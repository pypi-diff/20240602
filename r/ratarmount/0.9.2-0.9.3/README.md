# Comparing `tmp/ratarmount-0.9.2.tar.gz` & `tmp/ratarmount-0.9.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "ratarmount-0.9.2.tar", last modified: Sun Nov 28 19:44:20 2021, max compression
+gzip compressed data, was "ratarmount-0.9.3.tar", last modified: Tue Dec 21 00:09:29 2021, max compression
```

## Comparing `ratarmount-0.9.2.tar` & `ratarmount-0.9.3.tar`

### file list

```diff
@@ -1,15 +1,15 @@
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-11-28 19:44:20.071406 ratarmount-0.9.2/
--rw-r--r--   0 runner    (1001) docker     (121)     1070 2021-11-28 19:44:10.000000 ratarmount-0.9.2/LICENSE
--rw-r--r--   0 runner    (1001) docker     (121)       56 2021-11-28 19:44:10.000000 ratarmount-0.9.2/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (121)    34640 2021-11-28 19:44:20.071406 ratarmount-0.9.2/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)    29676 2021-11-28 19:44:10.000000 ratarmount-0.9.2/README.md
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-11-28 19:44:20.071406 ratarmount-0.9.2/ratarmount.egg-info/
--rw-r--r--   0 runner    (1001) docker     (121)    34640 2021-11-28 19:44:19.000000 ratarmount-0.9.2/ratarmount.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)      258 2021-11-28 19:44:19.000000 ratarmount-0.9.2/ratarmount.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (121)        1 2021-11-28 19:44:19.000000 ratarmount-0.9.2/ratarmount.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (121)       47 2021-11-28 19:44:19.000000 ratarmount-0.9.2/ratarmount.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (121)      329 2021-11-28 19:44:19.000000 ratarmount-0.9.2/ratarmount.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (121)       11 2021-11-28 19:44:19.000000 ratarmount-0.9.2/ratarmount.egg-info/top_level.txt
--rwxr-xr-x   0 runner    (1001) docker     (121)   163058 2021-11-28 19:44:10.000000 ratarmount-0.9.2/ratarmount.py
--rw-r--r--   0 runner    (1001) docker     (121)       38 2021-11-28 19:44:20.071406 ratarmount-0.9.2/setup.cfg
--rwxr-xr-x   0 runner    (1001) docker     (121)     2195 2021-11-28 19:44:10.000000 ratarmount-0.9.2/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-21 00:09:29.274203 ratarmount-0.9.3/
+-rw-r--r--   0 runner    (1001) docker     (121)     1070 2021-12-21 00:09:16.000000 ratarmount-0.9.3/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (121)       56 2021-12-21 00:09:16.000000 ratarmount-0.9.3/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (121)    34640 2021-12-21 00:09:29.274203 ratarmount-0.9.3/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (121)    29676 2021-12-21 00:09:16.000000 ratarmount-0.9.3/README.md
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-21 00:09:29.274203 ratarmount-0.9.3/ratarmount.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (121)    34640 2021-12-21 00:09:28.000000 ratarmount-0.9.3/ratarmount.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (121)      258 2021-12-21 00:09:29.000000 ratarmount-0.9.3/ratarmount.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (121)        1 2021-12-21 00:09:28.000000 ratarmount-0.9.3/ratarmount.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       47 2021-12-21 00:09:28.000000 ratarmount-0.9.3/ratarmount.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (121)      329 2021-12-21 00:09:28.000000 ratarmount-0.9.3/ratarmount.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       11 2021-12-21 00:09:28.000000 ratarmount-0.9.3/ratarmount.egg-info/top_level.txt
+-rwxr-xr-x   0 runner    (1001) docker     (121)   163705 2021-12-21 00:09:16.000000 ratarmount-0.9.3/ratarmount.py
+-rw-r--r--   0 runner    (1001) docker     (121)       38 2021-12-21 00:09:29.274203 ratarmount-0.9.3/setup.cfg
+-rwxr-xr-x   0 runner    (1001) docker     (121)     2195 2021-12-21 00:09:16.000000 ratarmount-0.9.3/setup.py
```

### Comparing `ratarmount-0.9.2/LICENSE` & `ratarmount-0.9.3/LICENSE`

 * *Files identical despite different names*

### Comparing `ratarmount-0.9.2/PKG-INFO` & `ratarmount-0.9.3/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ratarmount
-Version: 0.9.2
+Version: 0.9.3
 Summary: Random Access Read-Only Tar Mount
 Home-page: https://github.com/mxmlnkn/ratarmount
 Author: Maximilian Knespel
 Author-email: mxmlnkn@github.de
 License: MIT
 Description: # Random Access Read-Only Tar Mount (Ratarmount)
```

### Comparing `ratarmount-0.9.2/README.md` & `ratarmount-0.9.3/README.md`

 * *Files identical despite different names*

### Comparing `ratarmount-0.9.2/ratarmount.egg-info/PKG-INFO` & `ratarmount-0.9.3/ratarmount.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ratarmount
-Version: 0.9.2
+Version: 0.9.3
 Summary: Random Access Read-Only Tar Mount
 Home-page: https://github.com/mxmlnkn/ratarmount
 Author: Maximilian Knespel
 Author-email: mxmlnkn@github.de
 License: MIT
 Description: # Random Access Read-Only Tar Mount (Ratarmount)
```

### Comparing `ratarmount-0.9.2/ratarmount.py` & `ratarmount-0.9.3/ratarmount.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,10184 +9,10224 @@
 00000080: 7420 6a73 6f6e 0a69 6d70 6f72 7420 6f73  t json.import os
 00000090: 0a69 6d70 6f72 7420 7265 0a69 6d70 6f72  .import re.impor
 000000a0: 7420 7371 6c69 7465 330a 696d 706f 7274  t sqlite3.import
 000000b0: 2073 7461 740a 696d 706f 7274 2073 7973   stat.import sys
 000000c0: 0a69 6d70 6f72 7420 7461 7266 696c 650a  .import tarfile.
 000000d0: 696d 706f 7274 2074 656d 7066 696c 650a  import tempfile.
 000000e0: 696d 706f 7274 2074 696d 650a 696d 706f  import time.impo
-000000f0: 7274 2074 7261 6365 6261 636b 0a66 726f  rt traceback.fro
-00000100: 6d20 6162 6320 696d 706f 7274 2041 4243  m abc import ABC
-00000110: 2c20 6162 7374 7261 6374 6d65 7468 6f64  , abstractmethod
-00000120: 0a66 726f 6d20 7469 6d65 6974 2069 6d70  .from timeit imp
-00000130: 6f72 7420 6465 6661 756c 745f 7469 6d65  ort default_time
-00000140: 7220 6173 2074 696d 6572 0a69 6d70 6f72  r as timer.impor
-00000150: 7420 7479 7069 6e67 0a66 726f 6d20 7479  t typing.from ty
-00000160: 7069 6e67 2069 6d70 6f72 7420 416e 792c  ping import Any,
-00000170: 2041 6e79 5374 722c 2063 6173 742c 2044   AnyStr, cast, D
-00000180: 6963 742c 2049 4f2c 2049 7465 7261 626c  ict, IO, Iterabl
-00000190: 652c 204c 6973 742c 204f 7074 696f 6e61  e, List, Optiona
-000001a0: 6c2c 2053 6574 2c20 5475 706c 652c 2055  l, Set, Tuple, U
-000001b0: 6e69 6f6e 0a66 726f 6d20 6461 7461 636c  nion.from datacl
-000001c0: 6173 7365 7320 696d 706f 7274 2064 6174  asses import dat
-000001d0: 6163 6c61 7373 0a69 6d70 6f72 7420 6461  aclass.import da
-000001e0: 7461 636c 6173 7365 730a 0a23 2043 616e  taclasses..# Can
-000001f0: 2774 2064 6f20 7468 6973 2064 796e 616d  't do this dynam
-00000200: 6963 616c 6c79 2077 6974 6820 696d 706f  ically with impo
-00000210: 7274 6c69 622e 696d 706f 7274 5f6d 6f64  rtlib.import_mod
-00000220: 756c 6520 616e 6420 7573 696e 6720 7375  ule and using su
-00000230: 7070 6f72 7465 6443 6f6d 7072 6573 7369  pportedCompressi
-00000240: 6f6e 730a 2320 6265 6361 7573 6520 7468  ons.# because th
-00000250: 656e 2074 6865 2073 7461 7469 6320 6368  en the static ch
-00000260: 6563 6b65 7273 206c 696b 6520 6d79 7079  eckers like mypy
-00000270: 2061 6e64 2070 796c 696e 7420 776f 6e27   and pylint won'
-00000280: 7420 7265 636f 676e 697a 6520 7468 6520  t recognize the 
-00000290: 6d6f 6475 6c65 7321 0a74 7279 3a0a 2020  modules!.try:.  
-000002a0: 2020 696d 706f 7274 2066 7573 650a 6578    import fuse.ex
-000002b0: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
-000002c0: 3a0a 2020 2020 7061 7373 0a74 7279 3a0a  :.    pass.try:.
-000002d0: 2020 2020 696d 706f 7274 2069 6e64 6578      import index
-000002e0: 6564 5f62 7a69 7032 0a65 7863 6570 7420  ed_bzip2.except 
-000002f0: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
-00000300: 2070 6173 730a 7472 793a 0a20 2020 2069   pass.try:.    i
-00000310: 6d70 6f72 7420 696e 6465 7865 645f 677a  mport indexed_gz
-00000320: 6970 0a65 7863 6570 7420 496d 706f 7274  ip.except Import
-00000330: 4572 726f 723a 0a20 2020 2070 6173 730a  Error:.    pass.
-00000340: 7472 793a 0a20 2020 2069 6d70 6f72 7420  try:.    import 
-00000350: 696e 6465 7865 645f 7a73 7464 0a65 7863  indexed_zstd.exc
-00000360: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
-00000370: 0a20 2020 2070 6173 730a 7472 793a 0a20  .    pass.try:. 
-00000380: 2020 2069 6d70 6f72 7420 6c7a 6d61 6666     import lzmaff
-00000390: 690a 6578 6365 7074 2049 6d70 6f72 7445  i.except ImportE
-000003a0: 7272 6f72 3a0a 2020 2020 7061 7373 0a74  rror:.    pass.t
-000003b0: 7279 3a0a 2020 2020 696d 706f 7274 2078  ry:.    import x
-000003c0: 7a0a 6578 6365 7074 2049 6d70 6f72 7445  z.except ImportE
-000003d0: 7272 6f72 3a0a 2020 2020 7061 7373 0a74  rror:.    pass.t
-000003e0: 7279 3a0a 2020 2020 696d 706f 7274 2072  ry:.    import r
-000003f0: 6172 6669 6c65 0a65 7863 6570 7420 496d  arfile.except Im
-00000400: 706f 7274 4572 726f 723a 0a20 2020 2070  portError:.    p
-00000410: 6173 730a 0a0a 2320 5468 6520 6669 6c65  ass...# The file
-00000420: 206f 626a 6563 7420 7265 7475 726e 6564   object returned
-00000430: 2062 7920 5a69 7046 696c 652e 6f70 656e   by ZipFile.open
-00000440: 2069 7320 6e6f 7420 7365 656b 6162 6c65   is not seekable
-00000450: 2069 6e20 5079 7468 6f6e 2033 2e36 2066   in Python 3.6 f
-00000460: 6f72 2073 6f6d 6520 7265 6173 6f6e 2e0a  or some reason..
-00000470: 2320 5468 6572 6566 6f72 6520 6469 7361  # Therefore disa
-00000480: 626c 6520 5a49 5020 7375 7070 6f72 7420  ble ZIP support 
-00000490: 7468 6572 6521 0a23 2049 2064 6f6e 2774  there!.# I don't
-000004a0: 2073 6565 2069 7420 646f 6375 6d65 6e74   see it document
-000004b0: 6564 2c20 696e 7374 6561 6420 4920 7465  ed, instead I te
-000004c0: 7374 6564 2064 6966 6665 7265 6e74 2050  sted different P
-000004d0: 7974 686f 6e20 7665 7273 696f 6e73 2077  ython versions w
-000004e0: 6974 6820 446f 636b 6572 2e0a 6966 2073  ith Docker..if s
-000004f0: 7973 2e76 6572 7369 6f6e 5f69 6e66 6f5b  ys.version_info[
-00000500: 325d 203e 2036 3a0a 2020 2020 696d 706f  2] > 6:.    impo
-00000510: 7274 207a 6970 6669 6c65 0a0a 0a5f 5f76  rt zipfile...__v
-00000520: 6572 7369 6f6e 5f5f 203d 2027 302e 392e  ersion__ = '0.9.
-00000530: 3227 0a0a 0a70 6172 616c 6c65 6c69 7a61  2'...paralleliza
-00000540: 7469 6f6e 203d 2031 0a0a 0a64 6566 2068  tion = 1...def h
-00000550: 6173 4e6f 6e45 6d70 7479 5375 7070 6f72  asNonEmptySuppor
-00000560: 7428 2920 2d3e 2062 6f6f 6c3a 0a20 2020  t() -> bool:.   
-00000570: 2074 7279 3a0a 2020 2020 2020 2020 7769   try:.        wi
-00000580: 7468 206f 732e 706f 7065 6e28 2766 7573  th os.popen('fus
-00000590: 6572 6d6f 756e 7420 2d56 2729 2061 7320  ermount -V') as 
-000005a0: 7069 7065 3a0a 2020 2020 2020 2020 2020  pipe:.          
-000005b0: 2020 6d61 7463 6820 3d20 7265 2e73 6561    match = re.sea
-000005c0: 7263 6828 7227 285b 302d 395d 2b29 5b2e  rch(r'([0-9]+)[.
-000005d0: 5d5b 302d 395d 2b5b 2e5d 5b30 2d39 5d2b  ][0-9]+[.][0-9]+
-000005e0: 272c 2070 6970 652e 7265 6164 2829 290a  ', pipe.read()).
-000005f0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00000600: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00000610: 2020 2020 2020 7265 7475 726e 2069 6e74        return int
-00000620: 286d 6174 6368 2e67 726f 7570 2831 2929  (match.group(1))
-00000630: 203c 2033 0a20 2020 2065 7863 6570 7420   < 3.    except 
-00000640: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00000650: 2020 2070 6173 730a 0a20 2020 2072 6574     pass..    ret
-00000660: 7572 6e20 4661 6c73 6520 2023 204f 6e20  urn False  # On 
-00000670: 6d61 634f 532c 2066 7573 6572 6d6f 756e  macOS, fusermoun
-00000680: 7420 646f 6573 206e 746f 2065 7869 7374  t does nto exist
-00000690: 2061 6e64 206d 6163 6675 7365 2061 6c73   and macfuse als
-000006a0: 6f20 7365 656d 7320 746f 2063 6f6d 706c  o seems to compl
-000006b0: 6169 6e20 7769 7468 206e 6f6e 656d 7074  ain with nonempt
-000006c0: 7920 6f70 7469 6f6e 2e0a 0a0a 2320 4465  y option....# De
-000006d0: 6669 6e69 6e67 206c 616d 6264 6173 2064  fining lambdas d
-000006e0: 6f65 7320 6e6f 7420 7965 7420 6368 6563  oes not yet chec
-000006f0: 6b20 7468 6520 6e61 6d65 7320 6f66 2065  k the names of e
-00000700: 6e74 6974 6965 7320 7573 6564 2069 6e73  ntities used ins
-00000710: 6964 6520 7468 6520 6c61 6d62 6461 210a  ide the lambda!.
-00000720: 436f 6d70 7265 7373 696f 6e49 6e66 6f20  CompressionInfo 
-00000730: 3d20 636f 6c6c 6563 7469 6f6e 732e 6e61  = collections.na
-00000740: 6d65 6474 7570 6c65 280a 2020 2020 2743  medtuple(.    'C
-00000750: 6f6d 7072 6573 7369 6f6e 496e 666f 272c  ompressionInfo',
-00000760: 205b 2773 7566 6669 7865 7327 2c20 2764   ['suffixes', 'd
-00000770: 6f75 626c 6553 7566 6669 7865 7327 2c20  oubleSuffixes', 
-00000780: 276d 6f64 756c 654e 616d 6527 2c20 2763  'moduleName', 'c
-00000790: 6865 636b 4865 6164 6572 272c 2027 6f70  heckHeader', 'op
-000007a0: 656e 275d 0a29 0a73 7570 706f 7274 6564  en'].).supported
-000007b0: 436f 6d70 7265 7373 696f 6e73 203d 207b  Compressions = {
-000007c0: 0a20 2020 2027 627a 3227 3a20 436f 6d70  .    'bz2': Comp
-000007d0: 7265 7373 696f 6e49 6e66 6f28 0a20 2020  ressionInfo(.   
-000007e0: 2020 2020 205b 2762 7a32 272c 2027 627a       ['bz2', 'bz
-000007f0: 6970 3227 5d2c 0a20 2020 2020 2020 205b  ip2'],.        [
-00000800: 2774 6232 272c 2027 7462 7a27 2c20 2774  'tb2', 'tbz', 't
-00000810: 627a 3227 2c20 2774 7a32 275d 2c0a 2020  bz2', 'tz2'],.  
-00000820: 2020 2020 2020 2769 6e64 6578 6564 5f62        'indexed_b
-00000830: 7a69 7032 272c 0a20 2020 2020 2020 206c  zip2',.        l
-00000840: 616d 6264 6120 783a 2028 782e 7265 6164  ambda x: (x.read
-00000850: 2834 295b 3a33 5d20 3d3d 2062 2742 5a68  (4)[:3] == b'BZh
-00000860: 2720 616e 6420 782e 7265 6164 2836 2920  ' and x.read(6) 
-00000870: 3d3d 2028 3078 3331 3431 3539 3236 3533  == (0x3141592653
-00000880: 3539 292e 746f 5f62 7974 6573 2836 2c20  59).to_bytes(6, 
-00000890: 2762 6967 2729 292c 0a20 2020 2020 2020  'big')),.       
-000008a0: 206c 616d 6264 6120 783a 2069 6e64 6578   lambda x: index
-000008b0: 6564 5f62 7a69 7032 2e6f 7065 6e28 782c  ed_bzip2.open(x,
-000008c0: 2070 6172 616c 6c65 6c69 7a61 7469 6f6e   parallelization
-000008d0: 3d70 6172 616c 6c65 6c69 7a61 7469 6f6e  =parallelization
-000008e0: 292c 0a20 2020 2029 2c0a 2020 2020 2767  ),.    ),.    'g
-000008f0: 7a27 3a20 436f 6d70 7265 7373 696f 6e49  z': CompressionI
-00000900: 6e66 6f28 0a20 2020 2020 2020 205b 2767  nfo(.        ['g
-00000910: 7a27 2c20 2767 7a69 7027 5d2c 0a20 2020  z', 'gzip'],.   
-00000920: 2020 2020 205b 2774 617a 272c 2027 7467       ['taz', 'tg
-00000930: 7a27 5d2c 0a20 2020 2020 2020 2027 696e  z'],.        'in
-00000940: 6465 7865 645f 677a 6970 272c 0a20 2020  dexed_gzip',.   
-00000950: 2020 2020 206c 616d 6264 6120 783a 2078       lambda x: x
-00000960: 2e72 6561 6428 3229 203d 3d20 6227 5c78  .read(2) == b'\x
-00000970: 3146 5c78 3842 272c 0a20 2020 2020 2020  1F\x8B',.       
-00000980: 206c 616d 6264 6120 783a 2069 6e64 6578   lambda x: index
-00000990: 6564 5f67 7a69 702e 496e 6465 7865 6447  ed_gzip.IndexedG
-000009a0: 7a69 7046 696c 6528 6669 6c65 6f62 6a3d  zipFile(fileobj=
-000009b0: 7829 2c0a 2020 2020 292c 0a20 2020 2027  x),.    ),.    '
-000009c0: 7261 7227 3a20 436f 6d70 7265 7373 696f  rar': Compressio
-000009d0: 6e49 6e66 6f28 0a20 2020 2020 2020 205b  nInfo(.        [
-000009e0: 2772 6172 275d 2c0a 2020 2020 2020 2020  'rar'],.        
-000009f0: 5b5d 2c0a 2020 2020 2020 2020 2772 6172  [],.        'rar
-00000a00: 6669 6c65 272c 0a20 2020 2020 2020 206c  file',.        l
-00000a10: 616d 6264 6120 783a 2078 2e72 6561 6428  ambda x: x.read(
-00000a20: 3629 203d 3d20 6227 5261 7221 5c78 3141  6) == b'Rar!\x1A
-00000a30: 5c78 3037 272c 0a20 2020 2020 2020 206c  \x07',.        l
-00000a40: 616d 6264 6120 783a 2072 6172 6669 6c65  ambda x: rarfile
-00000a50: 2e52 6172 4669 6c65 2878 292c 0a20 2020  .RarFile(x),.   
-00000a60: 2029 2c0a 2020 2020 2778 7a27 3a20 436f   ),.    'xz': Co
-00000a70: 6d70 7265 7373 696f 6e49 6e66 6f28 0a20  mpressionInfo(. 
-00000a80: 2020 2020 2020 205b 2778 7a27 5d2c 0a20         ['xz'],. 
-00000a90: 2020 2020 2020 205b 2774 787a 275d 2c0a         ['txz'],.
-00000aa0: 2020 2020 2020 2020 276c 7a6d 6166 6669          'lzmaffi
-00000ab0: 2720 6966 2027 6c7a 6d61 6666 6927 2069  ' if 'lzmaffi' i
-00000ac0: 6e20 676c 6f62 616c 7328 2920 656c 7365  n globals() else
-00000ad0: 2027 787a 272c 0a20 2020 2020 2020 206c   'xz',.        l
-00000ae0: 616d 6264 6120 783a 2078 2e72 6561 6428  ambda x: x.read(
-00000af0: 3629 203d 3d20 6222 5c78 4644 377a 585a  6) == b"\xFD7zXZ
-00000b00: 5c78 3030 222c 0a20 2020 2020 2020 2028  \x00",.        (
-00000b10: 6c61 6d62 6461 2078 3a20 6c7a 6d61 6666  lambda x: lzmaff
-00000b20: 692e 6f70 656e 2878 2929 2069 6620 276c  i.open(x)) if 'l
-00000b30: 7a6d 6166 6669 2720 696e 2067 6c6f 6261  zmaffi' in globa
-00000b40: 6c73 2829 2065 6c73 6520 286c 616d 6264  ls() else (lambd
-00000b50: 6120 783a 2078 7a2e 6f70 656e 2878 2929  a x: xz.open(x))
-00000b60: 2c0a 2020 2020 292c 0a20 2020 2027 7a69  ,.    ),.    'zi
-00000b70: 7027 3a20 436f 6d70 7265 7373 696f 6e49  p': CompressionI
-00000b80: 6e66 6f28 0a20 2020 2020 2020 205b 277a  nfo(.        ['z
-00000b90: 6970 275d 2c0a 2020 2020 2020 2020 5b5d  ip'],.        []
-00000ba0: 2c0a 2020 2020 2020 2020 277a 6970 6669  ,.        'zipfi
-00000bb0: 6c65 272c 0a20 2020 2020 2020 206c 616d  le',.        lam
-00000bc0: 6264 6120 783a 2078 2e72 6561 6428 3229  bda x: x.read(2)
-00000bd0: 203d 3d20 6227 504b 272c 0a20 2020 2020   == b'PK',.     
-00000be0: 2020 206c 616d 6264 6120 783a 207a 6970     lambda x: zip
-00000bf0: 6669 6c65 2e5a 6970 4669 6c65 2878 292c  file.ZipFile(x),
-00000c00: 0a20 2020 2029 2c0a 2020 2020 277a 7374  .    ),.    'zst
-00000c10: 273a 2043 6f6d 7072 6573 7369 6f6e 496e  ': CompressionIn
-00000c20: 666f 280a 2020 2020 2020 2020 5b27 7a73  fo(.        ['zs
-00000c30: 7427 2c20 277a 7374 6427 5d2c 0a20 2020  t', 'zstd'],.   
-00000c40: 2020 2020 205b 2774 7a73 7427 5d2c 0a20       ['tzst'],. 
-00000c50: 2020 2020 2020 2027 696e 6465 7865 645f         'indexed_
-00000c60: 7a73 7464 272c 0a20 2020 2020 2020 206c  zstd',.        l
-00000c70: 616d 6264 6120 783a 2078 2e72 6561 6428  ambda x: x.read(
-00000c80: 3429 203d 3d20 2830 7846 4432 4642 3532  4) == (0xFD2FB52
-00000c90: 3829 2e74 6f5f 6279 7465 7328 342c 2027  8).to_bytes(4, '
-00000ca0: 6c69 7474 6c65 2729 2c0a 2020 2020 2020  little'),.      
-00000cb0: 2020 6c61 6d62 6461 2078 3a20 696e 6465    lambda x: inde
-00000cc0: 7865 645f 7a73 7464 2e49 6e64 6578 6564  xed_zstd.Indexed
-00000cd0: 5a73 7464 4669 6c65 2878 2e66 696c 656e  ZstdFile(x.filen
-00000ce0: 6f28 2929 2c0a 2020 2020 292c 0a7d 0a0a  o()),.    ),.}..
-00000cf0: 0a64 6566 2073 7472 6970 5375 6666 6978  .def stripSuffix
-00000d00: 4672 6f6d 436f 6d70 7265 7373 6564 4669  FromCompressedFi
-00000d10: 6c65 2870 6174 683a 2073 7472 2920 2d3e  le(path: str) ->
-00000d20: 2073 7472 3a0a 2020 2020 2222 2253 7472   str:.    """Str
-00000d30: 6970 7320 636f 6d70 7265 7373 696f 6e20  ips compression 
-00000d40: 7375 6666 6978 6573 206c 696b 6520 2e62  suffixes like .b
-00000d50: 7a32 2c20 2e67 7a2c 202e 2e2e 2222 220a  z2, .gz, ...""".
-00000d60: 2020 2020 666f 7220 636f 6d70 7265 7373      for compress
-00000d70: 696f 6e20 696e 2073 7570 706f 7274 6564  ion in supported
-00000d80: 436f 6d70 7265 7373 696f 6e73 2e76 616c  Compressions.val
-00000d90: 7565 7328 293a 0a20 2020 2020 2020 2066  ues():.        f
-00000da0: 6f72 2073 7566 6669 7820 696e 2063 6f6d  or suffix in com
-00000db0: 7072 6573 7369 6f6e 2e73 7566 6669 7865  pression.suffixe
-00000dc0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00000dd0: 6620 7061 7468 2e6c 6f77 6572 2829 2e65  f path.lower().e
-00000de0: 6e64 7377 6974 6828 272e 2720 2b20 7375  ndswith('.' + su
-00000df0: 6666 6978 2e6c 6f77 6572 2829 293a 0a20  ffix.lower()):. 
-00000e00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00000e10: 6574 7572 6e20 7061 7468 5b3a 202d 286c  eturn path[: -(l
-00000e20: 656e 2873 7566 6669 7829 202b 2031 295d  en(suffix) + 1)]
-00000e30: 0a0a 2020 2020 7265 7475 726e 2070 6174  ..    return pat
-00000e40: 680a 0a0a 6465 6620 7374 7269 7053 7566  h...def stripSuf
-00000e50: 6669 7846 726f 6d54 6172 4669 6c65 2870  fixFromTarFile(p
-00000e60: 6174 683a 2073 7472 2920 2d3e 2073 7472  ath: str) -> str
-00000e70: 3a0a 2020 2020 2222 2253 7472 6970 7320  :.    """Strips 
-00000e80: 6578 7465 6e73 696f 6e73 206c 696b 6520  extensions like 
-00000e90: 2e74 6172 2e67 7a20 6f72 202e 677a 206f  .tar.gz or .gz o
-00000ea0: 7220 2e74 677a 2c20 2e2e 2e22 2222 0a20  r .tgz, ...""". 
-00000eb0: 2020 2023 2031 2e20 5472 7920 666f 7220     # 1. Try for 
-00000ec0: 636f 6e66 6c61 7465 6420 7375 6666 6978  conflated suffix
-00000ed0: 6573 2066 6972 7374 0a20 2020 2066 6f72  es first.    for
-00000ee0: 2063 6f6d 7072 6573 7369 6f6e 2069 6e20   compression in 
-00000ef0: 7375 7070 6f72 7465 6443 6f6d 7072 6573  supportedCompres
-00000f00: 7369 6f6e 732e 7661 6c75 6573 2829 3a0a  sions.values():.
-00000f10: 2020 2020 2020 2020 666f 7220 7375 6666          for suff
-00000f20: 6978 2069 6e20 636f 6d70 7265 7373 696f  ix in compressio
-00000f30: 6e2e 646f 7562 6c65 5375 6666 6978 6573  n.doubleSuffixes
-00000f40: 202b 205b 2774 2720 2b20 7320 666f 7220   + ['t' + s for 
-00000f50: 7320 696e 2063 6f6d 7072 6573 7369 6f6e  s in compression
-00000f60: 2e73 7566 6669 7865 735d 3a0a 2020 2020  .suffixes]:.    
-00000f70: 2020 2020 2020 2020 6966 2070 6174 682e          if path.
-00000f80: 6c6f 7765 7228 292e 656e 6473 7769 7468  lower().endswith
-00000f90: 2827 2e27 202b 2073 7566 6669 782e 6c6f  ('.' + suffix.lo
-00000fa0: 7765 7228 2929 3a0a 2020 2020 2020 2020  wer()):.        
-00000fb0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00000fc0: 6174 685b 3a20 2d28 6c65 6e28 7375 6666  ath[: -(len(suff
-00000fd0: 6978 2920 2b20 3129 5d0a 0a20 2020 2023  ix) + 1)]..    #
-00000fe0: 2032 2e20 5265 6d6f 7665 2063 6f6d 7072   2. Remove compr
-00000ff0: 6573 7369 6f6e 2073 7566 6669 7865 730a  ession suffixes.
-00001000: 2020 2020 7061 7468 203d 2073 7472 6970      path = strip
-00001010: 5375 6666 6978 4672 6f6d 436f 6d70 7265  SuffixFromCompre
-00001020: 7373 6564 4669 6c65 2870 6174 6829 0a0a  ssedFile(path)..
-00001030: 2020 2020 2320 332e 2052 656d 6f76 6520      # 3. Remove 
-00001040: 2e74 6172 2069 6620 7765 2061 7265 206c  .tar if we are l
-00001050: 6566 7420 7769 7468 2069 7420 6166 7465  eft with it afte
-00001060: 7220 7468 6520 636f 6d70 7265 7373 696f  r the compressio
-00001070: 6e20 7375 6666 6978 2072 656d 6f76 616c  n suffix removal
-00001080: 0a20 2020 2069 6620 7061 7468 2e6c 6f77  .    if path.low
-00001090: 6572 2829 2e65 6e64 7377 6974 6828 272e  er().endswith('.
-000010a0: 7461 7227 293a 0a20 2020 2020 2020 2070  tar'):.        p
-000010b0: 6174 6820 3d20 7061 7468 5b3a 2d34 5d0a  ath = path[:-4].
-000010c0: 0a20 2020 2072 6574 7572 6e20 7061 7468  .    return path
-000010d0: 0a0a 0a70 7269 6e74 4465 6275 6720 3d20  ...printDebug = 
-000010e0: 310a 0a0a 636c 6173 7320 5261 7461 726d  1...class Ratarm
-000010f0: 6f75 6e74 4572 726f 7228 4578 6365 7074  ountError(Except
-00001100: 696f 6e29 3a0a 2020 2020 2222 2242 6173  ion):.    """Bas
-00001110: 6520 6578 6365 7074 696f 6e20 666f 7220  e exception for 
-00001120: 7261 7461 726d 6f75 6e74 206d 6f64 756c  ratarmount modul
-00001130: 652e 2222 220a 0a0a 636c 6173 7320 496e  e."""...class In
-00001140: 6465 784e 6f74 4f70 656e 4572 726f 7228  dexNotOpenError(
-00001150: 5261 7461 726d 6f75 6e74 4572 726f 7229  RatarmountError)
-00001160: 3a0a 2020 2020 2222 2245 7863 6570 7469  :.    """Excepti
-00001170: 6f6e 2066 6f72 206f 7065 7261 7469 6f6e  on for operation
-00001180: 7320 6578 6563 7574 6564 206f 6e20 6120  s executed on a 
-00001190: 636c 6f73 6564 2069 6e64 6578 2064 6174  closed index dat
-000011a0: 6162 6173 652e 2222 220a 0a0a 636c 6173  abase."""...clas
-000011b0: 7320 496e 7661 6c69 6449 6e64 6578 4572  s InvalidIndexEr
-000011c0: 726f 7228 5261 7461 726d 6f75 6e74 4572  ror(RatarmountEr
-000011d0: 726f 7229 3a0a 2020 2020 2222 2245 7863  ror):.    """Exc
-000011e0: 6570 7469 6f6e 2066 6f72 2069 6e64 6578  eption for index
-000011f0: 6573 2062 6569 6e67 2069 6e76 616c 6964  es being invalid
-00001200: 2c20 6f75 7464 6174 6564 2c20 6f72 2063  , outdated, or c
-00001210: 7265 6174 6564 2077 6974 6820 6469 6666  reated with diff
-00001220: 6572 656e 7420 6172 6775 6d65 6e74 732e  erent arguments.
-00001230: 2222 220a 0a0a 636c 6173 7320 436f 6d70  """...class Comp
-00001240: 7265 7373 696f 6e45 7272 6f72 2852 6174  ressionError(Rat
-00001250: 6172 6d6f 756e 7445 7272 6f72 293a 0a20  armountError):. 
-00001260: 2020 2022 2222 4578 6365 7074 696f 6e20     """Exception 
-00001270: 666f 7220 7472 7969 6e67 2074 6f20 6f70  for trying to op
-00001280: 656e 2066 696c 6573 2077 6974 6820 756e  en files with un
-00001290: 7375 7070 6f72 7465 6420 636f 6d70 7265  supported compre
-000012a0: 7373 696f 6e20 6f72 2075 6e61 7661 696c  ssion or unavail
-000012b0: 6162 6c65 2064 6563 6f6d 7072 6573 7369  able decompressi
-000012c0: 6f6e 206d 6f64 756c 652e 2222 220a 0a0a  on module."""...
-000012d0: 6465 6620 6f76 6572 7269 6465 7328 7061  def overrides(pa
-000012e0: 7265 6e74 436c 6173 7329 3a0a 2020 2020  rentClass):.    
-000012f0: 2222 2253 696d 706c 6520 6465 636f 7261  """Simple decora
-00001300: 746f 7220 7468 6174 2063 6865 636b 7320  tor that checks 
-00001310: 7468 6174 2061 206d 6574 686f 6420 7769  that a method wi
-00001320: 7468 2074 6865 2073 616d 6520 6e61 6d65  th the same name
-00001330: 2065 7869 7374 7320 696e 2074 6865 2070   exists in the p
-00001340: 6172 656e 7420 636c 6173 7322 2222 0a0a  arent class"""..
-00001350: 2020 2020 6465 6620 6f76 6572 7269 6465      def override
-00001360: 7228 6d65 7468 6f64 293a 0a20 2020 2020  r(method):.     
-00001370: 2020 2061 7373 6572 7420 6d65 7468 6f64     assert method
-00001380: 2e5f 5f6e 616d 655f 5f20 696e 2064 6972  .__name__ in dir
-00001390: 2870 6172 656e 7443 6c61 7373 290a 2020  (parentClass).  
-000013a0: 2020 2020 2020 6173 7365 7274 2063 616c        assert cal
-000013b0: 6c61 626c 6528 6765 7461 7474 7228 7061  lable(getattr(pa
-000013c0: 7265 6e74 436c 6173 732c 206d 6574 686f  rentClass, metho
-000013d0: 642e 5f5f 6e61 6d65 5f5f 2929 0a20 2020  d.__name__)).   
-000013e0: 2020 2020 2072 6574 7572 6e20 6d65 7468       return meth
-000013f0: 6f64 0a0a 2020 2020 7265 7475 726e 206f  od..    return o
-00001400: 7665 7272 6964 6572 0a0a 0a63 6c61 7373  verrider...class
-00001410: 2050 726f 6772 6573 7342 6172 3a0a 2020   ProgressBar:.  
-00001420: 2020 2222 2253 696d 706c 6520 7072 6f67    """Simple prog
-00001430: 7265 7373 2062 6172 2077 6869 6368 206b  ress bar which k
-00001440: 6565 7073 2074 7261 636b 206f 6620 6368  eeps track of ch
-00001450: 616e 6765 7320 616e 6420 7072 696e 7473  anges and prints
-00001460: 2074 6865 2070 726f 6772 6573 7320 616e   the progress an
-00001470: 6420 6120 7469 6d65 2065 7374 696d 6174  d a time estimat
-00001480: 652e 2222 220a 0a20 2020 2064 6566 205f  e."""..    def _
-00001490: 5f69 6e69 745f 5f28 7365 6c66 2c20 6d61  _init__(self, ma
-000014a0: 7856 616c 7565 3a20 666c 6f61 7429 3a0a  xValue: float):.
-000014b0: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
-000014c0: 6666 0a20 2020 2020 2020 2073 656c 662e  ff.        self.
-000014d0: 6d61 7856 616c 7565 2020 2020 2020 2020  maxValue        
-000014e0: 3d20 6d61 7856 616c 7565 0a20 2020 2020  = maxValue.     
-000014f0: 2020 2073 656c 662e 6c61 7374 5570 6461     self.lastUpda
-00001500: 7465 5469 6d65 2020 3d20 7469 6d65 2e74  teTime  = time.t
-00001510: 696d 6528 290a 2020 2020 2020 2020 7365  ime().        se
-00001520: 6c66 2e6c 6173 7455 7064 6174 6556 616c  lf.lastUpdateVal
-00001530: 7565 203d 2030 2e0a 2020 2020 2020 2020  ue = 0..        
-00001540: 7365 6c66 2e75 7064 6174 6549 6e74 6572  self.updateInter
-00001550: 7661 6c20 203d 2032 2e20 2023 2073 6563  val  = 2.  # sec
-00001560: 6f6e 6473 0a20 2020 2020 2020 2073 656c  onds.        sel
-00001570: 662e 6372 6561 7469 6f6e 5469 6d65 2020  f.creationTime  
-00001580: 2020 3d20 7469 6d65 2e74 696d 6528 290a    = time.time().
-00001590: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
-000015a0: 6e0a 0a20 2020 2064 6566 2075 7064 6174  n..    def updat
-000015b0: 6528 7365 6c66 2c20 7661 6c75 653a 2066  e(self, value: f
-000015c0: 6c6f 6174 2920 2d3e 204e 6f6e 653a 0a20  loat) -> None:. 
-000015d0: 2020 2020 2020 2022 2222 5368 6f75 6c64         """Should
-000015e0: 2062 6520 6361 6c6c 6564 2077 6865 6e65   be called whene
-000015f0: 7665 7220 7468 6520 6d6f 6e69 746f 7265  ver the monitore
-00001600: 6420 7661 6c75 6520 6368 616e 6765 732e  d value changes.
-00001610: 2054 6865 2070 726f 6772 6573 7320 6261   The progress ba
-00001620: 7220 6973 2075 7064 6174 6564 2061 6363  r is updated acc
-00001630: 6f72 6469 6e67 6c79 2e22 2222 0a20 2020  ordingly.""".   
-00001640: 2020 2020 2069 6620 7365 6c66 2e6c 6173       if self.las
-00001650: 7455 7064 6174 6554 696d 6520 6973 206e  tUpdateTime is n
-00001660: 6f74 204e 6f6e 6520 616e 6420 2874 696d  ot None and (tim
-00001670: 652e 7469 6d65 2829 202d 2073 656c 662e  e.time() - self.
-00001680: 6c61 7374 5570 6461 7465 5469 6d65 2920  lastUpdateTime) 
-00001690: 3c20 7365 6c66 2e75 7064 6174 6549 6e74  < self.updateInt
-000016a0: 6572 7661 6c3a 0a20 2020 2020 2020 2020  erval:.         
-000016b0: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-000016c0: 2020 2023 2055 7365 2077 686f 6c65 2069     # Use whole i
-000016d0: 6e74 6572 7661 6c20 7369 6e63 6520 7374  nterval since st
-000016e0: 6172 7420 746f 2065 7374 696d 6174 6520  art to estimate 
-000016f0: 7469 6d65 0a20 2020 2020 2020 2065 7461  time.        eta
-00001700: 3120 3d20 696e 7428 2874 696d 652e 7469  1 = int((time.ti
-00001710: 6d65 2829 202d 2073 656c 662e 6372 6561  me() - self.crea
-00001720: 7469 6f6e 5469 6d65 2920 2f20 7661 6c75  tionTime) / valu
-00001730: 6520 2a20 2873 656c 662e 6d61 7856 616c  e * (self.maxVal
-00001740: 7565 202d 2076 616c 7565 2929 0a20 2020  ue - value)).   
-00001750: 2020 2020 2023 2055 7365 206f 6e6c 7920       # Use only 
-00001760: 6120 7368 6f72 7465 7220 7769 6e64 6f77  a shorter window
-00001770: 2069 6e74 6572 7661 6c20 746f 2065 7374   interval to est
-00001780: 696d 6174 6520 7469 6d65 2e0a 2020 2020  imate time..    
-00001790: 2020 2020 2320 4163 636f 756e 7473 2062      # Accounts b
-000017a0: 6574 7465 7220 666f 7220 6869 6768 6572  etter for higher
-000017b0: 2073 7065 6564 7320 696e 2062 6567 696e   speeds in begin
-000017c0: 6e69 6e67 2c20 652e 672e 2c20 6361 7573  ning, e.g., caus
-000017d0: 6564 2062 7920 6361 6368 696e 6720 6566  ed by caching ef
-000017e0: 6665 6374 732e 0a20 2020 2020 2020 2023  fects..        #
-000017f0: 2048 6f77 6576 6572 2c20 7468 6973 2065   However, this e
-00001800: 7374 696d 6174 6520 6d69 6768 7420 7661  stimate might va
-00001810: 7279 2061 206c 6f74 2077 6869 6c65 2074  ry a lot while t
-00001820: 6865 206f 7468 6572 206f 6e65 2073 7461  he other one sta
-00001830: 6269 6c69 7a65 7320 6166 7465 7220 736f  bilizes after so
-00001840: 6d65 2074 696d 6521 0a20 2020 2020 2020  me time!.       
-00001850: 2065 7461 3220 3d20 696e 7428 2874 696d   eta2 = int((tim
-00001860: 652e 7469 6d65 2829 202d 2073 656c 662e  e.time() - self.
-00001870: 6c61 7374 5570 6461 7465 5469 6d65 2920  lastUpdateTime) 
-00001880: 2f20 2876 616c 7565 202d 2073 656c 662e  / (value - self.
-00001890: 6c61 7374 5570 6461 7465 5661 6c75 6529  lastUpdateValue)
-000018a0: 202a 2028 7365 6c66 2e6d 6178 5661 6c75   * (self.maxValu
-000018b0: 6520 2d20 7661 6c75 6529 290a 2020 2020  e - value)).    
-000018c0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
-000018d0: 2020 2020 2020 2022 4375 7272 656e 746c         "Currentl
-000018e0: 7920 6174 2070 6f73 6974 696f 6e20 7b7d  y at position {}
-000018f0: 206f 6620 7b7d 2028 7b3a 2e32 667d 2529   of {} ({:.2f}%)
-00001900: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-00001910: 2245 7374 696d 6174 6564 2074 696d 6520  "Estimated time 
-00001920: 7265 6d61 696e 696e 6720 7769 7468 2063  remaining with c
-00001930: 7572 7265 6e74 2072 6174 653a 207b 7d20  urrent rate: {} 
-00001940: 6d69 6e20 7b7d 2073 2c20 7769 7468 2061  min {} s, with a
-00001950: 7665 7261 6765 2072 6174 653a 207b 7d20  verage rate: {} 
-00001960: 6d69 6e20 7b7d 2073 2e22 2e66 6f72 6d61  min {} s.".forma
-00001970: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00001980: 2020 2023 2066 6d74 3a6f 6666 0a20 2020     # fmt:off.   
-00001990: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000019a0: 7565 2c20 7365 6c66 2e6d 6178 5661 6c75  ue, self.maxValu
-000019b0: 652c 2076 616c 7565 202f 2073 656c 662e  e, value / self.
-000019c0: 6d61 7856 616c 7565 202a 2031 3030 2e30  maxValue * 100.0
-000019d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000019e0: 2020 6574 6132 202f 2f20 3630 2c20 6574    eta2 // 60, et
-000019f0: 6132 2025 2036 302c 0a20 2020 2020 2020  a2 % 60,.       
-00001a00: 2020 2020 2020 2020 2065 7461 3120 2f2f           eta1 //
-00001a10: 2036 302c 2065 7461 3120 2520 3630 0a20   60, eta1 % 60. 
-00001a20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00001a30: 2066 6d74 3a6f 6e0a 2020 2020 2020 2020   fmt:on.        
-00001a40: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00001a50: 2020 2066 6c75 7368 3d54 7275 652c 0a20     flush=True,. 
-00001a60: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00001a70: 2020 7365 6c66 2e6c 6173 7455 7064 6174    self.lastUpdat
-00001a80: 6554 696d 6520 3d20 7469 6d65 2e74 696d  eTime = time.tim
-00001a90: 6528 290a 2020 2020 2020 2020 7365 6c66  e().        self
-00001aa0: 2e6c 6173 7455 7064 6174 6556 616c 7565  .lastUpdateValue
-00001ab0: 203d 2076 616c 7565 0a0a 0a63 6c61 7373   = value...class
-00001ac0: 2053 7465 6e63 696c 6564 4669 6c65 2869   StenciledFile(i
-00001ad0: 6f2e 4275 6666 6572 6564 494f 4261 7365  o.BufferedIOBase
-00001ae0: 293a 0a20 2020 2022 2222 4120 6669 6c65  ):.    """A file
-00001af0: 2061 6273 7472 6163 7469 6f6e 206c 6179   abstraction lay
-00001b00: 6572 2067 6976 696e 6720 6120 7374 656e  er giving a sten
-00001b10: 6369 6c65 6420 7669 6577 2074 6f20 616e  ciled view to an
-00001b20: 2075 6e64 6572 6c79 696e 6720 6669 6c65   underlying file
-00001b30: 2e22 2222 0a0a 2020 2020 6465 6620 5f5f  ."""..    def __
-00001b40: 696e 6974 5f5f 2873 656c 662c 2066 696c  init__(self, fil
-00001b50: 656f 626a 3a20 494f 2c20 7374 656e 6369  eobj: IO, stenci
-00001b60: 6c73 3a20 4c69 7374 5b54 7570 6c65 5b69  ls: List[Tuple[i
-00001b70: 6e74 2c20 696e 745d 5d29 202d 3e20 4e6f  nt, int]]) -> No
-00001b80: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00001b90: 2020 2020 2020 2020 7374 656e 6369 6c73          stencils
-00001ba0: 3a20 4120 6c69 7374 2074 7570 6c65 7320  : A list tuples 
-00001bb0: 7370 6563 6966 7969 6e67 2074 6865 206f  specifying the o
-00001bc0: 6666 7365 7420 616e 6420 6c65 6e67 7468  ffset and length
-00001bd0: 206f 6620 7468 6520 756e 6465 726c 7969   of the underlyi
-00001be0: 6e67 2066 696c 6520 746f 2075 7365 2e0a  ng file to use..
-00001bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c00: 2020 5468 6520 6f72 6465 7220 6f66 2074    The order of t
-00001c10: 6865 7365 2074 7570 6c65 7320 7769 6c6c  hese tuples will
-00001c20: 2062 6520 6b65 7074 2e0a 2020 2020 2020   be kept..      
-00001c30: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00001c40: 6f66 6673 6574 206d 7573 7420 6265 206e  offset must be n
-00001c50: 6f6e 2d6e 6567 6174 6976 6520 616e 6420  on-negative and 
-00001c60: 7468 6520 7369 7a65 206d 7573 7420 6265  the size must be
-00001c70: 2070 6f73 6974 6976 652e 0a0a 2020 2020   positive...    
-00001c80: 2020 2020 4578 616d 706c 6573 3a0a 2020      Examples:.  
-00001c90: 2020 2020 2020 2020 2020 7374 656e 6369            stenci
-00001ca0: 6c20 3d20 5b28 352c 3729 5d0a 2020 2020  l = [(5,7)].    
-00001cb0: 2020 2020 2020 2020 2020 2020 4d61 6b65              Make
-00001cc0: 7320 6120 6e65 7720 3742 2073 697a 6564  s a new 7B sized
-00001cd0: 2076 6972 7475 616c 2066 696c 6520 7374   virtual file st
-00001ce0: 6172 7469 6e67 2061 7420 6f66 6673 6574  arting at offset
-00001cf0: 2035 206f 6620 6669 6c65 6f62 6a2e 0a20   5 of fileobj.. 
-00001d00: 2020 2020 2020 2020 2020 2073 7465 6e63             stenc
-00001d10: 696c 203d 205b 2830 2c33 292c 2835 2c33  il = [(0,3),(5,3
-00001d20: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-00001d30: 2020 204d 616b 6520 6120 6e65 7720 3642     Make a new 6B
-00001d40: 2073 697a 6564 2076 6972 7475 616c 2066   sized virtual f
-00001d50: 696c 6520 636f 6e74 6169 6e69 6e67 2062  ile containing b
-00001d60: 7974 6573 205b 302c 312c 322c 352c 362c  ytes [0,1,2,5,6,
-00001d70: 375d 206f 6620 6669 6c65 6f62 6a2e 0a20  7] of fileobj.. 
-00001d80: 2020 2020 2020 2020 2020 2073 7465 6e63             stenc
-00001d90: 696c 203d 205b 2830 2c33 292c 2830 2c33  il = [(0,3),(0,3
-00001da0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-00001db0: 2020 204d 616b 6520 6120 3642 2073 697a     Make a 6B siz
-00001dc0: 6520 6669 6c65 2063 6f6e 7461 696e 696e  e file containin
-00001dd0: 6720 7468 6520 6669 7273 7420 3342 206f  g the first 3B o
-00001de0: 6620 6669 6c65 6f62 6a20 7477 6963 6520  f fileobj twice 
-00001df0: 636f 6e63 6174 656e 6174 6564 2074 6f67  concatenated tog
-00001e00: 6574 6865 722e 0a20 2020 2020 2020 2022  ether..        "
-00001e10: 2222 0a0a 2020 2020 2020 2020 2320 666d  ""..        # fm
-00001e20: 743a 206f 6666 0a20 2020 2020 2020 2073  t: off.        s
-00001e30: 656c 662e 6669 6c65 6f62 6a20 3d20 6669  elf.fileobj = fi
-00001e40: 6c65 6f62 6a0a 2020 2020 2020 2020 7365  leobj.        se
-00001e50: 6c66 2e6f 6666 7365 7473 203d 205b 785b  lf.offsets = [x[
-00001e60: 305d 2066 6f72 2078 2069 6e20 7374 656e  0] for x in sten
-00001e70: 6369 6c73 5d0a 2020 2020 2020 2020 7365  cils].        se
-00001e80: 6c66 2e73 697a 6573 2020 203d 205b 785b  lf.sizes   = [x[
-00001e90: 315d 2066 6f72 2078 2069 6e20 7374 656e  1] for x in sten
-00001ea0: 6369 6c73 5d0a 2020 2020 2020 2020 7365  cils].        se
-00001eb0: 6c66 2e6f 6666 7365 7420 203d 2030 0a20  lf.offset  = 0. 
-00001ec0: 2020 2020 2020 2023 2066 6d74 3a20 6f6e         # fmt: on
-00001ed0: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
-00001ee0: 756c 6174 6520 6375 6d75 6c61 7469 7665  ulate cumulative
-00001ef0: 2073 697a 6573 0a20 2020 2020 2020 2073   sizes.        s
-00001f00: 656c 662e 6375 6d73 697a 6573 203d 205b  elf.cumsizes = [
-00001f10: 305d 0a20 2020 2020 2020 2066 6f72 206f  0].        for o
-00001f20: 6666 7365 742c 2073 697a 6520 696e 2073  ffset, size in s
-00001f30: 7465 6e63 696c 733a 0a20 2020 2020 2020  tencils:.       
-00001f40: 2020 2020 2061 7373 6572 7420 6f66 6673       assert offs
-00001f50: 6574 203e 3d20 300a 2020 2020 2020 2020  et >= 0.        
-00001f60: 2020 2020 6173 7365 7274 2073 697a 6520      assert size 
-00001f70: 3e3d 2030 0a20 2020 2020 2020 2020 2020  >= 0.           
-00001f80: 2073 656c 662e 6375 6d73 697a 6573 2e61   self.cumsizes.a
-00001f90: 7070 656e 6428 7365 6c66 2e63 756d 7369  ppend(self.cumsi
-00001fa0: 7a65 735b 2d31 5d20 2b20 7369 7a65 290a  zes[-1] + size).
-00001fb0: 0a20 2020 2020 2020 2023 2053 6565 6b20  .        # Seek 
-00001fc0: 746f 2074 6865 2066 6972 7374 2073 7465  to the first ste
-00001fd0: 6e63 696c 206f 6666 7365 7420 696e 2074  ncil offset in t
-00001fe0: 6865 2075 6e64 6572 6c79 696e 6720 6669  he underlying fi
-00001ff0: 6c65 2073 6f20 7468 6174 2022 7265 6164  le so that "read
-00002000: 2220 7769 6c6c 2077 6f72 6b20 6f75 742d  " will work out-
-00002010: 6f66 2d74 6865 2d62 6f78 0a20 2020 2020  of-the-box.     
-00002020: 2020 2073 656c 662e 7365 656b 2830 290a     self.seek(0).
-00002030: 0a20 2020 2064 6566 205f 6669 6e64 5374  .    def _findSt
-00002040: 656e 6369 6c28 7365 6c66 2c20 6f66 6673  encil(self, offs
-00002050: 6574 3a20 696e 7429 202d 3e20 696e 743a  et: int) -> int:
-00002060: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00002070: 2020 2020 2052 6574 7572 6e20 696e 6465       Return inde
-00002080: 7820 746f 2073 7465 6e63 696c 2077 6865  x to stencil whe
-00002090: 7265 206f 6666 7365 7420 6265 6c6f 6e67  re offset belong
-000020a0: 7320 746f 2e20 452e 672e 2c20 666f 7220  s to. E.g., for 
-000020b0: 7374 656e 6369 6c73 205b 2833 2c35 292c  stencils [(3,5),
-000020c0: 2838 2c32 295d 2c20 6f66 6673 6574 7320  (8,2)], offsets 
-000020d0: 3020 746f 0a20 2020 2020 2020 2061 6e64  0 to.        and
-000020e0: 2069 6e63 6c75 6469 6e67 2034 2077 696c   including 4 wil
-000020f0: 6c20 7374 696c 6c20 6265 2069 6e73 6964  l still be insid
-00002100: 6520 7374 656e 6369 6c20 2833 2c35 292c  e stencil (3,5),
-00002110: 2069 2e65 2e2c 2069 6e64 6578 2030 2077   i.e., index 0 w
-00002120: 696c 6c20 6265 2072 6574 7572 6e65 642e  ill be returned.
-00002130: 2046 6f72 206f 6666 7365 7420 362c 0a20   For offset 6,. 
-00002140: 2020 2020 2020 2069 6e64 6578 2031 2077         index 1 w
-00002150: 6f75 6c64 2062 6520 7265 7475 726e 6564  ould be returned
-00002160: 2062 6563 6175 7365 2069 7420 6e6f 7720   because it now 
-00002170: 6973 2069 6e20 7468 6520 7365 636f 6e64  is in the second
-00002180: 2063 6f6e 7469 6775 6f75 7320 7265 6769   contiguous regi
-00002190: 6f6e 202f 2073 7465 6e63 696c 2e0a 2020  on / stencil..  
-000021a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000021b0: 2020 2320 6269 7365 6374 5f6c 6566 7428    # bisect_left(
-000021c0: 2076 616c 7565 2029 2067 6976 6573 2061   value ) gives a
-000021d0: 6e20 696e 6465 7820 666f 7220 6120 6c6f  n index for a lo
-000021e0: 7765 7220 7261 6e67 653a 2076 616c 7565  wer range: value
-000021f0: 203c 2078 2066 6f72 2061 6c6c 2078 2069   < x for all x i
-00002200: 6e20 6c69 7374 5b30 3a69 5d0a 2020 2020  n list[0:i].    
-00002210: 2020 2020 2320 4265 6361 7573 6520 7661      # Because va
-00002220: 6c75 6520 3e3d 2030 2061 6e64 206c 6973  lue >= 0 and lis
-00002230: 7420 7374 6172 7473 2077 6974 6820 3020  t starts with 0 
-00002240: 7765 2063 616e 2074 6865 7265 666f 7265  we can therefore
-00002250: 2062 6520 7375 7265 2074 6861 7420 7468   be sure that th
-00002260: 6520 7265 7475 726e 6564 2069 3e30 0a20  e returned i>0. 
-00002270: 2020 2020 2020 2023 2043 6f6e 7369 6465         # Conside
-00002280: 7220 7468 6520 7374 656e 6369 6c73 205b  r the stencils [
-00002290: 2831 312c 3229 2c28 3232 2c32 292c 2833  (11,2),(22,2),(3
-000022a0: 332c 3229 5d20 2d3e 2063 756d 7369 7a65  3,2)] -> cumsize
-000022b0: 7320 5b30 2c32 2c34 2c36 5d2e 2053 6565  s [0,2,4,6]. See
-000022c0: 6b20 746f 206f 6666 7365 7420 3220 7368  k to offset 2 sh
-000022d0: 6f75 6c64 2073 6565 6b20 746f 2032 322e  ould seek to 22.
-000022e0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-000022f0: 6f66 6673 6574 203e 3d20 300a 2020 2020  offset >= 0.    
-00002300: 2020 2020 6920 3d20 6269 7365 6374 2e62      i = bisect.b
-00002310: 6973 6563 745f 6c65 6674 2873 656c 662e  isect_left(self.
-00002320: 6375 6d73 697a 6573 2c20 6f66 6673 6574  cumsizes, offset
-00002330: 202b 2031 2920 2d20 310a 2020 2020 2020   + 1) - 1.      
-00002340: 2020 6173 7365 7274 2069 203e 3d20 300a    assert i >= 0.
-00002350: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00002360: 0a0a 2020 2020 6465 6620 5f5f 656e 7465  ..    def __ente
-00002370: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00002380: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
-00002390: 2020 2020 6465 6620 5f5f 6578 6974 5f5f      def __exit__
-000023a0: 2873 656c 662c 2065 7863 6570 7469 6f6e  (self, exception
-000023b0: 5f74 7970 652c 2065 7863 6570 7469 6f6e  _type, exception
-000023c0: 5f76 616c 7565 2c20 6578 6365 7074 696f  _value, exceptio
-000023d0: 6e5f 7472 6163 6562 6163 6b29 3a0a 2020  n_traceback):.  
-000023e0: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-000023f0: 406f 7665 7272 6964 6573 2869 6f2e 4275  @overrides(io.Bu
-00002400: 6666 6572 6564 494f 4261 7365 290a 2020  fferedIOBase).  
-00002410: 2020 6465 6620 636c 6f73 6528 7365 6c66    def close(self
-00002420: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00002430: 2020 2023 2044 6f6e 2774 2063 6c6f 7365     # Don't close
-00002440: 2074 6865 206f 626a 6563 7420 6769 7665   the object give
-00002450: 6e20 746f 2075 730a 2020 2020 2020 2020  n to us.        
-00002460: 2320 7365 6c66 2e66 696c 656f 626a 2e63  # self.fileobj.c
-00002470: 6c6f 7365 2829 0a20 2020 2020 2020 2070  lose().        p
-00002480: 6173 730a 0a20 2020 2040 6f76 6572 7269  ass..    @overri
-00002490: 6465 7328 696f 2e42 7566 6665 7265 6449  des(io.BufferedI
-000024a0: 4f42 6173 6529 0a20 2020 2064 6566 2066  OBase).    def f
-000024b0: 696c 656e 6f28 7365 6c66 2920 2d3e 2069  ileno(self) -> i
-000024c0: 6e74 3a0a 2020 2020 2020 2020 2320 5468  nt:.        # Th
-000024d0: 6973 2069 7320 6120 7669 7274 7561 6c20  is is a virtual 
-000024e0: 5079 7468 6f6e 206c 6576 656c 2066 696c  Python level fil
-000024f0: 6520 6f62 6a65 6374 2061 6e64 2074 6865  e object and the
-00002500: 7265 666f 7265 2064 6f65 7320 6e6f 7420  refore does not 
-00002510: 6861 7665 2061 2076 616c 6964 204f 5320  have a valid OS 
-00002520: 6669 6c65 2064 6573 6372 6970 746f 7221  file descriptor!
-00002530: 0a20 2020 2020 2020 2072 6169 7365 2069  .        raise i
-00002540: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
-00002550: 7261 7469 6f6e 2829 0a0a 2020 2020 406f  ration()..    @o
-00002560: 7665 7272 6964 6573 2869 6f2e 4275 6666  verrides(io.Buff
-00002570: 6572 6564 494f 4261 7365 290a 2020 2020  eredIOBase).    
-00002580: 6465 6620 7365 656b 6162 6c65 2873 656c  def seekable(sel
-00002590: 6629 202d 3e20 626f 6f6c 3a0a 2020 2020  f) -> bool:.    
-000025a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000025b0: 6669 6c65 6f62 6a2e 7365 656b 6162 6c65  fileobj.seekable
-000025c0: 2829 0a0a 2020 2020 406f 7665 7272 6964  ()..    @overrid
-000025d0: 6573 2869 6f2e 4275 6666 6572 6564 494f  es(io.BufferedIO
-000025e0: 4261 7365 290a 2020 2020 6465 6620 7265  Base).    def re
-000025f0: 6164 6162 6c65 2873 656c 6629 202d 3e20  adable(self) -> 
-00002600: 626f 6f6c 3a0a 2020 2020 2020 2020 7265  bool:.        re
-00002610: 7475 726e 2073 656c 662e 6669 6c65 6f62  turn self.fileob
-00002620: 6a2e 7265 6164 6162 6c65 2829 0a0a 2020  j.readable()..  
-00002630: 2020 406f 7665 7272 6964 6573 2869 6f2e    @overrides(io.
-00002640: 4275 6666 6572 6564 494f 4261 7365 290a  BufferedIOBase).
-00002650: 2020 2020 6465 6620 7772 6974 6162 6c65      def writable
-00002660: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-00002670: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00002680: 616c 7365 0a0a 2020 2020 406f 7665 7272  alse..    @overr
-00002690: 6964 6573 2869 6f2e 4275 6666 6572 6564  ides(io.Buffered
-000026a0: 494f 4261 7365 290a 2020 2020 6465 6620  IOBase).    def 
-000026b0: 7265 6164 2873 656c 662c 2073 697a 653a  read(self, size:
-000026c0: 2069 6e74 203d 202d 3129 202d 3e20 6279   int = -1) -> by
-000026d0: 7465 733a 0a20 2020 2020 2020 2069 6620  tes:.        if 
-000026e0: 7369 7a65 203d 3d20 2d31 3a0a 2020 2020  size == -1:.    
-000026f0: 2020 2020 2020 2020 7369 7a65 203d 2073          size = s
-00002700: 656c 662e 6375 6d73 697a 6573 5b2d 315d  elf.cumsizes[-1]
-00002710: 202d 2073 656c 662e 6f66 6673 6574 0a0a   - self.offset..
-00002720: 2020 2020 2020 2020 2320 5468 6973 206c          # This l
-00002730: 6f6f 7020 776f 726b 7320 696e 2061 206b  oop works in a k
-00002740: 696e 6420 6f66 206c 6561 7066 726f 6720  ind of leapfrog 
-00002750: 6661 7368 696f 6e2e 204f 6e20 6561 6368  fashion. On each
-00002760: 2065 7665 6e20 6c6f 6f70 2069 7465 7261   even loop itera
-00002770: 7469 6f6e 2069 7420 7365 656b 7320 746f  tion it seeks to
-00002780: 2074 6865 206e 6578 7420 7374 656e 6369   the next stenci
-00002790: 6c0a 2020 2020 2020 2020 2320 616e 6420  l.        # and 
-000027a0: 6f6e 2065 6163 6820 6f64 6420 6974 6572  on each odd iter
-000027b0: 6174 696f 6e20 6974 2072 6561 6473 2074  ation it reads t
-000027c0: 6865 2064 6174 6120 616e 6420 696e 6372  he data and incr
-000027d0: 656d 656e 7473 2074 6865 206f 6666 7365  ements the offse
-000027e0: 7420 696e 7369 6465 2074 6865 2073 7465  t inside the ste
-000027f0: 6e63 696c 210a 2020 2020 2020 2020 7265  ncil!.        re
-00002800: 7375 6c74 203d 2062 2727 0a20 2020 2020  sult = b''.     
-00002810: 2020 2069 203d 2073 656c 662e 5f66 696e     i = self._fin
-00002820: 6453 7465 6e63 696c 2873 656c 662e 6f66  dStencil(self.of
-00002830: 6673 6574 290a 2020 2020 2020 2020 7768  fset).        wh
-00002840: 696c 6520 7369 7a65 203e 2030 2061 6e64  ile size > 0 and
-00002850: 2069 203c 206c 656e 2873 656c 662e 7369   i < len(self.si
-00002860: 7a65 7329 3a0a 2020 2020 2020 2020 2020  zes):.          
-00002870: 2020 2320 5265 6164 2061 7320 6d75 6368    # Read as much
-00002880: 2061 7320 7265 7175 6573 7465 6420 6f72   as requested or
-00002890: 2061 7320 6d75 6368 2061 7320 7468 6520   as much as the 
-000028a0: 6375 7272 656e 7420 636f 6e74 6967 756f  current contiguo
-000028b0: 7573 2072 6567 696f 6e20 2f20 7374 656e  us region / sten
-000028c0: 6369 6c20 7374 696c 6c20 636f 6e74 6169  cil still contai
-000028d0: 6e73 0a20 2020 2020 2020 2020 2020 2072  ns.            r
-000028e0: 6561 6461 626c 6553 697a 6520 3d20 6d69  eadableSize = mi
-000028f0: 6e28 7369 7a65 2c20 7365 6c66 2e73 697a  n(size, self.siz
-00002900: 6573 5b69 5d20 2d20 2873 656c 662e 6f66  es[i] - (self.of
-00002910: 6673 6574 202d 2073 656c 662e 6375 6d73  fset - self.cums
-00002920: 697a 6573 5b69 5d29 290a 2020 2020 2020  izes[i])).      
-00002930: 2020 2020 2020 6966 2072 6561 6461 626c        if readabl
-00002940: 6553 697a 6520 3d3d 2030 3a0a 2020 2020  eSize == 0:.    
-00002950: 2020 2020 2020 2020 2020 2020 2320 476f              # Go
-00002960: 2074 6f20 6e65 7874 2073 7465 6e63 696c   to next stencil
-00002970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002980: 2069 202b 3d20 310a 2020 2020 2020 2020   i += 1.        
-00002990: 2020 2020 2020 2020 6966 2069 203e 3d20          if i >= 
-000029a0: 6c65 6e28 7365 6c66 2e6f 6666 7365 7473  len(self.offsets
-000029b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000029c0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-000029d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000029e0: 662e 6669 6c65 6f62 6a2e 7365 656b 2873  f.fileobj.seek(s
-000029f0: 656c 662e 6f66 6673 6574 735b 695d 290a  elf.offsets[i]).
-00002a00: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00002a10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002a20: 2020 2320 4163 7475 616c 6c79 2072 6561    # Actually rea
-00002a30: 6420 6461 7461 0a20 2020 2020 2020 2020  d data.         
-00002a40: 2020 2020 2020 2074 6d70 203d 2073 656c         tmp = sel
-00002a50: 662e 6669 6c65 6f62 6a2e 7265 6164 2872  f.fileobj.read(r
-00002a60: 6561 6461 626c 6553 697a 6529 0a20 2020  eadableSize).   
-00002a70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00002a80: 662e 6f66 6673 6574 202b 3d20 6c65 6e28  f.offset += len(
-00002a90: 746d 7029 0a20 2020 2020 2020 2020 2020  tmp).           
-00002aa0: 2020 2020 2072 6573 756c 7420 2b3d 2074       result += t
-00002ab0: 6d70 0a20 2020 2020 2020 2020 2020 2020  mp.             
-00002ac0: 2020 2073 697a 6520 2d3d 2072 6561 6461     size -= reada
-00002ad0: 626c 6553 697a 650a 2020 2020 2020 2020  bleSize.        
-00002ae0: 2020 2020 2020 2020 2320 4e6f 772c 2065          # Now, e
-00002af0: 6974 6865 7220 7369 7a65 2069 7320 3020  ither size is 0 
-00002b00: 6f72 2072 6561 6461 626c 6553 697a 6520  or readableSize 
-00002b10: 7769 6c6c 2062 6520 3020 696e 2074 6865  will be 0 in the
-00002b20: 206e 6578 7420 6974 6572 6174 696f 6e0a   next iteration.
-00002b30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00002b40: 7265 7375 6c74 0a0a 2020 2020 406f 7665  result..    @ove
-00002b50: 7272 6964 6573 2869 6f2e 4275 6666 6572  rrides(io.Buffer
-00002b60: 6564 494f 4261 7365 290a 2020 2020 6465  edIOBase).    de
-00002b70: 6620 7365 656b 2873 656c 662c 206f 6666  f seek(self, off
-00002b80: 7365 743a 2069 6e74 2c20 7768 656e 6365  set: int, whence
-00002b90: 3a20 696e 7420 3d20 696f 2e53 4545 4b5f  : int = io.SEEK_
-00002ba0: 5345 5429 202d 3e20 696e 743a 0a20 2020  SET) -> int:.   
-00002bb0: 2020 2020 2069 6620 7768 656e 6365 203d       if whence =
-00002bc0: 3d20 696f 2e53 4545 4b5f 4355 523a 0a20  = io.SEEK_CUR:. 
-00002bd0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002be0: 6f66 6673 6574 202b 3d20 6f66 6673 6574  offset += offset
-00002bf0: 0a20 2020 2020 2020 2065 6c69 6620 7768  .        elif wh
-00002c00: 656e 6365 203d 3d20 696f 2e53 4545 4b5f  ence == io.SEEK_
-00002c10: 454e 443a 0a20 2020 2020 2020 2020 2020  END:.           
-00002c20: 2073 656c 662e 6f66 6673 6574 203d 2073   self.offset = s
-00002c30: 656c 662e 6375 6d73 697a 6573 5b2d 315d  elf.cumsizes[-1]
-00002c40: 202b 206f 6666 7365 740a 2020 2020 2020   + offset.      
-00002c50: 2020 656c 6966 2077 6865 6e63 6520 3d3d    elif whence ==
-00002c60: 2069 6f2e 5345 454b 5f53 4554 3a0a 2020   io.SEEK_SET:.  
-00002c70: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-00002c80: 6666 7365 7420 3d20 6f66 6673 6574 0a0a  ffset = offset..
-00002c90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00002ca0: 6f66 6673 6574 203c 2030 3a0a 2020 2020  offset < 0:.    
-00002cb0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00002cc0: 6c75 6545 7272 6f72 2822 5472 7969 6e67  lueError("Trying
-00002cd0: 2074 6f20 7365 656b 2062 6566 6f72 6520   to seek before 
-00002ce0: 7468 6520 7374 6172 7420 6f66 2074 6865  the start of the
-00002cf0: 2066 696c 6521 2229 0a20 2020 2020 2020   file!").       
-00002d00: 2069 6620 7365 6c66 2e6f 6666 7365 7420   if self.offset 
-00002d10: 3e3d 2073 656c 662e 6375 6d73 697a 6573  >= self.cumsizes
-00002d20: 5b2d 315d 3a0a 2020 2020 2020 2020 2020  [-1]:.          
-00002d30: 2020 7265 7475 726e 2073 656c 662e 6f66    return self.of
-00002d40: 6673 6574 0a0a 2020 2020 2020 2020 6920  fset..        i 
-00002d50: 3d20 7365 6c66 2e5f 6669 6e64 5374 656e  = self._findSten
-00002d60: 6369 6c28 7365 6c66 2e6f 6666 7365 7429  cil(self.offset)
-00002d70: 0a20 2020 2020 2020 206f 6666 7365 7449  .        offsetI
-00002d80: 6e73 6964 6553 7465 6e63 696c 203d 2073  nsideStencil = s
-00002d90: 656c 662e 6f66 6673 6574 202d 2073 656c  elf.offset - sel
-00002da0: 662e 6375 6d73 697a 6573 5b69 5d0a 2020  f.cumsizes[i].  
-00002db0: 2020 2020 2020 6173 7365 7274 206f 6666        assert off
-00002dc0: 7365 7449 6e73 6964 6553 7465 6e63 696c  setInsideStencil
-00002dd0: 203e 3d20 300a 2020 2020 2020 2020 6173   >= 0.        as
-00002de0: 7365 7274 206f 6666 7365 7449 6e73 6964  sert offsetInsid
-00002df0: 6553 7465 6e63 696c 203c 2073 656c 662e  eStencil < self.
-00002e00: 7369 7a65 735b 695d 0a20 2020 2020 2020  sizes[i].       
-00002e10: 2073 656c 662e 6669 6c65 6f62 6a2e 7365   self.fileobj.se
-00002e20: 656b 2873 656c 662e 6f66 6673 6574 735b  ek(self.offsets[
-00002e30: 695d 202b 206f 6666 7365 7449 6e73 6964  i] + offsetInsid
-00002e40: 6553 7465 6e63 696c 2c20 696f 2e53 4545  eStencil, io.SEE
-00002e50: 4b5f 5345 5429 0a0a 2020 2020 2020 2020  K_SET)..        
-00002e60: 7265 7475 726e 2073 656c 662e 6f66 6673  return self.offs
-00002e70: 6574 0a0a 2020 2020 406f 7665 7272 6964  et..    @overrid
-00002e80: 6573 2869 6f2e 4275 6666 6572 6564 494f  es(io.BufferedIO
-00002e90: 4261 7365 290a 2020 2020 6465 6620 7465  Base).    def te
-00002ea0: 6c6c 2873 656c 6629 202d 3e20 696e 743a  ll(self) -> int:
-00002eb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00002ec0: 7365 6c66 2e6f 6666 7365 740a 0a0a 4064  self.offset...@d
-00002ed0: 6174 6163 6c61 7373 0a63 6c61 7373 2046  ataclass.class F
-00002ee0: 696c 6549 6e66 6f3a 0a20 2020 2023 2066  ileInfo:.    # f
-00002ef0: 6d74 3a20 6f66 660a 2020 2020 7369 7a65  mt: off.    size
-00002f00: 2020 2020 203a 2069 6e74 0a20 2020 206d       : int.    m
-00002f10: 7469 6d65 2020 2020 3a20 666c 6f61 740a  time    : float.
-00002f20: 2020 2020 6d6f 6465 2020 2020 203a 2069      mode     : i
-00002f30: 6e74 0a20 2020 206c 696e 6b6e 616d 6520  nt.    linkname 
-00002f40: 3a20 7374 720a 2020 2020 7569 6420 2020  : str.    uid   
-00002f50: 2020 203a 2069 6e74 0a20 2020 2067 6964     : int.    gid
-00002f60: 2020 2020 2020 3a20 696e 740a 2020 2020        : int.    
-00002f70: 2320 4279 2063 6f6e 7665 6e74 696f 6e20  # By convention 
-00002f80: 7468 6973 2069 7320 6120 6c69 7374 2061  this is a list a
-00002f90: 6e64 204d 6f75 6e74 536f 7572 6365 7320  nd MountSources 
-00002fa0: 7368 6f75 6c64 206f 6e6c 7920 7265 6164  should only read
-00002fb0: 2074 6865 206c 6173 7420 656c 656d 656e   the last elemen
-00002fc0: 7420 616e 6420 6265 666f 7265 2066 6f72  t and before for
-00002fd0: 7761 7264 696e 6720 7468 650a 2020 2020  warding the.    
-00002fe0: 2320 4669 6c65 496e 666f 2074 6f20 6120  # FileInfo to a 
-00002ff0: 706f 7373 6962 6c79 2072 6563 7572 7369  possibly recursi
-00003000: 7665 6c79 2022 6d6f 756e 7465 6422 204d  vely "mounted" M
-00003010: 6f75 6e74 536f 7572 6365 2c20 7265 6d6f  ountSource, remo
-00003020: 7665 2074 6861 7420 6c61 7374 2065 6c65  ve that last ele
-00003030: 6d65 6e74 2062 656c 6f6e 6769 6e67 2074  ment belonging t
-00003040: 6f20 6974 2e0a 2020 2020 2320 5468 6973  o it..    # This
-00003050: 2077 6179 2061 6e20 6172 6269 7472 6172   way an arbitrar
-00003060: 7920 616d 6f75 6e74 206f 6620 7573 6572  y amount of user
-00003070: 6461 7461 2063 616e 2062 6520 7374 6f72  data can be stor
-00003080: 6564 2061 6e64 2069 7420 7368 6f75 6c64  ed and it should
-00003090: 2062 6520 6465 6369 6461 626c 6520 7768   be decidable wh
-000030a0: 6963 6820 6265 6c6f 6e67 7320 746f 2077  ich belongs to w
-000030b0: 686f 6d20 696e 0a20 2020 2023 2061 2063  hom in.    # a c
-000030c0: 6861 696e 206f 6620 4d6f 756e 7453 6f75  hain of MountSou
-000030d0: 7263 6520 6f62 6a65 6374 732e 0a20 2020  rce objects..   
-000030e0: 2075 7365 7264 6174 6120 3a20 4c69 7374   userdata : List
-000030f0: 5b41 6e79 5d0a 2020 2020 2320 666d 743a  [Any].    # fmt:
-00003100: 206f 6e0a 0a20 2020 2064 6566 2063 6c6f   on..    def clo
-00003110: 6e65 2873 656c 6629 3a0a 2020 2020 2020  ne(self):.      
-00003120: 2020 636f 7069 6564 203d 2064 6174 6163    copied = datac
-00003130: 6c61 7373 6573 2e72 6570 6c61 6365 2873  lasses.replace(s
-00003140: 656c 6629 0a20 2020 2020 2020 2023 204d  elf).        # M
-00003150: 616b 6520 6120 6e65 7720 7573 6572 6461  ake a new userda
-00003160: 7461 206c 6973 7420 6275 7420 646f 206e  ta list but do n
-00003170: 6f74 2064 6f20 6120 6675 6c6c 2064 6565  ot do a full dee
-00003180: 7020 636f 7079 2062 6563 6175 7365 2073  p copy because s
-00003190: 6f6d 6520 4d6f 756e 7453 6f75 7263 6573  ome MountSources
-000031a0: 2070 7574 2072 6566 6572 656e 6365 730a   put references.
-000031b0: 2020 2020 2020 2020 2320 746f 204d 6f75          # to Mou
-000031c0: 6e74 536f 7572 6365 7320 696e 746f 2075  ntSources into u
-000031d0: 7365 7264 6174 6120 616e 6420 7468 6f73  serdata and thos
-000031e0: 6520 7368 6f75 6c64 2061 6e64 2063 616e  e should and can
-000031f0: 206e 6f74 2062 6520 6465 6570 2063 6f70   not be deep cop
-00003200: 6965 642e 0a20 2020 2020 2020 2063 6f70  ied..        cop
-00003210: 6965 642e 7573 6572 6461 7461 203d 2073  ied.userdata = s
-00003220: 656c 662e 7573 6572 6461 7461 5b3a 5d0a  elf.userdata[:].
-00003230: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00003240: 6f70 6965 640a 0a0a 4064 6174 6163 6c61  opied...@datacla
-00003250: 7373 0a63 6c61 7373 2053 514c 6974 6549  ss.class SQLiteI
-00003260: 6e64 6578 6564 5461 7255 7365 7244 6174  ndexedTarUserDat
-00003270: 613a 0a20 2020 2023 2066 6d74 3a20 6f66  a:.    # fmt: of
-00003280: 660a 2020 2020 6f66 6673 6574 2020 2020  f.    offset    
-00003290: 2020 203a 2069 6e74 0a20 2020 206f 6666     : int.    off
-000032a0: 7365 7468 6561 6465 7220 3a20 696e 740a  setheader : int.
-000032b0: 2020 2020 6973 7461 7220 2020 2020 2020      istar       
-000032c0: 203a 2062 6f6f 6c0a 2020 2020 6973 7370   : bool.    issp
-000032d0: 6172 7365 2020 2020 203a 2062 6f6f 6c0a  arse     : bool.
-000032e0: 2020 2020 2320 666d 743a 206f 6e0a 0a0a      # fmt: on...
-000032f0: 636c 6173 7320 4d6f 756e 7453 6f75 7263  class MountSourc
-00003300: 6528 4142 4329 3a0a 2020 2020 2222 220a  e(ABC):.    """.
-00003310: 2020 2020 4765 6e65 7269 6320 636c 6173      Generic clas
-00003320: 7320 7265 7072 6573 656e 7469 6e67 2061  s representing a
-00003330: 206d 6f75 6e74 2070 6f69 6e74 2e20 4974   mount point. It
-00003340: 2773 2062 6173 6963 616c 6c79 206c 696b  's basically lik
-00003350: 6520 7468 6520 4655 5345 2041 5049 2062  e the FUSE API b
-00003360: 7574 2062 6f69 6c65 6420 646f 776e 0a20  ut boiled down. 
-00003370: 2020 2074 6f20 7468 6520 6e65 6365 7373     to the necess
-00003380: 6172 7920 6d65 7468 6f64 7320 666f 7220  ary methods for 
-00003390: 7261 7461 726d 6f75 6e74 2e0a 0a20 2020  ratarmount...   
-000033a0: 2053 696d 696c 6172 2c20 746f 2046 5553   Similar, to FUS
-000033b0: 452c 2061 6c6c 2070 6174 6873 2073 686f  E, all paths sho
-000033c0: 756c 6420 6861 7665 2061 206c 6561 6469  uld have a leadi
-000033d0: 6e67 2027 2f27 2e0a 2020 2020 4966 2074  ng '/'..    If t
-000033e0: 6865 7265 2069 7320 6973 206e 6f20 6c65  here is is no le
-000033f0: 6164 696e 6720 736c 6173 682c 2062 6568  ading slash, beh
-00003400: 6176 6520 6173 2069 6620 7468 6572 6520  ave as if there 
-00003410: 7761 7320 6f6e 652e 0a20 2020 2022 2222  was one..    """
-00003420: 0a0a 2020 2020 4061 6273 7472 6163 746d  ..    @abstractm
-00003430: 6574 686f 640a 2020 2020 6465 6620 6c69  ethod.    def li
-00003440: 7374 4469 7228 7365 6c66 2c20 7061 7468  stDir(self, path
-00003450: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
-00003460: 616c 5b49 7465 7261 626c 655b 7374 725d  al[Iterable[str]
-00003470: 5d3a 0a20 2020 2020 2020 2070 6173 730a  ]:.        pass.
-00003480: 0a20 2020 2040 6162 7374 7261 6374 6d65  .    @abstractme
-00003490: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-000034a0: 4669 6c65 496e 666f 2873 656c 662c 2070  FileInfo(self, p
-000034b0: 6174 683a 2073 7472 2c20 6669 6c65 5665  ath: str, fileVe
-000034c0: 7273 696f 6e3a 2069 6e74 203d 2030 2920  rsion: int = 0) 
-000034d0: 2d3e 204f 7074 696f 6e61 6c5b 4669 6c65  -> Optional[File
-000034e0: 496e 666f 5d3a 0a20 2020 2020 2020 2070  Info]:.        p
-000034f0: 6173 730a 0a20 2020 2040 6162 7374 7261  ass..    @abstra
-00003500: 6374 6d65 7468 6f64 0a20 2020 2064 6566  ctmethod.    def
-00003510: 2066 696c 6556 6572 7369 6f6e 7328 7365   fileVersions(se
-00003520: 6c66 2c20 7061 7468 3a20 7374 7229 202d  lf, path: str) -
-00003530: 3e20 696e 743a 0a20 2020 2020 2020 2070  > int:.        p
-00003540: 6173 730a 0a20 2020 2040 6162 7374 7261  ass..    @abstra
-00003550: 6374 6d65 7468 6f64 0a20 2020 2064 6566  ctmethod.    def
-00003560: 206f 7065 6e28 7365 6c66 2c20 6669 6c65   open(self, file
-00003570: 496e 666f 3a20 4669 6c65 496e 666f 2920  Info: FileInfo) 
-00003580: 2d3e 2049 4f5b 6279 7465 735d 3a0a 2020  -> IO[bytes]:.  
-00003590: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-000035a0: 4061 6273 7472 6163 746d 6574 686f 640a  @abstractmethod.
-000035b0: 2020 2020 6465 6620 7265 6164 2873 656c      def read(sel
-000035c0: 662c 2066 696c 6549 6e66 6f3a 2046 696c  f, fileInfo: Fil
-000035d0: 6549 6e66 6f2c 2073 697a 653a 2069 6e74  eInfo, size: int
-000035e0: 2c20 6f66 6673 6574 3a20 696e 7429 202d  , offset: int) -
-000035f0: 3e20 6279 7465 733a 0a20 2020 2020 2020  > bytes:.       
-00003600: 2070 6173 730a 0a20 2020 2064 6566 2067   pass..    def g
-00003610: 6574 4d6f 756e 7453 6f75 7263 6528 7365  etMountSource(se
-00003620: 6c66 2c20 6669 6c65 496e 666f 3a20 4669  lf, fileInfo: Fi
-00003630: 6c65 496e 666f 293a 0a20 2020 2020 2020  leInfo):.       
-00003640: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-00003650: 7572 6e73 2074 6865 2064 6972 6563 7420  urns the direct 
-00003660: 6d6f 756e 7420 736f 7572 6365 2074 6f20  mount source to 
-00003670: 7768 6963 6820 7468 6520 6669 6c65 496e  which the fileIn
-00003680: 666f 2062 656c 6f6e 6773 2c20 6120 6d6f  fo belongs, a mo
-00003690: 756e 7420 736f 7572 6365 2073 7065 6369  unt source speci
-000036a0: 6669 6320 6669 6c65 2069 6e66 6f2c 0a20  fic file info,. 
-000036b0: 2020 2020 2020 2061 6e64 2074 6865 206d         and the m
-000036c0: 6f75 6e74 2070 6f69 6e74 206f 6620 7468  ount point of th
-000036d0: 6520 7265 7475 726e 6564 206d 6f75 6e74  e returned mount
-000036e0: 2073 6f75 7263 6520 696e 2072 6573 7065   source in respe
-000036f0: 6374 2074 6f20 7468 6973 2028 7365 6c66  ct to this (self
-00003700: 2920 4d6f 756e 7453 6f75 7263 652e 0a20  ) MountSource.. 
-00003710: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003720: 2020 2072 6574 7572 6e20 272f 272c 2073     return '/', s
-00003730: 656c 662c 2066 696c 6549 6e66 6f0a 0a20  elf, fileInfo.. 
-00003740: 2020 2064 6566 2065 7869 7374 7328 7365     def exists(se
-00003750: 6c66 2c20 7061 7468 3a20 7374 7229 3a0a  lf, path: str):.
-00003760: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00003770: 656c 662e 6765 7446 696c 6549 6e66 6f28  elf.getFileInfo(
-00003780: 7061 7468 2920 6973 206e 6f74 204e 6f6e  path) is not Non
-00003790: 650a 0a20 2020 2064 6566 2069 7364 6972  e..    def isdir
-000037a0: 2873 656c 662c 2070 6174 683a 2073 7472  (self, path: str
-000037b0: 293a 0a20 2020 2020 2020 2066 696c 6549  ):.        fileI
-000037c0: 6e66 6f20 3d20 7365 6c66 2e67 6574 4669  nfo = self.getFi
-000037d0: 6c65 496e 666f 2870 6174 6829 0a20 2020  leInfo(path).   
-000037e0: 2020 2020 2072 6574 7572 6e20 6669 6c65       return file
-000037f0: 496e 666f 2069 7320 6e6f 7420 4e6f 6e65  Info is not None
-00003800: 2061 6e64 2073 7461 742e 535f 4953 4449   and stat.S_ISDI
-00003810: 5228 6669 6c65 496e 666f 2e6d 6f64 6529  R(fileInfo.mode)
-00003820: 0a0a 0a63 6c61 7373 2053 514c 6974 6549  ...class SQLiteI
-00003830: 6e64 6578 6564 5461 7228 4d6f 756e 7453  ndexedTar(MountS
-00003840: 6f75 7263 6529 3a0a 2020 2020 2222 220a  ource):.    """.
-00003850: 2020 2020 5468 6973 2063 6c61 7373 2072      This class r
-00003860: 6561 6473 206f 6e63 6520 7468 726f 7567  eads once throug
-00003870: 6820 7468 6520 7768 6f6c 6520 5441 5220  h the whole TAR 
-00003880: 6172 6368 6976 6520 616e 6420 7374 6f72  archive and stor
-00003890: 6573 2054 4152 2066 696c 6520 6f66 6673  es TAR file offs
-000038a0: 6574 730a 2020 2020 666f 7220 616c 6c20  ets.    for all 
-000038b0: 636f 6e74 6169 6e65 6420 6669 6c65 7320  contained files 
-000038c0: 696e 2061 6e20 696e 6465 7820 746f 2073  in an index to s
-000038d0: 7570 706f 7274 2066 6173 7420 7365 656b  upport fast seek
-000038e0: 696e 6720 746f 2061 2067 6976 656e 2066  ing to a given f
-000038f0: 696c 652e 0a20 2020 2022 2222 0a0a 2020  ile..    """..  
-00003900: 2020 2320 5665 7273 696f 6e20 302e 312e    # Version 0.1.
-00003910: 303a 0a20 2020 2023 2020 202d 2049 6e69  0:.    #   - Ini
-00003920: 7469 616c 2076 6572 7369 6f6e 0a20 2020  tial version.   
-00003930: 2023 2056 6572 7369 6f6e 2030 2e32 2e30   # Version 0.2.0
-00003940: 3a0a 2020 2020 2320 2020 2d20 4164 6420  :.    #   - Add 
-00003950: 7370 6172 7365 2073 7570 706f 7274 2061  sparse support a
-00003960: 6e64 2027 6f66 6673 6574 6865 6164 6572  nd 'offsetheader
-00003970: 2720 616e 6420 2769 7373 7061 7273 6527  ' and 'issparse'
-00003980: 2063 6f6c 756d 6e73 2074 6f20 7468 6520   columns to the 
-00003990: 5351 4c69 7465 2064 6174 6162 6173 650a  SQLite database.
-000039a0: 2020 2020 2320 2020 2d20 4164 6420 5441      #   - Add TA
-000039b0: 5220 6669 6c65 2073 697a 6520 6d65 7461  R file size meta
-000039c0: 6461 7461 2069 6e20 6f72 6465 7220 746f  data in order to
-000039d0: 2071 7569 636b 6c79 2063 6865 636b 2077   quickly check w
-000039e0: 6865 7468 6572 2074 6865 2054 4152 2063  hether the TAR c
-000039f0: 6861 6e67 6564 0a20 2020 2023 2020 202d  hanged.    #   -
-00003a00: 2041 6464 2027 6f66 6673 6574 6865 6164   Add 'offsethead
-00003a10: 6572 2720 746f 2074 6865 2070 7269 6d61  er' to the prima
-00003a20: 7279 206b 6579 206f 6620 7468 6520 2766  ry key of the 'f
-00003a30: 696c 6573 2720 7461 626c 6520 736f 2074  iles' table so t
-00003a40: 6861 7420 6669 6c65 7320 7768 6963 6820  hat files which 
-00003a50: 7765 7265 0a20 2020 2023 2020 2020 2075  were.    #     u
-00003a60: 7064 6174 6564 2069 6e20 7468 6520 5441  pdated in the TA
-00003a70: 5220 6361 6e20 7374 696c 6c20 6265 2061  R can still be a
-00003a80: 6363 6573 7365 6420 6966 206e 6563 6573  ccessed if neces
-00003a90: 7361 7279 2e0a 2020 2020 2320 5665 7273  sary..    # Vers
-00003aa0: 696f 6e20 302e 332e 303a 0a20 2020 2023  ion 0.3.0:.    #
-00003ab0: 2020 202d 2041 6464 2061 7267 756d 656e     - Add argumen
-00003ac0: 7473 2069 6e66 6c75 656e 6369 6e67 2074  ts influencing t
-00003ad0: 6865 2063 7265 6174 6564 2069 6e64 6578  he created index
-00003ae0: 2074 6f20 6d65 7461 6461 7461 2028 6967   to metadata (ig
-00003af0: 6e6f 7265 2d7a 6572 6f73 2c20 7265 6375  nore-zeros, recu
-00003b00: 7273 6976 652c 202e 2e2e 290a 2020 2020  rsive, ...).    
-00003b10: 2320 5665 7273 696f 6e20 302e 342e 303a  # Version 0.4.0:
-00003b20: 0a20 2020 2023 2020 202d 2041 6464 6564  .    #   - Added
-00003b30: 2027 677a 6970 696e 6465 7865 7327 2074   'gzipindexes' t
-00003b40: 6162 6c65 2c20 7768 6963 6820 6d61 7920  able, which may 
-00003b50: 636f 6e74 6169 6e20 6d75 6c74 6970 6c65  contain multiple
-00003b60: 2062 6c6f 6273 2069 6e20 636f 6e74 7261   blobs in contra
-00003b70: 7374 2074 6f20 2767 7a69 7069 6e64 6578  st to 'gzipindex
-00003b80: 2720 7461 626c 652e 0a20 2020 205f 5f76  ' table..    __v
-00003b90: 6572 7369 6f6e 5f5f 203d 2027 302e 342e  ersion__ = '0.4.
-00003ba0: 3027 0a0a 2020 2020 6465 6620 5f5f 696e  0'..    def __in
-00003bb0: 6974 5f5f 280a 2020 2020 2020 2020 2320  it__(.        # 
-00003bc0: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
-00003bd0: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
-00003be0: 6172 4669 6c65 4e61 6d65 2020 2020 2020  arFileName      
-00003bf0: 2020 2020 2020 2020 2020 3a20 4f70 7469            : Opti
-00003c00: 6f6e 616c 5b73 7472 5d20 2020 2020 2020  onal[str]       
-00003c10: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00003c20: 6669 6c65 4f62 6a65 6374 2020 2020 2020  fileObject      
-00003c30: 2020 2020 2020 2020 2020 203a 204f 7074             : Opt
-00003c40: 696f 6e61 6c5b 494f 5b62 7974 6573 5d5d  ional[IO[bytes]]
-00003c50: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00003c60: 2077 7269 7465 496e 6465 7820 2020 2020   writeIndex     
-00003c70: 2020 2020 2020 2020 2020 2020 3a20 626f              : bo
-00003c80: 6f6c 2020 2020 2020 2020 2020 2020 2020  ol              
-00003c90: 2020 3d20 4661 6c73 652c 0a20 2020 2020    = False,.     
-00003ca0: 2020 2063 6c65 6172 496e 6465 7843 6163     clearIndexCac
-00003cb0: 6865 2020 2020 2020 2020 2020 2020 3a20  he            : 
-00003cc0: 626f 6f6c 2020 2020 2020 2020 2020 2020  bool            
-00003cd0: 2020 2020 3d20 4661 6c73 652c 0a20 2020      = False,.   
-00003ce0: 2020 2020 2069 6e64 6578 4669 6c65 4e61       indexFileNa
-00003cf0: 6d65 2020 2020 2020 2020 2020 2020 2020  me              
-00003d00: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00003d10: 2020 2020 2020 3d20 4e6f 6e65 2c0a 2020        = None,.  
-00003d20: 2020 2020 2020 696e 6465 7846 6f6c 6465        indexFolde
-00003d30: 7273 2020 2020 2020 2020 2020 2020 2020  rs              
-00003d40: 203a 204f 7074 696f 6e61 6c5b 4c69 7374   : Optional[List
-00003d50: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
-00003d60: 2020 2020 2020 2072 6563 7572 7369 7665         recursive
-00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d80: 2020 3a20 626f 6f6c 2020 2020 2020 2020    : bool        
-00003d90: 2020 2020 2020 2020 3d20 4661 6c73 652c          = False,
-00003da0: 0a20 2020 2020 2020 2067 7a69 7053 6565  .        gzipSee
-00003db0: 6b50 6f69 6e74 5370 6163 696e 6720 2020  kPointSpacing   
-00003dc0: 2020 2020 3a20 696e 7420 2020 2020 2020      : int       
-00003dd0: 2020 2020 2020 2020 2020 3d20 342a 3130            = 4*10
-00003de0: 3234 2a31 3032 342c 0a20 2020 2020 2020  24*1024,.       
-00003df0: 2065 6e63 6f64 696e 6720 2020 2020 2020   encoding       
-00003e00: 2020 2020 2020 2020 2020 2020 3a20 7374              : st
-00003e10: 7220 2020 2020 2020 2020 2020 2020 2020  r               
-00003e20: 2020 3d20 7461 7266 696c 652e 454e 434f    = tarfile.ENCO
-00003e30: 4449 4e47 2c0a 2020 2020 2020 2020 7374  DING,.        st
-00003e40: 7269 7052 6563 7572 7369 7665 5461 7245  ripRecursiveTarE
-00003e50: 7874 656e 7369 6f6e 203a 2062 6f6f 6c20  xtension : bool 
-00003e60: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-00003e70: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00003e80: 6967 6e6f 7265 5a65 726f 7320 2020 2020  ignoreZeros     
-00003e90: 2020 2020 2020 2020 2020 203a 2062 6f6f             : boo
-00003ea0: 6c20 2020 2020 2020 2020 2020 2020 2020  l               
-00003eb0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00003ec0: 2020 7665 7269 6679 4d6f 6469 6669 6361    verifyModifica
-00003ed0: 7469 6f6e 5469 6d65 2020 2020 203a 2062  tionTime     : b
-00003ee0: 6f6f 6c20 2020 2020 2020 2020 2020 2020  ool             
-00003ef0: 2020 203d 2046 616c 7365 2c0a 2020 2020     = False,.    
-00003f00: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
-00003f10: 7361 626c 653d 756e 7573 6564 2d61 7267  sable=unused-arg
-00003f20: 756d 656e 740a 2020 2020 2020 2020 2a2a  ument.        **
-00003f30: 6b77 6172 6773 0a20 2020 2020 2020 2023  kwargs.        #
-00003f40: 2066 6d74 3a20 6f6e 0a20 2020 2029 202d   fmt: on.    ) -
-00003f50: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00003f60: 2222 220a 2020 2020 2020 2020 7461 7246  """.        tarF
-00003f70: 696c 654e 616d 6520 3a20 5061 7468 2074  ileName : Path t
-00003f80: 6f20 7468 6520 5441 5220 6669 6c65 2074  o the TAR file t
-00003f90: 6f20 6265 206f 7065 6e65 642e 2049 6620  o be opened. If 
-00003fa0: 6e6f 7420 7370 6563 6966 6965 642c 2061  not specified, a
-00003fb0: 2066 696c 654f 626a 6563 7420 6d75 7374   fileObject must
-00003fc0: 2062 6520 7370 6563 6966 6965 642e 0a20   be specified.. 
-00003fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fe0: 2020 2020 2049 6620 6f6e 6c79 2061 2066       If only a f
-00003ff0: 696c 654f 626a 6563 7420 6973 2067 6976  ileObject is giv
-00004000: 656e 2c20 7468 6520 6372 6561 7465 6420  en, the created 
-00004010: 696e 6465 7820 6361 6e27 7420 6265 2063  index can't be c
-00004020: 6163 6865 6420 2865 6666 6963 6965 6e74  ached (efficient
-00004030: 6c79 292e 0a20 2020 2020 2020 2066 696c  ly)..        fil
-00004040: 654f 626a 6563 7420 3a20 4120 696f 2e49  eObject : A io.I
-00004050: 4f42 6173 6520 6465 7269 7665 6420 6f62  OBase derived ob
-00004060: 6a65 6374 2e20 4966 206e 6f74 2073 7065  ject. If not spe
-00004070: 6369 6669 6564 2c20 7461 7246 696c 654e  cified, tarFileN
-00004080: 616d 6520 7769 6c6c 2062 6520 6f70 656e  ame will be open
-00004090: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-000040a0: 2020 2020 2020 2020 2049 6620 6974 2069           If it i
-000040b0: 7320 616e 2069 6e73 7461 6e63 6520 6f66  s an instance of
-000040c0: 2049 6e64 6578 6564 427a 6970 3246 696c   IndexedBzip2Fil
-000040d0: 652c 2049 6e64 6578 6564 477a 6970 4669  e, IndexedGzipFi
-000040e0: 6c65 2c20 6f72 2049 6e64 6578 6564 5a73  le, or IndexedZs
-000040f0: 7464 4669 6c65 2c20 7468 656e 2074 6865  tdFile, then the
-00004100: 206f 6666 7365 740a 2020 2020 2020 2020   offset.        
-00004110: 2020 2020 2020 2020 2020 2020 206c 6f61               loa
-00004120: 6469 6e67 2061 6e64 2073 746f 7269 6e67  ding and storing
-00004130: 2066 726f 6d20 616e 6420 746f 2074 6865   from and to the
-00004140: 2053 514c 6974 6520 6461 7461 6261 7365   SQLite database
-00004150: 2069 7320 6d61 6e61 6765 6420 6175 746f   is managed auto
-00004160: 6d61 7469 6361 6c6c 7920 6279 2074 6869  matically by thi
-00004170: 7320 636c 6173 732e 0a20 2020 2020 2020  s class..       
-00004180: 2077 7269 7465 496e 6465 7820 3a20 4966   writeIndex : If
-00004190: 2074 7275 652c 2074 6865 6e20 7468 6520   true, then the 
-000041a0: 7369 6465 6361 7220 696e 6465 7820 6669  sidecar index fi
-000041b0: 6c65 2077 696c 6c20 6265 2077 7269 7474  le will be writt
-000041c0: 656e 2074 6f20 6120 7375 6974 6162 6c65  en to a suitable
-000041d0: 206c 6f63 6174 696f 6e2e 0a20 2020 2020   location..     
-000041e0: 2020 2063 6c65 6172 496e 6465 7843 6163     clearIndexCac
-000041f0: 6865 203a 2049 6620 7472 7565 2c20 7468  he : If true, th
-00004200: 656e 2063 6865 636b 2061 6c6c 2070 6f73  en check all pos
-00004210: 7369 626c 6520 696e 6465 7820 6669 6c65  sible index file
-00004220: 206c 6f63 6174 696f 6e73 2066 6f72 2074   locations for t
-00004230: 6865 2067 6976 656e 2074 6172 4669 6c65  he given tarFile
-00004240: 4e61 6d65 2f66 696c 654f 626a 6563 740a  Name/fileObject.
-00004250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004260: 2020 2020 2020 2020 2020 636f 6d62 696e            combin
-00004270: 6174 696f 6e20 616e 6420 6465 6c65 7465  ation and delete
-00004280: 2074 6865 6d2e 2054 6869 7320 616c 736f   them. This also
-00004290: 2069 6d70 6c69 6369 746c 7920 666f 7263   implicitly forc
-000042a0: 6573 2061 2072 6563 7265 6174 696f 6e20  es a recreation 
-000042b0: 6f66 2074 6865 2069 6e64 6578 2e0a 2020  of the index..  
-000042c0: 2020 2020 2020 696e 6465 7846 696c 654e        indexFileN
-000042d0: 616d 6520 3a20 5061 7468 2074 6f20 7468  ame : Path to th
-000042e0: 6520 696e 6465 7820 6669 6c65 2066 6f72  e index file for
-000042f0: 2074 6869 7320 5441 5220 6172 6368 6976   this TAR archiv
-00004300: 652e 2054 6869 7320 7461 6b65 7320 7072  e. This takes pr
-00004310: 6563 6564 656e 6365 206f 7665 7220 7468  ecedence over th
-00004320: 6520 6175 746f 6d61 7469 6361 6c6c 790a  e automatically.
-00004330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004340: 2020 2020 2020 2020 6368 6f73 656e 206c          chosen l
-00004350: 6f63 6174 696f 6e73 2e0a 2020 2020 2020  ocations..      
-00004360: 2020 696e 6465 7846 6f6c 6465 7273 203a    indexFolders :
-00004370: 2053 7065 6369 6679 206f 6e65 206f 7220   Specify one or 
-00004380: 6d75 6c74 6970 6c65 2070 6174 6873 2066  multiple paths f
-00004390: 6f72 2073 746f 7269 6e67 202e 696e 6465  or storing .inde
-000043a0: 782e 7371 6c69 7465 2066 696c 6573 2e20  x.sqlite files. 
-000043b0: 5061 7468 7320 7769 6c6c 2062 6520 7465  Paths will be te
-000043c0: 7374 6564 2066 6f72 0a20 2020 2020 2020  sted for.       
-000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043e0: 7375 6974 6162 696c 6974 7920 696e 2074  suitability in t
-000043f0: 6865 2067 6976 656e 206f 7264 6572 2e20  he given order. 
-00004400: 416e 2065 6d70 7479 2070 6174 6820 7769  An empty path wi
-00004410: 6c6c 2062 6520 696e 7465 7270 7265 7465  ll be interprete
-00004420: 6420 6173 2074 6865 206c 6f63 6174 696f  d as the locatio
-00004430: 6e20 696e 2077 6869 6368 0a20 2020 2020  n in which.     
-00004440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004450: 2020 7468 6520 5441 5220 7265 7369 6465    the TAR reside
-00004460: 732e 2054 6869 7320 6f76 6572 7269 6465  s. This override
-00004470: 7320 7468 6520 6465 6661 756c 7420 696e  s the default in
-00004480: 6465 7820 6661 6c6c 6261 636b 2066 6f6c  dex fallback fol
-00004490: 6465 7220 696e 207e 2f2e 7261 7461 726d  der in ~/.ratarm
-000044a0: 6f75 6e74 2e0a 2020 2020 2020 2020 7265  ount..        re
-000044b0: 6375 7273 6976 6520 3a20 4966 2074 7275  cursive : If tru
-000044c0: 652c 2074 6865 6e20 5441 5220 6669 6c65  e, then TAR file
-000044d0: 7320 696e 7369 6465 2074 6869 7320 6172  s inside this ar
-000044e0: 6368 6976 6520 7769 6c6c 2062 6520 7265  chive will be re
-000044f0: 6375 7273 6976 656c 7920 616e 616c 797a  cursively analyz
-00004500: 6564 2061 6e64 2061 6464 6564 2074 6f20  ed and added to 
-00004510: 7468 6520 5351 4c69 7465 0a20 2020 2020  the SQLite.     
-00004520: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004530: 6e64 6578 2e20 4375 7272 656e 746c 792c  ndex. Currently,
-00004540: 2074 6869 7320 7265 6375 7273 696f 6e20   this recursion 
-00004550: 6361 6e20 6f6e 6c79 2062 7265 616b 2074  can only break t
-00004560: 6865 206f 7574 6572 6d6f 7374 2063 6f6d  he outermost com
-00004570: 7072 6573 7369 6f6e 206c 6179 6572 2e20  pression layer. 
-00004580: 492e 652e 2c20 6120 2e74 6172 2e62 7a32  I.e., a .tar.bz2
-00004590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000045a0: 2020 2020 2066 696c 6520 696e 7369 6465       file inside
-000045b0: 2061 2074 6172 2e62 7a32 2066 696c 6520   a tar.bz2 file 
-000045c0: 6361 6e20 6e6f 7420 6265 206d 6f75 6e74  can not be mount
-000045d0: 6564 2072 6563 7572 7369 7665 6c79 2e0a  ed recursively..
-000045e0: 2020 2020 2020 2020 677a 6970 5365 656b          gzipSeek
-000045f0: 506f 696e 7453 7061 6369 6e67 203a 2054  PointSpacing : T
-00004600: 6869 7320 636f 6e74 726f 6c73 2074 6865  his controls the
-00004610: 2066 7265 7175 656e 6379 206f 6620 677a   frequency of gz
-00004620: 6970 2064 6563 6f64 6572 2073 6565 6b20  ip decoder seek 
-00004630: 706f 696e 7473 2c20 7365 6520 696e 6465  points, see inde
-00004640: 7865 645f 677a 6970 2064 6f63 756d 656e  xed_gzip documen
-00004650: 7461 7469 6f6e 2e0a 2020 2020 2020 2020  tation..        
-00004660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004670: 2020 2020 2020 204c 6172 6765 7220 7370         Larger sp
-00004680: 6163 696e 6773 206c 6561 6420 746f 206c  acings lead to l
-00004690: 6573 7320 6d65 6d6f 7279 2075 7361 6765  ess memory usage
-000046a0: 2062 7574 2069 6e63 7265 6173 6520 7468   but increase th
-000046b0: 6520 636f 6e73 7461 6e74 2073 6565 6b20  e constant seek 
-000046c0: 6f76 6572 6865 6164 2e0a 2020 2020 2020  overhead..      
-000046d0: 2020 656e 636f 6469 6e67 203a 2057 696c    encoding : Wil
-000046e0: 6c20 6265 2066 6f72 7761 7264 6564 2074  l be forwarded t
-000046f0: 6f20 7461 7266 696c 652e 2053 7065 6369  o tarfile. Speci
-00004700: 6669 6573 2068 6f77 2066 696c 656e 616d  fies how filenam
-00004710: 6573 2069 6e73 6964 6520 7468 6520 5441  es inside the TA
-00004720: 5220 6172 6520 656e 636f 6465 642e 0a20  R are encoded.. 
-00004730: 2020 2020 2020 2069 676e 6f72 655a 6572         ignoreZer
-00004740: 6f73 203a 2057 696c 6c20 6265 2066 6f72  os : Will be for
-00004750: 7761 7264 6564 2074 6f20 7461 7266 696c  warded to tarfil
-00004760: 652e 2053 7065 6369 6669 6573 2074 6f20  e. Specifies to 
-00004770: 6e6f 7420 6f6e 6c79 2073 6b69 7020 7a65  not only skip ze
-00004780: 726f 2062 6c6f 636b 7320 6275 7420 616c  ro blocks but al
-00004790: 736f 2062 6c6f 636b 7320 7769 7468 0a20  so blocks with. 
-000047a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047b0: 2020 2020 2069 6e76 616c 6964 2064 6174       invalid dat
-000047c0: 612e 2053 6574 7469 6e67 2074 6869 7320  a. Setting this 
-000047d0: 746f 2074 7275 6520 6361 6e20 6c65 6164  to true can lead
-000047e0: 2074 6f20 736f 6d65 2070 726f 626c 656d   to some problem
-000047f0: 7320 6275 7420 6973 2072 6571 7569 7265  s but is require
-00004800: 6420 746f 2063 6f72 7265 6374 6c79 0a20  d to correctly. 
-00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004820: 2020 2020 2072 6561 6420 636f 6e63 6174       read concat
-00004830: 656e 6174 6564 2074 6172 732e 0a20 2020  enated tars..   
-00004840: 2020 2020 2073 7472 6970 5265 6375 7273       stripRecurs
-00004850: 6976 6554 6172 4578 7465 6e73 696f 6e20  iveTarExtension 
-00004860: 3a20 4966 2074 7275 6520 616e 6420 6966  : If true and if
-00004870: 2072 6563 7572 7369 7665 2069 7320 616c   recursive is al
-00004880: 736f 2074 7275 652c 2074 6865 6e20 6120  so true, then a 
-00004890: 3c66 696c 653e 2e74 6172 2069 6e73 6964  <file>.tar insid
-000048a0: 6520 7468 6520 6375 7272 656e 740a 2020  e the current.  
-000048b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048d0: 2020 2074 6172 2077 696c 6c20 6265 206d     tar will be m
-000048e0: 6f75 6e74 6564 2061 7420 3c66 696c 653e  ounted at <file>
-000048f0: 2f20 696e 7374 6561 6420 6f66 203c 6669  / instead of <fi
-00004900: 6c65 3e2e 7461 722f 2e0a 2020 2020 2020  le>.tar/..      
-00004910: 2020 7665 7269 6679 4d6f 6469 6669 6361    verifyModifica
-00004920: 7469 6f6e 5469 6d65 203a 2049 6620 7472  tionTime : If tr
-00004930: 7565 2c20 7468 656e 2074 6865 2069 6e64  ue, then the ind
-00004940: 6578 2077 696c 6c20 6265 2072 6563 7265  ex will be recre
-00004950: 6174 6564 2061 7574 6f6d 6174 6963 616c  ated automatical
-00004960: 6c79 2069 6620 7468 6520 5441 5220 6172  ly if the TAR ar
-00004970: 6368 6976 6520 6861 7320 6120 6d6f 7265  chive has a more
-00004980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049a0: 2020 7265 6365 6e74 206d 6f64 6966 6963    recent modific
-000049b0: 6174 696f 6e20 7469 6d65 2074 6861 6e20  ation time than 
-000049c0: 7468 6520 696e 6465 7820 6669 6c65 2e0a  the index file..
-000049d0: 2020 2020 2020 2020 6b77 6172 6773 203a          kwargs :
-000049e0: 2055 6e75 7365 642e 204f 6e6c 7920 666f   Unused. Only fo
-000049f0: 7220 636f 6d70 6174 6962 696c 6974 7920  r compatibility 
-00004a00: 7769 7468 2067 656e 6572 6963 204d 6f75  with generic Mou
-00004a10: 6e74 536f 7572 6365 2069 6e74 6572 6661  ntSource interfa
-00004a20: 6365 2e0a 2020 2020 2020 2020 2222 220a  ce..        """.
-00004a30: 0a20 2020 2020 2020 2023 2073 746f 7265  .        # store
-00004a40: 7320 7768 6963 6820 7061 7265 6e74 2066  s which parent f
-00004a50: 6f6c 6465 7273 2077 6572 6520 6c61 7374  olders were last
-00004a60: 2074 7269 6564 2074 6f20 6164 6420 746f   tried to add to
-00004a70: 2064 6174 6162 6173 6520 616e 6420 7468   database and th
-00004a80: 6572 6566 6f72 6520 646f 2065 7869 7374  erefore do exist
-00004a90: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00004aa0: 7265 6e74 466f 6c64 6572 4361 6368 653a  rentFolderCache:
-00004ab0: 204c 6973 745b 5475 706c 655b 7374 722c   List[Tuple[str,
-00004ac0: 2073 7472 5d5d 203d 205b 5d0a 2020 2020   str]] = [].    
-00004ad0: 2020 2020 7365 6c66 2e73 716c 436f 6e6e      self.sqlConn
-00004ae0: 6563 7469 6f6e 3a20 4f70 7469 6f6e 616c  ection: Optional
-00004af0: 5b73 716c 6974 6533 2e43 6f6e 6e65 6374  [sqlite3.Connect
-00004b00: 696f 6e5d 203d 204e 6f6e 650a 2020 2020  ion] = None.    
-00004b10: 2020 2020 7365 6c66 2e69 6e64 6578 4669      self.indexFi
-00004b20: 6c65 4e61 6d65 203d 204e 6f6e 650a 0a20  leName = None.. 
-00004b30: 2020 2020 2020 2023 2066 6d74 3a20 6f66         # fmt: of
-00004b40: 660a 2020 2020 2020 2020 7365 6c66 2e6d  f.        self.m
-00004b50: 6f75 6e74 5265 6375 7273 6976 656c 7920  ountRecursively 
-00004b60: 2020 2020 2020 2020 2020 3d20 7265 6375            = recu
-00004b70: 7273 6976 650a 2020 2020 2020 2020 7365  rsive.        se
-00004b80: 6c66 2e65 6e63 6f64 696e 6720 2020 2020  lf.encoding     
-00004b90: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00004ba0: 656e 636f 6469 6e67 0a20 2020 2020 2020  encoding.       
-00004bb0: 2073 656c 662e 7374 7269 7052 6563 7572   self.stripRecur
-00004bc0: 7369 7665 5461 7245 7874 656e 7369 6f6e  siveTarExtension
-00004bd0: 203d 2073 7472 6970 5265 6375 7273 6976   = stripRecursiv
-00004be0: 6554 6172 4578 7465 6e73 696f 6e0a 2020  eTarExtension.  
-00004bf0: 2020 2020 2020 7365 6c66 2e69 676e 6f72        self.ignor
-00004c00: 655a 6572 6f73 2020 2020 2020 2020 2020  eZeros          
-00004c10: 2020 2020 2020 3d20 6967 6e6f 7265 5a65        = ignoreZe
-00004c20: 726f 730a 2020 2020 2020 2020 7365 6c66  ros.        self
-00004c30: 2e76 6572 6966 794d 6f64 6966 6963 6174  .verifyModificat
-00004c40: 696f 6e54 696d 6520 2020 2020 3d20 7665  ionTime     = ve
-00004c50: 7269 6679 4d6f 6469 6669 6361 7469 6f6e  rifyModification
-00004c60: 5469 6d65 0a20 2020 2020 2020 2073 656c  Time.        sel
-00004c70: 662e 677a 6970 5365 656b 506f 696e 7453  f.gzipSeekPointS
-00004c80: 7061 6369 6e67 2020 2020 2020 203d 2067  pacing       = g
-00004c90: 7a69 7053 6565 6b50 6f69 6e74 5370 6163  zipSeekPointSpac
-00004ca0: 696e 670a 2020 2020 2020 2020 2320 666d  ing.        # fm
-00004cb0: 743a 206f 6e0a 0a20 2020 2020 2020 2073  t: on..        s
-00004cc0: 656c 662e 7461 7246 696c 654e 616d 653a  elf.tarFileName:
-00004cd0: 2073 7472 203d 2027 3c66 696c 6520 6f62   str = '<file ob
-00004ce0: 6a65 6374 3e27 0a20 2020 2020 2020 2069  ject>'.        i
-00004cf0: 6620 6e6f 7420 6669 6c65 4f62 6a65 6374  f not fileObject
-00004d00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00004d10: 206e 6f74 2074 6172 4669 6c65 4e61 6d65   not tarFileName
-00004d20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004d30: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00004d40: 6f72 2822 4174 206c 6561 7374 206f 6e65  or("At least one
-00004d50: 206f 6620 7461 7246 696c 654e 616d 6520   of tarFileName 
-00004d60: 616e 6420 6669 6c65 4f62 6a65 6374 2061  and fileObject a
-00004d70: 7267 756d 656e 7473 2073 686f 756c 6420  rguments should 
-00004d80: 6265 2073 6574 2122 290a 2020 2020 2020  be set!").      
-00004d90: 2020 2020 2020 7365 6c66 2e74 6172 4669        self.tarFi
-00004da0: 6c65 4e61 6d65 203d 206f 732e 7061 7468  leName = os.path
-00004db0: 2e61 6273 7061 7468 2874 6172 4669 6c65  .abspath(tarFile
-00004dc0: 4e61 6d65 290a 2020 2020 2020 2020 2020  Name).          
-00004dd0: 2020 6669 6c65 4f62 6a65 6374 203d 206f    fileObject = o
-00004de0: 7065 6e28 7365 6c66 2e74 6172 4669 6c65  pen(self.tarFile
-00004df0: 4e61 6d65 2c20 2772 6227 290a 2020 2020  Name, 'rb').    
-00004e00: 2020 2020 656c 6966 2074 6172 4669 6c65      elif tarFile
-00004e10: 4e61 6d65 3a0a 2020 2020 2020 2020 2020  Name:.          
-00004e20: 2020 2320 4966 2074 6172 4669 6c65 4e61    # If tarFileNa
-00004e30: 6d65 2077 6173 2073 7065 6369 6669 6564  me was specified
-00004e40: 2066 6f72 2061 2066 696c 6520 6f62 6a65   for a file obje
-00004e50: 6374 2c20 7365 7420 7365 6c66 2e74 6172  ct, set self.tar
-00004e60: 4669 6c65 4e61 6d65 2061 6363 6f72 6469  FileName accordi
-00004e70: 6e67 6c79 2e0a 2020 2020 2020 2020 2020  ngly..          
-00004e80: 2020 7365 6c66 2e74 6172 4669 6c65 4e61    self.tarFileNa
-00004e90: 6d65 203d 2074 6172 4669 6c65 4e61 6d65  me = tarFileName
-00004ea0: 0a0a 2020 2020 2020 2020 6669 6c65 4f62  ..        fileOb
-00004eb0: 6a65 6374 2e73 6565 6b28 302c 2069 6f2e  ject.seek(0, io.
-00004ec0: 5345 454b 5f45 4e44 290a 2020 2020 2020  SEEK_END).      
-00004ed0: 2020 6669 6c65 5369 7a65 203d 2066 696c    fileSize = fil
-00004ee0: 654f 626a 6563 742e 7465 6c6c 2829 0a20  eObject.tell(). 
-00004ef0: 2020 2020 2020 2066 696c 654f 626a 6563         fileObjec
-00004f00: 742e 7365 656b 2830 290a 0a20 2020 2020  t.seek(0)..     
-00004f10: 2020 2023 2072 6177 4669 6c65 4f62 6a65     # rawFileObje
-00004f20: 6374 203a 204f 6e6c 7920 7365 7420 7768  ct : Only set wh
-00004f30: 656e 206f 7065 6e69 6e67 2061 2063 6f6d  en opening a com
-00004f40: 7072 6573 7365 6420 6669 6c65 2061 6e64  pressed file and
-00004f50: 206f 6e6c 7920 6b65 7074 2074 6f20 6b65   only kept to ke
-00004f60: 6570 2074 6865 0a20 2020 2020 2020 2023  ep the.        #
-00004f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f80: 2063 6f6d 7072 6573 7365 6420 6669 6c65   compressed file
-00004f90: 2068 616e 646c 6520 6672 6f6d 2062 6569   handle from bei
-00004fa0: 6e67 2063 6c6f 7365 6420 6279 2074 6865  ng closed by the
-00004fb0: 2067 6172 6261 6765 2063 6f6c 6c65 6374   garbage collect
-00004fc0: 6f72 2e0a 2020 2020 2020 2020 2320 7461  or..        # ta
-00004fd0: 7246 696c 654f 626a 6563 7420 3a20 4669  rFileObject : Fi
-00004fe0: 6c65 206f 626a 6563 7420 746f 2074 6865  le object to the
-00004ff0: 2075 6e63 6f6d 7072 6573 7365 6420 286f   uncompressed (o
-00005000: 7220 6465 636f 6d70 7265 7373 6564 2920  r decompressed) 
-00005010: 5441 5220 6669 6c65 2074 6f20 7265 6164  TAR file to read
-00005020: 2061 6374 7561 6c20 6461 7461 206f 7574   actual data out
-00005030: 206f 662e 0a20 2020 2020 2020 2023 2063   of..        # c
-00005040: 6f6d 7072 6573 7369 6f6e 2020 203a 2053  ompression   : S
-00005050: 746f 7265 7320 7768 6174 206b 696e 6420  tores what kind 
-00005060: 6f66 2063 6f6d 7072 6573 7369 6f6e 2074  of compression t
-00005070: 6865 206f 7269 6769 6e61 6c6c 7920 7370  he originally sp
-00005080: 6563 6966 6965 6420 5441 5220 6669 6c65  ecified TAR file
-00005090: 2075 7365 732e 0a20 2020 2020 2020 2023   uses..        #
-000050a0: 2069 7354 6172 2020 2020 2020 2020 203a   isTar         :
-000050b0: 2043 616e 2062 6520 6661 6c73 6520 666f   Can be false fo
-000050c0: 7220 7468 6520 6465 6765 6e65 7261 7465  r the degenerate
-000050d0: 6420 6361 7365 206f 6620 6f6e 6c79 2061  d case of only a
-000050e0: 2062 7a32 206f 7220 677a 2066 696c 6520   bz2 or gz file 
-000050f0: 6e6f 7420 636f 6e74 6169 6e69 6e67 2061  not containing a
-00005100: 2054 4152 0a20 2020 2020 2020 2073 656c   TAR.        sel
-00005110: 662e 7461 7246 696c 654f 626a 6563 742c  f.tarFileObject,
-00005120: 2073 656c 662e 7261 7746 696c 654f 626a   self.rawFileObj
-00005130: 6563 742c 2073 656c 662e 636f 6d70 7265  ect, self.compre
-00005140: 7373 696f 6e2c 2073 656c 662e 6973 5461  ssion, self.isTa
-00005150: 7220 3d20 5351 4c69 7465 496e 6465 7865  r = SQLiteIndexe
-00005160: 6454 6172 2e5f 6f70 656e 436f 6d70 7265  dTar._openCompre
-00005170: 7373 6564 4669 6c65 280a 2020 2020 2020  ssedFile(.      
-00005180: 2020 2020 2020 6669 6c65 4f62 6a65 6374        fileObject
-00005190: 2c20 677a 6970 5365 656b 506f 696e 7453  , gzipSeekPointS
-000051a0: 7061 6369 6e67 2c20 656e 636f 6469 6e67  pacing, encoding
-000051b0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000051c0: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
-000051d0: 7354 6172 2061 6e64 206e 6f74 2073 656c  sTar and not sel
-000051e0: 662e 7261 7746 696c 654f 626a 6563 743a  f.rawFileObject:
-000051f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00005200: 7365 2052 6174 6172 6d6f 756e 7445 7272  se RatarmountErr
-00005210: 6f72 2822 4669 6c65 206f 626a 6563 7420  or("File object 
-00005220: 2822 202b 2073 7472 2866 696c 654f 626a  (" + str(fileObj
-00005230: 6563 7429 202b 2022 2920 636f 756c 6420  ect) + ") could 
-00005240: 6e6f 7420 6265 206f 7065 6e65 6420 6173  not be opened as
-00005250: 2061 2054 4152 2066 696c 6521 2229 0a0a   a TAR file!")..
-00005260: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00005270: 636f 6d70 7265 7373 696f 6e20 3d3d 2027  compression == '
-00005280: 787a 273a 0a20 2020 2020 2020 2020 2020  xz':.           
-00005290: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-000052a0: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-000052b0: 662e 7461 7246 696c 654f 626a 6563 742e  f.tarFileObject.
-000052c0: 626c 6f63 6b5f 626f 756e 6461 7269 6573  block_boundaries
-000052d0: 2920 3c3d 2031 2061 6e64 2028 6669 6c65  ) <= 1 and (file
-000052e0: 5369 7a65 2069 7320 4e6f 6e65 206f 7220  Size is None or 
-000052f0: 6669 6c65 5369 7a65 203e 2031 3032 3420  fileSize > 1024 
-00005300: 2a20 3130 3234 293a 0a20 2020 2020 2020  * 1024):.       
-00005310: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00005320: 6e74 2822 5b57 6172 6e69 6e67 5d20 5468  nt("[Warning] Th
-00005330: 6520 7370 6563 6966 6965 6420 6669 6c65  e specified file
-00005340: 2027 7b7d 2722 2e66 6f72 6d61 7428 7365   '{}'".format(se
-00005350: 6c66 2e74 6172 4669 6c65 4e61 6d65 2929  lf.tarFileName))
-00005360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005370: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
-00005380: 6e69 6e67 5d20 6973 2063 6f6d 7072 6573  ning] is compres
-00005390: 7365 6420 7573 696e 6720 787a 2062 7574  sed using xz but
-000053a0: 206f 6e6c 7920 636f 6e74 6169 6e73 206f   only contains o
-000053b0: 6e65 2078 7a20 626c 6f63 6b2e 2054 6869  ne xz block. Thi
-000053c0: 7320 6d61 6b65 7320 6974 2022 290a 2020  s makes it ").  
-000053d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053e0: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-000053f0: 675d 2069 6d70 6f73 7369 626c 6520 746f  g] impossible to
-00005400: 2075 7365 2074 7275 6520 7365 656b 696e   use true seekin
-00005410: 6721 2050 6c65 6173 6520 2872 6529 636f  g! Please (re)co
-00005420: 6d70 7265 7373 2079 6f75 7220 5441 5220  mpress your TAR 
-00005430: 7573 696e 6720 7069 787a 2229 0a20 2020  using pixz").   
-00005440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005450: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
-00005460: 5d20 2873 6565 2068 7474 7073 3a2f 2f67  ] (see https://g
-00005470: 6974 6875 622e 636f 6d2f 7661 7369 2f70  ithub.com/vasi/p
-00005480: 6978 7a29 2069 6e20 6f72 6465 7220 666f  ixz) in order fo
-00005490: 7220 7261 7461 726d 6f75 6e74 2074 6f20  r ratarmount to 
-000054a0: 646f 2062 6520 6162 6c65 2022 290a 2020  do be able ").  
-000054b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054c0: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-000054d0: 675d 2074 6f20 646f 2066 6173 7420 7365  g] to do fast se
-000054e0: 656b 696e 6720 746f 2072 6571 7565 7374  eking to request
-000054f0: 6564 2066 696c 6573 2e22 290a 2020 2020  ed files.").    
-00005500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005510: 7072 696e 7428 225b 5761 726e 696e 675d  print("[Warning]
-00005520: 2041 7320 6974 2069 732c 2065 6163 6820   As it is, each 
-00005530: 6669 6c65 2061 6363 6573 7320 7769 6c6c  file access will
-00005540: 2064 6563 6f6d 7072 6573 7320 7468 6520   decompress the 
-00005550: 7768 6f6c 6520 5441 5220 6672 6f6d 2074  whole TAR from t
-00005560: 6865 2062 6567 696e 6e69 6e67 2122 290a  he beginning!").
-00005570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005580: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-00005590: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-000055a0: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-000055b0: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-000055c0: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
-000055d0: 6172 4669 6c65 4e61 6d65 3a0a 2020 2020  arFileName:.    
-000055e0: 2020 2020 2020 2020 7365 6c66 2e5f 6372          self._cr
-000055f0: 6561 7465 496e 6465 7828 7365 6c66 2e74  eateIndex(self.t
-00005600: 6172 4669 6c65 4f62 6a65 6374 290a 2020  arFileObject).  
-00005610: 2020 2020 2020 2020 2020 2320 7265 7475            # retu
-00005620: 726e 2068 6572 6520 6265 6361 7573 6520  rn here because 
-00005630: 7765 2063 616e 2774 2066 696e 6420 6120  we can't find a 
-00005640: 7361 7665 206c 6f63 6174 696f 6e20 7769  save location wi
-00005650: 7468 6f75 7420 616e 7920 6964 656e 7469  thout any identi
-00005660: 6679 696e 6720 6e61 6d65 0a20 2020 2020  fying name.     
-00005670: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-00005680: 2020 2020 2020 2023 2077 696c 6c20 6265         # will be
-00005690: 2075 7365 6420 666f 7220 7374 6f72 696e   used for storin
-000056a0: 6720 696e 6465 7865 7320 6966 2063 7572  g indexes if cur
-000056b0: 7265 6e74 2070 6174 6820 6973 2072 6561  rent path is rea
-000056c0: 642d 6f6e 6c79 0a20 2020 2020 2020 2070  d-only.        p
-000056d0: 6f73 7369 626c 6549 6e64 6578 4669 6c65  ossibleIndexFile
-000056e0: 5061 7468 7320 3d20 5b73 656c 662e 7461  Paths = [self.ta
-000056f0: 7246 696c 654e 616d 6520 2b20 222e 696e  rFileName + ".in
-00005700: 6465 782e 7371 6c69 7465 225d 0a20 2020  dex.sqlite"].   
-00005710: 2020 2020 2069 6e64 6578 5061 7468 4173       indexPathAs
-00005720: 4e61 6d65 203d 2073 656c 662e 7461 7246  Name = self.tarF
-00005730: 696c 654e 616d 652e 7265 706c 6163 6528  ileName.replace(
-00005740: 222f 222c 2022 5f22 2920 2b20 222e 696e  "/", "_") + ".in
-00005750: 6465 782e 7371 6c69 7465 220a 2020 2020  dex.sqlite".    
-00005760: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00005770: 6528 696e 6465 7846 6f6c 6465 7273 2c20  e(indexFolders, 
-00005780: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-00005790: 2020 696e 6465 7846 6f6c 6465 7273 203d    indexFolders =
-000057a0: 205b 696e 6465 7846 6f6c 6465 7273 5d0a   [indexFolders].
-000057b0: 0a20 2020 2020 2020 2023 2041 2067 6976  .        # A giv
-000057c0: 656e 2069 6e64 6578 2066 696c 6520 6e61  en index file na
-000057d0: 6d65 2074 616b 6573 2070 7265 6365 6465  me takes precede
-000057e0: 6e63 6520 616e 6420 7468 6572 6520 7368  nce and there sh
-000057f0: 6f75 6c64 2062 6520 6e6f 2069 6d70 6c69  ould be no impli
-00005800: 6369 7420 6661 6c6c 6261 636b 0a20 2020  cit fallback.   
-00005810: 2020 2020 2069 6620 696e 6465 7846 696c       if indexFil
-00005820: 654e 616d 653a 0a20 2020 2020 2020 2020  eName:.         
-00005830: 2020 2069 6620 696e 6465 7846 696c 654e     if indexFileN
-00005840: 616d 6520 3d3d 2027 3a6d 656d 6f72 793a  ame == ':memory:
-00005850: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00005860: 2020 2070 6f73 7369 626c 6549 6e64 6578     possibleIndex
-00005870: 4669 6c65 5061 7468 7320 3d20 5b69 6e64  FilePaths = [ind
-00005880: 6578 4669 6c65 4e61 6d65 5d0a 2020 2020  exFileName].    
-00005890: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000058a0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000058b0: 7373 6962 6c65 496e 6465 7846 696c 6550  ssibleIndexFileP
-000058c0: 6174 6873 203d 205b 6f73 2e70 6174 682e  aths = [os.path.
-000058d0: 6162 7370 6174 6828 6f73 2e70 6174 682e  abspath(os.path.
-000058e0: 6578 7061 6e64 7573 6572 2869 6e64 6578  expanduser(index
-000058f0: 4669 6c65 4e61 6d65 2929 5d0a 2020 2020  FileName))].    
-00005900: 2020 2020 656c 6966 2069 6e64 6578 466f      elif indexFo
-00005910: 6c64 6572 733a 0a20 2020 2020 2020 2020  lders:.         
-00005920: 2020 2023 2041 6e20 656d 7074 7920 7061     # An empty pa
-00005930: 7468 2069 7320 746f 2062 6520 696e 7465  th is to be inte
-00005940: 7270 7265 7465 6420 6173 2074 6865 2064  rpreted as the d
-00005950: 6566 6175 6c74 2070 6174 6820 7269 6768  efault path righ
-00005960: 7420 6265 7369 6465 7320 7468 6520 5441  t besides the TA
-00005970: 520a 2020 2020 2020 2020 2020 2020 6966  R.            if
-00005980: 2027 2720 6e6f 7420 696e 2069 6e64 6578   '' not in index
-00005990: 466f 6c64 6572 733a 0a20 2020 2020 2020  Folders:.       
-000059a0: 2020 2020 2020 2020 2070 6f73 7369 626c           possibl
-000059b0: 6549 6e64 6578 4669 6c65 5061 7468 7320  eIndexFilePaths 
-000059c0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-000059d0: 2066 6f72 2066 6f6c 6465 7220 696e 2069   for folder in i
-000059e0: 6e64 6578 466f 6c64 6572 733a 0a20 2020  ndexFolders:.   
-000059f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005a00: 666f 6c64 6572 3a0a 2020 2020 2020 2020  folder:.        
-00005a10: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00005a20: 7850 6174 6820 3d20 6f73 2e70 6174 682e  xPath = os.path.
-00005a30: 6a6f 696e 2866 6f6c 6465 722c 2069 6e64  join(folder, ind
-00005a40: 6578 5061 7468 4173 4e61 6d65 290a 2020  exPathAsName).  
-00005a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a60: 2020 706f 7373 6962 6c65 496e 6465 7846    possibleIndexF
-00005a70: 696c 6550 6174 6873 2e61 7070 656e 6428  ilePaths.append(
-00005a80: 6f73 2e70 6174 682e 6162 7370 6174 6828  os.path.abspath(
-00005a90: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
-00005aa0: 6572 2869 6e64 6578 5061 7468 2929 290a  er(indexPath))).
-00005ab0: 0a20 2020 2020 2020 2069 6620 636c 6561  .        if clea
-00005ac0: 7249 6e64 6578 4361 6368 653a 0a20 2020  rIndexCache:.   
-00005ad0: 2020 2020 2020 2020 2066 6f72 2069 6e64           for ind
-00005ae0: 6578 5061 7468 2069 6e20 706f 7373 6962  exPath in possib
-00005af0: 6c65 496e 6465 7846 696c 6550 6174 6873  leIndexFilePaths
-00005b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005b10: 2020 6966 206f 732e 7061 7468 2e69 7366    if os.path.isf
-00005b20: 696c 6528 696e 6465 7850 6174 6829 3a0a  ile(indexPath):.
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 2020 2020 6f73 2e72 656d 6f76 6528 696e      os.remove(in
-00005b50: 6465 7850 6174 6829 0a0a 2020 2020 2020  dexPath)..      
-00005b60: 2020 2320 5472 7920 746f 2066 696e 6420    # Try to find 
-00005b70: 616e 2061 6c72 6561 6479 2065 7869 7374  an already exist
-00005b80: 696e 6720 696e 6465 780a 2020 2020 2020  ing index.      
-00005b90: 2020 666f 7220 696e 6465 7850 6174 6820    for indexPath 
-00005ba0: 696e 2070 6f73 7369 626c 6549 6e64 6578  in possibleIndex
-00005bb0: 4669 6c65 5061 7468 733a 0a20 2020 2020  FilePaths:.     
-00005bc0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00005bd0: 7472 794c 6f61 6449 6e64 6578 2869 6e64  tryLoadIndex(ind
-00005be0: 6578 5061 7468 293a 0a20 2020 2020 2020  exPath):.       
-00005bf0: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-00005c00: 6465 7846 696c 654e 616d 6520 3d20 696e  dexFileName = in
-00005c10: 6465 7850 6174 680a 2020 2020 2020 2020  dexPath.        
-00005c20: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00005c30: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
-00005c40: 6465 7849 734c 6f61 6465 6428 2920 616e  dexIsLoaded() an
-00005c50: 6420 7365 6c66 2e73 716c 436f 6e6e 6563  d self.sqlConnec
-00005c60: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00005c70: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00005c80: 2020 2020 2020 2069 6e64 6578 5665 7273         indexVers
-00005c90: 696f 6e20 3d20 7365 6c66 2e73 716c 436f  ion = self.sqlCo
-00005ca0: 6e6e 6563 7469 6f6e 2e65 7865 6375 7465  nnection.execute
-00005cb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00005cc0: 2020 2020 2020 2253 454c 4543 5420 6d61        "SELECT ma
-00005cd0: 6a6f 722c 6d69 6e6f 7220 4652 4f4d 2076  jor,minor FROM v
-00005ce0: 6572 7369 6f6e 7320 5748 4552 4520 6e61  ersions WHERE na
-00005cf0: 6d65 203d 3d20 2769 6e64 6578 273b 220a  me == 'index';".
-00005d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d10: 292e 6665 7463 686f 6e65 2829 0a0a 2020  ).fetchone()..  
-00005d20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005d30: 2069 6e64 6578 5665 7273 696f 6e20 616e   indexVersion an
-00005d40: 6420 696e 6465 7856 6572 7369 6f6e 203e  d indexVersion >
-00005d50: 205f 5f76 6572 7369 6f6e 5f5f 3a0a 2020   __version__:.  
-00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d70: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-00005d80: 675d 2054 6865 206c 6f61 6465 6420 696e  g] The loaded in
-00005d90: 6465 7820 7761 7320 6372 6561 7465 6420  dex was created 
-00005da0: 7769 7468 2061 206e 6577 6572 2076 6572  with a newer ver
-00005db0: 7369 6f6e 206f 6620 7261 7461 726d 6f75  sion of ratarmou
-00005dc0: 6e74 2e22 290a 2020 2020 2020 2020 2020  nt.").          
-00005dd0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00005de0: 225b 5761 726e 696e 675d 2049 6620 7468  "[Warning] If th
-00005df0: 6572 6520 6172 6520 616e 7920 7072 6f62  ere are any prob
-00005e00: 6c65 6d73 2c20 706c 6561 7365 2075 7064  lems, please upd
-00005e10: 6174 6520 7261 7461 726d 6f75 6e74 206f  ate ratarmount o
-00005e20: 7220 7265 6372 6561 7465 2074 6865 2069  r recreate the i
-00005e30: 6e64 6578 2229 0a20 2020 2020 2020 2020  ndex").         
-00005e40: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00005e50: 2822 5b57 6172 6e69 6e67 5d20 7769 7468  ("[Warning] with
-00005e60: 2074 6869 7320 7261 7461 726d 6f75 6e74   this ratarmount
-00005e70: 2076 6572 7369 6f6e 2075 7369 6e67 2074   version using t
-00005e80: 6865 202d 2d72 6563 7265 6174 652d 696e  he --recreate-in
-00005e90: 6465 7820 6f70 7469 6f6e 2122 290a 2020  dex option!").  
-00005ea0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00005eb0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00005ec0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00005ed0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00005ee0: 6c66 2e5f 6c6f 6164 4f72 5374 6f72 6543  lf._loadOrStoreC
-00005ef0: 6f6d 7072 6573 7369 6f6e 4f66 6673 6574  ompressionOffset
-00005f00: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00005f10: 7365 6c66 2e5f 7265 6c6f 6164 496e 6465  self._reloadInde
-00005f20: 7852 6561 644f 6e6c 7928 290a 2020 2020  xReadOnly().    
-00005f30: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00005f40: 2020 2020 2020 2020 2320 4669 6e64 2061          # Find a
-00005f50: 2073 7569 7461 626c 6520 2877 7269 7461   suitable (writa
-00005f60: 626c 6529 206c 6f63 6174 696f 6e20 666f  ble) location fo
-00005f70: 7220 7468 6520 696e 6465 7820 6461 7461  r the index data
-00005f80: 6261 7365 0a20 2020 2020 2020 2069 6620  base.        if 
-00005f90: 7772 6974 6549 6e64 6578 3a0a 2020 2020  writeIndex:.    
-00005fa0: 2020 2020 2020 2020 666f 7220 696e 6465          for inde
-00005fb0: 7850 6174 6820 696e 2070 6f73 7369 626c  xPath in possibl
-00005fc0: 6549 6e64 6578 4669 6c65 5061 7468 733a  eIndexFilePaths:
-00005fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005fe0: 2069 6620 7365 6c66 2e5f 7061 7468 4973   if self._pathIs
-00005ff0: 5772 6974 6162 6c65 2869 6e64 6578 5061  Writable(indexPa
-00006000: 7468 2920 616e 6420 7365 6c66 2e5f 7061  th) and self._pa
-00006010: 7468 4361 6e42 6555 7365 6446 6f72 5371  thCanBeUsedForSq
-00006020: 6c69 7465 2869 6e64 6578 5061 7468 293a  lite(indexPath):
-00006030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006040: 2020 2020 2073 656c 662e 696e 6465 7846       self.indexF
-00006050: 696c 654e 616d 6520 3d20 696e 6465 7850  ileName = indexP
-00006060: 6174 680a 2020 2020 2020 2020 2020 2020  ath.            
-00006070: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
-00006080: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00006090: 7420 7365 6c66 2e69 6e64 6578 4669 6c65  t self.indexFile
-000060a0: 4e61 6d65 3a0a 2020 2020 2020 2020 2020  Name:.          
-000060b0: 2020 2020 2020 7261 6973 6520 496e 7661        raise Inva
-000060c0: 6c69 6449 6e64 6578 4572 726f 7228 0a20  lidIndexError(. 
-000060d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060e0: 2020 2022 436f 756c 6420 6e6f 7420 6669     "Could not fi
-000060f0: 6e64 2061 6e79 2065 7869 7374 696e 6720  nd any existing 
-00006100: 696e 6465 7820 6f72 2077 7269 7461 626c  index or writabl
-00006110: 6520 6c6f 6361 7469 6f6e 2066 6f72 2061  e location for a
-00006120: 6e20 696e 6465 7820 696e 2022 0a20 2020  n index in ".   
-00006130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006140: 202b 2073 7472 2870 6f73 7369 626c 6549   + str(possibleI
-00006150: 6e64 6578 4669 6c65 5061 7468 7329 0a20  ndexFilePaths). 
-00006160: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00006170: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00006180: 6372 6561 7465 496e 6465 7828 7365 6c66  createIndex(self
-00006190: 2e74 6172 4669 6c65 4f62 6a65 6374 290a  .tarFileObject).
-000061a0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-000061b0: 6164 4f72 5374 6f72 6543 6f6d 7072 6573  adOrStoreCompres
-000061c0: 7369 6f6e 4f66 6673 6574 7328 2920 2023  sionOffsets()  #
-000061d0: 2073 746f 7265 0a20 2020 2020 2020 2069   store.        i
-000061e0: 6620 7365 6c66 2e73 716c 436f 6e6e 6563  f self.sqlConnec
-000061f0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00006200: 2020 7365 6c66 2e5f 7374 6f72 654d 6574    self._storeMet
-00006210: 6164 6174 6128 7365 6c66 2e73 716c 436f  adata(self.sqlCo
-00006220: 6e6e 6563 7469 6f6e 290a 2020 2020 2020  nnection).      
-00006230: 2020 2020 2020 7365 6c66 2e5f 7265 6c6f        self._relo
-00006240: 6164 496e 6465 7852 6561 644f 6e6c 7928  adIndexReadOnly(
-00006250: 290a 0a20 2020 2020 2020 2069 6620 7072  )..        if pr
-00006260: 696e 7444 6562 7567 203e 3d20 3120 616e  intDebug >= 1 an
-00006270: 6420 7365 6c66 2e69 6e64 6578 4669 6c65  d self.indexFile
-00006280: 4e61 6d65 2061 6e64 206f 732e 7061 7468  Name and os.path
-00006290: 2e69 7366 696c 6528 7365 6c66 2e69 6e64  .isfile(self.ind
-000062a0: 6578 4669 6c65 4e61 6d65 293a 0a20 2020  exFileName):.   
-000062b0: 2020 2020 2020 2020 2023 2054 6865 2030           # The 0
-000062c0: 2d74 696d 6520 6973 206c 6567 6163 7920  -time is legacy 
-000062d0: 666f 7220 7468 6520 6175 746f 6d61 7465  for the automate
-000062e0: 6420 7465 7374 730a 2020 2020 2020 2020  d tests.        
-000062f0: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
-00006300: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00006310: 2822 5772 6974 696e 6720 6f75 7420 5441  ("Writing out TA
-00006320: 5220 696e 6465 7820 746f 222c 2073 656c  R index to", sel
-00006330: 662e 696e 6465 7846 696c 654e 616d 652c  f.indexFileName,
-00006340: 2022 746f 6f6b 2030 7322 2c0a 2020 2020   "took 0s",.    
-00006350: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-00006360: 6e64 2069 7320 7369 7a65 6422 2c20 6f73  nd is sized", os
-00006370: 2e73 7461 7428 2073 656c 662e 696e 6465  .stat( self.inde
-00006380: 7846 696c 654e 616d 6520 292e 7374 5f73  xFileName ).st_s
-00006390: 697a 652c 2022 4222 290a 2020 2020 2020  ize, "B").      
-000063a0: 2020 2020 2020 2320 666d 743a 206f 6e0a        # fmt: on.
-000063b0: 0a20 2020 2064 6566 205f 5f65 6e74 6572  .    def __enter
-000063c0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-000063d0: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
-000063e0: 2020 2064 6566 205f 5f65 7869 745f 5f28     def __exit__(
-000063f0: 7365 6c66 2c20 6578 6365 7074 696f 6e5f  self, exception_
-00006400: 7479 7065 2c20 6578 6365 7074 696f 6e5f  type, exception_
-00006410: 7661 6c75 652c 2065 7863 6570 7469 6f6e  value, exception
-00006420: 5f74 7261 6365 6261 636b 293a 0a20 2020  _traceback):.   
-00006430: 2020 2020 2069 6620 7365 6c66 2e73 716c       if self.sql
-00006440: 436f 6e6e 6563 7469 6f6e 3a0a 2020 2020  Connection:.    
-00006450: 2020 2020 2020 2020 7365 6c66 2e73 716c          self.sql
-00006460: 436f 6e6e 6563 7469 6f6e 2e63 6f6d 6d69  Connection.commi
-00006470: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00006480: 7365 6c66 2e73 716c 436f 6e6e 6563 7469  self.sqlConnecti
-00006490: 6f6e 2e63 6c6f 7365 2829 0a0a 2020 2020  on.close()..    
-000064a0: 2020 2020 6966 2073 656c 662e 7461 7246      if self.tarF
-000064b0: 696c 654f 626a 6563 743a 0a20 2020 2020  ileObject:.     
-000064c0: 2020 2020 2020 2073 656c 662e 7461 7246         self.tarF
-000064d0: 696c 654f 626a 6563 742e 636c 6f73 6528  ileObject.close(
-000064e0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-000064f0: 6c66 2e72 6177 4669 6c65 4f62 6a65 6374  lf.rawFileObject
-00006500: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00006510: 6c66 2e74 6172 4669 6c65 4f62 6a65 6374  lf.tarFileObject
-00006520: 2e63 6c6f 7365 2829 0a0a 2020 2020 6465  .close()..    de
-00006530: 6620 5f73 746f 7265 4d65 7461 6461 7461  f _storeMetadata
-00006540: 2873 656c 662c 2063 6f6e 6e65 6374 696f  (self, connectio
-00006550: 6e3a 2073 716c 6974 6533 2e43 6f6e 6e65  n: sqlite3.Conne
-00006560: 6374 696f 6e29 202d 3e20 4e6f 6e65 3a0a  ction) -> None:.
-00006570: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-00006580: 6f72 6556 6572 7369 6f6e 734d 6574 6164  oreVersionsMetad
-00006590: 6174 6128 636f 6e6e 6563 7469 6f6e 290a  ata(connection).
-000065a0: 0a20 2020 2020 2020 206d 6574 6164 6174  .        metadat
-000065b0: 6154 6162 6c65 203d 2022 2222 0a20 2020  aTable = """.   
-000065c0: 2020 2020 2020 2020 202f 2a20 656d 7074           /* empt
-000065d0: 7920 7461 626c 6520 7768 6f73 6520 736f  y table whose so
-000065e0: 6c65 2065 7869 7374 656e 6365 2073 7065  le existence spe
-000065f0: 6369 6669 6573 2074 6861 7420 7765 2066  cifies that we f
-00006600: 696e 6973 6865 6420 6974 6572 6174 696e  inished iteratin
-00006610: 6720 7468 6520 7461 7220 2a2f 0a20 2020  g the tar */.   
-00006620: 2020 2020 2020 2020 2043 5245 4154 4520           CREATE 
-00006630: 5441 424c 4520 226d 6574 6164 6174 6122  TABLE "metadata"
-00006640: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00006650: 2020 2022 6b65 7922 2020 2020 2020 5641     "key"      VA
-00006660: 5243 4841 5228 3635 3533 3529 204e 4f54  RCHAR(65535) NOT
-00006670: 204e 554c 4c2c 202f 2a20 652e 672e 2022   NULL, /* e.g. "
-00006680: 7461 7273 697a 6522 202a 2f0a 2020 2020  tarsize" */.    
-00006690: 2020 2020 2020 2020 2020 2020 2276 616c              "val
-000066a0: 7565 2220 2020 2056 4152 4348 4152 2836  ue"    VARCHAR(6
-000066b0: 3535 3335 2920 4e4f 5420 4e55 4c4c 2020  5535) NOT NULL  
-000066c0: 2f2a 2065 2e67 2e20 7369 7a65 2069 6e20  /* e.g. size in 
-000066d0: 6279 7465 7320 6173 2069 6e74 6567 6572  bytes as integer
-000066e0: 202a 2f0a 2020 2020 2020 2020 2020 2020   */.            
-000066f0: 293b 0a20 2020 2020 2020 2022 2222 0a0a  );.        """..
-00006700: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00006710: 6f6e 2e65 7865 6375 7465 7363 7269 7074  on.executescript
-00006720: 286d 6574 6164 6174 6154 6162 6c65 290a  (metadataTable).
-00006730: 0a20 2020 2020 2020 2023 2041 6c6c 206f  .        # All o
-00006740: 6620 7468 6573 6520 7265 7175 6972 6520  f these require 
-00006750: 7468 6520 6765 6e65 7269 6320 226d 6574  the generic "met
-00006760: 6164 6174 6122 2074 6162 6c65 2e0a 2020  adata" table..  
-00006770: 2020 2020 2020 7365 6c66 2e5f 7374 6f72        self._stor
-00006780: 6554 6172 4d65 7461 6461 7461 2863 6f6e  eTarMetadata(con
-00006790: 6e65 6374 696f 6e2c 2073 656c 662e 7461  nection, self.ta
-000067a0: 7246 696c 654e 616d 6529 0a20 2020 2020  rFileName).     
-000067b0: 2020 2073 656c 662e 5f73 746f 7265 4172     self._storeAr
-000067c0: 6775 6d65 6e74 734d 6574 6164 6174 6128  gumentsMetadata(
-000067d0: 636f 6e6e 6563 7469 6f6e 290a 2020 2020  connection).    
-000067e0: 2020 2020 636f 6e6e 6563 7469 6f6e 2e63      connection.c
-000067f0: 6f6d 6d69 7428 290a 0a20 2020 2040 7374  ommit()..    @st
-00006800: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-00006810: 6566 205f 7374 6f72 6556 6572 7369 6f6e  ef _storeVersion
-00006820: 734d 6574 6164 6174 6128 636f 6e6e 6563  sMetadata(connec
-00006830: 7469 6f6e 3a20 7371 6c69 7465 332e 436f  tion: sqlite3.Co
-00006840: 6e6e 6563 7469 6f6e 2920 2d3e 204e 6f6e  nnection) -> Non
-00006850: 653a 0a20 2020 2020 2020 2076 6572 7369  e:.        versi
-00006860: 6f6e 7354 6162 6c65 203d 2022 2222 0a20  onsTable = """. 
-00006870: 2020 2020 2020 2020 2020 202f 2a20 5468             /* Th
-00006880: 6973 2074 6162 6c65 2773 2073 6f6c 6520  is table's sole 
-00006890: 6578 6973 7465 6e63 6520 7370 6563 6966  existence specif
-000068a0: 6965 7320 7468 6174 2077 6520 6669 6e69  ies that we fini
-000068b0: 7368 6564 2069 7465 7261 7469 6e67 2074  shed iterating t
-000068c0: 6865 2074 6172 2066 6f72 206f 6c64 6572  he tar for older
-000068d0: 2072 6174 6172 6d6f 756e 7420 7665 7273   ratarmount vers
-000068e0: 696f 6e73 202a 2f0a 2020 2020 2020 2020  ions */.        
-000068f0: 2020 2020 4352 4541 5445 2054 4142 4c45      CREATE TABLE
-00006900: 2022 7665 7273 696f 6e73 2220 280a 2020   "versions" (.  
-00006910: 2020 2020 2020 2020 2020 2020 2020 226e                "n
-00006920: 616d 6522 2020 2020 2056 4152 4348 4152  ame"     VARCHAR
-00006930: 2836 3535 3335 2920 4e4f 5420 4e55 4c4c  (65535) NOT NULL
-00006940: 2c20 2f2a 2077 6869 6368 2063 6f6d 706f  , /* which compo
-00006950: 6e65 6e74 2074 6865 2076 6572 7369 6f6e  nent the version
-00006960: 2062 656c 6f6e 6773 2074 6f20 2a2f 0a20   belongs to */. 
-00006970: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006980: 7665 7273 696f 6e22 2020 5641 5243 4841  version"  VARCHA
-00006990: 5228 3635 3533 3529 204e 4f54 204e 554c  R(65535) NOT NUL
-000069a0: 4c2c 202f 2a20 6672 6565 2066 6f72 6d20  L, /* free form 
-000069b0: 7665 7273 696f 6e20 7374 7269 6e67 202a  version string *
-000069c0: 2f0a 2020 2020 2020 2020 2020 2020 2020  /.              
-000069d0: 2020 2f2a 2053 656d 616e 7469 6320 5665    /* Semantic Ve
-000069e0: 7273 696f 6e69 6e67 2032 2e30 2e30 2028  rsioning 2.0.0 (
-000069f0: 7365 6d76 6572 2e6f 7267 2920 7061 7274  semver.org) part
-00006a00: 7320 6966 2074 6865 7920 6361 6e20 6265  s if they can be
-00006a10: 2073 7065 6369 6669 6564 3a0a 2020 2020   specified:.    
-00006a20: 2020 2020 2020 2020 2020 2020 202a 2020               *  
-00006a30: 204d 414a 4f52 2076 6572 7369 6f6e 2077   MAJOR version w
-00006a40: 6865 6e20 796f 7520 6d61 6b65 2069 6e63  hen you make inc
-00006a50: 6f6d 7061 7469 626c 6520 4150 4920 6368  ompatible API ch
-00006a60: 616e 6765 732c 0a20 2020 2020 2020 2020  anges,.         
-00006a70: 2020 2020 2020 2020 2a20 2020 4d49 4e4f          *   MINO
-00006a80: 5220 7665 7273 696f 6e20 7768 656e 2079  R version when y
-00006a90: 6f75 2061 6464 2066 756e 6374 696f 6e61  ou add functiona
-00006aa0: 6c69 7479 2069 6e20 6120 6261 636b 7761  lity in a backwa
-00006ab0: 7264 7320 636f 6d70 6174 6962 6c65 206d  rds compatible m
-00006ac0: 616e 6e65 722c 2061 6e64 0a20 2020 2020  anner, and.     
-00006ad0: 2020 2020 2020 2020 2020 2020 2a20 2020              *   
-00006ae0: 5041 5443 4820 7665 7273 696f 6e20 7768  PATCH version wh
-00006af0: 656e 2079 6f75 206d 616b 6520 6261 636b  en you make back
-00006b00: 7761 7264 7320 636f 6d70 6174 6962 6c65  wards compatible
-00006b10: 2062 7567 2066 6978 6573 2e20 2a2f 0a20   bug fixes. */. 
-00006b20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006b30: 6d61 6a6f 7222 2020 2020 494e 5445 4745  major"    INTEGE
-00006b40: 522c 0a20 2020 2020 2020 2020 2020 2020  R,.             
-00006b50: 2020 2022 6d69 6e6f 7222 2020 2020 494e     "minor"    IN
-00006b60: 5445 4745 522c 0a20 2020 2020 2020 2020  TEGER,.         
-00006b70: 2020 2020 2020 2022 7061 7463 6822 2020         "patch"  
-00006b80: 2020 494e 5445 4745 520a 2020 2020 2020    INTEGER.      
-00006b90: 2020 2020 2020 293b 0a20 2020 2020 2020        );.       
-00006ba0: 2022 2222 0a20 2020 2020 2020 2074 7279   """.        try
-00006bb0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00006bc0: 6e6e 6563 7469 6f6e 2e65 7865 6375 7465  nnection.execute
-00006bd0: 7363 7269 7074 2876 6572 7369 6f6e 7354  script(versionsT
-00006be0: 6162 6c65 290a 2020 2020 2020 2020 6578  able).        ex
-00006bf0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00006c00: 7320 6578 6365 7074 696f 6e3a 0a20 2020  s exception:.   
-00006c10: 2020 2020 2020 2020 2069 6620 7072 696e           if prin
-00006c20: 7444 6562 7567 203e 3d20 323a 0a20 2020  tDebug >= 2:.   
-00006c30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00006c40: 6e74 2865 7863 6570 7469 6f6e 290a 2020  nt(exception).  
-00006c50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00006c60: 225b 5761 726e 696e 675d 2054 6865 7265  "[Warning] There
-00006c70: 2077 6173 2061 6e20 6572 726f 7220 7768   was an error wh
-00006c80: 656e 2061 6464 696e 6720 6d65 7461 6461  en adding metada
-00006c90: 7461 2069 6e66 6f72 6d61 7469 6f6e 2e20  ta information. 
-00006ca0: 496e 6465 7820 6c6f 6164 696e 6720 6d69  Index loading mi
-00006cb0: 6768 7420 6e6f 7420 776f 726b 2e22 290a  ght not work.").
-00006cc0: 0a20 2020 2020 2020 2074 7279 3a0a 0a20  .        try:.. 
-00006cd0: 2020 2020 2020 2020 2020 2064 6566 206d             def m
-00006ce0: 616b 6556 6572 7369 6f6e 526f 7728 0a20  akeVersionRow(. 
-00006cf0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00006d00: 6572 7369 6f6e 4e61 6d65 3a20 7374 722c  ersionName: str,
-00006d10: 2076 6572 7369 6f6e 3a20 7374 720a 2020   version: str.  
-00006d20: 2020 2020 2020 2020 2020 2920 2d3e 2054            ) -> T
-00006d30: 7570 6c65 5b73 7472 2c20 7374 722c 204f  uple[str, str, O
-00006d40: 7074 696f 6e61 6c5b 7374 725d 2c20 4f70  ptional[str], Op
-00006d50: 7469 6f6e 616c 5b73 7472 5d2c 204f 7074  tional[str], Opt
-00006d60: 696f 6e61 6c5b 7374 725d 5d3a 0a20 2020  ional[str]]:.   
-00006d70: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-00006d80: 7369 6f6e 4e75 6d62 6572 7320 3d20 5b72  sionNumbers = [r
-00006d90: 652e 7375 6228 275b 5e30 2d39 5d27 2c20  e.sub('[^0-9]', 
-00006da0: 2727 2c20 7829 2066 6f72 2078 2069 6e20  '', x) for x in 
-00006db0: 7665 7273 696f 6e2e 7370 6c69 7428 272e  version.split('.
-00006dc0: 2729 5d0a 2020 2020 2020 2020 2020 2020  ')].            
-00006dd0: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-00006de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006df0: 2076 6572 7369 6f6e 4e61 6d65 2c0a 2020   versionName,.  
+000000f0: 7274 2074 7261 6365 6261 636b 0a69 6d70  rt traceback.imp
+00000100: 6f72 7420 7572 6c6c 6962 0a66 726f 6d20  ort urllib.from 
+00000110: 6162 6320 696d 706f 7274 2041 4243 2c20  abc import ABC, 
+00000120: 6162 7374 7261 6374 6d65 7468 6f64 0a66  abstractmethod.f
+00000130: 726f 6d20 7469 6d65 6974 2069 6d70 6f72  rom timeit impor
+00000140: 7420 6465 6661 756c 745f 7469 6d65 7220  t default_timer 
+00000150: 6173 2074 696d 6572 0a69 6d70 6f72 7420  as timer.import 
+00000160: 7479 7069 6e67 0a66 726f 6d20 7479 7069  typing.from typi
+00000170: 6e67 2069 6d70 6f72 7420 416e 792c 2041  ng import Any, A
+00000180: 6e79 5374 722c 2063 6173 742c 2044 6963  nyStr, cast, Dic
+00000190: 742c 2049 4f2c 2049 7465 7261 626c 652c  t, IO, Iterable,
+000001a0: 204c 6973 742c 204f 7074 696f 6e61 6c2c   List, Optional,
+000001b0: 2053 6574 2c20 5475 706c 652c 2055 6e69   Set, Tuple, Uni
+000001c0: 6f6e 0a66 726f 6d20 6461 7461 636c 6173  on.from dataclas
+000001d0: 7365 7320 696d 706f 7274 2064 6174 6163  ses import datac
+000001e0: 6c61 7373 0a69 6d70 6f72 7420 6461 7461  lass.import data
+000001f0: 636c 6173 7365 730a 0a23 2043 616e 2774  classes..# Can't
+00000200: 2064 6f20 7468 6973 2064 796e 616d 6963   do this dynamic
+00000210: 616c 6c79 2077 6974 6820 696d 706f 7274  ally with import
+00000220: 6c69 622e 696d 706f 7274 5f6d 6f64 756c  lib.import_modul
+00000230: 6520 616e 6420 7573 696e 6720 7375 7070  e and using supp
+00000240: 6f72 7465 6443 6f6d 7072 6573 7369 6f6e  ortedCompression
+00000250: 730a 2320 6265 6361 7573 6520 7468 656e  s.# because then
+00000260: 2074 6865 2073 7461 7469 6320 6368 6563   the static chec
+00000270: 6b65 7273 206c 696b 6520 6d79 7079 2061  kers like mypy a
+00000280: 6e64 2070 796c 696e 7420 776f 6e27 7420  nd pylint won't 
+00000290: 7265 636f 676e 697a 6520 7468 6520 6d6f  recognize the mo
+000002a0: 6475 6c65 7321 0a74 7279 3a0a 2020 2020  dules!.try:.    
+000002b0: 696d 706f 7274 2066 7573 650a 6578 6365  import fuse.exce
+000002c0: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
+000002d0: 2020 2020 7061 7373 0a74 7279 3a0a 2020      pass.try:.  
+000002e0: 2020 696d 706f 7274 2069 6e64 6578 6564    import indexed
+000002f0: 5f62 7a69 7032 0a65 7863 6570 7420 496d  _bzip2.except Im
+00000300: 706f 7274 4572 726f 723a 0a20 2020 2070  portError:.    p
+00000310: 6173 730a 7472 793a 0a20 2020 2069 6d70  ass.try:.    imp
+00000320: 6f72 7420 696e 6465 7865 645f 677a 6970  ort indexed_gzip
+00000330: 0a65 7863 6570 7420 496d 706f 7274 4572  .except ImportEr
+00000340: 726f 723a 0a20 2020 2070 6173 730a 7472  ror:.    pass.tr
+00000350: 793a 0a20 2020 2069 6d70 6f72 7420 696e  y:.    import in
+00000360: 6465 7865 645f 7a73 7464 0a65 7863 6570  dexed_zstd.excep
+00000370: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
+00000380: 2020 2070 6173 730a 7472 793a 0a20 2020     pass.try:.   
+00000390: 2069 6d70 6f72 7420 6c7a 6d61 6666 690a   import lzmaffi.
+000003a0: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+000003b0: 6f72 3a0a 2020 2020 7061 7373 0a74 7279  or:.    pass.try
+000003c0: 3a0a 2020 2020 696d 706f 7274 2078 7a0a  :.    import xz.
+000003d0: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+000003e0: 6f72 3a0a 2020 2020 7061 7373 0a74 7279  or:.    pass.try
+000003f0: 3a0a 2020 2020 696d 706f 7274 2072 6172  :.    import rar
+00000400: 6669 6c65 0a65 7863 6570 7420 496d 706f  file.except Impo
+00000410: 7274 4572 726f 723a 0a20 2020 2070 6173  rtError:.    pas
+00000420: 730a 0a0a 2320 5468 6520 6669 6c65 206f  s...# The file o
+00000430: 626a 6563 7420 7265 7475 726e 6564 2062  bject returned b
+00000440: 7920 5a69 7046 696c 652e 6f70 656e 2069  y ZipFile.open i
+00000450: 7320 6e6f 7420 7365 656b 6162 6c65 2069  s not seekable i
+00000460: 6e20 5079 7468 6f6e 2033 2e36 2066 6f72  n Python 3.6 for
+00000470: 2073 6f6d 6520 7265 6173 6f6e 2e0a 2320   some reason..# 
+00000480: 5468 6572 6566 6f72 6520 6469 7361 626c  Therefore disabl
+00000490: 6520 5a49 5020 7375 7070 6f72 7420 7468  e ZIP support th
+000004a0: 6572 6521 0a23 2049 2064 6f6e 2774 2073  ere!.# I don't s
+000004b0: 6565 2069 7420 646f 6375 6d65 6e74 6564  ee it documented
+000004c0: 2c20 696e 7374 6561 6420 4920 7465 7374  , instead I test
+000004d0: 6564 2064 6966 6665 7265 6e74 2050 7974  ed different Pyt
+000004e0: 686f 6e20 7665 7273 696f 6e73 2077 6974  hon versions wit
+000004f0: 6820 446f 636b 6572 2e0a 6966 2073 7973  h Docker..if sys
+00000500: 2e76 6572 7369 6f6e 5f69 6e66 6f5b 325d  .version_info[2]
+00000510: 203e 2036 3a0a 2020 2020 696d 706f 7274   > 6:.    import
+00000520: 207a 6970 6669 6c65 0a0a 0a5f 5f76 6572   zipfile...__ver
+00000530: 7369 6f6e 5f5f 203d 2027 302e 392e 3327  sion__ = '0.9.3'
+00000540: 0a0a 0a70 6172 616c 6c65 6c69 7a61 7469  ...parallelizati
+00000550: 6f6e 203d 2031 0a0a 0a64 6566 2068 6173  on = 1...def has
+00000560: 4e6f 6e45 6d70 7479 5375 7070 6f72 7428  NonEmptySupport(
+00000570: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2074  ) -> bool:.    t
+00000580: 7279 3a0a 2020 2020 2020 2020 7769 7468  ry:.        with
+00000590: 206f 732e 706f 7065 6e28 2766 7573 6572   os.popen('fuser
+000005a0: 6d6f 756e 7420 2d56 2729 2061 7320 7069  mount -V') as pi
+000005b0: 7065 3a0a 2020 2020 2020 2020 2020 2020  pe:.            
+000005c0: 6d61 7463 6820 3d20 7265 2e73 6561 7263  match = re.searc
+000005d0: 6828 7227 285b 302d 395d 2b29 5b2e 5d5b  h(r'([0-9]+)[.][
+000005e0: 302d 395d 2b5b 2e5d 5b30 2d39 5d2b 272c  0-9]+[.][0-9]+',
+000005f0: 2070 6970 652e 7265 6164 2829 290a 2020   pipe.read()).  
+00000600: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
+00000610: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00000620: 2020 2020 7265 7475 726e 2069 6e74 286d      return int(m
+00000630: 6174 6368 2e67 726f 7570 2831 2929 203c  atch.group(1)) <
+00000640: 2033 0a20 2020 2065 7863 6570 7420 4578   3.    except Ex
+00000650: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00000660: 2070 6173 730a 0a20 2020 2072 6574 7572   pass..    retur
+00000670: 6e20 4661 6c73 6520 2023 204f 6e20 6d61  n False  # On ma
+00000680: 634f 532c 2066 7573 6572 6d6f 756e 7420  cOS, fusermount 
+00000690: 646f 6573 206e 746f 2065 7869 7374 2061  does nto exist a
+000006a0: 6e64 206d 6163 6675 7365 2061 6c73 6f20  nd macfuse also 
+000006b0: 7365 656d 7320 746f 2063 6f6d 706c 6169  seems to complai
+000006c0: 6e20 7769 7468 206e 6f6e 656d 7074 7920  n with nonempty 
+000006d0: 6f70 7469 6f6e 2e0a 0a0a 2320 4465 6669  option....# Defi
+000006e0: 6e69 6e67 206c 616d 6264 6173 2064 6f65  ning lambdas doe
+000006f0: 7320 6e6f 7420 7965 7420 6368 6563 6b20  s not yet check 
+00000700: 7468 6520 6e61 6d65 7320 6f66 2065 6e74  the names of ent
+00000710: 6974 6965 7320 7573 6564 2069 6e73 6964  ities used insid
+00000720: 6520 7468 6520 6c61 6d62 6461 210a 436f  e the lambda!.Co
+00000730: 6d70 7265 7373 696f 6e49 6e66 6f20 3d20  mpressionInfo = 
+00000740: 636f 6c6c 6563 7469 6f6e 732e 6e61 6d65  collections.name
+00000750: 6474 7570 6c65 280a 2020 2020 2743 6f6d  dtuple(.    'Com
+00000760: 7072 6573 7369 6f6e 496e 666f 272c 205b  pressionInfo', [
+00000770: 2773 7566 6669 7865 7327 2c20 2764 6f75  'suffixes', 'dou
+00000780: 626c 6553 7566 6669 7865 7327 2c20 276d  bleSuffixes', 'm
+00000790: 6f64 756c 654e 616d 6527 2c20 2763 6865  oduleName', 'che
+000007a0: 636b 4865 6164 6572 272c 2027 6f70 656e  ckHeader', 'open
+000007b0: 275d 0a29 0a73 7570 706f 7274 6564 436f  '].).supportedCo
+000007c0: 6d70 7265 7373 696f 6e73 203d 207b 0a20  mpressions = {. 
+000007d0: 2020 2027 627a 3227 3a20 436f 6d70 7265     'bz2': Compre
+000007e0: 7373 696f 6e49 6e66 6f28 0a20 2020 2020  ssionInfo(.     
+000007f0: 2020 205b 2762 7a32 272c 2027 627a 6970     ['bz2', 'bzip
+00000800: 3227 5d2c 0a20 2020 2020 2020 205b 2774  2'],.        ['t
+00000810: 6232 272c 2027 7462 7a27 2c20 2774 627a  b2', 'tbz', 'tbz
+00000820: 3227 2c20 2774 7a32 275d 2c0a 2020 2020  2', 'tz2'],.    
+00000830: 2020 2020 2769 6e64 6578 6564 5f62 7a69      'indexed_bzi
+00000840: 7032 272c 0a20 2020 2020 2020 206c 616d  p2',.        lam
+00000850: 6264 6120 783a 2028 782e 7265 6164 2834  bda x: (x.read(4
+00000860: 295b 3a33 5d20 3d3d 2062 2742 5a68 2720  )[:3] == b'BZh' 
+00000870: 616e 6420 782e 7265 6164 2836 2920 3d3d  and x.read(6) ==
+00000880: 2028 3078 3331 3431 3539 3236 3533 3539   (0x314159265359
+00000890: 292e 746f 5f62 7974 6573 2836 2c20 2762  ).to_bytes(6, 'b
+000008a0: 6967 2729 292c 0a20 2020 2020 2020 206c  ig')),.        l
+000008b0: 616d 6264 6120 783a 2069 6e64 6578 6564  ambda x: indexed
+000008c0: 5f62 7a69 7032 2e6f 7065 6e28 782c 2070  _bzip2.open(x, p
+000008d0: 6172 616c 6c65 6c69 7a61 7469 6f6e 3d70  arallelization=p
+000008e0: 6172 616c 6c65 6c69 7a61 7469 6f6e 292c  arallelization),
+000008f0: 0a20 2020 2029 2c0a 2020 2020 2767 7a27  .    ),.    'gz'
+00000900: 3a20 436f 6d70 7265 7373 696f 6e49 6e66  : CompressionInf
+00000910: 6f28 0a20 2020 2020 2020 205b 2767 7a27  o(.        ['gz'
+00000920: 2c20 2767 7a69 7027 5d2c 0a20 2020 2020  , 'gzip'],.     
+00000930: 2020 205b 2774 617a 272c 2027 7467 7a27     ['taz', 'tgz'
+00000940: 5d2c 0a20 2020 2020 2020 2027 696e 6465  ],.        'inde
+00000950: 7865 645f 677a 6970 272c 0a20 2020 2020  xed_gzip',.     
+00000960: 2020 206c 616d 6264 6120 783a 2078 2e72     lambda x: x.r
+00000970: 6561 6428 3229 203d 3d20 6227 5c78 3146  ead(2) == b'\x1F
+00000980: 5c78 3842 272c 0a20 2020 2020 2020 206c  \x8B',.        l
+00000990: 616d 6264 6120 783a 2069 6e64 6578 6564  ambda x: indexed
+000009a0: 5f67 7a69 702e 496e 6465 7865 6447 7a69  _gzip.IndexedGzi
+000009b0: 7046 696c 6528 6669 6c65 6f62 6a3d 7829  pFile(fileobj=x)
+000009c0: 2c0a 2020 2020 292c 0a20 2020 2027 7261  ,.    ),.    'ra
+000009d0: 7227 3a20 436f 6d70 7265 7373 696f 6e49  r': CompressionI
+000009e0: 6e66 6f28 0a20 2020 2020 2020 205b 2772  nfo(.        ['r
+000009f0: 6172 275d 2c0a 2020 2020 2020 2020 5b5d  ar'],.        []
+00000a00: 2c0a 2020 2020 2020 2020 2772 6172 6669  ,.        'rarfi
+00000a10: 6c65 272c 0a20 2020 2020 2020 206c 616d  le',.        lam
+00000a20: 6264 6120 783a 2078 2e72 6561 6428 3629  bda x: x.read(6)
+00000a30: 203d 3d20 6227 5261 7221 5c78 3141 5c78   == b'Rar!\x1A\x
+00000a40: 3037 272c 0a20 2020 2020 2020 206c 616d  07',.        lam
+00000a50: 6264 6120 783a 2072 6172 6669 6c65 2e52  bda x: rarfile.R
+00000a60: 6172 4669 6c65 2878 292c 0a20 2020 2029  arFile(x),.    )
+00000a70: 2c0a 2020 2020 2778 7a27 3a20 436f 6d70  ,.    'xz': Comp
+00000a80: 7265 7373 696f 6e49 6e66 6f28 0a20 2020  ressionInfo(.   
+00000a90: 2020 2020 205b 2778 7a27 5d2c 0a20 2020       ['xz'],.   
+00000aa0: 2020 2020 205b 2774 787a 275d 2c0a 2020       ['txz'],.  
+00000ab0: 2020 2020 2020 276c 7a6d 6166 6669 2720        'lzmaffi' 
+00000ac0: 6966 2027 6c7a 6d61 6666 6927 2069 6e20  if 'lzmaffi' in 
+00000ad0: 676c 6f62 616c 7328 2920 656c 7365 2027  globals() else '
+00000ae0: 787a 272c 0a20 2020 2020 2020 206c 616d  xz',.        lam
+00000af0: 6264 6120 783a 2078 2e72 6561 6428 3629  bda x: x.read(6)
+00000b00: 203d 3d20 6222 5c78 4644 377a 585a 5c78   == b"\xFD7zXZ\x
+00000b10: 3030 222c 0a20 2020 2020 2020 2028 6c61  00",.        (la
+00000b20: 6d62 6461 2078 3a20 6c7a 6d61 6666 692e  mbda x: lzmaffi.
+00000b30: 6f70 656e 2878 2929 2069 6620 276c 7a6d  open(x)) if 'lzm
+00000b40: 6166 6669 2720 696e 2067 6c6f 6261 6c73  affi' in globals
+00000b50: 2829 2065 6c73 6520 286c 616d 6264 6120  () else (lambda 
+00000b60: 783a 2078 7a2e 6f70 656e 2878 2929 2c0a  x: xz.open(x)),.
+00000b70: 2020 2020 292c 0a20 2020 2027 7a69 7027      ),.    'zip'
+00000b80: 3a20 436f 6d70 7265 7373 696f 6e49 6e66  : CompressionInf
+00000b90: 6f28 0a20 2020 2020 2020 205b 277a 6970  o(.        ['zip
+00000ba0: 275d 2c0a 2020 2020 2020 2020 5b5d 2c0a  '],.        [],.
+00000bb0: 2020 2020 2020 2020 277a 6970 6669 6c65          'zipfile
+00000bc0: 272c 0a20 2020 2020 2020 206c 616d 6264  ',.        lambd
+00000bd0: 6120 783a 2078 2e72 6561 6428 3229 203d  a x: x.read(2) =
+00000be0: 3d20 6227 504b 272c 0a20 2020 2020 2020  = b'PK',.       
+00000bf0: 206c 616d 6264 6120 783a 207a 6970 6669   lambda x: zipfi
+00000c00: 6c65 2e5a 6970 4669 6c65 2878 292c 0a20  le.ZipFile(x),. 
+00000c10: 2020 2029 2c0a 2020 2020 277a 7374 273a     ),.    'zst':
+00000c20: 2043 6f6d 7072 6573 7369 6f6e 496e 666f   CompressionInfo
+00000c30: 280a 2020 2020 2020 2020 5b27 7a73 7427  (.        ['zst'
+00000c40: 2c20 277a 7374 6427 5d2c 0a20 2020 2020  , 'zstd'],.     
+00000c50: 2020 205b 2774 7a73 7427 5d2c 0a20 2020     ['tzst'],.   
+00000c60: 2020 2020 2027 696e 6465 7865 645f 7a73       'indexed_zs
+00000c70: 7464 272c 0a20 2020 2020 2020 206c 616d  td',.        lam
+00000c80: 6264 6120 783a 2078 2e72 6561 6428 3429  bda x: x.read(4)
+00000c90: 203d 3d20 2830 7846 4432 4642 3532 3829   == (0xFD2FB528)
+00000ca0: 2e74 6f5f 6279 7465 7328 342c 2027 6c69  .to_bytes(4, 'li
+00000cb0: 7474 6c65 2729 2c0a 2020 2020 2020 2020  ttle'),.        
+00000cc0: 6c61 6d62 6461 2078 3a20 696e 6465 7865  lambda x: indexe
+00000cd0: 645f 7a73 7464 2e49 6e64 6578 6564 5a73  d_zstd.IndexedZs
+00000ce0: 7464 4669 6c65 2878 2e66 696c 656e 6f28  tdFile(x.fileno(
+00000cf0: 2929 2c0a 2020 2020 292c 0a7d 0a0a 0a64  )),.    ),.}...d
+00000d00: 6566 2073 7472 6970 5375 6666 6978 4672  ef stripSuffixFr
+00000d10: 6f6d 436f 6d70 7265 7373 6564 4669 6c65  omCompressedFile
+00000d20: 2870 6174 683a 2073 7472 2920 2d3e 2073  (path: str) -> s
+00000d30: 7472 3a0a 2020 2020 2222 2253 7472 6970  tr:.    """Strip
+00000d40: 7320 636f 6d70 7265 7373 696f 6e20 7375  s compression su
+00000d50: 6666 6978 6573 206c 696b 6520 2e62 7a32  ffixes like .bz2
+00000d60: 2c20 2e67 7a2c 202e 2e2e 2222 220a 2020  , .gz, ...""".  
+00000d70: 2020 666f 7220 636f 6d70 7265 7373 696f    for compressio
+00000d80: 6e20 696e 2073 7570 706f 7274 6564 436f  n in supportedCo
+00000d90: 6d70 7265 7373 696f 6e73 2e76 616c 7565  mpressions.value
+00000da0: 7328 293a 0a20 2020 2020 2020 2066 6f72  s():.        for
+00000db0: 2073 7566 6669 7820 696e 2063 6f6d 7072   suffix in compr
+00000dc0: 6573 7369 6f6e 2e73 7566 6669 7865 733a  ession.suffixes:
+00000dd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00000de0: 7061 7468 2e6c 6f77 6572 2829 2e65 6e64  path.lower().end
+00000df0: 7377 6974 6828 272e 2720 2b20 7375 6666  swith('.' + suff
+00000e00: 6978 2e6c 6f77 6572 2829 293a 0a20 2020  ix.lower()):.   
+00000e10: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00000e20: 7572 6e20 7061 7468 5b3a 202d 286c 656e  urn path[: -(len
+00000e30: 2873 7566 6669 7829 202b 2031 295d 0a0a  (suffix) + 1)]..
+00000e40: 2020 2020 7265 7475 726e 2070 6174 680a      return path.
+00000e50: 0a0a 6465 6620 7374 7269 7053 7566 6669  ..def stripSuffi
+00000e60: 7846 726f 6d54 6172 4669 6c65 2870 6174  xFromTarFile(pat
+00000e70: 683a 2073 7472 2920 2d3e 2073 7472 3a0a  h: str) -> str:.
+00000e80: 2020 2020 2222 2253 7472 6970 7320 6578      """Strips ex
+00000e90: 7465 6e73 696f 6e73 206c 696b 6520 2e74  tensions like .t
+00000ea0: 6172 2e67 7a20 6f72 202e 677a 206f 7220  ar.gz or .gz or 
+00000eb0: 2e74 677a 2c20 2e2e 2e22 2222 0a20 2020  .tgz, ...""".   
+00000ec0: 2023 2031 2e20 5472 7920 666f 7220 636f   # 1. Try for co
+00000ed0: 6e66 6c61 7465 6420 7375 6666 6978 6573  nflated suffixes
+00000ee0: 2066 6972 7374 0a20 2020 2066 6f72 2063   first.    for c
+00000ef0: 6f6d 7072 6573 7369 6f6e 2069 6e20 7375  ompression in su
+00000f00: 7070 6f72 7465 6443 6f6d 7072 6573 7369  pportedCompressi
+00000f10: 6f6e 732e 7661 6c75 6573 2829 3a0a 2020  ons.values():.  
+00000f20: 2020 2020 2020 666f 7220 7375 6666 6978        for suffix
+00000f30: 2069 6e20 636f 6d70 7265 7373 696f 6e2e   in compression.
+00000f40: 646f 7562 6c65 5375 6666 6978 6573 202b  doubleSuffixes +
+00000f50: 205b 2774 2720 2b20 7320 666f 7220 7320   ['t' + s for s 
+00000f60: 696e 2063 6f6d 7072 6573 7369 6f6e 2e73  in compression.s
+00000f70: 7566 6669 7865 735d 3a0a 2020 2020 2020  uffixes]:.      
+00000f80: 2020 2020 2020 6966 2070 6174 682e 6c6f        if path.lo
+00000f90: 7765 7228 292e 656e 6473 7769 7468 2827  wer().endswith('
+00000fa0: 2e27 202b 2073 7566 6669 782e 6c6f 7765  .' + suffix.lowe
+00000fb0: 7228 2929 3a0a 2020 2020 2020 2020 2020  r()):.          
+00000fc0: 2020 2020 2020 7265 7475 726e 2070 6174        return pat
+00000fd0: 685b 3a20 2d28 6c65 6e28 7375 6666 6978  h[: -(len(suffix
+00000fe0: 2920 2b20 3129 5d0a 0a20 2020 2023 2032  ) + 1)]..    # 2
+00000ff0: 2e20 5265 6d6f 7665 2063 6f6d 7072 6573  . Remove compres
+00001000: 7369 6f6e 2073 7566 6669 7865 730a 2020  sion suffixes.  
+00001010: 2020 7061 7468 203d 2073 7472 6970 5375    path = stripSu
+00001020: 6666 6978 4672 6f6d 436f 6d70 7265 7373  ffixFromCompress
+00001030: 6564 4669 6c65 2870 6174 6829 0a0a 2020  edFile(path)..  
+00001040: 2020 2320 332e 2052 656d 6f76 6520 2e74    # 3. Remove .t
+00001050: 6172 2069 6620 7765 2061 7265 206c 6566  ar if we are lef
+00001060: 7420 7769 7468 2069 7420 6166 7465 7220  t with it after 
+00001070: 7468 6520 636f 6d70 7265 7373 696f 6e20  the compression 
+00001080: 7375 6666 6978 2072 656d 6f76 616c 0a20  suffix removal. 
+00001090: 2020 2069 6620 7061 7468 2e6c 6f77 6572     if path.lower
+000010a0: 2829 2e65 6e64 7377 6974 6828 272e 7461  ().endswith('.ta
+000010b0: 7227 293a 0a20 2020 2020 2020 2070 6174  r'):.        pat
+000010c0: 6820 3d20 7061 7468 5b3a 2d34 5d0a 0a20  h = path[:-4].. 
+000010d0: 2020 2072 6574 7572 6e20 7061 7468 0a0a     return path..
+000010e0: 0a70 7269 6e74 4465 6275 6720 3d20 310a  .printDebug = 1.
+000010f0: 0a0a 636c 6173 7320 5261 7461 726d 6f75  ..class Ratarmou
+00001100: 6e74 4572 726f 7228 4578 6365 7074 696f  ntError(Exceptio
+00001110: 6e29 3a0a 2020 2020 2222 2242 6173 6520  n):.    """Base 
+00001120: 6578 6365 7074 696f 6e20 666f 7220 7261  exception for ra
+00001130: 7461 726d 6f75 6e74 206d 6f64 756c 652e  tarmount module.
+00001140: 2222 220a 0a0a 636c 6173 7320 496e 6465  """...class Inde
+00001150: 784e 6f74 4f70 656e 4572 726f 7228 5261  xNotOpenError(Ra
+00001160: 7461 726d 6f75 6e74 4572 726f 7229 3a0a  tarmountError):.
+00001170: 2020 2020 2222 2245 7863 6570 7469 6f6e      """Exception
+00001180: 2066 6f72 206f 7065 7261 7469 6f6e 7320   for operations 
+00001190: 6578 6563 7574 6564 206f 6e20 6120 636c  executed on a cl
+000011a0: 6f73 6564 2069 6e64 6578 2064 6174 6162  osed index datab
+000011b0: 6173 652e 2222 220a 0a0a 636c 6173 7320  ase."""...class 
+000011c0: 496e 7661 6c69 6449 6e64 6578 4572 726f  InvalidIndexErro
+000011d0: 7228 5261 7461 726d 6f75 6e74 4572 726f  r(RatarmountErro
+000011e0: 7229 3a0a 2020 2020 2222 2245 7863 6570  r):.    """Excep
+000011f0: 7469 6f6e 2066 6f72 2069 6e64 6578 6573  tion for indexes
+00001200: 2062 6569 6e67 2069 6e76 616c 6964 2c20   being invalid, 
+00001210: 6f75 7464 6174 6564 2c20 6f72 2063 7265  outdated, or cre
+00001220: 6174 6564 2077 6974 6820 6469 6666 6572  ated with differ
+00001230: 656e 7420 6172 6775 6d65 6e74 732e 2222  ent arguments.""
+00001240: 220a 0a0a 636c 6173 7320 436f 6d70 7265  "...class Compre
+00001250: 7373 696f 6e45 7272 6f72 2852 6174 6172  ssionError(Ratar
+00001260: 6d6f 756e 7445 7272 6f72 293a 0a20 2020  mountError):.   
+00001270: 2022 2222 4578 6365 7074 696f 6e20 666f   """Exception fo
+00001280: 7220 7472 7969 6e67 2074 6f20 6f70 656e  r trying to open
+00001290: 2066 696c 6573 2077 6974 6820 756e 7375   files with unsu
+000012a0: 7070 6f72 7465 6420 636f 6d70 7265 7373  pported compress
+000012b0: 696f 6e20 6f72 2075 6e61 7661 696c 6162  ion or unavailab
+000012c0: 6c65 2064 6563 6f6d 7072 6573 7369 6f6e  le decompression
+000012d0: 206d 6f64 756c 652e 2222 220a 0a0a 6465   module."""...de
+000012e0: 6620 6f76 6572 7269 6465 7328 7061 7265  f overrides(pare
+000012f0: 6e74 436c 6173 7329 3a0a 2020 2020 2222  ntClass):.    ""
+00001300: 2253 696d 706c 6520 6465 636f 7261 746f  "Simple decorato
+00001310: 7220 7468 6174 2063 6865 636b 7320 7468  r that checks th
+00001320: 6174 2061 206d 6574 686f 6420 7769 7468  at a method with
+00001330: 2074 6865 2073 616d 6520 6e61 6d65 2065   the same name e
+00001340: 7869 7374 7320 696e 2074 6865 2070 6172  xists in the par
+00001350: 656e 7420 636c 6173 7322 2222 0a0a 2020  ent class"""..  
+00001360: 2020 6465 6620 6f76 6572 7269 6465 7228    def overrider(
+00001370: 6d65 7468 6f64 293a 0a20 2020 2020 2020  method):.       
+00001380: 2061 7373 6572 7420 6d65 7468 6f64 2e5f   assert method._
+00001390: 5f6e 616d 655f 5f20 696e 2064 6972 2870  _name__ in dir(p
+000013a0: 6172 656e 7443 6c61 7373 290a 2020 2020  arentClass).    
+000013b0: 2020 2020 6173 7365 7274 2063 616c 6c61      assert calla
+000013c0: 626c 6528 6765 7461 7474 7228 7061 7265  ble(getattr(pare
+000013d0: 6e74 436c 6173 732c 206d 6574 686f 642e  ntClass, method.
+000013e0: 5f5f 6e61 6d65 5f5f 2929 0a20 2020 2020  __name__)).     
+000013f0: 2020 2072 6574 7572 6e20 6d65 7468 6f64     return method
+00001400: 0a0a 2020 2020 7265 7475 726e 206f 7665  ..    return ove
+00001410: 7272 6964 6572 0a0a 0a63 6c61 7373 2050  rrider...class P
+00001420: 726f 6772 6573 7342 6172 3a0a 2020 2020  rogressBar:.    
+00001430: 2222 2253 696d 706c 6520 7072 6f67 7265  """Simple progre
+00001440: 7373 2062 6172 2077 6869 6368 206b 6565  ss bar which kee
+00001450: 7073 2074 7261 636b 206f 6620 6368 616e  ps track of chan
+00001460: 6765 7320 616e 6420 7072 696e 7473 2074  ges and prints t
+00001470: 6865 2070 726f 6772 6573 7320 616e 6420  he progress and 
+00001480: 6120 7469 6d65 2065 7374 696d 6174 652e  a time estimate.
+00001490: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+000014a0: 6e69 745f 5f28 7365 6c66 2c20 6d61 7856  nit__(self, maxV
+000014b0: 616c 7565 3a20 666c 6f61 7429 3a0a 2020  alue: float):.  
+000014c0: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
+000014d0: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
+000014e0: 7856 616c 7565 2020 2020 2020 2020 3d20  xValue        = 
+000014f0: 6d61 7856 616c 7565 0a20 2020 2020 2020  maxValue.       
+00001500: 2073 656c 662e 6c61 7374 5570 6461 7465   self.lastUpdate
+00001510: 5469 6d65 2020 3d20 7469 6d65 2e74 696d  Time  = time.tim
+00001520: 6528 290a 2020 2020 2020 2020 7365 6c66  e().        self
+00001530: 2e6c 6173 7455 7064 6174 6556 616c 7565  .lastUpdateValue
+00001540: 203d 2030 2e0a 2020 2020 2020 2020 7365   = 0..        se
+00001550: 6c66 2e75 7064 6174 6549 6e74 6572 7661  lf.updateInterva
+00001560: 6c20 203d 2032 2e20 2023 2073 6563 6f6e  l  = 2.  # secon
+00001570: 6473 0a20 2020 2020 2020 2073 656c 662e  ds.        self.
+00001580: 6372 6561 7469 6f6e 5469 6d65 2020 2020  creationTime    
+00001590: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
+000015a0: 2020 2020 2020 2320 666d 743a 206f 6e0a        # fmt: on.
+000015b0: 0a20 2020 2064 6566 2075 7064 6174 6528  .    def update(
+000015c0: 7365 6c66 2c20 7661 6c75 653a 2066 6c6f  self, value: flo
+000015d0: 6174 2920 2d3e 204e 6f6e 653a 0a20 2020  at) -> None:.   
+000015e0: 2020 2020 2022 2222 5368 6f75 6c64 2062       """Should b
+000015f0: 6520 6361 6c6c 6564 2077 6865 6e65 7665  e called wheneve
+00001600: 7220 7468 6520 6d6f 6e69 746f 7265 6420  r the monitored 
+00001610: 7661 6c75 6520 6368 616e 6765 732e 2054  value changes. T
+00001620: 6865 2070 726f 6772 6573 7320 6261 7220  he progress bar 
+00001630: 6973 2075 7064 6174 6564 2061 6363 6f72  is updated accor
+00001640: 6469 6e67 6c79 2e22 2222 0a20 2020 2020  dingly.""".     
+00001650: 2020 2069 6620 7365 6c66 2e6c 6173 7455     if self.lastU
+00001660: 7064 6174 6554 696d 6520 6973 206e 6f74  pdateTime is not
+00001670: 204e 6f6e 6520 616e 6420 2874 696d 652e   None and (time.
+00001680: 7469 6d65 2829 202d 2073 656c 662e 6c61  time() - self.la
+00001690: 7374 5570 6461 7465 5469 6d65 2920 3c20  stUpdateTime) < 
+000016a0: 7365 6c66 2e75 7064 6174 6549 6e74 6572  self.updateInter
+000016b0: 7661 6c3a 0a20 2020 2020 2020 2020 2020  val:.           
+000016c0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+000016d0: 2023 2055 7365 2077 686f 6c65 2069 6e74   # Use whole int
+000016e0: 6572 7661 6c20 7369 6e63 6520 7374 6172  erval since star
+000016f0: 7420 746f 2065 7374 696d 6174 6520 7469  t to estimate ti
+00001700: 6d65 0a20 2020 2020 2020 2065 7461 3120  me.        eta1 
+00001710: 3d20 696e 7428 2874 696d 652e 7469 6d65  = int((time.time
+00001720: 2829 202d 2073 656c 662e 6372 6561 7469  () - self.creati
+00001730: 6f6e 5469 6d65 2920 2f20 7661 6c75 6520  onTime) / value 
+00001740: 2a20 2873 656c 662e 6d61 7856 616c 7565  * (self.maxValue
+00001750: 202d 2076 616c 7565 2929 0a20 2020 2020   - value)).     
+00001760: 2020 2023 2055 7365 206f 6e6c 7920 6120     # Use only a 
+00001770: 7368 6f72 7465 7220 7769 6e64 6f77 2069  shorter window i
+00001780: 6e74 6572 7661 6c20 746f 2065 7374 696d  nterval to estim
+00001790: 6174 6520 7469 6d65 2e0a 2020 2020 2020  ate time..      
+000017a0: 2020 2320 4163 636f 756e 7473 2062 6574    # Accounts bet
+000017b0: 7465 7220 666f 7220 6869 6768 6572 2073  ter for higher s
+000017c0: 7065 6564 7320 696e 2062 6567 696e 6e69  peeds in beginni
+000017d0: 6e67 2c20 652e 672e 2c20 6361 7573 6564  ng, e.g., caused
+000017e0: 2062 7920 6361 6368 696e 6720 6566 6665   by caching effe
+000017f0: 6374 732e 0a20 2020 2020 2020 2023 2048  cts..        # H
+00001800: 6f77 6576 6572 2c20 7468 6973 2065 7374  owever, this est
+00001810: 696d 6174 6520 6d69 6768 7420 7661 7279  imate might vary
+00001820: 2061 206c 6f74 2077 6869 6c65 2074 6865   a lot while the
+00001830: 206f 7468 6572 206f 6e65 2073 7461 6269   other one stabi
+00001840: 6c69 7a65 7320 6166 7465 7220 736f 6d65  lizes after some
+00001850: 2074 696d 6521 0a20 2020 2020 2020 2065   time!.        e
+00001860: 7461 3220 3d20 696e 7428 2874 696d 652e  ta2 = int((time.
+00001870: 7469 6d65 2829 202d 2073 656c 662e 6c61  time() - self.la
+00001880: 7374 5570 6461 7465 5469 6d65 2920 2f20  stUpdateTime) / 
+00001890: 2876 616c 7565 202d 2073 656c 662e 6c61  (value - self.la
+000018a0: 7374 5570 6461 7465 5661 6c75 6529 202a  stUpdateValue) *
+000018b0: 2028 7365 6c66 2e6d 6178 5661 6c75 6520   (self.maxValue 
+000018c0: 2d20 7661 6c75 6529 290a 2020 2020 2020  - value)).      
+000018d0: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
+000018e0: 2020 2020 2022 4375 7272 656e 746c 7920       "Currently 
+000018f0: 6174 2070 6f73 6974 696f 6e20 7b7d 206f  at position {} o
+00001900: 6620 7b7d 2028 7b3a 2e32 667d 2529 2e20  f {} ({:.2f}%). 
+00001910: 220a 2020 2020 2020 2020 2020 2020 2245  ".            "E
+00001920: 7374 696d 6174 6564 2074 696d 6520 7265  stimated time re
+00001930: 6d61 696e 696e 6720 7769 7468 2063 7572  maining with cur
+00001940: 7265 6e74 2072 6174 653a 207b 7d20 6d69  rent rate: {} mi
+00001950: 6e20 7b7d 2073 2c20 7769 7468 2061 7665  n {} s, with ave
+00001960: 7261 6765 2072 6174 653a 207b 7d20 6d69  rage rate: {} mi
+00001970: 6e20 7b7d 2073 2e22 2e66 6f72 6d61 7428  n {} s.".format(
+00001980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001990: 2023 2066 6d74 3a6f 6666 0a20 2020 2020   # fmt:off.     
+000019a0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+000019b0: 2c20 7365 6c66 2e6d 6178 5661 6c75 652c  , self.maxValue,
+000019c0: 2076 616c 7565 202f 2073 656c 662e 6d61   value / self.ma
+000019d0: 7856 616c 7565 202a 2031 3030 2e30 2c0a  xValue * 100.0,.
+000019e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019f0: 6574 6132 202f 2f20 3630 2c20 6574 6132  eta2 // 60, eta2
+00001a00: 2025 2036 302c 0a20 2020 2020 2020 2020   % 60,.         
+00001a10: 2020 2020 2020 2065 7461 3120 2f2f 2036         eta1 // 6
+00001a20: 302c 2065 7461 3120 2520 3630 0a20 2020  0, eta1 % 60.   
+00001a30: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+00001a40: 6d74 3a6f 6e0a 2020 2020 2020 2020 2020  mt:on.          
+00001a50: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00001a60: 2066 6c75 7368 3d54 7275 652c 0a20 2020   flush=True,.   
+00001a70: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00001a80: 7365 6c66 2e6c 6173 7455 7064 6174 6554  self.lastUpdateT
+00001a90: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+00001aa0: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
+00001ab0: 6173 7455 7064 6174 6556 616c 7565 203d  astUpdateValue =
+00001ac0: 2076 616c 7565 0a0a 0a63 6c61 7373 2053   value...class S
+00001ad0: 7465 6e63 696c 6564 4669 6c65 2869 6f2e  tenciledFile(io.
+00001ae0: 4275 6666 6572 6564 494f 4261 7365 293a  BufferedIOBase):
+00001af0: 0a20 2020 2022 2222 4120 6669 6c65 2061  .    """A file a
+00001b00: 6273 7472 6163 7469 6f6e 206c 6179 6572  bstraction layer
+00001b10: 2067 6976 696e 6720 6120 7374 656e 6369   giving a stenci
+00001b20: 6c65 6420 7669 6577 2074 6f20 616e 2075  led view to an u
+00001b30: 6e64 6572 6c79 696e 6720 6669 6c65 2e22  nderlying file."
+00001b40: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00001b50: 6974 5f5f 2873 656c 662c 2066 696c 656f  it__(self, fileo
+00001b60: 626a 3a20 494f 2c20 7374 656e 6369 6c73  bj: IO, stencils
+00001b70: 3a20 4c69 7374 5b54 7570 6c65 5b69 6e74  : List[Tuple[int
+00001b80: 2c20 696e 745d 5d29 202d 3e20 4e6f 6e65  , int]]) -> None
+00001b90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00001ba0: 2020 2020 2020 7374 656e 6369 6c73 3a20        stencils: 
+00001bb0: 4120 6c69 7374 2074 7570 6c65 7320 7370  A list tuples sp
+00001bc0: 6563 6966 7969 6e67 2074 6865 206f 6666  ecifying the off
+00001bd0: 7365 7420 616e 6420 6c65 6e67 7468 206f  set and length o
+00001be0: 6620 7468 6520 756e 6465 726c 7969 6e67  f the underlying
+00001bf0: 2066 696c 6520 746f 2075 7365 2e0a 2020   file to use..  
+00001c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c10: 5468 6520 6f72 6465 7220 6f66 2074 6865  The order of the
+00001c20: 7365 2074 7570 6c65 7320 7769 6c6c 2062  se tuples will b
+00001c30: 6520 6b65 7074 2e0a 2020 2020 2020 2020  e kept..        
+00001c40: 2020 2020 2020 2020 2020 5468 6520 6f66            The of
+00001c50: 6673 6574 206d 7573 7420 6265 206e 6f6e  fset must be non
+00001c60: 2d6e 6567 6174 6976 6520 616e 6420 7468  -negative and th
+00001c70: 6520 7369 7a65 206d 7573 7420 6265 2070  e size must be p
+00001c80: 6f73 6974 6976 652e 0a0a 2020 2020 2020  ositive...      
+00001c90: 2020 4578 616d 706c 6573 3a0a 2020 2020    Examples:.    
+00001ca0: 2020 2020 2020 2020 7374 656e 6369 6c20          stencil 
+00001cb0: 3d20 5b28 352c 3729 5d0a 2020 2020 2020  = [(5,7)].      
+00001cc0: 2020 2020 2020 2020 2020 4d61 6b65 7320            Makes 
+00001cd0: 6120 6e65 7720 3742 2073 697a 6564 2076  a new 7B sized v
+00001ce0: 6972 7475 616c 2066 696c 6520 7374 6172  irtual file star
+00001cf0: 7469 6e67 2061 7420 6f66 6673 6574 2035  ting at offset 5
+00001d00: 206f 6620 6669 6c65 6f62 6a2e 0a20 2020   of fileobj..   
+00001d10: 2020 2020 2020 2020 2073 7465 6e63 696c           stencil
+00001d20: 203d 205b 2830 2c33 292c 2835 2c33 295d   = [(0,3),(5,3)]
+00001d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001d40: 204d 616b 6520 6120 6e65 7720 3642 2073   Make a new 6B s
+00001d50: 697a 6564 2076 6972 7475 616c 2066 696c  ized virtual fil
+00001d60: 6520 636f 6e74 6169 6e69 6e67 2062 7974  e containing byt
+00001d70: 6573 205b 302c 312c 322c 352c 362c 375d  es [0,1,2,5,6,7]
+00001d80: 206f 6620 6669 6c65 6f62 6a2e 0a20 2020   of fileobj..   
+00001d90: 2020 2020 2020 2020 2073 7465 6e63 696c           stencil
+00001da0: 203d 205b 2830 2c33 292c 2830 2c33 295d   = [(0,3),(0,3)]
+00001db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001dc0: 204d 616b 6520 6120 3642 2073 697a 6520   Make a 6B size 
+00001dd0: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
+00001de0: 7468 6520 6669 7273 7420 3342 206f 6620  the first 3B of 
+00001df0: 6669 6c65 6f62 6a20 7477 6963 6520 636f  fileobj twice co
+00001e00: 6e63 6174 656e 6174 6564 2074 6f67 6574  ncatenated toget
+00001e10: 6865 722e 0a20 2020 2020 2020 2022 2222  her..        """
+00001e20: 0a0a 2020 2020 2020 2020 2320 666d 743a  ..        # fmt:
+00001e30: 206f 6666 0a20 2020 2020 2020 2073 656c   off.        sel
+00001e40: 662e 6669 6c65 6f62 6a20 3d20 6669 6c65  f.fileobj = file
+00001e50: 6f62 6a0a 2020 2020 2020 2020 7365 6c66  obj.        self
+00001e60: 2e6f 6666 7365 7473 203d 205b 785b 305d  .offsets = [x[0]
+00001e70: 2066 6f72 2078 2069 6e20 7374 656e 6369   for x in stenci
+00001e80: 6c73 5d0a 2020 2020 2020 2020 7365 6c66  ls].        self
+00001e90: 2e73 697a 6573 2020 203d 205b 785b 315d  .sizes   = [x[1]
+00001ea0: 2066 6f72 2078 2069 6e20 7374 656e 6369   for x in stenci
+00001eb0: 6c73 5d0a 2020 2020 2020 2020 7365 6c66  ls].        self
+00001ec0: 2e6f 6666 7365 7420 203d 2030 0a20 2020  .offset  = 0.   
+00001ed0: 2020 2020 2023 2066 6d74 3a20 6f6e 0a0a       # fmt: on..
+00001ee0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00001ef0: 6174 6520 6375 6d75 6c61 7469 7665 2073  ate cumulative s
+00001f00: 697a 6573 0a20 2020 2020 2020 2073 656c  izes.        sel
+00001f10: 662e 6375 6d73 697a 6573 203d 205b 305d  f.cumsizes = [0]
+00001f20: 0a20 2020 2020 2020 2066 6f72 206f 6666  .        for off
+00001f30: 7365 742c 2073 697a 6520 696e 2073 7465  set, size in ste
+00001f40: 6e63 696c 733a 0a20 2020 2020 2020 2020  ncils:.         
+00001f50: 2020 2061 7373 6572 7420 6f66 6673 6574     assert offset
+00001f60: 203e 3d20 300a 2020 2020 2020 2020 2020   >= 0.          
+00001f70: 2020 6173 7365 7274 2073 697a 6520 3e3d    assert size >=
+00001f80: 2030 0a20 2020 2020 2020 2020 2020 2073   0.            s
+00001f90: 656c 662e 6375 6d73 697a 6573 2e61 7070  elf.cumsizes.app
+00001fa0: 656e 6428 7365 6c66 2e63 756d 7369 7a65  end(self.cumsize
+00001fb0: 735b 2d31 5d20 2b20 7369 7a65 290a 0a20  s[-1] + size).. 
+00001fc0: 2020 2020 2020 2023 2053 6565 6b20 746f         # Seek to
+00001fd0: 2074 6865 2066 6972 7374 2073 7465 6e63   the first stenc
+00001fe0: 696c 206f 6666 7365 7420 696e 2074 6865  il offset in the
+00001ff0: 2075 6e64 6572 6c79 696e 6720 6669 6c65   underlying file
+00002000: 2073 6f20 7468 6174 2022 7265 6164 2220   so that "read" 
+00002010: 7769 6c6c 2077 6f72 6b20 6f75 742d 6f66  will work out-of
+00002020: 2d74 6865 2d62 6f78 0a20 2020 2020 2020  -the-box.       
+00002030: 2073 656c 662e 7365 656b 2830 290a 0a20   self.seek(0).. 
+00002040: 2020 2064 6566 205f 6669 6e64 5374 656e     def _findSten
+00002050: 6369 6c28 7365 6c66 2c20 6f66 6673 6574  cil(self, offset
+00002060: 3a20 696e 7429 202d 3e20 696e 743a 0a20  : int) -> int:. 
+00002070: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00002080: 2020 2052 6574 7572 6e20 696e 6465 7820     Return index 
+00002090: 746f 2073 7465 6e63 696c 2077 6865 7265  to stencil where
+000020a0: 206f 6666 7365 7420 6265 6c6f 6e67 7320   offset belongs 
+000020b0: 746f 2e20 452e 672e 2c20 666f 7220 7374  to. E.g., for st
+000020c0: 656e 6369 6c73 205b 2833 2c35 292c 2838  encils [(3,5),(8
+000020d0: 2c32 295d 2c20 6f66 6673 6574 7320 3020  ,2)], offsets 0 
+000020e0: 746f 0a20 2020 2020 2020 2061 6e64 2069  to.        and i
+000020f0: 6e63 6c75 6469 6e67 2034 2077 696c 6c20  ncluding 4 will 
+00002100: 7374 696c 6c20 6265 2069 6e73 6964 6520  still be inside 
+00002110: 7374 656e 6369 6c20 2833 2c35 292c 2069  stencil (3,5), i
+00002120: 2e65 2e2c 2069 6e64 6578 2030 2077 696c  .e., index 0 wil
+00002130: 6c20 6265 2072 6574 7572 6e65 642e 2046  l be returned. F
+00002140: 6f72 206f 6666 7365 7420 362c 0a20 2020  or offset 6,.   
+00002150: 2020 2020 2069 6e64 6578 2031 2077 6f75       index 1 wou
+00002160: 6c64 2062 6520 7265 7475 726e 6564 2062  ld be returned b
+00002170: 6563 6175 7365 2069 7420 6e6f 7720 6973  ecause it now is
+00002180: 2069 6e20 7468 6520 7365 636f 6e64 2063   in the second c
+00002190: 6f6e 7469 6775 6f75 7320 7265 6769 6f6e  ontiguous region
+000021a0: 202f 2073 7465 6e63 696c 2e0a 2020 2020   / stencil..    
+000021b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000021c0: 2320 6269 7365 6374 5f6c 6566 7428 2076  # bisect_left( v
+000021d0: 616c 7565 2029 2067 6976 6573 2061 6e20  alue ) gives an 
+000021e0: 696e 6465 7820 666f 7220 6120 6c6f 7765  index for a lowe
+000021f0: 7220 7261 6e67 653a 2076 616c 7565 203c  r range: value <
+00002200: 2078 2066 6f72 2061 6c6c 2078 2069 6e20   x for all x in 
+00002210: 6c69 7374 5b30 3a69 5d0a 2020 2020 2020  list[0:i].      
+00002220: 2020 2320 4265 6361 7573 6520 7661 6c75    # Because valu
+00002230: 6520 3e3d 2030 2061 6e64 206c 6973 7420  e >= 0 and list 
+00002240: 7374 6172 7473 2077 6974 6820 3020 7765  starts with 0 we
+00002250: 2063 616e 2074 6865 7265 666f 7265 2062   can therefore b
+00002260: 6520 7375 7265 2074 6861 7420 7468 6520  e sure that the 
+00002270: 7265 7475 726e 6564 2069 3e30 0a20 2020  returned i>0.   
+00002280: 2020 2020 2023 2043 6f6e 7369 6465 7220       # Consider 
+00002290: 7468 6520 7374 656e 6369 6c73 205b 2831  the stencils [(1
+000022a0: 312c 3229 2c28 3232 2c32 292c 2833 332c  1,2),(22,2),(33,
+000022b0: 3229 5d20 2d3e 2063 756d 7369 7a65 7320  2)] -> cumsizes 
+000022c0: 5b30 2c32 2c34 2c36 5d2e 2053 6565 6b20  [0,2,4,6]. Seek 
+000022d0: 746f 206f 6666 7365 7420 3220 7368 6f75  to offset 2 shou
+000022e0: 6c64 2073 6565 6b20 746f 2032 322e 0a20  ld seek to 22.. 
+000022f0: 2020 2020 2020 2061 7373 6572 7420 6f66         assert of
+00002300: 6673 6574 203e 3d20 300a 2020 2020 2020  fset >= 0.      
+00002310: 2020 6920 3d20 6269 7365 6374 2e62 6973    i = bisect.bis
+00002320: 6563 745f 6c65 6674 2873 656c 662e 6375  ect_left(self.cu
+00002330: 6d73 697a 6573 2c20 6f66 6673 6574 202b  msizes, offset +
+00002340: 2031 2920 2d20 310a 2020 2020 2020 2020   1) - 1.        
+00002350: 6173 7365 7274 2069 203e 3d20 300a 2020  assert i >= 0.  
+00002360: 2020 2020 2020 7265 7475 726e 2069 0a0a        return i..
+00002370: 2020 2020 6465 6620 5f5f 656e 7465 725f      def __enter_
+00002380: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00002390: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+000023a0: 2020 6465 6620 5f5f 6578 6974 5f5f 2873    def __exit__(s
+000023b0: 656c 662c 2065 7863 6570 7469 6f6e 5f74  elf, exception_t
+000023c0: 7970 652c 2065 7863 6570 7469 6f6e 5f76  ype, exception_v
+000023d0: 616c 7565 2c20 6578 6365 7074 696f 6e5f  alue, exception_
+000023e0: 7472 6163 6562 6163 6b29 3a0a 2020 2020  traceback):.    
+000023f0: 2020 2020 7061 7373 0a0a 2020 2020 406f      pass..    @o
+00002400: 7665 7272 6964 6573 2869 6f2e 4275 6666  verrides(io.Buff
+00002410: 6572 6564 494f 4261 7365 290a 2020 2020  eredIOBase).    
+00002420: 6465 6620 636c 6f73 6528 7365 6c66 2920  def close(self) 
+00002430: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00002440: 2023 2044 6f6e 2774 2063 6c6f 7365 2074   # Don't close t
+00002450: 6865 206f 626a 6563 7420 6769 7665 6e20  he object given 
+00002460: 746f 2075 730a 2020 2020 2020 2020 2320  to us.        # 
+00002470: 7365 6c66 2e66 696c 656f 626a 2e63 6c6f  self.fileobj.clo
+00002480: 7365 2829 0a20 2020 2020 2020 2070 6173  se().        pas
+00002490: 730a 0a20 2020 2040 6f76 6572 7269 6465  s..    @override
+000024a0: 7328 696f 2e42 7566 6665 7265 6449 4f42  s(io.BufferedIOB
+000024b0: 6173 6529 0a20 2020 2064 6566 2066 696c  ase).    def fil
+000024c0: 656e 6f28 7365 6c66 2920 2d3e 2069 6e74  eno(self) -> int
+000024d0: 3a0a 2020 2020 2020 2020 2320 5468 6973  :.        # This
+000024e0: 2069 7320 6120 7669 7274 7561 6c20 5079   is a virtual Py
+000024f0: 7468 6f6e 206c 6576 656c 2066 696c 6520  thon level file 
+00002500: 6f62 6a65 6374 2061 6e64 2074 6865 7265  object and there
+00002510: 666f 7265 2064 6f65 7320 6e6f 7420 6861  fore does not ha
+00002520: 7665 2061 2076 616c 6964 204f 5320 6669  ve a valid OS fi
+00002530: 6c65 2064 6573 6372 6970 746f 7221 0a20  le descriptor!. 
+00002540: 2020 2020 2020 2072 6169 7365 2069 6f2e         raise io.
+00002550: 556e 7375 7070 6f72 7465 644f 7065 7261  UnsupportedOpera
+00002560: 7469 6f6e 2829 0a0a 2020 2020 406f 7665  tion()..    @ove
+00002570: 7272 6964 6573 2869 6f2e 4275 6666 6572  rrides(io.Buffer
+00002580: 6564 494f 4261 7365 290a 2020 2020 6465  edIOBase).    de
+00002590: 6620 7365 656b 6162 6c65 2873 656c 6629  f seekable(self)
+000025a0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+000025b0: 2020 7265 7475 726e 2073 656c 662e 6669    return self.fi
+000025c0: 6c65 6f62 6a2e 7365 656b 6162 6c65 2829  leobj.seekable()
+000025d0: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
+000025e0: 2869 6f2e 4275 6666 6572 6564 494f 4261  (io.BufferedIOBa
+000025f0: 7365 290a 2020 2020 6465 6620 7265 6164  se).    def read
+00002600: 6162 6c65 2873 656c 6629 202d 3e20 626f  able(self) -> bo
+00002610: 6f6c 3a0a 2020 2020 2020 2020 7265 7475  ol:.        retu
+00002620: 726e 2073 656c 662e 6669 6c65 6f62 6a2e  rn self.fileobj.
+00002630: 7265 6164 6162 6c65 2829 0a0a 2020 2020  readable()..    
+00002640: 406f 7665 7272 6964 6573 2869 6f2e 4275  @overrides(io.Bu
+00002650: 6666 6572 6564 494f 4261 7365 290a 2020  fferedIOBase).  
+00002660: 2020 6465 6620 7772 6974 6162 6c65 2873    def writable(s
+00002670: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
+00002680: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00002690: 7365 0a0a 2020 2020 406f 7665 7272 6964  se..    @overrid
+000026a0: 6573 2869 6f2e 4275 6666 6572 6564 494f  es(io.BufferedIO
+000026b0: 4261 7365 290a 2020 2020 6465 6620 7265  Base).    def re
+000026c0: 6164 2873 656c 662c 2073 697a 653a 2069  ad(self, size: i
+000026d0: 6e74 203d 202d 3129 202d 3e20 6279 7465  nt = -1) -> byte
+000026e0: 733a 0a20 2020 2020 2020 2069 6620 7369  s:.        if si
+000026f0: 7a65 203d 3d20 2d31 3a0a 2020 2020 2020  ze == -1:.      
+00002700: 2020 2020 2020 7369 7a65 203d 2073 656c        size = sel
+00002710: 662e 6375 6d73 697a 6573 5b2d 315d 202d  f.cumsizes[-1] -
+00002720: 2073 656c 662e 6f66 6673 6574 0a0a 2020   self.offset..  
+00002730: 2020 2020 2020 2320 5468 6973 206c 6f6f        # This loo
+00002740: 7020 776f 726b 7320 696e 2061 206b 696e  p works in a kin
+00002750: 6420 6f66 206c 6561 7066 726f 6720 6661  d of leapfrog fa
+00002760: 7368 696f 6e2e 204f 6e20 6561 6368 2065  shion. On each e
+00002770: 7665 6e20 6c6f 6f70 2069 7465 7261 7469  ven loop iterati
+00002780: 6f6e 2069 7420 7365 656b 7320 746f 2074  on it seeks to t
+00002790: 6865 206e 6578 7420 7374 656e 6369 6c0a  he next stencil.
+000027a0: 2020 2020 2020 2020 2320 616e 6420 6f6e          # and on
+000027b0: 2065 6163 6820 6f64 6420 6974 6572 6174   each odd iterat
+000027c0: 696f 6e20 6974 2072 6561 6473 2074 6865  ion it reads the
+000027d0: 2064 6174 6120 616e 6420 696e 6372 656d   data and increm
+000027e0: 656e 7473 2074 6865 206f 6666 7365 7420  ents the offset 
+000027f0: 696e 7369 6465 2074 6865 2073 7465 6e63  inside the stenc
+00002800: 696c 210a 2020 2020 2020 2020 7265 7375  il!.        resu
+00002810: 6c74 203d 2062 2727 0a20 2020 2020 2020  lt = b''.       
+00002820: 2069 203d 2073 656c 662e 5f66 696e 6453   i = self._findS
+00002830: 7465 6e63 696c 2873 656c 662e 6f66 6673  tencil(self.offs
+00002840: 6574 290a 2020 2020 2020 2020 6966 2069  et).        if i
+00002850: 203e 3d20 6c65 6e28 7365 6c66 2e73 697a   >= len(self.siz
+00002860: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+00002870: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+00002880: 2020 2020 2020 2020 6f66 6673 6574 496e          offsetIn
+00002890: 7369 6465 5374 656e 6369 6c20 3d20 7365  sideStencil = se
+000028a0: 6c66 2e6f 6666 7365 7420 2d20 7365 6c66  lf.offset - self
+000028b0: 2e63 756d 7369 7a65 735b 695d 0a20 2020  .cumsizes[i].   
+000028c0: 2020 2020 2061 7373 6572 7420 6f66 6673       assert offs
+000028d0: 6574 496e 7369 6465 5374 656e 6369 6c20  etInsideStencil 
+000028e0: 3e3d 2030 0a20 2020 2020 2020 2061 7373  >= 0.        ass
+000028f0: 6572 7420 6f66 6673 6574 496e 7369 6465  ert offsetInside
+00002900: 5374 656e 6369 6c20 3c20 7365 6c66 2e73  Stencil < self.s
+00002910: 697a 6573 5b69 5d0a 2020 2020 2020 2020  izes[i].        
+00002920: 7365 6c66 2e66 696c 656f 626a 2e73 6565  self.fileobj.see
+00002930: 6b28 7365 6c66 2e6f 6666 7365 7473 5b69  k(self.offsets[i
+00002940: 5d20 2b20 6f66 6673 6574 496e 7369 6465  ] + offsetInside
+00002950: 5374 656e 6369 6c2c 2069 6f2e 5345 454b  Stencil, io.SEEK
+00002960: 5f53 4554 290a 0a20 2020 2020 2020 2077  _SET)..        w
+00002970: 6869 6c65 2073 697a 6520 3e20 3020 616e  hile size > 0 an
+00002980: 6420 6920 3c20 6c65 6e28 7365 6c66 2e73  d i < len(self.s
+00002990: 697a 6573 293a 0a20 2020 2020 2020 2020  izes):.         
+000029a0: 2020 2023 2052 6561 6420 6173 206d 7563     # Read as muc
+000029b0: 6820 6173 2072 6571 7565 7374 6564 206f  h as requested o
+000029c0: 7220 6173 206d 7563 6820 6173 2074 6865  r as much as the
+000029d0: 2063 7572 7265 6e74 2063 6f6e 7469 6775   current contigu
+000029e0: 6f75 7320 7265 6769 6f6e 202f 2073 7465  ous region / ste
+000029f0: 6e63 696c 2073 7469 6c6c 2063 6f6e 7461  ncil still conta
+00002a00: 696e 730a 2020 2020 2020 2020 2020 2020  ins.            
+00002a10: 7265 6164 6162 6c65 5369 7a65 203d 206d  readableSize = m
+00002a20: 696e 2873 697a 652c 2073 656c 662e 7369  in(size, self.si
+00002a30: 7a65 735b 695d 202d 2028 7365 6c66 2e6f  zes[i] - (self.o
+00002a40: 6666 7365 7420 2d20 7365 6c66 2e63 756d  ffset - self.cum
+00002a50: 7369 7a65 735b 695d 2929 0a20 2020 2020  sizes[i])).     
+00002a60: 2020 2020 2020 2069 6620 7265 6164 6162         if readab
+00002a70: 6c65 5369 7a65 203d 3d20 303a 0a20 2020  leSize == 0:.   
+00002a80: 2020 2020 2020 2020 2020 2020 2023 2047               # G
+00002a90: 6f20 746f 206e 6578 7420 7374 656e 6369  o to next stenci
+00002aa0: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00002ab0: 2020 6920 2b3d 2031 0a20 2020 2020 2020    i += 1.       
+00002ac0: 2020 2020 2020 2020 2069 6620 6920 3e3d           if i >=
+00002ad0: 206c 656e 2873 656c 662e 6f66 6673 6574   len(self.offset
+00002ae0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00002af0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00002b00: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00002b10: 6c66 2e66 696c 656f 626a 2e73 6565 6b28  lf.fileobj.seek(
+00002b20: 7365 6c66 2e6f 6666 7365 7473 5b69 5d29  self.offsets[i])
+00002b30: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00002b40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00002b50: 2020 2023 2041 6374 7561 6c6c 7920 7265     # Actually re
+00002b60: 6164 2064 6174 610a 2020 2020 2020 2020  ad data.        
+00002b70: 2020 2020 2020 2020 746d 7020 3d20 7365          tmp = se
+00002b80: 6c66 2e66 696c 656f 626a 2e72 6561 6428  lf.fileobj.read(
+00002b90: 7265 6164 6162 6c65 5369 7a65 290a 2020  readableSize).  
+00002ba0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00002bb0: 6c66 2e6f 6666 7365 7420 2b3d 206c 656e  lf.offset += len
+00002bc0: 2874 6d70 290a 2020 2020 2020 2020 2020  (tmp).          
+00002bd0: 2020 2020 2020 7265 7375 6c74 202b 3d20        result += 
+00002be0: 746d 700a 2020 2020 2020 2020 2020 2020  tmp.            
+00002bf0: 2020 2020 7369 7a65 202d 3d20 7265 6164      size -= read
+00002c00: 6162 6c65 5369 7a65 0a20 2020 2020 2020  ableSize.       
+00002c10: 2020 2020 2020 2020 2023 204e 6f77 2c20           # Now, 
+00002c20: 6569 7468 6572 2073 697a 6520 6973 2030  either size is 0
+00002c30: 206f 7220 7265 6164 6162 6c65 5369 7a65   or readableSize
+00002c40: 2077 696c 6c20 6265 2030 2069 6e20 7468   will be 0 in th
+00002c50: 6520 6e65 7874 2069 7465 7261 7469 6f6e  e next iteration
+00002c60: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00002c70: 2072 6573 756c 740a 0a20 2020 2040 6f76   result..    @ov
+00002c80: 6572 7269 6465 7328 696f 2e42 7566 6665  errides(io.Buffe
+00002c90: 7265 6449 4f42 6173 6529 0a20 2020 2064  redIOBase).    d
+00002ca0: 6566 2073 6565 6b28 7365 6c66 2c20 6f66  ef seek(self, of
+00002cb0: 6673 6574 3a20 696e 742c 2077 6865 6e63  fset: int, whenc
+00002cc0: 653a 2069 6e74 203d 2069 6f2e 5345 454b  e: int = io.SEEK
+00002cd0: 5f53 4554 2920 2d3e 2069 6e74 3a0a 2020  _SET) -> int:.  
+00002ce0: 2020 2020 2020 6966 2077 6865 6e63 6520        if whence 
+00002cf0: 3d3d 2069 6f2e 5345 454b 5f43 5552 3a0a  == io.SEEK_CUR:.
+00002d00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002d10: 2e6f 6666 7365 7420 2b3d 206f 6666 7365  .offset += offse
+00002d20: 740a 2020 2020 2020 2020 656c 6966 2077  t.        elif w
+00002d30: 6865 6e63 6520 3d3d 2069 6f2e 5345 454b  hence == io.SEEK
+00002d40: 5f45 4e44 3a0a 2020 2020 2020 2020 2020  _END:.          
+00002d50: 2020 7365 6c66 2e6f 6666 7365 7420 3d20    self.offset = 
+00002d60: 7365 6c66 2e63 756d 7369 7a65 735b 2d31  self.cumsizes[-1
+00002d70: 5d20 2b20 6f66 6673 6574 0a20 2020 2020  ] + offset.     
+00002d80: 2020 2065 6c69 6620 7768 656e 6365 203d     elif whence =
+00002d90: 3d20 696f 2e53 4545 4b5f 5345 543a 0a20  = io.SEEK_SET:. 
+00002da0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002db0: 6f66 6673 6574 203d 206f 6666 7365 740a  offset = offset.
+00002dc0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00002dd0: 2e6f 6666 7365 7420 3c20 303a 0a20 2020  .offset < 0:.   
+00002de0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00002df0: 616c 7565 4572 726f 7228 2254 7279 696e  alueError("Tryin
+00002e00: 6720 746f 2073 6565 6b20 6265 666f 7265  g to seek before
+00002e10: 2074 6865 2073 7461 7274 206f 6620 7468   the start of th
+00002e20: 6520 6669 6c65 2122 290a 2020 2020 2020  e file!").      
+00002e30: 2020 6966 2073 656c 662e 6f66 6673 6574    if self.offset
+00002e40: 203e 3d20 7365 6c66 2e63 756d 7369 7a65   >= self.cumsize
+00002e50: 735b 2d31 5d3a 0a20 2020 2020 2020 2020  s[-1]:.         
+00002e60: 2020 2072 6574 7572 6e20 7365 6c66 2e6f     return self.o
+00002e70: 6666 7365 740a 0a20 2020 2020 2020 2072  ffset..        r
+00002e80: 6574 7572 6e20 7365 6c66 2e6f 6666 7365  eturn self.offse
+00002e90: 740a 0a20 2020 2040 6f76 6572 7269 6465  t..    @override
+00002ea0: 7328 696f 2e42 7566 6665 7265 6449 4f42  s(io.BufferedIOB
+00002eb0: 6173 6529 0a20 2020 2064 6566 2074 656c  ase).    def tel
+00002ec0: 6c28 7365 6c66 2920 2d3e 2069 6e74 3a0a  l(self) -> int:.
+00002ed0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00002ee0: 656c 662e 6f66 6673 6574 0a0a 0a40 6461  elf.offset...@da
+00002ef0: 7461 636c 6173 730a 636c 6173 7320 4669  taclass.class Fi
+00002f00: 6c65 496e 666f 3a0a 2020 2020 2320 666d  leInfo:.    # fm
+00002f10: 743a 206f 6666 0a20 2020 2073 697a 6520  t: off.    size 
+00002f20: 2020 2020 3a20 696e 740a 2020 2020 6d74      : int.    mt
+00002f30: 696d 6520 2020 203a 2066 6c6f 6174 0a20  ime    : float. 
+00002f40: 2020 206d 6f64 6520 2020 2020 3a20 696e     mode     : in
+00002f50: 740a 2020 2020 6c69 6e6b 6e61 6d65 203a  t.    linkname :
+00002f60: 2073 7472 0a20 2020 2075 6964 2020 2020   str.    uid    
+00002f70: 2020 3a20 696e 740a 2020 2020 6769 6420    : int.    gid 
+00002f80: 2020 2020 203a 2069 6e74 0a20 2020 2023       : int.    #
+00002f90: 2042 7920 636f 6e76 656e 7469 6f6e 2074   By convention t
+00002fa0: 6869 7320 6973 2061 206c 6973 7420 616e  his is a list an
+00002fb0: 6420 4d6f 756e 7453 6f75 7263 6573 2073  d MountSources s
+00002fc0: 686f 756c 6420 6f6e 6c79 2072 6561 6420  hould only read 
+00002fd0: 7468 6520 6c61 7374 2065 6c65 6d65 6e74  the last element
+00002fe0: 2061 6e64 2062 6566 6f72 6520 666f 7277   and before forw
+00002ff0: 6172 6469 6e67 2074 6865 0a20 2020 2023  arding the.    #
+00003000: 2046 696c 6549 6e66 6f20 746f 2061 2070   FileInfo to a p
+00003010: 6f73 7369 626c 7920 7265 6375 7273 6976  ossibly recursiv
+00003020: 656c 7920 226d 6f75 6e74 6564 2220 4d6f  ely "mounted" Mo
+00003030: 756e 7453 6f75 7263 652c 2072 656d 6f76  untSource, remov
+00003040: 6520 7468 6174 206c 6173 7420 656c 656d  e that last elem
+00003050: 656e 7420 6265 6c6f 6e67 696e 6720 746f  ent belonging to
+00003060: 2069 742e 0a20 2020 2023 2054 6869 7320   it..    # This 
+00003070: 7761 7920 616e 2061 7262 6974 7261 7279  way an arbitrary
+00003080: 2061 6d6f 756e 7420 6f66 2075 7365 7264   amount of userd
+00003090: 6174 6120 6361 6e20 6265 2073 746f 7265  ata can be store
+000030a0: 6420 616e 6420 6974 2073 686f 756c 6420  d and it should 
+000030b0: 6265 2064 6563 6964 6162 6c65 2077 6869  be decidable whi
+000030c0: 6368 2062 656c 6f6e 6773 2074 6f20 7768  ch belongs to wh
+000030d0: 6f6d 2069 6e0a 2020 2020 2320 6120 6368  om in.    # a ch
+000030e0: 6169 6e20 6f66 204d 6f75 6e74 536f 7572  ain of MountSour
+000030f0: 6365 206f 626a 6563 7473 2e0a 2020 2020  ce objects..    
+00003100: 7573 6572 6461 7461 203a 204c 6973 745b  userdata : List[
+00003110: 416e 795d 0a20 2020 2023 2066 6d74 3a20  Any].    # fmt: 
+00003120: 6f6e 0a0a 2020 2020 6465 6620 636c 6f6e  on..    def clon
+00003130: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+00003140: 2063 6f70 6965 6420 3d20 6461 7461 636c   copied = datacl
+00003150: 6173 7365 732e 7265 706c 6163 6528 7365  asses.replace(se
+00003160: 6c66 290a 2020 2020 2020 2020 2320 4d61  lf).        # Ma
+00003170: 6b65 2061 206e 6577 2075 7365 7264 6174  ke a new userdat
+00003180: 6120 6c69 7374 2062 7574 2064 6f20 6e6f  a list but do no
+00003190: 7420 646f 2061 2066 756c 6c20 6465 6570  t do a full deep
+000031a0: 2063 6f70 7920 6265 6361 7573 6520 736f   copy because so
+000031b0: 6d65 204d 6f75 6e74 536f 7572 6365 7320  me MountSources 
+000031c0: 7075 7420 7265 6665 7265 6e63 6573 0a20  put references. 
+000031d0: 2020 2020 2020 2023 2074 6f20 4d6f 756e         # to Moun
+000031e0: 7453 6f75 7263 6573 2069 6e74 6f20 7573  tSources into us
+000031f0: 6572 6461 7461 2061 6e64 2074 686f 7365  erdata and those
+00003200: 2073 686f 756c 6420 616e 6420 6361 6e20   should and can 
+00003210: 6e6f 7420 6265 2064 6565 7020 636f 7069  not be deep copi
+00003220: 6564 2e0a 2020 2020 2020 2020 636f 7069  ed..        copi
+00003230: 6564 2e75 7365 7264 6174 6120 3d20 7365  ed.userdata = se
+00003240: 6c66 2e75 7365 7264 6174 615b 3a5d 0a20  lf.userdata[:]. 
+00003250: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00003260: 7069 6564 0a0a 0a40 6461 7461 636c 6173  pied...@dataclas
+00003270: 730a 636c 6173 7320 5351 4c69 7465 496e  s.class SQLiteIn
+00003280: 6465 7865 6454 6172 5573 6572 4461 7461  dexedTarUserData
+00003290: 3a0a 2020 2020 2320 666d 743a 206f 6666  :.    # fmt: off
+000032a0: 0a20 2020 206f 6666 7365 7420 2020 2020  .    offset     
+000032b0: 2020 3a20 696e 740a 2020 2020 6f66 6673    : int.    offs
+000032c0: 6574 6865 6164 6572 203a 2069 6e74 0a20  etheader : int. 
+000032d0: 2020 2069 7374 6172 2020 2020 2020 2020     istar        
+000032e0: 3a20 626f 6f6c 0a20 2020 2069 7373 7061  : bool.    isspa
+000032f0: 7273 6520 2020 2020 3a20 626f 6f6c 0a20  rse     : bool. 
+00003300: 2020 2023 2066 6d74 3a20 6f6e 0a0a 0a63     # fmt: on...c
+00003310: 6c61 7373 204d 6f75 6e74 536f 7572 6365  lass MountSource
+00003320: 2841 4243 293a 0a20 2020 2022 2222 0a20  (ABC):.    """. 
+00003330: 2020 2047 656e 6572 6963 2063 6c61 7373     Generic class
+00003340: 2072 6570 7265 7365 6e74 696e 6720 6120   representing a 
+00003350: 6d6f 756e 7420 706f 696e 742e 2049 7427  mount point. It'
+00003360: 7320 6261 7369 6361 6c6c 7920 6c69 6b65  s basically like
+00003370: 2074 6865 2046 5553 4520 4150 4920 6275   the FUSE API bu
+00003380: 7420 626f 696c 6564 2064 6f77 6e0a 2020  t boiled down.  
+00003390: 2020 746f 2074 6865 206e 6563 6573 7361    to the necessa
+000033a0: 7279 206d 6574 686f 6473 2066 6f72 2072  ry methods for r
+000033b0: 6174 6172 6d6f 756e 742e 0a0a 2020 2020  atarmount...    
+000033c0: 5369 6d69 6c61 722c 2074 6f20 4655 5345  Similar, to FUSE
+000033d0: 2c20 616c 6c20 7061 7468 7320 7368 6f75  , all paths shou
+000033e0: 6c64 2068 6176 6520 6120 6c65 6164 696e  ld have a leadin
+000033f0: 6720 272f 272e 0a20 2020 2049 6620 7468  g '/'..    If th
+00003400: 6572 6520 6973 2069 7320 6e6f 206c 6561  ere is is no lea
+00003410: 6469 6e67 2073 6c61 7368 2c20 6265 6861  ding slash, beha
+00003420: 7665 2061 7320 6966 2074 6865 7265 2077  ve as if there w
+00003430: 6173 206f 6e65 2e0a 2020 2020 2222 220a  as one..    """.
+00003440: 0a20 2020 2040 6162 7374 7261 6374 6d65  .    @abstractme
+00003450: 7468 6f64 0a20 2020 2064 6566 206c 6973  thod.    def lis
+00003460: 7444 6972 2873 656c 662c 2070 6174 683a  tDir(self, path:
+00003470: 2073 7472 2920 2d3e 204f 7074 696f 6e61   str) -> Optiona
+00003480: 6c5b 4974 6572 6162 6c65 5b73 7472 5d5d  l[Iterable[str]]
+00003490: 3a0a 2020 2020 2020 2020 7061 7373 0a0a  :.        pass..
+000034a0: 2020 2020 4061 6273 7472 6163 746d 6574      @abstractmet
+000034b0: 686f 640a 2020 2020 6465 6620 6765 7446  hod.    def getF
+000034c0: 696c 6549 6e66 6f28 7365 6c66 2c20 7061  ileInfo(self, pa
+000034d0: 7468 3a20 7374 722c 2066 696c 6556 6572  th: str, fileVer
+000034e0: 7369 6f6e 3a20 696e 7420 3d20 3029 202d  sion: int = 0) -
+000034f0: 3e20 4f70 7469 6f6e 616c 5b46 696c 6549  > Optional[FileI
+00003500: 6e66 6f5d 3a0a 2020 2020 2020 2020 7061  nfo]:.        pa
+00003510: 7373 0a0a 2020 2020 4061 6273 7472 6163  ss..    @abstrac
+00003520: 746d 6574 686f 640a 2020 2020 6465 6620  tmethod.    def 
+00003530: 6669 6c65 5665 7273 696f 6e73 2873 656c  fileVersions(sel
+00003540: 662c 2070 6174 683a 2073 7472 2920 2d3e  f, path: str) ->
+00003550: 2069 6e74 3a0a 2020 2020 2020 2020 7061   int:.        pa
+00003560: 7373 0a0a 2020 2020 4061 6273 7472 6163  ss..    @abstrac
+00003570: 746d 6574 686f 640a 2020 2020 6465 6620  tmethod.    def 
+00003580: 6f70 656e 2873 656c 662c 2066 696c 6549  open(self, fileI
+00003590: 6e66 6f3a 2046 696c 6549 6e66 6f29 202d  nfo: FileInfo) -
+000035a0: 3e20 494f 5b62 7974 6573 5d3a 0a20 2020  > IO[bytes]:.   
+000035b0: 2020 2020 2070 6173 730a 0a20 2020 2040       pass..    @
+000035c0: 6162 7374 7261 6374 6d65 7468 6f64 0a20  abstractmethod. 
+000035d0: 2020 2064 6566 2072 6561 6428 7365 6c66     def read(self
+000035e0: 2c20 6669 6c65 496e 666f 3a20 4669 6c65  , fileInfo: File
+000035f0: 496e 666f 2c20 7369 7a65 3a20 696e 742c  Info, size: int,
+00003600: 206f 6666 7365 743a 2069 6e74 2920 2d3e   offset: int) ->
+00003610: 2062 7974 6573 3a0a 2020 2020 2020 2020   bytes:.        
+00003620: 7061 7373 0a0a 2020 2020 6465 6620 6765  pass..    def ge
+00003630: 744d 6f75 6e74 536f 7572 6365 2873 656c  tMountSource(sel
+00003640: 662c 2066 696c 6549 6e66 6f3a 2046 696c  f, fileInfo: Fil
+00003650: 6549 6e66 6f29 3a0a 2020 2020 2020 2020  eInfo):.        
+00003660: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+00003670: 726e 7320 7468 6520 6469 7265 6374 206d  rns the direct m
+00003680: 6f75 6e74 2073 6f75 7263 6520 746f 2077  ount source to w
+00003690: 6869 6368 2074 6865 2066 696c 6549 6e66  hich the fileInf
+000036a0: 6f20 6265 6c6f 6e67 732c 2061 206d 6f75  o belongs, a mou
+000036b0: 6e74 2073 6f75 7263 6520 7370 6563 6966  nt source specif
+000036c0: 6963 2066 696c 6520 696e 666f 2c0a 2020  ic file info,.  
+000036d0: 2020 2020 2020 616e 6420 7468 6520 6d6f        and the mo
+000036e0: 756e 7420 706f 696e 7420 6f66 2074 6865  unt point of the
+000036f0: 2072 6574 7572 6e65 6420 6d6f 756e 7420   returned mount 
+00003700: 736f 7572 6365 2069 6e20 7265 7370 6563  source in respec
+00003710: 7420 746f 2074 6869 7320 2873 656c 6629  t to this (self)
+00003720: 204d 6f75 6e74 536f 7572 6365 2e0a 2020   MountSource..  
+00003730: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003740: 2020 7265 7475 726e 2027 2f27 2c20 7365    return '/', se
+00003750: 6c66 2c20 6669 6c65 496e 666f 0a0a 2020  lf, fileInfo..  
+00003760: 2020 6465 6620 6578 6973 7473 2873 656c    def exists(sel
+00003770: 662c 2070 6174 683a 2073 7472 293a 0a20  f, path: str):. 
+00003780: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00003790: 6c66 2e67 6574 4669 6c65 496e 666f 2870  lf.getFileInfo(p
+000037a0: 6174 6829 2069 7320 6e6f 7420 4e6f 6e65  ath) is not None
+000037b0: 0a0a 2020 2020 6465 6620 6973 6469 7228  ..    def isdir(
+000037c0: 7365 6c66 2c20 7061 7468 3a20 7374 7229  self, path: str)
+000037d0: 3a0a 2020 2020 2020 2020 6669 6c65 496e  :.        fileIn
+000037e0: 666f 203d 2073 656c 662e 6765 7446 696c  fo = self.getFil
+000037f0: 6549 6e66 6f28 7061 7468 290a 2020 2020  eInfo(path).    
+00003800: 2020 2020 7265 7475 726e 2066 696c 6549      return fileI
+00003810: 6e66 6f20 6973 206e 6f74 204e 6f6e 6520  nfo is not None 
+00003820: 616e 6420 7374 6174 2e53 5f49 5344 4952  and stat.S_ISDIR
+00003830: 2866 696c 6549 6e66 6f2e 6d6f 6465 290a  (fileInfo.mode).
+00003840: 0a0a 636c 6173 7320 5351 4c69 7465 496e  ..class SQLiteIn
+00003850: 6465 7865 6454 6172 284d 6f75 6e74 536f  dexedTar(MountSo
+00003860: 7572 6365 293a 0a20 2020 2022 2222 0a20  urce):.    """. 
+00003870: 2020 2054 6869 7320 636c 6173 7320 7265     This class re
+00003880: 6164 7320 6f6e 6365 2074 6872 6f75 6768  ads once through
+00003890: 2074 6865 2077 686f 6c65 2054 4152 2061   the whole TAR a
+000038a0: 7263 6869 7665 2061 6e64 2073 746f 7265  rchive and store
+000038b0: 7320 5441 5220 6669 6c65 206f 6666 7365  s TAR file offse
+000038c0: 7473 0a20 2020 2066 6f72 2061 6c6c 2063  ts.    for all c
+000038d0: 6f6e 7461 696e 6564 2066 696c 6573 2069  ontained files i
+000038e0: 6e20 616e 2069 6e64 6578 2074 6f20 7375  n an index to su
+000038f0: 7070 6f72 7420 6661 7374 2073 6565 6b69  pport fast seeki
+00003900: 6e67 2074 6f20 6120 6769 7665 6e20 6669  ng to a given fi
+00003910: 6c65 2e0a 2020 2020 2222 220a 0a20 2020  le..    """..   
+00003920: 2023 2056 6572 7369 6f6e 2030 2e31 2e30   # Version 0.1.0
+00003930: 3a0a 2020 2020 2320 2020 2d20 496e 6974  :.    #   - Init
+00003940: 6961 6c20 7665 7273 696f 6e0a 2020 2020  ial version.    
+00003950: 2320 5665 7273 696f 6e20 302e 322e 303a  # Version 0.2.0:
+00003960: 0a20 2020 2023 2020 202d 2041 6464 2073  .    #   - Add s
+00003970: 7061 7273 6520 7375 7070 6f72 7420 616e  parse support an
+00003980: 6420 276f 6666 7365 7468 6561 6465 7227  d 'offsetheader'
+00003990: 2061 6e64 2027 6973 7370 6172 7365 2720   and 'issparse' 
+000039a0: 636f 6c75 6d6e 7320 746f 2074 6865 2053  columns to the S
+000039b0: 514c 6974 6520 6461 7461 6261 7365 0a20  QLite database. 
+000039c0: 2020 2023 2020 202d 2041 6464 2054 4152     #   - Add TAR
+000039d0: 2066 696c 6520 7369 7a65 206d 6574 6164   file size metad
+000039e0: 6174 6120 696e 206f 7264 6572 2074 6f20  ata in order to 
+000039f0: 7175 6963 6b6c 7920 6368 6563 6b20 7768  quickly check wh
+00003a00: 6574 6865 7220 7468 6520 5441 5220 6368  ether the TAR ch
+00003a10: 616e 6765 640a 2020 2020 2320 2020 2d20  anged.    #   - 
+00003a20: 4164 6420 276f 6666 7365 7468 6561 6465  Add 'offsetheade
+00003a30: 7227 2074 6f20 7468 6520 7072 696d 6172  r' to the primar
+00003a40: 7920 6b65 7920 6f66 2074 6865 2027 6669  y key of the 'fi
+00003a50: 6c65 7327 2074 6162 6c65 2073 6f20 7468  les' table so th
+00003a60: 6174 2066 696c 6573 2077 6869 6368 2077  at files which w
+00003a70: 6572 650a 2020 2020 2320 2020 2020 7570  ere.    #     up
+00003a80: 6461 7465 6420 696e 2074 6865 2054 4152  dated in the TAR
+00003a90: 2063 616e 2073 7469 6c6c 2062 6520 6163   can still be ac
+00003aa0: 6365 7373 6564 2069 6620 6e65 6365 7373  cessed if necess
+00003ab0: 6172 792e 0a20 2020 2023 2056 6572 7369  ary..    # Versi
+00003ac0: 6f6e 2030 2e33 2e30 3a0a 2020 2020 2320  on 0.3.0:.    # 
+00003ad0: 2020 2d20 4164 6420 6172 6775 6d65 6e74    - Add argument
+00003ae0: 7320 696e 666c 7565 6e63 696e 6720 7468  s influencing th
+00003af0: 6520 6372 6561 7465 6420 696e 6465 7820  e created index 
+00003b00: 746f 206d 6574 6164 6174 6120 2869 676e  to metadata (ign
+00003b10: 6f72 652d 7a65 726f 732c 2072 6563 7572  ore-zeros, recur
+00003b20: 7369 7665 2c20 2e2e 2e29 0a20 2020 2023  sive, ...).    #
+00003b30: 2056 6572 7369 6f6e 2030 2e34 2e30 3a0a   Version 0.4.0:.
+00003b40: 2020 2020 2320 2020 2d20 4164 6465 6420      #   - Added 
+00003b50: 2767 7a69 7069 6e64 6578 6573 2720 7461  'gzipindexes' ta
+00003b60: 626c 652c 2077 6869 6368 206d 6179 2063  ble, which may c
+00003b70: 6f6e 7461 696e 206d 756c 7469 706c 6520  ontain multiple 
+00003b80: 626c 6f62 7320 696e 2063 6f6e 7472 6173  blobs in contras
+00003b90: 7420 746f 2027 677a 6970 696e 6465 7827  t to 'gzipindex'
+00003ba0: 2074 6162 6c65 2e0a 2020 2020 5f5f 7665   table..    __ve
+00003bb0: 7273 696f 6e5f 5f20 3d20 2730 2e34 2e30  rsion__ = '0.4.0
+00003bc0: 270a 0a20 2020 2064 6566 205f 5f69 6e69  '..    def __ini
+00003bd0: 745f 5f28 0a20 2020 2020 2020 2023 2066  t__(.        # f
+00003be0: 6d74 3a20 6f66 660a 2020 2020 2020 2020  mt: off.        
+00003bf0: 7365 6c66 2c0a 2020 2020 2020 2020 7461  self,.        ta
+00003c00: 7246 696c 654e 616d 6520 2020 2020 2020  rFileName       
+00003c10: 2020 2020 2020 2020 203a 204f 7074 696f           : Optio
+00003c20: 6e61 6c5b 7374 725d 2020 2020 2020 203d  nal[str]       =
+00003c30: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+00003c40: 696c 654f 626a 6563 7420 2020 2020 2020  ileObject       
+00003c50: 2020 2020 2020 2020 2020 3a20 4f70 7469            : Opti
+00003c60: 6f6e 616c 5b49 4f5b 6279 7465 735d 5d20  onal[IO[bytes]] 
+00003c70: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00003c80: 7772 6974 6549 6e64 6578 2020 2020 2020  writeIndex      
+00003c90: 2020 2020 2020 2020 2020 203a 2062 6f6f             : boo
+00003ca0: 6c20 2020 2020 2020 2020 2020 2020 2020  l               
+00003cb0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+00003cc0: 2020 636c 6561 7249 6e64 6578 4361 6368    clearIndexCach
+00003cd0: 6520 2020 2020 2020 2020 2020 203a 2062  e            : b
+00003ce0: 6f6f 6c20 2020 2020 2020 2020 2020 2020  ool             
+00003cf0: 2020 203d 2046 616c 7365 2c0a 2020 2020     = False,.    
+00003d00: 2020 2020 696e 6465 7846 696c 654e 616d      indexFileNam
+00003d10: 6520 2020 2020 2020 2020 2020 2020 203a  e              :
+00003d20: 204f 7074 696f 6e61 6c5b 7374 725d 2020   Optional[str]  
+00003d30: 2020 2020 203d 204e 6f6e 652c 0a20 2020       = None,.   
+00003d40: 2020 2020 2069 6e64 6578 466f 6c64 6572       indexFolder
+00003d50: 7320 2020 2020 2020 2020 2020 2020 2020  s               
+00003d60: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745b  : Optional[List[
+00003d70: 7374 725d 5d20 3d20 4e6f 6e65 2c0a 2020  str]] = None,.  
+00003d80: 2020 2020 2020 7265 6375 7273 6976 6520        recursive 
+00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003da0: 203a 2062 6f6f 6c20 2020 2020 2020 2020   : bool         
+00003db0: 2020 2020 2020 203d 2046 616c 7365 2c0a         = False,.
+00003dc0: 2020 2020 2020 2020 677a 6970 5365 656b          gzipSeek
+00003dd0: 506f 696e 7453 7061 6369 6e67 2020 2020  PointSpacing    
+00003de0: 2020 203a 2069 6e74 2020 2020 2020 2020     : int        
+00003df0: 2020 2020 2020 2020 203d 2034 2a31 3032           = 4*102
+00003e00: 342a 3130 3234 2c0a 2020 2020 2020 2020  4*1024,.        
+00003e10: 656e 636f 6469 6e67 2020 2020 2020 2020  encoding        
+00003e20: 2020 2020 2020 2020 2020 203a 2073 7472             : str
+00003e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e40: 203d 2074 6172 6669 6c65 2e45 4e43 4f44   = tarfile.ENCOD
+00003e50: 494e 472c 0a20 2020 2020 2020 2073 7472  ING,.        str
+00003e60: 6970 5265 6375 7273 6976 6554 6172 4578  ipRecursiveTarEx
+00003e70: 7465 6e73 696f 6e20 3a20 626f 6f6c 2020  tension : bool  
+00003e80: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00003e90: 4661 6c73 652c 0a20 2020 2020 2020 2069  False,.        i
+00003ea0: 676e 6f72 655a 6572 6f73 2020 2020 2020  gnoreZeros      
+00003eb0: 2020 2020 2020 2020 2020 3a20 626f 6f6c            : bool
+00003ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ed0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00003ee0: 2076 6572 6966 794d 6f64 6966 6963 6174   verifyModificat
+00003ef0: 696f 6e54 696d 6520 2020 2020 3a20 626f  ionTime     : bo
+00003f00: 6f6c 2020 2020 2020 2020 2020 2020 2020  ol              
+00003f10: 2020 3d20 4661 6c73 652c 0a20 2020 2020    = False,.     
+00003f20: 2020 2023 2070 796c 696e 743a 2064 6973     # pylint: dis
+00003f30: 6162 6c65 3d75 6e75 7365 642d 6172 6775  able=unused-argu
+00003f40: 6d65 6e74 0a20 2020 2020 2020 202a 2a6b  ment.        **k
+00003f50: 7761 7267 730a 2020 2020 2020 2020 2320  wargs.        # 
+00003f60: 666d 743a 206f 6e0a 2020 2020 2920 2d3e  fmt: on.    ) ->
+00003f70: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00003f80: 2222 0a20 2020 2020 2020 2074 6172 4669  "".        tarFi
+00003f90: 6c65 4e61 6d65 203a 2050 6174 6820 746f  leName : Path to
+00003fa0: 2074 6865 2054 4152 2066 696c 6520 746f   the TAR file to
+00003fb0: 2062 6520 6f70 656e 6564 2e20 4966 206e   be opened. If n
+00003fc0: 6f74 2073 7065 6369 6669 6564 2c20 6120  ot specified, a 
+00003fd0: 6669 6c65 4f62 6a65 6374 206d 7573 7420  fileObject must 
+00003fe0: 6265 2073 7065 6369 6669 6564 2e0a 2020  be specified..  
+00003ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004000: 2020 2020 4966 206f 6e6c 7920 6120 6669      If only a fi
+00004010: 6c65 4f62 6a65 6374 2069 7320 6769 7665  leObject is give
+00004020: 6e2c 2074 6865 2063 7265 6174 6564 2069  n, the created i
+00004030: 6e64 6578 2063 616e 2774 2062 6520 6361  ndex can't be ca
+00004040: 6368 6564 2028 6566 6669 6369 656e 746c  ched (efficientl
+00004050: 7929 2e0a 2020 2020 2020 2020 6669 6c65  y)..        file
+00004060: 4f62 6a65 6374 203a 2041 2069 6f2e 494f  Object : A io.IO
+00004070: 4261 7365 2064 6572 6976 6564 206f 626a  Base derived obj
+00004080: 6563 742e 2049 6620 6e6f 7420 7370 6563  ect. If not spec
+00004090: 6966 6965 642c 2074 6172 4669 6c65 4e61  ified, tarFileNa
+000040a0: 6d65 2077 696c 6c20 6265 206f 7065 6e65  me will be opene
+000040b0: 642e 0a20 2020 2020 2020 2020 2020 2020  d..             
+000040c0: 2020 2020 2020 2020 4966 2069 7420 6973          If it is
+000040d0: 2061 6e20 696e 7374 616e 6365 206f 6620   an instance of 
+000040e0: 496e 6465 7865 6442 7a69 7032 4669 6c65  IndexedBzip2File
+000040f0: 2c20 496e 6465 7865 6447 7a69 7046 696c  , IndexedGzipFil
+00004100: 652c 206f 7220 496e 6465 7865 645a 7374  e, or IndexedZst
+00004110: 6446 696c 652c 2074 6865 6e20 7468 6520  dFile, then the 
+00004120: 6f66 6673 6574 0a20 2020 2020 2020 2020  offset.         
+00004130: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
+00004140: 696e 6720 616e 6420 7374 6f72 696e 6720  ing and storing 
+00004150: 6672 6f6d 2061 6e64 2074 6f20 7468 6520  from and to the 
+00004160: 5351 4c69 7465 2064 6174 6162 6173 6520  SQLite database 
+00004170: 6973 206d 616e 6167 6564 2061 7574 6f6d  is managed autom
+00004180: 6174 6963 616c 6c79 2062 7920 7468 6973  atically by this
+00004190: 2063 6c61 7373 2e0a 2020 2020 2020 2020   class..        
+000041a0: 7772 6974 6549 6e64 6578 203a 2049 6620  writeIndex : If 
+000041b0: 7472 7565 2c20 7468 656e 2074 6865 2073  true, then the s
+000041c0: 6964 6563 6172 2069 6e64 6578 2066 696c  idecar index fil
+000041d0: 6520 7769 6c6c 2062 6520 7772 6974 7465  e will be writte
+000041e0: 6e20 746f 2061 2073 7569 7461 626c 6520  n to a suitable 
+000041f0: 6c6f 6361 7469 6f6e 2e0a 2020 2020 2020  location..      
+00004200: 2020 636c 6561 7249 6e64 6578 4361 6368    clearIndexCach
+00004210: 6520 3a20 4966 2074 7275 652c 2074 6865  e : If true, the
+00004220: 6e20 6368 6563 6b20 616c 6c20 706f 7373  n check all poss
+00004230: 6962 6c65 2069 6e64 6578 2066 696c 6520  ible index file 
+00004240: 6c6f 6361 7469 6f6e 7320 666f 7220 7468  locations for th
+00004250: 6520 6769 7665 6e20 7461 7246 696c 654e  e given tarFileN
+00004260: 616d 652f 6669 6c65 4f62 6a65 6374 0a20  ame/fileObject. 
+00004270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004280: 2020 2020 2020 2020 2063 6f6d 6269 6e61           combina
+00004290: 7469 6f6e 2061 6e64 2064 656c 6574 6520  tion and delete 
+000042a0: 7468 656d 2e20 5468 6973 2061 6c73 6f20  them. This also 
+000042b0: 696d 706c 6963 6974 6c79 2066 6f72 6365  implicitly force
+000042c0: 7320 6120 7265 6372 6561 7469 6f6e 206f  s a recreation o
+000042d0: 6620 7468 6520 696e 6465 782e 0a20 2020  f the index..   
+000042e0: 2020 2020 2069 6e64 6578 4669 6c65 4e61       indexFileNa
+000042f0: 6d65 203a 2050 6174 6820 746f 2074 6865  me : Path to the
+00004300: 2069 6e64 6578 2066 696c 6520 666f 7220   index file for 
+00004310: 7468 6973 2054 4152 2061 7263 6869 7665  this TAR archive
+00004320: 2e20 5468 6973 2074 616b 6573 2070 7265  . This takes pre
+00004330: 6365 6465 6e63 6520 6f76 6572 2074 6865  cedence over the
+00004340: 2061 7574 6f6d 6174 6963 616c 6c79 0a20   automatically. 
+00004350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004360: 2020 2020 2020 2063 686f 7365 6e20 6c6f         chosen lo
+00004370: 6361 7469 6f6e 732e 0a20 2020 2020 2020  cations..       
+00004380: 2069 6e64 6578 466f 6c64 6572 7320 3a20   indexFolders : 
+00004390: 5370 6563 6966 7920 6f6e 6520 6f72 206d  Specify one or m
+000043a0: 756c 7469 706c 6520 7061 7468 7320 666f  ultiple paths fo
+000043b0: 7220 7374 6f72 696e 6720 2e69 6e64 6578  r storing .index
+000043c0: 2e73 716c 6974 6520 6669 6c65 732e 2050  .sqlite files. P
+000043d0: 6174 6873 2077 696c 6c20 6265 2074 6573  aths will be tes
+000043e0: 7465 6420 666f 720a 2020 2020 2020 2020  ted for.        
+000043f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004400: 7569 7461 6269 6c69 7479 2069 6e20 7468  uitability in th
+00004410: 6520 6769 7665 6e20 6f72 6465 722e 2041  e given order. A
+00004420: 6e20 656d 7074 7920 7061 7468 2077 696c  n empty path wil
+00004430: 6c20 6265 2069 6e74 6572 7072 6574 6564  l be interpreted
+00004440: 2061 7320 7468 6520 6c6f 6361 7469 6f6e   as the location
+00004450: 2069 6e20 7768 6963 680a 2020 2020 2020   in which.      
+00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004470: 2074 6865 2054 4152 2072 6573 6964 6573   the TAR resides
+00004480: 2e20 5468 6973 206f 7665 7272 6964 6573  . This overrides
+00004490: 2074 6865 2064 6566 6175 6c74 2069 6e64   the default ind
+000044a0: 6578 2066 616c 6c62 6163 6b20 666f 6c64  ex fallback fold
+000044b0: 6572 2069 6e20 7e2f 2e72 6174 6172 6d6f  er in ~/.ratarmo
+000044c0: 756e 742e 0a20 2020 2020 2020 2072 6563  unt..        rec
+000044d0: 7572 7369 7665 203a 2049 6620 7472 7565  ursive : If true
+000044e0: 2c20 7468 656e 2054 4152 2066 696c 6573  , then TAR files
+000044f0: 2069 6e73 6964 6520 7468 6973 2061 7263   inside this arc
+00004500: 6869 7665 2077 696c 6c20 6265 2072 6563  hive will be rec
+00004510: 7572 7369 7665 6c79 2061 6e61 6c79 7a65  ursively analyze
+00004520: 6420 616e 6420 6164 6465 6420 746f 2074  d and added to t
+00004530: 6865 2053 514c 6974 650a 2020 2020 2020  he SQLite.      
+00004540: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00004550: 6465 782e 2043 7572 7265 6e74 6c79 2c20  dex. Currently, 
+00004560: 7468 6973 2072 6563 7572 7369 6f6e 2063  this recursion c
+00004570: 616e 206f 6e6c 7920 6272 6561 6b20 7468  an only break th
+00004580: 6520 6f75 7465 726d 6f73 7420 636f 6d70  e outermost comp
+00004590: 7265 7373 696f 6e20 6c61 7965 722e 2049  ression layer. I
+000045a0: 2e65 2e2c 2061 202e 7461 722e 627a 320a  .e., a .tar.bz2.
+000045b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045c0: 2020 2020 6669 6c65 2069 6e73 6964 6520      file inside 
+000045d0: 6120 7461 722e 627a 3220 6669 6c65 2063  a tar.bz2 file c
+000045e0: 616e 206e 6f74 2062 6520 6d6f 756e 7465  an not be mounte
+000045f0: 6420 7265 6375 7273 6976 656c 792e 0a20  d recursively.. 
+00004600: 2020 2020 2020 2067 7a69 7053 6565 6b50         gzipSeekP
+00004610: 6f69 6e74 5370 6163 696e 6720 3a20 5468  ointSpacing : Th
+00004620: 6973 2063 6f6e 7472 6f6c 7320 7468 6520  is controls the 
+00004630: 6672 6571 7565 6e63 7920 6f66 2067 7a69  frequency of gzi
+00004640: 7020 6465 636f 6465 7220 7365 656b 2070  p decoder seek p
+00004650: 6f69 6e74 732c 2073 6565 2069 6e64 6578  oints, see index
+00004660: 6564 5f67 7a69 7020 646f 6375 6d65 6e74  ed_gzip document
+00004670: 6174 696f 6e2e 0a20 2020 2020 2020 2020  ation..         
+00004680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004690: 2020 2020 2020 4c61 7267 6572 2073 7061        Larger spa
+000046a0: 6369 6e67 7320 6c65 6164 2074 6f20 6c65  cings lead to le
+000046b0: 7373 206d 656d 6f72 7920 7573 6167 6520  ss memory usage 
+000046c0: 6275 7420 696e 6372 6561 7365 2074 6865  but increase the
+000046d0: 2063 6f6e 7374 616e 7420 7365 656b 206f   constant seek o
+000046e0: 7665 7268 6561 642e 0a20 2020 2020 2020  verhead..       
+000046f0: 2065 6e63 6f64 696e 6720 3a20 5769 6c6c   encoding : Will
+00004700: 2062 6520 666f 7277 6172 6465 6420 746f   be forwarded to
+00004710: 2074 6172 6669 6c65 2e20 5370 6563 6966   tarfile. Specif
+00004720: 6965 7320 686f 7720 6669 6c65 6e61 6d65  ies how filename
+00004730: 7320 696e 7369 6465 2074 6865 2054 4152  s inside the TAR
+00004740: 2061 7265 2065 6e63 6f64 6564 2e0a 2020   are encoded..  
+00004750: 2020 2020 2020 6967 6e6f 7265 5a65 726f        ignoreZero
+00004760: 7320 3a20 5769 6c6c 2062 6520 666f 7277  s : Will be forw
+00004770: 6172 6465 6420 746f 2074 6172 6669 6c65  arded to tarfile
+00004780: 2e20 5370 6563 6966 6965 7320 746f 206e  . Specifies to n
+00004790: 6f74 206f 6e6c 7920 736b 6970 207a 6572  ot only skip zer
+000047a0: 6f20 626c 6f63 6b73 2062 7574 2061 6c73  o blocks but als
+000047b0: 6f20 626c 6f63 6b73 2077 6974 680a 2020  o blocks with.  
+000047c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047d0: 2020 2020 696e 7661 6c69 6420 6461 7461      invalid data
+000047e0: 2e20 5365 7474 696e 6720 7468 6973 2074  . Setting this t
+000047f0: 6f20 7472 7565 2063 616e 206c 6561 6420  o true can lead 
+00004800: 746f 2073 6f6d 6520 7072 6f62 6c65 6d73  to some problems
+00004810: 2062 7574 2069 7320 7265 7175 6972 6564   but is required
+00004820: 2074 6f20 636f 7272 6563 746c 790a 2020   to correctly.  
+00004830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004840: 2020 2020 7265 6164 2063 6f6e 6361 7465      read concate
+00004850: 6e61 7465 6420 7461 7273 2e0a 2020 2020  nated tars..    
+00004860: 2020 2020 7374 7269 7052 6563 7572 7369      stripRecursi
+00004870: 7665 5461 7245 7874 656e 7369 6f6e 203a  veTarExtension :
+00004880: 2049 6620 7472 7565 2061 6e64 2069 6620   If true and if 
+00004890: 7265 6375 7273 6976 6520 6973 2061 6c73  recursive is als
+000048a0: 6f20 7472 7565 2c20 7468 656e 2061 203c  o true, then a <
+000048b0: 6669 6c65 3e2e 7461 7220 696e 7369 6465  file>.tar inside
+000048c0: 2074 6865 2063 7572 7265 6e74 0a20 2020   the current.   
+000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048f0: 2020 7461 7220 7769 6c6c 2062 6520 6d6f    tar will be mo
+00004900: 756e 7465 6420 6174 203c 6669 6c65 3e2f  unted at <file>/
+00004910: 2069 6e73 7465 6164 206f 6620 3c66 696c   instead of <fil
+00004920: 653e 2e74 6172 2f2e 0a20 2020 2020 2020  e>.tar/..       
+00004930: 2076 6572 6966 794d 6f64 6966 6963 6174   verifyModificat
+00004940: 696f 6e54 696d 6520 3a20 4966 2074 7275  ionTime : If tru
+00004950: 652c 2074 6865 6e20 7468 6520 696e 6465  e, then the inde
+00004960: 7820 7769 6c6c 2062 6520 7265 6372 6561  x will be recrea
+00004970: 7465 6420 6175 746f 6d61 7469 6361 6c6c  ted automaticall
+00004980: 7920 6966 2074 6865 2054 4152 2061 7263  y if the TAR arc
+00004990: 6869 7665 2068 6173 2061 206d 6f72 650a  hive has a more.
+000049a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049c0: 2072 6563 656e 7420 6d6f 6469 6669 6361   recent modifica
+000049d0: 7469 6f6e 2074 696d 6520 7468 616e 2074  tion time than t
+000049e0: 6865 2069 6e64 6578 2066 696c 652e 0a20  he index file.. 
+000049f0: 2020 2020 2020 206b 7761 7267 7320 3a20         kwargs : 
+00004a00: 556e 7573 6564 2e20 4f6e 6c79 2066 6f72  Unused. Only for
+00004a10: 2063 6f6d 7061 7469 6269 6c69 7479 2077   compatibility w
+00004a20: 6974 6820 6765 6e65 7269 6320 4d6f 756e  ith generic Moun
+00004a30: 7453 6f75 7263 6520 696e 7465 7266 6163  tSource interfac
+00004a40: 652e 0a20 2020 2020 2020 2022 2222 0a0a  e..        """..
+00004a50: 2020 2020 2020 2020 2320 7374 6f72 6573          # stores
+00004a60: 2077 6869 6368 2070 6172 656e 7420 666f   which parent fo
+00004a70: 6c64 6572 7320 7765 7265 206c 6173 7420  lders were last 
+00004a80: 7472 6965 6420 746f 2061 6464 2074 6f20  tried to add to 
+00004a90: 6461 7461 6261 7365 2061 6e64 2074 6865  database and the
+00004aa0: 7265 666f 7265 2064 6f20 6578 6973 740a  refore do exist.
+00004ab0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+00004ac0: 656e 7446 6f6c 6465 7243 6163 6865 3a20  entFolderCache: 
+00004ad0: 4c69 7374 5b54 7570 6c65 5b73 7472 2c20  List[Tuple[str, 
+00004ae0: 7374 725d 5d20 3d20 5b5d 0a20 2020 2020  str]] = [].     
+00004af0: 2020 2073 656c 662e 7371 6c43 6f6e 6e65     self.sqlConne
+00004b00: 6374 696f 6e3a 204f 7074 696f 6e61 6c5b  ction: Optional[
+00004b10: 7371 6c69 7465 332e 436f 6e6e 6563 7469  sqlite3.Connecti
+00004b20: 6f6e 5d20 3d20 4e6f 6e65 0a20 2020 2020  on] = None.     
+00004b30: 2020 2073 656c 662e 696e 6465 7846 696c     self.indexFil
+00004b40: 654e 616d 6520 3d20 4e6f 6e65 0a0a 2020  eName = None..  
+00004b50: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
+00004b60: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00004b70: 756e 7452 6563 7572 7369 7665 6c79 2020  untRecursively  
+00004b80: 2020 2020 2020 2020 203d 2072 6563 7572           = recur
+00004b90: 7369 7665 0a20 2020 2020 2020 2073 656c  sive.        sel
+00004ba0: 662e 656e 636f 6469 6e67 2020 2020 2020  f.encoding      
+00004bb0: 2020 2020 2020 2020 2020 2020 203d 2065               = e
+00004bc0: 6e63 6f64 696e 670a 2020 2020 2020 2020  ncoding.        
+00004bd0: 7365 6c66 2e73 7472 6970 5265 6375 7273  self.stripRecurs
+00004be0: 6976 6554 6172 4578 7465 6e73 696f 6e20  iveTarExtension 
+00004bf0: 3d20 7374 7269 7052 6563 7572 7369 7665  = stripRecursive
+00004c00: 5461 7245 7874 656e 7369 6f6e 0a20 2020  TarExtension.   
+00004c10: 2020 2020 2073 656c 662e 6967 6e6f 7265       self.ignore
+00004c20: 5a65 726f 7320 2020 2020 2020 2020 2020  Zeros           
+00004c30: 2020 2020 203d 2069 676e 6f72 655a 6572       = ignoreZer
+00004c40: 6f73 0a20 2020 2020 2020 2073 656c 662e  os.        self.
+00004c50: 7665 7269 6679 4d6f 6469 6669 6361 7469  verifyModificati
+00004c60: 6f6e 5469 6d65 2020 2020 203d 2076 6572  onTime     = ver
+00004c70: 6966 794d 6f64 6966 6963 6174 696f 6e54  ifyModificationT
+00004c80: 696d 650a 2020 2020 2020 2020 7365 6c66  ime.        self
+00004c90: 2e67 7a69 7053 6565 6b50 6f69 6e74 5370  .gzipSeekPointSp
+00004ca0: 6163 696e 6720 2020 2020 2020 3d20 677a  acing       = gz
+00004cb0: 6970 5365 656b 506f 696e 7453 7061 6369  ipSeekPointSpaci
+00004cc0: 6e67 0a20 2020 2020 2020 2023 2066 6d74  ng.        # fmt
+00004cd0: 3a20 6f6e 0a0a 2020 2020 2020 2020 7365  : on..        se
+00004ce0: 6c66 2e74 6172 4669 6c65 4e61 6d65 3a20  lf.tarFileName: 
+00004cf0: 7374 7220 3d20 273c 6669 6c65 206f 626a  str = '<file obj
+00004d00: 6563 743e 270a 2020 2020 2020 2020 6966  ect>'.        if
+00004d10: 206e 6f74 2066 696c 654f 626a 6563 743a   not fileObject:
+00004d20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004d30: 6e6f 7420 7461 7246 696c 654e 616d 653a  not tarFileName:
+00004d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d50: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00004d60: 7228 2241 7420 6c65 6173 7420 6f6e 6520  r("At least one 
+00004d70: 6f66 2074 6172 4669 6c65 4e61 6d65 2061  of tarFileName a
+00004d80: 6e64 2066 696c 654f 626a 6563 7420 6172  nd fileObject ar
+00004d90: 6775 6d65 6e74 7320 7368 6f75 6c64 2062  guments should b
+00004da0: 6520 7365 7421 2229 0a20 2020 2020 2020  e set!").       
+00004db0: 2020 2020 2073 656c 662e 7461 7246 696c       self.tarFil
+00004dc0: 654e 616d 6520 3d20 6f73 2e70 6174 682e  eName = os.path.
+00004dd0: 6162 7370 6174 6828 7461 7246 696c 654e  abspath(tarFileN
+00004de0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00004df0: 2066 696c 654f 626a 6563 7420 3d20 6f70   fileObject = op
+00004e00: 656e 2873 656c 662e 7461 7246 696c 654e  en(self.tarFileN
+00004e10: 616d 652c 2027 7262 2729 0a20 2020 2020  ame, 'rb').     
+00004e20: 2020 2065 6c69 6620 7461 7246 696c 654e     elif tarFileN
+00004e30: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+00004e40: 2023 2049 6620 7461 7246 696c 654e 616d   # If tarFileNam
+00004e50: 6520 7761 7320 7370 6563 6966 6965 6420  e was specified 
+00004e60: 666f 7220 6120 6669 6c65 206f 626a 6563  for a file objec
+00004e70: 742c 2073 6574 2073 656c 662e 7461 7246  t, set self.tarF
+00004e80: 696c 654e 616d 6520 6163 636f 7264 696e  ileName accordin
+00004e90: 676c 792e 0a20 2020 2020 2020 2020 2020  gly..           
+00004ea0: 2073 656c 662e 7461 7246 696c 654e 616d   self.tarFileNam
+00004eb0: 6520 3d20 7461 7246 696c 654e 616d 650a  e = tarFileName.
+00004ec0: 0a20 2020 2020 2020 2066 696c 654f 626a  .        fileObj
+00004ed0: 6563 742e 7365 656b 2830 2c20 696f 2e53  ect.seek(0, io.S
+00004ee0: 4545 4b5f 454e 4429 0a20 2020 2020 2020  EEK_END).       
+00004ef0: 2066 696c 6553 697a 6520 3d20 6669 6c65   fileSize = file
+00004f00: 4f62 6a65 6374 2e74 656c 6c28 290a 2020  Object.tell().  
+00004f10: 2020 2020 2020 6669 6c65 4f62 6a65 6374        fileObject
+00004f20: 2e73 6565 6b28 3029 0a0a 2020 2020 2020  .seek(0)..      
+00004f30: 2020 2320 7261 7746 696c 654f 626a 6563    # rawFileObjec
+00004f40: 7420 3a20 4f6e 6c79 2073 6574 2077 6865  t : Only set whe
+00004f50: 6e20 6f70 656e 696e 6720 6120 636f 6d70  n opening a comp
+00004f60: 7265 7373 6564 2066 696c 6520 616e 6420  ressed file and 
+00004f70: 6f6e 6c79 206b 6570 7420 746f 206b 6565  only kept to kee
+00004f80: 7020 7468 650a 2020 2020 2020 2020 2320  p the.        # 
+00004f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fa0: 636f 6d70 7265 7373 6564 2066 696c 6520  compressed file 
+00004fb0: 6861 6e64 6c65 2066 726f 6d20 6265 696e  handle from bein
+00004fc0: 6720 636c 6f73 6564 2062 7920 7468 6520  g closed by the 
+00004fd0: 6761 7262 6167 6520 636f 6c6c 6563 746f  garbage collecto
+00004fe0: 722e 0a20 2020 2020 2020 2023 2074 6172  r..        # tar
+00004ff0: 4669 6c65 4f62 6a65 6374 203a 2046 696c  FileObject : Fil
+00005000: 6520 6f62 6a65 6374 2074 6f20 7468 6520  e object to the 
+00005010: 756e 636f 6d70 7265 7373 6564 2028 6f72  uncompressed (or
+00005020: 2064 6563 6f6d 7072 6573 7365 6429 2054   decompressed) T
+00005030: 4152 2066 696c 6520 746f 2072 6561 6420  AR file to read 
+00005040: 6163 7475 616c 2064 6174 6120 6f75 7420  actual data out 
+00005050: 6f66 2e0a 2020 2020 2020 2020 2320 636f  of..        # co
+00005060: 6d70 7265 7373 696f 6e20 2020 3a20 5374  mpression   : St
+00005070: 6f72 6573 2077 6861 7420 6b69 6e64 206f  ores what kind o
+00005080: 6620 636f 6d70 7265 7373 696f 6e20 7468  f compression th
+00005090: 6520 6f72 6967 696e 616c 6c79 2073 7065  e originally spe
+000050a0: 6369 6669 6564 2054 4152 2066 696c 6520  cified TAR file 
+000050b0: 7573 6573 2e0a 2020 2020 2020 2020 2320  uses..        # 
+000050c0: 6973 5461 7220 2020 2020 2020 2020 3a20  isTar         : 
+000050d0: 4361 6e20 6265 2066 616c 7365 2066 6f72  Can be false for
+000050e0: 2074 6865 2064 6567 656e 6572 6174 6564   the degenerated
+000050f0: 2063 6173 6520 6f66 206f 6e6c 7920 6120   case of only a 
+00005100: 627a 3220 6f72 2067 7a20 6669 6c65 206e  bz2 or gz file n
+00005110: 6f74 2063 6f6e 7461 696e 696e 6720 6120  ot containing a 
+00005120: 5441 520a 2020 2020 2020 2020 7365 6c66  TAR.        self
+00005130: 2e74 6172 4669 6c65 4f62 6a65 6374 2c20  .tarFileObject, 
+00005140: 7365 6c66 2e72 6177 4669 6c65 4f62 6a65  self.rawFileObje
+00005150: 6374 2c20 7365 6c66 2e63 6f6d 7072 6573  ct, self.compres
+00005160: 7369 6f6e 2c20 7365 6c66 2e69 7354 6172  sion, self.isTar
+00005170: 203d 2053 514c 6974 6549 6e64 6578 6564   = SQLiteIndexed
+00005180: 5461 722e 5f6f 7065 6e43 6f6d 7072 6573  Tar._openCompres
+00005190: 7365 6446 696c 6528 0a20 2020 2020 2020  sedFile(.       
+000051a0: 2020 2020 2066 696c 654f 626a 6563 742c       fileObject,
+000051b0: 2067 7a69 7053 6565 6b50 6f69 6e74 5370   gzipSeekPointSp
+000051c0: 6163 696e 672c 2065 6e63 6f64 696e 670a  acing, encoding.
+000051d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000051e0: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
+000051f0: 5461 7220 616e 6420 6e6f 7420 7365 6c66  Tar and not self
+00005200: 2e72 6177 4669 6c65 4f62 6a65 6374 3a0a  .rawFileObject:.
+00005210: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005220: 6520 5261 7461 726d 6f75 6e74 4572 726f  e RatarmountErro
+00005230: 7228 2246 696c 6520 6f62 6a65 6374 2028  r("File object (
+00005240: 2220 2b20 7374 7228 6669 6c65 4f62 6a65  " + str(fileObje
+00005250: 6374 2920 2b20 2229 2063 6f75 6c64 206e  ct) + ") could n
+00005260: 6f74 2062 6520 6f70 656e 6564 2061 7320  ot be opened as 
+00005270: 6120 5441 5220 6669 6c65 2122 290a 0a20  a TAR file!").. 
+00005280: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00005290: 6f6d 7072 6573 7369 6f6e 203d 3d20 2778  ompression == 'x
+000052a0: 7a27 3a0a 2020 2020 2020 2020 2020 2020  z':.            
+000052b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000052c0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+000052d0: 2e74 6172 4669 6c65 4f62 6a65 6374 2e62  .tarFileObject.b
+000052e0: 6c6f 636b 5f62 6f75 6e64 6172 6965 7329  lock_boundaries)
+000052f0: 203c 3d20 3120 616e 6420 2866 696c 6553   <= 1 and (fileS
+00005300: 697a 6520 6973 204e 6f6e 6520 6f72 2066  ize is None or f
+00005310: 696c 6553 697a 6520 3e20 3130 3234 202a  ileSize > 1024 *
+00005320: 2031 3032 3429 3a0a 2020 2020 2020 2020   1024):.        
+00005330: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00005340: 7428 225b 5761 726e 696e 675d 2054 6865  t("[Warning] The
+00005350: 2073 7065 6369 6669 6564 2066 696c 6520   specified file 
+00005360: 277b 7d27 222e 666f 726d 6174 2873 656c  '{}'".format(sel
+00005370: 662e 7461 7246 696c 654e 616d 6529 290a  f.tarFileName)).
+00005380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005390: 2020 2020 7072 696e 7428 225b 5761 726e      print("[Warn
+000053a0: 696e 675d 2069 7320 636f 6d70 7265 7373  ing] is compress
+000053b0: 6564 2075 7369 6e67 2078 7a20 6275 7420  ed using xz but 
+000053c0: 6f6e 6c79 2063 6f6e 7461 696e 7320 6f6e  only contains on
+000053d0: 6520 787a 2062 6c6f 636b 2e20 5468 6973  e xz block. This
+000053e0: 206d 616b 6573 2069 7420 2229 0a20 2020   makes it ").   
+000053f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005400: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+00005410: 5d20 696d 706f 7373 6962 6c65 2074 6f20  ] impossible to 
+00005420: 7573 6520 7472 7565 2073 6565 6b69 6e67  use true seeking
+00005430: 2120 506c 6561 7365 2028 7265 2963 6f6d  ! Please (re)com
+00005440: 7072 6573 7320 796f 7572 2054 4152 2075  press your TAR u
+00005450: 7369 6e67 2070 6978 7a22 290a 2020 2020  sing pixz").    
+00005460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005470: 7072 696e 7428 225b 5761 726e 696e 675d  print("[Warning]
+00005480: 2028 7365 6520 6874 7470 733a 2f2f 6769   (see https://gi
+00005490: 7468 7562 2e63 6f6d 2f76 6173 692f 7069  thub.com/vasi/pi
+000054a0: 787a 2920 696e 206f 7264 6572 2066 6f72  xz) in order for
+000054b0: 2072 6174 6172 6d6f 756e 7420 746f 2064   ratarmount to d
+000054c0: 6f20 6265 2061 626c 6520 2229 0a20 2020  o be able ").   
+000054d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054e0: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+000054f0: 5d20 746f 2064 6f20 6661 7374 2073 6565  ] to do fast see
+00005500: 6b69 6e67 2074 6f20 7265 7175 6573 7465  king to requeste
+00005510: 6420 6669 6c65 732e 2229 0a20 2020 2020  d files.").     
+00005520: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00005530: 7269 6e74 2822 5b57 6172 6e69 6e67 5d20  rint("[Warning] 
+00005540: 4173 2069 7420 6973 2c20 6561 6368 2066  As it is, each f
+00005550: 696c 6520 6163 6365 7373 2077 696c 6c20  ile access will 
+00005560: 6465 636f 6d70 7265 7373 2074 6865 2077  decompress the w
+00005570: 686f 6c65 2054 4152 2066 726f 6d20 7468  hole TAR from th
+00005580: 6520 6265 6769 6e6e 696e 6721 2229 0a20  e beginning!"). 
+00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055a0: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
+000055b0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000055c0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+000055d0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+000055e0: 2020 2020 2020 2069 6620 6e6f 7420 7461         if not ta
+000055f0: 7246 696c 654e 616d 653a 0a20 2020 2020  rFileName:.     
+00005600: 2020 2020 2020 2073 656c 662e 5f63 7265         self._cre
+00005610: 6174 6549 6e64 6578 2873 656c 662e 7461  ateIndex(self.ta
+00005620: 7246 696c 654f 626a 6563 7429 0a20 2020  rFileObject).   
+00005630: 2020 2020 2020 2020 2023 2072 6574 7572           # retur
+00005640: 6e20 6865 7265 2062 6563 6175 7365 2077  n here because w
+00005650: 6520 6361 6e27 7420 6669 6e64 2061 2073  e can't find a s
+00005660: 6176 6520 6c6f 6361 7469 6f6e 2077 6974  ave location wit
+00005670: 686f 7574 2061 6e79 2069 6465 6e74 6966  hout any identif
+00005680: 7969 6e67 206e 616d 650a 2020 2020 2020  ying name.      
+00005690: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+000056a0: 2020 2020 2020 2320 7769 6c6c 2062 6520        # will be 
+000056b0: 7573 6564 2066 6f72 2073 746f 7269 6e67  used for storing
+000056c0: 2069 6e64 6578 6573 2069 6620 6375 7272   indexes if curr
+000056d0: 656e 7420 7061 7468 2069 7320 7265 6164  ent path is read
+000056e0: 2d6f 6e6c 790a 2020 2020 2020 2020 706f  -only.        po
+000056f0: 7373 6962 6c65 496e 6465 7846 696c 6550  ssibleIndexFileP
+00005700: 6174 6873 203d 205b 7365 6c66 2e74 6172  aths = [self.tar
+00005710: 4669 6c65 4e61 6d65 202b 2022 2e69 6e64  FileName + ".ind
+00005720: 6578 2e73 716c 6974 6522 5d0a 2020 2020  ex.sqlite"].    
+00005730: 2020 2020 696e 6465 7850 6174 6841 734e      indexPathAsN
+00005740: 616d 6520 3d20 7365 6c66 2e74 6172 4669  ame = self.tarFi
+00005750: 6c65 4e61 6d65 2e72 6570 6c61 6365 2822  leName.replace("
+00005760: 2f22 2c20 225f 2229 202b 2022 2e69 6e64  /", "_") + ".ind
+00005770: 6578 2e73 716c 6974 6522 0a20 2020 2020  ex.sqlite".     
+00005780: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00005790: 2869 6e64 6578 466f 6c64 6572 732c 2073  (indexFolders, s
+000057a0: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+000057b0: 2069 6e64 6578 466f 6c64 6572 7320 3d20   indexFolders = 
+000057c0: 5b69 6e64 6578 466f 6c64 6572 735d 0a0a  [indexFolders]..
+000057d0: 2020 2020 2020 2020 2320 4120 6769 7665          # A give
+000057e0: 6e20 696e 6465 7820 6669 6c65 206e 616d  n index file nam
+000057f0: 6520 7461 6b65 7320 7072 6563 6564 656e  e takes preceden
+00005800: 6365 2061 6e64 2074 6865 7265 2073 686f  ce and there sho
+00005810: 756c 6420 6265 206e 6f20 696d 706c 6963  uld be no implic
+00005820: 6974 2066 616c 6c62 6163 6b0a 2020 2020  it fallback.    
+00005830: 2020 2020 6966 2069 6e64 6578 4669 6c65      if indexFile
+00005840: 4e61 6d65 3a0a 2020 2020 2020 2020 2020  Name:.          
+00005850: 2020 6966 2069 6e64 6578 4669 6c65 4e61    if indexFileNa
+00005860: 6d65 203d 3d20 273a 6d65 6d6f 7279 3a27  me == ':memory:'
+00005870: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005880: 2020 706f 7373 6962 6c65 496e 6465 7846    possibleIndexF
+00005890: 696c 6550 6174 6873 203d 205b 696e 6465  ilePaths = [inde
+000058a0: 7846 696c 654e 616d 655d 0a20 2020 2020  xFileName].     
+000058b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000058c0: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+000058d0: 7369 626c 6549 6e64 6578 4669 6c65 5061  sibleIndexFilePa
+000058e0: 7468 7320 3d20 5b6f 732e 7061 7468 2e61  ths = [os.path.a
+000058f0: 6273 7061 7468 286f 732e 7061 7468 2e65  bspath(os.path.e
+00005900: 7870 616e 6475 7365 7228 696e 6465 7846  xpanduser(indexF
+00005910: 696c 654e 616d 6529 295d 0a20 2020 2020  ileName))].     
+00005920: 2020 2065 6c69 6620 696e 6465 7846 6f6c     elif indexFol
+00005930: 6465 7273 3a0a 2020 2020 2020 2020 2020  ders:.          
+00005940: 2020 2320 416e 2065 6d70 7479 2070 6174    # An empty pat
+00005950: 6820 6973 2074 6f20 6265 2069 6e74 6572  h is to be inter
+00005960: 7072 6574 6564 2061 7320 7468 6520 6465  preted as the de
+00005970: 6661 756c 7420 7061 7468 2072 6967 6874  fault path right
+00005980: 2062 6573 6964 6573 2074 6865 2054 4152   besides the TAR
+00005990: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000059a0: 2727 206e 6f74 2069 6e20 696e 6465 7846  '' not in indexF
+000059b0: 6f6c 6465 7273 3a0a 2020 2020 2020 2020  olders:.        
+000059c0: 2020 2020 2020 2020 706f 7373 6962 6c65          possible
+000059d0: 496e 6465 7846 696c 6550 6174 6873 203d  IndexFilePaths =
+000059e0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+000059f0: 666f 7220 666f 6c64 6572 2069 6e20 696e  for folder in in
+00005a00: 6465 7846 6f6c 6465 7273 3a0a 2020 2020  dexFolders:.    
+00005a10: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00005a20: 6f6c 6465 723a 0a20 2020 2020 2020 2020  older:.         
+00005a30: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00005a40: 5061 7468 203d 206f 732e 7061 7468 2e6a  Path = os.path.j
+00005a50: 6f69 6e28 666f 6c64 6572 2c20 696e 6465  oin(folder, inde
+00005a60: 7850 6174 6841 734e 616d 6529 0a20 2020  xPathAsName).   
+00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a80: 2070 6f73 7369 626c 6549 6e64 6578 4669   possibleIndexFi
+00005a90: 6c65 5061 7468 732e 6170 7065 6e64 286f  lePaths.append(o
+00005aa0: 732e 7061 7468 2e61 6273 7061 7468 286f  s.path.abspath(o
+00005ab0: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+00005ac0: 7228 696e 6465 7850 6174 6829 2929 0a0a  r(indexPath)))..
+00005ad0: 2020 2020 2020 2020 6966 2063 6c65 6172          if clear
+00005ae0: 496e 6465 7843 6163 6865 3a0a 2020 2020  IndexCache:.    
+00005af0: 2020 2020 2020 2020 666f 7220 696e 6465          for inde
+00005b00: 7850 6174 6820 696e 2070 6f73 7369 626c  xPath in possibl
+00005b10: 6549 6e64 6578 4669 6c65 5061 7468 733a  eIndexFilePaths:
+00005b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005b30: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+00005b40: 6c65 2869 6e64 6578 5061 7468 293a 0a20  le(indexPath):. 
+00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b60: 2020 206f 732e 7265 6d6f 7665 2869 6e64     os.remove(ind
+00005b70: 6578 5061 7468 290a 0a20 2020 2020 2020  exPath)..       
+00005b80: 2023 2054 7279 2074 6f20 6669 6e64 2061   # Try to find a
+00005b90: 6e20 616c 7265 6164 7920 6578 6973 7469  n already existi
+00005ba0: 6e67 2069 6e64 6578 0a20 2020 2020 2020  ng index.       
+00005bb0: 2066 6f72 2069 6e64 6578 5061 7468 2069   for indexPath i
+00005bc0: 6e20 706f 7373 6962 6c65 496e 6465 7846  n possibleIndexF
+00005bd0: 696c 6550 6174 6873 3a0a 2020 2020 2020  ilePaths:.      
+00005be0: 2020 2020 2020 6966 2073 656c 662e 5f74        if self._t
+00005bf0: 7279 4c6f 6164 496e 6465 7828 696e 6465  ryLoadIndex(inde
+00005c00: 7850 6174 6829 3a0a 2020 2020 2020 2020  xPath):.        
+00005c10: 2020 2020 2020 2020 7365 6c66 2e69 6e64          self.ind
+00005c20: 6578 4669 6c65 4e61 6d65 203d 2069 6e64  exFileName = ind
+00005c30: 6578 5061 7468 0a20 2020 2020 2020 2020  exPath.         
+00005c40: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00005c50: 2020 2020 2069 6620 7365 6c66 2e69 6e64       if self.ind
+00005c60: 6578 4973 4c6f 6164 6564 2829 2061 6e64  exIsLoaded() and
+00005c70: 2073 656c 662e 7371 6c43 6f6e 6e65 6374   self.sqlConnect
+00005c80: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00005c90: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00005ca0: 2020 2020 2020 696e 6465 7856 6572 7369        indexVersi
+00005cb0: 6f6e 203d 2073 656c 662e 7371 6c43 6f6e  on = self.sqlCon
+00005cc0: 6e65 6374 696f 6e2e 6578 6563 7574 6528  nection.execute(
+00005cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005ce0: 2020 2020 2022 5345 4c45 4354 206d 616a       "SELECT maj
+00005cf0: 6f72 2c6d 696e 6f72 2046 524f 4d20 7665  or,minor FROM ve
+00005d00: 7273 696f 6e73 2057 4845 5245 206e 616d  rsions WHERE nam
+00005d10: 6520 3d3d 2027 696e 6465 7827 3b22 0a20  e == 'index';". 
+00005d20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00005d30: 2e66 6574 6368 6f6e 6528 290a 0a20 2020  .fetchone()..   
+00005d40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00005d50: 696e 6465 7856 6572 7369 6f6e 2061 6e64  indexVersion and
+00005d60: 2069 6e64 6578 5665 7273 696f 6e20 3e20   indexVersion > 
+00005d70: 5f5f 7665 7273 696f 6e5f 5f3a 0a20 2020  __version__:.   
+00005d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d90: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+00005da0: 5d20 5468 6520 6c6f 6164 6564 2069 6e64  ] The loaded ind
+00005db0: 6578 2077 6173 2063 7265 6174 6564 2077  ex was created w
+00005dc0: 6974 6820 6120 6e65 7765 7220 7665 7273  ith a newer vers
+00005dd0: 696f 6e20 6f66 2072 6174 6172 6d6f 756e  ion of ratarmoun
+00005de0: 742e 2229 0a20 2020 2020 2020 2020 2020  t.").           
+00005df0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00005e00: 5b57 6172 6e69 6e67 5d20 4966 2074 6865  [Warning] If the
+00005e10: 7265 2061 7265 2061 6e79 2070 726f 626c  re are any probl
+00005e20: 656d 732c 2070 6c65 6173 6520 7570 6461  ems, please upda
+00005e30: 7465 2072 6174 6172 6d6f 756e 7420 6f72  te ratarmount or
+00005e40: 2072 6563 7265 6174 6520 7468 6520 696e   recreate the in
+00005e50: 6465 7822 290a 2020 2020 2020 2020 2020  dex").          
+00005e60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00005e70: 225b 5761 726e 696e 675d 2077 6974 6820  "[Warning] with 
+00005e80: 7468 6973 2072 6174 6172 6d6f 756e 7420  this ratarmount 
+00005e90: 7665 7273 696f 6e20 7573 696e 6720 7468  version using th
+00005ea0: 6520 2d2d 7265 6372 6561 7465 2d69 6e64  e --recreate-ind
+00005eb0: 6578 206f 7074 696f 6e21 2229 0a20 2020  ex option!").   
+00005ec0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00005ed0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00005ee0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00005ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005f00: 662e 5f6c 6f61 644f 7253 746f 7265 436f  f._loadOrStoreCo
+00005f10: 6d70 7265 7373 696f 6e4f 6666 7365 7473  mpressionOffsets
+00005f20: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00005f30: 656c 662e 5f72 656c 6f61 6449 6e64 6578  elf._reloadIndex
+00005f40: 5265 6164 4f6e 6c79 2829 0a20 2020 2020  ReadOnly().     
+00005f50: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+00005f60: 2020 2020 2020 2023 2046 696e 6420 6120         # Find a 
+00005f70: 7375 6974 6162 6c65 2028 7772 6974 6162  suitable (writab
+00005f80: 6c65 2920 6c6f 6361 7469 6f6e 2066 6f72  le) location for
+00005f90: 2074 6865 2069 6e64 6578 2064 6174 6162   the index datab
+00005fa0: 6173 650a 2020 2020 2020 2020 6966 2077  ase.        if w
+00005fb0: 7269 7465 496e 6465 783a 0a20 2020 2020  riteIndex:.     
+00005fc0: 2020 2020 2020 2066 6f72 2069 6e64 6578         for index
+00005fd0: 5061 7468 2069 6e20 706f 7373 6962 6c65  Path in possible
+00005fe0: 496e 6465 7846 696c 6550 6174 6873 3a0a  IndexFilePaths:.
+00005ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006000: 6966 2073 656c 662e 5f70 6174 6849 7357  if self._pathIsW
+00006010: 7269 7461 626c 6528 696e 6465 7850 6174  ritable(indexPat
+00006020: 6829 2061 6e64 2073 656c 662e 5f70 6174  h) and self._pat
+00006030: 6843 616e 4265 5573 6564 466f 7253 716c  hCanBeUsedForSql
+00006040: 6974 6528 696e 6465 7850 6174 6829 3a0a  ite(indexPath):.
+00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006060: 2020 2020 7365 6c66 2e69 6e64 6578 4669      self.indexFi
+00006070: 6c65 4e61 6d65 203d 2069 6e64 6578 5061  leName = indexPa
+00006080: 7468 0a20 2020 2020 2020 2020 2020 2020  th.             
+00006090: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+000060a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000060b0: 2073 656c 662e 696e 6465 7846 696c 654e   self.indexFileN
+000060c0: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+000060d0: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
+000060e0: 6964 496e 6465 7845 7272 6f72 280a 2020  idIndexError(.  
+000060f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006100: 2020 2243 6f75 6c64 206e 6f74 2066 696e    "Could not fin
+00006110: 6420 616e 7920 6578 6973 7469 6e67 2069  d any existing i
+00006120: 6e64 6578 206f 7220 7772 6974 6162 6c65  ndex or writable
+00006130: 206c 6f63 6174 696f 6e20 666f 7220 616e   location for an
+00006140: 2069 6e64 6578 2069 6e20 220a 2020 2020   index in ".    
+00006150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006160: 2b20 7374 7228 706f 7373 6962 6c65 496e  + str(possibleIn
+00006170: 6465 7846 696c 6550 6174 6873 290a 2020  dexFilePaths).  
+00006180: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00006190: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+000061a0: 7265 6174 6549 6e64 6578 2873 656c 662e  reateIndex(self.
+000061b0: 7461 7246 696c 654f 626a 6563 7429 0a20  tarFileObject). 
+000061c0: 2020 2020 2020 2073 656c 662e 5f6c 6f61         self._loa
+000061d0: 644f 7253 746f 7265 436f 6d70 7265 7373  dOrStoreCompress
+000061e0: 696f 6e4f 6666 7365 7473 2829 2020 2320  ionOffsets()  # 
+000061f0: 7374 6f72 650a 2020 2020 2020 2020 6966  store.        if
+00006200: 2073 656c 662e 7371 6c43 6f6e 6e65 6374   self.sqlConnect
+00006210: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00006220: 2073 656c 662e 5f73 746f 7265 4d65 7461   self._storeMeta
+00006230: 6461 7461 2873 656c 662e 7371 6c43 6f6e  data(self.sqlCon
+00006240: 6e65 6374 696f 6e29 0a20 2020 2020 2020  nection).       
+00006250: 2020 2020 2073 656c 662e 5f72 656c 6f61       self._reloa
+00006260: 6449 6e64 6578 5265 6164 4f6e 6c79 2829  dIndexReadOnly()
+00006270: 0a0a 2020 2020 2020 2020 6966 2070 7269  ..        if pri
+00006280: 6e74 4465 6275 6720 3e3d 2031 2061 6e64  ntDebug >= 1 and
+00006290: 2073 656c 662e 696e 6465 7846 696c 654e   self.indexFileN
+000062a0: 616d 6520 616e 6420 6f73 2e70 6174 682e  ame and os.path.
+000062b0: 6973 6669 6c65 2873 656c 662e 696e 6465  isfile(self.inde
+000062c0: 7846 696c 654e 616d 6529 3a0a 2020 2020  xFileName):.    
+000062d0: 2020 2020 2020 2020 2320 5468 6520 302d          # The 0-
+000062e0: 7469 6d65 2069 7320 6c65 6761 6379 2066  time is legacy f
+000062f0: 6f72 2074 6865 2061 7574 6f6d 6174 6564  or the automated
+00006300: 2074 6573 7473 0a20 2020 2020 2020 2020   tests.         
+00006310: 2020 2023 2066 6d74 3a20 6f66 660a 2020     # fmt: off.  
+00006320: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00006330: 2257 7269 7469 6e67 206f 7574 2054 4152  "Writing out TAR
+00006340: 2069 6e64 6578 2074 6f22 2c20 7365 6c66   index to", self
+00006350: 2e69 6e64 6578 4669 6c65 4e61 6d65 2c20  .indexFileName, 
+00006360: 2274 6f6f 6b20 3073 222c 0a20 2020 2020  "took 0s",.     
+00006370: 2020 2020 2020 2020 2020 2020 2022 616e               "an
+00006380: 6420 6973 2073 697a 6564 222c 206f 732e  d is sized", os.
+00006390: 7374 6174 2820 7365 6c66 2e69 6e64 6578  stat( self.index
+000063a0: 4669 6c65 4e61 6d65 2029 2e73 745f 7369  FileName ).st_si
+000063b0: 7a65 2c20 2242 2229 0a20 2020 2020 2020  ze, "B").       
+000063c0: 2020 2020 2023 2066 6d74 3a20 6f6e 0a0a       # fmt: on..
+000063d0: 2020 2020 6465 6620 5f5f 656e 7465 725f      def __enter_
+000063e0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+000063f0: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+00006400: 2020 6465 6620 5f5f 6578 6974 5f5f 2873    def __exit__(s
+00006410: 656c 662c 2065 7863 6570 7469 6f6e 5f74  elf, exception_t
+00006420: 7970 652c 2065 7863 6570 7469 6f6e 5f76  ype, exception_v
+00006430: 616c 7565 2c20 6578 6365 7074 696f 6e5f  alue, exception_
+00006440: 7472 6163 6562 6163 6b29 3a0a 2020 2020  traceback):.    
+00006450: 2020 2020 6966 2073 656c 662e 7371 6c43      if self.sqlC
+00006460: 6f6e 6e65 6374 696f 6e3a 0a20 2020 2020  onnection:.     
+00006470: 2020 2020 2020 2073 656c 662e 7371 6c43         self.sqlC
+00006480: 6f6e 6e65 6374 696f 6e2e 636f 6d6d 6974  onnection.commit
+00006490: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+000064a0: 656c 662e 7371 6c43 6f6e 6e65 6374 696f  elf.sqlConnectio
+000064b0: 6e2e 636c 6f73 6528 290a 0a20 2020 2020  n.close()..     
+000064c0: 2020 2069 6620 7365 6c66 2e74 6172 4669     if self.tarFi
+000064d0: 6c65 4f62 6a65 6374 3a0a 2020 2020 2020  leObject:.      
+000064e0: 2020 2020 2020 7365 6c66 2e74 6172 4669        self.tarFi
+000064f0: 6c65 4f62 6a65 6374 2e63 6c6f 7365 2829  leObject.close()
+00006500: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00006510: 662e 7261 7746 696c 654f 626a 6563 743a  f.rawFileObject:
+00006520: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006530: 662e 7461 7246 696c 654f 626a 6563 742e  f.tarFileObject.
+00006540: 636c 6f73 6528 290a 0a20 2020 2064 6566  close()..    def
+00006550: 205f 7374 6f72 654d 6574 6164 6174 6128   _storeMetadata(
+00006560: 7365 6c66 2c20 636f 6e6e 6563 7469 6f6e  self, connection
+00006570: 3a20 7371 6c69 7465 332e 436f 6e6e 6563  : sqlite3.Connec
+00006580: 7469 6f6e 2920 2d3e 204e 6f6e 653a 0a20  tion) -> None:. 
+00006590: 2020 2020 2020 2073 656c 662e 5f73 746f         self._sto
+000065a0: 7265 5665 7273 696f 6e73 4d65 7461 6461  reVersionsMetada
+000065b0: 7461 2863 6f6e 6e65 6374 696f 6e29 0a0a  ta(connection)..
+000065c0: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+000065d0: 5461 626c 6520 3d20 2222 220a 2020 2020  Table = """.    
+000065e0: 2020 2020 2020 2020 2f2a 2065 6d70 7479          /* empty
+000065f0: 2074 6162 6c65 2077 686f 7365 2073 6f6c   table whose sol
+00006600: 6520 6578 6973 7465 6e63 6520 7370 6563  e existence spec
+00006610: 6966 6965 7320 7468 6174 2077 6520 6669  ifies that we fi
+00006620: 6e69 7368 6564 2069 7465 7261 7469 6e67  nished iterating
+00006630: 2074 6865 2074 6172 202a 2f0a 2020 2020   the tar */.    
+00006640: 2020 2020 2020 2020 4352 4541 5445 2054          CREATE T
+00006650: 4142 4c45 2022 6d65 7461 6461 7461 2220  ABLE "metadata" 
+00006660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00006670: 2020 226b 6579 2220 2020 2020 2056 4152    "key"      VAR
+00006680: 4348 4152 2836 3535 3335 2920 4e4f 5420  CHAR(65535) NOT 
+00006690: 4e55 4c4c 2c20 2f2a 2065 2e67 2e20 2274  NULL, /* e.g. "t
+000066a0: 6172 7369 7a65 2220 2a2f 0a20 2020 2020  arsize" */.     
+000066b0: 2020 2020 2020 2020 2020 2022 7661 6c75             "valu
+000066c0: 6522 2020 2020 5641 5243 4841 5228 3635  e"    VARCHAR(65
+000066d0: 3533 3529 204e 4f54 204e 554c 4c20 202f  535) NOT NULL  /
+000066e0: 2a20 652e 672e 2073 697a 6520 696e 2062  * e.g. size in b
+000066f0: 7974 6573 2061 7320 696e 7465 6765 7220  ytes as integer 
+00006700: 2a2f 0a20 2020 2020 2020 2020 2020 2029  */.            )
+00006710: 3b0a 2020 2020 2020 2020 2222 220a 0a20  ;.        """.. 
+00006720: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00006730: 6e2e 6578 6563 7574 6573 6372 6970 7428  n.executescript(
+00006740: 6d65 7461 6461 7461 5461 626c 6529 0a0a  metadataTable)..
+00006750: 2020 2020 2020 2020 2320 416c 6c20 6f66          # All of
+00006760: 2074 6865 7365 2072 6571 7569 7265 2074   these require t
+00006770: 6865 2067 656e 6572 6963 2022 6d65 7461  he generic "meta
+00006780: 6461 7461 2220 7461 626c 652e 0a20 2020  data" table..   
+00006790: 2020 2020 2073 656c 662e 5f73 746f 7265       self._store
+000067a0: 5461 724d 6574 6164 6174 6128 636f 6e6e  TarMetadata(conn
+000067b0: 6563 7469 6f6e 2c20 7365 6c66 2e74 6172  ection, self.tar
+000067c0: 4669 6c65 4e61 6d65 290a 2020 2020 2020  FileName).      
+000067d0: 2020 7365 6c66 2e5f 7374 6f72 6541 7267    self._storeArg
+000067e0: 756d 656e 7473 4d65 7461 6461 7461 2863  umentsMetadata(c
+000067f0: 6f6e 6e65 6374 696f 6e29 0a20 2020 2020  onnection).     
+00006800: 2020 2063 6f6e 6e65 6374 696f 6e2e 636f     connection.co
+00006810: 6d6d 6974 2829 0a0a 2020 2020 4073 7461  mmit()..    @sta
+00006820: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+00006830: 6620 5f73 746f 7265 5665 7273 696f 6e73  f _storeVersions
+00006840: 4d65 7461 6461 7461 2863 6f6e 6e65 6374  Metadata(connect
+00006850: 696f 6e3a 2073 716c 6974 6533 2e43 6f6e  ion: sqlite3.Con
+00006860: 6e65 6374 696f 6e29 202d 3e20 4e6f 6e65  nection) -> None
+00006870: 3a0a 2020 2020 2020 2020 7665 7273 696f  :.        versio
+00006880: 6e73 5461 626c 6520 3d20 2222 220a 2020  nsTable = """.  
+00006890: 2020 2020 2020 2020 2020 2f2a 2054 6869            /* Thi
+000068a0: 7320 7461 626c 6527 7320 736f 6c65 2065  s table's sole e
+000068b0: 7869 7374 656e 6365 2073 7065 6369 6669  xistence specifi
+000068c0: 6573 2074 6861 7420 7765 2066 696e 6973  es that we finis
+000068d0: 6865 6420 6974 6572 6174 696e 6720 7468  hed iterating th
+000068e0: 6520 7461 7220 666f 7220 6f6c 6465 7220  e tar for older 
+000068f0: 7261 7461 726d 6f75 6e74 2076 6572 7369  ratarmount versi
+00006900: 6f6e 7320 2a2f 0a20 2020 2020 2020 2020  ons */.         
+00006910: 2020 2043 5245 4154 4520 5441 424c 4520     CREATE TABLE 
+00006920: 2276 6572 7369 6f6e 7322 2028 0a20 2020  "versions" (.   
+00006930: 2020 2020 2020 2020 2020 2020 2022 6e61               "na
+00006940: 6d65 2220 2020 2020 5641 5243 4841 5228  me"     VARCHAR(
+00006950: 3635 3533 3529 204e 4f54 204e 554c 4c2c  65535) NOT NULL,
+00006960: 202f 2a20 7768 6963 6820 636f 6d70 6f6e   /* which compon
+00006970: 656e 7420 7468 6520 7665 7273 696f 6e20  ent the version 
+00006980: 6265 6c6f 6e67 7320 746f 202a 2f0a 2020  belongs to */.  
+00006990: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+000069a0: 6572 7369 6f6e 2220 2056 4152 4348 4152  ersion"  VARCHAR
+000069b0: 2836 3535 3335 2920 4e4f 5420 4e55 4c4c  (65535) NOT NULL
+000069c0: 2c20 2f2a 2066 7265 6520 666f 726d 2076  , /* free form v
+000069d0: 6572 7369 6f6e 2073 7472 696e 6720 2a2f  ersion string */
+000069e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000069f0: 202f 2a20 5365 6d61 6e74 6963 2056 6572   /* Semantic Ver
+00006a00: 7369 6f6e 696e 6720 322e 302e 3020 2873  sioning 2.0.0 (s
+00006a10: 656d 7665 722e 6f72 6729 2070 6172 7473  emver.org) parts
+00006a20: 2069 6620 7468 6579 2063 616e 2062 6520   if they can be 
+00006a30: 7370 6563 6966 6965 643a 0a20 2020 2020  specified:.     
+00006a40: 2020 2020 2020 2020 2020 2020 2a20 2020              *   
+00006a50: 4d41 4a4f 5220 7665 7273 696f 6e20 7768  MAJOR version wh
+00006a60: 656e 2079 6f75 206d 616b 6520 696e 636f  en you make inco
+00006a70: 6d70 6174 6962 6c65 2041 5049 2063 6861  mpatible API cha
+00006a80: 6e67 6573 2c0a 2020 2020 2020 2020 2020  nges,.          
+00006a90: 2020 2020 2020 202a 2020 204d 494e 4f52         *   MINOR
+00006aa0: 2076 6572 7369 6f6e 2077 6865 6e20 796f   version when yo
+00006ab0: 7520 6164 6420 6675 6e63 7469 6f6e 616c  u add functional
+00006ac0: 6974 7920 696e 2061 2062 6163 6b77 6172  ity in a backwar
+00006ad0: 6473 2063 6f6d 7061 7469 626c 6520 6d61  ds compatible ma
+00006ae0: 6e6e 6572 2c20 616e 640a 2020 2020 2020  nner, and.      
+00006af0: 2020 2020 2020 2020 2020 202a 2020 2050             *   P
+00006b00: 4154 4348 2076 6572 7369 6f6e 2077 6865  ATCH version whe
+00006b10: 6e20 796f 7520 6d61 6b65 2062 6163 6b77  n you make backw
+00006b20: 6172 6473 2063 6f6d 7061 7469 626c 6520  ards compatible 
+00006b30: 6275 6720 6669 7865 732e 202a 2f0a 2020  bug fixes. */.  
+00006b40: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+00006b50: 616a 6f72 2220 2020 2049 4e54 4547 4552  ajor"    INTEGER
+00006b60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006b70: 2020 226d 696e 6f72 2220 2020 2049 4e54    "minor"    INT
+00006b80: 4547 4552 2c0a 2020 2020 2020 2020 2020  EGER,.          
+00006b90: 2020 2020 2020 2270 6174 6368 2220 2020        "patch"   
+00006ba0: 2049 4e54 4547 4552 0a20 2020 2020 2020   INTEGER.       
+00006bb0: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
+00006bc0: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
+00006bd0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00006be0: 6e65 6374 696f 6e2e 6578 6563 7574 6573  nection.executes
+00006bf0: 6372 6970 7428 7665 7273 696f 6e73 5461  cript(versionsTa
+00006c00: 626c 6529 0a20 2020 2020 2020 2065 7863  ble).        exc
+00006c10: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00006c20: 2065 7863 6570 7469 6f6e 3a0a 2020 2020   exception:.    
+00006c30: 2020 2020 2020 2020 6966 2070 7269 6e74          if print
+00006c40: 4465 6275 6720 3e3d 2032 3a0a 2020 2020  Debug >= 2:.    
+00006c50: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00006c60: 7428 6578 6365 7074 696f 6e29 0a20 2020  t(exception).   
+00006c70: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00006c80: 5b57 6172 6e69 6e67 5d20 5468 6572 6520  [Warning] There 
+00006c90: 7761 7320 616e 2065 7272 6f72 2077 6865  was an error whe
+00006ca0: 6e20 6164 6469 6e67 206d 6574 6164 6174  n adding metadat
+00006cb0: 6120 696e 666f 726d 6174 696f 6e2e 2049  a information. I
+00006cc0: 6e64 6578 206c 6f61 6469 6e67 206d 6967  ndex loading mig
+00006cd0: 6874 206e 6f74 2077 6f72 6b2e 2229 0a0a  ht not work.")..
+00006ce0: 2020 2020 2020 2020 7472 793a 0a0a 2020          try:..  
+00006cf0: 2020 2020 2020 2020 2020 6465 6620 6d61            def ma
+00006d00: 6b65 5665 7273 696f 6e52 6f77 280a 2020  keVersionRow(.  
+00006d10: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+00006d20: 7273 696f 6e4e 616d 653a 2073 7472 2c20  rsionName: str, 
+00006d30: 7665 7273 696f 6e3a 2073 7472 0a20 2020  version: str.   
+00006d40: 2020 2020 2020 2020 2029 202d 3e20 5475           ) -> Tu
+00006d50: 706c 655b 7374 722c 2073 7472 2c20 4f70  ple[str, str, Op
+00006d60: 7469 6f6e 616c 5b73 7472 5d2c 204f 7074  tional[str], Opt
+00006d70: 696f 6e61 6c5b 7374 725d 2c20 4f70 7469  ional[str], Opti
+00006d80: 6f6e 616c 5b73 7472 5d5d 3a0a 2020 2020  onal[str]]:.    
+00006d90: 2020 2020 2020 2020 2020 2020 7665 7273              vers
+00006da0: 696f 6e4e 756d 6265 7273 203d 205b 7265  ionNumbers = [re
+00006db0: 2e73 7562 2827 5b5e 302d 395d 272c 2027  .sub('[^0-9]', '
+00006dc0: 272c 2078 2920 666f 7220 7820 696e 2076  ', x) for x in v
+00006dd0: 6572 7369 6f6e 2e73 706c 6974 2827 2e27  ersion.split('.'
+00006de0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+00006df0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
 00006e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e10: 2020 7665 7273 696f 6e2c 0a20 2020 2020    version,.     
-00006e20: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00006e30: 6572 7369 6f6e 4e75 6d62 6572 735b 305d  ersionNumbers[0]
-00006e40: 2069 6620 6c65 6e28 7665 7273 696f 6e4e   if len(versionN
-00006e50: 756d 6265 7273 2920 3e20 3020 656c 7365  umbers) > 0 else
-00006e60: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00006e70: 2020 2020 2020 2020 2020 2076 6572 7369             versi
-00006e80: 6f6e 4e75 6d62 6572 735b 315d 2069 6620  onNumbers[1] if 
-00006e90: 6c65 6e28 7665 7273 696f 6e4e 756d 6265  len(versionNumbe
-00006ea0: 7273 2920 3e20 3120 656c 7365 204e 6f6e  rs) > 1 else Non
-00006eb0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00006ec0: 2020 2020 2020 2076 6572 7369 6f6e 4e75         versionNu
-00006ed0: 6d62 6572 735b 325d 2069 6620 6c65 6e28  mbers[2] if len(
-00006ee0: 7665 7273 696f 6e4e 756d 6265 7273 2920  versionNumbers) 
-00006ef0: 3e20 3220 656c 7365 204e 6f6e 652c 0a20  > 2 else None,. 
-00006f00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00006f10: 0a0a 2020 2020 2020 2020 2020 2020 7665  ..            ve
-00006f20: 7273 696f 6e73 203d 205b 0a20 2020 2020  rsions = [.     
-00006f30: 2020 2020 2020 2020 2020 206d 616b 6556             makeV
-00006f40: 6572 7369 6f6e 526f 7728 2772 6174 6172  ersionRow('ratar
-00006f50: 6d6f 756e 7427 2c20 5f5f 7665 7273 696f  mount', __versio
-00006f60: 6e5f 5f29 2c0a 2020 2020 2020 2020 2020  n__),.          
-00006f70: 2020 2020 2020 6d61 6b65 5665 7273 696f        makeVersio
-00006f80: 6e52 6f77 2827 696e 6465 7827 2c20 5351  nRow('index', SQ
-00006f90: 4c69 7465 496e 6465 7865 6454 6172 2e5f  LiteIndexedTar._
-00006fa0: 5f76 6572 7369 6f6e 5f5f 292c 0a20 2020  _version__),.   
-00006fb0: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
-00006fc0: 2020 2020 2020 2020 666f 7220 5f2c 2063          for _, c
-00006fd0: 696e 666f 2069 6e20 7375 7070 6f72 7465  info in supporte
-00006fe0: 6443 6f6d 7072 6573 7369 6f6e 732e 6974  dCompressions.it
-00006ff0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00007000: 2020 2020 2020 2069 6620 6369 6e66 6f2e         if cinfo.
-00007010: 6d6f 6475 6c65 4e61 6d65 2069 6e20 676c  moduleName in gl
-00007020: 6f62 616c 7328 293a 0a20 2020 2020 2020  obals():.       
-00007030: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00007040: 756c 6520 3d20 676c 6f62 616c 7328 295b  ule = globals()[
-00007050: 6369 6e66 6f2e 6d6f 6475 6c65 4e61 6d65  cinfo.moduleName
-00007060: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00007070: 2020 2020 2020 2320 7a69 7066 696c 6520        # zipfile 
-00007080: 6861 7320 6e6f 205f 5f76 6572 7369 6f6e  has no __version
-00007090: 5f5f 2061 7474 7269 6275 7465 2061 6e64  __ attribute and
-000070a0: 2050 4550 2033 3936 2065 6e73 7572 696e   PEP 396 ensurin
-000070b0: 6720 7468 6174 2077 6173 2072 656a 6563  g that was rejec
-000070c0: 7465 6420 3230 3231 2d30 342d 3134 0a20  ted 2021-04-14. 
-000070d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070e0: 2020 2023 2069 6e20 6661 766f 7220 6f66     # in favor of
-000070f0: 2027 7665 7273 696f 6e27 2066 726f 6d20   'version' from 
-00007100: 696d 706f 7274 6c69 622e 6d65 7461 6461  importlib.metada
-00007110: 7461 2077 6869 6368 2064 6f65 7320 6e6f  ta which does no
-00007120: 7420 6576 656e 2077 6f72 6b20 7769 7468  t even work with
-00007130: 207a 6970 6669 6c65 2e0a 2020 2020 2020   zipfile..      
-00007140: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007150: 5072 6f62 6162 6c79 2c20 6265 6361 7573  Probably, becaus
-00007160: 6520 7a69 7066 696c 6520 6973 2061 2062  e zipfile is a b
-00007170: 7569 6c74 2d69 6e20 6d6f 6475 6c65 2077  uilt-in module w
-00007180: 686f 7365 2076 6572 7369 6f6e 2077 6f75  hose version wou
-00007190: 6c64 2062 6520 7468 6520 5079 7468 6f6e  ld be the Python
-000071a0: 2076 6572 7369 6f6e 2e0a 2020 2020 2020   version..      
-000071b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000071c0: 6874 7470 733a 2f2f 7777 772e 7079 7468  https://www.pyth
-000071d0: 6f6e 2e6f 7267 2f64 6576 2f70 6570 732f  on.org/dev/peps/
-000071e0: 7065 702d 3033 3936 2f0a 2020 2020 2020  pep-0396/.      
-000071f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007200: 5468 6520 2270 7974 686f 6e2d 787a 2220  The "python-xz" 
-00007210: 7072 6f6a 6563 7420 6973 2069 6d70 6f72  project is impor
-00007220: 7465 6420 6173 2061 6e20 2278 7a22 206d  ted as an "xz" m
-00007230: 6f64 756c 652c 2077 6869 6368 2063 6f6d  odule, which com
-00007240: 706c 6963 6174 6573 2074 6869 6e67 7320  plicates things 
-00007250: 6265 6361 7573 650a 2020 2020 2020 2020  because.        
-00007260: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-00007270: 6572 6520 6973 206e 6f20 6765 6e65 7269  ere is no generi
-00007280: 6320 7761 7920 746f 2067 6574 2074 6865  c way to get the
-00007290: 2022 7079 7468 6f6e 2d78 7a22 206e 616d   "python-xz" nam
-000072a0: 6520 6672 6f6d 2074 6865 2022 787a 2220  e from the "xz" 
-000072b0: 7275 6e74 696d 6520 6d6f 6475 6c65 206f  runtime module o
-000072c0: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
-000072d0: 2020 2020 2020 2020 2020 2320 616e 6420            # and 
-000072e0: 696d 706f 7274 6c69 622e 6d65 7461 6461  importlib.metada
-000072f0: 7461 2e76 6572 7369 6f6e 2077 696c 6c20  ta.version will 
-00007300: 7265 7175 6972 6520 2270 7974 686f 6e2d  require "python-
-00007310: 787a 2220 6173 2061 7267 756d 656e 742e  xz" as argument.
-00007320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007330: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00007340: 6d6f 6475 6c65 2c20 275f 5f76 6572 7369  module, '__versi
-00007350: 6f6e 5f5f 2729 3a0a 2020 2020 2020 2020  on__'):.        
-00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007370: 7665 7273 696f 6e73 202b 3d20 5b6d 616b  versions += [mak
-00007380: 6556 6572 7369 6f6e 526f 7728 6369 6e66  eVersionRow(cinf
-00007390: 6f2e 6d6f 6475 6c65 4e61 6d65 2c20 6d6f  o.moduleName, mo
-000073a0: 6475 6c65 2e5f 5f76 6572 7369 6f6e 5f5f  dule.__version__
-000073b0: 295d 0a0a 2020 2020 2020 2020 2020 2020  )]..            
-000073c0: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
-000073d0: 7465 6d61 6e79 2827 494e 5345 5254 204f  temany('INSERT O
-000073e0: 5220 5245 504c 4143 4520 494e 544f 2022  R REPLACE INTO "
-000073f0: 7665 7273 696f 6e73 2220 5641 4c55 4553  versions" VALUES
-00007400: 2028 3f2c 3f2c 3f2c 3f2c 3f29 272c 2076   (?,?,?,?,?)', v
-00007410: 6572 7369 6f6e 7329 0a20 2020 2020 2020  ersions).       
-00007420: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00007430: 6e20 6173 2065 7863 6570 7469 6f6e 3a0a  n as exception:.
-00007440: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00007450: 7428 225b 5761 726e 696e 675d 2054 6865  t("[Warning] The
-00007460: 7265 2077 6173 2061 6e20 6572 726f 7220  re was an error 
-00007470: 7768 656e 2061 6464 696e 6720 7665 7273  when adding vers
-00007480: 696f 6e20 696e 666f 726d 6174 696f 6e2e  ion information.
-00007490: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-000074a0: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
-000074b0: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
-000074c0: 2020 2070 7269 6e74 2865 7863 6570 7469     print(excepti
-000074d0: 6f6e 290a 0a20 2020 2040 7374 6174 6963  on)..    @static
-000074e0: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-000074f0: 7374 6f72 6554 6172 4d65 7461 6461 7461  storeTarMetadata
-00007500: 2863 6f6e 6e65 6374 696f 6e3a 2073 716c  (connection: sql
-00007510: 6974 6533 2e43 6f6e 6e65 6374 696f 6e2c  ite3.Connection,
-00007520: 2074 6172 5061 7468 3a20 416e 7953 7472   tarPath: AnyStr
-00007530: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00007540: 2020 2022 2222 4164 6473 2073 6f6d 6520     """Adds some 
-00007550: 636f 6e73 6973 7465 6e63 7920 6d65 7461  consistency meta
-00007560: 2069 6e66 6f72 6d61 7469 6f6e 2074 6f20   information to 
-00007570: 7265 636f 676e 697a 6520 7468 6520 6e65  recognize the ne
-00007580: 6564 2074 6f20 7570 6461 7465 2074 6865  ed to update the
-00007590: 2063 6163 6865 6420 5441 5220 696e 6465   cached TAR inde
-000075a0: 7822 2222 0a20 2020 2020 2020 2074 7279  x""".        try
-000075b0: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-000075c0: 7253 7461 7473 203d 206f 732e 7374 6174  rStats = os.stat
-000075d0: 2874 6172 5061 7468 290a 2020 2020 2020  (tarPath).      
-000075e0: 2020 2020 2020 7365 7269 616c 697a 6564        serialized
-000075f0: 5461 7253 7461 7473 203d 206a 736f 6e2e  TarStats = json.
-00007600: 6475 6d70 7328 0a20 2020 2020 2020 2020  dumps(.         
-00007610: 2020 2020 2020 207b 6174 7472 3a20 6765         {attr: ge
-00007620: 7461 7474 7228 7461 7253 7461 7473 2c20  tattr(tarStats, 
-00007630: 6174 7472 2920 666f 7220 6174 7472 2069  attr) for attr i
-00007640: 6e20 6469 7228 7461 7253 7461 7473 2920  n dir(tarStats) 
-00007650: 6966 2061 7474 722e 7374 6172 7473 7769  if attr.startswi
-00007660: 7468 2827 7374 5f27 297d 0a20 2020 2020  th('st_')}.     
-00007670: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00007680: 2020 2020 2063 6f6e 6e65 6374 696f 6e2e       connection.
-00007690: 6578 6563 7574 6528 2749 4e53 4552 5420  execute('INSERT 
-000076a0: 494e 544f 2022 6d65 7461 6461 7461 2220  INTO "metadata" 
-000076b0: 5641 4c55 4553 2028 3f2c 3f29 272c 2028  VALUES (?,?)', (
-000076c0: 2274 6172 7374 6174 7322 2c20 7365 7269  "tarstats", seri
-000076d0: 616c 697a 6564 5461 7253 7461 7473 2929  alizedTarStats))
-000076e0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000076f0: 4578 6365 7074 696f 6e20 6173 2065 7863  Exception as exc
-00007700: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00007710: 2020 2020 6966 2070 7269 6e74 4465 6275      if printDebu
-00007720: 6720 3e3d 2032 3a0a 2020 2020 2020 2020  g >= 2:.        
-00007730: 2020 2020 2020 2020 7072 696e 7428 6578          print(ex
-00007740: 6365 7074 696f 6e29 0a20 2020 2020 2020  ception).       
-00007750: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
-00007760: 6e69 6e67 5d20 5468 6572 6520 7761 7320  ning] There was 
-00007770: 616e 2065 7272 6f72 2077 6865 6e20 6164  an error when ad
-00007780: 6469 6e67 2066 696c 6520 6d65 7461 6461  ding file metada
-00007790: 7461 2e22 290a 2020 2020 2020 2020 2020  ta.").          
-000077a0: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-000077b0: 675d 2041 7574 6f6d 6174 6963 2064 6574  g] Automatic det
-000077c0: 6563 7469 6f6e 206f 6620 6368 616e 6765  ection of change
-000077d0: 6420 5441 5220 6669 6c65 7320 6475 7269  d TAR files duri
-000077e0: 6e67 2069 6e64 6578 206c 6f61 6469 6e67  ng index loading
-000077f0: 206d 6967 6874 206e 6f74 2077 6f72 6b2e   might not work.
-00007800: 2229 0a0a 2020 2020 6465 6620 5f73 746f  ")..    def _sto
-00007810: 7265 4172 6775 6d65 6e74 734d 6574 6164  reArgumentsMetad
-00007820: 6174 6128 7365 6c66 2c20 636f 6e6e 6563  ata(self, connec
-00007830: 7469 6f6e 3a20 7371 6c69 7465 332e 436f  tion: sqlite3.Co
-00007840: 6e6e 6563 7469 6f6e 2920 2d3e 204e 6f6e  nnection) -> Non
-00007850: 653a 0a20 2020 2020 2020 2061 7267 756d  e:.        argum
-00007860: 656e 7473 546f 5361 7665 203d 205b 0a20  entsToSave = [. 
-00007870: 2020 2020 2020 2020 2020 2027 6d6f 756e             'moun
-00007880: 7452 6563 7572 7369 7665 6c79 272c 0a20  tRecursively',. 
-00007890: 2020 2020 2020 2020 2020 2027 677a 6970             'gzip
-000078a0: 5365 656b 506f 696e 7453 7061 6369 6e67  SeekPointSpacing
-000078b0: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-000078c0: 656e 636f 6469 6e67 272c 0a20 2020 2020  encoding',.     
-000078d0: 2020 2020 2020 2027 7374 7269 7052 6563         'stripRec
-000078e0: 7572 7369 7665 5461 7245 7874 656e 7369  ursiveTarExtensi
-000078f0: 6f6e 272c 0a20 2020 2020 2020 2020 2020  on',.           
-00007900: 2027 6967 6e6f 7265 5a65 726f 7327 2c0a   'ignoreZeros',.
-00007910: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
-00007920: 2020 2061 7267 756d 656e 7473 4d65 7461     argumentsMeta
-00007930: 6461 7461 203d 206a 736f 6e2e 6475 6d70  data = json.dump
-00007940: 7328 7b61 7267 756d 656e 743a 2067 6574  s({argument: get
-00007950: 6174 7472 2873 656c 662c 2061 7267 756d  attr(self, argum
-00007960: 656e 7429 2066 6f72 2061 7267 756d 656e  ent) for argumen
-00007970: 7420 696e 2061 7267 756d 656e 7473 546f  t in argumentsTo
-00007980: 5361 7665 7d29 0a0a 2020 2020 2020 2020  Save})..        
-00007990: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000079a0: 2063 6f6e 6e65 6374 696f 6e2e 6578 6563   connection.exec
-000079b0: 7574 6528 2749 4e53 4552 5420 494e 544f  ute('INSERT INTO
-000079c0: 2022 6d65 7461 6461 7461 2220 5641 4c55   "metadata" VALU
-000079d0: 4553 2028 3f2c 3f29 272c 2028 2261 7267  ES (?,?)', ("arg
-000079e0: 756d 656e 7473 222c 2061 7267 756d 656e  uments", argumen
-000079f0: 7473 4d65 7461 6461 7461 2929 0a20 2020  tsMetadata)).   
-00007a00: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00007a10: 7074 696f 6e20 6173 2065 7863 6570 7469  ption as excepti
-00007a20: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00007a30: 6966 2070 7269 6e74 4465 6275 6720 3e3d  if printDebug >=
-00007a40: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00007a50: 2020 2020 7072 696e 7428 6578 6365 7074      print(except
-00007a60: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
-00007a70: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
-00007a80: 5d20 5468 6572 6520 7761 7320 616e 2065  ] There was an e
-00007a90: 7272 6f72 2077 6865 6e20 6164 6469 6e67  rror when adding
-00007aa0: 2061 7267 756d 656e 7420 6d65 7461 6461   argument metada
-00007ab0: 7461 2e22 290a 2020 2020 2020 2020 2020  ta.").          
-00007ac0: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-00007ad0: 675d 2041 7574 6f6d 6174 6963 2064 6574  g] Automatic det
-00007ae0: 6563 7469 6f6e 206f 6620 6368 616e 6765  ection of change
-00007af0: 6420 6172 6775 6d65 6e74 7320 6669 6c65  d arguments file
-00007b00: 7320 6475 7269 6e67 2069 6e64 6578 206c  s during index l
-00007b10: 6f61 6469 6e67 206d 6967 6874 206e 6f74  oading might not
-00007b20: 2077 6f72 6b2e 2229 0a0a 2020 2020 4073   work.")..    @s
-00007b30: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00007b40: 6465 6620 5f70 6174 6849 7357 7269 7461  def _pathIsWrita
-00007b50: 626c 6528 7061 7468 3a20 416e 7953 7472  ble(path: AnyStr
-00007b60: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-00007b70: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00007b80: 2020 2020 666f 6c64 6572 203d 206f 732e      folder = os.
-00007b90: 7061 7468 2e64 6972 6e61 6d65 2870 6174  path.dirname(pat
-00007ba0: 6829 0a20 2020 2020 2020 2020 2020 2069  h).            i
-00007bb0: 6620 666f 6c64 6572 3a0a 2020 2020 2020  f folder:.      
-00007bc0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-00007bd0: 6564 6972 7328 666f 6c64 6572 2c20 6578  edirs(folder, ex
-00007be0: 6973 745f 6f6b 3d54 7275 6529 0a0a 2020  ist_ok=True)..  
-00007bf0: 2020 2020 2020 2020 2020 6620 3d20 6f70            f = op
-00007c00: 656e 2870 6174 682c 2027 7762 2729 0a20  en(path, 'wb'). 
-00007c10: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-00007c20: 7465 2862 275c 3027 202a 2031 3032 3420  te(b'\0' * 1024 
-00007c30: 2a20 3130 3234 290a 2020 2020 2020 2020  * 1024).        
-00007c40: 2020 2020 662e 636c 6f73 6528 290a 2020      f.close().  
-00007c50: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
-00007c60: 6f76 6528 7061 7468 290a 0a20 2020 2020  ove(path)..     
-00007c70: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00007c80: 7565 0a0a 2020 2020 2020 2020 6578 6365  ue..        exce
-00007c90: 7074 2050 6572 6d69 7373 696f 6e45 7272  pt PermissionErr
-00007ca0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00007cb0: 6966 2070 7269 6e74 4465 6275 6720 3e3d  if printDebug >=
-00007cc0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00007cd0: 2020 2020 7472 6163 6562 6163 6b2e 7072      traceback.pr
-00007ce0: 696e 745f 6578 6328 290a 2020 2020 2020  int_exc().      
-00007cf0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00007d00: 2243 6f75 6c64 206e 6f74 2063 7265 6174  "Could not creat
-00007d10: 6520 6669 6c65 3a22 2c20 7061 7468 290a  e file:", path).
-00007d20: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00007d30: 494f 4572 726f 723a 0a20 2020 2020 2020  IOError:.       
-00007d40: 2020 2020 2069 6620 7072 696e 7444 6562       if printDeb
-00007d50: 7567 203e 3d20 323a 0a20 2020 2020 2020  ug >= 2:.       
-00007d60: 2020 2020 2020 2020 2074 7261 6365 6261           traceba
-00007d70: 636b 2e70 7269 6e74 5f65 7863 2829 0a20  ck.print_exc(). 
-00007d80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00007d90: 7269 6e74 2822 436f 756c 6420 6e6f 7420  rint("Could not 
-00007da0: 6372 6561 7465 2066 696c 653a 222c 2070  create file:", p
-00007db0: 6174 6829 0a0a 2020 2020 2020 2020 7265  ath)..        re
-00007dc0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-00007dd0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00007de0: 2020 6465 6620 5f70 6174 6843 616e 4265    def _pathCanBe
-00007df0: 5573 6564 466f 7253 716c 6974 6528 7061  UsedForSqlite(pa
-00007e00: 7468 3a20 416e 7953 7472 2920 2d3e 2062  th: AnyStr) -> b
-00007e10: 6f6f 6c3a 0a20 2020 2020 2020 2066 696c  ool:.        fil
-00007e20: 6545 7869 7374 6564 203d 206f 732e 7061  eExisted = os.pa
-00007e30: 7468 2e69 7366 696c 6528 7061 7468 290a  th.isfile(path).
-00007e40: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00007e50: 2020 2020 2020 2020 2066 6f6c 6465 7220           folder 
-00007e60: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00007e70: 6528 7061 7468 290a 2020 2020 2020 2020  e(path).        
-00007e80: 2020 2020 6966 2066 6f6c 6465 723a 0a20      if folder:. 
-00007e90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00007ea0: 732e 6d61 6b65 6469 7273 2866 6f6c 6465  s.makedirs(folde
-00007eb0: 722c 2065 7869 7374 5f6f 6b3d 5472 7565  r, exist_ok=True
-00007ec0: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
-00007ed0: 6f6e 6e65 6374 696f 6e20 3d20 5351 4c69  onnection = SQLi
-00007ee0: 7465 496e 6465 7865 6454 6172 2e5f 6f70  teIndexedTar._op
-00007ef0: 656e 5371 6c44 6228 7061 7468 290a 2020  enSqlDb(path).  
-00007f00: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
-00007f10: 7469 6f6e 2e65 7865 6375 7465 7363 7269  tion.executescri
-00007f20: 7074 2827 4352 4541 5445 2054 4142 4c45  pt('CREATE TABLE
-00007f30: 2022 6669 6c65 7322 2028 2022 7061 7468   "files" ( "path
-00007f40: 2220 5641 5243 4841 5228 3635 3533 3529  " VARCHAR(65535)
-00007f50: 204e 4f54 204e 554c 4c20 293b 2729 0a20   NOT NULL );'). 
-00007f60: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
-00007f70: 6374 696f 6e2e 636f 6d6d 6974 2829 0a20  ction.commit(). 
-00007f80: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
-00007f90: 6374 696f 6e2e 636c 6f73 6528 290a 2020  ction.close().  
-00007fa0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007fb0: 2054 7275 650a 2020 2020 2020 2020 6578   True.        ex
-00007fc0: 6365 7074 2073 716c 6974 6533 2e4f 7065  cept sqlite3.Ope
-00007fd0: 7261 7469 6f6e 616c 4572 726f 723a 0a20  rationalError:. 
-00007fe0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00007ff0: 696e 7444 6562 7567 203e 3d20 323a 0a20  intDebug >= 2:. 
-00008000: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00008010: 7261 6365 6261 636b 2e70 7269 6e74 5f65  raceback.print_e
-00008020: 7863 2829 0a20 2020 2020 2020 2020 2020  xc().           
-00008030: 2020 2020 2070 7269 6e74 2822 436f 756c       print("Coul
-00008040: 6420 6e6f 7420 6372 6561 7465 2053 514c  d not create SQL
-00008050: 6974 6520 6461 7461 6261 7365 2061 743a  ite database at:
-00008060: 222c 2070 6174 6829 0a20 2020 2020 2020  ", path).       
-00008070: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-00008080: 2020 2020 2020 6966 206e 6f74 2066 696c        if not fil
-00008090: 6545 7869 7374 6564 2061 6e64 206f 732e  eExisted and os.
-000080a0: 7061 7468 2e69 7366 696c 6528 7061 7468  path.isfile(path
-000080b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000080c0: 2020 2053 514c 6974 6549 6e64 6578 6564     SQLiteIndexed
-000080d0: 5461 722e 5f75 6e63 6865 636b 6564 5265  Tar._uncheckedRe
-000080e0: 6d6f 7665 2870 6174 6829 0a0a 2020 2020  move(path)..    
-000080f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00008100: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00008110: 686f 640a 2020 2020 6465 6620 5f6f 7065  hod.    def _ope
-00008120: 6e53 716c 4462 2870 6174 683a 2041 6e79  nSqlDb(path: Any
-00008130: 5374 722c 202a 2a6b 7761 7267 7329 202d  Str, **kwargs) -
-00008140: 3e20 7371 6c69 7465 332e 436f 6e6e 6563  > sqlite3.Connec
-00008150: 7469 6f6e 3a0a 2020 2020 2020 2020 7371  tion:.        sq
-00008160: 6c43 6f6e 6e65 6374 696f 6e20 3d20 7371  lConnection = sq
-00008170: 6c69 7465 332e 636f 6e6e 6563 7428 7061  lite3.connect(pa
-00008180: 7468 2c20 2a2a 6b77 6172 6773 290a 2020  th, **kwargs).  
-00008190: 2020 2020 2020 7371 6c43 6f6e 6e65 6374        sqlConnect
-000081a0: 696f 6e2e 726f 775f 6661 6374 6f72 7920  ion.row_factory 
-000081b0: 3d20 7371 6c69 7465 332e 526f 770a 2020  = sqlite3.Row.  
-000081c0: 2020 2020 2020 7371 6c43 6f6e 6e65 6374        sqlConnect
-000081d0: 696f 6e2e 6578 6563 7574 6573 6372 6970  ion.executescrip
-000081e0: 7428 0a20 2020 2020 2020 2020 2020 2023  t(.            #
-000081f0: 204c 6f6f 6b69 6e67 206d 6f64 6520 6578   Looking mode ex
-00008200: 636c 7573 6976 6520 6c65 6164 7320 746f  clusive leads to
-00008210: 2061 206d 6561 7375 7261 626c 6520 7370   a measurable sp
-00008220: 6565 6475 702e 2045 2e67 2e2c 2066 696e  eedup. E.g., fin
-00008230: 6420 6f6e 2032 6b20 7265 6375 7273 6976  d on 2k recursiv
-00008240: 6520 6669 6c65 7320 7461 720a 2020 2020  e files tar.    
-00008250: 2020 2020 2020 2020 2320 696d 7072 6f76          # improv
-00008260: 6573 2066 726f 6d20 7e31 7320 746f 207e  es from ~1s to ~
-00008270: 302e 3473 210a 2020 2020 2020 2020 2020  0.4s!.          
-00008280: 2020 2320 6874 7470 733a 2f2f 626c 6f67    # https://blog
-00008290: 2e64 6576 6172 742e 636f 6d2f 696e 6372  .devart.com/incr
-000082a0: 6561 7369 6e67 2d73 716c 6974 652d 7065  easing-sqlite-pe
-000082b0: 7266 6f72 6d61 6e63 652e 6874 6d6c 0a20  rformance.html. 
-000082c0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-000082d0: 2020 2020 2020 2020 2020 2050 5241 474d             PRAGM
-000082e0: 4120 4c4f 434b 494e 475f 4d4f 4445 203d  A LOCKING_MODE =
-000082f0: 2045 5843 4c55 5349 5645 3b0a 2020 2020   EXCLUSIVE;.    
-00008300: 2020 2020 2020 2020 5052 4147 4d41 2054          PRAGMA T
-00008310: 454d 505f 5354 4f52 4520 3d20 4d45 4d4f  EMP_STORE = MEMO
-00008320: 5259 3b0a 2020 2020 2020 2020 2020 2020  RY;.            
-00008330: 5052 4147 4d41 204a 4f55 524e 414c 5f4d  PRAGMA JOURNAL_M
-00008340: 4f44 4520 3d20 4f46 463b 0a20 2020 2020  ODE = OFF;.     
-00008350: 2020 2020 2020 2050 5241 474d 4120 5359         PRAGMA SY
-00008360: 4e43 4852 4f4e 4f55 5320 3d20 4f46 463b  NCHRONOUS = OFF;
-00008370: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-00008380: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00008390: 2020 2072 6574 7572 6e20 7371 6c43 6f6e     return sqlCon
-000083a0: 6e65 6374 696f 6e0a 0a20 2020 2040 7374  nection..    @st
-000083b0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-000083c0: 6566 205f 696e 6974 6961 6c69 7a65 5371  ef _initializeSq
-000083d0: 6c44 6228 696e 6465 7846 696c 654e 616d  lDb(indexFileNam
-000083e0: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
-000083f0: 2920 2d3e 2073 716c 6974 6533 2e43 6f6e  ) -> sqlite3.Con
-00008400: 6e65 6374 696f 6e3a 0a20 2020 2020 2020  nection:.       
-00008410: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
-00008420: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00008430: 2070 7269 6e74 2822 4372 6561 7469 6e67   print("Creating
-00008440: 206e 6577 2053 514c 6974 6520 696e 6465   new SQLite inde
-00008450: 7820 6461 7461 6261 7365 2061 7422 2c20  x database at", 
-00008460: 696e 6465 7846 696c 654e 616d 6520 6966  indexFileName if
-00008470: 2069 6e64 6578 4669 6c65 4e61 6d65 2065   indexFileName e
-00008480: 6c73 6520 273a 6d65 6d6f 7279 3a27 290a  lse ':memory:').
-00008490: 0a20 2020 2020 2020 2063 7265 6174 6554  .        createT
-000084a0: 6162 6c65 7320 3d20 2222 220a 2020 2020  ables = """.    
-000084b0: 2020 2020 2020 2020 4352 4541 5445 2054          CREATE T
-000084c0: 4142 4c45 2022 6669 6c65 7322 2028 0a20  ABLE "files" (. 
-000084d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000084e0: 7061 7468 2220 2020 2020 2020 2020 2056  path"          V
-000084f0: 4152 4348 4152 2836 3535 3335 2920 4e4f  ARCHAR(65535) NO
-00008500: 5420 4e55 4c4c 2c20 202f 2a20 7061 7468  T NULL,  /* path
-00008510: 2077 6974 6820 6c65 6164 696e 6720 616e   with leading an
-00008520: 6420 7769 7468 6f75 7420 7472 6169 6c69  d without traili
-00008530: 6e67 2073 6c61 7368 202a 2f0a 2020 2020  ng slash */.    
-00008540: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00008550: 6522 2020 2020 2020 2020 2020 5641 5243  e"          VARC
-00008560: 4841 5228 3635 3533 3529 204e 4f54 204e  HAR(65535) NOT N
-00008570: 554c 4c2c 0a20 2020 2020 2020 2020 2020  ULL,.           
-00008580: 2020 2020 2022 6f66 6673 6574 6865 6164       "offsethead
-00008590: 6572 2220 2049 4e54 4547 4552 2c20 202f  er"  INTEGER,  /
-000085a0: 2a20 7365 656b 206f 6666 7365 7420 6672  * seek offset fr
-000085b0: 6f6d 2054 4152 2066 696c 6520 7768 6572  om TAR file wher
-000085c0: 6520 7468 6520 5441 5220 6d65 7461 6461  e the TAR metada
-000085d0: 7461 2066 6f72 2074 6869 7320 6669 6c65  ta for this file
-000085e0: 2072 6573 6964 6573 202a 2f0a 2020 2020   resides */.    
-000085f0: 2020 2020 2020 2020 2020 2020 226f 6666              "off
-00008600: 7365 7422 2020 2020 2020 2020 494e 5445  set"        INTE
-00008610: 4745 522c 2020 2f2a 2073 6565 6b20 6f66  GER,  /* seek of
-00008620: 6673 6574 2066 726f 6d20 5441 5220 6669  fset from TAR fi
-00008630: 6c65 2077 6865 7265 2074 6865 7365 2066  le where these f
-00008640: 696c 6527 7320 636f 6e74 656e 7473 2072  ile's contents r
-00008650: 6573 6964 6573 202a 2f0a 2020 2020 2020  esides */.      
-00008660: 2020 2020 2020 2020 2020 2273 697a 6522            "size"
-00008670: 2020 2020 2020 2020 2020 494e 5445 4745            INTEGE
-00008680: 522c 0a20 2020 2020 2020 2020 2020 2020  R,.             
-00008690: 2020 2022 6d74 696d 6522 2020 2020 2020     "mtime"      
-000086a0: 2020 2049 4e54 4547 4552 2c0a 2020 2020     INTEGER,.    
-000086b0: 2020 2020 2020 2020 2020 2020 226d 6f64              "mod
-000086c0: 6522 2020 2020 2020 2020 2020 494e 5445  e"          INTE
-000086d0: 4745 522c 0a20 2020 2020 2020 2020 2020  GER,.           
-000086e0: 2020 2020 2022 7479 7065 2220 2020 2020       "type"     
-000086f0: 2020 2020 2049 4e54 4547 4552 2c0a 2020       INTEGER,.  
-00008700: 2020 2020 2020 2020 2020 2020 2020 226c                "l
-00008710: 696e 6b6e 616d 6522 2020 2020 2020 5641  inkname"      VA
-00008720: 5243 4841 5228 3635 3533 3529 2c0a 2020  RCHAR(65535),.  
-00008730: 2020 2020 2020 2020 2020 2020 2020 2275                "u
-00008740: 6964 2220 2020 2020 2020 2020 2020 494e  id"           IN
-00008750: 5445 4745 522c 0a20 2020 2020 2020 2020  TEGER,.         
-00008760: 2020 2020 2020 2022 6769 6422 2020 2020         "gid"    
-00008770: 2020 2020 2020 2049 4e54 4547 4552 2c0a         INTEGER,.
-00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008790: 2f2a 2054 7275 6520 666f 7220 7661 6c69  /* True for vali
-000087a0: 6420 5441 5220 6669 6c65 732e 2049 6e74  d TAR files. Int
-000087b0: 6572 6e61 6c6c 7920 7573 6564 2074 6f20  ernally used to 
-000087c0: 6465 7465 726d 696e 6520 7768 6572 6520  determine where 
-000087d0: 746f 206d 6f75 6e74 2072 6563 7572 7369  to mount recursi
-000087e0: 7665 2054 4152 2066 696c 6573 2e20 2a2f  ve TAR files. */
-000087f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008800: 2022 6973 7461 7222 2020 2020 2020 2020   "istar"        
-00008810: 2042 4f4f 4c20 2020 2c0a 2020 2020 2020   BOOL   ,.      
-00008820: 2020 2020 2020 2020 2020 2269 7373 7061            "isspa
-00008830: 7273 6522 2020 2020 2020 424f 4f4c 2020  rse"      BOOL  
-00008840: 202c 2020 2f2a 2066 6f72 2073 7061 7273   ,  /* for spars
-00008850: 6520 6669 6c65 7320 7468 6520 6669 6c65  e files the file
-00008860: 2073 697a 6520 7265 6665 7273 2074 6f20   size refers to 
-00008870: 7468 6520 6578 7061 6e64 6564 2073 697a  the expanded siz
-00008880: 6521 202a 2f0a 2020 2020 2020 2020 2020  e! */.          
-00008890: 2020 2020 2020 2f2a 2053 6565 2053 514c        /* See SQL
-000088a0: 2062 656e 6368 6d61 726b 7320 666f 7220   benchmarks for 
-000088b0: 6465 6369 7369 6f6e 206f 6e20 7468 6520  decision on the 
-000088c0: 7072 696d 6172 7920 6b65 792e 0a20 2020  primary key..   
-000088d0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-000088e0: 5365 6520 616c 736f 2068 7474 7073 3a2f  See also https:/
-000088f0: 2f77 7777 2e73 716c 6974 652e 6f72 672f  /www.sqlite.org/
-00008900: 6f70 746f 7665 7276 6965 772e 6874 6d6c  optoverview.html
-00008910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008920: 2020 2a20 2870 6174 682c 6e61 6d65 2920    * (path,name) 
-00008930: 7475 706c 6573 206d 6967 6874 2061 7070  tuples might app
-00008940: 6561 7220 6d75 6c74 6970 6c65 2074 696d  ear multiple tim
-00008950: 6573 2069 6e20 6120 5441 5220 6966 2069  es in a TAR if i
-00008960: 7420 676f 7420 7570 6461 7465 642e 0a20  t got updated.. 
-00008970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008980: 2a20 496e 206f 7264 6572 2074 6f20 616c  * In order to al
-00008990: 736f 2062 6520 6162 6c65 2074 6f20 7368  so be able to sh
-000089a0: 6f77 206f 6c64 6572 2076 6572 7369 6f6e  ow older version
-000089b0: 732c 2077 6520 6e65 6564 2074 6f20 6164  s, we need to ad
-000089c0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-000089d0: 2020 202a 2074 6865 206f 6666 7365 7468     * the offseth
-000089e0: 6561 6465 7220 636f 6c75 6d6e 2074 6f20  eader column to 
-000089f0: 7468 6520 7072 696d 6172 7920 6b65 792e  the primary key.
-00008a00: 202a 2f0a 2020 2020 2020 2020 2020 2020   */.            
-00008a10: 2020 2020 5052 494d 4152 5920 4b45 5920      PRIMARY KEY 
-00008a20: 2870 6174 682c 6e61 6d65 2c6f 6666 7365  (path,name,offse
-00008a30: 7468 6561 6465 7229 0a20 2020 2020 2020  theader).       
-00008a40: 2020 2020 2029 3b0a 2020 2020 2020 2020       );.        
-00008a50: 2020 2020 2f2a 2022 4120 7461 626c 6520      /* "A table 
-00008a60: 6372 6561 7465 6420 7573 696e 6720 4352  created using CR
-00008a70: 4541 5445 2054 4142 4c45 2041 5320 6861  EATE TABLE AS ha
-00008a80: 7320 6e6f 2050 5249 4d41 5259 204b 4559  s no PRIMARY KEY
-00008a90: 2061 6e64 206e 6f20 636f 6e73 7472 6169   and no constrai
-00008aa0: 6e74 7320 6f66 2061 6e79 206b 696e 6422  nts of any kind"
-00008ab0: 0a20 2020 2020 2020 2020 2020 2020 2a20  .             * 
-00008ac0: 5468 6572 6566 6f72 652c 2069 7420 7769  Therefore, it wi
-00008ad0: 6c6c 206e 6f74 2062 6520 736f 7274 6564  ll not be sorted
-00008ae0: 2061 6e64 2069 6e73 6572 7469 6e67 2077   and inserting w
-00008af0: 696c 6c20 6265 2066 6173 7465 7221 202a  ill be faster! *
-00008b00: 2f0a 2020 2020 2020 2020 2020 2020 4352  /.            CR
-00008b10: 4541 5445 2054 4142 4c45 2022 6669 6c65  EATE TABLE "file
-00008b20: 7374 6d70 2220 4153 2053 454c 4543 5420  stmp" AS SELECT 
-00008b30: 2a20 4652 4f4d 2022 6669 6c65 7322 2057  * FROM "files" W
-00008b40: 4845 5245 2030 3b0a 2020 2020 2020 2020  HERE 0;.        
-00008b50: 2020 2020 4352 4541 5445 2054 4142 4c45      CREATE TABLE
-00008b60: 2022 7061 7265 6e74 666f 6c64 6572 7322   "parentfolders"
-00008b70: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00008b80: 2020 2022 7061 7468 2220 2020 2020 2020     "path"       
-00008b90: 2020 2056 4152 4348 4152 2836 3535 3335     VARCHAR(65535
-00008ba0: 2920 4e4f 5420 4e55 4c4c 2c0a 2020 2020  ) NOT NULL,.    
-00008bb0: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00008bc0: 6522 2020 2020 2020 2020 2020 5641 5243  e"          VARC
-00008bd0: 4841 5228 3635 3533 3529 204e 4f54 204e  HAR(65535) NOT N
-00008be0: 554c 4c2c 0a20 2020 2020 2020 2020 2020  ULL,.           
-00008bf0: 2020 2020 2022 6f66 6673 6574 6865 6164       "offsethead
-00008c00: 6572 2220 2049 4e54 4547 4552 2c0a 2020  er"  INTEGER,.  
-00008c10: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-00008c20: 6666 7365 7422 2020 2020 2020 2020 494e  ffset"        IN
-00008c30: 5445 4745 522c 0a20 2020 2020 2020 2020  TEGER,.         
-00008c40: 2020 2020 2020 2050 5249 4d41 5259 204b         PRIMARY K
-00008c50: 4559 2028 7061 7468 2c6e 616d 6529 0a20  EY (path,name). 
-00008c60: 2020 2020 2020 2020 2020 2020 2020 2055                 U
-00008c70: 4e49 5155 4520 2870 6174 682c 6e61 6d65  NIQUE (path,name
-00008c80: 290a 2020 2020 2020 2020 2020 2020 293b  ).            );
-00008c90: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00008ca0: 2020 2020 2020 7371 6c43 6f6e 6e65 6374        sqlConnect
-00008cb0: 696f 6e20 3d20 5351 4c69 7465 496e 6465  ion = SQLiteInde
-00008cc0: 7865 6454 6172 2e5f 6f70 656e 5371 6c44  xedTar._openSqlD
-00008cd0: 6228 696e 6465 7846 696c 654e 616d 6520  b(indexFileName 
-00008ce0: 6966 2069 6e64 6578 4669 6c65 4e61 6d65  if indexFileName
-00008cf0: 2065 6c73 6520 273a 6d65 6d6f 7279 3a27   else ':memory:'
-00008d00: 290a 2020 2020 2020 2020 7461 626c 6573  ).        tables
-00008d10: 203d 2073 716c 436f 6e6e 6563 7469 6f6e   = sqlConnection
-00008d20: 2e65 7865 6375 7465 2827 5345 4c45 4354  .execute('SELECT
-00008d30: 206e 616d 6520 4652 4f4d 2073 716c 6974   name FROM sqlit
-00008d40: 655f 6d61 7374 6572 2057 4845 5245 2074  e_master WHERE t
-00008d50: 7970 6520 3d20 2274 6162 6c65 223b 2729  ype = "table";')
-00008d60: 0a20 2020 2020 2020 2069 6620 7b22 6669  .        if {"fi
-00008d70: 6c65 7322 2c20 2266 696c 6573 746d 7022  les", "filestmp"
-00008d80: 2c20 2270 6172 656e 7466 6f6c 6465 7273  , "parentfolders
-00008d90: 227d 2e69 6e74 6572 7365 6374 696f 6e28  "}.intersection(
-00008da0: 7b74 5b30 5d20 666f 7220 7420 696e 2074  {t[0] for t in t
-00008db0: 6162 6c65 737d 293a 0a20 2020 2020 2020  ables}):.       
-00008dc0: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
-00008dd0: 6964 496e 6465 7845 7272 6f72 280a 2020  idIndexError(.  
-00008de0: 2020 2020 2020 2020 2020 2020 2020 2254                "T
-00008df0: 6865 2069 6e64 6578 2066 696c 6520 7b7d  he index file {}
-00008e00: 2061 6c72 6561 6479 2073 6565 6d73 2074   already seems t
-00008e10: 6f20 636f 6e74 6169 6e20 6120 7461 626c  o contain a tabl
-00008e20: 652e 2022 0a20 2020 2020 2020 2020 2020  e. ".           
-00008e30: 2020 2020 2022 506c 6561 7365 2073 7065       "Please spe
-00008e40: 6369 6679 202d 2d72 6563 7265 6174 652d  cify --recreate-
-00008e50: 696e 6465 782e 222e 666f 726d 6174 2869  index.".format(i
-00008e60: 6e64 6578 4669 6c65 4e61 6d65 290a 2020  ndexFileName).  
-00008e70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00008e80: 2020 2020 7371 6c43 6f6e 6e65 6374 696f      sqlConnectio
-00008e90: 6e2e 6578 6563 7574 6573 6372 6970 7428  n.executescript(
-00008ea0: 6372 6561 7465 5461 626c 6573 290a 2020  createTables).  
-00008eb0: 2020 2020 2020 7265 7475 726e 2073 716c        return sql
-00008ec0: 436f 6e6e 6563 7469 6f6e 0a0a 2020 2020  Connection..    
-00008ed0: 6465 6620 5f72 656c 6f61 6449 6e64 6578  def _reloadIndex
-00008ee0: 5265 6164 4f6e 6c79 2873 656c 6629 3a0a  ReadOnly(self):.
-00008ef0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00008f00: 656c 662e 696e 6465 7846 696c 654e 616d  elf.indexFileNam
-00008f10: 6520 6f72 2073 656c 662e 696e 6465 7846  e or self.indexF
-00008f20: 696c 654e 616d 6520 3d3d 2027 3a6d 656d  ileName == ':mem
-00008f30: 6f72 793a 2720 6f72 206e 6f74 2073 656c  ory:' or not sel
-00008f40: 662e 7371 6c43 6f6e 6e65 6374 696f 6e3a  f.sqlConnection:
-00008f50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00008f60: 7572 6e0a 0a20 2020 2020 2020 2073 656c  urn..        sel
-00008f70: 662e 7371 6c43 6f6e 6e65 6374 696f 6e2e  f.sqlConnection.
-00008f80: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-00008f90: 7365 6c66 2e73 716c 436f 6e6e 6563 7469  self.sqlConnecti
-00008fa0: 6f6e 203d 2053 514c 6974 6549 6e64 6578  on = SQLiteIndex
-00008fb0: 6564 5461 722e 5f6f 7065 6e53 716c 4462  edTar._openSqlDb
-00008fc0: 2866 2266 696c 653a 7b73 656c 662e 696e  (f"file:{self.in
-00008fd0: 6465 7846 696c 654e 616d 657d 3f6d 6f64  dexFileName}?mod
-00008fe0: 653d 726f 222c 2075 7269 3d54 7275 6529  e=ro", uri=True)
-00008ff0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00009000: 686f 640a 2020 2020 6465 6620 5f74 6172  hod.    def _tar
-00009010: 496e 666f 4675 6c6c 4d6f 6465 2874 6172  InfoFullMode(tar
-00009020: 496e 666f 3a20 7461 7266 696c 652e 5461  Info: tarfile.Ta
-00009030: 7249 6e66 6f29 202d 3e20 696e 743a 0a20  rInfo) -> int:. 
-00009040: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00009050: 2020 2052 6574 7572 6e73 2074 6865 2066     Returns the f
-00009060: 756c 6c20 6d6f 6465 2066 6f72 2061 2054  ull mode for a T
-00009070: 6172 496e 666f 206f 626a 6563 742e 204e  arInfo object. N
-00009080: 6f74 6520 7468 6174 2054 6172 496e 666f  ote that TarInfo
-00009090: 2e6d 6f64 6520 6f6e 6c79 2063 6f6e 7461  .mode only conta
-000090a0: 696e 7320 7468 6520 7065 726d 6973 7369  ins the permissi
-000090b0: 6f6e 2062 6974 730a 2020 2020 2020 2020  on bits.        
-000090c0: 616e 6420 6e6f 7420 6f74 6865 7220 6269  and not other bi
-000090d0: 7473 206c 696b 6520 7365 7420 666f 7220  ts like set for 
-000090e0: 6469 7265 6374 6f72 792c 2073 796d 626f  directory, symbo
-000090f0: 6c69 6320 6c69 6e6b 732c 2061 6e64 206f  lic links, and o
-00009100: 7468 6572 2073 7065 6369 616c 2066 696c  ther special fil
-00009110: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-00009120: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00009130: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
-00009140: 496e 666f 2e6d 6f64 650a 2020 2020 2020  Info.mode.      
-00009150: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
-00009160: 0a20 2020 2020 2020 2020 2020 207c 2028  .            | (
-00009170: 2073 7461 742e 535f 4946 4449 5220 6966   stat.S_IFDIR if
-00009180: 2074 6172 496e 666f 2e69 7364 6972 2028   tarInfo.isdir (
-00009190: 2920 656c 7365 2030 2029 0a20 2020 2020  ) else 0 ).     
-000091a0: 2020 2020 2020 207c 2028 2073 7461 742e         | ( stat.
-000091b0: 535f 4946 5245 4720 6966 2074 6172 496e  S_IFREG if tarIn
-000091c0: 666f 2e69 7366 696c 6528 2920 656c 7365  fo.isfile() else
-000091d0: 2030 2029 0a20 2020 2020 2020 2020 2020   0 ).           
-000091e0: 207c 2028 2073 7461 742e 535f 4946 4c4e   | ( stat.S_IFLN
-000091f0: 4b20 6966 2074 6172 496e 666f 2e69 7373  K if tarInfo.iss
-00009200: 796d 2028 2920 656c 7365 2030 2029 0a20  ym () else 0 ). 
-00009210: 2020 2020 2020 2020 2020 207c 2028 2073             | ( s
-00009220: 7461 742e 535f 4946 4348 5220 6966 2074  tat.S_IFCHR if t
-00009230: 6172 496e 666f 2e69 7363 6872 2028 2920  arInfo.ischr () 
-00009240: 656c 7365 2030 2029 0a20 2020 2020 2020  else 0 ).       
-00009250: 2020 2020 207c 2028 2073 7461 742e 535f       | ( stat.S_
-00009260: 4946 4946 4f20 6966 2074 6172 496e 666f  IFIFO if tarInfo
-00009270: 2e69 7366 6966 6f28 2920 656c 7365 2030  .isfifo() else 0
-00009280: 2029 0a20 2020 2020 2020 2020 2020 2023   ).            #
-00009290: 2066 6d74 3a20 6f6e 0a20 2020 2020 2020   fmt: on.       
-000092a0: 2029 0a0a 2020 2020 6465 6620 5f75 7064   )..    def _upd
-000092b0: 6174 6550 726f 6772 6573 7342 6172 2873  ateProgressBar(s
-000092c0: 656c 662c 2070 726f 6772 6573 7342 6172  elf, progressBar
-000092d0: 2c20 6669 6c65 6f62 6a3a 2041 6e79 2920  , fileobj: Any) 
-000092e0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000092f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00009300: 2020 6966 2068 6173 6174 7472 2866 696c    if hasattr(fil
-00009310: 656f 626a 2c20 2774 656c 6c5f 636f 6d70  eobj, 'tell_comp
-00009320: 7265 7373 6564 2729 2061 6e64 2073 656c  ressed') and sel
-00009330: 662e 636f 6d70 7265 7373 696f 6e20 3d3d  f.compression ==
-00009340: 2027 627a 3227 3a0a 2020 2020 2020 2020   'bz2':.        
-00009350: 2020 2020 2020 2020 2320 4e6f 7465 2074          # Note t
-00009360: 6861 7420 6265 6361 7573 6520 627a 3220  hat because bz2 
-00009370: 776f 726b 7320 6f6e 2061 2062 6974 7374  works on a bitst
-00009380: 7265 616d 2074 6865 2074 656c 6c5f 636f  ream the tell_co
-00009390: 6d70 7265 7373 6564 2072 6574 7572 6e73  mpressed returns
-000093a0: 2074 6865 206f 6666 7365 7420 696e 2062   the offset in b
-000093b0: 6974 730a 2020 2020 2020 2020 2020 2020  its.            
-000093c0: 2020 2020 7072 6f67 7265 7373 4261 722e      progressBar.
-000093d0: 7570 6461 7465 2866 696c 656f 626a 2e74  update(fileobj.t
-000093e0: 656c 6c5f 636f 6d70 7265 7373 6564 2829  ell_compressed()
-000093f0: 202f 2f20 3829 0a20 2020 2020 2020 2020   // 8).         
-00009400: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
-00009410: 6669 6c65 6f62 6a2c 2027 7465 6c6c 5f63  fileobj, 'tell_c
-00009420: 6f6d 7072 6573 7365 6427 293a 0a20 2020  ompressed'):.   
-00009430: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-00009440: 6772 6573 7342 6172 2e75 7064 6174 6528  gressBar.update(
-00009450: 6669 6c65 6f62 6a2e 7465 6c6c 5f63 6f6d  fileobj.tell_com
-00009460: 7072 6573 7365 6428 2929 0a20 2020 2020  pressed()).     
-00009470: 2020 2020 2020 2065 6c69 6620 6861 7361         elif hasa
-00009480: 7474 7228 6669 6c65 6f62 6a2c 2027 6669  ttr(fileobj, 'fi
-00009490: 6c65 6f62 6a27 293a 0a20 2020 2020 2020  leobj'):.       
-000094a0: 2020 2020 2020 2020 2070 726f 6772 6573           progres
-000094b0: 7342 6172 2e75 7064 6174 6528 6669 6c65  sBar.update(file
-000094c0: 6f62 6a2e 6669 6c65 6f62 6a28 292e 7465  obj.fileobj().te
-000094d0: 6c6c 2829 290a 2020 2020 2020 2020 2020  ll()).          
-000094e0: 2020 656c 6966 2073 656c 662e 7261 7746    elif self.rawF
-000094f0: 696c 654f 626a 6563 7420 616e 6420 6861  ileObject and ha
-00009500: 7361 7474 7228 7365 6c66 2e72 6177 4669  sattr(self.rawFi
-00009510: 6c65 4f62 6a65 6374 2c20 2774 656c 6c27  leObject, 'tell'
-00009520: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00009530: 2020 2070 726f 6772 6573 7342 6172 2e75     progressBar.u
-00009540: 7064 6174 6528 7365 6c66 2e72 6177 4669  pdate(self.rawFi
-00009550: 6c65 4f62 6a65 6374 2e74 656c 6c28 2929  leObject.tell())
-00009560: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00009570: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009580: 2020 2070 726f 6772 6573 7342 6172 2e75     progressBar.u
-00009590: 7064 6174 6528 6669 6c65 6f62 6a2e 7465  pdate(fileobj.te
-000095a0: 6c6c 2829 290a 2020 2020 2020 2020 6578  ll()).        ex
-000095b0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-000095c0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000095d0: 0a0a 2020 2020 6465 6620 5f63 7265 6174  ..    def _creat
-000095e0: 6549 6e64 6578 280a 2020 2020 2020 2020  eIndex(.        
-000095f0: 7365 6c66 2c0a 2020 2020 2020 2020 2320  self,.        # 
-00009600: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
-00009610: 2066 696c 654f 626a 6563 7420 203a 2041   fileObject  : A
-00009620: 6e79 2c0a 2020 2020 2020 2020 7072 6f67  ny,.        prog
-00009630: 7265 7373 4261 7220 3a20 416e 7920 3d20  ressBar : Any = 
-00009640: 4e6f 6e65 2c0a 2020 2020 2020 2020 7061  None,.        pa
-00009650: 7468 5072 6566 6978 2020 3a20 7374 7220  thPrefix  : str 
-00009660: 3d20 2727 2c0a 2020 2020 2020 2020 7374  = '',.        st
-00009670: 7265 616d 4f66 6673 6574 3a20 696e 7420  reamOffset: int 
-00009680: 3d20 300a 2020 2020 2020 2020 2320 666d  = 0.        # fm
-00009690: 743a 206f 6e0a 2020 2020 2920 2d3e 204e  t: on.    ) -> N
-000096a0: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
-000096b0: 7072 696e 7444 6562 7567 203e 3d20 313a  printDebug >= 1:
-000096c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000096d0: 6e74 2822 4372 6561 7469 6e67 206f 6666  nt("Creating off
-000096e0: 7365 7420 6469 6374 696f 6e61 7279 2066  set dictionary f
-000096f0: 6f72 222c 2073 656c 662e 7461 7246 696c  or", self.tarFil
-00009700: 654e 616d 652c 2022 2e2e 2e22 290a 2020  eName, "...").  
-00009710: 2020 2020 2020 7430 203d 2074 696d 6572        t0 = timer
-00009720: 2829 0a0a 2020 2020 2020 2020 2320 312e  ()..        # 1.
-00009730: 2049 6620 6e6f 2053 514c 2063 6f6e 6e65   If no SQL conne
-00009740: 6374 696f 6e20 7761 7320 6769 7665 6e20  ction was given 
-00009750: 2862 7920 7265 6375 7273 6976 6520 6361  (by recursive ca
-00009760: 6c6c 292c 206f 7065 6e20 6120 6e65 7720  ll), open a new 
-00009770: 6461 7461 6261 7365 2066 696c 650a 2020  database file.  
-00009780: 2020 2020 2020 6f70 656e 6564 436f 6e6e        openedConn
-00009790: 6563 7469 6f6e 203d 2046 616c 7365 0a20  ection = False. 
-000097a0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-000097b0: 6c66 2e69 6e64 6578 4973 4c6f 6164 6564  lf.indexIsLoaded
-000097c0: 2829 206f 7220 6e6f 7420 7365 6c66 2e73  () or not self.s
-000097d0: 716c 436f 6e6e 6563 7469 6f6e 3a0a 2020  qlConnection:.  
-000097e0: 2020 2020 2020 2020 2020 6f70 656e 6564            opened
-000097f0: 436f 6e6e 6563 7469 6f6e 203d 2054 7275  Connection = Tru
-00009800: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-00009810: 6c66 2e73 716c 436f 6e6e 6563 7469 6f6e  lf.sqlConnection
-00009820: 203d 2073 656c 662e 5f69 6e69 7469 616c   = self._initial
-00009830: 697a 6553 716c 4462 2873 656c 662e 696e  izeSqlDb(self.in
-00009840: 6465 7846 696c 654e 616d 6529 0a0a 2020  dexFileName)..  
-00009850: 2020 2020 2020 2320 322e 204f 7065 6e20        # 2. Open 
-00009860: 5441 5220 6669 6c65 2072 6561 6465 720a  TAR file reader.
-00009870: 2020 2020 2020 2020 6c6f 6164 6564 5461          loadedTa
-00009880: 7246 696c 653a 2041 6e79 203d 205b 5d20  rFile: Any = [] 
-00009890: 2023 2046 6569 676e 2061 6e20 656d 7074   # Feign an empt
-000098a0: 7920 5441 5220 6669 6c65 2069 6620 616e  y TAR file if an
-000098b0: 7974 6869 6e67 2067 6f65 7320 7772 6f6e  ything goes wron
-000098c0: 670a 2020 2020 2020 2020 6966 2073 656c  g.        if sel
-000098d0: 662e 6973 5461 723a 0a20 2020 2020 2020  f.isTar:.       
-000098e0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000098f0: 2020 2020 2020 2020 2020 2320 723a 2075            # r: u
-00009900: 7365 7320 7365 656b 7320 746f 2073 6b69  ses seeks to ski
-00009910: 7020 746f 2074 6865 206e 6578 7420 6669  p to the next fi
-00009920: 6c65 2069 6e73 6964 6520 7468 6520 5441  le inside the TA
-00009930: 5220 7768 696c 6520 727c 2064 6f65 736e  R while r| doesn
-00009940: 2774 2064 6f20 616e 7920 7365 656b 732e  't do any seeks.
-00009950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009960: 2023 2072 7c20 6d69 6768 7420 6265 2073   # r| might be s
-00009970: 6c6f 7765 7220 6275 7420 666f 7220 636f  lower but for co
-00009980: 6d70 7265 7373 6564 2066 696c 6573 2077  mpressed files w
-00009990: 6520 6861 7665 2074 6f20 676f 206f 7665  e have to go ove
-000099a0: 7220 616c 6c20 7468 6520 6461 7461 206f  r all the data o
-000099b0: 6e63 6520 616e 7977 6179 732e 0a20 2020  nce anyways..   
-000099c0: 2020 2020 2020 2020 2020 2020 2023 204e               # N
-000099d0: 6f74 6520 7468 6174 2077 6974 6820 6967  ote that with ig
-000099e0: 6e6f 7265 5f7a 6572 6f73 203d 2054 7275  nore_zeros = Tru
-000099f0: 652c 206e 6f20 696e 7661 6c69 6420 6865  e, no invalid he
-00009a00: 6164 6572 2069 7373 7565 7320 6f72 2073  ader issues or s
-00009a10: 696d 696c 6172 2077 696c 6c20 6265 2072  imilar will be r
-00009a20: 6169 7365 6420 6576 656e 2066 6f72 0a20  aised even for. 
+00006e10: 7665 7273 696f 6e4e 616d 652c 0a20 2020  versionName,.   
+00006e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e30: 2076 6572 7369 6f6e 2c0a 2020 2020 2020   version,.      
+00006e40: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+00006e50: 7273 696f 6e4e 756d 6265 7273 5b30 5d20  rsionNumbers[0] 
+00006e60: 6966 206c 656e 2876 6572 7369 6f6e 4e75  if len(versionNu
+00006e70: 6d62 6572 7329 203e 2030 2065 6c73 6520  mbers) > 0 else 
+00006e80: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+00006e90: 2020 2020 2020 2020 2020 7665 7273 696f            versio
+00006ea0: 6e4e 756d 6265 7273 5b31 5d20 6966 206c  nNumbers[1] if l
+00006eb0: 656e 2876 6572 7369 6f6e 4e75 6d62 6572  en(versionNumber
+00006ec0: 7329 203e 2031 2065 6c73 6520 4e6f 6e65  s) > 1 else None
+00006ed0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006ee0: 2020 2020 2020 7665 7273 696f 6e4e 756d        versionNum
+00006ef0: 6265 7273 5b32 5d20 6966 206c 656e 2876  bers[2] if len(v
+00006f00: 6572 7369 6f6e 4e75 6d62 6572 7329 203e  ersionNumbers) >
+00006f10: 2032 2065 6c73 6520 4e6f 6e65 2c0a 2020   2 else None,.  
+00006f20: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00006f30: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
+00006f40: 7369 6f6e 7320 3d20 5b0a 2020 2020 2020  sions = [.      
+00006f50: 2020 2020 2020 2020 2020 6d61 6b65 5665            makeVe
+00006f60: 7273 696f 6e52 6f77 2827 7261 7461 726d  rsionRow('ratarm
+00006f70: 6f75 6e74 272c 205f 5f76 6572 7369 6f6e  ount', __version
+00006f80: 5f5f 292c 0a20 2020 2020 2020 2020 2020  __),.           
+00006f90: 2020 2020 206d 616b 6556 6572 7369 6f6e       makeVersion
+00006fa0: 526f 7728 2769 6e64 6578 272c 2053 514c  Row('index', SQL
+00006fb0: 6974 6549 6e64 6578 6564 5461 722e 5f5f  iteIndexedTar.__
+00006fc0: 7665 7273 696f 6e5f 5f29 2c0a 2020 2020  version__),.    
+00006fd0: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
+00006fe0: 2020 2020 2020 2066 6f72 205f 2c20 6369         for _, ci
+00006ff0: 6e66 6f20 696e 2073 7570 706f 7274 6564  nfo in supported
+00007000: 436f 6d70 7265 7373 696f 6e73 2e69 7465  Compressions.ite
+00007010: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00007020: 2020 2020 2020 6966 2063 696e 666f 2e6d        if cinfo.m
+00007030: 6f64 756c 654e 616d 6520 696e 2067 6c6f  oduleName in glo
+00007040: 6261 6c73 2829 3a0a 2020 2020 2020 2020  bals():.        
+00007050: 2020 2020 2020 2020 2020 2020 6d6f 6475              modu
+00007060: 6c65 203d 2067 6c6f 6261 6c73 2829 5b63  le = globals()[c
+00007070: 696e 666f 2e6d 6f64 756c 654e 616d 655d  info.moduleName]
+00007080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007090: 2020 2020 2023 207a 6970 6669 6c65 2068       # zipfile h
+000070a0: 6173 206e 6f20 5f5f 7665 7273 696f 6e5f  as no __version_
+000070b0: 5f20 6174 7472 6962 7574 6520 616e 6420  _ attribute and 
+000070c0: 5045 5020 3339 3620 656e 7375 7269 6e67  PEP 396 ensuring
+000070d0: 2074 6861 7420 7761 7320 7265 6a65 6374   that was reject
+000070e0: 6564 2032 3032 312d 3034 2d31 340a 2020  ed 2021-04-14.  
+000070f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007100: 2020 2320 696e 2066 6176 6f72 206f 6620    # in favor of 
+00007110: 2776 6572 7369 6f6e 2720 6672 6f6d 2069  'version' from i
+00007120: 6d70 6f72 746c 6962 2e6d 6574 6164 6174  mportlib.metadat
+00007130: 6120 7768 6963 6820 646f 6573 206e 6f74  a which does not
+00007140: 2065 7665 6e20 776f 726b 2077 6974 6820   even work with 
+00007150: 7a69 7066 696c 652e 0a20 2020 2020 2020  zipfile..       
+00007160: 2020 2020 2020 2020 2020 2020 2023 2050               # P
+00007170: 726f 6261 626c 792c 2062 6563 6175 7365  robably, because
+00007180: 207a 6970 6669 6c65 2069 7320 6120 6275   zipfile is a bu
+00007190: 696c 742d 696e 206d 6f64 756c 6520 7768  ilt-in module wh
+000071a0: 6f73 6520 7665 7273 696f 6e20 776f 756c  ose version woul
+000071b0: 6420 6265 2074 6865 2050 7974 686f 6e20  d be the Python 
+000071c0: 7665 7273 696f 6e2e 0a20 2020 2020 2020  version..       
+000071d0: 2020 2020 2020 2020 2020 2020 2023 2068               # h
+000071e0: 7474 7073 3a2f 2f77 7777 2e70 7974 686f  ttps://www.pytho
+000071f0: 6e2e 6f72 672f 6465 762f 7065 7073 2f70  n.org/dev/peps/p
+00007200: 6570 2d30 3339 362f 0a20 2020 2020 2020  ep-0396/.       
+00007210: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00007220: 6865 2022 7079 7468 6f6e 2d78 7a22 2070  he "python-xz" p
+00007230: 726f 6a65 6374 2069 7320 696d 706f 7274  roject is import
+00007240: 6564 2061 7320 616e 2022 787a 2220 6d6f  ed as an "xz" mo
+00007250: 6475 6c65 2c20 7768 6963 6820 636f 6d70  dule, which comp
+00007260: 6c69 6361 7465 7320 7468 696e 6773 2062  licates things b
+00007270: 6563 6175 7365 0a20 2020 2020 2020 2020  ecause.         
+00007280: 2020 2020 2020 2020 2020 2023 2074 6865             # the
+00007290: 7265 2069 7320 6e6f 2067 656e 6572 6963  re is no generic
+000072a0: 2077 6179 2074 6f20 6765 7420 7468 6520   way to get the 
+000072b0: 2270 7974 686f 6e2d 787a 2220 6e61 6d65  "python-xz" name
+000072c0: 2066 726f 6d20 7468 6520 2278 7a22 2072   from the "xz" r
+000072d0: 756e 7469 6d65 206d 6f64 756c 6520 6f62  untime module ob
+000072e0: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+000072f0: 2020 2020 2020 2020 2023 2061 6e64 2069           # and i
+00007300: 6d70 6f72 746c 6962 2e6d 6574 6164 6174  mportlib.metadat
+00007310: 612e 7665 7273 696f 6e20 7769 6c6c 2072  a.version will r
+00007320: 6571 7569 7265 2022 7079 7468 6f6e 2d78  equire "python-x
+00007330: 7a22 2061 7320 6172 6775 6d65 6e74 2e0a  z" as argument..
+00007340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007350: 2020 2020 6966 2068 6173 6174 7472 286d      if hasattr(m
+00007360: 6f64 756c 652c 2027 5f5f 7665 7273 696f  odule, '__versio
+00007370: 6e5f 5f27 293a 0a20 2020 2020 2020 2020  n__'):.         
+00007380: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00007390: 6572 7369 6f6e 7320 2b3d 205b 6d61 6b65  ersions += [make
+000073a0: 5665 7273 696f 6e52 6f77 2863 696e 666f  VersionRow(cinfo
+000073b0: 2e6d 6f64 756c 654e 616d 652c 206d 6f64  .moduleName, mod
+000073c0: 756c 652e 5f5f 7665 7273 696f 6e5f 5f29  ule.__version__)
+000073d0: 5d0a 0a20 2020 2020 2020 2020 2020 2063  ]..            c
+000073e0: 6f6e 6e65 6374 696f 6e2e 6578 6563 7574  onnection.execut
+000073f0: 656d 616e 7928 2749 4e53 4552 5420 4f52  emany('INSERT OR
+00007400: 2052 4550 4c41 4345 2049 4e54 4f20 2276   REPLACE INTO "v
+00007410: 6572 7369 6f6e 7322 2056 414c 5545 5320  ersions" VALUES 
+00007420: 283f 2c3f 2c3f 2c3f 2c3f 2927 2c20 7665  (?,?,?,?,?)', ve
+00007430: 7273 696f 6e73 290a 2020 2020 2020 2020  rsions).        
+00007440: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00007450: 2061 7320 6578 6365 7074 696f 6e3a 0a20   as exception:. 
+00007460: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00007470: 2822 5b57 6172 6e69 6e67 5d20 5468 6572  ("[Warning] Ther
+00007480: 6520 7761 7320 616e 2065 7272 6f72 2077  e was an error w
+00007490: 6865 6e20 6164 6469 6e67 2076 6572 7369  hen adding versi
+000074a0: 6f6e 2069 6e66 6f72 6d61 7469 6f6e 2e22  on information."
+000074b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000074c0: 2070 7269 6e74 4465 6275 6720 3e3d 2033   printDebug >= 3
+000074d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000074e0: 2020 7072 696e 7428 6578 6365 7074 696f    print(exceptio
+000074f0: 6e29 0a0a 2020 2020 4073 7461 7469 636d  n)..    @staticm
+00007500: 6574 686f 640a 2020 2020 6465 6620 5f73  ethod.    def _s
+00007510: 746f 7265 5461 724d 6574 6164 6174 6128  toreTarMetadata(
+00007520: 636f 6e6e 6563 7469 6f6e 3a20 7371 6c69  connection: sqli
+00007530: 7465 332e 436f 6e6e 6563 7469 6f6e 2c20  te3.Connection, 
+00007540: 7461 7250 6174 683a 2041 6e79 5374 7229  tarPath: AnyStr)
+00007550: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00007560: 2020 2222 2241 6464 7320 736f 6d65 2063    """Adds some c
+00007570: 6f6e 7369 7374 656e 6379 206d 6574 6120  onsistency meta 
+00007580: 696e 666f 726d 6174 696f 6e20 746f 2072  information to r
+00007590: 6563 6f67 6e69 7a65 2074 6865 206e 6565  ecognize the nee
+000075a0: 6420 746f 2075 7064 6174 6520 7468 6520  d to update the 
+000075b0: 6361 6368 6564 2054 4152 2069 6e64 6578  cached TAR index
+000075c0: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
+000075d0: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
+000075e0: 5374 6174 7320 3d20 6f73 2e73 7461 7428  Stats = os.stat(
+000075f0: 7461 7250 6174 6829 0a20 2020 2020 2020  tarPath).       
+00007600: 2020 2020 2073 6572 6961 6c69 7a65 6454       serializedT
+00007610: 6172 5374 6174 7320 3d20 6a73 6f6e 2e64  arStats = json.d
+00007620: 756d 7073 280a 2020 2020 2020 2020 2020  umps(.          
+00007630: 2020 2020 2020 7b61 7474 723a 2067 6574        {attr: get
+00007640: 6174 7472 2874 6172 5374 6174 732c 2061  attr(tarStats, a
+00007650: 7474 7229 2066 6f72 2061 7474 7220 696e  ttr) for attr in
+00007660: 2064 6972 2874 6172 5374 6174 7329 2069   dir(tarStats) i
+00007670: 6620 6174 7472 2e73 7461 7274 7377 6974  f attr.startswit
+00007680: 6828 2773 745f 2729 7d0a 2020 2020 2020  h('st_')}.      
+00007690: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000076a0: 2020 2020 636f 6e6e 6563 7469 6f6e 2e65      connection.e
+000076b0: 7865 6375 7465 2827 494e 5345 5254 2049  xecute('INSERT I
+000076c0: 4e54 4f20 226d 6574 6164 6174 6122 2056  NTO "metadata" V
+000076d0: 414c 5545 5320 283f 2c3f 2927 2c20 2822  ALUES (?,?)', ("
+000076e0: 7461 7273 7461 7473 222c 2073 6572 6961  tarstats", seria
+000076f0: 6c69 7a65 6454 6172 5374 6174 7329 290a  lizedTarStats)).
+00007700: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00007710: 7863 6570 7469 6f6e 2061 7320 6578 6365  xception as exce
+00007720: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00007730: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
+00007740: 203e 3d20 323a 0a20 2020 2020 2020 2020   >= 2:.         
+00007750: 2020 2020 2020 2070 7269 6e74 2865 7863         print(exc
+00007760: 6570 7469 6f6e 290a 2020 2020 2020 2020  eption).        
+00007770: 2020 2020 7072 696e 7428 225b 5761 726e      print("[Warn
+00007780: 696e 675d 2054 6865 7265 2077 6173 2061  ing] There was a
+00007790: 6e20 6572 726f 7220 7768 656e 2061 6464  n error when add
+000077a0: 696e 6720 6669 6c65 206d 6574 6164 6174  ing file metadat
+000077b0: 612e 2229 0a20 2020 2020 2020 2020 2020  a.").           
+000077c0: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+000077d0: 5d20 4175 746f 6d61 7469 6320 6465 7465  ] Automatic dete
+000077e0: 6374 696f 6e20 6f66 2063 6861 6e67 6564  ction of changed
+000077f0: 2054 4152 2066 696c 6573 2064 7572 696e   TAR files durin
+00007800: 6720 696e 6465 7820 6c6f 6164 696e 6720  g index loading 
+00007810: 6d69 6768 7420 6e6f 7420 776f 726b 2e22  might not work."
+00007820: 290a 0a20 2020 2064 6566 205f 7374 6f72  )..    def _stor
+00007830: 6541 7267 756d 656e 7473 4d65 7461 6461  eArgumentsMetada
+00007840: 7461 2873 656c 662c 2063 6f6e 6e65 6374  ta(self, connect
+00007850: 696f 6e3a 2073 716c 6974 6533 2e43 6f6e  ion: sqlite3.Con
+00007860: 6e65 6374 696f 6e29 202d 3e20 4e6f 6e65  nection) -> None
+00007870: 3a0a 2020 2020 2020 2020 6172 6775 6d65  :.        argume
+00007880: 6e74 7354 6f53 6176 6520 3d20 5b0a 2020  ntsToSave = [.  
+00007890: 2020 2020 2020 2020 2020 276d 6f75 6e74            'mount
+000078a0: 5265 6375 7273 6976 656c 7927 2c0a 2020  Recursively',.  
+000078b0: 2020 2020 2020 2020 2020 2767 7a69 7053            'gzipS
+000078c0: 6565 6b50 6f69 6e74 5370 6163 696e 6727  eekPointSpacing'
+000078d0: 2c0a 2020 2020 2020 2020 2020 2020 2765  ,.            'e
+000078e0: 6e63 6f64 696e 6727 2c0a 2020 2020 2020  ncoding',.      
+000078f0: 2020 2020 2020 2773 7472 6970 5265 6375        'stripRecu
+00007900: 7273 6976 6554 6172 4578 7465 6e73 696f  rsiveTarExtensio
+00007910: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
+00007920: 2769 676e 6f72 655a 6572 6f73 272c 0a20  'ignoreZeros',. 
+00007930: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
+00007940: 2020 6172 6775 6d65 6e74 734d 6574 6164    argumentsMetad
+00007950: 6174 6120 3d20 6a73 6f6e 2e64 756d 7073  ata = json.dumps
+00007960: 287b 6172 6775 6d65 6e74 3a20 6765 7461  ({argument: geta
+00007970: 7474 7228 7365 6c66 2c20 6172 6775 6d65  ttr(self, argume
+00007980: 6e74 2920 666f 7220 6172 6775 6d65 6e74  nt) for argument
+00007990: 2069 6e20 6172 6775 6d65 6e74 7354 6f53   in argumentsToS
+000079a0: 6176 657d 290a 0a20 2020 2020 2020 2074  ave})..        t
+000079b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000079c0: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
+000079d0: 7465 2827 494e 5345 5254 2049 4e54 4f20  te('INSERT INTO 
+000079e0: 226d 6574 6164 6174 6122 2056 414c 5545  "metadata" VALUE
+000079f0: 5320 283f 2c3f 2927 2c20 2822 6172 6775  S (?,?)', ("argu
+00007a00: 6d65 6e74 7322 2c20 6172 6775 6d65 6e74  ments", argument
+00007a10: 734d 6574 6164 6174 6129 290a 2020 2020  sMetadata)).    
+00007a20: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00007a30: 7469 6f6e 2061 7320 6578 6365 7074 696f  tion as exceptio
+00007a40: 6e3a 0a20 2020 2020 2020 2020 2020 2069  n:.            i
+00007a50: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
+00007a60: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+00007a70: 2020 2070 7269 6e74 2865 7863 6570 7469     print(excepti
+00007a80: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+00007a90: 7072 696e 7428 225b 5761 726e 696e 675d  print("[Warning]
+00007aa0: 2054 6865 7265 2077 6173 2061 6e20 6572   There was an er
+00007ab0: 726f 7220 7768 656e 2061 6464 696e 6720  ror when adding 
+00007ac0: 6172 6775 6d65 6e74 206d 6574 6164 6174  argument metadat
+00007ad0: 612e 2229 0a20 2020 2020 2020 2020 2020  a.").           
+00007ae0: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+00007af0: 5d20 4175 746f 6d61 7469 6320 6465 7465  ] Automatic dete
+00007b00: 6374 696f 6e20 6f66 2063 6861 6e67 6564  ction of changed
+00007b10: 2061 7267 756d 656e 7473 2066 696c 6573   arguments files
+00007b20: 2064 7572 696e 6720 696e 6465 7820 6c6f   during index lo
+00007b30: 6164 696e 6720 6d69 6768 7420 6e6f 7420  ading might not 
+00007b40: 776f 726b 2e22 290a 0a20 2020 2040 7374  work.")..    @st
+00007b50: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00007b60: 6566 205f 7061 7468 4973 5772 6974 6162  ef _pathIsWritab
+00007b70: 6c65 2870 6174 683a 2041 6e79 5374 7229  le(path: AnyStr)
+00007b80: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00007b90: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00007ba0: 2020 2066 6f6c 6465 7220 3d20 6f73 2e70     folder = os.p
+00007bb0: 6174 682e 6469 726e 616d 6528 7061 7468  ath.dirname(path
+00007bc0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00007bd0: 2066 6f6c 6465 723a 0a20 2020 2020 2020   folder:.       
+00007be0: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
+00007bf0: 6469 7273 2866 6f6c 6465 722c 2065 7869  dirs(folder, exi
+00007c00: 7374 5f6f 6b3d 5472 7565 290a 0a20 2020  st_ok=True)..   
+00007c10: 2020 2020 2020 2020 2066 203d 206f 7065           f = ope
+00007c20: 6e28 7061 7468 2c20 2777 6227 290a 2020  n(path, 'wb').  
+00007c30: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
+00007c40: 6528 6227 5c30 2720 2a20 3130 3234 202a  e(b'\0' * 1024 *
+00007c50: 2031 3032 3429 0a20 2020 2020 2020 2020   1024).         
+00007c60: 2020 2066 2e63 6c6f 7365 2829 0a20 2020     f.close().   
+00007c70: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+00007c80: 7665 2870 6174 6829 0a0a 2020 2020 2020  ve(path)..      
+00007c90: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00007ca0: 650a 0a20 2020 2020 2020 2065 7863 6570  e..        excep
+00007cb0: 7420 5065 726d 6973 7369 6f6e 4572 726f  t PermissionErro
+00007cc0: 723a 0a20 2020 2020 2020 2020 2020 2069  r:.            i
+00007cd0: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
+00007ce0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+00007cf0: 2020 2074 7261 6365 6261 636b 2e70 7269     traceback.pri
+00007d00: 6e74 5f65 7863 2829 0a20 2020 2020 2020  nt_exc().       
+00007d10: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00007d20: 436f 756c 6420 6e6f 7420 6372 6561 7465  Could not create
+00007d30: 2066 696c 653a 222c 2070 6174 6829 0a0a   file:", path)..
+00007d40: 2020 2020 2020 2020 6578 6365 7074 2049          except I
+00007d50: 4f45 7272 6f72 3a0a 2020 2020 2020 2020  OError:.        
+00007d60: 2020 2020 6966 2070 7269 6e74 4465 6275      if printDebu
+00007d70: 6720 3e3d 2032 3a0a 2020 2020 2020 2020  g >= 2:.        
+00007d80: 2020 2020 2020 2020 7472 6163 6562 6163          tracebac
+00007d90: 6b2e 7072 696e 745f 6578 6328 290a 2020  k.print_exc().  
+00007da0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00007db0: 696e 7428 2243 6f75 6c64 206e 6f74 2063  int("Could not c
+00007dc0: 7265 6174 6520 6669 6c65 3a22 2c20 7061  reate file:", pa
+00007dd0: 7468 290a 0a20 2020 2020 2020 2072 6574  th)..        ret
+00007de0: 7572 6e20 4661 6c73 650a 0a20 2020 2040  urn False..    @
+00007df0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00007e00: 2064 6566 205f 7061 7468 4361 6e42 6555   def _pathCanBeU
+00007e10: 7365 6446 6f72 5371 6c69 7465 2870 6174  sedForSqlite(pat
+00007e20: 683a 2041 6e79 5374 7229 202d 3e20 626f  h: AnyStr) -> bo
+00007e30: 6f6c 3a0a 2020 2020 2020 2020 6669 6c65  ol:.        file
+00007e40: 4578 6973 7465 6420 3d20 6f73 2e70 6174  Existed = os.pat
+00007e50: 682e 6973 6669 6c65 2870 6174 6829 0a20  h.isfile(path). 
+00007e60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00007e70: 2020 2020 2020 2020 666f 6c64 6572 203d          folder =
+00007e80: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+00007e90: 2870 6174 6829 0a20 2020 2020 2020 2020  (path).         
+00007ea0: 2020 2069 6620 666f 6c64 6572 3a0a 2020     if folder:.  
+00007eb0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+00007ec0: 2e6d 616b 6564 6972 7328 666f 6c64 6572  .makedirs(folder
+00007ed0: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
+00007ee0: 0a0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00007ef0: 6e6e 6563 7469 6f6e 203d 2053 514c 6974  nnection = SQLit
+00007f00: 6549 6e64 6578 6564 5461 722e 5f6f 7065  eIndexedTar._ope
+00007f10: 6e53 716c 4462 2870 6174 6829 0a20 2020  nSqlDb(path).   
+00007f20: 2020 2020 2020 2020 2063 6f6e 6e65 6374           connect
+00007f30: 696f 6e2e 6578 6563 7574 6573 6372 6970  ion.executescrip
+00007f40: 7428 2743 5245 4154 4520 5441 424c 4520  t('CREATE TABLE 
+00007f50: 2266 696c 6573 2220 2820 2270 6174 6822  "files" ( "path"
+00007f60: 2056 4152 4348 4152 2836 3535 3335 2920   VARCHAR(65535) 
+00007f70: 4e4f 5420 4e55 4c4c 2029 3b27 290a 2020  NOT NULL );').  
+00007f80: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
+00007f90: 7469 6f6e 2e63 6f6d 6d69 7428 290a 2020  tion.commit().  
+00007fa0: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
+00007fb0: 7469 6f6e 2e63 6c6f 7365 2829 0a20 2020  tion.close().   
+00007fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007fd0: 5472 7565 0a20 2020 2020 2020 2065 7863  True.        exc
+00007fe0: 6570 7420 7371 6c69 7465 332e 4f70 6572  ept sqlite3.Oper
+00007ff0: 6174 696f 6e61 6c45 7272 6f72 3a0a 2020  ationalError:.  
+00008000: 2020 2020 2020 2020 2020 6966 2070 7269            if pri
+00008010: 6e74 4465 6275 6720 3e3d 2032 3a0a 2020  ntDebug >= 2:.  
+00008020: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00008030: 6163 6562 6163 6b2e 7072 696e 745f 6578  aceback.print_ex
+00008040: 6328 290a 2020 2020 2020 2020 2020 2020  c().            
+00008050: 2020 2020 7072 696e 7428 2243 6f75 6c64      print("Could
+00008060: 206e 6f74 2063 7265 6174 6520 5351 4c69   not create SQLi
+00008070: 7465 2064 6174 6162 6173 6520 6174 3a22  te database at:"
+00008080: 2c20 7061 7468 290a 2020 2020 2020 2020  , path).        
+00008090: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+000080a0: 2020 2020 2069 6620 6e6f 7420 6669 6c65       if not file
+000080b0: 4578 6973 7465 6420 616e 6420 6f73 2e70  Existed and os.p
+000080c0: 6174 682e 6973 6669 6c65 2870 6174 6829  ath.isfile(path)
+000080d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000080e0: 2020 5351 4c69 7465 496e 6465 7865 6454    SQLiteIndexedT
+000080f0: 6172 2e5f 756e 6368 6563 6b65 6452 656d  ar._uncheckedRem
+00008100: 6f76 6528 7061 7468 290a 0a20 2020 2020  ove(path)..     
+00008110: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00008120: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00008130: 6f64 0a20 2020 2064 6566 205f 6f70 656e  od.    def _open
+00008140: 5371 6c44 6228 7061 7468 3a20 416e 7953  SqlDb(path: AnyS
+00008150: 7472 2c20 2a2a 6b77 6172 6773 2920 2d3e  tr, **kwargs) ->
+00008160: 2073 716c 6974 6533 2e43 6f6e 6e65 6374   sqlite3.Connect
+00008170: 696f 6e3a 0a20 2020 2020 2020 2073 716c  ion:.        sql
+00008180: 436f 6e6e 6563 7469 6f6e 203d 2073 716c  Connection = sql
+00008190: 6974 6533 2e63 6f6e 6e65 6374 2870 6174  ite3.connect(pat
+000081a0: 682c 202a 2a6b 7761 7267 7329 0a20 2020  h, **kwargs).   
+000081b0: 2020 2020 2073 716c 436f 6e6e 6563 7469       sqlConnecti
+000081c0: 6f6e 2e72 6f77 5f66 6163 746f 7279 203d  on.row_factory =
+000081d0: 2073 716c 6974 6533 2e52 6f77 0a20 2020   sqlite3.Row.   
+000081e0: 2020 2020 2073 716c 436f 6e6e 6563 7469       sqlConnecti
+000081f0: 6f6e 2e65 7865 6375 7465 7363 7269 7074  on.executescript
+00008200: 280a 2020 2020 2020 2020 2020 2020 2320  (.            # 
+00008210: 4c6f 6f6b 696e 6720 6d6f 6465 2065 7863  Looking mode exc
+00008220: 6c75 7369 7665 206c 6561 6473 2074 6f20  lusive leads to 
+00008230: 6120 6d65 6173 7572 6162 6c65 2073 7065  a measurable spe
+00008240: 6564 7570 2e20 452e 672e 2c20 6669 6e64  edup. E.g., find
+00008250: 206f 6e20 326b 2072 6563 7572 7369 7665   on 2k recursive
+00008260: 2066 696c 6573 2074 6172 0a20 2020 2020   files tar.     
+00008270: 2020 2020 2020 2023 2069 6d70 726f 7665         # improve
+00008280: 7320 6672 6f6d 207e 3173 2074 6f20 7e30  s from ~1s to ~0
+00008290: 2e34 7321 0a20 2020 2020 2020 2020 2020  .4s!.           
+000082a0: 2023 2068 7474 7073 3a2f 2f62 6c6f 672e   # https://blog.
+000082b0: 6465 7661 7274 2e63 6f6d 2f69 6e63 7265  devart.com/incre
+000082c0: 6173 696e 672d 7371 6c69 7465 2d70 6572  asing-sqlite-per
+000082d0: 666f 726d 616e 6365 2e68 746d 6c0a 2020  formance.html.  
+000082e0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+000082f0: 2020 2020 2020 2020 2020 5052 4147 4d41            PRAGMA
+00008300: 204c 4f43 4b49 4e47 5f4d 4f44 4520 3d20   LOCKING_MODE = 
+00008310: 4558 434c 5553 4956 453b 0a20 2020 2020  EXCLUSIVE;.     
+00008320: 2020 2020 2020 2050 5241 474d 4120 5445         PRAGMA TE
+00008330: 4d50 5f53 544f 5245 203d 204d 454d 4f52  MP_STORE = MEMOR
+00008340: 593b 0a20 2020 2020 2020 2020 2020 2050  Y;.            P
+00008350: 5241 474d 4120 4a4f 5552 4e41 4c5f 4d4f  RAGMA JOURNAL_MO
+00008360: 4445 203d 204f 4646 3b0a 2020 2020 2020  DE = OFF;.      
+00008370: 2020 2020 2020 5052 4147 4d41 2053 594e        PRAGMA SYN
+00008380: 4348 524f 4e4f 5553 203d 204f 4646 3b0a  CHRONOUS = OFF;.
+00008390: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+000083a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000083b0: 2020 7265 7475 726e 2073 716c 436f 6e6e    return sqlConn
+000083c0: 6563 7469 6f6e 0a0a 2020 2020 4073 7461  ection..    @sta
+000083d0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+000083e0: 6620 5f69 6e69 7469 616c 697a 6553 716c  f _initializeSql
+000083f0: 4462 2869 6e64 6578 4669 6c65 4e61 6d65  Db(indexFileName
+00008400: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d29  : Optional[str])
+00008410: 202d 3e20 7371 6c69 7465 332e 436f 6e6e   -> sqlite3.Conn
+00008420: 6563 7469 6f6e 3a0a 2020 2020 2020 2020  ection:.        
+00008430: 6966 2070 7269 6e74 4465 6275 6720 3e3d  if printDebug >=
+00008440: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00008450: 7072 696e 7428 2243 7265 6174 696e 6720  print("Creating 
+00008460: 6e65 7720 5351 4c69 7465 2069 6e64 6578  new SQLite index
+00008470: 2064 6174 6162 6173 6520 6174 222c 2069   database at", i
+00008480: 6e64 6578 4669 6c65 4e61 6d65 2069 6620  ndexFileName if 
+00008490: 696e 6465 7846 696c 654e 616d 6520 656c  indexFileName el
+000084a0: 7365 2027 3a6d 656d 6f72 793a 2729 0a0a  se ':memory:')..
+000084b0: 2020 2020 2020 2020 6372 6561 7465 5461          createTa
+000084c0: 626c 6573 203d 2022 2222 0a20 2020 2020  bles = """.     
+000084d0: 2020 2020 2020 2043 5245 4154 4520 5441         CREATE TA
+000084e0: 424c 4520 2266 696c 6573 2220 280a 2020  BLE "files" (.  
+000084f0: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+00008500: 6174 6822 2020 2020 2020 2020 2020 5641  ath"          VA
+00008510: 5243 4841 5228 3635 3533 3529 204e 4f54  RCHAR(65535) NOT
+00008520: 204e 554c 4c2c 2020 2f2a 2070 6174 6820   NULL,  /* path 
+00008530: 7769 7468 206c 6561 6469 6e67 2061 6e64  with leading and
+00008540: 2077 6974 686f 7574 2074 7261 696c 696e   without trailin
+00008550: 6720 736c 6173 6820 2a2f 0a20 2020 2020  g slash */.     
+00008560: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+00008570: 2220 2020 2020 2020 2020 2056 4152 4348  "          VARCH
+00008580: 4152 2836 3535 3335 2920 4e4f 5420 4e55  AR(65535) NOT NU
+00008590: 4c4c 2c0a 2020 2020 2020 2020 2020 2020  LL,.            
+000085a0: 2020 2020 226f 6666 7365 7468 6561 6465      "offsetheade
+000085b0: 7222 2020 494e 5445 4745 522c 2020 2f2a  r"  INTEGER,  /*
+000085c0: 2073 6565 6b20 6f66 6673 6574 2066 726f   seek offset fro
+000085d0: 6d20 5441 5220 6669 6c65 2077 6865 7265  m TAR file where
+000085e0: 2074 6865 2054 4152 206d 6574 6164 6174   the TAR metadat
+000085f0: 6120 666f 7220 7468 6973 2066 696c 6520  a for this file 
+00008600: 7265 7369 6465 7320 2a2f 0a20 2020 2020  resides */.     
+00008610: 2020 2020 2020 2020 2020 2022 6f66 6673             "offs
+00008620: 6574 2220 2020 2020 2020 2049 4e54 4547  et"        INTEG
+00008630: 4552 2c20 202f 2a20 7365 656b 206f 6666  ER,  /* seek off
+00008640: 7365 7420 6672 6f6d 2054 4152 2066 696c  set from TAR fil
+00008650: 6520 7768 6572 6520 7468 6573 6520 6669  e where these fi
+00008660: 6c65 2773 2063 6f6e 7465 6e74 7320 7265  le's contents re
+00008670: 7369 6465 7320 2a2f 0a20 2020 2020 2020  sides */.       
+00008680: 2020 2020 2020 2020 2022 7369 7a65 2220           "size" 
+00008690: 2020 2020 2020 2020 2049 4e54 4547 4552           INTEGER
+000086a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000086b0: 2020 226d 7469 6d65 2220 2020 2020 2020    "mtime"       
+000086c0: 2020 494e 5445 4745 522c 0a20 2020 2020    INTEGER,.     
+000086d0: 2020 2020 2020 2020 2020 2022 6d6f 6465             "mode
+000086e0: 2220 2020 2020 2020 2020 2049 4e54 4547  "          INTEG
+000086f0: 4552 2c0a 2020 2020 2020 2020 2020 2020  ER,.            
+00008700: 2020 2020 2274 7970 6522 2020 2020 2020      "type"      
+00008710: 2020 2020 494e 5445 4745 522c 0a20 2020      INTEGER,.   
+00008720: 2020 2020 2020 2020 2020 2020 2022 6c69               "li
+00008730: 6e6b 6e61 6d65 2220 2020 2020 2056 4152  nkname"      VAR
+00008740: 4348 4152 2836 3535 3335 292c 0a20 2020  CHAR(65535),.   
+00008750: 2020 2020 2020 2020 2020 2020 2022 7569               "ui
+00008760: 6422 2020 2020 2020 2020 2020 2049 4e54  d"           INT
+00008770: 4547 4552 2c0a 2020 2020 2020 2020 2020  EGER,.          
+00008780: 2020 2020 2020 2267 6964 2220 2020 2020        "gid"     
+00008790: 2020 2020 2020 494e 5445 4745 522c 0a20        INTEGER,. 
+000087a0: 2020 2020 2020 2020 2020 2020 2020 202f                 /
+000087b0: 2a20 5472 7565 2066 6f72 2076 616c 6964  * True for valid
+000087c0: 2054 4152 2066 696c 6573 2e20 496e 7465   TAR files. Inte
+000087d0: 726e 616c 6c79 2075 7365 6420 746f 2064  rnally used to d
+000087e0: 6574 6572 6d69 6e65 2077 6865 7265 2074  etermine where t
+000087f0: 6f20 6d6f 756e 7420 7265 6375 7273 6976  o mount recursiv
+00008800: 6520 5441 5220 6669 6c65 732e 202a 2f0a  e TAR files. */.
+00008810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008820: 2269 7374 6172 2220 2020 2020 2020 2020  "istar"         
+00008830: 424f 4f4c 2020 202c 0a20 2020 2020 2020  BOOL   ,.       
+00008840: 2020 2020 2020 2020 2022 6973 7370 6172           "isspar
+00008850: 7365 2220 2020 2020 2042 4f4f 4c20 2020  se"      BOOL   
+00008860: 2c20 202f 2a20 666f 7220 7370 6172 7365  ,  /* for sparse
+00008870: 2066 696c 6573 2074 6865 2066 696c 6520   files the file 
+00008880: 7369 7a65 2072 6566 6572 7320 746f 2074  size refers to t
+00008890: 6865 2065 7870 616e 6465 6420 7369 7a65  he expanded size
+000088a0: 2120 2a2f 0a20 2020 2020 2020 2020 2020  ! */.           
+000088b0: 2020 2020 202f 2a20 5365 6520 5351 4c20       /* See SQL 
+000088c0: 6265 6e63 686d 6172 6b73 2066 6f72 2064  benchmarks for d
+000088d0: 6563 6973 696f 6e20 6f6e 2074 6865 2070  ecision on the p
+000088e0: 7269 6d61 7279 206b 6579 2e0a 2020 2020  rimary key..    
+000088f0: 2020 2020 2020 2020 2020 2020 202a 2053               * S
+00008900: 6565 2061 6c73 6f20 6874 7470 733a 2f2f  ee also https://
+00008910: 7777 772e 7371 6c69 7465 2e6f 7267 2f6f  www.sqlite.org/o
+00008920: 7074 6f76 6572 7669 6577 2e68 746d 6c0a  ptoverview.html.
+00008930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008940: 202a 2028 7061 7468 2c6e 616d 6529 2074   * (path,name) t
+00008950: 7570 6c65 7320 6d69 6768 7420 6170 7065  uples might appe
+00008960: 6172 206d 756c 7469 706c 6520 7469 6d65  ar multiple time
+00008970: 7320 696e 2061 2054 4152 2069 6620 6974  s in a TAR if it
+00008980: 2067 6f74 2075 7064 6174 6564 2e0a 2020   got updated..  
+00008990: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+000089a0: 2049 6e20 6f72 6465 7220 746f 2061 6c73   In order to als
+000089b0: 6f20 6265 2061 626c 6520 746f 2073 686f  o be able to sho
+000089c0: 7720 6f6c 6465 7220 7665 7273 696f 6e73  w older versions
+000089d0: 2c20 7765 206e 6565 6420 746f 2061 6464  , we need to add
+000089e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000089f0: 2020 2a20 7468 6520 6f66 6673 6574 6865    * the offsethe
+00008a00: 6164 6572 2063 6f6c 756d 6e20 746f 2074  ader column to t
+00008a10: 6865 2070 7269 6d61 7279 206b 6579 2e20  he primary key. 
+00008a20: 2a2f 0a20 2020 2020 2020 2020 2020 2020  */.             
+00008a30: 2020 2050 5249 4d41 5259 204b 4559 2028     PRIMARY KEY (
+00008a40: 7061 7468 2c6e 616d 652c 6f66 6673 6574  path,name,offset
+00008a50: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
+00008a60: 2020 2020 293b 0a20 2020 2020 2020 2020      );.         
+00008a70: 2020 202f 2a20 2241 2074 6162 6c65 2063     /* "A table c
+00008a80: 7265 6174 6564 2075 7369 6e67 2043 5245  reated using CRE
+00008a90: 4154 4520 5441 424c 4520 4153 2068 6173  ATE TABLE AS has
+00008aa0: 206e 6f20 5052 494d 4152 5920 4b45 5920   no PRIMARY KEY 
+00008ab0: 616e 6420 6e6f 2063 6f6e 7374 7261 696e  and no constrain
+00008ac0: 7473 206f 6620 616e 7920 6b69 6e64 220a  ts of any kind".
+00008ad0: 2020 2020 2020 2020 2020 2020 202a 2054               * T
+00008ae0: 6865 7265 666f 7265 2c20 6974 2077 696c  herefore, it wil
+00008af0: 6c20 6e6f 7420 6265 2073 6f72 7465 6420  l not be sorted 
+00008b00: 616e 6420 696e 7365 7274 696e 6720 7769  and inserting wi
+00008b10: 6c6c 2062 6520 6661 7374 6572 2120 2a2f  ll be faster! */
+00008b20: 0a20 2020 2020 2020 2020 2020 2043 5245  .            CRE
+00008b30: 4154 4520 5441 424c 4520 2266 696c 6573  ATE TABLE "files
+00008b40: 746d 7022 2041 5320 5345 4c45 4354 202a  tmp" AS SELECT *
+00008b50: 2046 524f 4d20 2266 696c 6573 2220 5748   FROM "files" WH
+00008b60: 4552 4520 303b 0a20 2020 2020 2020 2020  ERE 0;.         
+00008b70: 2020 2043 5245 4154 4520 5441 424c 4520     CREATE TABLE 
+00008b80: 2270 6172 656e 7466 6f6c 6465 7273 2220  "parentfolders" 
+00008b90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008ba0: 2020 2270 6174 6822 2020 2020 2020 2020    "path"        
+00008bb0: 2020 5641 5243 4841 5228 3635 3533 3529    VARCHAR(65535)
+00008bc0: 204e 4f54 204e 554c 4c2c 0a20 2020 2020   NOT NULL,.     
+00008bd0: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+00008be0: 2220 2020 2020 2020 2020 2056 4152 4348  "          VARCH
+00008bf0: 4152 2836 3535 3335 2920 4e4f 5420 4e55  AR(65535) NOT NU
+00008c00: 4c4c 2c0a 2020 2020 2020 2020 2020 2020  LL,.            
+00008c10: 2020 2020 226f 6666 7365 7468 6561 6465      "offsetheade
+00008c20: 7222 2020 494e 5445 4745 522c 0a20 2020  r"  INTEGER,.   
+00008c30: 2020 2020 2020 2020 2020 2020 2022 6f66               "of
+00008c40: 6673 6574 2220 2020 2020 2020 2049 4e54  fset"        INT
+00008c50: 4547 4552 2c0a 2020 2020 2020 2020 2020  EGER,.          
+00008c60: 2020 2020 2020 5052 494d 4152 5920 4b45        PRIMARY KE
+00008c70: 5920 2870 6174 682c 6e61 6d65 290a 2020  Y (path,name).  
+00008c80: 2020 2020 2020 2020 2020 2020 2020 554e                UN
+00008c90: 4951 5545 2028 7061 7468 2c6e 616d 6529  IQUE (path,name)
+00008ca0: 0a20 2020 2020 2020 2020 2020 2029 3b0a  .            );.
+00008cb0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00008cc0: 2020 2020 2073 716c 436f 6e6e 6563 7469       sqlConnecti
+00008cd0: 6f6e 203d 2053 514c 6974 6549 6e64 6578  on = SQLiteIndex
+00008ce0: 6564 5461 722e 5f6f 7065 6e53 716c 4462  edTar._openSqlDb
+00008cf0: 2869 6e64 6578 4669 6c65 4e61 6d65 2069  (indexFileName i
+00008d00: 6620 696e 6465 7846 696c 654e 616d 6520  f indexFileName 
+00008d10: 656c 7365 2027 3a6d 656d 6f72 793a 2729  else ':memory:')
+00008d20: 0a20 2020 2020 2020 2074 6162 6c65 7320  .        tables 
+00008d30: 3d20 7371 6c43 6f6e 6e65 6374 696f 6e2e  = sqlConnection.
+00008d40: 6578 6563 7574 6528 2753 454c 4543 5420  execute('SELECT 
+00008d50: 6e61 6d65 2046 524f 4d20 7371 6c69 7465  name FROM sqlite
+00008d60: 5f6d 6173 7465 7220 5748 4552 4520 7479  _master WHERE ty
+00008d70: 7065 203d 2022 7461 626c 6522 3b27 290a  pe = "table";').
+00008d80: 2020 2020 2020 2020 6966 207b 2266 696c          if {"fil
+00008d90: 6573 222c 2022 6669 6c65 7374 6d70 222c  es", "filestmp",
+00008da0: 2022 7061 7265 6e74 666f 6c64 6572 7322   "parentfolders"
+00008db0: 7d2e 696e 7465 7273 6563 7469 6f6e 287b  }.intersection({
+00008dc0: 745b 305d 2066 6f72 2074 2069 6e20 7461  t[0] for t in ta
+00008dd0: 626c 6573 7d29 3a0a 2020 2020 2020 2020  bles}):.        
+00008de0: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
+00008df0: 6449 6e64 6578 4572 726f 7228 0a20 2020  dIndexError(.   
+00008e00: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
+00008e10: 6520 696e 6465 7820 6669 6c65 207b 7d20  e index file {} 
+00008e20: 616c 7265 6164 7920 7365 656d 7320 746f  already seems to
+00008e30: 2063 6f6e 7461 696e 2061 2074 6162 6c65   contain a table
+00008e40: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+00008e50: 2020 2020 2250 6c65 6173 6520 7370 6563      "Please spec
+00008e60: 6966 7920 2d2d 7265 6372 6561 7465 2d69  ify --recreate-i
+00008e70: 6e64 6578 2e22 2e66 6f72 6d61 7428 696e  ndex.".format(in
+00008e80: 6465 7846 696c 654e 616d 6529 0a20 2020  dexFileName).   
+00008e90: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00008ea0: 2020 2073 716c 436f 6e6e 6563 7469 6f6e     sqlConnection
+00008eb0: 2e65 7865 6375 7465 7363 7269 7074 2863  .executescript(c
+00008ec0: 7265 6174 6554 6162 6c65 7329 0a20 2020  reateTables).   
+00008ed0: 2020 2020 2072 6574 7572 6e20 7371 6c43       return sqlC
+00008ee0: 6f6e 6e65 6374 696f 6e0a 0a20 2020 2064  onnection..    d
+00008ef0: 6566 205f 7265 6c6f 6164 496e 6465 7852  ef _reloadIndexR
+00008f00: 6561 644f 6e6c 7928 7365 6c66 293a 0a20  eadOnly(self):. 
+00008f10: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00008f20: 6c66 2e69 6e64 6578 4669 6c65 4e61 6d65  lf.indexFileName
+00008f30: 206f 7220 7365 6c66 2e69 6e64 6578 4669   or self.indexFi
+00008f40: 6c65 4e61 6d65 203d 3d20 273a 6d65 6d6f  leName == ':memo
+00008f50: 7279 3a27 206f 7220 6e6f 7420 7365 6c66  ry:' or not self
+00008f60: 2e73 716c 436f 6e6e 6563 7469 6f6e 3a0a  .sqlConnection:.
+00008f70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008f80: 726e 0a0a 2020 2020 2020 2020 7365 6c66  rn..        self
+00008f90: 2e73 716c 436f 6e6e 6563 7469 6f6e 2e63  .sqlConnection.c
+00008fa0: 6f6d 6d69 7428 290a 2020 2020 2020 2020  ommit().        
+00008fb0: 7365 6c66 2e73 716c 436f 6e6e 6563 7469  self.sqlConnecti
+00008fc0: 6f6e 2e63 6c6f 7365 2829 0a0a 2020 2020  on.close()..    
+00008fd0: 2020 2020 7572 6950 6174 6820 3d20 7572      uriPath = ur
+00008fe0: 6c6c 6962 2e70 6172 7365 2e71 756f 7465  llib.parse.quote
+00008ff0: 2873 656c 662e 696e 6465 7846 696c 654e  (self.indexFileN
+00009000: 616d 6529 0a20 2020 2020 2020 2073 656c  ame).        sel
+00009010: 662e 7371 6c43 6f6e 6e65 6374 696f 6e20  f.sqlConnection 
+00009020: 3d20 5351 4c69 7465 496e 6465 7865 6454  = SQLiteIndexedT
+00009030: 6172 2e5f 6f70 656e 5371 6c44 6228 6622  ar._openSqlDb(f"
+00009040: 6669 6c65 3a7b 7572 6950 6174 687d 3f6d  file:{uriPath}?m
+00009050: 6f64 653d 726f 222c 2075 7269 3d54 7275  ode=ro", uri=Tru
+00009060: 6529 0a0a 2020 2020 4073 7461 7469 636d  e)..    @staticm
+00009070: 6574 686f 640a 2020 2020 6465 6620 5f74  ethod.    def _t
+00009080: 6172 496e 666f 4675 6c6c 4d6f 6465 2874  arInfoFullMode(t
+00009090: 6172 496e 666f 3a20 7461 7266 696c 652e  arInfo: tarfile.
+000090a0: 5461 7249 6e66 6f29 202d 3e20 696e 743a  TarInfo) -> int:
+000090b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000090c0: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
+000090d0: 2066 756c 6c20 6d6f 6465 2066 6f72 2061   full mode for a
+000090e0: 2054 6172 496e 666f 206f 626a 6563 742e   TarInfo object.
+000090f0: 204e 6f74 6520 7468 6174 2054 6172 496e   Note that TarIn
+00009100: 666f 2e6d 6f64 6520 6f6e 6c79 2063 6f6e  fo.mode only con
+00009110: 7461 696e 7320 7468 6520 7065 726d 6973  tains the permis
+00009120: 7369 6f6e 2062 6974 730a 2020 2020 2020  sion bits.      
+00009130: 2020 616e 6420 6e6f 7420 6f74 6865 7220    and not other 
+00009140: 6269 7473 206c 696b 6520 7365 7420 666f  bits like set fo
+00009150: 7220 6469 7265 6374 6f72 792c 2073 796d  r directory, sym
+00009160: 626f 6c69 6320 6c69 6e6b 732c 2061 6e64  bolic links, and
+00009170: 206f 7468 6572 2073 7065 6369 616c 2066   other special f
+00009180: 696c 6573 2e0a 2020 2020 2020 2020 2222  iles..        ""
+00009190: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+000091a0: 2028 0a20 2020 2020 2020 2020 2020 2074   (.            t
+000091b0: 6172 496e 666f 2e6d 6f64 650a 2020 2020  arInfo.mode.    
+000091c0: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
+000091d0: 6666 0a20 2020 2020 2020 2020 2020 207c  ff.            |
+000091e0: 2028 2073 7461 742e 535f 4946 4449 5220   ( stat.S_IFDIR 
+000091f0: 6966 2074 6172 496e 666f 2e69 7364 6972  if tarInfo.isdir
+00009200: 2028 2920 656c 7365 2030 2029 0a20 2020   () else 0 ).   
+00009210: 2020 2020 2020 2020 207c 2028 2073 7461           | ( sta
+00009220: 742e 535f 4946 5245 4720 6966 2074 6172  t.S_IFREG if tar
+00009230: 496e 666f 2e69 7366 696c 6528 2920 656c  Info.isfile() el
+00009240: 7365 2030 2029 0a20 2020 2020 2020 2020  se 0 ).         
+00009250: 2020 207c 2028 2073 7461 742e 535f 4946     | ( stat.S_IF
+00009260: 4c4e 4b20 6966 2074 6172 496e 666f 2e69  LNK if tarInfo.i
+00009270: 7373 796d 2028 2920 656c 7365 2030 2029  ssym () else 0 )
+00009280: 0a20 2020 2020 2020 2020 2020 207c 2028  .            | (
+00009290: 2073 7461 742e 535f 4946 4348 5220 6966   stat.S_IFCHR if
+000092a0: 2074 6172 496e 666f 2e69 7363 6872 2028   tarInfo.ischr (
+000092b0: 2920 656c 7365 2030 2029 0a20 2020 2020  ) else 0 ).     
+000092c0: 2020 2020 2020 207c 2028 2073 7461 742e         | ( stat.
+000092d0: 535f 4946 4946 4f20 6966 2074 6172 496e  S_IFIFO if tarIn
+000092e0: 666f 2e69 7366 6966 6f28 2920 656c 7365  fo.isfifo() else
+000092f0: 2030 2029 0a20 2020 2020 2020 2020 2020   0 ).           
+00009300: 2023 2066 6d74 3a20 6f6e 0a20 2020 2020   # fmt: on.     
+00009310: 2020 2029 0a0a 2020 2020 6465 6620 5f75     )..    def _u
+00009320: 7064 6174 6550 726f 6772 6573 7342 6172  pdateProgressBar
+00009330: 2873 656c 662c 2070 726f 6772 6573 7342  (self, progressB
+00009340: 6172 2c20 6669 6c65 6f62 6a3a 2041 6e79  ar, fileobj: Any
+00009350: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00009360: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00009370: 2020 2020 6966 2068 6173 6174 7472 2866      if hasattr(f
+00009380: 696c 656f 626a 2c20 2774 656c 6c5f 636f  ileobj, 'tell_co
+00009390: 6d70 7265 7373 6564 2729 2061 6e64 2073  mpressed') and s
+000093a0: 656c 662e 636f 6d70 7265 7373 696f 6e20  elf.compression 
+000093b0: 3d3d 2027 627a 3227 3a0a 2020 2020 2020  == 'bz2':.      
+000093c0: 2020 2020 2020 2020 2020 2320 4e6f 7465            # Note
+000093d0: 2074 6861 7420 6265 6361 7573 6520 627a   that because bz
+000093e0: 3220 776f 726b 7320 6f6e 2061 2062 6974  2 works on a bit
+000093f0: 7374 7265 616d 2074 6865 2074 656c 6c5f  stream the tell_
+00009400: 636f 6d70 7265 7373 6564 2072 6574 7572  compressed retur
+00009410: 6e73 2074 6865 206f 6666 7365 7420 696e  ns the offset in
+00009420: 2062 6974 730a 2020 2020 2020 2020 2020   bits.          
+00009430: 2020 2020 2020 7072 6f67 7265 7373 4261        progressBa
+00009440: 722e 7570 6461 7465 2866 696c 656f 626a  r.update(fileobj
+00009450: 2e74 656c 6c5f 636f 6d70 7265 7373 6564  .tell_compressed
+00009460: 2829 202f 2f20 3829 0a20 2020 2020 2020  () // 8).       
+00009470: 2020 2020 2065 6c69 6620 6861 7361 7474       elif hasatt
+00009480: 7228 6669 6c65 6f62 6a2c 2027 7465 6c6c  r(fileobj, 'tell
+00009490: 5f63 6f6d 7072 6573 7365 6427 293a 0a20  _compressed'):. 
+000094a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000094b0: 726f 6772 6573 7342 6172 2e75 7064 6174  rogressBar.updat
+000094c0: 6528 6669 6c65 6f62 6a2e 7465 6c6c 5f63  e(fileobj.tell_c
+000094d0: 6f6d 7072 6573 7365 6428 2929 0a20 2020  ompressed()).   
+000094e0: 2020 2020 2020 2020 2065 6c69 6620 6861           elif ha
+000094f0: 7361 7474 7228 6669 6c65 6f62 6a2c 2027  sattr(fileobj, '
+00009500: 6669 6c65 6f62 6a27 293a 0a20 2020 2020  fileobj'):.     
+00009510: 2020 2020 2020 2020 2020 2070 726f 6772             progr
+00009520: 6573 7342 6172 2e75 7064 6174 6528 6669  essBar.update(fi
+00009530: 6c65 6f62 6a2e 6669 6c65 6f62 6a28 292e  leobj.fileobj().
+00009540: 7465 6c6c 2829 290a 2020 2020 2020 2020  tell()).        
+00009550: 2020 2020 656c 6966 2073 656c 662e 7261      elif self.ra
+00009560: 7746 696c 654f 626a 6563 7420 616e 6420  wFileObject and 
+00009570: 6861 7361 7474 7228 7365 6c66 2e72 6177  hasattr(self.raw
+00009580: 4669 6c65 4f62 6a65 6374 2c20 2774 656c  FileObject, 'tel
+00009590: 6c27 293a 0a20 2020 2020 2020 2020 2020  l'):.           
+000095a0: 2020 2020 2070 726f 6772 6573 7342 6172       progressBar
+000095b0: 2e75 7064 6174 6528 7365 6c66 2e72 6177  .update(self.raw
+000095c0: 4669 6c65 4f62 6a65 6374 2e74 656c 6c28  FileObject.tell(
+000095d0: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
+000095e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000095f0: 2020 2020 2070 726f 6772 6573 7342 6172       progressBar
+00009600: 2e75 7064 6174 6528 6669 6c65 6f62 6a2e  .update(fileobj.
+00009610: 7465 6c6c 2829 290a 2020 2020 2020 2020  tell()).        
+00009620: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00009630: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00009640: 7373 0a0a 2020 2020 6465 6620 5f63 7265  ss..    def _cre
+00009650: 6174 6549 6e64 6578 280a 2020 2020 2020  ateIndex(.      
+00009660: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00009670: 2320 666d 743a 206f 6666 0a20 2020 2020  # fmt: off.     
+00009680: 2020 2066 696c 654f 626a 6563 7420 203a     fileObject  :
+00009690: 2041 6e79 2c0a 2020 2020 2020 2020 7072   Any,.        pr
+000096a0: 6f67 7265 7373 4261 7220 3a20 416e 7920  ogressBar : Any 
+000096b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000096c0: 7061 7468 5072 6566 6978 2020 3a20 7374  pathPrefix  : st
+000096d0: 7220 3d20 2727 2c0a 2020 2020 2020 2020  r = '',.        
+000096e0: 7374 7265 616d 4f66 6673 6574 3a20 696e  streamOffset: in
+000096f0: 7420 3d20 300a 2020 2020 2020 2020 2320  t = 0.        # 
+00009700: 666d 743a 206f 6e0a 2020 2020 2920 2d3e  fmt: on.    ) ->
+00009710: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+00009720: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
+00009730: 313a 0a20 2020 2020 2020 2020 2020 2070  1:.            p
+00009740: 7269 6e74 2822 4372 6561 7469 6e67 206f  rint("Creating o
+00009750: 6666 7365 7420 6469 6374 696f 6e61 7279  ffset dictionary
+00009760: 2066 6f72 222c 2073 656c 662e 7461 7246   for", self.tarF
+00009770: 696c 654e 616d 652c 2022 2e2e 2e22 290a  ileName, "...").
+00009780: 2020 2020 2020 2020 7430 203d 2074 696d          t0 = tim
+00009790: 6572 2829 0a0a 2020 2020 2020 2020 2320  er()..        # 
+000097a0: 312e 2049 6620 6e6f 2053 514c 2063 6f6e  1. If no SQL con
+000097b0: 6e65 6374 696f 6e20 7761 7320 6769 7665  nection was give
+000097c0: 6e20 2862 7920 7265 6375 7273 6976 6520  n (by recursive 
+000097d0: 6361 6c6c 292c 206f 7065 6e20 6120 6e65  call), open a ne
+000097e0: 7720 6461 7461 6261 7365 2066 696c 650a  w database file.
+000097f0: 2020 2020 2020 2020 6f70 656e 6564 436f          openedCo
+00009800: 6e6e 6563 7469 6f6e 203d 2046 616c 7365  nnection = False
+00009810: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00009820: 7365 6c66 2e69 6e64 6578 4973 4c6f 6164  self.indexIsLoad
+00009830: 6564 2829 206f 7220 6e6f 7420 7365 6c66  ed() or not self
+00009840: 2e73 716c 436f 6e6e 6563 7469 6f6e 3a0a  .sqlConnection:.
+00009850: 2020 2020 2020 2020 2020 2020 6f70 656e              open
+00009860: 6564 436f 6e6e 6563 7469 6f6e 203d 2054  edConnection = T
+00009870: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00009880: 7365 6c66 2e73 716c 436f 6e6e 6563 7469  self.sqlConnecti
+00009890: 6f6e 203d 2073 656c 662e 5f69 6e69 7469  on = self._initi
+000098a0: 616c 697a 6553 716c 4462 2873 656c 662e  alizeSqlDb(self.
+000098b0: 696e 6465 7846 696c 654e 616d 6529 0a0a  indexFileName)..
+000098c0: 2020 2020 2020 2020 2320 322e 204f 7065          # 2. Ope
+000098d0: 6e20 5441 5220 6669 6c65 2072 6561 6465  n TAR file reade
+000098e0: 720a 2020 2020 2020 2020 6c6f 6164 6564  r.        loaded
+000098f0: 5461 7246 696c 653a 2041 6e79 203d 205b  TarFile: Any = [
+00009900: 5d20 2023 2046 6569 676e 2061 6e20 656d  ]  # Feign an em
+00009910: 7074 7920 5441 5220 6669 6c65 2069 6620  pty TAR file if 
+00009920: 616e 7974 6869 6e67 2067 6f65 7320 7772  anything goes wr
+00009930: 6f6e 670a 2020 2020 2020 2020 6966 2073  ong.        if s
+00009940: 656c 662e 6973 5461 723a 0a20 2020 2020  elf.isTar:.     
+00009950: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00009960: 2020 2020 2020 2020 2020 2020 2320 723a              # r:
+00009970: 2075 7365 7320 7365 656b 7320 746f 2073   uses seeks to s
+00009980: 6b69 7020 746f 2074 6865 206e 6578 7420  kip to the next 
+00009990: 6669 6c65 2069 6e73 6964 6520 7468 6520  file inside the 
+000099a0: 5441 5220 7768 696c 6520 727c 2064 6f65  TAR while r| doe
+000099b0: 736e 2774 2064 6f20 616e 7920 7365 656b  sn't do any seek
+000099c0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+000099d0: 2020 2023 2072 7c20 6d69 6768 7420 6265     # r| might be
+000099e0: 2073 6c6f 7765 7220 6275 7420 666f 7220   slower but for 
+000099f0: 636f 6d70 7265 7373 6564 2066 696c 6573  compressed files
+00009a00: 2077 6520 6861 7665 2074 6f20 676f 206f   we have to go o
+00009a10: 7665 7220 616c 6c20 7468 6520 6461 7461  ver all the data
+00009a20: 206f 6e63 6520 616e 7977 6179 732e 0a20   once anyways.. 
 00009a30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009a40: 206e 6f6e 2054 4152 2066 696c 6573 213f   non TAR files!?
-00009a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009a60: 206c 6f61 6465 6454 6172 4669 6c65 203d   loadedTarFile =
-00009a70: 2074 6172 6669 6c65 2e6f 7065 6e28 0a20   tarfile.open(. 
-00009a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a90: 2020 2023 2066 6d74 3a6f 6666 0a20 2020     # fmt:off.   
-00009aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ab0: 2066 696c 656f 626a 2020 2020 2020 3d20   fileobj      = 
-00009ac0: 6669 6c65 4f62 6a65 6374 2c0a 2020 2020  fileObject,.    
-00009ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ae0: 6d6f 6465 2020 2020 2020 2020 203d 2027  mode         = '
-00009af0: 727c 2720 6966 2073 656c 662e 636f 6d70  r|' if self.comp
-00009b00: 7265 7373 696f 6e20 656c 7365 2027 723a  ression else 'r:
-00009b10: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00009b20: 2020 2020 2020 2069 676e 6f72 655f 7a65         ignore_ze
-00009b30: 726f 7320 3d20 7365 6c66 2e69 676e 6f72  ros = self.ignor
-00009b40: 655a 6572 6f73 2c0a 2020 2020 2020 2020  eZeros,.        
-00009b50: 2020 2020 2020 2020 2020 2020 656e 636f              enco
-00009b60: 6469 6e67 2020 2020 203d 2073 656c 662e  ding     = self.
-00009b70: 656e 636f 6469 6e67 2c0a 2020 2020 2020  encoding,.      
-00009b80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009b90: 666d 743a 6f6e 0a20 2020 2020 2020 2020  fmt:on.         
-00009ba0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00009bb0: 2020 2020 2065 7863 6570 7420 7461 7266       except tarf
-00009bc0: 696c 652e 5265 6164 4572 726f 723a 0a20  ile.ReadError:. 
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00009be0: 6173 730a 0a20 2020 2020 2020 2069 6620  ass..        if 
-00009bf0: 7072 6f67 7265 7373 4261 7220 6973 204e  progressBar is N
-00009c00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00009c10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00009c20: 2020 2020 2020 7072 6f67 7265 7373 4261        progressBa
-00009c30: 7220 3d20 5072 6f67 7265 7373 4261 7228  r = ProgressBar(
-00009c40: 6f73 2e66 7374 6174 2866 696c 654f 626a  os.fstat(fileObj
-00009c50: 6563 742e 6669 6c65 6e6f 2829 292e 7374  ect.fileno()).st
-00009c60: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-00009c70: 2020 2065 7863 6570 7420 696f 2e55 6e73     except io.Uns
-00009c80: 7570 706f 7274 6564 4f70 6572 6174 696f  upportedOperatio
-00009c90: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00009ca0: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
-00009cb0: 2023 2033 2e20 4974 6572 6174 6520 6f76   # 3. Iterate ov
-00009cc0: 6572 2066 696c 6573 2069 6e73 6964 6520  er files inside 
-00009cd0: 5441 5220 616e 6420 6164 6420 7468 656d  TAR and add them
-00009ce0: 2074 6f20 7468 6520 6461 7461 6261 7365   to the database
-00009cf0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00009d00: 2020 2020 2020 2020 2020 6669 6c65 7354            filesT
-00009d10: 6f4d 6f75 6e74 5265 6375 7273 6976 656c  oMountRecursivel
-00009d20: 7920 3d20 5b5d 0a0a 2020 2020 2020 2020  y = []..        
-00009d30: 2020 2020 666f 7220 7461 7249 6e66 6f20      for tarInfo 
-00009d40: 696e 206c 6f61 6465 6454 6172 4669 6c65  in loadedTarFile
-00009d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009d60: 2020 6c6f 6164 6564 5461 7246 696c 652e    loadedTarFile.
-00009d70: 6d65 6d62 6572 7320 3d20 5b5d 2020 2320  members = []  # 
-00009d80: 436c 6561 7220 7468 6973 2069 6e20 6f72  Clear this in or
-00009d90: 6465 7220 746f 206c 696d 6974 206d 656d  der to limit mem
-00009da0: 6f72 7920 7573 6167 6520 6279 2074 6172  ory usage by tar
-00009db0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00009dc0: 2020 2020 2073 656c 662e 5f75 7064 6174       self._updat
-00009dd0: 6550 726f 6772 6573 7342 6172 2870 726f  eProgressBar(pro
-00009de0: 6772 6573 7342 6172 2c20 6669 6c65 4f62  gressBar, fileOb
-00009df0: 6a65 6374 290a 0a20 2020 2020 2020 2020  ject)..         
-00009e00: 2020 2020 2020 2023 2041 6464 2061 206c         # Add a l
-00009e10: 6561 6469 6e67 2027 2f27 2061 7320 6120  eading '/' as a 
-00009e20: 636f 6e76 656e 7469 6f6e 2077 6865 7265  convention where
-00009e30: 2027 2f27 2072 6570 7265 7365 6e74 7320   '/' represents 
-00009e40: 7468 6520 5441 5220 726f 6f74 2066 6f6c  the TAR root fol
-00009e50: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-00009e60: 2020 2020 2320 5061 7274 6c79 2c20 646f      # Partly, do
-00009e70: 6e65 2062 6563 6175 7365 2066 7573 6570  ne because fusep
-00009e80: 7920 7370 6563 6966 6965 7320 7061 7468  y specifies path
-00009e90: 7320 696e 2061 206d 6f75 6e74 6564 2064  s in a mounted d
-00009ea0: 6972 6563 746f 7279 206c 696b 6520 7468  irectory like th
-00009eb0: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
-00009ec0: 2020 2023 206f 732e 6e6f 726d 7061 7468     # os.normpath
-00009ed0: 2064 6f65 7320 6e6f 7420 6465 6c65 7465   does not delete
-00009ee0: 2064 7570 6c69 6361 7465 2027 2f27 2061   duplicate '/' a
-00009ef0: 7420 6265 6769 6e6e 696e 6720 6f66 2073  t beginning of s
-00009f00: 7472 696e 6721 0a20 2020 2020 2020 2020  tring!.         
-00009f10: 2020 2020 2020 2023 2074 6172 496e 666f         # tarInfo
-00009f20: 2e6e 616d 6520 6d69 6768 7420 6265 2069  .name might be i
-00009f30: 6465 6e74 6963 616c 2074 6f20 222e 2220  dentical to "." 
-00009f40: 6f72 2062 6567 696e 2077 6974 6820 222e  or begin with ".
-00009f50: 2f22 2c20 7768 6963 6820 6973 2062 6164  /", which is bad
-00009f60: 210a 2020 2020 2020 2020 2020 2020 2020  !.              
-00009f70: 2020 2320 6f73 2e70 6174 682e 6e6f 726d    # os.path.norm
-00009f80: 7061 7468 2063 616e 2072 656d 6f76 6520  path can remove 
-00009f90: 7375 6666 6978 6564 2066 6f6c 6465 722f  suffixed folder/
-00009fa0: 2e2f 2070 6174 6820 7370 6563 6966 6963  ./ path specific
-00009fb0: 6174 696f 6e73 2062 7574 2069 7420 6361  ations but it ca
-00009fc0: 6e27 7420 7265 6d6f 7665 0a20 2020 2020  n't remove.     
-00009fd0: 2020 2020 2020 2020 2020 2023 2061 206c             # a l
-00009fe0: 6561 6469 6e67 2064 6f74 2e0a 2020 2020  eading dot..    
-00009ff0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
-0000a000: 444f 3a20 576f 756c 6420 6265 2061 206e  DO: Would be a n
-0000a010: 6963 6520 6675 6e63 7469 6f6e 202f 206c  ice function / l
-0000a020: 696e 6520 6f66 2063 6f64 6520 746f 2074  ine of code to t
-0000a030: 6573 7420 6265 6361 7573 6520 6974 2069  est because it i
-0000a040: 7320 7665 7279 2066 696e 6963 6b79 2e0a  s very finicky..
-0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a060: 2320 2020 2020 2020 416e 6420 736f 6d65  #       And some
-0000a070: 2063 6173 6573 2061 7265 206f 6e6c 7920   cases are only 
-0000a080: 7472 6967 6765 7265 6420 666f 7220 7265  triggered for re
-0000a090: 6375 7273 6976 6520 6d6f 756e 7473 2c20  cursive mounts, 
-0000a0a0: 692e 652e 2c20 666f 7220 6e6f 6e2d 656d  i.e., for non-em
-0000a0b0: 7074 7920 7061 7468 5072 6566 6978 2e0a  pty pathPrefix..
-0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0d0: 6675 6c6c 5061 7468 203d 2022 2f22 202b  fullPath = "/" +
-0000a0e0: 206f 732e 7061 7468 2e6e 6f72 6d70 6174   os.path.normpat
-0000a0f0: 6828 7061 7468 5072 6566 6978 202b 2022  h(pathPrefix + "
-0000a100: 2f22 202b 2074 6172 496e 666f 2e6e 616d  /" + tarInfo.nam
-0000a110: 6529 2e6c 7374 7269 7028 272f 2729 0a0a  e).lstrip('/')..
-0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a130: 2320 544f 444f 3a20 4173 2066 6f72 2074  # TODO: As for t
-0000a140: 6865 2074 6172 6669 6c65 2074 7970 6520  he tarfile type 
-0000a150: 5351 4c69 7465 2065 7870 6563 7473 2069  SQLite expects i
-0000a160: 6e74 2062 7574 2069 7420 6973 2067 656e  nt but it is gen
-0000a170: 6572 616c 6c79 2062 7974 6573 2e0a 2020  erally bytes..  
-0000a180: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a190: 2020 2020 2020 4d6f 7374 206f 6620 7468        Most of th
-0000a1a0: 656d 2077 6f75 6c64 2062 6520 636f 6e76  em would be conv
-0000a1b0: 6572 7469 626c 6520 746f 2069 6e74 206c  ertible to int l
-0000a1c0: 696b 6520 7461 7266 696c 652e 5359 4d54  ike tarfile.SYMT
-0000a1d0: 5950 4520 7768 6963 6820 6973 2062 2732  YPE which is b'2
-0000a1e0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000a1f0: 2020 2023 2020 2020 2020 2062 7574 206f     #       but o
-0000a200: 7468 6572 7320 7368 6f75 6c64 2074 6872  thers should thr
-0000a210: 6f77 2065 7272 6f72 732c 206c 696b 6520  ow errors, like 
-0000a220: 474e 5554 5950 455f 5350 4152 5345 2077  GNUTYPE_SPARSE w
-0000a230: 6869 6368 2069 7320 6227 5327 2e0a 2020  hich is b'S'..  
-0000a240: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a250: 2020 2020 2020 5768 656e 206c 6f6f 6b69        When looki
-0000a260: 6e67 2061 7420 7468 6520 6765 6e65 7261  ng at the genera
-0000a270: 7465 6420 696e 6465 782c 2074 686f 7365  ted index, those
-0000a280: 2076 616c 7565 7320 6765 7420 7369 6c65   values get sile
-0000a290: 6e74 6c79 2063 6f6e 7665 7274 6564 2074  ntly converted t
-0000a2a0: 6f20 303f 0a20 2020 2020 2020 2020 2020  o 0?.           
-0000a2b0: 2020 2020 2070 6174 682c 206e 616d 6520       path, name 
-0000a2c0: 3d20 6675 6c6c 5061 7468 2e72 7370 6c69  = fullPath.rspli
-0000a2d0: 7428 222f 222c 2031 290a 2020 2020 2020  t("/", 1).      
-0000a2e0: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
-0000a2f0: 206f 6666 0a20 2020 2020 2020 2020 2020   off.           
-0000a300: 2020 2020 2066 696c 6549 6e66 6f20 3d20       fileInfo = 
-0000a310: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000a320: 2020 2020 2020 7061 7468 2020 2020 2020        path      
-0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a340: 2020 2020 2020 2020 2c20 2023 2030 0a20          ,  # 0. 
-0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a360: 2020 206e 616d 6520 2020 2020 2020 2020     name         
-0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a380: 2020 2020 202c 2020 2320 310a 2020 2020       ,  # 1.    
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3a0: 7374 7265 616d 4f66 6673 6574 202b 2074  streamOffset + t
-0000a3b0: 6172 496e 666f 2e6f 6666 7365 7420 2020  arInfo.offset   
-0000a3c0: 2020 2c20 2023 2032 0a20 2020 2020 2020    ,  # 2.       
-0000a3d0: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0000a3e0: 6561 6d4f 6666 7365 7420 2b20 7461 7249  eamOffset + tarI
-0000a3f0: 6e66 6f2e 6f66 6673 6574 5f64 6174 612c  nfo.offset_data,
-0000a400: 2020 2320 330a 2020 2020 2020 2020 2020    # 3.          
-0000a410: 2020 2020 2020 2020 2020 7461 7249 6e66            tarInf
-0000a420: 6f2e 7369 7a65 2020 2020 2020 2020 2020  o.size          
-0000a430: 2020 2020 2020 2020 2020 2020 2c20 2023              ,  #
-0000a440: 2034 0a20 2020 2020 2020 2020 2020 2020   4.             
-0000a450: 2020 2020 2020 2074 6172 496e 666f 2e6d         tarInfo.m
-0000a460: 7469 6d65 2020 2020 2020 2020 2020 2020  time            
-0000a470: 2020 2020 2020 2020 202c 2020 2320 350a           ,  # 5.
-0000a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a490: 2020 2020 7365 6c66 2e5f 7461 7249 6e66      self._tarInf
-0000a4a0: 6f46 756c 6c4d 6f64 6528 7461 7249 6e66  oFullMode(tarInf
-0000a4b0: 6f29 2020 2020 2c20 2023 2036 0a20 2020  o)    ,  # 6.   
-0000a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4d0: 2074 6172 496e 666f 2e74 7970 6520 2020   tarInfo.type   
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 202c 2020 2320 370a 2020 2020 2020     ,  # 7.      
-0000a500: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-0000a510: 7249 6e66 6f2e 6c69 6e6b 6e61 6d65 2020  rInfo.linkname  
-0000a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a530: 2c20 2023 2038 0a20 2020 2020 2020 2020  ,  # 8.         
-0000a540: 2020 2020 2020 2020 2020 2074 6172 496e             tarIn
-0000a550: 666f 2e75 6964 2020 2020 2020 2020 2020  fo.uid          
-0000a560: 2020 2020 2020 2020 2020 2020 202c 2020               ,  
-0000a570: 2320 390a 2020 2020 2020 2020 2020 2020  # 9.            
-0000a580: 2020 2020 2020 2020 7461 7249 6e66 6f2e          tarInfo.
-0000a590: 6769 6420 2020 2020 2020 2020 2020 2020  gid             
-0000a5a0: 2020 2020 2020 2020 2020 2c20 2023 2031            ,  # 1
-0000a5b0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-0000a5c0: 2020 2020 2020 4661 6c73 6520 2020 2020        False     
-0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2020 2020 2020 2020 2c20 2023 2031 3120          ,  # 11 
-0000a5f0: 2869 7354 6172 290a 2020 2020 2020 2020  (isTar).        
-0000a600: 2020 2020 2020 2020 2020 2020 7461 7249              tarI
-0000a610: 6e66 6f2e 6973 7370 6172 7365 2829 2020  nfo.issparse()  
-0000a620: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
-0000a630: 2023 2031 320a 2020 2020 2020 2020 2020   # 12.          
-0000a640: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000a650: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
-0000a660: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000a670: 2020 2069 6620 7365 6c66 2e6d 6f75 6e74     if self.mount
-0000a680: 5265 6375 7273 6976 656c 7920 616e 6420  Recursively and 
-0000a690: 7461 7249 6e66 6f2e 6973 6669 6c65 2829  tarInfo.isfile()
-0000a6a0: 2061 6e64 2074 6172 496e 666f 2e6e 616d   and tarInfo.nam
-0000a6b0: 652e 6c6f 7765 7228 292e 656e 6473 7769  e.lower().endswi
-0000a6c0: 7468 2827 2e74 6172 2729 3a0a 2020 2020  th('.tar'):.    
-0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6e0: 6669 6c65 7354 6f4d 6f75 6e74 5265 6375  filesToMountRecu
-0000a6f0: 7273 6976 656c 792e 6170 7065 6e64 2866  rsively.append(f
-0000a700: 696c 6549 6e66 6f29 0a20 2020 2020 2020  ileInfo).       
-0000a710: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a730: 2020 2073 656c 662e 5f73 6574 4669 6c65     self._setFile
-0000a740: 496e 666f 2866 696c 6549 6e66 6f29 0a20  Info(fileInfo). 
-0000a750: 2020 2020 2020 2065 7863 6570 7420 7461         except ta
-0000a760: 7266 696c 652e 5265 6164 4572 726f 7220  rfile.ReadError 
-0000a770: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000a780: 2020 6966 2027 756e 6578 7065 6374 6564    if 'unexpected
-0000a790: 2065 6e64 206f 6620 6461 7461 2720 696e   end of data' in
-0000a7a0: 2073 7472 2865 293a 0a20 2020 2020 2020   str(e):.       
-0000a7b0: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-0000a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7d0: 2020 2020 225b 5761 726e 696e 675d 2054      "[Warning] T
-0000a7e0: 6865 2054 4152 2066 696c 6520 6973 2069  he TAR file is i
-0000a7f0: 6e63 6f6d 706c 6574 652e 2052 6174 6172  ncomplete. Ratar
-0000a800: 6d6f 756e 7420 7769 6c6c 2077 6f72 6b20  mount will work 
-0000a810: 6275 7420 736f 6d65 2066 696c 6573 206d  but some files m
-0000a820: 6967 6874 2062 6520 6375 7420 6f66 662e  ight be cut off.
-0000a830: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000a840: 2020 2020 2020 2022 4966 2074 6865 2054         "If the T
-0000a850: 4152 2066 696c 6520 7369 7a65 2063 6861  AR file size cha
-0000a860: 6e67 6573 2c20 7261 7461 726d 6f75 6e74  nges, ratarmount
-0000a870: 2077 696c 6c20 7265 6372 6561 7465 2074   will recreate t
-0000a880: 6865 2069 6e64 6578 2064 7572 696e 6720  he index during 
-0000a890: 7468 6520 6e65 7874 206d 6f75 6e74 696e  the next mountin
-0000a8a0: 672e 220a 2020 2020 2020 2020 2020 2020  g.".            
-0000a8b0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0000a8c0: 2034 2e20 4f70 656e 2063 6f6e 7461 696e   4. Open contain
-0000a8d0: 6564 2054 4152 7320 666f 7220 7265 6375  ed TARs for recu
-0000a8e0: 7273 6976 6520 6d6f 756e 7469 6e67 0a20  rsive mounting. 
-0000a8f0: 2020 2020 2020 206f 6c64 506f 7320 3d20         oldPos = 
-0000a900: 6669 6c65 4f62 6a65 6374 2e74 656c 6c28  fileObject.tell(
-0000a910: 290a 2020 2020 2020 2020 6f6c 6450 7269  ).        oldPri
-0000a920: 6e74 4e61 6d65 203d 2073 656c 662e 7461  ntName = self.ta
-0000a930: 7246 696c 654e 616d 650a 2020 2020 2020  rFileName.      
-0000a940: 2020 666f 7220 6669 6c65 496e 666f 2069    for fileInfo i
-0000a950: 6e20 6669 6c65 7354 6f4d 6f75 6e74 5265  n filesToMountRe
-0000a960: 6375 7273 6976 656c 793a 0a20 2020 2020  cursively:.     
-0000a970: 2020 2020 2020 2023 2053 7472 6970 2066         # Strip f
-0000a980: 696c 6520 6578 7465 6e73 696f 6e20 666f  ile extension fo
-0000a990: 7220 6d6f 756e 7420 706f 696e 7420 6966  r mount point if
-0000a9a0: 2073 6f20 636f 6e66 6967 7572 6564 0a20   so configured. 
-0000a9b0: 2020 2020 2020 2020 2020 206d 6f64 6966             modif
-0000a9c0: 6965 644e 616d 6520 3d20 6669 6c65 496e  iedName = fileIn
-0000a9d0: 666f 5b31 5d0a 2020 2020 2020 2020 2020  fo[1].          
-0000a9e0: 2020 7461 7245 7874 656e 7369 6f6e 203d    tarExtension =
-0000a9f0: 2027 2e74 6172 270a 2020 2020 2020 2020   '.tar'.        
-0000aa00: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-0000aa10: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0000aa20: 7269 7052 6563 7572 7369 7665 5461 7245  ripRecursiveTarE
-0000aa30: 7874 656e 7369 6f6e 0a20 2020 2020 2020  xtension.       
-0000aa40: 2020 2020 2020 2020 2061 6e64 206c 656e           and len
-0000aa50: 2874 6172 4578 7465 6e73 696f 6e29 203e  (tarExtension) >
-0000aa60: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0000aa70: 2020 2061 6e64 206d 6f64 6966 6965 644e     and modifiedN
-0000aa80: 616d 652e 6c6f 7765 7228 292e 656e 6473  ame.lower().ends
-0000aa90: 7769 7468 2874 6172 4578 7465 6e73 696f  with(tarExtensio
-0000aaa0: 6e2e 6c6f 7765 7228 2929 0a20 2020 2020  n.lower()).     
-0000aab0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0000aac0: 2020 2020 2020 2020 2020 6d6f 6469 6669            modifi
-0000aad0: 6564 4e61 6d65 203d 206d 6f64 6966 6965  edName = modifie
-0000aae0: 644e 616d 655b 3a20 2d6c 656e 2874 6172  dName[: -len(tar
-0000aaf0: 4578 7465 6e73 696f 6e29 5d0a 0a20 2020  Extension)]..   
-0000ab00: 2020 2020 2020 2020 2023 2054 656d 706f           # Tempo
-0000ab10: 7261 7269 6c79 2063 6861 6e67 6520 7461  rarily change ta
-0000ab20: 7246 696c 654e 616d 6520 666f 7220 7468  rFileName for th
-0000ab30: 6520 696e 666f 206f 7574 7075 7420 6f66  e info output of
-0000ab40: 2074 6865 2072 6563 7572 7369 7665 2063   the recursive c
-0000ab50: 616c 6c0a 2020 2020 2020 2020 2020 2020  all.            
-0000ab60: 7365 6c66 2e74 6172 4669 6c65 4e61 6d65  self.tarFileName
-0000ab70: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
-0000ab80: 6669 6c65 496e 666f 5b30 5d2c 2066 696c  fileInfo[0], fil
-0000ab90: 6549 6e66 6f5b 315d 290a 0a20 2020 2020  eInfo[1])..     
-0000aba0: 2020 2020 2020 2023 2053 7465 6e63 696c         # Stencil
-0000abb0: 6564 4669 6c65 2773 2074 656c 6c20 7265  edFile's tell re
-0000abc0: 7475 726e 7320 7468 6520 6f66 6673 6574  turns the offset
-0000abd0: 2069 6e73 6964 6520 7468 6520 6669 6c65   inside the file
-0000abe0: 2063 6875 6e6b 2069 6e73 7465 6164 206f   chunk instead o
-0000abf0: 6620 7468 6520 676c 6f62 616c 206f 6e65  f the global one
-0000ac00: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
-0000ac10: 736f 2077 6520 6861 7665 2074 6f20 616c  so we have to al
-0000ac20: 7761 7973 2063 6f6d 6d75 6e69 6361 7465  ways communicate
-0000ac30: 2074 6865 206f 6666 7365 7420 6f66 2074   the offset of t
-0000ac40: 6869 7320 6368 756e 6b20 746f 2074 6865  his chunk to the
-0000ac50: 2072 6563 7572 7369 7665 2063 616c 6c20   recursive call 
-0000ac60: 6e6f 206d 6174 7465 720a 2020 2020 2020  no matter.      
-0000ac70: 2020 2020 2020 2320 7768 6574 6865 7220        # whether 
-0000ac80: 7461 7266 696c 6520 6861 7320 7374 7265  tarfile has stre
-0000ac90: 616d 696e 6720 6163 6365 7373 206f 7220  aming access or 
-0000aca0: 7365 656b 696e 6720 6163 6365 7373 210a  seeking access!.
-0000acb0: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
-0000acc0: 616c 4f66 6673 6574 203d 2066 696c 6549  alOffset = fileI
-0000acd0: 6e66 6f5b 335d 0a20 2020 2020 2020 2020  nfo[3].         
-0000ace0: 2020 2073 697a 6520 3d20 6669 6c65 496e     size = fileIn
-0000acf0: 666f 5b34 5d0a 2020 2020 2020 2020 2020  fo[4].          
-0000ad00: 2020 7461 7246 696c 654f 626a 6563 7420    tarFileObject 
-0000ad10: 3d20 5374 656e 6369 6c65 6446 696c 6528  = StenciledFile(
-0000ad20: 6669 6c65 4f62 6a65 6374 2c20 5b28 676c  fileObject, [(gl
-0000ad30: 6f62 616c 4f66 6673 6574 2c20 7369 7a65  obalOffset, size
-0000ad40: 295d 290a 0a20 2020 2020 2020 2020 2020  )])..           
-0000ad50: 2069 7354 6172 203d 2046 616c 7365 0a20   isTar = False. 
-0000ad60: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad80: 2320 446f 206e 6f74 2075 7365 206f 732e  # Do not use os.
-0000ad90: 7061 7468 2e6a 6f69 6e20 6865 7265 2062  path.join here b
-0000ada0: 6563 6175 7365 2074 6865 206c 6561 6469  ecause the leadi
-0000adb0: 6e67 202f 206d 6967 6874 2062 6520 6d69  ng / might be mi
-0000adc0: 7373 696e 672e 0a20 2020 2020 2020 2020  ssing..         
-0000add0: 2020 2020 2020 2023 2054 6869 7320 7368         # This sh
-0000ade0: 6f75 6c64 2069 6e73 7465 6164 2062 6520  ould instead be 
-0000adf0: 7365 656e 2061 7320 7468 6520 7265 7665  seen as the reve
-0000ae00: 7273 6520 6f70 6572 6174 696f 6e20 6f66  rse operation of
-0000ae10: 2074 6865 2072 7370 6c69 7420 6675 7274   the rsplit furt
-0000ae20: 6865 7220 6162 6f76 652e 0a20 2020 2020  her above..     
-0000ae30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000ae40: 5f63 7265 6174 6549 6e64 6578 2874 6172  _createIndex(tar
-0000ae50: 4669 6c65 4f62 6a65 6374 2c20 7072 6f67  FileObject, prog
-0000ae60: 7265 7373 4261 722c 2022 2f22 2e6a 6f69  ressBar, "/".joi
-0000ae70: 6e28 5b66 696c 6549 6e66 6f5b 305d 2c20  n([fileInfo[0], 
-0000ae80: 6d6f 6469 6669 6564 4e61 6d65 5d29 2c20  modifiedName]), 
-0000ae90: 676c 6f62 616c 4f66 6673 6574 290a 2020  globalOffset).  
-0000aea0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-0000aeb0: 5461 7220 3d20 5472 7565 0a20 2020 2020  Tar = True.     
-0000aec0: 2020 2020 2020 2065 7863 6570 7420 7461         except ta
-0000aed0: 7266 696c 652e 5265 6164 4572 726f 723a  rfile.ReadError:
-0000aee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aef0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-0000af00: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-0000af10: 2020 2020 2020 2020 2020 2064 656c 2074             del t
-0000af20: 6172 4669 6c65 4f62 6a65 6374 0a0a 2020  arFileObject..  
-0000af30: 2020 2020 2020 2020 2020 6966 2069 7354            if isT
-0000af40: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
-0000af50: 2020 2020 6d6f 6469 6669 6564 4669 6c65      modifiedFile
-0000af60: 496e 666f 203d 206c 6973 7428 6669 6c65  Info = list(file
-0000af70: 496e 666f 290a 0a20 2020 2020 2020 2020  Info)..         
-0000af80: 2020 2020 2020 2023 2069 6620 7468 6520         # if the 
-0000af90: 5441 5220 6669 6c65 2063 6f6e 7465 6e74  TAR file content
-0000afa0: 7320 636f 756c 6420 6265 2072 6561 642c  s could be read,
-0000afb0: 2077 6520 6e65 6564 2074 6f20 6164 6a75   we need to adju
-0000afc0: 7374 2074 6865 2061 6374 7561 6c0a 2020  st the actual.  
-0000afd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000afe0: 5441 5220 6669 6c65 2773 206d 6574 6164  TAR file's metad
-0000aff0: 6174 6120 746f 2062 6520 6120 6469 7265  ata to be a dire
-0000b000: 6374 6f72 7920 696e 7374 6561 6420 6f66  ctory instead of
-0000b010: 2061 2066 696c 650a 2020 2020 2020 2020   a file.        
-0000b020: 2020 2020 2020 2020 6d6f 6465 203d 206d          mode = m
-0000b030: 6f64 6966 6965 6446 696c 6549 6e66 6f5b  odifiedFileInfo[
-0000b040: 365d 0a20 2020 2020 2020 2020 2020 2020  6].             
-0000b050: 2020 206d 6f64 6520 3d20 280a 2020 2020     mode = (.    
-0000b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b070: 286d 6f64 6520 2620 306f 3737 3729 0a20  (mode & 0o777). 
-0000b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b090: 2020 207c 2073 7461 742e 535f 4946 4449     | stat.S_IFDI
-0000b0a0: 520a 2020 2020 2020 2020 2020 2020 2020  R.              
-0000b0b0: 2020 2020 2020 7c20 2873 7461 742e 535f        | (stat.S_
-0000b0c0: 4958 5553 5220 6966 206d 6f64 6520 2620  IXUSR if mode & 
-0000b0d0: 7374 6174 2e53 5f49 5255 5352 2021 3d20  stat.S_IRUSR != 
-0000b0e0: 3020 656c 7365 2030 290a 2020 2020 2020  0 else 0).      
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 7c20                | 
-0000b100: 2873 7461 742e 535f 4958 4752 5020 6966  (stat.S_IXGRP if
-0000b110: 206d 6f64 6520 2620 7374 6174 2e53 5f49   mode & stat.S_I
-0000b120: 5247 5250 2021 3d20 3020 656c 7365 2030  RGRP != 0 else 0
-0000b130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b140: 2020 2020 2020 7c20 2873 7461 742e 535f        | (stat.S_
-0000b150: 4958 4f54 4820 6966 206d 6f64 6520 2620  IXOTH if mode & 
-0000b160: 7374 6174 2e53 5f49 524f 5448 2021 3d20  stat.S_IROTH != 
-0000b170: 3020 656c 7365 2030 290a 2020 2020 2020  0 else 0).      
-0000b180: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000b190: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000b1a0: 6966 6965 6446 696c 6549 6e66 6f5b 305d  ifiedFileInfo[0]
-0000b1b0: 203d 2066 696c 6549 6e66 6f5b 305d 0a20   = fileInfo[0]. 
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000b1d0: 6f64 6966 6965 6446 696c 6549 6e66 6f5b  odifiedFileInfo[
-0000b1e0: 315d 203d 206d 6f64 6966 6965 644e 616d  1] = modifiedNam
-0000b1f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000b200: 2020 6d6f 6469 6669 6564 4669 6c65 496e    modifiedFileIn
-0000b210: 666f 5b36 5d20 3d20 6d6f 6465 0a20 2020  fo[6] = mode.   
-0000b220: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000b230: 6966 6965 6446 696c 6549 6e66 6f5b 3131  ifiedFileInfo[11
-0000b240: 5d20 3d20 6973 5461 720a 0a20 2020 2020  ] = isTar..     
-0000b250: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b260: 5f73 6574 4669 6c65 496e 666f 2874 7570  _setFileInfo(tup
-0000b270: 6c65 286d 6f64 6966 6965 6446 696c 6549  le(modifiedFileI
-0000b280: 6e66 6f29 290a 2020 2020 2020 2020 2020  nfo)).          
-0000b290: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b2a0: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
-0000b2b0: 7446 696c 6549 6e66 6f28 6669 6c65 496e  tFileInfo(fileIn
-0000b2c0: 666f 290a 0a20 2020 2020 2020 2066 696c  fo)..        fil
-0000b2d0: 654f 626a 6563 742e 7365 656b 286f 6c64  eObject.seek(old
-0000b2e0: 506f 7329 0a20 2020 2020 2020 2073 656c  Pos).        sel
-0000b2f0: 662e 7461 7246 696c 654e 616d 6520 3d20  f.tarFileName = 
-0000b300: 6f6c 6450 7269 6e74 4e61 6d65 0a0a 2020  oldPrintName..  
-0000b310: 2020 2020 2020 2320 4576 6572 7974 6869        # Everythi
-0000b320: 6e67 2062 656c 6f77 2073 686f 756c 6420  ng below should 
-0000b330: 6e6f 7420 6265 2064 6f6e 6520 696e 2061  not be done in a
-0000b340: 2072 6563 7572 7369 7665 2063 616c 6c20   recursive call 
-0000b350: 6f66 2063 7265 6174 6549 6e64 6578 0a20  of createIndex. 
-0000b360: 2020 2020 2020 2069 6620 7374 7265 616d         if stream
-0000b370: 4f66 6673 6574 203e 2030 3a0a 2020 2020  Offset > 0:.    
-0000b380: 2020 2020 2020 2020 7431 203d 2074 696d          t1 = tim
-0000b390: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-0000b3a0: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
-0000b3b0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0000b3c0: 2020 2020 2070 7269 6e74 2822 4372 6561       print("Crea
-0000b3d0: 7469 6e67 206f 6666 7365 7420 6469 6374  ting offset dict
-0000b3e0: 696f 6e61 7279 2066 6f72 222c 2073 656c  ionary for", sel
-0000b3f0: 662e 7461 7246 696c 654e 616d 652c 2022  f.tarFileName, "
-0000b400: 746f 6f6b 207b 3a2e 3266 7d73 222e 666f  took {:.2f}s".fo
-0000b410: 726d 6174 2874 3120 2d20 7430 2929 0a20  rmat(t1 - t0)). 
-0000b420: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000b430: 6e0a 0a20 2020 2020 2020 2023 2049 6620  n..        # If 
-0000b440: 6e6f 2066 696c 6520 6973 2069 6e20 7468  no file is in th
-0000b450: 6520 5441 522c 2074 6865 6e20 6974 206d  e TAR, then it m
-0000b460: 6f73 7420 6c69 6b65 6c79 2069 6e64 6963  ost likely indic
-0000b470: 6174 6573 2061 2070 6f73 7369 626c 7920  ates a possibly 
-0000b480: 636f 6d70 7265 7373 6564 206e 6f6e 2054  compressed non T
-0000b490: 4152 2066 696c 652e 0a20 2020 2020 2020  AR file..       
-0000b4a0: 2023 2049 6e20 7468 6174 2063 6173 6520   # In that case 
-0000b4b0: 6164 6420 7468 6174 2069 7473 656c 6620  add that itself 
-0000b4c0: 746f 2074 6865 2066 696c 6520 696e 6465  to the file inde
-0000b4d0: 782e 2054 6869 7320 776f 6e27 7420 776f  x. This won't wo
-0000b4e0: 726b 2077 6865 6e20 6361 6c6c 6564 2072  rk when called r
-0000b4f0: 6563 7572 7369 7665 6c79 2c0a 2020 2020  ecursively,.    
-0000b500: 2020 2020 2320 736f 2063 6865 636b 2073      # so check s
-0000b510: 7472 6561 6d20 6f66 6673 6574 2e0a 2020  tream offset..  
-0000b520: 2020 2020 2020 6669 6c65 436f 756e 7420        fileCount 
-0000b530: 3d20 7365 6c66 2e73 716c 436f 6e6e 6563  = self.sqlConnec
-0000b540: 7469 6f6e 2e65 7865 6375 7465 2827 5345  tion.execute('SE
-0000b550: 4c45 4354 2043 4f55 4e54 282a 2920 4652  LECT COUNT(*) FR
-0000b560: 4f4d 2022 6669 6c65 7322 3b27 292e 6665  OM "files";').fe
-0000b570: 7463 686f 6e65 2829 5b30 5d0a 2020 2020  tchone()[0].    
-0000b580: 2020 2020 6966 2066 696c 6543 6f75 6e74      if fileCount
-0000b590: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000b5a0: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
-0000b5b0: 203e 3d20 333a 0a20 2020 2020 2020 2020   >= 3:.         
-0000b5c0: 2020 2020 2020 2070 7269 6e74 2866 2244         print(f"D
-0000b5d0: 6964 206e 6f74 2066 696e 6420 616e 7920  id not find any 
-0000b5e0: 6669 6c65 2069 6e20 7468 6520 6769 7665  file in the give
-0000b5f0: 6e20 5441 523a 207b 7365 6c66 2e74 6172  n TAR: {self.tar
-0000b600: 4669 6c65 4e61 6d65 7d2e 2041 7373 756d  FileName}. Assum
-0000b610: 696e 6720 6120 636f 6d70 7265 7373 6564  ing a compressed
-0000b620: 2066 696c 652e 2229 0a0a 2020 2020 2020   file.")..      
-0000b630: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000b640: 2020 2020 2020 2020 2020 2074 6172 496e             tarIn
-0000b650: 666f 203d 206f 732e 6673 7461 7428 6669  fo = os.fstat(fi
-0000b660: 6c65 4f62 6a65 6374 2e66 696c 656e 6f28  leObject.fileno(
-0000b670: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
-0000b680: 7863 6570 7420 696f 2e55 6e73 7570 706f  xcept io.Unsuppo
-0000b690: 7274 6564 4f70 6572 6174 696f 6e3a 0a20  rtedOperation:. 
-0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b6b0: 2049 6620 6669 6c65 4f62 6a65 6374 2064   If fileObject d
-0000b6c0: 6f65 736e 2774 2068 6176 6520 6120 6669  oesn't have a fi
-0000b6d0: 6c65 6e6f 2c20 7765 2073 6574 2074 6172  leno, we set tar
-0000b6e0: 496e 666f 2074 6f20 4e6f 6e65 0a20 2020  Info to None.   
-0000b6f0: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-0000b700: 6e64 2073 6574 2074 6865 2072 656c 6576  nd set the relev
-0000b710: 616e 7420 7374 6174 6973 7469 6373 2028  ant statistics (
-0000b720: 7375 6368 2061 7320 7374 5f6d 7469 6d65  such as st_mtime
-0000b730: 2920 746f 2073 656e 7369 626c 6520 6465  ) to sensible de
-0000b740: 6661 756c 7473 2e0a 2020 2020 2020 2020  faults..        
-0000b750: 2020 2020 2020 2020 7461 7249 6e66 6f20          tarInfo 
-0000b760: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-0000b770: 2020 2066 6e61 6d65 203d 206f 732e 7061     fname = os.pa
-0000b780: 7468 2e62 6173 656e 616d 6528 7365 6c66  th.basename(self
-0000b790: 2e74 6172 4669 6c65 4e61 6d65 290a 2020  .tarFileName).  
-0000b7a0: 2020 2020 2020 2020 2020 666f 7220 7375            for su
-0000b7b0: 6666 6978 2069 6e20 5b27 2e67 7a27 2c20  ffix in ['.gz', 
-0000b7c0: 272e 627a 3227 2c20 272e 627a 6970 3227  '.bz2', '.bzip2'
-0000b7d0: 2c20 272e 677a 6970 272c 2027 2e78 7a27  , '.gzip', '.xz'
-0000b7e0: 2c20 272e 7a73 7427 2c20 272e 7a73 7464  , '.zst', '.zstd
-0000b7f0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0000b800: 2020 2020 6966 2066 6e61 6d65 2e6c 6f77      if fname.low
-0000b810: 6572 2829 2e65 6e64 7377 6974 6828 7375  er().endswith(su
-0000b820: 6666 6978 2920 616e 6420 6c65 6e28 666e  ffix) and len(fn
-0000b830: 616d 6529 203e 206c 656e 2873 7566 6669  ame) > len(suffi
-0000b840: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
-0000b850: 2020 2020 2020 2020 666e 616d 6520 3d20          fname = 
-0000b860: 666e 616d 655b 3a20 2d6c 656e 2873 7566  fname[: -len(suf
-0000b870: 6669 7829 5d0a 2020 2020 2020 2020 2020  fix)].          
-0000b880: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0000b890: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0000b8a0: 6620 7468 6520 6669 6c65 206f 626a 6563  f the file objec
-0000b8b0: 7420 6973 2061 6374 7561 6c6c 7920 616e  t is actually an
-0000b8c0: 2049 6e64 6578 6564 427a 6970 3246 696c   IndexedBzip2Fil
-0000b8d0: 6520 6f72 2073 7563 682c 2077 6520 6361  e or such, we ca
-0000b8e0: 6e27 7420 6469 7265 6374 6c79 2075 7365  n't directly use
-0000b8f0: 2074 6865 2066 696c 6520 7369 7a65 0a20   the file size. 
-0000b900: 2020 2020 2020 2020 2020 2023 2066 726f             # fro
-0000b910: 6d20 6f73 2e73 7461 7420 616e 6420 696e  m os.stat and in
-0000b920: 7374 6561 6420 6861 7665 2074 6f20 6761  stead have to ga
-0000b930: 7468 6572 2069 7420 6672 6f6d 2073 6565  ther it from see
-0000b940: 6b2e 2055 6e66 6f72 7475 6e61 7465 6c79  k. Unfortunately
-0000b950: 2c20 696e 6465 7865 645f 677a 6970 2064  , indexed_gzip d
-0000b960: 6f65 7320 6e6f 7420 7375 7070 6f72 740a  oes not support.
-0000b970: 2020 2020 2020 2020 2020 2020 2320 696f              # io
-0000b980: 2e53 4545 4b5f 454e 4420 6576 656e 2074  .SEEK_END even t
-0000b990: 686f 7567 6820 6974 2063 6f75 6c64 2061  hough it could a
-0000b9a0: 7320 6974 2068 6173 2074 6865 2069 6e64  s it has the ind
-0000b9b0: 6578 202e 2e2e 0a20 2020 2020 2020 2020  ex ....         
-0000b9c0: 2020 2077 6869 6c65 2066 696c 654f 626a     while fileObj
-0000b9d0: 6563 742e 7265 6164 2831 3032 3420 2a20  ect.read(1024 * 
-0000b9e0: 3130 3234 293a 0a20 2020 2020 2020 2020  1024):.         
-0000b9f0: 2020 2020 2020 2073 656c 662e 5f75 7064         self._upd
-0000ba00: 6174 6550 726f 6772 6573 7342 6172 2870  ateProgressBar(p
-0000ba10: 726f 6772 6573 7342 6172 2c20 6669 6c65  rogressBar, file
-0000ba20: 4f62 6a65 6374 290a 2020 2020 2020 2020  Object).        
-0000ba30: 2020 2020 6669 6c65 5369 7a65 203d 2066      fileSize = f
-0000ba40: 696c 654f 626a 6563 742e 7465 6c6c 2829  ileObject.tell()
-0000ba50: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000ba60: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
-0000ba70: 2020 2020 2066 696c 6549 6e66 6f20 3d20       fileInfo = 
-0000ba80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ba90: 2020 2222 2020 2020 2020 2020 2020 2020    ""            
-0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bab0: 2020 2020 2020 202c 2020 2320 3020 7061         ,  # 0 pa
-0000bac0: 7468 0a20 2020 2020 2020 2020 2020 2020  th.             
-0000bad0: 2020 2066 6e61 6d65 2020 2020 2020 2020     fname        
-0000bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000baf0: 2020 2020 2020 2020 2c20 2023 2031 0a20          ,  # 1. 
-0000bb00: 2020 2020 2020 2020 2020 2020 2020 204e                 N
-0000bb10: 6f6e 6520 2020 2020 2020 2020 2020 2020  one             
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb30: 2020 2020 2c20 2023 2032 2068 6561 6465      ,  # 2 heade
-0000bb40: 7220 6f66 6673 6574 0a20 2020 2020 2020  r offset.       
-0000bb50: 2020 2020 2020 2020 2030 2020 2020 2020           0      
-0000bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb70: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
-0000bb80: 2023 2033 2064 6174 6120 6f66 6673 6574   # 3 data offset
-0000bb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bba0: 2066 696c 6553 697a 6520 2020 2020 2020   fileSize       
-0000bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbc0: 2020 2020 2020 2c20 2023 2034 0a20 2020        ,  # 4.   
-0000bbd0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
-0000bbe0: 496e 666f 2e73 745f 6d74 696d 6520 6966  Info.st_mtime if
-0000bbf0: 2074 6172 496e 666f 2065 6c73 6520 3020   tarInfo else 0 
-0000bc00: 2020 2c20 2023 2035 0a20 2020 2020 2020    ,  # 5.       
-0000bc10: 2020 2020 2020 2020 2074 6172 496e 666f           tarInfo
-0000bc20: 2e73 745f 6d6f 6465 2069 6620 7461 7249  .st_mode if tarI
-0000bc30: 6e66 6f20 656c 7365 2030 6f37 3737 2c20  nfo else 0o777, 
-0000bc40: 2023 2036 0a20 2020 2020 2020 2020 2020   # 6.           
-0000bc50: 2020 2020 204e 6f6e 6520 2020 2020 2020       None       
+00009a40: 204e 6f74 6520 7468 6174 2077 6974 6820   Note that with 
+00009a50: 6967 6e6f 7265 5f7a 6572 6f73 203d 2054  ignore_zeros = T
+00009a60: 7275 652c 206e 6f20 696e 7661 6c69 6420  rue, no invalid 
+00009a70: 6865 6164 6572 2069 7373 7565 7320 6f72  header issues or
+00009a80: 2073 696d 696c 6172 2077 696c 6c20 6265   similar will be
+00009a90: 2072 6169 7365 6420 6576 656e 2066 6f72   raised even for
+00009aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009ab0: 2023 206e 6f6e 2054 4152 2066 696c 6573   # non TAR files
+00009ac0: 213f 0a20 2020 2020 2020 2020 2020 2020  !?.             
+00009ad0: 2020 206c 6f61 6465 6454 6172 4669 6c65     loadedTarFile
+00009ae0: 203d 2074 6172 6669 6c65 2e6f 7065 6e28   = tarfile.open(
+00009af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009b00: 2020 2020 2023 2066 6d74 3a6f 6666 0a20       # fmt:off. 
+00009b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b20: 2020 2066 696c 656f 626a 2020 2020 2020     fileobj      
+00009b30: 3d20 6669 6c65 4f62 6a65 6374 2c0a 2020  = fileObject,.  
+00009b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b50: 2020 6d6f 6465 2020 2020 2020 2020 203d    mode         =
+00009b60: 2027 727c 2720 6966 2073 656c 662e 636f   'r|' if self.co
+00009b70: 6d70 7265 7373 696f 6e20 656c 7365 2027  mpression else '
+00009b80: 723a 272c 0a20 2020 2020 2020 2020 2020  r:',.           
+00009b90: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+00009ba0: 7a65 726f 7320 3d20 7365 6c66 2e69 676e  zeros = self.ign
+00009bb0: 6f72 655a 6572 6f73 2c0a 2020 2020 2020  oreZeros,.      
+00009bc0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00009bd0: 636f 6469 6e67 2020 2020 203d 2073 656c  coding     = sel
+00009be0: 662e 656e 636f 6469 6e67 2c0a 2020 2020  f.encoding,.    
+00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c00: 2320 666d 743a 6f6e 0a20 2020 2020 2020  # fmt:on.       
+00009c10: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00009c20: 2020 2020 2020 2065 7863 6570 7420 7461         except ta
+00009c30: 7266 696c 652e 5265 6164 4572 726f 723a  rfile.ReadError:
+00009c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009c50: 2070 6173 730a 0a20 2020 2020 2020 2069   pass..        i
+00009c60: 6620 7072 6f67 7265 7373 4261 7220 6973  f progressBar is
+00009c70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00009c80: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00009c90: 2020 2020 2020 2020 7072 6f67 7265 7373          progress
+00009ca0: 4261 7220 3d20 5072 6f67 7265 7373 4261  Bar = ProgressBa
+00009cb0: 7228 6f73 2e66 7374 6174 2866 696c 654f  r(os.fstat(fileO
+00009cc0: 626a 6563 742e 6669 6c65 6e6f 2829 292e  bject.fileno()).
+00009cd0: 7374 5f73 697a 6529 0a20 2020 2020 2020  st_size).       
+00009ce0: 2020 2020 2065 7863 6570 7420 696f 2e55       except io.U
+00009cf0: 6e73 7570 706f 7274 6564 4f70 6572 6174  nsupportedOperat
+00009d00: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00009d10: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
+00009d20: 2020 2023 2033 2e20 4974 6572 6174 6520     # 3. Iterate 
+00009d30: 6f76 6572 2066 696c 6573 2069 6e73 6964  over files insid
+00009d40: 6520 5441 5220 616e 6420 6164 6420 7468  e TAR and add th
+00009d50: 656d 2074 6f20 7468 6520 6461 7461 6261  em to the databa
+00009d60: 7365 0a20 2020 2020 2020 2074 7279 3a0a  se.        try:.
+00009d70: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00009d80: 7354 6f4d 6f75 6e74 5265 6375 7273 6976  sToMountRecursiv
+00009d90: 656c 7920 3d20 5b5d 0a0a 2020 2020 2020  ely = []..      
+00009da0: 2020 2020 2020 666f 7220 7461 7249 6e66        for tarInf
+00009db0: 6f20 696e 206c 6f61 6465 6454 6172 4669  o in loadedTarFi
+00009dc0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00009dd0: 2020 2020 6c6f 6164 6564 5461 7246 696c      loadedTarFil
+00009de0: 652e 6d65 6d62 6572 7320 3d20 5b5d 2020  e.members = []  
+00009df0: 2320 436c 6561 7220 7468 6973 2069 6e20  # Clear this in 
+00009e00: 6f72 6465 7220 746f 206c 696d 6974 206d  order to limit m
+00009e10: 656d 6f72 7920 7573 6167 6520 6279 2074  emory usage by t
+00009e20: 6172 6669 6c65 0a20 2020 2020 2020 2020  arfile.         
+00009e30: 2020 2020 2020 2073 656c 662e 5f75 7064         self._upd
+00009e40: 6174 6550 726f 6772 6573 7342 6172 2870  ateProgressBar(p
+00009e50: 726f 6772 6573 7342 6172 2c20 6669 6c65  rogressBar, file
+00009e60: 4f62 6a65 6374 290a 0a20 2020 2020 2020  Object)..       
+00009e70: 2020 2020 2020 2020 2023 2041 6464 2061           # Add a
+00009e80: 206c 6561 6469 6e67 2027 2f27 2061 7320   leading '/' as 
+00009e90: 6120 636f 6e76 656e 7469 6f6e 2077 6865  a convention whe
+00009ea0: 7265 2027 2f27 2072 6570 7265 7365 6e74  re '/' represent
+00009eb0: 7320 7468 6520 5441 5220 726f 6f74 2066  s the TAR root f
+00009ec0: 6f6c 6465 720a 2020 2020 2020 2020 2020  older.          
+00009ed0: 2020 2020 2020 2320 5061 7274 6c79 2c20        # Partly, 
+00009ee0: 646f 6e65 2062 6563 6175 7365 2066 7573  done because fus
+00009ef0: 6570 7920 7370 6563 6966 6965 7320 7061  epy specifies pa
+00009f00: 7468 7320 696e 2061 206d 6f75 6e74 6564  ths in a mounted
+00009f10: 2064 6972 6563 746f 7279 206c 696b 6520   directory like 
+00009f20: 7468 6973 0a20 2020 2020 2020 2020 2020  this.           
+00009f30: 2020 2020 2023 206f 732e 6e6f 726d 7061       # os.normpa
+00009f40: 7468 2064 6f65 7320 6e6f 7420 6465 6c65  th does not dele
+00009f50: 7465 2064 7570 6c69 6361 7465 2027 2f27  te duplicate '/'
+00009f60: 2061 7420 6265 6769 6e6e 696e 6720 6f66   at beginning of
+00009f70: 2073 7472 696e 6721 0a20 2020 2020 2020   string!.       
+00009f80: 2020 2020 2020 2020 2023 2074 6172 496e           # tarIn
+00009f90: 666f 2e6e 616d 6520 6d69 6768 7420 6265  fo.name might be
+00009fa0: 2069 6465 6e74 6963 616c 2074 6f20 222e   identical to ".
+00009fb0: 2220 6f72 2062 6567 696e 2077 6974 6820  " or begin with 
+00009fc0: 222e 2f22 2c20 7768 6963 6820 6973 2062  "./", which is b
+00009fd0: 6164 210a 2020 2020 2020 2020 2020 2020  ad!.            
+00009fe0: 2020 2020 2320 6f73 2e70 6174 682e 6e6f      # os.path.no
+00009ff0: 726d 7061 7468 2063 616e 2072 656d 6f76  rmpath can remov
+0000a000: 6520 7375 6666 6978 6564 2066 6f6c 6465  e suffixed folde
+0000a010: 722f 2e2f 2070 6174 6820 7370 6563 6966  r/./ path specif
+0000a020: 6963 6174 696f 6e73 2062 7574 2069 7420  ications but it 
+0000a030: 6361 6e27 7420 7265 6d6f 7665 0a20 2020  can't remove.   
+0000a040: 2020 2020 2020 2020 2020 2020 2023 2061               # a
+0000a050: 206c 6561 6469 6e67 2064 6f74 2e0a 2020   leading dot..  
+0000a060: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a070: 544f 444f 3a20 576f 756c 6420 6265 2061  TODO: Would be a
+0000a080: 206e 6963 6520 6675 6e63 7469 6f6e 202f   nice function /
+0000a090: 206c 696e 6520 6f66 2063 6f64 6520 746f   line of code to
+0000a0a0: 2074 6573 7420 6265 6361 7573 6520 6974   test because it
+0000a0b0: 2069 7320 7665 7279 2066 696e 6963 6b79   is very finicky
+0000a0c0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a0d0: 2020 2320 2020 2020 2020 416e 6420 736f    #       And so
+0000a0e0: 6d65 2063 6173 6573 2061 7265 206f 6e6c  me cases are onl
+0000a0f0: 7920 7472 6967 6765 7265 6420 666f 7220  y triggered for 
+0000a100: 7265 6375 7273 6976 6520 6d6f 756e 7473  recursive mounts
+0000a110: 2c20 692e 652e 2c20 666f 7220 6e6f 6e2d  , i.e., for non-
+0000a120: 656d 7074 7920 7061 7468 5072 6566 6978  empty pathPrefix
+0000a130: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a140: 2020 6675 6c6c 5061 7468 203d 2022 2f22    fullPath = "/"
+0000a150: 202b 206f 732e 7061 7468 2e6e 6f72 6d70   + os.path.normp
+0000a160: 6174 6828 7061 7468 5072 6566 6978 202b  ath(pathPrefix +
+0000a170: 2022 2f22 202b 2074 6172 496e 666f 2e6e   "/" + tarInfo.n
+0000a180: 616d 6529 2e6c 7374 7269 7028 272f 2729  ame).lstrip('/')
+0000a190: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a1a0: 2020 2320 544f 444f 3a20 4173 2066 6f72    # TODO: As for
+0000a1b0: 2074 6865 2074 6172 6669 6c65 2074 7970   the tarfile typ
+0000a1c0: 6520 5351 4c69 7465 2065 7870 6563 7473  e SQLite expects
+0000a1d0: 2069 6e74 2062 7574 2069 7420 6973 2067   int but it is g
+0000a1e0: 656e 6572 616c 6c79 2062 7974 6573 2e0a  enerally bytes..
+0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a200: 2320 2020 2020 2020 4d6f 7374 206f 6620  #       Most of 
+0000a210: 7468 656d 2077 6f75 6c64 2062 6520 636f  them would be co
+0000a220: 6e76 6572 7469 626c 6520 746f 2069 6e74  nvertible to int
+0000a230: 206c 696b 6520 7461 7266 696c 652e 5359   like tarfile.SY
+0000a240: 4d54 5950 4520 7768 6963 6820 6973 2062  MTYPE which is b
+0000a250: 2732 272c 0a20 2020 2020 2020 2020 2020  '2',.           
+0000a260: 2020 2020 2023 2020 2020 2020 2062 7574       #       but
+0000a270: 206f 7468 6572 7320 7368 6f75 6c64 2074   others should t
+0000a280: 6872 6f77 2065 7272 6f72 732c 206c 696b  hrow errors, lik
+0000a290: 6520 474e 5554 5950 455f 5350 4152 5345  e GNUTYPE_SPARSE
+0000a2a0: 2077 6869 6368 2069 7320 6227 5327 2e0a   which is b'S'..
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2c0: 2320 2020 2020 2020 5768 656e 206c 6f6f  #       When loo
+0000a2d0: 6b69 6e67 2061 7420 7468 6520 6765 6e65  king at the gene
+0000a2e0: 7261 7465 6420 696e 6465 782c 2074 686f  rated index, tho
+0000a2f0: 7365 2076 616c 7565 7320 6765 7420 7369  se values get si
+0000a300: 6c65 6e74 6c79 2063 6f6e 7665 7274 6564  lently converted
+0000a310: 2074 6f20 303f 0a20 2020 2020 2020 2020   to 0?.         
+0000a320: 2020 2020 2020 2070 6174 682c 206e 616d         path, nam
+0000a330: 6520 3d20 6675 6c6c 5061 7468 2e72 7370  e = fullPath.rsp
+0000a340: 6c69 7428 222f 222c 2031 290a 2020 2020  lit("/", 1).    
+0000a350: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
+0000a360: 743a 206f 6666 0a20 2020 2020 2020 2020  t: off.         
+0000a370: 2020 2020 2020 2066 696c 6549 6e66 6f20         fileInfo 
+0000a380: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000a390: 2020 2020 2020 2020 7061 7468 2020 2020          path    
+0000a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3b0: 2020 2020 2020 2020 2020 2c20 2023 2030            ,  # 0
+0000a3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a3d0: 2020 2020 206e 616d 6520 2020 2020 2020       name       
+0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3f0: 2020 2020 2020 202c 2020 2320 310a 2020         ,  # 1.  
+0000a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a410: 2020 7374 7265 616d 4f66 6673 6574 202b    streamOffset +
+0000a420: 2074 6172 496e 666f 2e6f 6666 7365 7420   tarInfo.offset 
+0000a430: 2020 2020 2c20 2023 2032 0a20 2020 2020      ,  # 2.     
+0000a440: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000a450: 7472 6561 6d4f 6666 7365 7420 2b20 7461  treamOffset + ta
+0000a460: 7249 6e66 6f2e 6f66 6673 6574 5f64 6174  rInfo.offset_dat
+0000a470: 612c 2020 2320 330a 2020 2020 2020 2020  a,  # 3.        
+0000a480: 2020 2020 2020 2020 2020 2020 7461 7249              tarI
+0000a490: 6e66 6f2e 7369 7a65 2020 2020 2020 2020  nfo.size        
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
+0000a4b0: 2023 2034 0a20 2020 2020 2020 2020 2020   # 4.           
+0000a4c0: 2020 2020 2020 2020 2074 6172 496e 666f           tarInfo
+0000a4d0: 2e6d 7469 6d65 2020 2020 2020 2020 2020  .mtime          
+0000a4e0: 2020 2020 2020 2020 2020 202c 2020 2320             ,  # 
+0000a4f0: 350a 2020 2020 2020 2020 2020 2020 2020  5.              
+0000a500: 2020 2020 2020 7365 6c66 2e5f 7461 7249        self._tarI
+0000a510: 6e66 6f46 756c 6c4d 6f64 6528 7461 7249  nfoFullMode(tarI
+0000a520: 6e66 6f29 2020 2020 2c20 2023 2036 0a20  nfo)    ,  # 6. 
+0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a540: 2020 2074 6172 496e 666f 2e74 7970 6520     tarInfo.type 
+0000a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a560: 2020 2020 202c 2020 2320 370a 2020 2020       ,  # 7.    
+0000a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a580: 7461 7249 6e66 6f2e 6c69 6e6b 6e61 6d65  tarInfo.linkname
+0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5a0: 2020 2c20 2023 2038 0a20 2020 2020 2020    ,  # 8.       
+0000a5b0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
+0000a5c0: 496e 666f 2e75 6964 2020 2020 2020 2020  Info.uid        
+0000a5d0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0000a5e0: 2020 2320 390a 2020 2020 2020 2020 2020    # 9.          
+0000a5f0: 2020 2020 2020 2020 2020 7461 7249 6e66            tarInf
+0000a600: 6f2e 6769 6420 2020 2020 2020 2020 2020  o.gid           
+0000a610: 2020 2020 2020 2020 2020 2020 2c20 2023              ,  #
+0000a620: 2031 300a 2020 2020 2020 2020 2020 2020   10.            
+0000a630: 2020 2020 2020 2020 4661 6c73 6520 2020          False   
+0000a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a650: 2020 2020 2020 2020 2020 2c20 2023 2031            ,  # 1
+0000a660: 3120 2869 7354 6172 290a 2020 2020 2020  1 (isTar).      
+0000a670: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+0000a680: 7249 6e66 6f2e 6973 7370 6172 7365 2829  rInfo.issparse()
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6a0: 2c20 2023 2031 320a 2020 2020 2020 2020  ,  # 12.        
+0000a6b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000a6c0: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
+0000a6d0: 206f 6e0a 0a20 2020 2020 2020 2020 2020   on..           
+0000a6e0: 2020 2020 2069 6620 7365 6c66 2e6d 6f75       if self.mou
+0000a6f0: 6e74 5265 6375 7273 6976 656c 7920 616e  ntRecursively an
+0000a700: 6420 7461 7249 6e66 6f2e 6973 6669 6c65  d tarInfo.isfile
+0000a710: 2829 2061 6e64 2074 6172 496e 666f 2e6e  () and tarInfo.n
+0000a720: 616d 652e 6c6f 7765 7228 292e 656e 6473  ame.lower().ends
+0000a730: 7769 7468 2827 2e74 6172 2729 3a0a 2020  with('.tar'):.  
+0000a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a750: 2020 6669 6c65 7354 6f4d 6f75 6e74 5265    filesToMountRe
+0000a760: 6375 7273 6976 656c 792e 6170 7065 6e64  cursively.append
+0000a770: 2866 696c 6549 6e66 6f29 0a20 2020 2020  (fileInfo).     
+0000a780: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000a790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a7a0: 2020 2020 2073 656c 662e 5f73 6574 4669       self._setFi
+0000a7b0: 6c65 496e 666f 2866 696c 6549 6e66 6f29  leInfo(fileInfo)
+0000a7c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000a7d0: 7461 7266 696c 652e 5265 6164 4572 726f  tarfile.ReadErro
+0000a7e0: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0000a7f0: 2020 2020 6966 2027 756e 6578 7065 6374      if 'unexpect
+0000a800: 6564 2065 6e64 206f 6620 6461 7461 2720  ed end of data' 
+0000a810: 696e 2073 7472 2865 293a 0a20 2020 2020  in str(e):.     
+0000a820: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000a830: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000a840: 2020 2020 2020 225b 5761 726e 696e 675d        "[Warning]
+0000a850: 2054 6865 2054 4152 2066 696c 6520 6973   The TAR file is
+0000a860: 2069 6e63 6f6d 706c 6574 652e 2052 6174   incomplete. Rat
+0000a870: 6172 6d6f 756e 7420 7769 6c6c 2077 6f72  armount will wor
+0000a880: 6b20 6275 7420 736f 6d65 2066 696c 6573  k but some files
+0000a890: 206d 6967 6874 2062 6520 6375 7420 6f66   might be cut of
+0000a8a0: 662e 2022 0a20 2020 2020 2020 2020 2020  f. ".           
+0000a8b0: 2020 2020 2020 2020 2022 4966 2074 6865           "If the
+0000a8c0: 2054 4152 2066 696c 6520 7369 7a65 2063   TAR file size c
+0000a8d0: 6861 6e67 6573 2c20 7261 7461 726d 6f75  hanges, ratarmou
+0000a8e0: 6e74 2077 696c 6c20 7265 6372 6561 7465  nt will recreate
+0000a8f0: 2074 6865 2069 6e64 6578 2064 7572 696e   the index durin
+0000a900: 6720 7468 6520 6e65 7874 206d 6f75 6e74  g the next mount
+0000a910: 696e 672e 220a 2020 2020 2020 2020 2020  ing.".          
+0000a920: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000a930: 2023 2034 2e20 4f70 656e 2063 6f6e 7461   # 4. Open conta
+0000a940: 696e 6564 2054 4152 7320 666f 7220 7265  ined TARs for re
+0000a950: 6375 7273 6976 6520 6d6f 756e 7469 6e67  cursive mounting
+0000a960: 0a20 2020 2020 2020 206f 6c64 506f 7320  .        oldPos 
+0000a970: 3d20 6669 6c65 4f62 6a65 6374 2e74 656c  = fileObject.tel
+0000a980: 6c28 290a 2020 2020 2020 2020 6f6c 6450  l().        oldP
+0000a990: 7269 6e74 4e61 6d65 203d 2073 656c 662e  rintName = self.
+0000a9a0: 7461 7246 696c 654e 616d 650a 2020 2020  tarFileName.    
+0000a9b0: 2020 2020 666f 7220 6669 6c65 496e 666f      for fileInfo
+0000a9c0: 2069 6e20 6669 6c65 7354 6f4d 6f75 6e74   in filesToMount
+0000a9d0: 5265 6375 7273 6976 656c 793a 0a20 2020  Recursively:.   
+0000a9e0: 2020 2020 2020 2020 2023 2053 7472 6970           # Strip
+0000a9f0: 2066 696c 6520 6578 7465 6e73 696f 6e20   file extension 
+0000aa00: 666f 7220 6d6f 756e 7420 706f 696e 7420  for mount point 
+0000aa10: 6966 2073 6f20 636f 6e66 6967 7572 6564  if so configured
+0000aa20: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+0000aa30: 6966 6965 644e 616d 6520 3d20 6669 6c65  ifiedName = file
+0000aa40: 496e 666f 5b31 5d0a 2020 2020 2020 2020  Info[1].        
+0000aa50: 2020 2020 7461 7245 7874 656e 7369 6f6e      tarExtension
+0000aa60: 203d 2027 2e74 6172 270a 2020 2020 2020   = '.tar'.      
+0000aa70: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+0000aa80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000aa90: 7374 7269 7052 6563 7572 7369 7665 5461  stripRecursiveTa
+0000aaa0: 7245 7874 656e 7369 6f6e 0a20 2020 2020  rExtension.     
+0000aab0: 2020 2020 2020 2020 2020 2061 6e64 206c             and l
+0000aac0: 656e 2874 6172 4578 7465 6e73 696f 6e29  en(tarExtension)
+0000aad0: 203e 2030 0a20 2020 2020 2020 2020 2020   > 0.           
+0000aae0: 2020 2020 2061 6e64 206d 6f64 6966 6965       and modifie
+0000aaf0: 644e 616d 652e 6c6f 7765 7228 292e 656e  dName.lower().en
+0000ab00: 6473 7769 7468 2874 6172 4578 7465 6e73  dswith(tarExtens
+0000ab10: 696f 6e2e 6c6f 7765 7228 2929 0a20 2020  ion.lower()).   
+0000ab20: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+0000ab30: 2020 2020 2020 2020 2020 2020 6d6f 6469              modi
+0000ab40: 6669 6564 4e61 6d65 203d 206d 6f64 6966  fiedName = modif
+0000ab50: 6965 644e 616d 655b 3a20 2d6c 656e 2874  iedName[: -len(t
+0000ab60: 6172 4578 7465 6e73 696f 6e29 5d0a 0a20  arExtension)].. 
+0000ab70: 2020 2020 2020 2020 2020 2023 2054 656d             # Tem
+0000ab80: 706f 7261 7269 6c79 2063 6861 6e67 6520  porarily change 
+0000ab90: 7461 7246 696c 654e 616d 6520 666f 7220  tarFileName for 
+0000aba0: 7468 6520 696e 666f 206f 7574 7075 7420  the info output 
+0000abb0: 6f66 2074 6865 2072 6563 7572 7369 7665  of the recursive
+0000abc0: 2063 616c 6c0a 2020 2020 2020 2020 2020   call.          
+0000abd0: 2020 7365 6c66 2e74 6172 4669 6c65 4e61    self.tarFileNa
+0000abe0: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
+0000abf0: 6e28 6669 6c65 496e 666f 5b30 5d2c 2066  n(fileInfo[0], f
+0000ac00: 696c 6549 6e66 6f5b 315d 290a 0a20 2020  ileInfo[1])..   
+0000ac10: 2020 2020 2020 2020 2023 2053 7465 6e63           # Stenc
+0000ac20: 696c 6564 4669 6c65 2773 2074 656c 6c20  iledFile's tell 
+0000ac30: 7265 7475 726e 7320 7468 6520 6f66 6673  returns the offs
+0000ac40: 6574 2069 6e73 6964 6520 7468 6520 6669  et inside the fi
+0000ac50: 6c65 2063 6875 6e6b 2069 6e73 7465 6164  le chunk instead
+0000ac60: 206f 6620 7468 6520 676c 6f62 616c 206f   of the global o
+0000ac70: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0000ac80: 2320 736f 2077 6520 6861 7665 2074 6f20  # so we have to 
+0000ac90: 616c 7761 7973 2063 6f6d 6d75 6e69 6361  always communica
+0000aca0: 7465 2074 6865 206f 6666 7365 7420 6f66  te the offset of
+0000acb0: 2074 6869 7320 6368 756e 6b20 746f 2074   this chunk to t
+0000acc0: 6865 2072 6563 7572 7369 7665 2063 616c  he recursive cal
+0000acd0: 6c20 6e6f 206d 6174 7465 720a 2020 2020  l no matter.    
+0000ace0: 2020 2020 2020 2020 2320 7768 6574 6865          # whethe
+0000acf0: 7220 7461 7266 696c 6520 6861 7320 7374  r tarfile has st
+0000ad00: 7265 616d 696e 6720 6163 6365 7373 206f  reaming access o
+0000ad10: 7220 7365 656b 696e 6720 6163 6365 7373  r seeking access
+0000ad20: 210a 2020 2020 2020 2020 2020 2020 676c  !.            gl
+0000ad30: 6f62 616c 4f66 6673 6574 203d 2066 696c  obalOffset = fil
+0000ad40: 6549 6e66 6f5b 335d 0a20 2020 2020 2020  eInfo[3].       
+0000ad50: 2020 2020 2073 697a 6520 3d20 6669 6c65       size = file
+0000ad60: 496e 666f 5b34 5d0a 2020 2020 2020 2020  Info[4].        
+0000ad70: 2020 2020 7461 7246 696c 654f 626a 6563      tarFileObjec
+0000ad80: 7420 3d20 5374 656e 6369 6c65 6446 696c  t = StenciledFil
+0000ad90: 6528 6669 6c65 4f62 6a65 6374 2c20 5b28  e(fileObject, [(
+0000ada0: 676c 6f62 616c 4f66 6673 6574 2c20 7369  globalOffset, si
+0000adb0: 7a65 295d 290a 0a20 2020 2020 2020 2020  ze)])..         
+0000adc0: 2020 2069 7354 6172 203d 2046 616c 7365     isTar = False
+0000add0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000ade0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000adf0: 2020 2320 446f 206e 6f74 2075 7365 206f    # Do not use o
+0000ae00: 732e 7061 7468 2e6a 6f69 6e20 6865 7265  s.path.join here
+0000ae10: 2062 6563 6175 7365 2074 6865 206c 6561   because the lea
+0000ae20: 6469 6e67 202f 206d 6967 6874 2062 6520  ding / might be 
+0000ae30: 6d69 7373 696e 672e 0a20 2020 2020 2020  missing..       
+0000ae40: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
+0000ae50: 7368 6f75 6c64 2069 6e73 7465 6164 2062  should instead b
+0000ae60: 6520 7365 656e 2061 7320 7468 6520 7265  e seen as the re
+0000ae70: 7665 7273 6520 6f70 6572 6174 696f 6e20  verse operation 
+0000ae80: 6f66 2074 6865 2072 7370 6c69 7420 6675  of the rsplit fu
+0000ae90: 7274 6865 7220 6162 6f76 652e 0a20 2020  rther above..   
+0000aea0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000aeb0: 662e 5f63 7265 6174 6549 6e64 6578 2874  f._createIndex(t
+0000aec0: 6172 4669 6c65 4f62 6a65 6374 2c20 7072  arFileObject, pr
+0000aed0: 6f67 7265 7373 4261 722c 2022 2f22 2e6a  ogressBar, "/".j
+0000aee0: 6f69 6e28 5b66 696c 6549 6e66 6f5b 305d  oin([fileInfo[0]
+0000aef0: 2c20 6d6f 6469 6669 6564 4e61 6d65 5d29  , modifiedName])
+0000af00: 2c20 676c 6f62 616c 4f66 6673 6574 290a  , globalOffset).
+0000af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af20: 6973 5461 7220 3d20 5472 7565 0a20 2020  isTar = True.   
+0000af30: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000af40: 7461 7266 696c 652e 5265 6164 4572 726f  tarfile.ReadErro
+0000af50: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0000af60: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0000af70: 2020 2020 6669 6e61 6c6c 793a 0a20 2020      finally:.   
+0000af80: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0000af90: 2074 6172 4669 6c65 4f62 6a65 6374 0a0a   tarFileObject..
+0000afa0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000afb0: 7354 6172 3a0a 2020 2020 2020 2020 2020  sTar:.          
+0000afc0: 2020 2020 2020 6d6f 6469 6669 6564 4669        modifiedFi
+0000afd0: 6c65 496e 666f 203d 206c 6973 7428 6669  leInfo = list(fi
+0000afe0: 6c65 496e 666f 290a 0a20 2020 2020 2020  leInfo)..       
+0000aff0: 2020 2020 2020 2020 2023 2069 6620 7468           # if th
+0000b000: 6520 5441 5220 6669 6c65 2063 6f6e 7465  e TAR file conte
+0000b010: 6e74 7320 636f 756c 6420 6265 2072 6561  nts could be rea
+0000b020: 642c 2077 6520 6e65 6564 2074 6f20 6164  d, we need to ad
+0000b030: 6a75 7374 2074 6865 2061 6374 7561 6c0a  just the actual.
+0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b050: 2320 5441 5220 6669 6c65 2773 206d 6574  # TAR file's met
+0000b060: 6164 6174 6120 746f 2062 6520 6120 6469  adata to be a di
+0000b070: 7265 6374 6f72 7920 696e 7374 6561 6420  rectory instead 
+0000b080: 6f66 2061 2066 696c 650a 2020 2020 2020  of a file.      
+0000b090: 2020 2020 2020 2020 2020 6d6f 6465 203d            mode =
+0000b0a0: 206d 6f64 6966 6965 6446 696c 6549 6e66   modifiedFileInf
+0000b0b0: 6f5b 365d 0a20 2020 2020 2020 2020 2020  o[6].           
+0000b0c0: 2020 2020 206d 6f64 6520 3d20 280a 2020       mode = (.  
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 2020 286d 6f64 6520 2620 306f 3737 3729    (mode & 0o777)
+0000b0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b100: 2020 2020 207c 2073 7461 742e 535f 4946       | stat.S_IF
+0000b110: 4449 520a 2020 2020 2020 2020 2020 2020  DIR.            
+0000b120: 2020 2020 2020 2020 7c20 2873 7461 742e          | (stat.
+0000b130: 535f 4958 5553 5220 6966 206d 6f64 6520  S_IXUSR if mode 
+0000b140: 2620 7374 6174 2e53 5f49 5255 5352 2021  & stat.S_IRUSR !
+0000b150: 3d20 3020 656c 7365 2030 290a 2020 2020  = 0 else 0).    
+0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b170: 7c20 2873 7461 742e 535f 4958 4752 5020  | (stat.S_IXGRP 
+0000b180: 6966 206d 6f64 6520 2620 7374 6174 2e53  if mode & stat.S
+0000b190: 5f49 5247 5250 2021 3d20 3020 656c 7365  _IRGRP != 0 else
+0000b1a0: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+0000b1b0: 2020 2020 2020 2020 7c20 2873 7461 742e          | (stat.
+0000b1c0: 535f 4958 4f54 4820 6966 206d 6f64 6520  S_IXOTH if mode 
+0000b1d0: 2620 7374 6174 2e53 5f49 524f 5448 2021  & stat.S_IROTH !
+0000b1e0: 3d20 3020 656c 7365 2030 290a 2020 2020  = 0 else 0).    
+0000b1f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0000b200: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000b210: 6f64 6966 6965 6446 696c 6549 6e66 6f5b  odifiedFileInfo[
+0000b220: 305d 203d 2066 696c 6549 6e66 6f5b 305d  0] = fileInfo[0]
+0000b230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b240: 206d 6f64 6966 6965 6446 696c 6549 6e66   modifiedFileInf
+0000b250: 6f5b 315d 203d 206d 6f64 6966 6965 644e  o[1] = modifiedN
+0000b260: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0000b270: 2020 2020 6d6f 6469 6669 6564 4669 6c65      modifiedFile
+0000b280: 496e 666f 5b36 5d20 3d20 6d6f 6465 0a20  Info[6] = mode. 
+0000b290: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000b2a0: 6f64 6966 6965 6446 696c 6549 6e66 6f5b  odifiedFileInfo[
+0000b2b0: 3131 5d20 3d20 6973 5461 720a 0a20 2020  11] = isTar..   
+0000b2c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b2d0: 662e 5f73 6574 4669 6c65 496e 666f 2874  f._setFileInfo(t
+0000b2e0: 7570 6c65 286d 6f64 6966 6965 6446 696c  uple(modifiedFil
+0000b2f0: 6549 6e66 6f29 290a 2020 2020 2020 2020  eInfo)).        
+0000b300: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000b310: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000b320: 7365 7446 696c 6549 6e66 6f28 6669 6c65  setFileInfo(file
+0000b330: 496e 666f 290a 0a20 2020 2020 2020 2066  Info)..        f
+0000b340: 696c 654f 626a 6563 742e 7365 656b 286f  ileObject.seek(o
+0000b350: 6c64 506f 7329 0a20 2020 2020 2020 2073  ldPos).        s
+0000b360: 656c 662e 7461 7246 696c 654e 616d 6520  elf.tarFileName 
+0000b370: 3d20 6f6c 6450 7269 6e74 4e61 6d65 0a0a  = oldPrintName..
+0000b380: 2020 2020 2020 2020 2320 4576 6572 7974          # Everyt
+0000b390: 6869 6e67 2062 656c 6f77 2073 686f 756c  hing below shoul
+0000b3a0: 6420 6e6f 7420 6265 2064 6f6e 6520 696e  d not be done in
+0000b3b0: 2061 2072 6563 7572 7369 7665 2063 616c   a recursive cal
+0000b3c0: 6c20 6f66 2063 7265 6174 6549 6e64 6578  l of createIndex
+0000b3d0: 0a20 2020 2020 2020 2069 6620 7374 7265  .        if stre
+0000b3e0: 616d 4f66 6673 6574 203e 2030 3a0a 2020  amOffset > 0:.  
+0000b3f0: 2020 2020 2020 2020 2020 7431 203d 2074            t1 = t
+0000b400: 696d 6572 2829 0a20 2020 2020 2020 2020  imer().         
+0000b410: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
+0000b420: 203e 3d20 313a 0a20 2020 2020 2020 2020   >= 1:.         
+0000b430: 2020 2020 2020 2070 7269 6e74 2822 4372         print("Cr
+0000b440: 6561 7469 6e67 206f 6666 7365 7420 6469  eating offset di
+0000b450: 6374 696f 6e61 7279 2066 6f72 222c 2073  ctionary for", s
+0000b460: 656c 662e 7461 7246 696c 654e 616d 652c  elf.tarFileName,
+0000b470: 2022 746f 6f6b 207b 3a2e 3266 7d73 222e   "took {:.2f}s".
+0000b480: 666f 726d 6174 2874 3120 2d20 7430 2929  format(t1 - t0))
+0000b490: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000b4a0: 7572 6e0a 0a20 2020 2020 2020 2023 2049  urn..        # I
+0000b4b0: 6620 6e6f 2066 696c 6520 6973 2069 6e20  f no file is in 
+0000b4c0: 7468 6520 5441 522c 2074 6865 6e20 6974  the TAR, then it
+0000b4d0: 206d 6f73 7420 6c69 6b65 6c79 2069 6e64   most likely ind
+0000b4e0: 6963 6174 6573 2061 2070 6f73 7369 626c  icates a possibl
+0000b4f0: 7920 636f 6d70 7265 7373 6564 206e 6f6e  y compressed non
+0000b500: 2054 4152 2066 696c 652e 0a20 2020 2020   TAR file..     
+0000b510: 2020 2023 2049 6e20 7468 6174 2063 6173     # In that cas
+0000b520: 6520 6164 6420 7468 6174 2069 7473 656c  e add that itsel
+0000b530: 6620 746f 2074 6865 2066 696c 6520 696e  f to the file in
+0000b540: 6465 782e 2054 6869 7320 776f 6e27 7420  dex. This won't 
+0000b550: 776f 726b 2077 6865 6e20 6361 6c6c 6564  work when called
+0000b560: 2072 6563 7572 7369 7665 6c79 2c0a 2020   recursively,.  
+0000b570: 2020 2020 2020 2320 736f 2063 6865 636b        # so check
+0000b580: 2073 7472 6561 6d20 6f66 6673 6574 2e0a   stream offset..
+0000b590: 2020 2020 2020 2020 6669 6c65 436f 756e          fileCoun
+0000b5a0: 7420 3d20 7365 6c66 2e73 716c 436f 6e6e  t = self.sqlConn
+0000b5b0: 6563 7469 6f6e 2e65 7865 6375 7465 2827  ection.execute('
+0000b5c0: 5345 4c45 4354 2043 4f55 4e54 282a 2920  SELECT COUNT(*) 
+0000b5d0: 4652 4f4d 2022 6669 6c65 7322 3b27 292e  FROM "files";').
+0000b5e0: 6665 7463 686f 6e65 2829 5b30 5d0a 2020  fetchone()[0].  
+0000b5f0: 2020 2020 2020 6966 2066 696c 6543 6f75        if fileCou
+0000b600: 6e74 203d 3d20 303a 0a20 2020 2020 2020  nt == 0:.       
+0000b610: 2020 2020 2069 6620 7072 696e 7444 6562       if printDeb
+0000b620: 7567 203e 3d20 333a 0a20 2020 2020 2020  ug >= 3:.       
+0000b630: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+0000b640: 2244 6964 206e 6f74 2066 696e 6420 616e  "Did not find an
+0000b650: 7920 6669 6c65 2069 6e20 7468 6520 6769  y file in the gi
+0000b660: 7665 6e20 5441 523a 207b 7365 6c66 2e74  ven TAR: {self.t
+0000b670: 6172 4669 6c65 4e61 6d65 7d2e 2041 7373  arFileName}. Ass
+0000b680: 756d 696e 6720 6120 636f 6d70 7265 7373  uming a compress
+0000b690: 6564 2066 696c 652e 2229 0a0a 2020 2020  ed file.")..    
+0000b6a0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000b6b0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
+0000b6c0: 496e 666f 203d 206f 732e 6673 7461 7428  Info = os.fstat(
+0000b6d0: 6669 6c65 4f62 6a65 6374 2e66 696c 656e  fileObject.filen
+0000b6e0: 6f28 2929 0a20 2020 2020 2020 2020 2020  o()).           
+0000b6f0: 2065 7863 6570 7420 696f 2e55 6e73 7570   except io.Unsup
+0000b700: 706f 7274 6564 4f70 6572 6174 696f 6e3a  portedOperation:
+0000b710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b720: 2023 2049 6620 6669 6c65 4f62 6a65 6374   # If fileObject
+0000b730: 2064 6f65 736e 2774 2068 6176 6520 6120   doesn't have a 
+0000b740: 6669 6c65 6e6f 2c20 7765 2073 6574 2074  fileno, we set t
+0000b750: 6172 496e 666f 2074 6f20 4e6f 6e65 0a20  arInfo to None. 
+0000b760: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000b770: 2061 6e64 2073 6574 2074 6865 2072 656c   and set the rel
+0000b780: 6576 616e 7420 7374 6174 6973 7469 6373  evant statistics
+0000b790: 2028 7375 6368 2061 7320 7374 5f6d 7469   (such as st_mti
+0000b7a0: 6d65 2920 746f 2073 656e 7369 626c 6520  me) to sensible 
+0000b7b0: 6465 6661 756c 7473 2e0a 2020 2020 2020  defaults..      
+0000b7c0: 2020 2020 2020 2020 2020 7461 7249 6e66            tarInf
+0000b7d0: 6f20 3d20 4e6f 6e65 0a20 2020 2020 2020  o = None.       
+0000b7e0: 2020 2020 2066 6e61 6d65 203d 206f 732e       fname = os.
+0000b7f0: 7061 7468 2e62 6173 656e 616d 6528 7365  path.basename(se
+0000b800: 6c66 2e74 6172 4669 6c65 4e61 6d65 290a  lf.tarFileName).
+0000b810: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000b820: 7375 6666 6978 2069 6e20 5b27 2e67 7a27  suffix in ['.gz'
+0000b830: 2c20 272e 627a 3227 2c20 272e 627a 6970  , '.bz2', '.bzip
+0000b840: 3227 2c20 272e 677a 6970 272c 2027 2e78  2', '.gzip', '.x
+0000b850: 7a27 2c20 272e 7a73 7427 2c20 272e 7a73  z', '.zst', '.zs
+0000b860: 7464 275d 3a0a 2020 2020 2020 2020 2020  td']:.          
+0000b870: 2020 2020 2020 6966 2066 6e61 6d65 2e6c        if fname.l
+0000b880: 6f77 6572 2829 2e65 6e64 7377 6974 6828  ower().endswith(
+0000b890: 7375 6666 6978 2920 616e 6420 6c65 6e28  suffix) and len(
+0000b8a0: 666e 616d 6529 203e 206c 656e 2873 7566  fname) > len(suf
+0000b8b0: 6669 7829 3a0a 2020 2020 2020 2020 2020  fix):.          
+0000b8c0: 2020 2020 2020 2020 2020 666e 616d 6520            fname 
+0000b8d0: 3d20 666e 616d 655b 3a20 2d6c 656e 2873  = fname[: -len(s
+0000b8e0: 7566 6669 7829 5d0a 2020 2020 2020 2020  uffix)].        
+0000b8f0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0000b900: 6b0a 0a20 2020 2020 2020 2020 2020 2023  k..            #
+0000b910: 2049 6620 7468 6520 6669 6c65 206f 626a   If the file obj
+0000b920: 6563 7420 6973 2061 6374 7561 6c6c 7920  ect is actually 
+0000b930: 616e 2049 6e64 6578 6564 427a 6970 3246  an IndexedBzip2F
+0000b940: 696c 6520 6f72 2073 7563 682c 2077 6520  ile or such, we 
+0000b950: 6361 6e27 7420 6469 7265 6374 6c79 2075  can't directly u
+0000b960: 7365 2074 6865 2066 696c 6520 7369 7a65  se the file size
+0000b970: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
+0000b980: 726f 6d20 6f73 2e73 7461 7420 616e 6420  rom os.stat and 
+0000b990: 696e 7374 6561 6420 6861 7665 2074 6f20  instead have to 
+0000b9a0: 6761 7468 6572 2069 7420 6672 6f6d 2073  gather it from s
+0000b9b0: 6565 6b2e 2055 6e66 6f72 7475 6e61 7465  eek. Unfortunate
+0000b9c0: 6c79 2c20 696e 6465 7865 645f 677a 6970  ly, indexed_gzip
+0000b9d0: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+0000b9e0: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+0000b9f0: 696f 2e53 4545 4b5f 454e 4420 6576 656e  io.SEEK_END even
+0000ba00: 2074 686f 7567 6820 6974 2063 6f75 6c64   though it could
+0000ba10: 2061 7320 6974 2068 6173 2074 6865 2069   as it has the i
+0000ba20: 6e64 6578 202e 2e2e 0a20 2020 2020 2020  ndex ....       
+0000ba30: 2020 2020 2077 6869 6c65 2066 696c 654f       while fileO
+0000ba40: 626a 6563 742e 7265 6164 2831 3032 3420  bject.read(1024 
+0000ba50: 2a20 3130 3234 293a 0a20 2020 2020 2020  * 1024):.       
+0000ba60: 2020 2020 2020 2020 2073 656c 662e 5f75           self._u
+0000ba70: 7064 6174 6550 726f 6772 6573 7342 6172  pdateProgressBar
+0000ba80: 2870 726f 6772 6573 7342 6172 2c20 6669  (progressBar, fi
+0000ba90: 6c65 4f62 6a65 6374 290a 2020 2020 2020  leObject).      
+0000baa0: 2020 2020 2020 6669 6c65 5369 7a65 203d        fileSize =
+0000bab0: 2066 696c 654f 626a 6563 742e 7465 6c6c   fileObject.tell
+0000bac0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0000bad0: 6d6f 6465 203d 2030 6f37 3737 207c 2073  mode = 0o777 | s
+0000bae0: 7461 742e 535f 4946 5245 4720 2023 2064  tat.S_IFREG  # d
+0000baf0: 6566 6175 6c74 206d 6f64 650a 0a20 2020  efault mode..   
+0000bb00: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
+0000bb10: 6f66 660a 2020 2020 2020 2020 2020 2020  off.            
+0000bb20: 6669 6c65 496e 666f 203d 2028 0a20 2020  fileInfo = (.   
+0000bb30: 2020 2020 2020 2020 2020 2020 2022 2220               "" 
+0000bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb60: 2020 2c20 2023 2030 2070 6174 680a 2020    ,  # 0 path.  
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 666e                fn
+0000bb80: 616d 6520 2020 2020 2020 2020 2020 2020  ame             
+0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bba0: 2020 202c 2020 2320 310a 2020 2020 2020     ,  # 1.      
+0000bbb0: 2020 2020 2020 2020 2020 4e6f 6e65 2020            None  
+0000bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbd0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0000bbe0: 2020 2320 3220 6865 6164 6572 206f 6666    # 2 header off
+0000bbf0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+0000bc00: 2020 2020 3020 2020 2020 2020 2020 2020      0           
+0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc20: 2020 2020 2020 2020 202c 2020 2320 3320           ,  # 3 
+0000bc30: 6461 7461 206f 6666 7365 740a 2020 2020  data offset.    
+0000bc40: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000bc50: 5369 7a65 2020 2020 2020 2020 2020 2020  Size            
 0000bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc70: 2020 2020 2020 2020 2020 2c20 2023 2037            ,  # 7
-0000bc80: 2054 4152 2066 696c 6520 7479 7065 2e20   TAR file type. 
-0000bc90: 4375 7272 656e 746c 7920 756e 7573 6564  Currently unused
-0000bca0: 2e20 4f76 6572 6c61 7073 2077 6974 6820  . Overlaps with 
-0000bcb0: 6d6f 6465 0a20 2020 2020 2020 2020 2020  mode.           
-0000bcc0: 2020 2020 204e 6f6e 6520 2020 2020 2020       None       
-0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bce0: 2020 2020 2020 2020 2020 2c20 2023 2038            ,  # 8
-0000bcf0: 206c 696e 6b6e 616d 650a 2020 2020 2020   linkname.      
-0000bd00: 2020 2020 2020 2020 2020 7461 7249 6e66            tarInf
-0000bd10: 6f2e 7374 5f75 6964 2069 6620 7461 7249  o.st_uid if tarI
-0000bd20: 6e66 6f20 656c 7365 2030 2020 2020 202c  nfo else 0     ,
-0000bd30: 2020 2320 390a 2020 2020 2020 2020 2020    # 9.          
-0000bd40: 2020 2020 2020 7461 7249 6e66 6f2e 7374        tarInfo.st
-0000bd50: 5f67 6964 2069 6620 7461 7249 6e66 6f20  _gid if tarInfo 
-0000bd60: 656c 7365 2030 2020 2020 202c 2020 2320  else 0     ,  # 
-0000bd70: 3130 0a20 2020 2020 2020 2020 2020 2020  10.             
-0000bd80: 2020 2046 616c 7365 2020 2020 2020 2020     False        
-0000bd90: 2020 2020 2020 2c20 2023 2031 3120 6973        ,  # 11 is
-0000bda0: 5461 720a 2020 2020 2020 2020 2020 2020  Tar.            
-0000bdb0: 2020 2020 4661 6c73 6520 2020 2020 2020      False       
-0000bdc0: 2020 2020 2020 202c 2020 2320 3132 2069         ,  # 12 i
-0000bdd0: 7353 7061 7273 652c 2064 6f6e 2774 2063  sSparse, don't c
-0000bde0: 6172 6520 6966 2069 7420 6973 2061 6374  are if it is act
-0000bdf0: 7561 6c6c 7920 7370 6172 7365 206f 7220  ually sparse or 
-0000be00: 6e6f 7420 6265 6361 7573 6520 6974 2069  not because it i
-0000be10: 7320 6e6f 7420 696e 2054 4152 0a20 2020  s not in TAR.   
-0000be20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000be30: 2020 2020 2020 2023 2066 6d74 3a20 6f6e         # fmt: on
-0000be40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000be50: 662e 5f73 6574 4669 6c65 496e 666f 2866  f._setFileInfo(f
-0000be60: 696c 6549 6e66 6f29 0a0a 2020 2020 2020  ileInfo)..      
-0000be70: 2020 2320 416c 6c20 7468 6520 636f 6465    # All the code
-0000be80: 2062 656c 6f77 2069 7320 666f 7220 6461   below is for da
-0000be90: 7461 6261 7365 2066 696e 616c 697a 696e  tabase finalizin
-0000bea0: 6720 7768 6963 6820 7368 6f75 6c64 206e  g which should n
-0000beb0: 6f74 2062 6520 646f 6e65 2069 6e20 6120  ot be done in a 
-0000bec0: 7265 6375 7273 6976 6520 6361 6c6c 206f  recursive call o
-0000bed0: 6620 6372 6561 7465 496e 6465 7821 0a20  f createIndex!. 
-0000bee0: 2020 2020 2020 2069 6620 6e6f 7420 6f70         if not op
-0000bef0: 656e 6564 436f 6e6e 6563 7469 6f6e 3a0a  enedConnection:.
-0000bf00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000bf10: 726e 0a0a 2020 2020 2020 2020 2320 352e  rn..        # 5.
-0000bf20: 2052 6573 6f72 7420 6279 2028 7061 7468   Resort by (path
-0000bf30: 2c6e 616d 6529 2e20 5468 6973 206f 6e65  ,name). This one
-0000bf40: 2d74 696d 6520 7265 736f 7274 2069 7320  -time resort is 
-0000bf50: 6661 7374 6572 2074 6861 6e20 7265 736f  faster than reso
-0000bf60: 7274 696e 6720 6f6e 2065 6163 6820 494e  rting on each IN
-0000bf70: 5345 5254 2028 6361 6368 6520 7370 696c  SERT (cache spil
-0000bf80: 6c29 0a20 2020 2020 2020 2069 6620 7072  l).        if pr
-0000bf90: 696e 7444 6562 7567 203e 3d20 323a 0a20  intDebug >= 2:. 
-0000bfa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000bfb0: 2822 5265 736f 7274 696e 6720 6669 6c65  ("Resorting file
-0000bfc0: 7320 6279 2070 6174 6820 2e2e 2e22 290a  s by path ...").
-0000bfd0: 0a20 2020 2020 2020 2063 6c65 616e 7570  .        cleanup
-0000bfe0: 4461 7461 6261 7365 203d 2022 2222 0a20  Database = """. 
-0000bff0: 2020 2020 2020 2020 2020 2049 4e53 4552             INSER
-0000c000: 5420 4f52 2052 4550 4c41 4345 2049 4e54  T OR REPLACE INT
-0000c010: 4f20 2266 696c 6573 2220 5345 4c45 4354  O "files" SELECT
-0000c020: 202a 2046 524f 4d20 2266 696c 6573 746d   * FROM "filestm
-0000c030: 7022 204f 5244 4552 2042 5920 2270 6174  p" ORDER BY "pat
-0000c040: 6822 2c22 6e61 6d65 222c 726f 7769 643b  h","name",rowid;
-0000c050: 0a20 2020 2020 2020 2020 2020 2044 524f  .            DRO
-0000c060: 5020 5441 424c 4520 2266 696c 6573 746d  P TABLE "filestm
-0000c070: 7022 3b0a 2020 2020 2020 2020 2020 2020  p";.            
-0000c080: 494e 5345 5254 204f 5220 4947 4e4f 5245  INSERT OR IGNORE
-0000c090: 2049 4e54 4f20 2266 696c 6573 220a 2020   INTO "files".  
-0000c0a0: 2020 2020 2020 2020 2020 2020 2020 2f2a                /*
-0000c0b0: 2070 6174 6820 6e61 6d65 206f 6666 7365   path name offse
-0000c0c0: 7468 6561 6465 7220 6f66 6673 6574 2073  theader offset s
-0000c0d0: 697a 6520 6d74 696d 6520 6d6f 6465 2074  ize mtime mode t
-0000c0e0: 7970 6520 6c69 6e6b 6e61 6d65 2075 6964  ype linkname uid
-0000c0f0: 2067 6964 2069 7374 6172 2069 7373 7061   gid istar isspa
-0000c100: 7273 6520 2a2f 0a20 2020 2020 2020 2020  rse */.         
-0000c110: 2020 2020 2020 2053 454c 4543 5420 7061         SELECT pa
-0000c120: 7468 2c6e 616d 652c 6f66 6673 6574 6865  th,name,offsethe
-0000c130: 6164 6572 2c6f 6666 7365 742c 302c 302c  ader,offset,0,0,
-0000c140: 7b7d 2c7b 7d2c 2222 2c30 2c30 2c30 2c30  {},{},"",0,0,0,0
-0000c150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c160: 2046 524f 4d20 2270 6172 656e 7466 6f6c   FROM "parentfol
-0000c170: 6465 7273 220a 2020 2020 2020 2020 2020  ders".          
-0000c180: 2020 2020 2020 5748 4552 4520 2870 6174        WHERE (pat
-0000c190: 682c 6e61 6d65 2920 4e4f 5420 494e 2028  h,name) NOT IN (
-0000c1a0: 2053 454c 4543 5420 7061 7468 2c6e 616d   SELECT path,nam
-0000c1b0: 6520 4652 4f4d 2022 6669 6c65 7322 2057  e FROM "files" W
-0000c1c0: 4845 5245 206d 6f64 6520 2620 2831 203c  HERE mode & (1 <
-0000c1d0: 3c20 3134 2920 213d 2030 2029 0a20 2020  < 14) != 0 ).   
-0000c1e0: 2020 2020 2020 2020 2020 2020 204f 5244               ORD
-0000c1f0: 4552 2042 5920 2270 6174 6822 2c22 6e61  ER BY "path","na
-0000c200: 6d65 223b 0a20 2020 2020 2020 2020 2020  me";.           
-0000c210: 2044 524f 5020 5441 424c 4520 2270 6172   DROP TABLE "par
-0000c220: 656e 7466 6f6c 6465 7273 223b 0a20 2020  entfolders";.   
-0000c230: 2020 2020 2020 2020 2050 5241 474d 4120           PRAGMA 
-0000c240: 6f70 7469 6d69 7a65 3b0a 2020 2020 2020  optimize;.      
-0000c250: 2020 2222 222e 666f 726d 6174 280a 2020    """.format(.  
-0000c260: 2020 2020 2020 2020 2020 696e 7428 306f            int(0o
-0000c270: 3535 3520 7c20 7374 6174 2e53 5f49 4644  555 | stat.S_IFD
-0000c280: 4952 292c 2069 6e74 2874 6172 6669 6c65  IR), int(tarfile
-0000c290: 2e44 4952 5459 5045 290a 2020 2020 2020  .DIRTYPE).      
-0000c2a0: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
-0000c2b0: 2e73 716c 436f 6e6e 6563 7469 6f6e 2e65  .sqlConnection.e
-0000c2c0: 7865 6375 7465 7363 7269 7074 2863 6c65  xecutescript(cle
-0000c2d0: 616e 7570 4461 7461 6261 7365 290a 0a20  anupDatabase).. 
-0000c2e0: 2020 2020 2020 2073 656c 662e 7371 6c43         self.sqlC
-0000c2f0: 6f6e 6e65 6374 696f 6e2e 636f 6d6d 6974  onnection.commit
-0000c300: 2829 0a0a 2020 2020 2020 2020 7431 203d  ()..        t1 =
-0000c310: 2074 696d 6572 2829 0a20 2020 2020 2020   timer().       
-0000c320: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
-0000c330: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0000c340: 2070 7269 6e74 2822 4372 6561 7469 6e67   print("Creating
-0000c350: 206f 6666 7365 7420 6469 6374 696f 6e61   offset dictiona
-0000c360: 7279 2066 6f72 222c 2073 656c 662e 7461  ry for", self.ta
-0000c370: 7246 696c 654e 616d 652c 2022 746f 6f6b  rFileName, "took
-0000c380: 207b 3a2e 3266 7d73 222e 666f 726d 6174   {:.2f}s".format
-0000c390: 2874 3120 2d20 7430 2929 0a0a 2020 2020  (t1 - t0))..    
-0000c3a0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-0000c3b0: 2020 6465 6620 5f72 6f77 546f 4669 6c65    def _rowToFile
-0000c3c0: 496e 666f 2872 6f77 3a20 4469 6374 5b73  Info(row: Dict[s
-0000c3d0: 7472 2c20 416e 795d 2920 2d3e 2046 696c  tr, Any]) -> Fil
-0000c3e0: 6549 6e66 6f3a 0a20 2020 2020 2020 2075  eInfo:.        u
-0000c3f0: 7365 7244 6174 6120 3d20 5351 4c69 7465  serData = SQLite
-0000c400: 496e 6465 7865 6454 6172 5573 6572 4461  IndexedTarUserDa
-0000c410: 7461 280a 2020 2020 2020 2020 2020 2020  ta(.            
-0000c420: 2320 666d 743a 206f 6666 0a20 2020 2020  # fmt: off.     
-0000c430: 2020 2020 2020 206f 6666 7365 7420 2020         offset   
-0000c440: 2020 2020 3d20 726f 775b 276f 6666 7365      = row['offse
-0000c450: 7427 5d2c 0a20 2020 2020 2020 2020 2020  t'],.           
-0000c460: 206f 6666 7365 7468 6561 6465 7220 3d20   offsetheader = 
-0000c470: 726f 775b 276f 6666 7365 7468 6561 6465  row['offsetheade
-0000c480: 7227 5d20 6966 2027 6f66 6673 6574 6865  r'] if 'offsethe
-0000c490: 6164 6572 2720 696e 2072 6f77 2e6b 6579  ader' in row.key
-0000c4a0: 7328 2920 656c 7365 2030 2c0a 2020 2020  s() else 0,.    
-0000c4b0: 2020 2020 2020 2020 6973 7461 7220 2020          istar   
-0000c4c0: 2020 2020 203d 2072 6f77 5b27 6973 7461       = row['ista
-0000c4d0: 7227 5d2c 0a20 2020 2020 2020 2020 2020  r'],.           
-0000c4e0: 2069 7373 7061 7273 6520 2020 2020 3d20   issparse     = 
-0000c4f0: 726f 775b 2769 7373 7061 7273 6527 5d20  row['issparse'] 
-0000c500: 6966 2027 6973 7370 6172 7365 2720 696e  if 'issparse' in
-0000c510: 2072 6f77 2e6b 6579 7328 2920 656c 7365   row.keys() else
-0000c520: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0000c530: 2020 2020 2320 666d 743a 206f 6e0a 2020      # fmt: on.  
-0000c540: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000c550: 2066 696c 6549 6e66 6f20 3d20 4669 6c65   fileInfo = File
-0000c560: 496e 666f 280a 2020 2020 2020 2020 2020  Info(.          
-0000c570: 2020 2320 666d 743a 206f 6666 0a20 2020    # fmt: off.   
-0000c580: 2020 2020 2020 2020 2073 697a 6520 2020           size   
-0000c590: 2020 3d20 726f 775b 2773 697a 6527 5d2c    = row['size'],
-0000c5a0: 0a20 2020 2020 2020 2020 2020 206d 7469  .            mti
-0000c5b0: 6d65 2020 2020 3d20 726f 775b 276d 7469  me    = row['mti
-0000c5c0: 6d65 275d 2c0a 2020 2020 2020 2020 2020  me'],.          
-0000c5d0: 2020 6d6f 6465 2020 2020 203d 2072 6f77    mode     = row
-0000c5e0: 5b27 6d6f 6465 275d 2c0a 2020 2020 2020  ['mode'],.      
-0000c5f0: 2020 2020 2020 6c69 6e6b 6e61 6d65 203d        linkname =
-0000c600: 2072 6f77 5b27 6c69 6e6b 6e61 6d65 275d   row['linkname']
-0000c610: 2c0a 2020 2020 2020 2020 2020 2020 7569  ,.            ui
-0000c620: 6420 2020 2020 203d 2072 6f77 5b27 7569  d      = row['ui
-0000c630: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
-0000c640: 2067 6964 2020 2020 2020 3d20 726f 775b   gid      = row[
-0000c650: 2767 6964 275d 2c0a 2020 2020 2020 2020  'gid'],.        
-0000c660: 2020 2020 7573 6572 6461 7461 203d 205b      userdata = [
-0000c670: 7573 6572 4461 7461 5d2c 0a20 2020 2020  userData],.     
-0000c680: 2020 2020 2020 2023 2066 6d74 3a20 6f6e         # fmt: on
-0000c690: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000c6a0: 2020 2020 7265 7475 726e 2066 696c 6549      return fileI
-0000c6b0: 6e66 6f0a 0a20 2020 2040 6f76 6572 7269  nfo..    @overri
-0000c6c0: 6465 7328 4d6f 756e 7453 6f75 7263 6529  des(MountSource)
-0000c6d0: 0a20 2020 2064 6566 2067 6574 4669 6c65  .    def getFile
-0000c6e0: 496e 666f 2873 656c 662c 2070 6174 683a  Info(self, path:
-0000c6f0: 2073 7472 2c20 6669 6c65 5665 7273 696f   str, fileVersio
-0000c700: 6e3a 2069 6e74 203d 2030 2920 2d3e 204f  n: int = 0) -> O
-0000c710: 7074 696f 6e61 6c5b 4669 6c65 496e 666f  ptional[FileInfo
-0000c720: 5d3a 0a20 2020 2020 2020 2066 696c 6549  ]:.        fileI
-0000c730: 6e66 6f20 3d20 7365 6c66 2e5f 6765 7446  nfo = self._getF
-0000c740: 696c 6549 6e66 6f28 7061 7468 2c20 6669  ileInfo(path, fi
-0000c750: 6c65 5665 7273 696f 6e3d 6669 6c65 5665  leVersion=fileVe
-0000c760: 7273 696f 6e29 0a0a 2020 2020 2020 2020  rsion)..        
-0000c770: 6966 2066 696c 6549 6e66 6f20 6973 204e  if fileInfo is N
-0000c780: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000c790: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
-0000c7a0: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-0000c7b0: 6e73 7461 6e63 6528 6669 6c65 496e 666f  nstance(fileInfo
-0000c7c0: 2c20 4669 6c65 496e 666f 290a 2020 2020  , FileInfo).    
-0000c7d0: 2020 2020 7265 7475 726e 2066 696c 6549      return fileI
-0000c7e0: 6e66 6f0a 0a20 2020 2064 6566 205f 6765  nfo..    def _ge
-0000c7f0: 7446 696c 6549 6e66 6f28 0a20 2020 2020  tFileInfo(.     
-0000c800: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000c810: 2023 2066 6d74 3a20 6f66 660a 2020 2020   # fmt: off.    
-0000c820: 2020 2020 6675 6c6c 5061 7468 2020 2020      fullPath    
-0000c830: 203a 2073 7472 2c0a 2020 2020 2020 2020   : str,.        
-0000c840: 6c69 7374 4469 7220 2020 2020 203a 2062  listDir      : b
-0000c850: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000c860: 2020 2020 206c 6973 7456 6572 7369 6f6e       listVersion
-0000c870: 7320 3a20 626f 6f6c 203d 2046 616c 7365  s : bool = False
-0000c880: 2c0a 2020 2020 2020 2020 6669 6c65 5665  ,.        fileVe
-0000c890: 7273 696f 6e20 203a 2069 6e74 2020 3d20  rsion  : int  = 
-0000c8a0: 300a 2020 2020 2020 2020 2320 666d 743a  0.        # fmt:
-0000c8b0: 206f 6e0a 2020 2020 2920 2d3e 204f 7074   on.    ) -> Opt
-0000c8c0: 696f 6e61 6c5b 556e 696f 6e5b 4669 6c65  ional[Union[File
-0000c8d0: 496e 666f 2c20 4469 6374 5b73 7472 2c20  Info, Dict[str, 
-0000c8e0: 4669 6c65 496e 666f 5d5d 5d3a 0a20 2020  FileInfo]]]:.   
-0000c8f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c900: 2054 6869 7320 6973 2074 6865 2068 6561   This is the hea
-0000c910: 7274 206f 6620 7468 6973 2063 6c61 7373  rt of this class
-0000c920: 2720 7075 626c 6963 2069 6e74 6572 6661  ' public interfa
-0000c930: 6365 210a 0a20 2020 2020 2020 2070 6174  ce!..        pat
-0000c940: 6820 2020 203a 2066 756c 6c20 7061 7468  h    : full path
-0000c950: 2074 6f20 6669 6c65 2077 6865 7265 2027   to file where '
-0000c960: 2f27 2064 656e 6f74 6573 2054 4152 2773  /' denotes TAR's
-0000c970: 2072 6f6f 742c 2065 2e67 2e2c 2027 2f27   root, e.g., '/'
-0000c980: 2c20 6f72 2027 2f66 6f6f 270a 2020 2020  , or '/foo'.    
-0000c990: 2020 2020 6c69 7374 4469 7220 3a20 6966      listDir : if
-0000c9a0: 2054 7275 652c 2072 6574 7572 6e20 6120   True, return a 
-0000c9b0: 6469 6374 696f 6e61 7279 2066 6f72 2074  dictionary for t
-0000c9c0: 6865 2067 6976 656e 2064 6972 6563 746f  he given directo
-0000c9d0: 7279 2070 6174 683a 207b 2066 696c 654e  ry path: { fileN
-0000c9e0: 616d 6520 3a20 4669 6c65 496e 666f 2c20  ame : FileInfo, 
-0000c9f0: 2e2e 2e20 7d0a 2020 2020 2020 2020 2020  ... }.          
-0000ca00: 2020 2020 2020 2020 6966 2046 616c 7365          if False
-0000ca10: 2c20 7265 7475 726e 2073 696d 706c 6520  , return simple 
-0000ca20: 4669 6c65 496e 666f 2074 6f20 6769 7665  FileInfo to give
-0000ca30: 6e20 7061 7468 2028 6469 7265 6374 6f72  n path (director
-0000ca40: 7920 6f72 2066 696c 6529 0a20 2020 2020  y or file).     
-0000ca50: 2020 2066 696c 6556 6572 7369 6f6e 203a     fileVersion :
-0000ca60: 2049 6620 7468 6520 5441 5220 636f 6e74   If the TAR cont
-0000ca70: 6169 6e73 2074 6865 2073 616d 6520 6669  ains the same fi
-0000ca80: 6c65 2070 6174 6820 6d75 6c74 6970 6c65  le path multiple
-0000ca90: 2074 696d 6573 2c20 6279 2064 6566 6175   times, by defau
-0000caa0: 6c74 206f 6e6c 7920 7468 6520 6c61 7374  lt only the last
-0000cab0: 206f 6e65 2069 7320 7368 6f77 6e2e 0a20   one is shown.. 
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2020 2020 2042 7574 2077 6974 6820 7468       But with th
-0000cae0: 6973 2061 7267 756d 656e 7420 6f74 6865  is argument othe
-0000caf0: 7220 7665 7273 696f 6e73 2063 616e 2062  r versions can b
-0000cb00: 6520 7175 6572 6965 642e 2056 6572 7369  e queried. Versi
-0000cb10: 6f6e 2031 2069 7320 7468 6520 6f6c 6465  on 1 is the olde
-0000cb20: 7374 206f 6e65 2e0a 2020 2020 2020 2020  st one..        
-0000cb30: 2020 2020 2020 2020 2020 2020 2020 5665                Ve
-0000cb40: 7273 696f 6e20 3020 7472 616e 736c 6174  rsion 0 translat
-0000cb50: 6573 2074 6f20 7468 6520 6d6f 7374 2072  es to the most r
-0000cb60: 6563 656e 7420 6f6e 6520 666f 7220 636f  ecent one for co
-0000cb70: 6d70 6174 6962 696c 6974 7920 7769 7468  mpatibility with
-0000cb80: 2074 6172 202d 2d6f 6363 7572 7265 6e63   tar --occurrenc
-0000cb90: 653d 3c6e 756d 6265 723e 2e0a 2020 2020  e=<number>..    
-0000cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbb0: 2020 5665 7273 696f 6e20 2d31 2074 7261    Version -1 tra
-0000cbc0: 6e73 6c61 7465 7320 746f 2074 6865 2073  nslates to the s
-0000cbd0: 6563 6f6e 6420 6d6f 7374 2072 6563 656e  econd most recen
-0000cbe0: 742c 2061 6e64 2073 6f20 6f6e 2e0a 2020  t, and so on..  
-0000cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc00: 2020 2020 466f 7220 6c69 7374 4469 723d      For listDir=
-0000cc10: 5472 7565 2c20 7468 6520 6669 6c65 2076  True, the file v
-0000cc20: 6572 7369 6f6e 206d 616b 6573 206e 6f20  ersion makes no 
-0000cc30: 7365 6e73 6520 616e 6420 6973 2069 676e  sense and is ign
-0000cc40: 6f72 6564 210a 2020 2020 2020 2020 2020  ored!.          
-0000cc50: 2020 2020 2020 2020 2020 2020 536f 2c20              So, 
-0000cc60: 6576 656e 2069 6620 6120 666f 6c64 6572  even if a folder
-0000cc70: 2077 6173 206f 7665 7277 7269 7474 656e   was overwritten
-0000cc80: 2062 7920 6120 6669 6c65 2c20 7768 6963   by a file, whic
-0000cc90: 6820 6973 2061 6c72 6561 6479 206e 6f74  h is already not
-0000cca0: 2077 656c 6c20 7375 7070 6f72 7465 6420   well supported 
-0000ccb0: 6279 2074 6172 2c0a 2020 2020 2020 2020  by tar,.        
-0000ccc0: 2020 2020 2020 2020 2020 2020 2020 7468                th
-0000ccd0: 656e 206c 6973 7444 6972 2066 6f72 2074  en listDir for t
-0000cce0: 6861 7420 7061 7468 2077 696c 6c20 7374  hat path will st
-0000ccf0: 696c 6c20 6c69 7374 2061 6c6c 2063 6f6e  ill list all con
-0000cd00: 7465 6e74 7320 6f66 2074 6865 206f 7665  tents of the ove
-0000cd10: 7277 7269 7474 656e 2066 6f6c 6465 7220  rwritten folder 
-0000cd20: 6f72 2066 6f6c 6465 7273 2c0a 2020 2020  or folders,.    
-0000cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd40: 2020 6e6f 206d 6174 7465 7220 7468 6520    no matter the 
-0000cd50: 7370 6563 6966 6965 6420 7665 7273 696f  specified versio
-0000cd60: 6e2e 2054 6865 2066 696c 6520 7379 7374  n. The file syst
-0000cd70: 656d 206c 6179 6572 2068 6173 2074 6f20  em layer has to 
-0000cd80: 7461 6b65 2063 6172 6520 7468 6174 2061  take care that a
-0000cd90: 2064 6972 6563 746f 7279 0a20 2020 2020   directory.     
-0000cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdb0: 206c 6973 7469 6e67 2069 7320 6e6f 7420   listing is not 
-0000cdc0: 6576 656e 2072 6571 7565 7465 6420 696e  even requeted in
-0000cdd0: 2074 6865 2066 6972 7374 2070 6c61 6365   the first place
-0000cde0: 2069 6620 6974 2069 7320 6e6f 7420 6120   if it is not a 
-0000cdf0: 6469 7265 6374 6f72 792e 0a20 2020 2020  directory..     
-0000ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce10: 2046 5553 4520 616c 7265 6164 7920 646f   FUSE already do
-0000ce20: 6573 2074 6869 7320 6279 2063 616c 6c69  es this by calli
-0000ce30: 6e67 2067 6574 6174 7472 2066 6f72 2061  ng getattr for a
-0000ce40: 6c6c 2070 6172 656e 7420 666f 6c64 6572  ll parent folder
-0000ce50: 7320 696e 2074 6865 2073 7065 6369 6669  s in the specifi
-0000ce60: 6564 2070 6174 6820 6669 7273 742e 0a0a  ed path first...
-0000ce70: 2020 2020 2020 2020 4966 2070 6174 6820          If path 
-0000ce80: 646f 6573 206e 6f74 2065 7869 7374 2c20  does not exist, 
-0000ce90: 616c 7761 7973 2072 6574 7572 6e20 4e6f  always return No
-0000cea0: 6e65 0a0a 2020 2020 2020 2020 4966 206c  ne..        If l
-0000ceb0: 6973 7456 6572 7369 6f6e 7320 6973 2074  istVersions is t
-0000cec0: 7275 652c 2074 6865 6e20 7265 7475 726e  rue, then return
-0000ced0: 206d 6574 6164 6174 6120 666f 7220 616c   metadata for al
-0000cee0: 6c20 7665 7273 696f 6e73 206f 6620 6120  l versions of a 
-0000cef0: 6669 6c65 2070 6f73 7369 626c 7920 6170  file possibly ap
-0000cf00: 7065 6172 696e 6720 6d6f 7265 2074 6861  pearing more tha
-0000cf10: 6e20 6f6e 6365 0a20 2020 2020 2020 2069  n once.        i
-0000cf20: 6e20 7468 6520 5441 5220 6173 2061 2064  n the TAR as a d
-0000cf30: 6972 6563 746f 7279 2064 6963 7469 6f6e  irectory diction
-0000cf40: 6172 792e 206c 6973 7444 6972 2077 696c  ary. listDir wil
-0000cf50: 6c20 7468 656e 2062 6520 6967 6e6f 7265  l then be ignore
-0000cf60: 6421 0a20 2020 2020 2020 2022 2222 0a20  d!.        """. 
-0000cf70: 2020 2020 2020 2023 2054 4f44 4f20 6361         # TODO ca
-0000cf80: 6368 6520 6c61 7374 206c 6973 7444 6972  che last listDir
-0000cf90: 2061 7320 6d6f 7374 206f 6674 656e 2061   as most often a
-0000cfa0: 2073 7461 7420 6f76 6572 2061 6c6c 2065   stat over all e
-0000cfb0: 6e74 7269 6573 2077 696c 6c20 736f 6f6e  ntries will soon
-0000cfc0: 2066 6f6c 6c6f 770a 0a20 2020 2020 2020   follow..       
-0000cfd0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-0000cfe0: 6365 2866 696c 6556 6572 7369 6f6e 2c20  ce(fileVersion, 
-0000cff0: 696e 7429 3a0a 2020 2020 2020 2020 2020  int):.          
-0000d000: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0000d010: 7228 2254 6865 2073 7065 6369 6669 6564  r("The specified
-0000d020: 2066 696c 6520 7665 7273 696f 6e20 6d75   file version mu
-0000d030: 7374 2062 6520 616e 2069 6e74 6567 6572  st be an integer
-0000d040: 2122 290a 2020 2020 2020 2020 6966 206e  !").        if n
-0000d050: 6f74 2073 656c 662e 7371 6c43 6f6e 6e65  ot self.sqlConne
-0000d060: 6374 696f 6e3a 0a20 2020 2020 2020 2020  ction:.         
-0000d070: 2020 2072 6169 7365 2049 6e64 6578 4e6f     raise IndexNo
-0000d080: 744f 7065 6e45 7272 6f72 2822 5468 6973  tOpenError("This
-0000d090: 206d 6574 686f 6420 6361 6e20 6e6f 7420   method can not 
-0000d0a0: 6265 2063 616c 6c65 6420 7769 7468 6f75  be called withou
-0000d0b0: 7420 616e 206f 7065 6e65 6420 696e 6465  t an opened inde
-0000d0c0: 7820 6461 7461 6261 7365 2122 290a 0a20  x database!").. 
-0000d0d0: 2020 2020 2020 2023 2061 6c73 6f20 7374         # also st
-0000d0e0: 7269 7073 2074 7261 696c 696e 6720 272f  rips trailing '/
-0000d0f0: 2720 6578 6365 7074 2066 6f72 2061 2073  ' except for a s
-0000d100: 696e 676c 6520 272f 2720 616e 6420 6c65  ingle '/' and le
-0000d110: 6164 696e 6720 272f 270a 2020 2020 2020  ading '/'.      
-0000d120: 2020 6675 6c6c 5061 7468 203d 2027 2f27    fullPath = '/'
-0000d130: 202b 206f 732e 7061 7468 2e6e 6f72 6d70   + os.path.normp
-0000d140: 6174 6828 6675 6c6c 5061 7468 292e 6c73  ath(fullPath).ls
-0000d150: 7472 6970 2827 2f27 290a 0a20 2020 2020  trip('/')..     
-0000d160: 2020 2069 6620 6c69 7374 5665 7273 696f     if listVersio
-0000d170: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000d180: 7061 7468 2c20 6e61 6d65 203d 2066 756c  path, name = ful
-0000d190: 6c50 6174 682e 7273 706c 6974 2827 2f27  lPath.rsplit('/'
-0000d1a0: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-0000d1b0: 2072 6f77 7320 3d20 7365 6c66 2e73 716c   rows = self.sql
-0000d1c0: 436f 6e6e 6563 7469 6f6e 2e65 7865 6375  Connection.execu
-0000d1d0: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-0000d1e0: 2020 2020 2753 454c 4543 5420 2a20 4652      'SELECT * FR
-0000d1f0: 4f4d 2022 6669 6c65 7322 2057 4845 5245  OM "files" WHERE
-0000d200: 2022 7061 7468 2220 3d3d 2028 3f29 2041   "path" == (?) A
-0000d210: 4e44 2022 6e61 6d65 2220 3d3d 2028 3f29  ND "name" == (?)
-0000d220: 204f 5244 4552 2042 5920 226f 6666 7365   ORDER BY "offse
-0000d230: 7468 6561 6465 7222 2041 5343 272c 2028  theader" ASC', (
-0000d240: 7061 7468 2c20 6e61 6d65 290a 2020 2020  path, name).    
-0000d250: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d260: 2020 2020 2020 7265 7375 6c74 203d 207b        result = {
-0000d270: 7374 7228 7665 7273 696f 6e20 2b20 3129  str(version + 1)
-0000d280: 3a20 7365 6c66 2e5f 726f 7754 6f46 696c  : self._rowToFil
-0000d290: 6549 6e66 6f28 726f 7729 2066 6f72 2076  eInfo(row) for v
-0000d2a0: 6572 7369 6f6e 2c20 726f 7720 696e 2065  ersion, row in e
-0000d2b0: 6e75 6d65 7261 7465 2872 6f77 7329 7d0a  numerate(rows)}.
-0000d2c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d2d0: 726e 2072 6573 756c 740a 0a20 2020 2020  rn result..     
-0000d2e0: 2020 2069 6620 6c69 7374 4469 723a 0a20     if listDir:. 
-0000d2f0: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
-0000d300: 206c 6973 7469 6e67 2064 6972 6563 746f   listing directo
-0000d310: 7279 2065 6e74 7269 6573 2074 6865 2066  ry entries the f
-0000d320: 696c 6520 7665 7273 696f 6e20 6361 6e27  ile version can'
-0000d330: 7420 6265 2061 7070 6c69 6564 206d 6561  t be applied mea
-0000d340: 6e69 6e67 6675 6c6c 7920 6174 2074 6869  ningfully at thi
-0000d350: 7320 6162 7374 7261 6374 696f 6e20 6c61  s abstraction la
-0000d360: 7965 722e 0a20 2020 2020 2020 2020 2020  yer..           
-0000d370: 2023 2045 2e67 2e2c 2073 686f 756c 6420   # E.g., should 
-0000d380: 6974 2061 6666 6563 7420 7468 6520 6669  it affect the fi
-0000d390: 6c65 2076 6572 7369 6f6e 206f 6620 7468  le version of th
-0000d3a0: 6520 6469 7265 6374 6f72 7920 746f 206c  e directory to l
-0000d3b0: 6973 742c 206f 7220 7368 6f75 6c64 2069  ist, or should i
-0000d3c0: 7420 776f 726b 206f 6e20 7468 6520 6c69  t work on the li
-0000d3d0: 7374 6564 2066 696c 6573 0a20 2020 2020  sted files.     
-0000d3e0: 2020 2020 2020 2023 2069 6e73 7465 6164         # instead
-0000d3f0: 2061 6e64 2069 6620 736f 2068 6f77 2065   and if so how e
-0000d400: 7861 6374 6c79 2069 6620 7468 6572 6520  xactly if there 
-0000d410: 6172 656e 2774 2074 6865 2073 616d 6520  aren't the same 
-0000d420: 7665 7273 696f 6e73 2066 6f72 2061 6c6c  versions for all
-0000d430: 2066 696c 6573 2061 7661 696c 6162 6c65   files available
-0000d440: 2c20 2e2e 2e3f 0a20 2020 2020 2020 2020  , ...?.         
-0000d450: 2020 2023 204f 722c 2061 7265 2066 6f6c     # Or, are fol
-0000d460: 6465 7273 2061 7373 756d 6564 2074 6f20  ders assumed to 
-0000d470: 6265 206f 7665 7277 7269 7474 656e 2062  be overwritten b
-0000d480: 7920 6120 6e65 7720 666f 6c64 6572 2065  y a new folder e
-0000d490: 6e74 7279 2069 6e20 6120 5441 5220 6f72  ntry in a TAR or
-0000d4a0: 2073 686f 756c 6420 7468 6579 2062 6520   should they be 
-0000d4b0: 756e 696f 6e20 6d6f 756e 7465 643f 0a20  union mounted?. 
-0000d4c0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0000d4d0: 7468 6579 2073 686f 756c 6420 6265 2075  they should be u
-0000d4e0: 6e69 6f6e 206d 6f75 6e74 6564 2c20 6c69  nion mounted, li
-0000d4f0: 6b65 2069 7320 7468 6520 6361 7365 206e  ke is the case n
-0000d500: 6f77 2c20 7468 656e 2074 6865 2066 6f6c  ow, then the fol
-0000d510: 6465 7220 7665 7273 696f 6e20 6f6e 6c79  der version only
-0000d520: 206d 616b 6573 2073 656e 7365 2066 6f72   makes sense for
-0000d530: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-0000d540: 7473 2061 7474 7269 6275 7465 732e 0a20  ts attributes.. 
-0000d550: 2020 2020 2020 2020 2020 2072 6f77 7320             rows 
-0000d560: 3d20 7365 6c66 2e73 716c 436f 6e6e 6563  = self.sqlConnec
-0000d570: 7469 6f6e 2e65 7865 6375 7465 2827 5345  tion.execute('SE
-0000d580: 4c45 4354 202a 2046 524f 4d20 2266 696c  LECT * FROM "fil
-0000d590: 6573 2220 5748 4552 4520 2270 6174 6822  es" WHERE "path"
-0000d5a0: 203d 3d20 283f 2927 2c20 2866 756c 6c50   == (?)', (fullP
-0000d5b0: 6174 682e 7273 7472 6970 2827 2f27 292c  ath.rstrip('/'),
-0000d5c0: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
-0000d5d0: 6972 6563 746f 7279 203d 207b 7d0a 2020  irectory = {}.  
-0000d5e0: 2020 2020 2020 2020 2020 676f 7452 6573            gotRes
-0000d5f0: 756c 7473 203d 2046 616c 7365 0a20 2020  ults = False.   
-0000d600: 2020 2020 2020 2020 2066 6f72 2072 6f77           for row
-0000d610: 2069 6e20 726f 7773 3a0a 2020 2020 2020   in rows:.      
-0000d620: 2020 2020 2020 2020 2020 676f 7452 6573            gotRes
-0000d630: 756c 7473 203d 2054 7275 650a 2020 2020  ults = True.    
-0000d640: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0000d650: 6f77 5b27 6e61 6d65 275d 3a0a 2020 2020  ow['name']:.    
-0000d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d670: 6469 7265 6374 6f72 795b 726f 775b 276e  directory[row['n
-0000d680: 616d 6527 5d5d 203d 2073 656c 662e 5f72  ame']] = self._r
-0000d690: 6f77 546f 4669 6c65 496e 666f 2872 6f77  owToFileInfo(row
-0000d6a0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000d6b0: 7475 726e 2064 6972 6563 746f 7279 2069  turn directory i
-0000d6c0: 6620 676f 7452 6573 756c 7473 2065 6c73  f gotResults els
-0000d6d0: 6520 4e6f 6e65 0a0a 2020 2020 2020 2020  e None..        
-0000d6e0: 7061 7468 2c20 6e61 6d65 203d 2066 756c  path, name = ful
-0000d6f0: 6c50 6174 682e 7273 706c 6974 2827 2f27  lPath.rsplit('/'
-0000d700: 2c20 3129 0a20 2020 2020 2020 2072 6f77  , 1).        row
-0000d710: 203d 2073 656c 662e 7371 6c43 6f6e 6e65   = self.sqlConne
-0000d720: 6374 696f 6e2e 6578 6563 7574 6528 0a20  ction.execute(. 
-0000d730: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-0000d740: 2020 2020 2020 2020 2020 2053 454c 4543             SELEC
-0000d750: 5420 2a20 4652 4f4d 2022 6669 6c65 7322  T * FROM "files"
-0000d760: 0a20 2020 2020 2020 2020 2020 2057 4845  .            WHE
-0000d770: 5245 2022 7061 7468 2220 3d3d 2028 3f29  RE "path" == (?)
-0000d780: 2041 4e44 2022 6e61 6d65 2220 3d3d 2028   AND "name" == (
-0000d790: 3f29 0a20 2020 2020 2020 2020 2020 204f  ?).            O
-0000d7a0: 5244 4552 2042 5920 226f 6666 7365 7468  RDER BY "offseth
-0000d7b0: 6561 6465 7222 207b 7d0a 2020 2020 2020  eader" {}.      
-0000d7c0: 2020 2020 2020 4c49 4d49 5420 3120 4f46        LIMIT 1 OF
-0000d7d0: 4653 4554 2028 3f29 3b0a 2020 2020 2020  FSET (?);.      
-0000d7e0: 2020 2020 2020 2222 222e 666f 726d 6174        """.format
-0000d7f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d800: 2020 2744 4553 4327 2069 6620 6669 6c65    'DESC' if file
-0000d810: 5665 7273 696f 6e20 6973 204e 6f6e 6520  Version is None 
-0000d820: 6f72 2066 696c 6556 6572 7369 6f6e 203c  or fileVersion <
-0000d830: 3d20 3020 656c 7365 2027 4153 4327 0a20  = 0 else 'ASC'. 
-0000d840: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-0000d850: 2020 2020 2020 2020 2020 2870 6174 682c            (path,
-0000d860: 206e 616d 652c 2030 2069 6620 6669 6c65   name, 0 if file
-0000d870: 5665 7273 696f 6e20 6973 204e 6f6e 6520  Version is None 
-0000d880: 656c 7365 2066 696c 6556 6572 7369 6f6e  else fileVersion
-0000d890: 202d 2031 2069 6620 6669 6c65 5665 7273   - 1 if fileVers
-0000d8a0: 696f 6e20 3e20 3020 656c 7365 202d 6669  ion > 0 else -fi
-0000d8b0: 6c65 5665 7273 696f 6e29 2c0a 2020 2020  leVersion),.    
-0000d8c0: 2020 2020 292e 6665 7463 686f 6e65 2829      ).fetchone()
-0000d8d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d8e0: 7365 6c66 2e5f 726f 7754 6f46 696c 6549  self._rowToFileI
-0000d8f0: 6e66 6f28 726f 7729 2069 6620 726f 7720  nfo(row) if row 
-0000d900: 656c 7365 204e 6f6e 650a 0a20 2020 2064  else None..    d
-0000d910: 6566 2069 7344 6972 2873 656c 662c 2070  ef isDir(self, p
-0000d920: 6174 683a 2073 7472 2920 2d3e 2062 6f6f  ath: str) -> boo
-0000d930: 6c3a 0a20 2020 2020 2020 2022 2222 5265  l:.        """Re
-0000d940: 7475 726e 2074 7275 6520 6966 2070 6174  turn true if pat
-0000d950: 6820 6578 6973 7473 2061 6e64 2069 7320  h exists and is 
-0000d960: 6120 666f 6c64 6572 2e22 2222 0a20 2020  a folder.""".   
-0000d970: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000d980: 2e6c 6973 7444 6972 2870 6174 6829 2069  .listDir(path) i
-0000d990: 7320 6e6f 7420 4e6f 6e65 0a0a 2020 2020  s not None..    
-0000d9a0: 406f 7665 7272 6964 6573 284d 6f75 6e74  @overrides(Mount
-0000d9b0: 536f 7572 6365 290a 2020 2020 6465 6620  Source).    def 
-0000d9c0: 6c69 7374 4469 7228 7365 6c66 2c20 7061  listDir(self, pa
-0000d9d0: 7468 3a20 7374 7229 202d 3e20 4f70 7469  th: str) -> Opti
-0000d9e0: 6f6e 616c 5b49 7465 7261 626c 655b 7374  onal[Iterable[st
-0000d9f0: 725d 5d3a 0a20 2020 2020 2020 2022 2222  r]]:.        """
-0000da00: 0a20 2020 2020 2020 2055 7361 6269 6c69  .        Usabili
-0000da10: 7479 2077 7261 7070 6572 2066 6f72 2067  ty wrapper for g
-0000da20: 6574 4669 6c65 496e 666f 286c 6973 7444  etFileInfo(listD
-0000da30: 6972 3d54 7275 6529 2077 6974 6820 4669  ir=True) with Fi
-0000da40: 6c65 496e 666f 2073 7472 6970 7065 6420  leInfo stripped 
-0000da50: 6966 2079 6f75 2061 7265 2073 7572 6520  if you are sure 
-0000da60: 796f 7520 646f 6e27 7420 6e65 6564 2069  you don't need i
-0000da70: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
-0000da80: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000da90: 7365 6c66 2e5f 6765 7446 696c 6549 6e66  self._getFileInf
-0000daa0: 6f28 7061 7468 2c20 6c69 7374 4469 723d  o(path, listDir=
-0000dab0: 5472 7565 290a 2020 2020 2020 2020 6966  True).        if
-0000dac0: 2069 7369 6e73 7461 6e63 6528 7265 7375   isinstance(resu
-0000dad0: 6c74 2c20 6469 6374 293a 0a20 2020 2020  lt, dict):.     
-0000dae0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000daf0: 7375 6c74 2e6b 6579 7328 290a 2020 2020  sult.keys().    
-0000db00: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0000db10: 0a20 2020 2040 6f76 6572 7269 6465 7328  .    @overrides(
-0000db20: 4d6f 756e 7453 6f75 7263 6529 0a20 2020  MountSource).   
-0000db30: 2064 6566 2066 696c 6556 6572 7369 6f6e   def fileVersion
-0000db40: 7328 7365 6c66 2c20 7061 7468 3a20 7374  s(self, path: st
-0000db50: 7229 202d 3e20 696e 743a 0a20 2020 2020  r) -> int:.     
-0000db60: 2020 2022 2222 0a20 2020 2020 2020 2055     """.        U
-0000db70: 7361 6269 6c69 7479 2077 7261 7070 6572  sability wrapper
-0000db80: 2066 6f72 2067 6574 4669 6c65 496e 666f   for getFileInfo
-0000db90: 286c 6973 7456 6572 7369 6f6e 733d 5472  (listVersions=Tr
-0000dba0: 7565 2920 7769 7468 2046 696c 6549 6e66  ue) with FileInf
-0000dbb0: 6f20 7374 7269 7070 6564 2069 6620 796f  o stripped if yo
-0000dbc0: 7520 6172 6520 7375 7265 2079 6f75 2064  u are sure you d
-0000dbd0: 6f6e 2774 206e 6565 6420 6974 2e0a 2020  on't need it..  
-0000dbe0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000dbf0: 2020 6669 6c65 5665 7273 696f 6e73 203d    fileVersions =
-0000dc00: 2073 656c 662e 5f67 6574 4669 6c65 496e   self._getFileIn
-0000dc10: 666f 2870 6174 682c 206c 6973 7456 6572  fo(path, listVer
-0000dc20: 7369 6f6e 733d 5472 7565 290a 2020 2020  sions=True).    
-0000dc30: 2020 2020 7265 7475 726e 206c 656e 2866      return len(f
-0000dc40: 696c 6556 6572 7369 6f6e 7329 2069 6620  ileVersions) if 
-0000dc50: 6973 696e 7374 616e 6365 2866 696c 6556  isinstance(fileV
-0000dc60: 6572 7369 6f6e 732c 2064 6963 7429 2065  ersions, dict) e
-0000dc70: 6c73 6520 300a 0a20 2020 2040 6f76 6572  lse 0..    @over
-0000dc80: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
-0000dc90: 6529 0a20 2020 2064 6566 206f 7065 6e28  e).    def open(
-0000dca0: 7365 6c66 2c20 6669 6c65 496e 666f 3a20  self, fileInfo: 
-0000dcb0: 4669 6c65 496e 666f 2920 2d3e 2049 4f5b  FileInfo) -> IO[
-0000dcc0: 6279 7465 735d 3a0a 2020 2020 2020 2020  bytes]:.        
-0000dcd0: 6173 7365 7274 2066 696c 6549 6e66 6f2e  assert fileInfo.
-0000dce0: 7573 6572 6461 7461 0a20 2020 2020 2020  userdata.       
-0000dcf0: 2074 6172 4669 6c65 496e 666f 203d 2066   tarFileInfo = f
-0000dd00: 696c 6549 6e66 6f2e 7573 6572 6461 7461  ileInfo.userdata
-0000dd10: 5b2d 315d 0a20 2020 2020 2020 2061 7373  [-1].        ass
-0000dd20: 6572 7420 6973 696e 7374 616e 6365 2874  ert isinstance(t
-0000dd30: 6172 4669 6c65 496e 666f 2c20 5351 4c69  arFileInfo, SQLi
-0000dd40: 7465 496e 6465 7865 6454 6172 5573 6572  teIndexedTarUser
-0000dd50: 4461 7461 290a 0a20 2020 2020 2020 2023  Data)..        #
-0000dd60: 2054 6869 7320 6973 206e 6f74 2073 7472   This is not str
-0000dd70: 6963 746c 7920 6e65 6365 7373 6172 7920  ictly necessary 
-0000dd80: 6275 7420 6974 2073 6176 6573 2074 776f  but it saves two
-0000dd90: 2066 696c 6520 6f62 6a65 6374 206c 6179   file object lay
-0000dda0: 6572 7320 616e 6420 7468 6572 6566 6f72  ers and therefor
-0000ddb0: 6520 6d69 6768 7420 6265 206d 6f72 6520  e might be more 
-0000ddc0: 7065 7266 6f72 6d61 6e74 2e0a 2020 2020  performant..    
-0000ddd0: 2020 2020 2320 4675 7274 6865 726d 6f72      # Furthermor
-0000dde0: 652c 206e 6f6e 2d73 7061 7273 6520 6669  e, non-sparse fi
-0000ddf0: 6c65 7320 7368 6f75 6c64 2062 6520 7468  les should be th
-0000de00: 6520 6d75 6368 206d 6f72 6520 6c69 6b65  e much more like
-0000de10: 6c79 2063 6173 6520 616e 7977 6179 2e0a  ly case anyway..
-0000de20: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
-0000de30: 6172 4669 6c65 496e 666f 2e69 7373 7061  arFileInfo.isspa
-0000de40: 7273 653a 0a20 2020 2020 2020 2020 2020  rse:.           
-0000de50: 2072 6574 7572 6e20 6361 7374 2849 4f5b   return cast(IO[
-0000de60: 6279 7465 735d 2c20 5374 656e 6369 6c65  bytes], Stencile
-0000de70: 6446 696c 6528 7365 6c66 2e74 6172 4669  dFile(self.tarFi
-0000de80: 6c65 4f62 6a65 6374 2c20 5b28 7461 7246  leObject, [(tarF
-0000de90: 696c 6549 6e66 6f2e 6f66 6673 6574 2c20  ileInfo.offset, 
-0000dea0: 6669 6c65 496e 666f 2e73 697a 6529 5d29  fileInfo.size)])
-0000deb0: 290a 0a20 2020 2020 2020 2023 2054 6865  )..        # The
-0000dec0: 2054 4152 2066 696c 6520 666f 726d 6174   TAR file format
-0000ded0: 2069 7320 7665 7279 2073 696d 706c 652e   is very simple.
-0000dee0: 2049 7427 7320 6a75 7374 2061 2063 6f6e   It's just a con
-0000def0: 6361 7465 6e61 7469 6f6e 206f 6620 5441  catenation of TA
-0000df00: 5220 626c 6f63 6b73 2e20 5468 6572 6520  R blocks. There 
-0000df10: 6973 206e 6f74 2065 7665 6e20 610a 2020  is not even a.  
-0000df20: 2020 2020 2020 2320 676c 6f62 616c 2068        # global h
-0000df30: 6561 6465 722c 206f 6e6c 7920 7468 6520  eader, only the 
-0000df40: 5441 5220 626c 6f63 6b20 6865 6164 6572  TAR block header
-0000df50: 732e 2054 6861 7427 7320 7768 7920 7765  s. That's why we
-0000df60: 2063 616e 2073 696d 706c 7920 6375 7420   can simply cut 
-0000df70: 6f75 7420 7468 6520 5441 5220 626c 6f63  out the TAR bloc
-0000df80: 6b20 666f 720a 2020 2020 2020 2020 2320  k for.        # 
-0000df90: 7468 6520 7370 6172 7365 2066 696c 6520  the sparse file 
-0000dfa0: 7573 696e 6720 5374 656e 6369 6c65 6446  using StenciledF
-0000dfb0: 696c 6520 616e 6420 7468 656e 2075 7365  ile and then use
-0000dfc0: 2074 6172 6669 6c65 206f 6e20 6974 2074   tarfile on it t
-0000dfd0: 6f20 6578 7061 6e64 2074 6865 2073 7061  o expand the spa
-0000dfe0: 7273 6520 6669 6c65 2063 6f72 7265 6374  rse file correct
-0000dff0: 6c79 2e0a 2020 2020 2020 2020 7461 7242  ly..        tarB
-0000e000: 6c6f 636b 5369 7a65 203d 2074 6172 4669  lockSize = tarFi
-0000e010: 6c65 496e 666f 2e6f 6666 7365 7420 2d20  leInfo.offset - 
-0000e020: 7461 7246 696c 6549 6e66 6f2e 6f66 6673  tarFileInfo.offs
-0000e030: 6574 6865 6164 6572 202b 2066 696c 6549  etheader + fileI
-0000e040: 6e66 6f2e 7369 7a65 0a0a 2020 2020 2020  nfo.size..      
-0000e050: 2020 7461 7253 7562 4669 6c65 203d 2053    tarSubFile = S
-0000e060: 7465 6e63 696c 6564 4669 6c65 2873 656c  tenciledFile(sel
-0000e070: 662e 7461 7246 696c 654f 626a 6563 742c  f.tarFileObject,
-0000e080: 205b 2874 6172 4669 6c65 496e 666f 2e6f   [(tarFileInfo.o
-0000e090: 6666 7365 7468 6561 6465 722c 2074 6172  ffsetheader, tar
-0000e0a0: 426c 6f63 6b53 697a 6529 5d29 0a20 2020  BlockSize)]).   
-0000e0b0: 2020 2020 2023 2054 4f44 4f20 4974 206d       # TODO It m
-0000e0c0: 6967 6874 2062 6520 6265 7474 6572 2074  ight be better t
-0000e0d0: 6f20 736f 6d65 686f 7720 6361 6c6c 2063  o somehow call c
-0000e0e0: 6c6f 7365 206f 6e20 7461 7246 696c 6520  lose on tarFile 
-0000e0f0: 6275 7420 7468 6520 7175 6573 7469 6f6e  but the question
-0000e100: 2069 7320 7768 6572 6520 616e 6420 686f   is where and ho
-0000e110: 772e 0a20 2020 2020 2020 2023 2020 2020  w..        #    
-0000e120: 2020 4974 2077 6f75 6c64 2068 6176 6520    It would have 
-0000e130: 746f 2062 6520 6170 7065 6e64 6564 2074  to be appended t
-0000e140: 6f20 7468 6520 5f5f 6578 6974 5f5f 206d  o the __exit__ m
-0000e150: 6574 686f 6420 6f66 2066 696c 654f 626a  ethod of fileObj
-0000e160: 6563 7420 6c69 6b65 2069 6620 6265 696e  ect like if bein
-0000e170: 6720 6465 636f 7261 7465 642e 0a20 2020  g decorated..   
-0000e180: 2020 2020 2023 2020 2020 2020 466f 7220       #      For 
-0000e190: 6e6f 7720 7468 6973 2073 6565 6d73 2074  now this seems t
-0000e1a0: 6f20 776f 726b 2065 6974 6865 7220 6265  o work either be
-0000e1b0: 6361 7573 6520 6669 6c65 4f62 6a65 6374  cause fileObject
-0000e1c0: 2064 6f65 7320 6e6f 7420 7265 7175 6972   does not requir
-0000e1d0: 6520 7461 7246 696c 6520 746f 2065 7869  e tarFile to exi
-0000e1e0: 7374 0a20 2020 2020 2020 2023 2020 2020  st.        #    
-0000e1f0: 2020 6f72 2062 6563 6175 7365 2074 6172    or because tar
-0000e200: 4669 6c65 2069 7320 7369 6d70 6c79 206e  File is simply n
-0000e210: 6f74 2063 6c6f 7365 6420 636f 7272 6563  ot closed correc
-0000e220: 746c 7920 6865 7265 2c20 4927 6d20 6e6f  tly here, I'm no
-0000e230: 7420 7375 7265 2e0a 2020 2020 2020 2020  t sure..        
-0000e240: 2320 2020 2020 2053 7061 7273 6520 6669  #      Sparse fi
-0000e250: 6c65 7320 6172 6520 6b69 6e64 6120 6564  les are kinda ed
-0000e260: 6765 2d63 6173 6573 2061 6e79 7761 792c  ge-cases anyway,
-0000e270: 2073 6f20 6974 2069 736e 2774 2068 6967   so it isn't hig
-0000e280: 6820 7072 696f 7269 7479 2061 7320 6c6f  h priority as lo
-0000e290: 6e67 2061 7320 7468 6520 7465 7374 7320  ng as the tests 
-0000e2a0: 776f 726b 2e0a 2020 2020 2020 2020 7461  work..        ta
-0000e2b0: 7246 696c 6520 3d20 7461 7266 696c 652e  rFile = tarfile.
-0000e2c0: 6f70 656e 2866 696c 656f 626a 3d74 7970  open(fileobj=typ
-0000e2d0: 696e 672e 6361 7374 2849 4f5b 6279 7465  ing.cast(IO[byte
-0000e2e0: 735d 2c20 7461 7253 7562 4669 6c65 292c  s], tarSubFile),
-0000e2f0: 206d 6f64 653d 2772 3a27 2c20 656e 636f   mode='r:', enco
-0000e300: 6469 6e67 3d73 656c 662e 656e 636f 6469  ding=self.encodi
-0000e310: 6e67 290a 2020 2020 2020 2020 6669 6c65  ng).        file
-0000e320: 4f62 6a65 6374 203d 2074 6172 4669 6c65  Object = tarFile
-0000e330: 2e65 7874 7261 6374 6669 6c65 286e 6578  .extractfile(nex
-0000e340: 7428 6974 6572 2874 6172 4669 6c65 2929  t(iter(tarFile))
-0000e350: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0000e360: 2066 696c 654f 626a 6563 743a 0a20 2020   fileObject:.   
-0000e370: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0000e380: 7461 7266 696c 652e 6578 7472 6163 7466  tarfile.extractf
-0000e390: 696c 6520 7265 7475 726e 6564 206e 6f74  ile returned not
-0000e3a0: 6869 6e67 2122 290a 2020 2020 2020 2020  hing!").        
-0000e3b0: 2020 2020 7261 6973 6520 6675 7365 2e46      raise fuse.F
-0000e3c0: 7573 654f 5345 7272 6f72 2866 7573 652e  useOSError(fuse.
-0000e3d0: 6572 726e 6f2e 4549 4f29 2069 6620 2266  errno.EIO) if "f
-0000e3e0: 7573 6522 2069 6e20 7379 732e 6d6f 6475  use" in sys.modu
-0000e3f0: 6c65 7320 656c 7365 2045 7863 6570 7469  les else Excepti
-0000e400: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0000e410: 2020 2020 2274 6172 6669 6c65 2e65 7874      "tarfile.ext
-0000e420: 7261 6374 6669 6c65 2072 6574 7572 6e65  ractfile returne
-0000e430: 6420 6e6f 7468 696e 6721 220a 2020 2020  d nothing!".    
-0000e440: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000e450: 2020 2072 6574 7572 6e20 6669 6c65 4f62     return fileOb
-0000e460: 6a65 6374 0a0a 2020 2020 406f 7665 7272  ject..    @overr
-0000e470: 6964 6573 284d 6f75 6e74 536f 7572 6365  ides(MountSource
-0000e480: 290a 2020 2020 6465 6620 7265 6164 2873  ).    def read(s
-0000e490: 656c 662c 2066 696c 6549 6e66 6f3a 2046  elf, fileInfo: F
-0000e4a0: 696c 6549 6e66 6f2c 2073 697a 653a 2069  ileInfo, size: i
-0000e4b0: 6e74 2c20 6f66 6673 6574 3a20 696e 7429  nt, offset: int)
-0000e4c0: 202d 3e20 6279 7465 733a 0a20 2020 2020   -> bytes:.     
-0000e4d0: 2020 2061 7373 6572 7420 6669 6c65 496e     assert fileIn
-0000e4e0: 666f 2e75 7365 7264 6174 610a 2020 2020  fo.userdata.    
-0000e4f0: 2020 2020 7461 7246 696c 6549 6e66 6f20      tarFileInfo 
-0000e500: 3d20 6669 6c65 496e 666f 2e75 7365 7264  = fileInfo.userd
-0000e510: 6174 615b 2d31 5d0a 2020 2020 2020 2020  ata[-1].        
-0000e520: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-0000e530: 6528 7461 7246 696c 6549 6e66 6f2c 2053  e(tarFileInfo, S
-0000e540: 514c 6974 6549 6e64 6578 6564 5461 7255  QLiteIndexedTarU
-0000e550: 7365 7244 6174 6129 0a0a 2020 2020 2020  serData)..      
-0000e560: 2020 6966 2074 6172 4669 6c65 496e 666f    if tarFileInfo
-0000e570: 2e69 7373 7061 7273 653a 0a20 2020 2020  .issparse:.     
-0000e580: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000e590: 2e6f 7065 6e28 6669 6c65 496e 666f 2920  .open(fileInfo) 
-0000e5a0: 6173 2066 696c 653a 0a20 2020 2020 2020  as file:.       
-0000e5b0: 2020 2020 2020 2020 2066 696c 652e 7365           file.se
-0000e5c0: 656b 286f 6666 7365 742c 206f 732e 5345  ek(offset, os.SE
-0000e5d0: 454b 5f53 4554 290a 2020 2020 2020 2020  EK_SET).        
-0000e5e0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0000e5f0: 696c 652e 7265 6164 2873 697a 6529 0a0a  ile.read(size)..
-0000e600: 2020 2020 2020 2020 2320 466f 7220 6e6f          # For no
-0000e610: 6e2d 7370 6172 7365 2066 696c 6573 2c20  n-sparse files, 
-0000e620: 7765 2063 616e 2073 696d 706c 7920 7365  we can simply se
-0000e630: 656b 2074 6f20 7468 6520 6f66 6673 6574  ek to the offset
-0000e640: 2061 6e64 2072 6561 6420 6672 6f6d 2069   and read from i
-0000e650: 742e 0a20 2020 2020 2020 2073 656c 662e  t..        self.
-0000e660: 7461 7246 696c 654f 626a 6563 742e 7365  tarFileObject.se
-0000e670: 656b 2874 6172 4669 6c65 496e 666f 2e6f  ek(tarFileInfo.o
-0000e680: 6666 7365 7420 2b20 6f66 6673 6574 2c20  ffset + offset, 
-0000e690: 6f73 2e53 4545 4b5f 5345 5429 0a20 2020  os.SEEK_SET).   
-0000e6a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000e6b0: 2e74 6172 4669 6c65 4f62 6a65 6374 2e72  .tarFileObject.r
-0000e6c0: 6561 6428 7369 7a65 290a 0a20 2020 2064  ead(size)..    d
-0000e6d0: 6566 205f 7472 7941 6464 5061 7265 6e74  ef _tryAddParent
-0000e6e0: 466f 6c64 6572 7328 7365 6c66 2c20 7061  Folders(self, pa
-0000e6f0: 7468 3a20 7374 722c 206f 6666 7365 7468  th: str, offseth
-0000e700: 6561 6465 723a 2069 6e74 2c20 6f66 6673  eader: int, offs
-0000e710: 6574 3a20 696e 7429 202d 3e20 4e6f 6e65  et: int) -> None
-0000e720: 3a0a 2020 2020 2020 2020 2320 4164 6420  :.        # Add 
-0000e730: 7061 7265 6e74 2066 6f6c 6465 7273 2069  parent folders i
-0000e740: 6620 7468 6579 2064 6f20 6e6f 7420 6578  f they do not ex
-0000e750: 6973 742e 0a20 2020 2020 2020 2023 2045  ist..        # E
-0000e760: 2e67 2e3a 2070 6174 6820 3d20 272f 612f  .g.: path = '/a/
-0000e770: 622f 6327 202d 3e20 7061 7468 7320 3d20  b/c' -> paths = 
-0000e780: 5b28 2727 2c20 2761 2729 2c20 2827 2f61  [('', 'a'), ('/a
-0000e790: 272c 2027 6227 292c 2028 272f 612f 6227  ', 'b'), ('/a/b'
-0000e7a0: 2c20 2763 2729 5d0a 2020 2020 2020 2020  , 'c')].        
-0000e7b0: 2320 5769 7468 6f75 7420 7468 6520 7061  # Without the pa
-0000e7c0: 7265 6e74 466f 6c64 6572 4361 6368 652c  rentFolderCache,
-0000e7d0: 2074 6865 2061 6464 6974 696f 6e61 6c20   the additional 
-0000e7e0: 494e 5345 5254 2073 7461 7465 6d65 6e74  INSERT statement
-0000e7f0: 7320 696e 6372 6561 7365 2074 6865 2063  s increase the c
-0000e800: 7265 6174 696f 6e20 7469 6d65 0a20 2020  reation time.   
-0000e810: 2020 2020 2023 2066 726f 6d20 382e 3573       # from 8.5s
-0000e820: 2074 6f20 3132 732c 2073 6f20 616c 6d6f   to 12s, so almo
-0000e830: 7374 2035 3025 2073 6c6f 7764 6f77 6e20  st 50% slowdown 
-0000e840: 666f 7220 7468 6520 384d 6942 2074 6573  for the 8MiB tes
-0000e850: 7420 5441 5221 0a20 2020 2020 2020 2070  t TAR!.        p
-0000e860: 6174 6850 6172 7473 203d 2070 6174 682e  athParts = path.
-0000e870: 7370 6c69 7428 222f 2229 0a20 2020 2020  split("/").     
-0000e880: 2020 2070 6174 6873 203d 205b 0a20 2020     paths = [.   
-0000e890: 2020 2020 2020 2020 2070 0a20 2020 2020           p.     
-0000e8a0: 2020 2020 2020 2023 2066 6d74 3a20 6f66         # fmt: of
-0000e8b0: 660a 2020 2020 2020 2020 2020 2020 666f  f.            fo
-0000e8c0: 7220 7020 696e 2028 0a20 2020 2020 2020  r p in (.       
-0000e8d0: 2020 2020 2020 2020 2028 2022 2f22 2e6a           ( "/".j
-0000e8e0: 6f69 6e28 2070 6174 6850 6172 7473 5b3a  oin( pathParts[:
-0000e8f0: 695d 2029 2c20 7061 7468 5061 7274 735b  i] ), pathParts[
-0000e900: 695d 2029 0a20 2020 2020 2020 2020 2020  i] ).           
-0000e910: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0000e920: 6e67 6528 2031 2c20 6c65 6e28 2070 6174  nge( 1, len( pat
-0000e930: 6850 6172 7473 2029 2029 0a20 2020 2020  hParts ) ).     
-0000e940: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000e950: 2020 2020 2023 2066 6d74 3a20 6f6e 0a20       # fmt: on. 
-0000e960: 2020 2020 2020 2020 2020 2069 6620 7020             if p 
-0000e970: 6e6f 7420 696e 2073 656c 662e 7061 7265  not in self.pare
-0000e980: 6e74 466f 6c64 6572 4361 6368 650a 2020  ntFolderCache.  
-0000e990: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-0000e9a0: 6966 206e 6f74 2070 6174 6873 3a0a 2020  if not paths:.  
-0000e9b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000e9c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-0000e9d0: 6172 656e 7446 6f6c 6465 7243 6163 6865  arentFolderCache
-0000e9e0: 202b 3d20 7061 7468 730a 2020 2020 2020   += paths.      
-0000e9f0: 2020 2320 4173 7375 6d69 6e67 2066 696c    # Assuming fil
-0000ea00: 6573 2069 6e20 7468 6520 5441 5220 6172  es in the TAR ar
-0000ea10: 6520 736f 7274 6564 2062 7920 6869 6572  e sorted by hier
-0000ea20: 6172 6368 792c 2074 6865 206d 6178 696d  archy, the maxim
-0000ea30: 756d 2070 6172 656e 7420 666f 6c64 6572  um parent folder
-0000ea40: 2063 6163 6865 2073 697a 650a 2020 2020   cache size.    
-0000ea50: 2020 2020 2320 6769 7665 7320 7468 6520      # gives the 
-0000ea60: 6d61 7869 6d75 6d20 6361 6368 6561 626c  maximum cacheabl
-0000ea70: 6520 6669 6c65 206e 6573 7469 6e67 2064  e file nesting d
-0000ea80: 6570 7468 2e20 4869 6768 206e 756d 6265  epth. High numbe
-0000ea90: 7273 206c 6561 6420 746f 2068 6967 6865  rs lead to highe
-0000eaa0: 7220 6d65 6d6f 7279 2075 7361 6765 2061  r memory usage a
-0000eab0: 6e64 206c 6f6f 6b75 7020 7469 6d65 732e  nd lookup times.
-0000eac0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0000ead0: 7365 6c66 2e70 6172 656e 7446 6f6c 6465  self.parentFolde
-0000eae0: 7243 6163 6865 2920 3e20 3136 3a0a 2020  rCache) > 16:.  
-0000eaf0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000eb00: 6172 656e 7446 6f6c 6465 7243 6163 6865  arentFolderCache
-0000eb10: 203d 2073 656c 662e 7061 7265 6e74 466f   = self.parentFo
-0000eb20: 6c64 6572 4361 6368 655b 2d38 3a5d 0a0a  lderCache[-8:]..
-0000eb30: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000eb40: 656c 662e 7371 6c43 6f6e 6e65 6374 696f  elf.sqlConnectio
-0000eb50: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
-0000eb60: 6169 7365 2049 6e64 6578 4e6f 744f 7065  aise IndexNotOpe
-0000eb70: 6e45 7272 6f72 2822 5468 6973 206d 6574  nError("This met
-0000eb80: 686f 6420 6361 6e20 6e6f 7420 6265 2063  hod can not be c
-0000eb90: 616c 6c65 6420 7769 7468 6f75 7420 616e  alled without an
-0000eba0: 206f 7065 6e65 6420 696e 6465 7820 6461   opened index da
-0000ebb0: 7461 6261 7365 2122 290a 0a20 2020 2020  tabase!")..     
-0000ebc0: 2020 2023 2054 4f44 4f20 5468 6973 206d     # TODO This m
-0000ebd0: 6574 686f 6420 6973 2073 7469 6c6c 206e  ethod is still n
-0000ebe0: 6f74 2070 6572 6665 6374 2062 7574 2049  ot perfect but I
-0000ebf0: 2064 6f20 6e6f 7420 6b6e 6f77 2068 6f77   do not know how
-0000ec00: 2074 6f20 7065 7266 6563 7420 6974 2077   to perfect it w
-0000ec10: 6974 686f 7574 206c 6f6f 7369 6e67 2073  ithout loosing s
-0000ec20: 6967 6e69 6669 6361 6e74 0a20 2020 2020  ignificant.     
-0000ec30: 2020 2023 2020 2020 2020 7065 7266 6f72     #      perfor
-0000ec40: 6d61 6e63 652e 2043 7572 7265 6e74 6c79  mance. Currently
-0000ec50: 2c20 6164 6469 6e67 2069 6d70 6c69 6369  , adding implici
-0000ec60: 7420 666f 6c64 6572 7320 7769 6c6c 2066  t folders will f
-0000ec70: 6169 6c20 7768 656e 2061 2066 696c 6520  ail when a file 
-0000ec80: 6973 206f 7665 7277 7269 7474 656e 2069  is overwritten i
-0000ec90: 6d70 6c69 6369 746c 7920 7769 7468 0a20  mplicitly with. 
-0000eca0: 2020 2020 2020 2023 2020 2020 2020 6120         #      a 
-0000ecb0: 666f 6c64 6572 2061 6e64 2074 6865 6e20  folder and then 
-0000ecc0: 6f76 6572 7772 6974 7465 6e20 6279 2061  overwritten by a
-0000ecd0: 2066 696c 6520 616e 6420 7468 656e 2061   file and then a
-0000ece0: 6761 696e 206f 7665 7277 7269 7474 656e  gain overwritten
-0000ecf0: 2062 7920 6120 666f 6c64 6572 2e20 4265   by a folder. Be
-0000ed00: 6361 7573 6520 7468 6520 7061 7265 6e74  cause the parent
-0000ed10: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-0000ed20: 666f 6c64 6572 7761 7320 616c 7265 6164  folderwas alread
-0000ed30: 7920 6164 6465 6420 696d 706c 6963 6974  y added implicit
-0000ed40: 6c79 2074 6865 2066 6972 7374 2074 696d  ly the first tim
-0000ed50: 652c 2074 6865 2073 6563 6f6e 6420 7469  e, the second ti
-0000ed60: 6d65 2077 696c 6c20 6265 2073 6b69 7070  me will be skipp
-0000ed70: 6564 2e0a 2020 2020 2020 2020 2320 2020  ed..        #   
-0000ed80: 2020 2054 6f20 736f 6c76 6520 7468 6973     To solve this
-0000ed90: 2c20 4920 776f 756c 6420 6861 7665 2074  , I would have t
-0000eda0: 6f20 6164 6420 616c 6c20 7061 7265 6e74  o add all parent
-0000edb0: 2066 6f6c 6465 7273 2066 6f72 2061 6c6c   folders for all
-0000edc0: 2066 696c 6573 2c20 7768 6963 6820 6d69   files, which mi
-0000edd0: 6768 7420 6561 7369 6c79 2065 7870 6c6f  ght easily explo
-0000ede0: 6465 0a20 2020 2020 2020 2023 2020 2020  de.        #    
-0000edf0: 2020 7468 6520 7465 6d70 6f72 6172 7920    the temporary 
-0000ee00: 6461 7461 6261 7365 2061 6e64 2074 6865  database and the
-0000ee10: 2069 6e64 6578 696e 6720 7065 7266 6f72   indexing perfor
-0000ee20: 6d61 6e63 6520 6279 2074 6865 2066 6f6c  mance by the fol
-0000ee30: 6465 7220 6465 7074 682e 0a20 2020 2020  der depth..     
-0000ee40: 2020 2023 2020 2020 2020 416c 736f 2c20     #      Also, 
-0000ee50: 4920 646f 206e 6f74 2077 616e 7420 746f  I do not want to
-0000ee60: 2061 6464 2076 6572 7369 6f6e 7320 666f   add versions fo
-0000ee70: 7220 6120 7061 7265 6e74 2066 6f6c 6465  r a parent folde
-0000ee80: 7220 666f 7220 6561 6368 2069 6d70 6c69  r for each impli
-0000ee90: 6369 746c 7920 6164 6465 6420 7061 7265  citly added pare
-0000eea0: 6e74 2066 6f6c 6465 7220 666f 720a 2020  nt folder for.  
-0000eeb0: 2020 2020 2020 2320 2020 2020 2065 6163        #      eac
-0000eec0: 6820 6669 6c65 2c20 736f 2049 2077 6f75  h file, so I wou
-0000eed0: 6c64 2068 6176 6520 746f 2073 6f72 7420  ld have to sort 
-0000eee0: 6f75 7420 7468 6f73 6520 696e 2061 2070  out those in a p
-0000eef0: 6f73 742d 7072 6f63 6573 7369 6e67 2073  ost-processing s
-0000ef00: 7465 702e 2045 2e67 2e2c 2073 6f72 7420  tep. E.g., sort 
-0000ef10: 6279 206f 6666 7365 7468 6561 6465 720a  by offsetheader.
-0000ef20: 2020 2020 2020 2020 2320 2020 2020 2061          #      a
-0000ef30: 6e64 2074 6865 6e20 636c 6561 6e20 6f75  nd then clean ou
-0000ef40: 7420 7375 6363 6573 7369 7665 2069 6d70  t successive imp
-0000ef50: 6c69 6369 746c 7920 6164 6465 6420 666f  licitly added fo
-0000ef60: 6c64 6572 7320 6173 206c 6f6e 6720 6173  lders as long as
-0000ef70: 2074 6865 7265 2069 7320 6e6f 2066 696c   there is no fil
-0000ef80: 6520 6f66 2074 6865 2073 616d 6520 6e61  e of the same na
-0000ef90: 6d65 0a20 2020 2020 2020 2023 2020 2020  me.        #    
-0000efa0: 2020 696e 6265 7477 6565 6e2e 0a20 2020    inbetween..   
-0000efb0: 2020 2020 2023 2020 2020 2020 5468 6520       #      The 
-0000efc0: 756e 6d65 6e74 696f 6e65 6420 616c 7465  unmentioned alte
-0000efd0: 726e 6174 6976 6520 776f 756c 6420 6265  rnative would be
-0000efe0: 2074 6f20 6c6f 6f6b 7570 2070 6174 6873   to lookup paths
-0000eff0: 2077 6974 6820 4c49 4b45 2062 7574 2074   with LIKE but t
-0000f000: 6861 7420 6973 206a 7573 7420 6d61 646e  hat is just madn
-0000f010: 6573 7320 6265 6361 7573 6520 6974 0a20  ess because it. 
-0000f020: 2020 2020 2020 2023 2020 2020 2020 7769         #      wi
-0000f030: 6c6c 2068 6176 6520 6120 776f 7273 6520  ll have a worse 
-0000f040: 636f 6d70 6c65 7869 7479 206f 6620 4f28  complexity of O(
-0000f050: 4e29 2069 6e73 7465 6461 206f 6620 4f28  N) insteda of O(
-0000f060: 6c6f 6728 4e29 292e 0a20 2020 2020 2020  log(N))..       
-0000f070: 2073 656c 662e 7371 6c43 6f6e 6e65 6374   self.sqlConnect
-0000f080: 696f 6e2e 6578 6563 7574 656d 616e 7928  ion.executemany(
-0000f090: 0a20 2020 2020 2020 2020 2020 2027 494e  .            'IN
-0000f0a0: 5345 5254 204f 5220 4947 4e4f 5245 2049  SERT OR IGNORE I
-0000f0b0: 4e54 4f20 2270 6172 656e 7466 6f6c 6465  NTO "parentfolde
-0000f0c0: 7273 2220 5641 4c55 4553 2028 3f2c 3f2c  rs" VALUES (?,?,
-0000f0d0: 3f2c 3f29 272c 0a20 2020 2020 2020 2020  ?,?)',.         
-0000f0e0: 2020 205b 2870 5b30 5d2c 2070 5b31 5d2c     [(p[0], p[1],
-0000f0f0: 206f 6666 7365 7468 6561 6465 722c 206f   offsetheader, o
-0000f100: 6666 7365 7429 2066 6f72 2070 2069 6e20  ffset) for p in 
-0000f110: 7061 7468 735d 2c0a 2020 2020 2020 2020  paths],.        
-0000f120: 290a 0a20 2020 2064 6566 205f 7365 7446  )..    def _setF
-0000f130: 696c 6549 6e66 6f28 7365 6c66 2c20 726f  ileInfo(self, ro
-0000f140: 773a 2074 7570 6c65 2920 2d3e 204e 6f6e  w: tuple) -> Non
-0000f150: 653a 0a20 2020 2020 2020 2069 6620 6e6f  e:.        if no
-0000f160: 7420 7365 6c66 2e73 716c 436f 6e6e 6563  t self.sqlConnec
-0000f170: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0000f180: 2020 7261 6973 6520 496e 6465 784e 6f74    raise IndexNot
-0000f190: 4f70 656e 4572 726f 7228 2254 6869 7320  OpenError("This 
-0000f1a0: 6d65 7468 6f64 2063 616e 206e 6f74 2062  method can not b
-0000f1b0: 6520 6361 6c6c 6564 2077 6974 686f 7574  e called without
-0000f1c0: 2061 6e20 6f70 656e 6564 2069 6e64 6578   an opened index
-0000f1d0: 2064 6174 6162 6173 6521 2229 0a0a 2020   database!")..  
-0000f1e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000f1f0: 2020 2020 2020 2073 656c 662e 7371 6c43         self.sqlC
-0000f200: 6f6e 6e65 6374 696f 6e2e 6578 6563 7574  onnection.execut
-0000f210: 6528 2749 4e53 4552 5420 4f52 2052 4550  e('INSERT OR REP
-0000f220: 4c41 4345 2049 4e54 4f20 2266 696c 6573  LACE INTO "files
-0000f230: 2220 5641 4c55 4553 2028 2720 2b20 272c  " VALUES (' + ',
-0000f240: 272e 6a6f 696e 2827 3f27 202a 206c 656e  '.join('?' * len
-0000f250: 2872 6f77 2929 202b 2027 293b 272c 2072  (row)) + ');', r
-0000f260: 6f77 290a 2020 2020 2020 2020 6578 6365  ow).        exce
-0000f270: 7074 2055 6e69 636f 6465 456e 636f 6465  pt UnicodeEncode
-0000f280: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0000f290: 2020 2070 7269 6e74 2822 5b57 6172 6e69     print("[Warni
-0000f2a0: 6e67 5d20 5072 6f62 6c65 6d20 6361 7573  ng] Problem caus
-0000f2b0: 6564 2062 7920 6669 6c65 206e 616d 6520  ed by file name 
-0000f2c0: 656e 636f 6469 6e67 2077 6865 6e20 7472  encoding when tr
-0000f2d0: 7969 6e67 2074 6f20 696e 7365 7274 2074  ying to insert t
-0000f2e0: 6869 7320 726f 773a 222c 2072 6f77 290a  his row:", row).
-0000f2f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000f300: 7428 225b 5761 726e 696e 675d 2054 6865  t("[Warning] The
-0000f310: 2066 696c 6520 6e61 6d65 2077 696c 6c20   file name will 
-0000f320: 6e6f 7720 6265 2073 746f 7265 6420 7769  now be stored wi
-0000f330: 7468 2074 6865 2062 6164 2063 6861 7261  th the bad chara
-0000f340: 6374 6572 2062 6569 6e67 2065 7363 6170  cter being escap
-0000f350: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
-0000f360: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
-0000f370: 5d20 696e 7374 6561 6420 6f66 2062 6569  ] instead of bei
-0000f380: 6e67 2063 6f72 7265 6374 6c79 2069 6e74  ng correctly int
-0000f390: 6572 7072 6574 6564 2e22 290a 2020 2020  erpreted.").    
-0000f3a0: 2020 2020 2020 2020 7072 696e 7428 225b          print("[
-0000f3b0: 5761 726e 696e 675d 2050 6c65 6173 6520  Warning] Please 
-0000f3c0: 7370 6563 6966 7920 6120 7375 6974 6162  specify a suitab
-0000f3d0: 6c65 2066 696c 6520 6e61 6d65 2065 6e63  le file name enc
-0000f3e0: 6f64 696e 6720 7573 696e 672c 2065 2e67  oding using, e.g
-0000f3f0: 2e2c 202d 2d65 6e63 6f64 696e 6720 6973  ., --encoding is
-0000f400: 6f2d 3838 3539 2d31 2122 290a 2020 2020  o-8859-1!").    
-0000f410: 2020 2020 2020 2020 7072 696e 7428 225b          print("[
-0000f420: 5761 726e 696e 675d 2041 206c 6973 7420  Warning] A list 
-0000f430: 6f66 2070 6f73 7369 626c 6520 656e 636f  of possible enco
-0000f440: 6469 6e67 7320 6361 6e20 6265 2066 6f75  dings can be fou
-0000f450: 6e64 2068 6572 653a 2229 0a20 2020 2020  nd here:").     
-0000f460: 2020 2020 2020 2070 7269 6e74 2822 5b57         print("[W
-0000f470: 6172 6e69 6e67 5d20 6874 7470 733a 2f2f  arning] https://
-0000f480: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
-0000f490: 332f 6c69 6272 6172 792f 636f 6465 6373  3/library/codecs
-0000f4a0: 2e68 746d 6c23 7374 616e 6461 7264 2d65  .html#standard-e
-0000f4b0: 6e63 6f64 696e 6773 2229 0a0a 2020 2020  ncodings")..    
-0000f4c0: 2020 2020 2020 2020 6368 6563 6b65 6452          checkedR
-0000f4d0: 6f77 203d 205b 5d0a 2020 2020 2020 2020  ow = [].        
-0000f4e0: 2020 2020 666f 7220 7820 696e 206c 6973      for x in lis
-0000f4f0: 7428 726f 7729 3a20 2023 2063 6865 636b  t(row):  # check
-0000f500: 2073 7472 696e 6773 0a20 2020 2020 2020   strings.       
-0000f510: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0000f520: 7374 616e 6365 2878 2c20 7374 7229 3a0a  stance(x, str):.
-0000f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f540: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f560: 2078 2e65 6e63 6f64 6528 290a 2020 2020   x.encode().    
-0000f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f580: 2020 2020 6368 6563 6b65 6452 6f77 202b      checkedRow +
-0000f590: 3d20 5b78 5d0a 2020 2020 2020 2020 2020  = [x].          
-0000f5a0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000f5b0: 2055 6e69 636f 6465 456e 636f 6465 4572   UnicodeEncodeEr
-0000f5c0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000f5d0: 2020 2020 2020 2020 2020 2020 2023 2066               # f
-0000f5e0: 6d74 3a20 6f66 660a 2020 2020 2020 2020  mt: off.        
-0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f600: 6368 6563 6b65 6452 6f77 202b 3d20 5b0a  checkedRow += [.
-0000f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f620: 2020 2020 2020 2020 2020 2020 782e 656e              x.en
-0000f630: 636f 6465 2820 7365 6c66 2e65 6e63 6f64  code( self.encod
-0000f640: 696e 672c 2027 7375 7272 6f67 6174 6565  ing, 'surrogatee
-0000f650: 7363 6170 6527 2029 0a20 2020 2020 2020  scape' ).       
-0000f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f670: 2020 2020 2020 2e64 6563 6f64 6528 2073        .decode( s
-0000f680: 656c 662e 656e 636f 6469 6e67 2c20 2762  elf.encoding, 'b
-0000f690: 6163 6b73 6c61 7368 7265 706c 6163 6527  ackslashreplace'
-0000f6a0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000f6b0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-0000f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6d0: 2020 2020 2020 2320 666d 743a 206f 6e0a        # fmt: on.
-0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000f700: 2020 2020 2020 2020 2020 6368 6563 6b65            checke
-0000f710: 6452 6f77 202b 3d20 5b78 5d0a 0a20 2020  dRow += [x]..   
-0000f720: 2020 2020 2020 2020 2073 656c 662e 7371           self.sq
-0000f730: 6c43 6f6e 6e65 6374 696f 6e2e 6578 6563  lConnection.exec
-0000f740: 7574 6528 0a20 2020 2020 2020 2020 2020  ute(.           
-0000f750: 2020 2020 2027 494e 5345 5254 204f 5220       'INSERT OR 
-0000f760: 5245 504c 4143 4520 494e 544f 2022 6669  REPLACE INTO "fi
-0000f770: 6c65 7322 2056 414c 5545 5320 2827 202b  les" VALUES (' +
-0000f780: 2027 2c27 2e6a 6f69 6e28 273f 2720 2a20   ','.join('?' * 
-0000f790: 6c65 6e28 726f 7729 2920 2b20 2729 3b27  len(row)) + ');'
-0000f7a0: 2c20 7475 706c 6528 6368 6563 6b65 6452  , tuple(checkedR
-0000f7b0: 6f77 290a 2020 2020 2020 2020 2020 2020  ow).            
-0000f7c0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0000f7d0: 696e 7428 225b 5761 726e 696e 675d 2054  int("[Warning] T
-0000f7e0: 6865 2065 7363 6170 6564 2069 6e73 6572  he escaped inser
-0000f7f0: 7465 6420 726f 7720 6973 206e 6f77 3a22  ted row is now:"
-0000f800: 2c20 726f 7729 0a20 2020 2020 2020 2020  , row).         
-0000f810: 2020 2070 7269 6e74 2829 0a0a 2020 2020     print()..    
-0000f820: 2020 2020 7365 6c66 2e5f 7472 7941 6464      self._tryAdd
-0000f830: 5061 7265 6e74 466f 6c64 6572 7328 726f  ParentFolders(ro
-0000f840: 775b 305d 2c20 726f 775b 325d 2c20 726f  w[0], row[2], ro
-0000f850: 775b 335d 290a 0a20 2020 2064 6566 2069  w[3])..    def i
-0000f860: 6e64 6578 4973 4c6f 6164 6564 2873 656c  ndexIsLoaded(sel
-0000f870: 6629 202d 3e20 626f 6f6c 3a0a 2020 2020  f) -> bool:.    
-0000f880: 2020 2020 2222 2252 6574 7572 6e73 2074      """Returns t
-0000f890: 7275 6520 6966 2074 6865 2053 514c 6974  rue if the SQLit
-0000f8a0: 6520 6461 7461 6261 7365 2068 6173 2062  e database has b
-0000f8b0: 6565 6e20 6f70 656e 6564 2066 6f72 2072  een opened for r
-0000f8c0: 6561 6469 6e67 2061 6e64 2061 2022 6669  eading and a "fi
-0000f8d0: 6c65 7322 2074 6162 6c65 2065 7869 7374  les" table exist
-0000f8e0: 732e 2222 220a 2020 2020 2020 2020 6966  s.""".        if
-0000f8f0: 206e 6f74 2073 656c 662e 7371 6c43 6f6e   not self.sqlCon
-0000f900: 6e65 6374 696f 6e3a 0a20 2020 2020 2020  nection:.       
-0000f910: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0000f920: 650a 0a20 2020 2020 2020 2074 7279 3a0a  e..        try:.
-0000f930: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f940: 2e73 716c 436f 6e6e 6563 7469 6f6e 2e65  .sqlConnection.e
-0000f950: 7865 6375 7465 2827 5345 4c45 4354 202a  xecute('SELECT *
-0000f960: 2046 524f 4d20 2266 696c 6573 2220 5748   FROM "files" WH
-0000f970: 4552 4520 3020 3d3d 2031 3b27 290a 2020  ERE 0 == 1;').  
-0000f980: 2020 2020 2020 6578 6365 7074 2073 716c        except sql
-0000f990: 6974 6533 2e4f 7065 7261 7469 6f6e 616c  ite3.Operational
-0000f9a0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0000f9b0: 2020 2073 656c 662e 7371 6c43 6f6e 6e65     self.sqlConne
-0000f9c0: 6374 696f 6e20 3d20 4e6f 6e65 0a20 2020  ction = None.   
-0000f9d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000f9e0: 4661 6c73 650a 0a20 2020 2020 2020 2072  False..        r
-0000f9f0: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-0000fa00: 6465 6620 6c6f 6164 496e 6465 7828 7365  def loadIndex(se
-0000fa10: 6c66 2c20 696e 6465 7846 696c 654e 616d  lf, indexFileNam
-0000fa20: 653a 2041 6e79 5374 7229 202d 3e20 4e6f  e: AnyStr) -> No
-0000fa30: 6e65 3a0a 2020 2020 2020 2020 2222 224c  ne:.        """L
-0000fa40: 6f61 6473 2074 6865 2067 6976 656e 2069  oads the given i
-0000fa50: 6e64 6578 2053 514c 6974 6520 6461 7461  ndex SQLite data
-0000fa60: 6261 7365 2061 6e64 2063 6865 636b 7320  base and checks 
-0000fa70: 6974 2066 6f72 2076 616c 6964 6974 792e  it for validity.
-0000fa80: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0000fa90: 656c 662e 696e 6465 7849 734c 6f61 6465  elf.indexIsLoade
-0000faa0: 6428 293a 0a20 2020 2020 2020 2020 2020  d():.           
-0000fab0: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
-0000fac0: 2074 3020 3d20 7469 6d65 2e74 696d 6528   t0 = time.time(
-0000fad0: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-0000fae0: 716c 436f 6e6e 6563 7469 6f6e 203d 2073  qlConnection = s
-0000faf0: 656c 662e 5f6f 7065 6e53 716c 4462 2869  elf._openSqlDb(i
-0000fb00: 6e64 6578 4669 6c65 4e61 6d65 290a 2020  ndexFileName).  
-0000fb10: 2020 2020 2020 7461 626c 6573 203d 205b        tables = [
-0000fb20: 785b 305d 2066 6f72 2078 2069 6e20 7365  x[0] for x in se
-0000fb30: 6c66 2e73 716c 436f 6e6e 6563 7469 6f6e  lf.sqlConnection
-0000fb40: 2e65 7865 6375 7465 2827 5345 4c45 4354  .execute('SELECT
-0000fb50: 206e 616d 6520 4652 4f4d 2073 716c 6974   name FROM sqlit
-0000fb60: 655f 6d61 7374 6572 2057 4845 5245 2074  e_master WHERE t
-0000fb70: 7970 653d 2274 6162 6c65 2227 295d 0a20  ype="table"')]. 
-0000fb80: 2020 2020 2020 2076 6572 7369 6f6e 7320         versions 
-0000fb90: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
-0000fba0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000fbb0: 726f 7773 203d 2073 656c 662e 7371 6c43  rows = self.sqlC
-0000fbc0: 6f6e 6e65 6374 696f 6e2e 6578 6563 7574  onnection.execut
-0000fbd0: 6528 2753 454c 4543 5420 2a20 4652 4f4d  e('SELECT * FROM
-0000fbe0: 2076 6572 7369 6f6e 733b 2729 0a20 2020   versions;').   
-0000fbf0: 2020 2020 2020 2020 2076 6572 7369 6f6e           version
-0000fc00: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
-0000fc10: 2020 2066 6f72 2072 6f77 2069 6e20 726f     for row in ro
-0000fc20: 7773 3a0a 2020 2020 2020 2020 2020 2020  ws:.            
-0000fc30: 2020 2020 7665 7273 696f 6e73 5b72 6f77      versions[row
-0000fc40: 5b30 5d5d 203d 2028 726f 775b 325d 2c20  [0]] = (row[2], 
-0000fc50: 726f 775b 335d 2c20 726f 775b 345d 290a  row[3], row[4]).
-0000fc60: 2020 2020 2020 2020 6578 6365 7074 2073          except s
-0000fc70: 716c 6974 6533 2e4f 7065 7261 7469 6f6e  qlite3.Operation
-0000fc80: 616c 4572 726f 723a 0a20 2020 2020 2020  alError:.       
-0000fc90: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
-0000fca0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000fcb0: 2020 2020 2320 4368 6563 6b20 696e 6465      # Check inde
-0000fcc0: 7865 7320 6372 6561 7465 6420 7769 7468  xes created with
-0000fcd0: 2062 7567 6765 6420 627a 3220 6465 636f   bugged bz2 deco
-0000fce0: 6465 7220 2862 7567 2065 7869 7374 6564  der (bug existed
-0000fcf0: 2077 6865 6e20 4920 6469 6420 6e6f 7420   when I did not 
-0000fd00: 7374 6f72 6520 7665 7273 696f 6e73 2079  store versions y
-0000fd10: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-0000fd20: 6966 2027 627a 6970 3262 6c6f 636b 7327  if 'bzip2blocks'
-0000fd30: 2069 6e20 7461 626c 6573 2061 6e64 2027   in tables and '
-0000fd40: 7665 7273 696f 6e73 2720 6e6f 7420 696e  versions' not in
-0000fd50: 2074 6162 6c65 733a 0a20 2020 2020 2020   tables:.       
-0000fd60: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-0000fd70: 6e76 616c 6964 496e 6465 7845 7272 6f72  nvalidIndexError
-0000fd80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000fd90: 2020 2020 2020 2254 6865 2069 6e64 6578        "The index
-0000fda0: 6573 2063 7265 6174 6564 2077 6974 6820  es created with 
-0000fdb0: 7665 7273 696f 6e20 302e 332e 3020 7468  version 0.3.0 th
-0000fdc0: 726f 7567 6820 302e 332e 3320 666f 7220  rough 0.3.3 for 
-0000fdd0: 627a 6970 3220 636f 6d70 7265 7373 6564  bzip2 compressed
-0000fde0: 2061 7263 6869 7665 7320 220a 2020 2020   archives ".    
-0000fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe00: 2261 7265 2076 6572 7920 6c69 6b65 6c79  "are very likely
-0000fe10: 2074 6f20 6265 2077 726f 6e67 2062 6563   to be wrong bec
-0000fe20: 6175 7365 206f 6620 6120 627a 6970 3220  ause of a bzip2 
-0000fe30: 6465 636f 6465 7220 6275 672e 5c6e 220a  decoder bug.\n".
-0000fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe50: 2020 2020 2250 6c65 6173 6520 6465 6c65      "Please dele
-0000fe60: 7465 2074 6865 2069 6e64 6578 206f 7220  te the index or 
-0000fe70: 6361 6c6c 2072 6174 6172 6d6f 756e 7420  call ratarmount 
-0000fe80: 7769 7468 2074 6865 202d 2d72 6563 7265  with the --recre
-0000fe90: 6174 652d 696e 6465 7820 6f70 7469 6f6e  ate-index option
-0000fea0: 2122 0a20 2020 2020 2020 2020 2020 2020  !".             
-0000feb0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0000fec0: 2020 2320 4368 6563 6b20 666f 7220 656d    # Check for em
-0000fed0: 7074 7920 6f72 2069 6e63 6f6d 706c 6574  pty or incomplet
-0000fee0: 6520 696e 6465 7865 732e 2050 7265 7474  e indexes. Prett
-0000fef0: 7920 7361 6665 2074 6f20 7265 6275 696c  y safe to rebuil
-0000ff00: 6420 7468 6520 696e 6465 7820 666f 7220  d the index for 
-0000ff10: 7468 6573 6520 6173 2074 6865 790a 2020  these as they.  
-0000ff20: 2020 2020 2020 2020 2020 2320 6172 6520            # are 
-0000ff30: 736f 2069 6e76 616c 6964 2c20 6e6f 6f6e  so invalid, noon
-0000ff40: 6520 7368 6f75 6c64 206d 6973 7320 7468  e should miss th
-0000ff50: 656d 2e20 536f 2c20 7265 6372 6561 7465  em. So, recreate
-0000ff60: 2069 6e64 6578 2062 7920 6465 6661 756c   index by defaul
-0000ff70: 7420 666f 7220 7468 6573 6520 6361 7365  t for these case
-0000ff80: 732e 0a20 2020 2020 2020 2020 2020 2069  s..            i
-0000ff90: 6620 2766 696c 6573 2720 6e6f 7420 696e  f 'files' not in
-0000ffa0: 2074 6162 6c65 733a 0a20 2020 2020 2020   tables:.       
-0000ffb0: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-0000ffc0: 6e76 616c 6964 496e 6465 7845 7272 6f72  nvalidIndexError
-0000ffd0: 2822 5351 4c69 7465 2069 6e64 6578 2069  ("SQLite index i
-0000ffe0: 7320 656d 7074 7922 290a 0a20 2020 2020  s empty")..     
-0000fff0: 2020 2020 2020 2069 6620 2766 696c 6573         if 'files
-00010000: 746d 7027 2069 6e20 7461 626c 6573 206f  tmp' in tables o
-00010010: 7220 2770 6172 656e 7466 6f6c 6465 7273  r 'parentfolders
-00010020: 2720 696e 2074 6162 6c65 733a 0a20 2020  ' in tables:.   
-00010030: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00010040: 7365 2049 6e76 616c 6964 496e 6465 7845  se InvalidIndexE
-00010050: 7272 6f72 2822 5351 4c69 7465 2069 6e64  rror("SQLite ind
-00010060: 6578 2069 7320 696e 636f 6d70 6c65 7465  ex is incomplete
-00010070: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-00010080: 2320 4368 6563 6b20 666f 7220 7072 652d  # Check for pre-
-00010090: 7370 6172 7365 2073 7570 706f 7274 2069  sparse support i
-000100a0: 6e64 6578 6573 0a20 2020 2020 2020 2020  ndexes.         
-000100b0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-000100c0: 2020 2020 2020 2020 2776 6572 7369 6f6e          'version
-000100d0: 7327 206e 6f74 2069 6e20 7461 626c 6573  s' not in tables
-000100e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000100f0: 206f 7220 2769 6e64 6578 2720 6e6f 7420   or 'index' not 
-00010100: 696e 2076 6572 7369 6f6e 730a 2020 2020  in versions.    
-00010110: 2020 2020 2020 2020 2020 2020 6f72 206c              or l
-00010120: 656e 2876 6572 7369 6f6e 735b 2769 6e64  en(versions['ind
-00010130: 6578 275d 2920 3c20 320a 2020 2020 2020  ex']) < 2.      
-00010140: 2020 2020 2020 2020 2020 6f72 2076 6572            or ver
-00010150: 7369 6f6e 735b 2769 6e64 6578 275d 5b31  sions['index'][1
-00010160: 5d20 3c20 320a 2020 2020 2020 2020 2020  ] < 2.          
-00010170: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00010180: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
-00010190: 6e69 6e67 5d20 5468 6520 666f 756e 6420  ning] The found 
-000101a0: 6f75 7464 6174 6564 2069 6e64 6578 2064  outdated index d
-000101b0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
-000101c0: 616e 7920 7370 6172 7365 2066 696c 6520  any sparse file 
-000101d0: 696e 666f 726d 6174 696f 6e2e 2229 0a20  information."). 
-000101e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000101f0: 7269 6e74 2822 5b57 6172 6e69 6e67 5d20  rint("[Warning] 
-00010200: 5468 6520 696e 6465 7820 7769 6c6c 2061  The index will a
-00010210: 6c73 6f20 6d69 7373 2064 6174 6120 6162  lso miss data ab
-00010220: 6f75 7420 6d75 6c74 6970 6c65 2076 6572  out multiple ver
-00010230: 7369 6f6e 7320 6f66 2061 2066 696c 652e  sions of a file.
-00010240: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00010250: 2020 2070 7269 6e74 2822 5b57 6172 6e69     print("[Warni
-00010260: 6e67 5d20 506c 6561 7365 2072 6563 7265  ng] Please recre
-00010270: 6174 6520 7468 6520 696e 6465 7820 6966  ate the index if
-00010280: 2079 6f75 2068 6176 6520 7072 6f62 6c65   you have proble
-00010290: 6d73 2077 6974 6820 7468 6f73 652e 2229  ms with those.")
-000102a0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000102b0: 2027 6d65 7461 6461 7461 2720 696e 2074   'metadata' in t
-000102c0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-000102d0: 2020 2020 2020 206d 6574 6164 6174 6120         metadata 
-000102e0: 3d20 6469 6374 2873 656c 662e 7371 6c43  = dict(self.sqlC
-000102f0: 6f6e 6e65 6374 696f 6e2e 6578 6563 7574  onnection.execut
-00010300: 6528 2753 454c 4543 5420 2a20 4652 4f4d  e('SELECT * FROM
-00010310: 206d 6574 6164 6174 613b 2729 290a 0a20   metadata;')).. 
-00010320: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00010330: 6620 2774 6172 7374 6174 7327 2069 6e20  f 'tarstats' in 
-00010340: 6d65 7461 6461 7461 3a0a 2020 2020 2020  metadata:.      
-00010350: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00010360: 6c75 6573 203d 206a 736f 6e2e 6c6f 6164  lues = json.load
-00010370: 7328 6d65 7461 6461 7461 5b27 7461 7273  s(metadata['tars
-00010380: 7461 7473 275d 290a 2020 2020 2020 2020  tats']).        
-00010390: 2020 2020 2020 2020 2020 2020 7461 7253              tarS
-000103a0: 7461 7473 203d 206f 732e 7374 6174 2873  tats = os.stat(s
-000103b0: 656c 662e 7461 7246 696c 654e 616d 6529  elf.tarFileName)
-000103c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000103d0: 2020 2020 2020 2320 666d 743a 206f 6666        # fmt: off
-000103e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000103f0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010410: 2020 6861 7361 7474 7228 2074 6172 5374    hasattr( tarSt
-00010420: 6174 732c 2022 7374 5f73 697a 6522 2029  ats, "st_size" )
-00010430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010440: 2020 2020 2020 2020 2061 6e64 2027 7374           and 'st
-00010450: 5f73 697a 6527 2069 6e20 7661 6c75 6573  _size' in values
-00010460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010470: 2020 2020 2020 2020 2061 6e64 2074 6172           and tar
-00010480: 5374 6174 732e 7374 5f73 697a 6520 213d  Stats.st_size !=
-00010490: 2076 616c 7565 735b 2773 745f 7369 7a65   values['st_size
-000104a0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-000104b0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-000104c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104d0: 2020 7261 6973 6520 496e 7661 6c69 6449    raise InvalidI
-000104e0: 6e64 6578 4572 726f 7228 2022 5441 5220  ndexError( "TAR 
-000104f0: 6669 6c65 2066 6f72 2074 6869 7320 5351  file for this SQ
-00010500: 4c69 7465 2069 6e64 6578 2068 6173 2063  Lite index has c
-00010510: 6861 6e67 6564 2073 697a 6520 6672 6f6d  hanged size from
-00010520: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010550: 2020 2020 7661 6c75 6573 5b27 7374 5f73      values['st_s
-00010560: 697a 6527 5d2c 2022 746f 222c 2074 6172  ize'], "to", tar
-00010570: 5374 6174 732e 7374 5f73 697a 6529 0a20  Stats.st_size). 
-00010580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010590: 2020 2023 2066 6d74 3a20 6f6e 0a0a 2020     # fmt: on..  
-000105a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105b0: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000105d0: 656c 662e 7665 7269 6679 4d6f 6469 6669  elf.verifyModifi
-000105e0: 6361 7469 6f6e 5469 6d65 0a20 2020 2020  cationTime.     
-000105f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010600: 2020 2061 6e64 2068 6173 6174 7472 2874     and hasattr(t
-00010610: 6172 5374 6174 732c 2022 7374 5f6d 7469  arStats, "st_mti
-00010620: 6d65 2229 0a20 2020 2020 2020 2020 2020  me").           
-00010630: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00010640: 2027 7374 5f6d 7469 6d65 2720 696e 2076   'st_mtime' in v
-00010650: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
-00010660: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00010670: 6420 7461 7253 7461 7473 2e73 745f 6d74  d tarStats.st_mt
-00010680: 696d 6520 213d 2076 616c 7565 735b 2773  ime != values['s
-00010690: 745f 6d74 696d 6527 5d0a 2020 2020 2020  t_mtime'].      
-000106a0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
-000106b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000106c0: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-000106d0: 6e76 616c 6964 496e 6465 7845 7272 6f72  nvalidIndexError
-000106e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000106f0: 2020 2020 2020 2020 2020 2020 2020 2254                "T
-00010700: 6865 206d 6f64 6966 6963 6174 696f 6e20  he modification 
-00010710: 6461 7465 2066 6f72 2074 6865 2054 4152  date for the TAR
-00010720: 2066 696c 6522 2c0a 2020 2020 2020 2020   file",.        
-00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010740: 2020 2020 7661 6c75 6573 5b27 7374 5f6d      values['st_m
-00010750: 7469 6d65 275d 2c0a 2020 2020 2020 2020  time'],.        
-00010760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010770: 2020 2020 2274 6f20 7468 6973 2053 514c      "to this SQL
-00010780: 6974 6520 696e 6465 7820 6861 7320 6368  ite index has ch
-00010790: 616e 6765 6420 2822 202b 2073 7472 2874  anged (" + str(t
-000107a0: 6172 5374 6174 732e 7374 5f6d 7469 6d65  arStats.st_mtime
-000107b0: 2920 2b20 2229 222c 0a20 2020 2020 2020  ) + ")",.       
+0000bc70: 202c 2020 2320 340a 2020 2020 2020 2020   ,  # 4.        
+0000bc80: 2020 2020 2020 2020 7461 7249 6e66 6f2e          tarInfo.
+0000bc90: 7374 5f6d 7469 6d65 2069 6620 7461 7249  st_mtime if tarI
+0000bca0: 6e66 6f20 656c 7365 2030 2020 202c 2020  nfo else 0   ,  
+0000bcb0: 2320 350a 2020 2020 2020 2020 2020 2020  # 5.            
+0000bcc0: 2020 2020 7461 7249 6e66 6f2e 7374 5f6d      tarInfo.st_m
+0000bcd0: 6f64 6520 6966 2074 6172 496e 666f 2065  ode if tarInfo e
+0000bce0: 6c73 6520 6d6f 6465 202c 2020 2320 360a  lse mode ,  # 6.
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd00: 4e6f 6e65 2020 2020 2020 2020 2020 2020  None            
+0000bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd20: 2020 2020 202c 2020 2320 3720 5441 5220       ,  # 7 TAR 
+0000bd30: 6669 6c65 2074 7970 652e 2043 7572 7265  file type. Curre
+0000bd40: 6e74 6c79 2075 6e75 7365 642e 204f 7665  ntly unused. Ove
+0000bd50: 726c 6170 7320 7769 7468 206d 6f64 650a  rlaps with mode.
+0000bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd70: 4e6f 6e65 2020 2020 2020 2020 2020 2020  None            
+0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd90: 2020 2020 202c 2020 2320 3820 6c69 6e6b       ,  # 8 link
+0000bda0: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+0000bdb0: 2020 2020 2074 6172 496e 666f 2e73 745f       tarInfo.st_
+0000bdc0: 7569 6420 6966 2074 6172 496e 666f 2065  uid if tarInfo e
+0000bdd0: 6c73 6520 3020 2020 2020 2c20 2023 2039  lse 0     ,  # 9
+0000bde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bdf0: 2074 6172 496e 666f 2e73 745f 6769 6420   tarInfo.st_gid 
+0000be00: 6966 2074 6172 496e 666f 2065 6c73 6520  if tarInfo else 
+0000be10: 3020 2020 2020 2c20 2023 2031 300a 2020  0     ,  # 10.  
+0000be20: 2020 2020 2020 2020 2020 2020 2020 4661                Fa
+0000be30: 6c73 6520 2020 2020 2020 2020 2020 2020  lse             
+0000be40: 202c 2020 2320 3131 2069 7354 6172 0a20   ,  # 11 isTar. 
+0000be50: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+0000be60: 616c 7365 2020 2020 2020 2020 2020 2020  alse            
+0000be70: 2020 2c20 2023 2031 3220 6973 5370 6172    ,  # 12 isSpar
+0000be80: 7365 2c20 646f 6e27 7420 6361 7265 2069  se, don't care i
+0000be90: 6620 6974 2069 7320 6163 7475 616c 6c79  f it is actually
+0000bea0: 2073 7061 7273 6520 6f72 206e 6f74 2062   sparse or not b
+0000beb0: 6563 6175 7365 2069 7420 6973 206e 6f74  ecause it is not
+0000bec0: 2069 6e20 5441 520a 2020 2020 2020 2020   in TAR.        
+0000bed0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000bee0: 2020 2320 666d 743a 206f 6e0a 2020 2020    # fmt: on.    
+0000bef0: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0000bf00: 7446 696c 6549 6e66 6f28 6669 6c65 496e  tFileInfo(fileIn
+0000bf10: 666f 290a 0a20 2020 2020 2020 2023 2041  fo)..        # A
+0000bf20: 6c6c 2074 6865 2063 6f64 6520 6265 6c6f  ll the code belo
+0000bf30: 7720 6973 2066 6f72 2064 6174 6162 6173  w is for databas
+0000bf40: 6520 6669 6e61 6c69 7a69 6e67 2077 6869  e finalizing whi
+0000bf50: 6368 2073 686f 756c 6420 6e6f 7420 6265  ch should not be
+0000bf60: 2064 6f6e 6520 696e 2061 2072 6563 7572   done in a recur
+0000bf70: 7369 7665 2063 616c 6c20 6f66 2063 7265  sive call of cre
+0000bf80: 6174 6549 6e64 6578 210a 2020 2020 2020  ateIndex!.      
+0000bf90: 2020 6966 206e 6f74 206f 7065 6e65 6443    if not openedC
+0000bfa0: 6f6e 6e65 6374 696f 6e3a 0a20 2020 2020  onnection:.     
+0000bfb0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+0000bfc0: 2020 2020 2020 2023 2035 2e20 5265 736f         # 5. Reso
+0000bfd0: 7274 2062 7920 2870 6174 682c 6e61 6d65  rt by (path,name
+0000bfe0: 292e 2054 6869 7320 6f6e 652d 7469 6d65  ). This one-time
+0000bff0: 2072 6573 6f72 7420 6973 2066 6173 7465   resort is faste
+0000c000: 7220 7468 616e 2072 6573 6f72 7469 6e67  r than resorting
+0000c010: 206f 6e20 6561 6368 2049 4e53 4552 5420   on each INSERT 
+0000c020: 2863 6163 6865 2073 7069 6c6c 290a 2020  (cache spill).  
+0000c030: 2020 2020 2020 6966 2070 7269 6e74 4465        if printDe
+0000c040: 6275 6720 3e3d 2032 3a0a 2020 2020 2020  bug >= 2:.      
+0000c050: 2020 2020 2020 7072 696e 7428 2252 6573        print("Res
+0000c060: 6f72 7469 6e67 2066 696c 6573 2062 7920  orting files by 
+0000c070: 7061 7468 202e 2e2e 2229 0a0a 2020 2020  path ...")..    
+0000c080: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000c090: 2020 2020 2071 7565 7269 6564 4c69 6253       queriedLibS
+0000c0a0: 716c 6974 6556 6572 7369 6f6e 203d 2073  qliteVersion = s
+0000c0b0: 716c 6974 6533 2e63 6f6e 6e65 6374 2822  qlite3.connect("
+0000c0c0: 3a6d 656d 6f72 793a 2229 2e65 7865 6375  :memory:").execu
+0000c0d0: 7465 2822 7365 6c65 6374 2073 716c 6974  te("select sqlit
+0000c0e0: 655f 7665 7273 696f 6e28 293b 2229 2e66  e_version();").f
+0000c0f0: 6574 6368 6f6e 6528 290a 2020 2020 2020  etchone().      
+0000c100: 2020 2020 2020 6c69 6253 716c 6974 6556        libSqliteV
+0000c110: 6572 7369 6f6e 203d 2074 7570 6c65 2869  ersion = tuple(i
+0000c120: 6e74 2878 2920 666f 7220 7820 696e 2071  nt(x) for x in q
+0000c130: 7565 7269 6564 4c69 6253 716c 6974 6556  ueriedLibSqliteV
+0000c140: 6572 7369 6f6e 5b30 5d2e 7370 6c69 7428  ersion[0].split(
+0000c150: 272e 2729 290a 2020 2020 2020 2020 6578  '.')).        ex
+0000c160: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+0000c170: 2020 2020 2020 2020 2020 2020 6c69 6253              libS
+0000c180: 716c 6974 6556 6572 7369 6f6e 203d 2028  qliteVersion = (
+0000c190: 302c 2030 2c20 3029 0a0a 2020 2020 2020  0, 0, 0)..      
+0000c1a0: 2020 7365 6172 6368 4279 5475 706c 6520    searchByTuple 
+0000c1b0: 3d20 2222 2228 7061 7468 2c6e 616d 6529  = """(path,name)
+0000c1c0: 204e 4f54 2049 4e20 2820 5345 4c45 4354   NOT IN ( SELECT
+0000c1d0: 2070 6174 682c 6e61 6d65 2222 220a 2020   path,name""".  
+0000c1e0: 2020 2020 2020 7365 6172 6368 4279 436f        searchByCo
+0000c1f0: 6e63 6174 203d 2022 2222 7061 7468 207c  ncat = """path |
+0000c200: 7c20 222f 2220 7c7c 206e 616d 6520 4e4f  | "/" || name NO
+0000c210: 5420 494e 2028 2053 454c 4543 5420 7061  T IN ( SELECT pa
+0000c220: 7468 207c 7c20 222f 2220 7c7c 206e 616d  th || "/" || nam
+0000c230: 6522 2222 0a0a 2020 2020 2020 2020 636c  e"""..        cl
+0000c240: 6561 6e75 7044 6174 6162 6173 6520 3d20  eanupDatabase = 
+0000c250: 6622 2222 0a20 2020 2020 2020 2020 2020  f""".           
+0000c260: 2049 4e53 4552 5420 4f52 2052 4550 4c41   INSERT OR REPLA
+0000c270: 4345 2049 4e54 4f20 2266 696c 6573 2220  CE INTO "files" 
+0000c280: 5345 4c45 4354 202a 2046 524f 4d20 2266  SELECT * FROM "f
+0000c290: 696c 6573 746d 7022 204f 5244 4552 2042  ilestmp" ORDER B
+0000c2a0: 5920 2270 6174 6822 2c22 6e61 6d65 222c  Y "path","name",
+0000c2b0: 726f 7769 643b 0a20 2020 2020 2020 2020  rowid;.         
+0000c2c0: 2020 2044 524f 5020 5441 424c 4520 2266     DROP TABLE "f
+0000c2d0: 696c 6573 746d 7022 3b0a 2020 2020 2020  ilestmp";.      
+0000c2e0: 2020 2020 2020 494e 5345 5254 204f 5220        INSERT OR 
+0000c2f0: 4947 4e4f 5245 2049 4e54 4f20 2266 696c  IGNORE INTO "fil
+0000c300: 6573 220a 2020 2020 2020 2020 2020 2020  es".            
+0000c310: 2020 2020 2f2a 2070 6174 6820 6e61 6d65      /* path name
+0000c320: 206f 6666 7365 7468 6561 6465 7220 6f66   offsetheader of
+0000c330: 6673 6574 2073 697a 6520 6d74 696d 6520  fset size mtime 
+0000c340: 6d6f 6465 2074 7970 6520 6c69 6e6b 6e61  mode type linkna
+0000c350: 6d65 2075 6964 2067 6964 2069 7374 6172  me uid gid istar
+0000c360: 2069 7373 7061 7273 6520 2a2f 0a20 2020   issparse */.   
+0000c370: 2020 2020 2020 2020 2020 2020 2053 454c               SEL
+0000c380: 4543 5420 7061 7468 2c6e 616d 652c 6f66  ECT path,name,of
+0000c390: 6673 6574 6865 6164 6572 2c6f 6666 7365  fsetheader,offse
+0000c3a0: 742c 302c 302c 7b69 6e74 2830 6f35 3535  t,0,0,{int(0o555
+0000c3b0: 207c 2073 7461 742e 535f 4946 4449 5229   | stat.S_IFDIR)
+0000c3c0: 7d2c 7b69 6e74 2874 6172 6669 6c65 2e44  },{int(tarfile.D
+0000c3d0: 4952 5459 5045 297d 2c22 222c 302c 302c  IRTYPE)},"",0,0,
+0000c3e0: 302c 300a 2020 2020 2020 2020 2020 2020  0,0.            
+0000c3f0: 2020 2020 4652 4f4d 2022 7061 7265 6e74      FROM "parent
+0000c400: 666f 6c64 6572 7322 0a20 2020 2020 2020  folders".       
+0000c410: 2020 2020 2020 2020 2057 4845 5245 207b           WHERE {
+0000c420: 7365 6172 6368 4279 5475 706c 6520 6966  searchByTuple if
+0000c430: 206c 6962 5371 6c69 7465 5665 7273 696f   libSqliteVersio
+0000c440: 6e20 3e3d 2028 322c 3232 2c30 2920 656c  n >= (2,22,0) el
+0000c450: 7365 2073 6561 7263 6842 7943 6f6e 6361  se searchByConca
+0000c460: 747d 0a20 2020 2020 2020 2020 2020 2020  t}.             
+0000c470: 2020 2020 2020 2046 524f 4d20 2266 696c         FROM "fil
+0000c480: 6573 2220 5748 4552 4520 6d6f 6465 2026  es" WHERE mode &
+0000c490: 2028 3120 3c3c 2031 3429 2021 3d20 300a   (1 << 14) != 0.
+0000c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c4c0: 2020 4f52 4445 5220 4259 2022 7061 7468    ORDER BY "path
+0000c4d0: 222c 226e 616d 6522 3b0a 2020 2020 2020  ","name";.      
+0000c4e0: 2020 2020 2020 4452 4f50 2054 4142 4c45        DROP TABLE
+0000c4f0: 2022 7061 7265 6e74 666f 6c64 6572 7322   "parentfolders"
+0000c500: 3b0a 2020 2020 2020 2020 2020 2020 5052  ;.            PR
+0000c510: 4147 4d41 206f 7074 696d 697a 653b 0a20  AGMA optimize;. 
+0000c520: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000c530: 2020 2073 656c 662e 7371 6c43 6f6e 6e65     self.sqlConne
+0000c540: 6374 696f 6e2e 6578 6563 7574 6573 6372  ction.executescr
+0000c550: 6970 7428 636c 6561 6e75 7044 6174 6162  ipt(cleanupDatab
+0000c560: 6173 6529 0a0a 2020 2020 2020 2020 7365  ase)..        se
+0000c570: 6c66 2e73 716c 436f 6e6e 6563 7469 6f6e  lf.sqlConnection
+0000c580: 2e63 6f6d 6d69 7428 290a 0a20 2020 2020  .commit()..     
+0000c590: 2020 2074 3120 3d20 7469 6d65 7228 290a     t1 = timer().
+0000c5a0: 2020 2020 2020 2020 6966 2070 7269 6e74          if print
+0000c5b0: 4465 6275 6720 3e3d 2031 3a0a 2020 2020  Debug >= 1:.    
+0000c5c0: 2020 2020 2020 2020 7072 696e 7428 2243          print("C
+0000c5d0: 7265 6174 696e 6720 6f66 6673 6574 2064  reating offset d
+0000c5e0: 6963 7469 6f6e 6172 7920 666f 7222 2c20  ictionary for", 
+0000c5f0: 7365 6c66 2e74 6172 4669 6c65 4e61 6d65  self.tarFileName
+0000c600: 2c20 2274 6f6f 6b20 7b3a 2e32 667d 7322  , "took {:.2f}s"
+0000c610: 2e66 6f72 6d61 7428 7431 202d 2074 3029  .format(t1 - t0)
+0000c620: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
+0000c630: 7468 6f64 0a20 2020 2064 6566 205f 726f  thod.    def _ro
+0000c640: 7754 6f46 696c 6549 6e66 6f28 726f 773a  wToFileInfo(row:
+0000c650: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
+0000c660: 202d 3e20 4669 6c65 496e 666f 3a0a 2020   -> FileInfo:.  
+0000c670: 2020 2020 2020 7573 6572 4461 7461 203d        userData =
+0000c680: 2053 514c 6974 6549 6e64 6578 6564 5461   SQLiteIndexedTa
+0000c690: 7255 7365 7244 6174 6128 0a20 2020 2020  rUserData(.     
+0000c6a0: 2020 2020 2020 2023 2066 6d74 3a20 6f66         # fmt: of
+0000c6b0: 660a 2020 2020 2020 2020 2020 2020 6f66  f.            of
+0000c6c0: 6673 6574 2020 2020 2020 203d 2072 6f77  fset       = row
+0000c6d0: 5b27 6f66 6673 6574 275d 2c0a 2020 2020  ['offset'],.    
+0000c6e0: 2020 2020 2020 2020 6f66 6673 6574 6865          offsethe
+0000c6f0: 6164 6572 203d 2072 6f77 5b27 6f66 6673  ader = row['offs
+0000c700: 6574 6865 6164 6572 275d 2069 6620 276f  etheader'] if 'o
+0000c710: 6666 7365 7468 6561 6465 7227 2069 6e20  ffsetheader' in 
+0000c720: 726f 772e 6b65 7973 2829 2065 6c73 6520  row.keys() else 
+0000c730: 302c 0a20 2020 2020 2020 2020 2020 2069  0,.            i
+0000c740: 7374 6172 2020 2020 2020 2020 3d20 726f  star        = ro
+0000c750: 775b 2769 7374 6172 275d 2c0a 2020 2020  w['istar'],.    
+0000c760: 2020 2020 2020 2020 6973 7370 6172 7365          issparse
+0000c770: 2020 2020 203d 2072 6f77 5b27 6973 7370       = row['issp
+0000c780: 6172 7365 275d 2069 6620 2769 7373 7061  arse'] if 'isspa
+0000c790: 7273 6527 2069 6e20 726f 772e 6b65 7973  rse' in row.keys
+0000c7a0: 2829 2065 6c73 6520 4661 6c73 652c 0a20  () else False,. 
+0000c7b0: 2020 2020 2020 2020 2020 2023 2066 6d74             # fmt
+0000c7c0: 3a20 6f6e 0a20 2020 2020 2020 2029 0a0a  : on.        )..
+0000c7d0: 2020 2020 2020 2020 6669 6c65 496e 666f          fileInfo
+0000c7e0: 203d 2046 696c 6549 6e66 6f28 0a20 2020   = FileInfo(.   
+0000c7f0: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
+0000c800: 6f66 660a 2020 2020 2020 2020 2020 2020  off.            
+0000c810: 7369 7a65 2020 2020 203d 2072 6f77 5b27  size     = row['
+0000c820: 7369 7a65 275d 2c0a 2020 2020 2020 2020  size'],.        
+0000c830: 2020 2020 6d74 696d 6520 2020 203d 2072      mtime    = r
+0000c840: 6f77 5b27 6d74 696d 6527 5d2c 0a20 2020  ow['mtime'],.   
+0000c850: 2020 2020 2020 2020 206d 6f64 6520 2020           mode   
+0000c860: 2020 3d20 726f 775b 276d 6f64 6527 5d2c    = row['mode'],
+0000c870: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
+0000c880: 6b6e 616d 6520 3d20 726f 775b 276c 696e  kname = row['lin
+0000c890: 6b6e 616d 6527 5d2c 0a20 2020 2020 2020  kname'],.       
+0000c8a0: 2020 2020 2075 6964 2020 2020 2020 3d20       uid      = 
+0000c8b0: 726f 775b 2775 6964 275d 2c0a 2020 2020  row['uid'],.    
+0000c8c0: 2020 2020 2020 2020 6769 6420 2020 2020          gid     
+0000c8d0: 203d 2072 6f77 5b27 6769 6427 5d2c 0a20   = row['gid'],. 
+0000c8e0: 2020 2020 2020 2020 2020 2075 7365 7264             userd
+0000c8f0: 6174 6120 3d20 5b75 7365 7244 6174 615d  ata = [userData]
+0000c900: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
+0000c910: 666d 743a 206f 6e0a 2020 2020 2020 2020  fmt: on.        
+0000c920: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000c930: 6e20 6669 6c65 496e 666f 0a0a 2020 2020  n fileInfo..    
+0000c940: 406f 7665 7272 6964 6573 284d 6f75 6e74  @overrides(Mount
+0000c950: 536f 7572 6365 290a 2020 2020 6465 6620  Source).    def 
+0000c960: 6765 7446 696c 6549 6e66 6f28 7365 6c66  getFileInfo(self
+0000c970: 2c20 7061 7468 3a20 7374 722c 2066 696c  , path: str, fil
+0000c980: 6556 6572 7369 6f6e 3a20 696e 7420 3d20  eVersion: int = 
+0000c990: 3029 202d 3e20 4f70 7469 6f6e 616c 5b46  0) -> Optional[F
+0000c9a0: 696c 6549 6e66 6f5d 3a0a 2020 2020 2020  ileInfo]:.      
+0000c9b0: 2020 6669 6c65 496e 666f 203d 2073 656c    fileInfo = sel
+0000c9c0: 662e 5f67 6574 4669 6c65 496e 666f 2870  f._getFileInfo(p
+0000c9d0: 6174 682c 2066 696c 6556 6572 7369 6f6e  ath, fileVersion
+0000c9e0: 3d66 696c 6556 6572 7369 6f6e 290a 0a20  =fileVersion).. 
+0000c9f0: 2020 2020 2020 2069 6620 6669 6c65 496e         if fileIn
+0000ca00: 666f 2069 7320 4e6f 6e65 3a0a 2020 2020  fo is None:.    
+0000ca10: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000ca20: 6f6e 650a 0a20 2020 2020 2020 2061 7373  one..        ass
+0000ca30: 6572 7420 6973 696e 7374 616e 6365 2866  ert isinstance(f
+0000ca40: 696c 6549 6e66 6f2c 2046 696c 6549 6e66  ileInfo, FileInf
+0000ca50: 6f29 0a20 2020 2020 2020 2072 6574 7572  o).        retur
+0000ca60: 6e20 6669 6c65 496e 666f 0a0a 2020 2020  n fileInfo..    
+0000ca70: 6465 6620 5f67 6574 4669 6c65 496e 666f  def _getFileInfo
+0000ca80: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000ca90: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
+0000caa0: 6666 0a20 2020 2020 2020 2066 756c 6c50  ff.        fullP
+0000cab0: 6174 6820 2020 2020 3a20 7374 722c 0a20  ath     : str,. 
+0000cac0: 2020 2020 2020 206c 6973 7444 6972 2020         listDir  
+0000cad0: 2020 2020 3a20 626f 6f6c 203d 2046 616c      : bool = Fal
+0000cae0: 7365 2c0a 2020 2020 2020 2020 6c69 7374  se,.        list
+0000caf0: 5665 7273 696f 6e73 203a 2062 6f6f 6c20  Versions : bool 
+0000cb00: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0000cb10: 2066 696c 6556 6572 7369 6f6e 2020 3a20   fileVersion  : 
+0000cb20: 696e 7420 203d 2030 0a20 2020 2020 2020  int  = 0.       
+0000cb30: 2023 2066 6d74 3a20 6f6e 0a20 2020 2029   # fmt: on.    )
+0000cb40: 202d 3e20 4f70 7469 6f6e 616c 5b55 6e69   -> Optional[Uni
+0000cb50: 6f6e 5b46 696c 6549 6e66 6f2c 2044 6963  on[FileInfo, Dic
+0000cb60: 745b 7374 722c 2046 696c 6549 6e66 6f5d  t[str, FileInfo]
+0000cb70: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
+0000cb80: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+0000cb90: 7468 6520 6865 6172 7420 6f66 2074 6869  the heart of thi
+0000cba0: 7320 636c 6173 7327 2070 7562 6c69 6320  s class' public 
+0000cbb0: 696e 7465 7266 6163 6521 0a0a 2020 2020  interface!..    
+0000cbc0: 2020 2020 7061 7468 2020 2020 3a20 6675      path    : fu
+0000cbd0: 6c6c 2070 6174 6820 746f 2066 696c 6520  ll path to file 
+0000cbe0: 7768 6572 6520 272f 2720 6465 6e6f 7465  where '/' denote
+0000cbf0: 7320 5441 5227 7320 726f 6f74 2c20 652e  s TAR's root, e.
+0000cc00: 672e 2c20 272f 272c 206f 7220 272f 666f  g., '/', or '/fo
+0000cc10: 6f27 0a20 2020 2020 2020 206c 6973 7444  o'.        listD
+0000cc20: 6972 203a 2069 6620 5472 7565 2c20 7265  ir : if True, re
+0000cc30: 7475 726e 2061 2064 6963 7469 6f6e 6172  turn a dictionar
+0000cc40: 7920 666f 7220 7468 6520 6769 7665 6e20  y for the given 
+0000cc50: 6469 7265 6374 6f72 7920 7061 7468 3a20  directory path: 
+0000cc60: 7b20 6669 6c65 4e61 6d65 203a 2046 696c  { fileName : Fil
+0000cc70: 6549 6e66 6f2c 202e 2e2e 207d 0a20 2020  eInfo, ... }.   
+0000cc80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cc90: 6620 4661 6c73 652c 2072 6574 7572 6e20  f False, return 
+0000cca0: 7369 6d70 6c65 2046 696c 6549 6e66 6f20  simple FileInfo 
+0000ccb0: 746f 2067 6976 656e 2070 6174 6820 2864  to given path (d
+0000ccc0: 6972 6563 746f 7279 206f 7220 6669 6c65  irectory or file
+0000ccd0: 290a 2020 2020 2020 2020 6669 6c65 5665  ).        fileVe
+0000cce0: 7273 696f 6e20 3a20 4966 2074 6865 2054  rsion : If the T
+0000ccf0: 4152 2063 6f6e 7461 696e 7320 7468 6520  AR contains the 
+0000cd00: 7361 6d65 2066 696c 6520 7061 7468 206d  same file path m
+0000cd10: 756c 7469 706c 6520 7469 6d65 732c 2062  ultiple times, b
+0000cd20: 7920 6465 6661 756c 7420 6f6e 6c79 2074  y default only t
+0000cd30: 6865 206c 6173 7420 6f6e 6520 6973 2073  he last one is s
+0000cd40: 686f 776e 2e0a 2020 2020 2020 2020 2020  hown..          
+0000cd50: 2020 2020 2020 2020 2020 2020 4275 7420              But 
+0000cd60: 7769 7468 2074 6869 7320 6172 6775 6d65  with this argume
+0000cd70: 6e74 206f 7468 6572 2076 6572 7369 6f6e  nt other version
+0000cd80: 7320 6361 6e20 6265 2071 7565 7269 6564  s can be queried
+0000cd90: 2e20 5665 7273 696f 6e20 3120 6973 2074  . Version 1 is t
+0000cda0: 6865 206f 6c64 6573 7420 6f6e 652e 0a20  he oldest one.. 
+0000cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cdc0: 2020 2020 2056 6572 7369 6f6e 2030 2074       Version 0 t
+0000cdd0: 7261 6e73 6c61 7465 7320 746f 2074 6865  ranslates to the
+0000cde0: 206d 6f73 7420 7265 6365 6e74 206f 6e65   most recent one
+0000cdf0: 2066 6f72 2063 6f6d 7061 7469 6269 6c69   for compatibili
+0000ce00: 7479 2077 6974 6820 7461 7220 2d2d 6f63  ty with tar --oc
+0000ce10: 6375 7272 656e 6365 3d3c 6e75 6d62 6572  currence=<number
+0000ce20: 3e2e 0a20 2020 2020 2020 2020 2020 2020  >..             
+0000ce30: 2020 2020 2020 2020 2056 6572 7369 6f6e           Version
+0000ce40: 202d 3120 7472 616e 736c 6174 6573 2074   -1 translates t
+0000ce50: 6f20 7468 6520 7365 636f 6e64 206d 6f73  o the second mos
+0000ce60: 7420 7265 6365 6e74 2c20 616e 6420 736f  t recent, and so
+0000ce70: 206f 6e2e 0a20 2020 2020 2020 2020 2020   on..           
+0000ce80: 2020 2020 2020 2020 2020 2046 6f72 206c             For l
+0000ce90: 6973 7444 6972 3d54 7275 652c 2074 6865  istDir=True, the
+0000cea0: 2066 696c 6520 7665 7273 696f 6e20 6d61   file version ma
+0000ceb0: 6b65 7320 6e6f 2073 656e 7365 2061 6e64  kes no sense and
+0000cec0: 2069 7320 6967 6e6f 7265 6421 0a20 2020   is ignored!.   
+0000ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cee0: 2020 2053 6f2c 2065 7665 6e20 6966 2061     So, even if a
+0000cef0: 2066 6f6c 6465 7220 7761 7320 6f76 6572   folder was over
+0000cf00: 7772 6974 7465 6e20 6279 2061 2066 696c  written by a fil
+0000cf10: 652c 2077 6869 6368 2069 7320 616c 7265  e, which is alre
+0000cf20: 6164 7920 6e6f 7420 7765 6c6c 2073 7570  ady not well sup
+0000cf30: 706f 7274 6564 2062 7920 7461 722c 0a20  ported by tar,. 
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf50: 2020 2020 2074 6865 6e20 6c69 7374 4469       then listDi
+0000cf60: 7220 666f 7220 7468 6174 2070 6174 6820  r for that path 
+0000cf70: 7769 6c6c 2073 7469 6c6c 206c 6973 7420  will still list 
+0000cf80: 616c 6c20 636f 6e74 656e 7473 206f 6620  all contents of 
+0000cf90: 7468 6520 6f76 6572 7772 6974 7465 6e20  the overwritten 
+0000cfa0: 666f 6c64 6572 206f 7220 666f 6c64 6572  folder or folder
+0000cfb0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000cfc0: 2020 2020 2020 2020 206e 6f20 6d61 7474           no matt
+0000cfd0: 6572 2074 6865 2073 7065 6369 6669 6564  er the specified
+0000cfe0: 2076 6572 7369 6f6e 2e20 5468 6520 6669   version. The fi
+0000cff0: 6c65 2073 7973 7465 6d20 6c61 7965 7220  le system layer 
+0000d000: 6861 7320 746f 2074 616b 6520 6361 7265  has to take care
+0000d010: 2074 6861 7420 6120 6469 7265 6374 6f72   that a director
+0000d020: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0000d030: 2020 2020 2020 2020 6c69 7374 696e 6720          listing 
+0000d040: 6973 206e 6f74 2065 7665 6e20 7265 7175  is not even requ
+0000d050: 6574 6564 2069 6e20 7468 6520 6669 7273  eted in the firs
+0000d060: 7420 706c 6163 6520 6966 2069 7420 6973  t place if it is
+0000d070: 206e 6f74 2061 2064 6972 6563 746f 7279   not a directory
+0000d080: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d090: 2020 2020 2020 2020 4655 5345 2061 6c72          FUSE alr
+0000d0a0: 6561 6479 2064 6f65 7320 7468 6973 2062  eady does this b
+0000d0b0: 7920 6361 6c6c 696e 6720 6765 7461 7474  y calling getatt
+0000d0c0: 7220 666f 7220 616c 6c20 7061 7265 6e74  r for all parent
+0000d0d0: 2066 6f6c 6465 7273 2069 6e20 7468 6520   folders in the 
+0000d0e0: 7370 6563 6966 6965 6420 7061 7468 2066  specified path f
+0000d0f0: 6972 7374 2e0a 0a20 2020 2020 2020 2049  irst...        I
+0000d100: 6620 7061 7468 2064 6f65 7320 6e6f 7420  f path does not 
+0000d110: 6578 6973 742c 2061 6c77 6179 7320 7265  exist, always re
+0000d120: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
+0000d130: 2020 2049 6620 6c69 7374 5665 7273 696f     If listVersio
+0000d140: 6e73 2069 7320 7472 7565 2c20 7468 656e  ns is true, then
+0000d150: 2072 6574 7572 6e20 6d65 7461 6461 7461   return metadata
+0000d160: 2066 6f72 2061 6c6c 2076 6572 7369 6f6e   for all version
+0000d170: 7320 6f66 2061 2066 696c 6520 706f 7373  s of a file poss
+0000d180: 6962 6c79 2061 7070 6561 7269 6e67 206d  ibly appearing m
+0000d190: 6f72 6520 7468 616e 206f 6e63 650a 2020  ore than once.  
+0000d1a0: 2020 2020 2020 696e 2074 6865 2054 4152        in the TAR
+0000d1b0: 2061 7320 6120 6469 7265 6374 6f72 7920   as a directory 
+0000d1c0: 6469 6374 696f 6e61 7279 2e20 6c69 7374  dictionary. list
+0000d1d0: 4469 7220 7769 6c6c 2074 6865 6e20 6265  Dir will then be
+0000d1e0: 2069 676e 6f72 6564 210a 2020 2020 2020   ignored!.      
+0000d1f0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+0000d200: 544f 444f 2063 6163 6865 206c 6173 7420  TODO cache last 
+0000d210: 6c69 7374 4469 7220 6173 206d 6f73 7420  listDir as most 
+0000d220: 6f66 7465 6e20 6120 7374 6174 206f 7665  often a stat ove
+0000d230: 7220 616c 6c20 656e 7472 6965 7320 7769  r all entries wi
+0000d240: 6c6c 2073 6f6f 6e20 666f 6c6c 6f77 0a0a  ll soon follow..
+0000d250: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0000d260: 7369 6e73 7461 6e63 6528 6669 6c65 5665  sinstance(fileVe
+0000d270: 7273 696f 6e2c 2069 6e74 293a 0a20 2020  rsion, int):.   
+0000d280: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000d290: 7970 6545 7272 6f72 2822 5468 6520 7370  ypeError("The sp
+0000d2a0: 6563 6966 6965 6420 6669 6c65 2076 6572  ecified file ver
+0000d2b0: 7369 6f6e 206d 7573 7420 6265 2061 6e20  sion must be an 
+0000d2c0: 696e 7465 6765 7221 2229 0a20 2020 2020  integer!").     
+0000d2d0: 2020 2069 6620 6e6f 7420 7365 6c66 2e73     if not self.s
+0000d2e0: 716c 436f 6e6e 6563 7469 6f6e 3a0a 2020  qlConnection:.  
+0000d2f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000d300: 496e 6465 784e 6f74 4f70 656e 4572 726f  IndexNotOpenErro
+0000d310: 7228 2254 6869 7320 6d65 7468 6f64 2063  r("This method c
+0000d320: 616e 206e 6f74 2062 6520 6361 6c6c 6564  an not be called
+0000d330: 2077 6974 686f 7574 2061 6e20 6f70 656e   without an open
+0000d340: 6564 2069 6e64 6578 2064 6174 6162 6173  ed index databas
+0000d350: 6521 2229 0a0a 2020 2020 2020 2020 2320  e!")..        # 
+0000d360: 616c 736f 2073 7472 6970 7320 7472 6169  also strips trai
+0000d370: 6c69 6e67 2027 2f27 2065 7863 6570 7420  ling '/' except 
+0000d380: 666f 7220 6120 7369 6e67 6c65 2027 2f27  for a single '/'
+0000d390: 2061 6e64 206c 6561 6469 6e67 2027 2f27   and leading '/'
+0000d3a0: 0a20 2020 2020 2020 2066 756c 6c50 6174  .        fullPat
+0000d3b0: 6820 3d20 272f 2720 2b20 6f73 2e70 6174  h = '/' + os.pat
+0000d3c0: 682e 6e6f 726d 7061 7468 2866 756c 6c50  h.normpath(fullP
+0000d3d0: 6174 6829 2e6c 7374 7269 7028 272f 2729  ath).lstrip('/')
+0000d3e0: 0a0a 2020 2020 2020 2020 6966 206c 6973  ..        if lis
+0000d3f0: 7456 6572 7369 6f6e 733a 0a20 2020 2020  tVersions:.     
+0000d400: 2020 2020 2020 2070 6174 682c 206e 616d         path, nam
+0000d410: 6520 3d20 6675 6c6c 5061 7468 2e72 7370  e = fullPath.rsp
+0000d420: 6c69 7428 272f 272c 2031 290a 2020 2020  lit('/', 1).    
+0000d430: 2020 2020 2020 2020 726f 7773 203d 2073          rows = s
+0000d440: 656c 662e 7371 6c43 6f6e 6e65 6374 696f  elf.sqlConnectio
+0000d450: 6e2e 6578 6563 7574 6528 0a20 2020 2020  n.execute(.     
+0000d460: 2020 2020 2020 2020 2020 2027 5345 4c45             'SELE
+0000d470: 4354 202a 2046 524f 4d20 2266 696c 6573  CT * FROM "files
+0000d480: 2220 5748 4552 4520 2270 6174 6822 203d  " WHERE "path" =
+0000d490: 3d20 283f 2920 414e 4420 226e 616d 6522  = (?) AND "name"
+0000d4a0: 203d 3d20 283f 2920 4f52 4445 5220 4259   == (?) ORDER BY
+0000d4b0: 2022 6f66 6673 6574 6865 6164 6572 2220   "offsetheader" 
+0000d4c0: 4153 4327 2c20 2870 6174 682c 206e 616d  ASC', (path, nam
+0000d4d0: 6529 0a20 2020 2020 2020 2020 2020 2029  e).            )
+0000d4e0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000d4f0: 756c 7420 3d20 7b73 7472 2876 6572 7369  ult = {str(versi
+0000d500: 6f6e 202b 2031 293a 2073 656c 662e 5f72  on + 1): self._r
+0000d510: 6f77 546f 4669 6c65 496e 666f 2872 6f77  owToFileInfo(row
+0000d520: 2920 666f 7220 7665 7273 696f 6e2c 2072  ) for version, r
+0000d530: 6f77 2069 6e20 656e 756d 6572 6174 6528  ow in enumerate(
+0000d540: 726f 7773 297d 0a20 2020 2020 2020 2020  rows)}.         
+0000d550: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0000d560: 0a0a 2020 2020 2020 2020 6966 206c 6973  ..        if lis
+0000d570: 7444 6972 3a0a 2020 2020 2020 2020 2020  tDir:.          
+0000d580: 2020 2320 466f 7220 6c69 7374 696e 6720    # For listing 
+0000d590: 6469 7265 6374 6f72 7920 656e 7472 6965  directory entrie
+0000d5a0: 7320 7468 6520 6669 6c65 2076 6572 7369  s the file versi
+0000d5b0: 6f6e 2063 616e 2774 2062 6520 6170 706c  on can't be appl
+0000d5c0: 6965 6420 6d65 616e 696e 6766 756c 6c79  ied meaningfully
+0000d5d0: 2061 7420 7468 6973 2061 6273 7472 6163   at this abstrac
+0000d5e0: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
+0000d5f0: 2020 2020 2020 2020 2320 452e 672e 2c20          # E.g., 
+0000d600: 7368 6f75 6c64 2069 7420 6166 6665 6374  should it affect
+0000d610: 2074 6865 2066 696c 6520 7665 7273 696f   the file versio
+0000d620: 6e20 6f66 2074 6865 2064 6972 6563 746f  n of the directo
+0000d630: 7279 2074 6f20 6c69 7374 2c20 6f72 2073  ry to list, or s
+0000d640: 686f 756c 6420 6974 2077 6f72 6b20 6f6e  hould it work on
+0000d650: 2074 6865 206c 6973 7465 6420 6669 6c65   the listed file
+0000d660: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
+0000d670: 696e 7374 6561 6420 616e 6420 6966 2073  instead and if s
+0000d680: 6f20 686f 7720 6578 6163 746c 7920 6966  o how exactly if
+0000d690: 2074 6865 7265 2061 7265 6e27 7420 7468   there aren't th
+0000d6a0: 6520 7361 6d65 2076 6572 7369 6f6e 7320  e same versions 
+0000d6b0: 666f 7220 616c 6c20 6669 6c65 7320 6176  for all files av
+0000d6c0: 6169 6c61 626c 652c 202e 2e2e 3f0a 2020  ailable, ...?.  
+0000d6d0: 2020 2020 2020 2020 2020 2320 4f72 2c20            # Or, 
+0000d6e0: 6172 6520 666f 6c64 6572 7320 6173 7375  are folders assu
+0000d6f0: 6d65 6420 746f 2062 6520 6f76 6572 7772  med to be overwr
+0000d700: 6974 7465 6e20 6279 2061 206e 6577 2066  itten by a new f
+0000d710: 6f6c 6465 7220 656e 7472 7920 696e 2061  older entry in a
+0000d720: 2054 4152 206f 7220 7368 6f75 6c64 2074   TAR or should t
+0000d730: 6865 7920 6265 2075 6e69 6f6e 206d 6f75  hey be union mou
+0000d740: 6e74 6564 3f0a 2020 2020 2020 2020 2020  nted?.          
+0000d750: 2020 2320 4966 2074 6865 7920 7368 6f75    # If they shou
+0000d760: 6c64 2062 6520 756e 696f 6e20 6d6f 756e  ld be union moun
+0000d770: 7465 642c 206c 696b 6520 6973 2074 6865  ted, like is the
+0000d780: 2063 6173 6520 6e6f 772c 2074 6865 6e20   case now, then 
+0000d790: 7468 6520 666f 6c64 6572 2076 6572 7369  the folder versi
+0000d7a0: 6f6e 206f 6e6c 7920 6d61 6b65 7320 7365  on only makes se
+0000d7b0: 6e73 6520 666f 720a 2020 2020 2020 2020  nse for.        
+0000d7c0: 2020 2020 2320 6974 7320 6174 7472 6962      # its attrib
+0000d7d0: 7574 6573 2e0a 2020 2020 2020 2020 2020  utes..          
+0000d7e0: 2020 726f 7773 203d 2073 656c 662e 7371    rows = self.sq
+0000d7f0: 6c43 6f6e 6e65 6374 696f 6e2e 6578 6563  lConnection.exec
+0000d800: 7574 6528 2753 454c 4543 5420 2a20 4652  ute('SELECT * FR
+0000d810: 4f4d 2022 6669 6c65 7322 2057 4845 5245  OM "files" WHERE
+0000d820: 2022 7061 7468 2220 3d3d 2028 3f29 272c   "path" == (?)',
+0000d830: 2028 6675 6c6c 5061 7468 2e72 7374 7269   (fullPath.rstri
+0000d840: 7028 272f 2729 2c29 290a 2020 2020 2020  p('/'),)).      
+0000d850: 2020 2020 2020 6469 7265 6374 6f72 7920        directory 
+0000d860: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0000d870: 2067 6f74 5265 7375 6c74 7320 3d20 4661   gotResults = Fa
+0000d880: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000d890: 666f 7220 726f 7720 696e 2072 6f77 733a  for row in rows:
+0000d8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d8b0: 2067 6f74 5265 7375 6c74 7320 3d20 5472   gotResults = Tr
+0000d8c0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0000d8d0: 2020 2069 6620 726f 775b 276e 616d 6527     if row['name'
+0000d8e0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0000d8f0: 2020 2020 2020 2064 6972 6563 746f 7279         directory
+0000d900: 5b72 6f77 5b27 6e61 6d65 275d 5d20 3d20  [row['name']] = 
+0000d910: 7365 6c66 2e5f 726f 7754 6f46 696c 6549  self._rowToFileI
+0000d920: 6e66 6f28 726f 7729 0a20 2020 2020 2020  nfo(row).       
+0000d930: 2020 2020 2072 6574 7572 6e20 6469 7265       return dire
+0000d940: 6374 6f72 7920 6966 2067 6f74 5265 7375  ctory if gotResu
+0000d950: 6c74 7320 656c 7365 204e 6f6e 650a 0a20  lts else None.. 
+0000d960: 2020 2020 2020 2070 6174 682c 206e 616d         path, nam
+0000d970: 6520 3d20 6675 6c6c 5061 7468 2e72 7370  e = fullPath.rsp
+0000d980: 6c69 7428 272f 272c 2031 290a 2020 2020  lit('/', 1).    
+0000d990: 2020 2020 726f 7720 3d20 7365 6c66 2e73      row = self.s
+0000d9a0: 716c 436f 6e6e 6563 7469 6f6e 2e65 7865  qlConnection.exe
+0000d9b0: 6375 7465 280a 2020 2020 2020 2020 2020  cute(.          
+0000d9c0: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
+0000d9d0: 2020 5345 4c45 4354 202a 2046 524f 4d20    SELECT * FROM 
+0000d9e0: 2266 696c 6573 220a 2020 2020 2020 2020  "files".        
+0000d9f0: 2020 2020 5748 4552 4520 2270 6174 6822      WHERE "path"
+0000da00: 203d 3d20 283f 2920 414e 4420 226e 616d   == (?) AND "nam
+0000da10: 6522 203d 3d20 283f 290a 2020 2020 2020  e" == (?).      
+0000da20: 2020 2020 2020 4f52 4445 5220 4259 2022        ORDER BY "
+0000da30: 6f66 6673 6574 6865 6164 6572 2220 7b7d  offsetheader" {}
+0000da40: 0a20 2020 2020 2020 2020 2020 204c 494d  .            LIM
+0000da50: 4954 2031 204f 4646 5345 5420 283f 293b  IT 1 OFFSET (?);
+0000da60: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+0000da70: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
+0000da80: 2020 2020 2020 2020 2027 4445 5343 2720           'DESC' 
+0000da90: 6966 2066 696c 6556 6572 7369 6f6e 2069  if fileVersion i
+0000daa0: 7320 4e6f 6e65 206f 7220 6669 6c65 5665  s None or fileVe
+0000dab0: 7273 696f 6e20 3c3d 2030 2065 6c73 6520  rsion <= 0 else 
+0000dac0: 2741 5343 270a 2020 2020 2020 2020 2020  'ASC'.          
+0000dad0: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+0000dae0: 2028 7061 7468 2c20 6e61 6d65 2c20 3020   (path, name, 0 
+0000daf0: 6966 2066 696c 6556 6572 7369 6f6e 2069  if fileVersion i
+0000db00: 7320 4e6f 6e65 2065 6c73 6520 6669 6c65  s None else file
+0000db10: 5665 7273 696f 6e20 2d20 3120 6966 2066  Version - 1 if f
+0000db20: 696c 6556 6572 7369 6f6e 203e 2030 2065  ileVersion > 0 e
+0000db30: 6c73 6520 2d66 696c 6556 6572 7369 6f6e  lse -fileVersion
+0000db40: 292c 0a20 2020 2020 2020 2029 2e66 6574  ),.        ).fet
+0000db50: 6368 6f6e 6528 290a 2020 2020 2020 2020  chone().        
+0000db60: 7265 7475 726e 2073 656c 662e 5f72 6f77  return self._row
+0000db70: 546f 4669 6c65 496e 666f 2872 6f77 2920  ToFileInfo(row) 
+0000db80: 6966 2072 6f77 2065 6c73 6520 4e6f 6e65  if row else None
+0000db90: 0a0a 2020 2020 6465 6620 6973 4469 7228  ..    def isDir(
+0000dba0: 7365 6c66 2c20 7061 7468 3a20 7374 7229  self, path: str)
+0000dbb0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+0000dbc0: 2020 2222 2252 6574 7572 6e20 7472 7565    """Return true
+0000dbd0: 2069 6620 7061 7468 2065 7869 7374 7320   if path exists 
+0000dbe0: 616e 6420 6973 2061 2066 6f6c 6465 722e  and is a folder.
+0000dbf0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000dc00: 726e 2073 656c 662e 6c69 7374 4469 7228  rn self.listDir(
+0000dc10: 7061 7468 2920 6973 206e 6f74 204e 6f6e  path) is not Non
+0000dc20: 650a 0a20 2020 2040 6f76 6572 7269 6465  e..    @override
+0000dc30: 7328 4d6f 756e 7453 6f75 7263 6529 0a20  s(MountSource). 
+0000dc40: 2020 2064 6566 206c 6973 7444 6972 2873     def listDir(s
+0000dc50: 656c 662c 2070 6174 683a 2073 7472 2920  elf, path: str) 
+0000dc60: 2d3e 204f 7074 696f 6e61 6c5b 4974 6572  -> Optional[Iter
+0000dc70: 6162 6c65 5b73 7472 5d5d 3a0a 2020 2020  able[str]]:.    
+0000dc80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000dc90: 5573 6162 696c 6974 7920 7772 6170 7065  Usability wrappe
+0000dca0: 7220 666f 7220 6765 7446 696c 6549 6e66  r for getFileInf
+0000dcb0: 6f28 6c69 7374 4469 723d 5472 7565 2920  o(listDir=True) 
+0000dcc0: 7769 7468 2046 696c 6549 6e66 6f20 7374  with FileInfo st
+0000dcd0: 7269 7070 6564 2069 6620 796f 7520 6172  ripped if you ar
+0000dce0: 6520 7375 7265 2079 6f75 2064 6f6e 2774  e sure you don't
+0000dcf0: 206e 6565 6420 6974 2e0a 2020 2020 2020   need it..      
+0000dd00: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000dd10: 7375 6c74 203d 2073 656c 662e 5f67 6574  sult = self._get
+0000dd20: 4669 6c65 496e 666f 2870 6174 682c 206c  FileInfo(path, l
+0000dd30: 6973 7444 6972 3d54 7275 6529 0a20 2020  istDir=True).   
+0000dd40: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000dd50: 6365 2872 6573 756c 742c 2064 6963 7429  ce(result, dict)
+0000dd60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000dd70: 7475 726e 2072 6573 756c 742e 6b65 7973  turn result.keys
+0000dd80: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+0000dd90: 6e20 4e6f 6e65 0a0a 2020 2020 406f 7665  n None..    @ove
+0000dda0: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
+0000ddb0: 6365 290a 2020 2020 6465 6620 6669 6c65  ce).    def file
+0000ddc0: 5665 7273 696f 6e73 2873 656c 662c 2070  Versions(self, p
+0000ddd0: 6174 683a 2073 7472 2920 2d3e 2069 6e74  ath: str) -> int
+0000dde0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000ddf0: 2020 2020 2020 5573 6162 696c 6974 7920        Usability 
+0000de00: 7772 6170 7065 7220 666f 7220 6765 7446  wrapper for getF
+0000de10: 696c 6549 6e66 6f28 6c69 7374 5665 7273  ileInfo(listVers
+0000de20: 696f 6e73 3d54 7275 6529 2077 6974 6820  ions=True) with 
+0000de30: 4669 6c65 496e 666f 2073 7472 6970 7065  FileInfo strippe
+0000de40: 6420 6966 2079 6f75 2061 7265 2073 7572  d if you are sur
+0000de50: 6520 796f 7520 646f 6e27 7420 6e65 6564  e you don't need
+0000de60: 2069 742e 0a20 2020 2020 2020 2022 2222   it..        """
+0000de70: 0a20 2020 2020 2020 2066 696c 6556 6572  .        fileVer
+0000de80: 7369 6f6e 7320 3d20 7365 6c66 2e5f 6765  sions = self._ge
+0000de90: 7446 696c 6549 6e66 6f28 7061 7468 2c20  tFileInfo(path, 
+0000dea0: 6c69 7374 5665 7273 696f 6e73 3d54 7275  listVersions=Tru
+0000deb0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+0000dec0: 6e20 6c65 6e28 6669 6c65 5665 7273 696f  n len(fileVersio
+0000ded0: 6e73 2920 6966 2069 7369 6e73 7461 6e63  ns) if isinstanc
+0000dee0: 6528 6669 6c65 5665 7273 696f 6e73 2c20  e(fileVersions, 
+0000def0: 6469 6374 2920 656c 7365 2030 0a0a 2020  dict) else 0..  
+0000df00: 2020 406f 7665 7272 6964 6573 284d 6f75    @overrides(Mou
+0000df10: 6e74 536f 7572 6365 290a 2020 2020 6465  ntSource).    de
+0000df20: 6620 6f70 656e 2873 656c 662c 2066 696c  f open(self, fil
+0000df30: 6549 6e66 6f3a 2046 696c 6549 6e66 6f29  eInfo: FileInfo)
+0000df40: 202d 3e20 494f 5b62 7974 6573 5d3a 0a20   -> IO[bytes]:. 
+0000df50: 2020 2020 2020 2061 7373 6572 7420 6669         assert fi
+0000df60: 6c65 496e 666f 2e75 7365 7264 6174 610a  leInfo.userdata.
+0000df70: 2020 2020 2020 2020 7461 7246 696c 6549          tarFileI
+0000df80: 6e66 6f20 3d20 6669 6c65 496e 666f 2e75  nfo = fileInfo.u
+0000df90: 7365 7264 6174 615b 2d31 5d0a 2020 2020  serdata[-1].    
+0000dfa0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+0000dfb0: 7461 6e63 6528 7461 7246 696c 6549 6e66  tance(tarFileInf
+0000dfc0: 6f2c 2053 514c 6974 6549 6e64 6578 6564  o, SQLiteIndexed
+0000dfd0: 5461 7255 7365 7244 6174 6129 0a0a 2020  TarUserData)..  
+0000dfe0: 2020 2020 2020 2320 5468 6973 2069 7320        # This is 
+0000dff0: 6e6f 7420 7374 7269 6374 6c79 206e 6563  not strictly nec
+0000e000: 6573 7361 7279 2062 7574 2069 7420 7361  essary but it sa
+0000e010: 7665 7320 7477 6f20 6669 6c65 206f 626a  ves two file obj
+0000e020: 6563 7420 6c61 7965 7273 2061 6e64 2074  ect layers and t
+0000e030: 6865 7265 666f 7265 206d 6967 6874 2062  herefore might b
+0000e040: 6520 6d6f 7265 2070 6572 666f 726d 616e  e more performan
+0000e050: 742e 0a20 2020 2020 2020 2023 2046 7572  t..        # Fur
+0000e060: 7468 6572 6d6f 7265 2c20 6e6f 6e2d 7370  thermore, non-sp
+0000e070: 6172 7365 2066 696c 6573 2073 686f 756c  arse files shoul
+0000e080: 6420 6265 2074 6865 206d 7563 6820 6d6f  d be the much mo
+0000e090: 7265 206c 696b 656c 7920 6361 7365 2061  re likely case a
+0000e0a0: 6e79 7761 792e 0a20 2020 2020 2020 2069  nyway..        i
+0000e0b0: 6620 6e6f 7420 7461 7246 696c 6549 6e66  f not tarFileInf
+0000e0c0: 6f2e 6973 7370 6172 7365 3a0a 2020 2020  o.issparse:.    
+0000e0d0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000e0e0: 6173 7428 494f 5b62 7974 6573 5d2c 2053  ast(IO[bytes], S
+0000e0f0: 7465 6e63 696c 6564 4669 6c65 2873 656c  tenciledFile(sel
+0000e100: 662e 7461 7246 696c 654f 626a 6563 742c  f.tarFileObject,
+0000e110: 205b 2874 6172 4669 6c65 496e 666f 2e6f   [(tarFileInfo.o
+0000e120: 6666 7365 742c 2066 696c 6549 6e66 6f2e  ffset, fileInfo.
+0000e130: 7369 7a65 295d 2929 0a0a 2020 2020 2020  size)]))..      
+0000e140: 2020 2320 5468 6520 5441 5220 6669 6c65    # The TAR file
+0000e150: 2066 6f72 6d61 7420 6973 2076 6572 7920   format is very 
+0000e160: 7369 6d70 6c65 2e20 4974 2773 206a 7573  simple. It's jus
+0000e170: 7420 6120 636f 6e63 6174 656e 6174 696f  t a concatenatio
+0000e180: 6e20 6f66 2054 4152 2062 6c6f 636b 732e  n of TAR blocks.
+0000e190: 2054 6865 7265 2069 7320 6e6f 7420 6576   There is not ev
+0000e1a0: 656e 2061 0a20 2020 2020 2020 2023 2067  en a.        # g
+0000e1b0: 6c6f 6261 6c20 6865 6164 6572 2c20 6f6e  lobal header, on
+0000e1c0: 6c79 2074 6865 2054 4152 2062 6c6f 636b  ly the TAR block
+0000e1d0: 2068 6561 6465 7273 2e20 5468 6174 2773   headers. That's
+0000e1e0: 2077 6879 2077 6520 6361 6e20 7369 6d70   why we can simp
+0000e1f0: 6c79 2063 7574 206f 7574 2074 6865 2054  ly cut out the T
+0000e200: 4152 2062 6c6f 636b 2066 6f72 0a20 2020  AR block for.   
+0000e210: 2020 2020 2023 2074 6865 2073 7061 7273       # the spars
+0000e220: 6520 6669 6c65 2075 7369 6e67 2053 7465  e file using Ste
+0000e230: 6e63 696c 6564 4669 6c65 2061 6e64 2074  nciledFile and t
+0000e240: 6865 6e20 7573 6520 7461 7266 696c 6520  hen use tarfile 
+0000e250: 6f6e 2069 7420 746f 2065 7870 616e 6420  on it to expand 
+0000e260: 7468 6520 7370 6172 7365 2066 696c 6520  the sparse file 
+0000e270: 636f 7272 6563 746c 792e 0a20 2020 2020  correctly..     
+0000e280: 2020 2074 6172 426c 6f63 6b53 697a 6520     tarBlockSize 
+0000e290: 3d20 7461 7246 696c 6549 6e66 6f2e 6f66  = tarFileInfo.of
+0000e2a0: 6673 6574 202d 2074 6172 4669 6c65 496e  fset - tarFileIn
+0000e2b0: 666f 2e6f 6666 7365 7468 6561 6465 7220  fo.offsetheader 
+0000e2c0: 2b20 6669 6c65 496e 666f 2e73 697a 650a  + fileInfo.size.
+0000e2d0: 0a20 2020 2020 2020 2074 6172 5375 6246  .        tarSubF
+0000e2e0: 696c 6520 3d20 5374 656e 6369 6c65 6446  ile = StenciledF
+0000e2f0: 696c 6528 7365 6c66 2e74 6172 4669 6c65  ile(self.tarFile
+0000e300: 4f62 6a65 6374 2c20 5b28 7461 7246 696c  Object, [(tarFil
+0000e310: 6549 6e66 6f2e 6f66 6673 6574 6865 6164  eInfo.offsethead
+0000e320: 6572 2c20 7461 7242 6c6f 636b 5369 7a65  er, tarBlockSize
+0000e330: 295d 290a 2020 2020 2020 2020 2320 544f  )]).        # TO
+0000e340: 444f 2049 7420 6d69 6768 7420 6265 2062  DO It might be b
+0000e350: 6574 7465 7220 746f 2073 6f6d 6568 6f77  etter to somehow
+0000e360: 2063 616c 6c20 636c 6f73 6520 6f6e 2074   call close on t
+0000e370: 6172 4669 6c65 2062 7574 2074 6865 2071  arFile but the q
+0000e380: 7565 7374 696f 6e20 6973 2077 6865 7265  uestion is where
+0000e390: 2061 6e64 2068 6f77 2e0a 2020 2020 2020   and how..      
+0000e3a0: 2020 2320 2020 2020 2049 7420 776f 756c    #      It woul
+0000e3b0: 6420 6861 7665 2074 6f20 6265 2061 7070  d have to be app
+0000e3c0: 656e 6465 6420 746f 2074 6865 205f 5f65  ended to the __e
+0000e3d0: 7869 745f 5f20 6d65 7468 6f64 206f 6620  xit__ method of 
+0000e3e0: 6669 6c65 4f62 6a65 6374 206c 696b 6520  fileObject like 
+0000e3f0: 6966 2062 6569 6e67 2064 6563 6f72 6174  if being decorat
+0000e400: 6564 2e0a 2020 2020 2020 2020 2320 2020  ed..        #   
+0000e410: 2020 2046 6f72 206e 6f77 2074 6869 7320     For now this 
+0000e420: 7365 656d 7320 746f 2077 6f72 6b20 6569  seems to work ei
+0000e430: 7468 6572 2062 6563 6175 7365 2066 696c  ther because fil
+0000e440: 654f 626a 6563 7420 646f 6573 206e 6f74  eObject does not
+0000e450: 2072 6571 7569 7265 2074 6172 4669 6c65   require tarFile
+0000e460: 2074 6f20 6578 6973 740a 2020 2020 2020   to exist.      
+0000e470: 2020 2320 2020 2020 206f 7220 6265 6361    #      or beca
+0000e480: 7573 6520 7461 7246 696c 6520 6973 2073  use tarFile is s
+0000e490: 696d 706c 7920 6e6f 7420 636c 6f73 6564  imply not closed
+0000e4a0: 2063 6f72 7265 6374 6c79 2068 6572 652c   correctly here,
+0000e4b0: 2049 276d 206e 6f74 2073 7572 652e 0a20   I'm not sure.. 
+0000e4c0: 2020 2020 2020 2023 2020 2020 2020 5370         #      Sp
+0000e4d0: 6172 7365 2066 696c 6573 2061 7265 206b  arse files are k
+0000e4e0: 696e 6461 2065 6467 652d 6361 7365 7320  inda edge-cases 
+0000e4f0: 616e 7977 6179 2c20 736f 2069 7420 6973  anyway, so it is
+0000e500: 6e27 7420 6869 6768 2070 7269 6f72 6974  n't high priorit
+0000e510: 7920 6173 206c 6f6e 6720 6173 2074 6865  y as long as the
+0000e520: 2074 6573 7473 2077 6f72 6b2e 0a20 2020   tests work..   
+0000e530: 2020 2020 2074 6172 4669 6c65 203d 2074       tarFile = t
+0000e540: 6172 6669 6c65 2e6f 7065 6e28 6669 6c65  arfile.open(file
+0000e550: 6f62 6a3d 7479 7069 6e67 2e63 6173 7428  obj=typing.cast(
+0000e560: 494f 5b62 7974 6573 5d2c 2074 6172 5375  IO[bytes], tarSu
+0000e570: 6246 696c 6529 2c20 6d6f 6465 3d27 723a  bFile), mode='r:
+0000e580: 272c 2065 6e63 6f64 696e 673d 7365 6c66  ', encoding=self
+0000e590: 2e65 6e63 6f64 696e 6729 0a20 2020 2020  .encoding).     
+0000e5a0: 2020 2066 696c 654f 626a 6563 7420 3d20     fileObject = 
+0000e5b0: 7461 7246 696c 652e 6578 7472 6163 7466  tarFile.extractf
+0000e5c0: 696c 6528 6e65 7874 2869 7465 7228 7461  ile(next(iter(ta
+0000e5d0: 7246 696c 6529 2929 0a20 2020 2020 2020  rFile))).       
+0000e5e0: 2069 6620 6e6f 7420 6669 6c65 4f62 6a65   if not fileObje
+0000e5f0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+0000e600: 7072 696e 7428 2274 6172 6669 6c65 2e65  print("tarfile.e
+0000e610: 7874 7261 6374 6669 6c65 2072 6574 7572  xtractfile retur
+0000e620: 6e65 6420 6e6f 7468 696e 6721 2229 0a20  ned nothing!"). 
+0000e630: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e640: 2066 7573 652e 4675 7365 4f53 4572 726f   fuse.FuseOSErro
+0000e650: 7228 6675 7365 2e65 7272 6e6f 2e45 494f  r(fuse.errno.EIO
+0000e660: 2920 6966 2022 6675 7365 2220 696e 2073  ) if "fuse" in s
+0000e670: 7973 2e6d 6f64 756c 6573 2065 6c73 6520  ys.modules else 
+0000e680: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
+0000e690: 2020 2020 2020 2020 2020 2022 7461 7266             "tarf
+0000e6a0: 696c 652e 6578 7472 6163 7466 696c 6520  ile.extractfile 
+0000e6b0: 7265 7475 726e 6564 206e 6f74 6869 6e67  returned nothing
+0000e6c0: 2122 0a20 2020 2020 2020 2020 2020 2029  !".            )
+0000e6d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000e6e0: 2066 696c 654f 626a 6563 740a 0a20 2020   fileObject..   
+0000e6f0: 2040 6f76 6572 7269 6465 7328 4d6f 756e   @overrides(Moun
+0000e700: 7453 6f75 7263 6529 0a20 2020 2064 6566  tSource).    def
+0000e710: 2072 6561 6428 7365 6c66 2c20 6669 6c65   read(self, file
+0000e720: 496e 666f 3a20 4669 6c65 496e 666f 2c20  Info: FileInfo, 
+0000e730: 7369 7a65 3a20 696e 742c 206f 6666 7365  size: int, offse
+0000e740: 743a 2069 6e74 2920 2d3e 2062 7974 6573  t: int) -> bytes
+0000e750: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
+0000e760: 2066 696c 6549 6e66 6f2e 7573 6572 6461   fileInfo.userda
+0000e770: 7461 0a20 2020 2020 2020 2074 6172 4669  ta.        tarFi
+0000e780: 6c65 496e 666f 203d 2066 696c 6549 6e66  leInfo = fileInf
+0000e790: 6f2e 7573 6572 6461 7461 5b2d 315d 0a20  o.userdata[-1]. 
+0000e7a0: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+0000e7b0: 696e 7374 616e 6365 2874 6172 4669 6c65  instance(tarFile
+0000e7c0: 496e 666f 2c20 5351 4c69 7465 496e 6465  Info, SQLiteInde
+0000e7d0: 7865 6454 6172 5573 6572 4461 7461 290a  xedTarUserData).
+0000e7e0: 0a20 2020 2020 2020 2069 6620 7461 7246  .        if tarF
+0000e7f0: 696c 6549 6e66 6f2e 6973 7370 6172 7365  ileInfo.issparse
+0000e800: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+0000e810: 7468 2073 656c 662e 6f70 656e 2866 696c  th self.open(fil
+0000e820: 6549 6e66 6f29 2061 7320 6669 6c65 3a0a  eInfo) as file:.
+0000e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e840: 6669 6c65 2e73 6565 6b28 6f66 6673 6574  file.seek(offset
+0000e850: 2c20 6f73 2e53 4545 4b5f 5345 5429 0a20  , os.SEEK_SET). 
+0000e860: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e870: 6574 7572 6e20 6669 6c65 2e72 6561 6428  eturn file.read(
+0000e880: 7369 7a65 290a 0a20 2020 2020 2020 2023  size)..        #
+0000e890: 2046 6f72 206e 6f6e 2d73 7061 7273 6520   For non-sparse 
+0000e8a0: 6669 6c65 732c 2077 6520 6361 6e20 7369  files, we can si
+0000e8b0: 6d70 6c79 2073 6565 6b20 746f 2074 6865  mply seek to the
+0000e8c0: 206f 6666 7365 7420 616e 6420 7265 6164   offset and read
+0000e8d0: 2066 726f 6d20 6974 2e0a 2020 2020 2020   from it..      
+0000e8e0: 2020 7365 6c66 2e74 6172 4669 6c65 4f62    self.tarFileOb
+0000e8f0: 6a65 6374 2e73 6565 6b28 7461 7246 696c  ject.seek(tarFil
+0000e900: 6549 6e66 6f2e 6f66 6673 6574 202b 206f  eInfo.offset + o
+0000e910: 6666 7365 742c 206f 732e 5345 454b 5f53  ffset, os.SEEK_S
+0000e920: 4554 290a 2020 2020 2020 2020 7265 7475  ET).        retu
+0000e930: 726e 2073 656c 662e 7461 7246 696c 654f  rn self.tarFileO
+0000e940: 626a 6563 742e 7265 6164 2873 697a 6529  bject.read(size)
+0000e950: 0a0a 2020 2020 6465 6620 5f74 7279 4164  ..    def _tryAd
+0000e960: 6450 6172 656e 7446 6f6c 6465 7273 2873  dParentFolders(s
+0000e970: 656c 662c 2070 6174 683a 2073 7472 2c20  elf, path: str, 
+0000e980: 6f66 6673 6574 6865 6164 6572 3a20 696e  offsetheader: in
+0000e990: 742c 206f 6666 7365 743a 2069 6e74 2920  t, offset: int) 
+0000e9a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000e9b0: 2023 2041 6464 2070 6172 656e 7420 666f   # Add parent fo
+0000e9c0: 6c64 6572 7320 6966 2074 6865 7920 646f  lders if they do
+0000e9d0: 206e 6f74 2065 7869 7374 2e0a 2020 2020   not exist..    
+0000e9e0: 2020 2020 2320 452e 672e 3a20 7061 7468      # E.g.: path
+0000e9f0: 203d 2027 2f61 2f62 2f63 2720 2d3e 2070   = '/a/b/c' -> p
+0000ea00: 6174 6873 203d 205b 2827 272c 2027 6127  aths = [('', 'a'
+0000ea10: 292c 2028 272f 6127 2c20 2762 2729 2c20  ), ('/a', 'b'), 
+0000ea20: 2827 2f61 2f62 272c 2027 6327 295d 0a20  ('/a/b', 'c')]. 
+0000ea30: 2020 2020 2020 2023 2057 6974 686f 7574         # Without
+0000ea40: 2074 6865 2070 6172 656e 7446 6f6c 6465   the parentFolde
+0000ea50: 7243 6163 6865 2c20 7468 6520 6164 6469  rCache, the addi
+0000ea60: 7469 6f6e 616c 2049 4e53 4552 5420 7374  tional INSERT st
+0000ea70: 6174 656d 656e 7473 2069 6e63 7265 6173  atements increas
+0000ea80: 6520 7468 6520 6372 6561 7469 6f6e 2074  e the creation t
+0000ea90: 696d 650a 2020 2020 2020 2020 2320 6672  ime.        # fr
+0000eaa0: 6f6d 2038 2e35 7320 746f 2031 3273 2c20  om 8.5s to 12s, 
+0000eab0: 736f 2061 6c6d 6f73 7420 3530 2520 736c  so almost 50% sl
+0000eac0: 6f77 646f 776e 2066 6f72 2074 6865 2038  owdown for the 8
+0000ead0: 4d69 4220 7465 7374 2054 4152 210a 2020  MiB test TAR!.  
+0000eae0: 2020 2020 2020 7061 7468 5061 7274 7320        pathParts 
+0000eaf0: 3d20 7061 7468 2e73 706c 6974 2822 2f22  = path.split("/"
+0000eb00: 290a 2020 2020 2020 2020 7061 7468 7320  ).        paths 
+0000eb10: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0000eb20: 700a 2020 2020 2020 2020 2020 2020 2320  p.            # 
+0000eb30: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
+0000eb40: 2020 2020 2066 6f72 2070 2069 6e20 280a       for p in (.
+0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb60: 2820 222f 222e 6a6f 696e 2820 7061 7468  ( "/".join( path
+0000eb70: 5061 7274 735b 3a69 5d20 292c 2070 6174  Parts[:i] ), pat
+0000eb80: 6850 6172 7473 5b69 5d20 290a 2020 2020  hParts[i] ).    
+0000eb90: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000eba0: 6920 696e 2072 616e 6765 2820 312c 206c  i in range( 1, l
+0000ebb0: 656e 2820 7061 7468 5061 7274 7320 2920  en( pathParts ) 
+0000ebc0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0000ebd0: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
+0000ebe0: 743a 206f 6e0a 2020 2020 2020 2020 2020  t: on.          
+0000ebf0: 2020 6966 2070 206e 6f74 2069 6e20 7365    if p not in se
+0000ec00: 6c66 2e70 6172 656e 7446 6f6c 6465 7243  lf.parentFolderC
+0000ec10: 6163 6865 0a20 2020 2020 2020 205d 0a20  ache.        ]. 
+0000ec20: 2020 2020 2020 2069 6620 6e6f 7420 7061         if not pa
+0000ec30: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+0000ec40: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+0000ec50: 2073 656c 662e 7061 7265 6e74 466f 6c64   self.parentFold
+0000ec60: 6572 4361 6368 6520 2b3d 2070 6174 6873  erCache += paths
+0000ec70: 0a20 2020 2020 2020 2023 2041 7373 756d  .        # Assum
+0000ec80: 696e 6720 6669 6c65 7320 696e 2074 6865  ing files in the
+0000ec90: 2054 4152 2061 7265 2073 6f72 7465 6420   TAR are sorted 
+0000eca0: 6279 2068 6965 7261 7263 6879 2c20 7468  by hierarchy, th
+0000ecb0: 6520 6d61 7869 6d75 6d20 7061 7265 6e74  e maximum parent
+0000ecc0: 2066 6f6c 6465 7220 6361 6368 6520 7369   folder cache si
+0000ecd0: 7a65 0a20 2020 2020 2020 2023 2067 6976  ze.        # giv
+0000ece0: 6573 2074 6865 206d 6178 696d 756d 2063  es the maximum c
+0000ecf0: 6163 6865 6162 6c65 2066 696c 6520 6e65  acheable file ne
+0000ed00: 7374 696e 6720 6465 7074 682e 2048 6967  sting depth. Hig
+0000ed10: 6820 6e75 6d62 6572 7320 6c65 6164 2074  h numbers lead t
+0000ed20: 6f20 6869 6768 6572 206d 656d 6f72 7920  o higher memory 
+0000ed30: 7573 6167 6520 616e 6420 6c6f 6f6b 7570  usage and lookup
+0000ed40: 2074 696d 6573 2e0a 2020 2020 2020 2020   times..        
+0000ed50: 6966 206c 656e 2873 656c 662e 7061 7265  if len(self.pare
+0000ed60: 6e74 466f 6c64 6572 4361 6368 6529 203e  ntFolderCache) >
+0000ed70: 2031 363a 0a20 2020 2020 2020 2020 2020   16:.           
+0000ed80: 2073 656c 662e 7061 7265 6e74 466f 6c64   self.parentFold
+0000ed90: 6572 4361 6368 6520 3d20 7365 6c66 2e70  erCache = self.p
+0000eda0: 6172 656e 7446 6f6c 6465 7243 6163 6865  arentFolderCache
+0000edb0: 5b2d 383a 5d0a 0a20 2020 2020 2020 2069  [-8:]..        i
+0000edc0: 6620 6e6f 7420 7365 6c66 2e73 716c 436f  f not self.sqlCo
+0000edd0: 6e6e 6563 7469 6f6e 3a0a 2020 2020 2020  nnection:.      
+0000ede0: 2020 2020 2020 7261 6973 6520 496e 6465        raise Inde
+0000edf0: 784e 6f74 4f70 656e 4572 726f 7228 2254  xNotOpenError("T
+0000ee00: 6869 7320 6d65 7468 6f64 2063 616e 206e  his method can n
+0000ee10: 6f74 2062 6520 6361 6c6c 6564 2077 6974  ot be called wit
+0000ee20: 686f 7574 2061 6e20 6f70 656e 6564 2069  hout an opened i
+0000ee30: 6e64 6578 2064 6174 6162 6173 6521 2229  ndex database!")
+0000ee40: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+0000ee50: 2054 6869 7320 6d65 7468 6f64 2069 7320   This method is 
+0000ee60: 7374 696c 6c20 6e6f 7420 7065 7266 6563  still not perfec
+0000ee70: 7420 6275 7420 4920 646f 206e 6f74 206b  t but I do not k
+0000ee80: 6e6f 7720 686f 7720 746f 2070 6572 6665  now how to perfe
+0000ee90: 6374 2069 7420 7769 7468 6f75 7420 6c6f  ct it without lo
+0000eea0: 6f73 696e 6720 7369 676e 6966 6963 616e  osing significan
+0000eeb0: 740a 2020 2020 2020 2020 2320 2020 2020  t.        #     
+0000eec0: 2070 6572 666f 726d 616e 6365 2e20 4375   performance. Cu
+0000eed0: 7272 656e 746c 792c 2061 6464 696e 6720  rrently, adding 
+0000eee0: 696d 706c 6963 6974 2066 6f6c 6465 7273  implicit folders
+0000eef0: 2077 696c 6c20 6661 696c 2077 6865 6e20   will fail when 
+0000ef00: 6120 6669 6c65 2069 7320 6f76 6572 7772  a file is overwr
+0000ef10: 6974 7465 6e20 696d 706c 6963 6974 6c79  itten implicitly
+0000ef20: 2077 6974 680a 2020 2020 2020 2020 2320   with.        # 
+0000ef30: 2020 2020 2061 2066 6f6c 6465 7220 616e       a folder an
+0000ef40: 6420 7468 656e 206f 7665 7277 7269 7474  d then overwritt
+0000ef50: 656e 2062 7920 6120 6669 6c65 2061 6e64  en by a file and
+0000ef60: 2074 6865 6e20 6167 6169 6e20 6f76 6572   then again over
+0000ef70: 7772 6974 7465 6e20 6279 2061 2066 6f6c  written by a fol
+0000ef80: 6465 722e 2042 6563 6175 7365 2074 6865  der. Because the
+0000ef90: 2070 6172 656e 740a 2020 2020 2020 2020   parent.        
+0000efa0: 2320 2020 2020 2066 6f6c 6465 7277 6173  #      folderwas
+0000efb0: 2061 6c72 6561 6479 2061 6464 6564 2069   already added i
+0000efc0: 6d70 6c69 6369 746c 7920 7468 6520 6669  mplicitly the fi
+0000efd0: 7273 7420 7469 6d65 2c20 7468 6520 7365  rst time, the se
+0000efe0: 636f 6e64 2074 696d 6520 7769 6c6c 2062  cond time will b
+0000eff0: 6520 736b 6970 7065 642e 0a20 2020 2020  e skipped..     
+0000f000: 2020 2023 2020 2020 2020 546f 2073 6f6c     #      To sol
+0000f010: 7665 2074 6869 732c 2049 2077 6f75 6c64  ve this, I would
+0000f020: 2068 6176 6520 746f 2061 6464 2061 6c6c   have to add all
+0000f030: 2070 6172 656e 7420 666f 6c64 6572 7320   parent folders 
+0000f040: 666f 7220 616c 6c20 6669 6c65 732c 2077  for all files, w
+0000f050: 6869 6368 206d 6967 6874 2065 6173 696c  hich might easil
+0000f060: 7920 6578 706c 6f64 650a 2020 2020 2020  y explode.      
+0000f070: 2020 2320 2020 2020 2074 6865 2074 656d    #      the tem
+0000f080: 706f 7261 7279 2064 6174 6162 6173 6520  porary database 
+0000f090: 616e 6420 7468 6520 696e 6465 7869 6e67  and the indexing
+0000f0a0: 2070 6572 666f 726d 616e 6365 2062 7920   performance by 
+0000f0b0: 7468 6520 666f 6c64 6572 2064 6570 7468  the folder depth
+0000f0c0: 2e0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+0000f0d0: 2041 6c73 6f2c 2049 2064 6f20 6e6f 7420   Also, I do not 
+0000f0e0: 7761 6e74 2074 6f20 6164 6420 7665 7273  want to add vers
+0000f0f0: 696f 6e73 2066 6f72 2061 2070 6172 656e  ions for a paren
+0000f100: 7420 666f 6c64 6572 2066 6f72 2065 6163  t folder for eac
+0000f110: 6820 696d 706c 6963 6974 6c79 2061 6464  h implicitly add
+0000f120: 6564 2070 6172 656e 7420 666f 6c64 6572  ed parent folder
+0000f130: 2066 6f72 0a20 2020 2020 2020 2023 2020   for.        #  
+0000f140: 2020 2020 6561 6368 2066 696c 652c 2073      each file, s
+0000f150: 6f20 4920 776f 756c 6420 6861 7665 2074  o I would have t
+0000f160: 6f20 736f 7274 206f 7574 2074 686f 7365  o sort out those
+0000f170: 2069 6e20 6120 706f 7374 2d70 726f 6365   in a post-proce
+0000f180: 7373 696e 6720 7374 6570 2e20 452e 672e  ssing step. E.g.
+0000f190: 2c20 736f 7274 2062 7920 6f66 6673 6574  , sort by offset
+0000f1a0: 6865 6164 6572 0a20 2020 2020 2020 2023  header.        #
+0000f1b0: 2020 2020 2020 616e 6420 7468 656e 2063        and then c
+0000f1c0: 6c65 616e 206f 7574 2073 7563 6365 7373  lean out success
+0000f1d0: 6976 6520 696d 706c 6963 6974 6c79 2061  ive implicitly a
+0000f1e0: 6464 6564 2066 6f6c 6465 7273 2061 7320  dded folders as 
+0000f1f0: 6c6f 6e67 2061 7320 7468 6572 6520 6973  long as there is
+0000f200: 206e 6f20 6669 6c65 206f 6620 7468 6520   no file of the 
+0000f210: 7361 6d65 206e 616d 650a 2020 2020 2020  same name.      
+0000f220: 2020 2320 2020 2020 2069 6e62 6574 7765    #      inbetwe
+0000f230: 656e 2e0a 2020 2020 2020 2020 2320 2020  en..        #   
+0000f240: 2020 2054 6865 2075 6e6d 656e 7469 6f6e     The unmention
+0000f250: 6564 2061 6c74 6572 6e61 7469 7665 2077  ed alternative w
+0000f260: 6f75 6c64 2062 6520 746f 206c 6f6f 6b75  ould be to looku
+0000f270: 7020 7061 7468 7320 7769 7468 204c 494b  p paths with LIK
+0000f280: 4520 6275 7420 7468 6174 2069 7320 6a75  E but that is ju
+0000f290: 7374 206d 6164 6e65 7373 2062 6563 6175  st madness becau
+0000f2a0: 7365 2069 740a 2020 2020 2020 2020 2320  se it.        # 
+0000f2b0: 2020 2020 2077 696c 6c20 6861 7665 2061       will have a
+0000f2c0: 2077 6f72 7365 2063 6f6d 706c 6578 6974   worse complexit
+0000f2d0: 7920 6f66 204f 284e 2920 696e 7374 6564  y of O(N) insted
+0000f2e0: 6120 6f66 204f 286c 6f67 284e 2929 2e0a  a of O(log(N))..
+0000f2f0: 2020 2020 2020 2020 7365 6c66 2e73 716c          self.sql
+0000f300: 436f 6e6e 6563 7469 6f6e 2e65 7865 6375  Connection.execu
+0000f310: 7465 6d61 6e79 280a 2020 2020 2020 2020  temany(.        
+0000f320: 2020 2020 2749 4e53 4552 5420 4f52 2049      'INSERT OR I
+0000f330: 474e 4f52 4520 494e 544f 2022 7061 7265  GNORE INTO "pare
+0000f340: 6e74 666f 6c64 6572 7322 2056 414c 5545  ntfolders" VALUE
+0000f350: 5320 283f 2c3f 2c3f 2c3f 2927 2c0a 2020  S (?,?,?,?)',.  
+0000f360: 2020 2020 2020 2020 2020 5b28 705b 305d            [(p[0]
+0000f370: 2c20 705b 315d 2c20 6f66 6673 6574 6865  , p[1], offsethe
+0000f380: 6164 6572 2c20 6f66 6673 6574 2920 666f  ader, offset) fo
+0000f390: 7220 7020 696e 2070 6174 6873 5d2c 0a20  r p in paths],. 
+0000f3a0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000f3b0: 6620 5f73 6574 4669 6c65 496e 666f 2873  f _setFileInfo(s
+0000f3c0: 656c 662c 2072 6f77 3a20 7475 706c 6529  elf, row: tuple)
+0000f3d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000f3e0: 2020 6966 206e 6f74 2073 656c 662e 7371    if not self.sq
+0000f3f0: 6c43 6f6e 6e65 6374 696f 6e3a 0a20 2020  lConnection:.   
+0000f400: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
+0000f410: 6e64 6578 4e6f 744f 7065 6e45 7272 6f72  ndexNotOpenError
+0000f420: 2822 5468 6973 206d 6574 686f 6420 6361  ("This method ca
+0000f430: 6e20 6e6f 7420 6265 2063 616c 6c65 6420  n not be called 
+0000f440: 7769 7468 6f75 7420 616e 206f 7065 6e65  without an opene
+0000f450: 6420 696e 6465 7820 6461 7461 6261 7365  d index database
+0000f460: 2122 290a 0a20 2020 2020 2020 2074 7279  !")..        try
+0000f470: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000f480: 6c66 2e73 716c 436f 6e6e 6563 7469 6f6e  lf.sqlConnection
+0000f490: 2e65 7865 6375 7465 2827 494e 5345 5254  .execute('INSERT
+0000f4a0: 204f 5220 5245 504c 4143 4520 494e 544f   OR REPLACE INTO
+0000f4b0: 2022 6669 6c65 7322 2056 414c 5545 5320   "files" VALUES 
+0000f4c0: 2827 202b 2027 2c27 2e6a 6f69 6e28 273f  (' + ','.join('?
+0000f4d0: 2720 2a20 6c65 6e28 726f 7729 2920 2b20  ' * len(row)) + 
+0000f4e0: 2729 3b27 2c20 726f 7729 0a20 2020 2020  ');', row).     
+0000f4f0: 2020 2065 7863 6570 7420 556e 6963 6f64     except Unicod
+0000f500: 6545 6e63 6f64 6545 7272 6f72 3a0a 2020  eEncodeError:.  
+0000f510: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000f520: 225b 5761 726e 696e 675d 2050 726f 626c  "[Warning] Probl
+0000f530: 656d 2063 6175 7365 6420 6279 2066 696c  em caused by fil
+0000f540: 6520 6e61 6d65 2065 6e63 6f64 696e 6720  e name encoding 
+0000f550: 7768 656e 2074 7279 696e 6720 746f 2069  when trying to i
+0000f560: 6e73 6572 7420 7468 6973 2072 6f77 3a22  nsert this row:"
+0000f570: 2c20 726f 7729 0a20 2020 2020 2020 2020  , row).         
+0000f580: 2020 2070 7269 6e74 2822 5b57 6172 6e69     print("[Warni
+0000f590: 6e67 5d20 5468 6520 6669 6c65 206e 616d  ng] The file nam
+0000f5a0: 6520 7769 6c6c 206e 6f77 2062 6520 7374  e will now be st
+0000f5b0: 6f72 6564 2077 6974 6820 7468 6520 6261  ored with the ba
+0000f5c0: 6420 6368 6172 6163 7465 7220 6265 696e  d character bein
+0000f5d0: 6720 6573 6361 7065 6422 290a 2020 2020  g escaped").    
+0000f5e0: 2020 2020 2020 2020 7072 696e 7428 225b          print("[
+0000f5f0: 5761 726e 696e 675d 2069 6e73 7465 6164  Warning] instead
+0000f600: 206f 6620 6265 696e 6720 636f 7272 6563   of being correc
+0000f610: 746c 7920 696e 7465 7270 7265 7465 642e  tly interpreted.
+0000f620: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+0000f630: 7269 6e74 2822 5b57 6172 6e69 6e67 5d20  rint("[Warning] 
+0000f640: 506c 6561 7365 2073 7065 6369 6679 2061  Please specify a
+0000f650: 2073 7569 7461 626c 6520 6669 6c65 206e   suitable file n
+0000f660: 616d 6520 656e 636f 6469 6e67 2075 7369  ame encoding usi
+0000f670: 6e67 2c20 652e 672e 2c20 2d2d 656e 636f  ng, e.g., --enco
+0000f680: 6469 6e67 2069 736f 2d38 3835 392d 3121  ding iso-8859-1!
+0000f690: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+0000f6a0: 7269 6e74 2822 5b57 6172 6e69 6e67 5d20  rint("[Warning] 
+0000f6b0: 4120 6c69 7374 206f 6620 706f 7373 6962  A list of possib
+0000f6c0: 6c65 2065 6e63 6f64 696e 6773 2063 616e  le encodings can
+0000f6d0: 2062 6520 666f 756e 6420 6865 7265 3a22   be found here:"
+0000f6e0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0000f6f0: 696e 7428 225b 5761 726e 696e 675d 2068  int("[Warning] h
+0000f700: 7474 7073 3a2f 2f64 6f63 732e 7079 7468  ttps://docs.pyth
+0000f710: 6f6e 2e6f 7267 2f33 2f6c 6962 7261 7279  on.org/3/library
+0000f720: 2f63 6f64 6563 732e 6874 6d6c 2373 7461  /codecs.html#sta
+0000f730: 6e64 6172 642d 656e 636f 6469 6e67 7322  ndard-encodings"
+0000f740: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
+0000f750: 6865 636b 6564 526f 7720 3d20 5b5d 0a20  heckedRow = []. 
+0000f760: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
+0000f770: 2069 6e20 6c69 7374 2872 6f77 293a 2020   in list(row):  
+0000f780: 2320 6368 6563 6b20 7374 7269 6e67 730a  # check strings.
+0000f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7a0: 6966 2069 7369 6e73 7461 6e63 6528 782c  if isinstance(x,
+0000f7b0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+0000f7c0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7e0: 2020 2020 2020 2020 782e 656e 636f 6465          x.encode
+0000f7f0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000f800: 2020 2020 2020 2020 2020 2063 6865 636b             check
+0000f810: 6564 526f 7720 2b3d 205b 785d 0a20 2020  edRow += [x].   
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f830: 2065 7863 6570 7420 556e 6963 6f64 6545   except UnicodeE
+0000f840: 6e63 6f64 6545 7272 6f72 3a0a 2020 2020  ncodeError:.    
+0000f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f860: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
+0000f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f880: 2020 2020 2020 2063 6865 636b 6564 526f         checkedRo
+0000f890: 7720 2b3d 205b 0a20 2020 2020 2020 2020  w += [.         
+0000f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8b0: 2020 2078 2e65 6e63 6f64 6528 2073 656c     x.encode( sel
+0000f8c0: 662e 656e 636f 6469 6e67 2c20 2773 7572  f.encoding, 'sur
+0000f8d0: 726f 6761 7465 6573 6361 7065 2720 290a  rogateescape' ).
+0000f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8f0: 2020 2020 2020 2020 2020 2020 202e 6465               .de
+0000f900: 636f 6465 2820 7365 6c66 2e65 6e63 6f64  code( self.encod
+0000f910: 696e 672c 2027 6261 636b 736c 6173 6872  ing, 'backslashr
+0000f920: 6570 6c61 6365 2720 290a 2020 2020 2020  eplace' ).      
+0000f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f940: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0000f950: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+0000f960: 6d74 3a20 6f6e 0a20 2020 2020 2020 2020  mt: on.         
+0000f970: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f990: 2063 6865 636b 6564 526f 7720 2b3d 205b   checkedRow += [
+0000f9a0: 785d 0a0a 2020 2020 2020 2020 2020 2020  x]..            
+0000f9b0: 7365 6c66 2e73 716c 436f 6e6e 6563 7469  self.sqlConnecti
+0000f9c0: 6f6e 2e65 7865 6375 7465 280a 2020 2020  on.execute(.    
+0000f9d0: 2020 2020 2020 2020 2020 2020 2749 4e53              'INS
+0000f9e0: 4552 5420 4f52 2052 4550 4c41 4345 2049  ERT OR REPLACE I
+0000f9f0: 4e54 4f20 2266 696c 6573 2220 5641 4c55  NTO "files" VALU
+0000fa00: 4553 2028 2720 2b20 272c 272e 6a6f 696e  ES (' + ','.join
+0000fa10: 2827 3f27 202a 206c 656e 2872 6f77 2929  ('?' * len(row))
+0000fa20: 202b 2027 293b 272c 2074 7570 6c65 2863   + ');', tuple(c
+0000fa30: 6865 636b 6564 526f 7729 0a20 2020 2020  heckedRow).     
+0000fa40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000fa50: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
+0000fa60: 6e69 6e67 5d20 5468 6520 6573 6361 7065  ning] The escape
+0000fa70: 6420 696e 7365 7274 6564 2072 6f77 2069  d inserted row i
+0000fa80: 7320 6e6f 773a 222c 2072 6f77 290a 2020  s now:", row).  
+0000fa90: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000faa0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000fab0: 5f74 7279 4164 6450 6172 656e 7446 6f6c  _tryAddParentFol
+0000fac0: 6465 7273 2872 6f77 5b30 5d2c 2072 6f77  ders(row[0], row
+0000fad0: 5b32 5d2c 2072 6f77 5b33 5d29 0a0a 2020  [2], row[3])..  
+0000fae0: 2020 6465 6620 696e 6465 7849 734c 6f61    def indexIsLoa
+0000faf0: 6465 6428 7365 6c66 2920 2d3e 2062 6f6f  ded(self) -> boo
+0000fb00: 6c3a 0a20 2020 2020 2020 2022 2222 5265  l:.        """Re
+0000fb10: 7475 726e 7320 7472 7565 2069 6620 7468  turns true if th
+0000fb20: 6520 5351 4c69 7465 2064 6174 6162 6173  e SQLite databas
+0000fb30: 6520 6861 7320 6265 656e 206f 7065 6e65  e has been opene
+0000fb40: 6420 666f 7220 7265 6164 696e 6720 616e  d for reading an
+0000fb50: 6420 6120 2266 696c 6573 2220 7461 626c  d a "files" tabl
+0000fb60: 6520 6578 6973 7473 2e22 2222 0a20 2020  e exists.""".   
+0000fb70: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000fb80: 2e73 716c 436f 6e6e 6563 7469 6f6e 3a0a  .sqlConnection:.
+0000fb90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000fba0: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
+0000fbb0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000fbc0: 2020 2073 656c 662e 7371 6c43 6f6e 6e65     self.sqlConne
+0000fbd0: 6374 696f 6e2e 6578 6563 7574 6528 2753  ction.execute('S
+0000fbe0: 454c 4543 5420 2a20 4652 4f4d 2022 6669  ELECT * FROM "fi
+0000fbf0: 6c65 7322 2057 4845 5245 2030 203d 3d20  les" WHERE 0 == 
+0000fc00: 313b 2729 0a20 2020 2020 2020 2065 7863  1;').        exc
+0000fc10: 6570 7420 7371 6c69 7465 332e 4f70 6572  ept sqlite3.Oper
+0000fc20: 6174 696f 6e61 6c45 7272 6f72 3a0a 2020  ationalError:.  
+0000fc30: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0000fc40: 716c 436f 6e6e 6563 7469 6f6e 203d 204e  qlConnection = N
+0000fc50: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0000fc60: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+0000fc70: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000fc80: 650a 0a20 2020 2064 6566 206c 6f61 6449  e..    def loadI
+0000fc90: 6e64 6578 2873 656c 662c 2069 6e64 6578  ndex(self, index
+0000fca0: 4669 6c65 4e61 6d65 3a20 416e 7953 7472  FileName: AnyStr
+0000fcb0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000fcc0: 2020 2022 2222 4c6f 6164 7320 7468 6520     """Loads the 
+0000fcd0: 6769 7665 6e20 696e 6465 7820 5351 4c69  given index SQLi
+0000fce0: 7465 2064 6174 6162 6173 6520 616e 6420  te database and 
+0000fcf0: 6368 6563 6b73 2069 7420 666f 7220 7661  checks it for va
+0000fd00: 6c69 6469 7479 2e22 2222 0a20 2020 2020  lidity.""".     
+0000fd10: 2020 2069 6620 7365 6c66 2e69 6e64 6578     if self.index
+0000fd20: 4973 4c6f 6164 6564 2829 3a0a 2020 2020  IsLoaded():.    
+0000fd30: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0000fd40: 2020 2020 2020 2020 7430 203d 2074 696d          t0 = tim
+0000fd50: 652e 7469 6d65 2829 0a20 2020 2020 2020  e.time().       
+0000fd60: 2073 656c 662e 7371 6c43 6f6e 6e65 6374   self.sqlConnect
+0000fd70: 696f 6e20 3d20 7365 6c66 2e5f 6f70 656e  ion = self._open
+0000fd80: 5371 6c44 6228 696e 6465 7846 696c 654e  SqlDb(indexFileN
+0000fd90: 616d 6529 0a20 2020 2020 2020 2074 6162  ame).        tab
+0000fda0: 6c65 7320 3d20 5b78 5b30 5d20 666f 7220  les = [x[0] for 
+0000fdb0: 7820 696e 2073 656c 662e 7371 6c43 6f6e  x in self.sqlCon
+0000fdc0: 6e65 6374 696f 6e2e 6578 6563 7574 6528  nection.execute(
+0000fdd0: 2753 454c 4543 5420 6e61 6d65 2046 524f  'SELECT name FRO
+0000fde0: 4d20 7371 6c69 7465 5f6d 6173 7465 7220  M sqlite_master 
+0000fdf0: 5748 4552 4520 7479 7065 3d22 7461 626c  WHERE type="tabl
+0000fe00: 6522 2729 5d0a 2020 2020 2020 2020 7665  e"')].        ve
+0000fe10: 7273 696f 6e73 203d 204e 6f6e 650a 2020  rsions = None.  
+0000fe20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000fe30: 2020 2020 2020 2072 6f77 7320 3d20 7365         rows = se
+0000fe40: 6c66 2e73 716c 436f 6e6e 6563 7469 6f6e  lf.sqlConnection
+0000fe50: 2e65 7865 6375 7465 2827 5345 4c45 4354  .execute('SELECT
+0000fe60: 202a 2046 524f 4d20 7665 7273 696f 6e73   * FROM versions
+0000fe70: 3b27 290a 2020 2020 2020 2020 2020 2020  ;').            
+0000fe80: 7665 7273 696f 6e73 203d 207b 7d0a 2020  versions = {}.  
+0000fe90: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
+0000fea0: 7720 696e 2072 6f77 733a 0a20 2020 2020  w in rows:.     
+0000feb0: 2020 2020 2020 2020 2020 2076 6572 7369             versi
+0000fec0: 6f6e 735b 726f 775b 305d 5d20 3d20 2872  ons[row[0]] = (r
+0000fed0: 6f77 5b32 5d2c 2072 6f77 5b33 5d2c 2072  ow[2], row[3], r
+0000fee0: 6f77 5b34 5d29 0a20 2020 2020 2020 2065  ow[4]).        e
+0000fef0: 7863 6570 7420 7371 6c69 7465 332e 4f70  xcept sqlite3.Op
+0000ff00: 6572 6174 696f 6e61 6c45 7272 6f72 3a0a  erationalError:.
+0000ff10: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0000ff20: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000ff30: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+0000ff40: 636b 2069 6e64 6578 6573 2063 7265 6174  ck indexes creat
+0000ff50: 6564 2077 6974 6820 6275 6767 6564 2062  ed with bugged b
+0000ff60: 7a32 2064 6563 6f64 6572 2028 6275 6720  z2 decoder (bug 
+0000ff70: 6578 6973 7465 6420 7768 656e 2049 2064  existed when I d
+0000ff80: 6964 206e 6f74 2073 746f 7265 2076 6572  id not store ver
+0000ff90: 7369 6f6e 7320 7965 7429 0a20 2020 2020  sions yet).     
+0000ffa0: 2020 2020 2020 2069 6620 2762 7a69 7032         if 'bzip2
+0000ffb0: 626c 6f63 6b73 2720 696e 2074 6162 6c65  blocks' in table
+0000ffc0: 7320 616e 6420 2776 6572 7369 6f6e 7327  s and 'versions'
+0000ffd0: 206e 6f74 2069 6e20 7461 626c 6573 3a0a   not in tables:.
+0000ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fff0: 7261 6973 6520 496e 7661 6c69 6449 6e64  raise InvalidInd
+00010000: 6578 4572 726f 7228 0a20 2020 2020 2020  exError(.       
+00010010: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
+00010020: 6520 696e 6465 7865 7320 6372 6561 7465  e indexes create
+00010030: 6420 7769 7468 2076 6572 7369 6f6e 2030  d with version 0
+00010040: 2e33 2e30 2074 6872 6f75 6768 2030 2e33  .3.0 through 0.3
+00010050: 2e33 2066 6f72 2062 7a69 7032 2063 6f6d  .3 for bzip2 com
+00010060: 7072 6573 7365 6420 6172 6368 6976 6573  pressed archives
+00010070: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00010080: 2020 2020 2020 2022 6172 6520 7665 7279         "are very
+00010090: 206c 696b 656c 7920 746f 2062 6520 7772   likely to be wr
+000100a0: 6f6e 6720 6265 6361 7573 6520 6f66 2061  ong because of a
+000100b0: 2062 7a69 7032 2064 6563 6f64 6572 2062   bzip2 decoder b
+000100c0: 7567 2e5c 6e22 0a20 2020 2020 2020 2020  ug.\n".         
+000100d0: 2020 2020 2020 2020 2020 2022 506c 6561             "Plea
+000100e0: 7365 2064 656c 6574 6520 7468 6520 696e  se delete the in
+000100f0: 6465 7820 6f72 2063 616c 6c20 7261 7461  dex or call rata
+00010100: 726d 6f75 6e74 2077 6974 6820 7468 6520  rmount with the 
+00010110: 2d2d 7265 6372 6561 7465 2d69 6e64 6578  --recreate-index
+00010120: 206f 7074 696f 6e21 220a 2020 2020 2020   option!".      
+00010130: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00010140: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00010150: 2066 6f72 2065 6d70 7479 206f 7220 696e   for empty or in
+00010160: 636f 6d70 6c65 7465 2069 6e64 6578 6573  complete indexes
+00010170: 2e20 5072 6574 7479 2073 6166 6520 746f  . Pretty safe to
+00010180: 2072 6562 7569 6c64 2074 6865 2069 6e64   rebuild the ind
+00010190: 6578 2066 6f72 2074 6865 7365 2061 7320  ex for these as 
+000101a0: 7468 6579 0a20 2020 2020 2020 2020 2020  they.           
+000101b0: 2023 2061 7265 2073 6f20 696e 7661 6c69   # are so invali
+000101c0: 642c 206e 6f6f 6e65 2073 686f 756c 6420  d, noone should 
+000101d0: 6d69 7373 2074 6865 6d2e 2053 6f2c 2072  miss them. So, r
+000101e0: 6563 7265 6174 6520 696e 6465 7820 6279  ecreate index by
+000101f0: 2064 6566 6175 6c74 2066 6f72 2074 6865   default for the
+00010200: 7365 2063 6173 6573 2e0a 2020 2020 2020  se cases..      
+00010210: 2020 2020 2020 6966 2027 6669 6c65 7327        if 'files'
+00010220: 206e 6f74 2069 6e20 7461 626c 6573 3a0a   not in tables:.
+00010230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010240: 7261 6973 6520 496e 7661 6c69 6449 6e64  raise InvalidInd
+00010250: 6578 4572 726f 7228 2253 514c 6974 6520  exError("SQLite 
+00010260: 696e 6465 7820 6973 2065 6d70 7479 2229  index is empty")
+00010270: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00010280: 2027 6669 6c65 7374 6d70 2720 696e 2074   'filestmp' in t
+00010290: 6162 6c65 7320 6f72 2027 7061 7265 6e74  ables or 'parent
+000102a0: 666f 6c64 6572 7327 2069 6e20 7461 626c  folders' in tabl
+000102b0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000102c0: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
+000102d0: 6449 6e64 6578 4572 726f 7228 2253 514c  dIndexError("SQL
+000102e0: 6974 6520 696e 6465 7820 6973 2069 6e63  ite index is inc
+000102f0: 6f6d 706c 6574 6522 290a 0a20 2020 2020  omplete")..     
+00010300: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
+00010310: 6f72 2070 7265 2d73 7061 7273 6520 7375  or pre-sparse su
+00010320: 7070 6f72 7420 696e 6465 7865 730a 2020  pport indexes.  
+00010330: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00010340: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00010350: 7665 7273 696f 6e73 2720 6e6f 7420 696e  versions' not in
+00010360: 2074 6162 6c65 730a 2020 2020 2020 2020   tables.        
+00010370: 2020 2020 2020 2020 6f72 2027 696e 6465          or 'inde
+00010380: 7827 206e 6f74 2069 6e20 7665 7273 696f  x' not in versio
+00010390: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
+000103a0: 2020 206f 7220 6c65 6e28 7665 7273 696f     or len(versio
+000103b0: 6e73 5b27 696e 6465 7827 5d29 203c 2032  ns['index']) < 2
+000103c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000103d0: 206f 7220 7665 7273 696f 6e73 5b27 696e   or versions['in
+000103e0: 6465 7827 5d5b 315d 203c 2032 0a20 2020  dex'][1] < 2.   
+000103f0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00010400: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00010410: 7428 225b 5761 726e 696e 675d 2054 6865  t("[Warning] The
+00010420: 2066 6f75 6e64 206f 7574 6461 7465 6420   found outdated 
+00010430: 696e 6465 7820 646f 6573 206e 6f74 2063  index does not c
+00010440: 6f6e 7461 696e 2061 6e79 2073 7061 7273  ontain any spars
+00010450: 6520 6669 6c65 2069 6e66 6f72 6d61 7469  e file informati
+00010460: 6f6e 2e22 290a 2020 2020 2020 2020 2020  on.").          
+00010470: 2020 2020 2020 7072 696e 7428 225b 5761        print("[Wa
+00010480: 726e 696e 675d 2054 6865 2069 6e64 6578  rning] The index
+00010490: 2077 696c 6c20 616c 736f 206d 6973 7320   will also miss 
+000104a0: 6461 7461 2061 626f 7574 206d 756c 7469  data about multi
+000104b0: 706c 6520 7665 7273 696f 6e73 206f 6620  ple versions of 
+000104c0: 6120 6669 6c65 2e22 290a 2020 2020 2020  a file.").      
+000104d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000104e0: 225b 5761 726e 696e 675d 2050 6c65 6173  "[Warning] Pleas
+000104f0: 6520 7265 6372 6561 7465 2074 6865 2069  e recreate the i
+00010500: 6e64 6578 2069 6620 796f 7520 6861 7665  ndex if you have
+00010510: 2070 726f 626c 656d 7320 7769 7468 2074   problems with t
+00010520: 686f 7365 2e22 290a 0a20 2020 2020 2020  hose.")..       
+00010530: 2020 2020 2069 6620 276d 6574 6164 6174       if 'metadat
+00010540: 6127 2069 6e20 7461 626c 6573 3a0a 2020  a' in tables:.  
+00010550: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00010560: 7461 6461 7461 203d 2064 6963 7428 7365  tadata = dict(se
+00010570: 6c66 2e73 716c 436f 6e6e 6563 7469 6f6e  lf.sqlConnection
+00010580: 2e65 7865 6375 7465 2827 5345 4c45 4354  .execute('SELECT
+00010590: 202a 2046 524f 4d20 6d65 7461 6461 7461   * FROM metadata
+000105a0: 3b27 2929 0a0a 2020 2020 2020 2020 2020  ;'))..          
+000105b0: 2020 2020 2020 6966 2027 7461 7273 7461        if 'tarsta
+000105c0: 7473 2720 696e 206d 6574 6164 6174 613a  ts' in metadata:
+000105d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000105e0: 2020 2020 2076 616c 7565 7320 3d20 6a73       values = js
+000105f0: 6f6e 2e6c 6f61 6473 286d 6574 6164 6174  on.loads(metadat
+00010600: 615b 2774 6172 7374 6174 7327 5d29 0a20  a['tarstats']). 
+00010610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010620: 2020 2074 6172 5374 6174 7320 3d20 6f73     tarStats = os
+00010630: 2e73 7461 7428 7365 6c66 2e74 6172 4669  .stat(self.tarFi
+00010640: 6c65 4e61 6d65 290a 0a20 2020 2020 2020  leName)..       
+00010650: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+00010660: 6d74 3a20 6f66 660a 2020 2020 2020 2020  mt: off.        
+00010670: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00010680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010690: 2020 2020 2020 2020 2068 6173 6174 7472           hasattr
+000106a0: 2820 7461 7253 7461 7473 2c20 2273 745f  ( tarStats, "st_
+000106b0: 7369 7a65 2220 290a 2020 2020 2020 2020  size" ).        
+000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106d0: 616e 6420 2773 745f 7369 7a65 2720 696e  and 'st_size' in
+000106e0: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+000106f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010700: 616e 6420 7461 7253 7461 7473 2e73 745f  and tarStats.st_
+00010710: 7369 7a65 2021 3d20 7661 6c75 6573 5b27  size != values['
+00010720: 7374 5f73 697a 6527 5d0a 2020 2020 2020  st_size'].      
+00010730: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+00010740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010750: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
+00010760: 6e76 616c 6964 496e 6465 7845 7272 6f72  nvalidIndexError
+00010770: 2820 2254 4152 2066 696c 6520 666f 7220  ( "TAR file for 
+00010780: 7468 6973 2053 514c 6974 6520 696e 6465  this SQLite inde
+00010790: 7820 6861 7320 6368 616e 6765 6420 7369  x has changed si
+000107a0: 7a65 2066 726f 6d22 2c0a 2020 2020 2020  ze from",.      
+000107b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000107c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107d0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-000107e0: 2020 2020 2320 4368 6563 6b20 6172 6775      # Check argu
-000107f0: 6d65 6e74 7320 7573 6564 2074 6f20 6372  ments used to cr
-00010800: 6561 7465 2074 6865 2066 6f75 6e64 2069  eate the found i
-00010810: 6e64 6578 2e20 5468 6573 6520 6172 6520  ndex. These are 
-00010820: 6f6e 6c79 2077 6172 6e69 6e67 7320 616e  only warnings an
-00010830: 6420 6e6f 7420 666f 7263 696e 6720 6120  d not forcing a 
-00010840: 7265 6275 696c 640a 2020 2020 2020 2020  rebuild.        
-00010850: 2020 2020 2020 2020 2320 6279 2064 6566          # by def
-00010860: 6175 6c74 2e0a 2020 2020 2020 2020 2020  ault..          
-00010870: 2020 2020 2020 2320 544f 444f 3a20 4164        # TODO: Ad
-00010880: 6420 2d2d 666f 7263 6520 6f70 7469 6f6e  d --force option
-00010890: 733f 0a20 2020 2020 2020 2020 2020 2020  s?.             
-000108a0: 2020 2069 6620 2761 7267 756d 656e 7473     if 'arguments
-000108b0: 2720 696e 206d 6574 6164 6174 613a 0a20  ' in metadata:. 
-000108c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108d0: 2020 2069 6e64 6578 4172 6773 203d 206a     indexArgs = j
-000108e0: 736f 6e2e 6c6f 6164 7328 6d65 7461 6461  son.loads(metada
-000108f0: 7461 5b27 6172 6775 6d65 6e74 7327 5d29  ta['arguments'])
-00010900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010910: 2020 2020 2061 7267 756d 656e 7473 546f       argumentsTo
-00010920: 4368 6563 6b20 3d20 5b0a 2020 2020 2020  Check = [.      
-00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010940: 2020 276d 6f75 6e74 5265 6375 7273 6976    'mountRecursiv
-00010950: 656c 7927 2c0a 2020 2020 2020 2020 2020  ely',.          
-00010960: 2020 2020 2020 2020 2020 2020 2020 2767                'g
-00010970: 7a69 7053 6565 6b50 6f69 6e74 5370 6163  zipSeekPointSpac
-00010980: 696e 6727 2c0a 2020 2020 2020 2020 2020  ing',.          
-00010990: 2020 2020 2020 2020 2020 2020 2020 2765                'e
-000109a0: 6e63 6f64 696e 6727 2c0a 2020 2020 2020  ncoding',.      
+000107d0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+000107e0: 735b 2773 745f 7369 7a65 275d 2c20 2274  s['st_size'], "t
+000107f0: 6f22 2c20 7461 7253 7461 7473 2e73 745f  o", tarStats.st_
+00010800: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+00010810: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
+00010820: 206f 6e0a 0a20 2020 2020 2020 2020 2020   on..           
+00010830: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+00010840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010850: 2020 2020 2020 7365 6c66 2e76 6572 6966        self.verif
+00010860: 794d 6f64 6966 6963 6174 696f 6e54 696d  yModificationTim
+00010870: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00010880: 2020 2020 2020 2020 2020 616e 6420 6861            and ha
+00010890: 7361 7474 7228 7461 7253 7461 7473 2c20  sattr(tarStats, 
+000108a0: 2273 745f 6d74 696d 6522 290a 2020 2020  "st_mtime").    
+000108b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000108c0: 2020 2020 616e 6420 2773 745f 6d74 696d      and 'st_mtim
+000108d0: 6527 2069 6e20 7661 6c75 6573 0a20 2020  e' in values.   
+000108e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000108f0: 2020 2020 2061 6e64 2074 6172 5374 6174       and tarStat
+00010900: 732e 7374 5f6d 7469 6d65 2021 3d20 7661  s.st_mtime != va
+00010910: 6c75 6573 5b27 7374 5f6d 7469 6d65 275d  lues['st_mtime']
+00010920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010930: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010950: 7261 6973 6520 496e 7661 6c69 6449 6e64  raise InvalidInd
+00010960: 6578 4572 726f 7228 0a20 2020 2020 2020  exError(.       
+00010970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010980: 2020 2020 2022 5468 6520 6d6f 6469 6669       "The modifi
+00010990: 6361 7469 6f6e 2064 6174 6520 666f 7220  cation date for 
+000109a0: 7468 6520 5441 5220 6669 6c65 222c 0a20  the TAR file",. 
 000109b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109c0: 2020 2773 7472 6970 5265 6375 7273 6976    'stripRecursiv
-000109d0: 6554 6172 4578 7465 6e73 696f 6e27 2c0a  eTarExtension',.
+000109c0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+000109d0: 735b 2773 745f 6d74 696d 6527 5d2c 0a20  s['st_mtime'],. 
 000109e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109f0: 2020 2020 2020 2020 2769 676e 6f72 655a          'ignoreZ
-00010a00: 6572 6f73 272c 0a20 2020 2020 2020 2020  eros',.         
-00010a10: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-00010a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a30: 2064 6966 6665 7269 6e67 4172 6773 203d   differingArgs =
-00010a40: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00010a50: 2020 2020 2020 2020 666f 7220 6172 6720          for arg 
-00010a60: 696e 2061 7267 756d 656e 7473 546f 4368  in argumentsToCh
-00010a70: 6563 6b3a 0a20 2020 2020 2020 2020 2020  eck:.           
-00010a80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010a90: 6172 6720 696e 2069 6e64 6578 4172 6773  arg in indexArgs
-00010aa0: 2061 6e64 2068 6173 6174 7472 2873 656c   and hasattr(sel
-00010ab0: 662c 2061 7267 2920 616e 6420 696e 6465  f, arg) and inde
-00010ac0: 7841 7267 735b 6172 675d 2021 3d20 6765  xArgs[arg] != ge
-00010ad0: 7461 7474 7228 7365 6c66 2c20 6172 6729  tattr(self, arg)
-00010ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010af0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00010b00: 6666 6572 696e 6741 7267 732e 6170 7065  fferingArgs.appe
-00010b10: 6e64 2828 6172 672c 2069 6e64 6578 4172  nd((arg, indexAr
-00010b20: 6773 5b61 7267 5d2c 2067 6574 6174 7472  gs[arg], getattr
-00010b30: 2873 656c 662c 2061 7267 2929 290a 2020  (self, arg))).  
-00010b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b50: 2020 6966 2064 6966 6665 7269 6e67 4172    if differingAr
-00010b60: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00010b70: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00010b80: 7428 225b 5761 726e 696e 675d 2054 6865  t("[Warning] The
-00010b90: 2061 7267 756d 656e 7473 2075 7365 6420   arguments used 
-00010ba0: 666f 7220 6372 6561 7469 6e67 2074 6865  for creating the
-00010bb0: 2066 6f75 6e64 2069 6e64 6578 2064 6966   found index dif
-00010bc0: 6665 7220 6672 6f6d 2074 6865 2061 7267  fer from the arg
-00010bd0: 756d 656e 7473 2022 290a 2020 2020 2020  uments ").      
+000109f0: 2020 2020 2020 2020 2020 2022 746f 2074             "to t
+00010a00: 6869 7320 5351 4c69 7465 2069 6e64 6578  his SQLite index
+00010a10: 2068 6173 2063 6861 6e67 6564 2028 2220   has changed (" 
+00010a20: 2b20 7374 7228 7461 7253 7461 7473 2e73  + str(tarStats.s
+00010a30: 745f 6d74 696d 6529 202b 2022 2922 2c0a  t_mtime) + ")",.
+00010a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a50: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00010a60: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00010a70: 636b 2061 7267 756d 656e 7473 2075 7365  ck arguments use
+00010a80: 6420 746f 2063 7265 6174 6520 7468 6520  d to create the 
+00010a90: 666f 756e 6420 696e 6465 782e 2054 6865  found index. The
+00010aa0: 7365 2061 7265 206f 6e6c 7920 7761 726e  se are only warn
+00010ab0: 696e 6773 2061 6e64 206e 6f74 2066 6f72  ings and not for
+00010ac0: 6369 6e67 2061 2072 6562 7569 6c64 0a20  cing a rebuild. 
+00010ad0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00010ae0: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
+00010af0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00010b00: 4f44 4f3a 2041 6464 202d 2d66 6f72 6365  ODO: Add --force
+00010b10: 206f 7074 696f 6e73 3f0a 2020 2020 2020   options?.      
+00010b20: 2020 2020 2020 2020 2020 6966 2027 6172            if 'ar
+00010b30: 6775 6d65 6e74 7327 2069 6e20 6d65 7461  guments' in meta
+00010b40: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00010b50: 2020 2020 2020 2020 2020 696e 6465 7841            indexA
+00010b60: 7267 7320 3d20 6a73 6f6e 2e6c 6f61 6473  rgs = json.loads
+00010b70: 286d 6574 6164 6174 615b 2761 7267 756d  (metadata['argum
+00010b80: 656e 7473 275d 290a 2020 2020 2020 2020  ents']).        
+00010b90: 2020 2020 2020 2020 2020 2020 6172 6775              argu
+00010ba0: 6d65 6e74 7354 6f43 6865 636b 203d 205b  mentsToCheck = [
+00010bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010bc0: 2020 2020 2020 2020 2027 6d6f 756e 7452           'mountR
+00010bd0: 6563 7572 7369 7665 6c79 272c 0a20 2020  ecursively',.   
 00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bf0: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-00010c00: 675d 2067 6976 656e 2066 6f72 206d 6f75  g] given for mou
-00010c10: 6e74 696e 6720 7468 6520 6172 6368 6976  nting the archiv
-00010c20: 6520 6e6f 772e 2049 6e20 6f72 6465 7220  e now. In order 
-00010c30: 746f 2061 7070 6c79 2074 6865 7365 2063  to apply these c
-00010c40: 6861 6e67 6573 2c20 2229 0a20 2020 2020  hanges, ").     
-00010c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c60: 2020 2070 7269 6e74 2822 5b57 6172 6e69     print("[Warni
-00010c70: 6e67 5d20 7265 6372 6561 7465 2074 6865  ng] recreate the
-00010c80: 2069 6e64 6578 2075 7369 6e67 2074 6865   index using the
-00010c90: 202d 2d72 6563 7265 6174 652d 696e 6465   --recreate-inde
-00010ca0: 7820 6f70 7469 6f6e 2122 290a 2020 2020  x option!").    
-00010cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cc0: 2020 2020 666f 7220 6172 672c 206f 6c64      for arg, old
-00010cd0: 5374 6174 652c 206e 6577 5374 6174 6520  State, newState 
-00010ce0: 696e 2064 6966 6665 7269 6e67 4172 6773  in differingArgs
-00010cf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010d00: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00010d10: 696e 7428 225b 5761 726e 696e 675d 207b  int("[Warning] {
-00010d20: 7d3a 2069 6e64 6578 3a20 7b7d 2c20 6375  }: index: {}, cu
-00010d30: 7272 656e 743a 207b 7d22 2e66 6f72 6d61  rrent: {}".forma
-00010d40: 7428 6172 672c 206f 6c64 5374 6174 652c  t(arg, oldState,
-00010d50: 206e 6577 5374 6174 6529 290a 0a20 2020   newState))..   
-00010d60: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00010d70: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00010d80: 2020 2020 2020 2020 2320 696e 6465 7849          # indexI
-00010d90: 734c 6f61 6465 6420 6368 6563 6b73 2073  sLoaded checks s
-00010da0: 656c 662e 7371 6c43 6f6e 6e65 6374 696f  elf.sqlConnectio
-00010db0: 6e2c 2073 6f20 636c 6f73 6520 6974 2062  n, so close it b
-00010dc0: 6566 6f72 6520 7265 7475 726e 696e 6720  efore returning 
-00010dd0: 6265 6361 7573 6520 6974 2077 6173 2066  because it was f
-00010de0: 6f75 6e64 2074 6f20 6265 2066 6175 6c74  ound to be fault
-00010df0: 790a 2020 2020 2020 2020 2020 2020 7472  y.            tr
-00010e00: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00010e10: 2020 2073 656c 662e 7371 6c43 6f6e 6e65     self.sqlConne
-00010e20: 6374 696f 6e2e 636c 6f73 6528 290a 2020  ction.close().  
-00010e30: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00010e40: 2073 716c 6974 6533 2e45 7272 6f72 3a0a   sqlite3.Error:.
-00010e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e60: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00010e70: 2073 656c 662e 7371 6c43 6f6e 6e65 6374   self.sqlConnect
-00010e80: 696f 6e20 3d20 4e6f 6e65 0a0a 2020 2020  ion = None..    
-00010e90: 2020 2020 2020 2020 7261 6973 6520 650a          raise e.
-00010ea0: 0a20 2020 2020 2020 2069 6620 7072 696e  .        if prin
-00010eb0: 7444 6562 7567 203e 3d20 313a 0a20 2020  tDebug >= 1:.   
-00010ec0: 2020 2020 2020 2020 2023 204c 6567 6163           # Legac
-00010ed0: 7920 6f75 7470 7574 2066 6f72 2061 7574  y output for aut
-00010ee0: 6f6d 6174 6564 2074 6573 7473 0a20 2020  omated tests.   
-00010ef0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00010f00: 4c6f 6164 696e 6720 6f66 6673 6574 2064  Loading offset d
-00010f10: 6963 7469 6f6e 6172 7920 6672 6f6d 222c  ictionary from",
-00010f20: 2069 6e64 6578 4669 6c65 4e61 6d65 2c20   indexFileName, 
-00010f30: 2274 6f6f 6b20 7b3a 2e32 667d 7322 2e66  "took {:.2f}s".f
-00010f40: 6f72 6d61 7428 7469 6d65 2e74 696d 6528  ormat(time.time(
-00010f50: 2920 2d20 7430 2929 0a0a 2020 2020 6465  ) - t0))..    de
-00010f60: 6620 5f74 7279 4c6f 6164 496e 6465 7828  f _tryLoadIndex(
-00010f70: 7365 6c66 2c20 696e 6465 7846 696c 654e  self, indexFileN
-00010f80: 616d 653a 2041 6e79 5374 7229 202d 3e20  ame: AnyStr) -> 
-00010f90: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
-00010fa0: 2263 616c 6c73 206c 6f61 6449 6e64 6578  "calls loadIndex
-00010fb0: 2069 6620 696e 6465 7820 6973 206e 6f74   if index is not
-00010fc0: 206c 6f61 6465 6420 616c 7265 6164 7920   loaded already 
-00010fd0: 616e 6420 7072 6f76 6964 6573 2065 7874  and provides ext
-00010fe0: 656e 7369 7665 2065 7272 6f72 2068 616e  ensive error han
-00010ff0: 646c 696e 6722 2222 0a0a 2020 2020 2020  dling"""..      
-00011000: 2020 6966 2073 656c 662e 696e 6465 7849    if self.indexI
-00011010: 734c 6f61 6465 6428 293a 0a20 2020 2020  sLoaded():.     
-00011020: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00011030: 7565 0a0a 2020 2020 2020 2020 6966 206e  ue..        if n
-00011040: 6f74 206f 732e 7061 7468 2e69 7366 696c  ot os.path.isfil
-00011050: 6528 696e 6465 7846 696c 654e 616d 6529  e(indexFileName)
-00011060: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00011070: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-00011080: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00011090: 2020 2020 2073 656c 662e 6c6f 6164 496e       self.loadIn
-000110a0: 6465 7828 696e 6465 7846 696c 654e 616d  dex(indexFileNam
-000110b0: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
-000110c0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000110d0: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-000110e0: 2020 2020 2020 6966 2070 7269 6e74 4465        if printDe
-000110f0: 6275 6720 3e3d 2033 3a0a 2020 2020 2020  bug >= 3:.      
-00011100: 2020 2020 2020 2020 2020 7472 6163 6562            traceb
-00011110: 6163 6b2e 7072 696e 745f 6578 6328 290a  ack.print_exc().
-00011120: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00011130: 6e74 2822 5b57 6172 6e69 6e67 5d20 436f  nt("[Warning] Co
-00011140: 756c 6420 6e6f 7420 6c6f 6164 2066 696c  uld not load fil
-00011150: 653a 222c 2069 6e64 6578 4669 6c65 4e61  e:", indexFileNa
-00011160: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00011170: 7072 696e 7428 225b 496e 666f 5d20 4578  print("[Info] Ex
-00011180: 6365 7074 696f 6e3a 222c 2065 7863 6570  ception:", excep
-00011190: 7469 6f6e 290a 2020 2020 2020 2020 2020  tion).          
-000111a0: 2020 7072 696e 7428 225b 496e 666f 5d20    print("[Info] 
-000111b0: 536f 6d65 206c 696b 656c 7920 7265 6173  Some likely reas
-000111c0: 6f6e 7320 666f 7220 6e6f 7420 6265 696e  ons for not bein
-000111d0: 6720 6162 6c65 2074 6f20 6c6f 6164 2074  g able to load t
-000111e0: 6865 2069 6e64 6578 2066 696c 653a 2229  he index file:")
-000111f0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00011200: 6e74 2822 5b49 6e66 6f5d 2020 202d 2054  nt("[Info]   - T
-00011210: 6865 2069 6e64 6578 2066 696c 6520 6861  he index file ha
-00011220: 7320 696e 636f 7272 6563 7420 7265 6164  s incorrect read
-00011230: 2070 6572 6d69 7373 696f 6e73 2229 0a20   permissions"). 
-00011240: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00011250: 2822 5b49 6e66 6f5d 2020 202d 2054 6865  ("[Info]   - The
-00011260: 2069 6e64 6578 2066 696c 6520 6973 2069   index file is i
-00011270: 6e63 6f6d 706c 6574 6520 6265 6361 7573  ncomplete becaus
-00011280: 6520 7261 7461 726d 6f75 6e74 2077 6173  e ratarmount was
-00011290: 206b 696c 6c65 6420 6475 7269 6e67 2069   killed during i
-000112a0: 6e64 6578 2063 7265 6174 696f 6e22 290a  ndex creation").
-000112b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000112c0: 7428 225b 496e 666f 5d20 2020 2d20 5468  t("[Info]   - Th
-000112d0: 6520 696e 6465 7820 6669 6c65 2077 6173  e index file was
-000112e0: 2064 6574 6563 7465 6420 746f 2063 6f6e   detected to con
-000112f0: 7461 696e 2065 7272 6f72 7320 6265 6361  tain errors beca
-00011300: 7573 6520 6f66 206b 6e6f 776e 2062 7567  use of known bug
-00011310: 7320 6f66 206f 6c64 6572 2076 6572 7369  s of older versi
-00011320: 6f6e 7322 290a 2020 2020 2020 2020 2020  ons").          
-00011330: 2020 7072 696e 7428 225b 496e 666f 5d20    print("[Info] 
-00011340: 2020 2d20 5468 6520 696e 6465 7820 6669    - The index fi
-00011350: 6c65 2067 6f74 2063 6f72 7275 7074 6564  le got corrupted
-00011360: 2062 6563 6175 7365 206f 663a 2229 0a20   because of:"). 
-00011370: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00011380: 2822 5b49 6e66 6f5d 2020 2020 202d 2054  ("[Info]     - T
-00011390: 6865 2070 726f 6772 616d 2065 7869 7465  he program exite
-000113a0: 6420 7768 696c 6520 6974 2077 6173 2073  d while it was s
-000113b0: 7469 6c6c 2077 7269 7469 6e67 2074 6865  till writing the
-000113c0: 2069 6e64 6578 2062 6563 6175 7365 206f   index because o
-000113d0: 663a 2229 0a20 2020 2020 2020 2020 2020  f:").           
-000113e0: 2070 7269 6e74 2822 5b49 6e66 6f5d 2020   print("[Info]  
-000113f0: 2020 2020 202d 2074 6865 2075 7365 7220       - the user 
-00011400: 7365 6e74 2053 4947 494e 5420 746f 2066  sent SIGINT to f
-00011410: 6f72 6365 2074 6865 2070 726f 6772 616d  orce the program
-00011420: 2074 6f20 7175 6974 2229 0a20 2020 2020   to quit").     
-00011430: 2020 2020 2020 2070 7269 6e74 2822 5b49         print("[I
-00011440: 6e66 6f5d 2020 2020 2020 202d 2061 6e20  nfo]       - an 
-00011450: 696e 7465 726e 616c 2065 7272 6f72 206f  internal error o
-00011460: 6363 7572 6564 2077 6869 6c65 2077 7269  ccured while wri
-00011470: 7469 6e67 2074 6865 2069 6e64 6578 2229  ting the index")
-00011480: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00011490: 6e74 2822 5b49 6e66 6f5d 2020 2020 2020  nt("[Info]      
-000114a0: 202d 2074 6865 2064 6973 6b20 6669 6c6c   - the disk fill
-000114b0: 6564 2075 7020 7768 696c 6520 7772 6974  ed up while writ
-000114c0: 696e 6720 7468 6520 696e 6465 7822 290a  ing the index").
-000114d0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000114e0: 7428 225b 496e 666f 5d20 2020 2020 2d20  t("[Info]     - 
-000114f0: 5261 7265 206c 6f77 6c65 7665 6c20 636f  Rare lowlevel co
-00011500: 7272 7570 7469 6f6e 7320 6361 7573 6564  rruptions caused
-00011510: 2062 7920 6861 7264 7761 7265 2066 6169   by hardware fai
-00011520: 6c75 7265 2229 0a0a 2020 2020 2020 2020  lure")..        
-00011530: 2020 2020 7072 696e 7428 225b 496e 666f      print("[Info
-00011540: 5d20 5468 6973 206d 6967 6874 2066 6f72  ] This might for
-00011550: 6365 2061 2074 696d 652d 636f 7374 6c79  ce a time-costly
-00011560: 2069 6e64 6578 2072 6563 7265 6174 696f   index recreatio
-00011570: 6e2c 2073 6f20 6966 2069 7420 6861 7070  n, so if it happ
-00011580: 656e 7320 6f66 7465 6e22 290a 2020 2020  ens often").    
-00011590: 2020 2020 2020 2020 7072 696e 7428 2220          print(" 
-000115a0: 2020 2020 2020 616e 6420 6d6f 756e 7469        and mounti
-000115b0: 6e67 2069 7320 736c 6f77 2c20 7472 7920  ng is slow, try 
-000115c0: 746f 2066 696e 6420 6f75 7420 7768 7920  to find out why 
-000115d0: 6c6f 6164 696e 6720 6661 696c 7320 7265  loading fails re
-000115e0: 7065 6174 6564 6c79 2c22 290a 2020 2020  peatedly,").    
-000115f0: 2020 2020 2020 2020 7072 696e 7428 2220          print(" 
-00011600: 2020 2020 2020 652e 672e 2c20 6279 206f        e.g., by o
-00011610: 7065 6e69 6e67 2061 6e20 6973 7375 6520  pening an issue 
-00011620: 6f6e 2074 6865 2070 7562 6c69 6320 6769  on the public gi
-00011630: 7468 7562 2070 6167 652e 2229 0a0a 2020  thub page.")..  
-00011640: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00011650: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00011660: 732e 7265 6d6f 7665 2869 6e64 6578 4669  s.remove(indexFi
-00011670: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
-00011680: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
-00011690: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-000116a0: 2020 2020 7072 696e 7428 225b 5761 726e      print("[Warn
-000116b0: 696e 675d 2046 6169 6c65 6420 746f 2072  ing] Failed to r
-000116c0: 656d 6f76 6520 636f 7272 7570 7465 6420  emove corrupted 
-000116d0: 6f6c 6420 6361 6368 6564 2069 6e64 6578  old cached index
-000116e0: 2066 696c 653a 222c 2069 6e64 6578 4669   file:", indexFi
-000116f0: 6c65 4e61 6d65 290a 0a20 2020 2020 2020  leName)..       
-00011700: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
-00011710: 3d20 3320 616e 6420 7365 6c66 2e69 6e64  = 3 and self.ind
-00011720: 6578 4973 4c6f 6164 6564 2829 3a0a 2020  exIsLoaded():.  
-00011730: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00011740: 224c 6f61 6465 6420 696e 6465 7822 2c20  "Loaded index", 
-00011750: 696e 6465 7846 696c 654e 616d 6529 0a0a  indexFileName)..
-00011760: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00011770: 656c 662e 696e 6465 7849 734c 6f61 6465  elf.indexIsLoade
-00011780: 6428 290a 0a20 2020 2040 7374 6174 6963  d()..    @static
-00011790: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-000117a0: 6465 7465 6374 436f 6d70 7265 7373 696f  detectCompressio
-000117b0: 6e28 6669 6c65 6f62 6a3a 2049 4f5b 6279  n(fileobj: IO[by
-000117c0: 7465 735d 2920 2d3e 204f 7074 696f 6e61  tes]) -> Optiona
-000117d0: 6c5b 7374 725d 3a0a 2020 2020 2020 2020  l[str]:.        
-000117e0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-000117f0: 6528 6669 6c65 6f62 6a2c 2069 6f2e 494f  e(fileobj, io.IO
-00011800: 4261 7365 2920 6f72 206e 6f74 2066 696c  Base) or not fil
-00011810: 656f 626a 2e73 6565 6b61 626c 6528 293a  eobj.seekable():
-00011820: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00011830: 7572 6e20 4e6f 6e65 0a0a 2020 2020 2020  urn None..      
-00011840: 2020 6f6c 644f 6666 7365 7420 3d20 6669    oldOffset = fi
-00011850: 6c65 6f62 6a2e 7465 6c6c 2829 0a20 2020  leobj.tell().   
-00011860: 2020 2020 2066 6f72 2063 6f6d 7072 6573       for compres
-00011870: 7369 6f6e 4964 2c20 636f 6d70 7265 7373  sionId, compress
-00011880: 696f 6e20 696e 2073 7570 706f 7274 6564  ion in supported
-00011890: 436f 6d70 7265 7373 696f 6e73 2e69 7465  Compressions.ite
-000118a0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-000118b0: 2020 2320 5468 6520 6865 6164 6572 2063    # The header c
-000118c0: 6865 636b 2069 7320 6120 6e65 6365 7373  heck is a necess
-000118d0: 6172 7920 636f 6e64 6974 696f 6e20 6e6f  ary condition no
-000118e0: 7420 6120 7375 6666 6963 6965 6e74 2063  t a sufficient c
-000118f0: 6f6e 6469 7469 6f6e 2e0a 2020 2020 2020  ondition..      
-00011900: 2020 2020 2020 2320 4573 7065 6369 616c        # Especial
-00011910: 6c79 2066 6f72 2067 7a69 702c 2077 6869  ly for gzip, whi
-00011920: 6368 206f 6e6c 7920 6861 7320 3220 6d61  ch only has 2 ma
-00011930: 6769 6320 6279 7465 732c 2066 616c 7365  gic bytes, false
-00011940: 2070 6f73 6974 6976 6573 206d 6967 6874   positives might
-00011950: 2068 6170 7065 6e2e 0a20 2020 2020 2020   happen..       
-00011960: 2020 2020 2023 2054 6865 7265 666f 7265       # Therefore
-00011970: 2c20 6f6e 6c79 2075 7365 2074 6865 206d  , only use the m
-00011980: 6167 6963 2062 7974 6573 2062 6173 6564  agic bytes based
-00011990: 2063 6865 636b 2069 6620 7468 6520 6d6f   check if the mo
-000119a0: 6475 6c65 2063 6f75 6c64 206e 6f74 2062  dule could not b
-000119b0: 6520 666f 756e 640a 2020 2020 2020 2020  e found.        
-000119c0: 2020 2020 2320 696e 206f 7264 6572 2074      # in order t
-000119d0: 6f20 7374 696c 6c20 6265 2061 626c 6520  o still be able 
-000119e0: 746f 2070 7269 6e74 2070 696e 706f 696e  to print pinpoin
-000119f0: 7420 6572 726f 7220 6d65 7373 6167 6573  t error messages
-00011a00: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-00011a10: 7463 6865 7320 3d20 636f 6d70 7265 7373  tches = compress
-00011a20: 696f 6e2e 6368 6563 6b48 6561 6465 7228  ion.checkHeader(
-00011a30: 6669 6c65 6f62 6a29 0a20 2020 2020 2020  fileobj).       
-00011a40: 2020 2020 2066 696c 656f 626a 2e73 6565       fileobj.see
-00011a50: 6b28 6f6c 644f 6666 7365 7429 0a20 2020  k(oldOffset).   
-00011a60: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011a70: 6d61 7463 6865 733a 0a20 2020 2020 2020  matches:.       
-00011a80: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00011a90: 650a 0a20 2020 2020 2020 2020 2020 2069  e..            i
-00011aa0: 6620 636f 6d70 7265 7373 696f 6e2e 6d6f  f compression.mo
-00011ab0: 6475 6c65 4e61 6d65 206e 6f74 2069 6e20  duleName not in 
-00011ac0: 7379 732e 6d6f 6475 6c65 7320 616e 6420  sys.modules and 
-00011ad0: 6d61 7463 6865 733a 0a20 2020 2020 2020  matches:.       
-00011ae0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011af0: 636f 6d70 7265 7373 696f 6e49 640a 0a20  compressionId.. 
-00011b00: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00011b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b20: 636f 6d70 7265 7373 6564 4669 6c65 6f62  compressedFileob
-00011b30: 6a20 3d20 636f 6d70 7265 7373 696f 6e2e  j = compression.
-00011b40: 6f70 656e 2866 696c 656f 626a 290a 2020  open(fileobj).  
-00011b50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011b60: 5265 6164 696e 6720 3142 2066 726f 6d20  Reading 1B from 
-00011b70: 6120 7369 6e67 6c65 2d66 7261 6d65 207a  a single-frame z
-00011b80: 7374 2066 696c 6520 6d69 6768 7420 7265  st file might re
-00011b90: 7175 6972 6520 6465 636f 6d70 7265 7373  quire decompress
-00011ba0: 696e 6720 6974 2066 756c 6c79 2069 6e20  ing it fully in 
-00011bb0: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
-00011bc0: 2020 2020 2020 2320 746f 2067 6574 2075        # to get u
-00011bd0: 6e63 6f6d 7072 6573 7365 6420 6669 6c65  ncompressed file
-00011be0: 2073 697a 6521 2041 766f 6964 2074 6861   size! Avoid tha
-00011bf0: 742e 2054 6865 206d 6167 6963 2062 7974  t. The magic byt
-00011c00: 6573 2073 686f 756c 6420 7375 6666 6963  es should suffic
-00011c10: 6520 6d6f 7374 6c79 2e0a 2020 2020 2020  e mostly..      
-00011c20: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
-00011c30: 3a20 4d61 6b65 2069 6e64 6578 6564 5f7a  : Make indexed_z
-00011c40: 7374 6420 6e6f 7420 7265 7175 6972 6520  std not require 
-00011c50: 7468 6520 756e 636f 6d70 7265 7373 6564  the uncompressed
-00011c60: 2073 697a 6520 666f 7220 7468 6520 7265   size for the re
-00011c70: 6164 2063 616c 6c2e 0a20 2020 2020 2020  ad call..       
-00011c80: 2020 2020 2020 2020 2069 6620 636f 6d70           if comp
-00011c90: 7265 7373 696f 6e49 6420 213d 2027 7a73  ressionId != 'zs
-00011ca0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-00011cb0: 2020 2020 2020 2020 636f 6d70 7265 7373          compress
-00011cc0: 6564 4669 6c65 6f62 6a2e 7265 6164 2831  edFileobj.read(1
-00011cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011ce0: 2020 636f 6d70 7265 7373 6564 4669 6c65    compressedFile
-00011cf0: 6f62 6a2e 636c 6f73 6528 290a 2020 2020  obj.close().    
-00011d00: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00011d10: 6f62 6a2e 7365 656b 286f 6c64 4f66 6673  obj.seek(oldOffs
-00011d20: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-00011d30: 2020 2020 7265 7475 726e 2063 6f6d 7072      return compr
-00011d40: 6573 7369 6f6e 4964 0a20 2020 2020 2020  essionId.       
-00011d50: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00011d60: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00011d70: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00011d80: 7269 6e74 4465 6275 6720 3e3d 2032 3a0a  rintDebug >= 2:.
-00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011da0: 2020 2020 7072 696e 7428 6622 5b57 6172      print(f"[War
-00011db0: 6e69 6e67 5d20 4120 6769 7665 6e20 6669  ning] A given fi
-00011dc0: 6c65 2077 6974 6820 6d61 6769 6320 6279  le with magic by
-00011dd0: 7465 7320 666f 7220 7b63 6f6d 7072 6573  tes for {compres
-00011de0: 7369 6f6e 4964 7d20 636f 756c 6420 6e6f  sionId} could no
-00011df0: 7420 6265 206f 7065 6e65 6420 6265 6361  t be opened beca
-00011e00: 7573 653a 2229 0a20 2020 2020 2020 2020  use:").         
-00011e10: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00011e20: 2865 290a 2020 2020 2020 2020 2020 2020  (e).            
-00011e30: 2020 2020 6669 6c65 6f62 6a2e 7365 656b      fileobj.seek
-00011e40: 286f 6c64 4f66 6673 6574 290a 0a20 2020  (oldOffset)..   
-00011e50: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00011e60: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00011e70: 686f 640a 2020 2020 6465 6620 5f64 6574  hod.    def _det
-00011e80: 6563 7454 6172 2866 696c 656f 626a 3a20  ectTar(fileobj: 
-00011e90: 494f 5b62 7974 6573 5d2c 2065 6e63 6f64  IO[bytes], encod
-00011ea0: 696e 673a 2073 7472 2920 2d3e 2062 6f6f  ing: str) -> boo
-00011eb0: 6c3a 0a20 2020 2020 2020 2069 6620 6e6f  l:.        if no
-00011ec0: 7420 6973 696e 7374 616e 6365 2866 696c  t isinstance(fil
-00011ed0: 656f 626a 2c20 696f 2e49 4f42 6173 6529  eobj, io.IOBase)
-00011ee0: 206f 7220 6e6f 7420 6669 6c65 6f62 6a2e   or not fileobj.
-00011ef0: 7365 656b 6162 6c65 2829 3a0a 2020 2020  seekable():.    
-00011f00: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00011f10: 616c 7365 0a0a 2020 2020 2020 2020 6f6c  alse..        ol
-00011f20: 644f 6666 7365 7420 3d20 6669 6c65 6f62  dOffset = fileob
-00011f30: 6a2e 7465 6c6c 2829 0a20 2020 2020 2020  j.tell().       
-00011f40: 2069 7354 6172 203d 2046 616c 7365 0a20   isTar = False. 
-00011f50: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00011f60: 2020 2020 2020 2020 7769 7468 2074 6172          with tar
-00011f70: 6669 6c65 2e6f 7065 6e28 6669 6c65 6f62  file.open(fileob
-00011f80: 6a3d 6669 6c65 6f62 6a2c 206d 6f64 653d  j=fileobj, mode=
-00011f90: 2772 3a27 2c20 656e 636f 6469 6e67 3d65  'r:', encoding=e
-00011fa0: 6e63 6f64 696e 6729 3a0a 2020 2020 2020  ncoding):.      
-00011fb0: 2020 2020 2020 2020 2020 6973 5461 7220            isTar 
-00011fc0: 3d20 5472 7565 0a20 2020 2020 2020 2065  = True.        e
-00011fd0: 7863 6570 7420 2874 6172 6669 6c65 2e52  xcept (tarfile.R
-00011fe0: 6561 6445 7272 6f72 2c20 7461 7266 696c  eadError, tarfil
-00011ff0: 652e 436f 6d70 7265 7373 696f 6e45 7272  e.CompressionErr
-00012000: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00012010: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
-00012020: 3d20 333a 0a20 2020 2020 2020 2020 2020  = 3:.           
-00012030: 2020 2020 2070 7269 6e74 2822 5b49 6e66       print("[Inf
-00012040: 6f5d 2046 696c 6520 6f62 6a65 6374 222c  o] File object",
-00012050: 2066 696c 656f 626a 2c20 2269 7320 6e6f   fileobj, "is no
-00012060: 7420 6120 5441 522e 2229 0a0a 2020 2020  t a TAR.")..    
-00012070: 2020 2020 6669 6c65 6f62 6a2e 7365 656b      fileobj.seek
-00012080: 286f 6c64 4f66 6673 6574 290a 2020 2020  (oldOffset).    
-00012090: 2020 2020 7265 7475 726e 2069 7354 6172      return isTar
-000120a0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-000120b0: 686f 640a 2020 2020 6465 6620 5f6f 7065  hod.    def _ope
-000120c0: 6e43 6f6d 7072 6573 7365 6446 696c 6528  nCompressedFile(
-000120d0: 6669 6c65 6f62 6a3a 2049 4f5b 6279 7465  fileobj: IO[byte
-000120e0: 735d 2c20 677a 6970 5365 656b 506f 696e  s], gzipSeekPoin
-000120f0: 7453 7061 6369 6e67 3a20 696e 742c 2065  tSpacing: int, e
-00012100: 6e63 6f64 696e 673a 2073 7472 2920 2d3e  ncoding: str) ->
-00012110: 2041 6e79 3a0a 2020 2020 2020 2020 2222   Any:.        ""
-00012120: 220a 2020 2020 2020 2020 4f70 656e 7320  ".        Opens 
-00012130: 6120 6669 6c65 2070 6f73 7369 626c 7920  a file possibly 
-00012140: 756e 646f 696e 6720 7468 6520 636f 6d70  undoing the comp
-00012150: 7265 7373 696f 6e2e 0a20 2020 2020 2020  ression..       
-00012160: 2052 6574 7572 6e73 2028 7461 725f 6669   Returns (tar_fi
-00012170: 6c65 5f6f 626a 2c20 7261 775f 6669 6c65  le_obj, raw_file
-00012180: 5f6f 626a 2c20 636f 6d70 7265 7373 696f  _obj, compressio
-00012190: 6e2c 2069 7354 6172 292e 0a20 2020 2020  n, isTar)..     
-000121a0: 2020 2072 6177 5f66 696c 655f 6f62 6a20     raw_file_obj 
-000121b0: 7769 6c6c 2062 6520 6e6f 6e65 2069 6620  will be none if 
-000121c0: 636f 6d70 7265 7373 696f 6e20 6973 204e  compression is N
-000121d0: 6f6e 652e 0a20 2020 2020 2020 2022 2222  one..        """
-000121e0: 0a20 2020 2020 2020 2063 6f6d 7072 6573  .        compres
-000121f0: 7369 6f6e 203d 2053 514c 6974 6549 6e64  sion = SQLiteInd
-00012200: 6578 6564 5461 722e 5f64 6574 6563 7443  exedTar._detectC
-00012210: 6f6d 7072 6573 7369 6f6e 2866 696c 656f  ompression(fileo
-00012220: 626a 290a 2020 2020 2020 2020 6966 2070  bj).        if p
-00012230: 7269 6e74 4465 6275 6720 3e3d 2033 3a0a  rintDebug >= 3:.
-00012240: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00012250: 7428 6622 5b49 6e66 6f5d 2044 6574 6563  t(f"[Info] Detec
-00012260: 7465 6420 636f 6d70 7265 7373 696f 6e20  ted compression 
-00012270: 7b63 6f6d 7072 6573 7369 6f6e 7d20 666f  {compression} fo
-00012280: 7220 6669 6c65 206f 626a 6563 743a 222c  r file object:",
-00012290: 2066 696c 656f 626a 290a 0a20 2020 2020   fileobj)..     
-000122a0: 2020 2069 6620 636f 6d70 7265 7373 696f     if compressio
-000122b0: 6e20 6e6f 7420 696e 2073 7570 706f 7274  n not in support
-000122c0: 6564 436f 6d70 7265 7373 696f 6e73 3a0a  edCompressions:.
-000122d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000122e0: 726e 2066 696c 656f 626a 2c20 4e6f 6e65  rn fileobj, None
-000122f0: 2c20 636f 6d70 7265 7373 696f 6e2c 2053  , compression, S
-00012300: 514c 6974 6549 6e64 6578 6564 5461 722e  QLiteIndexedTar.
-00012310: 5f64 6574 6563 7454 6172 2866 696c 656f  _detectTar(fileo
-00012320: 626a 2c20 656e 636f 6469 6e67 290a 0a20  bj, encoding).. 
-00012330: 2020 2020 2020 2063 696e 666f 203d 2073         cinfo = s
-00012340: 7570 706f 7274 6564 436f 6d70 7265 7373  upportedCompress
-00012350: 696f 6e73 5b63 6f6d 7072 6573 7369 6f6e  ions[compression
-00012360: 5d0a 2020 2020 2020 2020 6966 2063 696e  ].        if cin
-00012370: 666f 2e6d 6f64 756c 654e 616d 6520 6e6f  fo.moduleName no
-00012380: 7420 696e 2073 7973 2e6d 6f64 756c 6573  t in sys.modules
-00012390: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000123a0: 6973 6520 436f 6d70 7265 7373 696f 6e45  ise CompressionE
-000123b0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000123c0: 2020 2020 2020 2243 616e 2774 206f 7065        "Can't ope
-000123d0: 6e20 6120 7b7d 2063 6f6d 7072 6573 7365  n a {} compresse
-000123e0: 6420 6669 6c65 2027 7b7d 2720 7769 7468  d file '{}' with
-000123f0: 6f75 7420 7b7d 206d 6f64 756c 6521 222e  out {} module!".
-00012400: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
-00012410: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00012420: 7265 7373 696f 6e2c 2066 696c 656f 626a  ression, fileobj
-00012430: 2e6e 616d 652c 2063 696e 666f 2e6d 6f64  .name, cinfo.mod
-00012440: 756c 654e 616d 650a 2020 2020 2020 2020  uleName.        
-00012450: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00012460: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00012470: 2069 6620 636f 6d70 7265 7373 696f 6e20   if compression 
-00012480: 3d3d 2027 677a 273a 0a20 2020 2020 2020  == 'gz':.       
-00012490: 2020 2020 2023 2064 726f 705f 6861 6e64       # drop_hand
-000124a0: 6c65 7320 6b65 6570 7320 6120 6669 6c65  les keeps a file
-000124b0: 2068 616e 646c 6520 6f70 656e 696e 6720   handle opening 
-000124c0: 6173 2069 7320 7265 7175 6972 6564 2074  as is required t
-000124d0: 6f20 6361 6c6c 2074 656c 6c28 2920 6475  o call tell() du
-000124e0: 7269 6e67 2064 6563 6f64 696e 670a 2020  ring decoding.  
-000124f0: 2020 2020 2020 2020 2020 7461 725f 6669            tar_fi
-00012500: 6c65 203d 2069 6e64 6578 6564 5f67 7a69  le = indexed_gzi
-00012510: 702e 496e 6465 7865 6447 7a69 7046 696c  p.IndexedGzipFil
-00012520: 6528 6669 6c65 6f62 6a3d 6669 6c65 6f62  e(fileobj=fileob
-00012530: 6a2c 2064 726f 705f 6861 6e64 6c65 733d  j, drop_handles=
-00012540: 4661 6c73 652c 2073 7061 6369 6e67 3d67  False, spacing=g
-00012550: 7a69 7053 6565 6b50 6f69 6e74 5370 6163  zipSeekPointSpac
-00012560: 696e 6729 0a20 2020 2020 2020 2065 6c73  ing).        els
-00012570: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-00012580: 6172 5f66 696c 6520 3d20 6369 6e66 6f2e  ar_file = cinfo.
-00012590: 6f70 656e 2866 696c 656f 626a 290a 0a20  open(fileobj).. 
-000125a0: 2020 2020 2020 2072 6574 7572 6e20 7461         return ta
-000125b0: 725f 6669 6c65 2c20 6669 6c65 6f62 6a2c  r_file, fileobj,
-000125c0: 2063 6f6d 7072 6573 7369 6f6e 2c20 5351   compression, SQ
-000125d0: 4c69 7465 496e 6465 7865 6454 6172 2e5f  LiteIndexedTar._
-000125e0: 6465 7465 6374 5461 7228 7461 725f 6669  detectTar(tar_fi
-000125f0: 6c65 2c20 656e 636f 6469 6e67 290a 0a20  le, encoding).. 
-00012600: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00012610: 0a20 2020 2064 6566 205f 756e 6368 6563  .    def _unchec
-00012620: 6b65 6452 656d 6f76 6528 7061 7468 3a20  kedRemove(path: 
-00012630: 4f70 7469 6f6e 616c 5b41 6e79 5374 725d  Optional[AnyStr]
-00012640: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00012650: 2020 2020 2020 204f 6674 656e 2063 6c65         Often cle
-00012660: 616e 7570 2069 7320 676f 6f64 206d 616e  anup is good man
-00012670: 6e65 7273 2062 7574 2069 7420 776f 756c  ners but it woul
-00012680: 6420 6f6e 6c79 2062 6520 6f62 6e6f 7869  d only be obnoxi
-00012690: 6f75 7320 6966 2072 6174 6172 6d6f 756e  ous if ratarmoun
-000126a0: 7420 6372 6173 6865 6420 6f6e 2075 6e6e  t crashed on unn
-000126b0: 6563 6573 7361 7279 2063 6c65 616e 7570  ecessary cleanup
-000126c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000126d0: 2020 2020 2020 6966 206e 6f74 2070 6174        if not pat
-000126e0: 6820 6f72 206e 6f74 206f 732e 7061 7468  h or not os.path
-000126f0: 2e65 7869 7374 7328 7061 7468 293a 0a20  .exists(path):. 
-00012700: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012710: 6e0a 0a20 2020 2020 2020 2074 7279 3a0a  n..        try:.
-00012720: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00012730: 656d 6f76 6528 7061 7468 290a 2020 2020  emove(path).    
-00012740: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00012750: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00012760: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
-00012770: 675d 2043 6f75 6c64 206e 6f74 2072 656d  g] Could not rem
-00012780: 6f76 653a 222c 2070 6174 6829 0a0a 2020  ove:", path)..  
-00012790: 2020 6465 6620 5f6c 6f61 644f 7253 746f    def _loadOrSto
-000127a0: 7265 436f 6d70 7265 7373 696f 6e4f 6666  reCompressionOff
-000127b0: 7365 7473 2873 656c 6629 3a0a 2020 2020  sets(self):.    
-000127c0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000127d0: 696e 6465 7846 696c 654e 616d 6520 6f72  indexFileName or
-000127e0: 2073 656c 662e 696e 6465 7846 696c 654e   self.indexFileN
-000127f0: 616d 6520 3d3d 2027 3a6d 656d 6f72 793a  ame == ':memory:
-00012800: 273a 0a20 2020 2020 2020 2020 2020 2069  ':.            i
-00012810: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
-00012820: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00012830: 2020 2070 7269 6e74 2822 5b49 6e66 6f5d     print("[Info]
-00012840: 2057 696c 6c20 736b 6970 2073 746f 7269   Will skip stori
-00012850: 6e67 2063 6f6d 7072 6573 7369 6f6e 2073  ng compression s
-00012860: 6565 6b20 6461 7461 2062 6563 6175 7365  eek data because
-00012870: 2074 6865 2064 6174 6162 6173 6520 6973   the database is
-00012880: 2069 6e20 6d65 6d6f 7279 2e22 290a 2020   in memory.").  
-00012890: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000128a0: 696e 7428 225b 496e 666f 5d20 4966 2074  int("[Info] If t
-000128b0: 6865 2064 6174 6162 6173 6520 6973 2069  he database is i
-000128c0: 6e20 6d65 6d6f 7279 2c20 7468 656e 2074  n memory, then t
-000128d0: 6869 7320 6461 7461 2077 696c 6c20 6e6f  his data will no
-000128e0: 7420 6265 2072 6561 6420 616e 7977 6179  t be read anyway
-000128f0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00012900: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
-00012910: 2320 5468 6973 2073 686f 756c 6420 6265  # This should be
-00012920: 2063 616c 6c65 6420 6166 7465 7220 7468   called after th
-00012930: 6520 5441 5220 6669 6c65 2069 6e64 6578  e TAR file index
-00012940: 2069 7320 636f 6d70 6c65 7465 2028 6c6f   is complete (lo
-00012950: 6164 6564 206f 7220 6372 6561 7465 6429  aded or created)
-00012960: 2e0a 2020 2020 2020 2020 2320 4966 2074  ..        # If t
-00012970: 6865 2054 4152 2066 696c 6520 696e 6465  he TAR file inde
-00012980: 7820 7761 7320 6372 6561 7465 642c 2074  x was created, t
-00012990: 6865 6e20 7461 7266 696c 6520 6861 7320  hen tarfile has 
-000129a0: 6974 6572 6174 6564 206f 7665 7220 7468  iterated over th
-000129b0: 6520 7768 6f6c 6520 6669 6c65 206f 6e63  e whole file onc
-000129c0: 650a 2020 2020 2020 2020 2320 616e 6420  e.        # and 
-000129d0: 7468 6572 6566 6f72 6520 636f 6d70 6c65  therefore comple
-000129e0: 7465 6420 7468 6520 696d 706c 6963 6974  ted the implicit
-000129f0: 2063 6f6d 7072 6573 7369 6f6e 206f 6666   compression off
-00012a00: 7365 7420 6372 6561 7469 6f6e 2e0a 2020  set creation..  
-00012a10: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00012a20: 662e 7371 6c43 6f6e 6e65 6374 696f 6e3a  f.sqlConnection:
-00012a30: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00012a40: 7365 2049 6e64 6578 4e6f 744f 7065 6e45  se IndexNotOpenE
-00012a50: 7272 6f72 2822 5468 6973 206d 6574 686f  rror("This metho
-00012a60: 6420 6361 6e20 6e6f 7420 6265 2063 616c  d can not be cal
-00012a70: 6c65 6420 7769 7468 6f75 7420 616e 206f  led without an o
-00012a80: 7065 6e65 6420 696e 6465 7820 6461 7461  pened index data
-00012a90: 6261 7365 2122 290a 2020 2020 2020 2020  base!").        
-00012aa0: 6462 203d 2073 656c 662e 7371 6c43 6f6e  db = self.sqlCon
-00012ab0: 6e65 6374 696f 6e0a 2020 2020 2020 2020  nection.        
-00012ac0: 6669 6c65 4f62 6a65 6374 203d 2073 656c  fileObject = sel
-00012ad0: 662e 7461 7246 696c 654f 626a 6563 740a  f.tarFileObject.
-00012ae0: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-00012af0: 2020 2020 2020 2020 2020 6861 7361 7474            hasatt
-00012b00: 7228 6669 6c65 4f62 6a65 6374 2c20 2773  r(fileObject, 's
-00012b10: 6574 5f62 6c6f 636b 5f6f 6666 7365 7473  et_block_offsets
-00012b20: 2729 0a20 2020 2020 2020 2020 2020 2061  ').            a
-00012b30: 6e64 2068 6173 6174 7472 2866 696c 654f  nd hasattr(fileO
-00012b40: 626a 6563 742c 2027 626c 6f63 6b5f 6f66  bject, 'block_of
-00012b50: 6673 6574 7327 290a 2020 2020 2020 2020  fsets').        
-00012b60: 2020 2020 616e 6420 7365 6c66 2e63 6f6d      and self.com
-00012b70: 7072 6573 7369 6f6e 2069 6e20 5b27 627a  pression in ['bz
-00012b80: 3227 2c20 277a 7374 275d 0a20 2020 2020  2', 'zst'].     
-00012b90: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00012ba0: 2020 6966 2073 656c 662e 636f 6d70 7265    if self.compre
-00012bb0: 7373 696f 6e20 3d3d 2027 627a 3227 3a0a  ssion == 'bz2':.
-00012bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bd0: 7461 626c 655f 6e61 6d65 203d 2027 627a  table_name = 'bz
-00012be0: 6970 3262 6c6f 636b 7327 0a20 2020 2020  ip2blocks'.     
-00012bf0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00012c00: 2e63 6f6d 7072 6573 7369 6f6e 203d 3d20  .compression == 
-00012c10: 277a 7374 273a 0a20 2020 2020 2020 2020  'zst':.         
-00012c20: 2020 2020 2020 2074 6162 6c65 5f6e 616d         table_nam
-00012c30: 6520 3d20 277a 7374 6462 6c6f 636b 7327  e = 'zstdblocks'
-00012c40: 0a0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00012c50: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00012c60: 2020 206f 6666 7365 7473 203d 2064 6963     offsets = dic
-00012c70: 7428 6462 2e65 7865 6375 7465 2827 5345  t(db.execute('SE
-00012c80: 4c45 4354 2062 6c6f 636b 6f66 6673 6574  LECT blockoffset
-00012c90: 2c64 6174 616f 6666 7365 7420 4652 4f4d  ,dataoffset FROM
-00012ca0: 207b 7d3b 272e 666f 726d 6174 2874 6162   {};'.format(tab
-00012cb0: 6c65 5f6e 616d 6529 2929 0a20 2020 2020  le_name))).     
-00012cc0: 2020 2020 2020 2020 2020 2066 696c 654f             fileO
-00012cd0: 626a 6563 742e 7365 745f 626c 6f63 6b5f  bject.set_block_
-00012ce0: 6f66 6673 6574 7328 6f66 6673 6574 7329  offsets(offsets)
-00012cf0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00012d00: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00012d10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012d20: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
-00012d30: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00012d40: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00012d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d60: 2020 2020 2020 225b 496e 666f 5d20 436f        "[Info] Co
-00012d70: 756c 6420 6e6f 7420 6c6f 6164 207b 7d20  uld not load {} 
-00012d80: 626c 6f63 6b20 6f66 6673 6574 2064 6174  block offset dat
-00012d90: 612e 2057 696c 6c20 6372 6561 7465 2069  a. Will create i
-00012da0: 7420 6672 6f6d 2073 6372 6174 6368 2e22  t from scratch."
-00012db0: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-00012dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dd0: 2020 2020 2073 656c 662e 636f 6d70 7265       self.compre
-00012de0: 7373 696f 6e0a 2020 2020 2020 2020 2020  ssion.          
-00012df0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00012e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e10: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00012e20: 2020 2020 2020 2074 6162 6c65 7320 3d20         tables = 
-00012e30: 5b78 5b30 5d20 666f 7220 7820 696e 2064  [x[0] for x in d
-00012e40: 622e 6578 6563 7574 6528 2753 454c 4543  b.execute('SELEC
-00012e50: 5420 6e61 6d65 2046 524f 4d20 7371 6c69  T name FROM sqli
-00012e60: 7465 5f6d 6173 7465 7220 5748 4552 4520  te_master WHERE 
-00012e70: 7479 7065 3d22 7461 626c 6522 3b27 295d  type="table";')]
-00012e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012e90: 2069 6620 7461 626c 655f 6e61 6d65 2069   if table_name i
-00012ea0: 6e20 7461 626c 6573 3a0a 2020 2020 2020  n tables:.      
-00012eb0: 2020 2020 2020 2020 2020 2020 2020 6462                db
-00012ec0: 2e65 7865 6375 7465 2827 4452 4f50 2054  .execute('DROP T
-00012ed0: 4142 4c45 207b 7d27 2e66 6f72 6d61 7428  ABLE {}'.format(
-00012ee0: 7461 626c 655f 6e61 6d65 2929 0a20 2020  table_name)).   
-00012ef0: 2020 2020 2020 2020 2020 2020 2064 622e               db.
-00012f00: 6578 6563 7574 6528 2743 5245 4154 4520  execute('CREATE 
-00012f10: 5441 424c 4520 7b7d 2028 2062 6c6f 636b  TABLE {} ( block
-00012f20: 6f66 6673 6574 2049 4e54 4547 4552 2050  offset INTEGER P
-00012f30: 5249 4d41 5259 204b 4559 2c20 6461 7461  RIMARY KEY, data
-00012f40: 6f66 6673 6574 2049 4e54 4547 4552 2029  offset INTEGER )
-00012f50: 272e 666f 726d 6174 2874 6162 6c65 5f6e  '.format(table_n
-00012f60: 616d 6529 290a 2020 2020 2020 2020 2020  ame)).          
-00012f70: 2020 2020 2020 6462 2e65 7865 6375 7465        db.execute
-00012f80: 6d61 6e79 2827 494e 5345 5254 2049 4e54  many('INSERT INT
-00012f90: 4f20 7b7d 2056 414c 5545 5320 283f 2c3f  O {} VALUES (?,?
-00012fa0: 2927 2e66 6f72 6d61 7428 7461 626c 655f  )'.format(table_
-00012fb0: 6e61 6d65 292c 2066 696c 654f 626a 6563  name), fileObjec
-00012fc0: 742e 626c 6f63 6b5f 6f66 6673 6574 7328  t.block_offsets(
-00012fd0: 292e 6974 656d 7328 2929 0a20 2020 2020  ).items()).     
-00012fe0: 2020 2020 2020 2020 2020 2064 622e 636f             db.co
-00012ff0: 6d6d 6974 2829 0a20 2020 2020 2020 2020  mmit().         
-00013000: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-00013010: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00013020: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
-00013030: 2020 2020 2020 2020 2020 2068 6173 6174             hasat
-00013040: 7472 2820 6669 6c65 4f62 6a65 6374 2c20  tr( fileObject, 
-00013050: 2769 6d70 6f72 745f 696e 6465 7827 2029  'import_index' )
-00013060: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-00013070: 2068 6173 6174 7472 2820 6669 6c65 4f62   hasattr( fileOb
-00013080: 6a65 6374 2c20 2765 7870 6f72 745f 696e  ject, 'export_in
-00013090: 6465 7827 2029 0a20 2020 2020 2020 2020  dex' ).         
-000130a0: 2020 2061 6e64 2073 656c 662e 636f 6d70     and self.comp
-000130b0: 7265 7373 696f 6e20 3d3d 2027 677a 270a  ression == 'gz'.
-000130c0: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
-000130d0: 743a 206f 6e0a 2020 2020 2020 2020 293a  t: on.        ):
-000130e0: 0a20 2020 2020 2020 2020 2020 2074 6162  .            tab
-000130f0: 6c65 7320 3d20 5b78 5b30 5d20 666f 7220  les = [x[0] for 
-00013100: 7820 696e 2064 622e 6578 6563 7574 6528  x in db.execute(
-00013110: 2753 454c 4543 5420 6e61 6d65 2046 524f  'SELECT name FRO
-00013120: 4d20 7371 6c69 7465 5f6d 6173 7465 7220  M sqlite_master 
-00013130: 5748 4552 4520 7479 7065 3d22 7461 626c  WHERE type="tabl
-00013140: 6522 2729 5d0a 0a20 2020 2020 2020 2020  e"')]..         
-00013150: 2020 2023 2069 6e64 6578 6564 5f67 7a69     # indexed_gzi
-00013160: 7020 696e 6465 7820 6f6e 6c79 2068 6173  p index only has
-00013170: 2061 2066 696c 6520 6261 7365 6420 4150   a file based AP
-00013180: 492c 2073 6f20 7765 206e 6565 6420 746f  I, so we need to
-00013190: 2077 7269 7465 2061 6c6c 2074 6865 2069   write all the i
-000131a0: 6e64 6578 2064 6174 6120 6672 6f6d 2074  ndex data from t
-000131b0: 6865 2053 514c 0a20 2020 2020 2020 2020  he SQL.         
-000131c0: 2020 2023 2064 6174 6162 6173 6520 6f75     # database ou
-000131d0: 7420 696e 746f 2061 2074 656d 706f 7261  t into a tempora
-000131e0: 7279 2066 696c 652e 2046 6f72 2074 6861  ry file. For tha
-000131f0: 742c 206c 6574 2773 2066 6972 7374 2074  t, let's first t
-00013200: 7279 2074 6f20 7573 6520 7468 6520 7361  ry to use the sa
-00013210: 6d65 206c 6f63 6174 696f 6e20 6173 2074  me location as t
-00013220: 6865 2053 514c 6974 650a 2020 2020 2020  he SQLite.      
-00013230: 2020 2020 2020 2320 6461 7461 6261 7365        # database
-00013240: 2062 6563 6175 7365 2069 7420 7368 6f75   because it shou
-00013250: 6c64 2068 6176 6520 7375 6666 6963 6965  ld have sufficie
-00013260: 6e74 2077 7269 7469 6e67 2072 6967 6874  nt writing right
-00013270: 7320 616e 6420 6672 6565 2064 6973 6b20  s and free disk 
-00013280: 7370 6163 652e 0a20 2020 2020 2020 2020  space..         
-00013290: 2020 2067 7a69 6e64 6578 203d 204e 6f6e     gzindex = Non
-000132a0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-000132b0: 7220 746d 7044 6972 2069 6e20 5b6f 732e  r tmpDir in [os.
-000132c0: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-000132d0: 662e 696e 6465 7846 696c 654e 616d 6529  f.indexFileName)
-000132e0: 2c20 4e6f 6e65 5d3a 0a20 2020 2020 2020  , None]:.       
-000132f0: 2020 2020 2020 2020 2069 6620 2767 7a69           if 'gzi
-00013300: 7069 6e64 6578 2720 6e6f 7420 696e 2074  pindex' not in t
-00013310: 6162 6c65 7320 616e 6420 2767 7a69 7069  ables and 'gzipi
-00013320: 6e64 6578 6573 2720 6e6f 7420 696e 2074  ndexes' not in t
-00013330: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
-00013340: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00013350: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013360: 2020 2320 5472 7920 746f 2065 7870 6f72    # Try to expor
-00013370: 7420 6461 7461 2066 726f 6d20 5351 4c69  t data from SQLi
-00013380: 7465 2064 6174 6162 6173 652e 204e 6f74  te database. Not
-00013390: 6520 7468 6174 206e 6f20 6572 726f 7220  e that no error 
-000133a0: 6368 6563 6b69 6e67 2061 6761 696e 7374  checking against
-000133b0: 2074 6865 2065 7869 7374 656e 6365 206f   the existence o
-000133c0: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-000133d0: 2020 2320 677a 6970 696e 6465 7820 7461    # gzipindex ta
-000133e0: 626c 6520 6973 2064 6f6e 6520 6265 6361  ble is done beca
-000133f0: 7573 6520 7468 6520 6578 706f 7274 6564  use the exported
-00013400: 2064 6174 6120 6974 7365 6c66 206d 6967   data itself mig
-00013410: 6874 2061 6c73 6f20 6265 2077 726f 6e67  ht also be wrong
-00013420: 2061 6e64 2077 6520 6361 6e27 7420 6368   and we can't ch
-00013430: 6563 6b0a 2020 2020 2020 2020 2020 2020  eck.            
-00013440: 2020 2020 2320 6167 6169 6e73 7420 7468      # against th
-00013450: 6973 2e20 5468 6572 6566 6f72 652c 2063  is. Therefore, c
-00013460: 6f6c 6c61 7465 2061 6c6c 2065 7272 6f72  ollate all error
-00013470: 2063 6865 636b 696e 6720 6279 2063 6174   checking by cat
-00013480: 6368 696e 6720 6578 6365 7074 696f 6e73  ching exceptions
-00013490: 2e0a 0a20 2020 2020 2020 2020 2020 2020  ...             
-000134a0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000134b0: 2020 2020 2020 2020 2020 2020 677a 696e              gzin
-000134c0: 6465 7820 3d20 7465 6d70 6669 6c65 2e6d  dex = tempfile.m
-000134d0: 6b73 7465 6d70 2864 6972 3d74 6d70 4469  kstemp(dir=tmpDi
-000134e0: 7229 5b31 5d0a 2020 2020 2020 2020 2020  r)[1].          
-000134f0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-00013500: 7065 6e28 677a 696e 6465 782c 2027 7762  pen(gzindex, 'wb
-00013510: 2729 2061 7320 6669 6c65 3a0a 2020 2020  ') as file:.    
-00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013530: 2020 2020 6966 2027 677a 6970 696e 6465      if 'gzipinde
-00013540: 7865 7327 2069 6e20 7461 626c 6573 3a0a  xes' in tables:.
-00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013560: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
-00013570: 7920 746f 2072 6561 6420 696e 6465 7820  y to read index 
-00013580: 6669 6c65 7320 636f 6e74 6169 6e69 6e67  files containing
-00013590: 2076 6572 7920 6c61 7267 6520 677a 6970   very large gzip
-000135a0: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
-000135b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135c0: 2020 2020 2072 6f77 7320 3d20 6462 2e65       rows = db.e
-000135d0: 7865 6375 7465 2827 5345 4c45 4354 2064  xecute('SELECT d
-000135e0: 6174 6120 4652 4f4d 2067 7a69 7069 6e64  ata FROM gzipind
-000135f0: 6578 6573 204f 5244 4552 2042 5920 524f  exes ORDER BY RO
-00013600: 5749 4427 290a 2020 2020 2020 2020 2020  WID').          
-00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013620: 2020 666f 7220 726f 7720 696e 2072 6f77    for row in row
-00013630: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013650: 2020 2066 696c 652e 7772 6974 6528 726f     file.write(ro
-00013660: 775b 305d 290a 2020 2020 2020 2020 2020  w[0]).          
-00013670: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00013680: 6966 2027 677a 6970 696e 6465 7827 2069  if 'gzipindex' i
-00013690: 6e20 7461 626c 6573 3a0a 2020 2020 2020  n tables:.      
-000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136b0: 2020 2020 2020 2320 5472 7920 746f 2072        # Try to r
-000136c0: 6561 6420 6c65 6761 6379 2069 6e64 6578  ead legacy index
-000136d0: 2066 696c 6573 2077 6974 6820 6578 6163   files with exac
-000136e0: 746c 7920 6f6e 6520 626c 6f62 2e0a 2020  tly one blob..  
-000136f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013700: 2020 2020 2020 2020 2020 2320 5468 6973            # This
-00013710: 2069 7320 686f 7720 6f6c 6420 7261 7461   is how old rata
-00013720: 726d 6f75 6e74 2076 6572 7369 6f6e 2072  rmount version r
-00013730: 6561 6420 6974 2e20 492e 652e 2c20 6966  ead it. I.e., if
-00013740: 2074 6865 7265 2077 6572 6520 7369 6d70   there were simp
-00013750: 6c79 206d 6f72 6520 7468 616e 206f 6e65  ly more than one
-00013760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013770: 2020 2020 2020 2020 2020 2020 2023 2062               # b
-00013780: 6c6f 6220 696e 2074 6865 2073 616d 6520  lob in the same 
-00013790: 7462 616c 652c 2074 6865 6e20 6974 2077  tbale, then it w
-000137a0: 6f75 6c64 2069 676e 6f72 6520 616c 6c20  ould ignore all 
-000137b0: 6275 7420 7468 6520 6669 7273 7428 3f21  but the first(?!
-000137c0: 2920 616e 6420 4920 616d 206e 6f74 2073  ) and I am not s
-000137d0: 7572 650a 2020 2020 2020 2020 2020 2020  ure.            
+00010bf0: 2020 2020 2027 677a 6970 5365 656b 506f       'gzipSeekPo
+00010c00: 696e 7453 7061 6369 6e67 272c 0a20 2020  intSpacing',.   
+00010c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c20: 2020 2020 2027 656e 636f 6469 6e67 272c       'encoding',
+00010c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010c40: 2020 2020 2020 2020 2027 7374 7269 7052           'stripR
+00010c50: 6563 7572 7369 7665 5461 7245 7874 656e  ecursiveTarExten
+00010c60: 7369 6f6e 272c 0a20 2020 2020 2020 2020  sion',.         
+00010c70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00010c80: 6967 6e6f 7265 5a65 726f 7327 2c0a 2020  ignoreZeros',.  
+00010c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ca0: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
+00010cb0: 2020 2020 2020 2020 6469 6666 6572 696e          differin
+00010cc0: 6741 7267 7320 3d20 5b5d 0a20 2020 2020  gArgs = [].     
+00010cd0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010ce0: 6f72 2061 7267 2069 6e20 6172 6775 6d65  or arg in argume
+00010cf0: 6e74 7354 6f43 6865 636b 3a0a 2020 2020  ntsToCheck:.    
+00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d10: 2020 2020 6966 2061 7267 2069 6e20 696e      if arg in in
+00010d20: 6465 7841 7267 7320 616e 6420 6861 7361  dexArgs and hasa
+00010d30: 7474 7228 7365 6c66 2c20 6172 6729 2061  ttr(self, arg) a
+00010d40: 6e64 2069 6e64 6578 4172 6773 5b61 7267  nd indexArgs[arg
+00010d50: 5d20 213d 2067 6574 6174 7472 2873 656c  ] != getattr(sel
+00010d60: 662c 2061 7267 293a 0a20 2020 2020 2020  f, arg):.       
+00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d80: 2020 2020 2064 6966 6665 7269 6e67 4172       differingAr
+00010d90: 6773 2e61 7070 656e 6428 2861 7267 2c20  gs.append((arg, 
+00010da0: 696e 6465 7841 7267 735b 6172 675d 2c20  indexArgs[arg], 
+00010db0: 6765 7461 7474 7228 7365 6c66 2c20 6172  getattr(self, ar
+00010dc0: 6729 2929 0a20 2020 2020 2020 2020 2020  g))).           
+00010dd0: 2020 2020 2020 2020 2069 6620 6469 6666           if diff
+00010de0: 6572 696e 6741 7267 733a 0a20 2020 2020  eringArgs:.     
+00010df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e00: 2020 2070 7269 6e74 2822 5b57 6172 6e69     print("[Warni
+00010e10: 6e67 5d20 5468 6520 6172 6775 6d65 6e74  ng] The argument
+00010e20: 7320 7573 6564 2066 6f72 2063 7265 6174  s used for creat
+00010e30: 696e 6720 7468 6520 666f 756e 6420 696e  ing the found in
+00010e40: 6465 7820 6469 6666 6572 2066 726f 6d20  dex differ from 
+00010e50: 7468 6520 6172 6775 6d65 6e74 7320 2229  the arguments ")
+00010e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010e70: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00010e80: 5b57 6172 6e69 6e67 5d20 6769 7665 6e20  [Warning] given 
+00010e90: 666f 7220 6d6f 756e 7469 6e67 2074 6865  for mounting the
+00010ea0: 2061 7263 6869 7665 206e 6f77 2e20 496e   archive now. In
+00010eb0: 206f 7264 6572 2074 6f20 6170 706c 7920   order to apply 
+00010ec0: 7468 6573 6520 6368 616e 6765 732c 2022  these changes, "
+00010ed0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010ee0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00010ef0: 225b 5761 726e 696e 675d 2072 6563 7265  "[Warning] recre
+00010f00: 6174 6520 7468 6520 696e 6465 7820 7573  ate the index us
+00010f10: 696e 6720 7468 6520 2d2d 7265 6372 6561  ing the --recrea
+00010f20: 7465 2d69 6e64 6578 206f 7074 696f 6e21  te-index option!
+00010f30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00010f40: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+00010f50: 7267 2c20 6f6c 6453 7461 7465 2c20 6e65  rg, oldState, ne
+00010f60: 7753 7461 7465 2069 6e20 6469 6666 6572  wState in differ
+00010f70: 696e 6741 7267 733a 0a20 2020 2020 2020  ingArgs:.       
+00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f90: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
+00010fa0: 6e69 6e67 5d20 7b7d 3a20 696e 6465 783a  ning] {}: index:
+00010fb0: 207b 7d2c 2063 7572 7265 6e74 3a20 7b7d   {}, current: {}
+00010fc0: 222e 666f 726d 6174 2861 7267 2c20 6f6c  ".format(arg, ol
+00010fd0: 6453 7461 7465 2c20 6e65 7753 7461 7465  dState, newState
+00010fe0: 2929 0a0a 2020 2020 2020 2020 6578 6365  ))..        exce
+00010ff0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00011000: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00011010: 2069 6e64 6578 4973 4c6f 6164 6564 2063   indexIsLoaded c
+00011020: 6865 636b 7320 7365 6c66 2e73 716c 436f  hecks self.sqlCo
+00011030: 6e6e 6563 7469 6f6e 2c20 736f 2063 6c6f  nnection, so clo
+00011040: 7365 2069 7420 6265 666f 7265 2072 6574  se it before ret
+00011050: 7572 6e69 6e67 2062 6563 6175 7365 2069  urning because i
+00011060: 7420 7761 7320 666f 756e 6420 746f 2062  t was found to b
+00011070: 6520 6661 756c 7479 0a20 2020 2020 2020  e faulty.       
+00011080: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00011090: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000110a0: 716c 436f 6e6e 6563 7469 6f6e 2e63 6c6f  qlConnection.clo
+000110b0: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+000110c0: 2065 7863 6570 7420 7371 6c69 7465 332e   except sqlite3.
+000110d0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+000110e0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+000110f0: 2020 2020 2020 2020 7365 6c66 2e73 716c          self.sql
+00011100: 436f 6e6e 6563 7469 6f6e 203d 204e 6f6e  Connection = Non
+00011110: 650a 0a20 2020 2020 2020 2020 2020 2072  e..            r
+00011120: 6169 7365 2065 0a0a 2020 2020 2020 2020  aise e..        
+00011130: 6966 2070 7269 6e74 4465 6275 6720 3e3d  if printDebug >=
+00011140: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00011150: 2320 4c65 6761 6379 206f 7574 7075 7420  # Legacy output 
+00011160: 666f 7220 6175 746f 6d61 7465 6420 7465  for automated te
+00011170: 7374 730a 2020 2020 2020 2020 2020 2020  sts.            
+00011180: 7072 696e 7428 224c 6f61 6469 6e67 206f  print("Loading o
+00011190: 6666 7365 7420 6469 6374 696f 6e61 7279  ffset dictionary
+000111a0: 2066 726f 6d22 2c20 696e 6465 7846 696c   from", indexFil
+000111b0: 654e 616d 652c 2022 746f 6f6b 207b 3a2e  eName, "took {:.
+000111c0: 3266 7d73 222e 666f 726d 6174 2874 696d  2f}s".format(tim
+000111d0: 652e 7469 6d65 2829 202d 2074 3029 290a  e.time() - t0)).
+000111e0: 0a20 2020 2064 6566 205f 7472 794c 6f61  .    def _tryLoa
+000111f0: 6449 6e64 6578 2873 656c 662c 2069 6e64  dIndex(self, ind
+00011200: 6578 4669 6c65 4e61 6d65 3a20 416e 7953  exFileName: AnyS
+00011210: 7472 2920 2d3e 2062 6f6f 6c3a 0a20 2020  tr) -> bool:.   
+00011220: 2020 2020 2022 2222 6361 6c6c 7320 6c6f       """calls lo
+00011230: 6164 496e 6465 7820 6966 2069 6e64 6578  adIndex if index
+00011240: 2069 7320 6e6f 7420 6c6f 6164 6564 2061   is not loaded a
+00011250: 6c72 6561 6479 2061 6e64 2070 726f 7669  lready and provi
+00011260: 6465 7320 6578 7465 6e73 6976 6520 6572  des extensive er
+00011270: 726f 7220 6861 6e64 6c69 6e67 2222 220a  ror handling""".
+00011280: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00011290: 2e69 6e64 6578 4973 4c6f 6164 6564 2829  .indexIsLoaded()
+000112a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000112b0: 7475 726e 2054 7275 650a 0a20 2020 2020  turn True..     
+000112c0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+000112d0: 682e 6973 6669 6c65 2869 6e64 6578 4669  h.isfile(indexFi
+000112e0: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
+000112f0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00011300: 650a 0a20 2020 2020 2020 2074 7279 3a0a  e..        try:.
+00011310: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011320: 2e6c 6f61 6449 6e64 6578 2869 6e64 6578  .loadIndex(index
+00011330: 4669 6c65 4e61 6d65 290a 2020 2020 2020  FileName).      
+00011340: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00011350: 6f6e 2061 7320 6578 6365 7074 696f 6e3a  on as exception:
+00011360: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011370: 7072 696e 7444 6562 7567 203e 3d20 333a  printDebug >= 3:
+00011380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011390: 2074 7261 6365 6261 636b 2e70 7269 6e74   traceback.print
+000113a0: 5f65 7863 2829 0a0a 2020 2020 2020 2020  _exc()..        
+000113b0: 2020 2020 7072 696e 7428 225b 5761 726e      print("[Warn
+000113c0: 696e 675d 2043 6f75 6c64 206e 6f74 206c  ing] Could not l
+000113d0: 6f61 6420 6669 6c65 3a22 2c20 696e 6465  oad file:", inde
+000113e0: 7846 696c 654e 616d 6529 0a20 2020 2020  xFileName).     
+000113f0: 2020 2020 2020 2070 7269 6e74 2822 5b49         print("[I
+00011400: 6e66 6f5d 2045 7863 6570 7469 6f6e 3a22  nfo] Exception:"
+00011410: 2c20 6578 6365 7074 696f 6e29 0a20 2020  , exception).   
+00011420: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00011430: 5b49 6e66 6f5d 2053 6f6d 6520 6c69 6b65  [Info] Some like
+00011440: 6c79 2072 6561 736f 6e73 2066 6f72 206e  ly reasons for n
+00011450: 6f74 2062 6569 6e67 2061 626c 6520 746f  ot being able to
+00011460: 206c 6f61 6420 7468 6520 696e 6465 7820   load the index 
+00011470: 6669 6c65 3a22 290a 2020 2020 2020 2020  file:").        
+00011480: 2020 2020 7072 696e 7428 225b 496e 666f      print("[Info
+00011490: 5d20 2020 2d20 5468 6520 696e 6465 7820  ]   - The index 
+000114a0: 6669 6c65 2068 6173 2069 6e63 6f72 7265  file has incorre
+000114b0: 6374 2072 6561 6420 7065 726d 6973 7369  ct read permissi
+000114c0: 6f6e 7322 290a 2020 2020 2020 2020 2020  ons").          
+000114d0: 2020 7072 696e 7428 225b 496e 666f 5d20    print("[Info] 
+000114e0: 2020 2d20 5468 6520 696e 6465 7820 6669    - The index fi
+000114f0: 6c65 2069 7320 696e 636f 6d70 6c65 7465  le is incomplete
+00011500: 2062 6563 6175 7365 2072 6174 6172 6d6f   because ratarmo
+00011510: 756e 7420 7761 7320 6b69 6c6c 6564 2064  unt was killed d
+00011520: 7572 696e 6720 696e 6465 7820 6372 6561  uring index crea
+00011530: 7469 6f6e 2229 0a20 2020 2020 2020 2020  tion").         
+00011540: 2020 2070 7269 6e74 2822 5b49 6e66 6f5d     print("[Info]
+00011550: 2020 202d 2054 6865 2069 6e64 6578 2066     - The index f
+00011560: 696c 6520 7761 7320 6465 7465 6374 6564  ile was detected
+00011570: 2074 6f20 636f 6e74 6169 6e20 6572 726f   to contain erro
+00011580: 7273 2062 6563 6175 7365 206f 6620 6b6e  rs because of kn
+00011590: 6f77 6e20 6275 6773 206f 6620 6f6c 6465  own bugs of olde
+000115a0: 7220 7665 7273 696f 6e73 2229 0a20 2020  r versions").   
+000115b0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000115c0: 5b49 6e66 6f5d 2020 202d 2054 6865 2069  [Info]   - The i
+000115d0: 6e64 6578 2066 696c 6520 676f 7420 636f  ndex file got co
+000115e0: 7272 7570 7465 6420 6265 6361 7573 6520  rrupted because 
+000115f0: 6f66 3a22 290a 2020 2020 2020 2020 2020  of:").          
+00011600: 2020 7072 696e 7428 225b 496e 666f 5d20    print("[Info] 
+00011610: 2020 2020 2d20 5468 6520 7072 6f67 7261      - The progra
+00011620: 6d20 6578 6974 6564 2077 6869 6c65 2069  m exited while i
+00011630: 7420 7761 7320 7374 696c 6c20 7772 6974  t was still writ
+00011640: 696e 6720 7468 6520 696e 6465 7820 6265  ing the index be
+00011650: 6361 7573 6520 6f66 3a22 290a 2020 2020  cause of:").    
+00011660: 2020 2020 2020 2020 7072 696e 7428 225b          print("[
+00011670: 496e 666f 5d20 2020 2020 2020 2d20 7468  Info]       - th
+00011680: 6520 7573 6572 2073 656e 7420 5349 4749  e user sent SIGI
+00011690: 4e54 2074 6f20 666f 7263 6520 7468 6520  NT to force the 
+000116a0: 7072 6f67 7261 6d20 746f 2071 7569 7422  program to quit"
+000116b0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+000116c0: 696e 7428 225b 496e 666f 5d20 2020 2020  int("[Info]     
+000116d0: 2020 2d20 616e 2069 6e74 6572 6e61 6c20    - an internal 
+000116e0: 6572 726f 7220 6f63 6375 7265 6420 7768  error occured wh
+000116f0: 696c 6520 7772 6974 696e 6720 7468 6520  ile writing the 
+00011700: 696e 6465 7822 290a 2020 2020 2020 2020  index").        
+00011710: 2020 2020 7072 696e 7428 225b 496e 666f      print("[Info
+00011720: 5d20 2020 2020 2020 2d20 7468 6520 6469  ]       - the di
+00011730: 736b 2066 696c 6c65 6420 7570 2077 6869  sk filled up whi
+00011740: 6c65 2077 7269 7469 6e67 2074 6865 2069  le writing the i
+00011750: 6e64 6578 2229 0a20 2020 2020 2020 2020  ndex").         
+00011760: 2020 2070 7269 6e74 2822 5b49 6e66 6f5d     print("[Info]
+00011770: 2020 2020 202d 2052 6172 6520 6c6f 776c       - Rare lowl
+00011780: 6576 656c 2063 6f72 7275 7074 696f 6e73  evel corruptions
+00011790: 2063 6175 7365 6420 6279 2068 6172 6477   caused by hardw
+000117a0: 6172 6520 6661 696c 7572 6522 290a 0a20  are failure").. 
+000117b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000117c0: 2822 5b49 6e66 6f5d 2054 6869 7320 6d69  ("[Info] This mi
+000117d0: 6768 7420 666f 7263 6520 6120 7469 6d65  ght force a time
+000117e0: 2d63 6f73 746c 7920 696e 6465 7820 7265  -costly index re
+000117f0: 6372 6561 7469 6f6e 2c20 736f 2069 6620  creation, so if 
+00011800: 6974 2068 6170 7065 6e73 206f 6674 656e  it happens often
+00011810: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00011820: 7269 6e74 2822 2020 2020 2020 2061 6e64  rint("       and
+00011830: 206d 6f75 6e74 696e 6720 6973 2073 6c6f   mounting is slo
+00011840: 772c 2074 7279 2074 6f20 6669 6e64 206f  w, try to find o
+00011850: 7574 2077 6879 206c 6f61 6469 6e67 2066  ut why loading f
+00011860: 6169 6c73 2072 6570 6561 7465 646c 792c  ails repeatedly,
+00011870: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00011880: 7269 6e74 2822 2020 2020 2020 2065 2e67  rint("       e.g
+00011890: 2e2c 2062 7920 6f70 656e 696e 6720 616e  ., by opening an
+000118a0: 2069 7373 7565 206f 6e20 7468 6520 7075   issue on the pu
+000118b0: 626c 6963 2067 6974 6875 6220 7061 6765  blic github page
+000118c0: 2e22 290a 0a20 2020 2020 2020 2020 2020  .")..           
+000118d0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000118e0: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
+000118f0: 696e 6465 7846 696c 654e 616d 6529 0a20  indexFileName). 
+00011900: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00011910: 7420 4f53 4572 726f 723a 0a20 2020 2020  t OSError:.     
+00011920: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00011930: 2822 5b57 6172 6e69 6e67 5d20 4661 696c  ("[Warning] Fail
+00011940: 6564 2074 6f20 7265 6d6f 7665 2063 6f72  ed to remove cor
+00011950: 7275 7074 6564 206f 6c64 2063 6163 6865  rupted old cache
+00011960: 6420 696e 6465 7820 6669 6c65 3a22 2c20  d index file:", 
+00011970: 696e 6465 7846 696c 654e 616d 6529 0a0a  indexFileName)..
+00011980: 2020 2020 2020 2020 6966 2070 7269 6e74          if print
+00011990: 4465 6275 6720 3e3d 2033 2061 6e64 2073  Debug >= 3 and s
+000119a0: 656c 662e 696e 6465 7849 734c 6f61 6465  elf.indexIsLoade
+000119b0: 6428 293a 0a20 2020 2020 2020 2020 2020  d():.           
+000119c0: 2070 7269 6e74 2822 4c6f 6164 6564 2069   print("Loaded i
+000119d0: 6e64 6578 222c 2069 6e64 6578 4669 6c65  ndex", indexFile
+000119e0: 4e61 6d65 290a 0a20 2020 2020 2020 2072  Name)..        r
+000119f0: 6574 7572 6e20 7365 6c66 2e69 6e64 6578  eturn self.index
+00011a00: 4973 4c6f 6164 6564 2829 0a0a 2020 2020  IsLoaded()..    
+00011a10: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+00011a20: 2020 6465 6620 5f64 6574 6563 7443 6f6d    def _detectCom
+00011a30: 7072 6573 7369 6f6e 2866 696c 656f 626a  pression(fileobj
+00011a40: 3a20 494f 5b62 7974 6573 5d29 202d 3e20  : IO[bytes]) -> 
+00011a50: 4f70 7469 6f6e 616c 5b73 7472 5d3a 0a20  Optional[str]:. 
+00011a60: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00011a70: 696e 7374 616e 6365 2866 696c 656f 626a  instance(fileobj
+00011a80: 2c20 696f 2e49 4f42 6173 6529 206f 7220  , io.IOBase) or 
+00011a90: 6e6f 7420 6669 6c65 6f62 6a2e 7365 656b  not fileobj.seek
+00011aa0: 6162 6c65 2829 3a0a 2020 2020 2020 2020  able():.        
+00011ab0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00011ac0: 0a20 2020 2020 2020 206f 6c64 4f66 6673  .        oldOffs
+00011ad0: 6574 203d 2066 696c 656f 626a 2e74 656c  et = fileobj.tel
+00011ae0: 6c28 290a 2020 2020 2020 2020 666f 7220  l().        for 
+00011af0: 636f 6d70 7265 7373 696f 6e49 642c 2063  compressionId, c
+00011b00: 6f6d 7072 6573 7369 6f6e 2069 6e20 7375  ompression in su
+00011b10: 7070 6f72 7465 6443 6f6d 7072 6573 7369  pportedCompressi
+00011b20: 6f6e 732e 6974 656d 7328 293a 0a20 2020  ons.items():.   
+00011b30: 2020 2020 2020 2020 2023 2054 6865 2068           # The h
+00011b40: 6561 6465 7220 6368 6563 6b20 6973 2061  eader check is a
+00011b50: 206e 6563 6573 7361 7279 2063 6f6e 6469   necessary condi
+00011b60: 7469 6f6e 206e 6f74 2061 2073 7566 6669  tion not a suffi
+00011b70: 6369 656e 7420 636f 6e64 6974 696f 6e2e  cient condition.
+00011b80: 0a20 2020 2020 2020 2020 2020 2023 2045  .            # E
+00011b90: 7370 6563 6961 6c6c 7920 666f 7220 677a  specially for gz
+00011ba0: 6970 2c20 7768 6963 6820 6f6e 6c79 2068  ip, which only h
+00011bb0: 6173 2032 206d 6167 6963 2062 7974 6573  as 2 magic bytes
+00011bc0: 2c20 6661 6c73 6520 706f 7369 7469 7665  , false positive
+00011bd0: 7320 6d69 6768 7420 6861 7070 656e 2e0a  s might happen..
+00011be0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+00011bf0: 6572 6566 6f72 652c 206f 6e6c 7920 7573  erefore, only us
+00011c00: 6520 7468 6520 6d61 6769 6320 6279 7465  e the magic byte
+00011c10: 7320 6261 7365 6420 6368 6563 6b20 6966  s based check if
+00011c20: 2074 6865 206d 6f64 756c 6520 636f 756c   the module coul
+00011c30: 6420 6e6f 7420 6265 2066 6f75 6e64 0a20  d not be found. 
+00011c40: 2020 2020 2020 2020 2020 2023 2069 6e20             # in 
+00011c50: 6f72 6465 7220 746f 2073 7469 6c6c 2062  order to still b
+00011c60: 6520 6162 6c65 2074 6f20 7072 696e 7420  e able to print 
+00011c70: 7069 6e70 6f69 6e74 2065 7272 6f72 206d  pinpoint error m
+00011c80: 6573 7361 6765 732e 0a20 2020 2020 2020  essages..       
+00011c90: 2020 2020 206d 6174 6368 6573 203d 2063       matches = c
+00011ca0: 6f6d 7072 6573 7369 6f6e 2e63 6865 636b  ompression.check
+00011cb0: 4865 6164 6572 2866 696c 656f 626a 290a  Header(fileobj).
+00011cc0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00011cd0: 6f62 6a2e 7365 656b 286f 6c64 4f66 6673  obj.seek(oldOffs
+00011ce0: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
+00011cf0: 6966 206e 6f74 206d 6174 6368 6573 3a0a  if not matches:.
+00011d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d10: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+00011d20: 2020 2020 2020 6966 2063 6f6d 7072 6573        if compres
+00011d30: 7369 6f6e 2e6d 6f64 756c 654e 616d 6520  sion.moduleName 
+00011d40: 6e6f 7420 696e 2073 7973 2e6d 6f64 756c  not in sys.modul
+00011d50: 6573 2061 6e64 206d 6174 6368 6573 3a0a  es and matches:.
+00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d70: 7265 7475 726e 2063 6f6d 7072 6573 7369  return compressi
+00011d80: 6f6e 4964 0a0a 2020 2020 2020 2020 2020  onId..          
+00011d90: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00011da0: 2020 2020 2020 2063 6f6d 7072 6573 7365         compresse
+00011db0: 6446 696c 656f 626a 203d 2063 6f6d 7072  dFileobj = compr
+00011dc0: 6573 7369 6f6e 2e6f 7065 6e28 6669 6c65  ession.open(file
+00011dd0: 6f62 6a29 0a20 2020 2020 2020 2020 2020  obj).           
+00011de0: 2020 2020 2023 2052 6561 6469 6e67 2031       # Reading 1
+00011df0: 4220 6672 6f6d 2061 2073 696e 676c 652d  B from a single-
+00011e00: 6672 616d 6520 7a73 7420 6669 6c65 206d  frame zst file m
+00011e10: 6967 6874 2072 6571 7569 7265 2064 6563  ight require dec
+00011e20: 6f6d 7072 6573 7369 6e67 2069 7420 6675  ompressing it fu
+00011e30: 6c6c 7920 696e 206f 7264 6572 0a20 2020  lly in order.   
+00011e40: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00011e50: 6f20 6765 7420 756e 636f 6d70 7265 7373  o get uncompress
+00011e60: 6564 2066 696c 6520 7369 7a65 2120 4176  ed file size! Av
+00011e70: 6f69 6420 7468 6174 2e20 5468 6520 6d61  oid that. The ma
+00011e80: 6769 6320 6279 7465 7320 7368 6f75 6c64  gic bytes should
+00011e90: 2073 7566 6669 6365 206d 6f73 746c 792e   suffice mostly.
+00011ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011eb0: 2023 2054 4f44 4f3a 204d 616b 6520 696e   # TODO: Make in
+00011ec0: 6465 7865 645f 7a73 7464 206e 6f74 2072  dexed_zstd not r
+00011ed0: 6571 7569 7265 2074 6865 2075 6e63 6f6d  equire the uncom
+00011ee0: 7072 6573 7365 6420 7369 7a65 2066 6f72  pressed size for
+00011ef0: 2074 6865 2072 6561 6420 6361 6c6c 2e0a   the read call..
+00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f10: 6966 2063 6f6d 7072 6573 7369 6f6e 4964  if compressionId
+00011f20: 2021 3d20 277a 7374 273a 0a20 2020 2020   != 'zst':.     
+00011f30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00011f40: 6f6d 7072 6573 7365 6446 696c 656f 626a  ompressedFileobj
+00011f50: 2e72 6561 6428 3129 0a20 2020 2020 2020  .read(1).       
+00011f60: 2020 2020 2020 2020 2063 6f6d 7072 6573           compres
+00011f70: 7365 6446 696c 656f 626a 2e63 6c6f 7365  sedFileobj.close
+00011f80: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00011f90: 2020 2066 696c 656f 626a 2e73 6565 6b28     fileobj.seek(
+00011fa0: 6f6c 644f 6666 7365 7429 0a20 2020 2020  oldOffset).     
+00011fb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011fc0: 6e20 636f 6d70 7265 7373 696f 6e49 640a  n compressionId.
+00011fd0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00011fe0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00011ff0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00012000: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
+00012010: 203e 3d20 323a 0a20 2020 2020 2020 2020   >= 2:.         
+00012020: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00012030: 2866 225b 5761 726e 696e 675d 2041 2067  (f"[Warning] A g
+00012040: 6976 656e 2066 696c 6520 7769 7468 206d  iven file with m
+00012050: 6167 6963 2062 7974 6573 2066 6f72 207b  agic bytes for {
+00012060: 636f 6d70 7265 7373 696f 6e49 647d 2063  compressionId} c
+00012070: 6f75 6c64 206e 6f74 2062 6520 6f70 656e  ould not be open
+00012080: 6564 2062 6563 6175 7365 3a22 290a 2020  ed because:").  
+00012090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120a0: 2020 7072 696e 7428 6529 0a20 2020 2020    print(e).     
+000120b0: 2020 2020 2020 2020 2020 2066 696c 656f             fileo
+000120c0: 626a 2e73 6565 6b28 6f6c 644f 6666 7365  bj.seek(oldOffse
+000120d0: 7429 0a0a 2020 2020 2020 2020 7265 7475  t)..        retu
+000120e0: 726e 204e 6f6e 650a 0a20 2020 2040 7374  rn None..    @st
+000120f0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00012100: 6566 205f 6465 7465 6374 5461 7228 6669  ef _detectTar(fi
+00012110: 6c65 6f62 6a3a 2049 4f5b 6279 7465 735d  leobj: IO[bytes]
+00012120: 2c20 656e 636f 6469 6e67 3a20 7374 7229  , encoding: str)
+00012130: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00012140: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00012150: 6e63 6528 6669 6c65 6f62 6a2c 2069 6f2e  nce(fileobj, io.
+00012160: 494f 4261 7365 2920 6f72 206e 6f74 2066  IOBase) or not f
+00012170: 696c 656f 626a 2e73 6565 6b61 626c 6528  ileobj.seekable(
+00012180: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00012190: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+000121a0: 2020 2020 206f 6c64 4f66 6673 6574 203d       oldOffset =
+000121b0: 2066 696c 656f 626a 2e74 656c 6c28 290a   fileobj.tell().
+000121c0: 2020 2020 2020 2020 6973 5461 7220 3d20          isTar = 
+000121d0: 4661 6c73 650a 2020 2020 2020 2020 7472  False.        tr
+000121e0: 793a 0a20 2020 2020 2020 2020 2020 2077  y:.            w
+000121f0: 6974 6820 7461 7266 696c 652e 6f70 656e  ith tarfile.open
+00012200: 2866 696c 656f 626a 3d66 696c 656f 626a  (fileobj=fileobj
+00012210: 2c20 6d6f 6465 3d27 723a 272c 2065 6e63  , mode='r:', enc
+00012220: 6f64 696e 673d 656e 636f 6469 6e67 293a  oding=encoding):
+00012230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012240: 2069 7354 6172 203d 2054 7275 650a 2020   isTar = True.  
+00012250: 2020 2020 2020 6578 6365 7074 2028 7461        except (ta
+00012260: 7266 696c 652e 5265 6164 4572 726f 722c  rfile.ReadError,
+00012270: 2074 6172 6669 6c65 2e43 6f6d 7072 6573   tarfile.Compres
+00012280: 7369 6f6e 4572 726f 7229 3a0a 2020 2020  sionError):.    
+00012290: 2020 2020 2020 2020 6966 2070 7269 6e74          if print
+000122a0: 4465 6275 6720 3e3d 2033 3a0a 2020 2020  Debug >= 3:.    
+000122b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000122c0: 7428 225b 496e 666f 5d20 4669 6c65 206f  t("[Info] File o
+000122d0: 626a 6563 7422 2c20 6669 6c65 6f62 6a2c  bject", fileobj,
+000122e0: 2022 6973 206e 6f74 2061 2054 4152 2e22   "is not a TAR."
+000122f0: 290a 0a20 2020 2020 2020 2066 696c 656f  )..        fileo
+00012300: 626a 2e73 6565 6b28 6f6c 644f 6666 7365  bj.seek(oldOffse
+00012310: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
+00012320: 6e20 6973 5461 720a 0a20 2020 2040 7374  n isTar..    @st
+00012330: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00012340: 6566 205f 6f70 656e 436f 6d70 7265 7373  ef _openCompress
+00012350: 6564 4669 6c65 2866 696c 656f 626a 3a20  edFile(fileobj: 
+00012360: 494f 5b62 7974 6573 5d2c 2067 7a69 7053  IO[bytes], gzipS
+00012370: 6565 6b50 6f69 6e74 5370 6163 696e 673a  eekPointSpacing:
+00012380: 2069 6e74 2c20 656e 636f 6469 6e67 3a20   int, encoding: 
+00012390: 7374 7229 202d 3e20 416e 793a 0a20 2020  str) -> Any:.   
+000123a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000123b0: 204f 7065 6e73 2061 2066 696c 6520 706f   Opens a file po
+000123c0: 7373 6962 6c79 2075 6e64 6f69 6e67 2074  ssibly undoing t
+000123d0: 6865 2063 6f6d 7072 6573 7369 6f6e 2e0a  he compression..
+000123e0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+000123f0: 2874 6172 5f66 696c 655f 6f62 6a2c 2072  (tar_file_obj, r
+00012400: 6177 5f66 696c 655f 6f62 6a2c 2063 6f6d  aw_file_obj, com
+00012410: 7072 6573 7369 6f6e 2c20 6973 5461 7229  pression, isTar)
+00012420: 2e0a 2020 2020 2020 2020 7261 775f 6669  ..        raw_fi
+00012430: 6c65 5f6f 626a 2077 696c 6c20 6265 206e  le_obj will be n
+00012440: 6f6e 6520 6966 2063 6f6d 7072 6573 7369  one if compressi
+00012450: 6f6e 2069 7320 4e6f 6e65 2e0a 2020 2020  on is None..    
+00012460: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00012470: 636f 6d70 7265 7373 696f 6e20 3d20 5351  compression = SQ
+00012480: 4c69 7465 496e 6465 7865 6454 6172 2e5f  LiteIndexedTar._
+00012490: 6465 7465 6374 436f 6d70 7265 7373 696f  detectCompressio
+000124a0: 6e28 6669 6c65 6f62 6a29 0a20 2020 2020  n(fileobj).     
+000124b0: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
+000124c0: 203e 3d20 333a 0a20 2020 2020 2020 2020   >= 3:.         
+000124d0: 2020 2070 7269 6e74 2866 225b 496e 666f     print(f"[Info
+000124e0: 5d20 4465 7465 6374 6564 2063 6f6d 7072  ] Detected compr
+000124f0: 6573 7369 6f6e 207b 636f 6d70 7265 7373  ession {compress
+00012500: 696f 6e7d 2066 6f72 2066 696c 6520 6f62  ion} for file ob
+00012510: 6a65 6374 3a22 2c20 6669 6c65 6f62 6a29  ject:", fileobj)
+00012520: 0a0a 2020 2020 2020 2020 6966 2063 6f6d  ..        if com
+00012530: 7072 6573 7369 6f6e 206e 6f74 2069 6e20  pression not in 
+00012540: 7375 7070 6f72 7465 6443 6f6d 7072 6573  supportedCompres
+00012550: 7369 6f6e 733a 0a20 2020 2020 2020 2020  sions:.         
+00012560: 2020 2072 6574 7572 6e20 6669 6c65 6f62     return fileob
+00012570: 6a2c 204e 6f6e 652c 2063 6f6d 7072 6573  j, None, compres
+00012580: 7369 6f6e 2c20 5351 4c69 7465 496e 6465  sion, SQLiteInde
+00012590: 7865 6454 6172 2e5f 6465 7465 6374 5461  xedTar._detectTa
+000125a0: 7228 6669 6c65 6f62 6a2c 2065 6e63 6f64  r(fileobj, encod
+000125b0: 696e 6729 0a0a 2020 2020 2020 2020 6369  ing)..        ci
+000125c0: 6e66 6f20 3d20 7375 7070 6f72 7465 6443  nfo = supportedC
+000125d0: 6f6d 7072 6573 7369 6f6e 735b 636f 6d70  ompressions[comp
+000125e0: 7265 7373 696f 6e5d 0a20 2020 2020 2020  ression].       
+000125f0: 2069 6620 6369 6e66 6f2e 6d6f 6475 6c65   if cinfo.module
+00012600: 4e61 6d65 206e 6f74 2069 6e20 7379 732e  Name not in sys.
+00012610: 6d6f 6475 6c65 733a 0a20 2020 2020 2020  modules:.       
+00012620: 2020 2020 2072 6169 7365 2043 6f6d 7072       raise Compr
+00012630: 6573 7369 6f6e 4572 726f 7228 0a20 2020  essionError(.   
+00012640: 2020 2020 2020 2020 2020 2020 2022 4361               "Ca
+00012650: 6e27 7420 6f70 656e 2061 207b 7d20 636f  n't open a {} co
+00012660: 6d70 7265 7373 6564 2066 696c 6520 277b  mpressed file '{
+00012670: 7d27 2077 6974 686f 7574 207b 7d20 6d6f  }' without {} mo
+00012680: 6475 6c65 2122 2e66 6f72 6d61 7428 0a20  dule!".format(. 
+00012690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126a0: 2020 2063 6f6d 7072 6573 7369 6f6e 2c20     compression, 
+000126b0: 6669 6c65 6f62 6a2e 6e61 6d65 2c20 6369  fileobj.name, ci
+000126c0: 6e66 6f2e 6d6f 6475 6c65 4e61 6d65 0a20  nfo.moduleName. 
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000126e0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+000126f0: 2020 2020 2020 2020 6966 2063 6f6d 7072          if compr
+00012700: 6573 7369 6f6e 203d 3d20 2767 7a27 3a0a  ession == 'gz':.
+00012710: 2020 2020 2020 2020 2020 2020 2320 6472              # dr
+00012720: 6f70 5f68 616e 646c 6573 206b 6565 7073  op_handles keeps
+00012730: 2061 2066 696c 6520 6861 6e64 6c65 206f   a file handle o
+00012740: 7065 6e69 6e67 2061 7320 6973 2072 6571  pening as is req
+00012750: 7569 7265 6420 746f 2063 616c 6c20 7465  uired to call te
+00012760: 6c6c 2829 2064 7572 696e 6720 6465 636f  ll() during deco
+00012770: 6469 6e67 0a20 2020 2020 2020 2020 2020  ding.           
+00012780: 2074 6172 5f66 696c 6520 3d20 696e 6465   tar_file = inde
+00012790: 7865 645f 677a 6970 2e49 6e64 6578 6564  xed_gzip.Indexed
+000127a0: 477a 6970 4669 6c65 2866 696c 656f 626a  GzipFile(fileobj
+000127b0: 3d66 696c 656f 626a 2c20 6472 6f70 5f68  =fileobj, drop_h
+000127c0: 616e 646c 6573 3d46 616c 7365 2c20 7370  andles=False, sp
+000127d0: 6163 696e 673d 677a 6970 5365 656b 506f  acing=gzipSeekPo
+000127e0: 696e 7453 7061 6369 6e67 290a 2020 2020  intSpacing).    
+000127f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012800: 2020 2020 2020 7461 725f 6669 6c65 203d        tar_file =
+00012810: 2063 696e 666f 2e6f 7065 6e28 6669 6c65   cinfo.open(file
+00012820: 6f62 6a29 0a0a 2020 2020 2020 2020 7265  obj)..        re
+00012830: 7475 726e 2074 6172 5f66 696c 652c 2066  turn tar_file, f
+00012840: 696c 656f 626a 2c20 636f 6d70 7265 7373  ileobj, compress
+00012850: 696f 6e2c 2053 514c 6974 6549 6e64 6578  ion, SQLiteIndex
+00012860: 6564 5461 722e 5f64 6574 6563 7454 6172  edTar._detectTar
+00012870: 2874 6172 5f66 696c 652c 2065 6e63 6f64  (tar_file, encod
+00012880: 696e 6729 0a0a 2020 2020 4073 7461 7469  ing)..    @stati
+00012890: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+000128a0: 5f75 6e63 6865 636b 6564 5265 6d6f 7665  _uncheckedRemove
+000128b0: 2870 6174 683a 204f 7074 696f 6e61 6c5b  (path: Optional[
+000128c0: 416e 7953 7472 5d29 3a0a 2020 2020 2020  AnyStr]):.      
+000128d0: 2020 2222 220a 2020 2020 2020 2020 4f66    """.        Of
+000128e0: 7465 6e20 636c 6561 6e75 7020 6973 2067  ten cleanup is g
+000128f0: 6f6f 6420 6d61 6e6e 6572 7320 6275 7420  ood manners but 
+00012900: 6974 2077 6f75 6c64 206f 6e6c 7920 6265  it would only be
+00012910: 206f 626e 6f78 696f 7573 2069 6620 7261   obnoxious if ra
+00012920: 7461 726d 6f75 6e74 2063 7261 7368 6564  tarmount crashed
+00012930: 206f 6e20 756e 6e65 6365 7373 6172 7920   on unnecessary 
+00012940: 636c 6561 6e75 702e 0a20 2020 2020 2020  cleanup..       
+00012950: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00012960: 6e6f 7420 7061 7468 206f 7220 6e6f 7420  not path or not 
+00012970: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
+00012980: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+00012990: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+000129a0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000129b0: 2020 206f 732e 7265 6d6f 7665 2870 6174     os.remove(pat
+000129c0: 6829 0a20 2020 2020 2020 2065 7863 6570  h).        excep
+000129d0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+000129e0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000129f0: 5b57 6172 6e69 6e67 5d20 436f 756c 6420  [Warning] Could 
+00012a00: 6e6f 7420 7265 6d6f 7665 3a22 2c20 7061  not remove:", pa
+00012a10: 7468 290a 0a20 2020 2064 6566 205f 6c6f  th)..    def _lo
+00012a20: 6164 4f72 5374 6f72 6543 6f6d 7072 6573  adOrStoreCompres
+00012a30: 7369 6f6e 4f66 6673 6574 7328 7365 6c66  sionOffsets(self
+00012a40: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
+00012a50: 7420 7365 6c66 2e69 6e64 6578 4669 6c65  t self.indexFile
+00012a60: 4e61 6d65 206f 7220 7365 6c66 2e69 6e64  Name or self.ind
+00012a70: 6578 4669 6c65 4e61 6d65 203d 3d20 273a  exFileName == ':
+00012a80: 6d65 6d6f 7279 3a27 3a0a 2020 2020 2020  memory:':.      
+00012a90: 2020 2020 2020 6966 2070 7269 6e74 4465        if printDe
+00012aa0: 6275 6720 3e3d 2032 3a0a 2020 2020 2020  bug >= 2:.      
+00012ab0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00012ac0: 225b 496e 666f 5d20 5769 6c6c 2073 6b69  "[Info] Will ski
+00012ad0: 7020 7374 6f72 696e 6720 636f 6d70 7265  p storing compre
+00012ae0: 7373 696f 6e20 7365 656b 2064 6174 6120  ssion seek data 
+00012af0: 6265 6361 7573 6520 7468 6520 6461 7461  because the data
+00012b00: 6261 7365 2069 7320 696e 206d 656d 6f72  base is in memor
+00012b10: 792e 2229 0a20 2020 2020 2020 2020 2020  y.").           
+00012b20: 2020 2020 2070 7269 6e74 2822 5b49 6e66       print("[Inf
+00012b30: 6f5d 2049 6620 7468 6520 6461 7461 6261  o] If the databa
+00012b40: 7365 2069 7320 696e 206d 656d 6f72 792c  se is in memory,
+00012b50: 2074 6865 6e20 7468 6973 2064 6174 6120   then this data 
+00012b60: 7769 6c6c 206e 6f74 2062 6520 7265 6164  will not be read
+00012b70: 2061 6e79 7761 792e 2229 0a20 2020 2020   anyway.").     
+00012b80: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+00012b90: 2020 2020 2020 2023 2054 6869 7320 7368         # This sh
+00012ba0: 6f75 6c64 2062 6520 6361 6c6c 6564 2061  ould be called a
+00012bb0: 6674 6572 2074 6865 2054 4152 2066 696c  fter the TAR fil
+00012bc0: 6520 696e 6465 7820 6973 2063 6f6d 706c  e index is compl
+00012bd0: 6574 6520 286c 6f61 6465 6420 6f72 2063  ete (loaded or c
+00012be0: 7265 6174 6564 292e 0a20 2020 2020 2020  reated)..       
+00012bf0: 2023 2049 6620 7468 6520 5441 5220 6669   # If the TAR fi
+00012c00: 6c65 2069 6e64 6578 2077 6173 2063 7265  le index was cre
+00012c10: 6174 6564 2c20 7468 656e 2074 6172 6669  ated, then tarfi
+00012c20: 6c65 2068 6173 2069 7465 7261 7465 6420  le has iterated 
+00012c30: 6f76 6572 2074 6865 2077 686f 6c65 2066  over the whole f
+00012c40: 696c 6520 6f6e 6365 0a20 2020 2020 2020  ile once.       
+00012c50: 2023 2061 6e64 2074 6865 7265 666f 7265   # and therefore
+00012c60: 2063 6f6d 706c 6574 6564 2074 6865 2069   completed the i
+00012c70: 6d70 6c69 6369 7420 636f 6d70 7265 7373  mplicit compress
+00012c80: 696f 6e20 6f66 6673 6574 2063 7265 6174  ion offset creat
+00012c90: 696f 6e2e 0a20 2020 2020 2020 2069 6620  ion..        if 
+00012ca0: 6e6f 7420 7365 6c66 2e73 716c 436f 6e6e  not self.sqlConn
+00012cb0: 6563 7469 6f6e 3a0a 2020 2020 2020 2020  ection:.        
+00012cc0: 2020 2020 7261 6973 6520 496e 6465 784e      raise IndexN
+00012cd0: 6f74 4f70 656e 4572 726f 7228 2254 6869  otOpenError("Thi
+00012ce0: 7320 6d65 7468 6f64 2063 616e 206e 6f74  s method can not
+00012cf0: 2062 6520 6361 6c6c 6564 2077 6974 686f   be called witho
+00012d00: 7574 2061 6e20 6f70 656e 6564 2069 6e64  ut an opened ind
+00012d10: 6578 2064 6174 6162 6173 6521 2229 0a20  ex database!"). 
+00012d20: 2020 2020 2020 2064 6220 3d20 7365 6c66         db = self
+00012d30: 2e73 716c 436f 6e6e 6563 7469 6f6e 0a20  .sqlConnection. 
+00012d40: 2020 2020 2020 2066 696c 654f 626a 6563         fileObjec
+00012d50: 7420 3d20 7365 6c66 2e74 6172 4669 6c65  t = self.tarFile
+00012d60: 4f62 6a65 6374 0a0a 2020 2020 2020 2020  Object..        
+00012d70: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00012d80: 2068 6173 6174 7472 2866 696c 654f 626a   hasattr(fileObj
+00012d90: 6563 742c 2027 7365 745f 626c 6f63 6b5f  ect, 'set_block_
+00012da0: 6f66 6673 6574 7327 290a 2020 2020 2020  offsets').      
+00012db0: 2020 2020 2020 616e 6420 6861 7361 7474        and hasatt
+00012dc0: 7228 6669 6c65 4f62 6a65 6374 2c20 2762  r(fileObject, 'b
+00012dd0: 6c6f 636b 5f6f 6666 7365 7473 2729 0a20  lock_offsets'). 
+00012de0: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
+00012df0: 656c 662e 636f 6d70 7265 7373 696f 6e20  elf.compression 
+00012e00: 696e 205b 2762 7a32 272c 2027 7a73 7427  in ['bz2', 'zst'
+00012e10: 5d0a 2020 2020 2020 2020 293a 0a20 2020  ].        ):.   
+00012e20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00012e30: 2e63 6f6d 7072 6573 7369 6f6e 203d 3d20  .compression == 
+00012e40: 2762 7a32 273a 0a20 2020 2020 2020 2020  'bz2':.         
+00012e50: 2020 2020 2020 2074 6162 6c65 5f6e 616d         table_nam
+00012e60: 6520 3d20 2762 7a69 7032 626c 6f63 6b73  e = 'bzip2blocks
+00012e70: 270a 2020 2020 2020 2020 2020 2020 656c  '.            el
+00012e80: 6966 2073 656c 662e 636f 6d70 7265 7373  if self.compress
+00012e90: 696f 6e20 3d3d 2027 7a73 7427 3a0a 2020  ion == 'zst':.  
+00012ea0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+00012eb0: 626c 655f 6e61 6d65 203d 2027 7a73 7464  ble_name = 'zstd
+00012ec0: 626c 6f63 6b73 270a 0a20 2020 2020 2020  blocks'..       
+00012ed0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00012ee0: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
+00012ef0: 7320 3d20 6469 6374 2864 622e 6578 6563  s = dict(db.exec
+00012f00: 7574 6528 2753 454c 4543 5420 626c 6f63  ute('SELECT bloc
+00012f10: 6b6f 6666 7365 742c 6461 7461 6f66 6673  koffset,dataoffs
+00012f20: 6574 2046 524f 4d20 7b7d 3b27 2e66 6f72  et FROM {};'.for
+00012f30: 6d61 7428 7461 626c 655f 6e61 6d65 2929  mat(table_name))
+00012f40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012f50: 2020 6669 6c65 4f62 6a65 6374 2e73 6574    fileObject.set
+00012f60: 5f62 6c6f 636b 5f6f 6666 7365 7473 286f  _block_offsets(o
+00012f70: 6666 7365 7473 290a 2020 2020 2020 2020  ffsets).        
+00012f80: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00012f90: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00012fa0: 2020 2020 2020 6966 2070 7269 6e74 4465        if printDe
+00012fb0: 6275 6720 3e3d 2032 3a0a 2020 2020 2020  bug >= 2:.      
+00012fc0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00012fd0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+00012fe0: 2020 2020 2020 2020 2020 2020 2022 5b49               "[I
+00012ff0: 6e66 6f5d 2043 6f75 6c64 206e 6f74 206c  nfo] Could not l
+00013000: 6f61 6420 7b7d 2062 6c6f 636b 206f 6666  oad {} block off
+00013010: 7365 7420 6461 7461 2e20 5769 6c6c 2063  set data. Will c
+00013020: 7265 6174 6520 6974 2066 726f 6d20 7363  reate it from sc
+00013030: 7261 7463 682e 222e 666f 726d 6174 280a  ratch.".format(.
+00013040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013050: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013060: 2e63 6f6d 7072 6573 7369 6f6e 0a20 2020  .compression.   
+00013070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013080: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00013090: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000130a0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+000130b0: 626c 6573 203d 205b 785b 305d 2066 6f72  bles = [x[0] for
+000130c0: 2078 2069 6e20 6462 2e65 7865 6375 7465   x in db.execute
+000130d0: 2827 5345 4c45 4354 206e 616d 6520 4652  ('SELECT name FR
+000130e0: 4f4d 2073 716c 6974 655f 6d61 7374 6572  OM sqlite_master
+000130f0: 2057 4845 5245 2074 7970 653d 2274 6162   WHERE type="tab
+00013100: 6c65 223b 2729 5d0a 2020 2020 2020 2020  le";')].        
+00013110: 2020 2020 2020 2020 6966 2074 6162 6c65          if table
+00013120: 5f6e 616d 6520 696e 2074 6162 6c65 733a  _name in tables:
+00013130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013140: 2020 2020 2064 622e 6578 6563 7574 6528       db.execute(
+00013150: 2744 524f 5020 5441 424c 4520 7b7d 272e  'DROP TABLE {}'.
+00013160: 666f 726d 6174 2874 6162 6c65 5f6e 616d  format(table_nam
+00013170: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+00013180: 2020 2020 6462 2e65 7865 6375 7465 2827      db.execute('
+00013190: 4352 4541 5445 2054 4142 4c45 207b 7d20  CREATE TABLE {} 
+000131a0: 2820 626c 6f63 6b6f 6666 7365 7420 494e  ( blockoffset IN
+000131b0: 5445 4745 5220 5052 494d 4152 5920 4b45  TEGER PRIMARY KE
+000131c0: 592c 2064 6174 616f 6666 7365 7420 494e  Y, dataoffset IN
+000131d0: 5445 4745 5220 2927 2e66 6f72 6d61 7428  TEGER )'.format(
+000131e0: 7461 626c 655f 6e61 6d65 2929 0a20 2020  table_name)).   
+000131f0: 2020 2020 2020 2020 2020 2020 2064 622e               db.
+00013200: 6578 6563 7574 656d 616e 7928 2749 4e53  executemany('INS
+00013210: 4552 5420 494e 544f 207b 7d20 5641 4c55  ERT INTO {} VALU
+00013220: 4553 2028 3f2c 3f29 272e 666f 726d 6174  ES (?,?)'.format
+00013230: 2874 6162 6c65 5f6e 616d 6529 2c20 6669  (table_name), fi
+00013240: 6c65 4f62 6a65 6374 2e62 6c6f 636b 5f6f  leObject.block_o
+00013250: 6666 7365 7473 2829 2e69 7465 6d73 2829  ffsets().items()
+00013260: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013270: 2020 6462 2e63 6f6d 6d69 7428 290a 2020    db.commit().  
+00013280: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013290: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
+000132a0: 2020 2020 2020 2020 2020 2023 2066 6d74             # fmt
+000132b0: 3a20 6f66 660a 2020 2020 2020 2020 2020  : off.          
+000132c0: 2020 6861 7361 7474 7228 2066 696c 654f    hasattr( fileO
+000132d0: 626a 6563 742c 2027 696d 706f 7274 5f69  bject, 'import_i
+000132e0: 6e64 6578 2720 290a 2020 2020 2020 2020  ndex' ).        
+000132f0: 2020 2020 616e 6420 6861 7361 7474 7228      and hasattr(
+00013300: 2066 696c 654f 626a 6563 742c 2027 6578   fileObject, 'ex
+00013310: 706f 7274 5f69 6e64 6578 2720 290a 2020  port_index' ).  
+00013320: 2020 2020 2020 2020 2020 616e 6420 7365            and se
+00013330: 6c66 2e63 6f6d 7072 6573 7369 6f6e 203d  lf.compression =
+00013340: 3d20 2767 7a27 0a20 2020 2020 2020 2020  = 'gz'.         
+00013350: 2020 2023 2066 6d74 3a20 6f6e 0a20 2020     # fmt: on.   
+00013360: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00013370: 2020 2020 7461 626c 6573 203d 205b 785b      tables = [x[
+00013380: 305d 2066 6f72 2078 2069 6e20 6462 2e65  0] for x in db.e
+00013390: 7865 6375 7465 2827 5345 4c45 4354 206e  xecute('SELECT n
+000133a0: 616d 6520 4652 4f4d 2073 716c 6974 655f  ame FROM sqlite_
+000133b0: 6d61 7374 6572 2057 4845 5245 2074 7970  master WHERE typ
+000133c0: 653d 2274 6162 6c65 2227 295d 0a0a 2020  e="table"')]..  
+000133d0: 2020 2020 2020 2020 2020 2320 696e 6465            # inde
+000133e0: 7865 645f 677a 6970 2069 6e64 6578 206f  xed_gzip index o
+000133f0: 6e6c 7920 6861 7320 6120 6669 6c65 2062  nly has a file b
+00013400: 6173 6564 2041 5049 2c20 736f 2077 6520  ased API, so we 
+00013410: 6e65 6564 2074 6f20 7772 6974 6520 616c  need to write al
+00013420: 6c20 7468 6520 696e 6465 7820 6461 7461  l the index data
+00013430: 2066 726f 6d20 7468 6520 5351 4c0a 2020   from the SQL.  
+00013440: 2020 2020 2020 2020 2020 2320 6461 7461            # data
+00013450: 6261 7365 206f 7574 2069 6e74 6f20 6120  base out into a 
+00013460: 7465 6d70 6f72 6172 7920 6669 6c65 2e20  temporary file. 
+00013470: 466f 7220 7468 6174 2c20 6c65 7427 7320  For that, let's 
+00013480: 6669 7273 7420 7472 7920 746f 2075 7365  first try to use
+00013490: 2074 6865 2073 616d 6520 6c6f 6361 7469   the same locati
+000134a0: 6f6e 2061 7320 7468 6520 5351 4c69 7465  on as the SQLite
+000134b0: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
+000134c0: 6174 6162 6173 6520 6265 6361 7573 6520  atabase because 
+000134d0: 6974 2073 686f 756c 6420 6861 7665 2073  it should have s
+000134e0: 7566 6669 6369 656e 7420 7772 6974 696e  ufficient writin
+000134f0: 6720 7269 6768 7473 2061 6e64 2066 7265  g rights and fre
+00013500: 6520 6469 736b 2073 7061 6365 2e0a 2020  e disk space..  
+00013510: 2020 2020 2020 2020 2020 677a 696e 6465            gzinde
+00013520: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
+00013530: 2020 2020 2066 6f72 2074 6d70 4469 7220       for tmpDir 
+00013540: 696e 205b 6f73 2e70 6174 682e 6469 726e  in [os.path.dirn
+00013550: 616d 6528 7365 6c66 2e69 6e64 6578 4669  ame(self.indexFi
+00013560: 6c65 4e61 6d65 292c 204e 6f6e 655d 3a0a  leName), None]:.
+00013570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013580: 6966 2027 677a 6970 696e 6465 7827 206e  if 'gzipindex' n
+00013590: 6f74 2069 6e20 7461 626c 6573 2061 6e64  ot in tables and
+000135a0: 2027 677a 6970 696e 6465 7865 7327 206e   'gzipindexes' n
+000135b0: 6f74 2069 6e20 7461 626c 6573 3a0a 2020  ot in tables:.  
+000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135d0: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+000135e0: 2020 2020 2020 2020 2023 2054 7279 2074           # Try t
+000135f0: 6f20 6578 706f 7274 2064 6174 6120 6672  o export data fr
+00013600: 6f6d 2053 514c 6974 6520 6461 7461 6261  om SQLite databa
+00013610: 7365 2e20 4e6f 7465 2074 6861 7420 6e6f  se. Note that no
+00013620: 2065 7272 6f72 2063 6865 636b 696e 6720   error checking 
+00013630: 6167 6169 6e73 7420 7468 6520 6578 6973  against the exis
+00013640: 7465 6e63 6520 6f66 0a20 2020 2020 2020  tence of.       
+00013650: 2020 2020 2020 2020 2023 2067 7a69 7069           # gzipi
+00013660: 6e64 6578 2074 6162 6c65 2069 7320 646f  ndex table is do
+00013670: 6e65 2062 6563 6175 7365 2074 6865 2065  ne because the e
+00013680: 7870 6f72 7465 6420 6461 7461 2069 7473  xported data its
+00013690: 656c 6620 6d69 6768 7420 616c 736f 2062  elf might also b
+000136a0: 6520 7772 6f6e 6720 616e 6420 7765 2063  e wrong and we c
+000136b0: 616e 2774 2063 6865 636b 0a20 2020 2020  an't check.     
+000136c0: 2020 2020 2020 2020 2020 2023 2061 6761             # aga
+000136d0: 696e 7374 2074 6869 732e 2054 6865 7265  inst this. There
+000136e0: 666f 7265 2c20 636f 6c6c 6174 6520 616c  fore, collate al
+000136f0: 6c20 6572 726f 7220 6368 6563 6b69 6e67  l error checking
+00013700: 2062 7920 6361 7463 6869 6e67 2065 7863   by catching exc
+00013710: 6570 7469 6f6e 732e 0a0a 2020 2020 2020  eptions...      
+00013720: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00013730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013740: 2020 2067 7a69 6e64 6578 203d 2074 656d     gzindex = tem
+00013750: 7066 696c 652e 6d6b 7374 656d 7028 6469  pfile.mkstemp(di
+00013760: 723d 746d 7044 6972 295b 315d 0a20 2020  r=tmpDir)[1].   
+00013770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013780: 2077 6974 6820 6f70 656e 2867 7a69 6e64   with open(gzind
+00013790: 6578 2c20 2777 6227 2920 6173 2066 696c  ex, 'wb') as fil
+000137a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000137b0: 2020 2020 2020 2020 2020 2069 6620 2767             if 'g
+000137c0: 7a69 7069 6e64 6578 6573 2720 696e 2074  zipindexes' in t
+000137d0: 6162 6c65 733a 0a20 2020 2020 2020 2020  ables:.         
 000137e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137f0: 2320 7768 6174 2077 6f75 6c64 2068 6170  # what would hap
-00013800: 7065 6e20 696e 2074 6861 7420 6361 7365  pen in that case
-00013810: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013820: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00013830: 536f 2c20 7573 6520 6120 6469 6666 6572  So, use a differ
-00013840: 656e 746c 7920 6e61 6d65 6420 7461 626c  ently named tabl
-00013850: 6520 6966 2074 6865 7265 2061 7265 206d  e if there are m
-00013860: 756c 7469 706c 6520 626c 6f62 732e 0a20  ultiple blobs.. 
-00013870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013880: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-00013890: 7772 6974 6528 6462 2e65 7865 6375 7465  write(db.execute
-000138a0: 2827 5345 4c45 4354 2064 6174 6120 4652  ('SELECT data FR
-000138b0: 4f4d 2067 7a69 7069 6e64 6578 2729 2e66  OM gzipindex').f
-000138c0: 6574 6368 6f6e 6528 295b 305d 290a 2020  etchone()[0]).  
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-000138f0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00013900: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00013910: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013920: 6c66 2e5f 756e 6368 6563 6b65 6452 656d  lf._uncheckedRem
-00013930: 6f76 6528 677a 696e 6465 7829 0a20 2020  ove(gzindex).   
-00013940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013950: 2067 7a69 6e64 6578 203d 204e 6f6e 650a   gzindex = None.
-00013960: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013970: 677a 696e 6465 783a 0a20 2020 2020 2020  gzindex:.       
-00013980: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00013990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139a0: 2020 6669 6c65 4f62 6a65 6374 2e69 6d70    fileObject.imp
-000139b0: 6f72 745f 696e 6465 7828 6669 6c65 6e61  ort_index(filena
-000139c0: 6d65 3d67 7a69 6e64 6578 290a 2020 2020  me=gzindex).    
-000139d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139e0: 7265 7475 726e 0a20 2020 2020 2020 2020  return.         
-000139f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00013a00: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00013a10: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00013a20: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00013a30: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
-00013a40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013a50: 656c 662e 5f75 6e63 6865 636b 6564 5265  elf._uncheckedRe
-00013a60: 6d6f 7665 2867 7a69 6e64 6578 290a 0a20  move(gzindex).. 
-00013a70: 2020 2020 2020 2020 2020 2023 2053 746f             # Sto
-00013a80: 7265 2074 6865 206f 6666 7365 7473 2069  re the offsets i
-00013a90: 6e74 6f20 6120 7465 6d70 6f72 6172 7920  nto a temporary 
-00013aa0: 6669 6c65 2061 6e64 2074 6865 6e20 696e  file and then in
-00013ab0: 746f 2074 6865 2053 514c 6974 6520 6461  to the SQLite da
-00013ac0: 7461 6261 7365 0a20 2020 2020 2020 2020  tabase.         
-00013ad0: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
-00013ae0: 203e 3d20 323a 0a20 2020 2020 2020 2020   >= 2:.         
-00013af0: 2020 2020 2020 2070 7269 6e74 2822 5b49         print("[I
-00013b00: 6e66 6f5d 2043 6f75 6c64 206e 6f74 206c  nfo] Could not l
-00013b10: 6f61 6420 475a 6970 2042 6c6f 636b 206f  oad GZip Block o
-00013b20: 6666 7365 7420 6461 7461 2e20 5769 6c6c  ffset data. Will
-00013b30: 2063 7265 6174 6520 6974 2066 726f 6d20   create it from 
-00013b40: 7363 7261 7463 682e 2229 0a0a 2020 2020  scratch.")..    
-00013b50: 2020 2020 2020 2020 2320 5472 616e 7370          # Transp
-00013b60: 6172 656e 746c 7920 666f 7263 6520 696e  arently force in
-00013b70: 6465 7820 746f 2062 6520 6275 696c 7420  dex to be built 
-00013b80: 6966 206e 6f74 2061 6c72 6561 6479 2064  if not already d
-00013b90: 6f6e 6520 736f 2e20 6275 696c 645f 6675  one so. build_fu
-00013ba0: 6c6c 5f69 6e64 6578 2077 6173 2062 7567  ll_index was bug
-00013bb0: 6779 2066 6f72 206d 652e 0a20 2020 2020  gy for me..     
-00013bc0: 2020 2020 2020 2023 2053 6565 6b69 6e67         # Seeking
-00013bd0: 2066 726f 6d20 656e 6420 6e6f 7420 7375   from end not su
-00013be0: 7070 6f72 7465 642c 2073 6f20 7765 2068  pported, so we h
-00013bf0: 6176 6520 746f 2072 6561 6420 7468 6520  ave to read the 
-00013c00: 7768 6f6c 6520 6461 7461 2069 6e20 696e  whole data in in
-00013c10: 2061 206c 6f6f 700a 2020 2020 2020 2020   a loop.        
-00013c20: 2020 2020 7768 696c 6520 6669 6c65 4f62      while fileOb
-00013c30: 6a65 6374 2e72 6561 6428 3130 3234 202a  ject.read(1024 *
-00013c40: 2031 3032 3429 3a0a 2020 2020 2020 2020   1024):.        
-00013c50: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-00013c60: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-00013c70: 6372 6561 7465 6420 696e 6465 7820 6361  created index ca
-00013c80: 6e20 756e 666f 7274 756e 6174 656c 7920  n unfortunately 
-00013c90: 6265 2070 7265 7474 7920 6c61 7267 6520  be pretty large 
-00013ca0: 616e 6420 746d 7020 6d69 6768 7420 6163  and tmp might ac
-00013cb0: 7475 616c 6c79 2072 756e 206f 7574 206f  tually run out o
-00013cc0: 6620 6d65 6d6f 7279 210a 2020 2020 2020  f memory!.      
-00013cd0: 2020 2020 2020 2320 5468 6572 6566 6f72        # Therefor
-00013ce0: 652c 2074 7279 2064 6966 6665 7265 6e74  e, try different
-00013cf0: 2070 6174 6873 2c20 7374 6172 7469 6e67   paths, starting
-00013d00: 2077 6974 6820 7468 6520 6c6f 6361 7469   with the locati
-00013d10: 6f6e 2077 6865 7265 2074 6865 2069 6e64  on where the ind
-00013d20: 6578 2072 6573 6964 6573 2e0a 2020 2020  ex resides..    
-00013d30: 2020 2020 2020 2020 677a 696e 6465 7820          gzindex 
-00013d40: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00013d50: 2020 2066 6f72 2074 6d70 4469 7220 696e     for tmpDir in
-00013d60: 205b 6f73 2e70 6174 682e 6469 726e 616d   [os.path.dirnam
-00013d70: 6528 7365 6c66 2e69 6e64 6578 4669 6c65  e(self.indexFile
-00013d80: 4e61 6d65 292c 204e 6f6e 655d 3a0a 2020  Name), None]:.  
-00013d90: 2020 2020 2020 2020 2020 2020 2020 677a                gz
-00013da0: 696e 6465 7820 3d20 7465 6d70 6669 6c65  index = tempfile
-00013db0: 2e6d 6b73 7465 6d70 2864 6972 3d74 6d70  .mkstemp(dir=tmp
-00013dc0: 4469 7229 5b31 5d0a 2020 2020 2020 2020  Dir)[1].        
-00013dd0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013df0: 2066 696c 654f 626a 6563 742e 6578 706f   fileObject.expo
-00013e00: 7274 5f69 6e64 6578 2866 696c 656e 616d  rt_index(filenam
-00013e10: 653d 677a 696e 6465 7829 0a20 2020 2020  e=gzindex).     
-00013e20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00013e30: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-00013e40: 2020 2020 2065 7863 6570 7420 696e 6465       except inde
-00013e50: 7865 645f 677a 6970 2e5a 7261 6e45 7272  xed_gzip.ZranErr
-00013e60: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00013e70: 2020 2020 2020 2020 7365 6c66 2e5f 756e          self._un
-00013e80: 6368 6563 6b65 6452 656d 6f76 6528 677a  checkedRemove(gz
-00013e90: 696e 6465 7829 0a20 2020 2020 2020 2020  index).         
-00013ea0: 2020 2020 2020 2020 2020 2067 7a69 6e64             gzind
-00013eb0: 6578 203d 204e 6f6e 650a 0a20 2020 2020  ex = None..     
-00013ec0: 2020 2020 2020 2069 6620 6e6f 7420 677a         if not gz
-00013ed0: 696e 6465 7820 6f72 206e 6f74 206f 732e  index or not os.
-00013ee0: 7061 7468 2e69 7366 696c 6528 677a 696e  path.isfile(gzin
-00013ef0: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
-00013f00: 2020 2020 2020 7072 696e 7428 225b 5761        print("[Wa
-00013f10: 726e 696e 675d 2054 6865 2047 5a69 7020  rning] The GZip 
-00013f20: 696e 6465 7820 7265 7175 6972 6564 2066  index required f
-00013f30: 6f72 2073 6565 6b69 6e67 2063 6f75 6c64  or seeking could
-00013f40: 206e 6f74 2062 6520 7374 6f72 6564 2069   not be stored i
-00013f50: 6e20 6120 7465 6d70 6f72 6172 7920 6669  n a temporary fi
-00013f60: 6c65 2122 290a 2020 2020 2020 2020 2020  le!").          
-00013f70: 2020 2020 2020 7072 696e 7428 225b 496e        print("[In
-00013f80: 666f 5d20 5468 6973 206d 6967 6874 2068  fo] This might h
-00013f90: 6170 7065 6e20 7768 656e 2079 6f75 2061  appen when you a
-00013fa0: 7265 206f 7574 206f 6620 7370 6163 6520  re out of space 
-00013fb0: 696e 2079 6f75 7220 7465 6d70 6f72 6172  in your temporar
-00013fc0: 7920 6669 6c65 2061 6e64 2061 7420 7468  y file and at th
-00013fd0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00013fe0: 2020 2020 7072 696e 7428 225b 496e 666f      print("[Info
-00013ff0: 5d20 7468 6520 696e 6465 7820 6669 6c65  ] the index file
-00014000: 206c 6f63 6174 696f 6e2e 2054 6865 2067   location. The g
-00014010: 7a69 7069 6e64 6578 2073 697a 6520 7461  zipindex size ta
-00014020: 6b65 7320 726f 7567 686c 7920 3332 6b69  kes roughly 32ki
-00014030: 4220 7065 7220 344d 6942 206f 6622 290a  B per 4MiB of").
-00014040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014050: 7072 696e 7428 225b 496e 666f 5d20 756e  print("[Info] un
-00014060: 636f 6d70 7265 7373 6564 2821 2920 6279  compressed(!) by
-00014070: 7465 7320 2830 2e38 2520 6f66 2074 6865  tes (0.8% of the
-00014080: 2075 6e63 6f6d 7072 6573 7365 6420 6461   uncompressed da
-00014090: 7461 2920 6279 2064 6566 6175 6c74 2e22  ta) by default."
+000137f0: 2020 2023 2054 7279 2074 6f20 7265 6164     # Try to read
+00013800: 2069 6e64 6578 2066 696c 6573 2063 6f6e   index files con
+00013810: 7461 696e 696e 6720 7665 7279 206c 6172  taining very lar
+00013820: 6765 2067 7a69 7020 696e 6465 7865 730a  ge gzip indexes.
+00013830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013840: 2020 2020 2020 2020 2020 2020 726f 7773              rows
+00013850: 203d 2064 622e 6578 6563 7574 6528 2753   = db.execute('S
+00013860: 454c 4543 5420 6461 7461 2046 524f 4d20  ELECT data FROM 
+00013870: 677a 6970 696e 6465 7865 7320 4f52 4445  gzipindexes ORDE
+00013880: 5220 4259 2052 4f57 4944 2729 0a20 2020  R BY ROWID').   
+00013890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138a0: 2020 2020 2020 2020 2066 6f72 2072 6f77           for row
+000138b0: 2069 6e20 726f 7773 3a0a 2020 2020 2020   in rows:.      
+000138c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138d0: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+000138e0: 7269 7465 2872 6f77 5b30 5d29 0a20 2020  rite(row[0]).   
+000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013900: 2020 2020 2065 6c69 6620 2767 7a69 7069       elif 'gzipi
+00013910: 6e64 6578 2720 696e 2074 6162 6c65 733a  ndex' in tables:
+00013920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013930: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00013940: 7279 2074 6f20 7265 6164 206c 6567 6163  ry to read legac
+00013950: 7920 696e 6465 7820 6669 6c65 7320 7769  y index files wi
+00013960: 7468 2065 7861 6374 6c79 206f 6e65 2062  th exactly one b
+00013970: 6c6f 622e 0a20 2020 2020 2020 2020 2020  lob..           
+00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013990: 2023 2054 6869 7320 6973 2068 6f77 206f   # This is how o
+000139a0: 6c64 2072 6174 6172 6d6f 756e 7420 7665  ld ratarmount ve
+000139b0: 7273 696f 6e20 7265 6164 2069 742e 2049  rsion read it. I
+000139c0: 2e65 2e2c 2069 6620 7468 6572 6520 7765  .e., if there we
+000139d0: 7265 2073 696d 706c 7920 6d6f 7265 2074  re simply more t
+000139e0: 6861 6e20 6f6e 650a 2020 2020 2020 2020  han one.        
+000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a00: 2020 2020 2320 626c 6f62 2069 6e20 7468      # blob in th
+00013a10: 6520 7361 6d65 2074 6261 6c65 2c20 7468  e same tbale, th
+00013a20: 656e 2069 7420 776f 756c 6420 6967 6e6f  en it would igno
+00013a30: 7265 2061 6c6c 2062 7574 2074 6865 2066  re all but the f
+00013a40: 6972 7374 283f 2129 2061 6e64 2049 2061  irst(?!) and I a
+00013a50: 6d20 6e6f 7420 7375 7265 0a20 2020 2020  m not sure.     
+00013a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a70: 2020 2020 2020 2023 2077 6861 7420 776f         # what wo
+00013a80: 756c 6420 6861 7070 656e 2069 6e20 7468  uld happen in th
+00013a90: 6174 2063 6173 652e 0a20 2020 2020 2020  at case..       
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ab0: 2020 2020 2023 2053 6f2c 2075 7365 2061       # So, use a
+00013ac0: 2064 6966 6665 7265 6e74 6c79 206e 616d   differently nam
+00013ad0: 6564 2074 6162 6c65 2069 6620 7468 6572  ed table if ther
+00013ae0: 6520 6172 6520 6d75 6c74 6970 6c65 2062  e are multiple b
+00013af0: 6c6f 6273 2e0a 2020 2020 2020 2020 2020  lobs..          
+00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b10: 2020 6669 6c65 2e77 7269 7465 2864 622e    file.write(db.
+00013b20: 6578 6563 7574 6528 2753 454c 4543 5420  execute('SELECT 
+00013b30: 6461 7461 2046 524f 4d20 677a 6970 696e  data FROM gzipin
+00013b40: 6465 7827 292e 6665 7463 686f 6e65 2829  dex').fetchone()
+00013b50: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+00013b60: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00013b70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013b80: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00013b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013ba0: 2020 2020 2073 656c 662e 5f75 6e63 6865       self._unche
+00013bb0: 636b 6564 5265 6d6f 7665 2867 7a69 6e64  ckedRemove(gzind
+00013bc0: 6578 290a 2020 2020 2020 2020 2020 2020  ex).            
+00013bd0: 2020 2020 2020 2020 677a 696e 6465 7820          gzindex 
+00013be0: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+00013bf0: 2020 2020 6966 2067 7a69 6e64 6578 3a0a      if gzindex:.
+00013c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c10: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00013c20: 2020 2020 2020 2020 2066 696c 654f 626a           fileObj
+00013c30: 6563 742e 696d 706f 7274 5f69 6e64 6578  ect.import_index
+00013c40: 2866 696c 656e 616d 653d 677a 696e 6465  (filename=gzinde
+00013c50: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
+00013c60: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00013c70: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00013c80: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+00013c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ca0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00013cb0: 2020 2020 2020 2020 2066 696e 616c 6c79           finally
+00013cc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013cd0: 2020 2020 2020 7365 6c66 2e5f 756e 6368        self._unch
+00013ce0: 6563 6b65 6452 656d 6f76 6528 677a 696e  eckedRemove(gzin
+00013cf0: 6465 7829 0a0a 2020 2020 2020 2020 2020  dex)..          
+00013d00: 2020 2320 5374 6f72 6520 7468 6520 6f66    # Store the of
+00013d10: 6673 6574 7320 696e 746f 2061 2074 656d  fsets into a tem
+00013d20: 706f 7261 7279 2066 696c 6520 616e 6420  porary file and 
+00013d30: 7468 656e 2069 6e74 6f20 7468 6520 5351  then into the SQ
+00013d40: 4c69 7465 2064 6174 6162 6173 650a 2020  Lite database.  
+00013d50: 2020 2020 2020 2020 2020 6966 2070 7269            if pri
+00013d60: 6e74 4465 6275 6720 3e3d 2032 3a0a 2020  ntDebug >= 2:.  
+00013d70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00013d80: 696e 7428 225b 496e 666f 5d20 436f 756c  int("[Info] Coul
+00013d90: 6420 6e6f 7420 6c6f 6164 2047 5a69 7020  d not load GZip 
+00013da0: 426c 6f63 6b20 6f66 6673 6574 2064 6174  Block offset dat
+00013db0: 612e 2057 696c 6c20 6372 6561 7465 2069  a. Will create i
+00013dc0: 7420 6672 6f6d 2073 6372 6174 6368 2e22  t from scratch."
+00013dd0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00013de0: 2054 7261 6e73 7061 7265 6e74 6c79 2066   Transparently f
+00013df0: 6f72 6365 2069 6e64 6578 2074 6f20 6265  orce index to be
+00013e00: 2062 7569 6c74 2069 6620 6e6f 7420 616c   built if not al
+00013e10: 7265 6164 7920 646f 6e65 2073 6f2e 2062  ready done so. b
+00013e20: 7569 6c64 5f66 756c 6c5f 696e 6465 7820  uild_full_index 
+00013e30: 7761 7320 6275 6767 7920 666f 7220 6d65  was buggy for me
+00013e40: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00013e50: 5365 656b 696e 6720 6672 6f6d 2065 6e64  Seeking from end
+00013e60: 206e 6f74 2073 7570 706f 7274 6564 2c20   not supported, 
+00013e70: 736f 2077 6520 6861 7665 2074 6f20 7265  so we have to re
+00013e80: 6164 2074 6865 2077 686f 6c65 2064 6174  ad the whole dat
+00013e90: 6120 696e 2069 6e20 6120 6c6f 6f70 0a20  a in in a loop. 
+00013ea0: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+00013eb0: 2066 696c 654f 626a 6563 742e 7265 6164   fileObject.read
+00013ec0: 2831 3032 3420 2a20 3130 3234 293a 0a20  (1024 * 1024):. 
+00013ed0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013ee0: 6173 730a 0a20 2020 2020 2020 2020 2020  ass..           
+00013ef0: 2023 2054 6865 2063 7265 6174 6564 2069   # The created i
+00013f00: 6e64 6578 2063 616e 2075 6e66 6f72 7475  ndex can unfortu
+00013f10: 6e61 7465 6c79 2062 6520 7072 6574 7479  nately be pretty
+00013f20: 206c 6172 6765 2061 6e64 2074 6d70 206d   large and tmp m
+00013f30: 6967 6874 2061 6374 7561 6c6c 7920 7275  ight actually ru
+00013f40: 6e20 6f75 7420 6f66 206d 656d 6f72 7921  n out of memory!
+00013f50: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+00013f60: 6865 7265 666f 7265 2c20 7472 7920 6469  herefore, try di
+00013f70: 6666 6572 656e 7420 7061 7468 732c 2073  fferent paths, s
+00013f80: 7461 7274 696e 6720 7769 7468 2074 6865  tarting with the
+00013f90: 206c 6f63 6174 696f 6e20 7768 6572 6520   location where 
+00013fa0: 7468 6520 696e 6465 7820 7265 7369 6465  the index reside
+00013fb0: 732e 0a20 2020 2020 2020 2020 2020 2067  s..            g
+00013fc0: 7a69 6e64 6578 203d 204e 6f6e 650a 2020  zindex = None.  
+00013fd0: 2020 2020 2020 2020 2020 666f 7220 746d            for tm
+00013fe0: 7044 6972 2069 6e20 5b6f 732e 7061 7468  pDir in [os.path
+00013ff0: 2e64 6972 6e61 6d65 2873 656c 662e 696e  .dirname(self.in
+00014000: 6465 7846 696c 654e 616d 6529 2c20 4e6f  dexFileName), No
+00014010: 6e65 5d3a 0a20 2020 2020 2020 2020 2020  ne]:.           
+00014020: 2020 2020 2067 7a69 6e64 6578 203d 2074       gzindex = t
+00014030: 656d 7066 696c 652e 6d6b 7374 656d 7028  empfile.mkstemp(
+00014040: 6469 723d 746d 7044 6972 295b 315d 0a20  dir=tmpDir)[1]. 
+00014050: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00014060: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00014070: 2020 2020 2020 2020 6669 6c65 4f62 6a65          fileObje
+00014080: 6374 2e65 7870 6f72 745f 696e 6465 7828  ct.export_index(
+00014090: 6669 6c65 6e61 6d65 3d67 7a69 6e64 6578  filename=gzindex
 000140a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000140b0: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-000140c0: 7272 6f72 2822 436f 756c 6420 6e6f 7420  rror("Could not 
-000140d0: 696e 6974 6961 6c69 7a65 2074 6865 2047  initialize the G
-000140e0: 5a69 7020 7365 656b 2063 6163 6865 2e22  Zip seek cache."
-000140f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00014100: 2070 7269 6e74 4465 6275 6720 3e3d 2032   printDebug >= 2
-00014110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014120: 2020 7072 696e 7428 2245 7870 6f72 7465    print("Exporte
-00014130: 6420 475a 6970 2069 6e64 6578 2073 697a  d GZip index siz
-00014140: 653a 222c 206f 732e 7374 6174 2867 7a69  e:", os.stat(gzi
-00014150: 6e64 6578 292e 7374 5f73 697a 6529 0a0a  ndex).st_size)..
-00014160: 2020 2020 2020 2020 2020 2020 2320 436c              # Cl
-00014170: 6561 6e20 7570 2075 6e72 6561 6461 626c  ean up unreadabl
-00014180: 6520 6f6c 6465 7220 6461 7461 2e0a 2020  e older data..  
-00014190: 2020 2020 2020 2020 2020 6966 2027 677a            if 'gz
-000141a0: 6970 696e 6465 7827 2069 6e20 7461 626c  ipindex' in tabl
-000141b0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000141c0: 2020 2020 6462 2e65 7865 6375 7465 2827      db.execute('
-000141d0: 4452 4f50 2054 4142 4c45 2067 7a69 7069  DROP TABLE gzipi
-000141e0: 6e64 6578 2729 0a20 2020 2020 2020 2020  ndex').         
-000141f0: 2020 2069 6620 2767 7a69 7069 6e64 6578     if 'gzipindex
-00014200: 6573 2720 696e 2074 6162 6c65 733a 0a20  es' in tables:. 
-00014210: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00014220: 622e 6578 6563 7574 6528 2744 524f 5020  b.execute('DROP 
-00014230: 5441 424c 4520 677a 6970 696e 6465 7865  TABLE gzipindexe
-00014240: 7327 290a 0a20 2020 2020 2020 2020 2020  s')..           
-00014250: 2023 2054 6865 206d 6178 696d 756d 2062   # The maximum b
-00014260: 6c6f 6220 7369 7a65 2063 6f6e 6669 6775  lob size configu
-00014270: 7265 6420 6279 2053 514c 6974 6520 6973  red by SQLite is
-00014280: 2065 7861 6374 6c79 2031 2047 422c 2073   exactly 1 GB, s
-00014290: 6565 2068 7474 7073 3a2f 2f77 7777 2e73  ee https://www.s
-000142a0: 716c 6974 652e 6f72 672f 6c69 6d69 7473  qlite.org/limits
-000142b0: 2e68 746d 6c0a 2020 2020 2020 2020 2020  .html.          
-000142c0: 2020 2320 5468 6572 6566 6f72 652c 2074    # Therefore, t
-000142d0: 6869 7320 7368 6f75 6c64 2062 6520 736d  his should be sm
-000142e0: 616c 6c65 722e 2041 6e6f 7468 6572 2061  aller. Another a
-000142f0: 7267 756d 656e 7420 666f 7220 6d61 6b69  rgument for maki
-00014300: 6e67 2069 7420 736d 616c 6c65 7220 6973  ng it smaller is
-00014310: 2074 6861 7420 7468 6973 2062 6c6f 6220   that this blob 
-00014320: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-00014330: 2023 2077 696c 6c20 6265 2068 656c 6420   # will be held 
-00014340: 6675 6c6c 7920 696e 206d 656d 6f72 7920  fully in memory 
-00014350: 7465 6d70 6f72 6172 696c 792e 0a20 2020  temporarily..   
-00014360: 2020 2020 2020 2020 2023 2042 7574 2c20           # But, 
-00014370: 6d61 6b69 6e67 2069 7420 746f 6f20 736d  making it too sm
-00014380: 616c 6c20 776f 756c 6420 7265 7375 6c74  all would result
-00014390: 2069 6e20 746f 6f20 6d61 6e79 206e 6f6e   in too many non
-000143a0: 2d62 6163 6b77 6172 6473 2063 6f6d 7061  -backwards compa
-000143b0: 7469 626c 6520 696e 6465 7865 7320 6265  tible indexes be
-000143c0: 696e 6720 6372 6561 7465 642e 0a20 2020  ing created..   
-000143d0: 2020 2020 2020 2020 206d 6178 426c 6f62           maxBlob
-000143e0: 5369 7a65 203d 2032 3536 202a 2031 3032  Size = 256 * 102
-000143f0: 3420 2a20 3130 3234 2020 2320 3132 3820  4 * 1024  # 128 
-00014400: 4d69 420a 0a20 2020 2020 2020 2020 2020  MiB..           
-00014410: 2023 2053 746f 7265 2063 6f6e 7465 6e74   # Store content
-00014420: 7320 6f66 2074 656d 706f 7261 7279 2066  s of temporary f
-00014430: 696c 6520 696e 746f 2074 6865 2053 514c  ile into the SQL
-00014440: 6974 6520 6461 7461 6261 7365 0a20 2020  ite database.   
-00014450: 2020 2020 2020 2020 2069 6620 6f73 2e73           if os.s
-00014460: 7461 7428 677a 696e 6465 7829 2e73 745f  tat(gzindex).st_
-00014470: 7369 7a65 203e 206d 6178 426c 6f62 5369  size > maxBlobSi
-00014480: 7a65 3a0a 2020 2020 2020 2020 2020 2020  ze:.            
-00014490: 2020 2020 6462 2e65 7865 6375 7465 2827      db.execute('
-000144a0: 4352 4541 5445 2054 4142 4c45 2067 7a69  CREATE TABLE gzi
-000144b0: 7069 6e64 6578 6573 2028 2064 6174 6120  pindexes ( data 
-000144c0: 424c 4f42 2029 2729 0a20 2020 2020 2020  BLOB )').       
-000144d0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-000144e0: 656e 2867 7a69 6e64 6578 2c20 2772 6227  en(gzindex, 'rb'
-000144f0: 2920 6173 2066 696c 653a 0a20 2020 2020  ) as file:.     
-00014500: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00014510: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
-00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014530: 2020 2064 6174 6120 3d20 6669 6c65 2e72     data = file.r
-00014540: 6561 6428 6d61 7842 6c6f 6253 697a 6529  ead(maxBlobSize)
-00014550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014560: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00014570: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014590: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
-000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145b0: 2023 2049 276d 2070 7265 7474 7920 7375   # I'm pretty su
-000145c0: 7265 2074 6861 7420 7468 6520 726f 7769  re that the rowi
-000145d0: 6420 6361 6e20 6265 2075 7365 6420 746f  d can be used to
-000145e0: 2071 7565 7279 2074 6865 2072 6f77 7320   query the rows 
-000145f0: 7769 7468 2074 6865 2069 6e73 6572 7469  with the inserti
-00014600: 6f6e 206f 7264 6572 3a0a 2020 2020 2020  on order:.      
-00014610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014620: 2020 2320 6874 7470 733a 2f2f 7777 772e    # https://www.
-00014630: 7371 6c69 7465 2e6f 7267 2f61 7574 6f69  sqlite.org/autoi
-00014640: 6e63 2e68 746d 6c0a 2020 2020 2020 2020  nc.html.        
-00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014660: 2320 3e20 5468 6520 7573 7561 6c20 616c  # > The usual al
-00014670: 676f 7269 7468 6d20 6973 2074 6f20 6769  gorithm is to gi
-00014680: 7665 2074 6865 206e 6577 6c79 2063 7265  ve the newly cre
-00014690: 6174 6564 2072 6f77 2061 2052 4f57 4944  ated row a ROWID
-000146a0: 2074 6861 7420 6973 206f 6e65 206c 6172   that is one lar
-000146b0: 6765 7220 7468 616e 2074 6865 0a20 2020  ger than the.   
-000146c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146d0: 2020 2020 2023 2020 206c 6172 6765 7374       #   largest
-000146e0: 2052 4f57 4944 2069 6e20 7468 6520 7461   ROWID in the ta
-000146f0: 626c 6520 7072 696f 7220 746f 2074 6865  ble prior to the
-00014700: 2069 6e73 6572 742e 0a20 2020 2020 2020   insert..       
-00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014720: 2023 2054 6865 2022 7573 7561 6c22 206d   # The "usual" m
-00014730: 616b 6573 206d 6520 776f 7272 7920 6120  akes me worry a 
-00014740: 6269 742c 2062 7574 2049 2074 6869 6e6b  bit, but I think
-00014750: 2069 7420 6973 2069 6e20 7265 6665 7265   it is in refere
-00014760: 6e63 6520 746f 2074 6865 2041 5554 4f49  nce to the AUTOI
-00014770: 4e43 5245 4d45 4e54 2066 6561 7475 7265  NCREMENT feature
-00014780: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014790: 2020 2020 2020 2020 2020 6462 2e65 7865            db.exe
-000147a0: 6375 7465 2827 494e 5345 5254 2049 4e54  cute('INSERT INT
-000147b0: 4f20 677a 6970 696e 6465 7865 7320 5641  O gzipindexes VA
-000147c0: 4c55 4553 2028 3f29 272c 2028 6461 7461  LUES (?)', (data
-000147d0: 2c29 290a 2020 2020 2020 2020 2020 2020  ,)).            
-000147e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000147f0: 2020 2020 2020 6462 2e65 7865 6375 7465        db.execute
-00014800: 2827 4352 4541 5445 2054 4142 4c45 2067  ('CREATE TABLE g
-00014810: 7a69 7069 6e64 6578 2028 2064 6174 6120  zipindex ( data 
-00014820: 424c 4f42 2029 2729 0a20 2020 2020 2020  BLOB )').       
-00014830: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00014840: 656e 2867 7a69 6e64 6578 2c20 2772 6227  en(gzindex, 'rb'
-00014850: 2920 6173 2066 696c 653a 0a20 2020 2020  ) as file:.     
-00014860: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00014870: 622e 6578 6563 7574 6528 2749 4e53 4552  b.execute('INSER
-00014880: 5420 494e 544f 2067 7a69 7069 6e64 6578  T INTO gzipindex
-00014890: 2056 414c 5545 5320 283f 2927 2c20 2866   VALUES (?)', (f
-000148a0: 696c 652e 7265 6164 2829 2c29 290a 0a20  ile.read(),)).. 
-000148b0: 2020 2020 2020 2020 2020 2064 622e 636f             db.co
-000148c0: 6d6d 6974 2829 0a20 2020 2020 2020 2020  mmit().         
-000148d0: 2020 206f 732e 7265 6d6f 7665 2867 7a69     os.remove(gzi
-000148e0: 6e64 6578 290a 2020 2020 2020 2020 2020  ndex).          
-000148f0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00014900: 2020 2320 4e6f 7465 2074 6861 7420 666f    # Note that fo
-00014910: 7220 787a 2073 6565 6b69 6e67 2c20 6c6f  r xz seeking, lo
-00014920: 6164 696e 6720 616e 6420 7374 6f72 696e  ading and storin
-00014930: 6720 626c 6f63 6b20 696e 6465 7865 7320  g block indexes 
-00014940: 6973 2075 6e6e 6563 6573 7361 7279 2062  is unnecessary b
-00014950: 6563 6175 7365 2069 7420 6861 7320 616e  ecause it has an
-00014960: 2069 6e64 6578 2069 6e63 6c75 6465 6421   index included!
-00014970: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00014980: 2e63 6f6d 7072 6573 7369 6f6e 2069 6e20  .compression in 
-00014990: 5b4e 6f6e 652c 2027 787a 275d 3a0a 2020  [None, 'xz']:.  
-000149a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000149b0: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
-000149c0: 2028 0a20 2020 2020 2020 2020 2020 2046   (.            F
-000149d0: 616c 7365 0a20 2020 2020 2020 2029 2c20  alse.        ), 
-000149e0: 2243 6f75 6c64 206e 6f74 206c 6f61 6420  "Could not load 
-000149f0: 6f72 2073 746f 7265 2062 6c6f 636b 206f  or store block o
-00014a00: 6666 7365 7473 2066 6f72 207b 7d20 7072  ffsets for {} pr
-00014a10: 6f62 6162 6c79 2062 6563 6175 7365 2061  obably because a
-00014a20: 6464 696e 6720 7375 7070 6f72 7420 7761  dding support wa
-00014a30: 7320 666f 7267 6f74 7465 6e21 222e 666f  s forgotten!".fo
-00014a40: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
-00014a50: 2020 7365 6c66 2e63 6f6d 7072 6573 7369    self.compressi
-00014a60: 6f6e 0a20 2020 2020 2020 2029 0a0a 0a64  on.        )...d
-00014a70: 6566 205f 6d61 6b65 4d6f 756e 7450 6f69  ef _makeMountPoi
-00014a80: 6e74 4669 6c65 496e 666f 4672 6f6d 5374  ntFileInfoFromSt
-00014a90: 6174 7328 7374 6174 733a 206f 732e 7374  ats(stats: os.st
-00014aa0: 6174 5f72 6573 756c 7429 202d 3e20 4669  at_result) -> Fi
-00014ab0: 6c65 496e 666f 3a0a 2020 2020 2320 6d61  leInfo:.    # ma
-00014ac0: 6b65 2074 6865 206d 6f75 6e74 2070 6f69  ke the mount poi
-00014ad0: 6e74 2072 6561 6420 6f6e 6c79 2061 6e64  nt read only and
-00014ae0: 2065 7865 6375 7461 626c 6520 6966 2072   executable if r
-00014af0: 6561 6461 626c 652c 2069 2e65 2e2c 2061  eadable, i.e., a
-00014b00: 6c6c 6f77 2064 6972 6563 746f 7279 206c  llow directory l
-00014b10: 6973 7469 6e67 0a20 2020 2023 2063 6c65  isting.    # cle
-00014b20: 6172 2068 6967 6865 7220 6269 7473 206c  ar higher bits l
-00014b30: 696b 6520 535f 4946 5245 4720 616e 6420  ike S_IFREG and 
-00014b40: 7365 7420 7468 6520 6469 7265 6374 6f72  set the director
-00014b50: 7920 6269 7420 696e 7374 6561 640a 2020  y bit instead.  
-00014b60: 2020 6d6f 756e 744d 6f64 6520 3d20 280a    mountMode = (.
-00014b70: 2020 2020 2020 2020 2873 7461 7473 2e73          (stats.s
-00014b80: 745f 6d6f 6465 2026 2030 6f37 3737 290a  t_mode & 0o777).
-00014b90: 2020 2020 2020 2020 7c20 7374 6174 2e53          | stat.S
-00014ba0: 5f49 4644 4952 0a20 2020 2020 2020 207c  _IFDIR.        |
-00014bb0: 2028 7374 6174 2e53 5f49 5855 5352 2069   (stat.S_IXUSR i
-00014bc0: 6620 7374 6174 732e 7374 5f6d 6f64 6520  f stats.st_mode 
-00014bd0: 2620 7374 6174 2e53 5f49 5255 5352 2021  & stat.S_IRUSR !
-00014be0: 3d20 3020 656c 7365 2030 290a 2020 2020  = 0 else 0).    
-00014bf0: 2020 2020 7c20 2873 7461 742e 535f 4958      | (stat.S_IX
-00014c00: 4752 5020 6966 2073 7461 7473 2e73 745f  GRP if stats.st_
-00014c10: 6d6f 6465 2026 2073 7461 742e 535f 4952  mode & stat.S_IR
-00014c20: 4752 5020 213d 2030 2065 6c73 6520 3029  GRP != 0 else 0)
-00014c30: 0a20 2020 2020 2020 207c 2028 7374 6174  .        | (stat
-00014c40: 2e53 5f49 584f 5448 2069 6620 7374 6174  .S_IXOTH if stat
-00014c50: 732e 7374 5f6d 6f64 6520 2620 7374 6174  s.st_mode & stat
-00014c60: 2e53 5f49 524f 5448 2021 3d20 3020 656c  .S_IROTH != 0 el
-00014c70: 7365 2030 290a 2020 2020 290a 0a20 2020  se 0).    )..   
-00014c80: 2066 696c 6549 6e66 6f20 3d20 4669 6c65   fileInfo = File
-00014c90: 496e 666f 280a 2020 2020 2020 2020 2320  Info(.        # 
-00014ca0: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
-00014cb0: 2073 697a 6520 2020 2020 3d20 7374 6174   size     = stat
-00014cc0: 732e 7374 5f73 697a 652c 0a20 2020 2020  s.st_size,.     
-00014cd0: 2020 206d 7469 6d65 2020 2020 3d20 7374     mtime    = st
-00014ce0: 6174 732e 7374 5f6d 7469 6d65 2c0a 2020  ats.st_mtime,.  
-00014cf0: 2020 2020 2020 6d6f 6465 2020 2020 203d        mode     =
-00014d00: 206d 6f75 6e74 4d6f 6465 2c0a 2020 2020   mountMode,.    
-00014d10: 2020 2020 6c69 6e6b 6e61 6d65 203d 2022      linkname = "
-00014d20: 222c 0a20 2020 2020 2020 2075 6964 2020  ",.        uid  
-00014d30: 2020 2020 3d20 7374 6174 732e 7374 5f75      = stats.st_u
-00014d40: 6964 2c0a 2020 2020 2020 2020 6769 6420  id,.        gid 
-00014d50: 2020 2020 203d 2073 7461 7473 2e73 745f       = stats.st_
-00014d60: 6769 642c 0a20 2020 2020 2020 2075 7365  gid,.        use
-00014d70: 7264 6174 6120 3d20 5b5d 2c0a 2020 2020  rdata = [],.    
-00014d80: 2020 2020 2320 666d 743a 206f 6e0a 2020      # fmt: on.  
-00014d90: 2020 290a 0a20 2020 2072 6574 7572 6e20    )..    return 
-00014da0: 6669 6c65 496e 666f 0a0a 0a63 6c61 7373  fileInfo...class
-00014db0: 2046 6f6c 6465 724d 6f75 6e74 536f 7572   FolderMountSour
-00014dc0: 6365 284d 6f75 6e74 536f 7572 6365 293a  ce(MountSource):
-00014dd0: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
-00014de0: 7320 636c 6173 7320 6d61 6e61 6765 7320  s class manages 
-00014df0: 6f6e 6520 666f 6c64 6572 2061 7320 6d6f  one folder as mo
-00014e00: 756e 7420 736f 7572 6365 206f 6666 6572  unt source offer
-00014e10: 696e 6720 6d65 7468 6f64 7320 666f 7220  ing methods for 
-00014e20: 6c69 7374 696e 6720 666f 6c64 6572 732c  listing folders,
-00014e30: 2072 6561 6469 6e67 2066 696c 6573 2c20   reading files, 
-00014e40: 616e 6420 6f74 6865 7273 2e0a 2020 2020  and others..    
-00014e50: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00014e60: 6e69 745f 5f28 7365 6c66 2c20 7061 7468  nit__(self, path
-00014e70: 3a20 7374 7229 202d 3e20 4e6f 6e65 3a0a  : str) -> None:.
-00014e80: 2020 2020 2020 2020 7365 6c66 2e72 6f6f          self.roo
-00014e90: 743a 2073 7472 203d 2070 6174 680a 0a20  t: str = path.. 
-00014ea0: 2020 2064 6566 2073 6574 466f 6c64 6572     def setFolder
-00014eb0: 4465 7363 7269 7074 6f72 2873 656c 662c  Descriptor(self,
-00014ec0: 2066 643a 2069 6e74 2920 2d3e 204e 6f6e   fd: int) -> Non
-00014ed0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-00014ee0: 2020 2020 2020 204d 616b 6520 7468 6973         Make this
-00014ef0: 206d 6f75 6e74 2073 6f75 7263 6520 6d61   mount source ma
-00014f00: 6e61 6765 2074 6865 2073 7065 6369 616c  nage the special
-00014f10: 2022 2e22 2066 6f6c 6465 7220 6279 2063   "." folder by c
-00014f20: 6861 6e67 696e 6720 746f 2074 6861 7420  hanging to that 
-00014f30: 6469 7265 6374 6f72 792e 0a20 2020 2020  directory..     
-00014f40: 2020 2042 6563 6175 7365 2077 6520 6368     Because we ch
-00014f50: 616e 6765 2074 6f20 7468 6174 2064 6972  ange to that dir
-00014f60: 6563 746f 7279 2069 7420 6d61 7920 6f6e  ectory it may on
-00014f70: 6c79 2062 6520 7573 6564 2066 6f72 206f  ly be used for o
-00014f80: 6e65 206d 6f75 6e74 2073 6f75 7263 6520  ne mount source 
-00014f90: 6275 7420 6974 2061 6c73 6f20 776f 726b  but it also work
-00014fa0: 730a 2020 2020 2020 2020 7768 656e 2074  s.        when t
-00014fb0: 6861 7420 6d6f 756e 7420 736f 7572 6365  hat mount source
-00014fc0: 2069 7320 6d6f 756e 7465 6420 6f6e 210a   is mounted on!.
-00014fd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014fe0: 2020 2020 6f73 2e66 6368 6469 7228 6664      os.fchdir(fd
-00014ff0: 290a 2020 2020 2020 2020 7365 6c66 2e72  ).        self.r
-00015000: 6f6f 7420 3d20 272e 270a 0a20 2020 2064  oot = '.'..    d
-00015010: 6566 205f 7265 616c 7061 7468 2873 656c  ef _realpath(sel
-00015020: 662c 2070 6174 683a 2073 7472 2920 2d3e  f, path: str) ->
-00015030: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-00015040: 2250 6174 6820 6769 7665 6e20 7265 6c61  "Path given rela
-00015050: 7469 7665 2074 6f20 666f 6c64 6572 2072  tive to folder r
-00015060: 6f6f 742e 204c 6561 6469 6e67 2027 2f27  oot. Leading '/'
-00015070: 2069 7320 6163 6365 7074 6162 6c65 2222   is acceptable""
-00015080: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00015090: 206f 732e 7061 7468 2e6a 6f69 6e28 7365   os.path.join(se
-000150a0: 6c66 2e72 6f6f 742c 2070 6174 682e 6c73  lf.root, path.ls
-000150b0: 7472 6970 286f 732e 7061 7468 2e73 6570  trip(os.path.sep
-000150c0: 2929 0a0a 2020 2020 406f 7665 7272 6964  ))..    @overrid
-000150d0: 6573 284d 6f75 6e74 536f 7572 6365 290a  es(MountSource).
-000150e0: 2020 2020 6465 6620 6578 6973 7473 2873      def exists(s
-000150f0: 656c 662c 2070 6174 683a 2073 7472 2920  elf, path: str) 
-00015100: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00015110: 2072 6574 7572 6e20 6f73 2e70 6174 682e   return os.path.
-00015120: 6c65 7869 7374 7328 7365 6c66 2e5f 7265  lexists(self._re
-00015130: 616c 7061 7468 2870 6174 6829 290a 0a20  alpath(path)).. 
-00015140: 2020 2040 6f76 6572 7269 6465 7328 4d6f     @overrides(Mo
-00015150: 756e 7453 6f75 7263 6529 0a20 2020 2064  untSource).    d
-00015160: 6566 2067 6574 4669 6c65 496e 666f 2873  ef getFileInfo(s
-00015170: 656c 662c 2070 6174 683a 2073 7472 2c20  elf, path: str, 
-00015180: 6669 6c65 5665 7273 696f 6e3a 2069 6e74  fileVersion: int
-00015190: 203d 2030 2920 2d3e 204f 7074 696f 6e61   = 0) -> Optiona
-000151a0: 6c5b 4669 6c65 496e 666f 5d3a 0a20 2020  l[FileInfo]:.   
-000151b0: 2020 2020 2022 2222 416c 6c20 7265 7475       """All retu
-000151c0: 726e 6564 2066 696c 6520 696e 666f 7320  rned file infos 
-000151d0: 636f 6e74 6169 6e20 6120 6669 6c65 2070  contain a file p
-000151e0: 6174 6820 7374 7269 6e67 2061 7420 7468  ath string at th
-000151f0: 6520 6261 636b 206f 6620 4669 6c65 496e  e back of FileIn
-00015200: 666f 2e75 7365 7264 6174 612e 2222 220a  fo.userdata.""".
-00015210: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
-00015220: 6973 2061 2062 6974 206f 6620 7072 6f62  is a bit of prob
-00015230: 6c65 6d61 7469 6320 6465 7369 676e 2c20  lematic design, 
-00015240: 686f 7765 7665 722c 2074 6865 2066 696c  however, the fil
-00015250: 6556 6572 7369 6f6e 7320 636f 756e 7420  eVersions count 
-00015260: 6672 6f6d 2031 2066 6f72 2074 6865 2075  from 1 for the u
-00015270: 7365 722e 0a20 2020 2020 2020 2023 2041  ser..        # A
-00015280: 6e64 2061 7320 2d31 206d 6561 6e73 2074  nd as -1 means t
-00015290: 6865 206c 6173 7420 7665 7273 696f 6e2c  he last version,
-000152a0: 2030 2073 686f 756c 6420 616c 736f 206d   0 should also m
-000152b0: 6561 6e20 7468 6520 6669 7273 7420 7665  ean the first ve
-000152c0: 7273 696f 6e20 2e2e 2e0a 2020 2020 2020  rsion ....      
-000152d0: 2020 2320 4261 7369 6361 6c6c 792c 2049    # Basically, I
-000152e0: 2064 6964 2061 6363 6964 656e 7461 6c6c   did accidentall
-000152f0: 7920 6d69 7820 7573 6572 2d76 6973 6962  y mix user-visib
-00015300: 6c65 2076 6572 7369 6f6e 7320 312b 2076  le versions 1+ v
-00015310: 6572 7369 6f6e 7320 7769 7468 2041 5049  ersions with API
-00015320: 2030 2b20 7665 7273 696f 6e73 2c0a 2020   0+ versions,.  
-00015330: 2020 2020 2020 2320 6c65 6164 696e 6720        # leading 
-00015340: 746f 2074 6869 7320 7072 6f62 6c65 6d61  to this problema
-00015350: 7469 6320 636c 6173 6820 6f66 2030 2061  tic clash of 0 a
-00015360: 6e64 2031 2e0a 2020 2020 2020 2020 6966  nd 1..        if
-00015370: 2066 696c 6556 6572 7369 6f6e 206e 6f74   fileVersion not
-00015380: 2069 6e20 5b30 2c20 315d 206f 7220 6e6f   in [0, 1] or no
-00015390: 7420 7365 6c66 2e65 7869 7374 7328 7061  t self.exists(pa
-000153a0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-000153b0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
-000153c0: 2020 2020 2020 7265 616c 7061 7468 203d        realpath =
-000153d0: 2073 656c 662e 5f72 6561 6c70 6174 6828   self._realpath(
-000153e0: 7061 7468 290a 0a20 2020 2020 2020 2073  path)..        s
-000153f0: 7461 7473 203d 206f 732e 6c73 7461 7428  tats = os.lstat(
-00015400: 7265 616c 7061 7468 290a 0a20 2020 2020  realpath)..     
-00015410: 2020 2066 696c 6549 6e66 6f20 3d20 4669     fileInfo = Fi
-00015420: 6c65 496e 666f 280a 2020 2020 2020 2020  leInfo(.        
-00015430: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
-00015440: 2020 2020 2020 2020 2020 2073 697a 6520             size 
-00015450: 2020 2020 3d20 7374 6174 732e 7374 5f73      = stats.st_s
-00015460: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
-00015470: 206d 7469 6d65 2020 2020 3d20 7374 6174   mtime    = stat
-00015480: 732e 7374 5f6d 7469 6d65 2c0a 2020 2020  s.st_mtime,.    
-00015490: 2020 2020 2020 2020 6d6f 6465 2020 2020          mode    
-000154a0: 203d 2073 7461 7473 2e73 745f 6d6f 6465   = stats.st_mode
-000154b0: 2c0a 2020 2020 2020 2020 2020 2020 6c69  ,.            li
-000154c0: 6e6b 6e61 6d65 203d 206f 732e 7265 6164  nkname = os.read
-000154d0: 6c69 6e6b 2872 6561 6c70 6174 6829 2069  link(realpath) i
-000154e0: 6620 6f73 2e70 6174 682e 6973 6c69 6e6b  f os.path.islink
-000154f0: 2872 6561 6c70 6174 6829 2065 6c73 6520  (realpath) else 
-00015500: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-00015510: 7569 6420 2020 2020 203d 2073 7461 7473  uid      = stats
-00015520: 2e73 745f 7569 642c 0a20 2020 2020 2020  .st_uid,.       
-00015530: 2020 2020 2067 6964 2020 2020 2020 3d20       gid      = 
-00015540: 7374 6174 732e 7374 5f67 6964 2c0a 2020  stats.st_gid,.  
-00015550: 2020 2020 2020 2020 2020 7573 6572 6461            userda
-00015560: 7461 203d 205b 7061 7468 5d2c 0a20 2020  ta = [path],.   
-00015570: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
-00015580: 6f6e 0a20 2020 2020 2020 2029 0a0a 2020  on.        )..  
-00015590: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
-000155a0: 6549 6e66 6f0a 0a20 2020 2040 6f76 6572  eInfo..    @over
-000155b0: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
-000155c0: 6529 0a20 2020 2064 6566 206c 6973 7444  e).    def listD
-000155d0: 6972 2873 656c 662c 2070 6174 683a 2073  ir(self, path: s
-000155e0: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
-000155f0: 4974 6572 6162 6c65 5b73 7472 5d5d 3a0a  Iterable[str]]:.
-00015600: 2020 2020 2020 2020 7265 616c 7061 7468          realpath
-00015610: 203d 2073 656c 662e 5f72 6561 6c70 6174   = self._realpat
-00015620: 6828 7061 7468 290a 2020 2020 2020 2020  h(path).        
-00015630: 6966 206e 6f74 206f 732e 7061 7468 2e69  if not os.path.i
-00015640: 7364 6972 2872 6561 6c70 6174 6829 3a0a  sdir(realpath):.
-00015650: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015660: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
-00015670: 2066 696c 6573 203d 206c 6973 7428 6f73   files = list(os
-00015680: 2e6c 6973 7464 6972 2872 6561 6c70 6174  .listdir(realpat
-00015690: 6829 290a 0a20 2020 2020 2020 2072 6574  h))..        ret
-000156a0: 7572 6e20 6669 6c65 730a 0a20 2020 2040  urn files..    @
-000156b0: 6f76 6572 7269 6465 7328 4d6f 756e 7453  overrides(MountS
-000156c0: 6f75 7263 6529 0a20 2020 2064 6566 2066  ource).    def f
-000156d0: 696c 6556 6572 7369 6f6e 7328 7365 6c66  ileVersions(self
-000156e0: 2c20 7061 7468 3a20 7374 7229 202d 3e20  , path: str) -> 
-000156f0: 696e 743a 0a20 2020 2020 2020 2072 6574  int:.        ret
-00015700: 7572 6e20 3120 6966 2073 656c 662e 6578  urn 1 if self.ex
-00015710: 6973 7473 2870 6174 6829 2065 6c73 6520  ists(path) else 
-00015720: 300a 0a20 2020 2040 6f76 6572 7269 6465  0..    @override
-00015730: 7328 4d6f 756e 7453 6f75 7263 6529 0a20  s(MountSource). 
-00015740: 2020 2064 6566 206f 7065 6e28 7365 6c66     def open(self
-00015750: 2c20 6669 6c65 496e 666f 3a20 4669 6c65  , fileInfo: File
-00015760: 496e 666f 2920 2d3e 2049 4f5b 6279 7465  Info) -> IO[byte
-00015770: 735d 3a0a 2020 2020 2020 2020 7061 7468  s]:.        path
-00015780: 203d 2066 696c 6549 6e66 6f2e 7573 6572   = fileInfo.user
-00015790: 6461 7461 5b2d 315d 0a20 2020 2020 2020  data[-1].       
-000157a0: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-000157b0: 6365 2870 6174 682c 2073 7472 290a 2020  ce(path, str).  
-000157c0: 2020 2020 2020 7265 616c 7061 7468 203d        realpath =
-000157d0: 2073 656c 662e 5f72 6561 6c70 6174 6828   self._realpath(
-000157e0: 7061 7468 290a 0a20 2020 2020 2020 2074  path)..        t
-000157f0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00015800: 7265 7475 726e 206f 7065 6e28 7265 616c  return open(real
-00015810: 7061 7468 2c20 2772 6227 290a 2020 2020  path, 'rb').    
-00015820: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00015830: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00015840: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00015850: 7565 4572 726f 7228 2253 7065 6369 6669  ueError("Specifi
-00015860: 6564 2070 6174 6820 277b 7d27 2069 7320  ed path '{}' is 
-00015870: 6e6f 7420 6120 6669 6c65 2074 6861 7420  not a file that 
-00015880: 6361 6e20 6265 2072 6561 6421 222e 666f  can be read!".fo
-00015890: 726d 6174 2872 6561 6c70 6174 6829 2920  rmat(realpath)) 
-000158a0: 6672 6f6d 2065 0a0a 2020 2020 406f 7665  from e..    @ove
-000158b0: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
-000158c0: 6365 290a 2020 2020 6465 6620 7265 6164  ce).    def read
-000158d0: 2873 656c 662c 2066 696c 6549 6e66 6f3a  (self, fileInfo:
-000158e0: 2046 696c 6549 6e66 6f2c 2073 697a 653a   FileInfo, size:
-000158f0: 2069 6e74 2c20 6f66 6673 6574 3a20 696e   int, offset: in
-00015900: 7429 202d 3e20 6279 7465 733a 0a20 2020  t) -> bytes:.   
-00015910: 2020 2020 2077 6974 6820 7365 6c66 2e6f       with self.o
-00015920: 7065 6e28 6669 6c65 496e 666f 2920 6173  pen(fileInfo) as
-00015930: 2066 696c 653a 0a20 2020 2020 2020 2020   file:.         
-00015940: 2020 2066 696c 652e 7365 656b 286f 6666     file.seek(off
-00015950: 7365 742c 206f 732e 5345 454b 5f53 4554  set, os.SEEK_SET
-00015960: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00015970: 7475 726e 2066 696c 652e 7265 6164 2873  turn file.read(s
-00015980: 697a 6529 0a0a 2020 2020 6465 6620 6765  ize)..    def ge
-00015990: 7446 696c 6550 6174 6828 7365 6c66 2c20  tFilePath(self, 
-000159a0: 6669 6c65 496e 666f 3a20 4669 6c65 496e  fileInfo: FileIn
-000159b0: 666f 2920 2d3e 2073 7472 3a0a 2020 2020  fo) -> str:.    
-000159c0: 2020 2020 7061 7468 203d 2066 696c 6549      path = fileI
-000159d0: 6e66 6f2e 7573 6572 6461 7461 5b2d 315d  nfo.userdata[-1]
-000159e0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-000159f0: 6973 696e 7374 616e 6365 2870 6174 682c  isinstance(path,
-00015a00: 2073 7472 290a 2020 2020 2020 2020 7265   str).        re
-00015a10: 7475 726e 2073 656c 662e 5f72 6561 6c70  turn self._realp
-00015a20: 6174 6828 7061 7468 290a 0a0a 636c 6173  ath(path)...clas
-00015a30: 7320 4175 746f 4d6f 756e 744c 6179 6572  s AutoMountLayer
-00015a40: 284d 6f75 6e74 536f 7572 6365 293a 0a20  (MountSource):. 
-00015a50: 2020 2022 2222 0a20 2020 2054 6869 7320     """.    This 
-00015a60: 6d6f 756e 7420 736f 7572 6365 2074 616b  mount source tak
-00015a70: 6573 2061 6e6f 7468 6572 206d 6f75 6e74  es another mount
-00015a80: 2073 6f75 7263 6520 616e 6420 6175 746f   source and auto
-00015a90: 6d61 7469 6361 6c6c 7920 7368 6f77 7320  matically shows 
-00015aa0: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
-00015ab0: 6669 6c65 7320 7768 6963 6820 6172 6520  files which are 
-00015ac0: 6172 6368 6976 6573 2e0a 2020 2020 5468  archives..    Th
-00015ad0: 6520 6465 7461 696c 6564 2062 6568 6176  e detailed behav
-00015ae0: 696f 7220 6361 6e20 6265 2063 6f6e 7472  ior can be contr
-00015af0: 6f6c 6c65 6420 7573 696e 6720 6f70 7469  olled using opti
-00015b00: 6f6e 732e 0a20 2020 2022 2222 0a0a 2020  ons..    """..  
-00015b10: 2020 5f5f 736c 6f74 735f 5f20 3d20 2827    __slots__ = ('
-00015b20: 6d6f 756e 7465 6427 2c20 276f 7074 696f  mounted', 'optio
-00015b30: 6e73 2729 0a0a 2020 2020 4064 6174 6163  ns')..    @datac
-00015b40: 6c61 7373 0a20 2020 2063 6c61 7373 204d  lass.    class M
-00015b50: 6f75 6e74 496e 666f 3a0a 2020 2020 2020  ountInfo:.      
-00015b60: 2020 6d6f 756e 7453 6f75 7263 653a 204d    mountSource: M
-00015b70: 6f75 6e74 536f 7572 6365 0a20 2020 2020  ountSource.     
-00015b80: 2020 2072 6f6f 7446 696c 6549 6e66 6f3a     rootFileInfo:
-00015b90: 2046 696c 6549 6e66 6f0a 0a20 2020 2064   FileInfo..    d
-00015ba0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00015bb0: 2c20 6d6f 756e 7453 6f75 7263 653a 204d  , mountSource: M
-00015bc0: 6f75 6e74 536f 7572 6365 2c20 2a2a 6f70  ountSource, **op
-00015bd0: 7469 6f6e 7329 202d 3e20 4e6f 6e65 3a0a  tions) -> None:.
-00015be0: 2020 2020 2020 2020 7365 6c66 2e6f 7074          self.opt
-00015bf0: 696f 6e73 203d 206f 7074 696f 6e73 0a0a  ions = options..
-00015c00: 2020 2020 2020 2020 726f 6f74 4669 6c65          rootFile
-00015c10: 496e 666f 203d 2046 696c 6549 6e66 6f28  Info = FileInfo(
-00015c20: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-00015c30: 6d74 3a20 6f66 660a 2020 2020 2020 2020  mt: off.        
-00015c40: 2020 2020 7369 7a65 2020 2020 2020 2020      size        
-00015c50: 203d 2030 2c0a 2020 2020 2020 2020 2020   = 0,.          
-00015c60: 2020 6d74 696d 6520 2020 2020 2020 203d    mtime        =
-00015c70: 2069 6e74 2874 696d 652e 7469 6d65 2829   int(time.time()
-00015c80: 292c 0a20 2020 2020 2020 2020 2020 206d  ),.            m
-00015c90: 6f64 6520 2020 2020 2020 2020 3d20 306f  ode         = 0o
-00015ca0: 3535 3520 7c20 7374 6174 2e53 5f49 4644  555 | stat.S_IFD
-00015cb0: 4952 2c0a 2020 2020 2020 2020 2020 2020  IR,.            
-00015cc0: 6c69 6e6b 6e61 6d65 2020 2020 203d 2022  linkname     = "
-00015cd0: 222c 0a20 2020 2020 2020 2020 2020 2075  ",.            u
-00015ce0: 6964 2020 2020 2020 2020 2020 3d20 6f73  id          = os
-00015cf0: 2e67 6574 7569 6428 292c 0a20 2020 2020  .getuid(),.     
-00015d00: 2020 2020 2020 2067 6964 2020 2020 2020         gid      
-00015d10: 2020 2020 3d20 6f73 2e67 6574 6769 6428      = os.getgid(
-00015d20: 292c 0a20 2020 2020 2020 2020 2020 2075  ),.            u
-00015d30: 7365 7264 6174 6120 2020 2020 3d20 5b27  serdata     = ['
-00015d40: 2f27 5d2c 0a20 2020 2020 2020 2020 2020  /'],.           
-00015d50: 2023 2066 6d74 3a20 6f6e 0a20 2020 2020   # fmt: on.     
-00015d60: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00015d70: 4d6f 756e 7420 706f 696e 7473 2061 7265  Mount points are
-00015d80: 2073 7065 6369 6669 6564 2077 6974 686f   specified witho
-00015d90: 7574 2074 7261 696c 696e 6720 736c 6173  ut trailing slas
-00015da0: 6820 616e 6420 7769 7468 206c 6561 6469  h and with leadi
-00015db0: 6e67 2073 6c61 7368 0a20 2020 2020 2020  ng slash.       
-00015dc0: 2023 2072 6570 7265 7365 6e74 696e 6720   # representing 
-00015dd0: 726f 6f74 206f 6620 7468 6973 206d 6f75  root of this mou
-00015de0: 6e74 2073 6f75 7263 652e 0a20 2020 2020  nt source..     
-00015df0: 2020 2023 2044 6973 6162 6c65 2066 616c     # Disable fal
-00015e00: 7365 2070 6f73 6974 6976 6520 696e 7472  se positive intr
-00015e10: 6f64 7563 6564 2077 6865 6e20 7570 6461  oduced when upda
-00015e20: 7469 6e67 2070 796c 696e 7420 6672 6f6d  ting pylint from
-00015e30: 2032 2e36 2074 6f20 322e 3132 2e0a 2020   2.6 to 2.12..  
-00015e40: 2020 2020 2020 2320 4974 206e 6f77 2074        # It now t
-00015e50: 6869 6e6b 7320 7468 6174 2074 6865 2061  hinks that the a
-00015e60: 7373 6967 6e6d 656e 7420 6973 2074 6f20  ssignment is to 
-00015e70: 4175 746f 4d6f 756e 744c 6179 6572 2069  AutoMountLayer i
-00015e80: 6e73 7465 6164 206f 6620 7365 6c66 2e6d  nstead of self.m
-00015e90: 6f75 6e74 6564 2e0a 2020 2020 2020 2020  ounted..        
-00015ea0: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
-00015eb0: 653d 7573 6564 2d62 6566 6f72 652d 6173  e=used-before-as
-00015ec0: 7369 676e 6d65 6e74 0a20 2020 2020 2020  signment.       
-00015ed0: 2073 656c 662e 6d6f 756e 7465 643a 2044   self.mounted: D
-00015ee0: 6963 745b 7374 722c 2041 7574 6f4d 6f75  ict[str, AutoMou
-00015ef0: 6e74 4c61 7965 722e 4d6f 756e 7449 6e66  ntLayer.MountInf
-00015f00: 6f5d 203d 207b 272f 273a 2041 7574 6f4d  o] = {'/': AutoM
-00015f10: 6f75 6e74 4c61 7965 722e 4d6f 756e 7449  ountLayer.MountI
-00015f20: 6e66 6f28 6d6f 756e 7453 6f75 7263 652c  nfo(mountSource,
-00015f30: 2072 6f6f 7446 696c 6549 6e66 6f29 7d0a   rootFileInfo)}.
-00015f40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00015f50: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00015f60: 2827 7265 6375 7273 6976 6527 2c20 4661  ('recursive', Fa
-00015f70: 6c73 6529 206f 7220 7365 6c66 2e6f 7074  lse) or self.opt
-00015f80: 696f 6e73 2e67 6574 2827 6c61 7a79 4d6f  ions.get('lazyMo
-00015f90: 756e 7469 6e67 272c 2046 616c 7365 293a  unting', False):
-00015fa0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00015fb0: 7572 6e0a 0a20 2020 2020 2020 2023 2047  urn..        # G
-00015fc0: 6f20 6f76 6572 2061 6c6c 2066 696c 6573  o over all files
-00015fd0: 2061 6e64 206d 6f75 6e74 2061 7263 6869   and mount archi
-00015fe0: 7665 7320 616e 6420 6576 656e 2061 7263  ves and even arc
-00015ff0: 6869 7665 7320 696e 2074 686f 7365 2061  hives in those a
-00016000: 7263 6869 7665 730a 2020 2020 2020 2020  rchives.        
-00016010: 666f 6c64 6572 7354 6f57 616c 6b20 3d20  foldersToWalk = 
-00016020: 5b27 2f27 5d0a 2020 2020 2020 2020 7768  ['/'].        wh
-00016030: 696c 6520 666f 6c64 6572 7354 6f57 616c  ile foldersToWal
-00016040: 6b3a 0a20 2020 2020 2020 2020 2020 2066  k:.            f
-00016050: 6f6c 6465 7220 3d20 666f 6c64 6572 7354  older = foldersT
-00016060: 6f57 616c 6b2e 706f 7028 290a 2020 2020  oWalk.pop().    
-00016070: 2020 2020 2020 2020 6669 6c65 4e61 6d65          fileName
-00016080: 7320 3d20 7365 6c66 2e6c 6973 7444 6972  s = self.listDir
-00016090: 2866 6f6c 6465 7229 0a20 2020 2020 2020  (folder).       
-000160a0: 2020 2020 2069 6620 6e6f 7420 6669 6c65       if not file
-000160b0: 4e61 6d65 733a 0a20 2020 2020 2020 2020  Names:.         
-000160c0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000160d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000160e0: 2066 696c 654e 616d 6520 696e 2066 696c   fileName in fil
-000160f0: 654e 616d 6573 3a0a 2020 2020 2020 2020  eNames:.        
-00016100: 2020 2020 2020 2020 6669 6c65 5061 7468          filePath
-00016110: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
-00016120: 666f 6c64 6572 2c20 6669 6c65 4e61 6d65  folder, fileName
-00016130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016140: 2020 6966 2073 656c 662e 6973 6469 7228    if self.isdir(
-00016150: 6669 6c65 5061 7468 293a 0a20 2020 2020  filePath):.     
-00016160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00016170: 6f6c 6465 7273 546f 5761 6c6b 2e61 7070  oldersToWalk.app
-00016180: 656e 6428 6669 6c65 5061 7468 290a 2020  end(filePath).  
-00016190: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000161a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000161b0: 2020 2020 2020 2020 6d6f 756e 7450 6f69          mountPoi
-000161c0: 6e74 203d 2073 656c 662e 5f74 7279 546f  nt = self._tryTo
-000161d0: 4d6f 756e 7446 696c 6528 6669 6c65 5061  MountFile(filePa
-000161e0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
-000161f0: 2020 2020 2020 2020 6966 206d 6f75 6e74          if mount
-00016200: 506f 696e 743a 0a20 2020 2020 2020 2020  Point:.         
-00016210: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00016220: 6f6c 6465 7273 546f 5761 6c6b 2e61 7070  oldersToWalk.app
-00016230: 656e 6428 6d6f 756e 7450 6f69 6e74 290a  end(mountPoint).
-00016240: 0a20 2020 2064 6566 205f 7369 6d70 6c79  .    def _simply
-00016250: 4669 6e64 4d6f 756e 7465 6428 7365 6c66  FindMounted(self
-00016260: 2c20 7061 7468 3a20 7374 7229 202d 3e20  , path: str) -> 
-00016270: 5475 706c 655b 7374 722c 2073 7472 5d3a  Tuple[str, str]:
-00016280: 0a20 2020 2020 2020 2022 2222 5365 6520  .        """See 
-00016290: 5f66 696e 644d 6f75 6e74 6564 2e20 5468  _findMounted. Th
-000162a0: 6973 2069 7320 7370 6c69 7420 6f66 6620  is is split off 
-000162b0: 746f 2061 766f 6964 2063 6f6e 766f 6c75  to avoid convolu
-000162c0: 7465 6420 7265 6375 7273 696f 6e73 2064  ted recursions d
-000162d0: 7572 696e 6720 6c61 7a79 206d 6f75 6e74  uring lazy mount
-000162e0: 696e 672e 2222 220a 0a20 2020 2020 2020  ing."""..       
-000162f0: 206c 6566 7450 6172 7420 3d20 7061 7468   leftPart = path
-00016300: 0a20 2020 2020 2020 2072 6967 6874 5061  .        rightPa
-00016310: 7274 733a 204c 6973 745b 7374 725d 203d  rts: List[str] =
-00016320: 205b 5d0a 2020 2020 2020 2020 7768 696c   [].        whil
-00016330: 6520 272f 2720 696e 206c 6566 7450 6172  e '/' in leftPar
-00016340: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
-00016350: 6620 6c65 6674 5061 7274 2069 6e20 7365  f leftPart in se
-00016360: 6c66 2e6d 6f75 6e74 6564 3a0a 2020 2020  lf.mounted:.    
-00016370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00016380: 726e 206c 6566 7450 6172 742c 2027 2f27  rn leftPart, '/'
-00016390: 202b 2027 2f27 2e6a 6f69 6e28 7269 6768   + '/'.join(righ
-000163a0: 7450 6172 7473 290a 0a20 2020 2020 2020  tParts)..       
-000163b0: 2020 2020 2070 6172 7473 203d 206c 6566       parts = lef
-000163c0: 7450 6172 742e 7273 706c 6974 2827 2f27  tPart.rsplit('/'
-000163d0: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-000163e0: 206c 6566 7450 6172 7420 3d20 7061 7274   leftPart = part
-000163f0: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
-00016400: 2072 6967 6874 5061 7274 732e 696e 7365   rightParts.inse
-00016410: 7274 2830 2c20 7061 7274 735b 315d 290a  rt(0, parts[1]).
-00016420: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00016430: 272f 2720 696e 2073 656c 662e 6d6f 756e  '/' in self.moun
-00016440: 7465 640a 2020 2020 2020 2020 7265 7475  ted.        retu
-00016450: 726e 2027 2f27 2c20 7061 7468 0a0a 2020  rn '/', path..  
-00016460: 2020 6465 6620 5f74 7279 546f 4d6f 756e    def _tryToMoun
-00016470: 7446 696c 6528 7365 6c66 2c20 7061 7468  tFile(self, path
-00016480: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
-00016490: 616c 5b73 7472 5d3a 0a20 2020 2020 2020  al[str]:.       
-000164a0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-000164b0: 7572 6e73 2074 6865 206d 6f75 6e74 2070  urns the mount p
-000164c0: 6f69 6e74 2070 6174 6820 6966 2069 7420  oint path if it 
-000164d0: 6861 7320 6265 656e 2073 7563 6365 7373  has been success
-000164e0: 6675 6c6c 7920 6d6f 756e 7465 642e 0a20  fully mounted.. 
-000164f0: 2020 2020 2020 2070 6174 683a 2050 6174         path: Pat
-00016500: 6820 696e 7369 6465 2074 6869 7320 6d6f  h inside this mo
-00016510: 756e 7420 736f 7572 6365 2e20 4d61 7920  unt source. May 
-00016520: 696e 636c 7564 6520 7265 6375 7273 6976  include recursiv
-00016530: 656c 7920 6d6f 756e 7465 6420 6d6f 756e  ely mounted moun
-00016540: 7420 706f 696e 7473 2e0a 2020 2020 2020  t points..      
-00016550: 2020 2020 2020 2020 5368 6f75 6c64 2063          Should c
-00016560: 6f6e 7461 696e 2061 206c 6561 6469 6e67  ontain a leading
-00016570: 2073 6c61 7368 2e0a 2020 2020 2020 2020   slash..        
-00016580: 2222 220a 0a20 2020 2020 2020 2023 2046  """..        # F
-00016590: 6f72 2062 6574 7465 7220 7065 7266 6f72  or better perfor
-000165a0: 6d61 6e63 652c 206f 6e6c 7920 6c6f 6f6b  mance, only look
-000165b0: 2061 7420 7468 6520 7375 6666 6978 206e   at the suffix n
-000165c0: 6f74 2061 7420 7468 6520 6d61 6769 6320  ot at the magic 
-000165d0: 6279 7465 732e 0a20 2020 2020 2020 2073  bytes..        s
-000165e0: 7472 6970 7065 6446 696c 6550 6174 6820  trippedFilePath 
-000165f0: 3d20 7374 7269 7053 7566 6669 7846 726f  = stripSuffixFro
-00016600: 6d54 6172 4669 6c65 2870 6174 6829 0a20  mTarFile(path). 
-00016610: 2020 2020 2020 2069 6620 7374 7269 7070         if stripp
-00016620: 6564 4669 6c65 5061 7468 203d 3d20 7061  edFilePath == pa
-00016630: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-00016640: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-00016650: 2020 2020 206d 6f75 6e74 506f 696e 7420       mountPoint 
-00016660: 3d20 7374 7269 7070 6564 4669 6c65 5061  = strippedFilePa
-00016670: 7468 2069 6620 7365 6c66 2e6f 7074 696f  th if self.optio
-00016680: 6e73 2e67 6574 2827 7374 7269 7052 6563  ns.get('stripRec
-00016690: 7572 7369 7665 5461 7245 7874 656e 7369  ursiveTarExtensi
-000166a0: 6f6e 272c 2046 616c 7365 2920 656c 7365  on', False) else
-000166b0: 2070 6174 680a 2020 2020 2020 2020 6966   path.        if
-000166c0: 206d 6f75 6e74 506f 696e 7420 696e 2073   mountPoint in s
-000166d0: 656c 662e 6d6f 756e 7465 643a 0a20 2020  elf.mounted:.   
-000166e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000166f0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
-00016700: 5573 6520 5f73 696d 706c 7946 696e 644d  Use _simplyFindM
-00016710: 6f75 6e74 6564 2069 6e73 7465 6164 206f  ounted instead o
-00016720: 6620 5f66 696e 644d 6f75 6e74 6564 206f  f _findMounted o
-00016730: 7220 7365 6c66 2e6f 7065 6e20 746f 2061  r self.open to a
-00016740: 766f 6964 2072 6563 7572 7369 6f6e 7320  void recursions 
-00016750: 6361 7573 6564 2062 7920 6c61 7a79 206d  caused by lazy m
-00016760: 6f75 6e74 696e 6721 0a20 2020 2020 2020  ounting!.       
-00016770: 2070 6172 656e 744d 6f75 6e74 506f 696e   parentMountPoin
-00016780: 742c 2070 6174 6849 6e73 6964 6550 6172  t, pathInsidePar
-00016790: 656e 744d 6f75 6e74 506f 696e 7420 3d20  entMountPoint = 
-000167a0: 7365 6c66 2e5f 7369 6d70 6c79 4669 6e64  self._simplyFind
-000167b0: 4d6f 756e 7465 6428 7061 7468 290a 2020  Mounted(path).  
-000167c0: 2020 2020 2020 7061 7265 6e74 4d6f 756e        parentMoun
-000167d0: 7453 6f75 7263 6520 3d20 7365 6c66 2e6d  tSource = self.m
-000167e0: 6f75 6e74 6564 5b70 6172 656e 744d 6f75  ounted[parentMou
-000167f0: 6e74 506f 696e 745d 2e6d 6f75 6e74 536f  ntPoint].mountSo
-00016800: 7572 6365 0a0a 2020 2020 2020 2020 7472  urce..        tr
-00016810: 793a 0a20 2020 2020 2020 2020 2020 2061  y:.            a
-00016820: 7263 6869 7665 4669 6c65 496e 666f 203d  rchiveFileInfo =
-00016830: 2070 6172 656e 744d 6f75 6e74 536f 7572   parentMountSour
-00016840: 6365 2e67 6574 4669 6c65 496e 666f 2870  ce.getFileInfo(p
-00016850: 6174 6849 6e73 6964 6550 6172 656e 744d  athInsideParentM
-00016860: 6f75 6e74 506f 696e 7429 0a20 2020 2020  ountPoint).     
-00016870: 2020 2020 2020 2069 6620 6172 6368 6976         if archiv
-00016880: 6546 696c 6549 6e66 6f20 6973 204e 6f6e  eFileInfo is Non
-00016890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000168a0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
-000168b0: 2020 2020 2020 2020 2020 2020 5f2c 2064              _, d
-000168c0: 6565 7065 7374 4d6f 756e 7453 6f75 7263  eepestMountSourc
-000168d0: 652c 2064 6565 7065 7374 4669 6c65 496e  e, deepestFileIn
-000168e0: 666f 203d 2070 6172 656e 744d 6f75 6e74  fo = parentMount
-000168f0: 536f 7572 6365 2e67 6574 4d6f 756e 7453  Source.getMountS
-00016900: 6f75 7263 6528 6172 6368 6976 6546 696c  ource(archiveFil
-00016910: 6549 6e66 6f29 0a20 2020 2020 2020 2020  eInfo).         
-00016920: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00016930: 2864 6565 7065 7374 4d6f 756e 7453 6f75  (deepestMountSou
-00016940: 7263 652c 2046 6f6c 6465 724d 6f75 6e74  rce, FolderMount
-00016950: 536f 7572 6365 293a 0a20 2020 2020 2020  Source):.       
-00016960: 2020 2020 2020 2020 2023 204f 7065 6e20           # Open 
-00016970: 6672 6f6d 2066 696c 6520 7061 7468 206f  from file path o
-00016980: 6e20 686f 7374 2066 696c 6520 7379 7374  n host file syst
-00016990: 656d 2069 6e20 6f72 6465 7220 746f 2077  em in order to w
-000169a0: 7269 7465 206f 7574 2054 4152 2069 6e64  rite out TAR ind
-000169b0: 6578 2066 696c 6573 2e0a 2020 2020 2020  ex files..      
-000169c0: 2020 2020 2020 2020 2020 6d6f 756e 7453            mountS
-000169d0: 6f75 7263 6520 3d20 6f70 656e 4d6f 756e  ource = openMoun
-000169e0: 7453 6f75 7263 6528 6465 6570 6573 744d  tSource(deepestM
-000169f0: 6f75 6e74 536f 7572 6365 2e67 6574 4669  ountSource.getFi
-00016a00: 6c65 5061 7468 2864 6565 7065 7374 4669  lePath(deepestFi
-00016a10: 6c65 496e 666f 292c 202a 2a73 656c 662e  leInfo), **self.
-00016a20: 6f70 7469 6f6e 7329 0a20 2020 2020 2020  options).       
-00016a30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00016a40: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
-00016a50: 7320 7769 6c6c 2066 6169 6c20 7769 7468  s will fail with
-00016a60: 2053 7465 6e63 696c 6564 4669 6c65 206f   StenciledFile o
-00016a70: 626a 6563 7473 2061 7320 7265 7475 726e  bjects as return
-00016a80: 6564 2062 7920 5351 4c69 7465 496e 6465  ed by SQLiteInde
-00016a90: 7865 6454 6172 206d 6f75 6e74 2073 6f75  xedTar mount sou
-00016aa0: 7263 6573 2061 6e64 2077 6865 6e0a 2020  rces and when.  
-00016ab0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00016ac0: 6769 7665 6e20 746f 2062 6163 6b65 6e64  given to backend
-00016ad0: 7320 6c69 6b65 2069 6e64 6578 6564 5f78  s like indexed_x
-00016ae0: 7878 2c20 7768 6963 6820 646f 2065 7870  xx, which do exp
-00016af0: 6563 7420 7468 6520 6669 6c65 206f 626a  ect the file obj
-00016b00: 6563 7420 746f 2068 6176 6520 6120 7661  ect to have a va
-00016b10: 6c69 6420 6669 6c65 6e6f 2e0a 2020 2020  lid fileno..    
-00016b20: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
-00016b30: 7453 6f75 7263 6520 3d20 6f70 656e 4d6f  tSource = openMo
-00016b40: 756e 7453 6f75 7263 6528 7061 7265 6e74  untSource(parent
-00016b50: 4d6f 756e 7453 6f75 7263 652e 6f70 656e  MountSource.open
-00016b60: 2861 7263 6869 7665 4669 6c65 496e 666f  (archiveFileInfo
-00016b70: 292c 202a 2a73 656c 662e 6f70 7469 6f6e  ), **self.option
-00016b80: 7329 0a20 2020 2020 2020 2065 7863 6570  s).        excep
-00016b90: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00016ba0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00016bb0: 696e 7428 225b 5761 726e 696e 675d 204d  int("[Warning] M
-00016bc0: 6f75 6e74 696e 6720 6f66 2027 2220 2b20  ounting of '" + 
-00016bd0: 7061 7468 202b 2022 2720 6661 696c 6564  path + "' failed
-00016be0: 2062 6563 6175 7365 206f 663a 222c 2065   because of:", e
-00016bf0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00016c00: 2070 7269 6e74 4465 6275 6720 3e3d 2033   printDebug >= 3
-00016c10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016c20: 2020 7472 6163 6562 6163 6b2e 7072 696e    traceback.prin
-00016c30: 745f 6578 6328 290a 2020 2020 2020 2020  t_exc().        
-00016c40: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-00016c50: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00016c60: 6f6e 650a 0a20 2020 2020 2020 2072 6f6f  one..        roo
-00016c70: 7446 696c 6549 6e66 6f20 3d20 6172 6368  tFileInfo = arch
-00016c80: 6976 6546 696c 6549 6e66 6f2e 636c 6f6e  iveFileInfo.clon
-00016c90: 6528 290a 2020 2020 2020 2020 726f 6f74  e().        root
-00016ca0: 4669 6c65 496e 666f 2e6d 6f64 6520 3d20  FileInfo.mode = 
-00016cb0: 2872 6f6f 7446 696c 6549 6e66 6f2e 6d6f  (rootFileInfo.mo
-00016cc0: 6465 2026 2030 6f37 3737 2920 7c20 7374  de & 0o777) | st
-00016cd0: 6174 2e53 5f49 4644 4952 0a20 2020 2020  at.S_IFDIR.     
-00016ce0: 2020 2072 6f6f 7446 696c 6549 6e66 6f2e     rootFileInfo.
-00016cf0: 6c69 6e6b 6e61 6d65 203d 2022 220a 2020  linkname = "".  
-00016d00: 2020 2020 2020 726f 6f74 4669 6c65 496e        rootFileIn
-00016d10: 666f 2e75 7365 7264 6174 6120 3d20 5b6d  fo.userdata = [m
-00016d20: 6f75 6e74 506f 696e 745d 0a20 2020 2020  ountPoint].     
-00016d30: 2020 206d 6f75 6e74 496e 666f 203d 2041     mountInfo = A
-00016d40: 7574 6f4d 6f75 6e74 4c61 7965 722e 4d6f  utoMountLayer.Mo
-00016d50: 756e 7449 6e66 6f28 6d6f 756e 7453 6f75  untInfo(mountSou
-00016d60: 7263 652c 2072 6f6f 7446 696c 6549 6e66  rce, rootFileInf
-00016d70: 6f29 0a0a 2020 2020 2020 2020 2320 544f  o)..        # TO
-00016d80: 444f 2057 6861 7420 6966 2074 6865 206d  DO What if the m
-00016d90: 6f75 6e74 2070 6f69 6e74 2061 6c72 6561  ount point alrea
-00016da0: 6479 2065 7869 7374 732c 2065 2e67 2e2c  dy exists, e.g.,
-00016db0: 2062 6563 6175 7365 2073 7472 6970 5265   because stripRe
-00016dc0: 6375 7273 6976 6554 6172 4578 7465 6e73  cursiveTarExtens
-00016dd0: 696f 6e20 6973 2074 7275 6520 616e 6420  ion is true and 
-00016de0: 7468 6572 650a 2020 2020 2020 2020 2320  there.        # 
-00016df0: 2020 2020 2061 7265 206d 756c 7469 706c       are multipl
-00016e00: 6520 6172 6368 6976 6573 2077 6974 6820  e archives with 
-00016e10: 7468 6520 7361 6d65 206e 616d 6520 6275  the same name bu
-00016e20: 7420 6469 6666 6572 656e 7420 6578 7465  t different exte
-00016e30: 7369 6f6e 733f 0a20 2020 2020 2020 2073  sions?.        s
-00016e40: 656c 662e 6d6f 756e 7465 645b 6d6f 756e  elf.mounted[moun
-00016e50: 7450 6f69 6e74 5d20 3d20 6d6f 756e 7449  tPoint] = mountI
-00016e60: 6e66 6f0a 2020 2020 2020 2020 6966 2070  nfo.        if p
-00016e70: 7269 6e74 4465 6275 6720 3e3d 2032 3a0a  rintDebug >= 2:.
-00016e80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00016e90: 7428 2252 6563 7572 7369 7665 6c79 206d  t("Recursively m
-00016ea0: 6f75 6e74 6564 3a22 2c20 6d6f 756e 7450  ounted:", mountP
-00016eb0: 6f69 6e74 290a 2020 2020 2020 2020 2020  oint).          
-00016ec0: 2020 7072 696e 7428 290a 0a20 2020 2020    print()..     
-00016ed0: 2020 2072 6574 7572 6e20 6d6f 756e 7450     return mountP
-00016ee0: 6f69 6e74 0a0a 2020 2020 6465 6620 5f66  oint..    def _f
-00016ef0: 696e 644d 6f75 6e74 6564 2873 656c 662c  indMounted(self,
-00016f00: 2070 6174 683a 2073 7472 2920 2d3e 2054   path: str) -> T
-00016f10: 7570 6c65 5b73 7472 2c20 7374 725d 3a0a  uple[str, str]:.
-00016f20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016f30: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
-00016f40: 6d6f 756e 7420 706f 696e 742c 2077 6869  mount point, whi
-00016f50: 6368 2063 616e 2062 6520 666f 756e 6420  ch can be found 
-00016f60: 696e 2073 656c 662e 6d6f 756e 7465 642c  in self.mounted,
-00016f70: 2061 6e64 2074 6865 2072 6573 7420 6f66   and the rest of
-00016f80: 2074 6865 2070 6174 682e 0a20 2020 2020   the path..     
-00016f90: 2020 2042 6173 6963 616c 6c79 2c20 6974     Basically, it
-00016fa0: 2073 706c 6974 7320 7061 7468 2061 7420   splits path at 
-00016fb0: 7468 6520 6170 7072 6f70 7269 6174 6520  the appropriate 
-00016fc0: 6d6f 756e 7420 706f 696e 7420 626f 756e  mount point boun
-00016fd0: 6461 7279 2e0a 2020 2020 2020 2020 4265  dary..        Be
-00016fe0: 6361 7573 6520 6f66 2074 6865 2072 6563  cause of the rec
-00016ff0: 7572 7369 7665 206d 6f75 6e74 696e 672c  ursive mounting,
-00017000: 2074 6865 7265 206d 6967 6874 2062 6520   there might be 
-00017010: 6d75 6c74 6970 6c65 206d 6f75 6e74 2070  multiple mount p
-00017020: 6f69 6e74 7320 6669 7474 696e 6720 7468  oints fitting th
-00017030: 6520 7061 7468 2e0a 2020 2020 2020 2020  e path..        
-00017040: 5468 6520 6c6f 6e67 6573 742c 2069 2e65  The longest, i.e
-00017050: 2e2c 2074 6865 2064 6565 7065 7374 206d  ., the deepest m
-00017060: 6f75 6e74 2070 6f69 6e74 2077 696c 6c20  ount point will 
-00017070: 6265 2072 6574 7572 6e65 642e 0a20 2020  be returned..   
-00017080: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00017090: 2020 6966 2073 656c 662e 6f70 7469 6f6e    if self.option
-000170a0: 732e 6765 7428 2772 6563 7572 7369 7665  s.get('recursive
-000170b0: 272c 2046 616c 7365 2920 616e 6420 7365  ', False) and se
-000170c0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-000170d0: 6c61 7a79 4d6f 756e 7469 6e67 272c 2046  lazyMounting', F
-000170e0: 616c 7365 293a 0a20 2020 2020 2020 2020  alse):.         
-000170f0: 2020 2073 7562 5061 7468 203d 2022 2f22     subPath = "/"
-00017100: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-00017110: 6972 7374 2067 6f20 6672 6f6d 2068 6967  irst go from hig
-00017120: 6865 7220 7061 7468 7320 746f 2064 6565  her paths to dee
-00017130: 7065 7220 6f6e 6573 2061 6e64 2074 7279  per ones and try
-00017140: 2074 6f20 6d6f 756e 7420 616c 6c20 7061   to mount all pa
-00017150: 7265 6e74 2061 7263 6869 7665 7320 6c61  rent archives la
-00017160: 7a69 6c79 2e0a 2020 2020 2020 2020 2020  zily..          
-00017170: 2020 666f 7220 7061 7274 2069 6e20 7061    for part in pa
-00017180: 7468 2e6c 7374 7269 7028 6f73 2e70 6174  th.lstrip(os.pat
-00017190: 682e 7365 7029 2e73 706c 6974 286f 732e  h.sep).split(os.
-000171a0: 7061 7468 2e73 6570 293a 0a20 2020 2020  path.sep):.     
-000171b0: 2020 2020 2020 2020 2020 2073 7562 5061             subPa
-000171c0: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
-000171d0: 6e28 7375 6250 6174 682c 2070 6172 7429  n(subPath, part)
-000171e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000171f0: 2069 6620 7375 6250 6174 6820 6e6f 7420   if subPath not 
-00017200: 696e 2073 656c 662e 6d6f 756e 7465 643a  in self.mounted:
-00017210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017220: 2020 2020 2073 656c 662e 5f74 7279 546f       self._tryTo
-00017230: 4d6f 756e 7446 696c 6528 7375 6250 6174  MountFile(subPat
-00017240: 6829 0a0a 2020 2020 2020 2020 7265 7475  h)..        retu
-00017250: 726e 2073 656c 662e 5f73 696d 706c 7946  rn self._simplyF
-00017260: 696e 644d 6f75 6e74 6564 2870 6174 6829  indMounted(path)
-00017270: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
-00017280: 284d 6f75 6e74 536f 7572 6365 290a 2020  (MountSource).  
-00017290: 2020 6465 6620 6765 7446 696c 6549 6e66    def getFileInf
-000172a0: 6f28 7365 6c66 2c20 7061 7468 3a20 7374  o(self, path: st
-000172b0: 722c 2066 696c 6556 6572 7369 6f6e 3a20  r, fileVersion: 
-000172c0: 696e 7420 3d20 3029 202d 3e20 4f70 7469  int = 0) -> Opti
-000172d0: 6f6e 616c 5b46 696c 6549 6e66 6f5d 3a0a  onal[FileInfo]:.
-000172e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000172f0: 2020 2020 5265 7475 726e 2066 696c 6520      Return file 
-00017300: 696e 666f 2066 6f72 2067 6976 656e 2070  info for given p
-00017310: 6174 682e 204e 6f74 6520 7468 6174 2061  ath. Note that a
-00017320: 6c6c 2072 6574 7572 6e65 6420 6669 6c65  ll returned file
-00017330: 2069 6e66 6f73 2063 6f6e 7461 696e 204d   infos contain M
-00017340: 6f75 6e74 496e 666f 0a20 2020 2020 2020  ountInfo.       
-00017350: 206f 7220 6120 6669 6c65 2070 6174 6820   or a file path 
-00017360: 7374 7269 6e67 2061 7420 7468 6520 6261  string at the ba
-00017370: 636b 206f 6620 4669 6c65 496e 666f 2e75  ck of FileInfo.u
-00017380: 7365 7264 6174 612e 0a20 2020 2020 2020  serdata..       
-00017390: 2022 2222 0a20 2020 2020 2020 2023 2054   """.        # T
-000173a0: 4f44 4f3a 2041 6464 2073 7570 706f 7274  ODO: Add support
-000173b0: 2066 6f72 2074 6865 202e 7665 7273 696f   for the .versio
-000173c0: 6e73 2041 5049 2069 6e20 6f72 6465 7220  ns API in order 
-000173d0: 746f 2061 6363 6573 7320 7468 6520 756e  to access the un
-000173e0: 6465 726c 7969 6e67 2054 4152 7320 6966  derlying TARs if
-000173f0: 2073 7472 6970 5265 6375 7273 6976 6554   stripRecursiveT
-00017400: 6172 4578 7465 6e73 696f 6e0a 2020 2020  arExtension.    
-00017410: 2020 2020 2320 2020 2020 2020 6973 2066      #       is f
-00017420: 616c 7365 3f20 5468 656e 2061 6761 696e  alse? Then again
-00017430: 2c20 5351 4c69 7465 496e 6465 7865 6454  , SQLiteIndexedT
-00017440: 6172 2069 7320 6e6f 7420 6162 6c65 2074  ar is not able t
-00017450: 6f20 646f 2074 6869 7320 6569 7468 6572  o do this either
-00017460: 2c20 736f 2069 7420 6d69 6768 7420 6265  , so it might be
-00017470: 2069 6e63 6f6e 7369 7374 656e 742e 0a0a   inconsistent...
-00017480: 2020 2020 2020 2020 2320 4974 206d 6967          # It mig
-00017490: 6874 2062 6520 6172 6775 6162 6c79 2074  ht be arguably t
-000174a0: 6861 7420 7765 2063 6f75 6c64 2073 696d  hat we could sim
-000174b0: 706c 7920 6c65 7420 7468 6520 6d6f 756e  ply let the moun
-000174c0: 7420 736f 7572 6365 2068 616e 646c 6520  t source handle 
-000174d0: 7265 7475 726e 696e 6720 6669 6c65 2069  returning file i
-000174e0: 6e66 6f73 2066 6f72 2074 6865 2072 6f6f  nfos for the roo
-000174f0: 740a 2020 2020 2020 2020 2320 6469 7265  t.        # dire
-00017500: 6374 6f72 7920 6275 7420 6f6e 6c79 2077  ctory but only w
-00017510: 6520 6b6e 6f77 2074 6865 2070 6572 6d69  e know the permi
-00017520: 7373 696f 6e73 206f 6620 7468 6520 7061  ssions of the pa
-00017530: 7265 6e74 2066 6f6c 6465 7220 616e 6420  rent folder and 
-00017540: 6361 6e20 6170 706c 7920 7468 656d 2074  can apply them t
-00017550: 6f20 7468 6520 726f 6f74 2064 6972 6563  o the root direc
-00017560: 746f 7279 2e0a 2020 2020 2020 2020 6d6f  tory..        mo
-00017570: 756e 7450 6f69 6e74 2c20 7061 7468 496e  untPoint, pathIn
-00017580: 4d6f 756e 7450 6f69 6e74 203d 2073 656c  MountPoint = sel
-00017590: 662e 5f66 696e 644d 6f75 6e74 6564 2870  f._findMounted(p
-000175a0: 6174 6829 0a20 2020 2020 2020 206d 6f75  ath).        mou
-000175b0: 6e74 496e 666f 203d 2073 656c 662e 6d6f  ntInfo = self.mo
-000175c0: 756e 7465 645b 6d6f 756e 7450 6f69 6e74  unted[mountPoint
-000175d0: 5d0a 2020 2020 2020 2020 6966 2070 6174  ].        if pat
-000175e0: 6849 6e4d 6f75 6e74 506f 696e 7420 3d3d  hInMountPoint ==
-000175f0: 2027 2f27 3a0a 2020 2020 2020 2020 2020   '/':.          
-00017600: 2020 7265 7475 726e 206d 6f75 6e74 496e    return mountIn
-00017610: 666f 2e72 6f6f 7446 696c 6549 6e66 6f0a  fo.rootFileInfo.
-00017620: 0a20 2020 2020 2020 2066 696c 6549 6e66  .        fileInf
-00017630: 6f20 3d20 6d6f 756e 7449 6e66 6f2e 6d6f  o = mountInfo.mo
-00017640: 756e 7453 6f75 7263 652e 6765 7446 696c  untSource.getFil
-00017650: 6549 6e66 6f28 7061 7468 496e 4d6f 756e  eInfo(pathInMoun
-00017660: 7450 6f69 6e74 2c20 6669 6c65 5665 7273  tPoint, fileVers
-00017670: 696f 6e29 0a20 2020 2020 2020 2069 6620  ion).        if 
-00017680: 6669 6c65 496e 666f 3a0a 2020 2020 2020  fileInfo:.      
-00017690: 2020 2020 2020 6669 6c65 496e 666f 2e75        fileInfo.u
-000176a0: 7365 7264 6174 612e 6170 7065 6e64 286d  serdata.append(m
-000176b0: 6f75 6e74 506f 696e 7429 0a20 2020 2020  ountPoint).     
-000176c0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-000176d0: 6c65 496e 666f 0a0a 2020 2020 2020 2020  leInfo..        
-000176e0: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-000176f0: 2040 6f76 6572 7269 6465 7328 4d6f 756e   @overrides(Moun
-00017700: 7453 6f75 7263 6529 0a20 2020 2064 6566  tSource).    def
-00017710: 206c 6973 7444 6972 2873 656c 662c 2070   listDir(self, p
-00017720: 6174 683a 2073 7472 2920 2d3e 204f 7074  ath: str) -> Opt
-00017730: 696f 6e61 6c5b 4974 6572 6162 6c65 5b73  ional[Iterable[s
-00017740: 7472 5d5d 3a0a 2020 2020 2020 2020 6d6f  tr]]:.        mo
-00017750: 756e 7450 6f69 6e74 2c20 7061 7468 496e  untPoint, pathIn
-00017760: 4d6f 756e 7450 6f69 6e74 203d 2073 656c  MountPoint = sel
-00017770: 662e 5f66 696e 644d 6f75 6e74 6564 2870  f._findMounted(p
-00017780: 6174 6829 0a20 2020 2020 2020 2066 696c  ath).        fil
-00017790: 6573 203d 2073 656c 662e 6d6f 756e 7465  es = self.mounte
-000177a0: 645b 6d6f 756e 7450 6f69 6e74 5d2e 6d6f  d[mountPoint].mo
-000177b0: 756e 7453 6f75 7263 652e 6c69 7374 4469  untSource.listDi
-000177c0: 7228 7061 7468 496e 4d6f 756e 7450 6f69  r(pathInMountPoi
-000177d0: 6e74 290a 2020 2020 2020 2020 6966 206e  nt).        if n
-000177e0: 6f74 2066 696c 6573 3a0a 2020 2020 2020  ot files:.      
-000177f0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00017800: 650a 2020 2020 2020 2020 6669 6c65 7320  e.        files 
-00017810: 3d20 7365 7428 6669 6c65 7329 0a0a 2020  = set(files)..  
-00017820: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
-00017830: 6574 6865 7220 7765 206e 6565 6420 746f  ether we need to
-00017840: 2061 6464 2072 6563 7572 7369 7665 206d   add recursive m
-00017850: 6f75 6e74 2070 6f69 6e74 7320 746f 2074  ount points to t
-00017860: 6869 7320 6469 7265 6374 6f72 7920 6c69  his directory li
-00017870: 7374 696e 670a 2020 2020 2020 2020 6966  sting.        if
-00017880: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00017890: 7428 2772 6563 7572 7369 7665 272c 2046  t('recursive', F
-000178a0: 616c 7365 2920 616e 6420 7365 6c66 2e6f  alse) and self.o
-000178b0: 7074 696f 6e73 2e67 6574 2827 7374 7269  ptions.get('stri
-000178c0: 7052 6563 7572 7369 7665 5461 7245 7874  pRecursiveTarExt
-000178d0: 656e 7369 6f6e 272c 2046 616c 7365 293a  ension', False):
-000178e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000178f0: 206d 6f75 6e74 506f 696e 7420 696e 2073   mountPoint in s
-00017900: 656c 662e 6d6f 756e 7465 643a 0a20 2020  elf.mounted:.   
-00017910: 2020 2020 2020 2020 2020 2020 2066 6f6c               fol
-00017920: 6465 722c 2066 6f6c 6465 724e 616d 6520  der, folderName 
-00017930: 3d20 6f73 2e70 6174 682e 7370 6c69 7428  = os.path.split(
-00017940: 6d6f 756e 7450 6f69 6e74 290a 2020 2020  mountPoint).    
-00017950: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00017960: 6f6c 6465 7220 3d3d 2070 6174 6820 616e  older == path an
-00017970: 6420 666f 6c64 6572 4e61 6d65 2061 6e64  d folderName and
-00017980: 2066 6f6c 6465 724e 616d 6520 6e6f 7420   folderName not 
-00017990: 696e 2066 696c 6573 3a0a 2020 2020 2020  in files:.      
-000179a0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000179b0: 6c65 732e 6164 6428 666f 6c64 6572 4e61  les.add(folderNa
-000179c0: 6d65 290a 0a20 2020 2020 2020 2072 6574  me)..        ret
-000179d0: 7572 6e20 6669 6c65 730a 0a20 2020 2040  urn files..    @
-000179e0: 6f76 6572 7269 6465 7328 4d6f 756e 7453  overrides(MountS
-000179f0: 6f75 7263 6529 0a20 2020 2064 6566 2066  ource).    def f
-00017a00: 696c 6556 6572 7369 6f6e 7328 7365 6c66  ileVersions(self
-00017a10: 2c20 7061 7468 3a20 7374 7229 202d 3e20  , path: str) -> 
-00017a20: 696e 743a 0a20 2020 2020 2020 206d 6f75  int:.        mou
-00017a30: 6e74 506f 696e 742c 2070 6174 6849 6e4d  ntPoint, pathInM
-00017a40: 6f75 6e74 506f 696e 7420 3d20 7365 6c66  ountPoint = self
-00017a50: 2e5f 6669 6e64 4d6f 756e 7465 6428 7061  ._findMounted(pa
-00017a60: 7468 290a 2020 2020 2020 2020 7265 7475  th).        retu
-00017a70: 726e 2073 656c 662e 6d6f 756e 7465 645b  rn self.mounted[
-00017a80: 6d6f 756e 7450 6f69 6e74 5d2e 6d6f 756e  mountPoint].moun
-00017a90: 7453 6f75 7263 652e 6669 6c65 5665 7273  tSource.fileVers
-00017aa0: 696f 6e73 2870 6174 6849 6e4d 6f75 6e74  ions(pathInMount
-00017ab0: 506f 696e 7429 0a0a 2020 2020 406f 7665  Point)..    @ove
-00017ac0: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
-00017ad0: 6365 290a 2020 2020 6465 6620 6f70 656e  ce).    def open
-00017ae0: 2873 656c 662c 2066 696c 6549 6e66 6f3a  (self, fileInfo:
-00017af0: 2046 696c 6549 6e66 6f29 202d 3e20 494f   FileInfo) -> IO
-00017b00: 5b62 7974 6573 5d3a 0a20 2020 2020 2020  [bytes]:.       
-00017b10: 205f 2c20 6d6f 756e 7453 6f75 7263 652c   _, mountSource,
-00017b20: 2073 6f75 7263 6546 696c 6549 6e66 6f20   sourceFileInfo 
-00017b30: 3d20 7365 6c66 2e67 6574 4d6f 756e 7453  = self.getMountS
-00017b40: 6f75 7263 6528 6669 6c65 496e 666f 290a  ource(fileInfo).
-00017b50: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00017b60: 6f75 6e74 536f 7572 6365 2e6f 7065 6e28  ountSource.open(
-00017b70: 736f 7572 6365 4669 6c65 496e 666f 290a  sourceFileInfo).
-00017b80: 0a20 2020 2040 6f76 6572 7269 6465 7328  .    @overrides(
-00017b90: 4d6f 756e 7453 6f75 7263 6529 0a20 2020  MountSource).   
-00017ba0: 2064 6566 2072 6561 6428 7365 6c66 2c20   def read(self, 
-00017bb0: 6669 6c65 496e 666f 3a20 4669 6c65 496e  fileInfo: FileIn
-00017bc0: 666f 2c20 7369 7a65 3a20 696e 742c 206f  fo, size: int, o
-00017bd0: 6666 7365 743a 2069 6e74 2920 2d3e 2062  ffset: int) -> b
-00017be0: 7974 6573 3a0a 2020 2020 2020 2020 5f2c  ytes:.        _,
-00017bf0: 206d 6f75 6e74 536f 7572 6365 2c20 736f   mountSource, so
-00017c00: 7572 6365 4669 6c65 496e 666f 203d 2073  urceFileInfo = s
-00017c10: 656c 662e 6765 744d 6f75 6e74 536f 7572  elf.getMountSour
-00017c20: 6365 2866 696c 6549 6e66 6f29 0a20 2020  ce(fileInfo).   
-00017c30: 2020 2020 2072 6574 7572 6e20 6d6f 756e       return moun
-00017c40: 7453 6f75 7263 652e 7265 6164 2873 6f75  tSource.read(sou
-00017c50: 7263 6546 696c 6549 6e66 6f2c 2073 697a  rceFileInfo, siz
-00017c60: 652c 206f 6666 7365 7429 0a0a 2020 2020  e, offset)..    
-00017c70: 406f 7665 7272 6964 6573 284d 6f75 6e74  @overrides(Mount
-00017c80: 536f 7572 6365 290a 2020 2020 6465 6620  Source).    def 
-00017c90: 6765 744d 6f75 6e74 536f 7572 6365 2873  getMountSource(s
-00017ca0: 656c 662c 2066 696c 6549 6e66 6f3a 2046  elf, fileInfo: F
-00017cb0: 696c 6549 6e66 6f29 202d 3e20 5475 706c  ileInfo) -> Tupl
-00017cc0: 655b 7374 722c 204d 6f75 6e74 536f 7572  e[str, MountSour
-00017cd0: 6365 2c20 4669 6c65 496e 666f 5d3a 0a20  ce, FileInfo]:. 
-00017ce0: 2020 2020 2020 206d 6f75 6e74 506f 696e         mountPoin
-00017cf0: 7420 3d20 6669 6c65 496e 666f 2e75 7365  t = fileInfo.use
-00017d00: 7264 6174 615b 2d31 5d0a 2020 2020 2020  rdata[-1].      
-00017d10: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-00017d20: 6e63 6528 6d6f 756e 7450 6f69 6e74 2c20  nce(mountPoint, 
-00017d30: 7374 7229 0a20 2020 2020 2020 206d 6f75  str).        mou
-00017d40: 6e74 536f 7572 6365 203d 2073 656c 662e  ntSource = self.
-00017d50: 6d6f 756e 7465 645b 6d6f 756e 7450 6f69  mounted[mountPoi
-00017d60: 6e74 5d2e 6d6f 756e 7453 6f75 7263 650a  nt].mountSource.
-00017d70: 0a20 2020 2020 2020 2073 6f75 7263 6546  .        sourceF
-00017d80: 696c 6549 6e66 6f20 3d20 6669 6c65 496e  ileInfo = fileIn
-00017d90: 666f 2e63 6c6f 6e65 2829 0a20 2020 2020  fo.clone().     
-00017da0: 2020 2073 6f75 7263 6546 696c 6549 6e66     sourceFileInf
-00017db0: 6f2e 7573 6572 6461 7461 2e70 6f70 2829  o.userdata.pop()
-00017dc0: 0a0a 2020 2020 2020 2020 6465 6570 6572  ..        deeper
-00017dd0: 4d6f 756e 7450 6f69 6e74 2c20 6465 6570  MountPoint, deep
-00017de0: 6572 4d6f 756e 7453 6f75 7263 652c 2064  erMountSource, d
-00017df0: 6565 7065 7246 696c 6549 6e66 6f20 3d20  eeperFileInfo = 
-00017e00: 6d6f 756e 7453 6f75 7263 652e 6765 744d  mountSource.getM
-00017e10: 6f75 6e74 536f 7572 6365 2873 6f75 7263  ountSource(sourc
-00017e20: 6546 696c 6549 6e66 6f29 0a20 2020 2020  eFileInfo).     
-00017e30: 2020 2072 6574 7572 6e20 6f73 2e70 6174     return os.pat
-00017e40: 682e 6a6f 696e 286d 6f75 6e74 506f 696e  h.join(mountPoin
-00017e50: 742c 2064 6565 7065 724d 6f75 6e74 506f  t, deeperMountPo
-00017e60: 696e 742e 6c73 7472 6970 2827 2f27 2929  int.lstrip('/'))
-00017e70: 2c20 6465 6570 6572 4d6f 756e 7453 6f75  , deeperMountSou
-00017e80: 7263 652c 2064 6565 7065 7246 696c 6549  rce, deeperFileI
-00017e90: 6e66 6f0a 0a0a 636c 6173 7320 5a69 704d  nfo...class ZipM
-00017ea0: 6f75 6e74 536f 7572 6365 284d 6f75 6e74  ountSource(Mount
-00017eb0: 536f 7572 6365 293a 0a20 2020 2064 6566  Source):.    def
-00017ec0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00017ed0: 6669 6c65 4f72 5061 7468 3a20 556e 696f  fileOrPath: Unio
-00017ee0: 6e5b 7374 722c 2049 4f5b 6279 7465 735d  n[str, IO[bytes]
-00017ef0: 5d2c 202a 2a6f 7074 696f 6e73 2920 2d3e  ], **options) ->
-00017f00: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-00017f10: 656c 662e 6669 6c65 4f62 6a65 6374 203d  elf.fileObject =
-00017f20: 207a 6970 6669 6c65 2e5a 6970 4669 6c65   zipfile.ZipFile
-00017f30: 2866 696c 654f 7250 6174 682c 2027 7227  (fileOrPath, 'r'
-00017f40: 290a 2020 2020 2020 2020 5a69 704d 6f75  ).        ZipMou
-00017f50: 6e74 536f 7572 6365 2e5f 6669 6e64 5061  ntSource._findPa
-00017f60: 7373 776f 7264 2873 656c 662e 6669 6c65  ssword(self.file
-00017f70: 4f62 6a65 6374 2c20 6f70 7469 6f6e 732e  Object, options.
-00017f80: 6765 7428 2270 6173 7377 6f72 6473 222c  get("passwords",
-00017f90: 205b 5d29 290a 2020 2020 2020 2020 7365   [])).        se
-00017fa0: 6c66 2e66 696c 6573 203d 2073 656c 662e  lf.files = self.
-00017fb0: 6669 6c65 4f62 6a65 6374 2e69 6e66 6f6c  fileObject.infol
-00017fc0: 6973 7428 290a 2020 2020 2020 2020 7365  ist().        se
-00017fd0: 6c66 2e6f 7074 696f 6e73 203d 206f 7074  lf.options = opt
-00017fe0: 696f 6e73 0a0a 2020 2020 4073 7461 7469  ions..    @stati
-00017ff0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00018000: 5f66 696e 6450 6173 7377 6f72 6428 6669  _findPassword(fi
-00018010: 6c65 6f62 6a3a 2022 7a69 7066 696c 652e  leobj: "zipfile.
-00018020: 5a69 7046 696c 6522 2c20 7061 7373 776f  ZipFile", passwo
-00018030: 7264 7329 3a0a 2020 2020 2020 2020 2320  rds):.        # 
-00018040: 4966 2068 6561 6465 7273 2061 7265 2065  If headers are e
-00018050: 6e63 7279 7074 6564 2c20 7468 656e 2069  ncrypted, then i
-00018060: 6e66 6f6c 6973 7420 7769 6c6c 2073 696d  nfolist will sim
-00018070: 706c 7920 7265 7475 726e 2061 6e20 656d  ply return an em
-00018080: 7074 7920 6c69 7374 210a 2020 2020 2020  pty list!.      
-00018090: 2020 6669 6c65 7320 3d20 6669 6c65 6f62    files = fileob
-000180a0: 6a2e 696e 666f 6c69 7374 2829 0a20 2020  j.infolist().   
-000180b0: 2020 2020 2069 6620 6e6f 7420 6669 6c65       if not file
-000180c0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-000180d0: 6f72 2070 6173 7377 6f72 6420 696e 2070  or password in p
-000180e0: 6173 7377 6f72 6473 3a0a 2020 2020 2020  asswords:.      
-000180f0: 2020 2020 2020 2020 2020 6669 6c65 6f62            fileob
-00018100: 6a2e 7365 7470 6173 7377 6f72 6428 7061  j.setpassword(pa
-00018110: 7373 776f 7264 290a 2020 2020 2020 2020  ssword).        
-00018120: 2020 2020 2020 2020 6669 6c65 7320 3d20          files = 
-00018130: 6669 6c65 6f62 6a2e 696e 666f 6c69 7374  fileobj.infolist
-00018140: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00018150: 2020 2069 6620 6669 6c65 733a 0a20 2020     if files:.   
-00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018170: 2072 6574 7572 6e20 7061 7373 776f 7264   return password
-00018180: 0a0a 2020 2020 2020 2020 2320 4966 2068  ..        # If h
-00018190: 6561 6465 7273 2061 7265 206e 6f74 2065  eaders are not e
-000181a0: 6e63 7279 7074 6564 2c20 7468 656e 2074  ncrypted, then t
-000181b0: 7279 206f 7574 2070 6173 7377 6f72 6473  ry out passwords
-000181c0: 2062 7920 7472 7969 6e67 2074 6f20 6f70   by trying to op
-000181d0: 656e 2074 6865 2066 6972 7374 2066 696c  en the first fil
-000181e0: 652e 0a20 2020 2020 2020 2066 696c 6573  e..        files
-000181f0: 203d 205b 6669 6c65 2066 6f72 2066 696c   = [file for fil
-00018200: 6520 696e 2066 696c 6573 2069 6620 6e6f  e in files if no
-00018210: 7420 6669 6c65 2e69 735f 6469 7228 2920  t file.is_dir() 
-00018220: 616e 6420 6669 6c65 2e66 696c 655f 7369  and file.file_si
-00018230: 7a65 203e 2030 5d0a 2020 2020 2020 2020  ze > 0].        
-00018240: 6966 206e 6f74 2066 696c 6573 3a0a 2020  if not files:.  
-00018250: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00018260: 204e 6f6e 650a 0a20 2020 2020 2020 2066   None..        f
-00018270: 6f72 2070 6173 7377 6f72 6420 696e 205b  or password in [
-00018280: 4e6f 6e65 5d20 2b20 7061 7373 776f 7264  None] + password
-00018290: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-000182a0: 696c 656f 626a 2e73 6574 7061 7373 776f  ileobj.setpasswo
-000182b0: 7264 2870 6173 7377 6f72 6429 0a20 2020  rd(password).   
-000182c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-000182d0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-000182e0: 7468 2066 696c 656f 626a 2e6f 7065 6e28  th fileobj.open(
-000182f0: 6669 6c65 735b 305d 2920 6173 2066 696c  files[0]) as fil
-00018300: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018310: 2020 2020 2020 2066 696c 652e 7265 6164         file.read
-00018320: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00018330: 2020 2020 7265 7475 726e 2070 6173 7377      return passw
-00018340: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
-00018350: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00018360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018370: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
-00018380: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-00018390: 6f72 2822 436f 756c 6420 6e6f 7420 6669  or("Could not fi
-000183a0: 6e64 2061 206d 6174 6368 696e 6720 7061  nd a matching pa
-000183b0: 7373 776f 7264 2122 290a 0a20 2020 2064  ssword!")..    d
-000183c0: 6566 205f 5f65 6e74 6572 5f5f 2873 656c  ef __enter__(sel
-000183d0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-000183e0: 726e 2073 656c 660a 0a20 2020 2064 6566  rn self..    def
-000183f0: 205f 5f65 7869 745f 5f28 7365 6c66 2c20   __exit__(self, 
-00018400: 6578 6365 7074 696f 6e5f 7479 7065 2c20  exception_type, 
-00018410: 6578 6365 7074 696f 6e5f 7661 6c75 652c  exception_value,
-00018420: 2065 7863 6570 7469 6f6e 5f74 7261 6365   exception_trace
-00018430: 6261 636b 293a 0a20 2020 2020 2020 2073  back):.        s
-00018440: 656c 662e 6669 6c65 4f62 6a65 6374 2e63  elf.fileObject.c
-00018450: 6c6f 7365 2829 0a0a 2020 2020 4073 7461  lose()..    @sta
-00018460: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-00018470: 6620 5f63 6f6e 7665 7274 546f 4669 6c65  f _convertToFile
-00018480: 496e 666f 2869 6e66 6f3a 2022 7a69 7066  Info(info: "zipf
-00018490: 696c 652e 5a69 7049 6e66 6f22 2c20 7a69  ile.ZipInfo", zi
-000184a0: 7046 696c 653a 2022 7a69 7066 696c 652e  pFile: "zipfile.
-000184b0: 5a69 7046 696c 6522 2920 2d3e 2046 696c  ZipFile") -> Fil
-000184c0: 6549 6e66 6f3a 0a20 2020 2020 2020 206d  eInfo:.        m
-000184d0: 6f64 6520 3d20 306f 3535 3520 7c20 2873  ode = 0o555 | (s
-000184e0: 7461 742e 535f 4946 4449 5220 6966 2069  tat.S_IFDIR if i
-000184f0: 6e66 6f2e 6973 5f64 6972 2829 2065 6c73  nfo.is_dir() els
-00018500: 6520 7374 6174 2e53 5f49 4652 4547 290a  e stat.S_IFREG).
-00018510: 2020 2020 2020 2020 6d74 696d 6520 3d20          mtime = 
-00018520: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-00018530: 6528 2a69 6e66 6f2e 6461 7465 5f74 696d  e(*info.date_tim
-00018540: 652c 2074 7a69 6e66 6f3d 6461 7465 7469  e, tzinfo=dateti
-00018550: 6d65 2e74 696d 657a 6f6e 652e 7574 6329  me.timezone.utc)
-00018560: 2e74 696d 6573 7461 6d70 2829 2069 6620  .timestamp() if 
-00018570: 696e 666f 2e64 6174 655f 7469 6d65 2065  info.date_time e
-00018580: 6c73 6520 300a 0a20 2020 2020 2020 2023  lse 0..        #
-00018590: 2041 6363 6f72 6469 6e67 2074 6f20 7365   According to se
-000185a0: 6374 696f 6e20 342e 352e 3720 696e 2074  ction 4.5.7 in t
-000185b0: 6865 202e 5a49 5020 6669 6c65 2066 6f72  he .ZIP file for
-000185c0: 6d61 7420 7370 6563 6966 6963 6174 696f  mat specificatio
-000185d0: 6e2c 206c 696e 6b73 2061 7265 2073 7570  n, links are sup
-000185e0: 706f 7274 6564 3a0a 2020 2020 2020 2020  ported:.        
-000185f0: 2320 6874 7470 733a 2f2f 706b 7761 7265  # https://pkware
-00018600: 2e63 6163 6865 666c 792e 6e65 742f 7765  .cachefly.net/we
-00018610: 6264 6f63 732f 6361 7365 7374 7564 6965  bdocs/casestudie
-00018620: 732f 4150 504e 4f54 452e 5458 540a 2020  s/APPNOTE.TXT.  
-00018630: 2020 2020 2020 2320 5468 6520 5079 7468        # The Pyth
-00018640: 6f6e 207a 6970 6669 6c65 206d 6f64 756c  on zipfile modul
-00018650: 6520 6861 7320 6e6f 2041 5049 2066 6f72  e has no API for
-00018660: 206c 696e 6b73 3a20 6874 7470 733a 2f2f   links: https://
-00018670: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
-00018680: 6973 7375 6534 3532 3836 0a20 2020 2020  issue45286.     
-00018690: 2020 2023 2048 6f77 6576 6572 2c20 7468     # However, th
-000186a0: 6520 6669 6c65 206d 6f64 6520 6578 706f  e file mode expo
-000186b0: 7365 7320 7768 6574 6865 7220 6974 2773  ses whether it's
-000186c0: 2061 206c 696e 6b20 616e 6420 7468 6520   a link and the 
-000186d0: 6669 6c65 206d 6f64 6520 6973 2073 686f  file mode is sho
-000186e0: 776e 2062 7920 5a69 7049 6e66 6f2e 5f5f  wn by ZipInfo.__
-000186f0: 7265 7072 5f5f 2e0a 2020 2020 2020 2020  repr__..        
-00018700: 2320 466f 7220 7468 6174 2c20 6974 2075  # For that, it u
-00018710: 7365 7320 7468 6520 4f53 2d64 6570 656e  ses the OS-depen
-00018720: 6465 6e74 2065 7874 6572 6e61 6c5f 6174  dent external_at
-00018730: 7472 206d 656d 6265 722e 2053 6565 2061  tr member. See a
-00018740: 6c73 6f20 7468 6520 5a49 5020 7370 6563  lso the ZIP spec
-00018750: 6966 6963 6174 696f 6e20 6f6e 2074 6861  ification on tha
-00018760: 743a 0a20 2020 2020 2020 2023 203e 2034  t:.        # > 4
-00018770: 2e34 2e31 3520 6578 7465 726e 616c 2066  .4.15 external f
-00018780: 696c 6520 6174 7472 6962 7574 6573 3a20  ile attributes: 
-00018790: 2834 2062 7974 6573 290a 2020 2020 2020  (4 bytes).      
-000187a0: 2020 2320 3e20 2020 5468 6520 6d61 7070    # >   The mapp
-000187b0: 696e 6720 6f66 2074 6865 2065 7874 6572  ing of the exter
-000187c0: 6e61 6c20 6174 7472 6962 7574 6573 2069  nal attributes i
-000187d0: 7320 686f 7374 2d73 7973 7465 6d20 6465  s host-system de
-000187e0: 7065 6e64 656e 7420 2873 6565 2027 7665  pendent (see 've
-000187f0: 7273 696f 6e20 6d61 6465 2062 7927 292e  rsion made by').
-00018800: 0a20 2020 2020 2020 2023 203e 2020 2046  .        # >   F
-00018810: 6f72 204d 532d 444f 532c 2074 6865 206c  or MS-DOS, the l
-00018820: 6f77 206f 7264 6572 2062 7974 6520 6973  ow order byte is
-00018830: 2074 6865 204d 532d 444f 5320 6469 7265   the MS-DOS dire
-00018840: 6374 6f72 7920 6174 7472 6962 7574 6520  ctory attribute 
-00018850: 6279 7465 2e0a 2020 2020 2020 2020 2320  byte..        # 
-00018860: 3e20 2020 4966 2069 6e70 7574 2063 616d  >   If input cam
-00018870: 6520 6672 6f6d 2073 7461 6e64 6172 6420  e from standard 
-00018880: 696e 7075 742c 2074 6869 7320 6669 656c  input, this fiel
-00018890: 6420 6973 2073 6574 2074 6f20 7a65 726f  d is set to zero
-000188a0: 2e0a 0a20 2020 2020 2020 2023 2066 696c  ...        # fil
-000188b0: 655f 7265 6469 7220 6973 2028 7479 7065  e_redir is (type
-000188c0: 2c20 666c 6167 732c 2074 6172 6765 7429  , flags, target)
-000188d0: 206f 7220 4e6f 6e65 2e20 4f6e 6c79 2074   or None. Only t
-000188e0: 6573 7465 6420 666f 7220 7479 7065 203d  ested for type =
-000188f0: 3d20 5241 5235 5f58 5245 4449 525f 554e  = RAR5_XREDIR_UN
-00018900: 4958 5f53 594d 4c49 4e4b 2e0a 2020 2020  IX_SYMLINK..    
-00018910: 2020 2020 6c69 6e6b 6e61 6d65 203d 2022      linkname = "
-00018920: 220a 2020 2020 2020 2020 6966 2073 7461  ".        if sta
-00018930: 742e 535f 4953 4c4e 4b28 696e 666f 2e65  t.S_ISLNK(info.e
-00018940: 7874 6572 6e61 6c5f 6174 7472 203e 3e20  xternal_attr >> 
-00018950: 3136 293a 0a20 2020 2020 2020 2020 2020  16):.           
-00018960: 206c 696e 6b6e 616d 6520 3d20 7a69 7046   linkname = zipF
-00018970: 696c 652e 7265 6164 2869 6e66 6f29 2e64  ile.read(info).d
-00018980: 6563 6f64 6528 290a 2020 2020 2020 2020  ecode().        
-00018990: 2020 2020 6d6f 6465 203d 2030 6f35 3535      mode = 0o555
-000189a0: 207c 2073 7461 742e 535f 4946 4c4e 4b0a   | stat.S_IFLNK.
-000189b0: 0a20 2020 2020 2020 2066 696c 6549 6e66  .        fileInf
-000189c0: 6f20 3d20 4669 6c65 496e 666f 280a 2020  o = FileInfo(.  
-000189d0: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
-000189e0: 206f 6666 0a20 2020 2020 2020 2020 2020   off.           
-000189f0: 2073 697a 6520 2020 2020 3d20 696e 666f   size     = info
-00018a00: 2e66 696c 655f 7369 7a65 2c0a 2020 2020  .file_size,.    
-00018a10: 2020 2020 2020 2020 6d74 696d 6520 2020          mtime   
-00018a20: 203d 206d 7469 6d65 2c0a 2020 2020 2020   = mtime,.      
-00018a30: 2020 2020 2020 6d6f 6465 2020 2020 203d        mode     =
-00018a40: 206d 6f64 652c 0a20 2020 2020 2020 2020   mode,.         
-00018a50: 2020 206c 696e 6b6e 616d 6520 3d20 6c69     linkname = li
-00018a60: 6e6b 6e61 6d65 2c0a 2020 2020 2020 2020  nkname,.        
-00018a70: 2020 2020 7569 6420 2020 2020 203d 206f      uid      = o
-00018a80: 732e 6765 7475 6964 2829 2c0a 2020 2020  s.getuid(),.    
-00018a90: 2020 2020 2020 2020 6769 6420 2020 2020          gid     
-00018aa0: 203d 206f 732e 6765 7467 6964 2829 2c0a   = os.getgid(),.
-00018ab0: 2020 2020 2020 2020 2020 2020 7573 6572              user
-00018ac0: 6461 7461 203d 205b 696e 666f 5d2c 0a20  data = [info],. 
-00018ad0: 2020 2020 2020 2020 2020 2023 2066 6d74             # fmt
-00018ae0: 3a20 6f6e 0a20 2020 2020 2020 2029 0a0a  : on.        )..
-00018af0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00018b00: 696c 6549 6e66 6f0a 0a20 2020 2040 6f76  ileInfo..    @ov
-00018b10: 6572 7269 6465 7328 4d6f 756e 7453 6f75  errides(MountSou
-00018b20: 7263 6529 0a20 2020 2064 6566 206c 6973  rce).    def lis
-00018b30: 7444 6972 2873 656c 662c 2070 6174 683a  tDir(self, path:
-00018b40: 2073 7472 2920 2d3e 204f 7074 696f 6e61   str) -> Optiona
-00018b50: 6c5b 4974 6572 6162 6c65 5b73 7472 5d5d  l[Iterable[str]]
-00018b60: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
-00018b70: 2070 6174 682e 7374 7269 7028 272f 2729   path.strip('/')
-00018b80: 0a20 2020 2020 2020 2069 6620 7061 7468  .        if path
-00018b90: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00018ba0: 7468 202b 3d20 272f 270a 0a20 2020 2020  th += '/'..     
-00018bb0: 2020 2023 2054 4f44 4f20 486f 7720 746f     # TODO How to
-00018bc0: 2062 6568 6176 6520 7769 7468 2066 696c   behave with fil
-00018bd0: 6573 2069 6e20 7a69 7020 7769 7468 2061  es in zip with a
-00018be0: 6273 6f6c 7574 6520 7061 7468 733f 2043  bsolute paths? C
-00018bf0: 7572 7265 6e74 6c79 2c20 7468 6579 2077  urrently, they w
-00018c00: 6f75 6c64 206e 6576 6572 2062 6520 7368  ould never be sh
-00018c10: 6f77 6e2e 0a20 2020 2020 2020 2064 6566  own..        def
-00018c20: 2067 6574 4e61 6d65 2866 696c 6550 6174   getName(filePat
-00018c30: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00018c40: 6966 206e 6f74 2066 696c 6550 6174 682e  if not filePath.
-00018c50: 7374 6172 7473 7769 7468 2870 6174 6829  startswith(path)
-00018c60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018c70: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00018c80: 2020 2020 2020 2020 2020 2066 696c 6550             fileP
-00018c90: 6174 6820 3d20 6669 6c65 5061 7468 5b6c  ath = filePath[l
-00018ca0: 656e 2870 6174 6829 203a 5d2e 7374 7269  en(path) :].stri
-00018cb0: 7028 272f 2729 0a20 2020 2020 2020 2020  p('/').         
-00018cc0: 2020 2069 6620 6e6f 7420 6669 6c65 5061     if not filePa
-00018cd0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-00018ce0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00018cf0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00018d00: 6869 7320 6566 6665 6374 6976 656c 7920  his effectively 
-00018d10: 6164 6473 2061 6c6c 2070 6172 656e 7420  adds all parent 
-00018d20: 7061 7468 7320 6173 2066 6f6c 6465 7273  paths as folders
-00018d30: 2e20 4974 2069 7320 6561 7379 2074 6f20  . It is easy to 
-00018d40: 6372 6561 7465 0a20 2020 2020 2020 2020  create.         
-00018d50: 2020 2023 2052 4152 7320 616e 6420 5a49     # RARs and ZI
-00018d60: 5073 2077 6974 6820 6e65 7374 6564 2066  Ps with nested f
-00018d70: 696c 6573 2077 6974 686f 7574 2069 6e66  iles without inf
-00018d80: 6f72 6d61 7469 6f6e 206f 6e20 7468 6520  ormation on the 
-00018d90: 7061 7265 6e74 2064 6972 6563 746f 7269  parent directori
-00018da0: 6573 210a 2020 2020 2020 2020 2020 2020  es!.            
-00018db0: 6966 2027 2f27 2069 6e20 6669 6c65 5061  if '/' in filePa
-00018dc0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-00018dd0: 2020 2020 6669 7273 7453 6c61 7368 203d      firstSlash =
-00018de0: 2066 696c 6550 6174 682e 696e 6465 7828   filePath.index(
-00018df0: 272f 2729 0a20 2020 2020 2020 2020 2020  '/').           
-00018e00: 2020 2020 2066 696c 6550 6174 6820 3d20       filePath = 
-00018e10: 6669 6c65 5061 7468 5b3a 6669 7273 7453  filePath[:firstS
-00018e20: 6c61 7368 5d0a 0a20 2020 2020 2020 2020  lash]..         
-00018e30: 2020 2072 6574 7572 6e20 6669 6c65 5061     return filePa
-00018e40: 7468 0a0a 2020 2020 2020 2020 2320 5a69  th..        # Zi
-00018e50: 7049 6e66 6f2e 6669 6c65 6e61 6d65 2069  pInfo.filename i
-00018e60: 7320 7772 6f6e 676c 7920 6e61 6d65 6420  s wrongly named 
-00018e70: 6173 2069 7420 7265 7475 726e 7320 7468  as it returns th
-00018e80: 6520 6675 6c6c 2070 6174 6820 696e 7369  e full path insi
-00018e90: 6465 2074 6865 2061 7263 6869 7665 206e  de the archive n
-00018ea0: 6f74 206a 7573 7420 7468 6520 6e61 6d65  ot just the name
-00018eb0: 2070 6172 740a 2020 2020 2020 2020 7265   part.        re
-00018ec0: 7475 726e 2073 6574 2867 6574 4e61 6d65  turn set(getName
-00018ed0: 2869 6e66 6f2e 6669 6c65 6e61 6d65 2920  (info.filename) 
-00018ee0: 666f 7220 696e 666f 2069 6e20 7365 6c66  for info in self
-00018ef0: 2e66 696c 6573 2069 6620 6765 744e 616d  .files if getNam
-00018f00: 6528 696e 666f 2e66 696c 656e 616d 6529  e(info.filename)
-00018f10: 290a 0a20 2020 2064 6566 205f 6765 7446  )..    def _getF
-00018f20: 696c 6549 6e66 6f73 2873 656c 662c 2070  ileInfos(self, p
-00018f30: 6174 683a 2073 7472 2920 2d3e 204c 6973  ath: str) -> Lis
-00018f40: 745b 4669 6c65 496e 666f 5d3a 0a20 2020  t[FileInfo]:.   
-00018f50: 2020 2020 2069 6e66 6f4c 6973 7420 3d20       infoList = 
-00018f60: 5b0a 2020 2020 2020 2020 2020 2020 5a69  [.            Zi
-00018f70: 704d 6f75 6e74 536f 7572 6365 2e5f 636f  pMountSource._co
-00018f80: 6e76 6572 7454 6f46 696c 6549 6e66 6f28  nvertToFileInfo(
-00018f90: 696e 666f 2c20 7365 6c66 2e66 696c 654f  info, self.fileO
-00018fa0: 626a 6563 7429 0a20 2020 2020 2020 2020  bject).         
-00018fb0: 2020 2066 6f72 2069 6e66 6f20 696e 2073     for info in s
-00018fc0: 656c 662e 6669 6c65 730a 2020 2020 2020  elf.files.      
-00018fd0: 2020 2020 2020 6966 2069 6e66 6f2e 6669        if info.fi
-00018fe0: 6c65 6e61 6d65 2e72 7374 7269 7028 272f  lename.rstrip('/
-00018ff0: 2729 203d 3d20 7061 7468 2e6c 7374 7269  ') == path.lstri
-00019000: 7028 272f 2729 0a20 2020 2020 2020 205d  p('/').        ]
-00019010: 0a0a 2020 2020 2020 2020 2320 4966 2077  ..        # If w
-00019020: 6520 6861 7665 2061 2066 696c 6549 6e66  e have a fileInf
-00019030: 6f20 666f 7220 7468 6520 6769 7665 6e20  o for the given 
-00019040: 6469 7265 6374 6f72 7920 7061 7468 2c20  directory path, 
-00019050: 7468 656e 2065 7665 7279 7468 696e 6720  then everything 
-00019060: 6973 2066 696e 652e 0a20 2020 2020 2020  is fine..       
-00019070: 2070 6174 6841 7344 6972 203d 2070 6174   pathAsDir = pat
-00019080: 682e 7374 7269 7028 272f 2729 202b 2027  h.strip('/') + '
-00019090: 2f27 0a0a 2020 2020 2020 2020 2320 4368  /'..        # Ch
-000190a0: 6563 6b20 7768 6574 6865 7220 736f 6d65  eck whether some
-000190b0: 2070 6172 656e 7420 6469 7265 6374 6f72   parent director
-000190c0: 6965 7320 6f66 2066 696c 6573 2064 6f20  ies of files do 
-000190d0: 6e6f 7420 6578 6973 7420 6173 2073 6570  not exist as sep
-000190e0: 6172 6174 6520 656e 7469 7469 6573 2069  arate entities i
-000190f0: 6e20 7468 6520 6172 6368 6976 652e 0a20  n the archive.. 
-00019100: 2020 2020 2020 2069 6620 6e6f 7420 616e         if not an
-00019110: 7928 5b69 6e66 6f2e 7573 6572 6461 7461  y([info.userdata
-00019120: 5b2d 315d 2e66 696c 656e 616d 6520 3d3d  [-1].filename ==
-00019130: 2070 6174 6841 7344 6972 2066 6f72 2069   pathAsDir for i
-00019140: 6e66 6f20 696e 2069 6e66 6f4c 6973 745d  nfo in infoList]
-00019150: 2920 616e 6420 616e 7928 0a20 2020 2020  ) and any(.     
-00019160: 2020 2020 2020 2069 6e66 6f2e 6669 6c65         info.file
-00019170: 6e61 6d65 2e72 7374 7269 7028 272f 2729  name.rstrip('/')
-00019180: 2e73 7461 7274 7377 6974 6828 7061 7468  .startswith(path
-00019190: 4173 4469 7229 2066 6f72 2069 6e66 6f20  AsDir) for info 
-000191a0: 696e 2073 656c 662e 6669 6c65 730a 2020  in self.files.  
-000191b0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-000191c0: 2020 2020 2069 6e66 6f4c 6973 742e 6170       infoList.ap
-000191d0: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-000191e0: 2020 2020 2020 4669 6c65 496e 666f 280a        FileInfo(.
-000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019200: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2073 697a 6520 2020 2020 3d20 302c     size     = 0,
-00019230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019240: 2020 2020 206d 7469 6d65 2020 2020 3d20       mtime    = 
-00019250: 696e 7428 7469 6d65 2e74 696d 6528 2929  int(time.time())
-00019260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019270: 2020 2020 2020 6d6f 6465 2020 2020 203d        mode     =
-00019280: 2030 6f37 3737 207c 2073 7461 742e 535f   0o777 | stat.S_
-00019290: 4946 4449 522c 0a20 2020 2020 2020 2020  IFDIR,.         
-000192a0: 2020 2020 2020 2020 2020 206c 696e 6b6e             linkn
-000192b0: 616d 6520 3d20 2222 2c0a 2020 2020 2020  ame = "",.      
-000192c0: 2020 2020 2020 2020 2020 2020 2020 7569                ui
-000192d0: 6420 2020 2020 203d 206f 732e 6765 7475  d      = os.getu
-000192e0: 6964 2829 2c0a 2020 2020 2020 2020 2020  id(),.          
-000192f0: 2020 2020 2020 2020 2020 6769 6420 2020            gid   
-00019300: 2020 203d 206f 732e 6765 7467 6964 2829     = os.getgid()
-00019310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019320: 2020 2020 2020 7573 6572 6461 7461 203d        userdata =
-00019330: 205b 4e6f 6e65 5d2c 0a20 2020 2020 2020   [None],.       
-00019340: 2020 2020 2020 2020 2020 2020 2023 2066               # f
-00019350: 6d74 3a20 6f6e 0a20 2020 2020 2020 2020  mt: on.         
-00019360: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00019370: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00019380: 7265 7475 726e 2069 6e66 6f4c 6973 740a  return infoList.
-00019390: 0a20 2020 2040 6f76 6572 7269 6465 7328  .    @overrides(
-000193a0: 4d6f 756e 7453 6f75 7263 6529 0a20 2020  MountSource).   
-000193b0: 2064 6566 2067 6574 4669 6c65 496e 666f   def getFileInfo
-000193c0: 2873 656c 662c 2070 6174 683a 2073 7472  (self, path: str
-000193d0: 2c20 6669 6c65 5665 7273 696f 6e3a 2069  , fileVersion: i
-000193e0: 6e74 203d 2030 2920 2d3e 204f 7074 696f  nt = 0) -> Optio
-000193f0: 6e61 6c5b 4669 6c65 496e 666f 5d3a 0a20  nal[FileInfo]:. 
-00019400: 2020 2020 2020 2069 6e66 6f73 203d 2073         infos = s
-00019410: 656c 662e 5f67 6574 4669 6c65 496e 666f  elf._getFileInfo
-00019420: 7328 7061 7468 290a 2020 2020 2020 2020  s(path).        
-00019430: 7265 7475 726e 2069 6e66 6f73 5b66 696c  return infos[fil
-00019440: 6556 6572 7369 6f6e 5d20 6966 202d 6c65  eVersion] if -le
-00019450: 6e28 696e 666f 7329 203c 3d20 6669 6c65  n(infos) <= file
-00019460: 5665 7273 696f 6e20 3c20 6c65 6e28 696e  Version < len(in
-00019470: 666f 7329 2065 6c73 6520 4e6f 6e65 0a0a  fos) else None..
-00019480: 2020 2020 406f 7665 7272 6964 6573 284d      @overrides(M
-00019490: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
-000194a0: 6465 6620 6669 6c65 5665 7273 696f 6e73  def fileVersions
-000194b0: 2873 656c 662c 2070 6174 683a 2073 7472  (self, path: str
-000194c0: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-000194d0: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
-000194e0: 662e 5f67 6574 4669 6c65 496e 666f 7328  f._getFileInfos(
-000194f0: 7061 7468 2929 0a0a 2020 2020 406f 7665  path))..    @ove
-00019500: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
-00019510: 6365 290a 2020 2020 6465 6620 6f70 656e  ce).    def open
-00019520: 2873 656c 662c 2066 696c 6549 6e66 6f3a  (self, fileInfo:
-00019530: 2046 696c 6549 6e66 6f29 202d 3e20 494f   FileInfo) -> IO
-00019540: 5b62 7974 6573 5d3a 0a20 2020 2020 2020  [bytes]:.       
-00019550: 2069 6e66 6f20 3d20 6669 6c65 496e 666f   info = fileInfo
-00019560: 2e75 7365 7264 6174 615b 2d31 5d0a 2020  .userdata[-1].  
-00019570: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-00019580: 6e73 7461 6e63 6528 696e 666f 2c20 7a69  nstance(info, zi
-00019590: 7066 696c 652e 5a69 7049 6e66 6f29 0a20  pfile.ZipInfo). 
-000195a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000195b0: 6c66 2e66 696c 654f 626a 6563 742e 6f70  lf.fileObject.op
-000195c0: 656e 2869 6e66 6f2c 2027 7227 2920 2023  en(info, 'r')  #
-000195d0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-000195e0: 636f 6d2f 7061 756c 646d 6363 6172 7468  com/pauldmccarth
-000195f0: 792f 696e 6465 7865 645f 677a 6970 2f69  y/indexed_gzip/i
-00019600: 7373 7565 732f 3835 0a0a 2020 2020 406f  ssues/85..    @o
-00019610: 7665 7272 6964 6573 284d 6f75 6e74 536f  verrides(MountSo
-00019620: 7572 6365 290a 2020 2020 6465 6620 7265  urce).    def re
-00019630: 6164 2873 656c 662c 2066 696c 6549 6e66  ad(self, fileInf
-00019640: 6f3a 2046 696c 6549 6e66 6f2c 2073 697a  o: FileInfo, siz
-00019650: 653a 2069 6e74 2c20 6f66 6673 6574 3a20  e: int, offset: 
-00019660: 696e 7429 202d 3e20 6279 7465 733a 0a20  int) -> bytes:. 
-00019670: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00019680: 2e6f 7065 6e28 6669 6c65 496e 666f 2920  .open(fileInfo) 
-00019690: 6173 2066 696c 653a 0a20 2020 2020 2020  as file:.       
-000196a0: 2020 2020 2066 696c 652e 7365 656b 286f       file.seek(o
-000196b0: 6666 7365 742c 206f 732e 5345 454b 5f53  ffset, os.SEEK_S
-000196c0: 4554 290a 2020 2020 2020 2020 2020 2020  ET).            
-000196d0: 7265 7475 726e 2066 696c 652e 7265 6164  return file.read
-000196e0: 2873 697a 6529 0a0a 0a63 6c61 7373 2052  (size)...class R
-000196f0: 6177 4669 6c65 496e 7369 6465 5261 7228  awFileInsideRar(
-00019700: 696f 2e52 6177 494f 4261 7365 293a 0a20  io.RawIOBase):. 
-00019710: 2020 2022 2222 0a20 2020 2054 6869 7320     """.    This 
-00019720: 636c 6173 7320 776f 726b 7320 6172 6f75  class works arou
-00019730: 6e64 2074 6865 2043 5243 2065 7272 6f72  nd the CRC error
-00019740: 2069 7373 7565 2062 7920 7265 6f70 656e   issue by reopen
-00019750: 696e 6720 7468 6520 6669 6c65 2077 6865  ing the file whe
-00019760: 6e20 7365 656b 696e 6720 6261 636b 2e0a  n seeking back..
-00019770: 2020 2020 5468 6973 2077 696c 6c20 6265      This will be
-00019780: 2073 6c6f 7765 7220 666f 7220 756e 636f   slower for unco
-00019790: 6d70 7265 7373 6564 2066 696c 6573 2062  mpressed files b
-000197a0: 7574 206e 6f74 2066 6f72 2063 6f6d 7072  ut not for compr
-000197b0: 6573 7365 6420 6669 6c65 7320 6265 6361  essed files beca
-000197c0: 7573 650a 2020 2020 7468 6520 7365 656b  use.    the seek
-000197d0: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
-000197e0: 6f66 2072 6172 6669 6c65 2061 6c73 6f20  of rarfile also 
-000197f0: 7265 6f70 656e 7320 7468 6520 6669 6c65  reopens the file
-00019800: 206f 6e20 7365 656b 696e 6720 6261 636b   on seeking back
-00019810: 2e0a 2020 2020 6874 7470 733a 2f2f 6769  ..    https://gi
-00019820: 7468 7562 2e63 6f6d 2f6d 6172 6b6f 6b72  thub.com/markokr
-00019830: 2f72 6172 6669 6c65 2f69 7373 7565 732f  /rarfile/issues/
-00019840: 3733 0a20 2020 2068 7474 7073 3a2f 2f72  73.    https://r
-00019850: 6172 6669 6c65 2e72 6561 6474 6865 646f  arfile.readthedo
-00019860: 6373 2e69 6f2f 6170 692e 6874 6d6c 2372  cs.io/api.html#r
-00019870: 6172 6669 6c65 2e52 6172 4578 7446 696c  arfile.RarExtFil
-00019880: 652e 7365 656b 0a20 2020 203e 204f 6e20  e.seek.    > On 
-00019890: 756e 636f 6d70 7265 7373 6564 2066 696c  uncompressed fil
-000198a0: 6573 2c20 7468 6520 7365 656b 696e 6720  es, the seeking 
-000198b0: 776f 726b 7320 6279 2061 6374 7561 6c20  works by actual 
-000198c0: 7365 656b 7320 736f 2069 74e2 8099 7320  seeks so it...s 
-000198d0: 6661 7374 2e0a 2020 2020 3e20 4f6e 2063  fast..    > On c
-000198e0: 6f6d 7072 6573 7365 6420 6669 6c65 7320  ompressed files 
-000198f0: 6974 2773 2073 6c6f 7720 2d20 666f 7277  it's slow - forw
-00019900: 6172 6420 7365 656b 696e 6720 6861 7070  ard seeking happ
-00019910: 656e 7320 6279 2072 6561 6469 6e67 2061  ens by reading a
-00019920: 6865 6164 2c0a 2020 2020 3e20 6261 636b  head,.    > back
-00019930: 7761 7264 7320 6279 2072 652d 6f70 656e  wards by re-open
-00019940: 696e 6720 616e 6420 6465 636f 6d70 7265  ing and decompre
-00019950: 7373 696e 6720 6672 6f6d 2074 6865 2073  ssing from the s
-00019960: 7461 7274 2e0a 2020 2020 2222 220a 0a20  tart..    """.. 
-00019970: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00019980: 7365 6c66 2c20 7265 6f70 656e 2c20 6669  self, reopen, fi
-00019990: 6c65 5f73 697a 6529 3a0a 2020 2020 2020  le_size):.      
-000199a0: 2020 7365 6c66 2e72 656f 7065 6e20 3d20    self.reopen = 
-000199b0: 7265 6f70 656e 0a20 2020 2020 2020 2073  reopen.        s
-000199c0: 656c 662e 6669 6c65 6f62 6a20 3d20 7265  elf.fileobj = re
-000199d0: 6f70 656e 2829 0a20 2020 2020 2020 2073  open().        s
-000199e0: 656c 662e 6669 6c65 5f73 697a 6520 3d20  elf.file_size = 
-000199f0: 6669 6c65 5f73 697a 650a 0a20 2020 2064  file_size..    d
-00019a00: 6566 205f 5f65 6e74 6572 5f5f 2873 656c  ef __enter__(sel
-00019a10: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00019a20: 726e 2073 656c 660a 0a20 2020 2064 6566  rn self..    def
-00019a30: 205f 5f65 7869 745f 5f28 7365 6c66 2c20   __exit__(self, 
-00019a40: 6578 6365 7074 696f 6e5f 7479 7065 2c20  exception_type, 
-00019a50: 6578 6365 7074 696f 6e5f 7661 6c75 652c  exception_value,
-00019a60: 2065 7863 6570 7469 6f6e 5f74 7261 6365   exception_trace
-00019a70: 6261 636b 293a 0a20 2020 2020 2020 2073  back):.        s
-00019a80: 656c 662e 636c 6f73 6528 290a 0a20 2020  elf.close()..   
-00019a90: 2040 6f76 6572 7269 6465 7328 696f 2e52   @overrides(io.R
-00019aa0: 6177 494f 4261 7365 290a 2020 2020 6465  awIOBase).    de
-00019ab0: 6620 636c 6f73 6528 7365 6c66 2920 2d3e  f close(self) ->
-00019ac0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-00019ad0: 656c 662e 6669 6c65 6f62 6a2e 636c 6f73  elf.fileobj.clos
-00019ae0: 6528 290a 0a20 2020 2040 6f76 6572 7269  e()..    @overri
-00019af0: 6465 7328 696f 2e52 6177 494f 4261 7365  des(io.RawIOBase
-00019b00: 290a 2020 2020 6465 6620 6669 6c65 6e6f  ).    def fileno
-00019b10: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
-00019b20: 2020 2020 2020 2023 2054 6869 7320 6973         # This is
-00019b30: 2061 2076 6972 7475 616c 2050 7974 686f   a virtual Pytho
-00019b40: 6e20 6c65 7665 6c20 6669 6c65 206f 626a  n level file obj
-00019b50: 6563 7420 616e 6420 7468 6572 6566 6f72  ect and therefor
-00019b60: 6520 646f 6573 206e 6f74 2068 6176 6520  e does not have 
-00019b70: 6120 7661 6c69 6420 4f53 2066 696c 6520  a valid OS file 
-00019b80: 6465 7363 7269 7074 6f72 210a 2020 2020  descriptor!.    
-00019b90: 2020 2020 7261 6973 6520 696f 2e55 6e73      raise io.Uns
-00019ba0: 7570 706f 7274 6564 4f70 6572 6174 696f  upportedOperatio
-00019bb0: 6e28 290a 0a20 2020 2040 6f76 6572 7269  n()..    @overri
-00019bc0: 6465 7328 696f 2e52 6177 494f 4261 7365  des(io.RawIOBase
-00019bd0: 290a 2020 2020 6465 6620 7365 656b 6162  ).    def seekab
-00019be0: 6c65 2873 656c 6629 202d 3e20 626f 6f6c  le(self) -> bool
-00019bf0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00019c00: 2073 656c 662e 6669 6c65 6f62 6a2e 7365   self.fileobj.se
-00019c10: 656b 6162 6c65 2829 0a0a 2020 2020 406f  ekable()..    @o
-00019c20: 7665 7272 6964 6573 2869 6f2e 5261 7749  verrides(io.RawI
-00019c30: 4f42 6173 6529 0a20 2020 2064 6566 2072  OBase).    def r
-00019c40: 6561 6461 626c 6528 7365 6c66 2920 2d3e  eadable(self) ->
-00019c50: 2062 6f6f 6c3a 0a20 2020 2020 2020 2072   bool:.        r
-00019c60: 6574 7572 6e20 7365 6c66 2e66 696c 656f  eturn self.fileo
-00019c70: 626a 2e72 6561 6461 626c 6528 290a 0a20  bj.readable().. 
-00019c80: 2020 2040 6f76 6572 7269 6465 7328 696f     @overrides(io
-00019c90: 2e52 6177 494f 4261 7365 290a 2020 2020  .RawIOBase).    
-00019ca0: 6465 6620 7772 6974 6162 6c65 2873 656c  def writable(sel
-00019cb0: 6629 202d 3e20 626f 6f6c 3a0a 2020 2020  f) -> bool:.    
-00019cc0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00019cd0: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
-00019ce0: 2869 6f2e 5261 7749 4f42 6173 6529 0a20  (io.RawIOBase). 
-00019cf0: 2020 2064 6566 2072 6561 6428 7365 6c66     def read(self
-00019d00: 2c20 7369 7a65 3a20 696e 7420 3d20 2d31  , size: int = -1
-00019d10: 2920 2d3e 2062 7974 6573 3a0a 2020 2020  ) -> bytes:.    
-00019d20: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00019d30: 6669 6c65 6f62 6a2e 7265 6164 2873 697a  fileobj.read(siz
-00019d40: 6529 0a0a 2020 2020 406f 7665 7272 6964  e)..    @overrid
-00019d50: 6573 2869 6f2e 5261 7749 4f42 6173 6529  es(io.RawIOBase)
-00019d60: 0a20 2020 2064 6566 2073 6565 6b28 7365  .    def seek(se
-00019d70: 6c66 2c20 6f66 6673 6574 3a20 696e 742c  lf, offset: int,
-00019d80: 2077 6865 6e63 653a 2069 6e74 203d 2069   whence: int = i
-00019d90: 6f2e 5345 454b 5f53 4554 2920 2d3e 2069  o.SEEK_SET) -> i
-00019da0: 6e74 3a0a 2020 2020 2020 2020 6966 2077  nt:.        if w
-00019db0: 6865 6e63 6520 3d3d 2069 6f2e 5345 454b  hence == io.SEEK
-00019dc0: 5f43 5552 3a0a 2020 2020 2020 2020 2020  _CUR:.          
-00019dd0: 2020 6f66 6673 6574 202b 3d20 7365 6c66    offset += self
-00019de0: 2e74 656c 6c28 290a 2020 2020 2020 2020  .tell().        
-00019df0: 656c 6966 2077 6865 6e63 6520 3d3d 2069  elif whence == i
-00019e00: 6f2e 5345 454b 5f45 4e44 3a0a 2020 2020  o.SEEK_END:.    
-00019e10: 2020 2020 2020 2020 6f66 6673 6574 202b          offset +
-00019e20: 3d20 7365 6c66 2e66 696c 655f 7369 7a65  = self.file_size
-00019e30: 0a0a 2020 2020 2020 2020 6966 206f 6666  ..        if off
-00019e40: 7365 7420 3e3d 2073 656c 662e 7465 6c6c  set >= self.tell
-00019e50: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00019e60: 7265 7475 726e 2073 656c 662e 6669 6c65  return self.file
-00019e70: 6f62 6a2e 7365 656b 286f 6666 7365 742c  obj.seek(offset,
-00019e80: 2077 6865 6e63 6529 0a0a 2020 2020 2020   whence)..      
-00019e90: 2020 7365 6c66 2e66 696c 656f 626a 203d    self.fileobj =
-00019ea0: 2073 656c 662e 7265 6f70 656e 2829 0a20   self.reopen(). 
-00019eb0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00019ec0: 6c66 2e66 696c 656f 626a 2e73 6565 6b28  lf.fileobj.seek(
-00019ed0: 6f66 6673 6574 2c20 696f 2e53 4545 4b5f  offset, io.SEEK_
-00019ee0: 5345 5429 0a0a 2020 2020 406f 7665 7272  SET)..    @overr
-00019ef0: 6964 6573 2869 6f2e 5261 7749 4f42 6173  ides(io.RawIOBas
-00019f00: 6529 0a20 2020 2064 6566 2074 656c 6c28  e).    def tell(
-00019f10: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-00019f20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00019f30: 662e 6669 6c65 6f62 6a2e 7465 6c6c 2829  f.fileobj.tell()
-00019f40: 0a0a 0a63 6c61 7373 2052 6172 4d6f 756e  ...class RarMoun
-00019f50: 7453 6f75 7263 6528 4d6f 756e 7453 6f75  tSource(MountSou
-00019f60: 7263 6529 3a0a 2020 2020 2320 4261 7369  rce):.    # Basi
-00019f70: 6361 6c6c 7920 636f 7079 2070 6173 7465  cally copy paste
-00019f80: 206f 6620 5a69 704d 6f75 6e74 536f 7572   of ZipMountSour
-00019f90: 6365 2062 6563 6175 7365 2074 6865 2069  ce because the i
-00019fa0: 6e74 6572 6661 6365 7320 6172 6520 7665  nterfaces are ve
-00019fb0: 7279 2073 696d 696c 6172 0a20 2020 2023  ry similar.    #
-00019fc0: 2049 276d 2068 6f6e 6573 746c 7920 6e6f   I'm honestly no
-00019fd0: 7420 7375 7265 2068 6f77 2069 7420 776f  t sure how it wo
-00019fe0: 726b 7320 7468 6174 2077 656c 6c20 6173  rks that well as
-00019ff0: 2069 7420 646f 6573 2e20 4974 2064 6f65   it does. It doe
-0001a000: 7320 6861 7665 2073 6f6d 6520 7072 6f62  s have some prob
-0001a010: 6c65 6d73 0a20 2020 2023 2077 6865 6e20  lems.    # when 
-0001a020: 7472 7969 6e67 2074 6f20 6d6f 756e 7420  trying to mount 
-0001a030: 2e74 6172 2e62 7a32 206f 7220 2e74 6172  .tar.bz2 or .tar
-0001a040: 2e78 7a20 696e 7369 6465 2072 6172 2066  .xz inside rar f
-0001a050: 696c 6573 2072 6563 7572 7369 7665 6c79  iles recursively
-0001a060: 2062 7574 2069 7420 776f 726b 730a 2020   but it works.  
-0001a070: 2020 2320 7265 6173 6f6e 6162 6c79 2077    # reasonably w
-0001a080: 656c 6c20 666f 7220 2e74 6172 2e67 7a20  ell for .tar.gz 
-0001a090: 616e 6420 2e7a 6970 2063 6f6e 7369 6465  and .zip conside
-0001a0a0: 7269 6e67 2074 6861 7420 7365 656b 696e  ring that seekin
-0001a0b0: 6720 7365 656d 7320 746f 2062 6520 6272  g seems to be br
-0001a0c0: 6f6b 656e 3a0a 2020 2020 2320 6874 7470  oken:.    # http
-0001a0d0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f6d  s://github.com/m
-0001a0e0: 6172 6b6f 6b72 2f72 6172 6669 6c65 2f69  arkokr/rarfile/i
-0001a0f0: 7373 7565 732f 3733 0a0a 2020 2020 6465  ssues/73..    de
-0001a100: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001a110: 2066 696c 654f 7250 6174 683a 2055 6e69   fileOrPath: Uni
-0001a120: 6f6e 5b73 7472 2c20 494f 5b62 7974 6573  on[str, IO[bytes
-0001a130: 5d5d 2c20 2a2a 6f70 7469 6f6e 7329 202d  ]], **options) -
-0001a140: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0001a150: 7365 6c66 2e66 696c 654f 626a 6563 7420  self.fileObject 
-0001a160: 3d20 7261 7266 696c 652e 5261 7246 696c  = rarfile.RarFil
-0001a170: 6528 6669 6c65 4f72 5061 7468 2c20 2772  e(fileOrPath, 'r
-0001a180: 2729 0a20 2020 2020 2020 2052 6172 4d6f  ').        RarMo
-0001a190: 756e 7453 6f75 7263 652e 5f66 696e 6450  untSource._findP
-0001a1a0: 6173 7377 6f72 6428 7365 6c66 2e66 696c  assword(self.fil
-0001a1b0: 654f 626a 6563 742c 206f 7074 696f 6e73  eObject, options
-0001a1c0: 2e67 6574 2822 7061 7373 776f 7264 7322  .get("passwords"
-0001a1d0: 2c20 5b5d 2929 0a20 2020 2020 2020 2073  , [])).        s
-0001a1e0: 656c 662e 6669 6c65 7320 3d20 7365 6c66  elf.files = self
-0001a1f0: 2e66 696c 654f 626a 6563 742e 696e 666f  .fileObject.info
-0001a200: 6c69 7374 2829 0a20 2020 2020 2020 2073  list().        s
-0001a210: 656c 662e 6f70 7469 6f6e 7320 3d20 6f70  elf.options = op
-0001a220: 7469 6f6e 730a 0a20 2020 2040 7374 6174  tions..    @stat
-0001a230: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-0001a240: 205f 6669 6e64 5061 7373 776f 7264 2866   _findPassword(f
-0001a250: 696c 656f 626a 3a20 2272 6172 6669 6c65  ileobj: "rarfile
-0001a260: 2e52 6172 4669 6c65 222c 2070 6173 7377  .RarFile", passw
-0001a270: 6f72 6473 293a 0a20 2020 2020 2020 2069  ords):.        i
-0001a280: 6620 6e6f 7420 6669 6c65 6f62 6a2e 6e65  f not fileobj.ne
-0001a290: 6564 735f 7061 7373 776f 7264 2829 3a0a  eds_password():.
-0001a2a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001a2b0: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
-0001a2c0: 2023 2049 6620 6865 6164 6572 7320 6172   # If headers ar
-0001a2d0: 6520 656e 6372 7970 7465 642c 2074 6865  e encrypted, the
-0001a2e0: 6e20 696e 666f 6c69 7374 2077 696c 6c20  n infolist will 
-0001a2f0: 7369 6d70 6c79 2072 6574 7572 6e20 616e  simply return an
-0001a300: 2065 6d70 7479 206c 6973 7421 0a20 2020   empty list!.   
-0001a310: 2020 2020 2066 696c 6573 203d 2066 696c       files = fil
-0001a320: 656f 626a 2e69 6e66 6f6c 6973 7428 290a  eobj.infolist().
-0001a330: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
-0001a340: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-0001a350: 2020 666f 7220 7061 7373 776f 7264 2069    for password i
-0001a360: 6e20 7061 7373 776f 7264 733a 0a20 2020  n passwords:.   
-0001a370: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0001a380: 656f 626a 2e73 6574 7061 7373 776f 7264  eobj.setpassword
-0001a390: 2870 6173 7377 6f72 6429 0a20 2020 2020  (password).     
-0001a3a0: 2020 2020 2020 2020 2020 2066 696c 6573             files
-0001a3b0: 203d 2066 696c 656f 626a 2e69 6e66 6f6c   = fileobj.infol
-0001a3c0: 6973 7428 290a 2020 2020 2020 2020 2020  ist().          
-0001a3d0: 2020 2020 2020 6966 2066 696c 6573 3a0a        if files:.
-0001a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3f0: 2020 2020 7265 7475 726e 2070 6173 7377      return passw
-0001a400: 6f72 640a 0a20 2020 2020 2020 2023 2049  ord..        # I
-0001a410: 6620 6865 6164 6572 7320 6172 6520 6e6f  f headers are no
-0001a420: 7420 656e 6372 7970 7465 642c 2074 6865  t encrypted, the
-0001a430: 6e20 7472 7920 6f75 7420 7061 7373 776f  n try out passwo
-0001a440: 7264 7320 6279 2074 7279 696e 6720 746f  rds by trying to
-0001a450: 206f 7065 6e20 7468 6520 6669 7273 7420   open the first 
-0001a460: 6669 6c65 2e0a 2020 2020 2020 2020 6669  file..        fi
-0001a470: 6c65 7320 3d20 5b66 696c 6520 666f 7220  les = [file for 
-0001a480: 6669 6c65 2069 6e20 6669 6c65 7320 6966  file in files if
-0001a490: 2066 696c 652e 6973 5f66 696c 6528 295d   file.is_file()]
-0001a4a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001a4b0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
-0001a4c0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-0001a4d0: 2020 2020 2020 2066 6f72 2070 6173 7377         for passw
-0001a4e0: 6f72 6420 696e 2070 6173 7377 6f72 6473  ord in passwords
-0001a4f0: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
-0001a500: 6c65 6f62 6a2e 7365 7470 6173 7377 6f72  leobj.setpasswor
-0001a510: 6428 7061 7373 776f 7264 290a 2020 2020  d(password).    
-0001a520: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001a530: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0001a540: 6820 6669 6c65 6f62 6a2e 6f70 656e 2866  h fileobj.open(f
-0001a550: 696c 6573 5b30 5d29 2061 7320 6669 6c65  iles[0]) as file
-0001a560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a570: 2020 2020 2020 6669 6c65 2e72 6561 6428        file.read(
-0001a580: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-0001a590: 2020 2072 6574 7572 6e20 7061 7373 776f     return passwo
-0001a5a0: 7264 0a20 2020 2020 2020 2020 2020 2065  rd.            e
-0001a5b0: 7863 6570 7420 2872 6172 6669 6c65 2e50  xcept (rarfile.P
-0001a5c0: 6173 7377 6f72 6452 6571 7569 7265 642c  asswordRequired,
-0001a5d0: 2072 6172 6669 6c65 2e42 6164 5261 7246   rarfile.BadRarF
-0001a5e0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
-0001a5f0: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-0001a600: 2020 2020 7261 6973 6520 7261 7266 696c      raise rarfil
-0001a610: 652e 5061 7373 776f 7264 5265 7175 6972  e.PasswordRequir
-0001a620: 6564 2822 436f 756c 6420 6e6f 7420 6669  ed("Could not fi
-0001a630: 6e64 2061 206d 6174 6368 696e 6720 7061  nd a matching pa
-0001a640: 7373 776f 7264 2122 290a 0a20 2020 2040  ssword!")..    @
-0001a650: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-0001a660: 2064 6566 205f 636f 6e76 6572 7454 6f46   def _convertToF
-0001a670: 696c 6549 6e66 6f28 696e 666f 3a20 2272  ileInfo(info: "r
-0001a680: 6172 6669 6c65 2e52 6172 496e 666f 2229  arfile.RarInfo")
-0001a690: 202d 3e20 4669 6c65 496e 666f 3a0a 2020   -> FileInfo:.  
-0001a6a0: 2020 2020 2020 6d6f 6465 203d 2030 6f35        mode = 0o5
-0001a6b0: 3535 207c 2028 7374 6174 2e53 5f49 4644  55 | (stat.S_IFD
-0001a6c0: 4952 2069 6620 696e 666f 2e69 735f 6469  IR if info.is_di
-0001a6d0: 7228 2920 656c 7365 2073 7461 742e 535f  r() else stat.S_
-0001a6e0: 4946 5245 4729 0a20 2020 2020 2020 2064  IFREG).        d
-0001a6f0: 7469 6d65 203d 2064 6174 6574 696d 652e  time = datetime.
-0001a700: 6461 7465 7469 6d65 282a 696e 666f 2e64  datetime(*info.d
-0001a710: 6174 655f 7469 6d65 290a 2020 2020 2020  ate_time).      
-0001a720: 2020 6474 696d 6520 3d20 6474 696d 652e    dtime = dtime.
-0001a730: 7265 706c 6163 6528 747a 696e 666f 3d64  replace(tzinfo=d
-0001a740: 6174 6574 696d 652e 7469 6d65 7a6f 6e65  atetime.timezone
-0001a750: 2e75 7463 290a 2020 2020 2020 2020 6d74  .utc).        mt
-0001a760: 696d 6520 3d20 6474 696d 652e 7469 6d65  ime = dtime.time
-0001a770: 7374 616d 7028 2920 6966 2069 6e66 6f2e  stamp() if info.
-0001a780: 6461 7465 5f74 696d 6520 656c 7365 2030  date_time else 0
-0001a790: 0a0a 2020 2020 2020 2020 2320 6669 6c65  ..        # file
-0001a7a0: 5f72 6564 6972 2069 7320 2874 7970 652c  _redir is (type,
-0001a7b0: 2066 6c61 6773 2c20 7461 7267 6574 2920   flags, target) 
-0001a7c0: 6f72 204e 6f6e 652e 204f 6e6c 7920 7465  or None. Only te
-0001a7d0: 7374 6564 2066 6f72 2074 7970 6520 3d3d  sted for type ==
-0001a7e0: 2052 4152 355f 5852 4544 4952 5f55 4e49   RAR5_XREDIR_UNI
-0001a7f0: 585f 5359 4d4c 494e 4b2e 0a20 2020 2020  X_SYMLINK..     
-0001a800: 2020 206c 696e 6b6e 616d 6520 3d20 2222     linkname = ""
-0001a810: 0a20 2020 2020 2020 2069 6620 696e 666f  .        if info
-0001a820: 2e66 696c 655f 7265 6469 723a 0a20 2020  .file_redir:.   
-0001a830: 2020 2020 2020 2020 206c 696e 6b6e 616d           linknam
-0001a840: 6520 3d20 696e 666f 2e66 696c 655f 7265  e = info.file_re
-0001a850: 6469 725b 325d 0a20 2020 2020 2020 2020  dir[2].         
-0001a860: 2020 206d 6f64 6520 3d20 306f 3535 3520     mode = 0o555 
-0001a870: 7c20 7374 6174 2e53 5f49 464c 4e4b 0a0a  | stat.S_IFLNK..
-0001a880: 2020 2020 2020 2020 6669 6c65 496e 666f          fileInfo
-0001a890: 203d 2046 696c 6549 6e66 6f28 0a20 2020   = FileInfo(.   
-0001a8a0: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
-0001a8b0: 6f66 660a 2020 2020 2020 2020 2020 2020  off.            
-0001a8c0: 7369 7a65 2020 2020 203d 2069 6e66 6f2e  size     = info.
-0001a8d0: 6669 6c65 5f73 697a 652c 0a20 2020 2020  file_size,.     
-0001a8e0: 2020 2020 2020 206d 7469 6d65 2020 2020         mtime    
-0001a8f0: 3d20 6d74 696d 652c 0a20 2020 2020 2020  = mtime,.       
-0001a900: 2020 2020 206d 6f64 6520 2020 2020 3d20       mode     = 
-0001a910: 6d6f 6465 2c0a 2020 2020 2020 2020 2020  mode,.          
-0001a920: 2020 6c69 6e6b 6e61 6d65 203d 206c 696e    linkname = lin
-0001a930: 6b6e 616d 652c 0a20 2020 2020 2020 2020  kname,.         
-0001a940: 2020 2075 6964 2020 2020 2020 3d20 6f73     uid      = os
-0001a950: 2e67 6574 7569 6428 292c 0a20 2020 2020  .getuid(),.     
-0001a960: 2020 2020 2020 2067 6964 2020 2020 2020         gid      
-0001a970: 3d20 6f73 2e67 6574 6769 6428 292c 0a20  = os.getgid(),. 
-0001a980: 2020 2020 2020 2020 2020 2075 7365 7264             userd
-0001a990: 6174 6120 3d20 5b69 6e66 6f5d 2c0a 2020  ata = [info],.  
-0001a9a0: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
-0001a9b0: 206f 6e0a 2020 2020 2020 2020 290a 0a20   on.        ).. 
-0001a9c0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-0001a9d0: 6c65 496e 666f 0a0a 2020 2020 406f 7665  leInfo..    @ove
-0001a9e0: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
-0001a9f0: 6365 290a 2020 2020 6465 6620 6c69 7374  ce).    def list
-0001aa00: 4469 7228 7365 6c66 2c20 7061 7468 3a20  Dir(self, path: 
-0001aa10: 7374 7229 202d 3e20 4f70 7469 6f6e 616c  str) -> Optional
-0001aa20: 5b49 7465 7261 626c 655b 7374 725d 5d3a  [Iterable[str]]:
-0001aa30: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-0001aa40: 7061 7468 2e73 7472 6970 2827 2f27 290a  path.strip('/').
-0001aa50: 2020 2020 2020 2020 6966 2070 6174 683a          if path:
-0001aa60: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0001aa70: 6820 2b3d 2027 2f27 0a0a 2020 2020 2020  h += '/'..      
-0001aa80: 2020 2320 544f 444f 2048 6f77 2074 6f20    # TODO How to 
-0001aa90: 6265 6861 7665 2077 6974 6820 6669 6c65  behave with file
-0001aaa0: 7320 696e 2061 7263 6869 7665 2077 6974  s in archive wit
-0001aab0: 6820 6162 736f 6c75 7465 2070 6174 6873  h absolute paths
-0001aac0: 3f20 4375 7272 656e 746c 792c 2074 6865  ? Currently, the
-0001aad0: 7920 776f 756c 6420 6e65 7665 7220 6265  y would never be
-0001aae0: 2073 686f 776e 2e0a 2020 2020 2020 2020   shown..        
-0001aaf0: 6465 6620 6765 744e 616d 6528 6669 6c65  def getName(file
-0001ab00: 5061 7468 293a 0a20 2020 2020 2020 2020  Path):.         
-0001ab10: 2020 2069 6620 6e6f 7420 6669 6c65 5061     if not filePa
-0001ab20: 7468 2e73 7461 7274 7377 6974 6828 7061  th.startswith(pa
-0001ab30: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-0001ab40: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001ab50: 0a0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-0001ab60: 6c65 5061 7468 203d 2066 696c 6550 6174  lePath = filePat
-0001ab70: 685b 6c65 6e28 7061 7468 2920 3a5d 2e73  h[len(path) :].s
-0001ab80: 7472 6970 2827 2f27 290a 2020 2020 2020  trip('/').      
-0001ab90: 2020 2020 2020 6966 206e 6f74 2066 696c        if not fil
-0001aba0: 6550 6174 683a 0a20 2020 2020 2020 2020  ePath:.         
-0001abb0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001abc0: 6e65 0a0a 2020 2020 2020 2020 2020 2020  ne..            
-0001abd0: 2320 5468 6973 2065 6666 6563 7469 7665  # This effective
-0001abe0: 6c79 2061 6464 7320 616c 6c20 7061 7265  ly adds all pare
-0001abf0: 6e74 2070 6174 6873 2061 7320 666f 6c64  nt paths as fold
-0001ac00: 6572 732e 2049 7420 6973 2065 6173 7920  ers. It is easy 
-0001ac10: 746f 2063 7265 6174 650a 2020 2020 2020  to create.      
-0001ac20: 2020 2020 2020 2320 5241 5273 2061 6e64        # RARs and
-0001ac30: 205a 4950 7320 7769 7468 206e 6573 7465   ZIPs with neste
-0001ac40: 6420 6669 6c65 7320 7769 7468 6f75 7420  d files without 
-0001ac50: 696e 666f 726d 6174 696f 6e20 6f6e 2074  information on t
-0001ac60: 6865 2070 6172 656e 7420 6469 7265 6374  he parent direct
-0001ac70: 6f72 6965 7321 0a20 2020 2020 2020 2020  ories!.         
-0001ac80: 2020 2069 6620 272f 2720 696e 2066 696c     if '/' in fil
-0001ac90: 6550 6174 683a 0a20 2020 2020 2020 2020  ePath:.         
-0001aca0: 2020 2020 2020 2066 6972 7374 536c 6173         firstSlas
-0001acb0: 6820 3d20 6669 6c65 5061 7468 2e69 6e64  h = filePath.ind
-0001acc0: 6578 2827 2f27 290a 2020 2020 2020 2020  ex('/').        
-0001acd0: 2020 2020 2020 2020 6669 6c65 5061 7468          filePath
-0001ace0: 203d 2066 696c 6550 6174 685b 3a66 6972   = filePath[:fir
-0001acf0: 7374 536c 6173 685d 0a0a 2020 2020 2020  stSlash]..      
-0001ad00: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
-0001ad10: 6550 6174 680a 0a20 2020 2020 2020 2023  ePath..        #
-0001ad20: 2054 6865 2022 6669 6c65 6e61 6d65 2220   The "filename" 
-0001ad30: 6d65 6d62 6572 2069 7320 7772 6f6e 676c  member is wrongl
-0001ad40: 7920 6e61 6d65 6420 6173 2069 7420 7265  y named as it re
-0001ad50: 7475 726e 7320 7468 6520 6675 6c6c 2070  turns the full p
-0001ad60: 6174 6820 696e 7369 6465 2074 6865 2061  ath inside the a
-0001ad70: 7263 6869 7665 206e 6f74 206a 7573 7420  rchive not just 
-0001ad80: 7468 6520 6e61 6d65 2070 6172 742e 0a20  the name part.. 
-0001ad90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001ada0: 7428 6765 744e 616d 6528 696e 666f 2e66  t(getName(info.f
-0001adb0: 696c 656e 616d 6529 2066 6f72 2069 6e66  ilename) for inf
-0001adc0: 6f20 696e 2073 656c 662e 6669 6c65 7320  o in self.files 
-0001add0: 6966 2067 6574 4e61 6d65 2869 6e66 6f2e  if getName(info.
-0001ade0: 6669 6c65 6e61 6d65 2929 0a0a 2020 2020  filename))..    
-0001adf0: 6465 6620 5f67 6574 4669 6c65 496e 666f  def _getFileInfo
-0001ae00: 7328 7365 6c66 2c20 7061 7468 3a20 7374  s(self, path: st
-0001ae10: 7229 202d 3e20 4c69 7374 5b46 696c 6549  r) -> List[FileI
-0001ae20: 6e66 6f5d 3a0a 2020 2020 2020 2020 696e  nfo]:.        in
-0001ae30: 666f 4c69 7374 203d 205b 0a20 2020 2020  foList = [.     
-0001ae40: 2020 2020 2020 2052 6172 4d6f 756e 7453         RarMountS
-0001ae50: 6f75 7263 652e 5f63 6f6e 7665 7274 546f  ource._convertTo
-0001ae60: 4669 6c65 496e 666f 2869 6e66 6f29 0a20  FileInfo(info). 
-0001ae70: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0001ae80: 6e66 6f20 696e 2073 656c 662e 6669 6c65  nfo in self.file
-0001ae90: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-0001aea0: 2069 6e66 6f2e 6669 6c65 6e61 6d65 2e72   info.filename.r
-0001aeb0: 7374 7269 7028 272f 2729 203d 3d20 7061  strip('/') == pa
-0001aec0: 7468 2e6c 7374 7269 7028 272f 2729 0a20  th.lstrip('/'). 
-0001aed0: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-0001aee0: 2020 2320 4966 2077 6520 6861 7665 2061    # If we have a
-0001aef0: 2066 696c 6549 6e66 6f20 666f 7220 7468   fileInfo for th
-0001af00: 6520 6769 7665 6e20 6469 7265 6374 6f72  e given director
-0001af10: 7920 7061 7468 2c20 7468 656e 2065 7665  y path, then eve
-0001af20: 7279 7468 696e 6720 6973 2066 696e 652e  rything is fine.
-0001af30: 0a20 2020 2020 2020 2070 6174 6841 7344  .        pathAsD
-0001af40: 6972 203d 2070 6174 682e 7374 7269 7028  ir = path.strip(
-0001af50: 272f 2729 202b 2027 2f27 0a0a 2020 2020  '/') + '/'..    
-0001af60: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
-0001af70: 6865 7220 736f 6d65 2070 6172 656e 7420  her some parent 
-0001af80: 6469 7265 6374 6f72 6965 7320 6f66 2066  directories of f
-0001af90: 696c 6573 2064 6f20 6e6f 7420 6578 6973  iles do not exis
-0001afa0: 7420 6173 2073 6570 6172 6174 6520 656e  t as separate en
-0001afb0: 7469 7469 6573 2069 6e20 7468 6520 6172  tities in the ar
-0001afc0: 6368 6976 652e 0a20 2020 2020 2020 2069  chive..        i
-0001afd0: 6620 6e6f 7420 616e 7928 5b69 6e66 6f2e  f not any([info.
-0001afe0: 7573 6572 6461 7461 5b2d 315d 2e66 696c  userdata[-1].fil
-0001aff0: 656e 616d 6520 3d3d 2070 6174 6841 7344  ename == pathAsD
-0001b000: 6972 2066 6f72 2069 6e66 6f20 696e 2069  ir for info in i
-0001b010: 6e66 6f4c 6973 745d 2920 616e 6420 616e  nfoList]) and an
-0001b020: 7928 0a20 2020 2020 2020 2020 2020 2069  y(.            i
-0001b030: 6e66 6f2e 6669 6c65 6e61 6d65 2e72 7374  nfo.filename.rst
-0001b040: 7269 7028 272f 2729 2e73 7461 7274 7377  rip('/').startsw
-0001b050: 6974 6828 7061 7468 4173 4469 7229 2066  ith(pathAsDir) f
-0001b060: 6f72 2069 6e66 6f20 696e 2073 656c 662e  or info in self.
-0001b070: 6669 6c65 730a 2020 2020 2020 2020 293a  files.        ):
-0001b080: 0a20 2020 2020 2020 2020 2020 2069 6e66  .            inf
-0001b090: 6f4c 6973 742e 6170 7065 6e64 280a 2020  oList.append(.  
-0001b0a0: 2020 2020 2020 2020 2020 2020 2020 4669                Fi
-0001b0b0: 6c65 496e 666f 280a 2020 2020 2020 2020  leInfo(.        
-0001b0c0: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
-0001b0d0: 743a 206f 6666 0a20 2020 2020 2020 2020  t: off.         
-0001b0e0: 2020 2020 2020 2020 2020 2073 697a 6520             size 
-0001b0f0: 2020 2020 3d20 302c 0a20 2020 2020 2020      = 0,.       
-0001b100: 2020 2020 2020 2020 2020 2020 206d 7469               mti
-0001b110: 6d65 2020 2020 3d20 696e 7428 7469 6d65  me    = int(time
-0001b120: 2e74 696d 6528 2929 2c0a 2020 2020 2020  .time()),.      
-0001b130: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0001b140: 6465 2020 2020 203d 2030 6f37 3737 207c  de     = 0o777 |
-0001b150: 2073 7461 742e 535f 4946 4449 522c 0a20   stat.S_IFDIR,. 
-0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 206c 696e 6b6e 616d 6520 3d20 2222     linkname = ""
-0001b180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b190: 2020 2020 2020 7569 6420 2020 2020 203d        uid      =
-0001b1a0: 206f 732e 6765 7475 6964 2829 2c0a 2020   os.getuid(),.  
-0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1c0: 2020 6769 6420 2020 2020 203d 206f 732e    gid      = os.
-0001b1d0: 6765 7467 6964 2829 2c0a 2020 2020 2020  getgid(),.      
-0001b1e0: 2020 2020 2020 2020 2020 2020 2020 7573                us
-0001b1f0: 6572 6461 7461 203d 205b 4e6f 6e65 5d2c  erdata = [None],
-0001b200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b210: 2020 2020 2023 2066 6d74 3a20 6f6e 0a20       # fmt: on. 
-0001b220: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001b230: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0001b240: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0001b250: 6e66 6f4c 6973 740a 0a20 2020 2040 6f76  nfoList..    @ov
-0001b260: 6572 7269 6465 7328 4d6f 756e 7453 6f75  errides(MountSou
-0001b270: 7263 6529 0a20 2020 2064 6566 2067 6574  rce).    def get
-0001b280: 4669 6c65 496e 666f 2873 656c 662c 2070  FileInfo(self, p
-0001b290: 6174 683a 2073 7472 2c20 6669 6c65 5665  ath: str, fileVe
-0001b2a0: 7273 696f 6e3a 2069 6e74 203d 2030 2920  rsion: int = 0) 
-0001b2b0: 2d3e 204f 7074 696f 6e61 6c5b 4669 6c65  -> Optional[File
-0001b2c0: 496e 666f 5d3a 0a20 2020 2020 2020 2069  Info]:.        i
-0001b2d0: 6e66 6f73 203d 2073 656c 662e 5f67 6574  nfos = self._get
-0001b2e0: 4669 6c65 496e 666f 7328 7061 7468 290a  FileInfos(path).
-0001b2f0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0001b300: 6e66 6f73 5b66 696c 6556 6572 7369 6f6e  nfos[fileVersion
-0001b310: 5d20 6966 202d 6c65 6e28 696e 666f 7329  ] if -len(infos)
-0001b320: 203c 3d20 6669 6c65 5665 7273 696f 6e20   <= fileVersion 
-0001b330: 3c20 6c65 6e28 696e 666f 7329 2065 6c73  < len(infos) els
-0001b340: 6520 4e6f 6e65 0a0a 2020 2020 406f 7665  e None..    @ove
-0001b350: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
-0001b360: 6365 290a 2020 2020 6465 6620 6669 6c65  ce).    def file
-0001b370: 5665 7273 696f 6e73 2873 656c 662c 2070  Versions(self, p
-0001b380: 6174 683a 2073 7472 2920 2d3e 2069 6e74  ath: str) -> int
-0001b390: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001b3a0: 206c 656e 2873 656c 662e 5f67 6574 4669   len(self._getFi
-0001b3b0: 6c65 496e 666f 7328 7061 7468 2929 0a0a  leInfos(path))..
-0001b3c0: 2020 2020 406f 7665 7272 6964 6573 284d      @overrides(M
-0001b3d0: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
-0001b3e0: 6465 6620 6f70 656e 2873 656c 662c 2066  def open(self, f
-0001b3f0: 696c 6549 6e66 6f3a 2046 696c 6549 6e66  ileInfo: FileInf
-0001b400: 6f29 202d 3e20 494f 5b62 7974 6573 5d3a  o) -> IO[bytes]:
-0001b410: 0a20 2020 2020 2020 2069 6e66 6f20 3d20  .        info = 
-0001b420: 6669 6c65 496e 666f 2e75 7365 7264 6174  fileInfo.userdat
-0001b430: 615b 2d31 5d0a 2020 2020 2020 2020 6173  a[-1].        as
-0001b440: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-0001b450: 696e 666f 2c20 7261 7266 696c 652e 5261  info, rarfile.Ra
-0001b460: 7249 6e66 6f29 0a20 2020 2020 2020 2072  rInfo).        r
-0001b470: 6574 7572 6e20 6361 7374 2849 4f5b 6279  eturn cast(IO[by
-0001b480: 7465 735d 2c20 5261 7746 696c 6549 6e73  tes], RawFileIns
-0001b490: 6964 6552 6172 286c 616d 6264 613a 2073  ideRar(lambda: s
-0001b4a0: 656c 662e 6669 6c65 4f62 6a65 6374 2e6f  elf.fileObject.o
-0001b4b0: 7065 6e28 696e 666f 2c20 2772 2729 2c20  pen(info, 'r'), 
-0001b4c0: 696e 666f 2e66 696c 655f 7369 7a65 2929  info.file_size))
-0001b4d0: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
-0001b4e0: 284d 6f75 6e74 536f 7572 6365 290a 2020  (MountSource).  
-0001b4f0: 2020 6465 6620 7265 6164 2873 656c 662c    def read(self,
-0001b500: 2066 696c 6549 6e66 6f3a 2046 696c 6549   fileInfo: FileI
-0001b510: 6e66 6f2c 2073 697a 653a 2069 6e74 2c20  nfo, size: int, 
-0001b520: 6f66 6673 6574 3a20 696e 7429 202d 3e20  offset: int) -> 
-0001b530: 6279 7465 733a 0a20 2020 2020 2020 2077  bytes:.        w
-0001b540: 6974 6820 7365 6c66 2e6f 7065 6e28 6669  ith self.open(fi
-0001b550: 6c65 496e 666f 2920 6173 2066 696c 653a  leInfo) as file:
-0001b560: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0001b570: 652e 7365 656b 286f 6666 7365 742c 206f  e.seek(offset, o
-0001b580: 732e 5345 454b 5f53 4554 290a 2020 2020  s.SEEK_SET).    
-0001b590: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0001b5a0: 696c 652e 7265 6164 2873 697a 6529 0a0a  ile.read(size)..
-0001b5b0: 0a63 6c61 7373 2044 756d 6d79 4675 7365  .class DummyFuse
-0001b5c0: 4f70 6572 6174 696f 6e73 3a0a 2020 2020  Operations:.    
-0001b5d0: 2222 2241 2064 756d 6d79 2063 6c61 7373  """A dummy class
-0001b5e0: 2074 6861 7420 6973 2075 7365 6420 746f   that is used to
-0001b5f0: 2072 6570 6c61 6365 0a20 2020 2066 7573   replace.    fus
-0001b600: 652e 4f70 6572 6174 696f 6e73 2069 6620  e.Operations if 
-0001b610: 6675 7365 7079 2069 7320 6e6f 7420 696e  fusepy is not in
-0001b620: 7374 616c 6c65 642e 2222 220a 0a20 2020  stalled."""..   
-0001b630: 2064 6566 2069 6e69 7428 7365 6c66 293a   def init(self):
-0001b640: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
-0001b650: 2020 2064 6566 2067 6574 6174 7472 2873     def getattr(s
-0001b660: 656c 6629 3a0a 2020 2020 2020 2020 7061  elf):.        pa
-0001b670: 7373 0a0a 2020 2020 6465 6620 7265 6164  ss..    def read
-0001b680: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001b690: 7061 7373 0a0a 2020 2020 6465 6620 7265  pass..    def re
-0001b6a0: 6164 6469 7228 7365 6c66 293a 0a20 2020  addir(self):.   
-0001b6b0: 2020 2020 2070 6173 730a 0a20 2020 2064       pass..    d
-0001b6c0: 6566 2072 6561 646c 696e 6b28 7365 6c66  ef readlink(self
-0001b6d0: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
-0001b6e0: 0a20 2020 2064 6566 206f 7065 6e28 7365  .    def open(se
-0001b6f0: 6c66 293a 0a20 2020 2020 2020 2070 6173  lf):.        pas
-0001b700: 730a 0a20 2020 2064 6566 2072 656c 6561  s..    def relea
-0001b710: 7365 2873 656c 6629 3a0a 2020 2020 2020  se(self):.      
-0001b720: 2020 7061 7373 0a0a 0a46 7573 654f 7065    pass...FuseOpe
-0001b730: 7261 7469 6f6e 7320 3d20 6675 7365 2e4f  rations = fuse.O
-0001b740: 7065 7261 7469 6f6e 7320 6966 2027 6675  perations if 'fu
-0001b750: 7365 2720 696e 2073 7973 2e6d 6f64 756c  se' in sys.modul
-0001b760: 6573 2065 6c73 6520 4475 6d6d 7946 7573  es else DummyFus
-0001b770: 654f 7065 7261 7469 6f6e 730a 0a0a 6465  eOperations...de
-0001b780: 6620 6f70 656e 4d6f 756e 7453 6f75 7263  f openMountSourc
-0001b790: 6528 6669 6c65 4f72 5061 7468 3a20 556e  e(fileOrPath: Un
-0001b7a0: 696f 6e5b 7374 722c 2049 4f5b 6279 7465  ion[str, IO[byte
-0001b7b0: 735d 5d2c 202a 2a6f 7074 696f 6e73 2920  s]], **options) 
-0001b7c0: 2d3e 204d 6f75 6e74 536f 7572 6365 3a0a  -> MountSource:.
-0001b7d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001b7e0: 6528 6669 6c65 4f72 5061 7468 2c20 7374  e(fileOrPath, st
-0001b7f0: 7229 3a0a 2020 2020 2020 2020 6966 206e  r):.        if n
-0001b800: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-0001b810: 7328 6669 6c65 4f72 5061 7468 293a 0a20  s(fileOrPath):. 
-0001b820: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001b830: 2045 7863 6570 7469 6f6e 2822 4d6f 756e   Exception("Moun
-0001b840: 7420 736f 7572 6365 2064 6f65 7320 6e6f  t source does no
-0001b850: 7420 6578 6973 7421 2229 0a0a 2020 2020  t exist!")..    
-0001b860: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
-0001b870: 7364 6972 2866 696c 654f 7250 6174 6829  sdir(fileOrPath)
-0001b880: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001b890: 7475 726e 2046 6f6c 6465 724d 6f75 6e74  turn FolderMount
-0001b8a0: 536f 7572 6365 2827 2e27 2069 6620 6669  Source('.' if fi
-0001b8b0: 6c65 4f72 5061 7468 203d 3d20 272e 2720  leOrPath == '.' 
-0001b8c0: 656c 7365 206f 732e 7061 7468 2e72 6561  else os.path.rea
-0001b8d0: 6c70 6174 6828 6669 6c65 4f72 5061 7468  lpath(fileOrPath
-0001b8e0: 2929 0a0a 2020 2020 7472 793a 0a20 2020  ))..    try:.   
-0001b8f0: 2020 2020 2069 6620 2772 6172 6669 6c65       if 'rarfile
-0001b900: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
-0001b910: 2061 6e64 2072 6172 6669 6c65 2e69 735f   and rarfile.is_
-0001b920: 7261 7266 696c 6528 6669 6c65 4f72 5061  rarfile(fileOrPa
-0001b930: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-0001b940: 2072 6574 7572 6e20 5261 724d 6f75 6e74   return RarMount
-0001b950: 536f 7572 6365 2866 696c 654f 7250 6174  Source(fileOrPat
-0001b960: 682c 202a 2a6f 7074 696f 6e73 290a 2020  h, **options).  
-0001b970: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0001b980: 6f6e 2061 7320 6578 6365 7074 696f 6e3a  on as exception:
-0001b990: 0a20 2020 2020 2020 2069 6620 7072 696e  .        if prin
-0001b9a0: 7444 6562 7567 203e 3d20 313a 0a20 2020  tDebug >= 1:.   
-0001b9b0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-0001b9c0: 5b49 6e66 6f5d 2043 6865 636b 696e 6720  [Info] Checking 
-0001b9d0: 666f 7220 5241 5220 6669 6c65 2072 6169  for RAR file rai
-0001b9e0: 7365 6420 616e 2065 7863 6570 7469 6f6e  sed an exception
-0001b9f0: 3a22 2c20 6578 6365 7074 696f 6e29 0a20  :", exception). 
-0001ba00: 2020 2020 2020 2069 6620 7072 696e 7444         if printD
-0001ba10: 6562 7567 203e 3d20 323a 0a20 2020 2020  ebug >= 2:.     
-0001ba20: 2020 2020 2020 2074 7261 6365 6261 636b         traceback
-0001ba30: 2e70 7269 6e74 5f65 7863 2829 0a20 2020  .print_exc().   
-0001ba40: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-0001ba50: 2020 6966 2068 6173 6174 7472 2866 696c    if hasattr(fil
-0001ba60: 654f 7250 6174 682c 2027 7365 656b 2729  eOrPath, 'seek')
-0001ba70: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
-0001ba80: 6c65 4f72 5061 7468 2e73 6565 6b28 3029  leOrPath.seek(0)
-0001ba90: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
-0001baa0: 0a0a 2020 2020 7472 793a 0a20 2020 2020  ..    try:.     
-0001bab0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0001bac0: 2866 696c 654f 7250 6174 682c 2073 7472  (fileOrPath, str
-0001bad0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0001bae0: 6574 7572 6e20 5351 4c69 7465 496e 6465  eturn SQLiteInde
-0001baf0: 7865 6454 6172 2866 696c 654f 7250 6174  xedTar(fileOrPat
-0001bb00: 682c 202a 2a6f 7074 696f 6e73 290a 0a20  h, **options).. 
-0001bb10: 2020 2020 2020 2072 6574 7572 6e20 5351         return SQ
-0001bb20: 4c69 7465 496e 6465 7865 6454 6172 2866  LiteIndexedTar(f
-0001bb30: 696c 654f 626a 6563 743d 6669 6c65 4f72  ileObject=fileOr
-0001bb40: 5061 7468 2c20 2a2a 6f70 7469 6f6e 7329  Path, **options)
-0001bb50: 0a20 2020 2065 7863 6570 7420 5261 7461  .    except Rata
-0001bb60: 726d 6f75 6e74 4572 726f 7220 6173 2065  rmountError as e
-0001bb70: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-0001bb80: 2020 6966 2070 7269 6e74 4465 6275 6720    if printDebug 
-0001bb90: 3e3d 2032 3a0a 2020 2020 2020 2020 2020  >= 2:.          
-0001bba0: 2020 7072 696e 7428 225b 496e 666f 5d20    print("[Info] 
-0001bbb0: 4368 6563 6b69 6e67 2066 6f72 2028 636f  Checking for (co
-0001bbc0: 6d70 7265 7373 6564 2920 5441 5220 6669  mpressed) TAR fi
-0001bbd0: 6c65 2072 6169 7365 6420 616e 2065 7863  le raised an exc
-0001bbe0: 6570 7469 6f6e 3a22 2c20 6578 6365 7074  eption:", except
-0001bbf0: 696f 6e29 0a20 2020 2020 2020 2069 6620  ion).        if 
-0001bc00: 7072 696e 7444 6562 7567 203e 3d20 333a  printDebug >= 3:
-0001bc10: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-0001bc20: 6365 6261 636b 2e70 7269 6e74 5f65 7863  ceback.print_exc
-0001bc30: 2829 0a20 2020 2065 7863 6570 7420 4578  ().    except Ex
-0001bc40: 6365 7074 696f 6e20 6173 2065 7863 6570  ception as excep
-0001bc50: 7469 6f6e 3a0a 2020 2020 2020 2020 6966  tion:.        if
-0001bc60: 2070 7269 6e74 4465 6275 6720 3e3d 2031   printDebug >= 1
-0001bc70: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0001bc80: 696e 7428 225b 496e 666f 5d20 4368 6563  int("[Info] Chec
-0001bc90: 6b69 6e67 2066 6f72 2028 636f 6d70 7265  king for (compre
-0001bca0: 7373 6564 2920 5441 5220 6669 6c65 2072  ssed) TAR file r
-0001bcb0: 6169 7365 6420 616e 2065 7863 6570 7469  aised an excepti
-0001bcc0: 6f6e 3a22 2c20 6578 6365 7074 696f 6e29  on:", exception)
-0001bcd0: 0a20 2020 2020 2020 2069 6620 7072 696e  .        if prin
-0001bce0: 7444 6562 7567 203e 3d20 333a 0a20 2020  tDebug >= 3:.   
-0001bcf0: 2020 2020 2020 2020 2074 7261 6365 6261           traceba
-0001bd00: 636b 2e70 7269 6e74 5f65 7863 2829 0a20  ck.print_exc(). 
-0001bd10: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
-0001bd20: 2020 2020 6966 2068 6173 6174 7472 2866      if hasattr(f
-0001bd30: 696c 654f 7250 6174 682c 2027 7365 656b  ileOrPath, 'seek
-0001bd40: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0001bd50: 6669 6c65 4f72 5061 7468 2e73 6565 6b28  fileOrPath.seek(
-0001bd60: 3029 2020 2320 7479 7065 3a20 6967 6e6f  0)  # type: igno
-0001bd70: 7265 0a0a 2020 2020 6966 2027 7a69 7066  re..    if 'zipf
-0001bd80: 696c 6527 2069 6e20 7379 732e 6d6f 6475  ile' in sys.modu
-0001bd90: 6c65 733a 0a20 2020 2020 2020 2074 7279  les:.        try
-0001bda0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001bdb0: 6973 5f7a 6970 6669 6c65 2069 7320 6d75  is_zipfile is mu
-0001bdc0: 6368 2074 6f6f 206c 6178 2077 6865 6e20  ch too lax when 
-0001bdd0: 7465 7374 696e 6720 666f 7220 5a49 5073  testing for ZIPs
-0001bde0: 2062 6563 6175 7365 2069 7427 7320 6f6e   because it's on
-0001bdf0: 6c79 2074 6573 7469 6e67 2066 6f72 2074  ly testing for t
-0001be00: 6865 2063 656e 7472 616c 2064 6972 6563  he central direc
-0001be10: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
-0001be20: 2023 2061 7420 7468 6520 656e 6420 6f66   # at the end of
-0001be30: 2074 6865 2066 696c 6520 6e6f 7420 7468   the file not th
-0001be40: 6520 6d61 6769 6320 6269 7473 2061 7420  e magic bits at 
-0001be50: 7468 6520 6265 6769 6e6e 696e 672e 204d  the beginning. M
-0001be60: 6561 6e69 6e67 2c20 6966 2061 6e6f 7468  eaning, if anoth
-0001be70: 6572 206e 6f6e 2d5a 4950 2061 7263 6869  er non-ZIP archi
-0001be80: 7665 2068 6173 0a20 2020 2020 2020 2020  ve has.         
-0001be90: 2020 2023 207a 6970 2063 6f6e 7465 6e74     # zip content
-0001bea0: 7320 6174 2074 6865 2065 6e64 2c20 7468  s at the end, th
-0001beb0: 656e 2069 7420 6d69 6768 7420 6765 7420  en it might get 
-0001bec0: 6d69 7363 6c61 7373 6966 6965 6421 2054  misclassified! T
-0001bed0: 6865 666f 7265 2c20 6d61 6e75 616c 6c79  hefore, manually
-0001bee0: 2063 6865 636b 2066 6f72 2050 4b20 6174   check for PK at
-0001bef0: 2073 7461 7274 2e0a 2020 2020 2020 2020   start..        
-0001bf00: 2020 2020 2320 6874 7470 733a 2f2f 6275      # https://bu
-0001bf10: 6773 2e70 7974 686f 6e2e 6f72 672f 6973  gs.python.org/is
-0001bf20: 7375 6531 3637 3335 0a20 2020 2020 2020  sue16735.       
-0001bf30: 2020 2020 2023 2068 7474 7073 3a2f 2f62       # https://b
-0001bf40: 7567 732e 7079 7468 6f6e 2e6f 7267 2f69  ugs.python.org/i
-0001bf50: 7373 7565 3238 3439 340a 2020 2020 2020  ssue28494.      
-0001bf60: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-0001bf70: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
-0001bf80: 6973 7375 6534 3230 3936 0a20 2020 2020  issue42096.     
-0001bf90: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
-0001bfa0: 2f62 7567 732e 7079 7468 6f6e 2e6f 7267  /bugs.python.org
-0001bfb0: 2f69 7373 7565 3435 3238 370a 2020 2020  /issue45287.    
-0001bfc0: 2020 2020 2020 2020 2320 544f 444f 2054          # TODO T
-0001bfd0: 6869 7320 7769 6c6c 206e 6f74 2072 6563  his will not rec
-0001bfe0: 6f67 6e69 7a65 2073 656c 662d 6578 7472  ognize self-extr
-0001bff0: 6163 7469 6e67 205a 4950 2061 7263 6869  acting ZIP archi
-0001c000: 7665 732c 2073 6f20 666f 7220 6e6f 772c  ves, so for now,
-0001c010: 2074 686f 7365 2061 7265 2073 696d 706c   those are simpl
-0001c020: 7920 6e6f 7420 7375 7070 6f72 7465 6421  y not supported!
-0001c030: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001c040: 6973 696e 7374 616e 6365 2866 696c 654f  isinstance(fileO
-0001c050: 7250 6174 682c 2073 7472 293a 0a20 2020  rPath, str):.   
-0001c060: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0001c070: 6820 6f70 656e 2866 696c 654f 7250 6174  h open(fileOrPat
-0001c080: 682c 2027 7262 2729 2061 7320 6669 6c65  h, 'rb') as file
-0001c090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c0a0: 2020 2020 2020 6966 2073 7570 706f 7274        if support
-0001c0b0: 6564 436f 6d70 7265 7373 696f 6e73 5b27  edCompressions['
-0001c0c0: 7a69 7027 5d2e 6368 6563 6b48 6561 6465  zip'].checkHeade
-0001c0d0: 7228 6669 6c65 2920 616e 6420 7a69 7066  r(file) and zipf
-0001c0e0: 696c 652e 6973 5f7a 6970 6669 6c65 2866  ile.is_zipfile(f
-0001c0f0: 696c 654f 7250 6174 6829 3a0a 2020 2020  ileOrPath):.    
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c110: 2020 2020 7265 7475 726e 205a 6970 4d6f      return ZipMo
-0001c120: 756e 7453 6f75 7263 6528 6669 6c65 4f72  untSource(fileOr
-0001c130: 5061 7468 2c20 2a2a 6f70 7469 6f6e 7329  Path, **options)
-0001c140: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0001c150: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001c160: 2020 2023 2054 4f44 4f20 4f6e 6520 7072     # TODO One pr
-0001c170: 6f62 6c65 6d20 6865 7265 2069 7320 7768  oblem here is wh
-0001c180: 656e 2074 7279 696e 6720 746f 2072 6561  en trying to rea
-0001c190: 6420 616e 6420 7468 656e 2073 6565 6b20  d and then seek 
-0001c1a0: 6261 636b 2062 7574 2074 6865 7265 2061  back but there a
-0001c1b0: 6c73 6f20 6973 206e 6f20 7065 656b 206d  lso is no peek m
-0001c1c0: 6574 686f 642e 0a20 2020 2020 2020 2020  ethod..         
-0001c1d0: 2020 2020 2020 2023 2020 2020 2020 6874         #      ht
-0001c1e0: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-0001c1f0: 2f6d 6172 6b6f 6b72 2f72 6172 6669 6c65  /markokr/rarfile
-0001c200: 2f69 7373 7565 732f 3733 0a20 2020 2020  /issues/73.     
-0001c210: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-0001c220: 6c65 4f72 5061 7468 2e72 6561 6428 3229  leOrPath.read(2)
-0001c230: 203d 3d20 6227 504b 2720 616e 6420 7a69   == b'PK' and zi
-0001c240: 7066 696c 652e 6973 5f7a 6970 6669 6c65  pfile.is_zipfile
-0001c250: 2866 696c 654f 7250 6174 6829 3a0a 2020  (fileOrPath):.  
-0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c270: 2020 7265 7475 726e 205a 6970 4d6f 756e    return ZipMoun
-0001c280: 7453 6f75 7263 6528 6669 6c65 4f72 5061  tSource(fileOrPa
-0001c290: 7468 2c20 2a2a 6f70 7469 6f6e 7329 0a20  th, **options). 
-0001c2a0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-0001c2b0: 6365 7074 696f 6e20 6173 2065 7863 6570  ception as excep
-0001c2c0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0001c2d0: 2020 6966 2070 7269 6e74 4465 6275 6720    if printDebug 
-0001c2e0: 3e3d 2031 3a0a 2020 2020 2020 2020 2020  >= 1:.          
-0001c2f0: 2020 2020 2020 7072 696e 7428 225b 496e        print("[In
-0001c300: 666f 5d20 4368 6563 6b69 6e67 2066 6f72  fo] Checking for
-0001c310: 205a 4950 2066 696c 6520 7261 6973 6564   ZIP file raised
-0001c320: 2061 6e20 6578 6365 7074 696f 6e3a 222c   an exception:",
-0001c330: 2065 7863 6570 7469 6f6e 290a 2020 2020   exception).    
-0001c340: 2020 2020 2020 2020 6966 2070 7269 6e74          if print
-0001c350: 4465 6275 6720 3e3d 2033 3a0a 2020 2020  Debug >= 3:.    
-0001c360: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-0001c370: 6562 6163 6b2e 7072 696e 745f 6578 6328  eback.print_exc(
-0001c380: 290a 2020 2020 2020 2020 6669 6e61 6c6c  ).        finall
-0001c390: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-0001c3a0: 6620 6861 7361 7474 7228 6669 6c65 4f72  f hasattr(fileOr
-0001c3b0: 5061 7468 2c20 2773 6565 6b27 293a 0a20  Path, 'seek'):. 
-0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001c3d0: 696c 654f 7250 6174 682e 7365 656b 2830  ileOrPath.seek(0
-0001c3e0: 2920 2023 2074 7970 653a 2069 676e 6f72  )  # type: ignor
-0001c3f0: 650a 0a20 2020 2072 6169 7365 2043 6f6d  e..    raise Com
-0001c400: 7072 6573 7369 6f6e 4572 726f 7228 2241  pressionError("A
-0001c410: 7263 6869 7665 2074 6f20 6f70 656e 2068  rchive to open h
-0001c420: 6173 2075 6e72 6563 6f67 6e69 7a65 6420  as unrecognized 
-0001c430: 666f 726d 6174 2122 290a 0a0a 636c 6173  format!")...clas
-0001c440: 7320 556e 696f 6e4d 6f75 6e74 536f 7572  s UnionMountSour
-0001c450: 6365 284d 6f75 6e74 536f 7572 6365 293a  ce(MountSource):
-0001c460: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0001c470: 5f28 7365 6c66 2c20 6d6f 756e 7453 6f75  _(self, mountSou
-0001c480: 7263 6573 3a20 4c69 7374 5b4d 6f75 6e74  rces: List[Mount
-0001c490: 536f 7572 6365 5d29 202d 3e20 4e6f 6e65  Source]) -> None
-0001c4a0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6d  :.        self.m
-0001c4b0: 6f75 6e74 536f 7572 6365 733a 204c 6973  ountSources: Lis
-0001c4c0: 745b 4d6f 756e 7453 6f75 7263 655d 203d  t[MountSource] =
-0001c4d0: 206d 6f75 6e74 536f 7572 6365 730a 0a20   mountSources.. 
-0001c4e0: 2020 2020 2020 2073 656c 662e 666f 6c64         self.fold
-0001c4f0: 6572 4361 6368 653a 2044 6963 745b 7374  erCache: Dict[st
-0001c500: 722c 204c 6973 745b 4d6f 756e 7453 6f75  r, List[MountSou
-0001c510: 7263 655d 5d20 3d20 7b22 2f22 3a20 7365  rce]] = {"/": se
-0001c520: 6c66 2e6d 6f75 6e74 536f 7572 6365 737d  lf.mountSources}
-0001c530: 0a20 2020 2020 2020 2073 656c 662e 666f  .        self.fo
-0001c540: 6c64 6572 4361 6368 6544 6570 7468 203d  lderCacheDepth =
-0001c550: 2030 2020 2320 6465 7074 6820 3120 6d65   0  # depth 1 me
-0001c560: 616e 732c 2077 6520 6f6e 6c79 2063 6163  ans, we only cac
-0001c570: 6865 6420 746f 702d 6c65 7665 6c20 6469  hed top-level di
-0001c580: 7265 6374 6f72 6965 732e 0a0a 2020 2020  rectories...    
-0001c590: 2020 2020 7365 6c66 2e72 6f6f 7446 696c      self.rootFil
-0001c5a0: 6549 6e66 6f20 3d20 4669 6c65 496e 666f  eInfo = FileInfo
-0001c5b0: 280a 2020 2020 2020 2020 2020 2020 2320  (.            # 
-0001c5c0: 666d 743a 206f 6666 0a20 2020 2020 2020  fmt: off.       
-0001c5d0: 2020 2020 2073 697a 6520 2020 2020 3d20       size     = 
-0001c5e0: 302c 0a20 2020 2020 2020 2020 2020 206d  0,.            m
-0001c5f0: 7469 6d65 2020 2020 3d20 696e 7428 7469  time    = int(ti
-0001c600: 6d65 2e74 696d 6528 2929 2c0a 2020 2020  me.time()),.    
-0001c610: 2020 2020 2020 2020 6d6f 6465 2020 2020          mode    
-0001c620: 203d 2030 6f37 3737 207c 2073 7461 742e   = 0o777 | stat.
-0001c630: 535f 4946 4449 522c 0a20 2020 2020 2020  S_IFDIR,.       
-0001c640: 2020 2020 206c 696e 6b6e 616d 6520 3d20       linkname = 
-0001c650: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0001c660: 7569 6420 2020 2020 203d 206f 732e 6765  uid      = os.ge
-0001c670: 7475 6964 2829 2c0a 2020 2020 2020 2020  tuid(),.        
-0001c680: 2020 2020 6769 6420 2020 2020 203d 206f      gid      = o
-0001c690: 732e 6765 7467 6964 2829 2c0a 2020 2020  s.getgid(),.    
-0001c6a0: 2020 2020 2020 2020 7573 6572 6461 7461          userdata
-0001c6b0: 203d 205b 4e6f 6e65 5d2c 0a20 2020 2020   = [None],.     
-0001c6c0: 2020 2020 2020 2023 2066 6d74 3a20 6f6e         # fmt: on
-0001c6d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001c6e0: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-0001c6f0: 6d6f 756e 7453 6f75 7263 6573 2920 3e20  mountSources) > 
-0001c700: 313a 0a20 2020 2020 2020 2020 2020 2073  1:.            s
-0001c710: 656c 662e 5f62 7569 6c64 466f 6c64 6572  elf._buildFolder
-0001c720: 4361 6368 6528 290a 0a20 2020 2064 6566  Cache()..    def
-0001c730: 205f 6275 696c 6446 6f6c 6465 7243 6163   _buildFolderCac
-0001c740: 6865 2873 656c 662c 206d 6178 4465 7074  he(self, maxDept
-0001c750: 683d 3130 3234 2c20 6e4d 6178 4361 6368  h=1024, nMaxCach
-0001c760: 6553 697a 653d 3130 3030 3030 2c20 6e4d  eSize=100000, nM
-0001c770: 6178 5365 636f 6e64 7354 6f43 6163 6865  axSecondsToCache
-0001c780: 3d36 3029 3a0a 2020 2020 2020 2020 2222  =60):.        ""
-0001c790: 220a 2020 2020 2020 2020 6e4d 6178 4361  ".        nMaxCa
-0001c7a0: 6368 6553 697a 653a 0a20 2020 2020 2020  cheSize:.       
-0001c7b0: 2020 2020 2045 7665 6e20 6173 7375 6d69       Even assumi
-0001c7c0: 6e67 2076 6572 7920 6c6f 6e67 2066 696c  ng very long fil
-0001c7d0: 6520 7061 7468 7320 6c69 6b65 2031 3030  e paths like 100
-0001c7e0: 3020 6368 6172 732c 2074 6865 2063 6163  0 chars, the cac
-0001c7f0: 6865 2073 697a 650a 2020 2020 2020 2020  he size.        
-0001c800: 2020 2020 7769 6c6c 2062 6520 6265 6c6f      will be belo
-0001c810: 7720 3130 3020 4d42 2069 6620 7468 6520  w 100 MB if the 
-0001c820: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
-0001c830: 6620 656c 656d 656e 7473 2069 7320 3130  f elements is 10
-0001c840: 306b 2e0a 2020 2020 2020 2020 6e4d 6178  0k..        nMax
-0001c850: 5365 636f 6e64 7354 6f43 6163 6865 3a0a  SecondsToCache:.
-0001c860: 2020 2020 2020 2020 2020 2020 416e 6f74              Anot
-0001c870: 6865 7220 7072 6f62 6c65 6d20 6973 2074  her problem is t
-0001c880: 6865 2073 6574 7570 2074 696d 652c 2061  he setup time, a
-0001c890: 7320 6974 206d 6967 6874 2074 616b 6520  s it might take 
-0001c8a0: 7e30 2e30 3031 7320 666f 7220 6561 6368  ~0.001s for each
-0001c8b0: 2067 6574 4669 6c65 496e 666f 2063 616c   getFileInfo cal
-0001c8c0: 6c0a 2020 2020 2020 2020 2020 2020 616e  l.            an
-0001c8d0: 6420 6974 2073 686f 756c 646e 2774 2074  d it shouldn't t
-0001c8e0: 616b 6520 6d69 6e75 7465 7321 204e 6f74  ake minutes! Not
-0001c8f0: 6520 7468 6174 2074 6865 7265 2061 6c77  e that there alw
-0001c900: 6179 7320 6361 6e20 6265 2061 6e20 6564  ays can be an ed
-0001c910: 6765 2063 6173 6520 7769 7468 2068 756e  ge case with hun
-0001c920: 6472 6564 0a20 2020 2020 2020 2020 2020  dred.           
-0001c930: 2074 686f 7573 616e 6473 206f 6620 6669   thousands of fi
-0001c940: 6c65 7320 696e 206f 6e65 2066 6f6c 6465  les in one folde
-0001c950: 722c 2077 6869 6368 2063 616e 2074 616b  r, which can tak
-0001c960: 6520 616e 2061 7262 6974 7261 7279 2061  e an arbitrary a
-0001c970: 6d6f 756e 7420 6f66 2074 696d 6520 746f  mount of time to
-0001c980: 2063 6163 6865 2e0a 2020 2020 2020 2020   cache..        
-0001c990: 2222 220a 2020 2020 2020 2020 7430 203d  """.        t0 =
-0001c9a0: 2074 696d 652e 7469 6d65 2829 0a0a 2020   time.time()..  
-0001c9b0: 2020 2020 2020 6966 2070 7269 6e74 4465        if printDe
-0001c9c0: 6275 6720 3e3d 2031 3a0a 2020 2020 2020  bug >= 1:.      
-0001c9d0: 2020 2020 2020 7072 696e 7428 6622 4275        print(f"Bu
-0001c9e0: 696c 6469 6e67 2063 6163 6865 2066 6f72  ilding cache for
-0001c9f0: 2075 6e69 6f6e 206d 6f75 6e74 2028 7469   union mount (ti
-0001ca00: 6d65 6f75 7420 6166 7465 7220 7b6e 4d61  meout after {nMa
-0001ca10: 7853 6563 6f6e 6473 546f 4361 6368 657d  xSecondsToCache}
-0001ca20: 7329 2e2e 2e22 290a 0a20 2020 2020 2020  s)...")..       
-0001ca30: 2073 656c 662e 666f 6c64 6572 4361 6368   self.folderCach
-0001ca40: 6520 3d20 7b22 2f22 3a20 7365 6c66 2e6d  e = {"/": self.m
-0001ca50: 6f75 6e74 536f 7572 6365 737d 0a0a 2020  ountSources}..  
-0001ca60: 2020 2020 2020 6c61 7374 466f 6c64 6572        lastFolder
-0001ca70: 4361 6368 653a 2044 6963 745b 7374 722c  Cache: Dict[str,
-0001ca80: 204c 6973 745b 4d6f 756e 7453 6f75 7263   List[MountSourc
-0001ca90: 655d 5d20 3d20 7b22 2f22 3a20 7365 6c66  e]] = {"/": self
-0001caa0: 2e6d 6f75 6e74 536f 7572 6365 737d 0a0a  .mountSources}..
-0001cab0: 2020 2020 2020 2020 666f 7220 6465 7074          for dept
-0001cac0: 6820 696e 2072 616e 6765 2831 2c20 6d61  h in range(1, ma
-0001cad0: 7844 6570 7468 293a 0a20 2020 2020 2020  xDepth):.       
-0001cae0: 2020 2020 2023 2054 6869 7320 696e 7465       # This inte
-0001caf0: 726d 6564 6961 7279 2073 7472 7563 7475  rmediary structu
-0001cb00: 7265 2069 7320 7573 6564 2062 6563 6175  re is used becau
-0001cb10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001cb20: 2320 2020 312e 2057 6520 6e65 6564 2074  #   1. We need t
-0001cb30: 6f20 6f6e 6c79 2069 7465 7261 7465 206f  o only iterate o
-0001cb40: 7665 7220 7468 6520 6e65 776c 7920 6164  ver the newly ad
-0001cb50: 6465 6420 666f 6c64 6572 7320 696e 2074  ded folders in t
-0001cb60: 6865 206e 6578 7420 7374 6570 0a20 2020  he next step.   
-0001cb70: 2020 2020 2020 2020 2023 2020 2032 2e20           #   2. 
-0001cb80: 5765 2061 6c77 6179 7320 7761 6e74 2074  We always want t
-0001cb90: 6f20 2861 746f 6d69 6361 6c6c 7929 206d  o (atomically) m
-0001cba0: 6572 6765 2072 6573 756c 7473 2066 6f72  erge results for
-0001cbb0: 206f 6e65 2066 6f6c 6465 7220 6465 7074   one folder dept
-0001cbc0: 6820 736f 2074 6861 7420 7765 2063 616e  h so that we can
-0001cbd0: 2062 6520 7375 7265 0a20 2020 2020 2020   be sure.       
-0001cbe0: 2020 2020 2023 2020 2020 2020 7468 6174       #      that
-0001cbf0: 2069 6620 6120 666f 6c64 6572 206f 6620   if a folder of 
-0001cc00: 6120 6361 6368 6564 2064 6570 7468 2063  a cached depth c
-0001cc10: 616e 206e 6f74 2062 6520 666f 756e 6420  an not be found 
-0001cc20: 696e 2074 6865 2063 6163 6865 2074 6861  in the cache tha
-0001cc30: 7420 6974 2064 6f65 7320 6e6f 7420 6578  t it does not ex
-0001cc40: 6973 7420 6174 2061 6c6c 2e0a 2020 2020  ist at all..    
-0001cc50: 2020 2020 2020 2020 6e65 7746 6f6c 6465          newFolde
-0001cc60: 7243 6163 6865 3a20 4469 6374 5b73 7472  rCache: Dict[str
-0001cc70: 2c20 4c69 7374 5b4d 6f75 6e74 536f 7572  , List[MountSour
-0001cc80: 6365 5d5d 203d 207b 7d0a 0a20 2020 2020  ce]] = {}..     
-0001cc90: 2020 2020 2020 2066 6f72 2066 6f6c 6465         for folde
-0001cca0: 722c 206d 6f75 6e74 536f 7572 6365 7320  r, mountSources 
-0001ccb0: 696e 206c 6173 7446 6f6c 6465 7243 6163  in lastFolderCac
-0001ccc0: 6865 2e69 7465 6d73 2829 3a0a 2020 2020  he.items():.    
-0001ccd0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001cce0: 6d6f 756e 7453 6f75 7263 6520 696e 206d  mountSource in m
-0001ccf0: 6f75 6e74 536f 7572 6365 733a 0a20 2020  ountSources:.   
-0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd10: 2066 696c 6573 496e 466f 6c64 6572 203d   filesInFolder =
-0001cd20: 206d 6f75 6e74 536f 7572 6365 2e6c 6973   mountSource.lis
-0001cd30: 7444 6972 2866 6f6c 6465 7229 0a20 2020  tDir(folder).   
-0001cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd50: 2069 6620 6e6f 7420 6669 6c65 7349 6e46   if not filesInF
-0001cd60: 6f6c 6465 723a 0a20 2020 2020 2020 2020  older:.         
-0001cd70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001cd80: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-0001cd90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001cda0: 2066 696c 6520 696e 2066 696c 6573 496e   file in filesIn
-0001cdb0: 466f 6c64 6572 3a0a 2020 2020 2020 2020  Folder:.        
-0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdd0: 6966 2074 696d 652e 7469 6d65 2829 202d  if time.time() -
-0001cde0: 2074 3020 3e20 6e4d 6178 5365 636f 6e64   t0 > nMaxSecond
-0001cdf0: 7354 6f43 6163 6865 206f 7220 6e4d 6178  sToCache or nMax
-0001ce00: 4361 6368 6553 697a 6520 3c3d 2030 3a0a  CacheSize <= 0:.
-0001ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001ce30: 726e 0a0a 2020 2020 2020 2020 2020 2020  rn..            
-0001ce40: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
-0001ce50: 5061 7468 203d 206f 732e 7061 7468 2e6a  Path = os.path.j
-0001ce60: 6f69 6e28 666f 6c64 6572 2c20 6669 6c65  oin(folder, file
-0001ce70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ce80: 2020 2020 2020 2020 2020 6669 6c65 496e            fileIn
-0001ce90: 666f 203d 206d 6f75 6e74 536f 7572 6365  fo = mountSource
-0001cea0: 2e67 6574 4669 6c65 496e 666f 2866 756c  .getFileInfo(ful
-0001ceb0: 6c50 6174 6829 0a20 2020 2020 2020 2020  lPath).         
-0001cec0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ced0: 6620 6e6f 7420 6669 6c65 496e 666f 206f  f not fileInfo o
-0001cee0: 7220 6e6f 7420 7374 6174 2e53 5f49 5344  r not stat.S_ISD
-0001cef0: 4952 2866 696c 6549 6e66 6f2e 6d6f 6465  IR(fileInfo.mode
-0001cf00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001cf10: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001cf20: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf40: 206e 4d61 7843 6163 6865 5369 7a65 202d   nMaxCacheSize -
-0001cf50: 3d20 310a 0a20 2020 2020 2020 2020 2020  = 1..           
-0001cf60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001cf70: 6675 6c6c 5061 7468 2069 6e20 6e65 7746  fullPath in newF
-0001cf80: 6f6c 6465 7243 6163 6865 3a0a 2020 2020  olderCache:.    
-0001cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfa0: 2020 2020 2020 2020 6e65 7746 6f6c 6465          newFolde
-0001cfb0: 7243 6163 6865 5b66 756c 6c50 6174 685d  rCache[fullPath]
-0001cfc0: 2e61 7070 656e 6428 6d6f 756e 7453 6f75  .append(mountSou
-0001cfd0: 7263 6529 0a20 2020 2020 2020 2020 2020  rce).           
-0001cfe0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001cff0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001d000: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001d010: 6577 466f 6c64 6572 4361 6368 655b 6675  ewFolderCache[fu
-0001d020: 6c6c 5061 7468 5d20 3d20 5b6d 6f75 6e74  llPath] = [mount
-0001d030: 536f 7572 6365 5d0a 0a20 2020 2020 2020  Source]..       
-0001d040: 2020 2020 2069 6620 6e6f 7420 6e65 7746       if not newF
-0001d050: 6f6c 6465 7243 6163 6865 3a0a 2020 2020  olderCache:.    
-0001d060: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0001d070: 6b0a 0a20 2020 2020 2020 2020 2020 2073  k..            s
-0001d080: 656c 662e 666f 6c64 6572 4361 6368 652e  elf.folderCache.
-0001d090: 7570 6461 7465 286e 6577 466f 6c64 6572  update(newFolder
-0001d0a0: 4361 6368 6529 0a20 2020 2020 2020 2020  Cache).         
-0001d0b0: 2020 2073 656c 662e 666f 6c64 6572 4361     self.folderCa
-0001d0c0: 6368 6544 6570 7468 203d 2064 6570 7468  cheDepth = depth
-0001d0d0: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-0001d0e0: 7446 6f6c 6465 7243 6163 6865 203d 206e  tFolderCache = n
-0001d0f0: 6577 466f 6c64 6572 4361 6368 650a 0a20  ewFolderCache.. 
-0001d100: 2020 2020 2020 2074 3120 3d20 7469 6d65         t1 = time
-0001d110: 2e74 696d 6528 290a 0a20 2020 2020 2020  .time()..       
-0001d120: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
-0001d130: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-0001d140: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-0001d150: 2020 2020 2020 2020 6622 4361 6368 6564          f"Cached
-0001d160: 206d 6f75 6e74 2073 6f75 7263 6573 2066   mount sources f
-0001d170: 6f72 207b 6c65 6e28 7365 6c66 2e66 6f6c  or {len(self.fol
-0001d180: 6465 7243 6163 6865 297d 2066 6f6c 6465  derCache)} folde
-0001d190: 7273 2075 7020 746f 2061 2064 6570 7468  rs up to a depth
-0001d1a0: 206f 6620 220a 2020 2020 2020 2020 2020   of ".          
-0001d1b0: 2020 2020 2020 6622 7b73 656c 662e 666f        f"{self.fo
-0001d1c0: 6c64 6572 4361 6368 6544 6570 7468 7d20  lderCacheDepth} 
-0001d1d0: 696e 207b 7431 2d74 303a 2e33 7d73 2066  in {t1-t0:.3}s f
-0001d1e0: 6f72 2066 6173 7465 7220 756e 696f 6e20  or faster union 
-0001d1f0: 6d6f 756e 742e 220a 2020 2020 2020 2020  mount.".        
-0001d200: 2020 2020 290a 0a20 2020 2040 6f76 6572      )..    @over
-0001d210: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
-0001d220: 6529 0a20 2020 2064 6566 2067 6574 4669  e).    def getFi
-0001d230: 6c65 496e 666f 2873 656c 662c 2070 6174  leInfo(self, pat
-0001d240: 683a 2073 7472 2c20 6669 6c65 5665 7273  h: str, fileVers
-0001d250: 696f 6e3a 2069 6e74 203d 2030 2920 2d3e  ion: int = 0) ->
-0001d260: 204f 7074 696f 6e61 6c5b 4669 6c65 496e   Optional[FileIn
-0001d270: 666f 5d3a 0a20 2020 2020 2020 2069 6620  fo]:.        if 
-0001d280: 7061 7468 203d 3d20 272f 273a 0a20 2020  path == '/':.   
-0001d290: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001d2a0: 7365 6c66 2e72 6f6f 7446 696c 6549 6e66  self.rootFileInf
-0001d2b0: 6f0a 0a20 2020 2020 2020 2069 6620 7061  o..        if pa
-0001d2c0: 7468 2069 6e20 7365 6c66 2e66 6f6c 6465  th in self.folde
-0001d2d0: 7243 6163 6865 3a0a 2020 2020 2020 2020  rCache:.        
-0001d2e0: 2020 2020 2320 5468 6973 2063 6173 6520      # This case 
-0001d2f0: 6d69 6768 7420 6265 2074 7269 6767 6572  might be trigger
-0001d300: 6564 2077 6865 6e20 7061 7468 2069 7320  ed when path is 
-0001d310: 6120 666f 6c64 6572 0a20 2020 2020 2020  a folder.       
-0001d320: 2020 2020 206d 6f75 6e74 536f 7572 6365       mountSource
-0001d330: 7320 3d20 7365 6c66 2e66 6f6c 6465 7243  s = self.folderC
-0001d340: 6163 6865 5b70 6174 685d 0a20 2020 2020  ache[path].     
-0001d350: 2020 2065 6c69 6620 7365 6c66 2e66 6f6c     elif self.fol
-0001d360: 6465 7243 6163 6865 2061 6e64 2073 656c  derCache and sel
-0001d370: 662e 666f 6c64 6572 4361 6368 6544 6570  f.folderCacheDep
-0001d380: 7468 203e 2030 2061 6e64 2070 6174 682e  th > 0 and path.
-0001d390: 7374 6172 7473 7769 7468 2827 2f27 293a  startswith('/'):
-0001d3a0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0001d3b0: 6869 7320 7368 6f75 6c64 2062 6520 7468  his should be th
-0001d3c0: 6520 6d6f 7374 2063 6f6d 6d6f 6e20 6361  e most common ca
-0001d3d0: 7365 2c20 692e 652e 2c20 666f 7220 7265  se, i.e., for re
-0001d3e0: 6775 6c61 7220 6669 6c65 732e 204c 6f6f  gular files. Loo
-0001d3f0: 6b20 7570 2074 6865 2070 6172 656e 7420  k up the parent 
-0001d400: 666f 6c64 6572 2069 6e20 7468 6973 2063  folder in this c
-0001d410: 6173 652e 0a20 2020 2020 2020 2020 2020  ase..           
-0001d420: 2070 6172 656e 7446 6f6c 6465 7220 3d20   parentFolder = 
-0001d430: 272f 272e 6a6f 696e 2870 6174 682e 7370  '/'.join(path.sp
-0001d440: 6c69 7428 272f 272c 2073 656c 662e 666f  lit('/', self.fo
-0001d450: 6c64 6572 4361 6368 6544 6570 7468 202b  lderCacheDepth +
-0001d460: 2031 295b 3a2d 315d 290a 2020 2020 2020   1)[:-1]).      
-0001d470: 2020 2020 2020 6966 2070 6172 656e 7446        if parentF
-0001d480: 6f6c 6465 7220 6e6f 7420 696e 2073 656c  older not in sel
-0001d490: 662e 666f 6c64 6572 4361 6368 653a 0a20  f.folderCache:. 
-0001d4a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001d4b0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-0001d4c0: 2020 2020 2020 206d 6f75 6e74 536f 7572         mountSour
-0001d4d0: 6365 7320 3d20 7365 6c66 2e66 6f6c 6465  ces = self.folde
-0001d4e0: 7243 6163 6865 5b70 6172 656e 7446 6f6c  rCache[parentFol
-0001d4f0: 6465 725d 0a20 2020 2020 2020 2065 6c73  der].        els
-0001d500: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
-0001d510: 6f75 6e74 536f 7572 6365 7320 3d20 7365  ountSources = se
-0001d520: 6c66 2e6d 6f75 6e74 536f 7572 6365 730a  lf.mountSources.
-0001d530: 0a20 2020 2020 2020 2023 2057 6520 6e65  .        # We ne
-0001d540: 6564 2074 6f20 6b65 6570 2074 6865 2073  ed to keep the s
-0001d550: 6967 6e20 6f66 2074 6865 2066 696c 6556  ign of the fileV
-0001d560: 6572 7369 6f6e 2069 6e20 6f72 6465 7220  ersion in order 
-0001d570: 746f 2066 6f72 7761 7264 2069 7420 746f  to forward it to
-0001d580: 2053 514c 6974 6549 6e64 6578 6564 5461   SQLiteIndexedTa
-0001d590: 722e 0a20 2020 2020 2020 2023 2057 6865  r..        # Whe
-0001d5a0: 6e20 7468 6520 7265 7175 6573 7465 6420  n the requested 
-0001d5b0: 7665 7273 696f 6e20 6361 6e27 7420 6265  version can't be
-0001d5c0: 2066 6f75 6e64 2069 6e20 6120 6d6f 756e   found in a moun
-0001d5d0: 7420 736f 7572 6365 2c20 696e 6372 656d  t source, increm
-0001d5e0: 656e 7420 6e65 6761 7469 7665 2073 7065  ent negative spe
-0001d5f0: 6369 6669 6564 2076 6572 7369 6f6e 730a  cified versions.
-0001d600: 2020 2020 2020 2020 2320 6279 2074 6865          # by the
-0001d610: 2061 6d6f 756e 7420 6f66 2076 6572 7369   amount of versi
-0001d620: 6f6e 7320 696e 2074 6861 7420 6d6f 756e  ons in that moun
-0001d630: 7420 736f 7572 6365 206f 7220 6465 6372  t source or decr
-0001d640: 656d 656e 7420 7468 6520 696e 6974 6961  ement the initia
-0001d650: 6c6c 7920 706f 7369 7469 7665 2076 6572  lly positive ver
-0001d660: 7369 6f6e 2e0a 2020 2020 2020 2020 6966  sion..        if
-0001d670: 2066 696c 6556 6572 7369 6f6e 203c 3d20   fileVersion <= 
-0001d680: 303a 0a20 2020 2020 2020 2020 2020 2066  0:.            f
-0001d690: 6f72 206d 6f75 6e74 536f 7572 6365 2069  or mountSource i
-0001d6a0: 6e20 7265 7665 7273 6564 286d 6f75 6e74  n reversed(mount
-0001d6b0: 536f 7572 6365 7329 3a0a 2020 2020 2020  Sources):.      
-0001d6c0: 2020 2020 2020 2020 2020 6669 6c65 496e            fileIn
-0001d6d0: 666f 203d 206d 6f75 6e74 536f 7572 6365  fo = mountSource
-0001d6e0: 2e67 6574 4669 6c65 496e 666f 2870 6174  .getFileInfo(pat
-0001d6f0: 682c 2066 696c 6556 6572 7369 6f6e 3d66  h, fileVersion=f
-0001d700: 696c 6556 6572 7369 6f6e 290a 2020 2020  ileVersion).    
-0001d710: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0001d720: 7369 6e73 7461 6e63 6528 6669 6c65 496e  sinstance(fileIn
-0001d730: 666f 2c20 4669 6c65 496e 666f 293a 0a20  fo, FileInfo):. 
-0001d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d750: 2020 2066 696c 6549 6e66 6f2e 7573 6572     fileInfo.user
-0001d760: 6461 7461 2e61 7070 656e 6428 6d6f 756e  data.append(moun
-0001d770: 7453 6f75 7263 6529 0a20 2020 2020 2020  tSource).       
-0001d780: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001d790: 7572 6e20 6669 6c65 496e 666f 0a20 2020  urn fileInfo.   
-0001d7a0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0001d7b0: 6556 6572 7369 6f6e 202b 3d20 6d6f 756e  eVersion += moun
-0001d7c0: 7453 6f75 7263 652e 6669 6c65 5665 7273  tSource.fileVers
-0001d7d0: 696f 6e73 2870 6174 6829 0a20 2020 2020  ions(path).     
-0001d7e0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-0001d7f0: 6c65 5665 7273 696f 6e20 3e20 303a 0a20  leVersion > 0:. 
-0001d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d810: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
-0001d820: 2020 656c 7365 3a20 2023 2066 696c 6556    else:  # fileV
-0001d830: 6572 7369 6f6e 203e 3d20 310a 2020 2020  ersion >= 1.    
-0001d840: 2020 2020 2020 2020 666f 7220 6d6f 756e          for moun
-0001d850: 7453 6f75 7263 6520 696e 206d 6f75 6e74  tSource in mount
-0001d860: 536f 7572 6365 733a 0a20 2020 2020 2020  Sources:.       
-0001d870: 2020 2020 2020 2020 2066 696c 6549 6e66           fileInf
-0001d880: 6f20 3d20 6d6f 756e 7453 6f75 7263 652e  o = mountSource.
-0001d890: 6765 7446 696c 6549 6e66 6f28 7061 7468  getFileInfo(path
-0001d8a0: 2c20 6669 6c65 5665 7273 696f 6e3d 6669  , fileVersion=fi
-0001d8b0: 6c65 5665 7273 696f 6e29 0a20 2020 2020  leVersion).     
-0001d8c0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0001d8d0: 696e 7374 616e 6365 2866 696c 6549 6e66  instance(fileInf
-0001d8e0: 6f2c 2046 696c 6549 6e66 6f29 3a0a 2020  o, FileInfo):.  
-0001d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d900: 2020 6669 6c65 496e 666f 2e75 7365 7264    fileInfo.userd
-0001d910: 6174 612e 6170 7065 6e64 286d 6f75 6e74  ata.append(mount
-0001d920: 536f 7572 6365 290a 2020 2020 2020 2020  Source).        
-0001d930: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001d940: 726e 2066 696c 6549 6e66 6f0a 2020 2020  rn fileInfo.    
-0001d950: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0001d960: 5665 7273 696f 6e20 2d3d 206d 6f75 6e74  Version -= mount
-0001d970: 536f 7572 6365 2e66 696c 6556 6572 7369  Source.fileVersi
-0001d980: 6f6e 7328 7061 7468 290a 2020 2020 2020  ons(path).      
-0001d990: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-0001d9a0: 6556 6572 7369 6f6e 203c 2031 3a0a 2020  eVersion < 1:.  
-0001d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9c0: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
-0001d9d0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
-0001d9e0: 2020 406f 7665 7272 6964 6573 284d 6f75    @overrides(Mou
-0001d9f0: 6e74 536f 7572 6365 290a 2020 2020 6465  ntSource).    de
-0001da00: 6620 6669 6c65 5665 7273 696f 6e73 2873  f fileVersions(s
-0001da10: 656c 662c 2070 6174 683a 2073 7472 2920  elf, path: str) 
-0001da20: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-0001da30: 7265 7475 726e 2073 756d 286d 6f75 6e74  return sum(mount
-0001da40: 536f 7572 6365 2e66 696c 6556 6572 7369  Source.fileVersi
-0001da50: 6f6e 7328 7061 7468 2920 666f 7220 6d6f  ons(path) for mo
-0001da60: 756e 7453 6f75 7263 6520 696e 2073 656c  untSource in sel
-0001da70: 662e 6d6f 756e 7453 6f75 7263 6573 290a  f.mountSources).
-0001da80: 0a20 2020 2040 6f76 6572 7269 6465 7328  .    @overrides(
-0001da90: 4d6f 756e 7453 6f75 7263 6529 0a20 2020  MountSource).   
-0001daa0: 2064 6566 206c 6973 7444 6972 2873 656c   def listDir(sel
-0001dab0: 662c 2070 6174 683a 2073 7472 2920 2d3e  f, path: str) ->
-0001dac0: 204f 7074 696f 6e61 6c5b 4974 6572 6162   Optional[Iterab
-0001dad0: 6c65 5b73 7472 5d5d 3a0a 2020 2020 2020  le[str]]:.      
-0001dae0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0001daf0: 7475 726e 7320 7468 6520 7365 7420 6f66  turns the set of
-0001db00: 2061 6c6c 2066 6f6c 6465 7220 636f 6e74   all folder cont
-0001db10: 656e 7473 206f 7665 7220 616c 6c20 6d6f  ents over all mo
-0001db20: 756e 7420 736f 7572 6365 7320 6f72 204e  unt sources or N
-0001db30: 6f6e 6520 6966 2074 6865 2070 6174 6820  one if the path 
-0001db40: 7761 7320 666f 756e 6420 696e 206e 6f6e  was found in non
-0001db50: 6520 6f66 2074 6865 6d2e 0a20 2020 2020  e of them..     
-0001db60: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0001db70: 6669 6c65 733a 2053 6574 5b73 7472 5d20  files: Set[str] 
-0001db80: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
-0001db90: 666f 6c64 6572 4578 6973 7473 203d 2046  folderExists = F
-0001dba0: 616c 7365 0a0a 2020 2020 2020 2020 666f  alse..        fo
-0001dbb0: 7220 6d6f 756e 7453 6f75 7263 6520 696e  r mountSource in
-0001dbc0: 2073 656c 662e 6d6f 756e 7453 6f75 7263   self.mountSourc
-0001dbd0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001dbe0: 7265 7375 6c74 203d 206d 6f75 6e74 536f  result = mountSo
-0001dbf0: 7572 6365 2e6c 6973 7444 6972 2870 6174  urce.listDir(pat
-0001dc00: 6829 0a20 2020 2020 2020 2020 2020 2069  h).            i
-0001dc10: 6620 7265 7375 6c74 2069 7320 6e6f 7420  f result is not 
-0001dc20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001dc30: 2020 2020 2020 6669 6c65 7320 3d20 6669        files = fi
-0001dc40: 6c65 732e 756e 696f 6e28 7265 7375 6c74  les.union(result
-0001dc50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001dc60: 2020 666f 6c64 6572 4578 6973 7473 203d    folderExists =
-0001dc70: 2054 7275 650a 0a20 2020 2020 2020 2072   True..        r
-0001dc80: 6574 7572 6e20 6669 6c65 7320 6966 2066  eturn files if f
-0001dc90: 6f6c 6465 7245 7869 7374 7320 656c 7365  olderExists else
-0001dca0: 204e 6f6e 650a 0a20 2020 2040 6f76 6572   None..    @over
-0001dcb0: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
-0001dcc0: 6529 0a20 2020 2064 6566 206f 7065 6e28  e).    def open(
-0001dcd0: 7365 6c66 2c20 6669 6c65 496e 666f 3a20  self, fileInfo: 
-0001dce0: 4669 6c65 496e 666f 2920 2d3e 2049 4f5b  FileInfo) -> IO[
-0001dcf0: 6279 7465 735d 3a0a 2020 2020 2020 2020  bytes]:.        
-0001dd00: 6d6f 756e 7453 6f75 7263 6520 3d20 6669  mountSource = fi
-0001dd10: 6c65 496e 666f 2e75 7365 7264 6174 612e  leInfo.userdata.
-0001dd20: 706f 7028 290a 2020 2020 2020 2020 7472  pop().        tr
-0001dd30: 793a 0a20 2020 2020 2020 2020 2020 2061  y:.            a
-0001dd40: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-0001dd50: 286d 6f75 6e74 536f 7572 6365 2c20 4d6f  (mountSource, Mo
-0001dd60: 756e 7453 6f75 7263 6529 0a20 2020 2020  untSource).     
-0001dd70: 2020 2020 2020 2072 6574 7572 6e20 6d6f         return mo
-0001dd80: 756e 7453 6f75 7263 652e 6f70 656e 2866  untSource.open(f
-0001dd90: 696c 6549 6e66 6f29 0a20 2020 2020 2020  ileInfo).       
-0001dda0: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-0001ddb0: 2020 2020 2020 6669 6c65 496e 666f 2e75        fileInfo.u
-0001ddc0: 7365 7264 6174 612e 6170 7065 6e64 286d  serdata.append(m
-0001ddd0: 6f75 6e74 536f 7572 6365 290a 0a20 2020  ountSource)..   
-0001dde0: 2040 6f76 6572 7269 6465 7328 4d6f 756e   @overrides(Moun
-0001ddf0: 7453 6f75 7263 6529 0a20 2020 2064 6566  tSource).    def
-0001de00: 2072 6561 6428 7365 6c66 2c20 6669 6c65   read(self, file
-0001de10: 496e 666f 3a20 4669 6c65 496e 666f 2c20  Info: FileInfo, 
-0001de20: 7369 7a65 3a20 696e 742c 206f 6666 7365  size: int, offse
-0001de30: 743a 2069 6e74 2920 2d3e 2062 7974 6573  t: int) -> bytes
-0001de40: 3a0a 2020 2020 2020 2020 6d6f 756e 7453  :.        mountS
-0001de50: 6f75 7263 6520 3d20 6669 6c65 496e 666f  ource = fileInfo
-0001de60: 2e75 7365 7264 6174 612e 706f 7028 290a  .userdata.pop().
-0001de70: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001de80: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0001de90: 6973 696e 7374 616e 6365 286d 6f75 6e74  isinstance(mount
-0001dea0: 536f 7572 6365 2c20 4d6f 756e 7453 6f75  Source, MountSou
-0001deb0: 7263 6529 0a20 2020 2020 2020 2020 2020  rce).           
-0001dec0: 2072 6574 7572 6e20 6d6f 756e 7453 6f75   return mountSou
-0001ded0: 7263 652e 7265 6164 2866 696c 6549 6e66  rce.read(fileInf
-0001dee0: 6f2c 2073 697a 652c 206f 6666 7365 7429  o, size, offset)
-0001def0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-0001df00: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
-0001df10: 6c65 496e 666f 2e75 7365 7264 6174 612e  leInfo.userdata.
-0001df20: 6170 7065 6e64 286d 6f75 6e74 536f 7572  append(mountSour
-0001df30: 6365 290a 0a20 2020 2040 6f76 6572 7269  ce)..    @overri
-0001df40: 6465 7328 4d6f 756e 7453 6f75 7263 6529  des(MountSource)
-0001df50: 0a20 2020 2064 6566 2067 6574 4d6f 756e  .    def getMoun
-0001df60: 7453 6f75 7263 6528 7365 6c66 2c20 6669  tSource(self, fi
-0001df70: 6c65 496e 666f 3a20 4669 6c65 496e 666f  leInfo: FileInfo
-0001df80: 2920 2d3e 2054 7570 6c65 5b73 7472 2c20  ) -> Tuple[str, 
-0001df90: 4d6f 756e 7453 6f75 7263 652c 2046 696c  MountSource, Fil
-0001dfa0: 6549 6e66 6f5d 3a0a 2020 2020 2020 2020  eInfo]:.        
-0001dfb0: 736f 7572 6365 4669 6c65 496e 666f 203d  sourceFileInfo =
-0001dfc0: 2066 696c 6549 6e66 6f2e 636c 6f6e 6528   fileInfo.clone(
-0001dfd0: 290a 2020 2020 2020 2020 6d6f 756e 7453  ).        mountS
-0001dfe0: 6f75 7263 6520 3d20 736f 7572 6365 4669  ource = sourceFi
-0001dff0: 6c65 496e 666f 2e75 7365 7264 6174 612e  leInfo.userdata.
-0001e000: 706f 7028 290a 0a20 2020 2020 2020 2069  pop()..        i
-0001e010: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0001e020: 286d 6f75 6e74 536f 7572 6365 2c20 4d6f  (mountSource, Mo
-0001e030: 756e 7453 6f75 7263 6529 3a0a 2020 2020  untSource):.    
-0001e040: 2020 2020 2020 2020 7265 7475 726e 2027          return '
-0001e050: 2f27 2c20 7365 6c66 2c20 6669 6c65 496e  /', self, fileIn
-0001e060: 666f 0a0a 2020 2020 2020 2020 2320 4265  fo..        # Be
-0001e070: 6361 7573 6520 616c 6c20 6d6f 756e 7420  cause all mount 
-0001e080: 736f 7572 6365 7320 6172 6520 6d6f 756e  sources are moun
-0001e090: 7465 6420 6174 2027 2f27 2c20 7765 2064  ted at '/', we d
-0001e0a0: 6f20 6e6f 7420 6861 7665 2074 6f20 6170  o not have to ap
-0001e0b0: 7065 6e64 0a20 2020 2020 2020 2023 2074  pend.        # t
-0001e0c0: 6865 206d 6f75 6e74 2070 6f69 6e74 2070  he mount point p
-0001e0d0: 6174 6820 7265 7475 726e 6564 2062 7920  ath returned by 
-0001e0e0: 6765 744d 6f75 6e74 536f 7572 6365 2074  getMountSource t
-0001e0f0: 6f20 7468 6520 6d6f 756e 7420 706f 696e  o the mount poin
-0001e100: 7420 272f 272e 0a20 2020 2020 2020 2072  t '/'..        r
-0001e110: 6574 7572 6e20 6d6f 756e 7453 6f75 7263  eturn mountSourc
-0001e120: 652e 6765 744d 6f75 6e74 536f 7572 6365  e.getMountSource
-0001e130: 2873 6f75 7263 6546 696c 6549 6e66 6f29  (sourceFileInfo)
-0001e140: 0a0a 0a63 6c61 7373 2046 696c 6556 6572  ...class FileVer
-0001e150: 7369 6f6e 4c61 7965 7228 4d6f 756e 7453  sionLayer(MountS
-0001e160: 6f75 7263 6529 3a0a 2020 2020 2222 220a  ource):.    """.
-0001e170: 2020 2020 5468 6973 2062 696e 6420 6d6f      This bind mo
-0001e180: 756e 7420 6c69 6b65 206c 6179 6572 206d  unt like layer m
-0001e190: 616b 6573 2069 7420 706f 7373 6962 6c65  akes it possible
-0001e1a0: 2074 6f20 6163 6365 7373 206f 6c64 6572   to access older
-0001e1b0: 2066 696c 6520 7665 7273 696f 6e73 2069   file versions i
-0001e1c0: 6620 7468 6572 6520 6d75 6c74 6970 6c65  f there multiple
-0001e1d0: 206f 6e65 7320 696e 2074 6865 2067 6976   ones in the giv
-0001e1e0: 656e 0a20 2020 206d 6f75 6e74 2073 6f75  en.    mount sou
-0001e1f0: 7263 652e 2054 6865 2069 6e74 6572 6661  rce. The interfa
-0001e200: 6365 2070 726f 7669 6465 7320 666f 7220  ce provides for 
-0001e210: 6561 6368 2066 696c 6520 3c66 696c 6520  each file <file 
-0001e220: 7061 7468 3e20 6120 6869 6464 656e 2066  path> a hidden f
-0001e230: 6f6c 6465 7220 3c66 696c 6520 7061 7468  older <file path
-0001e240: 2e76 6572 7369 6f6e 733e 2063 6f6e 7461  .versions> conta
-0001e250: 696e 696e 670a 2020 2020 616c 6c20 6176  ining.    all av
-0001e260: 6169 6c61 626c 6520 7665 7273 696f 6e73  ailable versions
-0001e270: 2e0a 0a20 2020 2054 6869 7320 636c 6173  ...    This clas
-0001e280: 7320 616c 736f 2072 6573 6f6c 7665 7320  s also resolves 
-0001e290: 6861 7264 6c69 6e6b 732e 2054 6869 7320  hardlinks. This 
-0001e2a0: 6675 6e63 7469 6f6e 616c 6974 7920 6973  functionality is
-0001e2b0: 206d 6978 6564 2069 6e20 6865 7265 2062   mixed in here b
-0001e2c0: 6563 6175 7365 2073 656c 662d 7265 6665  ecause self-refe
-0001e2d0: 7265 6e63 696e 6720 6861 7264 6c69 6e6b  rencing hardlink
-0001e2e0: 730a 2020 2020 7368 6f75 6c64 2062 6520  s.    should be 
-0001e2f0: 7265 736f 6c76 6564 2062 7920 7368 6f77  resolved by show
-0001e300: 696e 6720 6f6c 6465 7220 7665 7273 696f  ing older versio
-0001e310: 6e73 206f 6620 6120 6669 6c65 2061 6e64  ns of a file and
-0001e320: 206f 6e6c 7920 7468 6973 206c 6179 6572   only this layer
-0001e330: 206b 6e6f 7773 2061 626f 7574 2066 696c   knows about fil
-0001e340: 6520 7665 7273 696f 6e69 6e67 2e0a 0a20  e versioning... 
-0001e350: 2020 2054 4f44 4f20 4966 2074 6865 7265     TODO If there
-0001e360: 2061 6c72 6561 6479 2065 7869 7374 7320   already exists 
-0001e370: 6120 6669 6c65 203c 6669 6c65 2070 6174  a file <file pat
-0001e380: 682e 7665 7273 696f 6e73 3e20 7468 656e  h.versions> then
-0001e390: 2074 6869 7320 7370 6563 6961 6c20 666f   this special fo
-0001e3a0: 6c64 6572 2077 696c 6c20 6e6f 7420 6265  lder will not be
-0001e3b0: 2061 7661 696c 6162 6c65 210a 2020 2020   available!.    
-0001e3c0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-0001e3d0: 6e69 745f 5f28 7365 6c66 2c20 6d6f 756e  nit__(self, moun
-0001e3e0: 7453 6f75 7263 653a 204d 6f75 6e74 536f  tSource: MountSo
-0001e3f0: 7572 6365 293a 0a20 2020 2020 2020 2073  urce):.        s
-0001e400: 656c 662e 6d6f 756e 7453 6f75 7263 653a  elf.mountSource:
-0001e410: 204d 6f75 6e74 536f 7572 6365 203d 206d   MountSource = m
-0001e420: 6f75 6e74 536f 7572 6365 0a0a 2020 2020  ountSource..    
-0001e430: 6465 6620 5f64 6563 6f64 6556 6572 7369  def _decodeVersi
-0001e440: 6f6e 7350 6174 6841 5049 2873 656c 662c  onsPathAPI(self,
-0001e450: 2066 696c 6550 6174 683a 2073 7472 2920   filePath: str) 
-0001e460: 2d3e 204f 7074 696f 6e61 6c5b 5475 706c  -> Optional[Tupl
-0001e470: 655b 7374 722c 2062 6f6f 6c2c 2069 6e74  e[str, bool, int
-0001e480: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
-0001e490: 2020 2020 2020 2020 446f 2061 206c 6f6f          Do a loo
-0001e4a0: 7020 6f76 6572 2074 6865 2070 6172 656e  p over the paren
-0001e4b0: 7420 7061 7468 2070 6172 7473 2074 6f20  t path parts to 
-0001e4c0: 7265 736f 6c76 6520 706f 7373 6962 6c65  resolve possible
-0001e4d0: 2076 6572 7369 6f6e 7320 696e 2070 6172   versions in par
-0001e4e0: 656e 7420 666f 6c64 6572 732e 0a20 2020  ent folders..   
-0001e4f0: 2020 2020 204e 6f74 6520 7468 6174 206d       Note that m
-0001e500: 756c 7469 706c 6520 7665 7273 696f 6e73  ultiple versions
-0001e510: 206f 6620 6120 666f 6c64 6572 2061 6c77   of a folder alw
-0001e520: 6179 7320 6172 6520 756e 696f 6e20 6d6f  ays are union mo
-0001e530: 756e 7465 642e 2053 6f2c 2066 6f72 2074  unted. So, for t
-0001e540: 6865 2070 6174 6820 746f 2061 2066 696c  he path to a fil
-0001e550: 650a 2020 2020 2020 2020 696e 7369 6465  e.        inside
-0001e560: 2074 686f 7365 2066 6f6c 6465 7273 2074   those folders t
-0001e570: 6865 2065 7861 6374 2076 6572 7369 6f6e  he exact version
-0001e580: 206f 6620 6120 7061 7265 6e74 2066 6f6c   of a parent fol
-0001e590: 6465 7220 6361 6e20 7369 6d70 6c79 2062  der can simply b
-0001e5a0: 6520 7265 6d6f 7665 6420 666f 7220 6c6f  e removed for lo
-0001e5b0: 6f6b 7570 2e0a 2020 2020 2020 2020 5468  okup..        Th
-0001e5c0: 6572 6566 6f72 652c 2074 7261 6e73 6c61  erefore, transla
-0001e5d0: 7465 2073 6f6d 6574 6869 6e67 206c 696b  te something lik
-0001e5e0: 653a 202f 666f 6f2e 7665 7273 696f 6e2f  e: /foo.version/
-0001e5f0: 332f 6261 722e 7665 7273 696f 6e2f 322f  3/bar.version/2/
-0001e600: 6d69 6d69 2e76 6572 7369 6f6e 2f31 2069  mimi.version/1 i
-0001e610: 6e74 6f0a 2020 2020 2020 2020 2f66 6f6f  nto.        /foo
-0001e620: 2f62 6172 2f6d 696d 692e 7665 7273 696f  /bar/mimi.versio
-0001e630: 6e2f 310a 2020 2020 2020 2020 5468 6973  n/1.        This
-0001e640: 2069 7320 706f 7373 6962 6c79 2074 696d   is possibly tim
-0001e650: 652d 636f 7374 6c79 2062 7574 2072 6571  e-costly but req
-0001e660: 7565 7374 696e 6720 6120 6469 6666 6572  uesting a differ
-0001e670: 656e 7420 7665 7273 696f 6e20 6672 6f6d  ent version from
-0001e680: 2074 6865 206d 6f73 7420 7265 6365 6e74   the most recent
-0001e690: 2073 686f 756c 640a 2020 2020 2020 2020   should.        
-0001e6a0: 6265 2061 2072 6172 6520 6f63 6375 7265  be a rare occure
-0001e6b0: 6e63 6520 616e 6420 4655 5345 2061 6c73  nce and FUSE als
-0001e6c0: 6f20 6368 6563 6b73 2061 6c6c 2070 6172  o checks all par
-0001e6d0: 656e 7420 7061 7274 7320 6265 666f 7265  ent parts before
-0001e6e0: 2061 6363 6573 7369 6e67 2061 2066 696c   accessing a fil
-0001e6f0: 6520 736f 2069 740a 2020 2020 2020 2020  e so it.        
-0001e700: 6d69 6768 7420 6f6e 6c79 2073 6c6f 7720  might only slow 
-0001e710: 646f 776e 2061 6363 6573 7320 6279 2072  down access by r
-0001e720: 6f75 6768 6c79 2066 6163 746f 7220 322e  oughly factor 2.
-0001e730: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0001e740: 2020 2020 2020 2320 544f 444f 206d 616b        # TODO mak
-0001e750: 6520 6974 2077 6f72 6b20 666f 7220 6669  e it work for fi
-0001e760: 6c65 7320 656e 6469 6e67 2077 6974 6820  les ending with 
-0001e770: 272e 7665 7273 696f 6e73 272e 0a20 2020  '.versions'..   
-0001e780: 2020 2020 2023 2043 7572 7265 6e74 6c79       # Currently
-0001e790: 2c20 7468 6973 2066 6561 7475 7265 2077  , this feature w
-0001e7a0: 6f75 6c64 2062 6520 6869 6464 656e 2062  ould be hidden b
-0001e7b0: 7920 7468 6f73 6520 6669 6c65 732e 2042  y those files. B
-0001e7c0: 7574 2c20 4920 7468 696e 6b20 7468 6973  ut, I think this
-0001e7d0: 2073 686f 756c 6420 6265 2071 7569 7465   should be quite
-0001e7e0: 2072 6172 652e 0a20 2020 2020 2020 2023   rare..        #
-0001e7f0: 2049 2063 6f75 6c64 2061 6c6c 6f77 2061   I could allow a
-0001e800: 7262 6974 7261 7279 2061 6d6f 756e 7473  rbitrary amounts
-0001e810: 206f 6620 646f 7473 206c 696b 6520 272e   of dots like '.
-0001e820: 2e2e 2e76 6572 7369 6f6e 7327 2062 7574  ...versions' but
-0001e830: 2074 6865 6e20 6974 2077 6f75 6c64 6e27   then it wouldn'
-0001e840: 7420 6265 2064 6973 6365 726e 6962 6c65  t be discernible
-0001e850: 0a20 2020 2020 2020 2023 2066 6f72 202e  .        # for .
-0001e860: 2e2e 7665 7273 696f 6e73 2077 6865 7468  ..versions wheth
-0001e870: 6572 2074 6865 2076 6572 7369 6f6e 7320  er the versions 
-0001e880: 6f66 202e 2e76 6572 7369 6f6e 7320 6f72  of ..versions or
-0001e890: 202e 7665 7273 696f 6e73 2066 696c 6520   .versions file 
-0001e8a0: 7761 7320 7265 7175 6573 7465 642e 2049  was requested. I
-0001e8b0: 2063 6f75 6c64 2061 6464 0a20 2020 2020   could add.     
-0001e8c0: 2020 2023 2061 2072 756c 6520 666f 7220     # a rule for 
-0001e8d0: 7468 6520 6465 6369 7369 6f6e 2c20 6c69  the decision, li
-0001e8e0: 6b65 202e 2e2e 7665 7273 696f 6e73 2073  ke ...versions s
-0001e8f0: 686f 7773 2074 6865 2076 6572 7369 6f6e  hows the version
-0001e900: 7320 6f66 202e 7665 7273 696f 6e73 2061  s of .versions a
-0001e910: 6e64 202e 2e2e 2e76 6572 7369 6f6e 7320  nd ....versions 
-0001e920: 666f 720a 2020 2020 2020 2020 2320 2e2e  for.        # ..
-0001e930: 7665 7273 696f 6e73 2c20 686f 7765 7665  versions, howeve
-0001e940: 722c 2061 6c6c 206f 6620 7468 6973 206d  r, all of this m
-0001e950: 6967 6874 2072 6571 7569 7265 2061 6e20  ight require an 
-0001e960: 6177 6675 6c20 6c6f 7420 6f66 2066 696c  awful lot of fil
-0001e970: 6520 6578 6973 7465 6e63 6520 6368 6563  e existence chec
-0001e980: 6b69 6e67 2e0a 2020 2020 2020 2020 2320  king..        # 
-0001e990: 4d79 2066 6972 7374 2069 6465 6120 7761  My first idea wa
-0001e9a0: 7320 746f 2075 7365 2068 6964 6465 6e20  s to use hidden 
-0001e9b0: 7375 6266 6f6c 6465 7273 2066 6f72 2065  subfolders for e
-0001e9c0: 6163 6820 6669 6c65 206c 696b 6520 7061  ach file like pa
-0001e9d0: 7468 2f74 6f2f 6669 6c65 2f2e 7665 7273  th/to/file/.vers
-0001e9e0: 696f 6e73 2f31 2062 7574 2046 5553 450a  ions/1 but FUSE.
-0001e9f0: 2020 2020 2020 2020 2320 6368 6563 6b73          # checks
-0001ea00: 2074 6865 2070 6172 656e 7473 2069 6e20   the parents in 
-0001ea10: 6120 7061 7468 2074 6861 7420 7468 6579  a path that they
-0001ea20: 2061 7265 2064 6972 6563 746f 7269 6573   are directories
-0001ea30: 2066 6972 7374 2c20 736f 2067 6574 6174   first, so getat
-0001ea40: 7472 206f 7220 7265 6164 6469 7220 6973  tr or readdir is
-0001ea50: 206e 6f74 2065 7665 6e0a 2020 2020 2020   not even.      
-0001ea60: 2020 2320 6361 6c6c 6564 2066 6f72 2070    # called for p
-0001ea70: 6174 682f 746f 2f66 696c 652f 2e76 6572  ath/to/file/.ver
-0001ea80: 7369 6f6e 7320 6966 2070 6174 682f 746f  sions if path/to
-0001ea90: 2f66 696c 6520 6973 206e 6f74 2061 2064  /file is not a d
-0001eaa0: 6972 6563 746f 7279 2e0a 2020 2020 2020  irectory..      
-0001eab0: 2020 2320 416e 6f74 6865 7220 616c 7465    # Another alte
-0001eac0: 726e 6174 6976 6520 6d69 6768 7420 6265  rnative might be
-0001ead0: 206f 6e65 2068 6964 6465 6e20 666f 6c64   one hidden fold
-0001eae0: 6572 2061 7420 7468 6520 726f 6f74 2066  er at the root f
-0001eaf0: 6f72 2061 2070 6172 616c 6c65 6c20 6669  or a parallel fi
-0001eb00: 6c65 2074 7265 652c 206c 696b 650a 2020  le tree, like.  
-0001eb10: 2020 2020 2020 2320 2f2e 7665 7273 696f        # /.versio
-0001eb20: 6e73 2f70 6174 682f 746f 2f66 696c 652f  ns/path/to/file/
-0001eb30: 3320 6275 7420 7468 6174 2072 756e 7320  3 but that runs 
-0001eb40: 696e 746f 2073 696d 696c 6172 2070 726f  into similar pro
-0001eb50: 626c 656d 7320 7768 656e 2074 7279 696e  blems when tryin
-0001eb60: 6720 746f 2073 7065 6369 6679 2074 6865  g to specify the
-0001eb70: 2066 696c 650a 2020 2020 2020 2020 2320   file.        # 
-0001eb80: 7665 7273 696f 6e20 6f72 2069 6620 6120  version or if a 
-0001eb90: 2e76 6572 7369 6f6e 7320 726f 6f74 2064  .versions root d
-0001eba0: 6972 6563 746f 7279 2065 7869 7374 732e  irectory exists.
-0001ebb0: 0a0a 2020 2020 2020 2020 6669 6c65 5061  ..        filePa
-0001ebc0: 7468 5061 7274 7320 3d20 6669 6c65 5061  thParts = filePa
-0001ebd0: 7468 2e6c 7374 7269 7028 272f 2729 2e73  th.lstrip('/').s
-0001ebe0: 706c 6974 2827 2f27 290a 2020 2020 2020  plit('/').      
-0001ebf0: 2020 6669 6c65 5061 7468 203d 2027 270a    filePath = ''.
-0001ec00: 2020 2020 2020 2020 7061 7468 4973 5370          pathIsSp
-0001ec10: 6563 6961 6c56 6572 7369 6f6e 7346 6f6c  ecialVersionsFol
-0001ec20: 6465 7220 3d20 4661 6c73 650a 2020 2020  der = False.    
-0001ec30: 2020 2020 6669 6c65 5665 7273 696f 6e20      fileVersion 
-0001ec40: 3d20 4e6f 6e65 2020 2320 4e6f 7420 7661  = None  # Not va
-0001ec50: 6c69 6420 6966 204e 6f6e 6520 6f72 2070  lid if None or p
-0001ec60: 6172 656e 7449 7356 6572 7369 6f6e 7320  arentIsVersions 
-0001ec70: 6973 2054 7275 650a 2020 2020 2020 2020  is True.        
-0001ec80: 666f 7220 7061 7274 2069 6e20 6669 6c65  for part in file
-0001ec90: 5061 7468 5061 7274 733a 0a20 2020 2020  PathParts:.     
-0001eca0: 2020 2020 2020 2023 2053 6b69 7020 6f76         # Skip ov
-0001ecb0: 6572 2074 6865 2065 7861 6374 2076 6572  er the exact ver
-0001ecc0: 7369 6f6e 2073 7065 6369 6669 6564 0a20  sion specified. 
-0001ecd0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-0001ece0: 7468 4973 5370 6563 6961 6c56 6572 7369  thIsSpecialVersi
-0001ecf0: 6f6e 7346 6f6c 6465 723a 0a20 2020 2020  onsFolder:.     
-0001ed00: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0001ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed20: 2020 2020 6669 6c65 5665 7273 696f 6e20      fileVersion 
-0001ed30: 3d20 696e 7428 7061 7274 290a 2020 2020  = int(part).    
-0001ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed50: 6173 7365 7274 2073 7472 2866 696c 6556  assert str(fileV
-0001ed60: 6572 7369 6f6e 2920 3d3d 2070 6172 740a  ersion) == part.
-0001ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed80: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001ed90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001eda0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001edb0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001edc0: 2020 7061 7468 4973 5370 6563 6961 6c56    pathIsSpecialV
-0001edd0: 6572 7369 6f6e 7346 6f6c 6465 7220 3d20  ersionsFolder = 
-0001ede0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0001edf0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-0001ee00: 2020 2020 2020 2020 2020 2020 2320 5369              # Si
-0001ee10: 6d70 6c79 2061 7070 656e 6420 6e6f 726d  mply append norm
-0001ee20: 616c 2065 7869 7374 696e 6720 666f 6c64  al existing fold
-0001ee30: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
-0001ee40: 746d 7046 696c 6550 6174 6820 3d20 272f  tmpFilePath = '/
-0001ee50: 272e 6a6f 696e 285b 6669 6c65 5061 7468  '.join([filePath
-0001ee60: 2c20 7061 7274 5d29 0a20 2020 2020 2020  , part]).       
-0001ee70: 2020 2020 2069 6620 7365 6c66 2e6d 6f75       if self.mou
-0001ee80: 6e74 536f 7572 6365 2e67 6574 4669 6c65  ntSource.getFile
-0001ee90: 496e 666f 2874 6d70 4669 6c65 5061 7468  Info(tmpFilePath
-0001eea0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001eeb0: 2020 2066 696c 6550 6174 6820 3d20 746d     filePath = tm
-0001eec0: 7046 696c 6550 6174 680a 2020 2020 2020  pFilePath.      
-0001eed0: 2020 2020 2020 2020 2020 6669 6c65 5665            fileVe
-0001eee0: 7273 696f 6e20 3d20 300a 2020 2020 2020  rsion = 0.      
-0001eef0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001ef00: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-0001ef10: 2320 4966 2063 7572 7265 6e74 2070 6174  # If current pat
-0001ef20: 6820 646f 6573 206e 6f74 2065 7869 7374  h does not exist
-0001ef30: 2c20 6368 6563 6b20 6966 2069 7420 6973  , check if it is
-0001ef40: 2061 2073 7065 6369 616c 2076 6572 7369   a special versi
-0001ef50: 6f6e 7320 7061 7468 0a20 2020 2020 2020  ons path.       
-0001ef60: 2020 2020 2069 6620 7061 7274 2e65 6e64       if part.end
-0001ef70: 7377 6974 6828 272e 7665 7273 696f 6e73  swith('.versions
-0001ef80: 2729 2061 6e64 206c 656e 2870 6172 7429  ') and len(part)
-0001ef90: 203e 206c 656e 2827 2e76 6572 7369 6f6e   > len('.version
-0001efa0: 7327 293a 0a20 2020 2020 2020 2020 2020  s'):.           
-0001efb0: 2020 2020 2070 6174 6849 7353 7065 6369       pathIsSpeci
-0001efc0: 616c 5665 7273 696f 6e73 466f 6c64 6572  alVersionsFolder
-0001efd0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001efe0: 2020 2020 2020 2020 6669 6c65 5665 7273          fileVers
-0001eff0: 696f 6e20 3d20 300a 2020 2020 2020 2020  ion = 0.        
-0001f000: 2020 2020 2020 2020 6669 6c65 5061 7468          filePath
-0001f010: 203d 2074 6d70 4669 6c65 5061 7468 5b3a   = tmpFilePath[:
-0001f020: 202d 6c65 6e28 272e 7665 7273 696f 6e73   -len('.versions
-0001f030: 2729 5d0a 2020 2020 2020 2020 2020 2020  ')].            
-0001f040: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-0001f050: 2020 2020 2020 2020 2020 2320 5061 7265            # Pare
-0001f060: 6e74 2070 6174 6820 646f 6573 206e 6f74  nt path does not
-0001f070: 2065 7869 7374 2061 6e64 2069 7320 6e6f   exist and is no
-0001f080: 7420 6120 7665 7273 696f 6e73 2070 6174  t a versions pat
-0001f090: 682c 2073 6f20 616e 7920 7375 6270 6174  h, so any subpat
-0001f0a0: 6873 2061 6c73 6f20 776f 6e27 7420 6578  hs also won't ex
-0001f0b0: 6973 7420 6569 7468 6572 0a20 2020 2020  ist either.     
-0001f0c0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001f0d0: 6e65 0a0a 2020 2020 2020 2020 6966 2066  ne..        if f
-0001f0e0: 696c 6556 6572 7369 6f6e 2069 7320 4e6f  ileVersion is No
-0001f0f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001f100: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0001f110: 224e 6f20 6669 6c65 2076 6572 7369 6f6e  "No file version
-0001f120: 2066 6f75 6e64 2069 6e20 7370 6563 6961   found in specia
-0001f130: 6c20 7665 7273 696f 6e69 6e67 2070 6174  l versioning pat
-0001f140: 6820 7370 6563 6966 6963 6174 696f 6e21  h specification!
-0001f150: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
-0001f160: 726e 2066 696c 6550 6174 682c 2070 6174  rn filePath, pat
-0001f170: 6849 7353 7065 6369 616c 5665 7273 696f  hIsSpecialVersio
-0001f180: 6e73 466f 6c64 6572 2c20 2830 2069 6620  nsFolder, (0 if 
-0001f190: 7061 7468 4973 5370 6563 6961 6c56 6572  pathIsSpecialVer
-0001f1a0: 7369 6f6e 7346 6f6c 6465 7220 656c 7365  sionsFolder else
-0001f1b0: 2066 696c 6556 6572 7369 6f6e 290a 0a20   fileVersion).. 
-0001f1c0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-0001f1d0: 0a20 2020 2064 6566 205f 6973 4861 7264  .    def _isHard
-0001f1e0: 4c69 6e6b 2866 696c 6549 6e66 6f3a 2046  Link(fileInfo: F
-0001f1f0: 696c 6549 6e66 6f29 202d 3e20 626f 6f6c  ileInfo) -> bool
-0001f200: 3a0a 2020 2020 2020 2020 2320 4e6f 7465  :.        # Note
-0001f210: 2074 6861 7420 535f 4953 4c4e 4b20 6368   that S_ISLNK ch
-0001f220: 6563 6b73 2066 6f72 2073 796d 626f 6c69  ecks for symboli
-0001f230: 6320 6c69 6e6b 732e 2048 6172 646c 696e  c links. Hardlin
-0001f240: 6b73 2028 6174 206c 6561 7374 2066 726f  ks (at least fro
-0001f250: 6d20 7461 7266 696c 6529 0a20 2020 2020  m tarfile).     
-0001f260: 2020 2023 2072 6574 7572 6e20 6661 6c73     # return fals
-0001f270: 6520 666f 7220 535f 4953 4c4e 4b20 6275  e for S_ISLNK bu
-0001f280: 7420 7374 696c 6c20 6861 7665 2061 206c  t still have a l
-0001f290: 696e 6b6e 616d 6521 0a20 2020 2020 2020  inkname!.       
-0001f2a0: 2072 6574 7572 6e20 626f 6f6c 286e 6f74   return bool(not
-0001f2b0: 2073 7461 742e 535f 4953 5245 4728 6669   stat.S_ISREG(fi
-0001f2c0: 6c65 496e 666f 2e6d 6f64 6529 2061 6e64  leInfo.mode) and
-0001f2d0: 206e 6f74 2073 7461 742e 535f 4953 4c4e   not stat.S_ISLN
-0001f2e0: 4b28 6669 6c65 496e 666f 2e6d 6f64 6529  K(fileInfo.mode)
-0001f2f0: 2061 6e64 2066 696c 6549 6e66 6f2e 6c69   and fileInfo.li
-0001f300: 6e6b 6e61 6d65 290a 0a20 2020 2040 7374  nkname)..    @st
-0001f310: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-0001f320: 6566 205f 7265 736f 6c76 6548 6172 644c  ef _resolveHardL
-0001f330: 696e 6b73 286d 6f75 6e74 536f 7572 6365  inks(mountSource
-0001f340: 3a20 4d6f 756e 7453 6f75 7263 652c 2070  : MountSource, p
-0001f350: 6174 683a 2073 7472 2920 2d3e 204f 7074  ath: str) -> Opt
-0001f360: 696f 6e61 6c5b 4669 6c65 496e 666f 5d3a  ional[FileInfo]:
-0001f370: 0a20 2020 2020 2020 2022 2222 7061 7468  .        """path
-0001f380: 203a 2053 696d 706c 6520 7061 7468 2e20   : Simple path. 
-0001f390: 5368 6f75 6c64 2063 6f6e 7461 696e 206e  Should contain n
-0001f3a0: 6f20 7370 6563 6961 6c20 7665 7273 696f  o special versio
-0001f3b0: 6e69 6e67 2066 6f6c 6465 7273 2122 2222  ning folders!"""
-0001f3c0: 0a0a 2020 2020 2020 2020 6669 6c65 496e  ..        fileIn
-0001f3d0: 666f 203d 206d 6f75 6e74 536f 7572 6365  fo = mountSource
-0001f3e0: 2e67 6574 4669 6c65 496e 666f 2870 6174  .getFileInfo(pat
-0001f3f0: 6829 0a20 2020 2020 2020 2069 6620 6e6f  h).        if no
-0001f400: 7420 6669 6c65 496e 666f 3a0a 2020 2020  t fileInfo:.    
-0001f410: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001f420: 6f6e 650a 0a20 2020 2020 2020 2072 6573  one..        res
-0001f430: 6f6c 7665 6450 6174 6820 3d20 272f 2720  olvedPath = '/' 
-0001f440: 2b20 6669 6c65 496e 666f 2e6c 696e 6b6e  + fileInfo.linkn
-0001f450: 616d 652e 6c73 7472 6970 2827 2f27 2920  ame.lstrip('/') 
-0001f460: 6966 2046 696c 6556 6572 7369 6f6e 4c61  if FileVersionLa
-0001f470: 7965 722e 5f69 7348 6172 644c 696e 6b28  yer._isHardLink(
-0001f480: 6669 6c65 496e 666f 2920 656c 7365 204e  fileInfo) else N
-0001f490: 6f6e 650a 2020 2020 2020 2020 6669 6c65  one.        file
-0001f4a0: 5665 7273 696f 6e20 3d20 300a 2020 2020  Version = 0.    
-0001f4b0: 2020 2020 6861 7264 4c69 6e6b 436f 756e      hardLinkCoun
-0001f4c0: 7420 3d20 300a 0a20 2020 2020 2020 2077  t = 0..        w
-0001f4d0: 6869 6c65 2072 6573 6f6c 7665 6450 6174  hile resolvedPat
-0001f4e0: 6820 616e 6420 6861 7264 4c69 6e6b 436f  h and hardLinkCo
-0001f4f0: 756e 7420 3c20 3132 383a 2020 2320 466f  unt < 128:  # Fo
-0001f500: 7220 636f 6d70 6172 6973 6f6e 2c20 7468  r comparison, th
-0001f510: 6520 6d61 7869 6d75 6d20 7379 6d62 6f6c  e maximum symbol
-0001f520: 6963 206c 696e 6b20 6368 6169 6e20 696e  ic link chain in
-0001f530: 204c 696e 7578 2069 7320 3430 2e0a 2020   Linux is 40..  
-0001f540: 2020 2020 2020 2020 2020 2320 4c69 6e6b            # Link
-0001f550: 2074 6172 6765 7473 2061 7265 2072 656c   targets are rel
-0001f560: 6174 6976 6520 746f 2074 6865 206d 6f75  ative to the mou
-0001f570: 6e74 2073 6f75 7263 652e 2054 6861 7427  nt source. That'
-0001f580: 7320 7768 7920 7765 206e 6565 6420 7468  s why we need th
-0001f590: 6520 6d6f 756e 7420 706f 696e 7420 746f  e mount point to
-0001f5a0: 2067 6574 2074 6865 2066 756c 6c20 7061   get the full pa
-0001f5b0: 7468 0a20 2020 2020 2020 2020 2020 2023  th.            #
-0001f5c0: 2069 6e20 7265 7370 6563 7420 746f 2074   in respect to t
-0001f5d0: 6869 7320 6d6f 756e 7420 736f 7572 6365  his mount source
-0001f5e0: 2e20 416e 6420 7765 206d 7573 7420 6120  . And we must a 
-0001f5f0: 6669 6c65 2069 6e66 6f20 6f62 6a65 6374  file info object
-0001f600: 2066 6f72 2074 6869 7320 6d6f 756e 7420   for this mount 
-0001f610: 736f 7572 6365 2c20 736f 2077 6520 6861  source, so we ha
-0001f620: 7665 2074 6f0a 2020 2020 2020 2020 2020  ve to.          
-0001f630: 2020 2320 6765 7420 7468 6174 2075 7369    # get that usi
-0001f640: 6e67 2074 6865 2066 756c 6c20 7061 7468  ng the full path
-0001f650: 2069 6e73 7465 6164 206f 6620 6361 6c6c   instead of call
-0001f660: 696e 6720 6765 7446 696c 6549 6e66 6f20  ing getFileInfo 
-0001f670: 6f6e 2074 6865 2064 6565 7065 7374 206d  on the deepest m
-0001f680: 6f75 6e74 2073 6f75 7263 652e 0a20 2020  ount source..   
-0001f690: 2020 2020 2020 2020 206d 6f75 6e74 506f           mountPo
-0001f6a0: 696e 742c 205f 2c20 5f20 3d20 6d6f 756e  int, _, _ = moun
-0001f6b0: 7453 6f75 7263 652e 6765 744d 6f75 6e74  tSource.getMount
-0001f6c0: 536f 7572 6365 2866 696c 6549 6e66 6f29  Source(fileInfo)
-0001f6d0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0001f6e0: 736f 6c76 6564 5061 7468 203d 206f 732e  solvedPath = os.
-0001f6f0: 7061 7468 2e6a 6f69 6e28 6d6f 756e 7450  path.join(mountP
-0001f700: 6f69 6e74 2c20 7265 736f 6c76 6564 5061  oint, resolvedPa
-0001f710: 7468 2e6c 7374 7269 7028 272f 2729 290a  th.lstrip('/')).
-0001f720: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001f730: 7265 736f 6c76 6564 5061 7468 2021 3d20  resolvedPath != 
-0001f740: 7061 7468 3a0a 2020 2020 2020 2020 2020  path:.          
-0001f750: 2020 2020 2020 2320 5468 6520 6669 6c65        # The file
-0001f760: 2076 6572 7369 6f6e 2069 7320 6f6e 6c79   version is only
-0001f770: 206f 6620 696d 706f 7274 616e 6365 2074   of importance t
-0001f780: 6f20 7265 736f 6c76 6520 7365 6c66 2d72  o resolve self-r
-0001f790: 6566 6572 656e 6365 732e 0a20 2020 2020  eferences..     
-0001f7a0: 2020 2020 2020 2020 2020 2023 2049 7420             # It 
-0001f7b0: 7365 656d 7320 756e 6465 6369 6461 626c  seems undecidabl
-0001f7c0: 6520 746f 206d 6520 7768 6574 6865 7220  e to me whether 
-0001f7d0: 746f 2072 6574 7572 6e20 7468 6520 6769  to return the gi
-0001f7e0: 7665 6e20 6669 6c65 5665 7273 696f 6e20  ven fileVersion 
-0001f7f0: 6f72 2030 2068 6572 652e 0a20 2020 2020  or 0 here..     
-0001f800: 2020 2020 2020 2020 2020 2023 2052 6574             # Ret
-0001f810: 7572 6e69 6e67 2030 2077 6f75 6c64 2066  urning 0 would f
-0001f820: 6565 6c20 6d6f 7265 2063 6f72 7265 6374  eel more correct
-0001f830: 2062 6563 6175 7365 2074 6865 2077 6520   because the we 
-0001f840: 7377 6974 6368 6564 2074 6f20 616e 6f74  switched to anot
-0001f850: 6865 7220 6669 6c65 2061 6e64 2074 6865  her file and the
-0001f860: 2076 6572 7369 6f6e 0a20 2020 2020 2020   version.       
-0001f870: 2020 2020 2020 2020 2023 2066 6f72 2074           # for t
-0001f880: 6861 7420 6669 6c65 2069 7320 7468 6520  hat file is the 
-0001f890: 6d6f 7374 2072 6563 656e 7420 6f6e 652e  most recent one.
-0001f8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f8b0: 2023 2048 6f77 6576 6572 2c20 7265 7365   # However, rese
-0001f8c0: 7474 696e 6720 7468 6520 6669 6c65 2076  tting the file v
-0001f8d0: 6572 7369 6f6e 2074 6f20 3020 6d65 616e  ersion to 0 mean
-0001f8e0: 7320 7468 6174 2069 6620 7468 6572 6520  s that if there 
-0001f8f0: 6973 2061 2063 7963 6c65 2c20 692e 652e  is a cycle, i.e.
-0001f900: 2c20 7477 6f20 6861 7264 6c69 6e6b 730a  , two hardlinks.
-0001f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f920: 2320 6f66 2064 6966 6665 7265 6e74 206e  # of different n
-0001f930: 616d 6573 2072 6566 6572 656e 6369 6e67  ames referencing
-0001f940: 2065 6163 6820 6f74 6865 722c 2074 6861   each other, tha
-0001f950: 6e20 7468 6520 6669 6c65 2076 6572 7369  n the file versi
-0001f960: 6f6e 2077 696c 6c20 616c 7761 7973 2062  on will always b
-0001f970: 6520 7265 7365 7420 746f 2030 0a20 2020  e reset to 0.   
-0001f980: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-0001f990: 6e64 2077 6520 6861 7665 206e 6f20 6272  nd we have no br
-0001f9a0: 6561 6b20 636f 6e64 6974 696f 6e2c 2065  eak condition, e
-0001f9b0: 6e74 6572 696e 6720 616e 2069 6e66 696e  ntering an infin
-0001f9c0: 6974 6520 6c6f 6f70 2e0a 2020 2020 2020  ite loop..      
-0001f9d0: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-0001f9e0: 6d6f 7374 2063 6f72 7265 6374 2076 6572  most correct ver
-0001f9f0: 7369 6f6e 2077 6f75 6c64 2062 6520 746f  sion would be to
-0001fa00: 2074 7261 636b 2074 6865 2076 6572 7369   track the versi
-0001fa10: 6f6e 206f 6620 6561 6368 2070 6174 6820  on of each path 
-0001fa20: 696e 2061 206d 6170 2061 6e64 2063 6f75  in a map and cou
-0001fa30: 6e74 2075 7020 7468 650a 2020 2020 2020  nt up the.      
-0001fa40: 2020 2020 2020 2020 2020 2320 7665 7273            # vers
-0001fa50: 696f 6e20 7065 7220 7061 7468 2e0a 2020  ion per path..  
-0001fa60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001fa70: 544f 444f 2049 7320 7375 6368 2061 2068  TODO Is such a h
-0001fa80: 6172 646c 696e 6b20 6379 636c 6520 6576  ardlink cycle ev
-0001fa90: 656e 2070 6f73 7369 626c 653f 210a 2020  en possible?!.  
-0001faa0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0001fab0: 6c65 5665 7273 696f 6e20 3d20 300a 2020  leVersion = 0.  
-0001fac0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fae0: 2320 4966 2066 696c 6520 6973 2072 6566  # If file is ref
-0001faf0: 6572 656e 6369 6e67 2069 7473 656c 662c  erencing itself,
-0001fb00: 2074 7279 2074 6f20 6163 6365 7373 2065   try to access e
-0001fb10: 6172 6c69 6572 2076 6572 7369 6f6e 206f  arlier version o
-0001fb20: 6620 6974 2e0a 2020 2020 2020 2020 2020  f it..          
-0001fb30: 2020 2020 2020 2320 5468 6520 6368 6563        # The chec
-0001fb40: 6b20 666f 7220 6669 6c65 5665 7273 696f  k for fileVersio
-0001fb50: 6e20 6167 6169 6e73 7420 7468 6520 746f  n against the to
-0001fb60: 7461 6c20 6e75 6d62 6572 206f 6620 6176  tal number of av
-0001fb70: 6169 6c61 626c 6520 6669 6c65 2076 6572  ailable file ver
-0001fb80: 7369 6f6e 7320 6973 206f 6d69 7474 6564  sions is omitted
-0001fb90: 2062 6563 6175 7365 0a20 2020 2020 2020   because.       
-0001fba0: 2020 2020 2020 2020 2023 2074 6861 7420           # that 
-0001fbb0: 6368 6563 6b20 6973 2064 6f6e 6520 696d  check is done im
-0001fbc0: 706c 6963 6974 6c79 2069 6e73 6964 6520  plicitly inside 
-0001fbd0: 7468 6520 6d6f 756e 7420 736f 7572 6365  the mount source
-0001fbe0: 7320 6765 7446 696c 6549 6e66 6f20 6d65  s getFileInfo me
-0001fbf0: 7468 6f64 210a 2020 2020 2020 2020 2020  thod!.          
-0001fc00: 2020 2020 2020 6669 6c65 5665 7273 696f        fileVersio
-0001fc10: 6e20 3d20 6669 6c65 5665 7273 696f 6e20  n = fileVersion 
-0001fc20: 2b20 3120 6966 2066 696c 6556 6572 7369  + 1 if fileVersi
-0001fc30: 6f6e 203e 3d20 3020 656c 7365 2066 696c  on >= 0 else fil
-0001fc40: 6556 6572 7369 6f6e 202d 2031 0a0a 2020  eVersion - 1..  
-0001fc50: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-0001fc60: 2072 6573 6f6c 7665 6450 6174 680a 2020   resolvedPath.  
-0001fc70: 2020 2020 2020 2020 2020 6669 6c65 496e            fileIn
-0001fc80: 666f 203d 206d 6f75 6e74 536f 7572 6365  fo = mountSource
-0001fc90: 2e67 6574 4669 6c65 496e 666f 2870 6174  .getFileInfo(pat
-0001fca0: 682c 2066 696c 6556 6572 7369 6f6e 290a  h, fileVersion).
-0001fcb0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001fcc0: 6f74 2066 696c 6549 6e66 6f3a 0a20 2020  ot fileInfo:.   
-0001fcd0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001fce0: 7572 6e20 4e6f 6e65 0a0a 2020 2020 2020  urn None..      
-0001fcf0: 2020 2020 2020 7265 736f 6c76 6564 5061        resolvedPa
-0001fd00: 7468 203d 2027 2f27 202b 2066 696c 6549  th = '/' + fileI
-0001fd10: 6e66 6f2e 6c69 6e6b 6e61 6d65 2e6c 7374  nfo.linkname.lst
-0001fd20: 7269 7028 272f 2729 2069 6620 4669 6c65  rip('/') if File
-0001fd30: 5665 7273 696f 6e4c 6179 6572 2e5f 6973  VersionLayer._is
-0001fd40: 4861 7264 4c69 6e6b 2866 696c 6549 6e66  HardLink(fileInf
-0001fd50: 6f29 2065 6c73 6520 4e6f 6e65 0a20 2020  o) else None.   
-0001fd60: 2020 2020 2020 2020 2068 6172 644c 696e           hardLin
-0001fd70: 6b43 6f75 6e74 202b 3d20 310a 0a20 2020  kCount += 1..   
-0001fd80: 2020 2020 2072 6574 7572 6e20 6669 6c65       return file
-0001fd90: 496e 666f 0a0a 2020 2020 406f 7665 7272  Info..    @overr
-0001fda0: 6964 6573 284d 6f75 6e74 536f 7572 6365  ides(MountSource
-0001fdb0: 290a 2020 2020 6465 6620 6c69 7374 4469  ).    def listDi
-0001fdc0: 7228 7365 6c66 2c20 7061 7468 3a20 7374  r(self, path: st
-0001fdd0: 7229 202d 3e20 4f70 7469 6f6e 616c 5b49  r) -> Optional[I
-0001fde0: 7465 7261 626c 655b 7374 725d 5d3a 0a20  terable[str]]:. 
-0001fdf0: 2020 2020 2020 2066 696c 6573 203d 2073         files = s
-0001fe00: 656c 662e 6d6f 756e 7453 6f75 7263 652e  elf.mountSource.
-0001fe10: 6c69 7374 4469 7228 7061 7468 290a 2020  listDir(path).  
-0001fe20: 2020 2020 2020 6966 2066 696c 6573 2069        if files i
-0001fe30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0001fe40: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0001fe50: 696c 6573 0a0a 2020 2020 2020 2020 2320  iles..        # 
-0001fe60: 4966 206e 6f20 666f 6c64 6572 2077 6173  If no folder was
-0001fe70: 2066 6f75 6e64 2c20 6368 6563 6b20 7768   found, check wh
-0001fe80: 6574 6865 7220 7468 6520 7370 6563 6961  ether the specia
-0001fe90: 6c20 2e76 6572 7369 6f6e 7320 666f 6c64  l .versions fold
-0001fea0: 6572 2077 6173 2072 6571 7565 7374 6564  er was requested
-0001feb0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0001fec0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0001fed0: 203d 2073 656c 662e 5f64 6563 6f64 6556   = self._decodeV
-0001fee0: 6572 7369 6f6e 7350 6174 6841 5049 2870  ersionsPathAPI(p
-0001fef0: 6174 6829 0a20 2020 2020 2020 2065 7863  ath).        exc
-0001ff00: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-0001ff10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ff20: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
-0001ff30: 6966 206e 6f74 2072 6573 756c 743a 0a20  if not result:. 
-0001ff40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ff50: 6e20 4e6f 6e65 0a20 2020 2020 2020 2070  n None.        p
-0001ff60: 6174 682c 2070 6174 6849 7353 7065 6369  ath, pathIsSpeci
-0001ff70: 616c 5665 7273 696f 6e73 466f 6c64 6572  alVersionsFolder
-0001ff80: 2c20 5f20 3d20 7265 7375 6c74 0a0a 2020  , _ = result..  
-0001ff90: 2020 2020 2020 6966 206e 6f74 2070 6174        if not pat
-0001ffa0: 6849 7353 7065 6369 616c 5665 7273 696f  hIsSpecialVersio
-0001ffb0: 6e73 466f 6c64 6572 3a0a 2020 2020 2020  nsFolder:.      
-0001ffc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001ffd0: 662e 6d6f 756e 7453 6f75 7263 652e 6c69  f.mountSource.li
-0001ffe0: 7374 4469 7228 7061 7468 290a 0a20 2020  stDir(path)..   
-0001fff0: 2020 2020 2023 2050 7269 6e74 2061 6c6c       # Print all
-00020000: 2061 7661 696c 6162 6c65 2076 6572 7369   available versi
-00020010: 6f6e 7320 6f66 2074 6865 2066 696c 6520  ons of the file 
-00020020: 6174 2066 696c 6550 6174 6820 6173 2074  at filePath as t
-00020030: 6865 2063 6f6e 7465 6e74 7320 6f66 2074  he contents of t
-00020040: 6865 2073 7065 6369 616c 2027 2e76 6572  he special '.ver
-00020050: 7369 6f6e 7327 2066 6f6c 6465 720a 2020  sions' folder.  
-00020060: 2020 2020 2020 7265 7475 726e 205b 7374        return [st
-00020070: 7228 7665 7273 696f 6e20 2b20 3129 2066  r(version + 1) f
-00020080: 6f72 2076 6572 7369 6f6e 2069 6e20 7261  or version in ra
-00020090: 6e67 6528 7365 6c66 2e6d 6f75 6e74 536f  nge(self.mountSo
-000200a0: 7572 6365 2e66 696c 6556 6572 7369 6f6e  urce.fileVersion
-000200b0: 7328 7061 7468 2929 5d0a 0a20 2020 2040  s(path))]..    @
-000200c0: 6f76 6572 7269 6465 7328 4d6f 756e 7453  overrides(MountS
-000200d0: 6f75 7263 6529 0a20 2020 2064 6566 2067  ource).    def g
-000200e0: 6574 4669 6c65 496e 666f 2873 656c 662c  etFileInfo(self,
-000200f0: 2070 6174 683a 2073 7472 2c20 6669 6c65   path: str, file
-00020100: 5665 7273 696f 6e3a 2069 6e74 203d 2030  Version: int = 0
-00020110: 2920 2d3e 204f 7074 696f 6e61 6c5b 4669  ) -> Optional[Fi
-00020120: 6c65 496e 666f 5d3a 0a20 2020 2020 2020  leInfo]:.       
-00020130: 2022 2222 5265 736f 6c76 6573 2073 7065   """Resolves spe
-00020140: 6369 616c 2066 696c 6520 7665 7273 696f  cial file versio
-00020150: 6e20 7370 6563 6966 6963 6174 696f 6e73  n specifications
-00020160: 2069 6e20 7468 6520 7061 7468 2e22 2222   in the path."""
-00020170: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
-00020180: 2066 696c 6556 6572 7369 6f6e 203d 3d20   fileVersion == 
-00020190: 300a 0a20 2020 2020 2020 2066 696c 6549  0..        fileI
-000201a0: 6e66 6f20 3d20 4669 6c65 5665 7273 696f  nfo = FileVersio
-000201b0: 6e4c 6179 6572 2e5f 7265 736f 6c76 6548  nLayer._resolveH
-000201c0: 6172 644c 696e 6b73 2873 656c 662e 6d6f  ardLinks(self.mo
-000201d0: 756e 7453 6f75 7263 652c 2070 6174 6829  untSource, path)
-000201e0: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
-000201f0: 496e 666f 3a0a 2020 2020 2020 2020 2020  Info:.          
-00020200: 2020 7265 7475 726e 2066 696c 6549 6e66    return fileInf
-00020210: 6f0a 0a20 2020 2020 2020 2023 2049 6620  o..        # If 
-00020220: 6e6f 2066 696c 6520 7761 7320 666f 756e  no file was foun
-00020230: 642c 2063 6865 636b 2069 6620 6120 7370  d, check if a sp
-00020240: 6563 6961 6c20 2e76 6572 7369 6f6e 7320  ecial .versions 
-00020250: 666f 6c64 6572 2074 6f20 616e 2065 7869  folder to an exi
-00020260: 7374 696e 6720 6669 6c65 2f66 6f6c 6465  sting file/folde
-00020270: 7220 7761 7320 7175 6572 6965 642e 0a20  r was queried.. 
-00020280: 2020 2020 2020 2076 6572 7369 6f6e 7349         versionsI
-00020290: 6e66 6f20 3d20 7365 6c66 2e5f 6465 636f  nfo = self._deco
-000202a0: 6465 5665 7273 696f 6e73 5061 7468 4150  deVersionsPathAP
-000202b0: 4928 7061 7468 290a 2020 2020 2020 2020  I(path).        
-000202c0: 6966 206e 6f74 2076 6572 7369 6f6e 7349  if not versionsI
-000202d0: 6e66 6f3a 0a20 2020 2020 2020 2020 2020  nfo:.           
-000202e0: 2072 6169 7365 2066 7573 652e 4675 7365   raise fuse.Fuse
-000202f0: 4f53 4572 726f 7228 6675 7365 2e65 7272  OSError(fuse.err
-00020300: 6e6f 2e45 4e4f 454e 5429 0a20 2020 2020  no.ENOENT).     
-00020310: 2020 2070 6174 682c 2070 6174 6849 7353     path, pathIsS
-00020320: 7065 6369 616c 5665 7273 696f 6e73 466f  pecialVersionsFo
-00020330: 6c64 6572 2c20 6669 6c65 5665 7273 696f  lder, fileVersio
-00020340: 6e20 3d20 7665 7273 696f 6e73 496e 666f  n = versionsInfo
-00020350: 0a0a 2020 2020 2020 2020 2320 322e 2920  ..        # 2.) 
-00020360: 4368 6563 6b20 6966 2074 6865 2072 6571  Check if the req
-00020370: 7565 7374 2077 6173 2066 6f72 2074 6865  uest was for the
-00020380: 2073 7065 6369 616c 202e 7665 7273 696f   special .versio
-00020390: 6e73 2066 6f6c 6465 7220 616e 6420 7265  ns folder and re
-000203a0: 7475 726e 2069 7473 2063 6f6e 7465 6e74  turn its content
-000203b0: 7320 6f72 2073 7461 7473 0a20 2020 2020  s or stats.     
-000203c0: 2020 2023 2041 7420 7468 6973 2070 6f69     # At this poi
-000203d0: 6e74 2c20 7061 7468 2069 7320 6173 7375  nt, path is assu
-000203e0: 7265 6420 746f 2061 6374 7561 6c6c 7920  red to actually 
-000203f0: 6578 6973 7421 0a20 2020 2020 2020 2069  exist!.        i
-00020400: 6620 7061 7468 4973 5370 6563 6961 6c56  f pathIsSpecialV
-00020410: 6572 7369 6f6e 7346 6f6c 6465 723a 0a20  ersionsFolder:. 
-00020420: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00020430: 7446 696c 6549 6e66 6f20 3d20 7365 6c66  tFileInfo = self
-00020440: 2e6d 6f75 6e74 536f 7572 6365 2e67 6574  .mountSource.get
-00020450: 4669 6c65 496e 666f 2870 6174 6829 0a20  FileInfo(path). 
-00020460: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00020470: 7420 7061 7265 6e74 4669 6c65 496e 666f  t parentFileInfo
-00020480: 0a0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-00020490: 6c65 496e 666f 203d 2046 696c 6549 6e66  leInfo = FileInf
-000204a0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-000204b0: 2020 2023 2066 6d74 3a20 6f66 660a 2020     # fmt: off.  
-000204c0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-000204d0: 7a65 2020 2020 203d 2030 2c0a 2020 2020  ze     = 0,.    
-000204e0: 2020 2020 2020 2020 2020 2020 6d74 696d              mtim
-000204f0: 6520 2020 203d 2070 6172 656e 7446 696c  e    = parentFil
-00020500: 6549 6e66 6f2e 6d74 696d 652c 0a20 2020  eInfo.mtime,.   
-00020510: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00020520: 6520 2020 2020 3d20 306f 3737 3720 7c20  e     = 0o777 | 
-00020530: 7374 6174 2e53 5f49 4644 4952 2c0a 2020  stat.S_IFDIR,.  
-00020540: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00020550: 6e6b 6e61 6d65 203d 2022 222c 0a20 2020  nkname = "",.   
-00020560: 2020 2020 2020 2020 2020 2020 2075 6964               uid
-00020570: 2020 2020 2020 3d20 7061 7265 6e74 4669        = parentFi
-00020580: 6c65 496e 666f 2e75 6964 2c0a 2020 2020  leInfo.uid,.    
-00020590: 2020 2020 2020 2020 2020 2020 6769 6420              gid 
-000205a0: 2020 2020 203d 2070 6172 656e 7446 696c       = parentFil
-000205b0: 6549 6e66 6f2e 6769 642c 0a20 2020 2020  eInfo.gid,.     
-000205c0: 2020 2020 2020 2020 2020 2023 2049 2074             # I t
-000205d0: 6869 6e6b 2074 6869 7320 646f 6573 206e  hink this does n
-000205e0: 6f74 206d 6174 7465 7220 6265 6361 7573  ot matter becaus
-000205f0: 6520 6375 7272 656e 746c 7920 7573 6572  e currently user
-00020600: 6461 7461 2069 7320 6f6e 6c79 2075 7365  data is only use
-00020610: 6420 696e 2072 6561 6420 6361 6c6c 732c  d in read calls,
-00020620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020630: 2023 2077 6869 6368 2073 686f 756c 6420   # which should 
-00020640: 6f6e 6c79 2062 6520 6769 7665 6e20 6e6f  only be given no
-00020650: 6e2d 6469 7265 6374 6f72 7920 6669 6c65  n-directory file
-00020660: 7320 616e 6420 7468 6973 2069 7320 6120  s and this is a 
-00020670: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
-00020680: 2020 2020 2020 2020 2020 7573 6572 6461            userda
-00020690: 7461 203d 205b 5d2c 0a20 2020 2020 2020  ta = [],.       
-000206a0: 2020 2020 2020 2020 2023 2066 6d74 3a20           # fmt: 
-000206b0: 6f6e 0a20 2020 2020 2020 2020 2020 2029  on.            )
-000206c0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000206d0: 7475 726e 2066 696c 6549 6e66 6f0a 0a20  turn fileInfo.. 
-000206e0: 2020 2020 2020 2023 2033 2e29 2041 7420         # 3.) At 
-000206f0: 7468 6973 2070 6f69 6e74 2074 6865 2072  this point the r
-00020700: 6571 7565 7374 2069 7320 666f 7220 616e  equest is for an
-00020710: 2061 6374 7561 6c6c 7920 6f6c 6465 7220   actually older 
-00020720: 7665 7273 696f 6e20 6f66 2061 2066 696c  version of a fil
-00020730: 6520 6f72 2066 6f6c 6465 720a 2020 2020  e or folder.    
-00020740: 2020 2020 6669 6c65 496e 666f 203d 2073      fileInfo = s
-00020750: 656c 662e 6d6f 756e 7453 6f75 7263 652e  elf.mountSource.
-00020760: 6765 7446 696c 6549 6e66 6f28 7061 7468  getFileInfo(path
-00020770: 2c20 6669 6c65 5665 7273 696f 6e3d 6669  , fileVersion=fi
-00020780: 6c65 5665 7273 696f 6e29 0a20 2020 2020  leVersion).     
-00020790: 2020 2069 6620 6669 6c65 496e 666f 3a0a     if fileInfo:.
-000207a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000207b0: 726e 2066 696c 6549 6e66 6f0a 0a20 2020  rn fileInfo..   
-000207c0: 2020 2020 2072 6169 7365 2066 7573 652e       raise fuse.
-000207d0: 4675 7365 4f53 4572 726f 7228 6675 7365  FuseOSError(fuse
-000207e0: 2e65 7272 6e6f 2e45 4e4f 454e 5429 0a0a  .errno.ENOENT)..
-000207f0: 2020 2020 406f 7665 7272 6964 6573 284d      @overrides(M
-00020800: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
-00020810: 6465 6620 6669 6c65 5665 7273 696f 6e73  def fileVersions
-00020820: 2873 656c 662c 2070 6174 683a 2073 7472  (self, path: str
-00020830: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-00020840: 2020 2320 544f 444f 2072 6574 7572 6e20    # TODO return 
-00020850: 3120 666f 7220 7370 6563 6961 6c20 2e76  1 for special .v
-00020860: 6572 7369 6f6e 7320 666f 6c64 6572 7320  ersions folders 
-00020870: 616e 6420 6669 6c65 7320 636f 6e74 6169  and files contai
-00020880: 6e65 6420 696e 2074 6865 7265 3f0a 2020  ned in there?.  
-00020890: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000208a0: 662e 6d6f 756e 7453 6f75 7263 652e 6669  f.mountSource.fi
-000208b0: 6c65 5665 7273 696f 6e73 2870 6174 6829  leVersions(path)
-000208c0: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
-000208d0: 284d 6f75 6e74 536f 7572 6365 290a 2020  (MountSource).  
-000208e0: 2020 6465 6620 6f70 656e 2873 656c 662c    def open(self,
-000208f0: 2066 696c 6549 6e66 6f3a 2046 696c 6549   fileInfo: FileI
-00020900: 6e66 6f29 202d 3e20 494f 5b62 7974 6573  nfo) -> IO[bytes
-00020910: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
-00020920: 6e20 7365 6c66 2e6d 6f75 6e74 536f 7572  n self.mountSour
-00020930: 6365 2e6f 7065 6e28 6669 6c65 496e 666f  ce.open(fileInfo
-00020940: 290a 0a20 2020 2040 6f76 6572 7269 6465  )..    @override
-00020950: 7328 4d6f 756e 7453 6f75 7263 6529 0a20  s(MountSource). 
-00020960: 2020 2064 6566 2072 6561 6428 7365 6c66     def read(self
-00020970: 2c20 6669 6c65 496e 666f 3a20 4669 6c65  , fileInfo: File
-00020980: 496e 666f 2c20 7369 7a65 3a20 696e 742c  Info, size: int,
-00020990: 206f 6666 7365 743a 2069 6e74 2920 2d3e   offset: int) ->
-000209a0: 2062 7974 6573 3a0a 2020 2020 2020 2020   bytes:.        
-000209b0: 7265 7475 726e 2073 656c 662e 6d6f 756e  return self.moun
-000209c0: 7453 6f75 7263 652e 7265 6164 2866 696c  tSource.read(fil
-000209d0: 6549 6e66 6f2c 2073 697a 652c 206f 6666  eInfo, size, off
-000209e0: 7365 7429 0a0a 2020 2020 406f 7665 7272  set)..    @overr
-000209f0: 6964 6573 284d 6f75 6e74 536f 7572 6365  ides(MountSource
-00020a00: 290a 2020 2020 6465 6620 6765 744d 6f75  ).    def getMou
-00020a10: 6e74 536f 7572 6365 2873 656c 662c 2066  ntSource(self, f
-00020a20: 696c 6549 6e66 6f3a 2046 696c 6549 6e66  ileInfo: FileInf
-00020a30: 6f29 202d 3e20 5475 706c 655b 7374 722c  o) -> Tuple[str,
-00020a40: 204d 6f75 6e74 536f 7572 6365 2c20 4669   MountSource, Fi
-00020a50: 6c65 496e 666f 5d3a 0a20 2020 2020 2020  leInfo]:.       
-00020a60: 2072 6574 7572 6e20 7365 6c66 2e6d 6f75   return self.mou
-00020a70: 6e74 536f 7572 6365 2e67 6574 4d6f 756e  ntSource.getMoun
-00020a80: 7453 6f75 7263 6528 6669 6c65 496e 666f  tSource(fileInfo
-00020a90: 290a 0a0a 636c 6173 7320 4675 7365 4d6f  )...class FuseMo
-00020aa0: 756e 7428 4675 7365 4f70 6572 6174 696f  unt(FuseOperatio
-00020ab0: 6e73 293a 2020 2320 7479 7065 3a20 6967  ns):  # type: ig
-00020ac0: 6e6f 7265 0a20 2020 2022 2222 0a20 2020  nore.    """.   
-00020ad0: 2054 6869 7320 636c 6173 7320 696d 706c   This class impl
-00020ae0: 656d 656e 7473 2074 6865 2066 7573 6570  ements the fusep
-00020af0: 7920 696e 7465 7266 6163 6520 696e 206f  y interface in o
-00020b00: 7264 6572 2074 6f20 6372 6561 7465 2061  rder to create a
-00020b10: 206d 6f75 6e74 6564 2066 696c 6520 7379   mounted file sy
-00020b20: 7374 656d 2076 6965 7720 746f 2061 204d  stem view to a M
-00020b30: 6f75 6e74 536f 7572 6365 2e0a 2020 2020  ountSource..    
-00020b40: 5461 736b 7320 6f66 2074 6869 7320 636c  Tasks of this cl
-00020b50: 6173 7320 6974 7365 6c66 3a0a 2020 2020  ass itself:.    
-00020b60: 2020 202d 2043 6861 6e67 6573 2061 6c6c     - Changes all
-00020b70: 2066 696c 6520 7065 726d 6973 7369 6f6e   file permission
-00020b80: 7320 746f 2072 6561 642d 6f6e 6c79 0a20  s to read-only. 
-00020b90: 2020 2020 2020 2d20 4765 7420 6163 7475        - Get actu
-00020ba0: 616c 2066 696c 6520 636f 6e74 656e 7473  al file contents
-00020bb0: 2065 6974 6865 7220 6279 2064 6972 6563   either by direc
-00020bc0: 746c 7920 7265 6164 696e 6720 6672 6f6d  tly reading from
-00020bd0: 2074 6865 2054 4152 206f 7220 6279 2075   the TAR or by u
-00020be0: 7369 6e67 2053 7465 6e63 696c 6564 4669  sing StenciledFi
-00020bf0: 6c65 2061 6e64 2074 6172 6669 6c65 0a20  le and tarfile. 
-00020c00: 2020 2020 2020 2d20 456e 6162 6c69 6e67        - Enabling
-00020c10: 2046 6f6c 6465 724d 6f75 6e74 536f 7572   FolderMountSour
-00020c20: 6365 2074 6f20 6269 6e64 2074 6f20 7468  ce to bind to th
-00020c30: 6520 6e6f 6e65 6d70 7479 2066 6f6c 6465  e nonempty folde
-00020c40: 7220 756e 6465 7220 7468 6520 6d6f 756e  r under the moun
-00020c50: 7470 6f69 6e74 2069 7473 656c 662e 0a20  tpoint itself.. 
-00020c60: 2020 204f 7468 6572 2066 756e 6374 696f     Other functio
-00020c70: 6e61 6c69 7469 6573 206c 696b 6520 6669  nalities like fi
-00020c80: 6c65 2076 6572 7369 6f6e 696e 672c 2068  le versioning, h
-00020c90: 6172 6420 6c69 6e6b 2072 6573 6f6c 7669  ard link resolvi
-00020ca0: 6e67 2c20 616e 6420 756e 696f 6e20 6d6f  ng, and union mo
-00020cb0: 756e 7469 6e67 2061 7265 2069 6d70 6c65  unting are imple
-00020cc0: 6d65 6e74 6564 2062 7920 7573 696e 670a  mented by using.
-00020cd0: 2020 2020 7468 6520 7265 7370 6563 7469      the respecti
-00020ce0: 7665 204d 6f75 6e74 536f 7572 6365 2064  ve MountSource d
-00020cf0: 6572 6976 6564 2063 6c61 7373 6573 2e0a  erived classes..
-00020d00: 0a20 2020 2044 6f63 756d 656e 7461 7469  .    Documentati
-00020d10: 6f6e 2066 6f72 2046 5553 4520 6d65 7468  on for FUSE meth
-00020d20: 6f64 7320 6361 6e20 6265 2066 6f75 6e64  ods can be found
-00020d30: 2069 6e20 7468 6520 6675 7365 7079 206f   in the fusepy o
-00020d40: 7220 6c69 6266 7573 6520 6865 6164 6572  r libfuse header
-00020d50: 732e 2054 6865 7265 2073 6565 6d73 2074  s. There seems t
-00020d60: 6f20 6265 206e 6f20 636f 6d70 6c65 7465  o be no complete
-00020d70: 0a20 2020 2072 656e 6465 7265 6420 646f  .    rendered do
-00020d80: 6375 6d65 6e74 6174 696f 6e20 6173 6964  cumentation asid
-00020d90: 6520 6672 6f6d 2074 6865 2068 6561 6465  e from the heade
-00020da0: 7220 636f 6d6d 656e 7473 2e0a 0a20 2020  r comments...   
-00020db0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-00020dc0: 636f 6d2f 6675 7365 7079 2f66 7573 6570  com/fusepy/fusep
-00020dd0: 792f 626c 6f62 2f6d 6173 7465 722f 6675  y/blob/master/fu
-00020de0: 7365 2e70 790a 2020 2020 6874 7470 733a  se.py.    https:
-00020df0: 2f2f 6769 7468 7562 2e63 6f6d 2f6c 6962  //github.com/lib
-00020e00: 6675 7365 2f6c 6962 6675 7365 2f62 6c6f  fuse/libfuse/blo
-00020e10: 622f 6d61 7374 6572 2f69 6e63 6c75 6465  b/master/include
-00020e20: 2f66 7573 652e 680a 2020 2020 6874 7470  /fuse.h.    http
-00020e30: 733a 2f2f 6d61 6e37 2e6f 7267 2f6c 696e  s://man7.org/lin
-00020e40: 7578 2f6d 616e 2d70 6167 6573 2f6d 616e  ux/man-pages/man
-00020e50: 332f 6572 726e 6f2e 332e 6874 6d6c 0a0a  3/errno.3.html..
-00020e60: 2020 2020 416c 6c20 7061 7468 2061 7267      All path arg
-00020e70: 756d 656e 7473 2066 6f72 206f 7665 7272  uments for overr
-00020e80: 6964 656e 2066 7573 6570 7920 6d65 7468  iden fusepy meth
-00020e90: 6f64 7320 646f 2068 6176 6520 6120 6c65  ods do have a le
-00020ea0: 6164 696e 6720 736c 6173 6820 2827 2f27  ading slash ('/'
-00020eb0: 2921 0a20 2020 2054 6869 7320 6973 2077  )!.    This is w
-00020ec0: 6879 204d 6f75 6e74 536f 7572 6365 2061  hy MountSource a
-00020ed0: 6c73 6f20 7368 6f75 6c64 2065 7870 6563  lso should expec
-00020ee0: 7420 6c65 6164 696e 6720 736c 6173 6865  t leading slashe
-00020ef0: 7320 696e 2061 6c6c 2070 6174 6873 2e0a  s in all paths..
-00020f00: 2020 2020 2222 220a 0a20 2020 205f 5f73      """..    __s
-00020f10: 6c6f 7473 5f5f 203d 2028 0a20 2020 2020  lots__ = (.     
-00020f20: 2020 2027 6d6f 756e 7453 6f75 7263 6527     'mountSource'
-00020f30: 2c0a 2020 2020 2020 2020 2772 6f6f 7446  ,.        'rootF
-00020f40: 696c 6549 6e66 6f27 2c0a 2020 2020 2020  ileInfo',.      
-00020f50: 2020 276d 6f75 6e74 506f 696e 7427 2c0a    'mountPoint',.
-00020f60: 2020 2020 2020 2020 276d 6f75 6e74 506f          'mountPo
-00020f70: 696e 7446 6427 2c0a 2020 2020 2020 2020  intFd',.        
-00020f80: 276d 6f75 6e74 506f 696e 7457 6173 4372  'mountPointWasCr
-00020f90: 6561 7465 6427 2c0a 2020 2020 2020 2020  eated',.        
-00020fa0: 2773 656c 6642 696e 644d 6f75 6e74 272c  'selfBindMount',
-00020fb0: 0a20 2020 2020 2020 2027 6f70 656e 6564  .        'opened
-00020fc0: 4669 6c65 7327 2c0a 2020 2020 2020 2020  Files',.        
-00020fd0: 276c 6173 7446 696c 6548 616e 646c 6527  'lastFileHandle'
-00020fe0: 2c0a 2020 2020 290a 0a20 2020 2064 6566  ,.    )..    def
-00020ff0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00021000: 7061 7468 546f 4d6f 756e 743a 2055 6e69  pathToMount: Uni
-00021010: 6f6e 5b73 7472 2c20 4c69 7374 5b73 7472  on[str, List[str
-00021020: 5d5d 2c20 6d6f 756e 7450 6f69 6e74 3a20  ]], mountPoint: 
-00021030: 7374 722c 202a 2a6f 7074 696f 6e73 2920  str, **options) 
-00021040: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00021050: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00021060: 6365 2870 6174 6854 6f4d 6f75 6e74 2c20  ce(pathToMount, 
-00021070: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-00021080: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00021090: 2020 2020 2020 2020 6f73 2e66 7370 6174          os.fspat
-000210a0: 6828 7061 7468 546f 4d6f 756e 7429 0a20  h(pathToMount). 
-000210b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000210c0: 6174 6854 6f4d 6f75 6e74 203d 205b 7061  athToMount = [pa
-000210d0: 7468 546f 4d6f 756e 745d 0a20 2020 2020  thToMount].     
-000210e0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-000210f0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00021100: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
-00021110: 2020 2020 2020 206f 7074 696f 6e73 5b27         options['
-00021120: 7772 6974 6549 6e64 6578 275d 203d 2054  writeIndex'] = T
-00021130: 7275 650a 0a20 2020 2020 2020 2023 2054  rue..        # T
-00021140: 6869 7320 616c 736f 2077 696c 6c20 6372  his also will cr
-00021150: 6561 7465 206f 7220 6c6f 6164 2074 6865  eate or load the
-00021160: 2062 6c6f 636b 206f 6666 7365 7473 2066   block offsets f
-00021170: 6f72 2063 6f6d 7072 6573 7365 6420 666f  or compressed fo
-00021180: 726d 6174 730a 2020 2020 2020 2020 6d6f  rmats.        mo
-00021190: 756e 7453 6f75 7263 6573 203d 205b 6f70  untSources = [op
-000211a0: 656e 4d6f 756e 7453 6f75 7263 6528 7061  enMountSource(pa
-000211b0: 7468 2c20 2a2a 6f70 7469 6f6e 7329 2066  th, **options) f
-000211c0: 6f72 2070 6174 6820 696e 2070 6174 6854  or path in pathT
-000211d0: 6f4d 6f75 6e74 5d0a 0a20 2020 2020 2020  oMount]..       
-000211e0: 2023 204e 6f20 7468 7265 6164 7320 7368   # No threads sh
-000211f0: 6f75 6c64 2062 6520 6372 6561 7465 6420  ould be created 
-00021200: 616e 6420 7374 696c 6c20 6265 206f 7065  and still be ope
-00021210: 6e20 6265 666f 7265 2046 5553 4520 666f  n before FUSE fo
-00021220: 726b 732e 0a20 2020 2020 2020 2023 2049  rks..        # I
-00021230: 6e73 7465 6164 2c20 7468 6579 2073 686f  nstead, they sho
-00021240: 756c 6420 6265 2063 7265 6174 6564 2069  uld be created i
-00021250: 6e20 2769 6e69 7427 2e0a 2020 2020 2020  n 'init'..      
-00021260: 2020 2320 5468 6572 6566 6f72 652c 2063    # Therefore, c
-00021270: 6c6f 7365 2074 6872 6561 6473 206f 7065  lose threads ope
-00021280: 6e65 6420 6279 2074 6865 2050 6172 616c  ned by the Paral
-00021290: 6c65 6c42 5a32 5265 6164 6572 2066 6f72  lelBZ2Reader for
-000212a0: 2063 7265 6174 696e 6720 7468 6520 626c   creating the bl
-000212b0: 6f63 6b20 6f66 6673 6574 732e 0a20 2020  ock offsets..   
-000212c0: 2020 2020 2023 2054 686f 7365 2074 6872       # Those thr
-000212d0: 6561 6473 2077 696c 6c20 6265 2061 7574  eads will be aut
-000212e0: 6f6d 6174 6963 616c 6c79 2072 6563 7265  omatically recre
-000212f0: 6174 6564 2061 6761 696e 206f 6e20 7468  ated again on th
-00021300: 6520 6e65 7874 2072 6561 6420 6361 6c6c  e next read call
-00021310: 2e0a 2020 2020 2020 2020 2320 5769 7468  ..        # With
-00021320: 6f75 7420 7468 6973 2c20 7468 6520 7261  out this, the ra
-00021330: 7461 726d 6f75 6e74 2062 6163 6b67 726f  tarmount backgro
-00021340: 756e 6420 7072 6f63 6573 7320 776f 6e27  und process won'
-00021350: 7420 7175 6974 2065 7665 6e20 6166 7465  t quit even afte
-00021360: 7220 756e 6d6f 756e 7469 6e67 210a 2020  r unmounting!.  
-00021370: 2020 2020 2020 666f 7220 6d6f 756e 7453        for mountS
-00021380: 6f75 7263 6520 696e 206d 6f75 6e74 536f  ource in mountSo
-00021390: 7572 6365 733a 0a20 2020 2020 2020 2020  urces:.         
-000213a0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-000213b0: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
-000213c0: 6365 286d 6f75 6e74 536f 7572 6365 2c20  ce(mountSource, 
-000213d0: 5351 4c69 7465 496e 6465 7865 6454 6172  SQLiteIndexedTar
-000213e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000213f0: 2020 616e 6420 6861 7361 7474 7228 6d6f    and hasattr(mo
-00021400: 756e 7453 6f75 7263 652c 2027 7461 7246  untSource, 'tarF
-00021410: 696c 654f 626a 6563 7427 290a 2020 2020  ileObject').    
-00021420: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00021430: 6861 7361 7474 7228 6d6f 756e 7453 6f75  hasattr(mountSou
-00021440: 7263 652e 7461 7246 696c 654f 626a 6563  rce.tarFileObjec
-00021450: 742c 2027 6a6f 696e 5f74 6872 6561 6473  t, 'join_threads
-00021460: 2729 0a20 2020 2020 2020 2020 2020 2029  ').            )
-00021470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021480: 2020 6d6f 756e 7453 6f75 7263 652e 7461    mountSource.ta
-00021490: 7246 696c 654f 626a 6563 742e 6a6f 696e  rFileObject.join
-000214a0: 5f74 6872 6561 6473 2829 0a0a 2020 2020  _threads()..    
-000214b0: 2020 2020 7365 6c66 2e6d 6f75 6e74 536f      self.mountSo
-000214c0: 7572 6365 3a20 4d6f 756e 7453 6f75 7263  urce: MountSourc
-000214d0: 6520 3d20 556e 696f 6e4d 6f75 6e74 536f  e = UnionMountSo
-000214e0: 7572 6365 286d 6f75 6e74 536f 7572 6365  urce(mountSource
-000214f0: 7329 0a20 2020 2020 2020 2069 6620 6f70  s).        if op
-00021500: 7469 6f6e 732e 6765 7428 2772 6563 7572  tions.get('recur
-00021510: 7369 7665 272c 2046 616c 7365 293a 0a20  sive', False):. 
-00021520: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00021530: 6d6f 756e 7453 6f75 7263 6520 3d20 4175  mountSource = Au
-00021540: 746f 4d6f 756e 744c 6179 6572 2873 656c  toMountLayer(sel
-00021550: 662e 6d6f 756e 7453 6f75 7263 652c 202a  f.mountSource, *
-00021560: 2a6f 7074 696f 6e73 290a 2020 2020 2020  *options).      
-00021570: 2020 7365 6c66 2e6d 6f75 6e74 536f 7572    self.mountSour
-00021580: 6365 203d 2046 696c 6556 6572 7369 6f6e  ce = FileVersion
-00021590: 4c61 7965 7228 7365 6c66 2e6d 6f75 6e74  Layer(self.mount
-000215a0: 536f 7572 6365 290a 0a20 2020 2020 2020  Source)..       
-000215b0: 2073 656c 662e 726f 6f74 4669 6c65 496e   self.rootFileIn
-000215c0: 666f 203d 205f 6d61 6b65 4d6f 756e 7450  fo = _makeMountP
-000215d0: 6f69 6e74 4669 6c65 496e 666f 4672 6f6d  ointFileInfoFrom
-000215e0: 5374 6174 7328 6f73 2e73 7461 7428 7061  Stats(os.stat(pa
-000215f0: 7468 546f 4d6f 756e 745b 305d 2929 0a0a  thToMount[0]))..
-00021600: 2020 2020 2020 2020 7365 6c66 2e6f 7065          self.ope
-00021610: 6e65 6446 696c 6573 3a20 4469 6374 5b69  nedFiles: Dict[i
-00021620: 6e74 2c20 494f 5b62 7974 6573 5d5d 203d  nt, IO[bytes]] =
-00021630: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
-00021640: 2e6c 6173 7446 696c 6548 616e 646c 653a  .lastFileHandle:
-00021650: 2069 6e74 203d 2030 2020 2320 4974 2077   int = 0  # It w
-00021660: 696c 6c20 6265 2069 6e63 7265 6d65 6e74  ill be increment
-00021670: 6564 2062 6566 6f72 6520 6265 696e 6720  ed before being 
-00021680: 7265 7475 726e 6564 2e20 4974 2063 616e  returned. It can
-00021690: 2774 2068 7572 7420 746f 206e 6576 6572  't hurt to never
-000216a0: 2072 6574 7572 6e20 302e 0a0a 2020 2020   return 0...    
-000216b0: 2020 2020 2320 4372 6561 7465 206d 6f75      # Create mou
-000216c0: 6e74 2070 6f69 6e74 2069 6620 6974 2064  nt point if it d
-000216d0: 6f65 7320 6e6f 7420 6578 6973 740a 2020  oes not exist.  
-000216e0: 2020 2020 2020 7365 6c66 2e6d 6f75 6e74        self.mount
-000216f0: 506f 696e 7457 6173 4372 6561 7465 6420  PointWasCreated 
-00021700: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00021710: 6966 206d 6f75 6e74 506f 696e 7420 616e  if mountPoint an
-00021720: 6420 6e6f 7420 6f73 2e70 6174 682e 6578  d not os.path.ex
-00021730: 6973 7473 286d 6f75 6e74 506f 696e 7429  ists(mountPoint)
-00021740: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-00021750: 2e6d 6b64 6972 286d 6f75 6e74 506f 696e  .mkdir(mountPoin
-00021760: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
-00021770: 656c 662e 6d6f 756e 7450 6f69 6e74 5761  elf.mountPointWa
-00021780: 7343 7265 6174 6564 203d 2054 7275 650a  sCreated = True.
-00021790: 2020 2020 2020 2020 7365 6c66 2e6d 6f75          self.mou
-000217a0: 6e74 506f 696e 7420 3d20 6f73 2e70 6174  ntPoint = os.pat
-000217b0: 682e 7265 616c 7061 7468 286d 6f75 6e74  h.realpath(mount
-000217c0: 506f 696e 7429 0a0a 2020 2020 2020 2020  Point)..        
-000217d0: 2320 5461 6b65 2063 6172 6520 7468 6174  # Take care that
-000217e0: 2062 696e 642d 6d6f 756e 7469 6e67 2066   bind-mounting f
-000217f0: 6f6c 6465 7273 2074 6f20 6974 7365 6c66  olders to itself
-00021800: 2077 6f72 6b73 0a20 2020 2020 2020 2073   works.        s
-00021810: 656c 662e 6d6f 756e 7450 6f69 6e74 4664  elf.mountPointFd
-00021820: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00021830: 7365 6c66 2e73 656c 6642 696e 644d 6f75  self.selfBindMou
-00021840: 6e74 3a20 4f70 7469 6f6e 616c 5b46 6f6c  nt: Optional[Fol
-00021850: 6465 724d 6f75 6e74 536f 7572 6365 5d20  derMountSource] 
-00021860: 3d20 4e6f 6e65 0a20 2020 2020 2020 2066  = None.        f
-00021870: 6f72 206d 6f75 6e74 536f 7572 6365 2069  or mountSource i
-00021880: 6e20 6d6f 756e 7453 6f75 7263 6573 3a0a  n mountSources:.
-00021890: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000218a0: 7369 6e73 7461 6e63 6528 6d6f 756e 7453  sinstance(mountS
-000218b0: 6f75 7263 652c 2046 6f6c 6465 724d 6f75  ource, FolderMou
-000218c0: 6e74 536f 7572 6365 2920 616e 6420 6d6f  ntSource) and mo
-000218d0: 756e 7453 6f75 7263 652e 726f 6f74 203d  untSource.root =
-000218e0: 3d20 7365 6c66 2e6d 6f75 6e74 506f 696e  = self.mountPoin
-000218f0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00021900: 2020 2073 656c 662e 7365 6c66 4269 6e64     self.selfBind
-00021910: 4d6f 756e 7420 3d20 6d6f 756e 7453 6f75  Mount = mountSou
-00021920: 7263 650a 2020 2020 2020 2020 2020 2020  rce.            
-00021930: 2020 2020 7365 6c66 2e6d 6f75 6e74 506f      self.mountPo
-00021940: 696e 7446 6420 3d20 6f73 2e6f 7065 6e28  intFd = os.open(
-00021950: 7365 6c66 2e6d 6f75 6e74 506f 696e 742c  self.mountPoint,
-00021960: 206f 732e 4f5f 5244 4f4e 4c59 290a 0a20   os.O_RDONLY).. 
-00021970: 2020 2064 6566 205f 5f64 656c 5f5f 2873     def __del__(s
-00021980: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00021990: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000219a0: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-000219b0: 6f75 6e74 506f 696e 7457 6173 4372 6561  ountPointWasCrea
-000219c0: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
-000219d0: 2020 2020 206f 732e 726d 6469 7228 7365       os.rmdir(se
-000219e0: 6c66 2e6d 6f75 6e74 506f 696e 7429 0a20  lf.mountPoint). 
-000219f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00021a00: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00021a10: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
-00021a20: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00021a30: 2020 2020 6966 2073 656c 662e 6d6f 756e      if self.moun
-00021a40: 7450 6f69 6e74 4664 2069 7320 6e6f 7420  tPointFd is not 
-00021a50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00021a60: 2020 2020 2020 6f73 2e63 6c6f 7365 2873        os.close(s
-00021a70: 656c 662e 6d6f 756e 7450 6f69 6e74 4664  elf.mountPointFd
-00021a80: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00021a90: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00021aa0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-00021ab0: 2020 406f 7665 7272 6964 6573 2846 7573    @overrides(Fus
-00021ac0: 654f 7065 7261 7469 6f6e 7329 0a20 2020  eOperations).   
-00021ad0: 2064 6566 2069 6e69 7428 7365 6c66 2c20   def init(self, 
-00021ae0: 636f 6e6e 6563 7469 6f6e 2920 2d3e 204e  connection) -> N
-00021af0: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
-00021b00: 7365 6c66 2e73 656c 6642 696e 644d 6f75  self.selfBindMou
-00021b10: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2061  nt is not None a
-00021b20: 6e64 2073 656c 662e 6d6f 756e 7450 6f69  nd self.mountPoi
-00021b30: 6e74 4664 2069 7320 6e6f 7420 4e6f 6e65  ntFd is not None
-00021b40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00021b50: 6c66 2e73 656c 6642 696e 644d 6f75 6e74  lf.selfBindMount
-00021b60: 2e73 6574 466f 6c64 6572 4465 7363 7269  .setFolderDescri
-00021b70: 7074 6f72 2873 656c 662e 6d6f 756e 7450  ptor(self.mountP
-00021b80: 6f69 6e74 4664 290a 0a20 2020 2040 6f76  ointFd)..    @ov
-00021b90: 6572 7269 6465 7328 4675 7365 4f70 6572  errides(FuseOper
-00021ba0: 6174 696f 6e73 290a 2020 2020 6465 6620  ations).    def 
-00021bb0: 6765 7461 7474 7228 7365 6c66 2c20 7061  getattr(self, pa
-00021bc0: 7468 3a20 7374 722c 2066 683d 4e6f 6e65  th: str, fh=None
-00021bd0: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
-00021be0: 6e79 5d3a 0a20 2020 2020 2020 2066 696c  ny]:.        fil
-00021bf0: 6549 6e66 6f20 3d20 7365 6c66 2e6d 6f75  eInfo = self.mou
-00021c00: 6e74 536f 7572 6365 2e67 6574 4669 6c65  ntSource.getFile
-00021c10: 496e 666f 2870 6174 6829 0a20 2020 2020  Info(path).     
-00021c20: 2020 2069 6620 6e6f 7420 6669 6c65 496e     if not fileIn
-00021c30: 666f 3a0a 2020 2020 2020 2020 2020 2020  fo:.            
-00021c40: 7261 6973 6520 6675 7365 2e46 7573 654f  raise fuse.FuseO
-00021c50: 5345 7272 6f72 2866 7573 652e 6572 726e  SError(fuse.errn
-00021c60: 6f2e 4549 4f29 0a0a 2020 2020 2020 2020  o.EIO)..        
-00021c70: 2320 6469 6374 696f 6e61 7279 206b 6579  # dictionary key
-00021c80: 733a 2068 7474 7073 3a2f 2f70 7562 732e  s: https://pubs.
-00021c90: 6f70 656e 6772 6f75 702e 6f72 672f 6f6e  opengroup.org/on
-00021ca0: 6c69 6e65 7075 6273 2f30 3037 3930 3438  linepubs/0079048
-00021cb0: 3735 2f62 6173 6564 6566 732f 7379 732f  75/basedefs/sys/
-00021cc0: 7374 6174 2e68 2e68 746d 6c0a 2020 2020  stat.h.html.    
-00021cd0: 2020 2020 7374 6174 4469 6374 203d 207b      statDict = {
-00021ce0: 2273 745f 2220 2b20 6b65 793a 2067 6574  "st_" + key: get
-00021cf0: 6174 7472 2866 696c 6549 6e66 6f2c 206b  attr(fileInfo, k
-00021d00: 6579 2920 666f 7220 6b65 7920 696e 2028  ey) for key in (
-00021d10: 2773 697a 6527 2c20 276d 7469 6d65 272c  'size', 'mtime',
-00021d20: 2027 6d6f 6465 272c 2027 7569 6427 2c20   'mode', 'uid', 
-00021d30: 2767 6964 2729 7d0a 2020 2020 2020 2020  'gid')}.        
-00021d40: 7374 6174 4469 6374 5b27 7374 5f6d 7469  statDict['st_mti
-00021d50: 6d65 275d 203d 2069 6e74 2873 7461 7444  me'] = int(statD
-00021d60: 6963 745b 2773 745f 6d74 696d 6527 5d29  ict['st_mtime'])
-00021d70: 0a20 2020 2020 2020 2073 7461 7444 6963  .        statDic
-00021d80: 745b 2773 745f 6e6c 696e 6b27 5d20 3d20  t['st_nlink'] = 
-00021d90: 3120 2023 2054 4f44 4f3a 2074 6869 7320  1  # TODO: this 
-00021da0: 6973 2077 726f 6e67 2066 6f72 2066 696c  is wrong for fil
-00021db0: 6573 2077 6974 6820 6861 7264 6c69 6e6b  es with hardlink
-00021dc0: 730a 0a20 2020 2020 2020 2023 2064 7520  s..        # du 
-00021dd0: 6279 2064 6566 6175 6c74 2073 756d 7320  by default sums 
-00021de0: 6469 736b 2075 7361 6765 2028 7468 6520  disk usage (the 
-00021df0: 6e75 6d62 6572 206f 6620 626c 6f63 6b73  number of blocks
-00021e00: 2075 7365 6420 6279 2061 2066 696c 6529   used by a file)
-00021e10: 0a20 2020 2020 2020 2023 2069 6e73 7465  .        # inste
-00021e20: 6164 206f 6620 6669 6c65 2073 697a 6520  ad of file size 
-00021e30: 6469 7265 6374 6c79 2e20 5461 7220 6669  directly. Tar fi
-00021e40: 6c65 7320 6172 6520 7573 7561 6c6c 7920  les are usually 
-00021e50: 6120 7365 7269 6573 206f 6620 3531 3242  a series of 512B
-00021e60: 0a20 2020 2020 2020 2023 2062 6c6f 636b  .        # block
-00021e70: 732c 2073 6f20 7765 2072 6570 6f72 7420  s, so we report 
-00021e80: 6120 312d 626c 6f63 6b20 6865 6164 6572  a 1-block header
-00021e90: 202b 2063 6569 6c28 6669 6c65 7369 7a65   + ceil(filesize
-00021ea0: 202f 2035 3132 292e 0a20 2020 2020 2020   / 512)..       
-00021eb0: 2073 7461 7444 6963 745b 2773 745f 626c   statDict['st_bl
-00021ec0: 6b73 697a 6527 5d20 3d20 3531 320a 2020  ksize'] = 512.  
-00021ed0: 2020 2020 2020 7374 6174 4469 6374 5b27        statDict['
-00021ee0: 7374 5f62 6c6f 636b 7327 5d20 3d20 3120  st_blocks'] = 1 
-00021ef0: 2b20 2828 6669 6c65 496e 666f 2e73 697a  + ((fileInfo.siz
-00021f00: 6520 2b20 3531 3129 202f 2f20 3531 3229  e + 511) // 512)
-00021f10: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00021f20: 2073 7461 7444 6963 740a 0a20 2020 2040   statDict..    @
-00021f30: 6f76 6572 7269 6465 7328 4675 7365 4f70  overrides(FuseOp
-00021f40: 6572 6174 696f 6e73 290a 2020 2020 6465  erations).    de
-00021f50: 6620 7265 6164 6469 7228 7365 6c66 2c20  f readdir(self, 
-00021f60: 7061 7468 3a20 7374 722c 2066 6829 3a0a  path: str, fh):.
-00021f70: 2020 2020 2020 2020 2320 7765 206f 6e6c          # we onl
-00021f80: 7920 6e65 6564 2074 6f20 7265 7475 726e  y need to return
-00021f90: 2074 6865 7365 2073 7065 6369 616c 2064   these special d
-00021fa0: 6972 6563 746f 7269 6573 2e20 4655 5345  irectories. FUSE
-00021fb0: 2061 7574 6f6d 6174 6963 616c 6c79 2065   automatically e
-00021fc0: 7870 616e 6473 2074 6865 7365 2061 6e64  xpands these and
-00021fd0: 2077 696c 6c20 6e6f 7420 6173 6b0a 2020   will not ask.  
-00021fe0: 2020 2020 2020 2320 666f 7220 7061 7468        # for path
-00021ff0: 7320 6c69 6b65 202f 2e2e 2f66 6f6f 2f2e  s like /../foo/.
-00022000: 2f2e 2e2f 6261 722c 2073 6f20 7765 2064  /../bar, so we d
-00022010: 6f6e 2774 206e 6565 6420 746f 2077 6f72  on't need to wor
-00022020: 7279 2061 626f 7574 2063 6c65 616e 696e  ry about cleanin
-00022030: 6720 7375 6368 2070 6174 6873 0a20 2020  g such paths.   
-00022040: 2020 2020 2079 6965 6c64 2027 2e27 0a20       yield '.'. 
-00022050: 2020 2020 2020 2079 6965 6c64 2027 2e2e         yield '..
-00022060: 270a 0a20 2020 2020 2020 2066 696c 6573  '..        files
-00022070: 203d 2073 656c 662e 6d6f 756e 7453 6f75   = self.mountSou
-00022080: 7263 652e 6c69 7374 4469 7228 7061 7468  rce.listDir(path
-00022090: 290a 2020 2020 2020 2020 6966 2066 696c  ).        if fil
-000220a0: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-000220b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000220c0: 6b65 7920 696e 2066 696c 6573 3a0a 2020  key in files:.  
-000220d0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-000220e0: 656c 6420 6b65 790a 0a20 2020 2040 6f76  eld key..    @ov
-000220f0: 6572 7269 6465 7328 4675 7365 4f70 6572  errides(FuseOper
-00022100: 6174 696f 6e73 290a 2020 2020 6465 6620  ations).    def 
-00022110: 7265 6164 6c69 6e6b 2873 656c 662c 2070  readlink(self, p
-00022120: 6174 683a 2073 7472 2920 2d3e 2073 7472  ath: str) -> str
-00022130: 3a0a 2020 2020 2020 2020 6669 6c65 496e  :.        fileIn
-00022140: 666f 203d 2073 656c 662e 6d6f 756e 7453  fo = self.mountS
-00022150: 6f75 7263 652e 6765 7446 696c 6549 6e66  ource.getFileInf
-00022160: 6f28 7061 7468 290a 2020 2020 2020 2020  o(path).        
-00022170: 6966 206e 6f74 2066 696c 6549 6e66 6f3a  if not fileInfo:
-00022180: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00022190: 7365 2066 7573 652e 4675 7365 4f53 4572  se fuse.FuseOSEr
-000221a0: 726f 7228 6675 7365 2e65 7272 6e6f 2e45  ror(fuse.errno.E
-000221b0: 494f 290a 2020 2020 2020 2020 7265 7475  IO).        retu
-000221c0: 726e 2066 696c 6549 6e66 6f2e 6c69 6e6b  rn fileInfo.link
-000221d0: 6e61 6d65 0a0a 2020 2020 406f 7665 7272  name..    @overr
-000221e0: 6964 6573 2846 7573 654f 7065 7261 7469  ides(FuseOperati
-000221f0: 6f6e 7329 0a20 2020 2064 6566 206f 7065  ons).    def ope
-00022200: 6e28 7365 6c66 2c20 7061 7468 2c20 666c  n(self, path, fl
-00022210: 6167 7329 3a0a 2020 2020 2020 2020 2222  ags):.        ""
-00022220: 2252 6574 7572 6e73 2066 696c 6520 6861  "Returns file ha
-00022230: 6e64 6c65 206f 6620 6f70 656e 6564 2070  ndle of opened p
-00022240: 6174 682e 2222 220a 0a20 2020 2020 2020  ath."""..       
-00022250: 2066 696c 6549 6e66 6f20 3d20 7365 6c66   fileInfo = self
-00022260: 2e6d 6f75 6e74 536f 7572 6365 2e67 6574  .mountSource.get
-00022270: 4669 6c65 496e 666f 2870 6174 6829 0a20  FileInfo(path). 
-00022280: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
-00022290: 6c65 496e 666f 3a0a 2020 2020 2020 2020  leInfo:.        
-000222a0: 2020 2020 7261 6973 6520 6675 7365 2e46      raise fuse.F
-000222b0: 7573 654f 5345 7272 6f72 2866 7573 652e  useOSError(fuse.
-000222c0: 6572 726e 6f2e 4549 4f29 0a0a 2020 2020  errno.EIO)..    
-000222d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000222e0: 2020 2020 2073 656c 662e 6c61 7374 4669       self.lastFi
-000222f0: 6c65 4861 6e64 6c65 202b 3d20 310a 2020  leHandle += 1.  
-00022300: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-00022310: 7065 6e65 6446 696c 6573 5b73 656c 662e  penedFiles[self.
-00022320: 6c61 7374 4669 6c65 4861 6e64 6c65 5d20  lastFileHandle] 
-00022330: 3d20 7365 6c66 2e6d 6f75 6e74 536f 7572  = self.mountSour
-00022340: 6365 2e6f 7065 6e28 6669 6c65 496e 666f  ce.open(fileInfo
-00022350: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00022360: 7475 726e 2073 656c 662e 6c61 7374 4669  turn self.lastFi
-00022370: 6c65 4861 6e64 6c65 0a20 2020 2020 2020  leHandle.       
-00022380: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00022390: 6e20 6173 2065 7863 6570 7469 6f6e 3a0a  n as exception:.
-000223a0: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-000223b0: 6562 6163 6b2e 7072 696e 745f 6578 6328  eback.print_exc(
-000223c0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-000223d0: 696e 7428 2243 6175 6768 7420 6578 6365  int("Caught exce
-000223e0: 7074 696f 6e20 7768 656e 2074 7279 696e  ption when tryin
-000223f0: 6720 746f 206f 7065 6e20 6669 6c65 2e22  g to open file."
-00022400: 2c20 6669 6c65 496e 666f 290a 2020 2020  , fileInfo).    
-00022410: 2020 2020 2020 2020 7261 6973 6520 6675          raise fu
-00022420: 7365 2e46 7573 654f 5345 7272 6f72 2866  se.FuseOSError(f
-00022430: 7573 652e 6572 726e 6f2e 4549 4f29 2066  use.errno.EIO) f
-00022440: 726f 6d20 6578 6365 7074 696f 6e0a 0a20  rom exception.. 
-00022450: 2020 2040 6f76 6572 7269 6465 7328 4675     @overrides(Fu
-00022460: 7365 4f70 6572 6174 696f 6e73 290a 2020  seOperations).  
-00022470: 2020 6465 6620 7265 6c65 6173 6528 7365    def release(se
-00022480: 6c66 2c20 7061 7468 2c20 6668 293a 0a20  lf, path, fh):. 
-00022490: 2020 2020 2020 2069 6620 6668 206e 6f74         if fh not
-000224a0: 2069 6e20 7365 6c66 2e6f 7065 6e65 6446   in self.openedF
-000224b0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-000224c0: 2020 7261 6973 6520 6675 7365 2e46 7573    raise fuse.Fus
-000224d0: 654f 5345 7272 6f72 2866 7573 652e 6572  eOSError(fuse.er
-000224e0: 726e 6f2e 4553 5441 4c45 290a 0a20 2020  rno.ESTALE)..   
-000224f0: 2020 2020 2073 656c 662e 6f70 656e 6564       self.opened
-00022500: 4669 6c65 735b 6668 5d2e 636c 6f73 6528  Files[fh].close(
-00022510: 290a 2020 2020 2020 2020 6465 6c20 7365  ).        del se
-00022520: 6c66 2e6f 7065 6e65 6446 696c 6573 5b66  lf.openedFiles[f
-00022530: 685d 0a20 2020 2020 2020 2072 6574 7572  h].        retur
-00022540: 6e20 6668 0a0a 2020 2020 406f 7665 7272  n fh..    @overr
-00022550: 6964 6573 2846 7573 654f 7065 7261 7469  ides(FuseOperati
-00022560: 6f6e 7329 0a20 2020 2064 6566 2072 6561  ons).    def rea
-00022570: 6428 7365 6c66 2c20 7061 7468 3a20 7374  d(self, path: st
-00022580: 722c 2073 697a 653a 2069 6e74 2c20 6f66  r, size: int, of
-00022590: 6673 6574 3a20 696e 742c 2066 683a 2069  fset: int, fh: i
-000225a0: 6e74 2920 2d3e 2062 7974 6573 3a0a 2020  nt) -> bytes:.  
-000225b0: 2020 2020 2020 6966 2066 6820 696e 2073        if fh in s
-000225c0: 656c 662e 6f70 656e 6564 4669 6c65 733a  elf.openedFiles:
-000225d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000225e0: 662e 6f70 656e 6564 4669 6c65 735b 6668  f.openedFiles[fh
-000225f0: 5d2e 7365 656b 286f 6666 7365 742c 206f  ].seek(offset, o
-00022600: 732e 5345 454b 5f53 4554 290a 2020 2020  s.SEEK_SET).    
-00022610: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00022620: 656c 662e 6f70 656e 6564 4669 6c65 735b  elf.openedFiles[
-00022630: 6668 5d2e 7265 6164 2873 697a 6529 0a0a  fh].read(size)..
-00022640: 2020 2020 2020 2020 2320 4173 2066 6172          # As far
-00022650: 2061 7320 4920 756e 6465 7273 7461 6e64   as I understand
-00022660: 2046 5553 4520 616e 6420 6d79 206f 776e   FUSE and my own
-00022670: 2066 696c 6520 6861 6e64 6c65 2063 6163   file handle cac
-00022680: 6865 2c20 7468 6973 2073 686f 756c 6420  he, this should 
-00022690: 6e65 7665 7220 6861 7070 656e 2e20 4275  never happen. Bu
-000226a0: 7420 796f 7520 6e65 7665 7220 6b6e 6f77  t you never know
-000226b0: 2e0a 2020 2020 2020 2020 6966 2070 7269  ..        if pri
-000226c0: 6e74 4465 6275 6720 3e3d 2031 3a0a 2020  ntDebug >= 1:.  
-000226d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000226e0: 225b 5761 726e 696e 675d 2047 6976 656e  "[Warning] Given
-000226f0: 2066 696c 6520 6861 6e64 6c65 2064 6f65   file handle doe
-00022700: 7320 6e6f 7420 6578 6973 742e 2057 696c  s not exist. Wil
-00022710: 6c20 6f70 656e 2066 696c 6520 6265 666f  l open file befo
-00022720: 7265 2072 6561 6469 6e67 2077 6869 6368  re reading which
-00022730: 206d 6967 6874 2062 6520 736c 6f77 2e22   might be slow."
-00022740: 290a 0a20 2020 2020 2020 2066 696c 6549  )..        fileI
-00022750: 6e66 6f20 3d20 7365 6c66 2e6d 6f75 6e74  nfo = self.mount
-00022760: 536f 7572 6365 2e67 6574 4669 6c65 496e  Source.getFileIn
-00022770: 666f 2870 6174 6829 0a20 2020 2020 2020  fo(path).       
-00022780: 2069 6620 6e6f 7420 6669 6c65 496e 666f   if not fileInfo
-00022790: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000227a0: 6973 6520 6675 7365 2e46 7573 654f 5345  ise fuse.FuseOSE
-000227b0: 7272 6f72 2866 7573 652e 6572 726e 6f2e  rror(fuse.errno.
-000227c0: 4549 4f29 0a0a 2020 2020 2020 2020 7472  EIO)..        tr
-000227d0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-000227e0: 6574 7572 6e20 7365 6c66 2e6d 6f75 6e74  eturn self.mount
-000227f0: 536f 7572 6365 2e72 6561 6428 6669 6c65  Source.read(file
-00022800: 496e 666f 2c20 7369 7a65 2c20 6f66 6673  Info, size, offs
-00022810: 6574 290a 2020 2020 2020 2020 6578 6365  et).        exce
-00022820: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00022830: 6578 6365 7074 696f 6e3a 0a20 2020 2020  exception:.     
-00022840: 2020 2020 2020 2074 7261 6365 6261 636b         traceback
-00022850: 2e70 7269 6e74 5f65 7863 2829 0a20 2020  .print_exc().   
-00022860: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00022870: 4361 7567 6874 2065 7863 6570 7469 6f6e  Caught exception
-00022880: 2077 6865 6e20 7472 7969 6e67 2074 6f20   when trying to 
-00022890: 7265 6164 2064 6174 6120 6672 6f6d 2075  read data from u
-000228a0: 6e64 6572 6c79 696e 6720 5441 5220 6669  nderlying TAR fi
-000228b0: 6c65 2120 5265 7475 726e 696e 6720 6572  le! Returning er
-000228c0: 726e 6f2e 4549 4f2e 2229 0a20 2020 2020  rno.EIO.").     
-000228d0: 2020 2020 2020 2072 6169 7365 2066 7573         raise fus
-000228e0: 652e 4675 7365 4f53 4572 726f 7228 6675  e.FuseOSError(fu
-000228f0: 7365 2e65 7272 6e6f 2e45 494f 2920 6672  se.errno.EIO) fr
-00022900: 6f6d 2065 7863 6570 7469 6f6e 0a0a 0a63  om exception...c
-00022910: 6c61 7373 2054 6172 4669 6c65 5479 7065  lass TarFileType
-00022920: 3a0a 2020 2020 2222 220a 2020 2020 5369  :.    """.    Si
-00022930: 6d69 6c61 7220 746f 2061 7267 7061 7273  milar to argpars
-00022940: 652e 4669 6c65 5479 7065 2062 7574 2072  e.FileType but r
-00022950: 6169 7365 7320 616e 2065 7863 6570 7469  aises an excepti
-00022960: 6f6e 2069 6620 6974 2069 7320 6e6f 7420  on if it is not 
-00022970: 6120 7661 6c69 6420 5441 5220 6669 6c65  a valid TAR file
-00022980: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00022990: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-000229a0: 2c20 656e 636f 6469 6e67 3a20 7374 7220  , encoding: str 
-000229b0: 3d20 7461 7266 696c 652e 454e 434f 4449  = tarfile.ENCODI
-000229c0: 4e47 2920 2d3e 204e 6f6e 653a 0a20 2020  NG) -> None:.   
-000229d0: 2020 2020 2073 656c 662e 656e 636f 6469       self.encodi
-000229e0: 6e67 203d 2065 6e63 6f64 696e 670a 0a20  ng = encoding.. 
-000229f0: 2020 2064 6566 205f 5f63 616c 6c5f 5f28     def __call__(
-00022a00: 7365 6c66 2c20 7461 7246 696c 653a 2073  self, tarFile: s
-00022a10: 7472 2920 2d3e 2054 7570 6c65 5b73 7472  tr) -> Tuple[str
-00022a20: 2c20 4f70 7469 6f6e 616c 5b73 7472 5d5d  , Optional[str]]
-00022a30: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-00022a40: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-00022a50: 7461 7246 696c 6529 3a0a 2020 2020 2020  tarFile):.      
-00022a60: 2020 2020 2020 7261 6973 6520 6172 6770        raise argp
-00022a70: 6172 7365 2e41 7267 756d 656e 7454 7970  arse.ArgumentTyp
-00022a80: 6545 7272 6f72 2822 4669 6c65 2027 7b7d  eError("File '{}
-00022a90: 2720 6973 206e 6f74 2061 2066 696c 6521  ' is not a file!
-00022aa0: 222e 666f 726d 6174 2874 6172 4669 6c65  ".format(tarFile
-00022ab0: 2929 0a0a 2020 2020 2020 2020 7769 7468  ))..        with
-00022ac0: 206f 7065 6e28 7461 7246 696c 652c 2027   open(tarFile, '
-00022ad0: 7262 2729 2061 7320 6669 6c65 6f62 6a3a  rb') as fileobj:
-00022ae0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00022af0: 6553 697a 6520 3d20 6f73 2e73 7461 7428  eSize = os.stat(
-00022b00: 7461 7246 696c 6529 2e73 745f 7369 7a65  tarFile).st_size
-00022b10: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00022b20: 4865 6164 6572 2063 6865 636b 7320 6172  Header checks ar
-00022b30: 6520 656e 6f75 6768 2066 6f72 2074 6869  e enough for thi
-00022b40: 7320 7374 6570 2e0a 2020 2020 2020 2020  s step..        
-00022b50: 2020 2020 6f6c 644f 6666 7365 7420 3d20      oldOffset = 
-00022b60: 6669 6c65 6f62 6a2e 7465 6c6c 2829 0a20  fileobj.tell(). 
-00022b70: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
-00022b80: 6573 7369 6f6e 203d 204e 6f6e 650a 2020  ession = None.  
-00022b90: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00022ba0: 6d70 7265 7373 696f 6e49 642c 2063 6f6d  mpressionId, com
-00022bb0: 7072 6573 7369 6f6e 496e 666f 2069 6e20  pressionInfo in 
-00022bc0: 7375 7070 6f72 7465 6443 6f6d 7072 6573  supportedCompres
-00022bd0: 7369 6f6e 732e 6974 656d 7328 293a 0a20  sions.items():. 
-00022be0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00022bf0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00022c00: 2020 2020 2020 2020 6966 2063 6f6d 7072          if compr
-00022c10: 6573 7369 6f6e 496e 666f 2e63 6865 636b  essionInfo.check
-00022c20: 4865 6164 6572 2866 696c 656f 626a 293a  Header(fileobj):
-00022c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022c40: 2020 2020 2020 2020 2063 6f6d 7072 6573           compres
-00022c50: 7369 6f6e 203d 2063 6f6d 7072 6573 7369  sion = compressi
-00022c60: 6f6e 4964 0a20 2020 2020 2020 2020 2020  onId.           
-00022c70: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00022c80: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00022c90: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
-00022ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022cb0: 6669 6c65 6f62 6a2e 7365 656b 286f 6c64  fileobj.seek(old
-00022cc0: 4f66 6673 6574 290a 0a20 2020 2020 2020  Offset)..       
-00022cd0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00022ce0: 2020 2020 2020 2020 2020 2320 4465 7465            # Dete
-00022cf0: 726d 696e 696e 6720 6966 2074 6865 7265  rmining if there
-00022d00: 2061 7265 206d 616e 7920 6672 616d 6573   are many frames
-00022d10: 2069 6e20 7a73 7464 2069 7320 4f28 3129   in zstd is O(1)
-00022d20: 2077 6974 6820 6973 5f6d 756c 7469 6672   with is_multifr
-00022d30: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00022d40: 2020 2020 6966 2063 6f6d 7072 6573 7369      if compressi
-00022d50: 6f6e 2021 3d20 277a 7374 2720 6f72 2073  on != 'zst' or s
-00022d60: 7570 706f 7274 6564 436f 6d70 7265 7373  upportedCompress
-00022d70: 696f 6e73 5b63 6f6d 7072 6573 7369 6f6e  ions[compression
-00022d80: 5d2e 6d6f 6475 6c65 4e61 6d65 206e 6f74  ].moduleName not
-00022d90: 2069 6e20 7379 732e 6d6f 6475 6c65 733a   in sys.modules:
-00022da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022db0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-00022dc0: 7469 6f6e 2829 2020 2320 6561 726c 7920  tion()  # early 
-00022dd0: 6578 6974 2062 6563 6175 7365 2077 6520  exit because we 
-00022de0: 6361 7463 6820 6974 206f 7572 7365 6c66  catch it ourself
-00022df0: 2061 6e79 7761 7973 0a0a 2020 2020 2020   anyways..      
-00022e00: 2020 2020 2020 2020 2020 7a73 7464 4669            zstdFi
-00022e10: 6c65 203d 2073 7570 706f 7274 6564 436f  le = supportedCo
-00022e20: 6d70 7265 7373 696f 6e73 5b63 6f6d 7072  mpressions[compr
-00022e30: 6573 7369 6f6e 5d2e 6f70 656e 2866 696c  ession].open(fil
-00022e40: 656f 626a 290a 0a20 2020 2020 2020 2020  eobj)..         
-00022e50: 2020 2020 2020 2069 6620 6e6f 7420 7a73         if not zs
-00022e60: 7464 4669 6c65 2e69 735f 6d75 6c74 6966  tdFile.is_multif
-00022e70: 7261 6d65 2829 2061 6e64 2066 696c 6553  rame() and fileS
-00022e80: 697a 6520 3e20 3130 3234 202a 2031 3032  ize > 1024 * 102
-00022e90: 343a 0a20 2020 2020 2020 2020 2020 2020  4:.             
-00022ea0: 2020 2020 2020 2070 7269 6e74 2822 5b57         print("[W
-00022eb0: 6172 6e69 6e67 5d20 5468 6520 7370 6563  arning] The spec
-00022ec0: 6966 6965 6420 6669 6c65 2027 7b7d 2722  ified file '{}'"
-00022ed0: 2e66 6f72 6d61 7428 7461 7246 696c 6529  .format(tarFile)
-00022ee0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00022ef0: 2020 2020 2020 7072 696e 7428 225b 5761        print("[Wa
-00022f00: 726e 696e 675d 2069 7320 636f 6d70 7265  rning] is compre
-00022f10: 7373 6564 2075 7369 6e67 207a 7374 6420  ssed using zstd 
-00022f20: 6275 7420 6f6e 6c79 2063 6f6e 7461 696e  but only contain
-00022f30: 7320 6f6e 6520 7a73 7464 2066 7261 6d65  s one zstd frame
-00022f40: 2e20 5468 6973 206d 616b 6573 2069 7420  . This makes it 
-00022f50: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00022f60: 2020 2020 2020 2070 7269 6e74 2822 5b57         print("[W
-00022f70: 6172 6e69 6e67 5d20 696d 706f 7373 6962  arning] impossib
-00022f80: 6c65 2074 6f20 7573 6520 7472 7565 2073  le to use true s
-00022f90: 6565 6b69 6e67 2120 506c 6561 7365 2028  eeking! Please (
-00022fa0: 7265 2963 6f6d 7072 6573 7320 796f 7572  re)compress your
-00022fb0: 2054 4152 2075 7369 6e67 206d 756c 7469   TAR using multi
-00022fc0: 706c 6520 2229 0a20 2020 2020 2020 2020  ple ").         
-00022fd0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00022fe0: 2822 5b57 6172 6e69 6e67 5d20 6672 616d  ("[Warning] fram
-00022ff0: 6573 2069 6e20 6f72 6465 7220 666f 7220  es in order for 
-00023000: 7261 7461 726d 6f75 6e74 2074 6f20 646f  ratarmount to do
-00023010: 2062 6520 6162 6c65 2074 6f20 646f 2066   be able to do f
-00023020: 6173 7420 7365 656b 696e 6720 746f 2072  ast seeking to r
-00023030: 6571 7565 7374 6564 2022 290a 2020 2020  equested ").    
-00023040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023050: 7072 696e 7428 225b 5761 726e 696e 675d  print("[Warning]
-00023060: 2066 696c 6573 2e20 456c 7365 2c20 6561   files. Else, ea
-00023070: 6368 2066 696c 6520 6163 6365 7373 2077  ch file access w
-00023080: 696c 6c20 6465 636f 6d70 7265 7373 2074  ill decompress t
-00023090: 6865 2077 686f 6c65 2054 4152 2066 726f  he whole TAR fro
-000230a0: 6d20 7468 6520 6265 6769 6e6e 696e 6721  m the beginning!
-000230b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000230c0: 2020 2020 2020 2070 7269 6e74 2822 5b57         print("[W
-000230d0: 6172 6e69 6e67 5d20 596f 7520 6361 6e20  arning] You can 
-000230e0: 7472 7920 6f75 7420 7432 737a 2066 6f72  try out t2sz for
-000230f0: 2063 7265 6174 696e 6720 7375 6368 2061   creating such a
-00023100: 7263 6869 7665 733a 2229 0a20 2020 2020  rchives:").     
-00023110: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00023120: 7269 6e74 2822 5b57 6172 6e69 6e67 5d20  rint("[Warning] 
-00023130: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00023140: 6f6d 2f6d 6172 7469 6e65 6c6c 696d 6172  om/martinellimar
-00023150: 636f 2f74 3273 7a22 290a 2020 2020 2020  co/t2sz").      
-00023160: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00023170: 696e 7428 225b 5761 726e 696e 675d 2048  int("[Warning] H
-00023180: 6572 6520 796f 7520 6361 6e20 6669 6e64  ere you can find
-00023190: 2061 2073 696d 706c 6520 6261 7368 2073   a simple bash s
-000231a0: 6372 6970 7420 6465 6d6f 6e73 7472 6174  cript demonstrat
-000231b0: 696e 6720 686f 7720 746f 2064 6f20 7468  ing how to do th
-000231c0: 6973 3a22 290a 2020 2020 2020 2020 2020  is:").          
-000231d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000231e0: 225b 5761 726e 696e 675d 2068 7474 7073  "[Warning] https
-000231f0: 3a2f 2f67 6974 6875 622e 636f 6d2f 6d78  ://github.com/mx
-00023200: 6d6c 6e6b 6e2f 7261 7461 726d 6f75 6e74  mlnkn/ratarmount
-00023210: 2378 7a2d 616e 642d 7a73 742d 6669 6c65  #xz-and-zst-file
-00023220: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
-00023230: 2020 2020 2020 2020 7072 696e 7428 290a          print().
-00023240: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00023250: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00023260: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00023270: 7373 0a0a 2020 2020 2020 2020 2020 2020  ss..            
-00023280: 6966 2063 6f6d 7072 6573 7369 6f6e 206e  if compression n
-00023290: 6f74 2069 6e20 7375 7070 6f72 7465 6443  ot in supportedC
-000232a0: 6f6d 7072 6573 7369 6f6e 733a 0a20 2020  ompressions:.   
-000232b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000232c0: 5351 4c69 7465 496e 6465 7865 6454 6172  SQLiteIndexedTar
-000232d0: 2e5f 6465 7465 6374 5461 7228 6669 6c65  ._detectTar(file
-000232e0: 6f62 6a2c 2073 656c 662e 656e 636f 6469  obj, self.encodi
-000232f0: 6e67 293a 0a20 2020 2020 2020 2020 2020  ng):.           
-00023300: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00023310: 7461 7246 696c 652c 2063 6f6d 7072 6573  tarFile, compres
-00023320: 7369 6f6e 0a0a 2020 2020 2020 2020 2020  sion..          
-00023330: 2020 2020 2020 6966 2070 7269 6e74 4465        if printDe
-00023340: 6275 6720 3e3d 2032 3a0a 2020 2020 2020  bug >= 2:.      
-00023350: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00023360: 696e 7428 6622 4172 6368 6976 6520 277b  int(f"Archive '{
-00023370: 7461 7246 696c 657d 2720 2863 6f6d 7072  tarFile}' (compr
-00023380: 6573 7369 6f6e 3a20 7b63 6f6d 7072 6573  ession: {compres
-00023390: 7369 6f6e 7d29 2063 616e 2774 2062 6520  sion}) can't be 
-000233a0: 6f70 656e 6564 2122 290a 0a20 2020 2020  opened!")..     
-000233b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000233c0: 2061 7267 7061 7273 652e 4172 6775 6d65   argparse.Argume
-000233d0: 6e74 5479 7065 4572 726f 7228 2241 7263  ntTypeError("Arc
-000233e0: 6869 7665 2027 7b7d 2720 6361 6e27 7420  hive '{}' can't 
-000233f0: 6265 206f 7065 6e65 6421 5c6e 222e 666f  be opened!\n".fo
-00023400: 726d 6174 2874 6172 4669 6c65 2929 0a0a  rmat(tarFile))..
-00023410: 2020 2020 2020 2020 6369 6e66 6f20 3d20          cinfo = 
-00023420: 7375 7070 6f72 7465 6443 6f6d 7072 6573  supportedCompres
-00023430: 7369 6f6e 735b 636f 6d70 7265 7373 696f  sions[compressio
-00023440: 6e5d 0a20 2020 2020 2020 2069 6620 6369  n].        if ci
-00023450: 6e66 6f2e 6d6f 6475 6c65 4e61 6d65 206e  nfo.moduleName n
-00023460: 6f74 2069 6e20 7379 732e 6d6f 6475 6c65  ot in sys.module
-00023470: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00023480: 6169 7365 2061 7267 7061 7273 652e 4172  aise argparse.Ar
-00023490: 6775 6d65 6e74 5479 7065 4572 726f 7228  gumentTypeError(
-000234a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000234b0: 2022 4361 6e27 7420 6f70 656e 2061 207b   "Can't open a {
-000234c0: 7d20 636f 6d70 7265 7373 6564 2054 4152  } compressed TAR
-000234d0: 2066 696c 6520 277b 7d27 2077 6974 686f   file '{}' witho
-000234e0: 7574 207b 7d20 6d6f 6475 6c65 2122 2e66  ut {} module!".f
-000234f0: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
-00023500: 2020 2020 2020 2020 2020 2063 6f6d 7072             compr
-00023510: 6573 7369 6f6e 2c20 6669 6c65 6f62 6a2e  ession, fileobj.
-00023520: 6e61 6d65 2c20 6369 6e66 6f2e 6d6f 6475  name, cinfo.modu
-00023530: 6c65 4e61 6d65 0a20 2020 2020 2020 2020  leName.         
-00023540: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00023550: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00023560: 7265 7475 726e 2074 6172 4669 6c65 2c20  return tarFile, 
-00023570: 636f 6d70 7265 7373 696f 6e0a 0a0a 6465  compression...de
-00023580: 6620 5f72 656d 6f76 6544 7570 6c69 6361  f _removeDuplica
-00023590: 7465 7353 7461 626c 6528 6974 6572 6162  tesStable(iterab
-000235a0: 6c65 3a20 4974 6572 6162 6c65 293a 0a20  le: Iterable):. 
-000235b0: 2020 2073 6565 6e20 3d20 7365 7428 290a     seen = set().
-000235c0: 2020 2020 6465 6475 706c 6963 6174 6564      deduplicated
-000235d0: 203d 205b 5d0a 2020 2020 666f 7220 7820   = [].    for x 
-000235e0: 696e 2069 7465 7261 626c 653a 0a20 2020  in iterable:.   
-000235f0: 2020 2020 2069 6620 7820 6e6f 7420 696e       if x not in
-00023600: 2073 6565 6e3a 0a20 2020 2020 2020 2020   seen:.         
-00023610: 2020 2064 6564 7570 6c69 6361 7465 642e     deduplicated.
-00023620: 6170 7065 6e64 2878 290a 2020 2020 2020  append(x).      
-00023630: 2020 2020 2020 7365 656e 2e61 6464 2878        seen.add(x
-00023640: 290a 2020 2020 7265 7475 726e 2064 6564  ).    return ded
-00023650: 7570 6c69 6361 7465 640a 0a0a 636c 6173  uplicated...clas
-00023660: 7320 5f43 7573 746f 6d46 6f72 6d61 7474  s _CustomFormatt
-00023670: 6572 2861 7267 7061 7273 652e 4172 6775  er(argparse.Argu
-00023680: 6d65 6e74 4465 6661 756c 7473 4865 6c70  mentDefaultsHelp
-00023690: 466f 726d 6174 7465 722c 2061 7267 7061  Formatter, argpa
-000236a0: 7273 652e 5261 7744 6573 6372 6970 7469  rse.RawDescripti
-000236b0: 6f6e 4865 6c70 466f 726d 6174 7465 7229  onHelpFormatter)
-000236c0: 3a0a 2020 2020 6465 6620 6164 645f 6172  :.    def add_ar
-000236d0: 6775 6d65 6e74 7328 7365 6c66 2c20 6163  guments(self, ac
-000236e0: 7469 6f6e 7329 3a0a 2020 2020 2020 2020  tions):.        
-000236f0: 6163 7469 6f6e 7320 3d20 736f 7274 6564  actions = sorted
-00023700: 2861 6374 696f 6e73 2c20 6b65 793d 6c61  (actions, key=la
-00023710: 6d62 6461 2078 3a20 6765 7461 7474 7228  mbda x: getattr(
-00023720: 782c 2027 6f70 7469 6f6e 5f73 7472 696e  x, 'option_strin
-00023730: 6773 2729 290a 2020 2020 2020 2020 7375  gs')).        su
-00023740: 7065 7228 292e 6164 645f 6172 6775 6d65  per().add_argume
-00023750: 6e74 7328 6163 7469 6f6e 7329 0a0a 0a64  nts(actions)...d
-00023760: 6566 205f 7061 7273 6541 7267 7328 7261  ef _parseArgs(ra
-00023770: 7741 7267 733a 204f 7074 696f 6e61 6c5b  wArgs: Optional[
-00023780: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
-00023790: 6529 3a0a 2020 2020 7061 7273 6572 203d  e):.    parser =
-000237a0: 2061 7267 7061 7273 652e 4172 6775 6d65   argparse.Argume
-000237b0: 6e74 5061 7273 6572 280a 2020 2020 2020  ntParser(.      
-000237c0: 2020 666f 726d 6174 7465 725f 636c 6173    formatter_clas
-000237d0: 733d 5f43 7573 746f 6d46 6f72 6d61 7474  s=_CustomFormatt
-000237e0: 6572 2c0a 2020 2020 2020 2020 6465 7363  er,.        desc
-000237f0: 7269 7074 696f 6e3d 2727 275c 0a57 6974  ription='''\.Wit
-00023800: 6820 7261 7461 726d 6f75 6e74 2c20 796f  h ratarmount, yo
-00023810: 7520 6361 6e3a 0a20 202d 204d 6f75 6e74  u can:.  - Mount
-00023820: 2061 2028 636f 6d70 7265 7373 6564 2920   a (compressed) 
-00023830: 5441 5220 6669 6c65 2074 6f20 6120 666f  TAR file to a fo
-00023840: 6c64 6572 2066 6f72 2072 6561 642d 6f6e  lder for read-on
-00023850: 6c79 2061 6363 6573 730a 2020 2d20 4d6f  ly access.  - Mo
-00023860: 756e 7420 6120 636f 6d70 7265 7373 6564  unt a compressed
-00023870: 2066 696c 6520 746f 2060 3c6d 6f75 6e74   file to `<mount
-00023880: 706f 696e 743e 2f3c 6669 6c65 6e61 6d65  point>/<filename
-00023890: 3e60 0a20 202d 2042 696e 6420 6d6f 756e  >`.  - Bind moun
-000238a0: 7420 6120 666f 6c64 6572 2074 6f20 616e  t a folder to an
-000238b0: 6f74 6865 7220 666f 6c64 6572 2066 6f72  other folder for
-000238c0: 2072 6561 642d 6f6e 6c79 2061 6363 6573   read-only acces
-000238d0: 730a 2020 2d20 556e 696f 6e20 6d6f 756e  s.  - Union moun
-000238e0: 7420 6120 6c69 7374 206f 6620 5441 5273  t a list of TARs
-000238f0: 2c20 636f 6d70 7265 7373 6564 2066 696c  , compressed fil
-00023900: 6573 2c20 616e 6420 666f 6c64 6572 7320  es, and folders 
-00023910: 746f 2061 206d 6f75 6e74 2070 6f69 6e74  to a mount point
-00023920: 0a20 2020 2066 6f72 2072 6561 642d 6f6e  .    for read-on
-00023930: 6c79 2061 6363 6573 730a 2727 272c 0a20  ly access.''',. 
-00023940: 2020 2020 2020 2065 7069 6c6f 673d 2727         epilog=''
-00023950: 275c 0a23 204d 6574 6164 6174 6120 496e  '\.# Metadata In
-00023960: 6465 7820 4361 6368 650a 0a49 6e20 6f72  dex Cache..In or
-00023970: 6465 7220 746f 2072 6564 7563 6520 7468  der to reduce th
-00023980: 6520 6d6f 756e 7469 6e67 2074 696d 652c  e mounting time,
-00023990: 2074 6865 2063 7265 6174 6564 2069 6e64   the created ind
-000239a0: 6578 2066 6f72 2072 616e 646f 6d20 6163  ex for random ac
-000239b0: 6365 7373 0a74 6f20 6669 6c65 7320 696e  cess.to files in
-000239c0: 7369 6465 2074 6865 2074 6172 2077 696c  side the tar wil
-000239d0: 6c20 6265 2073 6176 6564 2074 6f20 6f6e  l be saved to on
-000239e0: 6520 6f66 2074 6865 7365 206c 6f63 6174  e of these locat
-000239f0: 696f 6e73 2e20 5468 6573 650a 6c6f 6361  ions. These.loca
-00023a00: 7469 6f6e 7320 6172 6520 6368 6563 6b65  tions are checke
-00023a10: 6420 696e 206f 7264 6572 2061 6e64 2074  d in order and t
-00023a20: 6865 2066 6972 7374 2c20 7768 6963 6820  he first, which 
-00023a30: 776f 726b 7320 7375 6666 6963 6965 6e74  works sufficient
-00023a40: 6c79 2c20 7769 6c6c 0a62 6520 7573 6564  ly, will.be used
-00023a50: 2e20 5468 6973 2069 7320 7468 6520 6465  . This is the de
-00023a60: 6661 756c 7420 6c6f 6361 7469 6f6e 206f  fault location o
-00023a70: 7264 6572 3a0a 0a20 2031 2e20 3c70 6174  rder:..  1. <pat
-00023a80: 6820 746f 2074 6172 3e2e 696e 6465 782e  h to tar>.index.
-00023a90: 7371 6c69 7465 0a20 2032 2e20 7e2f 2e72  sqlite.  2. ~/.r
-00023aa0: 6174 6172 6d6f 756e 742f 3c70 6174 6820  atarmount/<path 
-00023ab0: 746f 2074 6172 3a20 272f 2720 2d3e 2027  to tar: '/' -> '
-00023ac0: 5f27 3e2e 696e 6465 782e 7371 6c69 7465  _'>.index.sqlite
-00023ad0: 0a20 2020 2020 452e 672e 2c20 7e2f 2e72  .     E.g., ~/.r
-00023ae0: 6174 6172 6d6f 756e 742f 5f6d 6564 6961  atarmount/_media
-00023af0: 5f63 6472 6f6d 5f70 726f 6772 616d 6d2e  _cdrom_programm.
-00023b00: 7461 722e 696e 6465 782e 7371 6c69 7465  tar.index.sqlite
-00023b10: 0a0a 5468 6973 206c 6973 7420 6f66 2066  ..This list of f
-00023b20: 616c 6c62 6163 6b20 666f 6c64 6572 7320  allback folders 
-00023b30: 6361 6e20 6265 206f 7665 7277 7269 7474  can be overwritt
-00023b40: 656e 2075 7369 6e67 2074 6865 2060 2d2d  en using the `--
-00023b50: 696e 6465 782d 666f 6c64 6572 7360 0a6f  index-folders`.o
-00023b60: 7074 696f 6e2e 2046 7572 7468 6572 6d6f  ption. Furthermo
-00023b70: 7265 2c20 616e 2065 7870 6c69 6369 746c  re, an explicitl
-00023b80: 7920 6e61 6d65 6420 696e 6465 7820 6669  y named index fi
-00023b90: 6c65 206d 6179 2062 6520 7370 6563 6966  le may be specif
-00023ba0: 6965 6420 7573 696e 670a 7468 6520 602d  ied using.the `-
-00023bb0: 2d69 6e64 6578 2d66 696c 6560 206f 7074  -index-file` opt
-00023bc0: 696f 6e2e 2049 6620 602d 2d69 6e64 6578  ion. If `--index
-00023bd0: 2d66 696c 6560 2069 7320 7573 6564 2c20  -file` is used, 
-00023be0: 7468 656e 2074 6865 2066 616c 6c62 6163  then the fallbac
-00023bf0: 6b0a 666f 6c64 6572 732c 2069 6e63 6c75  k.folders, inclu
-00023c00: 6469 6e67 2074 6865 2064 6566 6175 6c74  ding the default
-00023c10: 206f 6e65 732c 2077 696c 6c20 6265 2069   ones, will be i
-00023c20: 676e 6f72 6564 210a 0a23 2042 696e 6420  gnored!..# Bind 
-00023c30: 4d6f 756e 7469 6e67 0a0a 5468 6520 6d6f  Mounting..The mo
-00023c40: 756e 7420 736f 7572 6365 7320 6361 6e20  unt sources can 
-00023c50: 6265 2054 4152 7320 616e 642f 6f72 2066  be TARs and/or f
-00023c60: 6f6c 6465 7273 2e20 2042 6563 6175 7365  olders.  Because
-00023c70: 206f 6620 7468 6174 2c20 7261 7461 726d   of that, ratarm
-00023c80: 6f75 6e74 0a63 616e 2061 6c73 6f20 6265  ount.can also be
-00023c90: 2075 7365 6420 746f 2062 696e 6420 6d6f   used to bind mo
-00023ca0: 756e 7420 666f 6c64 6572 7320 7265 6164  unt folders read
-00023cb0: 2d6f 6e6c 7920 746f 2061 6e6f 7468 6572  -only to another
-00023cc0: 2070 6174 6820 7369 6d69 6c61 7220 746f   path similar to
-00023cd0: 0a60 6269 6e64 6673 6020 616e 6420 606d  .`bindfs` and `m
-00023ce0: 6f75 6e74 202d 2d62 696e 6460 2e20 536f  ount --bind`. So
-00023cf0: 2c20 666f 723a 0a0a 2020 2020 7261 7461  , for:..    rata
-00023d00: 726d 6f75 6e74 2066 6f6c 6465 7220 6d6f  rmount folder mo
-00023d10: 756e 7470 6f69 6e74 0a0a 616c 6c20 6669  untpoint..all fi
-00023d20: 6c65 7320 696e 2060 666f 6c64 6572 6020  les in `folder` 
-00023d30: 7769 6c6c 206e 6f77 2062 6520 7669 7369  will now be visi
-00023d40: 626c 6520 696e 206d 6f75 6e74 706f 696e  ble in mountpoin
-00023d50: 742e 0a0a 2320 556e 696f 6e20 4d6f 756e  t...# Union Moun
-00023d60: 7469 6e67 0a0a 4966 206d 756c 7469 706c  ting..If multipl
-00023d70: 6520 6d6f 756e 7420 736f 7572 6365 7320  e mount sources 
-00023d80: 6172 6520 7370 6563 6966 6965 642c 2074  are specified, t
-00023d90: 6865 2073 6f75 7263 6573 206f 6e20 7468  he sources on th
-00023da0: 6520 7269 6768 7420 7369 6465 2077 696c  e right side wil
-00023db0: 6c20 6265 0a61 6464 6564 2074 6f20 6f72  l be.added to or
-00023dc0: 2075 7064 6174 6520 6578 6973 7469 6e67   update existing
-00023dd0: 2066 696c 6573 2066 726f 6d20 6120 6d6f   files from a mo
-00023de0: 756e 7420 736f 7572 6365 206c 6566 7420  unt source left 
-00023df0: 6f66 2069 742e 2046 6f72 2065 7861 6d70  of it. For examp
-00023e00: 6c65 3a0a 0a20 2020 2072 6174 6172 6d6f  le:..    ratarmo
-00023e10: 756e 7420 666f 6c64 6572 3120 666f 6c64  unt folder1 fold
-00023e20: 6572 3220 6d6f 756e 7470 6f69 6e74 0a0a  er2 mountpoint..
-00023e30: 7769 6c6c 206d 616b 6520 626f 7468 2c20  will make both, 
-00023e40: 7468 6520 6669 6c65 7320 6672 6f6d 2066  the files from f
-00023e50: 6f6c 6465 7231 2061 6e64 2066 6f6c 6465  older1 and folde
-00023e60: 7232 2c20 7669 7369 626c 6520 696e 206d  r2, visible in m
-00023e70: 6f75 6e74 706f 696e 742e 0a49 6620 6120  ountpoint..If a 
-00023e80: 6669 6c65 2065 7869 7374 7320 696e 2062  file exists in b
-00023e90: 6f74 6820 6d75 6c74 6970 6c65 2073 6f75  oth multiple sou
-00023ea0: 7263 652c 2074 6865 6e20 7468 6520 6669  rce, then the fi
-00023eb0: 6c65 2066 726f 6d20 7468 6520 7269 6768  le from the righ
-00023ec0: 746d 6f73 740a 6d6f 756e 7420 736f 7572  tmost.mount sour
-00023ed0: 6365 2077 696c 6c20 6265 2075 7365 642c  ce will be used,
-00023ee0: 2077 6869 6368 2069 6e20 7468 6520 6162   which in the ab
-00023ef0: 6f76 6520 6578 616d 706c 6520 776f 756c  ove example woul
-00023f00: 6420 6265 2060 666f 6c64 6572 3260 2e0a  d be `folder2`..
-00023f10: 0a49 6620 796f 7520 7761 6e74 2074 6f20  .If you want to 
-00023f20: 7570 6461 7465 202f 206f 7665 7277 7269  update / overwri
-00023f30: 7465 2061 2066 6f6c 6465 7220 7769 7468  te a folder with
-00023f40: 2074 6865 2063 6f6e 7465 6e74 7320 6f66   the contents of
-00023f50: 2061 2067 6976 656e 2054 4152 2c0a 796f   a given TAR,.yo
-00023f60: 7520 6361 6e20 7370 6563 6966 7920 7468  u can specify th
-00023f70: 6520 666f 6c64 6572 2062 6f74 6820 6173  e folder both as
-00023f80: 2061 206d 6f75 6e74 2073 6f75 7263 6520   a mount source 
-00023f90: 616e 6420 6173 2074 6865 206d 6f75 6e74  and as the mount
-00023fa0: 2070 6f69 6e74 3a0a 0a20 2020 2072 6174   point:..    rat
-00023fb0: 6172 6d6f 756e 7420 666f 6c64 6572 2066  armount folder f
-00023fc0: 696c 652e 7461 7220 666f 6c64 6572 0a0a  ile.tar folder..
-00023fd0: 5468 6520 4655 5345 206f 7074 696f 6e20  The FUSE option 
-00023fe0: 2d6f 206e 6f6e 656d 7074 7920 7769 6c6c  -o nonempty will
-00023ff0: 2062 6520 6175 746f 6d61 7469 6361 6c6c   be automaticall
-00024000: 7920 6164 6465 6420 6966 2073 7563 6820  y added if such 
-00024010: 6120 7573 6167 6520 6973 0a64 6574 6563  a usage is.detec
-00024020: 7465 642e 2049 6620 796f 7520 696e 7374  ted. If you inst
-00024030: 6561 6420 7761 6e74 2074 6f20 7570 6461  ead want to upda
-00024040: 7465 2061 2054 4152 2077 6974 6820 6120  te a TAR with a 
-00024050: 666f 6c64 6572 2c20 796f 7520 6f6e 6c79  folder, you only
-00024060: 2068 6176 6520 746f 0a73 7761 7020 7468   have to.swap th
-00024070: 6520 7477 6f20 6d6f 756e 7420 736f 7572  e two mount sour
-00024080: 6365 733a 0a0a 2020 2020 7261 7461 726d  ces:..    ratarm
-00024090: 6f75 6e74 2066 696c 652e 7461 7220 666f  ount file.tar fo
-000240a0: 6c64 6572 2066 6f6c 6465 720a 0a23 2046  lder folder..# F
-000240b0: 696c 6520 7665 7273 696f 6e73 0a0a 4966  ile versions..If
-000240c0: 2061 2066 696c 6520 6578 6973 7473 206d   a file exists m
-000240d0: 756c 7469 706c 6520 7469 6d65 7320 696e  ultiple times in
-000240e0: 2061 2054 4152 206f 7220 696e 206d 756c   a TAR or in mul
-000240f0: 7469 706c 6520 6d6f 756e 7420 736f 7572  tiple mount sour
-00024100: 6365 732c 2074 6865 6e0a 7468 6520 6869  ces, then.the hi
-00024110: 6464 656e 2076 6572 7369 6f6e 7320 6361  dden versions ca
-00024120: 6e20 6265 2061 6363 6573 7365 6420 7468  n be accessed th
-00024130: 726f 7567 6820 7370 6563 6961 6c20 3c66  rough special <f
-00024140: 696c 653e 2e76 6572 7369 6f6e 7320 666f  ile>.versions fo
-00024150: 6c64 6572 732e 0a46 6f72 2065 7861 6d70  lders..For examp
-00024160: 6c65 2c20 636f 6e73 6964 6572 3a0a 0a20  le, consider:.. 
-00024170: 2020 2072 6174 6172 6d6f 756e 7420 666f     ratarmount fo
-00024180: 6c64 6572 2075 7064 6174 6564 2e74 6172  lder updated.tar
-00024190: 206d 6f75 6e74 706f 696e 740a 0a61 6e64   mountpoint..and
-000241a0: 2074 6865 2066 696c 6520 6066 6f6f 6020   the file `foo` 
-000241b0: 6578 6973 7473 2062 6f74 6820 696e 2074  exists both in t
-000241c0: 6865 2066 6f6c 6465 7220 616e 6420 6173  he folder and as
-000241d0: 2074 776f 2064 6966 6665 7265 6e74 2076   two different v
-000241e0: 6572 7369 6f6e 730a 696e 2060 7570 6461  ersions.in `upda
-000241f0: 7465 642e 7461 7260 2e20 5468 656e 2c20  ted.tar`. Then, 
-00024200: 796f 7520 6361 6e20 6c69 7374 2061 6c6c  you can list all
-00024210: 2074 6872 6565 2076 6572 7369 6f6e 7320   three versions 
-00024220: 7573 696e 673a 0a0a 2020 2020 6c73 202d  using:..    ls -
-00024230: 6c61 206d 6f75 6e74 706f 696e 742f 666f  la mountpoint/fo
-00024240: 6f2e 7665 7273 696f 6e73 2f0a 2020 2020  o.versions/.    
-00024250: 2020 2020 6472 2d78 722d 7872 2d78 2032      dr-xr-xr-x 2
-00024260: 2075 7365 7220 6772 6f75 7020 2020 2020   user group     
-00024270: 3020 4170 7220 3235 2032 313a 3431 202e  0 Apr 25 21:41 .
-00024280: 0a20 2020 2020 2020 2064 722d 782d 2d2d  .        dr-x---
-00024290: 2d2d 2d20 3220 7573 6572 2067 726f 7570  --- 2 user group
-000242a0: 2031 3032 3430 2041 7072 2032 3620 3135   10240 Apr 26 15
-000242b0: 3a35 3920 2e2e 0a20 2020 2020 2020 202d  :59 ...        -
-000242c0: 722d 782d 2d2d 2d2d 2d20 3220 7573 6572  r-x------ 2 user
-000242d0: 2067 726f 7570 2020 2031 3233 2041 7072   group   123 Apr
-000242e0: 2032 3520 3231 3a34 3120 310a 2020 2020   25 21:41 1.    
-000242f0: 2020 2020 2d72 2d78 2d2d 2d2d 2d2d 2032      -r-x------ 2
-00024300: 2075 7365 7220 6772 6f75 7020 2020 3235   user group   25
-00024310: 3620 4170 7220 3235 2032 313a 3533 2032  6 Apr 25 21:53 2
-00024320: 0a20 2020 2020 2020 202d 722d 782d 2d2d  .        -r-x---
-00024330: 2d2d 2d20 3220 7573 6572 2067 726f 7570  --- 2 user group
-00024340: 2020 3130 3234 2041 7072 2032 3520 3232    1024 Apr 25 22
-00024350: 3a31 3320 330a 0a49 6e20 7468 6973 2065  :13 3..In this e
-00024360: 7861 6d70 6c65 2c20 7468 6520 6f6c 6465  xample, the olde
-00024370: 7374 2076 6572 7369 6f6e 2068 6173 206f  st version has o
-00024380: 6e6c 7920 3132 3320 6279 7465 7320 7768  nly 123 bytes wh
-00024390: 696c 6520 7468 6520 6e65 7765 7374 2061  ile the newest a
-000243a0: 6e64 0a62 7920 6465 6661 756c 7420 7368  nd.by default sh
-000243b0: 6f77 6e20 7665 7273 696f 6e20 6861 7320  own version has 
-000243c0: 3130 3234 2062 7974 6573 2e20 536f 2c20  1024 bytes. So, 
-000243d0: 696e 206f 7264 6572 2074 6f20 6c6f 6f6b  in order to look
-000243e0: 2061 7420 7468 6520 6f6c 6465 7374 0a76   at the oldest.v
-000243f0: 6572 7369 6f6e 2c20 796f 7520 6361 6e20  ersion, you can 
-00024400: 7369 6d70 6c79 2064 6f3a 0a0a 2020 2020  simply do:..    
-00024410: 6361 7420 6d6f 756e 7470 6f69 6e74 2f66  cat mountpoint/f
-00024420: 6f6f 2e76 6572 7369 6f6e 732f 310a 0a4e  oo.versions/1..N
-00024430: 6f74 6520 7468 6174 2074 6865 7365 2076  ote that these v
-00024440: 6572 7369 6f6e 206e 756d 6265 7273 2061  ersion numbers a
-00024450: 7265 2074 6865 2073 616d 6520 6173 2077  re the same as w
-00024460: 6865 6e20 7573 6564 2077 6974 6820 7461  hen used with ta
-00024470: 7227 730a 602d 2d6f 6363 7572 7265 6e63  r's.`--occurrenc
-00024480: 653d 4e60 206f 7074 696f 6e2e 0a0a 2323  e=N` option...##
-00024490: 2050 7265 6669 7820 5265 6d6f 7661 6c0a   Prefix Removal.
-000244a0: 0a55 7365 2060 7261 7461 726d 6f75 6e74  .Use `ratarmount
-000244b0: 202d 6f20 6d6f 6475 6c65 733d 7375 6264   -o modules=subd
-000244c0: 6972 2c73 7562 6469 723d 3c70 7265 6669  ir,subdir=<prefi
-000244d0: 783e 6020 746f 2072 656d 6f76 6520 7061  x>` to remove pa
-000244e0: 7468 2070 7265 6669 7865 730a 7573 696e  th prefixes.usin
-000244f0: 6720 7468 6520 4655 5345 2060 7375 6264  g the FUSE `subd
-00024500: 6972 6020 6d6f 6475 6c65 2e20 4265 6361  ir` module. Beca
-00024510: 7573 6520 6974 2069 7320 6120 7374 616e  use it is a stan
-00024520: 6461 7264 2046 5553 4520 6665 6174 7572  dard FUSE featur
-00024530: 652c 2074 6865 0a60 2d6f 202e 2e2e 6020  e, the.`-o ...` 
-00024540: 6172 6775 6d65 6e74 2073 686f 756c 6420  argument should 
-00024550: 616c 736f 2077 6f72 6b20 666f 7220 6f74  also work for ot
-00024560: 6865 7220 4655 5345 2061 7070 6c69 6361  her FUSE applica
-00024570: 7469 6f6e 732e 0a0a 5768 656e 206d 6f75  tions...When mou
-00024580: 6e74 696e 6720 616e 2061 7263 6869 7665  nting an archive
-00024590: 2063 7265 6174 6564 2077 6974 6820 6162   created with ab
-000245a0: 736f 6c75 7465 2070 6174 6873 2c20 652e  solute paths, e.
-000245b0: 672e 2c0a 6074 6172 202d 5020 6366 202f  g.,.`tar -P cf /
-000245c0: 7661 722f 6c6f 672f 6170 742f 6869 7374  var/log/apt/hist
-000245d0: 6f72 792e 6c6f 6760 2c20 796f 7520 776f  ory.log`, you wo
-000245e0: 756c 6420 7365 6520 7468 6520 7768 6f6c  uld see the whol
-000245f0: 6520 6076 6172 2f6c 6f67 2f61 7074 600a  e `var/log/apt`.
-00024600: 6869 6572 6172 6368 7920 756e 6465 7220  hierarchy under 
-00024610: 7468 6520 6d6f 756e 7420 706f 696e 742e  the mount point.
-00024620: 2054 6f20 6176 6f69 6420 7468 6174 2c20   To avoid that, 
-00024630: 7370 6563 6966 6965 6420 7072 6566 6978  specified prefix
-00024640: 6573 2063 616e 2062 650a 7374 7269 7070  es can be.stripp
-00024650: 6564 2066 726f 6d20 7061 7468 7320 736f  ed from paths so
-00024660: 2074 6861 7420 7468 6520 6d6f 756e 7420   that the mount 
-00024670: 7461 7267 6574 2064 6972 6563 746f 7279  target directory
-00024680: 202a 2a64 6972 6563 746c 792a 2a20 636f   **directly** co
-00024690: 6e74 6169 6e73 0a60 6869 7374 6f72 792e  ntains.`history.
-000246a0: 6c6f 6760 2e20 5573 6520 6072 6174 6172  log`. Use `ratar
-000246b0: 6d6f 756e 7420 2d6f 206d 6f64 756c 6573  mount -o modules
-000246c0: 3d73 7562 6469 722c 7375 6264 6972 3d2f  =subdir,subdir=/
-000246d0: 7661 722f 6c6f 672f 6170 742f 6020 746f  var/log/apt/` to
-000246e0: 2064 6f0a 736f 2e20 5468 6520 7370 6563   do.so. The spec
-000246f0: 6966 6965 6420 7061 7468 2074 6f20 7468  ified path to th
-00024700: 6520 666f 6c64 6572 2069 6e73 6964 6520  e folder inside 
-00024710: 7468 6520 5441 5220 7769 6c6c 2062 6520  the TAR will be 
-00024720: 6d6f 756e 7465 6420 746f 2072 6f6f 742c  mounted to root,
-00024730: 0a69 2e65 2e2c 2074 6865 206d 6f75 6e74  .i.e., the mount
-00024740: 2070 6f69 6e74 2e0a 0a23 2043 6f6d 7072   point...# Compr
-00024750: 6573 7365 6420 6e6f 6e2d 5441 5220 6669  essed non-TAR fi
-00024760: 6c65 730a 0a49 6620 796f 7520 7761 6e74  les..If you want
-00024770: 2061 2063 6f6d 7072 6573 7365 6420 6669   a compressed fi
-00024780: 6c65 206e 6f74 2063 6f6e 7461 696e 696e  le not containin
-00024790: 6720 6120 5441 522c 2065 2e67 2e2c 2060  g a TAR, e.g., `
-000247a0: 666f 6f2e 627a 3260 2c20 7468 656e 0a79  foo.bz2`, then.y
-000247b0: 6f75 2063 616e 2061 6c73 6f20 7573 6520  ou can also use 
-000247c0: 7261 7461 726d 6f75 6e74 2066 6f72 2074  ratarmount for t
-000247d0: 6861 742e 2054 6865 2075 6e63 6f6d 7072  hat. The uncompr
-000247e0: 6573 7365 6420 7669 6577 2077 696c 6c20  essed view will 
-000247f0: 7468 656e 2062 650a 6d6f 756e 7465 6420  then be.mounted 
-00024800: 746f 2060 3c6d 6f75 6e74 706f 696e 743e  to `<mountpoint>
-00024810: 2f66 6f6f 6020 616e 6420 796f 7520 7769  /foo` and you wi
-00024820: 6c6c 2062 6520 6162 6c65 2074 6f20 6c65  ll be able to le
-00024830: 7665 7261 6765 2072 6174 6172 6d6f 756e  verage ratarmoun
-00024840: 7427 730a 7365 656b 696e 6720 6361 7061  t's.seeking capa
-00024850: 6269 6c69 7469 6573 2077 6865 6e20 6f70  bilities when op
-00024860: 656e 696e 6720 7468 6174 2066 696c 652e  ening that file.
-00024870: 0a27 2727 2c0a 2020 2020 290a 0a20 2020  .''',.    )..   
-00024880: 2023 2066 6d74 3a20 6f66 660a 2020 2020   # fmt: off.    
-00024890: 7061 7273 6572 2e61 6464 5f61 7267 756d  parser.add_argum
-000248a0: 656e 7428 0a20 2020 2020 2020 2027 2d66  ent(.        '-f
-000248b0: 272c 2027 2d2d 666f 7265 6772 6f75 6e64  ', '--foreground
-000248c0: 272c 2061 6374 696f 6e3d 2773 746f 7265  ', action='store
-000248d0: 5f74 7275 6527 2c20 6465 6661 756c 7420  _true', default 
-000248e0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-000248f0: 2068 656c 7020 3d20 274b 6565 7073 2074   help = 'Keeps t
-00024900: 6865 2070 7974 686f 6e20 7072 6f67 7261  he python progra
-00024910: 6d20 696e 2066 6f72 6567 726f 756e 6420  m in foreground 
-00024920: 736f 2069 7420 6361 6e20 7072 696e 7420  so it can print 
-00024930: 6465 6275 6720 270a 2020 2020 2020 2020  debug '.        
-00024940: 2020 2020 2020 2027 6f75 7470 7574 2077         'output w
-00024950: 6865 6e20 7468 6520 6d6f 756e 7465 6420  hen the mounted 
-00024960: 7061 7468 2069 7320 6163 6365 7373 6564  path is accessed
-00024970: 2e27 2029 0a0a 2020 2020 7061 7273 6572  .' )..    parser
-00024980: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
-00024990: 2020 2020 2020 2027 2d64 272c 2027 2d2d         '-d', '--
-000249a0: 6465 6275 6727 2c20 7479 7065 203d 2069  debug', type = i
-000249b0: 6e74 2c20 6465 6661 756c 7420 3d20 7072  nt, default = pr
-000249c0: 696e 7444 6562 7567 2c0a 2020 2020 2020  intDebug,.      
-000249d0: 2020 6865 6c70 203d 2027 5365 7473 2074    help = 'Sets t
-000249e0: 6865 2064 6562 7567 6769 6e67 206c 6576  he debugging lev
-000249f0: 656c 2e20 4869 6768 6572 206d 6561 6e73  el. Higher means
-00024a00: 206d 6f72 6520 6f75 7470 7574 2e20 4375   more output. Cu
-00024a10: 7272 656e 746c 792c 2033 2069 7320 7468  rrently, 3 is th
-00024a20: 6520 6869 6768 6573 742e 2720 290a 0a20  e highest.' ).. 
-00024a30: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
-00024a40: 6775 6d65 6e74 280a 2020 2020 2020 2020  gument(.        
-00024a50: 272d 6327 2c20 272d 2d72 6563 7265 6174  '-c', '--recreat
-00024a60: 652d 696e 6465 7827 2c20 6163 7469 6f6e  e-index', action
-00024a70: 3d27 7374 6f72 655f 7472 7565 272c 2064  ='store_true', d
-00024a80: 6566 6175 6c74 203d 2046 616c 7365 2c0a  efault = False,.
-00024a90: 2020 2020 2020 2020 6865 6c70 203d 2027          help = '
-00024aa0: 4966 2073 7065 6369 6669 6564 2c20 7072  If specified, pr
-00024ab0: 652d 6578 6973 7469 6e67 202e 696e 6465  e-existing .inde
-00024ac0: 7820 6669 6c65 7320 7769 6c6c 2062 6520  x files will be 
-00024ad0: 6465 6c65 7465 6420 616e 6420 6e65 776c  deleted and newl
-00024ae0: 7920 6372 6561 7465 642e 2720 290a 0a20  y created.' ).. 
-00024af0: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
-00024b00: 6775 6d65 6e74 280a 2020 2020 2020 2020  gument(.        
-00024b10: 272d 7227 2c20 272d 2d72 6563 7572 7369  '-r', '--recursi
-00024b20: 7665 272c 2061 6374 696f 6e3d 2773 746f  ve', action='sto
-00024b30: 7265 5f74 7275 6527 2c20 6465 6661 756c  re_true', defaul
-00024b40: 7420 3d20 4661 6c73 652c 0a20 2020 2020  t = False,.     
-00024b50: 2020 2068 656c 7020 3d20 274d 6f75 6e74     help = 'Mount
-00024b60: 2054 4152 2061 7263 6869 7665 7320 696e   TAR archives in
-00024b70: 7369 6465 2074 6865 206d 6f75 6e74 6564  side the mounted
-00024b80: 2054 4152 2072 6563 7572 7369 7665 6c79   TAR recursively
-00024b90: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
-00024ba0: 2020 2027 4e6f 7465 2074 6861 7420 7468     'Note that th
-00024bb0: 6973 206f 6e6c 7920 6861 7320 616e 2065  is only has an e
-00024bc0: 6666 6563 7420 7768 656e 2063 7265 6174  ffect when creat
-00024bd0: 696e 6720 616e 2069 6e64 6578 2e20 270a  ing an index. '.
-00024be0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00024bf0: 4966 2061 6e20 696e 6465 7820 616c 7265  If an index alre
-00024c00: 6164 7920 6578 6973 7473 2c20 7468 656e  ady exists, then
-00024c10: 2074 6869 7320 6f70 7469 6f6e 2077 696c   this option wil
-00024c20: 6c20 6265 2065 6666 6563 7469 7665 6c79  l be effectively
-00024c30: 2069 676e 6f72 6564 2e20 270a 2020 2020   ignored. '.    
-00024c40: 2020 2020 2020 2020 2020 2027 5265 6372             'Recr
-00024c50: 6561 7465 2074 6865 2069 6e64 6578 2069  eate the index i
-00024c60: 6620 796f 7520 7761 6e74 2063 6861 6e67  f you want chang
-00024c70: 6520 7468 6520 7265 6375 7273 6976 6520  e the recursive 
-00024c80: 6d6f 756e 7469 6e67 2070 6f6c 6963 7920  mounting policy 
-00024c90: 616e 7977 6179 732e 2720 290a 0a20 2020  anyways.' )..   
-00024ca0: 2070 6172 7365 722e 6164 645f 6172 6775   parser.add_argu
-00024cb0: 6d65 6e74 280a 2020 2020 2020 2020 272d  ment(.        '-
-00024cc0: 6c27 2c20 272d 2d6c 617a 7927 2c20 6163  l', '--lazy', ac
-00024cd0: 7469 6f6e 3d27 7374 6f72 655f 7472 7565  tion='store_true
-00024ce0: 272c 2064 6566 6175 6c74 203d 2046 616c  ', default = Fal
-00024cf0: 7365 2c0a 2020 2020 2020 2020 6865 6c70  se,.        help
-00024d00: 203d 2027 5768 656e 2075 7365 6420 7769   = 'When used wi
-00024d10: 7468 2072 6563 7572 7369 7665 6c79 2062  th recursively b
-00024d20: 696e 642d 6d6f 756e 7465 6420 666f 6c64  ind-mounted fold
-00024d30: 6572 732c 2054 4152 2066 696c 6573 2069  ers, TAR files i
-00024d40: 6e73 6964 6520 7468 6520 6d6f 756e 7465  nside the mounte
-00024d50: 6420 666f 6c64 6572 2077 696c 6c20 6f6e  d folder will on
-00024d60: 6c79 2062 6520 270a 2020 2020 2020 2020  ly be '.        
-00024d70: 2020 2020 2020 2027 6d6f 756e 7465 6420         'mounted 
-00024d80: 6f6e 2066 6972 7374 2061 6363 6573 7320  on first access 
-00024d90: 746f 2069 742e 2720 290a 0a20 2020 2023  to it.' )..    #
-00024da0: 2043 6f6e 7369 6465 7261 7469 6f6e 7320   Considerations 
-00024db0: 666f 7220 7468 6520 6465 6661 756c 7420  for the default 
-00024dc0: 7661 6c75 653a 0a20 2020 2023 2020 202d  value:.    #   -
-00024dd0: 2073 6565 6b20 7469 6d65 7320 666f 7220   seek times for 
-00024de0: 7468 6520 627a 3220 6261 636b 656e 6420  the bz2 backend 
-00024df0: 6172 6520 6265 7477 6565 6e20 302e 3031  are between 0.01
-00024e00: 7320 616e 6420 302e 3173 0a20 2020 2023  s and 0.1s.    #
-00024e10: 2020 202d 2073 6565 6b20 7469 6d65 7320     - seek times 
-00024e20: 666f 7220 7468 6520 677a 6970 2062 6163  for the gzip bac
-00024e30: 6b65 6e64 2061 7265 2072 6f75 6768 6c79  kend are roughly
-00024e40: 2031 2f31 3074 6820 636f 6d70 6172 6564   1/10th compared
-00024e50: 2074 6f20 627a 3220 6174 2061 2064 6566   to bz2 at a def
-00024e60: 6175 6c74 2073 7061 6369 6e67 206f 6620  ault spacing of 
-00024e70: 344d 6942 0a20 2020 2023 2020 2020 202d  4MiB.    #     -
-00024e80: 3e20 7765 2063 6f75 6c64 2064 6f20 6120  > we could do a 
-00024e90: 7370 6163 696e 6720 6f66 2034 304d 6942  spacing of 40MiB
-00024ea0: 2028 686f 7765 7665 7220 7468 6520 636f   (however the co
-00024eb0: 6d70 6172 6973 6f6e 2061 7265 2066 6f72  mparison are for
-00024ec0: 2061 6e6f 7468 6572 2074 6573 7420 6172   another test ar
-00024ed0: 6368 6976 652c 2073 6f20 6974 206d 6967  chive, so it mig
-00024ee0: 6874 206e 6f74 2061 7070 6c79 290a 2020  ht not apply).  
-00024ef0: 2020 2320 2020 2d20 756e 677a 6970 696e    #   - ungzipin
-00024f00: 6720 6669 7265 666f 7820 3636 2069 6e66  g firefox 66 inf
-00024f10: 6c61 7465 7320 7468 6520 636f 6d70 7265  lates the compre
-00024f20: 7373 6564 2073 697a 6520 6f66 2036 364d  ssed size of 66M
-00024f30: 6942 2074 6f20 3138 344d 6942 2028 7e33  iB to 184MiB (~3
-00024f40: 2074 696d 6573 206d 6f72 6529 2061 6e64   times more) and
-00024f50: 2074 616b 6573 2031 2e34 7320 6f6e 206d   takes 1.4s on m
-00024f60: 7920 5043 0a20 2020 2023 2020 2020 202d  y PC.    #     -
-00024f70: 3e20 746f 2068 6176 6520 6120 7265 7370  > to have a resp
-00024f80: 6f6e 7365 2074 696d 6520 6f66 2030 2e31  onse time of 0.1
-00024f90: 732c 2069 7420 776f 756c 6420 7265 7175  s, it would requ
-00024fa0: 6972 6520 6120 7370 6163 696e 6720 3c20  ire a spacing < 
-00024fb0: 3133 4d69 420a 2020 2020 2320 2020 2d20  13MiB.    #   - 
-00024fc0: 7468 6520 677a 6970 2069 6e64 6578 2074  the gzip index t
-00024fd0: 616b 6573 2072 6f75 6768 6c79 2033 326b  akes roughly 32k
-00024fe0: 6942 2070 6572 2073 6565 6b20 706f 696e  iB per seek poin
-00024ff0: 740a 2020 2020 2320 2020 2d20 7468 6520  t.    #   - the 
-00025000: 627a 6970 3220 696e 6465 7820 7461 6b65  bzip2 index take
-00025010: 7320 726f 7567 686c 7920 3136 4220 7065  s roughly 16B pe
-00025020: 7220 3130 302d 3930 306b 6942 206f 6620  r 100-900kiB of 
-00025030: 636f 6d70 7265 7373 6564 2064 6174 610a  compressed data.
-00025040: 2020 2020 2320 2020 2020 2d3e 2066 6f72      #     -> for
-00025050: 2074 6865 2067 7a69 7020 696e 6465 7820   the gzip index 
-00025060: 746f 2068 6176 6520 7468 6520 7361 6d65  to have the same
-00025070: 2073 7061 6365 2065 6666 6963 6965 6e63   space efficienc
-00025080: 7920 6173 7375 6d69 6e67 2061 2063 6f6d  y assuming a com
-00025090: 7072 6573 7369 6f6e 2072 6174 696f 206f  pression ratio o
-000250a0: 6620 6f6e 6c79 2031 2c0a 2020 2020 2320  f only 1,.    # 
-000250b0: 2020 2020 2020 2074 6865 2073 7061 6369         the spaci
-000250c0: 6e67 2077 6f75 6c64 2068 6176 6520 746f  ng would have to
-000250d0: 2062 6520 3138 3030 4d69 4220 6174 2077   be 1800MiB at w
-000250e0: 6869 6368 2070 6f69 6e74 2069 7420 776f  hich point it wo
-000250f0: 756c 6420 6265 636f 6d65 2061 6c6d 6f73  uld become almos
-00025100: 7420 7573 656c 6573 730a 2020 2020 7061  t useless.    pa
-00025110: 7273 6572 2e61 6464 5f61 7267 756d 656e  rser.add_argumen
-00025120: 7428 0a20 2020 2020 2020 2027 2d67 7327  t(.        '-gs'
-00025130: 2c20 272d 2d67 7a69 702d 7365 656b 2d70  , '--gzip-seek-p
-00025140: 6f69 6e74 2d73 7061 6369 6e67 272c 2074  oint-spacing', t
-00025150: 7970 6520 3d20 666c 6f61 742c 2064 6566  ype = float, def
-00025160: 6175 6c74 203d 2031 362c 0a20 2020 2020  ault = 16,.     
-00025170: 2020 2068 656c 7020 3d0a 2020 2020 2020     help =.      
-00025180: 2020 2754 6869 7320 6f6e 6c79 2069 7320    'This only is 
-00025190: 6170 706c 6965 6420 7768 656e 2074 6865  applied when the
-000251a0: 2069 6e64 6578 2069 7320 6669 7273 7420   index is first 
-000251b0: 6372 6561 7465 6420 6f72 2072 6563 7265  created or recre
-000251c0: 6174 6564 2077 6974 6820 7468 6520 2d63  ated with the -c
-000251d0: 206f 7074 696f 6e2e 2027 0a20 2020 2020   option. '.     
-000251e0: 2020 2027 5468 6520 7370 6163 696e 6720     'The spacing 
-000251f0: 6769 7665 6e20 696e 204d 6942 2073 7065  given in MiB spe
-00025200: 6369 6669 6573 2074 6865 2073 6565 6b20  cifies the seek 
-00025210: 706f 696e 7420 6469 7374 616e 6365 2069  point distance i
-00025220: 6e20 7468 6520 756e 636f 6d70 7265 7373  n the uncompress
-00025230: 6564 2064 6174 612e 2027 0a20 2020 2020  ed data. '.     
-00025240: 2020 2027 4120 6469 7374 616e 6365 206f     'A distance o
-00025250: 6620 3136 4d69 4220 6d65 616e 7320 7468  f 16MiB means th
-00025260: 6174 2061 7263 6869 7665 7320 736d 616c  at archives smal
-00025270: 6c65 7220 7468 616e 2031 364d 6942 2069  ler than 16MiB i
-00025280: 6e20 756e 636f 6d70 7265 7373 6564 2073  n uncompressed s
-00025290: 697a 6520 7769 6c6c 2027 0a20 2020 2020  ize will '.     
-000252a0: 2020 2027 6e6f 7420 6265 6e65 6669 7420     'not benefit 
-000252b0: 6672 6f6d 2066 6173 7465 7220 7365 656b  from faster seek
-000252c0: 2074 696d 6573 2e20 4120 7365 656b 2070   times. A seek p
-000252d0: 6f69 6e74 2074 616b 6573 2072 6f75 6768  oint takes rough
-000252e0: 6c79 2033 326b 6942 2e20 270a 2020 2020  ly 32kiB. '.    
-000252f0: 2020 2020 2753 6f2c 2073 6d61 6c6c 6572      'So, smaller
-00025300: 2064 6973 7461 6e63 6573 206c 6561 6420   distances lead 
-00025310: 746f 206d 6f72 6520 7265 7370 6f6e 7369  to more responsi
-00025320: 7665 2073 6565 6b69 6e67 2062 7574 206d  ve seeking but m
-00025330: 6179 2065 7870 6c6f 6465 2074 6865 2069  ay explode the i
-00025340: 6e64 6578 2073 697a 6521 2720 290a 0a20  ndex size!' ).. 
-00025350: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
-00025360: 6775 6d65 6e74 280a 2020 2020 2020 2020  gument(.        
-00025370: 272d 7027 2c20 272d 2d70 7265 6669 7827  '-p', '--prefix'
-00025380: 2c20 7479 7065 203d 2073 7472 2c20 6465  , type = str, de
-00025390: 6661 756c 7420 3d20 2727 2c0a 2020 2020  fault = '',.    
-000253a0: 2020 2020 6865 6c70 203d 2027 5b64 6570      help = '[dep
-000253b0: 7265 6361 7465 645d 2055 7365 2022 2d6f  recated] Use "-o
-000253c0: 206d 6f64 756c 6573 3d73 7562 6469 722c   modules=subdir,
-000253d0: 7375 6264 6972 3d3c 7072 6566 6978 3e22  subdir=<prefix>"
-000253e0: 2069 6e73 7465 6164 2e20 270a 2020 2020   instead. '.    
-000253f0: 2020 2020 2020 2020 2020 2027 5468 6973             'This
-00025400: 2073 7461 6e64 6172 6420 7761 7920 7574   standard way ut
-00025410: 696c 697a 6573 2046 5553 4520 6974 7365  ilizes FUSE itse
-00025420: 6c66 2061 6e64 2077 696c 6c20 616c 736f  lf and will also
-00025430: 2077 6f72 6b20 666f 7220 6f74 6865 7220   work for other 
-00025440: 4655 5345 2027 0a20 2020 2020 2020 2020  FUSE '.         
-00025450: 2020 2020 2020 2761 7070 6c69 6361 7469        'applicati
-00025460: 6f6e 732e 2053 6f2c 2069 7420 6973 2070  ons. So, it is p
-00025470: 7265 6665 7261 626c 6520 6576 656e 2069  referable even i
-00025480: 6620 6120 6269 7420 6d6f 7265 2076 6572  f a bit more ver
-00025490: 626f 7365 2e27 0a20 2020 2020 2020 2020  bose.'.         
-000254a0: 2020 2020 2020 2754 6865 2073 7065 6369        'The speci
-000254b0: 6669 6564 2070 6174 6820 746f 2074 6865  fied path to the
-000254c0: 2066 6f6c 6465 7220 696e 7369 6465 2074   folder inside t
-000254d0: 6865 2054 4152 2077 696c 6c20 6265 206d  he TAR will be m
-000254e0: 6f75 6e74 6564 2074 6f20 726f 6f74 2e20  ounted to root. 
-000254f0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00025500: 2027 5468 6973 2063 616e 2062 6520 7573   'This can be us
-00025510: 6566 756c 2077 6865 6e20 7468 6520 6172  eful when the ar
-00025520: 6368 6976 6520 6173 2063 7265 6174 6564  chive as created
-00025530: 2077 6974 6820 6162 736f 6c75 7465 2070   with absolute p
-00025540: 6174 6873 2e20 270a 2020 2020 2020 2020  aths. '.        
-00025550: 2020 2020 2020 2027 452e 672e 2c20 666f         'E.g., fo
-00025560: 7220 616e 2061 7263 6869 7665 2063 7265  r an archive cre
-00025570: 6174 6564 2077 6974 6820 6074 6172 202d  ated with `tar -
-00025580: 5020 6366 202f 7661 722f 6c6f 672f 6170  P cf /var/log/ap
-00025590: 742f 6869 7374 6f72 792e 6c6f 6760 2c20  t/history.log`, 
-000255a0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-000255b0: 2027 2d70 202f 7661 722f 6c6f 672f 6170   '-p /var/log/ap
-000255c0: 742f 2063 616e 2062 6520 7370 6563 6966  t/ can be specif
-000255d0: 6965 6420 736f 2074 6861 7420 7468 6520  ied so that the 
-000255e0: 6d6f 756e 7420 7461 7267 6574 2064 6972  mount target dir
-000255f0: 6563 746f 7279 2027 0a20 2020 2020 2020  ectory '.       
-00025600: 2020 2020 2020 2020 273e 6469 7265 6374          '>direct
-00025610: 6c79 3c20 636f 6e74 6169 6e73 2068 6973  ly< contains his
-00025620: 746f 7279 2e6c 6f67 2e27 2029 0a0a 2020  tory.log.' )..  
-00025630: 2020 7061 7273 6572 2e61 6464 5f61 7267    parser.add_arg
-00025640: 756d 656e 7428 0a20 2020 2020 2020 2027  ument(.        '
-00025650: 2d2d 7061 7373 776f 7264 272c 2074 7970  --password', typ
-00025660: 6520 3d20 7374 722c 2064 6566 6175 6c74  e = str, default
-00025670: 203d 2027 272c 0a20 2020 2020 2020 2068   = '',.        h
-00025680: 656c 7020 3d20 2753 7065 6369 6679 2061  elp = 'Specify a
-00025690: 2073 696e 676c 6520 7061 7373 776f 7264   single password
-000256a0: 2077 6869 6368 2073 6861 6c6c 2062 6520   which shall be 
-000256b0: 7573 6564 2066 6f72 2052 4152 2061 6e64  used for RAR and
-000256c0: 205a 4950 2066 696c 6573 2e27 2029 0a0a   ZIP files.' )..
-000256d0: 2020 2020 7061 7273 6572 2e61 6464 5f61      parser.add_a
-000256e0: 7267 756d 656e 7428 0a20 2020 2020 2020  rgument(.       
-000256f0: 2027 2d2d 7061 7373 776f 7264 2d66 696c   '--password-fil
-00025700: 6527 2c20 7479 7065 203d 2073 7472 2c20  e', type = str, 
-00025710: 6465 6661 756c 7420 3d20 2727 2c0a 2020  default = '',.  
-00025720: 2020 2020 2020 6865 6c70 203d 2027 5370        help = 'Sp
-00025730: 6563 6966 7920 6120 6669 6c65 2077 6974  ecify a file wit
-00025740: 6820 6e65 776c 696e 6520 7365 7061 7261  h newline separa
-00025750: 7465 6420 7061 7373 776f 7264 7320 666f  ted passwords fo
-00025760: 7220 5241 5220 616e 6420 5a49 5020 6669  r RAR and ZIP fi
-00025770: 6c65 732e 2027 0a20 2020 2020 2020 2020  les. '.         
-00025780: 2020 2020 2020 2754 6865 2070 6173 7377        'The passw
-00025790: 6f72 6473 2077 696c 6c20 6265 2074 7269  ords will be tri
-000257a0: 6564 206f 7574 2069 6e20 6f72 6465 7220  ed out in order 
-000257b0: 6f66 2061 7070 6561 7261 6e63 6520 696e  of appearance in
-000257c0: 2074 6865 2066 696c 652e 2720 290a 0a20   the file.' ).. 
-000257d0: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
-000257e0: 6775 6d65 6e74 280a 2020 2020 2020 2020  gument(.        
-000257f0: 272d 6527 2c20 272d 2d65 6e63 6f64 696e  '-e', '--encodin
-00025800: 6727 2c20 7479 7065 203d 2073 7472 2c20  g', type = str, 
-00025810: 6465 6661 756c 7420 3d20 7461 7266 696c  default = tarfil
-00025820: 652e 454e 434f 4449 4e47 2c0a 2020 2020  e.ENCODING,.    
-00025830: 2020 2020 6865 6c70 203d 2027 5370 6563      help = 'Spec
-00025840: 6966 7920 616e 2069 6e70 7574 2065 6e63  ify an input enc
-00025850: 6f64 696e 6720 7573 6564 2066 6f72 2066  oding used for f
-00025860: 696c 6520 6e61 6d65 7320 616d 6f6e 6720  ile names among 
-00025870: 6f74 6865 7273 2069 6e20 7468 6520 5441  others in the TA
-00025880: 522e 2027 0a20 2020 2020 2020 2020 2020  R. '.           
-00025890: 2020 2020 2754 6869 7320 6d75 7374 2062      'This must b
-000258a0: 6520 7573 6564 2077 6865 6e2c 2065 2e67  e used when, e.g
-000258b0: 2e2c 2074 7279 696e 6720 746f 206f 7065  ., trying to ope
-000258c0: 6e20 6120 6c61 7469 6e31 2065 6e63 6f64  n a latin1 encod
-000258d0: 6564 2054 4152 206f 6e20 616e 2055 5446  ed TAR on an UTF
-000258e0: 2d38 2073 7973 7465 6d2e 2027 0a20 2020  -8 system. '.   
-000258f0: 2020 2020 2020 2020 2020 2020 2750 6f73              'Pos
-00025900: 7369 626c 6520 656e 636f 6469 6e67 733a  sible encodings:
-00025910: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
-00025920: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
-00025930: 7279 2f63 6f64 6563 732e 6874 6d6c 2373  ry/codecs.html#s
-00025940: 7461 6e64 6172 642d 656e 636f 6469 6e67  tandard-encoding
-00025950: 7327 2029 0a0a 2020 2020 7061 7273 6572  s' )..    parser
-00025960: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
-00025970: 2020 2020 2020 2027 2d69 272c 2027 2d2d         '-i', '--
-00025980: 6967 6e6f 7265 2d7a 6572 6f73 272c 2061  ignore-zeros', a
-00025990: 6374 696f 6e20 3d20 2773 746f 7265 5f74  ction = 'store_t
-000259a0: 7275 6527 2c0a 2020 2020 2020 2020 6865  rue',.        he
-000259b0: 6c70 203d 2027 4967 6e6f 7265 207a 6572  lp = 'Ignore zer
-000259c0: 6f65 6420 626c 6f63 6b73 2069 6e20 6172  oed blocks in ar
-000259d0: 6368 6976 652e 204e 6f72 6d61 6c6c 792c  chive. Normally,
-000259e0: 2074 776f 2063 6f6e 7365 6375 7469 7665   two consecutive
-000259f0: 2035 3132 2d62 6c6f 636b 7320 6669 6c6c   512-blocks fill
-00025a00: 6564 2077 6974 6820 7a65 726f 6573 206d  ed with zeroes m
-00025a10: 6561 6e20 454f 4620 270a 2020 2020 2020  ean EOF '.      
-00025a20: 2020 2020 2020 2020 2027 616e 6420 7261           'and ra
-00025a30: 7461 726d 6f75 6e74 2073 746f 7073 2072  tarmount stops r
-00025a40: 6561 6469 6e67 2061 6674 6572 2065 6e63  eading after enc
-00025a50: 6f75 6e74 6572 696e 6720 7468 656d 2e20  ountering them. 
-00025a60: 5468 6973 206f 7074 696f 6e20 696e 7374  This option inst
-00025a70: 7275 6374 7320 6974 2074 6f20 7265 6164  ructs it to read
-00025a80: 2066 7572 7468 6572 2061 6e64 2027 0a20   further and '. 
-00025a90: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-00025aa0: 7320 7573 6566 756c 2077 6865 6e20 7265  s useful when re
-00025ab0: 6164 696e 6720 6172 6368 6976 6573 2063  ading archives c
-00025ac0: 7265 6174 6564 2077 6974 6820 7468 6520  reated with the 
-00025ad0: 2d41 206f 7074 696f 6e2e 2720 290a 0a20  -A option.' ).. 
-00025ae0: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
-00025af0: 6775 6d65 6e74 280a 2020 2020 2020 2020  gument(.        
-00025b00: 272d 2d76 6572 6966 792d 6d74 696d 6527  '--verify-mtime'
-00025b10: 2c20 6163 7469 6f6e 203d 2027 7374 6f72  , action = 'stor
-00025b20: 655f 7472 7565 272c 0a20 2020 2020 2020  e_true',.       
-00025b30: 2068 656c 7020 3d20 2742 7920 6465 6661   help = 'By defa
-00025b40: 756c 742c 206f 6e6c 7920 7468 6520 5441  ult, only the TA
-00025b50: 5220 6669 6c65 2073 697a 6520 6973 2063  R file size is c
-00025b60: 6865 636b 6564 2074 6f20 6d61 7463 6820  hecked to match 
-00025b70: 7468 6520 6f6e 6520 696e 2074 6865 2066  the one in the f
-00025b80: 6f75 6e64 2065 7869 7374 696e 6720 7261  ound existing ra
-00025b90: 7461 726d 6f75 6e74 2069 6e64 6578 2e20  tarmount index. 
-00025ba0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00025bb0: 2027 4966 2074 6869 7320 6f70 7469 6f6e   'If this option
-00025bc0: 2069 7320 7370 6563 6966 6965 642c 2074   is specified, t
-00025bd0: 6865 6e20 616c 736f 2063 6865 636b 2074  hen also check t
-00025be0: 6865 206d 6f64 6966 6963 6174 696f 6e20  he modification 
-00025bf0: 7469 6d65 7374 616d 702e 2042 7574 2062  timestamp. But b
-00025c00: 6577 6172 6520 7468 6174 2074 6865 206d  eware that the m
-00025c10: 7469 6d65 2027 0a20 2020 2020 2020 2020  time '.         
-00025c20: 2020 2020 2020 276d 6967 6874 2063 6861        'might cha
-00025c30: 6e67 6520 6475 7269 6e67 2063 6f70 7969  nge during copyi
-00025c40: 6e67 206f 7220 646f 776e 6c6f 6164 696e  ng or downloadin
-00025c50: 6720 7769 7468 6f75 7420 7468 6520 636f  g without the co
-00025c60: 6e74 656e 7473 2063 6861 6e67 696e 672e  ntents changing.
-00025c70: 2053 6f2c 2074 6869 7320 6368 6563 6b20   So, this check 
-00025c80: 6d69 6768 7420 6361 7573 6520 270a 2020  might cause '.  
-00025c90: 2020 2020 2020 2020 2020 2020 2027 6661               'fa
-00025ca0: 6c73 6520 706f 7369 7469 7665 732e 2720  lse positives.' 
-00025cb0: 290a 0a20 2020 2070 6172 7365 722e 6164  )..    parser.ad
-00025cc0: 645f 6172 6775 6d65 6e74 280a 2020 2020  d_argument(.    
-00025cd0: 2020 2020 272d 7327 2c20 272d 2d73 7472      '-s', '--str
-00025ce0: 6970 2d72 6563 7572 7369 7665 2d74 6172  ip-recursive-tar
-00025cf0: 2d65 7874 656e 7369 6f6e 272c 2061 6374  -extension', act
-00025d00: 696f 6e20 3d20 2773 746f 7265 5f74 7275  ion = 'store_tru
-00025d10: 6527 2c0a 2020 2020 2020 2020 6865 6c70  e',.        help
-00025d20: 203d 2027 4966 2074 7275 652c 2074 6865   = 'If true, the
-00025d30: 6e20 7265 6375 7273 6976 656c 7920 6d6f  n recursively mo
-00025d40: 756e 7465 6420 5441 5273 206e 616d 6564  unted TARs named
-00025d50: 203c 6669 6c65 3e2e 7461 7220 7769 6c6c   <file>.tar will
-00025d60: 2062 6520 6d6f 756e 7465 6420 6174 203c   be mounted at <
-00025d70: 6669 6c65 3e2f 2e20 270a 2020 2020 2020  file>/. '.      
-00025d80: 2020 2020 2020 2020 2027 5468 6973 206d           'This m
-00025d90: 6967 6874 206c 6561 6420 746f 2066 6f6c  ight lead to fol
-00025da0: 6465 7273 206f 6620 7468 6520 7361 6d65  ders of the same
-00025db0: 206e 616d 6520 6265 696e 6720 6f76 6572   name being over
-00025dc0: 7772 6974 7465 6e2c 2073 6f20 7573 6520  written, so use 
-00025dd0: 7769 7468 2063 6172 652e 2027 0a20 2020  with care. '.   
-00025de0: 2020 2020 2020 2020 2020 2020 2754 6865              'The
-00025df0: 2069 6e64 6578 206e 6565 6473 2074 6f20   index needs to 
-00025e00: 6265 2028 7265 2963 7265 6174 6564 2074  be (re)created t
-00025e10: 6f20 6170 706c 7920 7468 6973 206f 7074  o apply this opt
-00025e20: 696f 6e21 2720 290a 0a20 2020 2070 6172  ion!' )..    par
-00025e30: 7365 722e 6164 645f 6172 6775 6d65 6e74  ser.add_argument
-00025e40: 280a 2020 2020 2020 2020 272d 2d69 6e64  (.        '--ind
-00025e50: 6578 2d66 696c 6527 2c20 7479 7065 203d  ex-file', type =
-00025e60: 2073 7472 2c0a 2020 2020 2020 2020 6865   str,.        he
-00025e70: 6c70 203d 2027 5370 6563 6966 7920 6120  lp = 'Specify a 
-00025e80: 7061 7468 2074 6f20 7468 6520 2e69 6e64  path to the .ind
-00025e90: 6578 2e73 716c 6974 6520 6669 6c65 2e20  ex.sqlite file. 
-00025ea0: 5365 7474 696e 6720 7468 6973 2077 696c  Setting this wil
-00025eb0: 6c20 6469 7361 626c 6520 6661 6c6c 6261  l disable fallba
-00025ec0: 636b 2069 6e64 6578 2066 6f6c 6465 7273  ck index folders
-00025ed0: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
-00025ee0: 2020 2027 4966 2074 6865 2067 6976 656e     'If the given
-00025ef0: 2070 6174 6820 6973 2022 3a6d 656d 6f72   path is ":memor
-00025f00: 793a 222c 2074 6865 6e20 7468 6520 696e  y:", then the in
-00025f10: 6465 7820 7769 6c6c 206e 6f74 2062 6520  dex will not be 
-00025f20: 7772 6974 7465 6e20 6f75 7420 746f 2064  written out to d
-00025f30: 6973 6b2e 2720 290a 0a20 2020 2070 6172  isk.' )..    par
-00025f40: 7365 722e 6164 645f 6172 6775 6d65 6e74  ser.add_argument
-00025f50: 280a 2020 2020 2020 2020 272d 2d69 6e64  (.        '--ind
-00025f60: 6578 2d66 6f6c 6465 7273 272c 2064 6566  ex-folders', def
-00025f70: 6175 6c74 203d 2022 2c22 202b 206f 732e  ault = "," + os.
-00025f80: 7061 7468 2e6a 6f69 6e28 2022 7e22 2c20  path.join( "~", 
-00025f90: 222e 7261 7461 726d 6f75 6e74 2220 292c  ".ratarmount" ),
-00025fa0: 0a20 2020 2020 2020 2068 656c 7020 3d20  .        help = 
-00025fb0: 2753 7065 6369 6679 206f 6e65 206f 7220  'Specify one or 
-00025fc0: 6d75 6c74 6970 6c65 2070 6174 6873 2066  multiple paths f
-00025fd0: 6f72 2073 746f 7269 6e67 202e 696e 6465  or storing .inde
-00025fe0: 782e 7371 6c69 7465 2066 696c 6573 2e20  x.sqlite files. 
-00025ff0: 5061 7468 7320 7769 6c6c 2062 6520 7465  Paths will be te
-00026000: 7374 6564 2066 6f72 2073 7569 7461 6269  sted for suitabi
-00026010: 6c69 7479 2027 0a20 2020 2020 2020 2020  lity '.         
-00026020: 2020 2020 2020 2769 6e20 7468 6520 6769        'in the gi
-00026030: 7665 6e20 6f72 6465 722e 2041 6e20 656d  ven order. An em
-00026040: 7074 7920 7061 7468 2077 696c 6c20 6265  pty path will be
-00026050: 2069 6e74 6572 7072 6574 6564 2061 7320   interpreted as 
-00026060: 7468 6520 6c6f 6361 7469 6f6e 2069 6e20  the location in 
-00026070: 7768 6963 6820 7468 6520 5441 5220 7265  which the TAR re
-00026080: 7369 6465 732e 2027 0a20 2020 2020 2020  sides. '.       
-00026090: 2020 2020 2020 2020 2749 6620 7468 6520          'If the 
-000260a0: 6172 6775 6d65 6e74 2062 6567 696e 7320  argument begins 
-000260b0: 7769 7468 2061 2062 7261 636b 6574 2022  with a bracket "
-000260c0: 5b22 2c20 7468 656e 2069 7420 7769 6c6c  [", then it will
-000260d0: 2062 6520 696e 7465 7270 7265 7465 6420   be interpreted 
-000260e0: 6173 2061 204a 534f 4e2d 666f 726d 6174  as a JSON-format
-000260f0: 7465 6420 6c69 7374 2e20 270a 2020 2020  ted list. '.    
-00026100: 2020 2020 2020 2020 2020 2027 4966 2074             'If t
-00026110: 6865 2061 7267 756d 656e 7420 636f 6e74  he argument cont
-00026120: 6169 6e73 2061 2063 6f6d 6d61 2022 2c22  ains a comma ","
-00026130: 2c20 6974 2077 696c 6c20 6265 2069 6e74  , it will be int
-00026140: 6572 7072 6574 6564 2061 7320 6120 636f  erpreted as a co
-00026150: 6d6d 612d 7365 7061 7261 7465 6420 6c69  mma-separated li
-00026160: 7374 206f 6620 666f 6c64 6572 732e 2027  st of folders. '
-00026170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026180: 2745 6c73 652c 2074 6865 2077 686f 6c65  'Else, the whole
-00026190: 2073 7472 696e 6720 7769 6c6c 2062 6520   string will be 
-000261a0: 696e 7465 7270 7265 7465 6420 6173 206f  interpreted as o
-000261b0: 6e65 2066 6f6c 6465 7220 7061 7468 2e20  ne folder path. 
-000261c0: 4578 616d 706c 6573 3a20 270a 2020 2020  Examples: '.    
-000261d0: 2020 2020 2020 2020 2020 2027 2d2d 696e             '--in
-000261e0: 6465 782d 666f 6c64 6572 7320 222c 7e2f  dex-folders ",~/
-000261f0: 2e66 6f6f 2220 7769 6c6c 2074 7279 2074  .foo" will try t
-00026200: 6f20 7361 7665 2062 6573 6964 6573 2074  o save besides t
-00026210: 6865 2054 4152 2061 6e64 2069 6620 7468  he TAR and if th
-00026220: 6174 2064 6f65 7320 6e6f 7420 776f 726b  at does not work
-00026230: 2c20 696e 207e 2f2e 666f 6f2e 2027 0a20  , in ~/.foo. '. 
-00026240: 2020 2020 2020 2020 2020 2020 2020 272d                '-
-00026250: 2d69 6e64 6578 2d66 6f6c 6465 7273 205c  -index-folders \
-00026260: 275b 227e 2f2e 7261 7461 726d 6f75 6e74  '["~/.ratarmount
-00026270: 222c 2022 666f 6f2c 3930 3030 225d 5c27  ", "foo,9000"]\'
-00026280: 2077 696c 6c20 6e65 7665 7220 7472 7920   will never try 
-00026290: 746f 2073 6176 6520 6265 7369 6465 7320  to save besides 
-000262a0: 7468 6520 5441 522e 2027 0a20 2020 2020  the TAR. '.     
-000262b0: 2020 2020 2020 2020 2020 272d 2d69 6e64            '--ind
-000262c0: 6578 2d66 6f6c 6465 7220 7e2f 2e72 6174  ex-folder ~/.rat
-000262d0: 6172 6d6f 756e 7420 7769 6c6c 206f 6e6c  armount will onl
-000262e0: 7920 7465 7374 207e 2f2e 7261 7461 726d  y test ~/.ratarm
-000262f0: 6f75 6e74 2061 7320 6120 7374 6f72 6167  ount as a storag
-00026300: 6520 6c6f 6361 7469 6f6e 2061 6e64 206e  e location and n
-00026310: 6f74 6869 6e67 2065 6c73 652e 2027 0a20  othing else. '. 
-00026320: 2020 2020 2020 2020 2020 2020 2020 2749                'I
-00026330: 6e73 7465 6164 2c20 6974 2077 696c 6c20  nstead, it will 
-00026340: 6669 7273 7420 7472 7920 7e2f 2e72 6174  first try ~/.rat
-00026350: 6172 6d6f 756e 7420 616e 6420 7468 6520  armount and the 
-00026360: 666f 6c64 6572 2022 666f 6f2c 3930 3030  folder "foo,9000
-00026370: 222e 2027 2029 0a0a 2020 2020 7061 7273  ". ' )..    pars
-00026380: 6572 2e61 6464 5f61 7267 756d 656e 7428  er.add_argument(
-00026390: 0a20 2020 2020 2020 2027 2d6f 272c 2027  .        '-o', '
-000263a0: 2d2d 6675 7365 272c 2074 7970 6520 3d20  --fuse', type = 
-000263b0: 7374 722c 2064 6566 6175 6c74 203d 2027  str, default = '
-000263c0: 272c 0a20 2020 2020 2020 2068 656c 7020  ',.        help 
-000263d0: 3d20 2743 6f6d 6d61 2073 6570 6172 6174  = 'Comma separat
-000263e0: 6564 2046 5553 4520 6f70 7469 6f6e 732e  ed FUSE options.
-000263f0: 2053 6565 2022 6d61 6e20 6d6f 756e 742e   See "man mount.
-00026400: 6675 7365 2220 666f 7220 6865 6c70 2e20  fuse" for help. 
-00026410: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00026420: 2027 4578 616d 706c 653a 202d 2d66 7573   'Example: --fus
-00026430: 6520 2261 6c6c 6f77 5f6f 7468 6572 2c65  e "allow_other,e
-00026440: 6e74 7279 5f74 696d 656f 7574 3d32 2e38  ntry_timeout=2.8
-00026450: 2c67 6964 3d30 222e 2027 2029 0a0a 2020  ,gid=0". ' )..  
-00026460: 2020 7061 7273 6572 2e61 6464 5f61 7267    parser.add_arg
-00026470: 756d 656e 7428 0a20 2020 2020 2020 2027  ument(.        '
-00026480: 2d50 272c 2027 2d2d 7061 7261 6c6c 656c  -P', '--parallel
-00026490: 697a 6174 696f 6e27 2c20 7479 7065 203d  ization', type =
-000264a0: 2069 6e74 2c20 6465 6661 756c 7420 3d20   int, default = 
-000264b0: 312c 0a20 2020 2020 2020 2068 656c 7020  1,.        help 
-000264c0: 3d20 2749 6620 616e 2069 6e74 6567 6572  = 'If an integer
-000264d0: 206f 7468 6572 2074 6861 6e20 3120 6973   other than 1 is
-000264e0: 2073 7065 6369 6669 6564 2c20 7468 656e   specified, then
-000264f0: 2074 6865 2074 6872 6561 6465 6420 7061   the threaded pa
-00026500: 7261 6c6c 656c 2062 7a69 7032 2064 6563  rallel bzip2 dec
-00026510: 6f64 6572 2077 696c 6c20 6265 2075 7365  oder will be use
-00026520: 6420 270a 2020 2020 2020 2020 2020 2020  d '.            
-00026530: 2020 2027 7370 6563 6966 6965 6420 616d     'specified am
-00026540: 6f75 6e74 206f 6620 626c 6f63 6b20 6465  ount of block de
-00026550: 636f 6465 7220 7468 7265 6164 732e 2046  coder threads. F
-00026560: 7572 7468 6572 2074 6872 6561 6473 2077  urther threads w
-00026570: 6974 6820 6c69 6768 7465 7220 776f 726b  ith lighter work
-00026580: 206d 6179 2062 6520 7374 6172 7465 642e   may be started.
-00026590: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
-000265a0: 2020 2741 2076 616c 7565 206f 6620 3020    'A value of 0 
-000265b0: 7769 6c6c 2075 7365 2061 6c6c 2074 6865  will use all the
-000265c0: 2061 7661 696c 6162 6c65 2063 6f72 6573   available cores
-000265d0: 2028 7b7d 292e 272e 666f 726d 6174 286f   ({}).'.format(o
-000265e0: 732e 6370 755f 636f 756e 7428 2929 290a  s.cpu_count())).
-000265f0: 0a20 2020 2070 6172 7365 722e 6164 645f  .    parser.add_
-00026600: 6172 6775 6d65 6e74 280a 2020 2020 2020  argument(.      
-00026610: 2020 272d 7627 2c20 272d 2d76 6572 7369    '-v', '--versi
-00026620: 6f6e 272c 2061 6374 696f 6e3d 2773 746f  on', action='sto
-00026630: 7265 5f74 7275 6527 2c20 6865 6c70 203d  re_true', help =
-00026640: 2027 5072 696e 7420 7665 7273 696f 6e20   'Print version 
-00026650: 7374 7269 6e67 2e27 2029 0a0a 2020 2020  string.' )..    
-00026660: 7061 7273 6572 2e61 6464 5f61 7267 756d  parser.add_argum
-00026670: 656e 7428 0a20 2020 2020 2020 2027 6d6f  ent(.        'mo
-00026680: 756e 745f 736f 7572 6365 272c 206e 6172  unt_source', nar
-00026690: 6773 203d 2027 2b27 2c0a 2020 2020 2020  gs = '+',.      
-000266a0: 2020 6865 6c70 203d 2027 5468 6520 7061    help = 'The pa
-000266b0: 7468 2074 6f20 7468 6520 5441 5220 6172  th to the TAR ar
-000266c0: 6368 6976 6520 746f 2062 6520 6d6f 756e  chive to be moun
-000266d0: 7465 642e 2027 0a20 2020 2020 2020 2020  ted. '.         
-000266e0: 2020 2020 2020 2749 6620 6d75 6c74 6970        'If multip
-000266f0: 6c65 2061 7263 6869 7665 7320 616e 642f  le archives and/
-00026700: 6f72 2066 6f6c 6465 7273 2061 7265 2073  or folders are s
-00026710: 7065 6369 6669 6564 2c20 7468 656e 2074  pecified, then t
-00026720: 6865 7920 7769 6c6c 2062 6520 6d6f 756e  hey will be moun
-00026730: 7465 6420 6173 2069 6620 7468 6520 6172  ted as if the ar
-00026740: 6775 6d65 6e74 7320 270a 2020 2020 2020  guments '.      
-00026750: 2020 2020 2020 2020 2027 636f 6d69 6e67           'coming
-00026760: 2066 6972 7374 2077 6572 6520 7570 6461   first were upda
-00026770: 7465 6420 7769 7468 2074 6865 2063 6f6e  ted with the con
-00026780: 7465 6e74 7320 6f66 2074 6865 2061 7263  tents of the arc
-00026790: 6869 7665 7320 6f72 2066 6f6c 6465 7273  hives or folders
-000267a0: 2073 7065 6369 6669 6564 2074 6865 7265   specified there
-000267b0: 6166 7465 722c 2027 0a20 2020 2020 2020  after, '.       
-000267c0: 2020 2020 2020 2020 2769 2e65 2e2c 2074          'i.e., t
-000267d0: 6865 206c 6973 7420 6f66 2054 4152 7320  he list of TARs 
-000267e0: 616e 6420 666f 6c64 6572 7320 7769 6c6c  and folders will
-000267f0: 2062 6520 756e 696f 6e20 6d6f 756e 7465   be union mounte
-00026800: 642e 2720 290a 2020 2020 7061 7273 6572  d.' ).    parser
-00026810: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
-00026820: 2020 2020 2020 2027 6d6f 756e 745f 706f         'mount_po
-00026830: 696e 7427 2c20 6e61 7267 7320 3d20 273f  int', nargs = '?
-00026840: 272c 0a20 2020 2020 2020 2068 656c 7020  ',.        help 
-00026850: 3d20 2754 6865 2070 6174 6820 746f 2061  = 'The path to a
-00026860: 2066 6f6c 6465 7220 746f 206d 6f75 6e74   folder to mount
-00026870: 2074 6865 2054 4152 2063 6f6e 7465 6e74   the TAR content
-00026880: 7320 696e 746f 2e20 270a 2020 2020 2020  s into. '.      
-00026890: 2020 2020 2020 2020 2027 4966 206e 6f20           'If no 
-000268a0: 6d6f 756e 7420 7061 7468 2069 7320 7370  mount path is sp
-000268b0: 6563 6966 6965 642c 2074 6865 2054 4152  ecified, the TAR
-000268c0: 2077 696c 6c20 6265 206d 6f75 6e74 6564   will be mounted
-000268d0: 2074 6f20 6120 666f 6c64 6572 206f 6620   to a folder of 
-000268e0: 7468 6520 7361 6d65 206e 616d 6520 270a  the same name '.
-000268f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00026900: 6275 7420 7769 7468 6f75 7420 6120 6669  but without a fi
-00026910: 6c65 2065 7874 656e 7369 6f6e 2e27 2029  le extension.' )
-00026920: 0a20 2020 2023 2066 6d74 3a20 6f6e 0a0a  .    # fmt: on..
-00026930: 2020 2020 6172 6773 203d 2070 6172 7365      args = parse
-00026940: 722e 7061 7273 655f 6172 6773 2872 6177  r.parse_args(raw
-00026950: 4172 6773 290a 0a20 2020 2061 7267 732e  Args)..    args.
-00026960: 677a 6970 5365 656b 506f 696e 7453 7061  gzipSeekPointSpa
-00026970: 6369 6e67 203d 2061 7267 732e 677a 6970  cing = args.gzip
-00026980: 5f73 6565 6b5f 706f 696e 745f 7370 6163  _seek_point_spac
-00026990: 696e 6720 2a20 3130 3234 202a 2031 3032  ing * 1024 * 102
-000269a0: 340a 0a20 2020 2023 2054 6869 7320 6973  4..    # This is
-000269b0: 2061 2068 6163 6b20 6275 7420 6265 6361   a hack but beca
-000269c0: 7573 6520 7765 2068 6176 6520 7477 6f20  use we have two 
-000269d0: 706f 7369 7469 6f6e 616c 2061 7267 756d  positional argum
-000269e0: 656e 7473 2028 616e 6420 7761 6e74 2074  ents (and want t
-000269f0: 6861 7420 7265 666c 6563 7465 6420 696e  hat reflected in
-00026a00: 2074 6865 2061 7574 6f2d 6765 6e65 7261   the auto-genera
-00026a10: 7465 6420 6865 6c70 292c 0a20 2020 2023  ted help),.    #
-00026a20: 2061 6c6c 2070 6f73 6974 696f 6e61 6c20   all positional 
-00026a30: 6172 6775 6d65 6e74 732c 2069 6e63 6c75  arguments, inclu
-00026a40: 6469 6e67 2074 6865 206d 6f75 6e74 7061  ding the mountpa
-00026a50: 7468 2077 696c 6c20 6265 2070 6172 7365  th will be parse
-00026a60: 6420 696e 746f 2074 6865 2074 6172 6669  d into the tarfi
-00026a70: 6c65 7061 7468 7320 6e61 6d65 7370 6163  lepaths namespac
-00026a80: 6520 616e 6420 7765 2068 6176 6520 746f  e and we have to
-00026a90: 0a20 2020 2023 206d 616e 7561 6c6c 7920  .    # manually 
-00026aa0: 7365 7061 7261 7465 2074 6865 6d20 6465  separate them de
-00026ab0: 7065 6e64 696e 6720 6f6e 2074 6865 2074  pending on the t
-00026ac0: 7970 652e 0a20 2020 2069 6620 6f73 2e70  ype..    if os.p
-00026ad0: 6174 682e 6973 6469 7228 6172 6773 2e6d  ath.isdir(args.m
-00026ae0: 6f75 6e74 5f73 6f75 7263 655b 2d31 5d29  ount_source[-1])
-00026af0: 206f 7220 6e6f 7420 6f73 2e70 6174 682e   or not os.path.
-00026b00: 6578 6973 7473 2861 7267 732e 6d6f 756e  exists(args.moun
-00026b10: 745f 736f 7572 6365 5b2d 315d 293a 0a20  t_source[-1]):. 
-00026b20: 2020 2020 2020 2061 7267 732e 6d6f 756e         args.moun
-00026b30: 745f 706f 696e 7420 3d20 6172 6773 2e6d  t_point = args.m
-00026b40: 6f75 6e74 5f73 6f75 7263 655b 2d31 5d0a  ount_source[-1].
-00026b50: 2020 2020 2020 2020 6172 6773 2e6d 6f75          args.mou
-00026b60: 6e74 5f73 6f75 7263 6520 3d20 6172 6773  nt_source = args
-00026b70: 2e6d 6f75 6e74 5f73 6f75 7263 655b 3a2d  .mount_source[:-
-00026b80: 315d 0a20 2020 2069 6620 6e6f 7420 6172  1].    if not ar
-00026b90: 6773 2e6d 6f75 6e74 5f73 6f75 7263 653a  gs.mount_source:
-00026ba0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00026bb0: 5b45 7272 6f72 5d20 596f 7520 6d75 7374  [Error] You must
-00026bc0: 2061 7420 6c65 6173 7420 7370 6563 6966   at least specif
-00026bd0: 7920 6f6e 6520 7061 7468 2074 6f20 6120  y one path to a 
-00026be0: 7661 6c69 6420 5441 5220 6669 6c65 206f  valid TAR file o
-00026bf0: 7220 756e 696f 6e20 6d6f 756e 7420 736f  r union mount so
-00026c00: 7572 6365 2064 6972 6563 746f 7279 2122  urce directory!"
-00026c10: 290a 2020 2020 2020 2020 7379 732e 6578  ).        sys.ex
-00026c20: 6974 2831 290a 0a20 2020 2023 204d 616e  it(1)..    # Man
-00026c30: 7561 6c6c 7920 6368 6563 6b20 7468 6174  ually check that
-00026c40: 2061 6c6c 2073 7065 6369 6669 6564 2054   all specified T
-00026c50: 4152 7320 616e 6420 666f 6c64 6572 7320  ARs and folders 
-00026c60: 6578 6973 740a 2020 2020 6465 6620 6368  exist.    def ch
-00026c70: 6563 6b4d 6f75 6e74 536f 7572 6365 2870  eckMountSource(p
-00026c80: 6174 6829 3a0a 2020 2020 2020 2020 6966  ath):.        if
-00026c90: 2028 0a20 2020 2020 2020 2020 2020 206f   (.            o
-00026ca0: 732e 7061 7468 2e69 7364 6972 2870 6174  s.path.isdir(pat
-00026cb0: 6829 0a20 2020 2020 2020 2020 2020 206f  h).            o
-00026cc0: 7220 2827 7a69 7066 696c 6527 2069 6e20  r ('zipfile' in 
-00026cd0: 7379 732e 6d6f 6475 6c65 7320 616e 6420  sys.modules and 
-00026ce0: 7a69 7066 696c 652e 6973 5f7a 6970 6669  zipfile.is_zipfi
-00026cf0: 6c65 2870 6174 6829 290a 2020 2020 2020  le(path)).      
-00026d00: 2020 2020 2020 6f72 2028 2772 6172 6669        or ('rarfi
-00026d10: 6c65 2720 696e 2073 7973 2e6d 6f64 756c  le' in sys.modul
-00026d20: 6573 2061 6e64 2072 6172 6669 6c65 2e69  es and rarfile.i
-00026d30: 735f 7261 7266 696c 6528 7061 7468 2929  s_rarfile(path))
-00026d40: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-00026d50: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00026d60: 732e 7061 7468 2e72 6561 6c70 6174 6828  s.path.realpath(
-00026d70: 7061 7468 290a 2020 2020 2020 2020 7265  path).        re
-00026d80: 7475 726e 2054 6172 4669 6c65 5479 7065  turn TarFileType
-00026d90: 2865 6e63 6f64 696e 673d 6172 6773 2e65  (encoding=args.e
-00026da0: 6e63 6f64 696e 6729 2870 6174 6829 5b30  ncoding)(path)[0
-00026db0: 5d0a 0a20 2020 2061 7267 732e 6d6f 756e  ]..    args.moun
-00026dc0: 745f 736f 7572 6365 203d 205b 6368 6563  t_source = [chec
-00026dd0: 6b4d 6f75 6e74 536f 7572 6365 2870 6174  kMountSource(pat
-00026de0: 6829 2066 6f72 2070 6174 6820 696e 2061  h) for path in a
-00026df0: 7267 732e 6d6f 756e 745f 736f 7572 6365  rgs.mount_source
-00026e00: 5d0a 0a20 2020 2023 2041 7574 6f6d 6174  ]..    # Automat
-00026e10: 6963 616c 6c79 2067 656e 6572 6174 6520  ically generate 
-00026e20: 6120 6465 6661 756c 7420 6d6f 756e 7420  a default mount 
-00026e30: 7061 7468 0a20 2020 2069 6620 6e6f 7420  path.    if not 
-00026e40: 6172 6773 2e6d 6f75 6e74 5f70 6f69 6e74  args.mount_point
-00026e50: 3a0a 2020 2020 2020 2020 6175 746f 4d6f  :.        autoMo
-00026e60: 756e 7450 6f69 6e74 203d 2073 7472 6970  untPoint = strip
-00026e70: 5375 6666 6978 4672 6f6d 5461 7246 696c  SuffixFromTarFil
-00026e80: 6528 6172 6773 2e6d 6f75 6e74 5f73 6f75  e(args.mount_sou
-00026e90: 7263 655b 305d 290a 2020 2020 2020 2020  rce[0]).        
-00026ea0: 6966 2061 7267 732e 6d6f 756e 745f 706f  if args.mount_po
-00026eb0: 696e 7420 3d3d 2061 7574 6f4d 6f75 6e74  int == autoMount
-00026ec0: 506f 696e 743a 0a20 2020 2020 2020 2020  Point:.         
-00026ed0: 2020 2061 7267 732e 6d6f 756e 745f 706f     args.mount_po
-00026ee0: 696e 7420 3d20 6f73 2e70 6174 682e 7370  int = os.path.sp
-00026ef0: 6c69 7465 7874 2861 7267 732e 6d6f 756e  litext(args.moun
-00026f00: 745f 736f 7572 6365 5b30 5d29 5b30 5d0a  t_source[0])[0].
-00026f10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00026f20: 2020 2020 2020 2020 2020 6172 6773 2e6d            args.m
-00026f30: 6f75 6e74 5f70 6f69 6e74 203d 2061 7574  ount_point = aut
-00026f40: 6f4d 6f75 6e74 506f 696e 740a 2020 2020  oMountPoint.    
-00026f50: 6172 6773 2e6d 6f75 6e74 5f70 6f69 6e74  args.mount_point
-00026f60: 203d 206f 732e 7061 7468 2e61 6273 7061   = os.path.abspa
-00026f70: 7468 2861 7267 732e 6d6f 756e 745f 706f  th(args.mount_po
-00026f80: 696e 7429 0a0a 2020 2020 2320 5072 6570  int)..    # Prep
-00026f90: 726f 6365 7373 2074 6865 202d 2d69 6e64  rocess the --ind
-00026fa0: 6578 2d66 6f6c 6465 7273 206c 6973 7420  ex-folders list 
-00026fb0: 6173 2061 2073 7472 696e 6720 6172 6775  as a string argu
-00026fc0: 6d65 6e74 0a20 2020 2069 6620 6172 6773  ment.    if args
-00026fd0: 2e69 6e64 6578 5f66 6f6c 6465 7273 3a0a  .index_folders:.
-00026fe0: 2020 2020 2020 2020 6966 2061 7267 732e          if args.
-00026ff0: 696e 6465 785f 666f 6c64 6572 735b 305d  index_folders[0]
-00027000: 203d 3d20 275b 273a 0a20 2020 2020 2020   == '[':.       
-00027010: 2020 2020 2061 7267 732e 696e 6465 785f       args.index_
-00027020: 666f 6c64 6572 7320 3d20 6a73 6f6e 2e6c  folders = json.l
-00027030: 6f61 6473 2861 7267 732e 696e 6465 785f  oads(args.index_
-00027040: 666f 6c64 6572 7329 0a20 2020 2020 2020  folders).       
-00027050: 2065 6c69 6620 272c 2720 696e 2061 7267   elif ',' in arg
-00027060: 732e 696e 6465 785f 666f 6c64 6572 733a  s.index_folders:
-00027070: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-00027080: 732e 696e 6465 785f 666f 6c64 6572 7320  s.index_folders 
-00027090: 3d20 6172 6773 2e69 6e64 6578 5f66 6f6c  = args.index_fol
-000270a0: 6465 7273 2e73 706c 6974 2827 2c27 290a  ders.split(',').
-000270b0: 0a20 2020 2023 2043 6865 636b 2074 6865  .    # Check the
-000270c0: 2070 6172 616c 6c65 6c69 7a61 7469 6f6e   parallelization
-000270d0: 2061 7267 756d 656e 7420 616e 6420 6d6f   argument and mo
-000270e0: 7665 2074 6f20 676c 6f62 616c 2076 6172  ve to global var
-000270f0: 6961 626c 650a 2020 2020 6966 2061 7267  iable.    if arg
-00027100: 732e 7061 7261 6c6c 656c 697a 6174 696f  s.parallelizatio
-00027110: 6e20 3c20 303a 0a20 2020 2020 2020 2072  n < 0:.        r
-00027120: 6169 7365 2061 7267 7061 7273 652e 4172  aise argparse.Ar
-00027130: 6775 6d65 6e74 5479 7065 4572 726f 7228  gumentTypeError(
-00027140: 2241 7267 756d 656e 7420 666f 7220 7061  "Argument for pa
-00027150: 7261 6c6c 656c 697a 6174 696f 6e20 6d75  rallelization mu
-00027160: 7374 2062 6520 6e6f 6e2d 6e65 6761 7469  st be non-negati
-00027170: 7665 2122 290a 2020 2020 676c 6f62 616c  ve!").    global
-00027180: 2070 6172 616c 6c65 6c69 7a61 7469 6f6e   parallelization
-00027190: 0a20 2020 2070 6172 616c 6c65 6c69 7a61  .    paralleliza
-000271a0: 7469 6f6e 203d 2061 7267 732e 7061 7261  tion = args.para
-000271b0: 6c6c 656c 697a 6174 696f 6e20 6966 2061  llelization if a
-000271c0: 7267 732e 7061 7261 6c6c 656c 697a 6174  rgs.parallelizat
-000271d0: 696f 6e20 3e20 3020 656c 7365 206f 732e  ion > 0 else os.
-000271e0: 6370 755f 636f 756e 7428 290a 0a20 2020  cpu_count()..   
-000271f0: 2023 2053 616e 6974 697a 6520 6469 6666   # Sanitize diff
-00027200: 6572 656e 7420 7761 7973 2074 6f20 7370  erent ways to sp
-00027210: 6563 6966 7920 7061 7373 776f 7264 7320  ecify passwords 
-00027220: 696e 746f 2061 2073 696d 706c 6520 6c69  into a simple li
-00027230: 7374 0a20 2020 2061 7267 732e 7061 7373  st.    args.pass
-00027240: 776f 7264 7320 3d20 5b5d 0a20 2020 2069  words = [].    i
-00027250: 6620 6172 6773 2e70 6173 7377 6f72 643a  f args.password:
-00027260: 0a20 2020 2020 2020 2061 7267 732e 7061  .        args.pa
-00027270: 7373 776f 7264 732e 6170 7065 6e64 2861  sswords.append(a
-00027280: 7267 732e 7061 7373 776f 7264 290a 0a20  rgs.password).. 
-00027290: 2020 2069 6620 6172 6773 2e70 6173 7377     if args.passw
-000272a0: 6f72 645f 6669 6c65 3a0a 2020 2020 2020  ord_file:.      
-000272b0: 2020 7769 7468 206f 7065 6e28 6172 6773    with open(args
-000272c0: 2e70 6173 7377 6f72 645f 6669 6c65 2c20  .password_file, 
-000272d0: 2772 6227 2920 6173 2066 696c 653a 0a20  'rb') as file:. 
-000272e0: 2020 2020 2020 2020 2020 2061 7267 732e             args.
-000272f0: 7061 7373 776f 7264 7320 2b3d 2066 696c  passwords += fil
-00027300: 652e 7265 6164 2829 2e73 706c 6974 2862  e.read().split(b
-00027310: 275c 6e27 290a 0a20 2020 2061 7267 732e  '\n')..    args.
-00027320: 7061 7373 776f 7264 7320 3d20 5f72 656d  passwords = _rem
-00027330: 6f76 6544 7570 6c69 6361 7465 7353 7461  oveDuplicatesSta
-00027340: 626c 6528 6172 6773 2e70 6173 7377 6f72  ble(args.passwor
-00027350: 6473 290a 0a20 2020 2072 6574 7572 6e20  ds)..    return 
-00027360: 6172 6773 0a0a 0a64 6566 2063 6c69 2872  args...def cli(r
-00027370: 6177 4172 6773 3a20 4f70 7469 6f6e 616c  awArgs: Optional
-00027380: 5b4c 6973 745b 7374 725d 5d20 3d20 4e6f  [List[str]] = No
-00027390: 6e65 2920 2d3e 204e 6f6e 653a 0a20 2020  ne) -> None:.   
-000273a0: 2022 2222 436f 6d6d 616e 6420 6c69 6e65   """Command line
-000273b0: 2069 6e74 6572 6661 6365 2066 6f72 2072   interface for r
-000273c0: 6174 6172 6d6f 756e 742e 2043 616c 6c20  atarmount. Call 
-000273d0: 7769 7468 2061 7267 7320 3d20 5b20 272d  with args = [ '-
-000273e0: 2d68 656c 7027 205d 2066 6f72 2061 2064  -help' ] for a d
-000273f0: 6573 6372 6970 7469 6f6e 2e22 2222 0a0a  escription."""..
-00027400: 2020 2020 2320 5468 6520 6669 7273 7420      # The first 
-00027410: 6172 6775 6d65 6e74 2c20 6973 2074 6865  argument, is the
-00027420: 2070 6174 6820 746f 2074 6865 2073 6372   path to the scr
-00027430: 6970 7420 616e 6420 7368 6f75 6c64 2062  ipt and should b
-00027440: 6520 6967 6e6f 7265 640a 2020 2020 746d  e ignored.    tm
-00027450: 7041 7267 7320 3d20 7379 732e 6172 6776  pArgs = sys.argv
-00027460: 5b31 3a5d 2069 6620 7261 7741 7267 7320  [1:] if rawArgs 
-00027470: 6973 204e 6f6e 6520 656c 7365 2072 6177  is None else raw
-00027480: 4172 6773 0a20 2020 2069 6620 272d 2d76  Args.    if '--v
-00027490: 6572 7369 6f6e 2720 696e 2074 6d70 4172  ersion' in tmpAr
-000274a0: 6773 206f 7220 272d 7627 2069 6e20 746d  gs or '-v' in tm
-000274b0: 7041 7267 733a 0a20 2020 2020 2020 2070  pArgs:.        p
-000274c0: 7269 6e74 2822 7261 7461 726d 6f75 6e74  rint("ratarmount
-000274d0: 222c 205f 5f76 6572 7369 6f6e 5f5f 290a  ", __version__).
-000274e0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-000274f0: 2020 2020 2320 746d 7041 7267 7320 6172      # tmpArgs ar
-00027500: 6520 6f6e 6c79 2066 6f72 2074 6865 206d  e only for the m
-00027510: 616e 7561 6c20 7061 7273 696e 672e 2049  anual parsing. I
-00027520: 6e20 6765 6e65 7261 6c2c 2072 6177 4172  n general, rawAr
-00027530: 6773 2069 7320 4e6f 6e65 2c20 6d65 616e  gs is None, mean
-00027540: 696e 6720 6974 2072 6561 6473 2073 7973  ing it reads sys
-00027550: 2e61 7267 762c 0a20 2020 2023 2061 6e64  .argv,.    # and
-00027560: 206d 6179 6265 2073 6f6d 6574 696d 6573   maybe sometimes
-00027570: 2063 6f6e 7461 696e 7320 6172 6775 6d65   contains argume
-00027580: 6e74 7320 7768 656e 2075 7365 6420 7072  nts when used pr
-00027590: 6f67 7261 6d6d 6174 6963 616c 6c79 2e20  ogrammatically. 
-000275a0: 496e 2074 6861 7420 6361 7365 2074 6865  In that case the
-000275b0: 2066 6972 7374 2061 7267 756d 656e 740a   first argument.
-000275c0: 2020 2020 2320 7368 6f75 6c64 206e 6f74      # should not
-000275d0: 2062 6520 7468 6520 7061 7468 2074 6f20   be the path to 
-000275e0: 7468 6520 7363 7269 7074 210a 2020 2020  the script!.    
-000275f0: 6172 6773 203d 205f 7061 7273 6541 7267  args = _parseArg
-00027600: 7328 7261 7741 7267 7329 0a0a 2020 2020  s(rawArgs)..    
-00027610: 2320 436f 6e76 6572 7420 7468 6520 636f  # Convert the co
-00027620: 6d6d 6120 7365 7061 7261 7465 6420 6c69  mma separated li
-00027630: 7374 206f 6620 6b65 795b 3d76 616c 7565  st of key[=value
-00027640: 5d20 6f70 7469 6f6e 7320 696e 746f 2061  ] options into a
-00027650: 2064 6963 7469 6f6e 6172 7920 666f 7220   dictionary for 
-00027660: 6675 7365 7079 0a20 2020 2066 7573 656b  fusepy.    fusek
-00027670: 7761 7267 7320 3d20 280a 2020 2020 2020  wargs = (.      
-00027680: 2020 6469 6374 285b 6f70 7469 6f6e 2e73    dict([option.s
-00027690: 706c 6974 2827 3d27 2c20 3129 2069 6620  plit('=', 1) if 
-000276a0: 273d 2720 696e 206f 7074 696f 6e20 656c  '=' in option el
-000276b0: 7365 2028 6f70 7469 6f6e 2c20 5472 7565  se (option, True
-000276c0: 2920 666f 7220 6f70 7469 6f6e 2069 6e20  ) for option in 
-000276d0: 6172 6773 2e66 7573 652e 7370 6c69 7428  args.fuse.split(
-000276e0: 272c 2729 5d29 0a20 2020 2020 2020 2069  ',')]).        i
-000276f0: 6620 6172 6773 2e66 7573 650a 2020 2020  f args.fuse.    
-00027700: 2020 2020 656c 7365 207b 7d0a 2020 2020      else {}.    
-00027710: 290a 2020 2020 6966 2061 7267 732e 7072  ).    if args.pr
-00027720: 6566 6978 3a0a 2020 2020 2020 2020 6675  efix:.        fu
-00027730: 7365 6b77 6172 6773 5b27 6d6f 6475 6c65  sekwargs['module
-00027740: 7327 5d20 3d20 2773 7562 6469 7227 0a20  s'] = 'subdir'. 
-00027750: 2020 2020 2020 2066 7573 656b 7761 7267         fusekwarg
-00027760: 735b 2773 7562 6469 7227 5d20 3d20 6172  s['subdir'] = ar
-00027770: 6773 2e70 7265 6669 780a 0a20 2020 2069  gs.prefix..    i
-00027780: 6620 6172 6773 2e6d 6f75 6e74 5f70 6f69  f args.mount_poi
-00027790: 6e74 2069 6e20 6172 6773 2e6d 6f75 6e74  nt in args.mount
-000277a0: 5f73 6f75 7263 6520 616e 6420 6f73 2e70  _source and os.p
-000277b0: 6174 682e 6973 6469 7228 6172 6773 2e6d  ath.isdir(args.m
-000277c0: 6f75 6e74 5f70 6f69 6e74 2920 616e 6420  ount_point) and 
-000277d0: 6f73 2e6c 6973 7464 6972 2861 7267 732e  os.listdir(args.
-000277e0: 6d6f 756e 745f 706f 696e 7429 3a0a 2020  mount_point):.  
-000277f0: 2020 2020 2020 6966 2068 6173 4e6f 6e45        if hasNonE
-00027800: 6d70 7479 5375 7070 6f72 7428 293a 0a20  mptySupport():. 
-00027810: 2020 2020 2020 2020 2020 2066 7573 656b             fusek
-00027820: 7761 7267 735b 276e 6f6e 656d 7074 7927  wargs['nonempty'
-00027830: 5d20 3d20 5472 7565 0a0a 2020 2020 676c  ] = True..    gl
-00027840: 6f62 616c 2070 7269 6e74 4465 6275 670a  obal printDebug.
-00027850: 2020 2020 7072 696e 7444 6562 7567 203d      printDebug =
-00027860: 2061 7267 732e 6465 6275 670a 0a20 2020   args.debug..   
-00027870: 2066 7573 654f 7065 7261 7469 6f6e 734f   fuseOperationsO
-00027880: 626a 6563 7420 3d20 4675 7365 4d6f 756e  bject = FuseMoun
-00027890: 7428 0a20 2020 2020 2020 2023 2066 6d74  t(.        # fmt
-000278a0: 3a20 6f66 660a 2020 2020 2020 2020 7061  : off.        pa
-000278b0: 7468 546f 4d6f 756e 7420 2020 2020 2020  thToMount       
-000278c0: 2020 2020 2020 2020 203d 2061 7267 732e           = args.
-000278d0: 6d6f 756e 745f 736f 7572 6365 2c0a 2020  mount_source,.  
-000278e0: 2020 2020 2020 636c 6561 7249 6e64 6578        clearIndex
-000278f0: 4361 6368 6520 2020 2020 2020 2020 2020  Cache           
-00027900: 203d 2061 7267 732e 7265 6372 6561 7465   = args.recreate
-00027910: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
-00027920: 7265 6375 7273 6976 6520 2020 2020 2020  recursive       
-00027930: 2020 2020 2020 2020 2020 203d 2061 7267             = arg
-00027940: 732e 7265 6375 7273 6976 652c 0a20 2020  s.recursive,.   
-00027950: 2020 2020 2067 7a69 7053 6565 6b50 6f69       gzipSeekPoi
-00027960: 6e74 5370 6163 696e 6720 2020 2020 2020  ntSpacing       
-00027970: 3d20 6172 6773 2e67 7a69 7053 6565 6b50  = args.gzipSeekP
-00027980: 6f69 6e74 5370 6163 696e 672c 0a20 2020  ointSpacing,.   
-00027990: 2020 2020 206d 6f75 6e74 506f 696e 7420       mountPoint 
-000279a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279b0: 3d20 6172 6773 2e6d 6f75 6e74 5f70 6f69  = args.mount_poi
-000279c0: 6e74 2c0a 2020 2020 2020 2020 656e 636f  nt,.        enco
-000279d0: 6469 6e67 2020 2020 2020 2020 2020 2020  ding            
-000279e0: 2020 2020 2020 203d 2061 7267 732e 656e         = args.en
-000279f0: 636f 6469 6e67 2c0a 2020 2020 2020 2020  coding,.        
-00027a00: 6967 6e6f 7265 5a65 726f 7320 2020 2020  ignoreZeros     
-00027a10: 2020 2020 2020 2020 2020 203d 2061 7267             = arg
-00027a20: 732e 6967 6e6f 7265 5f7a 6572 6f73 2c0a  s.ignore_zeros,.
-00027a30: 2020 2020 2020 2020 7665 7269 6679 4d6f          verifyMo
-00027a40: 6469 6669 6361 7469 6f6e 5469 6d65 2020  dificationTime  
-00027a50: 2020 203d 2061 7267 732e 7665 7269 6679     = args.verify
-00027a60: 5f6d 7469 6d65 2c0a 2020 2020 2020 2020  _mtime,.        
-00027a70: 7374 7269 7052 6563 7572 7369 7665 5461  stripRecursiveTa
-00027a80: 7245 7874 656e 7369 6f6e 203d 2061 7267  rExtension = arg
-00027a90: 732e 7374 7269 705f 7265 6375 7273 6976  s.strip_recursiv
-00027aa0: 655f 7461 725f 6578 7465 6e73 696f 6e2c  e_tar_extension,
-00027ab0: 0a20 2020 2020 2020 2069 6e64 6578 4669  .        indexFi
-00027ac0: 6c65 4e61 6d65 2020 2020 2020 2020 2020  leName          
-00027ad0: 2020 2020 3d20 6172 6773 2e69 6e64 6578      = args.index
-00027ae0: 5f66 696c 652c 0a20 2020 2020 2020 2069  _file,.        i
-00027af0: 6e64 6578 466f 6c64 6572 7320 2020 2020  ndexFolders     
-00027b00: 2020 2020 2020 2020 2020 3d20 6172 6773            = args
-00027b10: 2e69 6e64 6578 5f66 6f6c 6465 7273 2c0a  .index_folders,.
-00027b20: 2020 2020 2020 2020 6c61 7a79 4d6f 756e          lazyMoun
-00027b30: 7469 6e67 2020 2020 2020 2020 2020 2020  ting            
-00027b40: 2020 203d 2061 7267 732e 6c61 7a79 2c0a     = args.lazy,.
-00027b50: 2020 2020 2020 2020 7061 7373 776f 7264          password
-00027b60: 7320 2020 2020 2020 2020 2020 2020 2020  s               
-00027b70: 2020 203d 2061 7267 732e 7061 7373 776f     = args.passwo
-00027b80: 7264 732c 0a20 2020 2020 2020 2023 2066  rds,.        # f
-00027b90: 6d74 3a20 6f6e 0a20 2020 2029 0a0a 2020  mt: on.    )..  
-00027ba0: 2020 6675 7365 2e46 5553 4528 0a20 2020    fuse.FUSE(.   
-00027bb0: 2020 2020 2023 2066 6d74 3a20 6f6e 0a20       # fmt: on. 
-00027bc0: 2020 2020 2020 206f 7065 7261 7469 6f6e         operation
-00027bd0: 733d 6675 7365 4f70 6572 6174 696f 6e73  s=fuseOperations
-00027be0: 4f62 6a65 6374 2c0a 2020 2020 2020 2020  Object,.        
-00027bf0: 6d6f 756e 7470 6f69 6e74 3d61 7267 732e  mountpoint=args.
-00027c00: 6d6f 756e 745f 706f 696e 742c 0a20 2020  mount_point,.   
-00027c10: 2020 2020 2066 6f72 6567 726f 756e 643d       foreground=
-00027c20: 6172 6773 2e66 6f72 6567 726f 756e 642c  args.foreground,
-00027c30: 0a20 2020 2020 2020 206e 6f74 6872 6561  .        nothrea
-00027c40: 6473 3d54 7275 652c 2020 2320 4361 6e27  ds=True,  # Can'
-00027c50: 7420 6163 6365 7373 2053 514c 6974 6520  t access SQLite 
-00027c60: 6461 7461 6261 7365 2063 6f6e 6e65 6374  database connect
-00027c70: 696f 6e20 6f62 6a65 6374 2066 726f 6d20  ion object from 
-00027c80: 6d75 6c74 6970 6c65 2074 6872 6561 6473  multiple threads
-00027c90: 0a20 2020 2020 2020 2023 2066 6d74 3a20  .        # fmt: 
-00027ca0: 6f66 660a 2020 2020 2020 2020 2a2a 6675  off.        **fu
-00027cb0: 7365 6b77 6172 6773 0a20 2020 2029 0a0a  sekwargs.    )..
-00027cc0: 0a69 6620 5f5f 6e61 6d65 5f5f 203d 3d20  .if __name__ == 
-00027cd0: 275f 5f6d 6169 6e5f 5f27 3a0a 2020 2020  '__main__':.    
-00027ce0: 636c 6928 7379 732e 6172 6776 5b31 3a5d  cli(sys.argv[1:]
-00027cf0: 290a                                     ).
+000140b0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+000140c0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+000140d0: 7074 2069 6e64 6578 6564 5f67 7a69 702e  pt indexed_gzip.
+000140e0: 5a72 616e 4572 726f 723a 0a20 2020 2020  ZranError:.     
+000140f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00014100: 656c 662e 5f75 6e63 6865 636b 6564 5265  elf._uncheckedRe
+00014110: 6d6f 7665 2867 7a69 6e64 6578 290a 2020  move(gzindex).  
+00014120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014130: 2020 677a 696e 6465 7820 3d20 4e6f 6e65    gzindex = None
+00014140: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00014150: 206e 6f74 2067 7a69 6e64 6578 206f 7220   not gzindex or 
+00014160: 6e6f 7420 6f73 2e70 6174 682e 6973 6669  not os.path.isfi
+00014170: 6c65 2867 7a69 6e64 6578 293a 0a20 2020  le(gzindex):.   
+00014180: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00014190: 6e74 2822 5b57 6172 6e69 6e67 5d20 5468  nt("[Warning] Th
+000141a0: 6520 475a 6970 2069 6e64 6578 2072 6571  e GZip index req
+000141b0: 7569 7265 6420 666f 7220 7365 656b 696e  uired for seekin
+000141c0: 6720 636f 756c 6420 6e6f 7420 6265 2073  g could not be s
+000141d0: 746f 7265 6420 696e 2061 2074 656d 706f  tored in a tempo
+000141e0: 7261 7279 2066 696c 6521 2229 0a20 2020  rary file!").   
+000141f0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00014200: 6e74 2822 5b49 6e66 6f5d 2054 6869 7320  nt("[Info] This 
+00014210: 6d69 6768 7420 6861 7070 656e 2077 6865  might happen whe
+00014220: 6e20 796f 7520 6172 6520 6f75 7420 6f66  n you are out of
+00014230: 2073 7061 6365 2069 6e20 796f 7572 2074   space in your t
+00014240: 656d 706f 7261 7279 2066 696c 6520 616e  emporary file an
+00014250: 6420 6174 2074 6865 2229 0a20 2020 2020  d at the").     
+00014260: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00014270: 2822 5b49 6e66 6f5d 2074 6865 2069 6e64  ("[Info] the ind
+00014280: 6578 2066 696c 6520 6c6f 6361 7469 6f6e  ex file location
+00014290: 2e20 5468 6520 677a 6970 696e 6465 7820  . The gzipindex 
+000142a0: 7369 7a65 2074 616b 6573 2072 6f75 6768  size takes rough
+000142b0: 6c79 2033 326b 6942 2070 6572 2034 4d69  ly 32kiB per 4Mi
+000142c0: 4220 6f66 2229 0a20 2020 2020 2020 2020  B of").         
+000142d0: 2020 2020 2020 2070 7269 6e74 2822 5b49         print("[I
+000142e0: 6e66 6f5d 2075 6e63 6f6d 7072 6573 7365  nfo] uncompresse
+000142f0: 6428 2129 2062 7974 6573 2028 302e 3825  d(!) bytes (0.8%
+00014300: 206f 6620 7468 6520 756e 636f 6d70 7265   of the uncompre
+00014310: 7373 6564 2064 6174 6129 2062 7920 6465  ssed data) by de
+00014320: 6661 756c 742e 2229 0a20 2020 2020 2020  fault.").       
+00014330: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
+00014340: 756e 7469 6d65 4572 726f 7228 2243 6f75  untimeError("Cou
+00014350: 6c64 206e 6f74 2069 6e69 7469 616c 697a  ld not initializ
+00014360: 6520 7468 6520 475a 6970 2073 6565 6b20  e the GZip seek 
+00014370: 6361 6368 652e 2229 0a20 2020 2020 2020  cache.").       
+00014380: 2020 2020 2069 6620 7072 696e 7444 6562       if printDeb
+00014390: 7567 203e 3d20 323a 0a20 2020 2020 2020  ug >= 2:.       
+000143a0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000143b0: 4578 706f 7274 6564 2047 5a69 7020 696e  Exported GZip in
+000143c0: 6465 7820 7369 7a65 3a22 2c20 6f73 2e73  dex size:", os.s
+000143d0: 7461 7428 677a 696e 6465 7829 2e73 745f  tat(gzindex).st_
+000143e0: 7369 7a65 290a 0a20 2020 2020 2020 2020  size)..         
+000143f0: 2020 2023 2043 6c65 616e 2075 7020 756e     # Clean up un
+00014400: 7265 6164 6162 6c65 206f 6c64 6572 2064  readable older d
+00014410: 6174 612e 0a20 2020 2020 2020 2020 2020  ata..           
+00014420: 2069 6620 2767 7a69 7069 6e64 6578 2720   if 'gzipindex' 
+00014430: 696e 2074 6162 6c65 733a 0a20 2020 2020  in tables:.     
+00014440: 2020 2020 2020 2020 2020 2064 622e 6578             db.ex
+00014450: 6563 7574 6528 2744 524f 5020 5441 424c  ecute('DROP TABL
+00014460: 4520 677a 6970 696e 6465 7827 290a 2020  E gzipindex').  
+00014470: 2020 2020 2020 2020 2020 6966 2027 677a            if 'gz
+00014480: 6970 696e 6465 7865 7327 2069 6e20 7461  ipindexes' in ta
+00014490: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+000144a0: 2020 2020 2020 6462 2e65 7865 6375 7465        db.execute
+000144b0: 2827 4452 4f50 2054 4142 4c45 2067 7a69  ('DROP TABLE gzi
+000144c0: 7069 6e64 6578 6573 2729 0a0a 2020 2020  pindexes')..    
+000144d0: 2020 2020 2020 2020 2320 5468 6520 6d61          # The ma
+000144e0: 7869 6d75 6d20 626c 6f62 2073 697a 6520  ximum blob size 
+000144f0: 636f 6e66 6967 7572 6564 2062 7920 5351  configured by SQ
+00014500: 4c69 7465 2069 7320 6578 6163 746c 7920  Lite is exactly 
+00014510: 3120 4742 2c20 7365 6520 6874 7470 733a  1 GB, see https:
+00014520: 2f2f 7777 772e 7371 6c69 7465 2e6f 7267  //www.sqlite.org
+00014530: 2f6c 696d 6974 732e 6874 6d6c 0a20 2020  /limits.html.   
+00014540: 2020 2020 2020 2020 2023 2054 6865 7265           # There
+00014550: 666f 7265 2c20 7468 6973 2073 686f 756c  fore, this shoul
+00014560: 6420 6265 2073 6d61 6c6c 6572 2e20 416e  d be smaller. An
+00014570: 6f74 6865 7220 6172 6775 6d65 6e74 2066  other argument f
+00014580: 6f72 206d 616b 696e 6720 6974 2073 6d61  or making it sma
+00014590: 6c6c 6572 2069 7320 7468 6174 2074 6869  ller is that thi
+000145a0: 7320 626c 6f62 2073 697a 650a 2020 2020  s blob size.    
+000145b0: 2020 2020 2020 2020 2320 7769 6c6c 2062          # will b
+000145c0: 6520 6865 6c64 2066 756c 6c79 2069 6e20  e held fully in 
+000145d0: 6d65 6d6f 7279 2074 656d 706f 7261 7269  memory temporari
+000145e0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
+000145f0: 2320 4275 742c 206d 616b 696e 6720 6974  # But, making it
+00014600: 2074 6f6f 2073 6d61 6c6c 2077 6f75 6c64   too small would
+00014610: 2072 6573 756c 7420 696e 2074 6f6f 206d   result in too m
+00014620: 616e 7920 6e6f 6e2d 6261 636b 7761 7264  any non-backward
+00014630: 7320 636f 6d70 6174 6962 6c65 2069 6e64  s compatible ind
+00014640: 6578 6573 2062 6569 6e67 2063 7265 6174  exes being creat
+00014650: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+00014660: 6d61 7842 6c6f 6253 697a 6520 3d20 3235  maxBlobSize = 25
+00014670: 3620 2a20 3130 3234 202a 2031 3032 3420  6 * 1024 * 1024 
+00014680: 2023 2031 3238 204d 6942 0a0a 2020 2020   # 128 MiB..    
+00014690: 2020 2020 2020 2020 2320 5374 6f72 6520          # Store 
+000146a0: 636f 6e74 656e 7473 206f 6620 7465 6d70  contents of temp
+000146b0: 6f72 6172 7920 6669 6c65 2069 6e74 6f20  orary file into 
+000146c0: 7468 6520 5351 4c69 7465 2064 6174 6162  the SQLite datab
+000146d0: 6173 650a 2020 2020 2020 2020 2020 2020  ase.            
+000146e0: 6966 206f 732e 7374 6174 2867 7a69 6e64  if os.stat(gzind
+000146f0: 6578 292e 7374 5f73 697a 6520 3e20 6d61  ex).st_size > ma
+00014700: 7842 6c6f 6253 697a 653a 0a20 2020 2020  xBlobSize:.     
+00014710: 2020 2020 2020 2020 2020 2064 622e 6578             db.ex
+00014720: 6563 7574 6528 2743 5245 4154 4520 5441  ecute('CREATE TA
+00014730: 424c 4520 677a 6970 696e 6465 7865 7320  BLE gzipindexes 
+00014740: 2820 6461 7461 2042 4c4f 4220 2927 290a  ( data BLOB )').
+00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014760: 7769 7468 206f 7065 6e28 677a 696e 6465  with open(gzinde
+00014770: 782c 2027 7262 2729 2061 7320 6669 6c65  x, 'rb') as file
+00014780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014790: 2020 2020 2020 7768 696c 6520 5472 7565        while True
+000147a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000147b0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+000147c0: 2066 696c 652e 7265 6164 286d 6178 426c   file.read(maxBl
+000147d0: 6f62 5369 7a65 290a 2020 2020 2020 2020  obSize).        
+000147e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147f0: 6966 206e 6f74 2064 6174 613a 0a20 2020  if not data:.   
+00014800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014810: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014830: 2020 2020 2020 2020 2320 4927 6d20 7072          # I'm pr
+00014840: 6574 7479 2073 7572 6520 7468 6174 2074  etty sure that t
+00014850: 6865 2072 6f77 6964 2063 616e 2062 6520  he rowid can be 
+00014860: 7573 6564 2074 6f20 7175 6572 7920 7468  used to query th
+00014870: 6520 726f 7773 2077 6974 6820 7468 6520  e rows with the 
+00014880: 696e 7365 7274 696f 6e20 6f72 6465 723a  insertion order:
+00014890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000148a0: 2020 2020 2020 2020 2023 2068 7474 7073           # https
+000148b0: 3a2f 2f77 7777 2e73 716c 6974 652e 6f72  ://www.sqlite.or
+000148c0: 672f 6175 746f 696e 632e 6874 6d6c 0a20  g/autoinc.html. 
+000148d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148e0: 2020 2020 2020 2023 203e 2054 6865 2075         # > The u
+000148f0: 7375 616c 2061 6c67 6f72 6974 686d 2069  sual algorithm i
+00014900: 7320 746f 2067 6976 6520 7468 6520 6e65  s to give the ne
+00014910: 776c 7920 6372 6561 7465 6420 726f 7720  wly created row 
+00014920: 6120 524f 5749 4420 7468 6174 2069 7320  a ROWID that is 
+00014930: 6f6e 6520 6c61 7267 6572 2074 6861 6e20  one larger than 
+00014940: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00014950: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00014960: 6c61 7267 6573 7420 524f 5749 4420 696e  largest ROWID in
+00014970: 2074 6865 2074 6162 6c65 2070 7269 6f72   the table prior
+00014980: 2074 6f20 7468 6520 696e 7365 7274 2e0a   to the insert..
+00014990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149a0: 2020 2020 2020 2020 2320 5468 6520 2275          # The "u
+000149b0: 7375 616c 2220 6d61 6b65 7320 6d65 2077  sual" makes me w
+000149c0: 6f72 7279 2061 2062 6974 2c20 6275 7420  orry a bit, but 
+000149d0: 4920 7468 696e 6b20 6974 2069 7320 696e  I think it is in
+000149e0: 2072 6566 6572 656e 6365 2074 6f20 7468   reference to th
+000149f0: 6520 4155 544f 494e 4352 454d 454e 5420  e AUTOINCREMENT 
+00014a00: 6665 6174 7572 652e 0a20 2020 2020 2020  feature..       
+00014a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a20: 2064 622e 6578 6563 7574 6528 2749 4e53   db.execute('INS
+00014a30: 4552 5420 494e 544f 2067 7a69 7069 6e64  ERT INTO gzipind
+00014a40: 6578 6573 2056 414c 5545 5320 283f 2927  exes VALUES (?)'
+00014a50: 2c20 2864 6174 612c 2929 0a20 2020 2020  , (data,)).     
+00014a60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014a70: 2020 2020 2020 2020 2020 2020 2064 622e               db.
+00014a80: 6578 6563 7574 6528 2743 5245 4154 4520  execute('CREATE 
+00014a90: 5441 424c 4520 677a 6970 696e 6465 7820  TABLE gzipindex 
+00014aa0: 2820 6461 7461 2042 4c4f 4220 2927 290a  ( data BLOB )').
+00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ac0: 7769 7468 206f 7065 6e28 677a 696e 6465  with open(gzinde
+00014ad0: 782c 2027 7262 2729 2061 7320 6669 6c65  x, 'rb') as file
+00014ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014af0: 2020 2020 2020 6462 2e65 7865 6375 7465        db.execute
+00014b00: 2827 494e 5345 5254 2049 4e54 4f20 677a  ('INSERT INTO gz
+00014b10: 6970 696e 6465 7820 5641 4c55 4553 2028  ipindex VALUES (
+00014b20: 3f29 272c 2028 6669 6c65 2e72 6561 6428  ?)', (file.read(
+00014b30: 292c 2929 0a0a 2020 2020 2020 2020 2020  ),))..          
+00014b40: 2020 6462 2e63 6f6d 6d69 7428 290a 2020    db.commit().  
+00014b50: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
+00014b60: 6f76 6528 677a 696e 6465 7829 0a20 2020  ove(gzindex).   
+00014b70: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00014b80: 0a20 2020 2020 2020 2023 204e 6f74 6520  .        # Note 
+00014b90: 7468 6174 2066 6f72 2078 7a20 7365 656b  that for xz seek
+00014ba0: 696e 672c 206c 6f61 6469 6e67 2061 6e64  ing, loading and
+00014bb0: 2073 746f 7269 6e67 2062 6c6f 636b 2069   storing block i
+00014bc0: 6e64 6578 6573 2069 7320 756e 6e65 6365  ndexes is unnece
+00014bd0: 7373 6172 7920 6265 6361 7573 6520 6974  ssary because it
+00014be0: 2068 6173 2061 6e20 696e 6465 7820 696e   has an index in
+00014bf0: 636c 7564 6564 210a 2020 2020 2020 2020  cluded!.        
+00014c00: 6966 2073 656c 662e 636f 6d70 7265 7373  if self.compress
+00014c10: 696f 6e20 696e 205b 4e6f 6e65 2c20 2778  ion in [None, 'x
+00014c20: 7a27 5d3a 0a20 2020 2020 2020 2020 2020  z']:.           
+00014c30: 2072 6574 7572 6e0a 0a20 2020 2020 2020   return..       
+00014c40: 2061 7373 6572 7420 280a 2020 2020 2020   assert (.      
+00014c50: 2020 2020 2020 4661 6c73 650a 2020 2020        False.    
+00014c60: 2020 2020 292c 2022 436f 756c 6420 6e6f      ), "Could no
+00014c70: 7420 6c6f 6164 206f 7220 7374 6f72 6520  t load or store 
+00014c80: 626c 6f63 6b20 6f66 6673 6574 7320 666f  block offsets fo
+00014c90: 7220 7b7d 2070 726f 6261 626c 7920 6265  r {} probably be
+00014ca0: 6361 7573 6520 6164 6469 6e67 2073 7570  cause adding sup
+00014cb0: 706f 7274 2077 6173 2066 6f72 676f 7474  port was forgott
+00014cc0: 656e 2122 2e66 6f72 6d61 7428 0a20 2020  en!".format(.   
+00014cd0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00014ce0: 6d70 7265 7373 696f 6e0a 2020 2020 2020  mpression.      
+00014cf0: 2020 290a 0a0a 6465 6620 5f6d 616b 654d    )...def _makeM
+00014d00: 6f75 6e74 506f 696e 7446 696c 6549 6e66  ountPointFileInf
+00014d10: 6f46 726f 6d53 7461 7473 2873 7461 7473  oFromStats(stats
+00014d20: 3a20 6f73 2e73 7461 745f 7265 7375 6c74  : os.stat_result
+00014d30: 2920 2d3e 2046 696c 6549 6e66 6f3a 0a20  ) -> FileInfo:. 
+00014d40: 2020 2023 206d 616b 6520 7468 6520 6d6f     # make the mo
+00014d50: 756e 7420 706f 696e 7420 7265 6164 206f  unt point read o
+00014d60: 6e6c 7920 616e 6420 6578 6563 7574 6162  nly and executab
+00014d70: 6c65 2069 6620 7265 6164 6162 6c65 2c20  le if readable, 
+00014d80: 692e 652e 2c20 616c 6c6f 7720 6469 7265  i.e., allow dire
+00014d90: 6374 6f72 7920 6c69 7374 696e 670a 2020  ctory listing.  
+00014da0: 2020 2320 636c 6561 7220 6869 6768 6572    # clear higher
+00014db0: 2062 6974 7320 6c69 6b65 2053 5f49 4652   bits like S_IFR
+00014dc0: 4547 2061 6e64 2073 6574 2074 6865 2064  EG and set the d
+00014dd0: 6972 6563 746f 7279 2062 6974 2069 6e73  irectory bit ins
+00014de0: 7465 6164 0a20 2020 206d 6f75 6e74 4d6f  tead.    mountMo
+00014df0: 6465 203d 2028 0a20 2020 2020 2020 2028  de = (.        (
+00014e00: 7374 6174 732e 7374 5f6d 6f64 6520 2620  stats.st_mode & 
+00014e10: 306f 3737 3729 0a20 2020 2020 2020 207c  0o777).        |
+00014e20: 2073 7461 742e 535f 4946 4449 520a 2020   stat.S_IFDIR.  
+00014e30: 2020 2020 2020 7c20 2873 7461 742e 535f        | (stat.S_
+00014e40: 4958 5553 5220 6966 2073 7461 7473 2e73  IXUSR if stats.s
+00014e50: 745f 6d6f 6465 2026 2073 7461 742e 535f  t_mode & stat.S_
+00014e60: 4952 5553 5220 213d 2030 2065 6c73 6520  IRUSR != 0 else 
+00014e70: 3029 0a20 2020 2020 2020 207c 2028 7374  0).        | (st
+00014e80: 6174 2e53 5f49 5847 5250 2069 6620 7374  at.S_IXGRP if st
+00014e90: 6174 732e 7374 5f6d 6f64 6520 2620 7374  ats.st_mode & st
+00014ea0: 6174 2e53 5f49 5247 5250 2021 3d20 3020  at.S_IRGRP != 0 
+00014eb0: 656c 7365 2030 290a 2020 2020 2020 2020  else 0).        
+00014ec0: 7c20 2873 7461 742e 535f 4958 4f54 4820  | (stat.S_IXOTH 
+00014ed0: 6966 2073 7461 7473 2e73 745f 6d6f 6465  if stats.st_mode
+00014ee0: 2026 2073 7461 742e 535f 4952 4f54 4820   & stat.S_IROTH 
+00014ef0: 213d 2030 2065 6c73 6520 3029 0a20 2020  != 0 else 0).   
+00014f00: 2029 0a0a 2020 2020 6669 6c65 496e 666f   )..    fileInfo
+00014f10: 203d 2046 696c 6549 6e66 6f28 0a20 2020   = FileInfo(.   
+00014f20: 2020 2020 2023 2066 6d74 3a20 6f66 660a       # fmt: off.
+00014f30: 2020 2020 2020 2020 7369 7a65 2020 2020          size    
+00014f40: 203d 2073 7461 7473 2e73 745f 7369 7a65   = stats.st_size
+00014f50: 2c0a 2020 2020 2020 2020 6d74 696d 6520  ,.        mtime 
+00014f60: 2020 203d 2073 7461 7473 2e73 745f 6d74     = stats.st_mt
+00014f70: 696d 652c 0a20 2020 2020 2020 206d 6f64  ime,.        mod
+00014f80: 6520 2020 2020 3d20 6d6f 756e 744d 6f64  e     = mountMod
+00014f90: 652c 0a20 2020 2020 2020 206c 696e 6b6e  e,.        linkn
+00014fa0: 616d 6520 3d20 2222 2c0a 2020 2020 2020  ame = "",.      
+00014fb0: 2020 7569 6420 2020 2020 203d 2073 7461    uid      = sta
+00014fc0: 7473 2e73 745f 7569 642c 0a20 2020 2020  ts.st_uid,.     
+00014fd0: 2020 2067 6964 2020 2020 2020 3d20 7374     gid      = st
+00014fe0: 6174 732e 7374 5f67 6964 2c0a 2020 2020  ats.st_gid,.    
+00014ff0: 2020 2020 7573 6572 6461 7461 203d 205b      userdata = [
+00015000: 5d2c 0a20 2020 2020 2020 2023 2066 6d74  ],.        # fmt
+00015010: 3a20 6f6e 0a20 2020 2029 0a0a 2020 2020  : on.    )..    
+00015020: 7265 7475 726e 2066 696c 6549 6e66 6f0a  return fileInfo.
+00015030: 0a0a 636c 6173 7320 466f 6c64 6572 4d6f  ..class FolderMo
+00015040: 756e 7453 6f75 7263 6528 4d6f 756e 7453  untSource(MountS
+00015050: 6f75 7263 6529 3a0a 2020 2020 2222 220a  ource):.    """.
+00015060: 2020 2020 5468 6973 2063 6c61 7373 206d      This class m
+00015070: 616e 6167 6573 206f 6e65 2066 6f6c 6465  anages one folde
+00015080: 7220 6173 206d 6f75 6e74 2073 6f75 7263  r as mount sourc
+00015090: 6520 6f66 6665 7269 6e67 206d 6574 686f  e offering metho
+000150a0: 6473 2066 6f72 206c 6973 7469 6e67 2066  ds for listing f
+000150b0: 6f6c 6465 7273 2c20 7265 6164 696e 6720  olders, reading 
+000150c0: 6669 6c65 732c 2061 6e64 206f 7468 6572  files, and other
+000150d0: 732e 0a20 2020 2022 2222 0a0a 2020 2020  s..    """..    
+000150e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000150f0: 662c 2070 6174 683a 2073 7472 2920 2d3e  f, path: str) ->
+00015100: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00015110: 656c 662e 726f 6f74 3a20 7374 7220 3d20  elf.root: str = 
+00015120: 7061 7468 0a0a 2020 2020 6465 6620 7365  path..    def se
+00015130: 7446 6f6c 6465 7244 6573 6372 6970 746f  tFolderDescripto
+00015140: 7228 7365 6c66 2c20 6664 3a20 696e 7429  r(self, fd: int)
+00015150: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00015160: 2020 2222 220a 2020 2020 2020 2020 4d61    """.        Ma
+00015170: 6b65 2074 6869 7320 6d6f 756e 7420 736f  ke this mount so
+00015180: 7572 6365 206d 616e 6167 6520 7468 6520  urce manage the 
+00015190: 7370 6563 6961 6c20 222e 2220 666f 6c64  special "." fold
+000151a0: 6572 2062 7920 6368 616e 6769 6e67 2074  er by changing t
+000151b0: 6f20 7468 6174 2064 6972 6563 746f 7279  o that directory
+000151c0: 2e0a 2020 2020 2020 2020 4265 6361 7573  ..        Becaus
+000151d0: 6520 7765 2063 6861 6e67 6520 746f 2074  e we change to t
+000151e0: 6861 7420 6469 7265 6374 6f72 7920 6974  hat directory it
+000151f0: 206d 6179 206f 6e6c 7920 6265 2075 7365   may only be use
+00015200: 6420 666f 7220 6f6e 6520 6d6f 756e 7420  d for one mount 
+00015210: 736f 7572 6365 2062 7574 2069 7420 616c  source but it al
+00015220: 736f 2077 6f72 6b73 0a20 2020 2020 2020  so works.       
+00015230: 2077 6865 6e20 7468 6174 206d 6f75 6e74   when that mount
+00015240: 2073 6f75 7263 6520 6973 206d 6f75 6e74   source is mount
+00015250: 6564 206f 6e21 0a20 2020 2020 2020 2022  ed on!.        "
+00015260: 2222 0a20 2020 2020 2020 206f 732e 6663  "".        os.fc
+00015270: 6864 6972 2866 6429 0a20 2020 2020 2020  hdir(fd).       
+00015280: 2073 656c 662e 726f 6f74 203d 2027 2e27   self.root = '.'
+00015290: 0a0a 2020 2020 6465 6620 5f72 6561 6c70  ..    def _realp
+000152a0: 6174 6828 7365 6c66 2c20 7061 7468 3a20  ath(self, path: 
+000152b0: 7374 7229 202d 3e20 7374 723a 0a20 2020  str) -> str:.   
+000152c0: 2020 2020 2022 2222 5061 7468 2067 6976       """Path giv
+000152d0: 656e 2072 656c 6174 6976 6520 746f 2066  en relative to f
+000152e0: 6f6c 6465 7220 726f 6f74 2e20 4c65 6164  older root. Lead
+000152f0: 696e 6720 272f 2720 6973 2061 6363 6570  ing '/' is accep
+00015300: 7461 626c 6522 2222 0a20 2020 2020 2020  table""".       
+00015310: 2072 6574 7572 6e20 6f73 2e70 6174 682e   return os.path.
+00015320: 6a6f 696e 2873 656c 662e 726f 6f74 2c20  join(self.root, 
+00015330: 7061 7468 2e6c 7374 7269 7028 6f73 2e70  path.lstrip(os.p
+00015340: 6174 682e 7365 7029 290a 0a20 2020 2040  ath.sep))..    @
+00015350: 6f76 6572 7269 6465 7328 4d6f 756e 7453  overrides(MountS
+00015360: 6f75 7263 6529 0a20 2020 2064 6566 2065  ource).    def e
+00015370: 7869 7374 7328 7365 6c66 2c20 7061 7468  xists(self, path
+00015380: 3a20 7374 7229 202d 3e20 626f 6f6c 3a0a  : str) -> bool:.
+00015390: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+000153a0: 732e 7061 7468 2e6c 6578 6973 7473 2873  s.path.lexists(s
+000153b0: 656c 662e 5f72 6561 6c70 6174 6828 7061  elf._realpath(pa
+000153c0: 7468 2929 0a0a 2020 2020 406f 7665 7272  th))..    @overr
+000153d0: 6964 6573 284d 6f75 6e74 536f 7572 6365  ides(MountSource
+000153e0: 290a 2020 2020 6465 6620 6765 7446 696c  ).    def getFil
+000153f0: 6549 6e66 6f28 7365 6c66 2c20 7061 7468  eInfo(self, path
+00015400: 3a20 7374 722c 2066 696c 6556 6572 7369  : str, fileVersi
+00015410: 6f6e 3a20 696e 7420 3d20 3029 202d 3e20  on: int = 0) -> 
+00015420: 4f70 7469 6f6e 616c 5b46 696c 6549 6e66  Optional[FileInf
+00015430: 6f5d 3a0a 2020 2020 2020 2020 2222 2241  o]:.        """A
+00015440: 6c6c 2072 6574 7572 6e65 6420 6669 6c65  ll returned file
+00015450: 2069 6e66 6f73 2063 6f6e 7461 696e 2061   infos contain a
+00015460: 2066 696c 6520 7061 7468 2073 7472 696e   file path strin
+00015470: 6720 6174 2074 6865 2062 6163 6b20 6f66  g at the back of
+00015480: 2046 696c 6549 6e66 6f2e 7573 6572 6461   FileInfo.userda
+00015490: 7461 2e22 2222 0a0a 2020 2020 2020 2020  ta."""..        
+000154a0: 2320 5468 6973 2069 7320 6120 6269 7420  # This is a bit 
+000154b0: 6f66 2070 726f 626c 656d 6174 6963 2064  of problematic d
+000154c0: 6573 6967 6e2c 2068 6f77 6576 6572 2c20  esign, however, 
+000154d0: 7468 6520 6669 6c65 5665 7273 696f 6e73  the fileVersions
+000154e0: 2063 6f75 6e74 2066 726f 6d20 3120 666f   count from 1 fo
+000154f0: 7220 7468 6520 7573 6572 2e0a 2020 2020  r the user..    
+00015500: 2020 2020 2320 416e 6420 6173 202d 3120      # And as -1 
+00015510: 6d65 616e 7320 7468 6520 6c61 7374 2076  means the last v
+00015520: 6572 7369 6f6e 2c20 3020 7368 6f75 6c64  ersion, 0 should
+00015530: 2061 6c73 6f20 6d65 616e 2074 6865 2066   also mean the f
+00015540: 6972 7374 2076 6572 7369 6f6e 202e 2e2e  irst version ...
+00015550: 0a20 2020 2020 2020 2023 2042 6173 6963  .        # Basic
+00015560: 616c 6c79 2c20 4920 6469 6420 6163 6369  ally, I did acci
+00015570: 6465 6e74 616c 6c79 206d 6978 2075 7365  dentally mix use
+00015580: 722d 7669 7369 626c 6520 7665 7273 696f  r-visible versio
+00015590: 6e73 2031 2b20 7665 7273 696f 6e73 2077  ns 1+ versions w
+000155a0: 6974 6820 4150 4920 302b 2076 6572 7369  ith API 0+ versi
+000155b0: 6f6e 732c 0a20 2020 2020 2020 2023 206c  ons,.        # l
+000155c0: 6561 6469 6e67 2074 6f20 7468 6973 2070  eading to this p
+000155d0: 726f 626c 656d 6174 6963 2063 6c61 7368  roblematic clash
+000155e0: 206f 6620 3020 616e 6420 312e 0a20 2020   of 0 and 1..   
+000155f0: 2020 2020 2069 6620 6669 6c65 5665 7273       if fileVers
+00015600: 696f 6e20 6e6f 7420 696e 205b 302c 2031  ion not in [0, 1
+00015610: 5d20 6f72 206e 6f74 2073 656c 662e 6578  ] or not self.ex
+00015620: 6973 7473 2870 6174 6829 3a0a 2020 2020  ists(path):.    
+00015630: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00015640: 6f6e 650a 0a20 2020 2020 2020 2072 6561  one..        rea
+00015650: 6c70 6174 6820 3d20 7365 6c66 2e5f 7265  lpath = self._re
+00015660: 616c 7061 7468 2870 6174 6829 0a0a 2020  alpath(path)..  
+00015670: 2020 2020 2020 7374 6174 7320 3d20 6f73        stats = os
+00015680: 2e6c 7374 6174 2872 6561 6c70 6174 6829  .lstat(realpath)
+00015690: 0a0a 2020 2020 2020 2020 6669 6c65 496e  ..        fileIn
+000156a0: 666f 203d 2046 696c 6549 6e66 6f28 0a20  fo = FileInfo(. 
+000156b0: 2020 2020 2020 2020 2020 2023 2066 6d74             # fmt
+000156c0: 3a20 6f66 660a 2020 2020 2020 2020 2020  : off.          
+000156d0: 2020 7369 7a65 2020 2020 203d 2073 7461    size     = sta
+000156e0: 7473 2e73 745f 7369 7a65 2c0a 2020 2020  ts.st_size,.    
+000156f0: 2020 2020 2020 2020 6d74 696d 6520 2020          mtime   
+00015700: 203d 2073 7461 7473 2e73 745f 6d74 696d   = stats.st_mtim
+00015710: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00015720: 6f64 6520 2020 2020 3d20 7374 6174 732e  ode     = stats.
+00015730: 7374 5f6d 6f64 652c 0a20 2020 2020 2020  st_mode,.       
+00015740: 2020 2020 206c 696e 6b6e 616d 6520 3d20       linkname = 
+00015750: 6f73 2e72 6561 646c 696e 6b28 7265 616c  os.readlink(real
+00015760: 7061 7468 2920 6966 206f 732e 7061 7468  path) if os.path
+00015770: 2e69 736c 696e 6b28 7265 616c 7061 7468  .islink(realpath
+00015780: 2920 656c 7365 2022 222c 0a20 2020 2020  ) else "",.     
+00015790: 2020 2020 2020 2075 6964 2020 2020 2020         uid      
+000157a0: 3d20 7374 6174 732e 7374 5f75 6964 2c0a  = stats.st_uid,.
+000157b0: 2020 2020 2020 2020 2020 2020 6769 6420              gid 
+000157c0: 2020 2020 203d 2073 7461 7473 2e73 745f       = stats.st_
+000157d0: 6769 642c 0a20 2020 2020 2020 2020 2020  gid,.           
+000157e0: 2075 7365 7264 6174 6120 3d20 5b70 6174   userdata = [pat
+000157f0: 685d 2c0a 2020 2020 2020 2020 2020 2020  h],.            
+00015800: 2320 666d 743a 206f 6e0a 2020 2020 2020  # fmt: on.      
+00015810: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
+00015820: 7572 6e20 6669 6c65 496e 666f 0a0a 2020  urn fileInfo..  
+00015830: 2020 406f 7665 7272 6964 6573 284d 6f75    @overrides(Mou
+00015840: 6e74 536f 7572 6365 290a 2020 2020 6465  ntSource).    de
+00015850: 6620 6c69 7374 4469 7228 7365 6c66 2c20  f listDir(self, 
+00015860: 7061 7468 3a20 7374 7229 202d 3e20 4f70  path: str) -> Op
+00015870: 7469 6f6e 616c 5b49 7465 7261 626c 655b  tional[Iterable[
+00015880: 7374 725d 5d3a 0a20 2020 2020 2020 2072  str]]:.        r
+00015890: 6561 6c70 6174 6820 3d20 7365 6c66 2e5f  ealpath = self._
+000158a0: 7265 616c 7061 7468 2870 6174 6829 0a20  realpath(path). 
+000158b0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+000158c0: 2e70 6174 682e 6973 6469 7228 7265 616c  .path.isdir(real
+000158d0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+000158e0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+000158f0: 2020 2020 2020 2020 6669 6c65 7320 3d20          files = 
+00015900: 6c69 7374 286f 732e 6c69 7374 6469 7228  list(os.listdir(
+00015910: 7265 616c 7061 7468 2929 0a0a 2020 2020  realpath))..    
+00015920: 2020 2020 7265 7475 726e 2066 696c 6573      return files
+00015930: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
+00015940: 284d 6f75 6e74 536f 7572 6365 290a 2020  (MountSource).  
+00015950: 2020 6465 6620 6669 6c65 5665 7273 696f    def fileVersio
+00015960: 6e73 2873 656c 662c 2070 6174 683a 2073  ns(self, path: s
+00015970: 7472 2920 2d3e 2069 6e74 3a0a 2020 2020  tr) -> int:.    
+00015980: 2020 2020 7265 7475 726e 2031 2069 6620      return 1 if 
+00015990: 7365 6c66 2e65 7869 7374 7328 7061 7468  self.exists(path
+000159a0: 2920 656c 7365 2030 0a0a 2020 2020 406f  ) else 0..    @o
+000159b0: 7665 7272 6964 6573 284d 6f75 6e74 536f  verrides(MountSo
+000159c0: 7572 6365 290a 2020 2020 6465 6620 6f70  urce).    def op
+000159d0: 656e 2873 656c 662c 2066 696c 6549 6e66  en(self, fileInf
+000159e0: 6f3a 2046 696c 6549 6e66 6f29 202d 3e20  o: FileInfo) -> 
+000159f0: 494f 5b62 7974 6573 5d3a 0a20 2020 2020  IO[bytes]:.     
+00015a00: 2020 2070 6174 6820 3d20 6669 6c65 496e     path = fileIn
+00015a10: 666f 2e75 7365 7264 6174 615b 2d31 5d0a  fo.userdata[-1].
+00015a20: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
+00015a30: 7369 6e73 7461 6e63 6528 7061 7468 2c20  sinstance(path, 
+00015a40: 7374 7229 0a20 2020 2020 2020 2072 6561  str).        rea
+00015a50: 6c70 6174 6820 3d20 7365 6c66 2e5f 7265  lpath = self._re
+00015a60: 616c 7061 7468 2870 6174 6829 0a0a 2020  alpath(path)..  
+00015a70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00015a80: 2020 2020 2020 2072 6574 7572 6e20 6f70         return op
+00015a90: 656e 2872 6561 6c70 6174 682c 2027 7262  en(realpath, 'rb
+00015aa0: 2729 0a20 2020 2020 2020 2065 7863 6570  ').        excep
+00015ab0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00015ac0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00015ad0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00015ae0: 5370 6563 6966 6965 6420 7061 7468 2027  Specified path '
+00015af0: 7b7d 2720 6973 206e 6f74 2061 2066 696c  {}' is not a fil
+00015b00: 6520 7468 6174 2063 616e 2062 6520 7265  e that can be re
+00015b10: 6164 2122 2e66 6f72 6d61 7428 7265 616c  ad!".format(real
+00015b20: 7061 7468 2929 2066 726f 6d20 650a 0a20  path)) from e.. 
+00015b30: 2020 2040 6f76 6572 7269 6465 7328 4d6f     @overrides(Mo
+00015b40: 756e 7453 6f75 7263 6529 0a20 2020 2064  untSource).    d
+00015b50: 6566 2072 6561 6428 7365 6c66 2c20 6669  ef read(self, fi
+00015b60: 6c65 496e 666f 3a20 4669 6c65 496e 666f  leInfo: FileInfo
+00015b70: 2c20 7369 7a65 3a20 696e 742c 206f 6666  , size: int, off
+00015b80: 7365 743a 2069 6e74 2920 2d3e 2062 7974  set: int) -> byt
+00015b90: 6573 3a0a 2020 2020 2020 2020 7769 7468  es:.        with
+00015ba0: 2073 656c 662e 6f70 656e 2866 696c 6549   self.open(fileI
+00015bb0: 6e66 6f29 2061 7320 6669 6c65 3a0a 2020  nfo) as file:.  
+00015bc0: 2020 2020 2020 2020 2020 6669 6c65 2e73            file.s
+00015bd0: 6565 6b28 6f66 6673 6574 2c20 6f73 2e53  eek(offset, os.S
+00015be0: 4545 4b5f 5345 5429 0a20 2020 2020 2020  EEK_SET).       
+00015bf0: 2020 2020 2072 6574 7572 6e20 6669 6c65       return file
+00015c00: 2e72 6561 6428 7369 7a65 290a 0a20 2020  .read(size)..   
+00015c10: 2064 6566 2067 6574 4669 6c65 5061 7468   def getFilePath
+00015c20: 2873 656c 662c 2066 696c 6549 6e66 6f3a  (self, fileInfo:
+00015c30: 2046 696c 6549 6e66 6f29 202d 3e20 7374   FileInfo) -> st
+00015c40: 723a 0a20 2020 2020 2020 2070 6174 6820  r:.        path 
+00015c50: 3d20 6669 6c65 496e 666f 2e75 7365 7264  = fileInfo.userd
+00015c60: 6174 615b 2d31 5d0a 2020 2020 2020 2020  ata[-1].        
+00015c70: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+00015c80: 6528 7061 7468 2c20 7374 7229 0a20 2020  e(path, str).   
+00015c90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00015ca0: 2e5f 7265 616c 7061 7468 2870 6174 6829  ._realpath(path)
+00015cb0: 0a0a 0a63 6c61 7373 2041 7574 6f4d 6f75  ...class AutoMou
+00015cc0: 6e74 4c61 7965 7228 4d6f 756e 7453 6f75  ntLayer(MountSou
+00015cd0: 7263 6529 3a0a 2020 2020 2222 220a 2020  rce):.    """.  
+00015ce0: 2020 5468 6973 206d 6f75 6e74 2073 6f75    This mount sou
+00015cf0: 7263 6520 7461 6b65 7320 616e 6f74 6865  rce takes anothe
+00015d00: 7220 6d6f 756e 7420 736f 7572 6365 2061  r mount source a
+00015d10: 6e64 2061 7574 6f6d 6174 6963 616c 6c79  nd automatically
+00015d20: 2073 686f 7773 2074 6865 2063 6f6e 7465   shows the conte
+00015d30: 6e74 7320 6f66 2066 696c 6573 2077 6869  nts of files whi
+00015d40: 6368 2061 7265 2061 7263 6869 7665 732e  ch are archives.
+00015d50: 0a20 2020 2054 6865 2064 6574 6169 6c65  .    The detaile
+00015d60: 6420 6265 6861 7669 6f72 2063 616e 2062  d behavior can b
+00015d70: 6520 636f 6e74 726f 6c6c 6564 2075 7369  e controlled usi
+00015d80: 6e67 206f 7074 696f 6e73 2e0a 2020 2020  ng options..    
+00015d90: 2222 220a 0a20 2020 205f 5f73 6c6f 7473  """..    __slots
+00015da0: 5f5f 203d 2028 276d 6f75 6e74 6564 272c  __ = ('mounted',
+00015db0: 2027 6f70 7469 6f6e 7327 290a 0a20 2020   'options')..   
+00015dc0: 2040 6461 7461 636c 6173 730a 2020 2020   @dataclass.    
+00015dd0: 636c 6173 7320 4d6f 756e 7449 6e66 6f3a  class MountInfo:
+00015de0: 0a20 2020 2020 2020 206d 6f75 6e74 536f  .        mountSo
+00015df0: 7572 6365 3a20 4d6f 756e 7453 6f75 7263  urce: MountSourc
+00015e00: 650a 2020 2020 2020 2020 726f 6f74 4669  e.        rootFi
+00015e10: 6c65 496e 666f 3a20 4669 6c65 496e 666f  leInfo: FileInfo
+00015e20: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00015e30: 5f5f 2873 656c 662c 206d 6f75 6e74 536f  __(self, mountSo
+00015e40: 7572 6365 3a20 4d6f 756e 7453 6f75 7263  urce: MountSourc
+00015e50: 652c 202a 2a6f 7074 696f 6e73 2920 2d3e  e, **options) ->
+00015e60: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00015e70: 656c 662e 6f70 7469 6f6e 7320 3d20 6f70  elf.options = op
+00015e80: 7469 6f6e 730a 0a20 2020 2020 2020 2072  tions..        r
+00015e90: 6f6f 7446 696c 6549 6e66 6f20 3d20 4669  ootFileInfo = Fi
+00015ea0: 6c65 496e 666f 280a 2020 2020 2020 2020  leInfo(.        
+00015eb0: 2020 2020 2320 666d 743a 206f 6666 0a20      # fmt: off. 
+00015ec0: 2020 2020 2020 2020 2020 2073 697a 6520             size 
+00015ed0: 2020 2020 2020 2020 3d20 302c 0a20 2020          = 0,.   
+00015ee0: 2020 2020 2020 2020 206d 7469 6d65 2020           mtime  
+00015ef0: 2020 2020 2020 3d20 696e 7428 7469 6d65        = int(time
+00015f00: 2e74 696d 6528 2929 2c0a 2020 2020 2020  .time()),.      
+00015f10: 2020 2020 2020 6d6f 6465 2020 2020 2020        mode      
+00015f20: 2020 203d 2030 6f35 3535 207c 2073 7461     = 0o555 | sta
+00015f30: 742e 535f 4946 4449 522c 0a20 2020 2020  t.S_IFDIR,.     
+00015f40: 2020 2020 2020 206c 696e 6b6e 616d 6520         linkname 
+00015f50: 2020 2020 3d20 2222 2c0a 2020 2020 2020      = "",.      
+00015f60: 2020 2020 2020 7569 6420 2020 2020 2020        uid       
+00015f70: 2020 203d 206f 732e 6765 7475 6964 2829     = os.getuid()
+00015f80: 2c0a 2020 2020 2020 2020 2020 2020 6769  ,.            gi
+00015f90: 6420 2020 2020 2020 2020 203d 206f 732e  d          = os.
+00015fa0: 6765 7467 6964 2829 2c0a 2020 2020 2020  getgid(),.      
+00015fb0: 2020 2020 2020 7573 6572 6461 7461 2020        userdata  
+00015fc0: 2020 203d 205b 272f 275d 2c0a 2020 2020     = ['/'],.    
+00015fd0: 2020 2020 2020 2020 2320 666d 743a 206f          # fmt: o
+00015fe0: 6e0a 2020 2020 2020 2020 290a 0a20 2020  n.        )..   
+00015ff0: 2020 2020 2023 204d 6f75 6e74 2070 6f69       # Mount poi
+00016000: 6e74 7320 6172 6520 7370 6563 6966 6965  nts are specifie
+00016010: 6420 7769 7468 6f75 7420 7472 6169 6c69  d without traili
+00016020: 6e67 2073 6c61 7368 2061 6e64 2077 6974  ng slash and wit
+00016030: 6820 6c65 6164 696e 6720 736c 6173 680a  h leading slash.
+00016040: 2020 2020 2020 2020 2320 7265 7072 6573          # repres
+00016050: 656e 7469 6e67 2072 6f6f 7420 6f66 2074  enting root of t
+00016060: 6869 7320 6d6f 756e 7420 736f 7572 6365  his mount source
+00016070: 2e0a 2020 2020 2020 2020 2320 4469 7361  ..        # Disa
+00016080: 626c 6520 6661 6c73 6520 706f 7369 7469  ble false positi
+00016090: 7665 2069 6e74 726f 6475 6365 6420 7768  ve introduced wh
+000160a0: 656e 2075 7064 6174 696e 6720 7079 6c69  en updating pyli
+000160b0: 6e74 2066 726f 6d20 322e 3620 746f 2032  nt from 2.6 to 2
+000160c0: 2e31 322e 0a20 2020 2020 2020 2023 2049  .12..        # I
+000160d0: 7420 6e6f 7720 7468 696e 6b73 2074 6861  t now thinks tha
+000160e0: 7420 7468 6520 6173 7369 676e 6d65 6e74  t the assignment
+000160f0: 2069 7320 746f 2041 7574 6f4d 6f75 6e74   is to AutoMount
+00016100: 4c61 7965 7220 696e 7374 6561 6420 6f66  Layer instead of
+00016110: 2073 656c 662e 6d6f 756e 7465 642e 0a20   self.mounted.. 
+00016120: 2020 2020 2020 2023 2070 796c 696e 743a         # pylint:
+00016130: 2064 6973 6162 6c65 3d75 7365 642d 6265   disable=used-be
+00016140: 666f 7265 2d61 7373 6967 6e6d 656e 740a  fore-assignment.
+00016150: 2020 2020 2020 2020 7365 6c66 2e6d 6f75          self.mou
+00016160: 6e74 6564 3a20 4469 6374 5b73 7472 2c20  nted: Dict[str, 
+00016170: 4175 746f 4d6f 756e 744c 6179 6572 2e4d  AutoMountLayer.M
+00016180: 6f75 6e74 496e 666f 5d20 3d20 7b27 2f27  ountInfo] = {'/'
+00016190: 3a20 4175 746f 4d6f 756e 744c 6179 6572  : AutoMountLayer
+000161a0: 2e4d 6f75 6e74 496e 666f 286d 6f75 6e74  .MountInfo(mount
+000161b0: 536f 7572 6365 2c20 726f 6f74 4669 6c65  Source, rootFile
+000161c0: 496e 666f 297d 0a0a 2020 2020 2020 2020  Info)}..        
+000161d0: 6966 206e 6f74 2073 656c 662e 6f70 7469  if not self.opti
+000161e0: 6f6e 732e 6765 7428 2772 6563 7572 7369  ons.get('recursi
+000161f0: 7665 272c 2046 616c 7365 2920 6f72 2073  ve', False) or s
+00016200: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00016210: 276c 617a 794d 6f75 6e74 696e 6727 2c20  'lazyMounting', 
+00016220: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00016230: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+00016240: 2020 2020 2320 476f 206f 7665 7220 616c      # Go over al
+00016250: 6c20 6669 6c65 7320 616e 6420 6d6f 756e  l files and moun
+00016260: 7420 6172 6368 6976 6573 2061 6e64 2065  t archives and e
+00016270: 7665 6e20 6172 6368 6976 6573 2069 6e20  ven archives in 
+00016280: 7468 6f73 6520 6172 6368 6976 6573 0a20  those archives. 
+00016290: 2020 2020 2020 2066 6f6c 6465 7273 546f         foldersTo
+000162a0: 5761 6c6b 203d 205b 272f 275d 0a20 2020  Walk = ['/'].   
+000162b0: 2020 2020 2077 6869 6c65 2066 6f6c 6465       while folde
+000162c0: 7273 546f 5761 6c6b 3a0a 2020 2020 2020  rsToWalk:.      
+000162d0: 2020 2020 2020 666f 6c64 6572 203d 2066        folder = f
+000162e0: 6f6c 6465 7273 546f 5761 6c6b 2e70 6f70  oldersToWalk.pop
+000162f0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
+00016300: 696c 654e 616d 6573 203d 2073 656c 662e  ileNames = self.
+00016310: 6c69 7374 4469 7228 666f 6c64 6572 290a  listDir(folder).
+00016320: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00016330: 6f74 2066 696c 654e 616d 6573 3a0a 2020  ot fileNames:.  
+00016340: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016350: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+00016360: 2020 2020 666f 7220 6669 6c65 4e61 6d65      for fileName
+00016370: 2069 6e20 6669 6c65 4e61 6d65 733a 0a20   in fileNames:. 
+00016380: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00016390: 696c 6550 6174 6820 3d20 6f73 2e70 6174  ilePath = os.pat
+000163a0: 682e 6a6f 696e 2866 6f6c 6465 722c 2066  h.join(folder, f
+000163b0: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
+000163c0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000163d0: 2e69 7364 6972 2866 696c 6550 6174 6829  .isdir(filePath)
+000163e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000163f0: 2020 2020 2020 666f 6c64 6572 7354 6f57        foldersToW
+00016400: 616c 6b2e 6170 7065 6e64 2866 696c 6550  alk.append(fileP
+00016410: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
+00016420: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00016430: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00016440: 6f75 6e74 506f 696e 7420 3d20 7365 6c66  ountPoint = self
+00016450: 2e5f 7472 7954 6f4d 6f75 6e74 4669 6c65  ._tryToMountFile
+00016460: 2866 696c 6550 6174 6829 0a20 2020 2020  (filePath).     
+00016470: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016480: 6620 6d6f 756e 7450 6f69 6e74 3a0a 2020  f mountPoint:.  
+00016490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164a0: 2020 2020 2020 666f 6c64 6572 7354 6f57        foldersToW
+000164b0: 616c 6b2e 6170 7065 6e64 286d 6f75 6e74  alk.append(mount
+000164c0: 506f 696e 7429 0a0a 2020 2020 6465 6620  Point)..    def 
+000164d0: 5f73 696d 706c 7946 696e 644d 6f75 6e74  _simplyFindMount
+000164e0: 6564 2873 656c 662c 2070 6174 683a 2073  ed(self, path: s
+000164f0: 7472 2920 2d3e 2054 7570 6c65 5b73 7472  tr) -> Tuple[str
+00016500: 2c20 7374 725d 3a0a 2020 2020 2020 2020  , str]:.        
+00016510: 2222 2253 6565 205f 6669 6e64 4d6f 756e  """See _findMoun
+00016520: 7465 642e 2054 6869 7320 6973 2073 706c  ted. This is spl
+00016530: 6974 206f 6666 2074 6f20 6176 6f69 6420  it off to avoid 
+00016540: 636f 6e76 6f6c 7574 6564 2072 6563 7572  convoluted recur
+00016550: 7369 6f6e 7320 6475 7269 6e67 206c 617a  sions during laz
+00016560: 7920 6d6f 756e 7469 6e67 2e22 2222 0a0a  y mounting."""..
+00016570: 2020 2020 2020 2020 6c65 6674 5061 7274          leftPart
+00016580: 203d 2070 6174 680a 2020 2020 2020 2020   = path.        
+00016590: 7269 6768 7450 6172 7473 3a20 4c69 7374  rightParts: List
+000165a0: 5b73 7472 5d20 3d20 5b5d 0a20 2020 2020  [str] = [].     
+000165b0: 2020 2077 6869 6c65 2027 2f27 2069 6e20     while '/' in 
+000165c0: 6c65 6674 5061 7274 3a0a 2020 2020 2020  leftPart:.      
+000165d0: 2020 2020 2020 6966 206c 6566 7450 6172        if leftPar
+000165e0: 7420 696e 2073 656c 662e 6d6f 756e 7465  t in self.mounte
+000165f0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00016600: 2020 2072 6574 7572 6e20 6c65 6674 5061     return leftPa
+00016610: 7274 2c20 272f 2720 2b20 272f 272e 6a6f  rt, '/' + '/'.jo
+00016620: 696e 2872 6967 6874 5061 7274 7329 0a0a  in(rightParts)..
+00016630: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00016640: 7320 3d20 6c65 6674 5061 7274 2e72 7370  s = leftPart.rsp
+00016650: 6c69 7428 272f 272c 2031 290a 2020 2020  lit('/', 1).    
+00016660: 2020 2020 2020 2020 6c65 6674 5061 7274          leftPart
+00016670: 203d 2070 6172 7473 5b30 5d0a 2020 2020   = parts[0].    
+00016680: 2020 2020 2020 2020 7269 6768 7450 6172          rightPar
+00016690: 7473 2e69 6e73 6572 7428 302c 2070 6172  ts.insert(0, par
+000166a0: 7473 5b31 5d29 0a0a 2020 2020 2020 2020  ts[1])..        
+000166b0: 6173 7365 7274 2027 2f27 2069 6e20 7365  assert '/' in se
+000166c0: 6c66 2e6d 6f75 6e74 6564 0a20 2020 2020  lf.mounted.     
+000166d0: 2020 2072 6574 7572 6e20 272f 272c 2070     return '/', p
+000166e0: 6174 680a 0a20 2020 2064 6566 205f 7472  ath..    def _tr
+000166f0: 7954 6f4d 6f75 6e74 4669 6c65 2873 656c  yToMountFile(sel
+00016700: 662c 2070 6174 683a 2073 7472 2920 2d3e  f, path: str) ->
+00016710: 204f 7074 696f 6e61 6c5b 7374 725d 3a0a   Optional[str]:.
+00016720: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016730: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
+00016740: 6d6f 756e 7420 706f 696e 7420 7061 7468  mount point path
+00016750: 2069 6620 6974 2068 6173 2062 6565 6e20   if it has been 
+00016760: 7375 6363 6573 7366 756c 6c79 206d 6f75  successfully mou
+00016770: 6e74 6564 2e0a 2020 2020 2020 2020 7061  nted..        pa
+00016780: 7468 3a20 5061 7468 2069 6e73 6964 6520  th: Path inside 
+00016790: 7468 6973 206d 6f75 6e74 2073 6f75 7263  this mount sourc
+000167a0: 652e 204d 6179 2069 6e63 6c75 6465 2072  e. May include r
+000167b0: 6563 7572 7369 7665 6c79 206d 6f75 6e74  ecursively mount
+000167c0: 6564 206d 6f75 6e74 2070 6f69 6e74 732e  ed mount points.
+000167d0: 0a20 2020 2020 2020 2020 2020 2020 2053  .              S
+000167e0: 686f 756c 6420 636f 6e74 6169 6e20 6120  hould contain a 
+000167f0: 6c65 6164 696e 6720 736c 6173 682e 0a20  leading slash.. 
+00016800: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00016810: 2020 2020 2320 466f 7220 6265 7474 6572      # For better
+00016820: 2070 6572 666f 726d 616e 6365 2c20 6f6e   performance, on
+00016830: 6c79 206c 6f6f 6b20 6174 2074 6865 2073  ly look at the s
+00016840: 7566 6669 7820 6e6f 7420 6174 2074 6865  uffix not at the
+00016850: 206d 6167 6963 2062 7974 6573 2e0a 2020   magic bytes..  
+00016860: 2020 2020 2020 7374 7269 7070 6564 4669        strippedFi
+00016870: 6c65 5061 7468 203d 2073 7472 6970 5375  lePath = stripSu
+00016880: 6666 6978 4672 6f6d 5461 7246 696c 6528  ffixFromTarFile(
+00016890: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
+000168a0: 2073 7472 6970 7065 6446 696c 6550 6174   strippedFilePat
+000168b0: 6820 3d3d 2070 6174 683a 0a20 2020 2020  h == path:.     
+000168c0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000168d0: 6e65 0a0a 2020 2020 2020 2020 6d6f 756e  ne..        moun
+000168e0: 7450 6f69 6e74 203d 2073 7472 6970 7065  tPoint = strippe
+000168f0: 6446 696c 6550 6174 6820 6966 2073 656c  dFilePath if sel
+00016900: 662e 6f70 7469 6f6e 732e 6765 7428 2773  f.options.get('s
+00016910: 7472 6970 5265 6375 7273 6976 6554 6172  tripRecursiveTar
+00016920: 4578 7465 6e73 696f 6e27 2c20 4661 6c73  Extension', Fals
+00016930: 6529 2065 6c73 6520 7061 7468 0a20 2020  e) else path.   
+00016940: 2020 2020 2069 6620 6d6f 756e 7450 6f69       if mountPoi
+00016950: 6e74 2069 6e20 7365 6c66 2e6d 6f75 6e74  nt in self.mount
+00016960: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00016970: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+00016980: 2020 2020 2023 2055 7365 205f 7369 6d70       # Use _simp
+00016990: 6c79 4669 6e64 4d6f 756e 7465 6420 696e  lyFindMounted in
+000169a0: 7374 6561 6420 6f66 205f 6669 6e64 4d6f  stead of _findMo
+000169b0: 756e 7465 6420 6f72 2073 656c 662e 6f70  unted or self.op
+000169c0: 656e 2074 6f20 6176 6f69 6420 7265 6375  en to avoid recu
+000169d0: 7273 696f 6e73 2063 6175 7365 6420 6279  rsions caused by
+000169e0: 206c 617a 7920 6d6f 756e 7469 6e67 210a   lazy mounting!.
+000169f0: 2020 2020 2020 2020 7061 7265 6e74 4d6f          parentMo
+00016a00: 756e 7450 6f69 6e74 2c20 7061 7468 496e  untPoint, pathIn
+00016a10: 7369 6465 5061 7265 6e74 4d6f 756e 7450  sideParentMountP
+00016a20: 6f69 6e74 203d 2073 656c 662e 5f73 696d  oint = self._sim
+00016a30: 706c 7946 696e 644d 6f75 6e74 6564 2870  plyFindMounted(p
+00016a40: 6174 6829 0a20 2020 2020 2020 2070 6172  ath).        par
+00016a50: 656e 744d 6f75 6e74 536f 7572 6365 203d  entMountSource =
+00016a60: 2073 656c 662e 6d6f 756e 7465 645b 7061   self.mounted[pa
+00016a70: 7265 6e74 4d6f 756e 7450 6f69 6e74 5d2e  rentMountPoint].
+00016a80: 6d6f 756e 7453 6f75 7263 650a 0a20 2020  mountSource..   
+00016a90: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00016aa0: 2020 2020 2020 6172 6368 6976 6546 696c        archiveFil
+00016ab0: 6549 6e66 6f20 3d20 7061 7265 6e74 4d6f  eInfo = parentMo
+00016ac0: 756e 7453 6f75 7263 652e 6765 7446 696c  untSource.getFil
+00016ad0: 6549 6e66 6f28 7061 7468 496e 7369 6465  eInfo(pathInside
+00016ae0: 5061 7265 6e74 4d6f 756e 7450 6f69 6e74  ParentMountPoint
+00016af0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00016b00: 2061 7263 6869 7665 4669 6c65 496e 666f   archiveFileInfo
+00016b10: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00016b20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016b30: 204e 6f6e 650a 0a20 2020 2020 2020 2020   None..         
+00016b40: 2020 205f 2c20 6465 6570 6573 744d 6f75     _, deepestMou
+00016b50: 6e74 536f 7572 6365 2c20 6465 6570 6573  ntSource, deepes
+00016b60: 7446 696c 6549 6e66 6f20 3d20 7061 7265  tFileInfo = pare
+00016b70: 6e74 4d6f 756e 7453 6f75 7263 652e 6765  ntMountSource.ge
+00016b80: 744d 6f75 6e74 536f 7572 6365 2861 7263  tMountSource(arc
+00016b90: 6869 7665 4669 6c65 496e 666f 290a 2020  hiveFileInfo).  
+00016ba0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00016bb0: 6e73 7461 6e63 6528 6465 6570 6573 744d  nstance(deepestM
+00016bc0: 6f75 6e74 536f 7572 6365 2c20 466f 6c64  ountSource, Fold
+00016bd0: 6572 4d6f 756e 7453 6f75 7263 6529 3a0a  erMountSource):.
+00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bf0: 2320 4f70 656e 2066 726f 6d20 6669 6c65  # Open from file
+00016c00: 2070 6174 6820 6f6e 2068 6f73 7420 6669   path on host fi
+00016c10: 6c65 2073 7973 7465 6d20 696e 206f 7264  le system in ord
+00016c20: 6572 2074 6f20 7772 6974 6520 6f75 7420  er to write out 
+00016c30: 5441 5220 696e 6465 7820 6669 6c65 732e  TAR index files.
+00016c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c50: 206d 6f75 6e74 536f 7572 6365 203d 206f   mountSource = o
+00016c60: 7065 6e4d 6f75 6e74 536f 7572 6365 2864  penMountSource(d
+00016c70: 6565 7065 7374 4d6f 756e 7453 6f75 7263  eepestMountSourc
+00016c80: 652e 6765 7446 696c 6550 6174 6828 6465  e.getFilePath(de
+00016c90: 6570 6573 7446 696c 6549 6e66 6f29 2c20  epestFileInfo), 
+00016ca0: 2a2a 7365 6c66 2e6f 7074 696f 6e73 290a  **self.options).
+00016cb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00016cc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016cd0: 2020 2320 5468 6973 2077 696c 6c20 6661    # This will fa
+00016ce0: 696c 2077 6974 6820 5374 656e 6369 6c65  il with Stencile
+00016cf0: 6446 696c 6520 6f62 6a65 6374 7320 6173  dFile objects as
+00016d00: 2072 6574 7572 6e65 6420 6279 2053 514c   returned by SQL
+00016d10: 6974 6549 6e64 6578 6564 5461 7220 6d6f  iteIndexedTar mo
+00016d20: 756e 7420 736f 7572 6365 7320 616e 6420  unt sources and 
+00016d30: 7768 656e 0a20 2020 2020 2020 2020 2020  when.           
+00016d40: 2020 2020 2023 2067 6976 656e 2074 6f20       # given to 
+00016d50: 6261 636b 656e 6473 206c 696b 6520 696e  backends like in
+00016d60: 6465 7865 645f 7878 782c 2077 6869 6368  dexed_xxx, which
+00016d70: 2064 6f20 6578 7065 6374 2074 6865 2066   do expect the f
+00016d80: 696c 6520 6f62 6a65 6374 2074 6f20 6861  ile object to ha
+00016d90: 7665 2061 2076 616c 6964 2066 696c 656e  ve a valid filen
+00016da0: 6f2e 0a20 2020 2020 2020 2020 2020 2020  o..             
+00016db0: 2020 206d 6f75 6e74 536f 7572 6365 203d     mountSource =
+00016dc0: 206f 7065 6e4d 6f75 6e74 536f 7572 6365   openMountSource
+00016dd0: 2870 6172 656e 744d 6f75 6e74 536f 7572  (parentMountSour
+00016de0: 6365 2e6f 7065 6e28 6172 6368 6976 6546  ce.open(archiveF
+00016df0: 696c 6549 6e66 6f29 2c20 2a2a 7365 6c66  ileInfo), **self
+00016e00: 2e6f 7074 696f 6e73 290a 2020 2020 2020  .options).      
+00016e10: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00016e20: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00016e30: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
+00016e40: 6e69 6e67 5d20 4d6f 756e 7469 6e67 206f  ning] Mounting o
+00016e50: 6620 2722 202b 2070 6174 6820 2b20 2227  f '" + path + "'
+00016e60: 2066 6169 6c65 6420 6265 6361 7573 6520   failed because 
+00016e70: 6f66 3a22 2c20 6529 0a20 2020 2020 2020  of:", e).       
+00016e80: 2020 2020 2069 6620 7072 696e 7444 6562       if printDeb
+00016e90: 7567 203e 3d20 333a 0a20 2020 2020 2020  ug >= 3:.       
+00016ea0: 2020 2020 2020 2020 2074 7261 6365 6261           traceba
+00016eb0: 636b 2e70 7269 6e74 5f65 7863 2829 0a20  ck.print_exc(). 
+00016ec0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00016ed0: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+00016ee0: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
+00016ef0: 2020 2020 726f 6f74 4669 6c65 496e 666f      rootFileInfo
+00016f00: 203d 2061 7263 6869 7665 4669 6c65 496e   = archiveFileIn
+00016f10: 666f 2e63 6c6f 6e65 2829 0a20 2020 2020  fo.clone().     
+00016f20: 2020 2072 6f6f 7446 696c 6549 6e66 6f2e     rootFileInfo.
+00016f30: 6d6f 6465 203d 2028 726f 6f74 4669 6c65  mode = (rootFile
+00016f40: 496e 666f 2e6d 6f64 6520 2620 306f 3737  Info.mode & 0o77
+00016f50: 3729 207c 2073 7461 742e 535f 4946 4449  7) | stat.S_IFDI
+00016f60: 520a 2020 2020 2020 2020 726f 6f74 4669  R.        rootFi
+00016f70: 6c65 496e 666f 2e6c 696e 6b6e 616d 6520  leInfo.linkname 
+00016f80: 3d20 2222 0a20 2020 2020 2020 2072 6f6f  = "".        roo
+00016f90: 7446 696c 6549 6e66 6f2e 7573 6572 6461  tFileInfo.userda
+00016fa0: 7461 203d 205b 6d6f 756e 7450 6f69 6e74  ta = [mountPoint
+00016fb0: 5d0a 2020 2020 2020 2020 6d6f 756e 7449  ].        mountI
+00016fc0: 6e66 6f20 3d20 4175 746f 4d6f 756e 744c  nfo = AutoMountL
+00016fd0: 6179 6572 2e4d 6f75 6e74 496e 666f 286d  ayer.MountInfo(m
+00016fe0: 6f75 6e74 536f 7572 6365 2c20 726f 6f74  ountSource, root
+00016ff0: 4669 6c65 496e 666f 290a 0a20 2020 2020  FileInfo)..     
+00017000: 2020 2023 2054 4f44 4f20 5768 6174 2069     # TODO What i
+00017010: 6620 7468 6520 6d6f 756e 7420 706f 696e  f the mount poin
+00017020: 7420 616c 7265 6164 7920 6578 6973 7473  t already exists
+00017030: 2c20 652e 672e 2c20 6265 6361 7573 6520  , e.g., because 
+00017040: 7374 7269 7052 6563 7572 7369 7665 5461  stripRecursiveTa
+00017050: 7245 7874 656e 7369 6f6e 2069 7320 7472  rExtension is tr
+00017060: 7565 2061 6e64 2074 6865 7265 0a20 2020  ue and there.   
+00017070: 2020 2020 2023 2020 2020 2020 6172 6520       #      are 
+00017080: 6d75 6c74 6970 6c65 2061 7263 6869 7665  multiple archive
+00017090: 7320 7769 7468 2074 6865 2073 616d 6520  s with the same 
+000170a0: 6e61 6d65 2062 7574 2064 6966 6665 7265  name but differe
+000170b0: 6e74 2065 7874 6573 696f 6e73 3f0a 2020  nt extesions?.  
+000170c0: 2020 2020 2020 7365 6c66 2e6d 6f75 6e74        self.mount
+000170d0: 6564 5b6d 6f75 6e74 506f 696e 745d 203d  ed[mountPoint] =
+000170e0: 206d 6f75 6e74 496e 666f 0a20 2020 2020   mountInfo.     
+000170f0: 2020 2069 6620 7072 696e 7444 6562 7567     if printDebug
+00017100: 203e 3d20 323a 0a20 2020 2020 2020 2020   >= 2:.         
+00017110: 2020 2070 7269 6e74 2822 5265 6375 7273     print("Recurs
+00017120: 6976 656c 7920 6d6f 756e 7465 643a 222c  ively mounted:",
+00017130: 206d 6f75 6e74 506f 696e 7429 0a20 2020   mountPoint).   
+00017140: 2020 2020 2020 2020 2070 7269 6e74 2829           print()
+00017150: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00017160: 206d 6f75 6e74 506f 696e 740a 0a20 2020   mountPoint..   
+00017170: 2064 6566 205f 6669 6e64 4d6f 756e 7465   def _findMounte
+00017180: 6428 7365 6c66 2c20 7061 7468 3a20 7374  d(self, path: st
+00017190: 7229 202d 3e20 5475 706c 655b 7374 722c  r) -> Tuple[str,
+000171a0: 2073 7472 5d3a 0a20 2020 2020 2020 2022   str]:.        "
+000171b0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+000171c0: 6e73 2074 6865 206d 6f75 6e74 2070 6f69  ns the mount poi
+000171d0: 6e74 2c20 7768 6963 6820 6361 6e20 6265  nt, which can be
+000171e0: 2066 6f75 6e64 2069 6e20 7365 6c66 2e6d   found in self.m
+000171f0: 6f75 6e74 6564 2c20 616e 6420 7468 6520  ounted, and the 
+00017200: 7265 7374 206f 6620 7468 6520 7061 7468  rest of the path
+00017210: 2e0a 2020 2020 2020 2020 4261 7369 6361  ..        Basica
+00017220: 6c6c 792c 2069 7420 7370 6c69 7473 2070  lly, it splits p
+00017230: 6174 6820 6174 2074 6865 2061 7070 726f  ath at the appro
+00017240: 7072 6961 7465 206d 6f75 6e74 2070 6f69  priate mount poi
+00017250: 6e74 2062 6f75 6e64 6172 792e 0a20 2020  nt boundary..   
+00017260: 2020 2020 2042 6563 6175 7365 206f 6620       Because of 
+00017270: 7468 6520 7265 6375 7273 6976 6520 6d6f  the recursive mo
+00017280: 756e 7469 6e67 2c20 7468 6572 6520 6d69  unting, there mi
+00017290: 6768 7420 6265 206d 756c 7469 706c 6520  ght be multiple 
+000172a0: 6d6f 756e 7420 706f 696e 7473 2066 6974  mount points fit
+000172b0: 7469 6e67 2074 6865 2070 6174 682e 0a20  ting the path.. 
+000172c0: 2020 2020 2020 2054 6865 206c 6f6e 6765         The longe
+000172d0: 7374 2c20 692e 652e 2c20 7468 6520 6465  st, i.e., the de
+000172e0: 6570 6573 7420 6d6f 756e 7420 706f 696e  epest mount poin
+000172f0: 7420 7769 6c6c 2062 6520 7265 7475 726e  t will be return
+00017300: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+00017310: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00017320: 2e6f 7074 696f 6e73 2e67 6574 2827 7265  .options.get('re
+00017330: 6375 7273 6976 6527 2c20 4661 6c73 6529  cursive', False)
+00017340: 2061 6e64 2073 656c 662e 6f70 7469 6f6e   and self.option
+00017350: 732e 6765 7428 276c 617a 794d 6f75 6e74  s.get('lazyMount
+00017360: 696e 6727 2c20 4661 6c73 6529 3a0a 2020  ing', False):.  
+00017370: 2020 2020 2020 2020 2020 7375 6250 6174            subPat
+00017380: 6820 3d20 222f 220a 2020 2020 2020 2020  h = "/".        
+00017390: 2020 2020 2320 4669 7273 7420 676f 2066      # First go f
+000173a0: 726f 6d20 6869 6768 6572 2070 6174 6873  rom higher paths
+000173b0: 2074 6f20 6465 6570 6572 206f 6e65 7320   to deeper ones 
+000173c0: 616e 6420 7472 7920 746f 206d 6f75 6e74  and try to mount
+000173d0: 2061 6c6c 2070 6172 656e 7420 6172 6368   all parent arch
+000173e0: 6976 6573 206c 617a 696c 792e 0a20 2020  ives lazily..   
+000173f0: 2020 2020 2020 2020 2066 6f72 2070 6172           for par
+00017400: 7420 696e 2070 6174 682e 6c73 7472 6970  t in path.lstrip
+00017410: 286f 732e 7061 7468 2e73 6570 292e 7370  (os.path.sep).sp
+00017420: 6c69 7428 6f73 2e70 6174 682e 7365 7029  lit(os.path.sep)
+00017430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017440: 2020 7375 6250 6174 6820 3d20 6f73 2e70    subPath = os.p
+00017450: 6174 682e 6a6f 696e 2873 7562 5061 7468  ath.join(subPath
+00017460: 2c20 7061 7274 290a 2020 2020 2020 2020  , part).        
+00017470: 2020 2020 2020 2020 6966 2073 7562 5061          if subPa
+00017480: 7468 206e 6f74 2069 6e20 7365 6c66 2e6d  th not in self.m
+00017490: 6f75 6e74 6564 3a0a 2020 2020 2020 2020  ounted:.        
+000174a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000174b0: 2e5f 7472 7954 6f4d 6f75 6e74 4669 6c65  ._tryToMountFile
+000174c0: 2873 7562 5061 7468 290a 0a20 2020 2020  (subPath)..     
+000174d0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000174e0: 7369 6d70 6c79 4669 6e64 4d6f 756e 7465  simplyFindMounte
+000174f0: 6428 7061 7468 290a 0a20 2020 2040 6f76  d(path)..    @ov
+00017500: 6572 7269 6465 7328 4d6f 756e 7453 6f75  errides(MountSou
+00017510: 7263 6529 0a20 2020 2064 6566 2067 6574  rce).    def get
+00017520: 4669 6c65 496e 666f 2873 656c 662c 2070  FileInfo(self, p
+00017530: 6174 683a 2073 7472 2c20 6669 6c65 5665  ath: str, fileVe
+00017540: 7273 696f 6e3a 2069 6e74 203d 2030 2920  rsion: int = 0) 
+00017550: 2d3e 204f 7074 696f 6e61 6c5b 4669 6c65  -> Optional[File
+00017560: 496e 666f 5d3a 0a20 2020 2020 2020 2022  Info]:.        "
+00017570: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00017580: 6e20 6669 6c65 2069 6e66 6f20 666f 7220  n file info for 
+00017590: 6769 7665 6e20 7061 7468 2e20 4e6f 7465  given path. Note
+000175a0: 2074 6861 7420 616c 6c20 7265 7475 726e   that all return
+000175b0: 6564 2066 696c 6520 696e 666f 7320 636f  ed file infos co
+000175c0: 6e74 6169 6e20 4d6f 756e 7449 6e66 6f0a  ntain MountInfo.
+000175d0: 2020 2020 2020 2020 6f72 2061 2066 696c          or a fil
+000175e0: 6520 7061 7468 2073 7472 696e 6720 6174  e path string at
+000175f0: 2074 6865 2062 6163 6b20 6f66 2046 696c   the back of Fil
+00017600: 6549 6e66 6f2e 7573 6572 6461 7461 2e0a  eInfo.userdata..
+00017610: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017620: 2020 2020 2320 544f 444f 3a20 4164 6420      # TODO: Add 
+00017630: 7375 7070 6f72 7420 666f 7220 7468 6520  support for the 
+00017640: 2e76 6572 7369 6f6e 7320 4150 4920 696e  .versions API in
+00017650: 206f 7264 6572 2074 6f20 6163 6365 7373   order to access
+00017660: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
+00017670: 5441 5273 2069 6620 7374 7269 7052 6563  TARs if stripRec
+00017680: 7572 7369 7665 5461 7245 7874 656e 7369  ursiveTarExtensi
+00017690: 6f6e 0a20 2020 2020 2020 2023 2020 2020  on.        #    
+000176a0: 2020 2069 7320 6661 6c73 653f 2054 6865     is false? The
+000176b0: 6e20 6167 6169 6e2c 2053 514c 6974 6549  n again, SQLiteI
+000176c0: 6e64 6578 6564 5461 7220 6973 206e 6f74  ndexedTar is not
+000176d0: 2061 626c 6520 746f 2064 6f20 7468 6973   able to do this
+000176e0: 2065 6974 6865 722c 2073 6f20 6974 206d   either, so it m
+000176f0: 6967 6874 2062 6520 696e 636f 6e73 6973  ight be inconsis
+00017700: 7465 6e74 2e0a 0a20 2020 2020 2020 2023  tent...        #
+00017710: 2049 7420 6d69 6768 7420 6265 2061 7267   It might be arg
+00017720: 7561 626c 7920 7468 6174 2077 6520 636f  uably that we co
+00017730: 756c 6420 7369 6d70 6c79 206c 6574 2074  uld simply let t
+00017740: 6865 206d 6f75 6e74 2073 6f75 7263 6520  he mount source 
+00017750: 6861 6e64 6c65 2072 6574 7572 6e69 6e67  handle returning
+00017760: 2066 696c 6520 696e 666f 7320 666f 7220   file infos for 
+00017770: 7468 6520 726f 6f74 0a20 2020 2020 2020  the root.       
+00017780: 2023 2064 6972 6563 746f 7279 2062 7574   # directory but
+00017790: 206f 6e6c 7920 7765 206b 6e6f 7720 7468   only we know th
+000177a0: 6520 7065 726d 6973 7369 6f6e 7320 6f66  e permissions of
+000177b0: 2074 6865 2070 6172 656e 7420 666f 6c64   the parent fold
+000177c0: 6572 2061 6e64 2063 616e 2061 7070 6c79  er and can apply
+000177d0: 2074 6865 6d20 746f 2074 6865 2072 6f6f   them to the roo
+000177e0: 7420 6469 7265 6374 6f72 792e 0a20 2020  t directory..   
+000177f0: 2020 2020 206d 6f75 6e74 506f 696e 742c       mountPoint,
+00017800: 2070 6174 6849 6e4d 6f75 6e74 506f 696e   pathInMountPoin
+00017810: 7420 3d20 7365 6c66 2e5f 6669 6e64 4d6f  t = self._findMo
+00017820: 756e 7465 6428 7061 7468 290a 2020 2020  unted(path).    
+00017830: 2020 2020 6d6f 756e 7449 6e66 6f20 3d20      mountInfo = 
+00017840: 7365 6c66 2e6d 6f75 6e74 6564 5b6d 6f75  self.mounted[mou
+00017850: 6e74 506f 696e 745d 0a20 2020 2020 2020  ntPoint].       
+00017860: 2069 6620 7061 7468 496e 4d6f 756e 7450   if pathInMountP
+00017870: 6f69 6e74 203d 3d20 272f 273a 0a20 2020  oint == '/':.   
+00017880: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00017890: 6d6f 756e 7449 6e66 6f2e 726f 6f74 4669  mountInfo.rootFi
+000178a0: 6c65 496e 666f 0a0a 2020 2020 2020 2020  leInfo..        
+000178b0: 6669 6c65 496e 666f 203d 206d 6f75 6e74  fileInfo = mount
+000178c0: 496e 666f 2e6d 6f75 6e74 536f 7572 6365  Info.mountSource
+000178d0: 2e67 6574 4669 6c65 496e 666f 2870 6174  .getFileInfo(pat
+000178e0: 6849 6e4d 6f75 6e74 506f 696e 742c 2066  hInMountPoint, f
+000178f0: 696c 6556 6572 7369 6f6e 290a 2020 2020  ileVersion).    
+00017900: 2020 2020 6966 2066 696c 6549 6e66 6f3a      if fileInfo:
+00017910: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00017920: 6549 6e66 6f2e 7573 6572 6461 7461 2e61  eInfo.userdata.a
+00017930: 7070 656e 6428 6d6f 756e 7450 6f69 6e74  ppend(mountPoint
+00017940: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00017950: 7475 726e 2066 696c 6549 6e66 6f0a 0a20  turn fileInfo.. 
+00017960: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00017970: 6e65 0a0a 2020 2020 406f 7665 7272 6964  ne..    @overrid
+00017980: 6573 284d 6f75 6e74 536f 7572 6365 290a  es(MountSource).
+00017990: 2020 2020 6465 6620 6c69 7374 4469 7228      def listDir(
+000179a0: 7365 6c66 2c20 7061 7468 3a20 7374 7229  self, path: str)
+000179b0: 202d 3e20 4f70 7469 6f6e 616c 5b49 7465   -> Optional[Ite
+000179c0: 7261 626c 655b 7374 725d 5d3a 0a20 2020  rable[str]]:.   
+000179d0: 2020 2020 206d 6f75 6e74 506f 696e 742c       mountPoint,
+000179e0: 2070 6174 6849 6e4d 6f75 6e74 506f 696e   pathInMountPoin
+000179f0: 7420 3d20 7365 6c66 2e5f 6669 6e64 4d6f  t = self._findMo
+00017a00: 756e 7465 6428 7061 7468 290a 2020 2020  unted(path).    
+00017a10: 2020 2020 6669 6c65 7320 3d20 7365 6c66      files = self
+00017a20: 2e6d 6f75 6e74 6564 5b6d 6f75 6e74 506f  .mounted[mountPo
+00017a30: 696e 745d 2e6d 6f75 6e74 536f 7572 6365  int].mountSource
+00017a40: 2e6c 6973 7444 6972 2870 6174 6849 6e4d  .listDir(pathInM
+00017a50: 6f75 6e74 506f 696e 7429 0a20 2020 2020  ountPoint).     
+00017a60: 2020 2069 6620 6e6f 7420 6669 6c65 733a     if not files:
+00017a70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00017a80: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+00017a90: 2066 696c 6573 203d 2073 6574 2866 696c   files = set(fil
+00017aa0: 6573 290a 0a20 2020 2020 2020 2023 2043  es)..        # C
+00017ab0: 6865 636b 2077 6865 7468 6572 2077 6520  heck whether we 
+00017ac0: 6e65 6564 2074 6f20 6164 6420 7265 6375  need to add recu
+00017ad0: 7273 6976 6520 6d6f 756e 7420 706f 696e  rsive mount poin
+00017ae0: 7473 2074 6f20 7468 6973 2064 6972 6563  ts to this direc
+00017af0: 746f 7279 206c 6973 7469 6e67 0a20 2020  tory listing.   
+00017b00: 2020 2020 2069 6620 7365 6c66 2e6f 7074       if self.opt
+00017b10: 696f 6e73 2e67 6574 2827 7265 6375 7273  ions.get('recurs
+00017b20: 6976 6527 2c20 4661 6c73 6529 2061 6e64  ive', False) and
+00017b30: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00017b40: 7428 2773 7472 6970 5265 6375 7273 6976  t('stripRecursiv
+00017b50: 6554 6172 4578 7465 6e73 696f 6e27 2c20  eTarExtension', 
+00017b60: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00017b70: 2020 2020 666f 7220 6d6f 756e 7450 6f69      for mountPoi
+00017b80: 6e74 2069 6e20 7365 6c66 2e6d 6f75 6e74  nt in self.mount
+00017b90: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00017ba0: 2020 2020 666f 6c64 6572 2c20 666f 6c64      folder, fold
+00017bb0: 6572 4e61 6d65 203d 206f 732e 7061 7468  erName = os.path
+00017bc0: 2e73 706c 6974 286d 6f75 6e74 506f 696e  .split(mountPoin
+00017bd0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00017be0: 2020 2069 6620 666f 6c64 6572 203d 3d20     if folder == 
+00017bf0: 7061 7468 2061 6e64 2066 6f6c 6465 724e  path and folderN
+00017c00: 616d 6520 616e 6420 666f 6c64 6572 4e61  ame and folderNa
+00017c10: 6d65 206e 6f74 2069 6e20 6669 6c65 733a  me not in files:
+00017c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017c30: 2020 2020 2066 696c 6573 2e61 6464 2866       files.add(f
+00017c40: 6f6c 6465 724e 616d 6529 0a0a 2020 2020  olderName)..    
+00017c50: 2020 2020 7265 7475 726e 2066 696c 6573      return files
+00017c60: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
+00017c70: 284d 6f75 6e74 536f 7572 6365 290a 2020  (MountSource).  
+00017c80: 2020 6465 6620 6669 6c65 5665 7273 696f    def fileVersio
+00017c90: 6e73 2873 656c 662c 2070 6174 683a 2073  ns(self, path: s
+00017ca0: 7472 2920 2d3e 2069 6e74 3a0a 2020 2020  tr) -> int:.    
+00017cb0: 2020 2020 6d6f 756e 7450 6f69 6e74 2c20      mountPoint, 
+00017cc0: 7061 7468 496e 4d6f 756e 7450 6f69 6e74  pathInMountPoint
+00017cd0: 203d 2073 656c 662e 5f66 696e 644d 6f75   = self._findMou
+00017ce0: 6e74 6564 2870 6174 6829 0a20 2020 2020  nted(path).     
+00017cf0: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+00017d00: 6f75 6e74 6564 5b6d 6f75 6e74 506f 696e  ounted[mountPoin
+00017d10: 745d 2e6d 6f75 6e74 536f 7572 6365 2e66  t].mountSource.f
+00017d20: 696c 6556 6572 7369 6f6e 7328 7061 7468  ileVersions(path
+00017d30: 496e 4d6f 756e 7450 6f69 6e74 290a 0a20  InMountPoint).. 
+00017d40: 2020 2040 6f76 6572 7269 6465 7328 4d6f     @overrides(Mo
+00017d50: 756e 7453 6f75 7263 6529 0a20 2020 2064  untSource).    d
+00017d60: 6566 206f 7065 6e28 7365 6c66 2c20 6669  ef open(self, fi
+00017d70: 6c65 496e 666f 3a20 4669 6c65 496e 666f  leInfo: FileInfo
+00017d80: 2920 2d3e 2049 4f5b 6279 7465 735d 3a0a  ) -> IO[bytes]:.
+00017d90: 2020 2020 2020 2020 5f2c 206d 6f75 6e74          _, mount
+00017da0: 536f 7572 6365 2c20 736f 7572 6365 4669  Source, sourceFi
+00017db0: 6c65 496e 666f 203d 2073 656c 662e 6765  leInfo = self.ge
+00017dc0: 744d 6f75 6e74 536f 7572 6365 2866 696c  tMountSource(fil
+00017dd0: 6549 6e66 6f29 0a20 2020 2020 2020 2072  eInfo).        r
+00017de0: 6574 7572 6e20 6d6f 756e 7453 6f75 7263  eturn mountSourc
+00017df0: 652e 6f70 656e 2873 6f75 7263 6546 696c  e.open(sourceFil
+00017e00: 6549 6e66 6f29 0a0a 2020 2020 406f 7665  eInfo)..    @ove
+00017e10: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
+00017e20: 6365 290a 2020 2020 6465 6620 7265 6164  ce).    def read
+00017e30: 2873 656c 662c 2066 696c 6549 6e66 6f3a  (self, fileInfo:
+00017e40: 2046 696c 6549 6e66 6f2c 2073 697a 653a   FileInfo, size:
+00017e50: 2069 6e74 2c20 6f66 6673 6574 3a20 696e   int, offset: in
+00017e60: 7429 202d 3e20 6279 7465 733a 0a20 2020  t) -> bytes:.   
+00017e70: 2020 2020 205f 2c20 6d6f 756e 7453 6f75       _, mountSou
+00017e80: 7263 652c 2073 6f75 7263 6546 696c 6549  rce, sourceFileI
+00017e90: 6e66 6f20 3d20 7365 6c66 2e67 6574 4d6f  nfo = self.getMo
+00017ea0: 756e 7453 6f75 7263 6528 6669 6c65 496e  untSource(fileIn
+00017eb0: 666f 290a 2020 2020 2020 2020 7265 7475  fo).        retu
+00017ec0: 726e 206d 6f75 6e74 536f 7572 6365 2e72  rn mountSource.r
+00017ed0: 6561 6428 736f 7572 6365 4669 6c65 496e  ead(sourceFileIn
+00017ee0: 666f 2c20 7369 7a65 2c20 6f66 6673 6574  fo, size, offset
+00017ef0: 290a 0a20 2020 2040 6f76 6572 7269 6465  )..    @override
+00017f00: 7328 4d6f 756e 7453 6f75 7263 6529 0a20  s(MountSource). 
+00017f10: 2020 2064 6566 2067 6574 4d6f 756e 7453     def getMountS
+00017f20: 6f75 7263 6528 7365 6c66 2c20 6669 6c65  ource(self, file
+00017f30: 496e 666f 3a20 4669 6c65 496e 666f 2920  Info: FileInfo) 
+00017f40: 2d3e 2054 7570 6c65 5b73 7472 2c20 4d6f  -> Tuple[str, Mo
+00017f50: 756e 7453 6f75 7263 652c 2046 696c 6549  untSource, FileI
+00017f60: 6e66 6f5d 3a0a 2020 2020 2020 2020 6d6f  nfo]:.        mo
+00017f70: 756e 7450 6f69 6e74 203d 2066 696c 6549  untPoint = fileI
+00017f80: 6e66 6f2e 7573 6572 6461 7461 5b2d 315d  nfo.userdata[-1]
+00017f90: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00017fa0: 6973 696e 7374 616e 6365 286d 6f75 6e74  isinstance(mount
+00017fb0: 506f 696e 742c 2073 7472 290a 2020 2020  Point, str).    
+00017fc0: 2020 2020 6d6f 756e 7453 6f75 7263 6520      mountSource 
+00017fd0: 3d20 7365 6c66 2e6d 6f75 6e74 6564 5b6d  = self.mounted[m
+00017fe0: 6f75 6e74 506f 696e 745d 2e6d 6f75 6e74  ountPoint].mount
+00017ff0: 536f 7572 6365 0a0a 2020 2020 2020 2020  Source..        
+00018000: 736f 7572 6365 4669 6c65 496e 666f 203d  sourceFileInfo =
+00018010: 2066 696c 6549 6e66 6f2e 636c 6f6e 6528   fileInfo.clone(
+00018020: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
+00018030: 4669 6c65 496e 666f 2e75 7365 7264 6174  FileInfo.userdat
+00018040: 612e 706f 7028 290a 0a20 2020 2020 2020  a.pop()..       
+00018050: 2064 6565 7065 724d 6f75 6e74 506f 696e   deeperMountPoin
+00018060: 742c 2064 6565 7065 724d 6f75 6e74 536f  t, deeperMountSo
+00018070: 7572 6365 2c20 6465 6570 6572 4669 6c65  urce, deeperFile
+00018080: 496e 666f 203d 206d 6f75 6e74 536f 7572  Info = mountSour
+00018090: 6365 2e67 6574 4d6f 756e 7453 6f75 7263  ce.getMountSourc
+000180a0: 6528 736f 7572 6365 4669 6c65 496e 666f  e(sourceFileInfo
+000180b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000180c0: 206f 732e 7061 7468 2e6a 6f69 6e28 6d6f   os.path.join(mo
+000180d0: 756e 7450 6f69 6e74 2c20 6465 6570 6572  untPoint, deeper
+000180e0: 4d6f 756e 7450 6f69 6e74 2e6c 7374 7269  MountPoint.lstri
+000180f0: 7028 272f 2729 292c 2064 6565 7065 724d  p('/')), deeperM
+00018100: 6f75 6e74 536f 7572 6365 2c20 6465 6570  ountSource, deep
+00018110: 6572 4669 6c65 496e 666f 0a0a 0a63 6c61  erFileInfo...cla
+00018120: 7373 205a 6970 4d6f 756e 7453 6f75 7263  ss ZipMountSourc
+00018130: 6528 4d6f 756e 7453 6f75 7263 6529 3a0a  e(MountSource):.
+00018140: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00018150: 2873 656c 662c 2066 696c 654f 7250 6174  (self, fileOrPat
+00018160: 683a 2055 6e69 6f6e 5b73 7472 2c20 494f  h: Union[str, IO
+00018170: 5b62 7974 6573 5d5d 2c20 2a2a 6f70 7469  [bytes]], **opti
+00018180: 6f6e 7329 202d 3e20 4e6f 6e65 3a0a 2020  ons) -> None:.  
+00018190: 2020 2020 2020 7365 6c66 2e66 696c 654f        self.fileO
+000181a0: 626a 6563 7420 3d20 7a69 7066 696c 652e  bject = zipfile.
+000181b0: 5a69 7046 696c 6528 6669 6c65 4f72 5061  ZipFile(fileOrPa
+000181c0: 7468 2c20 2772 2729 0a20 2020 2020 2020  th, 'r').       
+000181d0: 205a 6970 4d6f 756e 7453 6f75 7263 652e   ZipMountSource.
+000181e0: 5f66 696e 6450 6173 7377 6f72 6428 7365  _findPassword(se
+000181f0: 6c66 2e66 696c 654f 626a 6563 742c 206f  lf.fileObject, o
+00018200: 7074 696f 6e73 2e67 6574 2822 7061 7373  ptions.get("pass
+00018210: 776f 7264 7322 2c20 5b5d 2929 0a20 2020  words", [])).   
+00018220: 2020 2020 2073 656c 662e 6669 6c65 7320       self.files 
+00018230: 3d20 7365 6c66 2e66 696c 654f 626a 6563  = self.fileObjec
+00018240: 742e 696e 666f 6c69 7374 2829 0a20 2020  t.infolist().   
+00018250: 2020 2020 2073 656c 662e 6f70 7469 6f6e       self.option
+00018260: 7320 3d20 6f70 7469 6f6e 730a 0a20 2020  s = options..   
+00018270: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00018280: 2020 2064 6566 205f 6669 6e64 5061 7373     def _findPass
+00018290: 776f 7264 2866 696c 656f 626a 3a20 227a  word(fileobj: "z
+000182a0: 6970 6669 6c65 2e5a 6970 4669 6c65 222c  ipfile.ZipFile",
+000182b0: 2070 6173 7377 6f72 6473 293a 0a20 2020   passwords):.   
+000182c0: 2020 2020 2023 2049 6620 6865 6164 6572       # If header
+000182d0: 7320 6172 6520 656e 6372 7970 7465 642c  s are encrypted,
+000182e0: 2074 6865 6e20 696e 666f 6c69 7374 2077   then infolist w
+000182f0: 696c 6c20 7369 6d70 6c79 2072 6574 7572  ill simply retur
+00018300: 6e20 616e 2065 6d70 7479 206c 6973 7421  n an empty list!
+00018310: 0a20 2020 2020 2020 2066 696c 6573 203d  .        files =
+00018320: 2066 696c 656f 626a 2e69 6e66 6f6c 6973   fileobj.infolis
+00018330: 7428 290a 2020 2020 2020 2020 6966 206e  t().        if n
+00018340: 6f74 2066 696c 6573 3a0a 2020 2020 2020  ot files:.      
+00018350: 2020 2020 2020 666f 7220 7061 7373 776f        for passwo
+00018360: 7264 2069 6e20 7061 7373 776f 7264 733a  rd in passwords:
+00018370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018380: 2066 696c 656f 626a 2e73 6574 7061 7373   fileobj.setpass
+00018390: 776f 7264 2870 6173 7377 6f72 6429 0a20  word(password). 
+000183a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000183b0: 696c 6573 203d 2066 696c 656f 626a 2e69  iles = fileobj.i
+000183c0: 6e66 6f6c 6973 7428 290a 2020 2020 2020  nfolist().      
+000183d0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+000183e0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000183f0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+00018400: 6173 7377 6f72 640a 0a20 2020 2020 2020  assword..       
+00018410: 2023 2049 6620 6865 6164 6572 7320 6172   # If headers ar
+00018420: 6520 6e6f 7420 656e 6372 7970 7465 642c  e not encrypted,
+00018430: 2074 6865 6e20 7472 7920 6f75 7420 7061   then try out pa
+00018440: 7373 776f 7264 7320 6279 2074 7279 696e  sswords by tryin
+00018450: 6720 746f 206f 7065 6e20 7468 6520 6669  g to open the fi
+00018460: 7273 7420 6669 6c65 2e0a 2020 2020 2020  rst file..      
+00018470: 2020 6669 6c65 7320 3d20 5b66 696c 6520    files = [file 
+00018480: 666f 7220 6669 6c65 2069 6e20 6669 6c65  for file in file
+00018490: 7320 6966 206e 6f74 2066 696c 652e 6973  s if not file.is
+000184a0: 5f64 6972 2829 2061 6e64 2066 696c 652e  _dir() and file.
+000184b0: 6669 6c65 5f73 697a 6520 3e20 305d 0a20  file_size > 0]. 
+000184c0: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+000184d0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+000184e0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+000184f0: 2020 2020 2020 666f 7220 7061 7373 776f        for passwo
+00018500: 7264 2069 6e20 5b4e 6f6e 655d 202b 2070  rd in [None] + p
+00018510: 6173 7377 6f72 6473 3a0a 2020 2020 2020  asswords:.      
+00018520: 2020 2020 2020 6669 6c65 6f62 6a2e 7365        fileobj.se
+00018530: 7470 6173 7377 6f72 6428 7061 7373 776f  tpassword(passwo
+00018540: 7264 290a 2020 2020 2020 2020 2020 2020  rd).            
+00018550: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00018560: 2020 2020 2077 6974 6820 6669 6c65 6f62       with fileob
+00018570: 6a2e 6f70 656e 2866 696c 6573 5b30 5d29  j.open(files[0])
+00018580: 2061 7320 6669 6c65 3a0a 2020 2020 2020   as file:.      
+00018590: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000185a0: 6c65 2e72 6561 6428 3129 0a20 2020 2020  le.read(1).     
+000185b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000185c0: 6e20 7061 7373 776f 7264 0a20 2020 2020  n password.     
+000185d0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000185e0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+000185f0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+00018600: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
+00018610: 7469 6d65 4572 726f 7228 2243 6f75 6c64  timeError("Could
+00018620: 206e 6f74 2066 696e 6420 6120 6d61 7463   not find a matc
+00018630: 6869 6e67 2070 6173 7377 6f72 6421 2229  hing password!")
+00018640: 0a0a 2020 2020 6465 6620 5f5f 656e 7465  ..    def __ente
+00018650: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+00018660: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
+00018670: 2020 2020 6465 6620 5f5f 6578 6974 5f5f      def __exit__
+00018680: 2873 656c 662c 2065 7863 6570 7469 6f6e  (self, exception
+00018690: 5f74 7970 652c 2065 7863 6570 7469 6f6e  _type, exception
+000186a0: 5f76 616c 7565 2c20 6578 6365 7074 696f  _value, exceptio
+000186b0: 6e5f 7472 6163 6562 6163 6b29 3a0a 2020  n_traceback):.  
+000186c0: 2020 2020 2020 7365 6c66 2e66 696c 654f        self.fileO
+000186d0: 626a 6563 742e 636c 6f73 6528 290a 0a20  bject.close().. 
+000186e0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+000186f0: 0a20 2020 2064 6566 205f 636f 6e76 6572  .    def _conver
+00018700: 7454 6f46 696c 6549 6e66 6f28 696e 666f  tToFileInfo(info
+00018710: 3a20 227a 6970 6669 6c65 2e5a 6970 496e  : "zipfile.ZipIn
+00018720: 666f 222c 207a 6970 4669 6c65 3a20 227a  fo", zipFile: "z
+00018730: 6970 6669 6c65 2e5a 6970 4669 6c65 2229  ipfile.ZipFile")
+00018740: 202d 3e20 4669 6c65 496e 666f 3a0a 2020   -> FileInfo:.  
+00018750: 2020 2020 2020 6d6f 6465 203d 2030 6f35        mode = 0o5
+00018760: 3535 207c 2028 7374 6174 2e53 5f49 4644  55 | (stat.S_IFD
+00018770: 4952 2069 6620 696e 666f 2e69 735f 6469  IR if info.is_di
+00018780: 7228 2920 656c 7365 2073 7461 742e 535f  r() else stat.S_
+00018790: 4946 5245 4729 0a20 2020 2020 2020 206d  IFREG).        m
+000187a0: 7469 6d65 203d 2064 6174 6574 696d 652e  time = datetime.
+000187b0: 6461 7465 7469 6d65 282a 696e 666f 2e64  datetime(*info.d
+000187c0: 6174 655f 7469 6d65 2c20 747a 696e 666f  ate_time, tzinfo
+000187d0: 3d64 6174 6574 696d 652e 7469 6d65 7a6f  =datetime.timezo
+000187e0: 6e65 2e75 7463 292e 7469 6d65 7374 616d  ne.utc).timestam
+000187f0: 7028 2920 6966 2069 6e66 6f2e 6461 7465  p() if info.date
+00018800: 5f74 696d 6520 656c 7365 2030 0a0a 2020  _time else 0..  
+00018810: 2020 2020 2020 2320 4163 636f 7264 696e        # Accordin
+00018820: 6720 746f 2073 6563 7469 6f6e 2034 2e35  g to section 4.5
+00018830: 2e37 2069 6e20 7468 6520 2e5a 4950 2066  .7 in the .ZIP f
+00018840: 696c 6520 666f 726d 6174 2073 7065 6369  ile format speci
+00018850: 6669 6361 7469 6f6e 2c20 6c69 6e6b 7320  fication, links 
+00018860: 6172 6520 7375 7070 6f72 7465 643a 0a20  are supported:. 
+00018870: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
+00018880: 2f70 6b77 6172 652e 6361 6368 6566 6c79  /pkware.cachefly
+00018890: 2e6e 6574 2f77 6562 646f 6373 2f63 6173  .net/webdocs/cas
+000188a0: 6573 7475 6469 6573 2f41 5050 4e4f 5445  estudies/APPNOTE
+000188b0: 2e54 5854 0a20 2020 2020 2020 2023 2054  .TXT.        # T
+000188c0: 6865 2050 7974 686f 6e20 7a69 7066 696c  he Python zipfil
+000188d0: 6520 6d6f 6475 6c65 2068 6173 206e 6f20  e module has no 
+000188e0: 4150 4920 666f 7220 6c69 6e6b 733a 2068  API for links: h
+000188f0: 7474 7073 3a2f 2f62 7567 732e 7079 7468  ttps://bugs.pyth
+00018900: 6f6e 2e6f 7267 2f69 7373 7565 3435 3238  on.org/issue4528
+00018910: 360a 2020 2020 2020 2020 2320 486f 7765  6.        # Howe
+00018920: 7665 722c 2074 6865 2066 696c 6520 6d6f  ver, the file mo
+00018930: 6465 2065 7870 6f73 6573 2077 6865 7468  de exposes wheth
+00018940: 6572 2069 7427 7320 6120 6c69 6e6b 2061  er it's a link a
+00018950: 6e64 2074 6865 2066 696c 6520 6d6f 6465  nd the file mode
+00018960: 2069 7320 7368 6f77 6e20 6279 205a 6970   is shown by Zip
+00018970: 496e 666f 2e5f 5f72 6570 725f 5f2e 0a20  Info.__repr__.. 
+00018980: 2020 2020 2020 2023 2046 6f72 2074 6861         # For tha
+00018990: 742c 2069 7420 7573 6573 2074 6865 204f  t, it uses the O
+000189a0: 532d 6465 7065 6e64 656e 7420 6578 7465  S-dependent exte
+000189b0: 726e 616c 5f61 7474 7220 6d65 6d62 6572  rnal_attr member
+000189c0: 2e20 5365 6520 616c 736f 2074 6865 205a  . See also the Z
+000189d0: 4950 2073 7065 6369 6669 6361 7469 6f6e  IP specification
+000189e0: 206f 6e20 7468 6174 3a0a 2020 2020 2020   on that:.      
+000189f0: 2020 2320 3e20 342e 342e 3135 2065 7874    # > 4.4.15 ext
+00018a00: 6572 6e61 6c20 6669 6c65 2061 7474 7269  ernal file attri
+00018a10: 6275 7465 733a 2028 3420 6279 7465 7329  butes: (4 bytes)
+00018a20: 0a20 2020 2020 2020 2023 203e 2020 2054  .        # >   T
+00018a30: 6865 206d 6170 7069 6e67 206f 6620 7468  he mapping of th
+00018a40: 6520 6578 7465 726e 616c 2061 7474 7269  e external attri
+00018a50: 6275 7465 7320 6973 2068 6f73 742d 7379  butes is host-sy
+00018a60: 7374 656d 2064 6570 656e 6465 6e74 2028  stem dependent (
+00018a70: 7365 6520 2776 6572 7369 6f6e 206d 6164  see 'version mad
+00018a80: 6520 6279 2729 2e0a 2020 2020 2020 2020  e by')..        
+00018a90: 2320 3e20 2020 466f 7220 4d53 2d44 4f53  # >   For MS-DOS
+00018aa0: 2c20 7468 6520 6c6f 7720 6f72 6465 7220  , the low order 
+00018ab0: 6279 7465 2069 7320 7468 6520 4d53 2d44  byte is the MS-D
+00018ac0: 4f53 2064 6972 6563 746f 7279 2061 7474  OS directory att
+00018ad0: 7269 6275 7465 2062 7974 652e 0a20 2020  ribute byte..   
+00018ae0: 2020 2020 2023 203e 2020 2049 6620 696e       # >   If in
+00018af0: 7075 7420 6361 6d65 2066 726f 6d20 7374  put came from st
+00018b00: 616e 6461 7264 2069 6e70 7574 2c20 7468  andard input, th
+00018b10: 6973 2066 6965 6c64 2069 7320 7365 7420  is field is set 
+00018b20: 746f 207a 6572 6f2e 0a0a 2020 2020 2020  to zero...      
+00018b30: 2020 2320 6669 6c65 5f72 6564 6972 2069    # file_redir i
+00018b40: 7320 2874 7970 652c 2066 6c61 6773 2c20  s (type, flags, 
+00018b50: 7461 7267 6574 2920 6f72 204e 6f6e 652e  target) or None.
+00018b60: 204f 6e6c 7920 7465 7374 6564 2066 6f72   Only tested for
+00018b70: 2074 7970 6520 3d3d 2052 4152 355f 5852   type == RAR5_XR
+00018b80: 4544 4952 5f55 4e49 585f 5359 4d4c 494e  EDIR_UNIX_SYMLIN
+00018b90: 4b2e 0a20 2020 2020 2020 206c 696e 6b6e  K..        linkn
+00018ba0: 616d 6520 3d20 2222 0a20 2020 2020 2020  ame = "".       
+00018bb0: 2069 6620 7374 6174 2e53 5f49 534c 4e4b   if stat.S_ISLNK
+00018bc0: 2869 6e66 6f2e 6578 7465 726e 616c 5f61  (info.external_a
+00018bd0: 7474 7220 3e3e 2031 3629 3a0a 2020 2020  ttr >> 16):.    
+00018be0: 2020 2020 2020 2020 6c69 6e6b 6e61 6d65          linkname
+00018bf0: 203d 207a 6970 4669 6c65 2e72 6561 6428   = zipFile.read(
+00018c00: 696e 666f 292e 6465 636f 6465 2829 0a20  info).decode(). 
+00018c10: 2020 2020 2020 2020 2020 206d 6f64 6520             mode 
+00018c20: 3d20 306f 3535 3520 7c20 7374 6174 2e53  = 0o555 | stat.S
+00018c30: 5f49 464c 4e4b 0a0a 2020 2020 2020 2020  _IFLNK..        
+00018c40: 6669 6c65 496e 666f 203d 2046 696c 6549  fileInfo = FileI
+00018c50: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
+00018c60: 2023 2066 6d74 3a20 6f66 660a 2020 2020   # fmt: off.    
+00018c70: 2020 2020 2020 2020 7369 7a65 2020 2020          size    
+00018c80: 203d 2069 6e66 6f2e 6669 6c65 5f73 697a   = info.file_siz
+00018c90: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00018ca0: 7469 6d65 2020 2020 3d20 6d74 696d 652c  time    = mtime,
+00018cb0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+00018cc0: 6520 2020 2020 3d20 6d6f 6465 2c0a 2020  e     = mode,.  
+00018cd0: 2020 2020 2020 2020 2020 6c69 6e6b 6e61            linkna
+00018ce0: 6d65 203d 206c 696e 6b6e 616d 652c 0a20  me = linkname,. 
+00018cf0: 2020 2020 2020 2020 2020 2075 6964 2020             uid  
+00018d00: 2020 2020 3d20 6f73 2e67 6574 7569 6428      = os.getuid(
+00018d10: 292c 0a20 2020 2020 2020 2020 2020 2067  ),.            g
+00018d20: 6964 2020 2020 2020 3d20 6f73 2e67 6574  id      = os.get
+00018d30: 6769 6428 292c 0a20 2020 2020 2020 2020  gid(),.         
+00018d40: 2020 2075 7365 7264 6174 6120 3d20 5b69     userdata = [i
+00018d50: 6e66 6f5d 2c0a 2020 2020 2020 2020 2020  nfo],.          
+00018d60: 2020 2320 666d 743a 206f 6e0a 2020 2020    # fmt: on.    
+00018d70: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
+00018d80: 6574 7572 6e20 6669 6c65 496e 666f 0a0a  eturn fileInfo..
+00018d90: 2020 2020 406f 7665 7272 6964 6573 284d      @overrides(M
+00018da0: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
+00018db0: 6465 6620 6c69 7374 4469 7228 7365 6c66  def listDir(self
+00018dc0: 2c20 7061 7468 3a20 7374 7229 202d 3e20  , path: str) -> 
+00018dd0: 4f70 7469 6f6e 616c 5b49 7465 7261 626c  Optional[Iterabl
+00018de0: 655b 7374 725d 5d3a 0a20 2020 2020 2020  e[str]]:.       
+00018df0: 2070 6174 6820 3d20 7061 7468 2e73 7472   path = path.str
+00018e00: 6970 2827 2f27 290a 2020 2020 2020 2020  ip('/').        
+00018e10: 6966 2070 6174 683a 0a20 2020 2020 2020  if path:.       
+00018e20: 2020 2020 2070 6174 6820 2b3d 2027 2f27       path += '/'
+00018e30: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+00018e40: 2048 6f77 2074 6f20 6265 6861 7665 2077   How to behave w
+00018e50: 6974 6820 6669 6c65 7320 696e 207a 6970  ith files in zip
+00018e60: 2077 6974 6820 6162 736f 6c75 7465 2070   with absolute p
+00018e70: 6174 6873 3f20 4375 7272 656e 746c 792c  aths? Currently,
+00018e80: 2074 6865 7920 776f 756c 6420 6e65 7665   they would neve
+00018e90: 7220 6265 2073 686f 776e 2e0a 2020 2020  r be shown..    
+00018ea0: 2020 2020 6465 6620 6765 744e 616d 6528      def getName(
+00018eb0: 6669 6c65 5061 7468 293a 0a20 2020 2020  filePath):.     
+00018ec0: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+00018ed0: 6c65 5061 7468 2e73 7461 7274 7377 6974  lePath.startswit
+00018ee0: 6828 7061 7468 293a 0a20 2020 2020 2020  h(path):.       
+00018ef0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018f00: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
+00018f10: 2020 6669 6c65 5061 7468 203d 2066 696c    filePath = fil
+00018f20: 6550 6174 685b 6c65 6e28 7061 7468 2920  ePath[len(path) 
+00018f30: 3a5d 2e73 7472 6970 2827 2f27 290a 2020  :].strip('/').  
+00018f40: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00018f50: 2066 696c 6550 6174 683a 0a20 2020 2020   filePath:.     
+00018f60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00018f70: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
+00018f80: 2020 2020 2320 5468 6973 2065 6666 6563      # This effec
+00018f90: 7469 7665 6c79 2061 6464 7320 616c 6c20  tively adds all 
+00018fa0: 7061 7265 6e74 2070 6174 6873 2061 7320  parent paths as 
+00018fb0: 666f 6c64 6572 732e 2049 7420 6973 2065  folders. It is e
+00018fc0: 6173 7920 746f 2063 7265 6174 650a 2020  asy to create.  
+00018fd0: 2020 2020 2020 2020 2020 2320 5241 5273            # RARs
+00018fe0: 2061 6e64 205a 4950 7320 7769 7468 206e   and ZIPs with n
+00018ff0: 6573 7465 6420 6669 6c65 7320 7769 7468  ested files with
+00019000: 6f75 7420 696e 666f 726d 6174 696f 6e20  out information 
+00019010: 6f6e 2074 6865 2070 6172 656e 7420 6469  on the parent di
+00019020: 7265 6374 6f72 6965 7321 0a20 2020 2020  rectories!.     
+00019030: 2020 2020 2020 2069 6620 272f 2720 696e         if '/' in
+00019040: 2066 696c 6550 6174 683a 0a20 2020 2020   filePath:.     
+00019050: 2020 2020 2020 2020 2020 2066 6972 7374             first
+00019060: 536c 6173 6820 3d20 6669 6c65 5061 7468  Slash = filePath
+00019070: 2e69 6e64 6578 2827 2f27 290a 2020 2020  .index('/').    
+00019080: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00019090: 5061 7468 203d 2066 696c 6550 6174 685b  Path = filePath[
+000190a0: 3a66 6972 7374 536c 6173 685d 0a0a 2020  :firstSlash]..  
+000190b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000190c0: 2066 696c 6550 6174 680a 0a20 2020 2020   filePath..     
+000190d0: 2020 2023 205a 6970 496e 666f 2e66 696c     # ZipInfo.fil
+000190e0: 656e 616d 6520 6973 2077 726f 6e67 6c79  ename is wrongly
+000190f0: 206e 616d 6564 2061 7320 6974 2072 6574   named as it ret
+00019100: 7572 6e73 2074 6865 2066 756c 6c20 7061  urns the full pa
+00019110: 7468 2069 6e73 6964 6520 7468 6520 6172  th inside the ar
+00019120: 6368 6976 6520 6e6f 7420 6a75 7374 2074  chive not just t
+00019130: 6865 206e 616d 6520 7061 7274 0a20 2020  he name part.   
+00019140: 2020 2020 2072 6574 7572 6e20 7365 7428       return set(
+00019150: 6765 744e 616d 6528 696e 666f 2e66 696c  getName(info.fil
+00019160: 656e 616d 6529 2066 6f72 2069 6e66 6f20  ename) for info 
+00019170: 696e 2073 656c 662e 6669 6c65 7320 6966  in self.files if
+00019180: 2067 6574 4e61 6d65 2869 6e66 6f2e 6669   getName(info.fi
+00019190: 6c65 6e61 6d65 2929 0a0a 2020 2020 6465  lename))..    de
+000191a0: 6620 5f67 6574 4669 6c65 496e 666f 7328  f _getFileInfos(
+000191b0: 7365 6c66 2c20 7061 7468 3a20 7374 7229  self, path: str)
+000191c0: 202d 3e20 4c69 7374 5b46 696c 6549 6e66   -> List[FileInf
+000191d0: 6f5d 3a0a 2020 2020 2020 2020 696e 666f  o]:.        info
+000191e0: 4c69 7374 203d 205b 0a20 2020 2020 2020  List = [.       
+000191f0: 2020 2020 205a 6970 4d6f 756e 7453 6f75       ZipMountSou
+00019200: 7263 652e 5f63 6f6e 7665 7274 546f 4669  rce._convertToFi
+00019210: 6c65 496e 666f 2869 6e66 6f2c 2073 656c  leInfo(info, sel
+00019220: 662e 6669 6c65 4f62 6a65 6374 290a 2020  f.fileObject).  
+00019230: 2020 2020 2020 2020 2020 666f 7220 696e            for in
+00019240: 666f 2069 6e20 7365 6c66 2e66 696c 6573  fo in self.files
+00019250: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00019260: 696e 666f 2e66 696c 656e 616d 652e 7273  info.filename.rs
+00019270: 7472 6970 2827 2f27 2920 3d3d 2070 6174  trip('/') == pat
+00019280: 682e 6c73 7472 6970 2827 2f27 290a 2020  h.lstrip('/').  
+00019290: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+000192a0: 2023 2049 6620 7765 2068 6176 6520 6120   # If we have a 
+000192b0: 6669 6c65 496e 666f 2066 6f72 2074 6865  fileInfo for the
+000192c0: 2067 6976 656e 2064 6972 6563 746f 7279   given directory
+000192d0: 2070 6174 682c 2074 6865 6e20 6576 6572   path, then ever
+000192e0: 7974 6869 6e67 2069 7320 6669 6e65 2e0a  ything is fine..
+000192f0: 2020 2020 2020 2020 7061 7468 4173 4469          pathAsDi
+00019300: 7220 3d20 7061 7468 2e73 7472 6970 2827  r = path.strip('
+00019310: 2f27 2920 2b20 272f 270a 0a20 2020 2020  /') + '/'..     
+00019320: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
+00019330: 6572 2073 6f6d 6520 7061 7265 6e74 2064  er some parent d
+00019340: 6972 6563 746f 7269 6573 206f 6620 6669  irectories of fi
+00019350: 6c65 7320 646f 206e 6f74 2065 7869 7374  les do not exist
+00019360: 2061 7320 7365 7061 7261 7465 2065 6e74   as separate ent
+00019370: 6974 6965 7320 696e 2074 6865 2061 7263  ities in the arc
+00019380: 6869 7665 2e0a 2020 2020 2020 2020 6966  hive..        if
+00019390: 206e 6f74 2061 6e79 285b 696e 666f 2e75   not any([info.u
+000193a0: 7365 7264 6174 615b 2d31 5d2e 6669 6c65  serdata[-1].file
+000193b0: 6e61 6d65 203d 3d20 7061 7468 4173 4469  name == pathAsDi
+000193c0: 7220 666f 7220 696e 666f 2069 6e20 696e  r for info in in
+000193d0: 666f 4c69 7374 5d29 2061 6e64 2061 6e79  foList]) and any
+000193e0: 280a 2020 2020 2020 2020 2020 2020 696e  (.            in
+000193f0: 666f 2e66 696c 656e 616d 652e 7273 7472  fo.filename.rstr
+00019400: 6970 2827 2f27 292e 7374 6172 7473 7769  ip('/').startswi
+00019410: 7468 2870 6174 6841 7344 6972 2920 666f  th(pathAsDir) fo
+00019420: 7220 696e 666f 2069 6e20 7365 6c66 2e66  r info in self.f
+00019430: 696c 6573 0a20 2020 2020 2020 2029 3a0a  iles.        ):.
+00019440: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00019450: 4c69 7374 2e61 7070 656e 6428 0a20 2020  List.append(.   
+00019460: 2020 2020 2020 2020 2020 2020 2046 696c               Fil
+00019470: 6549 6e66 6f28 0a20 2020 2020 2020 2020  eInfo(.         
+00019480: 2020 2020 2020 2020 2020 2023 2066 6d74             # fmt
+00019490: 3a20 6f66 660a 2020 2020 2020 2020 2020  : off.          
+000194a0: 2020 2020 2020 2020 2020 7369 7a65 2020            size  
+000194b0: 2020 203d 2030 2c0a 2020 2020 2020 2020     = 0,.        
+000194c0: 2020 2020 2020 2020 2020 2020 6d74 696d              mtim
+000194d0: 6520 2020 203d 2069 6e74 2874 696d 652e  e    = int(time.
+000194e0: 7469 6d65 2829 292c 0a20 2020 2020 2020  time()),.       
+000194f0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+00019500: 6520 2020 2020 3d20 306f 3737 3720 7c20  e     = 0o777 | 
+00019510: 7374 6174 2e53 5f49 4644 4952 2c0a 2020  stat.S_IFDIR,.  
+00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019530: 2020 6c69 6e6b 6e61 6d65 203d 2022 222c    linkname = "",
+00019540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019550: 2020 2020 2075 6964 2020 2020 2020 3d20       uid      = 
+00019560: 6f73 2e67 6574 7569 6428 292c 0a20 2020  os.getuid(),.   
+00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019580: 2067 6964 2020 2020 2020 3d20 6f73 2e67   gid      = os.g
+00019590: 6574 6769 6428 292c 0a20 2020 2020 2020  etgid(),.       
+000195a0: 2020 2020 2020 2020 2020 2020 2075 7365               use
+000195b0: 7264 6174 6120 3d20 5b4e 6f6e 655d 2c0a  rdata = [None],.
+000195c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195d0: 2020 2020 2320 666d 743a 206f 6e0a 2020      # fmt: on.  
+000195e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000195f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00019600: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+00019610: 666f 4c69 7374 0a0a 2020 2020 406f 7665  foList..    @ove
+00019620: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
+00019630: 6365 290a 2020 2020 6465 6620 6765 7446  ce).    def getF
+00019640: 696c 6549 6e66 6f28 7365 6c66 2c20 7061  ileInfo(self, pa
+00019650: 7468 3a20 7374 722c 2066 696c 6556 6572  th: str, fileVer
+00019660: 7369 6f6e 3a20 696e 7420 3d20 3029 202d  sion: int = 0) -
+00019670: 3e20 4f70 7469 6f6e 616c 5b46 696c 6549  > Optional[FileI
+00019680: 6e66 6f5d 3a0a 2020 2020 2020 2020 696e  nfo]:.        in
+00019690: 666f 7320 3d20 7365 6c66 2e5f 6765 7446  fos = self._getF
+000196a0: 696c 6549 6e66 6f73 2870 6174 6829 0a20  ileInfos(path). 
+000196b0: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+000196c0: 666f 735b 6669 6c65 5665 7273 696f 6e5d  fos[fileVersion]
+000196d0: 2069 6620 2d6c 656e 2869 6e66 6f73 2920   if -len(infos) 
+000196e0: 3c3d 2066 696c 6556 6572 7369 6f6e 203c  <= fileVersion <
+000196f0: 206c 656e 2869 6e66 6f73 2920 656c 7365   len(infos) else
+00019700: 204e 6f6e 650a 0a20 2020 2040 6f76 6572   None..    @over
+00019710: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
+00019720: 6529 0a20 2020 2064 6566 2066 696c 6556  e).    def fileV
+00019730: 6572 7369 6f6e 7328 7365 6c66 2c20 7061  ersions(self, pa
+00019740: 7468 3a20 7374 7229 202d 3e20 696e 743a  th: str) -> int:
+00019750: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019760: 6c65 6e28 7365 6c66 2e5f 6765 7446 696c  len(self._getFil
+00019770: 6549 6e66 6f73 2870 6174 6829 290a 0a20  eInfos(path)).. 
+00019780: 2020 2040 6f76 6572 7269 6465 7328 4d6f     @overrides(Mo
+00019790: 756e 7453 6f75 7263 6529 0a20 2020 2064  untSource).    d
+000197a0: 6566 206f 7065 6e28 7365 6c66 2c20 6669  ef open(self, fi
+000197b0: 6c65 496e 666f 3a20 4669 6c65 496e 666f  leInfo: FileInfo
+000197c0: 2920 2d3e 2049 4f5b 6279 7465 735d 3a0a  ) -> IO[bytes]:.
+000197d0: 2020 2020 2020 2020 696e 666f 203d 2066          info = f
+000197e0: 696c 6549 6e66 6f2e 7573 6572 6461 7461  ileInfo.userdata
+000197f0: 5b2d 315d 0a20 2020 2020 2020 2061 7373  [-1].        ass
+00019800: 6572 7420 6973 696e 7374 616e 6365 2869  ert isinstance(i
+00019810: 6e66 6f2c 207a 6970 6669 6c65 2e5a 6970  nfo, zipfile.Zip
+00019820: 496e 666f 290a 2020 2020 2020 2020 7265  Info).        re
+00019830: 7475 726e 2073 656c 662e 6669 6c65 4f62  turn self.fileOb
+00019840: 6a65 6374 2e6f 7065 6e28 696e 666f 2c20  ject.open(info, 
+00019850: 2772 2729 2020 2320 6874 7470 733a 2f2f  'r')  # https://
+00019860: 6769 7468 7562 2e63 6f6d 2f70 6175 6c64  github.com/pauld
+00019870: 6d63 6361 7274 6879 2f69 6e64 6578 6564  mccarthy/indexed
+00019880: 5f67 7a69 702f 6973 7375 6573 2f38 350a  _gzip/issues/85.
+00019890: 0a20 2020 2040 6f76 6572 7269 6465 7328  .    @overrides(
+000198a0: 4d6f 756e 7453 6f75 7263 6529 0a20 2020  MountSource).   
+000198b0: 2064 6566 2072 6561 6428 7365 6c66 2c20   def read(self, 
+000198c0: 6669 6c65 496e 666f 3a20 4669 6c65 496e  fileInfo: FileIn
+000198d0: 666f 2c20 7369 7a65 3a20 696e 742c 206f  fo, size: int, o
+000198e0: 6666 7365 743a 2069 6e74 2920 2d3e 2062  ffset: int) -> b
+000198f0: 7974 6573 3a0a 2020 2020 2020 2020 7769  ytes:.        wi
+00019900: 7468 2073 656c 662e 6f70 656e 2866 696c  th self.open(fil
+00019910: 6549 6e66 6f29 2061 7320 6669 6c65 3a0a  eInfo) as file:.
+00019920: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00019930: 2e73 6565 6b28 6f66 6673 6574 2c20 6f73  .seek(offset, os
+00019940: 2e53 4545 4b5f 5345 5429 0a20 2020 2020  .SEEK_SET).     
+00019950: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+00019960: 6c65 2e72 6561 6428 7369 7a65 290a 0a0a  le.read(size)...
+00019970: 636c 6173 7320 5261 7746 696c 6549 6e73  class RawFileIns
+00019980: 6964 6552 6172 2869 6f2e 5261 7749 4f42  ideRar(io.RawIOB
+00019990: 6173 6529 3a0a 2020 2020 2222 220a 2020  ase):.    """.  
+000199a0: 2020 5468 6973 2063 6c61 7373 2077 6f72    This class wor
+000199b0: 6b73 2061 726f 756e 6420 7468 6520 4352  ks around the CR
+000199c0: 4320 6572 726f 7220 6973 7375 6520 6279  C error issue by
+000199d0: 2072 656f 7065 6e69 6e67 2074 6865 2066   reopening the f
+000199e0: 696c 6520 7768 656e 2073 6565 6b69 6e67  ile when seeking
+000199f0: 2062 6163 6b2e 0a20 2020 2054 6869 7320   back..    This 
+00019a00: 7769 6c6c 2062 6520 736c 6f77 6572 2066  will be slower f
+00019a10: 6f72 2075 6e63 6f6d 7072 6573 7365 6420  or uncompressed 
+00019a20: 6669 6c65 7320 6275 7420 6e6f 7420 666f  files but not fo
+00019a30: 7220 636f 6d70 7265 7373 6564 2066 696c  r compressed fil
+00019a40: 6573 2062 6563 6175 7365 0a20 2020 2074  es because.    t
+00019a50: 6865 2073 6565 6b20 696d 706c 656d 656e  he seek implemen
+00019a60: 7461 7469 6f6e 206f 6620 7261 7266 696c  tation of rarfil
+00019a70: 6520 616c 736f 2072 656f 7065 6e73 2074  e also reopens t
+00019a80: 6865 2066 696c 6520 6f6e 2073 6565 6b69  he file on seeki
+00019a90: 6e67 2062 6163 6b2e 0a20 2020 2068 7474  ng back..    htt
+00019aa0: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00019ab0: 6d61 726b 6f6b 722f 7261 7266 696c 652f  markokr/rarfile/
+00019ac0: 6973 7375 6573 2f37 330a 2020 2020 6874  issues/73.    ht
+00019ad0: 7470 733a 2f2f 7261 7266 696c 652e 7265  tps://rarfile.re
+00019ae0: 6164 7468 6564 6f63 732e 696f 2f61 7069  adthedocs.io/api
+00019af0: 2e68 746d 6c23 7261 7266 696c 652e 5261  .html#rarfile.Ra
+00019b00: 7245 7874 4669 6c65 2e73 6565 6b0a 2020  rExtFile.seek.  
+00019b10: 2020 3e20 4f6e 2075 6e63 6f6d 7072 6573    > On uncompres
+00019b20: 7365 6420 6669 6c65 732c 2074 6865 2073  sed files, the s
+00019b30: 6565 6b69 6e67 2077 6f72 6b73 2062 7920  eeking works by 
+00019b40: 6163 7475 616c 2073 6565 6b73 2073 6f20  actual seeks so 
+00019b50: 6974 e280 9973 2066 6173 742e 0a20 2020  it...s fast..   
+00019b60: 203e 204f 6e20 636f 6d70 7265 7373 6564   > On compressed
+00019b70: 2066 696c 6573 2069 7427 7320 736c 6f77   files it's slow
+00019b80: 202d 2066 6f72 7761 7264 2073 6565 6b69   - forward seeki
+00019b90: 6e67 2068 6170 7065 6e73 2062 7920 7265  ng happens by re
+00019ba0: 6164 696e 6720 6168 6561 642c 0a20 2020  ading ahead,.   
+00019bb0: 203e 2062 6163 6b77 6172 6473 2062 7920   > backwards by 
+00019bc0: 7265 2d6f 7065 6e69 6e67 2061 6e64 2064  re-opening and d
+00019bd0: 6563 6f6d 7072 6573 7369 6e67 2066 726f  ecompressing fro
+00019be0: 6d20 7468 6520 7374 6172 742e 0a20 2020  m the start..   
+00019bf0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00019c00: 696e 6974 5f5f 2873 656c 662c 2072 656f  init__(self, reo
+00019c10: 7065 6e2c 2066 696c 655f 7369 7a65 293a  pen, file_size):
+00019c20: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00019c30: 6f70 656e 203d 2072 656f 7065 6e0a 2020  open = reopen.  
+00019c40: 2020 2020 2020 7365 6c66 2e66 696c 656f        self.fileo
+00019c50: 626a 203d 2072 656f 7065 6e28 290a 2020  bj = reopen().  
+00019c60: 2020 2020 2020 7365 6c66 2e66 696c 655f        self.file_
+00019c70: 7369 7a65 203d 2066 696c 655f 7369 7a65  size = file_size
+00019c80: 0a0a 2020 2020 6465 6620 5f5f 656e 7465  ..    def __ente
+00019c90: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+00019ca0: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
+00019cb0: 2020 2020 6465 6620 5f5f 6578 6974 5f5f      def __exit__
+00019cc0: 2873 656c 662c 2065 7863 6570 7469 6f6e  (self, exception
+00019cd0: 5f74 7970 652c 2065 7863 6570 7469 6f6e  _type, exception
+00019ce0: 5f76 616c 7565 2c20 6578 6365 7074 696f  _value, exceptio
+00019cf0: 6e5f 7472 6163 6562 6163 6b29 3a0a 2020  n_traceback):.  
+00019d00: 2020 2020 2020 7365 6c66 2e63 6c6f 7365        self.close
+00019d10: 2829 0a0a 2020 2020 406f 7665 7272 6964  ()..    @overrid
+00019d20: 6573 2869 6f2e 5261 7749 4f42 6173 6529  es(io.RawIOBase)
+00019d30: 0a20 2020 2064 6566 2063 6c6f 7365 2873  .    def close(s
+00019d40: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00019d50: 2020 2020 2020 7365 6c66 2e66 696c 656f        self.fileo
+00019d60: 626a 2e63 6c6f 7365 2829 0a0a 2020 2020  bj.close()..    
+00019d70: 406f 7665 7272 6964 6573 2869 6f2e 5261  @overrides(io.Ra
+00019d80: 7749 4f42 6173 6529 0a20 2020 2064 6566  wIOBase).    def
+00019d90: 2066 696c 656e 6f28 7365 6c66 2920 2d3e   fileno(self) ->
+00019da0: 2069 6e74 3a0a 2020 2020 2020 2020 2320   int:.        # 
+00019db0: 5468 6973 2069 7320 6120 7669 7274 7561  This is a virtua
+00019dc0: 6c20 5079 7468 6f6e 206c 6576 656c 2066  l Python level f
+00019dd0: 696c 6520 6f62 6a65 6374 2061 6e64 2074  ile object and t
+00019de0: 6865 7265 666f 7265 2064 6f65 7320 6e6f  herefore does no
+00019df0: 7420 6861 7665 2061 2076 616c 6964 204f  t have a valid O
+00019e00: 5320 6669 6c65 2064 6573 6372 6970 746f  S file descripto
+00019e10: 7221 0a20 2020 2020 2020 2072 6169 7365  r!.        raise
+00019e20: 2069 6f2e 556e 7375 7070 6f72 7465 644f   io.UnsupportedO
+00019e30: 7065 7261 7469 6f6e 2829 0a0a 2020 2020  peration()..    
+00019e40: 406f 7665 7272 6964 6573 2869 6f2e 5261  @overrides(io.Ra
+00019e50: 7749 4f42 6173 6529 0a20 2020 2064 6566  wIOBase).    def
+00019e60: 2073 6565 6b61 626c 6528 7365 6c66 2920   seekable(self) 
+00019e70: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+00019e80: 2072 6574 7572 6e20 7365 6c66 2e66 696c   return self.fil
+00019e90: 656f 626a 2e73 6565 6b61 626c 6528 290a  eobj.seekable().
+00019ea0: 0a20 2020 2040 6f76 6572 7269 6465 7328  .    @overrides(
+00019eb0: 696f 2e52 6177 494f 4261 7365 290a 2020  io.RawIOBase).  
+00019ec0: 2020 6465 6620 7265 6164 6162 6c65 2873    def readable(s
+00019ed0: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
+00019ee0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00019ef0: 662e 6669 6c65 6f62 6a2e 7265 6164 6162  f.fileobj.readab
+00019f00: 6c65 2829 0a0a 2020 2020 406f 7665 7272  le()..    @overr
+00019f10: 6964 6573 2869 6f2e 5261 7749 4f42 6173  ides(io.RawIOBas
+00019f20: 6529 0a20 2020 2064 6566 2077 7269 7461  e).    def writa
+00019f30: 626c 6528 7365 6c66 2920 2d3e 2062 6f6f  ble(self) -> boo
+00019f40: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
+00019f50: 6e20 4661 6c73 650a 0a20 2020 2040 6f76  n False..    @ov
+00019f60: 6572 7269 6465 7328 696f 2e52 6177 494f  errides(io.RawIO
+00019f70: 4261 7365 290a 2020 2020 6465 6620 7265  Base).    def re
+00019f80: 6164 2873 656c 662c 2073 697a 653a 2069  ad(self, size: i
+00019f90: 6e74 203d 202d 3129 202d 3e20 6279 7465  nt = -1) -> byte
+00019fa0: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
+00019fb0: 6e20 7365 6c66 2e66 696c 656f 626a 2e72  n self.fileobj.r
+00019fc0: 6561 6428 7369 7a65 290a 0a20 2020 2040  ead(size)..    @
+00019fd0: 6f76 6572 7269 6465 7328 696f 2e52 6177  overrides(io.Raw
+00019fe0: 494f 4261 7365 290a 2020 2020 6465 6620  IOBase).    def 
+00019ff0: 7365 656b 2873 656c 662c 206f 6666 7365  seek(self, offse
+0001a000: 743a 2069 6e74 2c20 7768 656e 6365 3a20  t: int, whence: 
+0001a010: 696e 7420 3d20 696f 2e53 4545 4b5f 5345  int = io.SEEK_SE
+0001a020: 5429 202d 3e20 696e 743a 0a20 2020 2020  T) -> int:.     
+0001a030: 2020 2069 6620 7768 656e 6365 203d 3d20     if whence == 
+0001a040: 696f 2e53 4545 4b5f 4355 523a 0a20 2020  io.SEEK_CUR:.   
+0001a050: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
+0001a060: 2b3d 2073 656c 662e 7465 6c6c 2829 0a20  += self.tell(). 
+0001a070: 2020 2020 2020 2065 6c69 6620 7768 656e         elif when
+0001a080: 6365 203d 3d20 696f 2e53 4545 4b5f 454e  ce == io.SEEK_EN
+0001a090: 443a 0a20 2020 2020 2020 2020 2020 206f  D:.            o
+0001a0a0: 6666 7365 7420 2b3d 2073 656c 662e 6669  ffset += self.fi
+0001a0b0: 6c65 5f73 697a 650a 0a20 2020 2020 2020  le_size..       
+0001a0c0: 2069 6620 6f66 6673 6574 203e 3d20 7365   if offset >= se
+0001a0d0: 6c66 2e74 656c 6c28 293a 0a20 2020 2020  lf.tell():.     
+0001a0e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001a0f0: 6c66 2e66 696c 656f 626a 2e73 6565 6b28  lf.fileobj.seek(
+0001a100: 6f66 6673 6574 2c20 7768 656e 6365 290a  offset, whence).
+0001a110: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+0001a120: 6c65 6f62 6a20 3d20 7365 6c66 2e72 656f  leobj = self.reo
+0001a130: 7065 6e28 290a 2020 2020 2020 2020 7265  pen().        re
+0001a140: 7475 726e 2073 656c 662e 6669 6c65 6f62  turn self.fileob
+0001a150: 6a2e 7365 656b 286f 6666 7365 742c 2069  j.seek(offset, i
+0001a160: 6f2e 5345 454b 5f53 4554 290a 0a20 2020  o.SEEK_SET)..   
+0001a170: 2040 6f76 6572 7269 6465 7328 696f 2e52   @overrides(io.R
+0001a180: 6177 494f 4261 7365 290a 2020 2020 6465  awIOBase).    de
+0001a190: 6620 7465 6c6c 2873 656c 6629 202d 3e20  f tell(self) -> 
+0001a1a0: 696e 743a 0a20 2020 2020 2020 2072 6574  int:.        ret
+0001a1b0: 7572 6e20 7365 6c66 2e66 696c 656f 626a  urn self.fileobj
+0001a1c0: 2e74 656c 6c28 290a 0a0a 636c 6173 7320  .tell()...class 
+0001a1d0: 5261 724d 6f75 6e74 536f 7572 6365 284d  RarMountSource(M
+0001a1e0: 6f75 6e74 536f 7572 6365 293a 0a20 2020  ountSource):.   
+0001a1f0: 2023 2042 6173 6963 616c 6c79 2063 6f70   # Basically cop
+0001a200: 7920 7061 7374 6520 6f66 205a 6970 4d6f  y paste of ZipMo
+0001a210: 756e 7453 6f75 7263 6520 6265 6361 7573  untSource becaus
+0001a220: 6520 7468 6520 696e 7465 7266 6163 6573  e the interfaces
+0001a230: 2061 7265 2076 6572 7920 7369 6d69 6c61   are very simila
+0001a240: 720a 2020 2020 2320 4927 6d20 686f 6e65  r.    # I'm hone
+0001a250: 7374 6c79 206e 6f74 2073 7572 6520 686f  stly not sure ho
+0001a260: 7720 6974 2077 6f72 6b73 2074 6861 7420  w it works that 
+0001a270: 7765 6c6c 2061 7320 6974 2064 6f65 732e  well as it does.
+0001a280: 2049 7420 646f 6573 2068 6176 6520 736f   It does have so
+0001a290: 6d65 2070 726f 626c 656d 730a 2020 2020  me problems.    
+0001a2a0: 2320 7768 656e 2074 7279 696e 6720 746f  # when trying to
+0001a2b0: 206d 6f75 6e74 202e 7461 722e 627a 3220   mount .tar.bz2 
+0001a2c0: 6f72 202e 7461 722e 787a 2069 6e73 6964  or .tar.xz insid
+0001a2d0: 6520 7261 7220 6669 6c65 7320 7265 6375  e rar files recu
+0001a2e0: 7273 6976 656c 7920 6275 7420 6974 2077  rsively but it w
+0001a2f0: 6f72 6b73 0a20 2020 2023 2072 6561 736f  orks.    # reaso
+0001a300: 6e61 626c 7920 7765 6c6c 2066 6f72 202e  nably well for .
+0001a310: 7461 722e 677a 2061 6e64 202e 7a69 7020  tar.gz and .zip 
+0001a320: 636f 6e73 6964 6572 696e 6720 7468 6174  considering that
+0001a330: 2073 6565 6b69 6e67 2073 6565 6d73 2074   seeking seems t
+0001a340: 6f20 6265 2062 726f 6b65 6e3a 0a20 2020  o be broken:.   
+0001a350: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
+0001a360: 622e 636f 6d2f 6d61 726b 6f6b 722f 7261  b.com/markokr/ra
+0001a370: 7266 696c 652f 6973 7375 6573 2f37 330a  rfile/issues/73.
+0001a380: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+0001a390: 5f28 7365 6c66 2c20 6669 6c65 4f72 5061  _(self, fileOrPa
+0001a3a0: 7468 3a20 556e 696f 6e5b 7374 722c 2049  th: Union[str, I
+0001a3b0: 4f5b 6279 7465 735d 5d2c 202a 2a6f 7074  O[bytes]], **opt
+0001a3c0: 696f 6e73 2920 2d3e 204e 6f6e 653a 0a20  ions) -> None:. 
+0001a3d0: 2020 2020 2020 2073 656c 662e 6669 6c65         self.file
+0001a3e0: 4f62 6a65 6374 203d 2072 6172 6669 6c65  Object = rarfile
+0001a3f0: 2e52 6172 4669 6c65 2866 696c 654f 7250  .RarFile(fileOrP
+0001a400: 6174 682c 2027 7227 290a 2020 2020 2020  ath, 'r').      
+0001a410: 2020 5261 724d 6f75 6e74 536f 7572 6365    RarMountSource
+0001a420: 2e5f 6669 6e64 5061 7373 776f 7264 2873  ._findPassword(s
+0001a430: 656c 662e 6669 6c65 4f62 6a65 6374 2c20  elf.fileObject, 
+0001a440: 6f70 7469 6f6e 732e 6765 7428 2270 6173  options.get("pas
+0001a450: 7377 6f72 6473 222c 205b 5d29 290a 2020  swords", [])).  
+0001a460: 2020 2020 2020 7365 6c66 2e66 696c 6573        self.files
+0001a470: 203d 2073 656c 662e 6669 6c65 4f62 6a65   = self.fileObje
+0001a480: 6374 2e69 6e66 6f6c 6973 7428 290a 2020  ct.infolist().  
+0001a490: 2020 2020 2020 7365 6c66 2e6f 7074 696f        self.optio
+0001a4a0: 6e73 203d 206f 7074 696f 6e73 0a0a 2020  ns = options..  
+0001a4b0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+0001a4c0: 2020 2020 6465 6620 5f66 696e 6450 6173      def _findPas
+0001a4d0: 7377 6f72 6428 6669 6c65 6f62 6a3a 2022  sword(fileobj: "
+0001a4e0: 7261 7266 696c 652e 5261 7246 696c 6522  rarfile.RarFile"
+0001a4f0: 2c20 7061 7373 776f 7264 7329 3a0a 2020  , passwords):.  
+0001a500: 2020 2020 2020 6966 206e 6f74 2066 696c        if not fil
+0001a510: 656f 626a 2e6e 6565 6473 5f70 6173 7377  eobj.needs_passw
+0001a520: 6f72 6428 293a 0a20 2020 2020 2020 2020  ord():.         
+0001a530: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+0001a540: 2020 2020 2020 2020 2320 4966 2068 6561          # If hea
+0001a550: 6465 7273 2061 7265 2065 6e63 7279 7074  ders are encrypt
+0001a560: 6564 2c20 7468 656e 2069 6e66 6f6c 6973  ed, then infolis
+0001a570: 7420 7769 6c6c 2073 696d 706c 7920 7265  t will simply re
+0001a580: 7475 726e 2061 6e20 656d 7074 7920 6c69  turn an empty li
+0001a590: 7374 210a 2020 2020 2020 2020 6669 6c65  st!.        file
+0001a5a0: 7320 3d20 6669 6c65 6f62 6a2e 696e 666f  s = fileobj.info
+0001a5b0: 6c69 7374 2829 0a20 2020 2020 2020 2069  list().        i
+0001a5c0: 6620 6e6f 7420 6669 6c65 733a 0a20 2020  f not files:.   
+0001a5d0: 2020 2020 2020 2020 2066 6f72 2070 6173           for pas
+0001a5e0: 7377 6f72 6420 696e 2070 6173 7377 6f72  sword in passwor
+0001a5f0: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+0001a600: 2020 2020 6669 6c65 6f62 6a2e 7365 7470      fileobj.setp
+0001a610: 6173 7377 6f72 6428 7061 7373 776f 7264  assword(password
+0001a620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a630: 2020 6669 6c65 7320 3d20 6669 6c65 6f62    files = fileob
+0001a640: 6a2e 696e 666f 6c69 7374 2829 0a20 2020  j.infolist().   
+0001a650: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001a660: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0001a670: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a680: 6e20 7061 7373 776f 7264 0a0a 2020 2020  n password..    
+0001a690: 2020 2020 2320 4966 2068 6561 6465 7273      # If headers
+0001a6a0: 2061 7265 206e 6f74 2065 6e63 7279 7074   are not encrypt
+0001a6b0: 6564 2c20 7468 656e 2074 7279 206f 7574  ed, then try out
+0001a6c0: 2070 6173 7377 6f72 6473 2062 7920 7472   passwords by tr
+0001a6d0: 7969 6e67 2074 6f20 6f70 656e 2074 6865  ying to open the
+0001a6e0: 2066 6972 7374 2066 696c 652e 0a20 2020   first file..   
+0001a6f0: 2020 2020 2066 696c 6573 203d 205b 6669       files = [fi
+0001a700: 6c65 2066 6f72 2066 696c 6520 696e 2066  le for file in f
+0001a710: 696c 6573 2069 6620 6669 6c65 2e69 735f  iles if file.is_
+0001a720: 6669 6c65 2829 5d0a 2020 2020 2020 2020  file()].        
+0001a730: 6966 206e 6f74 2066 696c 6573 3a0a 2020  if not files:.  
+0001a740: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001a750: 204e 6f6e 650a 2020 2020 2020 2020 666f   None.        fo
+0001a760: 7220 7061 7373 776f 7264 2069 6e20 7061  r password in pa
+0001a770: 7373 776f 7264 733a 0a20 2020 2020 2020  sswords:.       
+0001a780: 2020 2020 2066 696c 656f 626a 2e73 6574       fileobj.set
+0001a790: 7061 7373 776f 7264 2870 6173 7377 6f72  password(passwor
+0001a7a0: 6429 0a20 2020 2020 2020 2020 2020 2074  d).            t
+0001a7b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001a7c0: 2020 2020 7769 7468 2066 696c 656f 626a      with fileobj
+0001a7d0: 2e6f 7065 6e28 6669 6c65 735b 305d 2920  .open(files[0]) 
+0001a7e0: 6173 2066 696c 653a 0a20 2020 2020 2020  as file:.       
+0001a7f0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0001a800: 652e 7265 6164 2831 290a 2020 2020 2020  e.read(1).      
+0001a810: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001a820: 2070 6173 7377 6f72 640a 2020 2020 2020   password.      
+0001a830: 2020 2020 2020 6578 6365 7074 2028 7261        except (ra
+0001a840: 7266 696c 652e 5061 7373 776f 7264 5265  rfile.PasswordRe
+0001a850: 7175 6972 6564 2c20 7261 7266 696c 652e  quired, rarfile.
+0001a860: 4261 6452 6172 4669 6c65 293a 0a20 2020  BadRarFile):.   
+0001a870: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+0001a880: 730a 0a20 2020 2020 2020 2072 6169 7365  s..        raise
+0001a890: 2072 6172 6669 6c65 2e50 6173 7377 6f72   rarfile.Passwor
+0001a8a0: 6452 6571 7569 7265 6428 2243 6f75 6c64  dRequired("Could
+0001a8b0: 206e 6f74 2066 696e 6420 6120 6d61 7463   not find a matc
+0001a8c0: 6869 6e67 2070 6173 7377 6f72 6421 2229  hing password!")
+0001a8d0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+0001a8e0: 686f 640a 2020 2020 6465 6620 5f63 6f6e  hod.    def _con
+0001a8f0: 7665 7274 546f 4669 6c65 496e 666f 2869  vertToFileInfo(i
+0001a900: 6e66 6f3a 2022 7261 7266 696c 652e 5261  nfo: "rarfile.Ra
+0001a910: 7249 6e66 6f22 2920 2d3e 2046 696c 6549  rInfo") -> FileI
+0001a920: 6e66 6f3a 0a20 2020 2020 2020 206d 6f64  nfo:.        mod
+0001a930: 6520 3d20 306f 3535 3520 7c20 2873 7461  e = 0o555 | (sta
+0001a940: 742e 535f 4946 4449 5220 6966 2069 6e66  t.S_IFDIR if inf
+0001a950: 6f2e 6973 5f64 6972 2829 2065 6c73 6520  o.is_dir() else 
+0001a960: 7374 6174 2e53 5f49 4652 4547 290a 2020  stat.S_IFREG).  
+0001a970: 2020 2020 2020 6474 696d 6520 3d20 6461        dtime = da
+0001a980: 7465 7469 6d65 2e64 6174 6574 696d 6528  tetime.datetime(
+0001a990: 2a69 6e66 6f2e 6461 7465 5f74 696d 6529  *info.date_time)
+0001a9a0: 0a20 2020 2020 2020 2064 7469 6d65 203d  .        dtime =
+0001a9b0: 2064 7469 6d65 2e72 6570 6c61 6365 2874   dtime.replace(t
+0001a9c0: 7a69 6e66 6f3d 6461 7465 7469 6d65 2e74  zinfo=datetime.t
+0001a9d0: 696d 657a 6f6e 652e 7574 6329 0a20 2020  imezone.utc).   
+0001a9e0: 2020 2020 206d 7469 6d65 203d 2064 7469       mtime = dti
+0001a9f0: 6d65 2e74 696d 6573 7461 6d70 2829 2069  me.timestamp() i
+0001aa00: 6620 696e 666f 2e64 6174 655f 7469 6d65  f info.date_time
+0001aa10: 2065 6c73 6520 300a 0a20 2020 2020 2020   else 0..       
+0001aa20: 2023 2066 696c 655f 7265 6469 7220 6973   # file_redir is
+0001aa30: 2028 7479 7065 2c20 666c 6167 732c 2074   (type, flags, t
+0001aa40: 6172 6765 7429 206f 7220 4e6f 6e65 2e20  arget) or None. 
+0001aa50: 4f6e 6c79 2074 6573 7465 6420 666f 7220  Only tested for 
+0001aa60: 7479 7065 203d 3d20 5241 5235 5f58 5245  type == RAR5_XRE
+0001aa70: 4449 525f 554e 4958 5f53 594d 4c49 4e4b  DIR_UNIX_SYMLINK
+0001aa80: 2e0a 2020 2020 2020 2020 6c69 6e6b 6e61  ..        linkna
+0001aa90: 6d65 203d 2022 220a 2020 2020 2020 2020  me = "".        
+0001aaa0: 6966 2069 6e66 6f2e 6669 6c65 5f72 6564  if info.file_red
+0001aab0: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+0001aac0: 6c69 6e6b 6e61 6d65 203d 2069 6e66 6f2e  linkname = info.
+0001aad0: 6669 6c65 5f72 6564 6972 5b32 5d0a 2020  file_redir[2].  
+0001aae0: 2020 2020 2020 2020 2020 6d6f 6465 203d            mode =
+0001aaf0: 2030 6f35 3535 207c 2073 7461 742e 535f   0o555 | stat.S_
+0001ab00: 4946 4c4e 4b0a 0a20 2020 2020 2020 2066  IFLNK..        f
+0001ab10: 696c 6549 6e66 6f20 3d20 4669 6c65 496e  ileInfo = FileIn
+0001ab20: 666f 280a 2020 2020 2020 2020 2020 2020  fo(.            
+0001ab30: 2320 666d 743a 206f 6666 0a20 2020 2020  # fmt: off.     
+0001ab40: 2020 2020 2020 2073 697a 6520 2020 2020         size     
+0001ab50: 3d20 696e 666f 2e66 696c 655f 7369 7a65  = info.file_size
+0001ab60: 2c0a 2020 2020 2020 2020 2020 2020 6d74  ,.            mt
+0001ab70: 696d 6520 2020 203d 206d 7469 6d65 2c0a  ime    = mtime,.
+0001ab80: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0001ab90: 2020 2020 203d 206d 6f64 652c 0a20 2020       = mode,.   
+0001aba0: 2020 2020 2020 2020 206c 696e 6b6e 616d           linknam
+0001abb0: 6520 3d20 6c69 6e6b 6e61 6d65 2c0a 2020  e = linkname,.  
+0001abc0: 2020 2020 2020 2020 2020 7569 6420 2020            uid   
+0001abd0: 2020 203d 206f 732e 6765 7475 6964 2829     = os.getuid()
+0001abe0: 2c0a 2020 2020 2020 2020 2020 2020 6769  ,.            gi
+0001abf0: 6420 2020 2020 203d 206f 732e 6765 7467  d      = os.getg
+0001ac00: 6964 2829 2c0a 2020 2020 2020 2020 2020  id(),.          
+0001ac10: 2020 7573 6572 6461 7461 203d 205b 696e    userdata = [in
+0001ac20: 666f 5d2c 0a20 2020 2020 2020 2020 2020  fo],.           
+0001ac30: 2023 2066 6d74 3a20 6f6e 0a20 2020 2020   # fmt: on.     
+0001ac40: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
+0001ac50: 7475 726e 2066 696c 6549 6e66 6f0a 0a20  turn fileInfo.. 
+0001ac60: 2020 2040 6f76 6572 7269 6465 7328 4d6f     @overrides(Mo
+0001ac70: 756e 7453 6f75 7263 6529 0a20 2020 2064  untSource).    d
+0001ac80: 6566 206c 6973 7444 6972 2873 656c 662c  ef listDir(self,
+0001ac90: 2070 6174 683a 2073 7472 2920 2d3e 204f   path: str) -> O
+0001aca0: 7074 696f 6e61 6c5b 4974 6572 6162 6c65  ptional[Iterable
+0001acb0: 5b73 7472 5d5d 3a0a 2020 2020 2020 2020  [str]]:.        
+0001acc0: 7061 7468 203d 2070 6174 682e 7374 7269  path = path.stri
+0001acd0: 7028 272f 2729 0a20 2020 2020 2020 2069  p('/').        i
+0001ace0: 6620 7061 7468 3a0a 2020 2020 2020 2020  f path:.        
+0001acf0: 2020 2020 7061 7468 202b 3d20 272f 270a      path += '/'.
+0001ad00: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+0001ad10: 486f 7720 746f 2062 6568 6176 6520 7769  How to behave wi
+0001ad20: 7468 2066 696c 6573 2069 6e20 6172 6368  th files in arch
+0001ad30: 6976 6520 7769 7468 2061 6273 6f6c 7574  ive with absolut
+0001ad40: 6520 7061 7468 733f 2043 7572 7265 6e74  e paths? Current
+0001ad50: 6c79 2c20 7468 6579 2077 6f75 6c64 206e  ly, they would n
+0001ad60: 6576 6572 2062 6520 7368 6f77 6e2e 0a20  ever be shown.. 
+0001ad70: 2020 2020 2020 2064 6566 2067 6574 4e61         def getNa
+0001ad80: 6d65 2866 696c 6550 6174 6829 3a0a 2020  me(filePath):.  
+0001ad90: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0001ada0: 2066 696c 6550 6174 682e 7374 6172 7473   filePath.starts
+0001adb0: 7769 7468 2870 6174 6829 3a0a 2020 2020  with(path):.    
+0001adc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001add0: 726e 204e 6f6e 650a 0a20 2020 2020 2020  rn None..       
+0001ade0: 2020 2020 2066 696c 6550 6174 6820 3d20       filePath = 
+0001adf0: 6669 6c65 5061 7468 5b6c 656e 2870 6174  filePath[len(pat
+0001ae00: 6829 203a 5d2e 7374 7269 7028 272f 2729  h) :].strip('/')
+0001ae10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001ae20: 6e6f 7420 6669 6c65 5061 7468 3a0a 2020  not filePath:.  
+0001ae30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001ae40: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
+0001ae50: 2020 2020 2020 2023 2054 6869 7320 6566         # This ef
+0001ae60: 6665 6374 6976 656c 7920 6164 6473 2061  fectively adds a
+0001ae70: 6c6c 2070 6172 656e 7420 7061 7468 7320  ll parent paths 
+0001ae80: 6173 2066 6f6c 6465 7273 2e20 4974 2069  as folders. It i
+0001ae90: 7320 6561 7379 2074 6f20 6372 6561 7465  s easy to create
+0001aea0: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+0001aeb0: 4152 7320 616e 6420 5a49 5073 2077 6974  ARs and ZIPs wit
+0001aec0: 6820 6e65 7374 6564 2066 696c 6573 2077  h nested files w
+0001aed0: 6974 686f 7574 2069 6e66 6f72 6d61 7469  ithout informati
+0001aee0: 6f6e 206f 6e20 7468 6520 7061 7265 6e74  on on the parent
+0001aef0: 2064 6972 6563 746f 7269 6573 210a 2020   directories!.  
+0001af00: 2020 2020 2020 2020 2020 6966 2027 2f27            if '/'
+0001af10: 2069 6e20 6669 6c65 5061 7468 3a0a 2020   in filePath:.  
+0001af20: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001af30: 7273 7453 6c61 7368 203d 2066 696c 6550  rstSlash = fileP
+0001af40: 6174 682e 696e 6465 7828 272f 2729 0a20  ath.index('/'). 
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001af60: 696c 6550 6174 6820 3d20 6669 6c65 5061  ilePath = filePa
+0001af70: 7468 5b3a 6669 7273 7453 6c61 7368 5d0a  th[:firstSlash].
+0001af80: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001af90: 7572 6e20 6669 6c65 5061 7468 0a0a 2020  urn filePath..  
+0001afa0: 2020 2020 2020 2320 5468 6520 2266 696c        # The "fil
+0001afb0: 656e 616d 6522 206d 656d 6265 7220 6973  ename" member is
+0001afc0: 2077 726f 6e67 6c79 206e 616d 6564 2061   wrongly named a
+0001afd0: 7320 6974 2072 6574 7572 6e73 2074 6865  s it returns the
+0001afe0: 2066 756c 6c20 7061 7468 2069 6e73 6964   full path insid
+0001aff0: 6520 7468 6520 6172 6368 6976 6520 6e6f  e the archive no
+0001b000: 7420 6a75 7374 2074 6865 206e 616d 6520  t just the name 
+0001b010: 7061 7274 2e0a 2020 2020 2020 2020 7265  part..        re
+0001b020: 7475 726e 2073 6574 2867 6574 4e61 6d65  turn set(getName
+0001b030: 2869 6e66 6f2e 6669 6c65 6e61 6d65 2920  (info.filename) 
+0001b040: 666f 7220 696e 666f 2069 6e20 7365 6c66  for info in self
+0001b050: 2e66 696c 6573 2069 6620 6765 744e 616d  .files if getNam
+0001b060: 6528 696e 666f 2e66 696c 656e 616d 6529  e(info.filename)
+0001b070: 290a 0a20 2020 2064 6566 205f 6765 7446  )..    def _getF
+0001b080: 696c 6549 6e66 6f73 2873 656c 662c 2070  ileInfos(self, p
+0001b090: 6174 683a 2073 7472 2920 2d3e 204c 6973  ath: str) -> Lis
+0001b0a0: 745b 4669 6c65 496e 666f 5d3a 0a20 2020  t[FileInfo]:.   
+0001b0b0: 2020 2020 2069 6e66 6f4c 6973 7420 3d20       infoList = 
+0001b0c0: 5b0a 2020 2020 2020 2020 2020 2020 5261  [.            Ra
+0001b0d0: 724d 6f75 6e74 536f 7572 6365 2e5f 636f  rMountSource._co
+0001b0e0: 6e76 6572 7454 6f46 696c 6549 6e66 6f28  nvertToFileInfo(
+0001b0f0: 696e 666f 290a 2020 2020 2020 2020 2020  info).          
+0001b100: 2020 666f 7220 696e 666f 2069 6e20 7365    for info in se
+0001b110: 6c66 2e66 696c 6573 0a20 2020 2020 2020  lf.files.       
+0001b120: 2020 2020 2069 6620 696e 666f 2e66 696c       if info.fil
+0001b130: 656e 616d 652e 7273 7472 6970 2827 2f27  ename.rstrip('/'
+0001b140: 2920 3d3d 2070 6174 682e 6c73 7472 6970  ) == path.lstrip
+0001b150: 2827 2f27 290a 2020 2020 2020 2020 5d0a  ('/').        ].
+0001b160: 0a20 2020 2020 2020 2023 2049 6620 7765  .        # If we
+0001b170: 2068 6176 6520 6120 6669 6c65 496e 666f   have a fileInfo
+0001b180: 2066 6f72 2074 6865 2067 6976 656e 2064   for the given d
+0001b190: 6972 6563 746f 7279 2070 6174 682c 2074  irectory path, t
+0001b1a0: 6865 6e20 6576 6572 7974 6869 6e67 2069  hen everything i
+0001b1b0: 7320 6669 6e65 2e0a 2020 2020 2020 2020  s fine..        
+0001b1c0: 7061 7468 4173 4469 7220 3d20 7061 7468  pathAsDir = path
+0001b1d0: 2e73 7472 6970 2827 2f27 2920 2b20 272f  .strip('/') + '/
+0001b1e0: 270a 0a20 2020 2020 2020 2023 2043 6865  '..        # Che
+0001b1f0: 636b 2077 6865 7468 6572 2073 6f6d 6520  ck whether some 
+0001b200: 7061 7265 6e74 2064 6972 6563 746f 7269  parent directori
+0001b210: 6573 206f 6620 6669 6c65 7320 646f 206e  es of files do n
+0001b220: 6f74 2065 7869 7374 2061 7320 7365 7061  ot exist as sepa
+0001b230: 7261 7465 2065 6e74 6974 6965 7320 696e  rate entities in
+0001b240: 2074 6865 2061 7263 6869 7665 2e0a 2020   the archive..  
+0001b250: 2020 2020 2020 6966 206e 6f74 2061 6e79        if not any
+0001b260: 285b 696e 666f 2e75 7365 7264 6174 615b  ([info.userdata[
+0001b270: 2d31 5d2e 6669 6c65 6e61 6d65 203d 3d20  -1].filename == 
+0001b280: 7061 7468 4173 4469 7220 666f 7220 696e  pathAsDir for in
+0001b290: 666f 2069 6e20 696e 666f 4c69 7374 5d29  fo in infoList])
+0001b2a0: 2061 6e64 2061 6e79 280a 2020 2020 2020   and any(.      
+0001b2b0: 2020 2020 2020 696e 666f 2e66 696c 656e        info.filen
+0001b2c0: 616d 652e 7273 7472 6970 2827 2f27 292e  ame.rstrip('/').
+0001b2d0: 7374 6172 7473 7769 7468 2870 6174 6841  startswith(pathA
+0001b2e0: 7344 6972 2920 666f 7220 696e 666f 2069  sDir) for info i
+0001b2f0: 6e20 7365 6c66 2e66 696c 6573 0a20 2020  n self.files.   
+0001b300: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0001b310: 2020 2020 696e 666f 4c69 7374 2e61 7070      infoList.app
+0001b320: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0001b330: 2020 2020 2046 696c 6549 6e66 6f28 0a20       FileInfo(. 
+0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b350: 2020 2023 2066 6d74 3a20 6f66 660a 2020     # fmt: off.  
+0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b370: 2020 7369 7a65 2020 2020 203d 2030 2c0a    size     = 0,.
+0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b390: 2020 2020 6d74 696d 6520 2020 203d 2069      mtime    = i
+0001b3a0: 6e74 2874 696d 652e 7469 6d65 2829 292c  nt(time.time()),
+0001b3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b3c0: 2020 2020 206d 6f64 6520 2020 2020 3d20       mode     = 
+0001b3d0: 306f 3737 3720 7c20 7374 6174 2e53 5f49  0o777 | stat.S_I
+0001b3e0: 4644 4952 2c0a 2020 2020 2020 2020 2020  FDIR,.          
+0001b3f0: 2020 2020 2020 2020 2020 6c69 6e6b 6e61            linkna
+0001b400: 6d65 203d 2022 222c 0a20 2020 2020 2020  me = "",.       
+0001b410: 2020 2020 2020 2020 2020 2020 2075 6964               uid
+0001b420: 2020 2020 2020 3d20 6f73 2e67 6574 7569        = os.getui
+0001b430: 6428 292c 0a20 2020 2020 2020 2020 2020  d(),.           
+0001b440: 2020 2020 2020 2020 2067 6964 2020 2020           gid    
+0001b450: 2020 3d20 6f73 2e67 6574 6769 6428 292c    = os.getgid(),
+0001b460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b470: 2020 2020 2075 7365 7264 6174 6120 3d20       userdata = 
+0001b480: 5b4e 6f6e 655d 2c0a 2020 2020 2020 2020  [None],.        
+0001b490: 2020 2020 2020 2020 2020 2020 2320 666d              # fm
+0001b4a0: 743a 206f 6e0a 2020 2020 2020 2020 2020  t: on.          
+0001b4b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b4c0: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
+0001b4d0: 6574 7572 6e20 696e 666f 4c69 7374 0a0a  eturn infoList..
+0001b4e0: 2020 2020 406f 7665 7272 6964 6573 284d      @overrides(M
+0001b4f0: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
+0001b500: 6465 6620 6765 7446 696c 6549 6e66 6f28  def getFileInfo(
+0001b510: 7365 6c66 2c20 7061 7468 3a20 7374 722c  self, path: str,
+0001b520: 2066 696c 6556 6572 7369 6f6e 3a20 696e   fileVersion: in
+0001b530: 7420 3d20 3029 202d 3e20 4f70 7469 6f6e  t = 0) -> Option
+0001b540: 616c 5b46 696c 6549 6e66 6f5d 3a0a 2020  al[FileInfo]:.  
+0001b550: 2020 2020 2020 696e 666f 7320 3d20 7365        infos = se
+0001b560: 6c66 2e5f 6765 7446 696c 6549 6e66 6f73  lf._getFileInfos
+0001b570: 2870 6174 6829 0a20 2020 2020 2020 2072  (path).        r
+0001b580: 6574 7572 6e20 696e 666f 735b 6669 6c65  eturn infos[file
+0001b590: 5665 7273 696f 6e5d 2069 6620 2d6c 656e  Version] if -len
+0001b5a0: 2869 6e66 6f73 2920 3c3d 2066 696c 6556  (infos) <= fileV
+0001b5b0: 6572 7369 6f6e 203c 206c 656e 2869 6e66  ersion < len(inf
+0001b5c0: 6f73 2920 656c 7365 204e 6f6e 650a 0a20  os) else None.. 
+0001b5d0: 2020 2040 6f76 6572 7269 6465 7328 4d6f     @overrides(Mo
+0001b5e0: 756e 7453 6f75 7263 6529 0a20 2020 2064  untSource).    d
+0001b5f0: 6566 2066 696c 6556 6572 7369 6f6e 7328  ef fileVersions(
+0001b600: 7365 6c66 2c20 7061 7468 3a20 7374 7229  self, path: str)
+0001b610: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+0001b620: 2072 6574 7572 6e20 6c65 6e28 7365 6c66   return len(self
+0001b630: 2e5f 6765 7446 696c 6549 6e66 6f73 2870  ._getFileInfos(p
+0001b640: 6174 6829 290a 0a20 2020 2040 6f76 6572  ath))..    @over
+0001b650: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
+0001b660: 6529 0a20 2020 2064 6566 206f 7065 6e28  e).    def open(
+0001b670: 7365 6c66 2c20 6669 6c65 496e 666f 3a20  self, fileInfo: 
+0001b680: 4669 6c65 496e 666f 2920 2d3e 2049 4f5b  FileInfo) -> IO[
+0001b690: 6279 7465 735d 3a0a 2020 2020 2020 2020  bytes]:.        
+0001b6a0: 696e 666f 203d 2066 696c 6549 6e66 6f2e  info = fileInfo.
+0001b6b0: 7573 6572 6461 7461 5b2d 315d 0a20 2020  userdata[-1].   
+0001b6c0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
+0001b6d0: 7374 616e 6365 2869 6e66 6f2c 2072 6172  stance(info, rar
+0001b6e0: 6669 6c65 2e52 6172 496e 666f 290a 2020  file.RarInfo).  
+0001b6f0: 2020 2020 2020 7265 7475 726e 2063 6173        return cas
+0001b700: 7428 494f 5b62 7974 6573 5d2c 2052 6177  t(IO[bytes], Raw
+0001b710: 4669 6c65 496e 7369 6465 5261 7228 6c61  FileInsideRar(la
+0001b720: 6d62 6461 3a20 7365 6c66 2e66 696c 654f  mbda: self.fileO
+0001b730: 626a 6563 742e 6f70 656e 2869 6e66 6f2c  bject.open(info,
+0001b740: 2027 7227 292c 2069 6e66 6f2e 6669 6c65   'r'), info.file
+0001b750: 5f73 697a 6529 290a 0a20 2020 2040 6f76  _size))..    @ov
+0001b760: 6572 7269 6465 7328 4d6f 756e 7453 6f75  errides(MountSou
+0001b770: 7263 6529 0a20 2020 2064 6566 2072 6561  rce).    def rea
+0001b780: 6428 7365 6c66 2c20 6669 6c65 496e 666f  d(self, fileInfo
+0001b790: 3a20 4669 6c65 496e 666f 2c20 7369 7a65  : FileInfo, size
+0001b7a0: 3a20 696e 742c 206f 6666 7365 743a 2069  : int, offset: i
+0001b7b0: 6e74 2920 2d3e 2062 7974 6573 3a0a 2020  nt) -> bytes:.  
+0001b7c0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+0001b7d0: 6f70 656e 2866 696c 6549 6e66 6f29 2061  open(fileInfo) a
+0001b7e0: 7320 6669 6c65 3a0a 2020 2020 2020 2020  s file:.        
+0001b7f0: 2020 2020 6669 6c65 2e73 6565 6b28 6f66      file.seek(of
+0001b800: 6673 6574 2c20 6f73 2e53 4545 4b5f 5345  fset, os.SEEK_SE
+0001b810: 5429 0a20 2020 2020 2020 2020 2020 2072  T).            r
+0001b820: 6574 7572 6e20 6669 6c65 2e72 6561 6428  eturn file.read(
+0001b830: 7369 7a65 290a 0a0a 636c 6173 7320 4475  size)...class Du
+0001b840: 6d6d 7946 7573 654f 7065 7261 7469 6f6e  mmyFuseOperation
+0001b850: 733a 0a20 2020 2022 2222 4120 6475 6d6d  s:.    """A dumm
+0001b860: 7920 636c 6173 7320 7468 6174 2069 7320  y class that is 
+0001b870: 7573 6564 2074 6f20 7265 706c 6163 650a  used to replace.
+0001b880: 2020 2020 6675 7365 2e4f 7065 7261 7469      fuse.Operati
+0001b890: 6f6e 7320 6966 2066 7573 6570 7920 6973  ons if fusepy is
+0001b8a0: 206e 6f74 2069 6e73 7461 6c6c 6564 2e22   not installed."
+0001b8b0: 2222 0a0a 2020 2020 6465 6620 696e 6974  ""..    def init
+0001b8c0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001b8d0: 7061 7373 0a0a 2020 2020 6465 6620 6765  pass..    def ge
+0001b8e0: 7461 7474 7228 7365 6c66 293a 0a20 2020  tattr(self):.   
+0001b8f0: 2020 2020 2070 6173 730a 0a20 2020 2064       pass..    d
+0001b900: 6566 2072 6561 6428 7365 6c66 293a 0a20  ef read(self):. 
+0001b910: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
+0001b920: 2064 6566 2072 6561 6464 6972 2873 656c   def readdir(sel
+0001b930: 6629 3a0a 2020 2020 2020 2020 7061 7373  f):.        pass
+0001b940: 0a0a 2020 2020 6465 6620 7265 6164 6c69  ..    def readli
+0001b950: 6e6b 2873 656c 6629 3a0a 2020 2020 2020  nk(self):.      
+0001b960: 2020 7061 7373 0a0a 2020 2020 6465 6620    pass..    def 
+0001b970: 6f70 656e 2873 656c 6629 3a0a 2020 2020  open(self):.    
+0001b980: 2020 2020 7061 7373 0a0a 2020 2020 6465      pass..    de
+0001b990: 6620 7265 6c65 6173 6528 7365 6c66 293a  f release(self):
+0001b9a0: 0a20 2020 2020 2020 2070 6173 730a 0a0a  .        pass...
+0001b9b0: 4675 7365 4f70 6572 6174 696f 6e73 203d  FuseOperations =
+0001b9c0: 2066 7573 652e 4f70 6572 6174 696f 6e73   fuse.Operations
+0001b9d0: 2069 6620 2766 7573 6527 2069 6e20 7379   if 'fuse' in sy
+0001b9e0: 732e 6d6f 6475 6c65 7320 656c 7365 2044  s.modules else D
+0001b9f0: 756d 6d79 4675 7365 4f70 6572 6174 696f  ummyFuseOperatio
+0001ba00: 6e73 0a0a 0a64 6566 206f 7065 6e4d 6f75  ns...def openMou
+0001ba10: 6e74 536f 7572 6365 2866 696c 654f 7250  ntSource(fileOrP
+0001ba20: 6174 683a 2055 6e69 6f6e 5b73 7472 2c20  ath: Union[str, 
+0001ba30: 494f 5b62 7974 6573 5d5d 2c20 2a2a 6f70  IO[bytes]], **op
+0001ba40: 7469 6f6e 7329 202d 3e20 4d6f 756e 7453  tions) -> MountS
+0001ba50: 6f75 7263 653a 0a20 2020 2069 6620 6973  ource:.    if is
+0001ba60: 696e 7374 616e 6365 2866 696c 654f 7250  instance(fileOrP
+0001ba70: 6174 682c 2073 7472 293a 0a20 2020 2020  ath, str):.     
+0001ba80: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+0001ba90: 682e 6578 6973 7473 2866 696c 654f 7250  h.exists(fileOrP
+0001baa0: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
+0001bab0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0001bac0: 6e28 224d 6f75 6e74 2073 6f75 7263 6520  n("Mount source 
+0001bad0: 646f 6573 206e 6f74 2065 7869 7374 2122  does not exist!"
+0001bae0: 290a 0a20 2020 2020 2020 2069 6620 6f73  )..        if os
+0001baf0: 2e70 6174 682e 6973 6469 7228 6669 6c65  .path.isdir(file
+0001bb00: 4f72 5061 7468 293a 0a20 2020 2020 2020  OrPath):.       
+0001bb10: 2020 2020 2072 6574 7572 6e20 466f 6c64       return Fold
+0001bb20: 6572 4d6f 756e 7453 6f75 7263 6528 272e  erMountSource('.
+0001bb30: 2720 6966 2066 696c 654f 7250 6174 6820  ' if fileOrPath 
+0001bb40: 3d3d 2027 2e27 2065 6c73 6520 6f73 2e70  == '.' else os.p
+0001bb50: 6174 682e 7265 616c 7061 7468 2866 696c  ath.realpath(fil
+0001bb60: 654f 7250 6174 6829 290a 0a20 2020 2074  eOrPath))..    t
+0001bb70: 7279 3a0a 2020 2020 2020 2020 6966 2027  ry:.        if '
+0001bb80: 7261 7266 696c 6527 2069 6e20 7379 732e  rarfile' in sys.
+0001bb90: 6d6f 6475 6c65 7320 616e 6420 7261 7266  modules and rarf
+0001bba0: 696c 652e 6973 5f72 6172 6669 6c65 2866  ile.is_rarfile(f
+0001bbb0: 696c 654f 7250 6174 6829 3a0a 2020 2020  ileOrPath):.    
+0001bbc0: 2020 2020 2020 2020 7265 7475 726e 2052          return R
+0001bbd0: 6172 4d6f 756e 7453 6f75 7263 6528 6669  arMountSource(fi
+0001bbe0: 6c65 4f72 5061 7468 2c20 2a2a 6f70 7469  leOrPath, **opti
+0001bbf0: 6f6e 7329 0a20 2020 2065 7863 6570 7420  ons).    except 
+0001bc00: 4578 6365 7074 696f 6e20 6173 2065 7863  Exception as exc
+0001bc10: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0001bc20: 6966 2070 7269 6e74 4465 6275 6720 3e3d  if printDebug >=
+0001bc30: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0001bc40: 7072 696e 7428 225b 496e 666f 5d20 4368  print("[Info] Ch
+0001bc50: 6563 6b69 6e67 2066 6f72 2052 4152 2066  ecking for RAR f
+0001bc60: 696c 6520 7261 6973 6564 2061 6e20 6578  ile raised an ex
+0001bc70: 6365 7074 696f 6e3a 222c 2065 7863 6570  ception:", excep
+0001bc80: 7469 6f6e 290a 2020 2020 2020 2020 6966  tion).        if
+0001bc90: 2070 7269 6e74 4465 6275 6720 3e3d 2032   printDebug >= 2
+0001bca0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+0001bcb0: 6163 6562 6163 6b2e 7072 696e 745f 6578  aceback.print_ex
+0001bcc0: 6328 290a 2020 2020 6669 6e61 6c6c 793a  c().    finally:
+0001bcd0: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
+0001bce0: 7474 7228 6669 6c65 4f72 5061 7468 2c20  ttr(fileOrPath, 
+0001bcf0: 2773 6565 6b27 293a 0a20 2020 2020 2020  'seek'):.       
+0001bd00: 2020 2020 2066 696c 654f 7250 6174 682e       fileOrPath.
+0001bd10: 7365 656b 2830 2920 2023 2074 7970 653a  seek(0)  # type:
+0001bd20: 2069 676e 6f72 650a 0a20 2020 2074 7279   ignore..    try
+0001bd30: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
+0001bd40: 6e73 7461 6e63 6528 6669 6c65 4f72 5061  nstance(fileOrPa
+0001bd50: 7468 2c20 7374 7229 3a0a 2020 2020 2020  th, str):.      
+0001bd60: 2020 2020 2020 7265 7475 726e 2053 514c        return SQL
+0001bd70: 6974 6549 6e64 6578 6564 5461 7228 6669  iteIndexedTar(fi
+0001bd80: 6c65 4f72 5061 7468 2c20 2a2a 6f70 7469  leOrPath, **opti
+0001bd90: 6f6e 7329 0a0a 2020 2020 2020 2020 7265  ons)..        re
+0001bda0: 7475 726e 2053 514c 6974 6549 6e64 6578  turn SQLiteIndex
+0001bdb0: 6564 5461 7228 6669 6c65 4f62 6a65 6374  edTar(fileObject
+0001bdc0: 3d66 696c 654f 7250 6174 682c 202a 2a6f  =fileOrPath, **o
+0001bdd0: 7074 696f 6e73 290a 2020 2020 6578 6365  ptions).    exce
+0001bde0: 7074 2052 6174 6172 6d6f 756e 7445 7272  pt RatarmountErr
+0001bdf0: 6f72 2061 7320 6578 6365 7074 696f 6e3a  or as exception:
+0001be00: 0a20 2020 2020 2020 2069 6620 7072 696e  .        if prin
+0001be10: 7444 6562 7567 203e 3d20 323a 0a20 2020  tDebug >= 2:.   
+0001be20: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0001be30: 5b49 6e66 6f5d 2043 6865 636b 696e 6720  [Info] Checking 
+0001be40: 666f 7220 2863 6f6d 7072 6573 7365 6429  for (compressed)
+0001be50: 2054 4152 2066 696c 6520 7261 6973 6564   TAR file raised
+0001be60: 2061 6e20 6578 6365 7074 696f 6e3a 222c   an exception:",
+0001be70: 2065 7863 6570 7469 6f6e 290a 2020 2020   exception).    
+0001be80: 2020 2020 6966 2070 7269 6e74 4465 6275      if printDebu
+0001be90: 6720 3e3d 2033 3a0a 2020 2020 2020 2020  g >= 3:.        
+0001bea0: 2020 2020 7472 6163 6562 6163 6b2e 7072      traceback.pr
+0001beb0: 696e 745f 6578 6328 290a 2020 2020 6578  int_exc().    ex
+0001bec0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0001bed0: 7320 6578 6365 7074 696f 6e3a 0a20 2020  s exception:.   
+0001bee0: 2020 2020 2069 6620 7072 696e 7444 6562       if printDeb
+0001bef0: 7567 203e 3d20 313a 0a20 2020 2020 2020  ug >= 1:.       
+0001bf00: 2020 2020 2070 7269 6e74 2822 5b49 6e66       print("[Inf
+0001bf10: 6f5d 2043 6865 636b 696e 6720 666f 7220  o] Checking for 
+0001bf20: 2863 6f6d 7072 6573 7365 6429 2054 4152  (compressed) TAR
+0001bf30: 2066 696c 6520 7261 6973 6564 2061 6e20   file raised an 
+0001bf40: 6578 6365 7074 696f 6e3a 222c 2065 7863  exception:", exc
+0001bf50: 6570 7469 6f6e 290a 2020 2020 2020 2020  eption).        
+0001bf60: 6966 2070 7269 6e74 4465 6275 6720 3e3d  if printDebug >=
+0001bf70: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
+0001bf80: 7472 6163 6562 6163 6b2e 7072 696e 745f  traceback.print_
+0001bf90: 6578 6328 290a 2020 2020 6669 6e61 6c6c  exc().    finall
+0001bfa0: 793a 0a20 2020 2020 2020 2069 6620 6861  y:.        if ha
+0001bfb0: 7361 7474 7228 6669 6c65 4f72 5061 7468  sattr(fileOrPath
+0001bfc0: 2c20 2773 6565 6b27 293a 0a20 2020 2020  , 'seek'):.     
+0001bfd0: 2020 2020 2020 2066 696c 654f 7250 6174         fileOrPat
+0001bfe0: 682e 7365 656b 2830 2920 2023 2074 7970  h.seek(0)  # typ
+0001bff0: 653a 2069 676e 6f72 650a 0a20 2020 2069  e: ignore..    i
+0001c000: 6620 277a 6970 6669 6c65 2720 696e 2073  f 'zipfile' in s
+0001c010: 7973 2e6d 6f64 756c 6573 3a0a 2020 2020  ys.modules:.    
+0001c020: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001c030: 2020 2020 2023 2069 735f 7a69 7066 696c       # is_zipfil
+0001c040: 6520 6973 206d 7563 6820 746f 6f20 6c61  e is much too la
+0001c050: 7820 7768 656e 2074 6573 7469 6e67 2066  x when testing f
+0001c060: 6f72 205a 4950 7320 6265 6361 7573 6520  or ZIPs because 
+0001c070: 6974 2773 206f 6e6c 7920 7465 7374 696e  it's only testin
+0001c080: 6720 666f 7220 7468 6520 6365 6e74 7261  g for the centra
+0001c090: 6c20 6469 7265 6374 6f72 790a 2020 2020  l directory.    
+0001c0a0: 2020 2020 2020 2020 2320 6174 2074 6865          # at the
+0001c0b0: 2065 6e64 206f 6620 7468 6520 6669 6c65   end of the file
+0001c0c0: 206e 6f74 2074 6865 206d 6167 6963 2062   not the magic b
+0001c0d0: 6974 7320 6174 2074 6865 2062 6567 696e  its at the begin
+0001c0e0: 6e69 6e67 2e20 4d65 616e 696e 672c 2069  ning. Meaning, i
+0001c0f0: 6620 616e 6f74 6865 7220 6e6f 6e2d 5a49  f another non-ZI
+0001c100: 5020 6172 6368 6976 6520 6861 730a 2020  P archive has.  
+0001c110: 2020 2020 2020 2020 2020 2320 7a69 7020            # zip 
+0001c120: 636f 6e74 656e 7473 2061 7420 7468 6520  contents at the 
+0001c130: 656e 642c 2074 6865 6e20 6974 206d 6967  end, then it mig
+0001c140: 6874 2067 6574 206d 6973 636c 6173 7369  ht get misclassi
+0001c150: 6669 6564 2120 5468 6566 6f72 652c 206d  fied! Thefore, m
+0001c160: 616e 7561 6c6c 7920 6368 6563 6b20 666f  anually check fo
+0001c170: 7220 504b 2061 7420 7374 6172 742e 0a20  r PK at start.. 
+0001c180: 2020 2020 2020 2020 2020 2023 2068 7474             # htt
+0001c190: 7073 3a2f 2f62 7567 732e 7079 7468 6f6e  ps://bugs.python
+0001c1a0: 2e6f 7267 2f69 7373 7565 3136 3733 350a  .org/issue16735.
+0001c1b0: 2020 2020 2020 2020 2020 2020 2320 6874              # ht
+0001c1c0: 7470 733a 2f2f 6275 6773 2e70 7974 686f  tps://bugs.pytho
+0001c1d0: 6e2e 6f72 672f 6973 7375 6532 3834 3934  n.org/issue28494
+0001c1e0: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
+0001c1f0: 7474 7073 3a2f 2f62 7567 732e 7079 7468  ttps://bugs.pyth
+0001c200: 6f6e 2e6f 7267 2f69 7373 7565 3432 3039  on.org/issue4209
+0001c210: 360a 2020 2020 2020 2020 2020 2020 2320  6.            # 
+0001c220: 6874 7470 733a 2f2f 6275 6773 2e70 7974  https://bugs.pyt
+0001c230: 686f 6e2e 6f72 672f 6973 7375 6534 3532  hon.org/issue452
+0001c240: 3837 0a20 2020 2020 2020 2020 2020 2023  87.            #
+0001c250: 2054 4f44 4f20 5468 6973 2077 696c 6c20   TODO This will 
+0001c260: 6e6f 7420 7265 636f 676e 697a 6520 7365  not recognize se
+0001c270: 6c66 2d65 7874 7261 6374 696e 6720 5a49  lf-extracting ZI
+0001c280: 5020 6172 6368 6976 6573 2c20 736f 2066  P archives, so f
+0001c290: 6f72 206e 6f77 2c20 7468 6f73 6520 6172  or now, those ar
+0001c2a0: 6520 7369 6d70 6c79 206e 6f74 2073 7570  e simply not sup
+0001c2b0: 706f 7274 6564 210a 2020 2020 2020 2020  ported!.        
+0001c2c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001c2d0: 6528 6669 6c65 4f72 5061 7468 2c20 7374  e(fileOrPath, st
+0001c2e0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0001c2f0: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
+0001c300: 6c65 4f72 5061 7468 2c20 2772 6227 2920  leOrPath, 'rb') 
+0001c310: 6173 2066 696c 653a 0a20 2020 2020 2020  as file:.       
+0001c320: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c330: 7375 7070 6f72 7465 6443 6f6d 7072 6573  supportedCompres
+0001c340: 7369 6f6e 735b 277a 6970 275d 2e63 6865  sions['zip'].che
+0001c350: 636b 4865 6164 6572 2866 696c 6529 2061  ckHeader(file) a
+0001c360: 6e64 207a 6970 6669 6c65 2e69 735f 7a69  nd zipfile.is_zi
+0001c370: 7066 696c 6528 6669 6c65 4f72 5061 7468  pfile(fileOrPath
+0001c380: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001c390: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001c3a0: 6e20 5a69 704d 6f75 6e74 536f 7572 6365  n ZipMountSource
+0001c3b0: 2866 696c 654f 7250 6174 682c 202a 2a6f  (fileOrPath, **o
+0001c3c0: 7074 696f 6e73 290a 2020 2020 2020 2020  ptions).        
+0001c3d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001c3e0: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
+0001c3f0: 204f 6e65 2070 726f 626c 656d 2068 6572   One problem her
+0001c400: 6520 6973 2077 6865 6e20 7472 7969 6e67  e is when trying
+0001c410: 2074 6f20 7265 6164 2061 6e64 2074 6865   to read and the
+0001c420: 6e20 7365 656b 2062 6163 6b20 6275 7420  n seek back but 
+0001c430: 7468 6572 6520 616c 736f 2069 7320 6e6f  there also is no
+0001c440: 2070 6565 6b20 6d65 7468 6f64 2e0a 2020   peek method..  
+0001c450: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001c460: 2020 2020 2068 7474 7073 3a2f 2f67 6974       https://git
+0001c470: 6875 622e 636f 6d2f 6d61 726b 6f6b 722f  hub.com/markokr/
+0001c480: 7261 7266 696c 652f 6973 7375 6573 2f37  rarfile/issues/7
+0001c490: 330a 2020 2020 2020 2020 2020 2020 2020  3.              
+0001c4a0: 2020 6966 2066 696c 654f 7250 6174 682e    if fileOrPath.
+0001c4b0: 7265 6164 2832 2920 3d3d 2062 2750 4b27  read(2) == b'PK'
+0001c4c0: 2061 6e64 207a 6970 6669 6c65 2e69 735f   and zipfile.is_
+0001c4d0: 7a69 7066 696c 6528 6669 6c65 4f72 5061  zipfile(fileOrPa
+0001c4e0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+0001c4f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001c500: 5a69 704d 6f75 6e74 536f 7572 6365 2866  ZipMountSource(f
+0001c510: 696c 654f 7250 6174 682c 202a 2a6f 7074  ileOrPath, **opt
+0001c520: 696f 6e73 290a 2020 2020 2020 2020 6578  ions).        ex
+0001c530: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0001c540: 7320 6578 6365 7074 696f 6e3a 0a20 2020  s exception:.   
+0001c550: 2020 2020 2020 2020 2069 6620 7072 696e           if prin
+0001c560: 7444 6562 7567 203e 3d20 313a 0a20 2020  tDebug >= 1:.   
+0001c570: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001c580: 6e74 2822 5b49 6e66 6f5d 2043 6865 636b  nt("[Info] Check
+0001c590: 696e 6720 666f 7220 5a49 5020 6669 6c65  ing for ZIP file
+0001c5a0: 2072 6169 7365 6420 616e 2065 7863 6570   raised an excep
+0001c5b0: 7469 6f6e 3a22 2c20 6578 6365 7074 696f  tion:", exceptio
+0001c5c0: 6e29 0a20 2020 2020 2020 2020 2020 2069  n).            i
+0001c5d0: 6620 7072 696e 7444 6562 7567 203e 3d20  f printDebug >= 
+0001c5e0: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
+0001c5f0: 2020 2074 7261 6365 6261 636b 2e70 7269     traceback.pri
+0001c600: 6e74 5f65 7863 2829 0a20 2020 2020 2020  nt_exc().       
+0001c610: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
+0001c620: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0001c630: 2866 696c 654f 7250 6174 682c 2027 7365  (fileOrPath, 'se
+0001c640: 656b 2729 3a0a 2020 2020 2020 2020 2020  ek'):.          
+0001c650: 2020 2020 2020 6669 6c65 4f72 5061 7468        fileOrPath
+0001c660: 2e73 6565 6b28 3029 2020 2320 7479 7065  .seek(0)  # type
+0001c670: 3a20 6967 6e6f 7265 0a0a 2020 2020 7261  : ignore..    ra
+0001c680: 6973 6520 436f 6d70 7265 7373 696f 6e45  ise CompressionE
+0001c690: 7272 6f72 2822 4172 6368 6976 6520 746f  rror("Archive to
+0001c6a0: 206f 7065 6e20 6861 7320 756e 7265 636f   open has unreco
+0001c6b0: 676e 697a 6564 2066 6f72 6d61 7421 2229  gnized format!")
+0001c6c0: 0a0a 0a63 6c61 7373 2055 6e69 6f6e 4d6f  ...class UnionMo
+0001c6d0: 756e 7453 6f75 7263 6528 4d6f 756e 7453  untSource(MountS
+0001c6e0: 6f75 7263 6529 3a0a 2020 2020 6465 6620  ource):.    def 
+0001c6f0: 5f5f 696e 6974 5f5f 2873 656c 662c 206d  __init__(self, m
+0001c700: 6f75 6e74 536f 7572 6365 733a 204c 6973  ountSources: Lis
+0001c710: 745b 4d6f 756e 7453 6f75 7263 655d 2920  t[MountSource]) 
+0001c720: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0001c730: 2073 656c 662e 6d6f 756e 7453 6f75 7263   self.mountSourc
+0001c740: 6573 3a20 4c69 7374 5b4d 6f75 6e74 536f  es: List[MountSo
+0001c750: 7572 6365 5d20 3d20 6d6f 756e 7453 6f75  urce] = mountSou
+0001c760: 7263 6573 0a0a 2020 2020 2020 2020 7365  rces..        se
+0001c770: 6c66 2e66 6f6c 6465 7243 6163 6865 3a20  lf.folderCache: 
+0001c780: 4469 6374 5b73 7472 2c20 4c69 7374 5b4d  Dict[str, List[M
+0001c790: 6f75 6e74 536f 7572 6365 5d5d 203d 207b  ountSource]] = {
+0001c7a0: 222f 223a 2073 656c 662e 6d6f 756e 7453  "/": self.mountS
+0001c7b0: 6f75 7263 6573 7d0a 2020 2020 2020 2020  ources}.        
+0001c7c0: 7365 6c66 2e66 6f6c 6465 7243 6163 6865  self.folderCache
+0001c7d0: 4465 7074 6820 3d20 3020 2023 2064 6570  Depth = 0  # dep
+0001c7e0: 7468 2031 206d 6561 6e73 2c20 7765 206f  th 1 means, we o
+0001c7f0: 6e6c 7920 6361 6368 6564 2074 6f70 2d6c  nly cached top-l
+0001c800: 6576 656c 2064 6972 6563 746f 7269 6573  evel directories
+0001c810: 2e0a 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+0001c820: 726f 6f74 4669 6c65 496e 666f 203d 2046  rootFileInfo = F
+0001c830: 696c 6549 6e66 6f28 0a20 2020 2020 2020  ileInfo(.       
+0001c840: 2020 2020 2023 2066 6d74 3a20 6f66 660a       # fmt: off.
+0001c850: 2020 2020 2020 2020 2020 2020 7369 7a65              size
+0001c860: 2020 2020 203d 2030 2c0a 2020 2020 2020       = 0,.      
+0001c870: 2020 2020 2020 6d74 696d 6520 2020 203d        mtime    =
+0001c880: 2069 6e74 2874 696d 652e 7469 6d65 2829   int(time.time()
+0001c890: 292c 0a20 2020 2020 2020 2020 2020 206d  ),.            m
+0001c8a0: 6f64 6520 2020 2020 3d20 306f 3737 3720  ode     = 0o777 
+0001c8b0: 7c20 7374 6174 2e53 5f49 4644 4952 2c0a  | stat.S_IFDIR,.
+0001c8c0: 2020 2020 2020 2020 2020 2020 6c69 6e6b              link
+0001c8d0: 6e61 6d65 203d 2022 222c 0a20 2020 2020  name = "",.     
+0001c8e0: 2020 2020 2020 2075 6964 2020 2020 2020         uid      
+0001c8f0: 3d20 6f73 2e67 6574 7569 6428 292c 0a20  = os.getuid(),. 
+0001c900: 2020 2020 2020 2020 2020 2067 6964 2020             gid  
+0001c910: 2020 2020 3d20 6f73 2e67 6574 6769 6428      = os.getgid(
+0001c920: 292c 0a20 2020 2020 2020 2020 2020 2075  ),.            u
+0001c930: 7365 7264 6174 6120 3d20 5b4e 6f6e 655d  serdata = [None]
+0001c940: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
+0001c950: 666d 743a 206f 6e0a 2020 2020 2020 2020  fmt: on.        
+0001c960: 290a 0a20 2020 2020 2020 2069 6620 6c65  )..        if le
+0001c970: 6e28 7365 6c66 2e6d 6f75 6e74 536f 7572  n(self.mountSour
+0001c980: 6365 7329 203e 2031 3a0a 2020 2020 2020  ces) > 1:.      
+0001c990: 2020 2020 2020 7365 6c66 2e5f 6275 696c        self._buil
+0001c9a0: 6446 6f6c 6465 7243 6163 6865 2829 0a0a  dFolderCache()..
+0001c9b0: 2020 2020 6465 6620 5f62 7569 6c64 466f      def _buildFo
+0001c9c0: 6c64 6572 4361 6368 6528 7365 6c66 2c20  lderCache(self, 
+0001c9d0: 6d61 7844 6570 7468 3d31 3032 342c 206e  maxDepth=1024, n
+0001c9e0: 4d61 7843 6163 6865 5369 7a65 3d31 3030  MaxCacheSize=100
+0001c9f0: 3030 302c 206e 4d61 7853 6563 6f6e 6473  000, nMaxSeconds
+0001ca00: 546f 4361 6368 653d 3630 293a 0a20 2020  ToCache=60):.   
+0001ca10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001ca20: 206e 4d61 7843 6163 6865 5369 7a65 3a0a   nMaxCacheSize:.
+0001ca30: 2020 2020 2020 2020 2020 2020 4576 656e              Even
+0001ca40: 2061 7373 756d 696e 6720 7665 7279 206c   assuming very l
+0001ca50: 6f6e 6720 6669 6c65 2070 6174 6873 206c  ong file paths l
+0001ca60: 696b 6520 3130 3030 2063 6861 7273 2c20  ike 1000 chars, 
+0001ca70: 7468 6520 6361 6368 6520 7369 7a65 0a20  the cache size. 
+0001ca80: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
+0001ca90: 6265 2062 656c 6f77 2031 3030 204d 4220  be below 100 MB 
+0001caa0: 6966 2074 6865 206d 6178 696d 756d 206e  if the maximum n
+0001cab0: 756d 6265 7220 6f66 2065 6c65 6d65 6e74  umber of element
+0001cac0: 7320 6973 2031 3030 6b2e 0a20 2020 2020  s is 100k..     
+0001cad0: 2020 206e 4d61 7853 6563 6f6e 6473 546f     nMaxSecondsTo
+0001cae0: 4361 6368 653a 0a20 2020 2020 2020 2020  Cache:.         
+0001caf0: 2020 2041 6e6f 7468 6572 2070 726f 626c     Another probl
+0001cb00: 656d 2069 7320 7468 6520 7365 7475 7020  em is the setup 
+0001cb10: 7469 6d65 2c20 6173 2069 7420 6d69 6768  time, as it migh
+0001cb20: 7420 7461 6b65 207e 302e 3030 3173 2066  t take ~0.001s f
+0001cb30: 6f72 2065 6163 6820 6765 7446 696c 6549  or each getFileI
+0001cb40: 6e66 6f20 6361 6c6c 0a20 2020 2020 2020  nfo call.       
+0001cb50: 2020 2020 2061 6e64 2069 7420 7368 6f75       and it shou
+0001cb60: 6c64 6e27 7420 7461 6b65 206d 696e 7574  ldn't take minut
+0001cb70: 6573 2120 4e6f 7465 2074 6861 7420 7468  es! Note that th
+0001cb80: 6572 6520 616c 7761 7973 2063 616e 2062  ere always can b
+0001cb90: 6520 616e 2065 6467 6520 6361 7365 2077  e an edge case w
+0001cba0: 6974 6820 6875 6e64 7265 640a 2020 2020  ith hundred.    
+0001cbb0: 2020 2020 2020 2020 7468 6f75 7361 6e64          thousand
+0001cbc0: 7320 6f66 2066 696c 6573 2069 6e20 6f6e  s of files in on
+0001cbd0: 6520 666f 6c64 6572 2c20 7768 6963 6820  e folder, which 
+0001cbe0: 6361 6e20 7461 6b65 2061 6e20 6172 6269  can take an arbi
+0001cbf0: 7472 6172 7920 616d 6f75 6e74 206f 6620  trary amount of 
+0001cc00: 7469 6d65 2074 6f20 6361 6368 652e 0a20  time to cache.. 
+0001cc10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001cc20: 2020 2074 3020 3d20 7469 6d65 2e74 696d     t0 = time.tim
+0001cc30: 6528 290a 0a20 2020 2020 2020 2069 6620  e()..        if 
+0001cc40: 7072 696e 7444 6562 7567 203e 3d20 313a  printDebug >= 1:
+0001cc50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001cc60: 6e74 2866 2242 7569 6c64 696e 6720 6361  nt(f"Building ca
+0001cc70: 6368 6520 666f 7220 756e 696f 6e20 6d6f  che for union mo
+0001cc80: 756e 7420 2874 696d 656f 7574 2061 6674  unt (timeout aft
+0001cc90: 6572 207b 6e4d 6178 5365 636f 6e64 7354  er {nMaxSecondsT
+0001cca0: 6f43 6163 6865 7d73 292e 2e2e 2229 0a0a  oCache}s)...")..
+0001ccb0: 2020 2020 2020 2020 7365 6c66 2e66 6f6c          self.fol
+0001ccc0: 6465 7243 6163 6865 203d 207b 222f 223a  derCache = {"/":
+0001ccd0: 2073 656c 662e 6d6f 756e 7453 6f75 7263   self.mountSourc
+0001cce0: 6573 7d0a 0a20 2020 2020 2020 206c 6173  es}..        las
+0001ccf0: 7446 6f6c 6465 7243 6163 6865 3a20 4469  tFolderCache: Di
+0001cd00: 6374 5b73 7472 2c20 4c69 7374 5b4d 6f75  ct[str, List[Mou
+0001cd10: 6e74 536f 7572 6365 5d5d 203d 207b 222f  ntSource]] = {"/
+0001cd20: 223a 2073 656c 662e 6d6f 756e 7453 6f75  ": self.mountSou
+0001cd30: 7263 6573 7d0a 0a20 2020 2020 2020 2066  rces}..        f
+0001cd40: 6f72 2064 6570 7468 2069 6e20 7261 6e67  or depth in rang
+0001cd50: 6528 312c 206d 6178 4465 7074 6829 3a0a  e(1, maxDepth):.
+0001cd60: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
+0001cd70: 6973 2069 6e74 6572 6d65 6469 6172 7920  is intermediary 
+0001cd80: 7374 7275 6374 7572 6520 6973 2075 7365  structure is use
+0001cd90: 6420 6265 6361 7573 653a 0a20 2020 2020  d because:.     
+0001cda0: 2020 2020 2020 2023 2020 2031 2e20 5765         #   1. We
+0001cdb0: 206e 6565 6420 746f 206f 6e6c 7920 6974   need to only it
+0001cdc0: 6572 6174 6520 6f76 6572 2074 6865 206e  erate over the n
+0001cdd0: 6577 6c79 2061 6464 6564 2066 6f6c 6465  ewly added folde
+0001cde0: 7273 2069 6e20 7468 6520 6e65 7874 2073  rs in the next s
+0001cdf0: 7465 700a 2020 2020 2020 2020 2020 2020  tep.            
+0001ce00: 2320 2020 322e 2057 6520 616c 7761 7973  #   2. We always
+0001ce10: 2077 616e 7420 746f 2028 6174 6f6d 6963   want to (atomic
+0001ce20: 616c 6c79 2920 6d65 7267 6520 7265 7375  ally) merge resu
+0001ce30: 6c74 7320 666f 7220 6f6e 6520 666f 6c64  lts for one fold
+0001ce40: 6572 2064 6570 7468 2073 6f20 7468 6174  er depth so that
+0001ce50: 2077 6520 6361 6e20 6265 2073 7572 650a   we can be sure.
+0001ce60: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0001ce70: 2020 2074 6861 7420 6966 2061 2066 6f6c     that if a fol
+0001ce80: 6465 7220 6f66 2061 2063 6163 6865 6420  der of a cached 
+0001ce90: 6465 7074 6820 6361 6e20 6e6f 7420 6265  depth can not be
+0001cea0: 2066 6f75 6e64 2069 6e20 7468 6520 6361   found in the ca
+0001ceb0: 6368 6520 7468 6174 2069 7420 646f 6573  che that it does
+0001cec0: 206e 6f74 2065 7869 7374 2061 7420 616c   not exist at al
+0001ced0: 6c2e 0a20 2020 2020 2020 2020 2020 206e  l..            n
+0001cee0: 6577 466f 6c64 6572 4361 6368 653a 2044  ewFolderCache: D
+0001cef0: 6963 745b 7374 722c 204c 6973 745b 4d6f  ict[str, List[Mo
+0001cf00: 756e 7453 6f75 7263 655d 5d20 3d20 7b7d  untSource]] = {}
+0001cf10: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0001cf20: 7220 666f 6c64 6572 2c20 6d6f 756e 7453  r folder, mountS
+0001cf30: 6f75 7263 6573 2069 6e20 6c61 7374 466f  ources in lastFo
+0001cf40: 6c64 6572 4361 6368 652e 6974 656d 7328  lderCache.items(
+0001cf50: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001cf60: 2020 2066 6f72 206d 6f75 6e74 536f 7572     for mountSour
+0001cf70: 6365 2069 6e20 6d6f 756e 7453 6f75 7263  ce in mountSourc
+0001cf80: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+0001cf90: 2020 2020 2020 2020 6669 6c65 7349 6e46          filesInF
+0001cfa0: 6f6c 6465 7220 3d20 6d6f 756e 7453 6f75  older = mountSou
+0001cfb0: 7263 652e 6c69 7374 4469 7228 666f 6c64  rce.listDir(fold
+0001cfc0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0001cfd0: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+0001cfe0: 696c 6573 496e 466f 6c64 6572 3a0a 2020  ilesInFolder:.  
+0001cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d000: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d020: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+0001d030: 6669 6c65 7349 6e46 6f6c 6465 723a 0a20  filesInFolder:. 
+0001d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d050: 2020 2020 2020 2069 6620 7469 6d65 2e74         if time.t
+0001d060: 696d 6528 2920 2d20 7430 203e 206e 4d61  ime() - t0 > nMa
+0001d070: 7853 6563 6f6e 6473 546f 4361 6368 6520  xSecondsToCache 
+0001d080: 6f72 206e 4d61 7843 6163 6865 5369 7a65  or nMaxCacheSize
+0001d090: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
+0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0b0: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2066 756c 6c50 6174 6820 3d20 6f73     fullPath = os
+0001d0e0: 2e70 6174 682e 6a6f 696e 2866 6f6c 6465  .path.join(folde
+0001d0f0: 722c 2066 696c 6529 0a20 2020 2020 2020  r, file).       
+0001d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d110: 2066 696c 6549 6e66 6f20 3d20 6d6f 756e   fileInfo = moun
+0001d120: 7453 6f75 7263 652e 6765 7446 696c 6549  tSource.getFileI
+0001d130: 6e66 6f28 6675 6c6c 5061 7468 290a 2020  nfo(fullPath).  
+0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d150: 2020 2020 2020 6966 206e 6f74 2066 696c        if not fil
+0001d160: 6549 6e66 6f20 6f72 206e 6f74 2073 7461  eInfo or not sta
+0001d170: 742e 535f 4953 4449 5228 6669 6c65 496e  t.S_ISDIR(fileIn
+0001d180: 666f 2e6d 6f64 6529 3a0a 2020 2020 2020  fo.mode):.      
+0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1a0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+0001d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1c0: 2020 2020 2020 2020 6e4d 6178 4361 6368          nMaxCach
+0001d1d0: 6553 697a 6520 2d3d 2031 0a0a 2020 2020  eSize -= 1..    
+0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1f0: 2020 2020 6966 2066 756c 6c50 6174 6820      if fullPath 
+0001d200: 696e 206e 6577 466f 6c64 6572 4361 6368  in newFolderCach
+0001d210: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001d220: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001d230: 6577 466f 6c64 6572 4361 6368 655b 6675  ewFolderCache[fu
+0001d240: 6c6c 5061 7468 5d2e 6170 7065 6e64 286d  llPath].append(m
+0001d250: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d290: 2020 2020 2020 6e65 7746 6f6c 6465 7243        newFolderC
+0001d2a0: 6163 6865 5b66 756c 6c50 6174 685d 203d  ache[fullPath] =
+0001d2b0: 205b 6d6f 756e 7453 6f75 7263 655d 0a0a   [mountSource]..
+0001d2c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001d2d0: 6f74 206e 6577 466f 6c64 6572 4361 6368  ot newFolderCach
+0001d2e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001d2f0: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+0001d300: 2020 2020 2020 7365 6c66 2e66 6f6c 6465        self.folde
+0001d310: 7243 6163 6865 2e75 7064 6174 6528 6e65  rCache.update(ne
+0001d320: 7746 6f6c 6465 7243 6163 6865 290a 2020  wFolderCache).  
+0001d330: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+0001d340: 6f6c 6465 7243 6163 6865 4465 7074 6820  olderCacheDepth 
+0001d350: 3d20 6465 7074 680a 2020 2020 2020 2020  = depth.        
+0001d360: 2020 2020 6c61 7374 466f 6c64 6572 4361      lastFolderCa
+0001d370: 6368 6520 3d20 6e65 7746 6f6c 6465 7243  che = newFolderC
+0001d380: 6163 6865 0a0a 2020 2020 2020 2020 7431  ache..        t1
+0001d390: 203d 2074 696d 652e 7469 6d65 2829 0a0a   = time.time()..
+0001d3a0: 2020 2020 2020 2020 6966 2070 7269 6e74          if print
+0001d3b0: 4465 6275 6720 3e3d 2031 3a0a 2020 2020  Debug >= 1:.    
+0001d3c0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+0001d3d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001d3e0: 2243 6163 6865 6420 6d6f 756e 7420 736f  "Cached mount so
+0001d3f0: 7572 6365 7320 666f 7220 7b6c 656e 2873  urces for {len(s
+0001d400: 656c 662e 666f 6c64 6572 4361 6368 6529  elf.folderCache)
+0001d410: 7d20 666f 6c64 6572 7320 7570 2074 6f20  } folders up to 
+0001d420: 6120 6465 7074 6820 6f66 2022 0a20 2020  a depth of ".   
+0001d430: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
+0001d440: 7365 6c66 2e66 6f6c 6465 7243 6163 6865  self.folderCache
+0001d450: 4465 7074 687d 2069 6e20 7b74 312d 7430  Depth} in {t1-t0
+0001d460: 3a2e 337d 7320 666f 7220 6661 7374 6572  :.3}s for faster
+0001d470: 2075 6e69 6f6e 206d 6f75 6e74 2e22 0a20   union mount.". 
+0001d480: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0001d490: 2020 406f 7665 7272 6964 6573 284d 6f75    @overrides(Mou
+0001d4a0: 6e74 536f 7572 6365 290a 2020 2020 6465  ntSource).    de
+0001d4b0: 6620 6765 7446 696c 6549 6e66 6f28 7365  f getFileInfo(se
+0001d4c0: 6c66 2c20 7061 7468 3a20 7374 722c 2066  lf, path: str, f
+0001d4d0: 696c 6556 6572 7369 6f6e 3a20 696e 7420  ileVersion: int 
+0001d4e0: 3d20 3029 202d 3e20 4f70 7469 6f6e 616c  = 0) -> Optional
+0001d4f0: 5b46 696c 6549 6e66 6f5d 3a0a 2020 2020  [FileInfo]:.    
+0001d500: 2020 2020 6966 2070 6174 6820 3d3d 2027      if path == '
+0001d510: 2f27 3a0a 2020 2020 2020 2020 2020 2020  /':.            
+0001d520: 7265 7475 726e 2073 656c 662e 726f 6f74  return self.root
+0001d530: 4669 6c65 496e 666f 0a0a 2020 2020 2020  FileInfo..      
+0001d540: 2020 6966 2070 6174 6820 696e 2073 656c    if path in sel
+0001d550: 662e 666f 6c64 6572 4361 6368 653a 0a20  f.folderCache:. 
+0001d560: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
+0001d570: 7320 6361 7365 206d 6967 6874 2062 6520  s case might be 
+0001d580: 7472 6967 6765 7265 6420 7768 656e 2070  triggered when p
+0001d590: 6174 6820 6973 2061 2066 6f6c 6465 720a  ath is a folder.
+0001d5a0: 2020 2020 2020 2020 2020 2020 6d6f 756e              moun
+0001d5b0: 7453 6f75 7263 6573 203d 2073 656c 662e  tSources = self.
+0001d5c0: 666f 6c64 6572 4361 6368 655b 7061 7468  folderCache[path
+0001d5d0: 5d0a 2020 2020 2020 2020 656c 6966 2073  ].        elif s
+0001d5e0: 656c 662e 666f 6c64 6572 4361 6368 6520  elf.folderCache 
+0001d5f0: 616e 6420 7365 6c66 2e66 6f6c 6465 7243  and self.folderC
+0001d600: 6163 6865 4465 7074 6820 3e20 3020 616e  acheDepth > 0 an
+0001d610: 6420 7061 7468 2e73 7461 7274 7377 6974  d path.startswit
+0001d620: 6828 272f 2729 3a0a 2020 2020 2020 2020  h('/'):.        
+0001d630: 2020 2020 2320 5468 6973 2073 686f 756c      # This shoul
+0001d640: 6420 6265 2074 6865 206d 6f73 7420 636f  d be the most co
+0001d650: 6d6d 6f6e 2063 6173 652c 2069 2e65 2e2c  mmon case, i.e.,
+0001d660: 2066 6f72 2072 6567 756c 6172 2066 696c   for regular fil
+0001d670: 6573 2e20 4c6f 6f6b 2075 7020 7468 6520  es. Look up the 
+0001d680: 7061 7265 6e74 2066 6f6c 6465 7220 696e  parent folder in
+0001d690: 2074 6869 7320 6361 7365 2e0a 2020 2020   this case..    
+0001d6a0: 2020 2020 2020 2020 7061 7265 6e74 466f          parentFo
+0001d6b0: 6c64 6572 203d 2027 2f27 2e6a 6f69 6e28  lder = '/'.join(
+0001d6c0: 7061 7468 2e73 706c 6974 2827 2f27 2c20  path.split('/', 
+0001d6d0: 7365 6c66 2e66 6f6c 6465 7243 6163 6865  self.folderCache
+0001d6e0: 4465 7074 6820 2b20 3129 5b3a 2d31 5d29  Depth + 1)[:-1])
+0001d6f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001d700: 7061 7265 6e74 466f 6c64 6572 206e 6f74  parentFolder not
+0001d710: 2069 6e20 7365 6c66 2e66 6f6c 6465 7243   in self.folderC
+0001d720: 6163 6865 3a0a 2020 2020 2020 2020 2020  ache:.          
+0001d730: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001d740: 650a 2020 2020 2020 2020 2020 2020 6d6f  e.            mo
+0001d750: 756e 7453 6f75 7263 6573 203d 2073 656c  untSources = sel
+0001d760: 662e 666f 6c64 6572 4361 6368 655b 7061  f.folderCache[pa
+0001d770: 7265 6e74 466f 6c64 6572 5d0a 2020 2020  rentFolder].    
+0001d780: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001d790: 2020 2020 2020 6d6f 756e 7453 6f75 7263        mountSourc
+0001d7a0: 6573 203d 2073 656c 662e 6d6f 756e 7453  es = self.mountS
+0001d7b0: 6f75 7263 6573 0a0a 2020 2020 2020 2020  ources..        
+0001d7c0: 2320 5765 206e 6565 6420 746f 206b 6565  # We need to kee
+0001d7d0: 7020 7468 6520 7369 676e 206f 6620 7468  p the sign of th
+0001d7e0: 6520 6669 6c65 5665 7273 696f 6e20 696e  e fileVersion in
+0001d7f0: 206f 7264 6572 2074 6f20 666f 7277 6172   order to forwar
+0001d800: 6420 6974 2074 6f20 5351 4c69 7465 496e  d it to SQLiteIn
+0001d810: 6465 7865 6454 6172 2e0a 2020 2020 2020  dexedTar..      
+0001d820: 2020 2320 5768 656e 2074 6865 2072 6571    # When the req
+0001d830: 7565 7374 6564 2076 6572 7369 6f6e 2063  uested version c
+0001d840: 616e 2774 2062 6520 666f 756e 6420 696e  an't be found in
+0001d850: 2061 206d 6f75 6e74 2073 6f75 7263 652c   a mount source,
+0001d860: 2069 6e63 7265 6d65 6e74 206e 6567 6174   increment negat
+0001d870: 6976 6520 7370 6563 6966 6965 6420 7665  ive specified ve
+0001d880: 7273 696f 6e73 0a20 2020 2020 2020 2023  rsions.        #
+0001d890: 2062 7920 7468 6520 616d 6f75 6e74 206f   by the amount o
+0001d8a0: 6620 7665 7273 696f 6e73 2069 6e20 7468  f versions in th
+0001d8b0: 6174 206d 6f75 6e74 2073 6f75 7263 6520  at mount source 
+0001d8c0: 6f72 2064 6563 7265 6d65 6e74 2074 6865  or decrement the
+0001d8d0: 2069 6e69 7469 616c 6c79 2070 6f73 6974   initially posit
+0001d8e0: 6976 6520 7665 7273 696f 6e2e 0a20 2020  ive version..   
+0001d8f0: 2020 2020 2069 6620 6669 6c65 5665 7273       if fileVers
+0001d900: 696f 6e20 3c3d 2030 3a0a 2020 2020 2020  ion <= 0:.      
+0001d910: 2020 2020 2020 666f 7220 6d6f 756e 7453        for mountS
+0001d920: 6f75 7263 6520 696e 2072 6576 6572 7365  ource in reverse
+0001d930: 6428 6d6f 756e 7453 6f75 7263 6573 293a  d(mountSources):
+0001d940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d950: 2066 696c 6549 6e66 6f20 3d20 6d6f 756e   fileInfo = moun
+0001d960: 7453 6f75 7263 652e 6765 7446 696c 6549  tSource.getFileI
+0001d970: 6e66 6f28 7061 7468 2c20 6669 6c65 5665  nfo(path, fileVe
+0001d980: 7273 696f 6e3d 6669 6c65 5665 7273 696f  rsion=fileVersio
+0001d990: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+0001d9a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0001d9b0: 2866 696c 6549 6e66 6f2c 2046 696c 6549  (fileInfo, FileI
+0001d9c0: 6e66 6f29 3a0a 2020 2020 2020 2020 2020  nfo):.          
+0001d9d0: 2020 2020 2020 2020 2020 6669 6c65 496e            fileIn
+0001d9e0: 666f 2e75 7365 7264 6174 612e 6170 7065  fo.userdata.appe
+0001d9f0: 6e64 286d 6f75 6e74 536f 7572 6365 290a  nd(mountSource).
+0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da10: 2020 2020 7265 7475 726e 2066 696c 6549      return fileI
+0001da20: 6e66 6f0a 2020 2020 2020 2020 2020 2020  nfo.            
+0001da30: 2020 2020 6669 6c65 5665 7273 696f 6e20      fileVersion 
+0001da40: 2b3d 206d 6f75 6e74 536f 7572 6365 2e66  += mountSource.f
+0001da50: 696c 6556 6572 7369 6f6e 7328 7061 7468  ileVersions(path
+0001da60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001da70: 2020 6966 2066 696c 6556 6572 7369 6f6e    if fileVersion
+0001da80: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0001da90: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0001daa0: 0a20 2020 2020 2020 2065 6c73 653a 2020  .        else:  
+0001dab0: 2320 6669 6c65 5665 7273 696f 6e20 3e3d  # fileVersion >=
+0001dac0: 2031 0a20 2020 2020 2020 2020 2020 2066   1.            f
+0001dad0: 6f72 206d 6f75 6e74 536f 7572 6365 2069  or mountSource i
+0001dae0: 6e20 6d6f 756e 7453 6f75 7263 6573 3a0a  n mountSources:.
+0001daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db00: 6669 6c65 496e 666f 203d 206d 6f75 6e74  fileInfo = mount
+0001db10: 536f 7572 6365 2e67 6574 4669 6c65 496e  Source.getFileIn
+0001db20: 666f 2870 6174 682c 2066 696c 6556 6572  fo(path, fileVer
+0001db30: 7369 6f6e 3d66 696c 6556 6572 7369 6f6e  sion=fileVersion
+0001db40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001db50: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001db60: 6669 6c65 496e 666f 2c20 4669 6c65 496e  fileInfo, FileIn
+0001db70: 666f 293a 0a20 2020 2020 2020 2020 2020  fo):.           
+0001db80: 2020 2020 2020 2020 2066 696c 6549 6e66           fileInf
+0001db90: 6f2e 7573 6572 6461 7461 2e61 7070 656e  o.userdata.appen
+0001dba0: 6428 6d6f 756e 7453 6f75 7263 6529 0a20  d(mountSource). 
+0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbc0: 2020 2072 6574 7572 6e20 6669 6c65 496e     return fileIn
+0001dbd0: 666f 0a20 2020 2020 2020 2020 2020 2020  fo.             
+0001dbe0: 2020 2066 696c 6556 6572 7369 6f6e 202d     fileVersion -
+0001dbf0: 3d20 6d6f 756e 7453 6f75 7263 652e 6669  = mountSource.fi
+0001dc00: 6c65 5665 7273 696f 6e73 2870 6174 6829  leVersions(path)
+0001dc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dc20: 2069 6620 6669 6c65 5665 7273 696f 6e20   if fileVersion 
+0001dc30: 3c20 313a 0a20 2020 2020 2020 2020 2020  < 1:.           
+0001dc40: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+0001dc50: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0001dc60: 6f6e 650a 0a20 2020 2040 6f76 6572 7269  one..    @overri
+0001dc70: 6465 7328 4d6f 756e 7453 6f75 7263 6529  des(MountSource)
+0001dc80: 0a20 2020 2064 6566 2066 696c 6556 6572  .    def fileVer
+0001dc90: 7369 6f6e 7328 7365 6c66 2c20 7061 7468  sions(self, path
+0001dca0: 3a20 7374 7229 202d 3e20 696e 743a 0a20  : str) -> int:. 
+0001dcb0: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+0001dcc0: 6d28 6d6f 756e 7453 6f75 7263 652e 6669  m(mountSource.fi
+0001dcd0: 6c65 5665 7273 696f 6e73 2870 6174 6829  leVersions(path)
+0001dce0: 2066 6f72 206d 6f75 6e74 536f 7572 6365   for mountSource
+0001dcf0: 2069 6e20 7365 6c66 2e6d 6f75 6e74 536f   in self.mountSo
+0001dd00: 7572 6365 7329 0a0a 2020 2020 406f 7665  urces)..    @ove
+0001dd10: 7272 6964 6573 284d 6f75 6e74 536f 7572  rrides(MountSour
+0001dd20: 6365 290a 2020 2020 6465 6620 6c69 7374  ce).    def list
+0001dd30: 4469 7228 7365 6c66 2c20 7061 7468 3a20  Dir(self, path: 
+0001dd40: 7374 7229 202d 3e20 4f70 7469 6f6e 616c  str) -> Optional
+0001dd50: 5b49 7465 7261 626c 655b 7374 725d 5d3a  [Iterable[str]]:
+0001dd60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001dd70: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
+0001dd80: 2073 6574 206f 6620 616c 6c20 666f 6c64   set of all fold
+0001dd90: 6572 2063 6f6e 7465 6e74 7320 6f76 6572  er contents over
+0001dda0: 2061 6c6c 206d 6f75 6e74 2073 6f75 7263   all mount sourc
+0001ddb0: 6573 206f 7220 4e6f 6e65 2069 6620 7468  es or None if th
+0001ddc0: 6520 7061 7468 2077 6173 2066 6f75 6e64  e path was found
+0001ddd0: 2069 6e20 6e6f 6e65 206f 6620 7468 656d   in none of them
+0001dde0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0001ddf0: 2020 2020 2020 2066 696c 6573 3a20 5365         files: Se
+0001de00: 745b 7374 725d 203d 2073 6574 2829 0a20  t[str] = set(). 
+0001de10: 2020 2020 2020 2066 6f6c 6465 7245 7869         folderExi
+0001de20: 7374 7320 3d20 4661 6c73 650a 0a20 2020  sts = False..   
+0001de30: 2020 2020 2066 6f72 206d 6f75 6e74 536f       for mountSo
+0001de40: 7572 6365 2069 6e20 7365 6c66 2e6d 6f75  urce in self.mou
+0001de50: 6e74 536f 7572 6365 733a 0a20 2020 2020  ntSources:.     
+0001de60: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0001de70: 6d6f 756e 7453 6f75 7263 652e 6c69 7374  mountSource.list
+0001de80: 4469 7228 7061 7468 290a 2020 2020 2020  Dir(path).      
+0001de90: 2020 2020 2020 6966 2072 6573 756c 7420        if result 
+0001dea0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001deb0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0001dec0: 6573 203d 2066 696c 6573 2e75 6e69 6f6e  es = files.union
+0001ded0: 2872 6573 756c 7429 0a20 2020 2020 2020  (result).       
+0001dee0: 2020 2020 2020 2020 2066 6f6c 6465 7245           folderE
+0001def0: 7869 7374 7320 3d20 5472 7565 0a0a 2020  xists = True..  
+0001df00: 2020 2020 2020 7265 7475 726e 2066 696c        return fil
+0001df10: 6573 2069 6620 666f 6c64 6572 4578 6973  es if folderExis
+0001df20: 7473 2065 6c73 6520 4e6f 6e65 0a0a 2020  ts else None..  
+0001df30: 2020 406f 7665 7272 6964 6573 284d 6f75    @overrides(Mou
+0001df40: 6e74 536f 7572 6365 290a 2020 2020 6465  ntSource).    de
+0001df50: 6620 6f70 656e 2873 656c 662c 2066 696c  f open(self, fil
+0001df60: 6549 6e66 6f3a 2046 696c 6549 6e66 6f29  eInfo: FileInfo)
+0001df70: 202d 3e20 494f 5b62 7974 6573 5d3a 0a20   -> IO[bytes]:. 
+0001df80: 2020 2020 2020 206d 6f75 6e74 536f 7572         mountSour
+0001df90: 6365 203d 2066 696c 6549 6e66 6f2e 7573  ce = fileInfo.us
+0001dfa0: 6572 6461 7461 2e70 6f70 2829 0a20 2020  erdata.pop().   
+0001dfb0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001dfc0: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+0001dfd0: 6e73 7461 6e63 6528 6d6f 756e 7453 6f75  nstance(mountSou
+0001dfe0: 7263 652c 204d 6f75 6e74 536f 7572 6365  rce, MountSource
+0001dff0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0001e000: 7475 726e 206d 6f75 6e74 536f 7572 6365  turn mountSource
+0001e010: 2e6f 7065 6e28 6669 6c65 496e 666f 290a  .open(fileInfo).
+0001e020: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
+0001e030: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+0001e040: 6549 6e66 6f2e 7573 6572 6461 7461 2e61  eInfo.userdata.a
+0001e050: 7070 656e 6428 6d6f 756e 7453 6f75 7263  ppend(mountSourc
+0001e060: 6529 0a0a 2020 2020 406f 7665 7272 6964  e)..    @overrid
+0001e070: 6573 284d 6f75 6e74 536f 7572 6365 290a  es(MountSource).
+0001e080: 2020 2020 6465 6620 7265 6164 2873 656c      def read(sel
+0001e090: 662c 2066 696c 6549 6e66 6f3a 2046 696c  f, fileInfo: Fil
+0001e0a0: 6549 6e66 6f2c 2073 697a 653a 2069 6e74  eInfo, size: int
+0001e0b0: 2c20 6f66 6673 6574 3a20 696e 7429 202d  , offset: int) -
+0001e0c0: 3e20 6279 7465 733a 0a20 2020 2020 2020  > bytes:.       
+0001e0d0: 206d 6f75 6e74 536f 7572 6365 203d 2066   mountSource = f
+0001e0e0: 696c 6549 6e66 6f2e 7573 6572 6461 7461  ileInfo.userdata
+0001e0f0: 2e70 6f70 2829 0a20 2020 2020 2020 2074  .pop().        t
+0001e100: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001e110: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+0001e120: 6528 6d6f 756e 7453 6f75 7263 652c 204d  e(mountSource, M
+0001e130: 6f75 6e74 536f 7572 6365 290a 2020 2020  ountSource).    
+0001e140: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0001e150: 6f75 6e74 536f 7572 6365 2e72 6561 6428  ountSource.read(
+0001e160: 6669 6c65 496e 666f 2c20 7369 7a65 2c20  fileInfo, size, 
+0001e170: 6f66 6673 6574 290a 2020 2020 2020 2020  offset).        
+0001e180: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+0001e190: 2020 2020 2066 696c 6549 6e66 6f2e 7573       fileInfo.us
+0001e1a0: 6572 6461 7461 2e61 7070 656e 6428 6d6f  erdata.append(mo
+0001e1b0: 756e 7453 6f75 7263 6529 0a0a 2020 2020  untSource)..    
+0001e1c0: 406f 7665 7272 6964 6573 284d 6f75 6e74  @overrides(Mount
+0001e1d0: 536f 7572 6365 290a 2020 2020 6465 6620  Source).    def 
+0001e1e0: 6765 744d 6f75 6e74 536f 7572 6365 2873  getMountSource(s
+0001e1f0: 656c 662c 2066 696c 6549 6e66 6f3a 2046  elf, fileInfo: F
+0001e200: 696c 6549 6e66 6f29 202d 3e20 5475 706c  ileInfo) -> Tupl
+0001e210: 655b 7374 722c 204d 6f75 6e74 536f 7572  e[str, MountSour
+0001e220: 6365 2c20 4669 6c65 496e 666f 5d3a 0a20  ce, FileInfo]:. 
+0001e230: 2020 2020 2020 2073 6f75 7263 6546 696c         sourceFil
+0001e240: 6549 6e66 6f20 3d20 6669 6c65 496e 666f  eInfo = fileInfo
+0001e250: 2e63 6c6f 6e65 2829 0a20 2020 2020 2020  .clone().       
+0001e260: 206d 6f75 6e74 536f 7572 6365 203d 2073   mountSource = s
+0001e270: 6f75 7263 6546 696c 6549 6e66 6f2e 7573  ourceFileInfo.us
+0001e280: 6572 6461 7461 2e70 6f70 2829 0a0a 2020  erdata.pop()..  
+0001e290: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001e2a0: 6e73 7461 6e63 6528 6d6f 756e 7453 6f75  nstance(mountSou
+0001e2b0: 7263 652c 204d 6f75 6e74 536f 7572 6365  rce, MountSource
+0001e2c0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0001e2d0: 6574 7572 6e20 272f 272c 2073 656c 662c  eturn '/', self,
+0001e2e0: 2066 696c 6549 6e66 6f0a 0a20 2020 2020   fileInfo..     
+0001e2f0: 2020 2023 2042 6563 6175 7365 2061 6c6c     # Because all
+0001e300: 206d 6f75 6e74 2073 6f75 7263 6573 2061   mount sources a
+0001e310: 7265 206d 6f75 6e74 6564 2061 7420 272f  re mounted at '/
+0001e320: 272c 2077 6520 646f 206e 6f74 2068 6176  ', we do not hav
+0001e330: 6520 746f 2061 7070 656e 640a 2020 2020  e to append.    
+0001e340: 2020 2020 2320 7468 6520 6d6f 756e 7420      # the mount 
+0001e350: 706f 696e 7420 7061 7468 2072 6574 7572  point path retur
+0001e360: 6e65 6420 6279 2067 6574 4d6f 756e 7453  ned by getMountS
+0001e370: 6f75 7263 6520 746f 2074 6865 206d 6f75  ource to the mou
+0001e380: 6e74 2070 6f69 6e74 2027 2f27 2e0a 2020  nt point '/'..  
+0001e390: 2020 2020 2020 7265 7475 726e 206d 6f75        return mou
+0001e3a0: 6e74 536f 7572 6365 2e67 6574 4d6f 756e  ntSource.getMoun
+0001e3b0: 7453 6f75 7263 6528 736f 7572 6365 4669  tSource(sourceFi
+0001e3c0: 6c65 496e 666f 290a 0a0a 636c 6173 7320  leInfo)...class 
+0001e3d0: 4669 6c65 5665 7273 696f 6e4c 6179 6572  FileVersionLayer
+0001e3e0: 284d 6f75 6e74 536f 7572 6365 293a 0a20  (MountSource):. 
+0001e3f0: 2020 2022 2222 0a20 2020 2054 6869 7320     """.    This 
+0001e400: 6269 6e64 206d 6f75 6e74 206c 696b 6520  bind mount like 
+0001e410: 6c61 7965 7220 6d61 6b65 7320 6974 2070  layer makes it p
+0001e420: 6f73 7369 626c 6520 746f 2061 6363 6573  ossible to acces
+0001e430: 7320 6f6c 6465 7220 6669 6c65 2076 6572  s older file ver
+0001e440: 7369 6f6e 7320 6966 2074 6865 7265 206d  sions if there m
+0001e450: 756c 7469 706c 6520 6f6e 6573 2069 6e20  ultiple ones in 
+0001e460: 7468 6520 6769 7665 6e0a 2020 2020 6d6f  the given.    mo
+0001e470: 756e 7420 736f 7572 6365 2e20 5468 6520  unt source. The 
+0001e480: 696e 7465 7266 6163 6520 7072 6f76 6964  interface provid
+0001e490: 6573 2066 6f72 2065 6163 6820 6669 6c65  es for each file
+0001e4a0: 203c 6669 6c65 2070 6174 683e 2061 2068   <file path> a h
+0001e4b0: 6964 6465 6e20 666f 6c64 6572 203c 6669  idden folder <fi
+0001e4c0: 6c65 2070 6174 682e 7665 7273 696f 6e73  le path.versions
+0001e4d0: 3e20 636f 6e74 6169 6e69 6e67 0a20 2020  > containing.   
+0001e4e0: 2061 6c6c 2061 7661 696c 6162 6c65 2076   all available v
+0001e4f0: 6572 7369 6f6e 732e 0a0a 2020 2020 5468  ersions...    Th
+0001e500: 6973 2063 6c61 7373 2061 6c73 6f20 7265  is class also re
+0001e510: 736f 6c76 6573 2068 6172 646c 696e 6b73  solves hardlinks
+0001e520: 2e20 5468 6973 2066 756e 6374 696f 6e61  . This functiona
+0001e530: 6c69 7479 2069 7320 6d69 7865 6420 696e  lity is mixed in
+0001e540: 2068 6572 6520 6265 6361 7573 6520 7365   here because se
+0001e550: 6c66 2d72 6566 6572 656e 6369 6e67 2068  lf-referencing h
+0001e560: 6172 646c 696e 6b73 0a20 2020 2073 686f  ardlinks.    sho
+0001e570: 756c 6420 6265 2072 6573 6f6c 7665 6420  uld be resolved 
+0001e580: 6279 2073 686f 7769 6e67 206f 6c64 6572  by showing older
+0001e590: 2076 6572 7369 6f6e 7320 6f66 2061 2066   versions of a f
+0001e5a0: 696c 6520 616e 6420 6f6e 6c79 2074 6869  ile and only thi
+0001e5b0: 7320 6c61 7965 7220 6b6e 6f77 7320 6162  s layer knows ab
+0001e5c0: 6f75 7420 6669 6c65 2076 6572 7369 6f6e  out file version
+0001e5d0: 696e 672e 0a0a 2020 2020 544f 444f 2049  ing...    TODO I
+0001e5e0: 6620 7468 6572 6520 616c 7265 6164 7920  f there already 
+0001e5f0: 6578 6973 7473 2061 2066 696c 6520 3c66  exists a file <f
+0001e600: 696c 6520 7061 7468 2e76 6572 7369 6f6e  ile path.version
+0001e610: 733e 2074 6865 6e20 7468 6973 2073 7065  s> then this spe
+0001e620: 6369 616c 2066 6f6c 6465 7220 7769 6c6c  cial folder will
+0001e630: 206e 6f74 2062 6520 6176 6169 6c61 626c   not be availabl
+0001e640: 6521 0a20 2020 2022 2222 0a0a 2020 2020  e!.    """..    
+0001e650: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001e660: 662c 206d 6f75 6e74 536f 7572 6365 3a20  f, mountSource: 
+0001e670: 4d6f 756e 7453 6f75 7263 6529 3a0a 2020  MountSource):.  
+0001e680: 2020 2020 2020 7365 6c66 2e6d 6f75 6e74        self.mount
+0001e690: 536f 7572 6365 3a20 4d6f 756e 7453 6f75  Source: MountSou
+0001e6a0: 7263 6520 3d20 6d6f 756e 7453 6f75 7263  rce = mountSourc
+0001e6b0: 650a 0a20 2020 2064 6566 205f 6465 636f  e..    def _deco
+0001e6c0: 6465 5665 7273 696f 6e73 5061 7468 4150  deVersionsPathAP
+0001e6d0: 4928 7365 6c66 2c20 6669 6c65 5061 7468  I(self, filePath
+0001e6e0: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
+0001e6f0: 616c 5b54 7570 6c65 5b73 7472 2c20 626f  al[Tuple[str, bo
+0001e700: 6f6c 2c20 696e 745d 5d3a 0a20 2020 2020  ol, int]]:.     
+0001e710: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
+0001e720: 6f20 6120 6c6f 6f70 206f 7665 7220 7468  o a loop over th
+0001e730: 6520 7061 7265 6e74 2070 6174 6820 7061  e parent path pa
+0001e740: 7274 7320 746f 2072 6573 6f6c 7665 2070  rts to resolve p
+0001e750: 6f73 7369 626c 6520 7665 7273 696f 6e73  ossible versions
+0001e760: 2069 6e20 7061 7265 6e74 2066 6f6c 6465   in parent folde
+0001e770: 7273 2e0a 2020 2020 2020 2020 4e6f 7465  rs..        Note
+0001e780: 2074 6861 7420 6d75 6c74 6970 6c65 2076   that multiple v
+0001e790: 6572 7369 6f6e 7320 6f66 2061 2066 6f6c  ersions of a fol
+0001e7a0: 6465 7220 616c 7761 7973 2061 7265 2075  der always are u
+0001e7b0: 6e69 6f6e 206d 6f75 6e74 6564 2e20 536f  nion mounted. So
+0001e7c0: 2c20 666f 7220 7468 6520 7061 7468 2074  , for the path t
+0001e7d0: 6f20 6120 6669 6c65 0a20 2020 2020 2020  o a file.       
+0001e7e0: 2069 6e73 6964 6520 7468 6f73 6520 666f   inside those fo
+0001e7f0: 6c64 6572 7320 7468 6520 6578 6163 7420  lders the exact 
+0001e800: 7665 7273 696f 6e20 6f66 2061 2070 6172  version of a par
+0001e810: 656e 7420 666f 6c64 6572 2063 616e 2073  ent folder can s
+0001e820: 696d 706c 7920 6265 2072 656d 6f76 6564  imply be removed
+0001e830: 2066 6f72 206c 6f6f 6b75 702e 0a20 2020   for lookup..   
+0001e840: 2020 2020 2054 6865 7265 666f 7265 2c20       Therefore, 
+0001e850: 7472 616e 736c 6174 6520 736f 6d65 7468  translate someth
+0001e860: 696e 6720 6c69 6b65 3a20 2f66 6f6f 2e76  ing like: /foo.v
+0001e870: 6572 7369 6f6e 2f33 2f62 6172 2e76 6572  ersion/3/bar.ver
+0001e880: 7369 6f6e 2f32 2f6d 696d 692e 7665 7273  sion/2/mimi.vers
+0001e890: 696f 6e2f 3120 696e 746f 0a20 2020 2020  ion/1 into.     
+0001e8a0: 2020 202f 666f 6f2f 6261 722f 6d69 6d69     /foo/bar/mimi
+0001e8b0: 2e76 6572 7369 6f6e 2f31 0a20 2020 2020  .version/1.     
+0001e8c0: 2020 2054 6869 7320 6973 2070 6f73 7369     This is possi
+0001e8d0: 626c 7920 7469 6d65 2d63 6f73 746c 7920  bly time-costly 
+0001e8e0: 6275 7420 7265 7175 6573 7469 6e67 2061  but requesting a
+0001e8f0: 2064 6966 6665 7265 6e74 2076 6572 7369   different versi
+0001e900: 6f6e 2066 726f 6d20 7468 6520 6d6f 7374  on from the most
+0001e910: 2072 6563 656e 7420 7368 6f75 6c64 0a20   recent should. 
+0001e920: 2020 2020 2020 2062 6520 6120 7261 7265         be a rare
+0001e930: 206f 6363 7572 656e 6365 2061 6e64 2046   occurence and F
+0001e940: 5553 4520 616c 736f 2063 6865 636b 7320  USE also checks 
+0001e950: 616c 6c20 7061 7265 6e74 2070 6172 7473  all parent parts
+0001e960: 2062 6566 6f72 6520 6163 6365 7373 696e   before accessin
+0001e970: 6720 6120 6669 6c65 2073 6f20 6974 0a20  g a file so it. 
+0001e980: 2020 2020 2020 206d 6967 6874 206f 6e6c         might onl
+0001e990: 7920 736c 6f77 2064 6f77 6e20 6163 6365  y slow down acce
+0001e9a0: 7373 2062 7920 726f 7567 686c 7920 6661  ss by roughly fa
+0001e9b0: 6374 6f72 2032 2e0a 2020 2020 2020 2020  ctor 2..        
+0001e9c0: 2222 220a 0a20 2020 2020 2020 2023 2054  """..        # T
+0001e9d0: 4f44 4f20 6d61 6b65 2069 7420 776f 726b  ODO make it work
+0001e9e0: 2066 6f72 2066 696c 6573 2065 6e64 696e   for files endin
+0001e9f0: 6720 7769 7468 2027 2e76 6572 7369 6f6e  g with '.version
+0001ea00: 7327 2e0a 2020 2020 2020 2020 2320 4375  s'..        # Cu
+0001ea10: 7272 656e 746c 792c 2074 6869 7320 6665  rrently, this fe
+0001ea20: 6174 7572 6520 776f 756c 6420 6265 2068  ature would be h
+0001ea30: 6964 6465 6e20 6279 2074 686f 7365 2066  idden by those f
+0001ea40: 696c 6573 2e20 4275 742c 2049 2074 6869  iles. But, I thi
+0001ea50: 6e6b 2074 6869 7320 7368 6f75 6c64 2062  nk this should b
+0001ea60: 6520 7175 6974 6520 7261 7265 2e0a 2020  e quite rare..  
+0001ea70: 2020 2020 2020 2320 4920 636f 756c 6420        # I could 
+0001ea80: 616c 6c6f 7720 6172 6269 7472 6172 7920  allow arbitrary 
+0001ea90: 616d 6f75 6e74 7320 6f66 2064 6f74 7320  amounts of dots 
+0001eaa0: 6c69 6b65 2027 2e2e 2e2e 7665 7273 696f  like '....versio
+0001eab0: 6e73 2720 6275 7420 7468 656e 2069 7420  ns' but then it 
+0001eac0: 776f 756c 646e 2774 2062 6520 6469 7363  wouldn't be disc
+0001ead0: 6572 6e69 626c 650a 2020 2020 2020 2020  ernible.        
+0001eae0: 2320 666f 7220 2e2e 2e76 6572 7369 6f6e  # for ...version
+0001eaf0: 7320 7768 6574 6865 7220 7468 6520 7665  s whether the ve
+0001eb00: 7273 696f 6e73 206f 6620 2e2e 7665 7273  rsions of ..vers
+0001eb10: 696f 6e73 206f 7220 2e76 6572 7369 6f6e  ions or .version
+0001eb20: 7320 6669 6c65 2077 6173 2072 6571 7565  s file was reque
+0001eb30: 7374 6564 2e20 4920 636f 756c 6420 6164  sted. I could ad
+0001eb40: 640a 2020 2020 2020 2020 2320 6120 7275  d.        # a ru
+0001eb50: 6c65 2066 6f72 2074 6865 2064 6563 6973  le for the decis
+0001eb60: 696f 6e2c 206c 696b 6520 2e2e 2e76 6572  ion, like ...ver
+0001eb70: 7369 6f6e 7320 7368 6f77 7320 7468 6520  sions shows the 
+0001eb80: 7665 7273 696f 6e73 206f 6620 2e76 6572  versions of .ver
+0001eb90: 7369 6f6e 7320 616e 6420 2e2e 2e2e 7665  sions and ....ve
+0001eba0: 7273 696f 6e73 2066 6f72 0a20 2020 2020  rsions for.     
+0001ebb0: 2020 2023 202e 2e76 6572 7369 6f6e 732c     # ..versions,
+0001ebc0: 2068 6f77 6576 6572 2c20 616c 6c20 6f66   however, all of
+0001ebd0: 2074 6869 7320 6d69 6768 7420 7265 7175   this might requ
+0001ebe0: 6972 6520 616e 2061 7766 756c 206c 6f74  ire an awful lot
+0001ebf0: 206f 6620 6669 6c65 2065 7869 7374 656e   of file existen
+0001ec00: 6365 2063 6865 636b 696e 672e 0a20 2020  ce checking..   
+0001ec10: 2020 2020 2023 204d 7920 6669 7273 7420       # My first 
+0001ec20: 6964 6561 2077 6173 2074 6f20 7573 6520  idea was to use 
+0001ec30: 6869 6464 656e 2073 7562 666f 6c64 6572  hidden subfolder
+0001ec40: 7320 666f 7220 6561 6368 2066 696c 6520  s for each file 
+0001ec50: 6c69 6b65 2070 6174 682f 746f 2f66 696c  like path/to/fil
+0001ec60: 652f 2e76 6572 7369 6f6e 732f 3120 6275  e/.versions/1 bu
+0001ec70: 7420 4655 5345 0a20 2020 2020 2020 2023  t FUSE.        #
+0001ec80: 2063 6865 636b 7320 7468 6520 7061 7265   checks the pare
+0001ec90: 6e74 7320 696e 2061 2070 6174 6820 7468  nts in a path th
+0001eca0: 6174 2074 6865 7920 6172 6520 6469 7265  at they are dire
+0001ecb0: 6374 6f72 6965 7320 6669 7273 742c 2073  ctories first, s
+0001ecc0: 6f20 6765 7461 7474 7220 6f72 2072 6561  o getattr or rea
+0001ecd0: 6464 6972 2069 7320 6e6f 7420 6576 656e  ddir is not even
+0001ece0: 0a20 2020 2020 2020 2023 2063 616c 6c65  .        # calle
+0001ecf0: 6420 666f 7220 7061 7468 2f74 6f2f 6669  d for path/to/fi
+0001ed00: 6c65 2f2e 7665 7273 696f 6e73 2069 6620  le/.versions if 
+0001ed10: 7061 7468 2f74 6f2f 6669 6c65 2069 7320  path/to/file is 
+0001ed20: 6e6f 7420 6120 6469 7265 6374 6f72 792e  not a directory.
+0001ed30: 0a20 2020 2020 2020 2023 2041 6e6f 7468  .        # Anoth
+0001ed40: 6572 2061 6c74 6572 6e61 7469 7665 206d  er alternative m
+0001ed50: 6967 6874 2062 6520 6f6e 6520 6869 6464  ight be one hidd
+0001ed60: 656e 2066 6f6c 6465 7220 6174 2074 6865  en folder at the
+0001ed70: 2072 6f6f 7420 666f 7220 6120 7061 7261   root for a para
+0001ed80: 6c6c 656c 2066 696c 6520 7472 6565 2c20  llel file tree, 
+0001ed90: 6c69 6b65 0a20 2020 2020 2020 2023 202f  like.        # /
+0001eda0: 2e76 6572 7369 6f6e 732f 7061 7468 2f74  .versions/path/t
+0001edb0: 6f2f 6669 6c65 2f33 2062 7574 2074 6861  o/file/3 but tha
+0001edc0: 7420 7275 6e73 2069 6e74 6f20 7369 6d69  t runs into simi
+0001edd0: 6c61 7220 7072 6f62 6c65 6d73 2077 6865  lar problems whe
+0001ede0: 6e20 7472 7969 6e67 2074 6f20 7370 6563  n trying to spec
+0001edf0: 6966 7920 7468 6520 6669 6c65 0a20 2020  ify the file.   
+0001ee00: 2020 2020 2023 2076 6572 7369 6f6e 206f       # version o
+0001ee10: 7220 6966 2061 202e 7665 7273 696f 6e73  r if a .versions
+0001ee20: 2072 6f6f 7420 6469 7265 6374 6f72 7920   root directory 
+0001ee30: 6578 6973 7473 2e0a 0a20 2020 2020 2020  exists...       
+0001ee40: 2066 696c 6550 6174 6850 6172 7473 203d   filePathParts =
+0001ee50: 2066 696c 6550 6174 682e 6c73 7472 6970   filePath.lstrip
+0001ee60: 2827 2f27 292e 7370 6c69 7428 272f 2729  ('/').split('/')
+0001ee70: 0a20 2020 2020 2020 2066 696c 6550 6174  .        filePat
+0001ee80: 6820 3d20 2727 0a20 2020 2020 2020 2070  h = ''.        p
+0001ee90: 6174 6849 7353 7065 6369 616c 5665 7273  athIsSpecialVers
+0001eea0: 696f 6e73 466f 6c64 6572 203d 2046 616c  ionsFolder = Fal
+0001eeb0: 7365 0a20 2020 2020 2020 2066 696c 6556  se.        fileV
+0001eec0: 6572 7369 6f6e 203d 204e 6f6e 6520 2023  ersion = None  #
+0001eed0: 204e 6f74 2076 616c 6964 2069 6620 4e6f   Not valid if No
+0001eee0: 6e65 206f 7220 7061 7265 6e74 4973 5665  ne or parentIsVe
+0001eef0: 7273 696f 6e73 2069 7320 5472 7565 0a20  rsions is True. 
+0001ef00: 2020 2020 2020 2066 6f72 2070 6172 7420         for part 
+0001ef10: 696e 2066 696c 6550 6174 6850 6172 7473  in filePathParts
+0001ef20: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001ef30: 536b 6970 206f 7665 7220 7468 6520 6578  Skip over the ex
+0001ef40: 6163 7420 7665 7273 696f 6e20 7370 6563  act version spec
+0001ef50: 6966 6965 640a 2020 2020 2020 2020 2020  ified.          
+0001ef60: 2020 6966 2070 6174 6849 7353 7065 6369    if pathIsSpeci
+0001ef70: 616c 5665 7273 696f 6e73 466f 6c64 6572  alVersionsFolder
+0001ef80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ef90: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001efa0: 2020 2020 2020 2020 2020 2066 696c 6556             fileV
+0001efb0: 6572 7369 6f6e 203d 2069 6e74 2870 6172  ersion = int(par
+0001efc0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0001efd0: 2020 2020 2020 2061 7373 6572 7420 7374         assert st
+0001efe0: 7228 6669 6c65 5665 7273 696f 6e29 203d  r(fileVersion) =
+0001eff0: 3d20 7061 7274 0a20 2020 2020 2020 2020  = part.         
+0001f000: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0001f010: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+0001f020: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001f030: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0001f040: 2020 2020 2020 2020 2070 6174 6849 7353           pathIsS
+0001f050: 7065 6369 616c 5665 7273 696f 6e73 466f  pecialVersionsFo
+0001f060: 6c64 6572 203d 2046 616c 7365 0a20 2020  lder = False.   
+0001f070: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001f080: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+0001f090: 2020 2023 2053 696d 706c 7920 6170 7065     # Simply appe
+0001f0a0: 6e64 206e 6f72 6d61 6c20 6578 6973 7469  nd normal existi
+0001f0b0: 6e67 2066 6f6c 6465 7273 0a20 2020 2020  ng folders.     
+0001f0c0: 2020 2020 2020 2074 6d70 4669 6c65 5061         tmpFilePa
+0001f0d0: 7468 203d 2027 2f27 2e6a 6f69 6e28 5b66  th = '/'.join([f
+0001f0e0: 696c 6550 6174 682c 2070 6172 745d 290a  ilePath, part]).
+0001f0f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001f100: 656c 662e 6d6f 756e 7453 6f75 7263 652e  elf.mountSource.
+0001f110: 6765 7446 696c 6549 6e66 6f28 746d 7046  getFileInfo(tmpF
+0001f120: 696c 6550 6174 6829 3a0a 2020 2020 2020  ilePath):.      
+0001f130: 2020 2020 2020 2020 2020 6669 6c65 5061            filePa
+0001f140: 7468 203d 2074 6d70 4669 6c65 5061 7468  th = tmpFilePath
+0001f150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f160: 2066 696c 6556 6572 7369 6f6e 203d 2030   fileVersion = 0
+0001f170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f180: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+0001f190: 2020 2020 2020 2023 2049 6620 6375 7272         # If curr
+0001f1a0: 656e 7420 7061 7468 2064 6f65 7320 6e6f  ent path does no
+0001f1b0: 7420 6578 6973 742c 2063 6865 636b 2069  t exist, check i
+0001f1c0: 6620 6974 2069 7320 6120 7370 6563 6961  f it is a specia
+0001f1d0: 6c20 7665 7273 696f 6e73 2070 6174 680a  l versions path.
+0001f1e0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0001f1f0: 6172 742e 656e 6473 7769 7468 2827 2e76  art.endswith('.v
+0001f200: 6572 7369 6f6e 7327 2920 616e 6420 6c65  ersions') and le
+0001f210: 6e28 7061 7274 2920 3e20 6c65 6e28 272e  n(part) > len('.
+0001f220: 7665 7273 696f 6e73 2729 3a0a 2020 2020  versions'):.    
+0001f230: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0001f240: 4973 5370 6563 6961 6c56 6572 7369 6f6e  IsSpecialVersion
+0001f250: 7346 6f6c 6465 7220 3d20 5472 7565 0a20  sFolder = True. 
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f270: 696c 6556 6572 7369 6f6e 203d 2030 0a20  ileVersion = 0. 
+0001f280: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f290: 696c 6550 6174 6820 3d20 746d 7046 696c  ilePath = tmpFil
+0001f2a0: 6550 6174 685b 3a20 2d6c 656e 2827 2e76  ePath[: -len('.v
+0001f2b0: 6572 7369 6f6e 7327 295d 0a20 2020 2020  ersions')].     
+0001f2c0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001f2d0: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
+0001f2e0: 2023 2050 6172 656e 7420 7061 7468 2064   # Parent path d
+0001f2f0: 6f65 7320 6e6f 7420 6578 6973 7420 616e  oes not exist an
+0001f300: 6420 6973 206e 6f74 2061 2076 6572 7369  d is not a versi
+0001f310: 6f6e 7320 7061 7468 2c20 736f 2061 6e79  ons path, so any
+0001f320: 2073 7562 7061 7468 7320 616c 736f 2077   subpaths also w
+0001f330: 6f6e 2774 2065 7869 7374 2065 6974 6865  on't exist eithe
+0001f340: 720a 2020 2020 2020 2020 2020 2020 7265  r.            re
+0001f350: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
+0001f360: 2020 2069 6620 6669 6c65 5665 7273 696f     if fileVersio
+0001f370: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+0001f380: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0001f390: 6570 7469 6f6e 2822 4e6f 2066 696c 6520  eption("No file 
+0001f3a0: 7665 7273 696f 6e20 666f 756e 6420 696e  version found in
+0001f3b0: 2073 7065 6369 616c 2076 6572 7369 6f6e   special version
+0001f3c0: 696e 6720 7061 7468 2073 7065 6369 6669  ing path specifi
+0001f3d0: 6361 7469 6f6e 2122 290a 0a20 2020 2020  cation!")..     
+0001f3e0: 2020 2072 6574 7572 6e20 6669 6c65 5061     return filePa
+0001f3f0: 7468 2c20 7061 7468 4973 5370 6563 6961  th, pathIsSpecia
+0001f400: 6c56 6572 7369 6f6e 7346 6f6c 6465 722c  lVersionsFolder,
+0001f410: 2028 3020 6966 2070 6174 6849 7353 7065   (0 if pathIsSpe
+0001f420: 6369 616c 5665 7273 696f 6e73 466f 6c64  cialVersionsFold
+0001f430: 6572 2065 6c73 6520 6669 6c65 5665 7273  er else fileVers
+0001f440: 696f 6e29 0a0a 2020 2020 4073 7461 7469  ion)..    @stati
+0001f450: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+0001f460: 5f69 7348 6172 644c 696e 6b28 6669 6c65  _isHardLink(file
+0001f470: 496e 666f 3a20 4669 6c65 496e 666f 2920  Info: FileInfo) 
+0001f480: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+0001f490: 2023 204e 6f74 6520 7468 6174 2053 5f49   # Note that S_I
+0001f4a0: 534c 4e4b 2063 6865 636b 7320 666f 7220  SLNK checks for 
+0001f4b0: 7379 6d62 6f6c 6963 206c 696e 6b73 2e20  symbolic links. 
+0001f4c0: 4861 7264 6c69 6e6b 7320 2861 7420 6c65  Hardlinks (at le
+0001f4d0: 6173 7420 6672 6f6d 2074 6172 6669 6c65  ast from tarfile
+0001f4e0: 290a 2020 2020 2020 2020 2320 7265 7475  ).        # retu
+0001f4f0: 726e 2066 616c 7365 2066 6f72 2053 5f49  rn false for S_I
+0001f500: 534c 4e4b 2062 7574 2073 7469 6c6c 2068  SLNK but still h
+0001f510: 6176 6520 6120 6c69 6e6b 6e61 6d65 210a  ave a linkname!.
+0001f520: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+0001f530: 6f6f 6c28 6e6f 7420 7374 6174 2e53 5f49  ool(not stat.S_I
+0001f540: 5352 4547 2866 696c 6549 6e66 6f2e 6d6f  SREG(fileInfo.mo
+0001f550: 6465 2920 616e 6420 6e6f 7420 7374 6174  de) and not stat
+0001f560: 2e53 5f49 534c 4e4b 2866 696c 6549 6e66  .S_ISLNK(fileInf
+0001f570: 6f2e 6d6f 6465 2920 616e 6420 6669 6c65  o.mode) and file
+0001f580: 496e 666f 2e6c 696e 6b6e 616d 6529 0a0a  Info.linkname)..
+0001f590: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+0001f5a0: 640a 2020 2020 6465 6620 5f72 6573 6f6c  d.    def _resol
+0001f5b0: 7665 4861 7264 4c69 6e6b 7328 6d6f 756e  veHardLinks(moun
+0001f5c0: 7453 6f75 7263 653a 204d 6f75 6e74 536f  tSource: MountSo
+0001f5d0: 7572 6365 2c20 7061 7468 3a20 7374 7229  urce, path: str)
+0001f5e0: 202d 3e20 4f70 7469 6f6e 616c 5b46 696c   -> Optional[Fil
+0001f5f0: 6549 6e66 6f5d 3a0a 2020 2020 2020 2020  eInfo]:.        
+0001f600: 2222 2270 6174 6820 3a20 5369 6d70 6c65  """path : Simple
+0001f610: 2070 6174 682e 2053 686f 756c 6420 636f   path. Should co
+0001f620: 6e74 6169 6e20 6e6f 2073 7065 6369 616c  ntain no special
+0001f630: 2076 6572 7369 6f6e 696e 6720 666f 6c64   versioning fold
+0001f640: 6572 7321 2222 220a 0a20 2020 2020 2020  ers!"""..       
+0001f650: 2066 696c 6549 6e66 6f20 3d20 6d6f 756e   fileInfo = moun
+0001f660: 7453 6f75 7263 652e 6765 7446 696c 6549  tSource.getFileI
+0001f670: 6e66 6f28 7061 7468 290a 2020 2020 2020  nfo(path).      
+0001f680: 2020 6966 206e 6f74 2066 696c 6549 6e66    if not fileInf
+0001f690: 6f3a 0a20 2020 2020 2020 2020 2020 2072  o:.            r
+0001f6a0: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
+0001f6b0: 2020 2020 7265 736f 6c76 6564 5061 7468      resolvedPath
+0001f6c0: 203d 2027 2f27 202b 2066 696c 6549 6e66   = '/' + fileInf
+0001f6d0: 6f2e 6c69 6e6b 6e61 6d65 2e6c 7374 7269  o.linkname.lstri
+0001f6e0: 7028 272f 2729 2069 6620 4669 6c65 5665  p('/') if FileVe
+0001f6f0: 7273 696f 6e4c 6179 6572 2e5f 6973 4861  rsionLayer._isHa
+0001f700: 7264 4c69 6e6b 2866 696c 6549 6e66 6f29  rdLink(fileInfo)
+0001f710: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+0001f720: 2020 2066 696c 6556 6572 7369 6f6e 203d     fileVersion =
+0001f730: 2030 0a20 2020 2020 2020 2068 6172 644c   0.        hardL
+0001f740: 696e 6b43 6f75 6e74 203d 2030 0a0a 2020  inkCount = 0..  
+0001f750: 2020 2020 2020 7768 696c 6520 7265 736f        while reso
+0001f760: 6c76 6564 5061 7468 2061 6e64 2068 6172  lvedPath and har
+0001f770: 644c 696e 6b43 6f75 6e74 203c 2031 3238  dLinkCount < 128
+0001f780: 3a20 2023 2046 6f72 2063 6f6d 7061 7269  :  # For compari
+0001f790: 736f 6e2c 2074 6865 206d 6178 696d 756d  son, the maximum
+0001f7a0: 2073 796d 626f 6c69 6320 6c69 6e6b 2063   symbolic link c
+0001f7b0: 6861 696e 2069 6e20 4c69 6e75 7820 6973  hain in Linux is
+0001f7c0: 2034 302e 0a20 2020 2020 2020 2020 2020   40..           
+0001f7d0: 2023 204c 696e 6b20 7461 7267 6574 7320   # Link targets 
+0001f7e0: 6172 6520 7265 6c61 7469 7665 2074 6f20  are relative to 
+0001f7f0: 7468 6520 6d6f 756e 7420 736f 7572 6365  the mount source
+0001f800: 2e20 5468 6174 2773 2077 6879 2077 6520  . That's why we 
+0001f810: 6e65 6564 2074 6865 206d 6f75 6e74 2070  need the mount p
+0001f820: 6f69 6e74 2074 6f20 6765 7420 7468 6520  oint to get the 
+0001f830: 6675 6c6c 2070 6174 680a 2020 2020 2020  full path.      
+0001f840: 2020 2020 2020 2320 696e 2072 6573 7065        # in respe
+0001f850: 6374 2074 6f20 7468 6973 206d 6f75 6e74  ct to this mount
+0001f860: 2073 6f75 7263 652e 2041 6e64 2077 6520   source. And we 
+0001f870: 6d75 7374 2061 2066 696c 6520 696e 666f  must a file info
+0001f880: 206f 626a 6563 7420 666f 7220 7468 6973   object for this
+0001f890: 206d 6f75 6e74 2073 6f75 7263 652c 2073   mount source, s
+0001f8a0: 6f20 7765 2068 6176 6520 746f 0a20 2020  o we have to.   
+0001f8b0: 2020 2020 2020 2020 2023 2067 6574 2074           # get t
+0001f8c0: 6861 7420 7573 696e 6720 7468 6520 6675  hat using the fu
+0001f8d0: 6c6c 2070 6174 6820 696e 7374 6561 6420  ll path instead 
+0001f8e0: 6f66 2063 616c 6c69 6e67 2067 6574 4669  of calling getFi
+0001f8f0: 6c65 496e 666f 206f 6e20 7468 6520 6465  leInfo on the de
+0001f900: 6570 6573 7420 6d6f 756e 7420 736f 7572  epest mount sour
+0001f910: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+0001f920: 6d6f 756e 7450 6f69 6e74 2c20 5f2c 205f  mountPoint, _, _
+0001f930: 203d 206d 6f75 6e74 536f 7572 6365 2e67   = mountSource.g
+0001f940: 6574 4d6f 756e 7453 6f75 7263 6528 6669  etMountSource(fi
+0001f950: 6c65 496e 666f 290a 0a20 2020 2020 2020  leInfo)..       
+0001f960: 2020 2020 2072 6573 6f6c 7665 6450 6174       resolvedPat
+0001f970: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+0001f980: 286d 6f75 6e74 506f 696e 742c 2072 6573  (mountPoint, res
+0001f990: 6f6c 7665 6450 6174 682e 6c73 7472 6970  olvedPath.lstrip
+0001f9a0: 2827 2f27 2929 0a0a 2020 2020 2020 2020  ('/'))..        
+0001f9b0: 2020 2020 6966 2072 6573 6f6c 7665 6450      if resolvedP
+0001f9c0: 6174 6820 213d 2070 6174 683a 0a20 2020  ath != path:.   
+0001f9d0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+0001f9e0: 6865 2066 696c 6520 7665 7273 696f 6e20  he file version 
+0001f9f0: 6973 206f 6e6c 7920 6f66 2069 6d70 6f72  is only of impor
+0001fa00: 7461 6e63 6520 746f 2072 6573 6f6c 7665  tance to resolve
+0001fa10: 2073 656c 662d 7265 6665 7265 6e63 6573   self-references
+0001fa20: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001fa30: 2020 2320 4974 2073 6565 6d73 2075 6e64    # It seems und
+0001fa40: 6563 6964 6162 6c65 2074 6f20 6d65 2077  ecidable to me w
+0001fa50: 6865 7468 6572 2074 6f20 7265 7475 726e  hether to return
+0001fa60: 2074 6865 2067 6976 656e 2066 696c 6556   the given fileV
+0001fa70: 6572 7369 6f6e 206f 7220 3020 6865 7265  ersion or 0 here
+0001fa80: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001fa90: 2020 2320 5265 7475 726e 696e 6720 3020    # Returning 0 
+0001faa0: 776f 756c 6420 6665 656c 206d 6f72 6520  would feel more 
+0001fab0: 636f 7272 6563 7420 6265 6361 7573 6520  correct because 
+0001fac0: 7468 6520 7765 2073 7769 7463 6865 6420  the we switched 
+0001fad0: 746f 2061 6e6f 7468 6572 2066 696c 6520  to another file 
+0001fae0: 616e 6420 7468 6520 7665 7273 696f 6e0a  and the version.
+0001faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb00: 2320 666f 7220 7468 6174 2066 696c 6520  # for that file 
+0001fb10: 6973 2074 6865 206d 6f73 7420 7265 6365  is the most rece
+0001fb20: 6e74 206f 6e65 2e0a 2020 2020 2020 2020  nt one..        
+0001fb30: 2020 2020 2020 2020 2320 486f 7765 7665          # Howeve
+0001fb40: 722c 2072 6573 6574 7469 6e67 2074 6865  r, resetting the
+0001fb50: 2066 696c 6520 7665 7273 696f 6e20 746f   file version to
+0001fb60: 2030 206d 6561 6e73 2074 6861 7420 6966   0 means that if
+0001fb70: 2074 6865 7265 2069 7320 6120 6379 636c   there is a cycl
+0001fb80: 652c 2069 2e65 2e2c 2074 776f 2068 6172  e, i.e., two har
+0001fb90: 646c 696e 6b73 0a20 2020 2020 2020 2020  dlinks.         
+0001fba0: 2020 2020 2020 2023 206f 6620 6469 6666         # of diff
+0001fbb0: 6572 656e 7420 6e61 6d65 7320 7265 6665  erent names refe
+0001fbc0: 7265 6e63 696e 6720 6561 6368 206f 7468  rencing each oth
+0001fbd0: 6572 2c20 7468 616e 2074 6865 2066 696c  er, than the fil
+0001fbe0: 6520 7665 7273 696f 6e20 7769 6c6c 2061  e version will a
+0001fbf0: 6c77 6179 7320 6265 2072 6573 6574 2074  lways be reset t
+0001fc00: 6f20 300a 2020 2020 2020 2020 2020 2020  o 0.            
+0001fc10: 2020 2020 2320 616e 6420 7765 2068 6176      # and we hav
+0001fc20: 6520 6e6f 2062 7265 616b 2063 6f6e 6469  e no break condi
+0001fc30: 7469 6f6e 2c20 656e 7465 7269 6e67 2061  tion, entering a
+0001fc40: 6e20 696e 6669 6e69 7465 206c 6f6f 702e  n infinite loop.
+0001fc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fc60: 2023 2054 6865 206d 6f73 7420 636f 7272   # The most corr
+0001fc70: 6563 7420 7665 7273 696f 6e20 776f 756c  ect version woul
+0001fc80: 6420 6265 2074 6f20 7472 6163 6b20 7468  d be to track th
+0001fc90: 6520 7665 7273 696f 6e20 6f66 2065 6163  e version of eac
+0001fca0: 6820 7061 7468 2069 6e20 6120 6d61 7020  h path in a map 
+0001fcb0: 616e 6420 636f 756e 7420 7570 2074 6865  and count up the
+0001fcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fcd0: 2023 2076 6572 7369 6f6e 2070 6572 2070   # version per p
+0001fce0: 6174 682e 0a20 2020 2020 2020 2020 2020  ath..           
+0001fcf0: 2020 2020 2023 2054 4f44 4f20 4973 2073       # TODO Is s
+0001fd00: 7563 6820 6120 6861 7264 6c69 6e6b 2063  uch a hardlink c
+0001fd10: 7963 6c65 2065 7665 6e20 706f 7373 6962  ycle even possib
+0001fd20: 6c65 3f21 0a20 2020 2020 2020 2020 2020  le?!.           
+0001fd30: 2020 2020 2066 696c 6556 6572 7369 6f6e       fileVersion
+0001fd40: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+0001fd50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001fd60: 2020 2020 2020 2023 2049 6620 6669 6c65         # If file
+0001fd70: 2069 7320 7265 6665 7265 6e63 696e 6720   is referencing 
+0001fd80: 6974 7365 6c66 2c20 7472 7920 746f 2061  itself, try to a
+0001fd90: 6363 6573 7320 6561 726c 6965 7220 7665  ccess earlier ve
+0001fda0: 7273 696f 6e20 6f66 2069 742e 0a20 2020  rsion of it..   
+0001fdb0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+0001fdc0: 6865 2063 6865 636b 2066 6f72 2066 696c  he check for fil
+0001fdd0: 6556 6572 7369 6f6e 2061 6761 696e 7374  eVersion against
+0001fde0: 2074 6865 2074 6f74 616c 206e 756d 6265   the total numbe
+0001fdf0: 7220 6f66 2061 7661 696c 6162 6c65 2066  r of available f
+0001fe00: 696c 6520 7665 7273 696f 6e73 2069 7320  ile versions is 
+0001fe10: 6f6d 6974 7465 6420 6265 6361 7573 650a  omitted because.
+0001fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe30: 2320 7468 6174 2063 6865 636b 2069 7320  # that check is 
+0001fe40: 646f 6e65 2069 6d70 6c69 6369 746c 7920  done implicitly 
+0001fe50: 696e 7369 6465 2074 6865 206d 6f75 6e74  inside the mount
+0001fe60: 2073 6f75 7263 6573 2067 6574 4669 6c65   sources getFile
+0001fe70: 496e 666f 206d 6574 686f 6421 0a20 2020  Info method!.   
+0001fe80: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0001fe90: 6556 6572 7369 6f6e 203d 2066 696c 6556  eVersion = fileV
+0001fea0: 6572 7369 6f6e 202b 2031 2069 6620 6669  ersion + 1 if fi
+0001feb0: 6c65 5665 7273 696f 6e20 3e3d 2030 2065  leVersion >= 0 e
+0001fec0: 6c73 6520 6669 6c65 5665 7273 696f 6e20  lse fileVersion 
+0001fed0: 2d20 310a 0a20 2020 2020 2020 2020 2020  - 1..           
+0001fee0: 2070 6174 6820 3d20 7265 736f 6c76 6564   path = resolved
+0001fef0: 5061 7468 0a20 2020 2020 2020 2020 2020  Path.           
+0001ff00: 2066 696c 6549 6e66 6f20 3d20 6d6f 756e   fileInfo = moun
+0001ff10: 7453 6f75 7263 652e 6765 7446 696c 6549  tSource.getFileI
+0001ff20: 6e66 6f28 7061 7468 2c20 6669 6c65 5665  nfo(path, fileVe
+0001ff30: 7273 696f 6e29 0a20 2020 2020 2020 2020  rsion).         
+0001ff40: 2020 2069 6620 6e6f 7420 6669 6c65 496e     if not fileIn
+0001ff50: 666f 3a0a 2020 2020 2020 2020 2020 2020  fo:.            
+0001ff60: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0001ff70: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0001ff80: 6f6c 7665 6450 6174 6820 3d20 272f 2720  olvedPath = '/' 
+0001ff90: 2b20 6669 6c65 496e 666f 2e6c 696e 6b6e  + fileInfo.linkn
+0001ffa0: 616d 652e 6c73 7472 6970 2827 2f27 2920  ame.lstrip('/') 
+0001ffb0: 6966 2046 696c 6556 6572 7369 6f6e 4c61  if FileVersionLa
+0001ffc0: 7965 722e 5f69 7348 6172 644c 696e 6b28  yer._isHardLink(
+0001ffd0: 6669 6c65 496e 666f 2920 656c 7365 204e  fileInfo) else N
+0001ffe0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001fff0: 6861 7264 4c69 6e6b 436f 756e 7420 2b3d  hardLinkCount +=
+00020000: 2031 0a0a 2020 2020 2020 2020 7265 7475   1..        retu
+00020010: 726e 2066 696c 6549 6e66 6f0a 0a20 2020  rn fileInfo..   
+00020020: 2040 6f76 6572 7269 6465 7328 4d6f 756e   @overrides(Moun
+00020030: 7453 6f75 7263 6529 0a20 2020 2064 6566  tSource).    def
+00020040: 206c 6973 7444 6972 2873 656c 662c 2070   listDir(self, p
+00020050: 6174 683a 2073 7472 2920 2d3e 204f 7074  ath: str) -> Opt
+00020060: 696f 6e61 6c5b 4974 6572 6162 6c65 5b73  ional[Iterable[s
+00020070: 7472 5d5d 3a0a 2020 2020 2020 2020 6669  tr]]:.        fi
+00020080: 6c65 7320 3d20 7365 6c66 2e6d 6f75 6e74  les = self.mount
+00020090: 536f 7572 6365 2e6c 6973 7444 6972 2870  Source.listDir(p
+000200a0: 6174 6829 0a20 2020 2020 2020 2069 6620  ath).        if 
+000200b0: 6669 6c65 7320 6973 206e 6f74 204e 6f6e  files is not Non
+000200c0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000200d0: 6574 7572 6e20 6669 6c65 730a 0a20 2020  eturn files..   
+000200e0: 2020 2020 2023 2049 6620 6e6f 2066 6f6c       # If no fol
+000200f0: 6465 7220 7761 7320 666f 756e 642c 2063  der was found, c
+00020100: 6865 636b 2077 6865 7468 6572 2074 6865  heck whether the
+00020110: 2073 7065 6369 616c 202e 7665 7273 696f   special .versio
+00020120: 6e73 2066 6f6c 6465 7220 7761 7320 7265  ns folder was re
+00020130: 7175 6573 7465 640a 2020 2020 2020 2020  quested.        
+00020140: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00020150: 2072 6573 756c 7420 3d20 7365 6c66 2e5f   result = self._
+00020160: 6465 636f 6465 5665 7273 696f 6e73 5061  decodeVersionsPa
+00020170: 7468 4150 4928 7061 7468 290a 2020 2020  thAPI(path).    
+00020180: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00020190: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+000201a0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+000201b0: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
+000201c0: 7375 6c74 3a0a 2020 2020 2020 2020 2020  sult:.          
+000201d0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+000201e0: 2020 2020 2020 7061 7468 2c20 7061 7468        path, path
+000201f0: 4973 5370 6563 6961 6c56 6572 7369 6f6e  IsSpecialVersion
+00020200: 7346 6f6c 6465 722c 205f 203d 2072 6573  sFolder, _ = res
+00020210: 756c 740a 0a20 2020 2020 2020 2069 6620  ult..        if 
+00020220: 6e6f 7420 7061 7468 4973 5370 6563 6961  not pathIsSpecia
+00020230: 6c56 6572 7369 6f6e 7346 6f6c 6465 723a  lVersionsFolder:
+00020240: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00020250: 7572 6e20 7365 6c66 2e6d 6f75 6e74 536f  urn self.mountSo
+00020260: 7572 6365 2e6c 6973 7444 6972 2870 6174  urce.listDir(pat
+00020270: 6829 0a0a 2020 2020 2020 2020 2320 5072  h)..        # Pr
+00020280: 696e 7420 616c 6c20 6176 6169 6c61 626c  int all availabl
+00020290: 6520 7665 7273 696f 6e73 206f 6620 7468  e versions of th
+000202a0: 6520 6669 6c65 2061 7420 6669 6c65 5061  e file at filePa
+000202b0: 7468 2061 7320 7468 6520 636f 6e74 656e  th as the conten
+000202c0: 7473 206f 6620 7468 6520 7370 6563 6961  ts of the specia
+000202d0: 6c20 272e 7665 7273 696f 6e73 2720 666f  l '.versions' fo
+000202e0: 6c64 6572 0a20 2020 2020 2020 2072 6574  lder.        ret
+000202f0: 7572 6e20 5b73 7472 2876 6572 7369 6f6e  urn [str(version
+00020300: 202b 2031 2920 666f 7220 7665 7273 696f   + 1) for versio
+00020310: 6e20 696e 2072 616e 6765 2873 656c 662e  n in range(self.
+00020320: 6d6f 756e 7453 6f75 7263 652e 6669 6c65  mountSource.file
+00020330: 5665 7273 696f 6e73 2870 6174 6829 295d  Versions(path))]
+00020340: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
+00020350: 284d 6f75 6e74 536f 7572 6365 290a 2020  (MountSource).  
+00020360: 2020 6465 6620 6765 7446 696c 6549 6e66    def getFileInf
+00020370: 6f28 7365 6c66 2c20 7061 7468 3a20 7374  o(self, path: st
+00020380: 722c 2066 696c 6556 6572 7369 6f6e 3a20  r, fileVersion: 
+00020390: 696e 7420 3d20 3029 202d 3e20 4f70 7469  int = 0) -> Opti
+000203a0: 6f6e 616c 5b46 696c 6549 6e66 6f5d 3a0a  onal[FileInfo]:.
+000203b0: 2020 2020 2020 2020 2222 2252 6573 6f6c          """Resol
+000203c0: 7665 7320 7370 6563 6961 6c20 6669 6c65  ves special file
+000203d0: 2076 6572 7369 6f6e 2073 7065 6369 6669   version specifi
+000203e0: 6361 7469 6f6e 7320 696e 2074 6865 2070  cations in the p
+000203f0: 6174 682e 2222 220a 0a20 2020 2020 2020  ath."""..       
+00020400: 2061 7373 6572 7420 6669 6c65 5665 7273   assert fileVers
+00020410: 696f 6e20 3d3d 2030 0a0a 2020 2020 2020  ion == 0..      
+00020420: 2020 6669 6c65 496e 666f 203d 2046 696c    fileInfo = Fil
+00020430: 6556 6572 7369 6f6e 4c61 7965 722e 5f72  eVersionLayer._r
+00020440: 6573 6f6c 7665 4861 7264 4c69 6e6b 7328  esolveHardLinks(
+00020450: 7365 6c66 2e6d 6f75 6e74 536f 7572 6365  self.mountSource
+00020460: 2c20 7061 7468 290a 2020 2020 2020 2020  , path).        
+00020470: 6966 2066 696c 6549 6e66 6f3a 0a20 2020  if fileInfo:.   
+00020480: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00020490: 6669 6c65 496e 666f 0a0a 2020 2020 2020  fileInfo..      
+000204a0: 2020 2320 4966 206e 6f20 6669 6c65 2077    # If no file w
+000204b0: 6173 2066 6f75 6e64 2c20 6368 6563 6b20  as found, check 
+000204c0: 6966 2061 2073 7065 6369 616c 202e 7665  if a special .ve
+000204d0: 7273 696f 6e73 2066 6f6c 6465 7220 746f  rsions folder to
+000204e0: 2061 6e20 6578 6973 7469 6e67 2066 696c   an existing fil
+000204f0: 652f 666f 6c64 6572 2077 6173 2071 7565  e/folder was que
+00020500: 7269 6564 2e0a 2020 2020 2020 2020 7665  ried..        ve
+00020510: 7273 696f 6e73 496e 666f 203d 2073 656c  rsionsInfo = sel
+00020520: 662e 5f64 6563 6f64 6556 6572 7369 6f6e  f._decodeVersion
+00020530: 7350 6174 6841 5049 2870 6174 6829 0a20  sPathAPI(path). 
+00020540: 2020 2020 2020 2069 6620 6e6f 7420 7665         if not ve
+00020550: 7273 696f 6e73 496e 666f 3a0a 2020 2020  rsionsInfo:.    
+00020560: 2020 2020 2020 2020 7261 6973 6520 6675          raise fu
+00020570: 7365 2e46 7573 654f 5345 7272 6f72 2866  se.FuseOSError(f
+00020580: 7573 652e 6572 726e 6f2e 454e 4f45 4e54  use.errno.ENOENT
+00020590: 290a 2020 2020 2020 2020 7061 7468 2c20  ).        path, 
+000205a0: 7061 7468 4973 5370 6563 6961 6c56 6572  pathIsSpecialVer
+000205b0: 7369 6f6e 7346 6f6c 6465 722c 2066 696c  sionsFolder, fil
+000205c0: 6556 6572 7369 6f6e 203d 2076 6572 7369  eVersion = versi
+000205d0: 6f6e 7349 6e66 6f0a 0a20 2020 2020 2020  onsInfo..       
+000205e0: 2023 2032 2e29 2043 6865 636b 2069 6620   # 2.) Check if 
+000205f0: 7468 6520 7265 7175 6573 7420 7761 7320  the request was 
+00020600: 666f 7220 7468 6520 7370 6563 6961 6c20  for the special 
+00020610: 2e76 6572 7369 6f6e 7320 666f 6c64 6572  .versions folder
+00020620: 2061 6e64 2072 6574 7572 6e20 6974 7320   and return its 
+00020630: 636f 6e74 656e 7473 206f 7220 7374 6174  contents or stat
+00020640: 730a 2020 2020 2020 2020 2320 4174 2074  s.        # At t
+00020650: 6869 7320 706f 696e 742c 2070 6174 6820  his point, path 
+00020660: 6973 2061 7373 7572 6564 2074 6f20 6163  is assured to ac
+00020670: 7475 616c 6c79 2065 7869 7374 210a 2020  tually exist!.  
+00020680: 2020 2020 2020 6966 2070 6174 6849 7353        if pathIsS
+00020690: 7065 6369 616c 5665 7273 696f 6e73 466f  pecialVersionsFo
+000206a0: 6c64 6572 3a0a 2020 2020 2020 2020 2020  lder:.          
+000206b0: 2020 7061 7265 6e74 4669 6c65 496e 666f    parentFileInfo
+000206c0: 203d 2073 656c 662e 6d6f 756e 7453 6f75   = self.mountSou
+000206d0: 7263 652e 6765 7446 696c 6549 6e66 6f28  rce.getFileInfo(
+000206e0: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+000206f0: 2020 6173 7365 7274 2070 6172 656e 7446    assert parentF
+00020700: 696c 6549 6e66 6f0a 0a20 2020 2020 2020  ileInfo..       
+00020710: 2020 2020 2066 696c 6549 6e66 6f20 3d20       fileInfo = 
+00020720: 4669 6c65 496e 666f 280a 2020 2020 2020  FileInfo(.      
+00020730: 2020 2020 2020 2020 2020 2320 666d 743a            # fmt:
+00020740: 206f 6666 0a20 2020 2020 2020 2020 2020   off.           
+00020750: 2020 2020 2073 697a 6520 2020 2020 3d20       size     = 
+00020760: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+00020770: 2020 206d 7469 6d65 2020 2020 3d20 7061     mtime    = pa
+00020780: 7265 6e74 4669 6c65 496e 666f 2e6d 7469  rentFileInfo.mti
+00020790: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000207a0: 2020 2020 6d6f 6465 2020 2020 203d 2030      mode     = 0
+000207b0: 6f37 3737 207c 2073 7461 742e 535f 4946  o777 | stat.S_IF
+000207c0: 4449 522c 0a20 2020 2020 2020 2020 2020  DIR,.           
+000207d0: 2020 2020 206c 696e 6b6e 616d 6520 3d20       linkname = 
+000207e0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+000207f0: 2020 2020 7569 6420 2020 2020 203d 2070      uid      = p
+00020800: 6172 656e 7446 696c 6549 6e66 6f2e 7569  arentFileInfo.ui
+00020810: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00020820: 2020 2067 6964 2020 2020 2020 3d20 7061     gid      = pa
+00020830: 7265 6e74 4669 6c65 496e 666f 2e67 6964  rentFileInfo.gid
+00020840: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020850: 2020 2320 4920 7468 696e 6b20 7468 6973    # I think this
+00020860: 2064 6f65 7320 6e6f 7420 6d61 7474 6572   does not matter
+00020870: 2062 6563 6175 7365 2063 7572 7265 6e74   because current
+00020880: 6c79 2075 7365 7264 6174 6120 6973 206f  ly userdata is o
+00020890: 6e6c 7920 7573 6564 2069 6e20 7265 6164  nly used in read
+000208a0: 2063 616c 6c73 2c0a 2020 2020 2020 2020   calls,.        
+000208b0: 2020 2020 2020 2020 2320 7768 6963 6820          # which 
+000208c0: 7368 6f75 6c64 206f 6e6c 7920 6265 2067  should only be g
+000208d0: 6976 656e 206e 6f6e 2d64 6972 6563 746f  iven non-directo
+000208e0: 7279 2066 696c 6573 2061 6e64 2074 6869  ry files and thi
+000208f0: 7320 6973 2061 2064 6972 6563 746f 7279  s is a directory
+00020900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020910: 2075 7365 7264 6174 6120 3d20 5b5d 2c0a   userdata = [],.
+00020920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020930: 2320 666d 743a 206f 6e0a 2020 2020 2020  # fmt: on.      
+00020940: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00020950: 2020 2020 2072 6574 7572 6e20 6669 6c65       return file
+00020960: 496e 666f 0a0a 2020 2020 2020 2020 2320  Info..        # 
+00020970: 332e 2920 4174 2074 6869 7320 706f 696e  3.) At this poin
+00020980: 7420 7468 6520 7265 7175 6573 7420 6973  t the request is
+00020990: 2066 6f72 2061 6e20 6163 7475 616c 6c79   for an actually
+000209a0: 206f 6c64 6572 2076 6572 7369 6f6e 206f   older version o
+000209b0: 6620 6120 6669 6c65 206f 7220 666f 6c64  f a file or fold
+000209c0: 6572 0a20 2020 2020 2020 2066 696c 6549  er.        fileI
+000209d0: 6e66 6f20 3d20 7365 6c66 2e6d 6f75 6e74  nfo = self.mount
+000209e0: 536f 7572 6365 2e67 6574 4669 6c65 496e  Source.getFileIn
+000209f0: 666f 2870 6174 682c 2066 696c 6556 6572  fo(path, fileVer
+00020a00: 7369 6f6e 3d66 696c 6556 6572 7369 6f6e  sion=fileVersion
+00020a10: 290a 2020 2020 2020 2020 6966 2066 696c  ).        if fil
+00020a20: 6549 6e66 6f3a 0a20 2020 2020 2020 2020  eInfo:.         
+00020a30: 2020 2072 6574 7572 6e20 6669 6c65 496e     return fileIn
+00020a40: 666f 0a0a 2020 2020 2020 2020 7261 6973  fo..        rais
+00020a50: 6520 6675 7365 2e46 7573 654f 5345 7272  e fuse.FuseOSErr
+00020a60: 6f72 2866 7573 652e 6572 726e 6f2e 454e  or(fuse.errno.EN
+00020a70: 4f45 4e54 290a 0a20 2020 2040 6f76 6572  OENT)..    @over
+00020a80: 7269 6465 7328 4d6f 756e 7453 6f75 7263  rides(MountSourc
+00020a90: 6529 0a20 2020 2064 6566 2066 696c 6556  e).    def fileV
+00020aa0: 6572 7369 6f6e 7328 7365 6c66 2c20 7061  ersions(self, pa
+00020ab0: 7468 3a20 7374 7229 202d 3e20 696e 743a  th: str) -> int:
+00020ac0: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+00020ad0: 7265 7475 726e 2031 2066 6f72 2073 7065  return 1 for spe
+00020ae0: 6369 616c 202e 7665 7273 696f 6e73 2066  cial .versions f
+00020af0: 6f6c 6465 7273 2061 6e64 2066 696c 6573  olders and files
+00020b00: 2063 6f6e 7461 696e 6564 2069 6e20 7468   contained in th
+00020b10: 6572 653f 0a20 2020 2020 2020 2072 6574  ere?.        ret
+00020b20: 7572 6e20 7365 6c66 2e6d 6f75 6e74 536f  urn self.mountSo
+00020b30: 7572 6365 2e66 696c 6556 6572 7369 6f6e  urce.fileVersion
+00020b40: 7328 7061 7468 290a 0a20 2020 2040 6f76  s(path)..    @ov
+00020b50: 6572 7269 6465 7328 4d6f 756e 7453 6f75  errides(MountSou
+00020b60: 7263 6529 0a20 2020 2064 6566 206f 7065  rce).    def ope
+00020b70: 6e28 7365 6c66 2c20 6669 6c65 496e 666f  n(self, fileInfo
+00020b80: 3a20 4669 6c65 496e 666f 2920 2d3e 2049  : FileInfo) -> I
+00020b90: 4f5b 6279 7465 735d 3a0a 2020 2020 2020  O[bytes]:.      
+00020ba0: 2020 7265 7475 726e 2073 656c 662e 6d6f    return self.mo
+00020bb0: 756e 7453 6f75 7263 652e 6f70 656e 2866  untSource.open(f
+00020bc0: 696c 6549 6e66 6f29 0a0a 2020 2020 406f  ileInfo)..    @o
+00020bd0: 7665 7272 6964 6573 284d 6f75 6e74 536f  verrides(MountSo
+00020be0: 7572 6365 290a 2020 2020 6465 6620 7265  urce).    def re
+00020bf0: 6164 2873 656c 662c 2066 696c 6549 6e66  ad(self, fileInf
+00020c00: 6f3a 2046 696c 6549 6e66 6f2c 2073 697a  o: FileInfo, siz
+00020c10: 653a 2069 6e74 2c20 6f66 6673 6574 3a20  e: int, offset: 
+00020c20: 696e 7429 202d 3e20 6279 7465 733a 0a20  int) -> bytes:. 
+00020c30: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00020c40: 6c66 2e6d 6f75 6e74 536f 7572 6365 2e72  lf.mountSource.r
+00020c50: 6561 6428 6669 6c65 496e 666f 2c20 7369  ead(fileInfo, si
+00020c60: 7a65 2c20 6f66 6673 6574 290a 0a20 2020  ze, offset)..   
+00020c70: 2040 6f76 6572 7269 6465 7328 4d6f 756e   @overrides(Moun
+00020c80: 7453 6f75 7263 6529 0a20 2020 2064 6566  tSource).    def
+00020c90: 2067 6574 4d6f 756e 7453 6f75 7263 6528   getMountSource(
+00020ca0: 7365 6c66 2c20 6669 6c65 496e 666f 3a20  self, fileInfo: 
+00020cb0: 4669 6c65 496e 666f 2920 2d3e 2054 7570  FileInfo) -> Tup
+00020cc0: 6c65 5b73 7472 2c20 4d6f 756e 7453 6f75  le[str, MountSou
+00020cd0: 7263 652c 2046 696c 6549 6e66 6f5d 3a0a  rce, FileInfo]:.
+00020ce0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00020cf0: 656c 662e 6d6f 756e 7453 6f75 7263 652e  elf.mountSource.
+00020d00: 6765 744d 6f75 6e74 536f 7572 6365 2866  getMountSource(f
+00020d10: 696c 6549 6e66 6f29 0a0a 0a63 6c61 7373  ileInfo)...class
+00020d20: 2046 7573 654d 6f75 6e74 2846 7573 654f   FuseMount(FuseO
+00020d30: 7065 7261 7469 6f6e 7329 3a20 2023 2074  perations):  # t
+00020d40: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
+00020d50: 2222 220a 2020 2020 5468 6973 2063 6c61  """.    This cla
+00020d60: 7373 2069 6d70 6c65 6d65 6e74 7320 7468  ss implements th
+00020d70: 6520 6675 7365 7079 2069 6e74 6572 6661  e fusepy interfa
+00020d80: 6365 2069 6e20 6f72 6465 7220 746f 2063  ce in order to c
+00020d90: 7265 6174 6520 6120 6d6f 756e 7465 6420  reate a mounted 
+00020da0: 6669 6c65 2073 7973 7465 6d20 7669 6577  file system view
+00020db0: 2074 6f20 6120 4d6f 756e 7453 6f75 7263   to a MountSourc
+00020dc0: 652e 0a20 2020 2054 6173 6b73 206f 6620  e..    Tasks of 
+00020dd0: 7468 6973 2063 6c61 7373 2069 7473 656c  this class itsel
+00020de0: 663a 0a20 2020 2020 2020 2d20 4368 616e  f:.       - Chan
+00020df0: 6765 7320 616c 6c20 6669 6c65 2070 6572  ges all file per
+00020e00: 6d69 7373 696f 6e73 2074 6f20 7265 6164  missions to read
+00020e10: 2d6f 6e6c 790a 2020 2020 2020 202d 2047  -only.       - G
+00020e20: 6574 2061 6374 7561 6c20 6669 6c65 2063  et actual file c
+00020e30: 6f6e 7465 6e74 7320 6569 7468 6572 2062  ontents either b
+00020e40: 7920 6469 7265 6374 6c79 2072 6561 6469  y directly readi
+00020e50: 6e67 2066 726f 6d20 7468 6520 5441 5220  ng from the TAR 
+00020e60: 6f72 2062 7920 7573 696e 6720 5374 656e  or by using Sten
+00020e70: 6369 6c65 6446 696c 6520 616e 6420 7461  ciledFile and ta
+00020e80: 7266 696c 650a 2020 2020 2020 202d 2045  rfile.       - E
+00020e90: 6e61 626c 696e 6720 466f 6c64 6572 4d6f  nabling FolderMo
+00020ea0: 756e 7453 6f75 7263 6520 746f 2062 696e  untSource to bin
+00020eb0: 6420 746f 2074 6865 206e 6f6e 656d 7074  d to the nonempt
+00020ec0: 7920 666f 6c64 6572 2075 6e64 6572 2074  y folder under t
+00020ed0: 6865 206d 6f75 6e74 706f 696e 7420 6974  he mountpoint it
+00020ee0: 7365 6c66 2e0a 2020 2020 4f74 6865 7220  self..    Other 
+00020ef0: 6675 6e63 7469 6f6e 616c 6974 6965 7320  functionalities 
+00020f00: 6c69 6b65 2066 696c 6520 7665 7273 696f  like file versio
+00020f10: 6e69 6e67 2c20 6861 7264 206c 696e 6b20  ning, hard link 
+00020f20: 7265 736f 6c76 696e 672c 2061 6e64 2075  resolving, and u
+00020f30: 6e69 6f6e 206d 6f75 6e74 696e 6720 6172  nion mounting ar
+00020f40: 6520 696d 706c 656d 656e 7465 6420 6279  e implemented by
+00020f50: 2075 7369 6e67 0a20 2020 2074 6865 2072   using.    the r
+00020f60: 6573 7065 6374 6976 6520 4d6f 756e 7453  espective MountS
+00020f70: 6f75 7263 6520 6465 7269 7665 6420 636c  ource derived cl
+00020f80: 6173 7365 732e 0a0a 2020 2020 446f 6375  asses...    Docu
+00020f90: 6d65 6e74 6174 696f 6e20 666f 7220 4655  mentation for FU
+00020fa0: 5345 206d 6574 686f 6473 2063 616e 2062  SE methods can b
+00020fb0: 6520 666f 756e 6420 696e 2074 6865 2066  e found in the f
+00020fc0: 7573 6570 7920 6f72 206c 6962 6675 7365  usepy or libfuse
+00020fd0: 2068 6561 6465 7273 2e20 5468 6572 6520   headers. There 
+00020fe0: 7365 656d 7320 746f 2062 6520 6e6f 2063  seems to be no c
+00020ff0: 6f6d 706c 6574 650a 2020 2020 7265 6e64  omplete.    rend
+00021000: 6572 6564 2064 6f63 756d 656e 7461 7469  ered documentati
+00021010: 6f6e 2061 7369 6465 2066 726f 6d20 7468  on aside from th
+00021020: 6520 6865 6164 6572 2063 6f6d 6d65 6e74  e header comment
+00021030: 732e 0a0a 2020 2020 6874 7470 733a 2f2f  s...    https://
+00021040: 6769 7468 7562 2e63 6f6d 2f66 7573 6570  github.com/fusep
+00021050: 792f 6675 7365 7079 2f62 6c6f 622f 6d61  y/fusepy/blob/ma
+00021060: 7374 6572 2f66 7573 652e 7079 0a20 2020  ster/fuse.py.   
+00021070: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+00021080: 636f 6d2f 6c69 6266 7573 652f 6c69 6266  com/libfuse/libf
+00021090: 7573 652f 626c 6f62 2f6d 6173 7465 722f  use/blob/master/
+000210a0: 696e 636c 7564 652f 6675 7365 2e68 0a20  include/fuse.h. 
+000210b0: 2020 2068 7474 7073 3a2f 2f6d 616e 372e     https://man7.
+000210c0: 6f72 672f 6c69 6e75 782f 6d61 6e2d 7061  org/linux/man-pa
+000210d0: 6765 732f 6d61 6e33 2f65 7272 6e6f 2e33  ges/man3/errno.3
+000210e0: 2e68 746d 6c0a 0a20 2020 2041 6c6c 2070  .html..    All p
+000210f0: 6174 6820 6172 6775 6d65 6e74 7320 666f  ath arguments fo
+00021100: 7220 6f76 6572 7269 6465 6e20 6675 7365  r overriden fuse
+00021110: 7079 206d 6574 686f 6473 2064 6f20 6861  py methods do ha
+00021120: 7665 2061 206c 6561 6469 6e67 2073 6c61  ve a leading sla
+00021130: 7368 2028 272f 2729 210a 2020 2020 5468  sh ('/')!.    Th
+00021140: 6973 2069 7320 7768 7920 4d6f 756e 7453  is is why MountS
+00021150: 6f75 7263 6520 616c 736f 2073 686f 756c  ource also shoul
+00021160: 6420 6578 7065 6374 206c 6561 6469 6e67  d expect leading
+00021170: 2073 6c61 7368 6573 2069 6e20 616c 6c20   slashes in all 
+00021180: 7061 7468 732e 0a20 2020 2022 2222 0a0a  paths..    """..
+00021190: 2020 2020 5f5f 736c 6f74 735f 5f20 3d20      __slots__ = 
+000211a0: 280a 2020 2020 2020 2020 276d 6f75 6e74  (.        'mount
+000211b0: 536f 7572 6365 272c 0a20 2020 2020 2020  Source',.       
+000211c0: 2027 726f 6f74 4669 6c65 496e 666f 272c   'rootFileInfo',
+000211d0: 0a20 2020 2020 2020 2027 6d6f 756e 7450  .        'mountP
+000211e0: 6f69 6e74 272c 0a20 2020 2020 2020 2027  oint',.        '
+000211f0: 6d6f 756e 7450 6f69 6e74 4664 272c 0a20  mountPointFd',. 
+00021200: 2020 2020 2020 2027 6d6f 756e 7450 6f69         'mountPoi
+00021210: 6e74 5761 7343 7265 6174 6564 272c 0a20  ntWasCreated',. 
+00021220: 2020 2020 2020 2027 7365 6c66 4269 6e64         'selfBind
+00021230: 4d6f 756e 7427 2c0a 2020 2020 2020 2020  Mount',.        
+00021240: 276f 7065 6e65 6446 696c 6573 272c 0a20  'openedFiles',. 
+00021250: 2020 2020 2020 2027 6c61 7374 4669 6c65         'lastFile
+00021260: 4861 6e64 6c65 272c 0a20 2020 2029 0a0a  Handle',.    )..
+00021270: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00021280: 2873 656c 662c 2070 6174 6854 6f4d 6f75  (self, pathToMou
+00021290: 6e74 3a20 556e 696f 6e5b 7374 722c 204c  nt: Union[str, L
+000212a0: 6973 745b 7374 725d 5d2c 206d 6f75 6e74  ist[str]], mount
+000212b0: 506f 696e 743a 2073 7472 2c20 2a2a 6f70  Point: str, **op
+000212c0: 7469 6f6e 7329 202d 3e20 4e6f 6e65 3a0a  tions) -> None:.
+000212d0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+000212e0: 7369 6e73 7461 6e63 6528 7061 7468 546f  sinstance(pathTo
+000212f0: 4d6f 756e 742c 206c 6973 7429 3a0a 2020  Mount, list):.  
+00021300: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00021310: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00021320: 732e 6673 7061 7468 2870 6174 6854 6f4d  s.fspath(pathToM
+00021330: 6f75 6e74 290a 2020 2020 2020 2020 2020  ount).          
+00021340: 2020 2020 2020 7061 7468 546f 4d6f 756e        pathToMoun
+00021350: 7420 3d20 5b70 6174 6854 6f4d 6f75 6e74  t = [pathToMount
+00021360: 5d0a 2020 2020 2020 2020 2020 2020 6578  ].            ex
+00021370: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+00021380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021390: 7061 7373 0a0a 2020 2020 2020 2020 6f70  pass..        op
+000213a0: 7469 6f6e 735b 2777 7269 7465 496e 6465  tions['writeInde
+000213b0: 7827 5d20 3d20 5472 7565 0a0a 2020 2020  x'] = True..    
+000213c0: 2020 2020 2320 5468 6973 2061 6c73 6f20      # This also 
+000213d0: 7769 6c6c 2063 7265 6174 6520 6f72 206c  will create or l
+000213e0: 6f61 6420 7468 6520 626c 6f63 6b20 6f66  oad the block of
+000213f0: 6673 6574 7320 666f 7220 636f 6d70 7265  fsets for compre
+00021400: 7373 6564 2066 6f72 6d61 7473 0a20 2020  ssed formats.   
+00021410: 2020 2020 206d 6f75 6e74 536f 7572 6365       mountSource
+00021420: 7320 3d20 5b6f 7065 6e4d 6f75 6e74 536f  s = [openMountSo
+00021430: 7572 6365 2870 6174 682c 202a 2a6f 7074  urce(path, **opt
+00021440: 696f 6e73 2920 666f 7220 7061 7468 2069  ions) for path i
+00021450: 6e20 7061 7468 546f 4d6f 756e 745d 0a0a  n pathToMount]..
+00021460: 2020 2020 2020 2020 2320 4e6f 2074 6872          # No thr
+00021470: 6561 6473 2073 686f 756c 6420 6265 2063  eads should be c
+00021480: 7265 6174 6564 2061 6e64 2073 7469 6c6c  reated and still
+00021490: 2062 6520 6f70 656e 2062 6566 6f72 6520   be open before 
+000214a0: 4655 5345 2066 6f72 6b73 2e0a 2020 2020  FUSE forks..    
+000214b0: 2020 2020 2320 496e 7374 6561 642c 2074      # Instead, t
+000214c0: 6865 7920 7368 6f75 6c64 2062 6520 6372  hey should be cr
+000214d0: 6561 7465 6420 696e 2027 696e 6974 272e  eated in 'init'.
+000214e0: 0a20 2020 2020 2020 2023 2054 6865 7265  .        # There
+000214f0: 666f 7265 2c20 636c 6f73 6520 7468 7265  fore, close thre
+00021500: 6164 7320 6f70 656e 6564 2062 7920 7468  ads opened by th
+00021510: 6520 5061 7261 6c6c 656c 425a 3252 6561  e ParallelBZ2Rea
+00021520: 6465 7220 666f 7220 6372 6561 7469 6e67  der for creating
+00021530: 2074 6865 2062 6c6f 636b 206f 6666 7365   the block offse
+00021540: 7473 2e0a 2020 2020 2020 2020 2320 5468  ts..        # Th
+00021550: 6f73 6520 7468 7265 6164 7320 7769 6c6c  ose threads will
+00021560: 2062 6520 6175 746f 6d61 7469 6361 6c6c   be automaticall
+00021570: 7920 7265 6372 6561 7465 6420 6167 6169  y recreated agai
+00021580: 6e20 6f6e 2074 6865 206e 6578 7420 7265  n on the next re
+00021590: 6164 2063 616c 6c2e 0a20 2020 2020 2020  ad call..       
+000215a0: 2023 2057 6974 686f 7574 2074 6869 732c   # Without this,
+000215b0: 2074 6865 2072 6174 6172 6d6f 756e 7420   the ratarmount 
+000215c0: 6261 636b 6772 6f75 6e64 2070 726f 6365  background proce
+000215d0: 7373 2077 6f6e 2774 2071 7569 7420 6576  ss won't quit ev
+000215e0: 656e 2061 6674 6572 2075 6e6d 6f75 6e74  en after unmount
+000215f0: 696e 6721 0a20 2020 2020 2020 2066 6f72  ing!.        for
+00021600: 206d 6f75 6e74 536f 7572 6365 2069 6e20   mountSource in 
+00021610: 6d6f 756e 7453 6f75 7263 6573 3a0a 2020  mountSources:.  
+00021620: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00021630: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021640: 7369 6e73 7461 6e63 6528 6d6f 756e 7453  sinstance(mountS
+00021650: 6f75 7263 652c 2053 514c 6974 6549 6e64  ource, SQLiteInd
+00021660: 6578 6564 5461 7229 0a20 2020 2020 2020  exedTar).       
+00021670: 2020 2020 2020 2020 2061 6e64 2068 6173           and has
+00021680: 6174 7472 286d 6f75 6e74 536f 7572 6365  attr(mountSource
+00021690: 2c20 2774 6172 4669 6c65 4f62 6a65 6374  , 'tarFileObject
+000216a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000216b0: 2020 2061 6e64 2068 6173 6174 7472 286d     and hasattr(m
+000216c0: 6f75 6e74 536f 7572 6365 2e74 6172 4669  ountSource.tarFi
+000216d0: 6c65 4f62 6a65 6374 2c20 276a 6f69 6e5f  leObject, 'join_
+000216e0: 7468 7265 6164 7327 290a 2020 2020 2020  threads').      
+000216f0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00021700: 2020 2020 2020 2020 206d 6f75 6e74 536f           mountSo
+00021710: 7572 6365 2e74 6172 4669 6c65 4f62 6a65  urce.tarFileObje
+00021720: 6374 2e6a 6f69 6e5f 7468 7265 6164 7328  ct.join_threads(
+00021730: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00021740: 6d6f 756e 7453 6f75 7263 653a 204d 6f75  mountSource: Mou
+00021750: 6e74 536f 7572 6365 203d 2055 6e69 6f6e  ntSource = Union
+00021760: 4d6f 756e 7453 6f75 7263 6528 6d6f 756e  MountSource(moun
+00021770: 7453 6f75 7263 6573 290a 2020 2020 2020  tSources).      
+00021780: 2020 6966 206f 7074 696f 6e73 2e67 6574    if options.get
+00021790: 2827 7265 6375 7273 6976 6527 2c20 4661  ('recursive', Fa
+000217a0: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+000217b0: 2020 7365 6c66 2e6d 6f75 6e74 536f 7572    self.mountSour
+000217c0: 6365 203d 2041 7574 6f4d 6f75 6e74 4c61  ce = AutoMountLa
+000217d0: 7965 7228 7365 6c66 2e6d 6f75 6e74 536f  yer(self.mountSo
+000217e0: 7572 6365 2c20 2a2a 6f70 7469 6f6e 7329  urce, **options)
+000217f0: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00021800: 756e 7453 6f75 7263 6520 3d20 4669 6c65  untSource = File
+00021810: 5665 7273 696f 6e4c 6179 6572 2873 656c  VersionLayer(sel
+00021820: 662e 6d6f 756e 7453 6f75 7263 6529 0a0a  f.mountSource)..
+00021830: 2020 2020 2020 2020 7365 6c66 2e72 6f6f          self.roo
+00021840: 7446 696c 6549 6e66 6f20 3d20 5f6d 616b  tFileInfo = _mak
+00021850: 654d 6f75 6e74 506f 696e 7446 696c 6549  eMountPointFileI
+00021860: 6e66 6f46 726f 6d53 7461 7473 286f 732e  nfoFromStats(os.
+00021870: 7374 6174 2870 6174 6854 6f4d 6f75 6e74  stat(pathToMount
+00021880: 5b30 5d29 290a 0a20 2020 2020 2020 2073  [0]))..        s
+00021890: 656c 662e 6f70 656e 6564 4669 6c65 733a  elf.openedFiles:
+000218a0: 2044 6963 745b 696e 742c 2049 4f5b 6279   Dict[int, IO[by
+000218b0: 7465 735d 5d20 3d20 7b7d 0a20 2020 2020  tes]] = {}.     
+000218c0: 2020 2073 656c 662e 6c61 7374 4669 6c65     self.lastFile
+000218d0: 4861 6e64 6c65 3a20 696e 7420 3d20 3020  Handle: int = 0 
+000218e0: 2023 2049 7420 7769 6c6c 2062 6520 696e   # It will be in
+000218f0: 6372 656d 656e 7465 6420 6265 666f 7265  cremented before
+00021900: 2062 6569 6e67 2072 6574 7572 6e65 642e   being returned.
+00021910: 2049 7420 6361 6e27 7420 6875 7274 2074   It can't hurt t
+00021920: 6f20 6e65 7665 7220 7265 7475 726e 2030  o never return 0
+00021930: 2e0a 0a20 2020 2020 2020 2023 2043 7265  ...        # Cre
+00021940: 6174 6520 6d6f 756e 7420 706f 696e 7420  ate mount point 
+00021950: 6966 2069 7420 646f 6573 206e 6f74 2065  if it does not e
+00021960: 7869 7374 0a20 2020 2020 2020 2073 656c  xist.        sel
+00021970: 662e 6d6f 756e 7450 6f69 6e74 5761 7343  f.mountPointWasC
+00021980: 7265 6174 6564 203d 2046 616c 7365 0a20  reated = False. 
+00021990: 2020 2020 2020 2069 6620 6d6f 756e 7450         if mountP
+000219a0: 6f69 6e74 2061 6e64 206e 6f74 206f 732e  oint and not os.
+000219b0: 7061 7468 2e65 7869 7374 7328 6d6f 756e  path.exists(moun
+000219c0: 7450 6f69 6e74 293a 0a20 2020 2020 2020  tPoint):.       
+000219d0: 2020 2020 206f 732e 6d6b 6469 7228 6d6f       os.mkdir(mo
+000219e0: 756e 7450 6f69 6e74 290a 2020 2020 2020  untPoint).      
+000219f0: 2020 2020 2020 7365 6c66 2e6d 6f75 6e74        self.mount
+00021a00: 506f 696e 7457 6173 4372 6561 7465 6420  PointWasCreated 
+00021a10: 3d20 5472 7565 0a20 2020 2020 2020 2073  = True.        s
+00021a20: 656c 662e 6d6f 756e 7450 6f69 6e74 203d  elf.mountPoint =
+00021a30: 206f 732e 7061 7468 2e72 6561 6c70 6174   os.path.realpat
+00021a40: 6828 6d6f 756e 7450 6f69 6e74 290a 0a20  h(mountPoint).. 
+00021a50: 2020 2020 2020 2023 2054 616b 6520 6361         # Take ca
+00021a60: 7265 2074 6861 7420 6269 6e64 2d6d 6f75  re that bind-mou
+00021a70: 6e74 696e 6720 666f 6c64 6572 7320 746f  nting folders to
+00021a80: 2069 7473 656c 6620 776f 726b 730a 2020   itself works.  
+00021a90: 2020 2020 2020 7365 6c66 2e6d 6f75 6e74        self.mount
+00021aa0: 506f 696e 7446 6420 3d20 4e6f 6e65 0a20  PointFd = None. 
+00021ab0: 2020 2020 2020 2073 656c 662e 7365 6c66         self.self
+00021ac0: 4269 6e64 4d6f 756e 743a 204f 7074 696f  BindMount: Optio
+00021ad0: 6e61 6c5b 466f 6c64 6572 4d6f 756e 7453  nal[FolderMountS
+00021ae0: 6f75 7263 655d 203d 204e 6f6e 650a 2020  ource] = None.  
+00021af0: 2020 2020 2020 666f 7220 6d6f 756e 7453        for mountS
+00021b00: 6f75 7263 6520 696e 206d 6f75 6e74 536f  ource in mountSo
+00021b10: 7572 6365 733a 0a20 2020 2020 2020 2020  urces:.         
+00021b20: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00021b30: 286d 6f75 6e74 536f 7572 6365 2c20 466f  (mountSource, Fo
+00021b40: 6c64 6572 4d6f 756e 7453 6f75 7263 6529  lderMountSource)
+00021b50: 2061 6e64 206d 6f75 6e74 536f 7572 6365   and mountSource
+00021b60: 2e72 6f6f 7420 3d3d 2073 656c 662e 6d6f  .root == self.mo
+00021b70: 756e 7450 6f69 6e74 3a0a 2020 2020 2020  untPoint:.      
+00021b80: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00021b90: 656c 6642 696e 644d 6f75 6e74 203d 206d  elfBindMount = m
+00021ba0: 6f75 6e74 536f 7572 6365 0a20 2020 2020  ountSource.     
+00021bb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00021bc0: 6d6f 756e 7450 6f69 6e74 4664 203d 206f  mountPointFd = o
+00021bd0: 732e 6f70 656e 2873 656c 662e 6d6f 756e  s.open(self.moun
+00021be0: 7450 6f69 6e74 2c20 6f73 2e4f 5f52 444f  tPoint, os.O_RDO
+00021bf0: 4e4c 5929 0a0a 2020 2020 6465 6620 5f5f  NLY)..    def __
+00021c00: 6465 6c5f 5f28 7365 6c66 2920 2d3e 204e  del__(self) -> N
+00021c10: 6f6e 653a 0a20 2020 2020 2020 2074 7279  one:.        try
+00021c20: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00021c30: 2073 656c 662e 6d6f 756e 7450 6f69 6e74   self.mountPoint
+00021c40: 5761 7343 7265 6174 6564 3a0a 2020 2020  WasCreated:.    
+00021c50: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
+00021c60: 6d64 6972 2873 656c 662e 6d6f 756e 7450  mdir(self.mountP
+00021c70: 6f69 6e74 290a 2020 2020 2020 2020 6578  oint).        ex
+00021c80: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+00021c90: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00021ca0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+00021cb0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00021cc0: 6c66 2e6d 6f75 6e74 506f 696e 7446 6420  lf.mountPointFd 
+00021cd0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00021ce0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+00021cf0: 636c 6f73 6528 7365 6c66 2e6d 6f75 6e74  close(self.mount
+00021d00: 506f 696e 7446 6429 0a20 2020 2020 2020  PointFd).       
+00021d10: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00021d20: 6e3a 0a20 2020 2020 2020 2020 2020 2070  n:.            p
+00021d30: 6173 730a 0a20 2020 2040 6f76 6572 7269  ass..    @overri
+00021d40: 6465 7328 4675 7365 4f70 6572 6174 696f  des(FuseOperatio
+00021d50: 6e73 290a 2020 2020 6465 6620 696e 6974  ns).    def init
+00021d60: 2873 656c 662c 2063 6f6e 6e65 6374 696f  (self, connectio
+00021d70: 6e29 202d 3e20 4e6f 6e65 3a0a 2020 2020  n) -> None:.    
+00021d80: 2020 2020 6966 2073 656c 662e 7365 6c66      if self.self
+00021d90: 4269 6e64 4d6f 756e 7420 6973 206e 6f74  BindMount is not
+00021da0: 204e 6f6e 6520 616e 6420 7365 6c66 2e6d   None and self.m
+00021db0: 6f75 6e74 506f 696e 7446 6420 6973 206e  ountPointFd is n
+00021dc0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00021dd0: 2020 2020 2073 656c 662e 7365 6c66 4269       self.selfBi
+00021de0: 6e64 4d6f 756e 742e 7365 7446 6f6c 6465  ndMount.setFolde
+00021df0: 7244 6573 6372 6970 746f 7228 7365 6c66  rDescriptor(self
+00021e00: 2e6d 6f75 6e74 506f 696e 7446 6429 0a0a  .mountPointFd)..
+00021e10: 2020 2020 406f 7665 7272 6964 6573 2846      @overrides(F
+00021e20: 7573 654f 7065 7261 7469 6f6e 7329 0a20  useOperations). 
+00021e30: 2020 2064 6566 2067 6574 6174 7472 2873     def getattr(s
+00021e40: 656c 662c 2070 6174 683a 2073 7472 2c20  elf, path: str, 
+00021e50: 6668 3d4e 6f6e 6529 202d 3e20 4469 6374  fh=None) -> Dict
+00021e60: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
+00021e70: 2020 2020 6669 6c65 496e 666f 203d 2073      fileInfo = s
+00021e80: 656c 662e 6d6f 756e 7453 6f75 7263 652e  elf.mountSource.
+00021e90: 6765 7446 696c 6549 6e66 6f28 7061 7468  getFileInfo(path
+00021ea0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00021eb0: 2066 696c 6549 6e66 6f3a 0a20 2020 2020   fileInfo:.     
+00021ec0: 2020 2020 2020 2072 6169 7365 2066 7573         raise fus
+00021ed0: 652e 4675 7365 4f53 4572 726f 7228 6675  e.FuseOSError(fu
+00021ee0: 7365 2e65 7272 6e6f 2e45 494f 290a 0a20  se.errno.EIO).. 
+00021ef0: 2020 2020 2020 2023 2064 6963 7469 6f6e         # diction
+00021f00: 6172 7920 6b65 7973 3a20 6874 7470 733a  ary keys: https:
+00021f10: 2f2f 7075 6273 2e6f 7065 6e67 726f 7570  //pubs.opengroup
+00021f20: 2e6f 7267 2f6f 6e6c 696e 6570 7562 732f  .org/onlinepubs/
+00021f30: 3030 3739 3034 3837 352f 6261 7365 6465  007904875/basede
+00021f40: 6673 2f73 7973 2f73 7461 742e 682e 6874  fs/sys/stat.h.ht
+00021f50: 6d6c 0a20 2020 2020 2020 2073 7461 7444  ml.        statD
+00021f60: 6963 7420 3d20 7b22 7374 5f22 202b 206b  ict = {"st_" + k
+00021f70: 6579 3a20 6765 7461 7474 7228 6669 6c65  ey: getattr(file
+00021f80: 496e 666f 2c20 6b65 7929 2066 6f72 206b  Info, key) for k
+00021f90: 6579 2069 6e20 2827 7369 7a65 272c 2027  ey in ('size', '
+00021fa0: 6d74 696d 6527 2c20 276d 6f64 6527 2c20  mtime', 'mode', 
+00021fb0: 2775 6964 272c 2027 6769 6427 297d 0a20  'uid', 'gid')}. 
+00021fc0: 2020 2020 2020 2073 7461 7444 6963 745b         statDict[
+00021fd0: 2773 745f 6d74 696d 6527 5d20 3d20 696e  'st_mtime'] = in
+00021fe0: 7428 7374 6174 4469 6374 5b27 7374 5f6d  t(statDict['st_m
+00021ff0: 7469 6d65 275d 290a 2020 2020 2020 2020  time']).        
+00022000: 7374 6174 4469 6374 5b27 7374 5f6e 6c69  statDict['st_nli
+00022010: 6e6b 275d 203d 2031 2020 2320 544f 444f  nk'] = 1  # TODO
+00022020: 3a20 7468 6973 2069 7320 7772 6f6e 6720  : this is wrong 
+00022030: 666f 7220 6669 6c65 7320 7769 7468 2068  for files with h
+00022040: 6172 646c 696e 6b73 0a0a 2020 2020 2020  ardlinks..      
+00022050: 2020 2320 6475 2062 7920 6465 6661 756c    # du by defaul
+00022060: 7420 7375 6d73 2064 6973 6b20 7573 6167  t sums disk usag
+00022070: 6520 2874 6865 206e 756d 6265 7220 6f66  e (the number of
+00022080: 2062 6c6f 636b 7320 7573 6564 2062 7920   blocks used by 
+00022090: 6120 6669 6c65 290a 2020 2020 2020 2020  a file).        
+000220a0: 2320 696e 7374 6561 6420 6f66 2066 696c  # instead of fil
+000220b0: 6520 7369 7a65 2064 6972 6563 746c 792e  e size directly.
+000220c0: 2054 6172 2066 696c 6573 2061 7265 2075   Tar files are u
+000220d0: 7375 616c 6c79 2061 2073 6572 6965 7320  sually a series 
+000220e0: 6f66 2035 3132 420a 2020 2020 2020 2020  of 512B.        
+000220f0: 2320 626c 6f63 6b73 2c20 736f 2077 6520  # blocks, so we 
+00022100: 7265 706f 7274 2061 2031 2d62 6c6f 636b  report a 1-block
+00022110: 2068 6561 6465 7220 2b20 6365 696c 2866   header + ceil(f
+00022120: 696c 6573 697a 6520 2f20 3531 3229 2e0a  ilesize / 512)..
+00022130: 2020 2020 2020 2020 7374 6174 4469 6374          statDict
+00022140: 5b27 7374 5f62 6c6b 7369 7a65 275d 203d  ['st_blksize'] =
+00022150: 2035 3132 0a20 2020 2020 2020 2073 7461   512.        sta
+00022160: 7444 6963 745b 2773 745f 626c 6f63 6b73  tDict['st_blocks
+00022170: 275d 203d 2031 202b 2028 2866 696c 6549  '] = 1 + ((fileI
+00022180: 6e66 6f2e 7369 7a65 202b 2035 3131 2920  nfo.size + 511) 
+00022190: 2f2f 2035 3132 290a 0a20 2020 2020 2020  // 512)..       
+000221a0: 2072 6574 7572 6e20 7374 6174 4469 6374   return statDict
+000221b0: 0a0a 2020 2020 406f 7665 7272 6964 6573  ..    @overrides
+000221c0: 2846 7573 654f 7065 7261 7469 6f6e 7329  (FuseOperations)
+000221d0: 0a20 2020 2064 6566 2072 6561 6464 6972  .    def readdir
+000221e0: 2873 656c 662c 2070 6174 683a 2073 7472  (self, path: str
+000221f0: 2c20 6668 293a 0a20 2020 2020 2020 2023  , fh):.        #
+00022200: 2077 6520 6f6e 6c79 206e 6565 6420 746f   we only need to
+00022210: 2072 6574 7572 6e20 7468 6573 6520 7370   return these sp
+00022220: 6563 6961 6c20 6469 7265 6374 6f72 6965  ecial directorie
+00022230: 732e 2046 5553 4520 6175 746f 6d61 7469  s. FUSE automati
+00022240: 6361 6c6c 7920 6578 7061 6e64 7320 7468  cally expands th
+00022250: 6573 6520 616e 6420 7769 6c6c 206e 6f74  ese and will not
+00022260: 2061 736b 0a20 2020 2020 2020 2023 2066   ask.        # f
+00022270: 6f72 2070 6174 6873 206c 696b 6520 2f2e  or paths like /.
+00022280: 2e2f 666f 6f2f 2e2f 2e2e 2f62 6172 2c20  ./foo/./../bar, 
+00022290: 736f 2077 6520 646f 6e27 7420 6e65 6564  so we don't need
+000222a0: 2074 6f20 776f 7272 7920 6162 6f75 7420   to worry about 
+000222b0: 636c 6561 6e69 6e67 2073 7563 6820 7061  cleaning such pa
+000222c0: 7468 730a 2020 2020 2020 2020 7969 656c  ths.        yiel
+000222d0: 6420 272e 270a 2020 2020 2020 2020 7969  d '.'.        yi
+000222e0: 656c 6420 272e 2e27 0a0a 2020 2020 2020  eld '..'..      
+000222f0: 2020 6669 6c65 7320 3d20 7365 6c66 2e6d    files = self.m
+00022300: 6f75 6e74 536f 7572 6365 2e6c 6973 7444  ountSource.listD
+00022310: 6972 2870 6174 6829 0a20 2020 2020 2020  ir(path).       
+00022320: 2069 6620 6669 6c65 7320 6973 206e 6f74   if files is not
+00022330: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00022340: 2020 2066 6f72 206b 6579 2069 6e20 6669     for key in fi
+00022350: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00022360: 2020 2020 2079 6965 6c64 206b 6579 0a0a       yield key..
+00022370: 2020 2020 406f 7665 7272 6964 6573 2846      @overrides(F
+00022380: 7573 654f 7065 7261 7469 6f6e 7329 0a20  useOperations). 
+00022390: 2020 2064 6566 2072 6561 646c 696e 6b28     def readlink(
+000223a0: 7365 6c66 2c20 7061 7468 3a20 7374 7229  self, path: str)
+000223b0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+000223c0: 2066 696c 6549 6e66 6f20 3d20 7365 6c66   fileInfo = self
+000223d0: 2e6d 6f75 6e74 536f 7572 6365 2e67 6574  .mountSource.get
+000223e0: 4669 6c65 496e 666f 2870 6174 6829 0a20  FileInfo(path). 
+000223f0: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+00022400: 6c65 496e 666f 3a0a 2020 2020 2020 2020  leInfo:.        
+00022410: 2020 2020 7261 6973 6520 6675 7365 2e46      raise fuse.F
+00022420: 7573 654f 5345 7272 6f72 2866 7573 652e  useOSError(fuse.
+00022430: 6572 726e 6f2e 4549 4f29 0a20 2020 2020  errno.EIO).     
+00022440: 2020 2072 6574 7572 6e20 6669 6c65 496e     return fileIn
+00022450: 666f 2e6c 696e 6b6e 616d 650a 0a20 2020  fo.linkname..   
+00022460: 2040 6f76 6572 7269 6465 7328 4675 7365   @overrides(Fuse
+00022470: 4f70 6572 6174 696f 6e73 290a 2020 2020  Operations).    
+00022480: 6465 6620 6f70 656e 2873 656c 662c 2070  def open(self, p
+00022490: 6174 682c 2066 6c61 6773 293a 0a20 2020  ath, flags):.   
+000224a0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+000224b0: 6669 6c65 2068 616e 646c 6520 6f66 206f  file handle of o
+000224c0: 7065 6e65 6420 7061 7468 2e22 2222 0a0a  pened path."""..
+000224d0: 2020 2020 2020 2020 6669 6c65 496e 666f          fileInfo
+000224e0: 203d 2073 656c 662e 6d6f 756e 7453 6f75   = self.mountSou
+000224f0: 7263 652e 6765 7446 696c 6549 6e66 6f28  rce.getFileInfo(
+00022500: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
+00022510: 206e 6f74 2066 696c 6549 6e66 6f3a 0a20   not fileInfo:. 
+00022520: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00022530: 2066 7573 652e 4675 7365 4f53 4572 726f   fuse.FuseOSErro
+00022540: 7228 6675 7365 2e65 7272 6e6f 2e45 494f  r(fuse.errno.EIO
+00022550: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
+00022560: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00022570: 2e6c 6173 7446 696c 6548 616e 646c 6520  .lastFileHandle 
+00022580: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00022590: 2073 656c 662e 6f70 656e 6564 4669 6c65   self.openedFile
+000225a0: 735b 7365 6c66 2e6c 6173 7446 696c 6548  s[self.lastFileH
+000225b0: 616e 646c 655d 203d 2073 656c 662e 6d6f  andle] = self.mo
+000225c0: 756e 7453 6f75 7263 652e 6f70 656e 2866  untSource.open(f
+000225d0: 696c 6549 6e66 6f29 0a20 2020 2020 2020  ileInfo).       
+000225e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000225f0: 2e6c 6173 7446 696c 6548 616e 646c 650a  .lastFileHandle.
+00022600: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00022610: 7863 6570 7469 6f6e 2061 7320 6578 6365  xception as exce
+00022620: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00022630: 2020 2074 7261 6365 6261 636b 2e70 7269     traceback.pri
+00022640: 6e74 5f65 7863 2829 0a20 2020 2020 2020  nt_exc().       
+00022650: 2020 2020 2070 7269 6e74 2822 4361 7567       print("Caug
+00022660: 6874 2065 7863 6570 7469 6f6e 2077 6865  ht exception whe
+00022670: 6e20 7472 7969 6e67 2074 6f20 6f70 656e  n trying to open
+00022680: 2066 696c 652e 222c 2066 696c 6549 6e66   file.", fileInf
+00022690: 6f29 0a20 2020 2020 2020 2020 2020 2072  o).            r
+000226a0: 6169 7365 2066 7573 652e 4675 7365 4f53  aise fuse.FuseOS
+000226b0: 4572 726f 7228 6675 7365 2e65 7272 6e6f  Error(fuse.errno
+000226c0: 2e45 494f 2920 6672 6f6d 2065 7863 6570  .EIO) from excep
+000226d0: 7469 6f6e 0a0a 2020 2020 406f 7665 7272  tion..    @overr
+000226e0: 6964 6573 2846 7573 654f 7065 7261 7469  ides(FuseOperati
+000226f0: 6f6e 7329 0a20 2020 2064 6566 2072 656c  ons).    def rel
+00022700: 6561 7365 2873 656c 662c 2070 6174 682c  ease(self, path,
+00022710: 2066 6829 3a0a 2020 2020 2020 2020 6966   fh):.        if
+00022720: 2066 6820 6e6f 7420 696e 2073 656c 662e   fh not in self.
+00022730: 6f70 656e 6564 4669 6c65 733a 0a20 2020  openedFiles:.   
+00022740: 2020 2020 2020 2020 2072 6169 7365 2066           raise f
+00022750: 7573 652e 4675 7365 4f53 4572 726f 7228  use.FuseOSError(
+00022760: 6675 7365 2e65 7272 6e6f 2e45 5354 414c  fuse.errno.ESTAL
+00022770: 4529 0a0a 2020 2020 2020 2020 7365 6c66  E)..        self
+00022780: 2e6f 7065 6e65 6446 696c 6573 5b66 685d  .openedFiles[fh]
+00022790: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+000227a0: 2064 656c 2073 656c 662e 6f70 656e 6564   del self.opened
+000227b0: 4669 6c65 735b 6668 5d0a 2020 2020 2020  Files[fh].      
+000227c0: 2020 7265 7475 726e 2066 680a 0a20 2020    return fh..   
+000227d0: 2040 6f76 6572 7269 6465 7328 4675 7365   @overrides(Fuse
+000227e0: 4f70 6572 6174 696f 6e73 290a 2020 2020  Operations).    
+000227f0: 6465 6620 7265 6164 2873 656c 662c 2070  def read(self, p
+00022800: 6174 683a 2073 7472 2c20 7369 7a65 3a20  ath: str, size: 
+00022810: 696e 742c 206f 6666 7365 743a 2069 6e74  int, offset: int
+00022820: 2c20 6668 3a20 696e 7429 202d 3e20 6279  , fh: int) -> by
+00022830: 7465 733a 0a20 2020 2020 2020 2069 6620  tes:.        if 
+00022840: 6668 2069 6e20 7365 6c66 2e6f 7065 6e65  fh in self.opene
+00022850: 6446 696c 6573 3a0a 2020 2020 2020 2020  dFiles:.        
+00022860: 2020 2020 7365 6c66 2e6f 7065 6e65 6446      self.openedF
+00022870: 696c 6573 5b66 685d 2e73 6565 6b28 6f66  iles[fh].seek(of
+00022880: 6673 6574 2c20 6f73 2e53 4545 4b5f 5345  fset, os.SEEK_SE
+00022890: 5429 0a20 2020 2020 2020 2020 2020 2072  T).            r
+000228a0: 6574 7572 6e20 7365 6c66 2e6f 7065 6e65  eturn self.opene
+000228b0: 6446 696c 6573 5b66 685d 2e72 6561 6428  dFiles[fh].read(
+000228c0: 7369 7a65 290a 0a20 2020 2020 2020 2023  size)..        #
+000228d0: 2041 7320 6661 7220 6173 2049 2075 6e64   As far as I und
+000228e0: 6572 7374 616e 6420 4655 5345 2061 6e64  erstand FUSE and
+000228f0: 206d 7920 6f77 6e20 6669 6c65 2068 616e   my own file han
+00022900: 646c 6520 6361 6368 652c 2074 6869 7320  dle cache, this 
+00022910: 7368 6f75 6c64 206e 6576 6572 2068 6170  should never hap
+00022920: 7065 6e2e 2042 7574 2079 6f75 206e 6576  pen. But you nev
+00022930: 6572 206b 6e6f 772e 0a20 2020 2020 2020  er know..       
+00022940: 2069 6620 7072 696e 7444 6562 7567 203e   if printDebug >
+00022950: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00022960: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+00022970: 5d20 4769 7665 6e20 6669 6c65 2068 616e  ] Given file han
+00022980: 646c 6520 646f 6573 206e 6f74 2065 7869  dle does not exi
+00022990: 7374 2e20 5769 6c6c 206f 7065 6e20 6669  st. Will open fi
+000229a0: 6c65 2062 6566 6f72 6520 7265 6164 696e  le before readin
+000229b0: 6720 7768 6963 6820 6d69 6768 7420 6265  g which might be
+000229c0: 2073 6c6f 772e 2229 0a0a 2020 2020 2020   slow.")..      
+000229d0: 2020 6669 6c65 496e 666f 203d 2073 656c    fileInfo = sel
+000229e0: 662e 6d6f 756e 7453 6f75 7263 652e 6765  f.mountSource.ge
+000229f0: 7446 696c 6549 6e66 6f28 7061 7468 290a  tFileInfo(path).
+00022a00: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+00022a10: 696c 6549 6e66 6f3a 0a20 2020 2020 2020  ileInfo:.       
+00022a20: 2020 2020 2072 6169 7365 2066 7573 652e       raise fuse.
+00022a30: 4675 7365 4f53 4572 726f 7228 6675 7365  FuseOSError(fuse
+00022a40: 2e65 7272 6e6f 2e45 494f 290a 0a20 2020  .errno.EIO)..   
+00022a50: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00022a60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00022a70: 662e 6d6f 756e 7453 6f75 7263 652e 7265  f.mountSource.re
+00022a80: 6164 2866 696c 6549 6e66 6f2c 2073 697a  ad(fileInfo, siz
+00022a90: 652c 206f 6666 7365 7429 0a20 2020 2020  e, offset).     
+00022aa0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00022ab0: 696f 6e20 6173 2065 7863 6570 7469 6f6e  ion as exception
+00022ac0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00022ad0: 6163 6562 6163 6b2e 7072 696e 745f 6578  aceback.print_ex
+00022ae0: 6328 290a 2020 2020 2020 2020 2020 2020  c().            
+00022af0: 7072 696e 7428 2243 6175 6768 7420 6578  print("Caught ex
+00022b00: 6365 7074 696f 6e20 7768 656e 2074 7279  ception when try
+00022b10: 696e 6720 746f 2072 6561 6420 6461 7461  ing to read data
+00022b20: 2066 726f 6d20 756e 6465 726c 7969 6e67   from underlying
+00022b30: 2054 4152 2066 696c 6521 2052 6574 7572   TAR file! Retur
+00022b40: 6e69 6e67 2065 7272 6e6f 2e45 494f 2e22  ning errno.EIO."
+00022b50: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
+00022b60: 6973 6520 6675 7365 2e46 7573 654f 5345  ise fuse.FuseOSE
+00022b70: 7272 6f72 2866 7573 652e 6572 726e 6f2e  rror(fuse.errno.
+00022b80: 4549 4f29 2066 726f 6d20 6578 6365 7074  EIO) from except
+00022b90: 696f 6e0a 0a0a 636c 6173 7320 5461 7246  ion...class TarF
+00022ba0: 696c 6554 7970 653a 0a20 2020 2022 2222  ileType:.    """
+00022bb0: 0a20 2020 2053 696d 696c 6172 2074 6f20  .    Similar to 
+00022bc0: 6172 6770 6172 7365 2e46 696c 6554 7970  argparse.FileTyp
+00022bd0: 6520 6275 7420 7261 6973 6573 2061 6e20  e but raises an 
+00022be0: 6578 6365 7074 696f 6e20 6966 2069 7420  exception if it 
+00022bf0: 6973 206e 6f74 2061 2076 616c 6964 2054  is not a valid T
+00022c00: 4152 2066 696c 652e 0a20 2020 2022 2222  AR file..    """
+00022c10: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00022c20: 5f5f 2873 656c 662c 2065 6e63 6f64 696e  __(self, encodin
+00022c30: 673a 2073 7472 203d 2074 6172 6669 6c65  g: str = tarfile
+00022c40: 2e45 4e43 4f44 494e 4729 202d 3e20 4e6f  .ENCODING) -> No
+00022c50: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
+00022c60: 2e65 6e63 6f64 696e 6720 3d20 656e 636f  .encoding = enco
+00022c70: 6469 6e67 0a0a 2020 2020 6465 6620 5f5f  ding..    def __
+00022c80: 6361 6c6c 5f5f 2873 656c 662c 2074 6172  call__(self, tar
+00022c90: 4669 6c65 3a20 7374 7229 202d 3e20 5475  File: str) -> Tu
+00022ca0: 706c 655b 7374 722c 204f 7074 696f 6e61  ple[str, Optiona
+00022cb0: 6c5b 7374 725d 5d3a 0a20 2020 2020 2020  l[str]]:.       
+00022cc0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00022cd0: 6973 6669 6c65 2874 6172 4669 6c65 293a  isfile(tarFile):
+00022ce0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00022cf0: 7365 2061 7267 7061 7273 652e 4172 6775  se argparse.Argu
+00022d00: 6d65 6e74 5479 7065 4572 726f 7228 2246  mentTypeError("F
+00022d10: 696c 6520 277b 7d27 2069 7320 6e6f 7420  ile '{}' is not 
+00022d20: 6120 6669 6c65 2122 2e66 6f72 6d61 7428  a file!".format(
+00022d30: 7461 7246 696c 6529 290a 0a20 2020 2020  tarFile))..     
+00022d40: 2020 2077 6974 6820 6f70 656e 2874 6172     with open(tar
+00022d50: 4669 6c65 2c20 2772 6227 2920 6173 2066  File, 'rb') as f
+00022d60: 696c 656f 626a 3a0a 2020 2020 2020 2020  ileobj:.        
+00022d70: 2020 2020 6669 6c65 5369 7a65 203d 206f      fileSize = o
+00022d80: 732e 7374 6174 2874 6172 4669 6c65 292e  s.stat(tarFile).
+00022d90: 7374 5f73 697a 650a 0a20 2020 2020 2020  st_size..       
+00022da0: 2020 2020 2023 2048 6561 6465 7220 6368       # Header ch
+00022db0: 6563 6b73 2061 7265 2065 6e6f 7567 6820  ecks are enough 
+00022dc0: 666f 7220 7468 6973 2073 7465 702e 0a20  for this step.. 
+00022dd0: 2020 2020 2020 2020 2020 206f 6c64 4f66             oldOf
+00022de0: 6673 6574 203d 2066 696c 656f 626a 2e74  fset = fileobj.t
+00022df0: 656c 6c28 290a 2020 2020 2020 2020 2020  ell().          
+00022e00: 2020 636f 6d70 7265 7373 696f 6e20 3d20    compression = 
+00022e10: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00022e20: 2066 6f72 2063 6f6d 7072 6573 7369 6f6e   for compression
+00022e30: 4964 2c20 636f 6d70 7265 7373 696f 6e49  Id, compressionI
+00022e40: 6e66 6f20 696e 2073 7570 706f 7274 6564  nfo in supported
+00022e50: 436f 6d70 7265 7373 696f 6e73 2e69 7465  Compressions.ite
+00022e60: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00022e70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00022e80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00022e90: 6620 636f 6d70 7265 7373 696f 6e49 6e66  f compressionInf
+00022ea0: 6f2e 6368 6563 6b48 6561 6465 7228 6669  o.checkHeader(fi
+00022eb0: 6c65 6f62 6a29 3a0a 2020 2020 2020 2020  leobj):.        
+00022ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ed0: 636f 6d70 7265 7373 696f 6e20 3d20 636f  compression = co
+00022ee0: 6d70 7265 7373 696f 6e49 640a 2020 2020  mpressionId.    
+00022ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f00: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00022f10: 2020 2020 2020 2020 2020 6669 6e61 6c6c            finall
+00022f20: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00022f30: 2020 2020 2020 2066 696c 656f 626a 2e73         fileobj.s
+00022f40: 6565 6b28 6f6c 644f 6666 7365 7429 0a0a  eek(oldOffset)..
+00022f50: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00022f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022f70: 2023 2044 6574 6572 6d69 6e69 6e67 2069   # Determining i
+00022f80: 6620 7468 6572 6520 6172 6520 6d61 6e79  f there are many
+00022f90: 2066 7261 6d65 7320 696e 207a 7374 6420   frames in zstd 
+00022fa0: 6973 204f 2831 2920 7769 7468 2069 735f  is O(1) with is_
+00022fb0: 6d75 6c74 6966 7261 6d65 0a20 2020 2020  multiframe.     
+00022fc0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00022fd0: 6d70 7265 7373 696f 6e20 213d 2027 7a73  mpression != 'zs
+00022fe0: 7427 206f 7220 7375 7070 6f72 7465 6443  t' or supportedC
+00022ff0: 6f6d 7072 6573 7369 6f6e 735b 636f 6d70  ompressions[comp
+00023000: 7265 7373 696f 6e5d 2e6d 6f64 756c 654e  ression].moduleN
+00023010: 616d 6520 6e6f 7420 696e 2073 7973 2e6d  ame not in sys.m
+00023020: 6f64 756c 6573 3a0a 2020 2020 2020 2020  odules:.        
+00023030: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00023040: 6520 4578 6365 7074 696f 6e28 2920 2023  e Exception()  #
+00023050: 2065 6172 6c79 2065 7869 7420 6265 6361   early exit beca
+00023060: 7573 6520 7765 2063 6174 6368 2069 7420  use we catch it 
+00023070: 6f75 7273 656c 6620 616e 7977 6179 730a  ourself anyways.
+00023080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023090: 207a 7374 6446 696c 6520 3d20 7375 7070   zstdFile = supp
+000230a0: 6f72 7465 6443 6f6d 7072 6573 7369 6f6e  ortedCompression
+000230b0: 735b 636f 6d70 7265 7373 696f 6e5d 2e6f  s[compression].o
+000230c0: 7065 6e28 6669 6c65 6f62 6a29 0a0a 2020  pen(fileobj)..  
+000230d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000230e0: 206e 6f74 207a 7374 6446 696c 652e 6973   not zstdFile.is
+000230f0: 5f6d 756c 7469 6672 616d 6528 2920 616e  _multiframe() an
+00023100: 6420 6669 6c65 5369 7a65 203e 2031 3032  d fileSize > 102
+00023110: 3420 2a20 3130 3234 3a0a 2020 2020 2020  4 * 1024:.      
+00023120: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00023130: 696e 7428 225b 5761 726e 696e 675d 2054  int("[Warning] T
+00023140: 6865 2073 7065 6369 6669 6564 2066 696c  he specified fil
+00023150: 6520 277b 7d27 222e 666f 726d 6174 2874  e '{}'".format(t
+00023160: 6172 4669 6c65 2929 0a20 2020 2020 2020  arFile)).       
+00023170: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00023180: 6e74 2822 5b57 6172 6e69 6e67 5d20 6973  nt("[Warning] is
+00023190: 2063 6f6d 7072 6573 7365 6420 7573 696e   compressed usin
+000231a0: 6720 7a73 7464 2062 7574 206f 6e6c 7920  g zstd but only 
+000231b0: 636f 6e74 6169 6e73 206f 6e65 207a 7374  contains one zst
+000231c0: 6420 6672 616d 652e 2054 6869 7320 6d61  d frame. This ma
+000231d0: 6b65 7320 6974 2022 290a 2020 2020 2020  kes it ").      
+000231e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000231f0: 696e 7428 225b 5761 726e 696e 675d 2069  int("[Warning] i
+00023200: 6d70 6f73 7369 626c 6520 746f 2075 7365  mpossible to use
+00023210: 2074 7275 6520 7365 656b 696e 6721 2050   true seeking! P
+00023220: 6c65 6173 6520 2872 6529 636f 6d70 7265  lease (re)compre
+00023230: 7373 2079 6f75 7220 5441 5220 7573 696e  ss your TAR usin
+00023240: 6720 6d75 6c74 6970 6c65 2022 290a 2020  g multiple ").  
+00023250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023260: 2020 7072 696e 7428 225b 5761 726e 696e    print("[Warnin
+00023270: 675d 2066 7261 6d65 7320 696e 206f 7264  g] frames in ord
+00023280: 6572 2066 6f72 2072 6174 6172 6d6f 756e  er for ratarmoun
+00023290: 7420 746f 2064 6f20 6265 2061 626c 6520  t to do be able 
+000232a0: 746f 2064 6f20 6661 7374 2073 6565 6b69  to do fast seeki
+000232b0: 6e67 2074 6f20 7265 7175 6573 7465 6420  ng to requested 
+000232c0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000232d0: 2020 2020 2020 2070 7269 6e74 2822 5b57         print("[W
+000232e0: 6172 6e69 6e67 5d20 6669 6c65 732e 2045  arning] files. E
+000232f0: 6c73 652c 2065 6163 6820 6669 6c65 2061  lse, each file a
+00023300: 6363 6573 7320 7769 6c6c 2064 6563 6f6d  ccess will decom
+00023310: 7072 6573 7320 7468 6520 7768 6f6c 6520  press the whole 
+00023320: 5441 5220 6672 6f6d 2074 6865 2062 6567  TAR from the beg
+00023330: 696e 6e69 6e67 2122 290a 2020 2020 2020  inning!").      
+00023340: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00023350: 696e 7428 225b 5761 726e 696e 675d 2059  int("[Warning] Y
+00023360: 6f75 2063 616e 2074 7279 206f 7574 2074  ou can try out t
+00023370: 3273 7a20 666f 7220 6372 6561 7469 6e67  2sz for creating
+00023380: 2073 7563 6820 6172 6368 6976 6573 3a22   such archives:"
+00023390: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000233a0: 2020 2020 2020 7072 696e 7428 225b 5761        print("[Wa
+000233b0: 726e 696e 675d 2068 7474 7073 3a2f 2f67  rning] https://g
+000233c0: 6974 6875 622e 636f 6d2f 6d61 7274 696e  ithub.com/martin
+000233d0: 656c 6c69 6d61 7263 6f2f 7432 737a 2229  ellimarco/t2sz")
+000233e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000233f0: 2020 2020 2070 7269 6e74 2822 5b57 6172       print("[War
+00023400: 6e69 6e67 5d20 4865 7265 2079 6f75 2063  ning] Here you c
+00023410: 616e 2066 696e 6420 6120 7369 6d70 6c65  an find a simple
+00023420: 2062 6173 6820 7363 7269 7074 2064 656d   bash script dem
+00023430: 6f6e 7374 7261 7469 6e67 2068 6f77 2074  onstrating how t
+00023440: 6f20 646f 2074 6869 733a 2229 0a20 2020  o do this:").   
+00023450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023460: 2070 7269 6e74 2822 5b57 6172 6e69 6e67   print("[Warning
+00023470: 5d20 6874 7470 733a 2f2f 6769 7468 7562  ] https://github
+00023480: 2e63 6f6d 2f6d 786d 6c6e 6b6e 2f72 6174  .com/mxmlnkn/rat
+00023490: 6172 6d6f 756e 7423 787a 2d61 6e64 2d7a  armount#xz-and-z
+000234a0: 7374 2d66 696c 6573 2229 0a20 2020 2020  st-files").     
+000234b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000234c0: 7269 6e74 2829 0a20 2020 2020 2020 2020  rint().         
+000234d0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000234e0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000234f0: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
+00023500: 2020 2020 2020 2069 6620 636f 6d70 7265         if compre
+00023510: 7373 696f 6e20 6e6f 7420 696e 2073 7570  ssion not in sup
+00023520: 706f 7274 6564 436f 6d70 7265 7373 696f  portedCompressio
+00023530: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00023540: 2020 2020 6966 2053 514c 6974 6549 6e64      if SQLiteInd
+00023550: 6578 6564 5461 722e 5f64 6574 6563 7454  exedTar._detectT
+00023560: 6172 2866 696c 656f 626a 2c20 7365 6c66  ar(fileobj, self
+00023570: 2e65 6e63 6f64 696e 6729 3a0a 2020 2020  .encoding):.    
+00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023590: 7265 7475 726e 2074 6172 4669 6c65 2c20  return tarFile, 
+000235a0: 636f 6d70 7265 7373 696f 6e0a 0a20 2020  compression..   
+000235b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000235c0: 7072 696e 7444 6562 7567 203e 3d20 323a  printDebug >= 2:
+000235d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000235e0: 2020 2020 2070 7269 6e74 2866 2241 7263       print(f"Arc
+000235f0: 6869 7665 2027 7b74 6172 4669 6c65 7d27  hive '{tarFile}'
+00023600: 2028 636f 6d70 7265 7373 696f 6e3a 207b   (compression: {
+00023610: 636f 6d70 7265 7373 696f 6e7d 2920 6361  compression}) ca
+00023620: 6e27 7420 6265 206f 7065 6e65 6421 2229  n't be opened!")
+00023630: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023640: 2020 7261 6973 6520 6172 6770 6172 7365    raise argparse
+00023650: 2e41 7267 756d 656e 7454 7970 6545 7272  .ArgumentTypeErr
+00023660: 6f72 2822 4172 6368 6976 6520 277b 7d27  or("Archive '{}'
+00023670: 2063 616e 2774 2062 6520 6f70 656e 6564   can't be opened
+00023680: 215c 6e22 2e66 6f72 6d61 7428 7461 7246  !\n".format(tarF
+00023690: 696c 6529 290a 0a20 2020 2020 2020 2063  ile))..        c
+000236a0: 696e 666f 203d 2073 7570 706f 7274 6564  info = supported
+000236b0: 436f 6d70 7265 7373 696f 6e73 5b63 6f6d  Compressions[com
+000236c0: 7072 6573 7369 6f6e 5d0a 2020 2020 2020  pression].      
+000236d0: 2020 6966 2063 696e 666f 2e6d 6f64 756c    if cinfo.modul
+000236e0: 654e 616d 6520 6e6f 7420 696e 2073 7973  eName not in sys
+000236f0: 2e6d 6f64 756c 6573 3a0a 2020 2020 2020  .modules:.      
+00023700: 2020 2020 2020 7261 6973 6520 6172 6770        raise argp
+00023710: 6172 7365 2e41 7267 756d 656e 7454 7970  arse.ArgumentTyp
+00023720: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00023730: 2020 2020 2020 2020 2243 616e 2774 206f          "Can't o
+00023740: 7065 6e20 6120 7b7d 2063 6f6d 7072 6573  pen a {} compres
+00023750: 7365 6420 5441 5220 6669 6c65 2027 7b7d  sed TAR file '{}
+00023760: 2720 7769 7468 6f75 7420 7b7d 206d 6f64  ' without {} mod
+00023770: 756c 6521 222e 666f 726d 6174 280a 2020  ule!".format(.  
+00023780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023790: 2020 636f 6d70 7265 7373 696f 6e2c 2066    compression, f
+000237a0: 696c 656f 626a 2e6e 616d 652c 2063 696e  ileobj.name, cin
+000237b0: 666f 2e6d 6f64 756c 654e 616d 650a 2020  fo.moduleName.  
+000237c0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000237d0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000237e0: 2020 2020 2020 2072 6574 7572 6e20 7461         return ta
+000237f0: 7246 696c 652c 2063 6f6d 7072 6573 7369  rFile, compressi
+00023800: 6f6e 0a0a 0a64 6566 205f 7265 6d6f 7665  on...def _remove
+00023810: 4475 706c 6963 6174 6573 5374 6162 6c65  DuplicatesStable
+00023820: 2869 7465 7261 626c 653a 2049 7465 7261  (iterable: Itera
+00023830: 626c 6529 3a0a 2020 2020 7365 656e 203d  ble):.    seen =
+00023840: 2073 6574 2829 0a20 2020 2064 6564 7570   set().    dedup
+00023850: 6c69 6361 7465 6420 3d20 5b5d 0a20 2020  licated = [].   
+00023860: 2066 6f72 2078 2069 6e20 6974 6572 6162   for x in iterab
+00023870: 6c65 3a0a 2020 2020 2020 2020 6966 2078  le:.        if x
+00023880: 206e 6f74 2069 6e20 7365 656e 3a0a 2020   not in seen:.  
+00023890: 2020 2020 2020 2020 2020 6465 6475 706c            dedupl
+000238a0: 6963 6174 6564 2e61 7070 656e 6428 7829  icated.append(x)
+000238b0: 0a20 2020 2020 2020 2020 2020 2073 6565  .            see
+000238c0: 6e2e 6164 6428 7829 0a20 2020 2072 6574  n.add(x).    ret
+000238d0: 7572 6e20 6465 6475 706c 6963 6174 6564  urn deduplicated
+000238e0: 0a0a 0a63 6c61 7373 205f 4375 7374 6f6d  ...class _Custom
+000238f0: 466f 726d 6174 7465 7228 6172 6770 6172  Formatter(argpar
+00023900: 7365 2e41 7267 756d 656e 7444 6566 6175  se.ArgumentDefau
+00023910: 6c74 7348 656c 7046 6f72 6d61 7474 6572  ltsHelpFormatter
+00023920: 2c20 6172 6770 6172 7365 2e52 6177 4465  , argparse.RawDe
+00023930: 7363 7269 7074 696f 6e48 656c 7046 6f72  scriptionHelpFor
+00023940: 6d61 7474 6572 293a 0a20 2020 2064 6566  matter):.    def
+00023950: 2061 6464 5f61 7267 756d 656e 7473 2873   add_arguments(s
+00023960: 656c 662c 2061 6374 696f 6e73 293a 0a20  elf, actions):. 
+00023970: 2020 2020 2020 2061 6374 696f 6e73 203d         actions =
+00023980: 2073 6f72 7465 6428 6163 7469 6f6e 732c   sorted(actions,
+00023990: 206b 6579 3d6c 616d 6264 6120 783a 2067   key=lambda x: g
+000239a0: 6574 6174 7472 2878 2c20 276f 7074 696f  etattr(x, 'optio
+000239b0: 6e5f 7374 7269 6e67 7327 2929 0a20 2020  n_strings')).   
+000239c0: 2020 2020 2073 7570 6572 2829 2e61 6464       super().add
+000239d0: 5f61 7267 756d 656e 7473 2861 6374 696f  _arguments(actio
+000239e0: 6e73 290a 0a0a 6465 6620 5f70 6172 7365  ns)...def _parse
+000239f0: 4172 6773 2872 6177 4172 6773 3a20 4f70  Args(rawArgs: Op
+00023a00: 7469 6f6e 616c 5b4c 6973 745b 7374 725d  tional[List[str]
+00023a10: 5d20 3d20 4e6f 6e65 293a 0a20 2020 2070  ] = None):.    p
+00023a20: 6172 7365 7220 3d20 6172 6770 6172 7365  arser = argparse
+00023a30: 2e41 7267 756d 656e 7450 6172 7365 7228  .ArgumentParser(
+00023a40: 0a20 2020 2020 2020 2066 6f72 6d61 7474  .        formatt
+00023a50: 6572 5f63 6c61 7373 3d5f 4375 7374 6f6d  er_class=_Custom
+00023a60: 466f 726d 6174 7465 722c 0a20 2020 2020  Formatter,.     
+00023a70: 2020 2064 6573 6372 6970 7469 6f6e 3d27     description='
+00023a80: 2727 5c0a 5769 7468 2072 6174 6172 6d6f  ''\.With ratarmo
+00023a90: 756e 742c 2079 6f75 2063 616e 3a0a 2020  unt, you can:.  
+00023aa0: 2d20 4d6f 756e 7420 6120 2863 6f6d 7072  - Mount a (compr
+00023ab0: 6573 7365 6429 2054 4152 2066 696c 6520  essed) TAR file 
+00023ac0: 746f 2061 2066 6f6c 6465 7220 666f 7220  to a folder for 
+00023ad0: 7265 6164 2d6f 6e6c 7920 6163 6365 7373  read-only access
+00023ae0: 0a20 202d 204d 6f75 6e74 2061 2063 6f6d  .  - Mount a com
+00023af0: 7072 6573 7365 6420 6669 6c65 2074 6f20  pressed file to 
+00023b00: 603c 6d6f 756e 7470 6f69 6e74 3e2f 3c66  `<mountpoint>/<f
+00023b10: 696c 656e 616d 653e 600a 2020 2d20 4269  ilename>`.  - Bi
+00023b20: 6e64 206d 6f75 6e74 2061 2066 6f6c 6465  nd mount a folde
+00023b30: 7220 746f 2061 6e6f 7468 6572 2066 6f6c  r to another fol
+00023b40: 6465 7220 666f 7220 7265 6164 2d6f 6e6c  der for read-onl
+00023b50: 7920 6163 6365 7373 0a20 202d 2055 6e69  y access.  - Uni
+00023b60: 6f6e 206d 6f75 6e74 2061 206c 6973 7420  on mount a list 
+00023b70: 6f66 2054 4152 732c 2063 6f6d 7072 6573  of TARs, compres
+00023b80: 7365 6420 6669 6c65 732c 2061 6e64 2066  sed files, and f
+00023b90: 6f6c 6465 7273 2074 6f20 6120 6d6f 756e  olders to a moun
+00023ba0: 7420 706f 696e 740a 2020 2020 666f 7220  t point.    for 
+00023bb0: 7265 6164 2d6f 6e6c 7920 6163 6365 7373  read-only access
+00023bc0: 0a27 2727 2c0a 2020 2020 2020 2020 6570  .''',.        ep
+00023bd0: 696c 6f67 3d27 2727 5c0a 2320 4d65 7461  ilog='''\.# Meta
+00023be0: 6461 7461 2049 6e64 6578 2043 6163 6865  data Index Cache
+00023bf0: 0a0a 496e 206f 7264 6572 2074 6f20 7265  ..In order to re
+00023c00: 6475 6365 2074 6865 206d 6f75 6e74 696e  duce the mountin
+00023c10: 6720 7469 6d65 2c20 7468 6520 6372 6561  g time, the crea
+00023c20: 7465 6420 696e 6465 7820 666f 7220 7261  ted index for ra
+00023c30: 6e64 6f6d 2061 6363 6573 730a 746f 2066  ndom access.to f
+00023c40: 696c 6573 2069 6e73 6964 6520 7468 6520  iles inside the 
+00023c50: 7461 7220 7769 6c6c 2062 6520 7361 7665  tar will be save
+00023c60: 6420 746f 206f 6e65 206f 6620 7468 6573  d to one of thes
+00023c70: 6520 6c6f 6361 7469 6f6e 732e 2054 6865  e locations. The
+00023c80: 7365 0a6c 6f63 6174 696f 6e73 2061 7265  se.locations are
+00023c90: 2063 6865 636b 6564 2069 6e20 6f72 6465   checked in orde
+00023ca0: 7220 616e 6420 7468 6520 6669 7273 742c  r and the first,
+00023cb0: 2077 6869 6368 2077 6f72 6b73 2073 7566   which works suf
+00023cc0: 6669 6369 656e 746c 792c 2077 696c 6c0a  ficiently, will.
+00023cd0: 6265 2075 7365 642e 2054 6869 7320 6973  be used. This is
+00023ce0: 2074 6865 2064 6566 6175 6c74 206c 6f63   the default loc
+00023cf0: 6174 696f 6e20 6f72 6465 723a 0a0a 2020  ation order:..  
+00023d00: 312e 203c 7061 7468 2074 6f20 7461 723e  1. <path to tar>
+00023d10: 2e69 6e64 6578 2e73 716c 6974 650a 2020  .index.sqlite.  
+00023d20: 322e 207e 2f2e 7261 7461 726d 6f75 6e74  2. ~/.ratarmount
+00023d30: 2f3c 7061 7468 2074 6f20 7461 723a 2027  /<path to tar: '
+00023d40: 2f27 202d 3e20 275f 273e 2e69 6e64 6578  /' -> '_'>.index
+00023d50: 2e73 716c 6974 650a 2020 2020 2045 2e67  .sqlite.     E.g
+00023d60: 2e2c 207e 2f2e 7261 7461 726d 6f75 6e74  ., ~/.ratarmount
+00023d70: 2f5f 6d65 6469 615f 6364 726f 6d5f 7072  /_media_cdrom_pr
+00023d80: 6f67 7261 6d6d 2e74 6172 2e69 6e64 6578  ogramm.tar.index
+00023d90: 2e73 716c 6974 650a 0a54 6869 7320 6c69  .sqlite..This li
+00023da0: 7374 206f 6620 6661 6c6c 6261 636b 2066  st of fallback f
+00023db0: 6f6c 6465 7273 2063 616e 2062 6520 6f76  olders can be ov
+00023dc0: 6572 7772 6974 7465 6e20 7573 696e 6720  erwritten using 
+00023dd0: 7468 6520 602d 2d69 6e64 6578 2d66 6f6c  the `--index-fol
+00023de0: 6465 7273 600a 6f70 7469 6f6e 2e20 4675  ders`.option. Fu
+00023df0: 7274 6865 726d 6f72 652c 2061 6e20 6578  rthermore, an ex
+00023e00: 706c 6963 6974 6c79 206e 616d 6564 2069  plicitly named i
+00023e10: 6e64 6578 2066 696c 6520 6d61 7920 6265  ndex file may be
+00023e20: 2073 7065 6369 6669 6564 2075 7369 6e67   specified using
+00023e30: 0a74 6865 2060 2d2d 696e 6465 782d 6669  .the `--index-fi
+00023e40: 6c65 6020 6f70 7469 6f6e 2e20 4966 2060  le` option. If `
+00023e50: 2d2d 696e 6465 782d 6669 6c65 6020 6973  --index-file` is
+00023e60: 2075 7365 642c 2074 6865 6e20 7468 6520   used, then the 
+00023e70: 6661 6c6c 6261 636b 0a66 6f6c 6465 7273  fallback.folders
+00023e80: 2c20 696e 636c 7564 696e 6720 7468 6520  , including the 
+00023e90: 6465 6661 756c 7420 6f6e 6573 2c20 7769  default ones, wi
+00023ea0: 6c6c 2062 6520 6967 6e6f 7265 6421 0a0a  ll be ignored!..
+00023eb0: 2320 4269 6e64 204d 6f75 6e74 696e 670a  # Bind Mounting.
+00023ec0: 0a54 6865 206d 6f75 6e74 2073 6f75 7263  .The mount sourc
+00023ed0: 6573 2063 616e 2062 6520 5441 5273 2061  es can be TARs a
+00023ee0: 6e64 2f6f 7220 666f 6c64 6572 732e 2020  nd/or folders.  
+00023ef0: 4265 6361 7573 6520 6f66 2074 6861 742c  Because of that,
+00023f00: 2072 6174 6172 6d6f 756e 740a 6361 6e20   ratarmount.can 
+00023f10: 616c 736f 2062 6520 7573 6564 2074 6f20  also be used to 
+00023f20: 6269 6e64 206d 6f75 6e74 2066 6f6c 6465  bind mount folde
+00023f30: 7273 2072 6561 642d 6f6e 6c79 2074 6f20  rs read-only to 
+00023f40: 616e 6f74 6865 7220 7061 7468 2073 696d  another path sim
+00023f50: 696c 6172 2074 6f0a 6062 696e 6466 7360  ilar to.`bindfs`
+00023f60: 2061 6e64 2060 6d6f 756e 7420 2d2d 6269   and `mount --bi
+00023f70: 6e64 602e 2053 6f2c 2066 6f72 3a0a 0a20  nd`. So, for:.. 
+00023f80: 2020 2072 6174 6172 6d6f 756e 7420 666f     ratarmount fo
+00023f90: 6c64 6572 206d 6f75 6e74 706f 696e 740a  lder mountpoint.
+00023fa0: 0a61 6c6c 2066 696c 6573 2069 6e20 6066  .all files in `f
+00023fb0: 6f6c 6465 7260 2077 696c 6c20 6e6f 7720  older` will now 
+00023fc0: 6265 2076 6973 6962 6c65 2069 6e20 6d6f  be visible in mo
+00023fd0: 756e 7470 6f69 6e74 2e0a 0a23 2055 6e69  untpoint...# Uni
+00023fe0: 6f6e 204d 6f75 6e74 696e 670a 0a49 6620  on Mounting..If 
+00023ff0: 6d75 6c74 6970 6c65 206d 6f75 6e74 2073  multiple mount s
+00024000: 6f75 7263 6573 2061 7265 2073 7065 6369  ources are speci
+00024010: 6669 6564 2c20 7468 6520 736f 7572 6365  fied, the source
+00024020: 7320 6f6e 2074 6865 2072 6967 6874 2073  s on the right s
+00024030: 6964 6520 7769 6c6c 2062 650a 6164 6465  ide will be.adde
+00024040: 6420 746f 206f 7220 7570 6461 7465 2065  d to or update e
+00024050: 7869 7374 696e 6720 6669 6c65 7320 6672  xisting files fr
+00024060: 6f6d 2061 206d 6f75 6e74 2073 6f75 7263  om a mount sourc
+00024070: 6520 6c65 6674 206f 6620 6974 2e20 466f  e left of it. Fo
+00024080: 7220 6578 616d 706c 653a 0a0a 2020 2020  r example:..    
+00024090: 7261 7461 726d 6f75 6e74 2066 6f6c 6465  ratarmount folde
+000240a0: 7231 2066 6f6c 6465 7232 206d 6f75 6e74  r1 folder2 mount
+000240b0: 706f 696e 740a 0a77 696c 6c20 6d61 6b65  point..will make
+000240c0: 2062 6f74 682c 2074 6865 2066 696c 6573   both, the files
+000240d0: 2066 726f 6d20 666f 6c64 6572 3120 616e   from folder1 an
+000240e0: 6420 666f 6c64 6572 322c 2076 6973 6962  d folder2, visib
+000240f0: 6c65 2069 6e20 6d6f 756e 7470 6f69 6e74  le in mountpoint
+00024100: 2e0a 4966 2061 2066 696c 6520 6578 6973  ..If a file exis
+00024110: 7473 2069 6e20 626f 7468 206d 756c 7469  ts in both multi
+00024120: 706c 6520 736f 7572 6365 2c20 7468 656e  ple source, then
+00024130: 2074 6865 2066 696c 6520 6672 6f6d 2074   the file from t
+00024140: 6865 2072 6967 6874 6d6f 7374 0a6d 6f75  he rightmost.mou
+00024150: 6e74 2073 6f75 7263 6520 7769 6c6c 2062  nt source will b
+00024160: 6520 7573 6564 2c20 7768 6963 6820 696e  e used, which in
+00024170: 2074 6865 2061 626f 7665 2065 7861 6d70   the above examp
+00024180: 6c65 2077 6f75 6c64 2062 6520 6066 6f6c  le would be `fol
+00024190: 6465 7232 602e 0a0a 4966 2079 6f75 2077  der2`...If you w
+000241a0: 616e 7420 746f 2075 7064 6174 6520 2f20  ant to update / 
+000241b0: 6f76 6572 7772 6974 6520 6120 666f 6c64  overwrite a fold
+000241c0: 6572 2077 6974 6820 7468 6520 636f 6e74  er with the cont
+000241d0: 656e 7473 206f 6620 6120 6769 7665 6e20  ents of a given 
+000241e0: 5441 522c 0a79 6f75 2063 616e 2073 7065  TAR,.you can spe
+000241f0: 6369 6679 2074 6865 2066 6f6c 6465 7220  cify the folder 
+00024200: 626f 7468 2061 7320 6120 6d6f 756e 7420  both as a mount 
+00024210: 736f 7572 6365 2061 6e64 2061 7320 7468  source and as th
+00024220: 6520 6d6f 756e 7420 706f 696e 743a 0a0a  e mount point:..
+00024230: 2020 2020 7261 7461 726d 6f75 6e74 2066      ratarmount f
+00024240: 6f6c 6465 7220 6669 6c65 2e74 6172 2066  older file.tar f
+00024250: 6f6c 6465 720a 0a54 6865 2046 5553 4520  older..The FUSE 
+00024260: 6f70 7469 6f6e 202d 6f20 6e6f 6e65 6d70  option -o nonemp
+00024270: 7479 2077 696c 6c20 6265 2061 7574 6f6d  ty will be autom
+00024280: 6174 6963 616c 6c79 2061 6464 6564 2069  atically added i
+00024290: 6620 7375 6368 2061 2075 7361 6765 2069  f such a usage i
+000242a0: 730a 6465 7465 6374 6564 2e20 4966 2079  s.detected. If y
+000242b0: 6f75 2069 6e73 7465 6164 2077 616e 7420  ou instead want 
+000242c0: 746f 2075 7064 6174 6520 6120 5441 5220  to update a TAR 
+000242d0: 7769 7468 2061 2066 6f6c 6465 722c 2079  with a folder, y
+000242e0: 6f75 206f 6e6c 7920 6861 7665 2074 6f0a  ou only have to.
+000242f0: 7377 6170 2074 6865 2074 776f 206d 6f75  swap the two mou
+00024300: 6e74 2073 6f75 7263 6573 3a0a 0a20 2020  nt sources:..   
+00024310: 2072 6174 6172 6d6f 756e 7420 6669 6c65   ratarmount file
+00024320: 2e74 6172 2066 6f6c 6465 7220 666f 6c64  .tar folder fold
+00024330: 6572 0a0a 2320 4669 6c65 2076 6572 7369  er..# File versi
+00024340: 6f6e 730a 0a49 6620 6120 6669 6c65 2065  ons..If a file e
+00024350: 7869 7374 7320 6d75 6c74 6970 6c65 2074  xists multiple t
+00024360: 696d 6573 2069 6e20 6120 5441 5220 6f72  imes in a TAR or
+00024370: 2069 6e20 6d75 6c74 6970 6c65 206d 6f75   in multiple mou
+00024380: 6e74 2073 6f75 7263 6573 2c20 7468 656e  nt sources, then
+00024390: 0a74 6865 2068 6964 6465 6e20 7665 7273  .the hidden vers
+000243a0: 696f 6e73 2063 616e 2062 6520 6163 6365  ions can be acce
+000243b0: 7373 6564 2074 6872 6f75 6768 2073 7065  ssed through spe
+000243c0: 6369 616c 203c 6669 6c65 3e2e 7665 7273  cial <file>.vers
+000243d0: 696f 6e73 2066 6f6c 6465 7273 2e0a 466f  ions folders..Fo
+000243e0: 7220 6578 616d 706c 652c 2063 6f6e 7369  r example, consi
+000243f0: 6465 723a 0a0a 2020 2020 7261 7461 726d  der:..    ratarm
+00024400: 6f75 6e74 2066 6f6c 6465 7220 7570 6461  ount folder upda
+00024410: 7465 642e 7461 7220 6d6f 756e 7470 6f69  ted.tar mountpoi
+00024420: 6e74 0a0a 616e 6420 7468 6520 6669 6c65  nt..and the file
+00024430: 2060 666f 6f60 2065 7869 7374 7320 626f   `foo` exists bo
+00024440: 7468 2069 6e20 7468 6520 666f 6c64 6572  th in the folder
+00024450: 2061 6e64 2061 7320 7477 6f20 6469 6666   and as two diff
+00024460: 6572 656e 7420 7665 7273 696f 6e73 0a69  erent versions.i
+00024470: 6e20 6075 7064 6174 6564 2e74 6172 602e  n `updated.tar`.
+00024480: 2054 6865 6e2c 2079 6f75 2063 616e 206c   Then, you can l
+00024490: 6973 7420 616c 6c20 7468 7265 6520 7665  ist all three ve
+000244a0: 7273 696f 6e73 2075 7369 6e67 3a0a 0a20  rsions using:.. 
+000244b0: 2020 206c 7320 2d6c 6120 6d6f 756e 7470     ls -la mountp
+000244c0: 6f69 6e74 2f66 6f6f 2e76 6572 7369 6f6e  oint/foo.version
+000244d0: 732f 0a20 2020 2020 2020 2064 722d 7872  s/.        dr-xr
+000244e0: 2d78 722d 7820 3220 7573 6572 2067 726f  -xr-x 2 user gro
+000244f0: 7570 2020 2020 2030 2041 7072 2032 3520  up     0 Apr 25 
+00024500: 3231 3a34 3120 2e0a 2020 2020 2020 2020  21:41 ..        
+00024510: 6472 2d78 2d2d 2d2d 2d2d 2032 2075 7365  dr-x------ 2 use
+00024520: 7220 6772 6f75 7020 3130 3234 3020 4170  r group 10240 Ap
+00024530: 7220 3236 2031 353a 3539 202e 2e0a 2020  r 26 15:59 ...  
+00024540: 2020 2020 2020 2d72 2d78 2d2d 2d2d 2d2d        -r-x------
+00024550: 2032 2075 7365 7220 6772 6f75 7020 2020   2 user group   
+00024560: 3132 3320 4170 7220 3235 2032 313a 3431  123 Apr 25 21:41
+00024570: 2031 0a20 2020 2020 2020 202d 722d 782d   1.        -r-x-
+00024580: 2d2d 2d2d 2d20 3220 7573 6572 2067 726f  ----- 2 user gro
+00024590: 7570 2020 2032 3536 2041 7072 2032 3520  up   256 Apr 25 
+000245a0: 3231 3a35 3320 320a 2020 2020 2020 2020  21:53 2.        
+000245b0: 2d72 2d78 2d2d 2d2d 2d2d 2032 2075 7365  -r-x------ 2 use
+000245c0: 7220 6772 6f75 7020 2031 3032 3420 4170  r group  1024 Ap
+000245d0: 7220 3235 2032 323a 3133 2033 0a0a 496e  r 25 22:13 3..In
+000245e0: 2074 6869 7320 6578 616d 706c 652c 2074   this example, t
+000245f0: 6865 206f 6c64 6573 7420 7665 7273 696f  he oldest versio
+00024600: 6e20 6861 7320 6f6e 6c79 2031 3233 2062  n has only 123 b
+00024610: 7974 6573 2077 6869 6c65 2074 6865 206e  ytes while the n
+00024620: 6577 6573 7420 616e 640a 6279 2064 6566  ewest and.by def
+00024630: 6175 6c74 2073 686f 776e 2076 6572 7369  ault shown versi
+00024640: 6f6e 2068 6173 2031 3032 3420 6279 7465  on has 1024 byte
+00024650: 732e 2053 6f2c 2069 6e20 6f72 6465 7220  s. So, in order 
+00024660: 746f 206c 6f6f 6b20 6174 2074 6865 206f  to look at the o
+00024670: 6c64 6573 740a 7665 7273 696f 6e2c 2079  ldest.version, y
+00024680: 6f75 2063 616e 2073 696d 706c 7920 646f  ou can simply do
+00024690: 3a0a 0a20 2020 2063 6174 206d 6f75 6e74  :..    cat mount
+000246a0: 706f 696e 742f 666f 6f2e 7665 7273 696f  point/foo.versio
+000246b0: 6e73 2f31 0a0a 4e6f 7465 2074 6861 7420  ns/1..Note that 
+000246c0: 7468 6573 6520 7665 7273 696f 6e20 6e75  these version nu
+000246d0: 6d62 6572 7320 6172 6520 7468 6520 7361  mbers are the sa
+000246e0: 6d65 2061 7320 7768 656e 2075 7365 6420  me as when used 
+000246f0: 7769 7468 2074 6172 2773 0a60 2d2d 6f63  with tar's.`--oc
+00024700: 6375 7272 656e 6365 3d4e 6020 6f70 7469  currence=N` opti
+00024710: 6f6e 2e0a 0a23 2320 5072 6566 6978 2052  on...## Prefix R
+00024720: 656d 6f76 616c 0a0a 5573 6520 6072 6174  emoval..Use `rat
+00024730: 6172 6d6f 756e 7420 2d6f 206d 6f64 756c  armount -o modul
+00024740: 6573 3d73 7562 6469 722c 7375 6264 6972  es=subdir,subdir
+00024750: 3d3c 7072 6566 6978 3e60 2074 6f20 7265  =<prefix>` to re
+00024760: 6d6f 7665 2070 6174 6820 7072 6566 6978  move path prefix
+00024770: 6573 0a75 7369 6e67 2074 6865 2046 5553  es.using the FUS
+00024780: 4520 6073 7562 6469 7260 206d 6f64 756c  E `subdir` modul
+00024790: 652e 2042 6563 6175 7365 2069 7420 6973  e. Because it is
+000247a0: 2061 2073 7461 6e64 6172 6420 4655 5345   a standard FUSE
+000247b0: 2066 6561 7475 7265 2c20 7468 650a 602d   feature, the.`-
+000247c0: 6f20 2e2e 2e60 2061 7267 756d 656e 7420  o ...` argument 
+000247d0: 7368 6f75 6c64 2061 6c73 6f20 776f 726b  should also work
+000247e0: 2066 6f72 206f 7468 6572 2046 5553 4520   for other FUSE 
+000247f0: 6170 706c 6963 6174 696f 6e73 2e0a 0a57  applications...W
+00024800: 6865 6e20 6d6f 756e 7469 6e67 2061 6e20  hen mounting an 
+00024810: 6172 6368 6976 6520 6372 6561 7465 6420  archive created 
+00024820: 7769 7468 2061 6273 6f6c 7574 6520 7061  with absolute pa
+00024830: 7468 732c 2065 2e67 2e2c 0a60 7461 7220  ths, e.g.,.`tar 
+00024840: 2d50 2063 6620 2f76 6172 2f6c 6f67 2f61  -P cf /var/log/a
+00024850: 7074 2f68 6973 746f 7279 2e6c 6f67 602c  pt/history.log`,
+00024860: 2079 6f75 2077 6f75 6c64 2073 6565 2074   you would see t
+00024870: 6865 2077 686f 6c65 2060 7661 722f 6c6f  he whole `var/lo
+00024880: 672f 6170 7460 0a68 6965 7261 7263 6879  g/apt`.hierarchy
+00024890: 2075 6e64 6572 2074 6865 206d 6f75 6e74   under the mount
+000248a0: 2070 6f69 6e74 2e20 546f 2061 766f 6964   point. To avoid
+000248b0: 2074 6861 742c 2073 7065 6369 6669 6564   that, specified
+000248c0: 2070 7265 6669 7865 7320 6361 6e20 6265   prefixes can be
+000248d0: 0a73 7472 6970 7065 6420 6672 6f6d 2070  .stripped from p
+000248e0: 6174 6873 2073 6f20 7468 6174 2074 6865  aths so that the
+000248f0: 206d 6f75 6e74 2074 6172 6765 7420 6469   mount target di
+00024900: 7265 6374 6f72 7920 2a2a 6469 7265 6374  rectory **direct
+00024910: 6c79 2a2a 2063 6f6e 7461 696e 730a 6068  ly** contains.`h
+00024920: 6973 746f 7279 2e6c 6f67 602e 2055 7365  istory.log`. Use
+00024930: 2060 7261 7461 726d 6f75 6e74 202d 6f20   `ratarmount -o 
+00024940: 6d6f 6475 6c65 733d 7375 6264 6972 2c73  modules=subdir,s
+00024950: 7562 6469 723d 2f76 6172 2f6c 6f67 2f61  ubdir=/var/log/a
+00024960: 7074 2f60 2074 6f20 646f 0a73 6f2e 2054  pt/` to do.so. T
+00024970: 6865 2073 7065 6369 6669 6564 2070 6174  he specified pat
+00024980: 6820 746f 2074 6865 2066 6f6c 6465 7220  h to the folder 
+00024990: 696e 7369 6465 2074 6865 2054 4152 2077  inside the TAR w
+000249a0: 696c 6c20 6265 206d 6f75 6e74 6564 2074  ill be mounted t
+000249b0: 6f20 726f 6f74 2c0a 692e 652e 2c20 7468  o root,.i.e., th
+000249c0: 6520 6d6f 756e 7420 706f 696e 742e 0a0a  e mount point...
+000249d0: 2320 436f 6d70 7265 7373 6564 206e 6f6e  # Compressed non
+000249e0: 2d54 4152 2066 696c 6573 0a0a 4966 2079  -TAR files..If y
+000249f0: 6f75 2077 616e 7420 6120 636f 6d70 7265  ou want a compre
+00024a00: 7373 6564 2066 696c 6520 6e6f 7420 636f  ssed file not co
+00024a10: 6e74 6169 6e69 6e67 2061 2054 4152 2c20  ntaining a TAR, 
+00024a20: 652e 672e 2c20 6066 6f6f 2e62 7a32 602c  e.g., `foo.bz2`,
+00024a30: 2074 6865 6e0a 796f 7520 6361 6e20 616c   then.you can al
+00024a40: 736f 2075 7365 2072 6174 6172 6d6f 756e  so use ratarmoun
+00024a50: 7420 666f 7220 7468 6174 2e20 5468 6520  t for that. The 
+00024a60: 756e 636f 6d70 7265 7373 6564 2076 6965  uncompressed vie
+00024a70: 7720 7769 6c6c 2074 6865 6e20 6265 0a6d  w will then be.m
+00024a80: 6f75 6e74 6564 2074 6f20 603c 6d6f 756e  ounted to `<moun
+00024a90: 7470 6f69 6e74 3e2f 666f 6f60 2061 6e64  tpoint>/foo` and
+00024aa0: 2079 6f75 2077 696c 6c20 6265 2061 626c   you will be abl
+00024ab0: 6520 746f 206c 6576 6572 6167 6520 7261  e to leverage ra
+00024ac0: 7461 726d 6f75 6e74 2773 0a73 6565 6b69  tarmount's.seeki
+00024ad0: 6e67 2063 6170 6162 696c 6974 6965 7320  ng capabilities 
+00024ae0: 7768 656e 206f 7065 6e69 6e67 2074 6861  when opening tha
+00024af0: 7420 6669 6c65 2e0a 2727 272c 0a20 2020  t file..''',.   
+00024b00: 2029 0a0a 2020 2020 2320 666d 743a 206f   )..    # fmt: o
+00024b10: 6666 0a20 2020 2070 6172 7365 722e 6164  ff.    parser.ad
+00024b20: 645f 6172 6775 6d65 6e74 280a 2020 2020  d_argument(.    
+00024b30: 2020 2020 272d 6627 2c20 272d 2d66 6f72      '-f', '--for
+00024b40: 6567 726f 756e 6427 2c20 6163 7469 6f6e  eground', action
+00024b50: 3d27 7374 6f72 655f 7472 7565 272c 2064  ='store_true', d
+00024b60: 6566 6175 6c74 203d 2046 616c 7365 2c0a  efault = False,.
+00024b70: 2020 2020 2020 2020 6865 6c70 203d 2027          help = '
+00024b80: 4b65 6570 7320 7468 6520 7079 7468 6f6e  Keeps the python
+00024b90: 2070 726f 6772 616d 2069 6e20 666f 7265   program in fore
+00024ba0: 6772 6f75 6e64 2073 6f20 6974 2063 616e  ground so it can
+00024bb0: 2070 7269 6e74 2064 6562 7567 2027 0a20   print debug '. 
+00024bc0: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+00024bd0: 7574 7075 7420 7768 656e 2074 6865 206d  utput when the m
+00024be0: 6f75 6e74 6564 2070 6174 6820 6973 2061  ounted path is a
+00024bf0: 6363 6573 7365 642e 2720 290a 0a20 2020  ccessed.' )..   
+00024c00: 2070 6172 7365 722e 6164 645f 6172 6775   parser.add_argu
+00024c10: 6d65 6e74 280a 2020 2020 2020 2020 272d  ment(.        '-
+00024c20: 6427 2c20 272d 2d64 6562 7567 272c 2074  d', '--debug', t
+00024c30: 7970 6520 3d20 696e 742c 2064 6566 6175  ype = int, defau
+00024c40: 6c74 203d 2070 7269 6e74 4465 6275 672c  lt = printDebug,
+00024c50: 0a20 2020 2020 2020 2068 656c 7020 3d20  .        help = 
+00024c60: 2753 6574 7320 7468 6520 6465 6275 6767  'Sets the debugg
+00024c70: 696e 6720 6c65 7665 6c2e 2048 6967 6865  ing level. Highe
+00024c80: 7220 6d65 616e 7320 6d6f 7265 206f 7574  r means more out
+00024c90: 7075 742e 2043 7572 7265 6e74 6c79 2c20  put. Currently, 
+00024ca0: 3320 6973 2074 6865 2068 6967 6865 7374  3 is the highest
+00024cb0: 2e27 2029 0a0a 2020 2020 7061 7273 6572  .' )..    parser
+00024cc0: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
+00024cd0: 2020 2020 2020 2027 2d63 272c 2027 2d2d         '-c', '--
+00024ce0: 7265 6372 6561 7465 2d69 6e64 6578 272c  recreate-index',
+00024cf0: 2061 6374 696f 6e3d 2773 746f 7265 5f74   action='store_t
+00024d00: 7275 6527 2c20 6465 6661 756c 7420 3d20  rue', default = 
+00024d10: 4661 6c73 652c 0a20 2020 2020 2020 2068  False,.        h
+00024d20: 656c 7020 3d20 2749 6620 7370 6563 6966  elp = 'If specif
+00024d30: 6965 642c 2070 7265 2d65 7869 7374 696e  ied, pre-existin
+00024d40: 6720 2e69 6e64 6578 2066 696c 6573 2077  g .index files w
+00024d50: 696c 6c20 6265 2064 656c 6574 6564 2061  ill be deleted a
+00024d60: 6e64 206e 6577 6c79 2063 7265 6174 6564  nd newly created
+00024d70: 2e27 2029 0a0a 2020 2020 7061 7273 6572  .' )..    parser
+00024d80: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
+00024d90: 2020 2020 2020 2027 2d72 272c 2027 2d2d         '-r', '--
+00024da0: 7265 6375 7273 6976 6527 2c20 6163 7469  recursive', acti
+00024db0: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
+00024dc0: 2064 6566 6175 6c74 203d 2046 616c 7365   default = False
+00024dd0: 2c0a 2020 2020 2020 2020 6865 6c70 203d  ,.        help =
+00024de0: 2027 4d6f 756e 7420 5441 5220 6172 6368   'Mount TAR arch
+00024df0: 6976 6573 2069 6e73 6964 6520 7468 6520  ives inside the 
+00024e00: 6d6f 756e 7465 6420 5441 5220 7265 6375  mounted TAR recu
+00024e10: 7273 6976 656c 792e 2027 0a20 2020 2020  rsively. '.     
+00024e20: 2020 2020 2020 2020 2020 274e 6f74 6520            'Note 
+00024e30: 7468 6174 2074 6869 7320 6f6e 6c79 2068  that this only h
+00024e40: 6173 2061 6e20 6566 6665 6374 2077 6865  as an effect whe
+00024e50: 6e20 6372 6561 7469 6e67 2061 6e20 696e  n creating an in
+00024e60: 6465 782e 2027 0a20 2020 2020 2020 2020  dex. '.         
+00024e70: 2020 2020 2020 2749 6620 616e 2069 6e64        'If an ind
+00024e80: 6578 2061 6c72 6561 6479 2065 7869 7374  ex already exist
+00024e90: 732c 2074 6865 6e20 7468 6973 206f 7074  s, then this opt
+00024ea0: 696f 6e20 7769 6c6c 2062 6520 6566 6665  ion will be effe
+00024eb0: 6374 6976 656c 7920 6967 6e6f 7265 642e  ctively ignored.
+00024ec0: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00024ed0: 2020 2752 6563 7265 6174 6520 7468 6520    'Recreate the 
+00024ee0: 696e 6465 7820 6966 2079 6f75 2077 616e  index if you wan
+00024ef0: 7420 6368 616e 6765 2074 6865 2072 6563  t change the rec
+00024f00: 7572 7369 7665 206d 6f75 6e74 696e 6720  ursive mounting 
+00024f10: 706f 6c69 6379 2061 6e79 7761 7973 2e27  policy anyways.'
+00024f20: 2029 0a0a 2020 2020 7061 7273 6572 2e61   )..    parser.a
+00024f30: 6464 5f61 7267 756d 656e 7428 0a20 2020  dd_argument(.   
+00024f40: 2020 2020 2027 2d6c 272c 2027 2d2d 6c61       '-l', '--la
+00024f50: 7a79 272c 2061 6374 696f 6e3d 2773 746f  zy', action='sto
+00024f60: 7265 5f74 7275 6527 2c20 6465 6661 756c  re_true', defaul
+00024f70: 7420 3d20 4661 6c73 652c 0a20 2020 2020  t = False,.     
+00024f80: 2020 2068 656c 7020 3d20 2757 6865 6e20     help = 'When 
+00024f90: 7573 6564 2077 6974 6820 7265 6375 7273  used with recurs
+00024fa0: 6976 656c 7920 6269 6e64 2d6d 6f75 6e74  ively bind-mount
+00024fb0: 6564 2066 6f6c 6465 7273 2c20 5441 5220  ed folders, TAR 
+00024fc0: 6669 6c65 7320 696e 7369 6465 2074 6865  files inside the
+00024fd0: 206d 6f75 6e74 6564 2066 6f6c 6465 7220   mounted folder 
+00024fe0: 7769 6c6c 206f 6e6c 7920 6265 2027 0a20  will only be '. 
+00024ff0: 2020 2020 2020 2020 2020 2020 2020 276d                'm
+00025000: 6f75 6e74 6564 206f 6e20 6669 7273 7420  ounted on first 
+00025010: 6163 6365 7373 2074 6f20 6974 2e27 2029  access to it.' )
+00025020: 0a0a 2020 2020 2320 436f 6e73 6964 6572  ..    # Consider
+00025030: 6174 696f 6e73 2066 6f72 2074 6865 2064  ations for the d
+00025040: 6566 6175 6c74 2076 616c 7565 3a0a 2020  efault value:.  
+00025050: 2020 2320 2020 2d20 7365 656b 2074 696d    #   - seek tim
+00025060: 6573 2066 6f72 2074 6865 2062 7a32 2062  es for the bz2 b
+00025070: 6163 6b65 6e64 2061 7265 2062 6574 7765  ackend are betwe
+00025080: 656e 2030 2e30 3173 2061 6e64 2030 2e31  en 0.01s and 0.1
+00025090: 730a 2020 2020 2320 2020 2d20 7365 656b  s.    #   - seek
+000250a0: 2074 696d 6573 2066 6f72 2074 6865 2067   times for the g
+000250b0: 7a69 7020 6261 636b 656e 6420 6172 6520  zip backend are 
+000250c0: 726f 7567 686c 7920 312f 3130 7468 2063  roughly 1/10th c
+000250d0: 6f6d 7061 7265 6420 746f 2062 7a32 2061  ompared to bz2 a
+000250e0: 7420 6120 6465 6661 756c 7420 7370 6163  t a default spac
+000250f0: 696e 6720 6f66 2034 4d69 420a 2020 2020  ing of 4MiB.    
+00025100: 2320 2020 2020 2d3e 2077 6520 636f 756c  #     -> we coul
+00025110: 6420 646f 2061 2073 7061 6369 6e67 206f  d do a spacing o
+00025120: 6620 3430 4d69 4220 2868 6f77 6576 6572  f 40MiB (however
+00025130: 2074 6865 2063 6f6d 7061 7269 736f 6e20   the comparison 
+00025140: 6172 6520 666f 7220 616e 6f74 6865 7220  are for another 
+00025150: 7465 7374 2061 7263 6869 7665 2c20 736f  test archive, so
+00025160: 2069 7420 6d69 6768 7420 6e6f 7420 6170   it might not ap
+00025170: 706c 7929 0a20 2020 2023 2020 202d 2075  ply).    #   - u
+00025180: 6e67 7a69 7069 6e67 2066 6972 6566 6f78  ngziping firefox
+00025190: 2036 3620 696e 666c 6174 6573 2074 6865   66 inflates the
+000251a0: 2063 6f6d 7072 6573 7365 6420 7369 7a65   compressed size
+000251b0: 206f 6620 3636 4d69 4220 746f 2031 3834   of 66MiB to 184
+000251c0: 4d69 4220 287e 3320 7469 6d65 7320 6d6f  MiB (~3 times mo
+000251d0: 7265 2920 616e 6420 7461 6b65 7320 312e  re) and takes 1.
+000251e0: 3473 206f 6e20 6d79 2050 430a 2020 2020  4s on my PC.    
+000251f0: 2320 2020 2020 2d3e 2074 6f20 6861 7665  #     -> to have
+00025200: 2061 2072 6573 706f 6e73 6520 7469 6d65   a response time
+00025210: 206f 6620 302e 3173 2c20 6974 2077 6f75   of 0.1s, it wou
+00025220: 6c64 2072 6571 7569 7265 2061 2073 7061  ld require a spa
+00025230: 6369 6e67 203c 2031 334d 6942 0a20 2020  cing < 13MiB.   
+00025240: 2023 2020 202d 2074 6865 2067 7a69 7020   #   - the gzip 
+00025250: 696e 6465 7820 7461 6b65 7320 726f 7567  index takes roug
+00025260: 686c 7920 3332 6b69 4220 7065 7220 7365  hly 32kiB per se
+00025270: 656b 2070 6f69 6e74 0a20 2020 2023 2020  ek point.    #  
+00025280: 202d 2074 6865 2062 7a69 7032 2069 6e64   - the bzip2 ind
+00025290: 6578 2074 616b 6573 2072 6f75 6768 6c79  ex takes roughly
+000252a0: 2031 3642 2070 6572 2031 3030 2d39 3030   16B per 100-900
+000252b0: 6b69 4220 6f66 2063 6f6d 7072 6573 7365  kiB of compresse
+000252c0: 6420 6461 7461 0a20 2020 2023 2020 2020  d data.    #    
+000252d0: 202d 3e20 666f 7220 7468 6520 677a 6970   -> for the gzip
+000252e0: 2069 6e64 6578 2074 6f20 6861 7665 2074   index to have t
+000252f0: 6865 2073 616d 6520 7370 6163 6520 6566  he same space ef
+00025300: 6669 6369 656e 6379 2061 7373 756d 696e  ficiency assumin
+00025310: 6720 6120 636f 6d70 7265 7373 696f 6e20  g a compression 
+00025320: 7261 7469 6f20 6f66 206f 6e6c 7920 312c  ratio of only 1,
+00025330: 0a20 2020 2023 2020 2020 2020 2020 7468  .    #        th
+00025340: 6520 7370 6163 696e 6720 776f 756c 6420  e spacing would 
+00025350: 6861 7665 2074 6f20 6265 2031 3830 304d  have to be 1800M
+00025360: 6942 2061 7420 7768 6963 6820 706f 696e  iB at which poin
+00025370: 7420 6974 2077 6f75 6c64 2062 6563 6f6d  t it would becom
+00025380: 6520 616c 6d6f 7374 2075 7365 6c65 7373  e almost useless
+00025390: 0a20 2020 2070 6172 7365 722e 6164 645f  .    parser.add_
+000253a0: 6172 6775 6d65 6e74 280a 2020 2020 2020  argument(.      
+000253b0: 2020 272d 6773 272c 2027 2d2d 677a 6970    '-gs', '--gzip
+000253c0: 2d73 6565 6b2d 706f 696e 742d 7370 6163  -seek-point-spac
+000253d0: 696e 6727 2c20 7479 7065 203d 2066 6c6f  ing', type = flo
+000253e0: 6174 2c20 6465 6661 756c 7420 3d20 3136  at, default = 16
+000253f0: 2c0a 2020 2020 2020 2020 6865 6c70 203d  ,.        help =
+00025400: 0a20 2020 2020 2020 2027 5468 6973 206f  .        'This o
+00025410: 6e6c 7920 6973 2061 7070 6c69 6564 2077  nly is applied w
+00025420: 6865 6e20 7468 6520 696e 6465 7820 6973  hen the index is
+00025430: 2066 6972 7374 2063 7265 6174 6564 206f   first created o
+00025440: 7220 7265 6372 6561 7465 6420 7769 7468  r recreated with
+00025450: 2074 6865 202d 6320 6f70 7469 6f6e 2e20   the -c option. 
+00025460: 270a 2020 2020 2020 2020 2754 6865 2073  '.        'The s
+00025470: 7061 6369 6e67 2067 6976 656e 2069 6e20  pacing given in 
+00025480: 4d69 4220 7370 6563 6966 6965 7320 7468  MiB specifies th
+00025490: 6520 7365 656b 2070 6f69 6e74 2064 6973  e seek point dis
+000254a0: 7461 6e63 6520 696e 2074 6865 2075 6e63  tance in the unc
+000254b0: 6f6d 7072 6573 7365 6420 6461 7461 2e20  ompressed data. 
+000254c0: 270a 2020 2020 2020 2020 2741 2064 6973  '.        'A dis
+000254d0: 7461 6e63 6520 6f66 2031 364d 6942 206d  tance of 16MiB m
+000254e0: 6561 6e73 2074 6861 7420 6172 6368 6976  eans that archiv
+000254f0: 6573 2073 6d61 6c6c 6572 2074 6861 6e20  es smaller than 
+00025500: 3136 4d69 4220 696e 2075 6e63 6f6d 7072  16MiB in uncompr
+00025510: 6573 7365 6420 7369 7a65 2077 696c 6c20  essed size will 
+00025520: 270a 2020 2020 2020 2020 276e 6f74 2062  '.        'not b
+00025530: 656e 6566 6974 2066 726f 6d20 6661 7374  enefit from fast
+00025540: 6572 2073 6565 6b20 7469 6d65 732e 2041  er seek times. A
+00025550: 2073 6565 6b20 706f 696e 7420 7461 6b65   seek point take
+00025560: 7320 726f 7567 686c 7920 3332 6b69 422e  s roughly 32kiB.
+00025570: 2027 0a20 2020 2020 2020 2027 536f 2c20   '.        'So, 
+00025580: 736d 616c 6c65 7220 6469 7374 616e 6365  smaller distance
+00025590: 7320 6c65 6164 2074 6f20 6d6f 7265 2072  s lead to more r
+000255a0: 6573 706f 6e73 6976 6520 7365 656b 696e  esponsive seekin
+000255b0: 6720 6275 7420 6d61 7920 6578 706c 6f64  g but may explod
+000255c0: 6520 7468 6520 696e 6465 7820 7369 7a65  e the index size
+000255d0: 2127 2029 0a0a 2020 2020 7061 7273 6572  !' )..    parser
+000255e0: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
+000255f0: 2020 2020 2020 2027 2d70 272c 2027 2d2d         '-p', '--
+00025600: 7072 6566 6978 272c 2074 7970 6520 3d20  prefix', type = 
+00025610: 7374 722c 2064 6566 6175 6c74 203d 2027  str, default = '
+00025620: 272c 0a20 2020 2020 2020 2068 656c 7020  ',.        help 
+00025630: 3d20 275b 6465 7072 6563 6174 6564 5d20  = '[deprecated] 
+00025640: 5573 6520 222d 6f20 6d6f 6475 6c65 733d  Use "-o modules=
+00025650: 7375 6264 6972 2c73 7562 6469 723d 3c70  subdir,subdir=<p
+00025660: 7265 6669 783e 2220 696e 7374 6561 642e  refix>" instead.
+00025670: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00025680: 2020 2754 6869 7320 7374 616e 6461 7264    'This standard
+00025690: 2077 6179 2075 7469 6c69 7a65 7320 4655   way utilizes FU
+000256a0: 5345 2069 7473 656c 6620 616e 6420 7769  SE itself and wi
+000256b0: 6c6c 2061 6c73 6f20 776f 726b 2066 6f72  ll also work for
+000256c0: 206f 7468 6572 2046 5553 4520 270a 2020   other FUSE '.  
+000256d0: 2020 2020 2020 2020 2020 2020 2027 6170               'ap
+000256e0: 706c 6963 6174 696f 6e73 2e20 536f 2c20  plications. So, 
+000256f0: 6974 2069 7320 7072 6566 6572 6162 6c65  it is preferable
+00025700: 2065 7665 6e20 6966 2061 2062 6974 206d   even if a bit m
+00025710: 6f72 6520 7665 7262 6f73 652e 270a 2020  ore verbose.'.  
+00025720: 2020 2020 2020 2020 2020 2020 2027 5468               'Th
+00025730: 6520 7370 6563 6966 6965 6420 7061 7468  e specified path
+00025740: 2074 6f20 7468 6520 666f 6c64 6572 2069   to the folder i
+00025750: 6e73 6964 6520 7468 6520 5441 5220 7769  nside the TAR wi
+00025760: 6c6c 2062 6520 6d6f 756e 7465 6420 746f  ll be mounted to
+00025770: 2072 6f6f 742e 2027 0a20 2020 2020 2020   root. '.       
+00025780: 2020 2020 2020 2020 2754 6869 7320 6361          'This ca
+00025790: 6e20 6265 2075 7365 6675 6c20 7768 656e  n be useful when
+000257a0: 2074 6865 2061 7263 6869 7665 2061 7320   the archive as 
+000257b0: 6372 6561 7465 6420 7769 7468 2061 6273  created with abs
+000257c0: 6f6c 7574 6520 7061 7468 732e 2027 0a20  olute paths. '. 
+000257d0: 2020 2020 2020 2020 2020 2020 2020 2745                'E
+000257e0: 2e67 2e2c 2066 6f72 2061 6e20 6172 6368  .g., for an arch
+000257f0: 6976 6520 6372 6561 7465 6420 7769 7468  ive created with
+00025800: 2060 7461 7220 2d50 2063 6620 2f76 6172   `tar -P cf /var
+00025810: 2f6c 6f67 2f61 7074 2f68 6973 746f 7279  /log/apt/history
+00025820: 2e6c 6f67 602c 2027 0a20 2020 2020 2020  .log`, '.       
+00025830: 2020 2020 2020 2020 272d 7020 2f76 6172          '-p /var
+00025840: 2f6c 6f67 2f61 7074 2f20 6361 6e20 6265  /log/apt/ can be
+00025850: 2073 7065 6369 6669 6564 2073 6f20 7468   specified so th
+00025860: 6174 2074 6865 206d 6f75 6e74 2074 6172  at the mount tar
+00025870: 6765 7420 6469 7265 6374 6f72 7920 270a  get directory '.
+00025880: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00025890: 3e64 6972 6563 746c 793c 2063 6f6e 7461  >directly< conta
+000258a0: 696e 7320 6869 7374 6f72 792e 6c6f 672e  ins history.log.
+000258b0: 2720 290a 0a20 2020 2070 6172 7365 722e  ' )..    parser.
+000258c0: 6164 645f 6172 6775 6d65 6e74 280a 2020  add_argument(.  
+000258d0: 2020 2020 2020 272d 2d70 6173 7377 6f72        '--passwor
+000258e0: 6427 2c20 7479 7065 203d 2073 7472 2c20  d', type = str, 
+000258f0: 6465 6661 756c 7420 3d20 2727 2c0a 2020  default = '',.  
+00025900: 2020 2020 2020 6865 6c70 203d 2027 5370        help = 'Sp
+00025910: 6563 6966 7920 6120 7369 6e67 6c65 2070  ecify a single p
+00025920: 6173 7377 6f72 6420 7768 6963 6820 7368  assword which sh
+00025930: 616c 6c20 6265 2075 7365 6420 666f 7220  all be used for 
+00025940: 5241 5220 616e 6420 5a49 5020 6669 6c65  RAR and ZIP file
+00025950: 732e 2720 290a 0a20 2020 2070 6172 7365  s.' )..    parse
+00025960: 722e 6164 645f 6172 6775 6d65 6e74 280a  r.add_argument(.
+00025970: 2020 2020 2020 2020 272d 2d70 6173 7377          '--passw
+00025980: 6f72 642d 6669 6c65 272c 2074 7970 6520  ord-file', type 
+00025990: 3d20 7374 722c 2064 6566 6175 6c74 203d  = str, default =
+000259a0: 2027 272c 0a20 2020 2020 2020 2068 656c   '',.        hel
+000259b0: 7020 3d20 2753 7065 6369 6679 2061 2066  p = 'Specify a f
+000259c0: 696c 6520 7769 7468 206e 6577 6c69 6e65  ile with newline
+000259d0: 2073 6570 6172 6174 6564 2070 6173 7377   separated passw
+000259e0: 6f72 6473 2066 6f72 2052 4152 2061 6e64  ords for RAR and
+000259f0: 205a 4950 2066 696c 6573 2e20 270a 2020   ZIP files. '.  
+00025a00: 2020 2020 2020 2020 2020 2020 2027 5468               'Th
+00025a10: 6520 7061 7373 776f 7264 7320 7769 6c6c  e passwords will
+00025a20: 2062 6520 7472 6965 6420 6f75 7420 696e   be tried out in
+00025a30: 206f 7264 6572 206f 6620 6170 7065 6172   order of appear
+00025a40: 616e 6365 2069 6e20 7468 6520 6669 6c65  ance in the file
+00025a50: 2e27 2029 0a0a 2020 2020 7061 7273 6572  .' )..    parser
+00025a60: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
+00025a70: 2020 2020 2020 2027 2d65 272c 2027 2d2d         '-e', '--
+00025a80: 656e 636f 6469 6e67 272c 2074 7970 6520  encoding', type 
+00025a90: 3d20 7374 722c 2064 6566 6175 6c74 203d  = str, default =
+00025aa0: 2074 6172 6669 6c65 2e45 4e43 4f44 494e   tarfile.ENCODIN
+00025ab0: 472c 0a20 2020 2020 2020 2068 656c 7020  G,.        help 
+00025ac0: 3d20 2753 7065 6369 6679 2061 6e20 696e  = 'Specify an in
+00025ad0: 7075 7420 656e 636f 6469 6e67 2075 7365  put encoding use
+00025ae0: 6420 666f 7220 6669 6c65 206e 616d 6573  d for file names
+00025af0: 2061 6d6f 6e67 206f 7468 6572 7320 696e   among others in
+00025b00: 2074 6865 2054 4152 2e20 270a 2020 2020   the TAR. '.    
+00025b10: 2020 2020 2020 2020 2020 2027 5468 6973             'This
+00025b20: 206d 7573 7420 6265 2075 7365 6420 7768   must be used wh
+00025b30: 656e 2c20 652e 672e 2c20 7472 7969 6e67  en, e.g., trying
+00025b40: 2074 6f20 6f70 656e 2061 206c 6174 696e   to open a latin
+00025b50: 3120 656e 636f 6465 6420 5441 5220 6f6e  1 encoded TAR on
+00025b60: 2061 6e20 5554 462d 3820 7379 7374 656d   an UTF-8 system
+00025b70: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
+00025b80: 2020 2027 506f 7373 6962 6c65 2065 6e63     'Possible enc
+00025b90: 6f64 696e 6773 3a20 6874 7470 733a 2f2f  odings: https://
+00025ba0: 646f 6373 2e70 7974 686f 6e2e 6f72 672f  docs.python.org/
+00025bb0: 332f 6c69 6272 6172 792f 636f 6465 6373  3/library/codecs
+00025bc0: 2e68 746d 6c23 7374 616e 6461 7264 2d65  .html#standard-e
+00025bd0: 6e63 6f64 696e 6773 2720 290a 0a20 2020  ncodings' )..   
+00025be0: 2070 6172 7365 722e 6164 645f 6172 6775   parser.add_argu
+00025bf0: 6d65 6e74 280a 2020 2020 2020 2020 272d  ment(.        '-
+00025c00: 6927 2c20 272d 2d69 676e 6f72 652d 7a65  i', '--ignore-ze
+00025c10: 726f 7327 2c20 6163 7469 6f6e 203d 2027  ros', action = '
+00025c20: 7374 6f72 655f 7472 7565 272c 0a20 2020  store_true',.   
+00025c30: 2020 2020 2068 656c 7020 3d20 2749 676e       help = 'Ign
+00025c40: 6f72 6520 7a65 726f 6564 2062 6c6f 636b  ore zeroed block
+00025c50: 7320 696e 2061 7263 6869 7665 2e20 4e6f  s in archive. No
+00025c60: 726d 616c 6c79 2c20 7477 6f20 636f 6e73  rmally, two cons
+00025c70: 6563 7574 6976 6520 3531 322d 626c 6f63  ecutive 512-bloc
+00025c80: 6b73 2066 696c 6c65 6420 7769 7468 207a  ks filled with z
+00025c90: 6572 6f65 7320 6d65 616e 2045 4f46 2027  eroes mean EOF '
+00025ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025cb0: 2761 6e64 2072 6174 6172 6d6f 756e 7420  'and ratarmount 
+00025cc0: 7374 6f70 7320 7265 6164 696e 6720 6166  stops reading af
+00025cd0: 7465 7220 656e 636f 756e 7465 7269 6e67  ter encountering
+00025ce0: 2074 6865 6d2e 2054 6869 7320 6f70 7469   them. This opti
+00025cf0: 6f6e 2069 6e73 7472 7563 7473 2069 7420  on instructs it 
+00025d00: 746f 2072 6561 6420 6675 7274 6865 7220  to read further 
+00025d10: 616e 6420 270a 2020 2020 2020 2020 2020  and '.          
+00025d20: 2020 2020 2027 6973 2075 7365 6675 6c20       'is useful 
+00025d30: 7768 656e 2072 6561 6469 6e67 2061 7263  when reading arc
+00025d40: 6869 7665 7320 6372 6561 7465 6420 7769  hives created wi
+00025d50: 7468 2074 6865 202d 4120 6f70 7469 6f6e  th the -A option
+00025d60: 2e27 2029 0a0a 2020 2020 7061 7273 6572  .' )..    parser
+00025d70: 2e61 6464 5f61 7267 756d 656e 7428 0a20  .add_argument(. 
+00025d80: 2020 2020 2020 2027 2d2d 7665 7269 6679         '--verify
+00025d90: 2d6d 7469 6d65 272c 2061 6374 696f 6e20  -mtime', action 
+00025da0: 3d20 2773 746f 7265 5f74 7275 6527 2c0a  = 'store_true',.
+00025db0: 2020 2020 2020 2020 6865 6c70 203d 2027          help = '
+00025dc0: 4279 2064 6566 6175 6c74 2c20 6f6e 6c79  By default, only
+00025dd0: 2074 6865 2054 4152 2066 696c 6520 7369   the TAR file si
+00025de0: 7a65 2069 7320 6368 6563 6b65 6420 746f  ze is checked to
+00025df0: 206d 6174 6368 2074 6865 206f 6e65 2069   match the one i
+00025e00: 6e20 7468 6520 666f 756e 6420 6578 6973  n the found exis
+00025e10: 7469 6e67 2072 6174 6172 6d6f 756e 7420  ting ratarmount 
+00025e20: 696e 6465 782e 2027 0a20 2020 2020 2020  index. '.       
+00025e30: 2020 2020 2020 2020 2749 6620 7468 6973          'If this
+00025e40: 206f 7074 696f 6e20 6973 2073 7065 6369   option is speci
+00025e50: 6669 6564 2c20 7468 656e 2061 6c73 6f20  fied, then also 
+00025e60: 6368 6563 6b20 7468 6520 6d6f 6469 6669  check the modifi
+00025e70: 6361 7469 6f6e 2074 696d 6573 7461 6d70  cation timestamp
+00025e80: 2e20 4275 7420 6265 7761 7265 2074 6861  . But beware tha
+00025e90: 7420 7468 6520 6d74 696d 6520 270a 2020  t the mtime '.  
+00025ea0: 2020 2020 2020 2020 2020 2020 2027 6d69               'mi
+00025eb0: 6768 7420 6368 616e 6765 2064 7572 696e  ght change durin
+00025ec0: 6720 636f 7079 696e 6720 6f72 2064 6f77  g copying or dow
+00025ed0: 6e6c 6f61 6469 6e67 2077 6974 686f 7574  nloading without
+00025ee0: 2074 6865 2063 6f6e 7465 6e74 7320 6368   the contents ch
+00025ef0: 616e 6769 6e67 2e20 536f 2c20 7468 6973  anging. So, this
+00025f00: 2063 6865 636b 206d 6967 6874 2063 6175   check might cau
+00025f10: 7365 2027 0a20 2020 2020 2020 2020 2020  se '.           
+00025f20: 2020 2020 2766 616c 7365 2070 6f73 6974      'false posit
+00025f30: 6976 6573 2e27 2029 0a0a 2020 2020 7061  ives.' )..    pa
+00025f40: 7273 6572 2e61 6464 5f61 7267 756d 656e  rser.add_argumen
+00025f50: 7428 0a20 2020 2020 2020 2027 2d73 272c  t(.        '-s',
+00025f60: 2027 2d2d 7374 7269 702d 7265 6375 7273   '--strip-recurs
+00025f70: 6976 652d 7461 722d 6578 7465 6e73 696f  ive-tar-extensio
+00025f80: 6e27 2c20 6163 7469 6f6e 203d 2027 7374  n', action = 'st
+00025f90: 6f72 655f 7472 7565 272c 0a20 2020 2020  ore_true',.     
+00025fa0: 2020 2068 656c 7020 3d20 2749 6620 7472     help = 'If tr
+00025fb0: 7565 2c20 7468 656e 2072 6563 7572 7369  ue, then recursi
+00025fc0: 7665 6c79 206d 6f75 6e74 6564 2054 4152  vely mounted TAR
+00025fd0: 7320 6e61 6d65 6420 3c66 696c 653e 2e74  s named <file>.t
+00025fe0: 6172 2077 696c 6c20 6265 206d 6f75 6e74  ar will be mount
+00025ff0: 6564 2061 7420 3c66 696c 653e 2f2e 2027  ed at <file>/. '
+00026000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026010: 2754 6869 7320 6d69 6768 7420 6c65 6164  'This might lead
+00026020: 2074 6f20 666f 6c64 6572 7320 6f66 2074   to folders of t
+00026030: 6865 2073 616d 6520 6e61 6d65 2062 6569  he same name bei
+00026040: 6e67 206f 7665 7277 7269 7474 656e 2c20  ng overwritten, 
+00026050: 736f 2075 7365 2077 6974 6820 6361 7265  so use with care
+00026060: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
+00026070: 2020 2027 5468 6520 696e 6465 7820 6e65     'The index ne
+00026080: 6564 7320 746f 2062 6520 2872 6529 6372  eds to be (re)cr
+00026090: 6561 7465 6420 746f 2061 7070 6c79 2074  eated to apply t
+000260a0: 6869 7320 6f70 7469 6f6e 2127 2029 0a0a  his option!' )..
+000260b0: 2020 2020 7061 7273 6572 2e61 6464 5f61      parser.add_a
+000260c0: 7267 756d 656e 7428 0a20 2020 2020 2020  rgument(.       
+000260d0: 2027 2d2d 696e 6465 782d 6669 6c65 272c   '--index-file',
+000260e0: 2074 7970 6520 3d20 7374 722c 0a20 2020   type = str,.   
+000260f0: 2020 2020 2068 656c 7020 3d20 2753 7065       help = 'Spe
+00026100: 6369 6679 2061 2070 6174 6820 746f 2074  cify a path to t
+00026110: 6865 202e 696e 6465 782e 7371 6c69 7465  he .index.sqlite
+00026120: 2066 696c 652e 2053 6574 7469 6e67 2074   file. Setting t
+00026130: 6869 7320 7769 6c6c 2064 6973 6162 6c65  his will disable
+00026140: 2066 616c 6c62 6163 6b20 696e 6465 7820   fallback index 
+00026150: 666f 6c64 6572 732e 2027 0a20 2020 2020  folders. '.     
+00026160: 2020 2020 2020 2020 2020 2749 6620 7468            'If th
+00026170: 6520 6769 7665 6e20 7061 7468 2069 7320  e given path is 
+00026180: 223a 6d65 6d6f 7279 3a22 2c20 7468 656e  ":memory:", then
+00026190: 2074 6865 2069 6e64 6578 2077 696c 6c20   the index will 
+000261a0: 6e6f 7420 6265 2077 7269 7474 656e 206f  not be written o
+000261b0: 7574 2074 6f20 6469 736b 2e27 2029 0a0a  ut to disk.' )..
+000261c0: 2020 2020 7061 7273 6572 2e61 6464 5f61      parser.add_a
+000261d0: 7267 756d 656e 7428 0a20 2020 2020 2020  rgument(.       
+000261e0: 2027 2d2d 696e 6465 782d 666f 6c64 6572   '--index-folder
+000261f0: 7327 2c20 6465 6661 756c 7420 3d20 222c  s', default = ",
+00026200: 2220 2b20 6f73 2e70 6174 682e 6a6f 696e  " + os.path.join
+00026210: 2820 227e 222c 2022 2e72 6174 6172 6d6f  ( "~", ".ratarmo
+00026220: 756e 7422 2029 2c0a 2020 2020 2020 2020  unt" ),.        
+00026230: 6865 6c70 203d 2027 5370 6563 6966 7920  help = 'Specify 
+00026240: 6f6e 6520 6f72 206d 756c 7469 706c 6520  one or multiple 
+00026250: 7061 7468 7320 666f 7220 7374 6f72 696e  paths for storin
+00026260: 6720 2e69 6e64 6578 2e73 716c 6974 6520  g .index.sqlite 
+00026270: 6669 6c65 732e 2050 6174 6873 2077 696c  files. Paths wil
+00026280: 6c20 6265 2074 6573 7465 6420 666f 7220  l be tested for 
+00026290: 7375 6974 6162 696c 6974 7920 270a 2020  suitability '.  
+000262a0: 2020 2020 2020 2020 2020 2020 2027 696e               'in
+000262b0: 2074 6865 2067 6976 656e 206f 7264 6572   the given order
+000262c0: 2e20 416e 2065 6d70 7479 2070 6174 6820  . An empty path 
+000262d0: 7769 6c6c 2062 6520 696e 7465 7270 7265  will be interpre
+000262e0: 7465 6420 6173 2074 6865 206c 6f63 6174  ted as the locat
+000262f0: 696f 6e20 696e 2077 6869 6368 2074 6865  ion in which the
+00026300: 2054 4152 2072 6573 6964 6573 2e20 270a   TAR resides. '.
+00026310: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00026320: 4966 2074 6865 2061 7267 756d 656e 7420  If the argument 
+00026330: 6265 6769 6e73 2077 6974 6820 6120 6272  begins with a br
+00026340: 6163 6b65 7420 225b 222c 2074 6865 6e20  acket "[", then 
+00026350: 6974 2077 696c 6c20 6265 2069 6e74 6572  it will be inter
+00026360: 7072 6574 6564 2061 7320 6120 4a53 4f4e  preted as a JSON
+00026370: 2d66 6f72 6d61 7474 6564 206c 6973 742e  -formatted list.
+00026380: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00026390: 2020 2749 6620 7468 6520 6172 6775 6d65    'If the argume
+000263a0: 6e74 2063 6f6e 7461 696e 7320 6120 636f  nt contains a co
+000263b0: 6d6d 6120 222c 222c 2069 7420 7769 6c6c  mma ",", it will
+000263c0: 2062 6520 696e 7465 7270 7265 7465 6420   be interpreted 
+000263d0: 6173 2061 2063 6f6d 6d61 2d73 6570 6172  as a comma-separ
+000263e0: 6174 6564 206c 6973 7420 6f66 2066 6f6c  ated list of fol
+000263f0: 6465 7273 2e20 270a 2020 2020 2020 2020  ders. '.        
+00026400: 2020 2020 2020 2027 456c 7365 2c20 7468         'Else, th
+00026410: 6520 7768 6f6c 6520 7374 7269 6e67 2077  e whole string w
+00026420: 696c 6c20 6265 2069 6e74 6572 7072 6574  ill be interpret
+00026430: 6564 2061 7320 6f6e 6520 666f 6c64 6572  ed as one folder
+00026440: 2070 6174 682e 2045 7861 6d70 6c65 733a   path. Examples:
+00026450: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00026460: 2020 272d 2d69 6e64 6578 2d66 6f6c 6465    '--index-folde
+00026470: 7273 2022 2c7e 2f2e 666f 6f22 2077 696c  rs ",~/.foo" wil
+00026480: 6c20 7472 7920 746f 2073 6176 6520 6265  l try to save be
+00026490: 7369 6465 7320 7468 6520 5441 5220 616e  sides the TAR an
+000264a0: 6420 6966 2074 6861 7420 646f 6573 206e  d if that does n
+000264b0: 6f74 2077 6f72 6b2c 2069 6e20 7e2f 2e66  ot work, in ~/.f
+000264c0: 6f6f 2e20 270a 2020 2020 2020 2020 2020  oo. '.          
+000264d0: 2020 2020 2027 2d2d 696e 6465 782d 666f       '--index-fo
+000264e0: 6c64 6572 7320 5c27 5b22 7e2f 2e72 6174  lders \'["~/.rat
+000264f0: 6172 6d6f 756e 7422 2c20 2266 6f6f 2c39  armount", "foo,9
+00026500: 3030 3022 5d5c 2720 7769 6c6c 206e 6576  000"]\' will nev
+00026510: 6572 2074 7279 2074 6f20 7361 7665 2062  er try to save b
+00026520: 6573 6964 6573 2074 6865 2054 4152 2e20  esides the TAR. 
+00026530: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00026540: 2027 2d2d 696e 6465 782d 666f 6c64 6572   '--index-folder
+00026550: 207e 2f2e 7261 7461 726d 6f75 6e74 2077   ~/.ratarmount w
+00026560: 696c 6c20 6f6e 6c79 2074 6573 7420 7e2f  ill only test ~/
+00026570: 2e72 6174 6172 6d6f 756e 7420 6173 2061  .ratarmount as a
+00026580: 2073 746f 7261 6765 206c 6f63 6174 696f   storage locatio
+00026590: 6e20 616e 6420 6e6f 7468 696e 6720 656c  n and nothing el
+000265a0: 7365 2e20 270a 2020 2020 2020 2020 2020  se. '.          
+000265b0: 2020 2020 2027 496e 7374 6561 642c 2069       'Instead, i
+000265c0: 7420 7769 6c6c 2066 6972 7374 2074 7279  t will first try
+000265d0: 207e 2f2e 7261 7461 726d 6f75 6e74 2061   ~/.ratarmount a
+000265e0: 6e64 2074 6865 2066 6f6c 6465 7220 2266  nd the folder "f
+000265f0: 6f6f 2c39 3030 3022 2e20 2720 290a 0a20  oo,9000". ' ).. 
+00026600: 2020 2070 6172 7365 722e 6164 645f 6172     parser.add_ar
+00026610: 6775 6d65 6e74 280a 2020 2020 2020 2020  gument(.        
+00026620: 272d 6f27 2c20 272d 2d66 7573 6527 2c20  '-o', '--fuse', 
+00026630: 7479 7065 203d 2073 7472 2c20 6465 6661  type = str, defa
+00026640: 756c 7420 3d20 2727 2c0a 2020 2020 2020  ult = '',.      
+00026650: 2020 6865 6c70 203d 2027 436f 6d6d 6120    help = 'Comma 
+00026660: 7365 7061 7261 7465 6420 4655 5345 206f  separated FUSE o
+00026670: 7074 696f 6e73 2e20 5365 6520 226d 616e  ptions. See "man
+00026680: 206d 6f75 6e74 2e66 7573 6522 2066 6f72   mount.fuse" for
+00026690: 2068 656c 702e 2027 0a20 2020 2020 2020   help. '.       
+000266a0: 2020 2020 2020 2020 2745 7861 6d70 6c65          'Example
+000266b0: 3a20 2d2d 6675 7365 2022 616c 6c6f 775f  : --fuse "allow_
+000266c0: 6f74 6865 722c 656e 7472 795f 7469 6d65  other,entry_time
+000266d0: 6f75 743d 322e 382c 6769 643d 3022 2e20  out=2.8,gid=0". 
+000266e0: 2720 290a 0a20 2020 2070 6172 7365 722e  ' )..    parser.
+000266f0: 6164 645f 6172 6775 6d65 6e74 280a 2020  add_argument(.  
+00026700: 2020 2020 2020 272d 5027 2c20 272d 2d70        '-P', '--p
+00026710: 6172 616c 6c65 6c69 7a61 7469 6f6e 272c  arallelization',
+00026720: 2074 7970 6520 3d20 696e 742c 2064 6566   type = int, def
+00026730: 6175 6c74 203d 2031 2c0a 2020 2020 2020  ault = 1,.      
+00026740: 2020 6865 6c70 203d 2027 4966 2061 6e20    help = 'If an 
+00026750: 696e 7465 6765 7220 6f74 6865 7220 7468  integer other th
+00026760: 616e 2031 2069 7320 7370 6563 6966 6965  an 1 is specifie
+00026770: 642c 2074 6865 6e20 7468 6520 7468 7265  d, then the thre
+00026780: 6164 6564 2070 6172 616c 6c65 6c20 627a  aded parallel bz
+00026790: 6970 3220 6465 636f 6465 7220 7769 6c6c  ip2 decoder will
+000267a0: 2062 6520 7573 6564 2027 0a20 2020 2020   be used '.     
+000267b0: 2020 2020 2020 2020 2020 2773 7065 6369            'speci
+000267c0: 6669 6564 2061 6d6f 756e 7420 6f66 2062  fied amount of b
+000267d0: 6c6f 636b 2064 6563 6f64 6572 2074 6872  lock decoder thr
+000267e0: 6561 6473 2e20 4675 7274 6865 7220 7468  eads. Further th
+000267f0: 7265 6164 7320 7769 7468 206c 6967 6874  reads with light
+00026800: 6572 2077 6f72 6b20 6d61 7920 6265 2073  er work may be s
+00026810: 7461 7274 6564 2e20 270a 2020 2020 2020  tarted. '.      
+00026820: 2020 2020 2020 2020 2027 4120 7661 6c75           'A valu
+00026830: 6520 6f66 2030 2077 696c 6c20 7573 6520  e of 0 will use 
+00026840: 616c 6c20 7468 6520 6176 6169 6c61 626c  all the availabl
+00026850: 6520 636f 7265 7320 287b 7d29 2e27 2e66  e cores ({}).'.f
+00026860: 6f72 6d61 7428 6f73 2e63 7075 5f63 6f75  ormat(os.cpu_cou
+00026870: 6e74 2829 2929 0a0a 2020 2020 7061 7273  nt()))..    pars
+00026880: 6572 2e61 6464 5f61 7267 756d 656e 7428  er.add_argument(
+00026890: 0a20 2020 2020 2020 2027 2d76 272c 2027  .        '-v', '
+000268a0: 2d2d 7665 7273 696f 6e27 2c20 6163 7469  --version', acti
+000268b0: 6f6e 3d27 7374 6f72 655f 7472 7565 272c  on='store_true',
+000268c0: 2068 656c 7020 3d20 2750 7269 6e74 2076   help = 'Print v
+000268d0: 6572 7369 6f6e 2073 7472 696e 672e 2720  ersion string.' 
+000268e0: 290a 0a20 2020 2070 6172 7365 722e 6164  )..    parser.ad
+000268f0: 645f 6172 6775 6d65 6e74 280a 2020 2020  d_argument(.    
+00026900: 2020 2020 276d 6f75 6e74 5f73 6f75 7263      'mount_sourc
+00026910: 6527 2c20 6e61 7267 7320 3d20 272b 272c  e', nargs = '+',
+00026920: 0a20 2020 2020 2020 2068 656c 7020 3d20  .        help = 
+00026930: 2754 6865 2070 6174 6820 746f 2074 6865  'The path to the
+00026940: 2054 4152 2061 7263 6869 7665 2074 6f20   TAR archive to 
+00026950: 6265 206d 6f75 6e74 6564 2e20 270a 2020  be mounted. '.  
+00026960: 2020 2020 2020 2020 2020 2020 2027 4966               'If
+00026970: 206d 756c 7469 706c 6520 6172 6368 6976   multiple archiv
+00026980: 6573 2061 6e64 2f6f 7220 666f 6c64 6572  es and/or folder
+00026990: 7320 6172 6520 7370 6563 6966 6965 642c  s are specified,
+000269a0: 2074 6865 6e20 7468 6579 2077 696c 6c20   then they will 
+000269b0: 6265 206d 6f75 6e74 6564 2061 7320 6966  be mounted as if
+000269c0: 2074 6865 2061 7267 756d 656e 7473 2027   the arguments '
+000269d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000269e0: 2763 6f6d 696e 6720 6669 7273 7420 7765  'coming first we
+000269f0: 7265 2075 7064 6174 6564 2077 6974 6820  re updated with 
+00026a00: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
+00026a10: 7468 6520 6172 6368 6976 6573 206f 7220  the archives or 
+00026a20: 666f 6c64 6572 7320 7370 6563 6966 6965  folders specifie
+00026a30: 6420 7468 6572 6561 6674 6572 2c20 270a  d thereafter, '.
+00026a40: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00026a50: 692e 652e 2c20 7468 6520 6c69 7374 206f  i.e., the list o
+00026a60: 6620 5441 5273 2061 6e64 2066 6f6c 6465  f TARs and folde
+00026a70: 7273 2077 696c 6c20 6265 2075 6e69 6f6e  rs will be union
+00026a80: 206d 6f75 6e74 6564 2e27 2029 0a20 2020   mounted.' ).   
+00026a90: 2070 6172 7365 722e 6164 645f 6172 6775   parser.add_argu
+00026aa0: 6d65 6e74 280a 2020 2020 2020 2020 276d  ment(.        'm
+00026ab0: 6f75 6e74 5f70 6f69 6e74 272c 206e 6172  ount_point', nar
+00026ac0: 6773 203d 2027 3f27 2c0a 2020 2020 2020  gs = '?',.      
+00026ad0: 2020 6865 6c70 203d 2027 5468 6520 7061    help = 'The pa
+00026ae0: 7468 2074 6f20 6120 666f 6c64 6572 2074  th to a folder t
+00026af0: 6f20 6d6f 756e 7420 7468 6520 5441 5220  o mount the TAR 
+00026b00: 636f 6e74 656e 7473 2069 6e74 6f2e 2027  contents into. '
+00026b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026b20: 2749 6620 6e6f 206d 6f75 6e74 2070 6174  'If no mount pat
+00026b30: 6820 6973 2073 7065 6369 6669 6564 2c20  h is specified, 
+00026b40: 7468 6520 5441 5220 7769 6c6c 2062 6520  the TAR will be 
+00026b50: 6d6f 756e 7465 6420 746f 2061 2066 6f6c  mounted to a fol
+00026b60: 6465 7220 6f66 2074 6865 2073 616d 6520  der of the same 
+00026b70: 6e61 6d65 2027 0a20 2020 2020 2020 2020  name '.         
+00026b80: 2020 2020 2020 2762 7574 2077 6974 686f        'but witho
+00026b90: 7574 2061 2066 696c 6520 6578 7465 6e73  ut a file extens
+00026ba0: 696f 6e2e 2720 290a 2020 2020 2320 666d  ion.' ).    # fm
+00026bb0: 743a 206f 6e0a 0a20 2020 2061 7267 7320  t: on..    args 
+00026bc0: 3d20 7061 7273 6572 2e70 6172 7365 5f61  = parser.parse_a
+00026bd0: 7267 7328 7261 7741 7267 7329 0a0a 2020  rgs(rawArgs)..  
+00026be0: 2020 6172 6773 2e67 7a69 7053 6565 6b50    args.gzipSeekP
+00026bf0: 6f69 6e74 5370 6163 696e 6720 3d20 6172  ointSpacing = ar
+00026c00: 6773 2e67 7a69 705f 7365 656b 5f70 6f69  gs.gzip_seek_poi
+00026c10: 6e74 5f73 7061 6369 6e67 202a 2031 3032  nt_spacing * 102
+00026c20: 3420 2a20 3130 3234 0a0a 2020 2020 2320  4 * 1024..    # 
+00026c30: 5468 6973 2069 7320 6120 6861 636b 2062  This is a hack b
+00026c40: 7574 2062 6563 6175 7365 2077 6520 6861  ut because we ha
+00026c50: 7665 2074 776f 2070 6f73 6974 696f 6e61  ve two positiona
+00026c60: 6c20 6172 6775 6d65 6e74 7320 2861 6e64  l arguments (and
+00026c70: 2077 616e 7420 7468 6174 2072 6566 6c65   want that refle
+00026c80: 6374 6564 2069 6e20 7468 6520 6175 746f  cted in the auto
+00026c90: 2d67 656e 6572 6174 6564 2068 656c 7029  -generated help)
+00026ca0: 2c0a 2020 2020 2320 616c 6c20 706f 7369  ,.    # all posi
+00026cb0: 7469 6f6e 616c 2061 7267 756d 656e 7473  tional arguments
+00026cc0: 2c20 696e 636c 7564 696e 6720 7468 6520  , including the 
+00026cd0: 6d6f 756e 7470 6174 6820 7769 6c6c 2062  mountpath will b
+00026ce0: 6520 7061 7273 6564 2069 6e74 6f20 7468  e parsed into th
+00026cf0: 6520 7461 7266 696c 6570 6174 6873 206e  e tarfilepaths n
+00026d00: 616d 6573 7061 6365 2061 6e64 2077 6520  amespace and we 
+00026d10: 6861 7665 2074 6f0a 2020 2020 2320 6d61  have to.    # ma
+00026d20: 6e75 616c 6c79 2073 6570 6172 6174 6520  nually separate 
+00026d30: 7468 656d 2064 6570 656e 6469 6e67 206f  them depending o
+00026d40: 6e20 7468 6520 7479 7065 2e0a 2020 2020  n the type..    
+00026d50: 6966 206f 732e 7061 7468 2e69 7364 6972  if os.path.isdir
+00026d60: 2861 7267 732e 6d6f 756e 745f 736f 7572  (args.mount_sour
+00026d70: 6365 5b2d 315d 2920 6f72 206e 6f74 206f  ce[-1]) or not o
+00026d80: 732e 7061 7468 2e65 7869 7374 7328 6172  s.path.exists(ar
+00026d90: 6773 2e6d 6f75 6e74 5f73 6f75 7263 655b  gs.mount_source[
+00026da0: 2d31 5d29 3a0a 2020 2020 2020 2020 6172  -1]):.        ar
+00026db0: 6773 2e6d 6f75 6e74 5f70 6f69 6e74 203d  gs.mount_point =
+00026dc0: 2061 7267 732e 6d6f 756e 745f 736f 7572   args.mount_sour
+00026dd0: 6365 5b2d 315d 0a20 2020 2020 2020 2061  ce[-1].        a
+00026de0: 7267 732e 6d6f 756e 745f 736f 7572 6365  rgs.mount_source
+00026df0: 203d 2061 7267 732e 6d6f 756e 745f 736f   = args.mount_so
+00026e00: 7572 6365 5b3a 2d31 5d0a 2020 2020 6966  urce[:-1].    if
+00026e10: 206e 6f74 2061 7267 732e 6d6f 756e 745f   not args.mount_
+00026e20: 736f 7572 6365 3a0a 2020 2020 2020 2020  source:.        
+00026e30: 7072 696e 7428 225b 4572 726f 725d 2059  print("[Error] Y
+00026e40: 6f75 206d 7573 7420 6174 206c 6561 7374  ou must at least
+00026e50: 2073 7065 6369 6679 206f 6e65 2070 6174   specify one pat
+00026e60: 6820 746f 2061 2076 616c 6964 2054 4152  h to a valid TAR
+00026e70: 2066 696c 6520 6f72 2075 6e69 6f6e 206d   file or union m
+00026e80: 6f75 6e74 2073 6f75 7263 6520 6469 7265  ount source dire
+00026e90: 6374 6f72 7921 2229 0a20 2020 2020 2020  ctory!").       
+00026ea0: 2073 7973 2e65 7869 7428 3129 0a0a 2020   sys.exit(1)..  
+00026eb0: 2020 2320 4d61 6e75 616c 6c79 2063 6865    # Manually che
+00026ec0: 636b 2074 6861 7420 616c 6c20 7370 6563  ck that all spec
+00026ed0: 6966 6965 6420 5441 5273 2061 6e64 2066  ified TARs and f
+00026ee0: 6f6c 6465 7273 2065 7869 7374 0a20 2020  olders exist.   
+00026ef0: 2064 6566 2063 6865 636b 4d6f 756e 7453   def checkMountS
+00026f00: 6f75 7263 6528 7061 7468 293a 0a20 2020  ource(path):.   
+00026f10: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+00026f20: 2020 2020 2020 6f73 2e70 6174 682e 6973        os.path.is
+00026f30: 6469 7228 7061 7468 290a 2020 2020 2020  dir(path).      
+00026f40: 2020 2020 2020 6f72 2028 277a 6970 6669        or ('zipfi
+00026f50: 6c65 2720 696e 2073 7973 2e6d 6f64 756c  le' in sys.modul
+00026f60: 6573 2061 6e64 207a 6970 6669 6c65 2e69  es and zipfile.i
+00026f70: 735f 7a69 7066 696c 6528 7061 7468 2929  s_zipfile(path))
+00026f80: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00026f90: 2827 7261 7266 696c 6527 2069 6e20 7379  ('rarfile' in sy
+00026fa0: 732e 6d6f 6475 6c65 7320 616e 6420 7261  s.modules and ra
+00026fb0: 7266 696c 652e 6973 5f72 6172 6669 6c65  rfile.is_rarfile
+00026fc0: 2870 6174 6829 290a 2020 2020 2020 2020  (path)).        
+00026fd0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00026fe0: 6574 7572 6e20 6f73 2e70 6174 682e 7265  eturn os.path.re
+00026ff0: 616c 7061 7468 2870 6174 6829 0a20 2020  alpath(path).   
+00027000: 2020 2020 2072 6574 7572 6e20 5461 7246       return TarF
+00027010: 696c 6554 7970 6528 656e 636f 6469 6e67  ileType(encoding
+00027020: 3d61 7267 732e 656e 636f 6469 6e67 2928  =args.encoding)(
+00027030: 7061 7468 295b 305d 0a0a 2020 2020 6172  path)[0]..    ar
+00027040: 6773 2e6d 6f75 6e74 5f73 6f75 7263 6520  gs.mount_source 
+00027050: 3d20 5b63 6865 636b 4d6f 756e 7453 6f75  = [checkMountSou
+00027060: 7263 6528 7061 7468 2920 666f 7220 7061  rce(path) for pa
+00027070: 7468 2069 6e20 6172 6773 2e6d 6f75 6e74  th in args.mount
+00027080: 5f73 6f75 7263 655d 0a0a 2020 2020 2320  _source]..    # 
+00027090: 4175 746f 6d61 7469 6361 6c6c 7920 6765  Automatically ge
+000270a0: 6e65 7261 7465 2061 2064 6566 6175 6c74  nerate a default
+000270b0: 206d 6f75 6e74 2070 6174 680a 2020 2020   mount path.    
+000270c0: 6966 206e 6f74 2061 7267 732e 6d6f 756e  if not args.moun
+000270d0: 745f 706f 696e 743a 0a20 2020 2020 2020  t_point:.       
+000270e0: 2061 7574 6f4d 6f75 6e74 506f 696e 7420   autoMountPoint 
+000270f0: 3d20 7374 7269 7053 7566 6669 7846 726f  = stripSuffixFro
+00027100: 6d54 6172 4669 6c65 2861 7267 732e 6d6f  mTarFile(args.mo
+00027110: 756e 745f 736f 7572 6365 5b30 5d29 0a20  unt_source[0]). 
+00027120: 2020 2020 2020 2069 6620 6172 6773 2e6d         if args.m
+00027130: 6f75 6e74 5f70 6f69 6e74 203d 3d20 6175  ount_point == au
+00027140: 746f 4d6f 756e 7450 6f69 6e74 3a0a 2020  toMountPoint:.  
+00027150: 2020 2020 2020 2020 2020 6172 6773 2e6d            args.m
+00027160: 6f75 6e74 5f70 6f69 6e74 203d 206f 732e  ount_point = os.
+00027170: 7061 7468 2e73 706c 6974 6578 7428 6172  path.splitext(ar
+00027180: 6773 2e6d 6f75 6e74 5f73 6f75 7263 655b  gs.mount_source[
+00027190: 305d 295b 305d 0a20 2020 2020 2020 2065  0])[0].        e
+000271a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000271b0: 2061 7267 732e 6d6f 756e 745f 706f 696e   args.mount_poin
+000271c0: 7420 3d20 6175 746f 4d6f 756e 7450 6f69  t = autoMountPoi
+000271d0: 6e74 0a20 2020 2061 7267 732e 6d6f 756e  nt.    args.moun
+000271e0: 745f 706f 696e 7420 3d20 6f73 2e70 6174  t_point = os.pat
+000271f0: 682e 6162 7370 6174 6828 6172 6773 2e6d  h.abspath(args.m
+00027200: 6f75 6e74 5f70 6f69 6e74 290a 0a20 2020  ount_point)..   
+00027210: 2023 2050 7265 7072 6f63 6573 7320 7468   # Preprocess th
+00027220: 6520 2d2d 696e 6465 782d 666f 6c64 6572  e --index-folder
+00027230: 7320 6c69 7374 2061 7320 6120 7374 7269  s list as a stri
+00027240: 6e67 2061 7267 756d 656e 740a 2020 2020  ng argument.    
+00027250: 6966 2061 7267 732e 696e 6465 785f 666f  if args.index_fo
+00027260: 6c64 6572 733a 0a20 2020 2020 2020 2069  lders:.        i
+00027270: 6620 6172 6773 2e69 6e64 6578 5f66 6f6c  f args.index_fol
+00027280: 6465 7273 5b30 5d20 3d3d 2027 5b27 3a0a  ders[0] == '[':.
+00027290: 2020 2020 2020 2020 2020 2020 6172 6773              args
+000272a0: 2e69 6e64 6578 5f66 6f6c 6465 7273 203d  .index_folders =
+000272b0: 206a 736f 6e2e 6c6f 6164 7328 6172 6773   json.loads(args
+000272c0: 2e69 6e64 6578 5f66 6f6c 6465 7273 290a  .index_folders).
+000272d0: 2020 2020 2020 2020 656c 6966 2027 2c27          elif ','
+000272e0: 2069 6e20 6172 6773 2e69 6e64 6578 5f66   in args.index_f
+000272f0: 6f6c 6465 7273 3a0a 2020 2020 2020 2020  olders:.        
+00027300: 2020 2020 6172 6773 2e69 6e64 6578 5f66      args.index_f
+00027310: 6f6c 6465 7273 203d 2061 7267 732e 696e  olders = args.in
+00027320: 6465 785f 666f 6c64 6572 732e 7370 6c69  dex_folders.spli
+00027330: 7428 272c 2729 0a0a 2020 2020 2320 4368  t(',')..    # Ch
+00027340: 6563 6b20 7468 6520 7061 7261 6c6c 656c  eck the parallel
+00027350: 697a 6174 696f 6e20 6172 6775 6d65 6e74  ization argument
+00027360: 2061 6e64 206d 6f76 6520 746f 2067 6c6f   and move to glo
+00027370: 6261 6c20 7661 7269 6162 6c65 0a20 2020  bal variable.   
+00027380: 2069 6620 6172 6773 2e70 6172 616c 6c65   if args.paralle
+00027390: 6c69 7a61 7469 6f6e 203c 2030 3a0a 2020  lization < 0:.  
+000273a0: 2020 2020 2020 7261 6973 6520 6172 6770        raise argp
+000273b0: 6172 7365 2e41 7267 756d 656e 7454 7970  arse.ArgumentTyp
+000273c0: 6545 7272 6f72 2822 4172 6775 6d65 6e74  eError("Argument
+000273d0: 2066 6f72 2070 6172 616c 6c65 6c69 7a61   for paralleliza
+000273e0: 7469 6f6e 206d 7573 7420 6265 206e 6f6e  tion must be non
+000273f0: 2d6e 6567 6174 6976 6521 2229 0a20 2020  -negative!").   
+00027400: 2067 6c6f 6261 6c20 7061 7261 6c6c 656c   global parallel
+00027410: 697a 6174 696f 6e0a 2020 2020 7061 7261  ization.    para
+00027420: 6c6c 656c 697a 6174 696f 6e20 3d20 6172  llelization = ar
+00027430: 6773 2e70 6172 616c 6c65 6c69 7a61 7469  gs.parallelizati
+00027440: 6f6e 2069 6620 6172 6773 2e70 6172 616c  on if args.paral
+00027450: 6c65 6c69 7a61 7469 6f6e 203e 2030 2065  lelization > 0 e
+00027460: 6c73 6520 6f73 2e63 7075 5f63 6f75 6e74  lse os.cpu_count
+00027470: 2829 0a0a 2020 2020 2320 5361 6e69 7469  ()..    # Saniti
+00027480: 7a65 2064 6966 6665 7265 6e74 2077 6179  ze different way
+00027490: 7320 746f 2073 7065 6369 6679 2070 6173  s to specify pas
+000274a0: 7377 6f72 6473 2069 6e74 6f20 6120 7369  swords into a si
+000274b0: 6d70 6c65 206c 6973 740a 2020 2020 6172  mple list.    ar
+000274c0: 6773 2e70 6173 7377 6f72 6473 203d 205b  gs.passwords = [
+000274d0: 5d0a 2020 2020 6966 2061 7267 732e 7061  ].    if args.pa
+000274e0: 7373 776f 7264 3a0a 2020 2020 2020 2020  ssword:.        
+000274f0: 6172 6773 2e70 6173 7377 6f72 6473 2e61  args.passwords.a
+00027500: 7070 656e 6428 6172 6773 2e70 6173 7377  ppend(args.passw
+00027510: 6f72 6429 0a0a 2020 2020 6966 2061 7267  ord)..    if arg
+00027520: 732e 7061 7373 776f 7264 5f66 696c 653a  s.password_file:
+00027530: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00027540: 656e 2861 7267 732e 7061 7373 776f 7264  en(args.password
+00027550: 5f66 696c 652c 2027 7262 2729 2061 7320  _file, 'rb') as 
+00027560: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+00027570: 2020 6172 6773 2e70 6173 7377 6f72 6473    args.passwords
+00027580: 202b 3d20 6669 6c65 2e72 6561 6428 292e   += file.read().
+00027590: 7370 6c69 7428 6227 5c6e 2729 0a0a 2020  split(b'\n')..  
+000275a0: 2020 6172 6773 2e70 6173 7377 6f72 6473    args.passwords
+000275b0: 203d 205f 7265 6d6f 7665 4475 706c 6963   = _removeDuplic
+000275c0: 6174 6573 5374 6162 6c65 2861 7267 732e  atesStable(args.
+000275d0: 7061 7373 776f 7264 7329 0a0a 2020 2020  passwords)..    
+000275e0: 7265 7475 726e 2061 7267 730a 0a0a 6465  return args...de
+000275f0: 6620 636c 6928 7261 7741 7267 733a 204f  f cli(rawArgs: O
+00027600: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+00027610: 5d5d 203d 204e 6f6e 6529 202d 3e20 4e6f  ]] = None) -> No
+00027620: 6e65 3a0a 2020 2020 2222 2243 6f6d 6d61  ne:.    """Comma
+00027630: 6e64 206c 696e 6520 696e 7465 7266 6163  nd line interfac
+00027640: 6520 666f 7220 7261 7461 726d 6f75 6e74  e for ratarmount
+00027650: 2e20 4361 6c6c 2077 6974 6820 6172 6773  . Call with args
+00027660: 203d 205b 2027 2d2d 6865 6c70 2720 5d20   = [ '--help' ] 
+00027670: 666f 7220 6120 6465 7363 7269 7074 696f  for a descriptio
+00027680: 6e2e 2222 220a 0a20 2020 2023 2054 6865  n."""..    # The
+00027690: 2066 6972 7374 2061 7267 756d 656e 742c   first argument,
+000276a0: 2069 7320 7468 6520 7061 7468 2074 6f20   is the path to 
+000276b0: 7468 6520 7363 7269 7074 2061 6e64 2073  the script and s
+000276c0: 686f 756c 6420 6265 2069 676e 6f72 6564  hould be ignored
+000276d0: 0a20 2020 2074 6d70 4172 6773 203d 2073  .    tmpArgs = s
+000276e0: 7973 2e61 7267 765b 313a 5d20 6966 2072  ys.argv[1:] if r
+000276f0: 6177 4172 6773 2069 7320 4e6f 6e65 2065  awArgs is None e
+00027700: 6c73 6520 7261 7741 7267 730a 2020 2020  lse rawArgs.    
+00027710: 6966 2027 2d2d 7665 7273 696f 6e27 2069  if '--version' i
+00027720: 6e20 746d 7041 7267 7320 6f72 2027 2d76  n tmpArgs or '-v
+00027730: 2720 696e 2074 6d70 4172 6773 3a0a 2020  ' in tmpArgs:.  
+00027740: 2020 2020 2020 7072 696e 7428 2272 6174        print("rat
+00027750: 6172 6d6f 756e 7422 2c20 5f5f 7665 7273  armount", __vers
+00027760: 696f 6e5f 5f29 0a20 2020 2020 2020 2072  ion__).        r
+00027770: 6574 7572 6e0a 0a20 2020 2023 2074 6d70  eturn..    # tmp
+00027780: 4172 6773 2061 7265 206f 6e6c 7920 666f  Args are only fo
+00027790: 7220 7468 6520 6d61 6e75 616c 2070 6172  r the manual par
+000277a0: 7369 6e67 2e20 496e 2067 656e 6572 616c  sing. In general
+000277b0: 2c20 7261 7741 7267 7320 6973 204e 6f6e  , rawArgs is Non
+000277c0: 652c 206d 6561 6e69 6e67 2069 7420 7265  e, meaning it re
+000277d0: 6164 7320 7379 732e 6172 6776 2c0a 2020  ads sys.argv,.  
+000277e0: 2020 2320 616e 6420 6d61 7962 6520 736f    # and maybe so
+000277f0: 6d65 7469 6d65 7320 636f 6e74 6169 6e73  metimes contains
+00027800: 2061 7267 756d 656e 7473 2077 6865 6e20   arguments when 
+00027810: 7573 6564 2070 726f 6772 616d 6d61 7469  used programmati
+00027820: 6361 6c6c 792e 2049 6e20 7468 6174 2063  cally. In that c
+00027830: 6173 6520 7468 6520 6669 7273 7420 6172  ase the first ar
+00027840: 6775 6d65 6e74 0a20 2020 2023 2073 686f  gument.    # sho
+00027850: 756c 6420 6e6f 7420 6265 2074 6865 2070  uld not be the p
+00027860: 6174 6820 746f 2074 6865 2073 6372 6970  ath to the scrip
+00027870: 7421 0a20 2020 2061 7267 7320 3d20 5f70  t!.    args = _p
+00027880: 6172 7365 4172 6773 2872 6177 4172 6773  arseArgs(rawArgs
+00027890: 290a 0a20 2020 2023 2043 6f6e 7665 7274  )..    # Convert
+000278a0: 2074 6865 2063 6f6d 6d61 2073 6570 6172   the comma separ
+000278b0: 6174 6564 206c 6973 7420 6f66 206b 6579  ated list of key
+000278c0: 5b3d 7661 6c75 655d 206f 7074 696f 6e73  [=value] options
+000278d0: 2069 6e74 6f20 6120 6469 6374 696f 6e61   into a dictiona
+000278e0: 7279 2066 6f72 2066 7573 6570 790a 2020  ry for fusepy.  
+000278f0: 2020 6675 7365 6b77 6172 6773 203d 2028    fusekwargs = (
+00027900: 0a20 2020 2020 2020 2064 6963 7428 5b6f  .        dict([o
+00027910: 7074 696f 6e2e 7370 6c69 7428 273d 272c  ption.split('=',
+00027920: 2031 2920 6966 2027 3d27 2069 6e20 6f70   1) if '=' in op
+00027930: 7469 6f6e 2065 6c73 6520 286f 7074 696f  tion else (optio
+00027940: 6e2c 2054 7275 6529 2066 6f72 206f 7074  n, True) for opt
+00027950: 696f 6e20 696e 2061 7267 732e 6675 7365  ion in args.fuse
+00027960: 2e73 706c 6974 2827 2c27 295d 290a 2020  .split(',')]).  
+00027970: 2020 2020 2020 6966 2061 7267 732e 6675        if args.fu
+00027980: 7365 0a20 2020 2020 2020 2065 6c73 6520  se.        else 
+00027990: 7b7d 0a20 2020 2029 0a20 2020 2069 6620  {}.    ).    if 
+000279a0: 6172 6773 2e70 7265 6669 783a 0a20 2020  args.prefix:.   
+000279b0: 2020 2020 2066 7573 656b 7761 7267 735b       fusekwargs[
+000279c0: 276d 6f64 756c 6573 275d 203d 2027 7375  'modules'] = 'su
+000279d0: 6264 6972 270a 2020 2020 2020 2020 6675  bdir'.        fu
+000279e0: 7365 6b77 6172 6773 5b27 7375 6264 6972  sekwargs['subdir
+000279f0: 275d 203d 2061 7267 732e 7072 6566 6978  '] = args.prefix
+00027a00: 0a0a 2020 2020 6966 2061 7267 732e 6d6f  ..    if args.mo
+00027a10: 756e 745f 706f 696e 7420 696e 2061 7267  unt_point in arg
+00027a20: 732e 6d6f 756e 745f 736f 7572 6365 2061  s.mount_source a
+00027a30: 6e64 206f 732e 7061 7468 2e69 7364 6972  nd os.path.isdir
+00027a40: 2861 7267 732e 6d6f 756e 745f 706f 696e  (args.mount_poin
+00027a50: 7429 2061 6e64 206f 732e 6c69 7374 6469  t) and os.listdi
+00027a60: 7228 6172 6773 2e6d 6f75 6e74 5f70 6f69  r(args.mount_poi
+00027a70: 6e74 293a 0a20 2020 2020 2020 2069 6620  nt):.        if 
+00027a80: 6861 734e 6f6e 456d 7074 7953 7570 706f  hasNonEmptySuppo
+00027a90: 7274 2829 3a0a 2020 2020 2020 2020 2020  rt():.          
+00027aa0: 2020 6675 7365 6b77 6172 6773 5b27 6e6f    fusekwargs['no
+00027ab0: 6e65 6d70 7479 275d 203d 2054 7275 650a  nempty'] = True.
+00027ac0: 0a20 2020 2067 6c6f 6261 6c20 7072 696e  .    global prin
+00027ad0: 7444 6562 7567 0a20 2020 2070 7269 6e74  tDebug.    print
+00027ae0: 4465 6275 6720 3d20 6172 6773 2e64 6562  Debug = args.deb
+00027af0: 7567 0a0a 2020 2020 6675 7365 4f70 6572  ug..    fuseOper
+00027b00: 6174 696f 6e73 4f62 6a65 6374 203d 2046  ationsObject = F
+00027b10: 7573 654d 6f75 6e74 280a 2020 2020 2020  useMount(.      
+00027b20: 2020 2320 666d 743a 206f 6666 0a20 2020    # fmt: off.   
+00027b30: 2020 2020 2070 6174 6854 6f4d 6f75 6e74       pathToMount
+00027b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b50: 3d20 6172 6773 2e6d 6f75 6e74 5f73 6f75  = args.mount_sou
+00027b60: 7263 652c 0a20 2020 2020 2020 2063 6c65  rce,.        cle
+00027b70: 6172 496e 6465 7843 6163 6865 2020 2020  arIndexCache    
+00027b80: 2020 2020 2020 2020 3d20 6172 6773 2e72          = args.r
+00027b90: 6563 7265 6174 655f 696e 6465 782c 0a20  ecreate_index,. 
+00027ba0: 2020 2020 2020 2072 6563 7572 7369 7665         recursive
+00027bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027bc0: 2020 3d20 6172 6773 2e72 6563 7572 7369    = args.recursi
+00027bd0: 7665 2c0a 2020 2020 2020 2020 677a 6970  ve,.        gzip
+00027be0: 5365 656b 506f 696e 7453 7061 6369 6e67  SeekPointSpacing
+00027bf0: 2020 2020 2020 203d 2061 7267 732e 677a         = args.gz
+00027c00: 6970 5365 656b 506f 696e 7453 7061 6369  ipSeekPointSpaci
+00027c10: 6e67 2c0a 2020 2020 2020 2020 6d6f 756e  ng,.        moun
+00027c20: 7450 6f69 6e74 2020 2020 2020 2020 2020  tPoint          
+00027c30: 2020 2020 2020 203d 2061 7267 732e 6d6f         = args.mo
+00027c40: 756e 745f 706f 696e 742c 0a20 2020 2020  unt_point,.     
+00027c50: 2020 2065 6e63 6f64 696e 6720 2020 2020     encoding     
+00027c60: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00027c70: 6172 6773 2e65 6e63 6f64 696e 672c 0a20  args.encoding,. 
+00027c80: 2020 2020 2020 2069 676e 6f72 655a 6572         ignoreZer
+00027c90: 6f73 2020 2020 2020 2020 2020 2020 2020  os              
+00027ca0: 2020 3d20 6172 6773 2e69 676e 6f72 655f    = args.ignore_
+00027cb0: 7a65 726f 732c 0a20 2020 2020 2020 2076  zeros,.        v
+00027cc0: 6572 6966 794d 6f64 6966 6963 6174 696f  erifyModificatio
+00027cd0: 6e54 696d 6520 2020 2020 3d20 6172 6773  nTime     = args
+00027ce0: 2e76 6572 6966 795f 6d74 696d 652c 0a20  .verify_mtime,. 
+00027cf0: 2020 2020 2020 2073 7472 6970 5265 6375         stripRecu
+00027d00: 7273 6976 6554 6172 4578 7465 6e73 696f  rsiveTarExtensio
+00027d10: 6e20 3d20 6172 6773 2e73 7472 6970 5f72  n = args.strip_r
+00027d20: 6563 7572 7369 7665 5f74 6172 5f65 7874  ecursive_tar_ext
+00027d30: 656e 7369 6f6e 2c0a 2020 2020 2020 2020  ension,.        
+00027d40: 696e 6465 7846 696c 654e 616d 6520 2020  indexFileName   
+00027d50: 2020 2020 2020 2020 2020 203d 2061 7267             = arg
+00027d60: 732e 696e 6465 785f 6669 6c65 2c0a 2020  s.index_file,.  
+00027d70: 2020 2020 2020 696e 6465 7846 6f6c 6465        indexFolde
+00027d80: 7273 2020 2020 2020 2020 2020 2020 2020  rs              
+00027d90: 203d 2061 7267 732e 696e 6465 785f 666f   = args.index_fo
+00027da0: 6c64 6572 732c 0a20 2020 2020 2020 206c  lders,.        l
+00027db0: 617a 794d 6f75 6e74 696e 6720 2020 2020  azyMounting     
+00027dc0: 2020 2020 2020 2020 2020 3d20 6172 6773            = args
+00027dd0: 2e6c 617a 792c 0a20 2020 2020 2020 2070  .lazy,.        p
+00027de0: 6173 7377 6f72 6473 2020 2020 2020 2020  asswords        
+00027df0: 2020 2020 2020 2020 2020 3d20 6172 6773            = args
+00027e00: 2e70 6173 7377 6f72 6473 2c0a 2020 2020  .passwords,.    
+00027e10: 2020 2020 2320 666d 743a 206f 6e0a 2020      # fmt: on.  
+00027e20: 2020 290a 0a20 2020 2066 7573 652e 4655    )..    fuse.FU
+00027e30: 5345 280a 2020 2020 2020 2020 2320 666d  SE(.        # fm
+00027e40: 743a 206f 6e0a 2020 2020 2020 2020 6f70  t: on.        op
+00027e50: 6572 6174 696f 6e73 3d66 7573 654f 7065  erations=fuseOpe
+00027e60: 7261 7469 6f6e 734f 626a 6563 742c 0a20  rationsObject,. 
+00027e70: 2020 2020 2020 206d 6f75 6e74 706f 696e         mountpoin
+00027e80: 743d 6172 6773 2e6d 6f75 6e74 5f70 6f69  t=args.mount_poi
+00027e90: 6e74 2c0a 2020 2020 2020 2020 666f 7265  nt,.        fore
+00027ea0: 6772 6f75 6e64 3d61 7267 732e 666f 7265  ground=args.fore
+00027eb0: 6772 6f75 6e64 2c0a 2020 2020 2020 2020  ground,.        
+00027ec0: 6e6f 7468 7265 6164 733d 5472 7565 2c20  nothreads=True, 
+00027ed0: 2023 2043 616e 2774 2061 6363 6573 7320   # Can't access 
+00027ee0: 5351 4c69 7465 2064 6174 6162 6173 6520  SQLite database 
+00027ef0: 636f 6e6e 6563 7469 6f6e 206f 626a 6563  connection objec
+00027f00: 7420 6672 6f6d 206d 756c 7469 706c 6520  t from multiple 
+00027f10: 7468 7265 6164 730a 2020 2020 2020 2020  threads.        
+00027f20: 2320 666d 743a 206f 6666 0a20 2020 2020  # fmt: off.     
+00027f30: 2020 202a 2a66 7573 656b 7761 7267 730a     **fusekwargs.
+00027f40: 2020 2020 290a 0a0a 6966 205f 5f6e 616d      )...if __nam
+00027f50: 655f 5f20 3d3d 2027 5f5f 6d61 696e 5f5f  e__ == '__main__
+00027f60: 273a 0a20 2020 2063 6c69 2873 7973 2e61  ':.    cli(sys.a
+00027f70: 7267 765b 313a 5d29 0a                   rgv[1:]).
```

### Comparing `ratarmount-0.9.2/setup.py` & `ratarmount-0.9.3/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -6,15 +6,15 @@
 
 scriptPath = os.path.abspath( os.path.dirname( __file__ ) )
 with open( os.path.join( scriptPath, 'README.md' ), encoding = 'utf-8' ) as file:
     readmeContents = file.read()
 
 setup(
     name             = 'ratarmount',
-    version          = '0.9.2',
+    version          = '0.9.3',
 
     description      = 'Random Access Read-Only Tar Mount',
     url              = 'https://github.com/mxmlnkn/ratarmount',
     author           = 'Maximilian Knespel',
     author_email     = 'mxmlnkn@github.de',
     license          = 'MIT',
     classifiers      = [ 'License :: OSI Approved :: MIT License',
```

