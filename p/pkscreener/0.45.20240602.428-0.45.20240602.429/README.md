# Comparing `tmp/pkscreener-0.45.20240602.428.tar.gz` & `tmp/pkscreener-0.45.20240602.429.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "pkscreener-0.45.20240602.428.tar", last modified: Sun Jun  2 15:20:52 2024, max compression
+gzip compressed data, was "pkscreener-0.45.20240602.429.tar", last modified: Sun Jun  2 19:34:25 2024, max compression
```

## Comparing `pkscreener-0.45.20240602.428.tar` & `pkscreener-0.45.20240602.429.tar`

### file list

```diff
@@ -1,50 +1,50 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 15:20:52.511162 pkscreener-0.45.20240602.428/
--rw-r--r--   0 runner    (1001) docker     (127)     1065 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/LICENSE
--rw-r--r--   0 runner    (1001) docker     (127)     1070 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/LICENSE-Others
--rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-02 15:20:52.511162 pkscreener-0.45.20240602.428/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)    26594 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/README.md
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 15:20:52.507162 pkscreener-0.45.20240602.428/pkscreener/
--rw-r--r--   0 runner    (1001) docker     (127)     1598 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 15:20:52.511162 pkscreener-0.45.20240602.428/pkscreener/classes/
--rw-r--r--   0 runner    (1001) docker     (127)    13194 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/ArtTexts.py
--rw-r--r--   0 runner    (1001) docker     (127)     9908 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Backtest.py
--rw-r--r--   0 runner    (1001) docker     (127)     5537 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Barometer.py
--rw-r--r--   0 runner    (1001) docker     (127)    16986 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/CandlePatterns.py
--rw-r--r--   0 runner    (1001) docker     (127)     1494 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Changelog.py
--rw-r--r--   0 runner    (1001) docker     (127)    35718 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/ConfigManager.py
--rw-r--r--   0 runner    (1001) docker     (127)    10122 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Fetcher.py
--rw-r--r--   0 runner    (1001) docker     (127)    13402 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/MarketMonitor.py
--rw-r--r--   0 runner    (1001) docker     (127)     3591 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/MarketStatus.py
--rw-r--r--   0 runner    (1001) docker     (127)    47369 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/MenuOptions.py
--rw-r--r--   0 runner    (1001) docker     (127)    12039 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/OtaUpdater.py
--rw-r--r--   0 runner    (1001) docker     (127)    24198 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PKMarketOpenCloseAnalyser.py
--rw-r--r--   0 runner    (1001) docker     (127)    22357 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PKScanRunner.py
--rw-r--r--   0 runner    (1001) docker     (127)     1588 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PKScheduledTaskProgress.py
--rw-r--r--   0 runner    (1001) docker     (127)     8143 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PKScheduler.py
--rw-r--r--   0 runner    (1001) docker     (127)     8298 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PKSpreadsheets.py
--rw-r--r--   0 runner    (1001) docker     (127)     1867 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PKTask.py
--rw-r--r--   0 runner    (1001) docker     (127)    19048 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Pktalib.py
--rw-r--r--   0 runner    (1001) docker     (127)    13876 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Portfolio.py
--rw-r--r--   0 runner    (1001) docker     (127)    47779 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/PortfolioXRay.py
--rw-r--r--   0 runner    (1001) docker     (127)   164145 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/ScreeningStatistics.py
--rw-r--r--   0 runner    (1001) docker     (127)    56499 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/StockScreener.py
--rw-r--r--   0 runner    (1001) docker     (127)     4885 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/UserMenuChoicesHandler.py
--rw-r--r--   0 runner    (1001) docker     (127)    85602 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/Utility.py
--rw-r--r--   0 runner    (1001) docker     (127)     3946 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/WorkflowManager.py
--rw-r--r--   0 runner    (1001) docker     (127)       28 2024-06-02 15:20:45.000000 pkscreener-0.45.20240602.428/pkscreener/classes/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     5122 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/classes/keys.py
--rw-r--r--   0 runner    (1001) docker     (127)   791436 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/courbd.ttf
--rw-r--r--   0 runner    (1001) docker     (127)   147454 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/globals.py
--rw-r--r--   0 runner    (1001) docker     (127)     1173 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/pkscreener.ini
--rw-r--r--   0 runner    (1001) docker     (127)    61055 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/pkscreenerbot.py
--rw-r--r--   0 runner    (1001) docker     (127)    35142 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/pkscreener/pkscreenercli.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 15:20:52.507162 pkscreener-0.45.20240602.428/pkscreener.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     1382 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)      120 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (127)      370 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)       11 2024-06-02 15:20:52.000000 pkscreener-0.45.20240602.428/pkscreener.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (127)       79 2024-06-02 15:20:52.511162 pkscreener-0.45.20240602.428/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (127)     5567 2024-06-02 15:18:59.000000 pkscreener-0.45.20240602.428/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 19:34:25.261185 pkscreener-0.45.20240602.429/
+-rw-r--r--   0 runner    (1001) docker     (127)     1065 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (127)     1070 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/LICENSE-Others
+-rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-02 19:34:25.261185 pkscreener-0.45.20240602.429/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)    26594 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/README.md
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 19:34:25.253185 pkscreener-0.45.20240602.429/pkscreener/
+-rw-r--r--   0 runner    (1001) docker     (127)     1598 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 19:34:25.261185 pkscreener-0.45.20240602.429/pkscreener/classes/
+-rw-r--r--   0 runner    (1001) docker     (127)    13194 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/ArtTexts.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9908 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Backtest.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5537 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Barometer.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16986 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/CandlePatterns.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1494 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Changelog.py
+-rw-r--r--   0 runner    (1001) docker     (127)    36121 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/ConfigManager.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10122 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Fetcher.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13402 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/MarketMonitor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3591 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/MarketStatus.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47411 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/MenuOptions.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12039 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/OtaUpdater.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24198 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PKMarketOpenCloseAnalyser.py
+-rw-r--r--   0 runner    (1001) docker     (127)    22357 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PKScanRunner.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1588 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PKScheduledTaskProgress.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8143 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PKScheduler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8298 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PKSpreadsheets.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1867 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PKTask.py
+-rw-r--r--   0 runner    (1001) docker     (127)    19048 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Pktalib.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13876 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Portfolio.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47779 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/PortfolioXRay.py
+-rw-r--r--   0 runner    (1001) docker     (127)   164271 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/ScreeningStatistics.py
+-rw-r--r--   0 runner    (1001) docker     (127)    56535 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/StockScreener.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4885 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/UserMenuChoicesHandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)    85660 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/Utility.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3946 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/WorkflowManager.py
+-rw-r--r--   0 runner    (1001) docker     (127)       28 2024-06-02 19:34:18.000000 pkscreener-0.45.20240602.429/pkscreener/classes/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5122 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/classes/keys.py
+-rw-r--r--   0 runner    (1001) docker     (127)   791436 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/courbd.ttf
+-rw-r--r--   0 runner    (1001) docker     (127)   148321 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/globals.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1256 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/pkscreener.ini
+-rw-r--r--   0 runner    (1001) docker     (127)    61567 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/pkscreenerbot.py
+-rw-r--r--   0 runner    (1001) docker     (127)    36859 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/pkscreener/pkscreenercli.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-02 19:34:25.257185 pkscreener-0.45.20240602.429/pkscreener.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     1382 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)      120 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (127)      370 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       11 2024-06-02 19:34:25.000000 pkscreener-0.45.20240602.429/pkscreener.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       79 2024-06-02 19:34:25.261185 pkscreener-0.45.20240602.429/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (127)     5567 2024-06-02 19:32:15.000000 pkscreener-0.45.20240602.429/setup.py
```

### Comparing `pkscreener-0.45.20240602.428/LICENSE` & `pkscreener-0.45.20240602.429/LICENSE`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/LICENSE-Others` & `pkscreener-0.45.20240602.429/LICENSE-Others`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/PKG-INFO` & `pkscreener-0.45.20240602.429/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: pkscreener
-Version: 0.45.20240602.428
+Version: 0.45.20240602.429
 Summary: A Python-based stock screener for NSE, India with alerts to Telegram Channel (pkscreener)
 Home-page: https://github.com/pkjmesra/pkscreener
-Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240602.428.zip
+Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240602.429.zip
 Author: pkjmesra
 Author-email: pkjmesra@gmail.com
 License: OSI Approved (MIT)
 Keywords: NSE,Technical Indicators,Scanning,Stock Scanners
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
@@ -39,15 +39,15 @@
 
 | Fair Value | Mutual funds, FII data | TTM Squeeze | Golden Crossover | Death Crossover|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | RSI screening | MACD scanners | IPO Stocks | Momentum Gainers | Watchlist screening |
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
-| Stock Performance | 52Wk H/L Breakouts | 10 days low breakouts | Aroon Crossover | Next Day Bullish Stocks|
+| Stock Performance | 52Wk-H/L Breakouts | 10 days low breakouts | Aroon Crossover | Next Day Bullish Stocks|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | Today's Breakouts | Breaking out now | Popular stocks by Mutual Funds / FIIs | Higher Highs | Lower Lows|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | F&O Stocks screening | Live 5-EMA Index Scan | Logging | Telegram Channel | Early Breakouts |
 | :------------------: | :-------------------: | :-----: | :--------------: | --------------- |
@@ -274,19 +274,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240602.428/README.md` & `pkscreener-0.45.20240602.429/README.md`

 * *Files 2% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 
 | Fair Value | Mutual funds, FII data | TTM Squeeze | Golden Crossover | Death Crossover|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | RSI screening | MACD scanners | IPO Stocks | Momentum Gainers | Watchlist screening |
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
-| Stock Performance | 52Wk H/L Breakouts | 10 days low breakouts | Aroon Crossover | Next Day Bullish Stocks|
+| Stock Performance | 52Wk-H/L Breakouts | 10 days low breakouts | Aroon Crossover | Next Day Bullish Stocks|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | Today's Breakouts | Breaking out now | Popular stocks by Mutual Funds / FIIs | Higher Highs | Lower Lows|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | F&O Stocks screening | Live 5-EMA Index Scan | Logging | Telegram Channel | Early Breakouts |
 | :------------------: | :-------------------: | :-----: | :--------------: | --------------- |
@@ -252,19 +252,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/__init__.py` & `pkscreener-0.45.20240602.429/pkscreener/__init__.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/ArtTexts.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/ArtTexts.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Backtest.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Backtest.py`

 * *Files 2% similar despite different names*

```diff
@@ -67,16 +67,16 @@
     previous_recent = data.head(
         1
     )  # This is the row which has the date for which the recommendation is valid
     if len(previous_recent) <= 0:
         return backTestedData
     data = data.head(max(calcPeriods) + 1)
     # Let's check the returns for the given strategy over a period ranging from 1 period to 30 periods.
-    # columns=['Stock', 'Date', 'Volume', 'Trend', 'MA-Signal', 'LTP', '52Wk H',
-    #          '52Wk L', '1-Pd', '2-Pd', '3-Pd', '4-Pd', '5-Pd', '10-Pd', '15-Pd',
+    # columns=['Stock', 'Date', 'Volume', 'Trend', 'MA-Signal', 'LTP', '52Wk-H',
+    #          '52Wk-L', '1-Pd', '2-Pd', '3-Pd', '4-Pd', '5-Pd', '10-Pd', '15-Pd',
     #          '22-Pd', '30-Pd', 'Consol.', 'Breakout', 'RSI', 'Pattern', 'CCI',
     #          'LTP1', 'Growth1', 'LTP2', 'Growth2', 'LTP3', 'Growth3', 'LTP4',
     #          'Growth4', 'LTP5', 'Growth5', 'LTP10', 'Growth10', 'LTP15', 'Growth15',
     #          'LTP22', 'Growth22', 'LTP30', 'Growth30']
     
     # incoming = list(saveDict.keys())
     # for prd in calcPeriods:
@@ -92,41 +92,41 @@
     columns=[
                 "Stock",
                 "Date",
                 "Volume",
                 "Trend",
                 "MA-Signal",
                 "LTP",
-                "52Wk H",
-                "52Wk L"
+                "52Wk-H",
+                "52Wk-L"
             ]
     backTestedStock = {
         "Stock": "",
         "Date": "",
         "Volume": "",
         "Trend": "",
         "MA-Signal": "",
         "LTP": "",
-        "52Wk H": "",
-        "52Wk L": ""
+        "52Wk-H": "",
+        "52Wk-L": ""
     }
     for prd in calcPeriods:
         columns.append(f"{prd}-Pd")
         backTestedStock[f"{prd}-Pd"] = ""
     if backTestedData is None:
         backTestedData = pd.DataFrame(columns=columns)
     backTestedStock["Stock"] = stock
     backTestedStock["Date"] = saveDict["Date"]
     backTestedStock["Consol."] = screenedDict["Consol."]
     backTestedStock["Breakout"] = screenedDict["Breakout"]
     backTestedStock["MA-Signal"] = screenedDict["MA-Signal"]
     backTestedStock["Volume"] = screenedDict["Volume"]
     backTestedStock["LTP"] = screenedDict["LTP"]
-    backTestedStock["52Wk H"] = screenedDict["52Wk H"]
-    backTestedStock["52Wk L"] = screenedDict["52Wk L"]
+    backTestedStock["52Wk-H"] = screenedDict["52Wk-H"]
+    backTestedStock["52Wk-L"] = screenedDict["52Wk-L"]
     backTestedStock["RSI"] = screenedDict["RSI"]
     backTestedStock["Trend"] = screenedDict["Trend"]
     backTestedStock["Pattern"] = screenedDict["Pattern"]
     backTestedStock["CCI"] = screenedDict["CCI"]
     for prd in calcPeriods:
         try:
             backTestedStock[f"{abs(prd)}-Pd"] = ""
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Barometer.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Barometer.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/CandlePatterns.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/CandlePatterns.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Changelog.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Changelog.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/ConfigManager.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/ConfigManager.py`

 * *Files 1% similar despite different names*

```diff
@@ -41,14 +41,15 @@
 default_timeout = 2
 
 
 # This Class manages read/write of user configuration
 class tools(SingletonMixin, metaclass=SingletonType):
     def __init__(self):
         super(tools, self).__init__()
+        self.alwaysHiddenDisplayColumns = ",52Wk-L,RSI,22-Pd,Consol.,Pattern,CCI,Trend(22Prds)"
         self.consolidationPercentage = 10
         self.volumeRatio = 2.5
         self.minLTP = 20.0
         self.maxLTP = 50000
         self.period = "1y"
         self.duration = "1d"
         self.shuffleEnabled = True
@@ -143,14 +144,15 @@
                 parser.remove_section("config")
                 parser.remove_section("filters")
             except Exception as e:  # pragma: no cover
                 self.default_logger.debug(e, exc_info=True)
                 pass
             parser.add_section("config")
             parser.add_section("filters")
+            parser.set("config", "alwaysHiddenDisplayColumns", str(self.alwaysHiddenDisplayColumns))
             parser.set("config", "atrtrailingstopemaperiod", str(self.atrTrailingStopEMAPeriod))
             parser.set("config", "atrtrailingstopperiod", str(self.atrTrailingStopPeriod))
             parser.set("config", "atrtrailingstopsensitivity", str(self.atrTrailingStopSensitivity))
             parser.set("config", "backtestPeriod", str(self.backtestPeriod))
             parser.set("config", "backtestPeriodFactor", str(self.backtestPeriodFactor))
             parser.set("config", "cacheStockData", "y" if self.cacheEnabled else "n")
             parser.set("config", "calculatersiintraday", "y" if self.calculatersiintraday else "n")
@@ -342,14 +344,15 @@
             except Exception as e:
                 default_logger().debug(e,exc_info=True)
                 from time import sleep
                 OutputControls().printOutput(colorText.FAIL + "Could not save configuration! Please check!" + colorText.END)
                 sleep(3)
                 pass
             try:
+                parser.set("config", "alwaysHiddenDisplayColumns", str(self.alwaysHiddenDisplayColumns))
                 parser.set("config", "atrtrailingstopemaperiod", str(self.atrTrailingStopEMAPeriod))
                 parser.set("config", "atrtrailingstopperiod", str(self.atrTrailingStopPeriod))
                 parser.set("config", "atrtrailingstopsensitivity", str(self.atrTrailingStopSensitivity))
                 parser.set("config", "backtestPeriod", str(self.backtestPeriod))
                 parser.set("config", "backtestPeriodFactor", str(self.backtestPeriodFactor))
                 parser.set("config", "cacheStockData", str(self.cacheStockData))
                 parser.set("config", "calculatersiintraday", str(self.calculatersiintraday))
@@ -433,14 +436,15 @@
                 input("Press <Enter> to continue...")
                 sys.exit(1)
 
     # Load user config from file
     def getConfig(self, parser):
         if len(parser.read("pkscreener.ini")):
             try:
+                self.alwaysHiddenDisplayColumns = parser.get("config", "alwaysHiddenDisplayColumns")
                 self.duration = parser.get("config", "duration")
                 self.period = parser.get("config", "period")
                 self.minLTP = float(parser.get("filters", "minprice"))
                 self.maxLTP = float(parser.get("filters", "maxprice"))
                 self.volumeRatio = float(parser.get("filters", "volumeRatio"))
                 self.consolidationPercentage = float(
                     parser.get("filters", "consolidationPercentage")
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Fetcher.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Fetcher.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/MarketMonitor.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/MarketMonitor.py`

 * *Files 0% similar despite different names*

```diff
@@ -103,27 +103,27 @@
         from pkscreener.classes import Utility
 
         if self.isPinnedSingleMonitorMode:
             screen_monitor_df = screen_monitor_df[screen_monitor_df.columns[:14]]
             self.monitor_df = screen_monitor_df
         else:
             screen_monitor_df.reset_index(inplace=True)
-            screen_monitor_df = screen_monitor_df[["Stock", "LTP", "%Chng","52Wk H","RSI/i" if "RSI/i" in screen_monitor_df.columns else "RSI","Volume"]].head(self.maxNumRowsInEachResult-1)
+            screen_monitor_df = screen_monitor_df[["Stock", "LTP", "%Chng","52Wk-H","RSI/i" if "RSI/i" in screen_monitor_df.columns else "RSI","Volume"]].head(self.maxNumRowsInEachResult-1)
             # Import Utility here since Utility has dependency on PKScheduler which in turn has dependency on 
             # multiprocessing, which behaves erratically if imported at the top.
             screen_monitor_df.loc[:, "%Chng"] = screen_monitor_df.loc[:, "%Chng"].apply(
                         lambda x: Utility.tools.roundOff(str(x).split("% (")[0] + colorText.END,0)
                     )
-            screen_monitor_df.loc[:, "52Wk H"] = screen_monitor_df.loc[:, "52Wk H"].apply(
+            screen_monitor_df.loc[:, "52Wk-H"] = screen_monitor_df.loc[:, "52Wk-H"].apply(
                 lambda x: Utility.tools.roundOff(x,0)
             )
             screen_monitor_df.loc[:, "Volume"] = screen_monitor_df.loc[:, "Volume"].apply(
                 lambda x: Utility.tools.roundOff(x,0)
             )
-            screen_monitor_df.rename(columns={"%Chng": "Ch%","Volume":"Vol","52Wk H":"52WkH", "RSI":"RSI/i"}, inplace=True)
+            screen_monitor_df.rename(columns={"%Chng": "Ch%","Volume":"Vol","52Wk-H":"52WkH", "RSI":"RSI/i"}, inplace=True)
             telegram_df = self.updateDataFrameForTelegramMode(telegram, screen_monitor_df)
         
         
         if monitorPosition is not None:
             startRowIndex, startColIndex = monitorPosition
             if not self.monitor_df.empty:
                 for _ in range(self.lines):
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/MarketStatus.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/MarketStatus.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/MenuOptions.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/MenuOptions.py`

 * *Files 0% similar despite different names*

```diff
@@ -132,15 +132,15 @@
     "M": "Back to the Top/Main menu",
     "Z": "Exit (Ctrl + C)",
 }
 level1_X_MenuDict = {
     "W": "Screen stocks from my own Watchlist",
     "N": "Nifty Prediction using Artifical Intelligence (Use for Gap-Up/Gap-Down/BTST/STBT)",
     "E": "Live Index Scan : 5 EMA for Intraday",
-    "0": "Screen stocks/index by the stock/index names (NSE Stock Code or index, e.g. ^NSEI, ^NSEBANK, ^BSESN)",
+    "0": "Screen stocks/index by the stock/index names (NSE Stock Code, e.g. SBIN,BANKINDIA or Yahoo Finance index symbol, e.g. ^NSEI, ^NSEBANK, ^BSESN)",
     "1": "Nifty 50          ",
     "2": "Nifty Next 50     ",
     "3": "Nifty 100         ",
     "4": "Nifty 200         ",
     "5": "Nifty 500         ",
     "6": "Nifty Smallcap 50 ",
     "7": "Nifty Smallcap 100",
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/OtaUpdater.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/OtaUpdater.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PKMarketOpenCloseAnalyser.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PKMarketOpenCloseAnalyser.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PKScanRunner.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PKScanRunner.py`

 * *Files 1% similar despite different names*

```diff
@@ -61,16 +61,16 @@
     def initDataframes():
         screenResults = pd.DataFrame(
             columns=[
                 "Stock",
                 "Consol.",
                 "Breakout",
                 "LTP",
-                "52Wk H",
-                "52Wk L",
+                "52Wk-H",
+                "52Wk-L",
                 "%Chng",
                 "Volume",
                 "MA-Signal",
                 "RSI",
                 "RSIi",
                 "Trend",
                 "Pattern",
@@ -79,16 +79,16 @@
         )
         saveResults = pd.DataFrame(
             columns=[
                 "Stock",
                 "Consol.",
                 "Breakout",
                 "LTP",
-                "52Wk H",
-                "52Wk L",
+                "52Wk-H",
+                "52Wk-L",
                 "%Chng",
                 "Volume",
                 "MA-Signal",
                 "RSI",
                 "RSIi",
                 "Trend",
                 "Pattern",
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PKScheduledTaskProgress.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PKScheduledTaskProgress.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PKScheduler.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PKScheduler.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PKSpreadsheets.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PKSpreadsheets.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PKTask.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PKTask.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Pktalib.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Pktalib.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Portfolio.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Portfolio.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/PortfolioXRay.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/PortfolioXRay.py`

 * *Files 0% similar despite different names*

```diff
@@ -394,16 +394,16 @@
             task.resultsDict[task.taskId] = scanResults
             task.progressStatusDict[task.taskId] = {'progress': 1, 'total': 1}
         else:
             task.result = scanResults
     return scanResults
 
 def ensureColumnsExist(saveResults):
-    columns = ['Stock', 'Date', 'Volume', 'Trend', 'MA-Signal', 'LTP', '52Wk H',
-               '52Wk L', '1-Pd', '2-Pd', '3-Pd', '4-Pd', '5-Pd', '10-Pd', '15-Pd',
+    columns = ['Stock', 'Date', 'Volume', 'Trend', 'MA-Signal', 'LTP', '52Wk-H',
+               '52Wk-L', '1-Pd', '2-Pd', '3-Pd', '4-Pd', '5-Pd', '10-Pd', '15-Pd',
                '22-Pd', '30-Pd', 'Consol.', 'Breakout', 'RSI', 'Pattern', 'CCI',
                'LTP1', 'Growth1', 'LTP2', 'Growth2', 'LTP3', 'Growth3', 'LTP4',
                'Growth4', 'LTP5', 'Growth5', 'LTP10', 'Growth10', 'LTP15', 'Growth15',
                'LTP22', 'Growth22', 'LTP30', 'Growth30']
     if saveResults is None:
         saveResults = pd.DataFrame(columns=columns)
     else:
@@ -448,16 +448,16 @@
         ].apply(lambda x: x.replace("(Potential)", "") if x is not None else x)
     saveResults["Volume"] = saveResults["Volume"].astype(float).fillna(0.0)
     saveResults[f"Consol."] = (
             saveResults[f"Consol."].astype(float).fillna(0.0)
         )
     saveResults["Breakout"] = saveResults["Breakout"].astype(float).fillna(0.0)
     saveResults["Resistance"] = saveResults["Resistance"].astype(float).fillna(0.0)
-    saveResults["52Wk H"] = saveResults["52Wk H"].astype(float).fillna(0.0)
-    saveResults["52Wk L"] = saveResults["52Wk L"].astype(float).fillna(0.0)
+    saveResults["52Wk-H"] = saveResults["52Wk-H"].astype(float).fillna(0.0)
+    saveResults["52Wk-L"] = saveResults["52Wk-L"].astype(float).fillna(0.0)
     saveResults["CCI"] = saveResults["CCI"].astype(float).fillna(0.0)
     return saveResults
 
 def getbacktestPeriod(args):
     backtestPeriods = configManager.maxBacktestWindow  # Max backtest days
     if args is None or ((not isinstance(args,int)) and (not isinstance(args,Namespace))):
         return backtestPeriods
@@ -1071,51 +1071,51 @@
         return None
     return df[((df["Resistance"] > 0) & (df["LTP"] >= df["Resistance"]))].fillna(0.0)
 
 
 def filterLTPMoreOREqual52WkH(df):
     if df is None:
         return None
-    return df[df["LTP"] >= df["52Wk H"]].fillna(0.0)
+    return df[df["LTP"] >= df["52Wk-H"]].fillna(0.0)
 
 
 def filterLTPWithin90Percent52WkH(df):
     if df is None:
         return None
-    return df[(df["LTP"] >= 0.9 * df["52Wk H"]) & (df["LTP"] < df["52Wk H"])].fillna(
+    return df[(df["LTP"] >= 0.9 * df["52Wk-H"]) & (df["LTP"] < df["52Wk-H"])].fillna(
         0.0
     )
 
 
 def filterLTPLess90Percent52WkH(df):
     if df is None:
         return None
-    return df[df["LTP"] < 0.9 * df["52Wk H"]].fillna(0.0)
+    return df[df["LTP"] < 0.9 * df["52Wk-H"]].fillna(0.0)
 
 
 def filterLTPMore52WkL(df):
     if df is None:
         return None
-    return df[((df["LTP"] > df["52Wk L"]) & (df["LTP"] < 1.1 * df["52Wk L"]))].fillna(
+    return df[((df["LTP"] > df["52Wk-L"]) & (df["LTP"] < 1.1 * df["52Wk-L"]))].fillna(
         0.0
     )
 
 
 def filterLTPWithin90Percent52WkL(df):
     if df is None:
         return None
-    return df[(df["LTP"] >= (1.1 * df["52Wk L"])) & (df["LTP"] > df["52Wk L"])].fillna(
+    return df[(df["LTP"] >= (1.1 * df["52Wk-L"])) & (df["LTP"] > df["52Wk-L"])].fillna(
         0.0
     )
 
 
 def filterLTPLess52WkL(df):
     if df is None:
         return None
-    return df[df["LTP"] <= df["52Wk L"]].fillna(0.0)
+    return df[df["LTP"] <= df["52Wk-L"]].fillna(0.0)
 
 
 def filterCCIBelowMinus100(df):
     if df is None:
         return None
     return df[df["CCI"] <= -100].fillna(0.0)
 
@@ -1167,15 +1167,15 @@
     ---
     `RSI>=50`, `50<=RSI<=67` and `RSI>=68`
 
     CCI
     ---
     `[CCI]<=-100`, `[CCI]-100<C<0`, `[CCI]0<=C<=100`, `[CCI]100<C<=200` and `[CCI]>200`
 
-    52Wk H/L
+    52Wk-H/L
     --------
     `[52Wk]LTP>=H`, `[52Wk]LTP>=.9*H`, `[52Wk]LTP<.9*H`, `[52Wk]LTP>L`, `[52Wk]LTP>=1.1*L` and `[52Wk]LTP<=L`
 
     Breakout
     --------
     `[BO]LTP<BO`, `[BO]LTP>=BO`, `[BO]LTP<R` and `[BO]LTP>=R`
 
@@ -1210,15 +1210,15 @@
     strategies["[RSI]>=68"] = filterRSI68OrAbove
     # CCI
     strategies["[CCI]<=-100"] = filterCCIBelowMinus100
     strategies["[CCI]-100<C<0"] = filterCCIBelow0
     strategies["[CCI]0<=C<=100"] = filterCCI0To100
     strategies["[CCI]100<C<=200"] = filterCCI100To200
     strategies["[CCI]>200"] = filterCCIAbove200
-    # 52Wk H/L
+    # 52Wk-H/L
     strategies["[52Wk]LTP>=H"] = filterLTPMoreOREqual52WkH
     strategies["[52Wk]LTP>=.9*H"] = filterLTPWithin90Percent52WkH
     strategies["[52Wk]LTP<.9*H"] = filterLTPLess90Percent52WkH
     strategies["[52Wk]LTP>L"] = filterLTPMore52WkL
     strategies["[52Wk]LTP>=1.1*L"] = filterLTPWithin90Percent52WkL
     strategies["[52Wk]LTP<=L"] = filterLTPLess52WkL
     # Breakout
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/ScreeningStatistics.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/ScreeningStatistics.py`

 * *Files 0% similar despite different names*

```diff
@@ -266,19 +266,19 @@
 00001090: 2020 2066 756c 6c35 3257 6565 6b48 6967     full52WeekHig
 000010a0: 6820 3d20 6675 6c6c 3532 5765 656b 5b22  h = full52Week["
 000010b0: 4869 6768 225d 2e6d 6178 2829 0a20 2020  High"].max().   
 000010c0: 2020 2020 2066 756c 6c35 3257 6565 6b4c       full52WeekL
 000010d0: 6f77 203d 2066 756c 6c35 3257 6565 6b5b  ow = full52Week[
 000010e0: 224c 6f77 225d 2e6d 696e 2829 0a0a 2020  "Low"].min()..  
 000010f0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00001100: 3532 576b 2048 225d 203d 2022 7b3a 2e32  52Wk H"] = "{:.2
+00001100: 3532 576b 2d48 225d 203d 2022 7b3a 2e32  52Wk-H"] = "{:.2
 00001110: 667d 222e 666f 726d 6174 2866 756c 6c35  f}".format(full5
 00001120: 3257 6565 6b48 6967 6829 0a20 2020 2020  2WeekHigh).     
 00001130: 2020 2073 6176 6544 6963 745b 2235 3257     saveDict["52W
-00001140: 6b20 4c22 5d20 3d20 227b 3a2e 3266 7d22  k L"] = "{:.2f}"
+00001140: 6b2d 4c22 5d20 3d20 227b 3a2e 3266 7d22  k-L"] = "{:.2f}"
 00001150: 2e66 6f72 6d61 7428 6675 6c6c 3532 5765  .format(full52We
 00001160: 656b 4c6f 7729 0a20 2020 2020 2020 2069  ekLow).        i
 00001170: 6620 7265 6365 6e74 4869 6768 203e 3d20  f recentHigh >= 
 00001180: 6675 6c6c 3532 5765 656b 4869 6768 3a0a  full52WeekHigh:.
 00001190: 2020 2020 2020 2020 2020 2020 6869 6768              high
 000011a0: 436f 6c6f 7220 3d20 636f 6c6f 7254 6578  Color = colorTex
 000011b0: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
@@ -302,22 +302,22 @@
 000012d0: 436f 6c6f 7220 3d20 636f 6c6f 7254 6578  Color = colorTex
 000012e0: 742e 5741 524e 0a20 2020 2020 2020 2065  t.WARN.        e
 000012f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
 00001300: 206c 6f77 436f 6c6f 7220 3d20 636f 6c6f   lowColor = colo
 00001310: 7254 6578 742e 4752 4545 4e0a 2020 2020  rText.GREEN.    
 00001320: 2020 2020 7363 7265 656e 4469 6374 5b0a      screenDict[.
 00001330: 2020 2020 2020 2020 2020 2020 2235 3257              "52W
-00001340: 6b20 4822 0a20 2020 2020 2020 205d 203d  k H".        ] =
+00001340: 6b2d 4822 0a20 2020 2020 2020 205d 203d  k-H".        ] =
 00001350: 2066 227b 6869 6768 436f 6c6f 727d 7b73   f"{highColor}{s
 00001360: 7472 2827 7b3a 2e32 667d 272e 666f 726d  tr('{:.2f}'.form
 00001370: 6174 2866 756c 6c35 3257 6565 6b48 6967  at(full52WeekHig
 00001380: 6829 297d 7b63 6f6c 6f72 5465 7874 2e45  h))}{colorText.E
 00001390: 4e44 7d22 0a20 2020 2020 2020 2073 6372  ND}".        scr
 000013a0: 6565 6e44 6963 745b 0a20 2020 2020 2020  eenDict[.       
-000013b0: 2020 2020 2022 3532 576b 204c 220a 2020       "52Wk L".  
+000013b0: 2020 2020 2022 3532 576b 2d4c 220a 2020       "52Wk-L".  
 000013c0: 2020 2020 2020 5d20 3d20 6622 7b6c 6f77        ] = f"{low
 000013d0: 436f 6c6f 727d 7b73 7472 2827 7b3a 2e32  Color}{str('{:.2
 000013e0: 667d 272e 666f 726d 6174 2866 756c 6c35  f}'.format(full5
 000013f0: 3257 6565 6b4c 6f77 2929 7d7b 636f 6c6f  2WeekLow))}{colo
 00001400: 7254 6578 742e 454e 447d 220a 2020 2020  rText.END}".    
 00001410: 2020 2020 2320 6966 2073 656c 662e 7368      # if self.sh
 00001420: 6f75 6c64 4c6f 673a 0a20 2020 2020 2020  ouldLog:.       
@@ -1065,9196 +1065,9203 @@
 00004280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00004290: 2064 665b 2241 626f 7665 225d 203d 2065   df["Above"] = e
 000042a0: 6d61 203e 2064 665b 2241 5452 5472 6169  ma > df["ATRTrai
 000042b0: 6c69 6e67 5374 6f70 225d 0a20 2020 2020  lingStop"].     
 000042c0: 2020 2020 2020 2020 2020 2064 665b 2242             df["B
 000042d0: 656c 6f77 225d 203d 2065 6d61 203c 2064  elow"] = ema < d
 000042e0: 665b 2241 5452 5472 6169 6c69 6e67 5374  f["ATRTrailingSt
-000042f0: 6f70 225d 0a20 2020 2020 2020 200a 2020  op"].        .  
-00004300: 2020 2020 2020 6966 2064 6620 6973 206e        if df is n
-00004310: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00004320: 2020 2020 2064 665b 2242 7579 225d 203d       df["Buy"] =
-00004330: 2028 6466 5b22 436c 6f73 6522 5d20 3e20   (df["Close"] > 
-00004340: 6466 5b22 4154 5254 7261 696c 696e 6753  df["ATRTrailingS
-00004350: 746f 7022 5d29 2026 2028 6466 5b22 4162  top"]) & (df["Ab
-00004360: 6f76 6522 5d3d 3d54 7275 6529 0a20 2020  ove"]==True).   
-00004370: 2020 2020 2020 2020 2064 665b 2253 656c           df["Sel
-00004380: 6c22 5d20 3d20 2864 665b 2243 6c6f 7365  l"] = (df["Close
-00004390: 225d 203c 2064 665b 2241 5452 5472 6169  "] < df["ATRTrai
-000043a0: 6c69 6e67 5374 6f70 225d 2920 2620 2864  lingStop"]) & (d
-000043b0: 665b 2242 656c 6f77 225d 3d3d 5472 7565  f["Below"]==True
-000043c0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000043d0: 6e20 6466 0a0a 2020 2020 6465 6620 6669  n df..    def fi
-000043e0: 6e64 4275 7953 656c 6c53 6967 6e61 6c73  ndBuySellSignals
-000043f0: 4672 6f6d 4154 5254 7261 696c 696e 6728  FromATRTrailing(
-00004400: 7365 6c66 2c64 662c 206b 6579 5f76 616c  self,df, key_val
-00004410: 7565 3d31 2c20 6174 725f 7065 7269 6f64  ue=1, atr_period
-00004420: 3d31 302c 2065 6d61 5f70 6572 696f 643d  =10, ema_period=
-00004430: 3230 302c 6275 7953 656c 6c41 6c6c 3d31  200,buySellAll=1
-00004440: 2c73 6176 6544 6963 743d 4e6f 6e65 2c73  ,saveDict=None,s
-00004450: 6372 6565 6e44 6963 743d 4e6f 6e65 293a  creenDict=None):
-00004460: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
-00004470: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
-00004480: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00004490: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000044a0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-000044b0: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
-000044c0: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
-000044d0: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
-000044e0: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
-000044f0: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
-00004500: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
-00004510: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
-00004520: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
-00004530: 6865 2064 6174 6166 7261 6d65 2073 6f20  he dataframe so 
-00004540: 7468 6174 2069 7473 2074 6865 206f 6c64  that its the old
-00004550: 6573 7420 6461 7465 2066 6972 7374 0a0a  est date first..
-00004560: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-00004570: 6174 6520 4154 5220 616e 6420 7841 5452  ate ATR and xATR
-00004580: 5472 6169 6c69 6e67 5374 6f70 0a20 2020  TrailingStop.   
-00004590: 2020 2020 2078 4154 5220 3d20 6e70 2e61       xATR = np.a
-000045a0: 7272 6179 2870 6b74 616c 6962 2e41 5452  rray(pktalib.ATR
-000045b0: 2864 6174 615b 2748 6967 6827 5d2c 2064  (data['High'], d
-000045c0: 6174 615b 274c 6f77 275d 2c20 6461 7461  ata['Low'], data
-000045d0: 5b27 436c 6f73 6527 5d2c 2074 696d 6570  ['Close'], timep
-000045e0: 6572 696f 643d 6174 725f 7065 7269 6f64  eriod=atr_period
-000045f0: 2929 0a20 2020 2020 2020 206e 4c6f 7373  )).        nLoss
-00004600: 203d 206b 6579 5f76 616c 7565 202a 2078   = key_value * x
-00004610: 4154 520a 2020 2020 2020 2020 7372 6320  ATR.        src 
-00004620: 3d20 6461 7461 5b27 436c 6f73 6527 5d0a  = data['Close'].
-00004630: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
-00004640: 6c69 7a65 2061 7272 6179 730a 2020 2020  lize arrays.    
-00004650: 2020 2020 7841 5452 5472 6169 6c69 6e67      xATRTrailing
-00004660: 5374 6f70 203d 206e 702e 7a65 726f 7328  Stop = np.zeros(
-00004670: 6c65 6e28 6461 7461 2929 0a20 2020 2020  len(data)).     
-00004680: 2020 2078 4154 5254 7261 696c 696e 6753     xATRTrailingS
-00004690: 746f 705b 305d 203d 2073 7263 5b30 5d20  top[0] = src[0] 
-000046a0: 2d20 6e4c 6f73 735b 305d 0a0a 2020 2020  - nLoss[0]..    
-000046b0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-000046c0: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-000046d0: 2075 7369 6e67 2076 6563 746f 7269 7a65   using vectorize
-000046e0: 6420 6f70 6572 6174 696f 6e73 0a20 2020  d operations.   
-000046f0: 2020 2020 206d 6173 6b5f 3120 3d20 2873       mask_1 = (s
-00004700: 7263 203e 206e 702e 726f 6c6c 2878 4154  rc > np.roll(xAT
-00004710: 5254 7261 696c 696e 6753 746f 702c 2031  RTrailingStop, 1
-00004720: 2929 2026 2028 6e70 2e72 6f6c 6c28 7372  )) & (np.roll(sr
-00004730: 632c 2031 2920 3e20 6e70 2e72 6f6c 6c28  c, 1) > np.roll(
-00004740: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-00004750: 2c20 3129 290a 2020 2020 2020 2020 6d61  , 1)).        ma
-00004760: 736b 5f32 203d 2028 7372 6320 3c20 6e70  sk_2 = (src < np
-00004770: 2e72 6f6c 6c28 7841 5452 5472 6169 6c69  .roll(xATRTraili
-00004780: 6e67 5374 6f70 2c20 3129 2920 2620 286e  ngStop, 1)) & (n
-00004790: 702e 726f 6c6c 2873 7263 2c20 3129 203c  p.roll(src, 1) <
-000047a0: 206e 702e 726f 6c6c 2878 4154 5254 7261   np.roll(xATRTra
-000047b0: 696c 696e 6753 746f 702c 2031 2929 0a20  ilingStop, 1)). 
-000047c0: 2020 2020 2020 206d 6173 6b5f 3320 3d20         mask_3 = 
-000047d0: 7372 6320 3e20 6e70 2e72 6f6c 6c28 7841  src > np.roll(xA
-000047e0: 5452 5472 6169 6c69 6e67 5374 6f70 2c20  TRTrailingStop, 
-000047f0: 3129 0a0a 2020 2020 2020 2020 7841 5452  1)..        xATR
-00004800: 5472 6169 6c69 6e67 5374 6f70 203d 206e  TrailingStop = n
-00004810: 702e 7768 6572 6528 6d61 736b 5f31 2c20  p.where(mask_1, 
-00004820: 6e70 2e6d 6178 696d 756d 286e 702e 726f  np.maximum(np.ro
-00004830: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-00004840: 746f 702c 2031 292c 2073 7263 202d 206e  top, 1), src - n
-00004850: 4c6f 7373 292c 2078 4154 5254 7261 696c  Loss), xATRTrail
-00004860: 696e 6753 746f 7029 0a20 2020 2020 2020  ingStop).       
-00004870: 2078 4154 5254 7261 696c 696e 6753 746f   xATRTrailingSto
-00004880: 7020 3d20 6e70 2e77 6865 7265 286d 6173  p = np.where(mas
-00004890: 6b5f 322c 206e 702e 6d69 6e69 6d75 6d28  k_2, np.minimum(
-000048a0: 6e70 2e72 6f6c 6c28 7841 5452 5472 6169  np.roll(xATRTrai
-000048b0: 6c69 6e67 5374 6f70 2c20 3129 2c20 7372  lingStop, 1), sr
-000048c0: 6320 2b20 6e4c 6f73 7329 2c20 7841 5452  c + nLoss), xATR
-000048d0: 5472 6169 6c69 6e67 5374 6f70 290a 2020  TrailingStop).  
-000048e0: 2020 2020 2020 7841 5452 5472 6169 6c69        xATRTraili
-000048f0: 6e67 5374 6f70 203d 206e 702e 7768 6572  ngStop = np.wher
-00004900: 6528 6d61 736b 5f33 2c20 7372 6320 2d20  e(mask_3, src - 
-00004910: 6e4c 6f73 732c 2078 4154 5254 7261 696c  nLoss, xATRTrail
-00004920: 696e 6753 746f 7029 0a0a 2020 2020 2020  ingStop)..      
-00004930: 2020 6d61 736b 5f62 7579 203d 2028 6e70    mask_buy = (np
-00004940: 2e72 6f6c 6c28 7372 632c 2031 2920 3c20  .roll(src, 1) < 
-00004950: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-00004960: 2920 2620 2873 7263 203e 206e 702e 726f  ) & (src > np.ro
-00004970: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-00004980: 746f 702c 2031 2929 0a20 2020 2020 2020  top, 1)).       
-00004990: 206d 6173 6b5f 7365 6c6c 203d 2028 6e70   mask_sell = (np
-000049a0: 2e72 6f6c 6c28 7372 632c 2031 2920 3e20  .roll(src, 1) > 
-000049b0: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-000049c0: 2920 2620 2873 7263 203c 206e 702e 726f  ) & (src < np.ro
-000049d0: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-000049e0: 746f 702c 2031 2929 0a0a 2020 2020 2020  top, 1))..      
-000049f0: 2020 706f 7320 3d20 6e70 2e7a 6572 6f73    pos = np.zeros
-00004a00: 286c 656e 2864 6174 6129 290a 2020 2020  (len(data)).    
-00004a10: 2020 2020 706f 7320 3d20 6e70 2e77 6865      pos = np.whe
-00004a20: 7265 286d 6173 6b5f 6275 792c 2031 2c20  re(mask_buy, 1, 
-00004a30: 706f 7329 0a20 2020 2020 2020 2070 6f73  pos).        pos
-00004a40: 203d 206e 702e 7768 6572 6528 6d61 736b   = np.where(mask
-00004a50: 5f73 656c 6c2c 202d 312c 2070 6f73 290a  _sell, -1, pos).
-00004a60: 2020 2020 2020 2020 706f 735b 7e28 2870          pos[~((p
-00004a70: 6f73 203d 3d20 3129 207c 2028 706f 7320  os == 1) | (pos 
-00004a80: 3d3d 202d 3129 295d 203d 2030 0a0a 2020  == -1))] = 0..  
-00004a90: 2020 2020 2020 656d 6120 3d20 6e70 2e61        ema = np.a
-00004aa0: 7272 6179 2870 6b74 616c 6962 2e45 4d41  rray(pktalib.EMA
-00004ab0: 2864 6174 615b 2743 6c6f 7365 275d 2c20  (data['Close'], 
-00004ac0: 7469 6d65 7065 7269 6f64 3d65 6d61 5f70  timeperiod=ema_p
-00004ad0: 6572 696f 6429 290a 0a20 2020 2020 2020  eriod))..       
-00004ae0: 2062 7579 5f63 6f6e 6469 7469 6f6e 5f75   buy_condition_u
-00004af0: 7462 6f74 203d 2028 7841 5452 5472 6169  tbot = (xATRTrai
-00004b00: 6c69 6e67 5374 6f70 203e 2065 6d61 2920  lingStop > ema) 
-00004b10: 2620 2870 6f73 203e 2030 2920 2620 2873  & (pos > 0) & (s
-00004b20: 7263 203e 2065 6d61 290a 2020 2020 2020  rc > ema).      
-00004b30: 2020 7365 6c6c 5f63 6f6e 6469 7469 6f6e    sell_condition
-00004b40: 5f75 7462 6f74 203d 2028 7841 5452 5472  _utbot = (xATRTr
-00004b50: 6169 6c69 6e67 5374 6f70 203c 2065 6d61  ailingStop < ema
-00004b60: 2920 2620 2870 6f73 203c 2030 2920 2620  ) & (pos < 0) & 
-00004b70: 2873 7263 203c 2065 6d61 290a 0a20 2020  (src < ema)..   
-00004b80: 2020 2020 2023 2054 6865 2072 6573 756c       # The resul
-00004b90: 7469 6e67 2074 7265 6e64 2061 7272 6179  ting trend array
-00004ba0: 2068 6f6c 6473 2076 616c 7565 7320 6f66   holds values of
-00004bb0: 2031 2028 6275 7929 2c20 2d31 2028 7365   1 (buy), -1 (se
-00004bc0: 6c6c 292c 206f 7220 3020 286e 6575 7472  ll), or 0 (neutr
-00004bd0: 616c 292e 0a20 2020 2020 2020 2074 7265  al)..        tre
-00004be0: 6e64 203d 206e 702e 7768 6572 6528 6275  nd = np.where(bu
-00004bf0: 795f 636f 6e64 6974 696f 6e5f 7574 626f  y_condition_utbo
-00004c00: 742c 2031 2c20 6e70 2e77 6865 7265 2873  t, 1, np.where(s
-00004c10: 656c 6c5f 636f 6e64 6974 696f 6e5f 7574  ell_condition_ut
-00004c20: 626f 742c 202d 312c 2030 2929 0a20 2020  bot, -1, 0)).   
-00004c30: 2020 2020 2074 7265 6e64 5f61 7272 203d       trend_arr =
-00004c40: 206e 702e 6172 7261 7928 7472 656e 6429   np.array(trend)
-00004c50: 0a20 2020 2020 2020 2064 6174 612e 696e  .        data.in
-00004c60: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
-00004c70: 6c75 6d6e 7329 2c20 2274 7265 6e64 222c  lumns), "trend",
-00004c80: 2074 7265 6e64 5f61 7272 290a 2020 2020   trend_arr).    
-00004c90: 2020 2020 7472 656e 6420 3d20 7472 656e      trend = tren
-00004ca0: 645b 305d 0a20 2020 2020 2020 2073 6176  d[0].        sav
-00004cb0: 6544 6963 745b 2242 2f53 225d 203d 2022  eDict["B/S"] = "
-00004cc0: 4275 7922 2069 6620 7472 656e 6420 3d3d  Buy" if trend ==
-00004cd0: 2031 2065 6c73 6520 2822 5365 6c6c 2220   1 else ("Sell" 
-00004ce0: 6966 2074 7265 6e64 203d 3d20 2d31 2065  if trend == -1 e
-00004cf0: 6c73 6520 224e 4122 290a 2020 2020 2020  lse "NA").      
-00004d00: 2020 7363 7265 656e 4469 6374 5b22 422f    screenDict["B/
-00004d10: 5322 5d20 3d20 2863 6f6c 6f72 5465 7874  S"] = (colorText
-00004d20: 2e47 5245 454e 202b 2022 4275 7922 2920  .GREEN + "Buy") 
-00004d30: 6966 2074 7265 6e64 203d 3d20 3120 656c  if trend == 1 el
-00004d40: 7365 2028 2863 6f6c 6f72 5465 7874 2e46  se ((colorText.F
-00004d50: 4149 4c2b 2022 5365 6c6c 2229 2069 6620  AIL+ "Sell") if 
-00004d60: 7472 656e 6420 3d3d 202d 3120 656c 7365  trend == -1 else
-00004d70: 2028 636f 6c6f 7254 6578 742e 5741 524e   (colorText.WARN
-00004d80: 202b 2022 4e41 2229 2920 2b20 636f 6c6f   + "NA")) + colo
-00004d90: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00004da0: 2020 7265 7475 726e 2062 7579 5365 6c6c    return buySell
-00004db0: 416c 6c20 3d3d 2074 7265 6e64 0a0a 2020  All == trend..  
-00004dc0: 2020 2320 4578 616d 706c 6520 6f66 2063    # Example of c
-00004dd0: 6f6d 6269 6e69 6e67 2055 5442 6f74 2041  ombining UTBot A
-00004de0: 6c65 7274 7320 7769 7468 2052 5349 2061  lerts with RSI a
-00004df0: 6e64 2041 4458 0a20 2020 2064 6566 2063  nd ADX.    def c
-00004e00: 7573 746f 6d5f 7374 7261 7465 6779 2873  ustom_strategy(s
-00004e10: 656c 662c 6461 7461 6672 616d 6529 3a0a  elf,dataframe):.
-00004e20: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00004e30: 6520 3d20 7365 6c66 2e66 696e 6442 7579  e = self.findBuy
-00004e40: 5365 6c6c 5369 676e 616c 7346 726f 6d41  SellSignalsFromA
-00004e50: 5452 5472 6169 6c69 6e67 2864 6174 6166  TRTrailing(dataf
-00004e60: 7261 6d65 2c20 6b65 795f 7661 6c75 653d  rame, key_value=
-00004e70: 322c 2061 7472 5f70 6572 696f 643d 372c  2, atr_period=7,
-00004e80: 2065 6d61 5f70 6572 696f 643d 3130 3029   ema_period=100)
-00004e90: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00004ea0: 2020 2320 4361 6c63 756c 6174 6520 5253    # Calculate RS
-00004eb0: 4920 616e 6420 4144 580a 2020 2020 2020  I and ADX.      
-00004ec0: 2020 7273 6920 3d20 706b 7461 6c69 622e    rsi = pktalib.
-00004ed0: 5253 4928 6461 7461 6672 616d 655b 2743  RSI(dataframe['C
-00004ee0: 6c6f 7365 275d 290a 2020 2020 2020 2020  lose']).        
-00004ef0: 6164 7820 3d20 706b 7461 6c69 622e 4144  adx = pktalib.AD
-00004f00: 5828 6461 7461 6672 616d 655b 2748 6967  X(dataframe['Hig
-00004f10: 6827 5d2c 2064 6174 6166 7261 6d65 5b27  h'], dataframe['
-00004f20: 4c6f 7727 5d2c 2064 6174 6166 7261 6d65  Low'], dataframe
-00004f30: 5b27 436c 6f73 6527 5d29 0a20 2020 2020  ['Close']).     
-00004f40: 2020 200a 2020 2020 2020 2020 2320 4465     .        # De
-00004f50: 6669 6e65 2063 6f6e 6469 7469 6f6e 7320  fine conditions 
-00004f60: 6261 7365 6420 6f6e 2055 5442 6f74 2041  based on UTBot A
-00004f70: 6c65 7274 7320 616e 6420 6164 6469 7469  lerts and additi
-00004f80: 6f6e 616c 2069 6e64 6963 6174 6f72 730a  onal indicators.
-00004f90: 2020 2020 2020 2020 2320 2e2e 2e20 2879          # ... (y
-00004fa0: 6f75 7220 6375 7374 6f6d 2063 6f6e 6469  our custom condi
-00004fb0: 7469 6f6e 7320 6865 7265 290a 2020 2020  tions here).    
-00004fc0: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
-00004fd0: 7572 6e20 6461 7461 6672 616d 650a 2020  urn dataframe.  
-00004fe0: 2020 0a20 2020 2064 6566 2070 6f70 756c    .    def popul
-00004ff0: 6174 655f 696e 6469 6361 746f 7273 2873  ate_indicators(s
-00005000: 656c 662c 2064 6174 6166 7261 6d65 3a20  elf, dataframe: 
-00005010: 7064 2e44 6174 6146 7261 6d65 2c20 6d65  pd.DataFrame, me
-00005020: 7461 6461 7461 3a20 6469 6374 2920 2d3e  tadata: dict) ->
-00005030: 2070 642e 4461 7461 4672 616d 653a 0a20   pd.DataFrame:. 
-00005040: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00005050: 6c66 2e64 703a 0a20 2020 2020 2020 2020  lf.dp:.         
-00005060: 2020 2023 2044 6f6e 2774 2064 6f20 616e     # Don't do an
-00005070: 7974 6869 6e67 2069 6620 4461 7461 5072  ything if DataPr
-00005080: 6f76 6964 6572 2069 7320 6e6f 7420 6176  ovider is not av
-00005090: 6169 6c61 626c 652e 0a20 2020 2020 2020  ailable..       
-000050a0: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
-000050b0: 6672 616d 650a 2020 2020 2020 2020 4c5f  frame.        L_
-000050c0: 6f70 7469 6d69 7a65 5f74 7265 6e64 5f61  optimize_trend_a
-000050d0: 6c65 7274 2020 3d20 7365 6c66 2e66 696e  lert  = self.fin
-000050e0: 6442 7579 5365 6c6c 5369 676e 616c 7346  dBuySellSignalsF
-000050f0: 726f 6d41 5452 5472 6169 6c69 6e67 2864  romATRTrailing(d
-00005100: 6174 6166 7261 6d65 3d64 6174 6166 7261  ataframe=datafra
-00005110: 6d65 2c20 6b65 795f 7661 6c75 653d 2073  me, key_value= s
-00005120: 656c 662e 6b65 795f 7661 6c75 655f 6c2e  elf.key_value_l.
-00005130: 7661 6c75 652c 2061 7472 5f70 6572 696f  value, atr_perio
-00005140: 643d 2073 656c 662e 6174 725f 7065 7269  d= self.atr_peri
-00005150: 6f64 5f6c 2e76 616c 7565 2c20 656d 615f  od_l.value, ema_
-00005160: 7065 7269 6f64 3d73 656c 662e 656d 615f  period=self.ema_
-00005170: 7065 7269 6f64 5f6c 2e76 616c 7565 290a  period_l.value).
-00005180: 2020 2020 2020 2020 2320 4c6f 6e67 2070          # Long p
-00005190: 6f73 6974 696f 6e3f 0a20 2020 2020 2020  osition?.       
-000051a0: 2064 6174 6166 7261 6d65 5b27 7472 656e   dataframe['tren
-000051b0: 645f 6c27 5d20 3d20 4c5f 6f70 7469 6d69  d_l'] = L_optimi
-000051c0: 7a65 5f74 7265 6e64 5f61 6c65 7274 5b27  ze_trend_alert['
-000051d0: 7472 656e 6427 5d0a 2020 2020 2020 2020  trend'].        
-000051e0: 535f 6f70 7469 6d69 7a65 5f74 7265 6e64  S_optimize_trend
-000051f0: 5f61 6c65 7274 2020 3d20 7365 6c66 2e66  _alert  = self.f
-00005200: 696e 6442 7579 5365 6c6c 5369 676e 616c  indBuySellSignal
-00005210: 7346 726f 6d41 5452 5472 6169 6c69 6e67  sFromATRTrailing
-00005220: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
-00005230: 7261 6d65 2c20 6b65 795f 7661 6c75 653d  rame, key_value=
-00005240: 2073 656c 662e 6b65 795f 7661 6c75 655f   self.key_value_
-00005250: 732e 7661 6c75 652c 2061 7472 5f70 6572  s.value, atr_per
-00005260: 696f 643d 2073 656c 662e 6174 725f 7065  iod= self.atr_pe
-00005270: 7269 6f64 5f73 2e76 616c 7565 2c20 656d  riod_s.value, em
-00005280: 615f 7065 7269 6f64 3d73 656c 662e 656d  a_period=self.em
-00005290: 615f 7065 7269 6f64 5f73 2e76 616c 7565  a_period_s.value
-000052a0: 290a 2020 2020 2020 2020 2320 5368 6f72  ).        # Shor
-000052b0: 7420 706f 7369 7469 6f6e 3f0a 2020 2020  t position?.    
-000052c0: 2020 2020 6461 7461 6672 616d 655b 2774      dataframe['t
-000052d0: 7265 6e64 5f73 275d 203d 2053 5f6f 7074  rend_s'] = S_opt
-000052e0: 696d 697a 655f 7472 656e 645f 616c 6572  imize_trend_aler
-000052f0: 745b 2774 7265 6e64 275d 0a0a 2020 2020  t['trend']..    
-00005300: 2020 2020 2320 4144 580a 2020 2020 2020      # ADX.      
-00005310: 2020 6461 7461 6672 616d 655b 2761 6478    dataframe['adx
-00005320: 275d 203d 2070 6b74 616c 6962 2e41 4458  '] = pktalib.ADX
-00005330: 2864 6174 6166 7261 6d65 290a 2020 2020  (dataframe).    
-00005340: 2020 2020 0a20 2020 2020 2020 2023 2052      .        # R
-00005350: 5349 0a20 2020 2020 2020 2023 2064 6174  SI.        # dat
-00005360: 6166 7261 6d65 5b27 7273 6927 5d20 3d20  aframe['rsi'] = 
-00005370: 7461 2e52 5349 2864 6174 6166 7261 6d65  ta.RSI(dataframe
-00005380: 290a 0a20 2020 2020 2020 2023 2045 4d41  )..        # EMA
-00005390: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
-000053a0: 6d65 5b27 656d 615f 6c27 5d20 3d20 706b  me['ema_l'] = pk
-000053b0: 7461 6c69 622e 454d 4128 6461 7461 6672  talib.EMA(datafr
-000053c0: 616d 655b 2763 6c6f 7365 275d 2c20 7469  ame['close'], ti
-000053d0: 6d65 7065 7269 6f64 3d73 656c 662e 656d  meperiod=self.em
-000053e0: 615f 7065 7269 6f64 5f6c 5f65 7869 742e  a_period_l_exit.
-000053f0: 7661 6c75 6529 0a20 2020 2020 2020 2064  value).        d
-00005400: 6174 6166 7261 6d65 5b27 656d 615f 7327  ataframe['ema_s'
-00005410: 5d20 3d20 706b 7461 6c69 622e 454d 4128  ] = pktalib.EMA(
-00005420: 6461 7461 6672 616d 655b 2763 6c6f 7365  dataframe['close
-00005430: 275d 2c20 7469 6d65 7065 7269 6f64 3d73  '], timeperiod=s
-00005440: 656c 662e 656d 615f 7065 7269 6f64 5f73  elf.ema_period_s
-00005450: 5f65 7869 742e 7661 6c75 6529 0a0a 0a20  _exit.value)... 
-00005460: 2020 2020 2020 2023 2056 6f6c 756d 6520         # Volume 
-00005470: 5765 6967 6874 6564 0a20 2020 2020 2020  Weighted.       
-00005480: 2064 6174 6166 7261 6d65 5b27 766f 6c75   dataframe['volu
-00005490: 6d65 5f6d 6561 6e27 5d20 3d20 6461 7461  me_mean'] = data
-000054a0: 6672 616d 655b 2776 6f6c 756d 6527 5d2e  frame['volume'].
-000054b0: 726f 6c6c 696e 6728 7365 6c66 2e76 6f6c  rolling(self.vol
-000054c0: 756d 655f 6368 6563 6b2e 7661 6c75 6529  ume_check.value)
-000054d0: 2e6d 6561 6e28 292e 7368 6966 7428 3129  .mean().shift(1)
-000054e0: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
-000054f0: 6d65 5b27 766f 6c75 6d65 5f6d 6561 6e5f  me['volume_mean_
-00005500: 6578 6974 275d 203d 2064 6174 6166 7261  exit'] = datafra
-00005510: 6d65 5b27 766f 6c75 6d65 275d 2e72 6f6c  me['volume'].rol
-00005520: 6c69 6e67 2873 656c 662e 766f 6c75 6d65  ling(self.volume
-00005530: 5f63 6865 636b 5f65 7869 742e 7661 6c75  _check_exit.valu
-00005540: 6529 2e6d 6561 6e28 292e 7368 6966 7428  e).mean().shift(
-00005550: 3129 0a0a 2020 2020 2020 2020 6461 7461  1)..        data
-00005560: 6672 616d 655b 2776 6f6c 756d 655f 6d65  frame['volume_me
-00005570: 616e 5f73 275d 203d 2064 6174 6166 7261  an_s'] = datafra
-00005580: 6d65 5b27 766f 6c75 6d65 275d 2e72 6f6c  me['volume'].rol
-00005590: 6c69 6e67 2873 656c 662e 766f 6c75 6d65  ling(self.volume
-000055a0: 5f63 6865 636b 5f73 2e76 616c 7565 292e  _check_s.value).
-000055b0: 6d65 616e 2829 2e73 6869 6674 2831 290a  mean().shift(1).
-000055c0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-000055d0: 655b 2776 6f6c 756d 655f 6d65 616e 5f65  e['volume_mean_e
-000055e0: 7869 745f 7327 5d20 3d20 6461 7461 6672  xit_s'] = datafr
-000055f0: 616d 655b 2776 6f6c 756d 6527 5d2e 726f  ame['volume'].ro
-00005600: 6c6c 696e 6728 7365 6c66 2e76 6f6c 756d  lling(self.volum
-00005610: 655f 6368 6563 6b5f 6578 6974 5f73 2e76  e_check_exit_s.v
-00005620: 616c 7565 292e 6d65 616e 2829 2e73 6869  alue).mean().shi
-00005630: 6674 2831 290a 2020 2020 2020 2020 7265  ft(1).        re
-00005640: 7475 726e 2064 6174 6166 7261 6d65 0a20  turn dataframe. 
-00005650: 2020 200a 2020 2020 6465 6620 706f 7075     .    def popu
-00005660: 6c61 7465 5f65 6e74 7279 5f74 7265 6e64  late_entry_trend
-00005670: 2873 656c 662c 2064 6174 6166 7261 6d65  (self, dataframe
-00005680: 3a20 7064 2e44 6174 6146 7261 6d65 2c20  : pd.DataFrame, 
-00005690: 6d65 7461 6461 7461 3a20 6469 6374 2920  metadata: dict) 
-000056a0: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
-000056b0: 0a0a 2020 2020 2020 2020 6461 7461 6672  ..        datafr
-000056c0: 616d 652e 6c6f 635b 0a20 2020 2020 2020  ame.loc[.       
-000056d0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-000056e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000056f0: 6461 7461 6672 616d 655b 2761 6478 275d  dataframe['adx']
-00005700: 203e 2073 656c 662e 6164 785f 6c6f 6e67   > self.adx_long
-00005710: 5f6d 696e 2e76 616c 7565 2920 2620 2320  _min.value) & # 
-00005720: 7472 656e 6420 7374 7265 6e67 7468 2063  trend strength c
-00005730: 6f6e 6669 726d 6174 696f 6e0a 2020 2020  onfirmation.    
-00005740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005750: 2020 2020 2864 6174 6166 7261 6d65 5b27      (dataframe['
-00005760: 6164 7827 5d20 3c20 7365 6c66 2e61 6478  adx'] < self.adx
-00005770: 5f6c 6f6e 675f 6d61 782e 7661 6c75 6529  _long_max.value)
-00005780: 2026 2023 2074 7265 6e64 2073 7472 656e   & # trend stren
-00005790: 6774 6820 636f 6e66 6972 6d61 7469 6f6e  gth confirmation
-000057a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000057b0: 2020 2020 2020 2020 2028 6461 7461 6672           (datafr
-000057c0: 616d 655b 2774 7265 6e64 5f6c 275d 203e  ame['trend_l'] >
-000057d0: 2030 2920 260a 2020 2020 2020 2020 2020   0) &.          
-000057e0: 2020 2020 2020 2020 2020 2020 2020 2864                (d
-000057f0: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
-00005800: 275d 203e 2064 6174 6166 7261 6d65 5b27  '] > dataframe['
-00005810: 766f 6c75 6d65 5f6d 6561 6e27 5d29 2026  volume_mean']) &
-00005820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005830: 2020 2020 2020 2020 2028 6461 7461 6672           (datafr
-00005840: 616d 655b 2776 6f6c 756d 6527 5d20 3e20  ame['volume'] > 
-00005850: 3029 0a0a 2020 2020 2020 2020 2020 2020  0)..            
-00005860: 292c 0a20 2020 2020 2020 2020 2020 2027  ),.            '
-00005870: 656e 7465 725f 6c6f 6e67 275d 203d 2031  enter_long'] = 1
-00005880: 0a0a 2020 2020 2020 2020 6461 7461 6672  ..        datafr
-00005890: 616d 652e 6c6f 635b 0a20 2020 2020 2020  ame.loc[.       
-000058a0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-000058b0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000058c0: 6461 7461 6672 616d 655b 2761 6478 275d  dataframe['adx']
-000058d0: 203e 2073 656c 662e 6164 785f 7368 6f72   > self.adx_shor
-000058e0: 745f 6d69 6e2e 7661 6c75 6529 2026 2023  t_min.value) & #
-000058f0: 2074 7265 6e64 2073 7472 656e 6774 6820   trend strength 
-00005900: 636f 6e66 6972 6d61 7469 6f6e 0a20 2020  confirmation.   
-00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005920: 2020 2020 2028 6461 7461 6672 616d 655b       (dataframe[
-00005930: 2761 6478 275d 203c 2073 656c 662e 6164  'adx'] < self.ad
-00005940: 785f 7368 6f72 745f 6d61 782e 7661 6c75  x_short_max.valu
-00005950: 6529 2026 2023 2074 7265 6e64 2073 7472  e) & # trend str
-00005960: 656e 6774 6820 636f 6e66 6972 6d61 7469  ength confirmati
-00005970: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00005980: 2020 2020 2020 2020 2020 2028 6461 7461             (data
-00005990: 6672 616d 655b 2774 7265 6e64 5f73 275d  frame['trend_s']
-000059a0: 203c 2030 2920 260a 2020 2020 2020 2020   < 0) &.        
-000059b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059c0: 2864 6174 6166 7261 6d65 5b27 766f 6c75  (dataframe['volu
-000059d0: 6d65 275d 203e 2064 6174 6166 7261 6d65  me'] > dataframe
-000059e0: 5b27 766f 6c75 6d65 5f6d 6561 6e5f 7327  ['volume_mean_s'
-000059f0: 5d29 2023 2076 6f6c 756d 6520 7765 6967  ]) # volume weig
-00005a00: 6874 6564 2069 6e64 6963 6174 6f72 0a20  hted indicator. 
-00005a10: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00005a20: 2020 2020 2020 2020 2020 2765 6e74 6572            'enter
-00005a30: 5f73 686f 7274 275d 203d 2031 0a20 2020  _short'] = 1.   
-00005a40: 2020 2020 200a 2020 2020 2020 2020 7265       .        re
-00005a50: 7475 726e 2064 6174 6166 7261 6d65 0a20  turn dataframe. 
-00005a60: 2020 200a 2020 2020 6465 6620 706f 7075     .    def popu
-00005a70: 6c61 7465 5f65 7869 745f 7472 656e 6428  late_exit_trend(
-00005a80: 7365 6c66 2c20 6461 7461 6672 616d 653a  self, dataframe:
-00005a90: 2070 642e 4461 7461 4672 616d 652c 206d   pd.DataFrame, m
-00005aa0: 6574 6164 6174 613a 2064 6963 7429 202d  etadata: dict) -
-00005ab0: 3e20 7064 2e44 6174 6146 7261 6d65 3a0a  > pd.DataFrame:.
-00005ac0: 0a20 2020 2020 2020 2063 6f6e 6469 7469  .        conditi
-00005ad0: 6f6e 735f 6c6f 6e67 203d 205b 5d0a 2020  ons_long = [].  
-00005ae0: 2020 2020 2020 636f 6e64 6974 696f 6e73        conditions
-00005af0: 5f73 686f 7274 203d 205b 5d0a 2020 2020  _short = [].    
-00005b00: 2020 2020 6461 7461 6672 616d 652e 6c6f      dataframe.lo
-00005b10: 635b 3a2c 2027 6578 6974 5f74 6167 275d  c[:, 'exit_tag']
-00005b20: 203d 2027 270a 0a20 2020 2020 2020 2065   = ''..        e
-00005b30: 7869 745f 6c6f 6e67 203d 2028 0a20 2020  xit_long = (.   
-00005b40: 2020 2020 2020 2020 2020 2020 2023 2028               # (
-00005b50: 6461 7461 6672 616d 655b 2763 6c6f 7365  dataframe['close
-00005b60: 275d 203c 2064 6174 6166 7261 6d65 5b27  '] < dataframe['
-00005b70: 6c6f 7727 5d2e 7368 6966 7428 7365 6c66  low'].shift(self
-00005b80: 2e73 656c 6c5f 7368 6966 742e 7661 6c75  .sell_shift.valu
-00005b90: 6529 2920 260a 2020 2020 2020 2020 2020  e)) &.          
-00005ba0: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
-00005bb0: 5b27 636c 6f73 6527 5d20 3c20 6461 7461  ['close'] < data
-00005bc0: 6672 616d 655b 2765 6d61 5f6c 275d 2920  frame['ema_l']) 
-00005bd0: 260a 2020 2020 2020 2020 2020 2020 2020  &.              
-00005be0: 2020 2864 6174 6166 7261 6d65 5b27 766f    (dataframe['vo
-00005bf0: 6c75 6d65 275d 203e 2064 6174 6166 7261  lume'] > datafra
-00005c00: 6d65 5b27 766f 6c75 6d65 5f6d 6561 6e5f  me['volume_mean_
-00005c10: 6578 6974 275d 290a 2020 2020 2020 2020  exit']).        
-00005c20: 290a 0a20 2020 2020 2020 2065 7869 745f  )..        exit_
-00005c30: 7368 6f72 7420 3d20 280a 2020 2020 2020  short = (.      
-00005c40: 2020 2020 2020 2020 2020 2320 2864 6174            # (dat
-00005c50: 6166 7261 6d65 5b27 636c 6f73 6527 5d20  aframe['close'] 
-00005c60: 3e20 6461 7461 6672 616d 655b 2768 6967  > dataframe['hig
-00005c70: 6827 5d2e 7368 6966 7428 7365 6c66 2e73  h'].shift(self.s
-00005c80: 656c 6c5f 7368 6966 745f 7368 6f72 742e  ell_shift_short.
-00005c90: 7661 6c75 6529 2920 260a 2020 2020 2020  value)) &.      
-00005ca0: 2020 2020 2020 2020 2020 2864 6174 6166            (dataf
-00005cb0: 7261 6d65 5b27 636c 6f73 6527 5d20 3e20  rame['close'] > 
-00005cc0: 6461 7461 6672 616d 655b 2765 6d61 5f73  dataframe['ema_s
-00005cd0: 275d 2920 260a 2020 2020 2020 2020 2020  ']) &.          
-00005ce0: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
-00005cf0: 5b27 766f 6c75 6d65 275d 203e 2064 6174  ['volume'] > dat
-00005d00: 6166 7261 6d65 5b27 766f 6c75 6d65 5f6d  aframe['volume_m
-00005d10: 6561 6e5f 6578 6974 5f73 275d 290a 2020  ean_exit_s']).  
-00005d20: 2020 2020 2020 290a 0a0a 2020 2020 2020        )...      
-00005d30: 2020 636f 6e64 6974 696f 6e73 5f73 686f    conditions_sho
-00005d40: 7274 2e61 7070 656e 6428 6578 6974 5f73  rt.append(exit_s
-00005d50: 686f 7274 290a 2020 2020 2020 2020 6461  hort).        da
-00005d60: 7461 6672 616d 652e 6c6f 635b 6578 6974  taframe.loc[exit
-00005d70: 5f73 686f 7274 2c20 2765 7869 745f 7461  _short, 'exit_ta
-00005d80: 6727 5d20 2b3d 2027 6578 6974 5f73 686f  g'] += 'exit_sho
-00005d90: 7274 270a 0a0a 2020 2020 2020 2020 636f  rt'...        co
-00005da0: 6e64 6974 696f 6e73 5f6c 6f6e 672e 6170  nditions_long.ap
-00005db0: 7065 6e64 2865 7869 745f 6c6f 6e67 290a  pend(exit_long).
-00005dc0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00005dd0: 652e 6c6f 635b 6578 6974 5f6c 6f6e 672c  e.loc[exit_long,
-00005de0: 2027 6578 6974 5f74 6167 275d 202b 3d20   'exit_tag'] += 
-00005df0: 2765 7869 745f 6c6f 6e67 270a 0a0a 2020  'exit_long'...  
-00005e00: 2020 2020 2020 6966 2063 6f6e 6469 7469        if conditi
-00005e10: 6f6e 735f 6c6f 6e67 3a0a 2020 2020 2020  ons_long:.      
-00005e20: 2020 2020 2020 6461 7461 6672 616d 652e        dataframe.
-00005e30: 6c6f 635b 0a20 2020 2020 2020 2020 2020  loc[.           
-00005e40: 2020 2020 2070 642e 7265 6475 6365 286c       pd.reduce(l
-00005e50: 616d 6264 6120 782c 2079 3a20 7820 7c20  ambda x, y: x | 
-00005e60: 792c 2063 6f6e 6469 7469 6f6e 735f 6c6f  y, conditions_lo
-00005e70: 6e67 292c 0a20 2020 2020 2020 2020 2020  ng),.           
-00005e80: 2020 2020 2027 6578 6974 5f6c 6f6e 6727       'exit_long'
-00005e90: 5d20 3d20 310a 0a20 2020 2020 2020 2069  ] = 1..        i
-00005ea0: 6620 636f 6e64 6974 696f 6e73 5f73 686f  f conditions_sho
-00005eb0: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-00005ec0: 6461 7461 6672 616d 652e 6c6f 635b 0a20  dataframe.loc[. 
-00005ed0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00005ee0: 642e 7265 6475 6365 286c 616d 6264 6120  d.reduce(lambda 
-00005ef0: 782c 2079 3a20 7820 7c20 792c 2063 6f6e  x, y: x | y, con
-00005f00: 6469 7469 6f6e 735f 7368 6f72 7429 2c0a  ditions_short),.
-00005f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f20: 2765 7869 745f 7368 6f72 7427 5d20 3d20  'exit_short'] = 
-00005f30: 310a 2020 2020 2020 2020 2020 2020 0a20  1.            . 
-00005f40: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
-00005f50: 7461 6672 616d 650a 0a20 2020 2023 2064  taframe..    # d
-00005f60: 6566 2069 6465 6e74 6966 795f 6465 6d61  ef identify_dema
-00005f70: 6e64 5f7a 6f6e 6528 7365 6c66 2c64 6174  nd_zone(self,dat
-00005f80: 612c 2063 6d70 293a 0a20 2020 2023 2020  a, cmp):.    #  
-00005f90: 2020 2064 656d 616e 645f 7a6f 6e65 7320     demand_zones 
-00005fa0: 3d20 5b5d 0a20 2020 2023 2020 2020 2064  = [].    #     d
-00005fb0: 726f 705f 6261 7365 5f72 616c 6c79 5f7a  rop_base_rally_z
-00005fc0: 6f6e 6520 3d20 4661 6c73 650a 2020 2020  one = False.    
-00005fd0: 2320 2020 2020 7261 6c6c 795f 6261 7365  #     rally_base
-00005fe0: 5f72 616c 6c79 5f7a 6f6e 6520 3d20 4661  _rally_zone = Fa
-00005ff0: 6c73 650a 2020 2020 2020 2020 0a20 2020  lse.        .   
-00006000: 2023 2020 2020 2023 2041 6464 6974 696f   #     # Additio
-00006010: 6e61 6c20 7661 7269 6162 6c65 7320 746f  nal variables to
-00006020: 2074 7261 636b 2062 6173 6520 6361 6e64   track base cand
-00006030: 6c65 2070 7269 6365 7320 666f 7220 7072  le prices for pr
-00006040: 6f78 696d 616c 206c 696e 6520 6361 6c63  oximal line calc
-00006050: 756c 6174 696f 6e0a 2020 2020 2320 2020  ulation.    #   
-00006060: 2020 6261 7365 5f63 616e 646c 655f 7072    base_candle_pr
-00006070: 6963 6573 203d 205b 5d0a 2020 2020 2020  ices = [].      
-00006080: 2020 0a20 2020 2023 2020 2020 2066 6f72    .    #     for
-00006090: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-000060a0: 6461 7461 2920 2d20 3229 3a0a 2020 2020  data) - 2):.    
-000060b0: 2320 2020 2020 2020 2020 6966 2064 6174  #         if dat
-000060c0: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-000060d0: 5b69 5d20 3d3d 2027 4472 6f70 2043 616e  [i] == 'Drop Can
-000060e0: 646c 6527 2061 6e64 2064 6174 615b 2743  dle' and data['C
-000060f0: 616e 646c 6520 5479 7065 275d 5b69 202b  andle Type'][i +
-00006100: 2031 5d20 3d3d 2027 4261 7365 2043 616e   1] == 'Base Can
-00006110: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-00006120: 2020 2020 2020 2020 6261 7365 5f63 6f75          base_cou
-00006130: 6e74 203d 2031 0a20 2020 2023 2020 2020  nt = 1.    #    
-00006140: 2020 2020 2020 2020 206a 203d 2069 202b           j = i +
-00006150: 2032 0a20 2020 2023 2020 2020 2020 2020   2.    #        
-00006160: 2020 2020 2077 6869 6c65 206a 203c 206c       while j < l
-00006170: 656e 2864 6174 6129 2061 6e64 2064 6174  en(data) and dat
-00006180: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-00006190: 5b6a 5d20 3d3d 2027 4261 7365 2043 616e  [j] == 'Base Can
-000061a0: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-000061b0: 2020 2020 2020 2020 2020 2020 6261 7365              base
-000061c0: 5f63 6f75 6e74 202b 3d20 310a 2020 2020  _count += 1.    
-000061d0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000061e0: 2020 6a20 2b3d 2031 0a20 2020 2020 2020    j += 1.       
-000061f0: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-00006200: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-00006210: 6173 655f 636f 756e 7420 3c3d 2034 3a20  ase_count <= 4: 
-00006220: 2023 204d 6178 696d 756d 206f 6620 3420   # Maximum of 4 
-00006230: 6261 7365 2063 616e 646c 6573 2066 6f72  base candles for
-00006240: 2077 6565 6b6c 7920 6f72 206d 6f6e 7468   weekly or month
-00006250: 6c79 2074 696d 6566 7261 6d65 2c20 656c  ly timeframe, el
-00006260: 7365 2033 2066 6f72 2064 6169 6c79 0a20  se 3 for daily. 
-00006270: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00006280: 2020 2020 2069 6620 6a20 3c20 6c65 6e28       if j < len(
-00006290: 6461 7461 2920 616e 6420 6461 7461 5b27  data) and data['
-000062a0: 4361 6e64 6c65 2054 7970 6527 5d5b 6a5d  Candle Type'][j]
-000062b0: 203d 3d20 2752 616c 6c79 2043 616e 646c   == 'Rally Candl
-000062c0: 6527 3a0a 2020 2020 2320 2020 2020 2020  e':.    #       
-000062d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000062e0: 2064 6174 615b 2743 6c6f 7365 275d 5b6a   data['Close'][j
-000062f0: 5d20 3e20 6461 7461 5b27 4c6f 7727 5d5b  ] > data['Low'][
-00006300: 695d 202b 2030 2e36 202a 2064 6174 615b  i] + 0.6 * data[
-00006310: 2743 616e 646c 6520 5261 6e67 6527 5d5b  'Candle Range'][
-00006320: 695d 2061 6e64 2064 6174 615b 2748 6967  i] and data['Hig
-00006330: 6827 5d5b 695d 203c 3d20 636d 703a 0a20  h'][i] <= cmp:. 
-00006340: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00006350: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00006360: 6865 636b 2066 6f72 206f 6e65 206d 6f72  heck for one mor
-00006370: 6520 7261 6c6c 7920 6361 6e64 6c65 206f  e rally candle o
-00006380: 7220 6772 6565 6e20 6261 7365 2063 616e  r green base can
-00006390: 646c 650a 2020 2020 2320 2020 2020 2020  dle.    #       
-000063a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063b0: 2020 6b20 3d20 6a20 2b20 310a 2020 2020    k = j + 1.    
-000063c0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000063d0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-000063e0: 6b20 3c20 6c65 6e28 6461 7461 293a 0a20  k < len(data):. 
-000063f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006410: 2069 6620 6461 7461 5b27 4361 6e64 6c65   if data['Candle
-00006420: 2054 7970 6527 5d5b 6b5d 203d 3d20 2752   Type'][k] == 'R
-00006430: 616c 6c79 2043 616e 646c 6527 206f 7220  ally Candle' or 
-00006440: 2864 6174 615b 2743 616e 646c 6520 5479  (data['Candle Ty
-00006450: 7065 275d 5b6b 5d20 3d3d 2027 4261 7365  pe'][k] == 'Base
-00006460: 2043 616e 646c 6527 2061 6e64 2064 6174   Candle' and dat
-00006470: 615b 2743 6c6f 7365 275d 5b6b 5d20 3e20  a['Close'][k] > 
-00006480: 6461 7461 5b27 4f70 656e 275d 5b6b 5d29  data['Open'][k])
-00006490: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-000064a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064b0: 2020 2020 2020 2020 6465 6d61 6e64 5f7a          demand_z
-000064c0: 6f6e 6573 2e61 7070 656e 6428 2869 2c20  ones.append((i, 
-000064d0: 6a2c 2027 4472 6f70 2042 6173 6520 5261  j, 'Drop Base Ra
-000064e0: 6c6c 7927 2c20 6261 7365 5f63 6f75 6e74  lly', base_count
-000064f0: 2929 0a20 2020 2023 2020 2020 2020 2020  )).    #        
-00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006510: 2020 2020 2020 2020 2064 726f 705f 6261           drop_ba
-00006520: 7365 5f72 616c 6c79 5f7a 6f6e 6520 3d20  se_rally_zone = 
-00006530: 5472 7565 0a20 2020 2023 2020 2020 2020  True.    #      
-00006540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006550: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00006560: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 2020 206b 202b 3d20 310a 2020 2020 2320     k += 1.    # 
-00006590: 2020 2020 2020 2020 656c 6966 2064 6174          elif dat
-000065a0: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-000065b0: 5b69 5d20 3d3d 2027 5261 6c6c 7920 4361  [i] == 'Rally Ca
-000065c0: 6e64 6c65 2720 616e 6420 6461 7461 5b27  ndle' and data['
-000065d0: 4361 6e64 6c65 2054 7970 6527 5d5b 6920  Candle Type'][i 
-000065e0: 2b20 315d 203d 3d20 2742 6173 6520 4361  + 1] == 'Base Ca
-000065f0: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
-00006600: 2020 2020 2020 2020 2062 6173 655f 636f           base_co
-00006610: 756e 7420 3d20 310a 2020 2020 2320 2020  unt = 1.    #   
-00006620: 2020 2020 2020 2020 2020 6a20 3d20 6920            j = i 
-00006630: 2b20 320a 2020 2020 2320 2020 2020 2020  + 2.    #       
-00006640: 2020 2020 2020 7768 696c 6520 6a20 3c20        while j < 
-00006650: 6c65 6e28 6461 7461 2920 616e 6420 6461  len(data) and da
-00006660: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
-00006670: 5d5b 6a5d 203d 3d20 2742 6173 6520 4361  ][j] == 'Base Ca
-00006680: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
-00006690: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-000066a0: 655f 636f 756e 7420 2b3d 2031 0a20 2020  e_count += 1.   
-000066b0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-000066c0: 2020 206a 202b 3d20 310a 2020 2020 2020     j += 1.      
-000066d0: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-000066e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000066f0: 6261 7365 5f63 6f75 6e74 203e 3d20 313a  base_count >= 1:
-00006700: 2020 2320 4174 206c 6561 7374 206f 6e65    # At least one
-00006710: 2062 6173 6520 6361 6e64 6c65 2072 6571   base candle req
-00006720: 7569 7265 640a 2020 2020 2320 2020 2020  uired.    #     
-00006730: 2020 2020 2020 2020 2020 2020 6966 206a              if j
-00006740: 203c 206c 656e 2864 6174 6129 2061 6e64   < len(data) and
-00006750: 2064 6174 615b 2743 616e 646c 6520 5479   data['Candle Ty
-00006760: 7065 275d 5b6a 5d20 3d3d 2027 5261 6c6c  pe'][j] == 'Rall
-00006770: 7920 4361 6e64 6c65 273a 0a20 2020 2023  y Candle':.    #
-00006780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006790: 2020 2020 2069 6620 6461 7461 5b27 436c       if data['Cl
-000067a0: 6f73 6527 5d5b 6a5d 203e 2064 6174 615b  ose'][j] > data[
-000067b0: 2743 6c6f 7365 275d 5b69 5d20 616e 6420  'Close'][i] and 
-000067c0: 6461 7461 5b27 4869 6768 275d 5b69 5d20  data['High'][i] 
-000067d0: 3c3d 2063 6d70 3a20 2023 204e 6577 2063  <= cmp:  # New c
-000067e0: 6f6e 6469 7469 6f6e 3a20 636c 6f73 6520  ondition: close 
-000067f0: 6f66 2032 6e64 2072 616c 6c79 2063 616e  of 2nd rally can
-00006800: 646c 6520 3e20 3173 7420 7261 6c6c 7920  dle > 1st rally 
-00006810: 6361 6e64 6c65 0a20 2020 2023 2020 2020  candle.    #    
-00006820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006830: 2020 2020 2023 2043 6865 636b 2066 6f72       # Check for
-00006840: 206f 6e65 206d 6f72 6520 7261 6c6c 7920   one more rally 
-00006850: 6361 6e64 6c65 206f 7220 6772 6565 6e20  candle or green 
-00006860: 6261 7365 2063 616e 646c 650a 2020 2020  base candle.    
-00006870: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00006880: 2020 2020 2020 2020 2020 6b20 3d20 6a20            k = j 
-00006890: 2b20 310a 2020 2020 2320 2020 2020 2020  + 1.    #       
+000042f0: 6f70 225d 0a20 2020 2020 2020 2065 7863  op"].        exc
+00004300: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00004310: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00004320: 6966 2073 656c 662e 7368 6f75 6c64 4c6f  if self.shouldLo
+00004330: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+00004340: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00004350: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+00004360: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+00004370: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00004380: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00004390: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000043a0: 2020 2020 2020 2064 665b 2242 7579 225d         df["Buy"]
+000043b0: 203d 2028 6466 5b22 436c 6f73 6522 5d20   = (df["Close"] 
+000043c0: 3e20 6466 5b22 4154 5254 7261 696c 696e  > df["ATRTrailin
+000043d0: 6753 746f 7022 5d29 2026 2028 6466 5b22  gStop"]) & (df["
+000043e0: 4162 6f76 6522 5d3d 3d54 7275 6529 0a20  Above"]==True). 
+000043f0: 2020 2020 2020 2020 2020 2064 665b 2253             df["S
+00004400: 656c 6c22 5d20 3d20 2864 665b 2243 6c6f  ell"] = (df["Clo
+00004410: 7365 225d 203c 2064 665b 2241 5452 5472  se"] < df["ATRTr
+00004420: 6169 6c69 6e67 5374 6f70 225d 2920 2620  ailingStop"]) & 
+00004430: 2864 665b 2242 656c 6f77 225d 3d3d 5472  (df["Below"]==Tr
+00004440: 7565 290a 0a20 2020 2020 2020 2072 6574  ue)..        ret
+00004450: 7572 6e20 6466 0a0a 2020 2020 6465 6620  urn df..    def 
+00004460: 6669 6e64 4275 7953 656c 6c53 6967 6e61  findBuySellSigna
+00004470: 6c73 4672 6f6d 4154 5254 7261 696c 696e  lsFromATRTrailin
+00004480: 6728 7365 6c66 2c64 662c 206b 6579 5f76  g(self,df, key_v
+00004490: 616c 7565 3d31 2c20 6174 725f 7065 7269  alue=1, atr_peri
+000044a0: 6f64 3d31 302c 2065 6d61 5f70 6572 696f  od=10, ema_perio
+000044b0: 643d 3230 302c 6275 7953 656c 6c41 6c6c  d=200,buySellAll
+000044c0: 3d31 2c73 6176 6544 6963 743d 4e6f 6e65  =1,saveDict=None
+000044d0: 2c73 6372 6565 6e44 6963 743d 4e6f 6e65  ,screenDict=None
+000044e0: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
+000044f0: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+00004500: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
+00004510: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00004520: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+00004530: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
+00004540: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+00004550: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
+00004560: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
+00004570: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
+00004580: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
+00004590: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+000045a0: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
+000045b0: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
+000045c0: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
+000045d0: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
+000045e0: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
+000045f0: 756c 6174 6520 4154 5220 616e 6420 7841  ulate ATR and xA
+00004600: 5452 5472 6169 6c69 6e67 5374 6f70 0a20  TRTrailingStop. 
+00004610: 2020 2020 2020 2078 4154 5220 3d20 6e70         xATR = np
+00004620: 2e61 7272 6179 2870 6b74 616c 6962 2e41  .array(pktalib.A
+00004630: 5452 2864 6174 615b 2748 6967 6827 5d2c  TR(data['High'],
+00004640: 2064 6174 615b 274c 6f77 275d 2c20 6461   data['Low'], da
+00004650: 7461 5b27 436c 6f73 6527 5d2c 2074 696d  ta['Close'], tim
+00004660: 6570 6572 696f 643d 6174 725f 7065 7269  eperiod=atr_peri
+00004670: 6f64 2929 0a20 2020 2020 2020 206e 4c6f  od)).        nLo
+00004680: 7373 203d 206b 6579 5f76 616c 7565 202a  ss = key_value *
+00004690: 2078 4154 520a 2020 2020 2020 2020 7372   xATR.        sr
+000046a0: 6320 3d20 6461 7461 5b27 436c 6f73 6527  c = data['Close'
+000046b0: 5d0a 2020 2020 2020 2020 2320 496e 6974  ].        # Init
+000046c0: 6961 6c69 7a65 2061 7272 6179 730a 2020  ialize arrays.  
+000046d0: 2020 2020 2020 7841 5452 5472 6169 6c69        xATRTraili
+000046e0: 6e67 5374 6f70 203d 206e 702e 7a65 726f  ngStop = np.zero
+000046f0: 7328 6c65 6e28 6461 7461 2929 0a20 2020  s(len(data)).   
+00004700: 2020 2020 2078 4154 5254 7261 696c 696e       xATRTrailin
+00004710: 6753 746f 705b 305d 203d 2073 7263 5b30  gStop[0] = src[0
+00004720: 5d20 2d20 6e4c 6f73 735b 305d 0a0a 2020  ] - nLoss[0]..  
+00004730: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+00004740: 6520 7841 5452 5472 6169 6c69 6e67 5374  e xATRTrailingSt
+00004750: 6f70 2075 7369 6e67 2076 6563 746f 7269  op using vectori
+00004760: 7a65 6420 6f70 6572 6174 696f 6e73 0a20  zed operations. 
+00004770: 2020 2020 2020 206d 6173 6b5f 3120 3d20         mask_1 = 
+00004780: 2873 7263 203e 206e 702e 726f 6c6c 2878  (src > np.roll(x
+00004790: 4154 5254 7261 696c 696e 6753 746f 702c  ATRTrailingStop,
+000047a0: 2031 2929 2026 2028 6e70 2e72 6f6c 6c28   1)) & (np.roll(
+000047b0: 7372 632c 2031 2920 3e20 6e70 2e72 6f6c  src, 1) > np.rol
+000047c0: 6c28 7841 5452 5472 6169 6c69 6e67 5374  l(xATRTrailingSt
+000047d0: 6f70 2c20 3129 290a 2020 2020 2020 2020  op, 1)).        
+000047e0: 6d61 736b 5f32 203d 2028 7372 6320 3c20  mask_2 = (src < 
+000047f0: 6e70 2e72 6f6c 6c28 7841 5452 5472 6169  np.roll(xATRTrai
+00004800: 6c69 6e67 5374 6f70 2c20 3129 2920 2620  lingStop, 1)) & 
+00004810: 286e 702e 726f 6c6c 2873 7263 2c20 3129  (np.roll(src, 1)
+00004820: 203c 206e 702e 726f 6c6c 2878 4154 5254   < np.roll(xATRT
+00004830: 7261 696c 696e 6753 746f 702c 2031 2929  railingStop, 1))
+00004840: 0a20 2020 2020 2020 206d 6173 6b5f 3320  .        mask_3 
+00004850: 3d20 7372 6320 3e20 6e70 2e72 6f6c 6c28  = src > np.roll(
+00004860: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
+00004870: 2c20 3129 0a0a 2020 2020 2020 2020 7841  , 1)..        xA
+00004880: 5452 5472 6169 6c69 6e67 5374 6f70 203d  TRTrailingStop =
+00004890: 206e 702e 7768 6572 6528 6d61 736b 5f31   np.where(mask_1
+000048a0: 2c20 6e70 2e6d 6178 696d 756d 286e 702e  , np.maximum(np.
+000048b0: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+000048c0: 6753 746f 702c 2031 292c 2073 7263 202d  gStop, 1), src -
+000048d0: 206e 4c6f 7373 292c 2078 4154 5254 7261   nLoss), xATRTra
+000048e0: 696c 696e 6753 746f 7029 0a20 2020 2020  ilingStop).     
+000048f0: 2020 2078 4154 5254 7261 696c 696e 6753     xATRTrailingS
+00004900: 746f 7020 3d20 6e70 2e77 6865 7265 286d  top = np.where(m
+00004910: 6173 6b5f 322c 206e 702e 6d69 6e69 6d75  ask_2, np.minimu
+00004920: 6d28 6e70 2e72 6f6c 6c28 7841 5452 5472  m(np.roll(xATRTr
+00004930: 6169 6c69 6e67 5374 6f70 2c20 3129 2c20  ailingStop, 1), 
+00004940: 7372 6320 2b20 6e4c 6f73 7329 2c20 7841  src + nLoss), xA
+00004950: 5452 5472 6169 6c69 6e67 5374 6f70 290a  TRTrailingStop).
+00004960: 2020 2020 2020 2020 7841 5452 5472 6169          xATRTrai
+00004970: 6c69 6e67 5374 6f70 203d 206e 702e 7768  lingStop = np.wh
+00004980: 6572 6528 6d61 736b 5f33 2c20 7372 6320  ere(mask_3, src 
+00004990: 2d20 6e4c 6f73 732c 2078 4154 5254 7261  - nLoss, xATRTra
+000049a0: 696c 696e 6753 746f 7029 0a0a 2020 2020  ilingStop)..    
+000049b0: 2020 2020 6d61 736b 5f62 7579 203d 2028      mask_buy = (
+000049c0: 6e70 2e72 6f6c 6c28 7372 632c 2031 2920  np.roll(src, 1) 
+000049d0: 3c20 7841 5452 5472 6169 6c69 6e67 5374  < xATRTrailingSt
+000049e0: 6f70 2920 2620 2873 7263 203e 206e 702e  op) & (src > np.
+000049f0: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+00004a00: 6753 746f 702c 2031 2929 0a20 2020 2020  gStop, 1)).     
+00004a10: 2020 206d 6173 6b5f 7365 6c6c 203d 2028     mask_sell = (
+00004a20: 6e70 2e72 6f6c 6c28 7372 632c 2031 2920  np.roll(src, 1) 
+00004a30: 3e20 7841 5452 5472 6169 6c69 6e67 5374  > xATRTrailingSt
+00004a40: 6f70 2920 2620 2873 7263 203c 206e 702e  op) & (src < np.
+00004a50: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+00004a60: 6753 746f 702c 2031 2929 0a0a 2020 2020  gStop, 1))..    
+00004a70: 2020 2020 706f 7320 3d20 6e70 2e7a 6572      pos = np.zer
+00004a80: 6f73 286c 656e 2864 6174 6129 290a 2020  os(len(data)).  
+00004a90: 2020 2020 2020 706f 7320 3d20 6e70 2e77        pos = np.w
+00004aa0: 6865 7265 286d 6173 6b5f 6275 792c 2031  here(mask_buy, 1
+00004ab0: 2c20 706f 7329 0a20 2020 2020 2020 2070  , pos).        p
+00004ac0: 6f73 203d 206e 702e 7768 6572 6528 6d61  os = np.where(ma
+00004ad0: 736b 5f73 656c 6c2c 202d 312c 2070 6f73  sk_sell, -1, pos
+00004ae0: 290a 2020 2020 2020 2020 706f 735b 7e28  ).        pos[~(
+00004af0: 2870 6f73 203d 3d20 3129 207c 2028 706f  (pos == 1) | (po
+00004b00: 7320 3d3d 202d 3129 295d 203d 2030 0a0a  s == -1))] = 0..
+00004b10: 2020 2020 2020 2020 656d 6120 3d20 6e70          ema = np
+00004b20: 2e61 7272 6179 2870 6b74 616c 6962 2e45  .array(pktalib.E
+00004b30: 4d41 2864 6174 615b 2743 6c6f 7365 275d  MA(data['Close']
+00004b40: 2c20 7469 6d65 7065 7269 6f64 3d65 6d61  , timeperiod=ema
+00004b50: 5f70 6572 696f 6429 290a 0a20 2020 2020  _period))..     
+00004b60: 2020 2062 7579 5f63 6f6e 6469 7469 6f6e     buy_condition
+00004b70: 5f75 7462 6f74 203d 2028 7841 5452 5472  _utbot = (xATRTr
+00004b80: 6169 6c69 6e67 5374 6f70 203e 2065 6d61  ailingStop > ema
+00004b90: 2920 2620 2870 6f73 203e 2030 2920 2620  ) & (pos > 0) & 
+00004ba0: 2873 7263 203e 2065 6d61 290a 2020 2020  (src > ema).    
+00004bb0: 2020 2020 7365 6c6c 5f63 6f6e 6469 7469      sell_conditi
+00004bc0: 6f6e 5f75 7462 6f74 203d 2028 7841 5452  on_utbot = (xATR
+00004bd0: 5472 6169 6c69 6e67 5374 6f70 203c 2065  TrailingStop < e
+00004be0: 6d61 2920 2620 2870 6f73 203c 2030 2920  ma) & (pos < 0) 
+00004bf0: 2620 2873 7263 203c 2065 6d61 290a 0a20  & (src < ema).. 
+00004c00: 2020 2020 2020 2023 2054 6865 2072 6573         # The res
+00004c10: 756c 7469 6e67 2074 7265 6e64 2061 7272  ulting trend arr
+00004c20: 6179 2068 6f6c 6473 2076 616c 7565 7320  ay holds values 
+00004c30: 6f66 2031 2028 6275 7929 2c20 2d31 2028  of 1 (buy), -1 (
+00004c40: 7365 6c6c 292c 206f 7220 3020 286e 6575  sell), or 0 (neu
+00004c50: 7472 616c 292e 0a20 2020 2020 2020 2074  tral)..        t
+00004c60: 7265 6e64 203d 206e 702e 7768 6572 6528  rend = np.where(
+00004c70: 6275 795f 636f 6e64 6974 696f 6e5f 7574  buy_condition_ut
+00004c80: 626f 742c 2031 2c20 6e70 2e77 6865 7265  bot, 1, np.where
+00004c90: 2873 656c 6c5f 636f 6e64 6974 696f 6e5f  (sell_condition_
+00004ca0: 7574 626f 742c 202d 312c 2030 2929 0a20  utbot, -1, 0)). 
+00004cb0: 2020 2020 2020 2074 7265 6e64 5f61 7272         trend_arr
+00004cc0: 203d 206e 702e 6172 7261 7928 7472 656e   = np.array(tren
+00004cd0: 6429 0a20 2020 2020 2020 2064 6174 612e  d).        data.
+00004ce0: 696e 7365 7274 286c 656e 2864 6174 612e  insert(len(data.
+00004cf0: 636f 6c75 6d6e 7329 2c20 2274 7265 6e64  columns), "trend
+00004d00: 222c 2074 7265 6e64 5f61 7272 290a 2020  ", trend_arr).  
+00004d10: 2020 2020 2020 7472 656e 6420 3d20 7472        trend = tr
+00004d20: 656e 645b 305d 0a20 2020 2020 2020 2073  end[0].        s
+00004d30: 6176 6544 6963 745b 2242 2f53 225d 203d  aveDict["B/S"] =
+00004d40: 2022 4275 7922 2069 6620 7472 656e 6420   "Buy" if trend 
+00004d50: 3d3d 2031 2065 6c73 6520 2822 5365 6c6c  == 1 else ("Sell
+00004d60: 2220 6966 2074 7265 6e64 203d 3d20 2d31  " if trend == -1
+00004d70: 2065 6c73 6520 224e 4122 290a 2020 2020   else "NA").    
+00004d80: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00004d90: 422f 5322 5d20 3d20 2863 6f6c 6f72 5465  B/S"] = (colorTe
+00004da0: 7874 2e47 5245 454e 202b 2022 4275 7922  xt.GREEN + "Buy"
+00004db0: 2920 6966 2074 7265 6e64 203d 3d20 3120  ) if trend == 1 
+00004dc0: 656c 7365 2028 2863 6f6c 6f72 5465 7874  else ((colorText
+00004dd0: 2e46 4149 4c2b 2022 5365 6c6c 2229 2069  .FAIL+ "Sell") i
+00004de0: 6620 7472 656e 6420 3d3d 202d 3120 656c  f trend == -1 el
+00004df0: 7365 2028 636f 6c6f 7254 6578 742e 5741  se (colorText.WA
+00004e00: 524e 202b 2022 4e41 2229 2920 2b20 636f  RN + "NA")) + co
+00004e10: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00004e20: 2020 2020 7265 7475 726e 2062 7579 5365      return buySe
+00004e30: 6c6c 416c 6c20 3d3d 2074 7265 6e64 0a0a  llAll == trend..
+00004e40: 2020 2020 2320 4578 616d 706c 6520 6f66      # Example of
+00004e50: 2063 6f6d 6269 6e69 6e67 2055 5442 6f74   combining UTBot
+00004e60: 2041 6c65 7274 7320 7769 7468 2052 5349   Alerts with RSI
+00004e70: 2061 6e64 2041 4458 0a20 2020 2064 6566   and ADX.    def
+00004e80: 2063 7573 746f 6d5f 7374 7261 7465 6779   custom_strategy
+00004e90: 2873 656c 662c 6461 7461 6672 616d 6529  (self,dataframe)
+00004ea0: 3a0a 2020 2020 2020 2020 6461 7461 6672  :.        datafr
+00004eb0: 616d 6520 3d20 7365 6c66 2e66 696e 6442  ame = self.findB
+00004ec0: 7579 5365 6c6c 5369 676e 616c 7346 726f  uySellSignalsFro
+00004ed0: 6d41 5452 5472 6169 6c69 6e67 2864 6174  mATRTrailing(dat
+00004ee0: 6166 7261 6d65 2c20 6b65 795f 7661 6c75  aframe, key_valu
+00004ef0: 653d 322c 2061 7472 5f70 6572 696f 643d  e=2, atr_period=
+00004f00: 372c 2065 6d61 5f70 6572 696f 643d 3130  7, ema_period=10
+00004f10: 3029 0a20 2020 2020 2020 200a 2020 2020  0).        .    
+00004f20: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+00004f30: 5253 4920 616e 6420 4144 580a 2020 2020  RSI and ADX.    
+00004f40: 2020 2020 7273 6920 3d20 706b 7461 6c69      rsi = pktali
+00004f50: 622e 5253 4928 6461 7461 6672 616d 655b  b.RSI(dataframe[
+00004f60: 2743 6c6f 7365 275d 290a 2020 2020 2020  'Close']).      
+00004f70: 2020 6164 7820 3d20 706b 7461 6c69 622e    adx = pktalib.
+00004f80: 4144 5828 6461 7461 6672 616d 655b 2748  ADX(dataframe['H
+00004f90: 6967 6827 5d2c 2064 6174 6166 7261 6d65  igh'], dataframe
+00004fa0: 5b27 4c6f 7727 5d2c 2064 6174 6166 7261  ['Low'], datafra
+00004fb0: 6d65 5b27 436c 6f73 6527 5d29 0a20 2020  me['Close']).   
+00004fc0: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
+00004fd0: 4465 6669 6e65 2063 6f6e 6469 7469 6f6e  Define condition
+00004fe0: 7320 6261 7365 6420 6f6e 2055 5442 6f74  s based on UTBot
+00004ff0: 2041 6c65 7274 7320 616e 6420 6164 6469   Alerts and addi
+00005000: 7469 6f6e 616c 2069 6e64 6963 6174 6f72  tional indicator
+00005010: 730a 2020 2020 2020 2020 2320 2e2e 2e20  s.        # ... 
+00005020: 2879 6f75 7220 6375 7374 6f6d 2063 6f6e  (your custom con
+00005030: 6469 7469 6f6e 7320 6865 7265 290a 2020  ditions here).  
+00005040: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00005050: 6574 7572 6e20 6461 7461 6672 616d 650a  eturn dataframe.
+00005060: 2020 2020 0a20 2020 2064 6566 2070 6f70      .    def pop
+00005070: 756c 6174 655f 696e 6469 6361 746f 7273  ulate_indicators
+00005080: 2873 656c 662c 2064 6174 6166 7261 6d65  (self, dataframe
+00005090: 3a20 7064 2e44 6174 6146 7261 6d65 2c20  : pd.DataFrame, 
+000050a0: 6d65 7461 6461 7461 3a20 6469 6374 2920  metadata: dict) 
+000050b0: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
+000050c0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000050d0: 7365 6c66 2e64 703a 0a20 2020 2020 2020  self.dp:.       
+000050e0: 2020 2020 2023 2044 6f6e 2774 2064 6f20       # Don't do 
+000050f0: 616e 7974 6869 6e67 2069 6620 4461 7461  anything if Data
+00005100: 5072 6f76 6964 6572 2069 7320 6e6f 7420  Provider is not 
+00005110: 6176 6169 6c61 626c 652e 0a20 2020 2020  available..     
+00005120: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+00005130: 7461 6672 616d 650a 2020 2020 2020 2020  taframe.        
+00005140: 4c5f 6f70 7469 6d69 7a65 5f74 7265 6e64  L_optimize_trend
+00005150: 5f61 6c65 7274 2020 3d20 7365 6c66 2e66  _alert  = self.f
+00005160: 696e 6442 7579 5365 6c6c 5369 676e 616c  indBuySellSignal
+00005170: 7346 726f 6d41 5452 5472 6169 6c69 6e67  sFromATRTrailing
+00005180: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
+00005190: 7261 6d65 2c20 6b65 795f 7661 6c75 653d  rame, key_value=
+000051a0: 2073 656c 662e 6b65 795f 7661 6c75 655f   self.key_value_
+000051b0: 6c2e 7661 6c75 652c 2061 7472 5f70 6572  l.value, atr_per
+000051c0: 696f 643d 2073 656c 662e 6174 725f 7065  iod= self.atr_pe
+000051d0: 7269 6f64 5f6c 2e76 616c 7565 2c20 656d  riod_l.value, em
+000051e0: 615f 7065 7269 6f64 3d73 656c 662e 656d  a_period=self.em
+000051f0: 615f 7065 7269 6f64 5f6c 2e76 616c 7565  a_period_l.value
+00005200: 290a 2020 2020 2020 2020 2320 4c6f 6e67  ).        # Long
+00005210: 2070 6f73 6974 696f 6e3f 0a20 2020 2020   position?.     
+00005220: 2020 2064 6174 6166 7261 6d65 5b27 7472     dataframe['tr
+00005230: 656e 645f 6c27 5d20 3d20 4c5f 6f70 7469  end_l'] = L_opti
+00005240: 6d69 7a65 5f74 7265 6e64 5f61 6c65 7274  mize_trend_alert
+00005250: 5b27 7472 656e 6427 5d0a 2020 2020 2020  ['trend'].      
+00005260: 2020 535f 6f70 7469 6d69 7a65 5f74 7265    S_optimize_tre
+00005270: 6e64 5f61 6c65 7274 2020 3d20 7365 6c66  nd_alert  = self
+00005280: 2e66 696e 6442 7579 5365 6c6c 5369 676e  .findBuySellSign
+00005290: 616c 7346 726f 6d41 5452 5472 6169 6c69  alsFromATRTraili
+000052a0: 6e67 2864 6174 6166 7261 6d65 3d64 6174  ng(dataframe=dat
+000052b0: 6166 7261 6d65 2c20 6b65 795f 7661 6c75  aframe, key_valu
+000052c0: 653d 2073 656c 662e 6b65 795f 7661 6c75  e= self.key_valu
+000052d0: 655f 732e 7661 6c75 652c 2061 7472 5f70  e_s.value, atr_p
+000052e0: 6572 696f 643d 2073 656c 662e 6174 725f  eriod= self.atr_
+000052f0: 7065 7269 6f64 5f73 2e76 616c 7565 2c20  period_s.value, 
+00005300: 656d 615f 7065 7269 6f64 3d73 656c 662e  ema_period=self.
+00005310: 656d 615f 7065 7269 6f64 5f73 2e76 616c  ema_period_s.val
+00005320: 7565 290a 2020 2020 2020 2020 2320 5368  ue).        # Sh
+00005330: 6f72 7420 706f 7369 7469 6f6e 3f0a 2020  ort position?.  
+00005340: 2020 2020 2020 6461 7461 6672 616d 655b        dataframe[
+00005350: 2774 7265 6e64 5f73 275d 203d 2053 5f6f  'trend_s'] = S_o
+00005360: 7074 696d 697a 655f 7472 656e 645f 616c  ptimize_trend_al
+00005370: 6572 745b 2774 7265 6e64 275d 0a0a 2020  ert['trend']..  
+00005380: 2020 2020 2020 2320 4144 580a 2020 2020        # ADX.    
+00005390: 2020 2020 6461 7461 6672 616d 655b 2761      dataframe['a
+000053a0: 6478 275d 203d 2070 6b74 616c 6962 2e41  dx'] = pktalib.A
+000053b0: 4458 2864 6174 6166 7261 6d65 290a 2020  DX(dataframe).  
+000053c0: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+000053d0: 2052 5349 0a20 2020 2020 2020 2023 2064   RSI.        # d
+000053e0: 6174 6166 7261 6d65 5b27 7273 6927 5d20  ataframe['rsi'] 
+000053f0: 3d20 7461 2e52 5349 2864 6174 6166 7261  = ta.RSI(datafra
+00005400: 6d65 290a 0a20 2020 2020 2020 2023 2045  me)..        # E
+00005410: 4d41 0a20 2020 2020 2020 2064 6174 6166  MA.        dataf
+00005420: 7261 6d65 5b27 656d 615f 6c27 5d20 3d20  rame['ema_l'] = 
+00005430: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+00005440: 6672 616d 655b 2763 6c6f 7365 275d 2c20  frame['close'], 
+00005450: 7469 6d65 7065 7269 6f64 3d73 656c 662e  timeperiod=self.
+00005460: 656d 615f 7065 7269 6f64 5f6c 5f65 7869  ema_period_l_exi
+00005470: 742e 7661 6c75 6529 0a20 2020 2020 2020  t.value).       
+00005480: 2064 6174 6166 7261 6d65 5b27 656d 615f   dataframe['ema_
+00005490: 7327 5d20 3d20 706b 7461 6c69 622e 454d  s'] = pktalib.EM
+000054a0: 4128 6461 7461 6672 616d 655b 2763 6c6f  A(dataframe['clo
+000054b0: 7365 275d 2c20 7469 6d65 7065 7269 6f64  se'], timeperiod
+000054c0: 3d73 656c 662e 656d 615f 7065 7269 6f64  =self.ema_period
+000054d0: 5f73 5f65 7869 742e 7661 6c75 6529 0a0a  _s_exit.value)..
+000054e0: 0a20 2020 2020 2020 2023 2056 6f6c 756d  .        # Volum
+000054f0: 6520 5765 6967 6874 6564 0a20 2020 2020  e Weighted.     
+00005500: 2020 2064 6174 6166 7261 6d65 5b27 766f     dataframe['vo
+00005510: 6c75 6d65 5f6d 6561 6e27 5d20 3d20 6461  lume_mean'] = da
+00005520: 7461 6672 616d 655b 2776 6f6c 756d 6527  taframe['volume'
+00005530: 5d2e 726f 6c6c 696e 6728 7365 6c66 2e76  ].rolling(self.v
+00005540: 6f6c 756d 655f 6368 6563 6b2e 7661 6c75  olume_check.valu
+00005550: 6529 2e6d 6561 6e28 292e 7368 6966 7428  e).mean().shift(
+00005560: 3129 0a20 2020 2020 2020 2064 6174 6166  1).        dataf
+00005570: 7261 6d65 5b27 766f 6c75 6d65 5f6d 6561  rame['volume_mea
+00005580: 6e5f 6578 6974 275d 203d 2064 6174 6166  n_exit'] = dataf
+00005590: 7261 6d65 5b27 766f 6c75 6d65 275d 2e72  rame['volume'].r
+000055a0: 6f6c 6c69 6e67 2873 656c 662e 766f 6c75  olling(self.volu
+000055b0: 6d65 5f63 6865 636b 5f65 7869 742e 7661  me_check_exit.va
+000055c0: 6c75 6529 2e6d 6561 6e28 292e 7368 6966  lue).mean().shif
+000055d0: 7428 3129 0a0a 2020 2020 2020 2020 6461  t(1)..        da
+000055e0: 7461 6672 616d 655b 2776 6f6c 756d 655f  taframe['volume_
+000055f0: 6d65 616e 5f73 275d 203d 2064 6174 6166  mean_s'] = dataf
+00005600: 7261 6d65 5b27 766f 6c75 6d65 275d 2e72  rame['volume'].r
+00005610: 6f6c 6c69 6e67 2873 656c 662e 766f 6c75  olling(self.volu
+00005620: 6d65 5f63 6865 636b 5f73 2e76 616c 7565  me_check_s.value
+00005630: 292e 6d65 616e 2829 2e73 6869 6674 2831  ).mean().shift(1
+00005640: 290a 2020 2020 2020 2020 6461 7461 6672  ).        datafr
+00005650: 616d 655b 2776 6f6c 756d 655f 6d65 616e  ame['volume_mean
+00005660: 5f65 7869 745f 7327 5d20 3d20 6461 7461  _exit_s'] = data
+00005670: 6672 616d 655b 2776 6f6c 756d 6527 5d2e  frame['volume'].
+00005680: 726f 6c6c 696e 6728 7365 6c66 2e76 6f6c  rolling(self.vol
+00005690: 756d 655f 6368 6563 6b5f 6578 6974 5f73  ume_check_exit_s
+000056a0: 2e76 616c 7565 292e 6d65 616e 2829 2e73  .value).mean().s
+000056b0: 6869 6674 2831 290a 2020 2020 2020 2020  hift(1).        
+000056c0: 7265 7475 726e 2064 6174 6166 7261 6d65  return dataframe
+000056d0: 0a20 2020 200a 2020 2020 6465 6620 706f  .    .    def po
+000056e0: 7075 6c61 7465 5f65 6e74 7279 5f74 7265  pulate_entry_tre
+000056f0: 6e64 2873 656c 662c 2064 6174 6166 7261  nd(self, datafra
+00005700: 6d65 3a20 7064 2e44 6174 6146 7261 6d65  me: pd.DataFrame
+00005710: 2c20 6d65 7461 6461 7461 3a20 6469 6374  , metadata: dict
+00005720: 2920 2d3e 2070 642e 4461 7461 4672 616d  ) -> pd.DataFram
+00005730: 653a 0a0a 2020 2020 2020 2020 6461 7461  e:..        data
+00005740: 6672 616d 652e 6c6f 635b 0a20 2020 2020  frame.loc[.     
+00005750: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00005760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005770: 2028 6461 7461 6672 616d 655b 2761 6478   (dataframe['adx
+00005780: 275d 203e 2073 656c 662e 6164 785f 6c6f  '] > self.adx_lo
+00005790: 6e67 5f6d 696e 2e76 616c 7565 2920 2620  ng_min.value) & 
+000057a0: 2320 7472 656e 6420 7374 7265 6e67 7468  # trend strength
+000057b0: 2063 6f6e 6669 726d 6174 696f 6e0a 2020   confirmation.  
+000057c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057d0: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
+000057e0: 5b27 6164 7827 5d20 3c20 7365 6c66 2e61  ['adx'] < self.a
+000057f0: 6478 5f6c 6f6e 675f 6d61 782e 7661 6c75  dx_long_max.valu
+00005800: 6529 2026 2023 2074 7265 6e64 2073 7472  e) & # trend str
+00005810: 656e 6774 6820 636f 6e66 6972 6d61 7469  ength confirmati
+00005820: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00005830: 2020 2020 2020 2020 2020 2028 6461 7461             (data
+00005840: 6672 616d 655b 2774 7265 6e64 5f6c 275d  frame['trend_l']
+00005850: 203e 2030 2920 260a 2020 2020 2020 2020   > 0) &.        
+00005860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005870: 2864 6174 6166 7261 6d65 5b27 766f 6c75  (dataframe['volu
+00005880: 6d65 275d 203e 2064 6174 6166 7261 6d65  me'] > dataframe
+00005890: 5b27 766f 6c75 6d65 5f6d 6561 6e27 5d29  ['volume_mean'])
+000058a0: 2026 0a20 2020 2020 2020 2020 2020 2020   &.             
+000058b0: 2020 2020 2020 2020 2020 2028 6461 7461             (data
+000058c0: 6672 616d 655b 2776 6f6c 756d 6527 5d20  frame['volume'] 
+000058d0: 3e20 3029 0a0a 2020 2020 2020 2020 2020  > 0)..          
+000058e0: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+000058f0: 2027 656e 7465 725f 6c6f 6e67 275d 203d   'enter_long'] =
+00005900: 2031 0a0a 2020 2020 2020 2020 6461 7461   1..        data
+00005910: 6672 616d 652e 6c6f 635b 0a20 2020 2020  frame.loc[.     
+00005920: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005940: 2028 6461 7461 6672 616d 655b 2761 6478   (dataframe['adx
+00005950: 275d 203e 2073 656c 662e 6164 785f 7368  '] > self.adx_sh
+00005960: 6f72 745f 6d69 6e2e 7661 6c75 6529 2026  ort_min.value) &
+00005970: 2023 2074 7265 6e64 2073 7472 656e 6774   # trend strengt
+00005980: 6820 636f 6e66 6972 6d61 7469 6f6e 0a20  h confirmation. 
+00005990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059a0: 2020 2020 2020 2028 6461 7461 6672 616d         (datafram
+000059b0: 655b 2761 6478 275d 203c 2073 656c 662e  e['adx'] < self.
+000059c0: 6164 785f 7368 6f72 745f 6d61 782e 7661  adx_short_max.va
+000059d0: 6c75 6529 2026 2023 2074 7265 6e64 2073  lue) & # trend s
+000059e0: 7472 656e 6774 6820 636f 6e66 6972 6d61  trength confirma
+000059f0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00005a00: 2020 2020 2020 2020 2020 2020 2028 6461               (da
+00005a10: 7461 6672 616d 655b 2774 7265 6e64 5f73  taframe['trend_s
+00005a20: 275d 203c 2030 2920 260a 2020 2020 2020  '] < 0) &.      
+00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a40: 2020 2864 6174 6166 7261 6d65 5b27 766f    (dataframe['vo
+00005a50: 6c75 6d65 275d 203e 2064 6174 6166 7261  lume'] > datafra
+00005a60: 6d65 5b27 766f 6c75 6d65 5f6d 6561 6e5f  me['volume_mean_
+00005a70: 7327 5d29 2023 2076 6f6c 756d 6520 7765  s']) # volume we
+00005a80: 6967 6874 6564 2069 6e64 6963 6174 6f72  ighted indicator
+00005a90: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00005aa0: 2020 2020 2020 2020 2020 2020 2765 6e74              'ent
+00005ab0: 6572 5f73 686f 7274 275d 203d 2031 0a20  er_short'] = 1. 
+00005ac0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00005ad0: 7265 7475 726e 2064 6174 6166 7261 6d65  return dataframe
+00005ae0: 0a20 2020 200a 2020 2020 6465 6620 706f  .    .    def po
+00005af0: 7075 6c61 7465 5f65 7869 745f 7472 656e  pulate_exit_tren
+00005b00: 6428 7365 6c66 2c20 6461 7461 6672 616d  d(self, datafram
+00005b10: 653a 2070 642e 4461 7461 4672 616d 652c  e: pd.DataFrame,
+00005b20: 206d 6574 6164 6174 613a 2064 6963 7429   metadata: dict)
+00005b30: 202d 3e20 7064 2e44 6174 6146 7261 6d65   -> pd.DataFrame
+00005b40: 3a0a 0a20 2020 2020 2020 2063 6f6e 6469  :..        condi
+00005b50: 7469 6f6e 735f 6c6f 6e67 203d 205b 5d0a  tions_long = [].
+00005b60: 2020 2020 2020 2020 636f 6e64 6974 696f          conditio
+00005b70: 6e73 5f73 686f 7274 203d 205b 5d0a 2020  ns_short = [].  
+00005b80: 2020 2020 2020 6461 7461 6672 616d 652e        dataframe.
+00005b90: 6c6f 635b 3a2c 2027 6578 6974 5f74 6167  loc[:, 'exit_tag
+00005ba0: 275d 203d 2027 270a 0a20 2020 2020 2020  '] = ''..       
+00005bb0: 2065 7869 745f 6c6f 6e67 203d 2028 0a20   exit_long = (. 
+00005bc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00005bd0: 2028 6461 7461 6672 616d 655b 2763 6c6f   (dataframe['clo
+00005be0: 7365 275d 203c 2064 6174 6166 7261 6d65  se'] < dataframe
+00005bf0: 5b27 6c6f 7727 5d2e 7368 6966 7428 7365  ['low'].shift(se
+00005c00: 6c66 2e73 656c 6c5f 7368 6966 742e 7661  lf.sell_shift.va
+00005c10: 6c75 6529 2920 260a 2020 2020 2020 2020  lue)) &.        
+00005c20: 2020 2020 2020 2020 2864 6174 6166 7261          (datafra
+00005c30: 6d65 5b27 636c 6f73 6527 5d20 3c20 6461  me['close'] < da
+00005c40: 7461 6672 616d 655b 2765 6d61 5f6c 275d  taframe['ema_l']
+00005c50: 2920 260a 2020 2020 2020 2020 2020 2020  ) &.            
+00005c60: 2020 2020 2864 6174 6166 7261 6d65 5b27      (dataframe['
+00005c70: 766f 6c75 6d65 275d 203e 2064 6174 6166  volume'] > dataf
+00005c80: 7261 6d65 5b27 766f 6c75 6d65 5f6d 6561  rame['volume_mea
+00005c90: 6e5f 6578 6974 275d 290a 2020 2020 2020  n_exit']).      
+00005ca0: 2020 290a 0a20 2020 2020 2020 2065 7869    )..        exi
+00005cb0: 745f 7368 6f72 7420 3d20 280a 2020 2020  t_short = (.    
+00005cc0: 2020 2020 2020 2020 2020 2020 2320 2864              # (d
+00005cd0: 6174 6166 7261 6d65 5b27 636c 6f73 6527  ataframe['close'
+00005ce0: 5d20 3e20 6461 7461 6672 616d 655b 2768  ] > dataframe['h
+00005cf0: 6967 6827 5d2e 7368 6966 7428 7365 6c66  igh'].shift(self
+00005d00: 2e73 656c 6c5f 7368 6966 745f 7368 6f72  .sell_shift_shor
+00005d10: 742e 7661 6c75 6529 2920 260a 2020 2020  t.value)) &.    
+00005d20: 2020 2020 2020 2020 2020 2020 2864 6174              (dat
+00005d30: 6166 7261 6d65 5b27 636c 6f73 6527 5d20  aframe['close'] 
+00005d40: 3e20 6461 7461 6672 616d 655b 2765 6d61  > dataframe['ema
+00005d50: 5f73 275d 2920 260a 2020 2020 2020 2020  _s']) &.        
+00005d60: 2020 2020 2020 2020 2864 6174 6166 7261          (datafra
+00005d70: 6d65 5b27 766f 6c75 6d65 275d 203e 2064  me['volume'] > d
+00005d80: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
+00005d90: 5f6d 6561 6e5f 6578 6974 5f73 275d 290a  _mean_exit_s']).
+00005da0: 2020 2020 2020 2020 290a 0a0a 2020 2020          )...    
+00005db0: 2020 2020 636f 6e64 6974 696f 6e73 5f73      conditions_s
+00005dc0: 686f 7274 2e61 7070 656e 6428 6578 6974  hort.append(exit
+00005dd0: 5f73 686f 7274 290a 2020 2020 2020 2020  _short).        
+00005de0: 6461 7461 6672 616d 652e 6c6f 635b 6578  dataframe.loc[ex
+00005df0: 6974 5f73 686f 7274 2c20 2765 7869 745f  it_short, 'exit_
+00005e00: 7461 6727 5d20 2b3d 2027 6578 6974 5f73  tag'] += 'exit_s
+00005e10: 686f 7274 270a 0a0a 2020 2020 2020 2020  hort'...        
+00005e20: 636f 6e64 6974 696f 6e73 5f6c 6f6e 672e  conditions_long.
+00005e30: 6170 7065 6e64 2865 7869 745f 6c6f 6e67  append(exit_long
+00005e40: 290a 2020 2020 2020 2020 6461 7461 6672  ).        datafr
+00005e50: 616d 652e 6c6f 635b 6578 6974 5f6c 6f6e  ame.loc[exit_lon
+00005e60: 672c 2027 6578 6974 5f74 6167 275d 202b  g, 'exit_tag'] +
+00005e70: 3d20 2765 7869 745f 6c6f 6e67 270a 0a0a  = 'exit_long'...
+00005e80: 2020 2020 2020 2020 6966 2063 6f6e 6469          if condi
+00005e90: 7469 6f6e 735f 6c6f 6e67 3a0a 2020 2020  tions_long:.    
+00005ea0: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+00005eb0: 652e 6c6f 635b 0a20 2020 2020 2020 2020  e.loc[.         
+00005ec0: 2020 2020 2020 2070 642e 7265 6475 6365         pd.reduce
+00005ed0: 286c 616d 6264 6120 782c 2079 3a20 7820  (lambda x, y: x 
+00005ee0: 7c20 792c 2063 6f6e 6469 7469 6f6e 735f  | y, conditions_
+00005ef0: 6c6f 6e67 292c 0a20 2020 2020 2020 2020  long),.         
+00005f00: 2020 2020 2020 2027 6578 6974 5f6c 6f6e         'exit_lon
+00005f10: 6727 5d20 3d20 310a 0a20 2020 2020 2020  g'] = 1..       
+00005f20: 2069 6620 636f 6e64 6974 696f 6e73 5f73   if conditions_s
+00005f30: 686f 7274 3a0a 2020 2020 2020 2020 2020  hort:.          
+00005f40: 2020 6461 7461 6672 616d 652e 6c6f 635b    dataframe.loc[
+00005f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005f60: 2070 642e 7265 6475 6365 286c 616d 6264   pd.reduce(lambd
+00005f70: 6120 782c 2079 3a20 7820 7c20 792c 2063  a x, y: x | y, c
+00005f80: 6f6e 6469 7469 6f6e 735f 7368 6f72 7429  onditions_short)
+00005f90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005fa0: 2020 2765 7869 745f 7368 6f72 7427 5d20    'exit_short'] 
+00005fb0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00005fc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005fd0: 6461 7461 6672 616d 650a 0a20 2020 2023  dataframe..    #
+00005fe0: 2064 6566 2069 6465 6e74 6966 795f 6465   def identify_de
+00005ff0: 6d61 6e64 5f7a 6f6e 6528 7365 6c66 2c64  mand_zone(self,d
+00006000: 6174 612c 2063 6d70 293a 0a20 2020 2023  ata, cmp):.    #
+00006010: 2020 2020 2064 656d 616e 645f 7a6f 6e65       demand_zone
+00006020: 7320 3d20 5b5d 0a20 2020 2023 2020 2020  s = [].    #    
+00006030: 2064 726f 705f 6261 7365 5f72 616c 6c79   drop_base_rally
+00006040: 5f7a 6f6e 6520 3d20 4661 6c73 650a 2020  _zone = False.  
+00006050: 2020 2320 2020 2020 7261 6c6c 795f 6261    #     rally_ba
+00006060: 7365 5f72 616c 6c79 5f7a 6f6e 6520 3d20  se_rally_zone = 
+00006070: 4661 6c73 650a 2020 2020 2020 2020 0a20  False.        . 
+00006080: 2020 2023 2020 2020 2023 2041 6464 6974     #     # Addit
+00006090: 696f 6e61 6c20 7661 7269 6162 6c65 7320  ional variables 
+000060a0: 746f 2074 7261 636b 2062 6173 6520 6361  to track base ca
+000060b0: 6e64 6c65 2070 7269 6365 7320 666f 7220  ndle prices for 
+000060c0: 7072 6f78 696d 616c 206c 696e 6520 6361  proximal line ca
+000060d0: 6c63 756c 6174 696f 6e0a 2020 2020 2320  lculation.    # 
+000060e0: 2020 2020 6261 7365 5f63 616e 646c 655f      base_candle_
+000060f0: 7072 6963 6573 203d 205b 5d0a 2020 2020  prices = [].    
+00006100: 2020 2020 0a20 2020 2023 2020 2020 2066      .    #     f
+00006110: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+00006120: 6e28 6461 7461 2920 2d20 3229 3a0a 2020  n(data) - 2):.  
+00006130: 2020 2320 2020 2020 2020 2020 6966 2064    #         if d
+00006140: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+00006150: 275d 5b69 5d20 3d3d 2027 4472 6f70 2043  '][i] == 'Drop C
+00006160: 616e 646c 6527 2061 6e64 2064 6174 615b  andle' and data[
+00006170: 2743 616e 646c 6520 5479 7065 275d 5b69  'Candle Type'][i
+00006180: 202b 2031 5d20 3d3d 2027 4261 7365 2043   + 1] == 'Base C
+00006190: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+000061a0: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
+000061b0: 6f75 6e74 203d 2031 0a20 2020 2023 2020  ount = 1.    #  
+000061c0: 2020 2020 2020 2020 2020 206a 203d 2069             j = i
+000061d0: 202b 2032 0a20 2020 2023 2020 2020 2020   + 2.    #      
+000061e0: 2020 2020 2020 2077 6869 6c65 206a 203c         while j <
+000061f0: 206c 656e 2864 6174 6129 2061 6e64 2064   len(data) and d
+00006200: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+00006210: 275d 5b6a 5d20 3d3d 2027 4261 7365 2043  '][j] == 'Base C
+00006220: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+00006230: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+00006240: 7365 5f63 6f75 6e74 202b 3d20 310a 2020  se_count += 1.  
+00006250: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006260: 2020 2020 6a20 2b3d 2031 0a20 2020 2020      j += 1.     
+00006270: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00006280: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+00006290: 2062 6173 655f 636f 756e 7420 3c3d 2034   base_count <= 4
+000062a0: 3a20 2023 204d 6178 696d 756d 206f 6620  :  # Maximum of 
+000062b0: 3420 6261 7365 2063 616e 646c 6573 2066  4 base candles f
+000062c0: 6f72 2077 6565 6b6c 7920 6f72 206d 6f6e  or weekly or mon
+000062d0: 7468 6c79 2074 696d 6566 7261 6d65 2c20  thly timeframe, 
+000062e0: 656c 7365 2033 2066 6f72 2064 6169 6c79  else 3 for daily
+000062f0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006300: 2020 2020 2020 2069 6620 6a20 3c20 6c65         if j < le
+00006310: 6e28 6461 7461 2920 616e 6420 6461 7461  n(data) and data
+00006320: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
+00006330: 6a5d 203d 3d20 2752 616c 6c79 2043 616e  j] == 'Rally Can
+00006340: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
+00006350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006360: 6966 2064 6174 615b 2743 6c6f 7365 275d  if data['Close']
+00006370: 5b6a 5d20 3e20 6461 7461 5b27 4c6f 7727  [j] > data['Low'
+00006380: 5d5b 695d 202b 2030 2e36 202a 2064 6174  ][i] + 0.6 * dat
+00006390: 615b 2743 616e 646c 6520 5261 6e67 6527  a['Candle Range'
+000063a0: 5d5b 695d 2061 6e64 2064 6174 615b 2748  ][i] and data['H
+000063b0: 6967 6827 5d5b 695d 203c 3d20 636d 703a  igh'][i] <= cmp:
+000063c0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000063e0: 2043 6865 636b 2066 6f72 206f 6e65 206d   Check for one m
+000063f0: 6f72 6520 7261 6c6c 7920 6361 6e64 6c65  ore rally candle
+00006400: 206f 7220 6772 6565 6e20 6261 7365 2063   or green base c
+00006410: 616e 646c 650a 2020 2020 2320 2020 2020  andle.    #     
+00006420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006430: 2020 2020 6b20 3d20 6a20 2b20 310a 2020      k = j + 1.  
+00006440: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006450: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00006460: 6520 6b20 3c20 6c65 6e28 6461 7461 293a  e k < len(data):
+00006470: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006490: 2020 2069 6620 6461 7461 5b27 4361 6e64     if data['Cand
+000064a0: 6c65 2054 7970 6527 5d5b 6b5d 203d 3d20  le Type'][k] == 
+000064b0: 2752 616c 6c79 2043 616e 646c 6527 206f  'Rally Candle' o
+000064c0: 7220 2864 6174 615b 2743 616e 646c 6520  r (data['Candle 
+000064d0: 5479 7065 275d 5b6b 5d20 3d3d 2027 4261  Type'][k] == 'Ba
+000064e0: 7365 2043 616e 646c 6527 2061 6e64 2064  se Candle' and d
+000064f0: 6174 615b 2743 6c6f 7365 275d 5b6b 5d20  ata['Close'][k] 
+00006500: 3e20 6461 7461 5b27 4f70 656e 275d 5b6b  > data['Open'][k
+00006510: 5d29 3a0a 2020 2020 2320 2020 2020 2020  ]):.    #       
+00006520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006530: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
+00006540: 5f7a 6f6e 6573 2e61 7070 656e 6428 2869  _zones.append((i
+00006550: 2c20 6a2c 2027 4472 6f70 2042 6173 6520  , j, 'Drop Base 
+00006560: 5261 6c6c 7927 2c20 6261 7365 5f63 6f75  Rally', base_cou
+00006570: 6e74 2929 0a20 2020 2023 2020 2020 2020  nt)).    #      
+00006580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006590: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
+000065a0: 6261 7365 5f72 616c 6c79 5f7a 6f6e 6520  base_rally_zone 
+000065b0: 3d20 5472 7565 0a20 2020 2023 2020 2020  = True.    #    
+000065c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065d0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000065e0: 616b 0a20 2020 2023 2020 2020 2020 2020  ak.    #        
+000065f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006600: 2020 2020 206b 202b 3d20 310a 2020 2020       k += 1.    
+00006610: 2320 2020 2020 2020 2020 656c 6966 2064  #         elif d
+00006620: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+00006630: 275d 5b69 5d20 3d3d 2027 5261 6c6c 7920  '][i] == 'Rally 
+00006640: 4361 6e64 6c65 2720 616e 6420 6461 7461  Candle' and data
+00006650: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
+00006660: 6920 2b20 315d 203d 3d20 2742 6173 6520  i + 1] == 'Base 
+00006670: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
+00006680: 2020 2020 2020 2020 2020 2062 6173 655f             base_
+00006690: 636f 756e 7420 3d20 310a 2020 2020 2320  count = 1.    # 
+000066a0: 2020 2020 2020 2020 2020 2020 6a20 3d20              j = 
+000066b0: 6920 2b20 320a 2020 2020 2320 2020 2020  i + 2.    #     
+000066c0: 2020 2020 2020 2020 7768 696c 6520 6a20          while j 
+000066d0: 3c20 6c65 6e28 6461 7461 2920 616e 6420  < len(data) and 
+000066e0: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+000066f0: 6527 5d5b 6a5d 203d 3d20 2742 6173 6520  e'][j] == 'Base 
+00006700: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
+00006710: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00006720: 6173 655f 636f 756e 7420 2b3d 2031 0a20  ase_count += 1. 
+00006730: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00006740: 2020 2020 206a 202b 3d20 310a 2020 2020       j += 1.    
+00006750: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00006760: 2023 2020 2020 2020 2020 2020 2020 2069   #             i
+00006770: 6620 6261 7365 5f63 6f75 6e74 203e 3d20  f base_count >= 
+00006780: 313a 2020 2320 4174 206c 6561 7374 206f  1:  # At least o
+00006790: 6e65 2062 6173 6520 6361 6e64 6c65 2072  ne base candle r
+000067a0: 6571 7569 7265 640a 2020 2020 2320 2020  equired.    #   
+000067b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000067c0: 206a 203c 206c 656e 2864 6174 6129 2061   j < len(data) a
+000067d0: 6e64 2064 6174 615b 2743 616e 646c 6520  nd data['Candle 
+000067e0: 5479 7065 275d 5b6a 5d20 3d3d 2027 5261  Type'][j] == 'Ra
+000067f0: 6c6c 7920 4361 6e64 6c65 273a 0a20 2020  lly Candle':.   
+00006800: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00006810: 2020 2020 2020 2069 6620 6461 7461 5b27         if data['
+00006820: 436c 6f73 6527 5d5b 6a5d 203e 2064 6174  Close'][j] > dat
+00006830: 615b 2743 6c6f 7365 275d 5b69 5d20 616e  a['Close'][i] an
+00006840: 6420 6461 7461 5b27 4869 6768 275d 5b69  d data['High'][i
+00006850: 5d20 3c3d 2063 6d70 3a20 2023 204e 6577  ] <= cmp:  # New
+00006860: 2063 6f6e 6469 7469 6f6e 3a20 636c 6f73   condition: clos
+00006870: 6520 6f66 2032 6e64 2072 616c 6c79 2063  e of 2nd rally c
+00006880: 616e 646c 6520 3e20 3173 7420 7261 6c6c  andle > 1st rall
+00006890: 7920 6361 6e64 6c65 0a20 2020 2023 2020  y candle.    #  
 000068a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068b0: 2020 7768 696c 6520 6b20 3c20 6c65 6e28    while k < len(
-000068c0: 6461 7461 293a 0a20 2020 2023 2020 2020  data):.    #    
-000068d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000068e0: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-000068f0: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-00006900: 6b5d 203d 3d20 2752 616c 6c79 2043 616e  k] == 'Rally Can
-00006910: 646c 6527 206f 7220 2864 6174 615b 2743  dle' or (data['C
-00006920: 616e 646c 6520 5479 7065 275d 5b6b 5d20  andle Type'][k] 
-00006930: 3d3d 2027 4261 7365 2043 616e 646c 6527  == 'Base Candle'
-00006940: 2061 6e64 2064 6174 615b 2743 6c6f 7365   and data['Close
-00006950: 275d 5b6b 5d20 3e20 6461 7461 5b27 4f70  '][k] > data['Op
-00006960: 656e 275d 5b6b 5d29 3a0a 2020 2020 2320  en'][k]):.    # 
-00006970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006990: 6465 6d61 6e64 5f7a 6f6e 6573 2e61 7070  demand_zones.app
-000069a0: 656e 6428 2869 2c20 6a2c 2027 5261 6c6c  end((i, j, 'Rall
-000069b0: 7920 4261 7365 2052 616c 6c79 272c 2062  y Base Rally', b
-000069c0: 6173 655f 636f 756e 7429 290a 2020 2020  ase_count)).    
-000069d0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000069e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000069f0: 2020 7261 6c6c 795f 6261 7365 5f72 616c    rally_base_ral
-00006a00: 6c79 5f7a 6f6e 6520 3d20 5472 7565 0a20  ly_zone = True. 
-00006a10: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00006a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a30: 2020 2020 2062 7265 616b 0a20 2020 2023       break.    #
-00006a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a50: 2020 2020 2020 2020 2020 2020 206b 202b               k +
-00006a60: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00006a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a80: 0a20 2020 2023 2020 2020 2020 2020 2023  .    #         #
-00006a90: 2043 6f6c 6c65 6374 2062 6173 6520 6361   Collect base ca
-00006aa0: 6e64 6c65 2070 7269 6365 7320 666f 7220  ndle prices for 
-00006ab0: 7072 6f78 696d 616c 206c 696e 6520 6361  proximal line ca
-00006ac0: 6c63 756c 6174 696f 6e0a 2020 2020 2320  lculation.    # 
-00006ad0: 2020 2020 2020 2020 6966 2064 6174 615b          if data[
-00006ae0: 2743 616e 646c 6520 5479 7065 275d 5b69  'Candle Type'][i
-00006af0: 5d20 3d3d 2027 4261 7365 2043 616e 646c  ] == 'Base Candl
-00006b00: 6527 3a0a 2020 2020 2320 2020 2020 2020  e':.    #       
-00006b10: 2020 2020 2020 6261 7365 5f63 616e 646c        base_candl
-00006b20: 655f 7072 6963 6573 2e61 7070 656e 6428  e_prices.append(
-00006b30: 6461 7461 5b27 436c 6f73 6527 5d5b 695d  data['Close'][i]
-00006b40: 290a 0a20 2020 2023 2020 2020 2023 2043  )..    #     # C
-00006b50: 616c 6375 6c61 7465 2070 726f 7869 6d61  alculate proxima
-00006b60: 6c20 6c69 6e65 2070 7269 6365 2028 6869  l line price (hi
-00006b70: 6768 6573 7420 7072 6963 6520 616d 6f6e  ghest price amon
-00006b80: 6720 6261 7365 2063 616e 646c 6573 290a  g base candles).
-00006b90: 2020 2020 2320 2020 2020 7072 6f78 696d      #     proxim
-00006ba0: 616c 5f6c 696e 655f 7072 6963 6520 3d20  al_line_price = 
-00006bb0: 6d61 7828 6261 7365 5f63 616e 646c 655f  max(base_candle_
-00006bc0: 7072 6963 6573 2920 6966 2062 6173 655f  prices) if base_
-00006bd0: 6361 6e64 6c65 5f70 7269 6365 7320 656c  candle_prices el
-00006be0: 7365 204e 6f6e 650a 0a20 2020 2023 2020  se None..    #  
-00006bf0: 2020 2072 6574 7572 6e20 6465 6d61 6e64     return demand
-00006c00: 5f7a 6f6e 6573 2c20 6472 6f70 5f62 6173  _zones, drop_bas
-00006c10: 655f 7261 6c6c 795f 7a6f 6e65 2c20 7261  e_rally_zone, ra
-00006c20: 6c6c 795f 6261 7365 5f72 616c 6c79 5f7a  lly_base_rally_z
-00006c30: 6f6e 652c 2070 726f 7869 6d61 6c5f 6c69  one, proximal_li
-00006c40: 6e65 5f70 7269 6365 0a0a 2020 2020 2320  ne_price..    # 
-00006c50: 6465 6620 6964 656e 7469 6679 5f73 7570  def identify_sup
-00006c60: 706c 795f 7a6f 6e65 2873 656c 662c 6461  ply_zone(self,da
-00006c70: 7461 2c20 636d 7029 3a0a 2020 2020 2320  ta, cmp):.    # 
-00006c80: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
-00006c90: 203d 205b 5d0a 2020 2020 2320 2020 2020   = [].    #     
-00006ca0: 7261 6c6c 795f 6261 7365 5f64 726f 705f  rally_base_drop_
-00006cb0: 7a6f 6e65 203d 2046 616c 7365 0a20 2020  zone = False.   
-00006cc0: 2023 2020 2020 2064 726f 705f 6261 7365   #     drop_base
-00006cd0: 5f64 726f 705f 7a6f 6e65 203d 2046 616c  _drop_zone = Fal
-00006ce0: 7365 0a20 2020 2020 2020 200a 2020 2020  se.        .    
-00006cf0: 2320 2020 2020 2320 4164 6469 7469 6f6e  #     # Addition
-00006d00: 616c 2076 6172 6961 626c 6573 2074 6f20  al variables to 
-00006d10: 7472 6163 6b20 6261 7365 2063 616e 646c  track base candl
-00006d20: 6520 7072 6963 6573 2066 6f72 2070 726f  e prices for pro
-00006d30: 7869 6d61 6c20 6c69 6e65 2063 616c 6375  ximal line calcu
-00006d40: 6c61 7469 6f6e 0a20 2020 2023 2020 2020  lation.    #    
-00006d50: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
-00006d60: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
-00006d70: 200a 2020 2020 2320 2020 2020 666f 7220   .    #     for 
-00006d80: 6920 696e 2072 616e 6765 286c 656e 2864  i in range(len(d
-00006d90: 6174 6129 202d 2032 293a 0a20 2020 2023  ata) - 2):.    #
-00006da0: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-00006db0: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-00006dc0: 695d 203d 3d20 2744 726f 7020 4361 6e64  i] == 'Drop Cand
-00006dd0: 6c65 2720 616e 6420 6461 7461 5b27 4361  le' and data['Ca
-00006de0: 6e64 6c65 2054 7970 6527 5d5b 6920 2b20  ndle Type'][i + 
-00006df0: 315d 203d 3d20 2742 6173 6520 4361 6e64  1] == 'Base Cand
-00006e00: 6c65 273a 0a20 2020 2023 2020 2020 2020  le':.    #      
-00006e10: 2020 2020 2020 2062 6173 655f 636f 756e         base_coun
-00006e20: 7420 3d20 310a 2020 2020 2320 2020 2020  t = 1.    #     
-00006e30: 2020 2020 2020 2020 6a20 3d20 6920 2b20          j = i + 
-00006e40: 320a 2020 2020 2320 2020 2020 2020 2020  2.    #         
-00006e50: 2020 2020 7768 696c 6520 6a20 3c20 6c65      while j < le
-00006e60: 6e28 6461 7461 2920 616e 6420 6461 7461  n(data) and data
-00006e70: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-00006e80: 6a5d 203d 3d20 2742 6173 6520 4361 6e64  j] == 'Base Cand
-00006e90: 6c65 273a 0a20 2020 2023 2020 2020 2020  le':.    #      
-00006ea0: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-00006eb0: 636f 756e 7420 2b3d 2031 0a20 2020 2023  count += 1.    #
-00006ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ed0: 206a 202b 3d20 310a 2020 2020 2020 2020   j += 1.        
-00006ee0: 2020 2020 2020 2020 0a20 2020 2023 2020          .    #  
-00006ef0: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
-00006f00: 7365 5f63 6f75 6e74 203c 3d20 343a 2020  se_count <= 4:  
-00006f10: 2320 4d61 7869 6d75 6d20 6f66 2034 2062  # Maximum of 4 b
-00006f20: 6173 6520 6361 6e64 6c65 7320 666f 7220  ase candles for 
-00006f30: 7765 656b 6c79 206f 7220 6d6f 6e74 686c  weekly or monthl
-00006f40: 7920 7469 6d65 6672 616d 652c 2065 6c73  y timeframe, els
-00006f50: 6520 3320 666f 7220 6461 696c 790a 2020  e 3 for daily.  
-00006f60: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00006f70: 2020 2020 6966 206a 203c 206c 656e 2864      if j < len(d
-00006f80: 6174 6129 2061 6e64 2064 6174 615b 2743  ata) and data['C
-00006f90: 616e 646c 6520 5479 7065 275d 5b6a 5d20  andle Type'][j] 
-00006fa0: 3d3d 2027 4472 6f70 2043 616e 646c 6527  == 'Drop Candle'
-00006fb0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00006fc0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00006fd0: 6174 615b 2743 6c6f 7365 275d 5b69 5d20  ata['Close'][i] 
-00006fe0: 3c20 6461 7461 5b27 4c6f 7727 5d5b 6a5d  < data['Low'][j]
-00006ff0: 2061 6e64 2064 6174 615b 274c 6f77 275d   and data['Low']
-00007000: 5b69 5d20 3e3d 2063 6d70 3a20 2023 204e  [i] >= cmp:  # N
-00007010: 6577 2063 6f6e 6469 7469 6f6e 3a20 636c  ew condition: cl
-00007020: 6f73 6520 6f66 2064 726f 7020 6361 6e64  ose of drop cand
-00007030: 6c65 203c 206c 6f77 206f 6620 6261 7365  le < low of base
-00007040: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
-00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007060: 2020 2020 2020 2320 4e65 7720 6c6f 6769        # New logi
-00007070: 633a 204c 6f6f 6b20 666f 7220 6f6e 6520  c: Look for one 
-00007080: 6d6f 7265 2064 726f 7020 6361 6e64 6c65  more drop candle
-00007090: 206f 7220 7265 6420 6261 7365 2063 616e   or red base can
-000070a0: 646c 650a 2020 2020 2320 2020 2020 2020  dle.    #       
-000070b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070c0: 2020 6b20 3d20 6a20 2b20 310a 2020 2020    k = j + 1.    
-000070d0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000070e0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-000070f0: 6b20 3c20 6c65 6e28 6461 7461 2920 616e  k < len(data) an
-00007100: 6420 2864 6174 615b 2743 616e 646c 6520  d (data['Candle 
-00007110: 5479 7065 275d 5b6b 5d20 3d3d 2027 4472  Type'][k] == 'Dr
-00007120: 6f70 2043 616e 646c 6527 206f 7220 6461  op Candle' or da
-00007130: 7461 5b27 436c 6f73 6527 5d5b 6b5d 203c  ta['Close'][k] <
-00007140: 2064 6174 615b 274f 7065 6e27 5d5b 6b5d   data['Open'][k]
-00007150: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
-00007160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007170: 2020 2020 206b 202b 3d20 310a 2020 2020       k += 1.    
-00007180: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00007190: 2020 2020 2020 2020 2020 6966 206b 203c            if k <
-000071a0: 206c 656e 2864 6174 6129 2061 6e64 2028   len(data) and (
-000071b0: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-000071c0: 6527 5d5b 6b5d 203d 3d20 2744 726f 7020  e'][k] == 'Drop 
-000071d0: 4361 6e64 6c65 2720 6f72 2064 6174 615b  Candle' or data[
-000071e0: 2743 6c6f 7365 275d 5b6b 5d20 3c20 6461  'Close'][k] < da
-000071f0: 7461 5b27 4f70 656e 275d 5b6b 5d29 3a0a  ta['Open'][k]):.
-00007200: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 2020 7375 7070 6c79 5f7a 6f6e 6573 2e61    supply_zones.a
-00007230: 7070 656e 6428 2869 2c20 6a2c 2027 4472  ppend((i, j, 'Dr
-00007240: 6f70 2042 6173 6520 4472 6f70 272c 2062  op Base Drop', b
-00007250: 6173 655f 636f 756e 7429 290a 2020 2020  ase_count)).    
-00007260: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00007270: 2020 2020 2020 2020 2020 2020 2020 6472                dr
-00007280: 6f70 5f62 6173 655f 6472 6f70 5f7a 6f6e  op_base_drop_zon
-00007290: 6520 3d20 5472 7565 0a20 2020 2023 2020  e = True.    #  
-000072a0: 2020 2020 2020 2065 6c69 6620 6461 7461         elif data
-000072b0: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
-000072c0: 695d 203d 3d20 2752 616c 6c79 2043 616e  i] == 'Rally Can
-000072d0: 646c 6527 2061 6e64 2064 6174 615b 2743  dle' and data['C
-000072e0: 616e 646c 6520 5479 7065 275d 5b69 202b  andle Type'][i +
-000072f0: 2031 5d20 3d3d 2027 4261 7365 2043 616e   1] == 'Base Can
-00007300: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-00007310: 2020 2020 2020 2020 6261 7365 5f63 6f75          base_cou
-00007320: 6e74 203d 2031 0a20 2020 2023 2020 2020  nt = 1.    #    
-00007330: 2020 2020 2020 2020 206a 203d 2069 202b           j = i +
-00007340: 2032 0a20 2020 2023 2020 2020 2020 2020   2.    #        
-00007350: 2020 2020 2077 6869 6c65 206a 203c 206c       while j < l
-00007360: 656e 2864 6174 6129 2061 6e64 2064 6174  en(data) and dat
-00007370: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
-00007380: 5b6a 5d20 3d3d 2027 4261 7365 2043 616e  [j] == 'Base Can
-00007390: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
-000073a0: 2020 2020 2020 2020 2020 2020 6261 7365              base
-000073b0: 5f63 6f75 6e74 202b 3d20 310a 2020 2020  _count += 1.    
-000073c0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000073d0: 2020 6a20 2b3d 2031 0a20 2020 2020 2020    j += 1.       
-000073e0: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-000073f0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-00007400: 6173 655f 636f 756e 7420 3e3d 2031 3a20  ase_count >= 1: 
-00007410: 2023 2041 7420 6c65 6173 7420 6f6e 6520   # At least one 
-00007420: 6261 7365 2063 616e 646c 6520 7265 7175  base candle requ
-00007430: 6972 6564 0a20 2020 2023 2020 2020 2020  ired.    #      
-00007440: 2020 2020 2020 2020 2020 2069 6620 6a20             if j 
-00007450: 3c20 6c65 6e28 6461 7461 2920 616e 6420  < len(data) and 
-00007460: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-00007470: 6527 5d5b 6a5d 203d 3d20 2744 726f 7020  e'][j] == 'Drop 
-00007480: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
-00007490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074a0: 2020 2069 6620 6461 7461 5b27 436c 6f73     if data['Clos
-000074b0: 6527 5d5b 6a5d 203c 2064 6174 615b 274f  e'][j] < data['O
-000074c0: 7065 6e27 5d5b 6a5d 2061 6e64 2064 6174  pen'][j] and dat
-000074d0: 615b 274c 6f77 275d 5b69 5d20 3e3d 2063  a['Low'][i] >= c
-000074e0: 6d70 3a20 2023 204d 6f64 6966 6965 6420  mp:  # Modified 
-000074f0: 636f 6e64 6974 696f 6e3a 2063 6c6f 7365  condition: close
-00007500: 206f 6620 6472 6f70 2063 616e 646c 6520   of drop candle 
-00007510: 3c20 6f70 656e 206f 6620 6472 6f70 2063  < open of drop c
-00007520: 616e 646c 650a 2020 2020 2320 2020 2020  andle.    #     
-00007530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007540: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
-00007550: 2e61 7070 656e 6428 2869 2c20 6a2c 2027  .append((i, j, '
-00007560: 5261 6c6c 7920 4261 7365 2044 726f 7027  Rally Base Drop'
-00007570: 2c20 6261 7365 5f63 6f75 6e74 2929 0a20  , base_count)). 
-00007580: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00007590: 2020 2020 2020 2020 2020 2020 2072 616c               ral
-000075a0: 6c79 5f62 6173 655f 6472 6f70 5f7a 6f6e  ly_base_drop_zon
-000075b0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075d0: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-000075e0: 2020 2020 2320 436f 6c6c 6563 7420 6261      # Collect ba
-000075f0: 7365 2063 616e 646c 6520 7072 6963 6573  se candle prices
-00007600: 2066 6f72 2070 726f 7869 6d61 6c20 6c69   for proximal li
-00007610: 6e65 2063 616c 6375 6c61 7469 6f6e 0a20  ne calculation. 
-00007620: 2020 2023 2020 2020 2020 2020 2069 6620     #         if 
-00007630: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-00007640: 6527 5d5b 695d 203d 3d20 2742 6173 6520  e'][i] == 'Base 
-00007650: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
-00007660: 2020 2020 2020 2020 2020 2062 6173 655f             base_
-00007670: 6361 6e64 6c65 5f70 7269 6365 732e 6170  candle_prices.ap
-00007680: 7065 6e64 2864 6174 615b 2743 6c6f 7365  pend(data['Close
-00007690: 275d 5b69 5d29 0a0a 2020 2020 2320 2020  '][i])..    #   
-000076a0: 2020 2320 4361 6c63 756c 6174 6520 7072    # Calculate pr
-000076b0: 6f78 696d 616c 206c 696e 6520 7072 6963  oximal line pric
-000076c0: 6520 286c 6f77 6573 7420 7072 6963 6520  e (lowest price 
-000076d0: 616d 6f6e 6720 6261 7365 2063 616e 646c  among base candl
-000076e0: 6573 290a 2020 2020 2320 2020 2020 7072  es).    #     pr
-000076f0: 6f78 696d 616c 5f6c 696e 655f 7072 6963  oximal_line_pric
-00007700: 6520 3d20 6d69 6e28 6261 7365 5f63 616e  e = min(base_can
-00007710: 646c 655f 7072 6963 6573 2920 6966 2062  dle_prices) if b
-00007720: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
-00007730: 7320 656c 7365 204e 6f6e 650a 0a20 2020  s else None..   
-00007740: 2023 2020 2020 2072 6574 7572 6e20 7375   #     return su
-00007750: 7070 6c79 5f7a 6f6e 6573 2c20 7261 6c6c  pply_zones, rall
-00007760: 795f 6261 7365 5f64 726f 705f 7a6f 6e65  y_base_drop_zone
-00007770: 2c20 6472 6f70 5f62 6173 655f 6472 6f70  , drop_base_drop
-00007780: 5f7a 6f6e 652c 2070 726f 7869 6d61 6c5f  _zone, proximal_
-00007790: 6c69 6e65 5f70 7269 6365 0a0a 2020 2020  line_price..    
-000077a0: 2320 6465 6620 6361 6c63 756c 6174 655f  # def calculate_
-000077b0: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
-000077c0: 6c69 6e65 7328 7365 6c66 2c64 6174 612c  lines(self,data,
-000077d0: 2064 656d 616e 645f 7a6f 6e65 7329 3a0a   demand_zones):.
-000077e0: 2020 2020 2320 2020 2020 7072 6f78 696d      #     proxim
-000077f0: 616c 5f6c 696e 655f 7072 6963 6573 203d  al_line_prices =
-00007800: 205b 5d0a 2020 2020 2320 2020 2020 666f   [].    #     fo
-00007810: 7220 7374 6172 742c 2065 6e64 2c20 5f2c  r start, end, _,
-00007820: 205f 2069 6e20 6465 6d61 6e64 5f7a 6f6e   _ in demand_zon
-00007830: 6573 3a0a 2020 2020 2320 2020 2020 2020  es:.    #       
-00007840: 2020 6261 7365 5f63 616e 646c 655f 7072    base_candle_pr
-00007850: 6963 6573 203d 2064 6174 612e 6c6f 635b  ices = data.loc[
-00007860: 2864 6174 615b 2743 616e 646c 6520 5479  (data['Candle Ty
-00007870: 7065 275d 203d 3d20 2742 6173 6520 4361  pe'] == 'Base Ca
-00007880: 6e64 6c65 2729 2026 2028 6461 7461 2e69  ndle') & (data.i
-00007890: 6e64 6578 203e 3d20 6461 7461 2e69 6e64  ndex >= data.ind
-000078a0: 6578 5b73 7461 7274 5d29 2026 2028 6461  ex[start]) & (da
-000078b0: 7461 2e69 6e64 6578 203c 3d20 6461 7461  ta.index <= data
-000078c0: 2e69 6e64 6578 5b65 6e64 5d29 2c20 5b27  .index[end]), ['
-000078d0: 4f70 656e 272c 2027 436c 6f73 6527 5d5d  Open', 'Close']]
-000078e0: 0a20 2020 2023 2020 2020 2020 2020 206d  .    #         m
-000078f0: 6178 5f70 7269 6365 203d 2062 6173 655f  ax_price = base_
-00007900: 6361 6e64 6c65 5f70 7269 6365 732e 6d61  candle_prices.ma
-00007910: 7828 6178 6973 3d31 292e 6d61 7828 2920  x(axis=1).max() 
-00007920: 2023 2047 6574 2074 6865 206d 6178 696d   # Get the maxim
-00007930: 756d 2070 7269 6365 2061 6d6f 6e67 2061  um price among a
-00007940: 6c6c 2062 6173 6520 6361 6e64 6c65 7327  ll base candles'
-00007950: 206f 7065 6e20 616e 6420 636c 6f73 6520   open and close 
-00007960: 7072 6963 6573 0a20 2020 2023 2020 2020  prices.    #    
-00007970: 2020 2020 2070 726f 7869 6d61 6c5f 6c69       proximal_li
-00007980: 6e65 5f70 7269 6365 732e 6170 7065 6e64  ne_prices.append
-00007990: 286d 6178 5f70 7269 6365 290a 2020 2020  (max_price).    
-000079a0: 2320 2020 2020 7265 7475 726e 2070 726f  #     return pro
-000079b0: 7869 6d61 6c5f 6c69 6e65 5f70 7269 6365  ximal_line_price
-000079c0: 730a 0a20 2020 2023 2064 6566 2063 616c  s..    # def cal
-000079d0: 6375 6c61 7465 5f73 7570 706c 795f 7072  culate_supply_pr
-000079e0: 6f78 696d 616c 5f6c 696e 6573 2873 656c  oximal_lines(sel
-000079f0: 662c 6461 7461 2c20 7375 7070 6c79 5f7a  f,data, supply_z
-00007a00: 6f6e 6573 293a 0a20 2020 2023 2020 2020  ones):.    #    
-00007a10: 2070 726f 7869 6d61 6c5f 6c69 6e65 5f70   proximal_line_p
-00007a20: 7269 6365 7320 3d20 5b5d 0a20 2020 2023  rices = [].    #
-00007a30: 2020 2020 2066 6f72 2073 7461 7274 2c20       for start, 
-00007a40: 656e 642c 205f 2c20 5f20 696e 2073 7570  end, _, _ in sup
-00007a50: 706c 795f 7a6f 6e65 733a 0a20 2020 2023  ply_zones:.    #
-00007a60: 2020 2020 2020 2020 2062 6173 655f 6361           base_ca
-00007a70: 6e64 6c65 5f70 7269 6365 7320 3d20 6461  ndle_prices = da
-00007a80: 7461 2e6c 6f63 5b28 6461 7461 5b27 4361  ta.loc[(data['Ca
-00007a90: 6e64 6c65 2054 7970 6527 5d20 3d3d 2027  ndle Type'] == '
-00007aa0: 4261 7365 2043 616e 646c 6527 2920 2620  Base Candle') & 
-00007ab0: 2864 6174 612e 696e 6465 7820 3e3d 2064  (data.index >= d
-00007ac0: 6174 612e 696e 6465 785b 7374 6172 745d  ata.index[start]
-00007ad0: 2920 2620 2864 6174 612e 696e 6465 7820  ) & (data.index 
-00007ae0: 3c3d 2064 6174 612e 696e 6465 785b 656e  <= data.index[en
-00007af0: 645d 292c 205b 274f 7065 6e27 2c20 2743  d]), ['Open', 'C
-00007b00: 6c6f 7365 275d 5d0a 2020 2020 2320 2020  lose']].    #   
-00007b10: 2020 2020 2020 6d69 6e5f 7072 6963 6520        min_price 
-00007b20: 3d20 6261 7365 5f63 616e 646c 655f 7072  = base_candle_pr
-00007b30: 6963 6573 2e6d 696e 2861 7869 733d 3129  ices.min(axis=1)
-00007b40: 2e6d 696e 2829 2020 2320 4765 7420 7468  .min()  # Get th
-00007b50: 6520 6d69 6e69 6d75 6d20 7072 6963 6520  e minimum price 
-00007b60: 616d 6f6e 6720 616c 6c20 6261 7365 2063  among all base c
-00007b70: 616e 646c 6573 2720 6f70 656e 2061 6e64  andles' open and
-00007b80: 2063 6c6f 7365 2070 7269 6365 730a 2020   close prices.  
-00007b90: 2020 2320 2020 2020 2020 2020 7072 6f78    #         prox
-00007ba0: 696d 616c 5f6c 696e 655f 7072 6963 6573  imal_line_prices
-00007bb0: 2e61 7070 656e 6428 6d69 6e5f 7072 6963  .append(min_pric
-00007bc0: 6529 0a20 2020 2023 2020 2020 2072 6574  e).    #     ret
-00007bd0: 7572 6e20 7072 6f78 696d 616c 5f6c 696e  urn proximal_lin
-00007be0: 655f 7072 6963 6573 0a20 2020 2020 2020  e_prices.       
-00007bf0: 200a 2020 2020 2320 6465 6620 6361 6c63   .    # def calc
-00007c00: 756c 6174 655f 6465 6d61 6e64 5f64 6973  ulate_demand_dis
-00007c10: 7461 6c5f 6c69 6e65 7328 7365 6c66 2c64  tal_lines(self,d
-00007c20: 6174 612c 2064 656d 616e 645f 7a6f 6e65  ata, demand_zone
-00007c30: 7329 3a0a 2020 2020 2320 2020 2020 6469  s):.    #     di
-00007c40: 7374 616c 5f6c 696e 655f 7072 6963 6573  stal_line_prices
-00007c50: 203d 205b 5d0a 2020 2020 2320 2020 2020   = [].    #     
-00007c60: 666f 7220 7374 6172 742c 2065 6e64 2c20  for start, end, 
-00007c70: 7061 7474 6572 6e2c 205f 2069 6e20 6465  pattern, _ in de
-00007c80: 6d61 6e64 5f7a 6f6e 6573 3a0a 2020 2020  mand_zones:.    
-00007c90: 2320 2020 2020 2020 2020 6966 2070 6174  #         if pat
-00007ca0: 7465 726e 203d 3d20 2744 726f 7020 4261  tern == 'Drop Ba
-00007cb0: 7365 2052 616c 6c79 273a 0a20 2020 2023  se Rally':.    #
-00007cc0: 2020 2020 2020 2020 2020 2020 2023 204c               # L
-00007cd0: 6f67 6963 2066 6f72 2044 726f 7020 4261  ogic for Drop Ba
-00007ce0: 7365 2052 616c 6c79 2070 6174 7465 726e  se Rally pattern
-00007cf0: 3a20 5461 6b65 2074 6865 206c 6f77 6573  : Take the lowes
-00007d00: 7420 7072 6963 6520 616d 6f6e 6720 616c  t price among al
-00007d10: 6c20 636f 6d70 6f6e 656e 7473 206f 6620  l components of 
-00007d20: 7468 6520 7a6f 6e65 0a20 2020 2023 2020  the zone.    #  
-00007d30: 2020 2020 2020 2020 2020 206c 6f77 6573             lowes
-00007d40: 745f 7072 6963 6520 3d20 6d69 6e28 6461  t_price = min(da
-00007d50: 7461 5b27 4c6f 7727 5d5b 7374 6172 743a  ta['Low'][start:
-00007d60: 656e 6420 2b20 315d 2920 2023 2047 6574  end + 1])  # Get
-00007d70: 2074 6865 206c 6f77 6573 7420 7072 6963   the lowest pric
-00007d80: 6520 7769 7468 696e 2074 6865 207a 6f6e  e within the zon
-00007d90: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00007da0: 2020 2020 6469 7374 616c 5f6c 696e 655f      distal_line_
-00007db0: 7072 6963 6573 2e61 7070 656e 6428 6c6f  prices.append(lo
-00007dc0: 7765 7374 5f70 7269 6365 290a 2020 2020  west_price).    
-00007dd0: 2320 2020 2020 2020 2020 656c 6966 2070  #         elif p
-00007de0: 6174 7465 726e 203d 3d20 2752 616c 6c79  attern == 'Rally
-00007df0: 2042 6173 6520 5261 6c6c 7927 3a0a 2020   Base Rally':.  
-00007e00: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00007e10: 2320 4c6f 6769 6320 666f 7220 5261 6c6c  # Logic for Rall
-00007e20: 7920 4261 7365 2052 616c 6c79 2070 6174  y Base Rally pat
-00007e30: 7465 726e 3a20 5461 6b65 2074 6865 206c  tern: Take the l
-00007e40: 6f77 6573 7420 6f66 206f 6e6c 7920 616c  owest of only al
-00007e50: 6c20 6261 7365 2063 616e 646c 6520 616e  l base candle an
-00007e60: 6420 666f 6c6c 6f77 6564 2072 616c 6c79  d followed rally
-00007e70: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
-00007e80: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
-00007e90: 616e 646c 655f 7072 6963 6573 203d 2064  andle_prices = d
-00007ea0: 6174 612e 6c6f 635b 2864 6174 615b 2743  ata.loc[(data['C
-00007eb0: 616e 646c 6520 5479 7065 275d 203d 3d20  andle Type'] == 
-00007ec0: 2742 6173 6520 4361 6e64 6c65 2729 2026  'Base Candle') &
-00007ed0: 2028 6461 7461 2e69 6e64 6578 203e 3d20   (data.index >= 
-00007ee0: 6461 7461 2e69 6e64 6578 5b73 7461 7274  data.index[start
-00007ef0: 5d29 2026 2028 6461 7461 2e69 6e64 6578  ]) & (data.index
-00007f00: 203c 3d20 6461 7461 2e69 6e64 6578 5b65   <= data.index[e
-00007f10: 6e64 5d29 2c20 274c 6f77 275d 0a20 2020  nd]), 'Low'].   
-00007f20: 2023 2020 2020 2020 2020 2020 2020 2072   #             r
-00007f30: 616c 6c79 5f63 616e 646c 655f 7072 6963  ally_candle_pric
-00007f40: 6573 203d 2064 6174 612e 6c6f 635b 2864  es = data.loc[(d
-00007f50: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00007f60: 275d 203d 3d20 2752 616c 6c79 2043 616e  '] == 'Rally Can
-00007f70: 646c 6527 2920 2620 2864 6174 612e 696e  dle') & (data.in
-00007f80: 6465 7820 3e3d 2064 6174 612e 696e 6465  dex >= data.inde
-00007f90: 785b 656e 645d 2920 2620 2864 6174 612e  x[end]) & (data.
-00007fa0: 696e 6465 7820 3c20 6461 7461 2e69 6e64  index < data.ind
-00007fb0: 6578 5b65 6e64 2b31 5d29 2c20 274c 6f77  ex[end+1]), 'Low
-00007fc0: 275d 0a20 2020 2023 2020 2020 2020 2020  '].    #        
-00007fd0: 2020 2020 2061 6c6c 5f70 7269 6365 7320       all_prices 
-00007fe0: 3d20 7064 2e63 6f6e 6361 7428 5b62 6173  = pd.concat([bas
-00007ff0: 655f 6361 6e64 6c65 5f70 7269 6365 732c  e_candle_prices,
-00008000: 2072 616c 6c79 5f63 616e 646c 655f 7072   rally_candle_pr
-00008010: 6963 6573 5d29 0a20 2020 2023 2020 2020  ices]).    #    
-00008020: 2020 2020 2020 2020 206c 6f77 6573 745f           lowest_
-00008030: 7072 6963 6520 3d20 616c 6c5f 7072 6963  price = all_pric
-00008040: 6573 2e6d 696e 2829 2069 6620 6e6f 7420  es.min() if not 
-00008050: 616c 6c5f 7072 6963 6573 2e65 6d70 7479  all_prices.empty
-00008060: 2065 6c73 6520 4e6f 6e65 0a20 2020 2023   else None.    #
-00008070: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-00008080: 7461 6c5f 6c69 6e65 5f70 7269 6365 732e  tal_line_prices.
-00008090: 6170 7065 6e64 286c 6f77 6573 745f 7072  append(lowest_pr
-000080a0: 6963 6529 0a20 2020 2023 2020 2020 2072  ice).    #     r
-000080b0: 6574 7572 6e20 6469 7374 616c 5f6c 696e  eturn distal_lin
-000080c0: 655f 7072 6963 6573 0a0a 2020 2020 2320  e_prices..    # 
-000080d0: 6465 6620 6361 6c63 756c 6174 655f 7375  def calculate_su
-000080e0: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
-000080f0: 7328 7365 6c66 2c64 6174 612c 2073 7570  s(self,data, sup
-00008100: 706c 795f 7a6f 6e65 7329 3a0a 2020 2020  ply_zones):.    
-00008110: 2320 2020 2020 6469 7374 616c 5f6c 696e  #     distal_lin
-00008120: 655f 7072 6963 6573 203d 205b 5d0a 2020  e_prices = [].  
-00008130: 2020 2320 2020 2020 666f 7220 7374 6172    #     for star
-00008140: 742c 2065 6e64 2c20 7061 7474 6572 6e2c  t, end, pattern,
-00008150: 205f 2069 6e20 7375 7070 6c79 5f7a 6f6e   _ in supply_zon
-00008160: 6573 3a0a 2020 2020 2320 2020 2020 2020  es:.    #       
-00008170: 2020 6966 2070 6174 7465 726e 203d 3d20    if pattern == 
-00008180: 2752 616c 6c79 2042 6173 6520 4472 6f70  'Rally Base Drop
-00008190: 273a 0a20 2020 2023 2020 2020 2020 2020  ':.    #        
-000081a0: 2020 2020 2023 204c 6f67 6963 2066 6f72       # Logic for
-000081b0: 2052 616c 6c79 2042 6173 6520 4472 6f70   Rally Base Drop
-000081c0: 2070 6174 7465 726e 3a20 5461 6b65 2074   pattern: Take t
-000081d0: 6865 2068 6967 6865 7374 2070 7269 6365  he highest price
-000081e0: 2061 6d6f 6e67 2061 6c6c 2063 6f6d 706f   among all compo
-000081f0: 6e65 6e74 7320 6f66 2074 6865 207a 6f6e  nents of the zon
-00008200: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00008210: 2020 2020 6869 6768 6573 745f 7072 6963      highest_pric
-00008220: 6520 3d20 6d61 7828 6461 7461 5b27 4869  e = max(data['Hi
-00008230: 6768 275d 5b73 7461 7274 3a65 6e64 202b  gh'][start:end +
-00008240: 2031 5d29 2020 2320 4765 7420 7468 6520   1])  # Get the 
-00008250: 6869 6768 6573 7420 7072 6963 6520 7769  highest price wi
-00008260: 7468 696e 2074 6865 207a 6f6e 650a 2020  thin the zone.  
-00008270: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008280: 6469 7374 616c 5f6c 696e 655f 7072 6963  distal_line_pric
-00008290: 6573 2e61 7070 656e 6428 6869 6768 6573  es.append(highes
-000082a0: 745f 7072 6963 6529 0a20 2020 2023 2020  t_price).    #  
-000082b0: 2020 2020 2020 2065 6c69 6620 7061 7474         elif patt
-000082c0: 6572 6e20 3d3d 2027 4472 6f70 2042 6173  ern == 'Drop Bas
-000082d0: 6520 4472 6f70 273a 0a20 2020 2023 2020  e Drop':.    #  
-000082e0: 2020 2020 2020 2020 2020 2023 204c 6f67             # Log
-000082f0: 6963 2066 6f72 2044 726f 7020 4261 7365  ic for Drop Base
-00008300: 2044 726f 7020 7061 7474 6572 6e3a 2054   Drop pattern: T
-00008310: 616b 6520 7468 6520 6869 6768 6573 7420  ake the highest 
-00008320: 6f66 206f 6e6c 7920 616c 6c20 6261 7365  of only all base
-00008330: 2063 616e 646c 6573 2061 6e64 2066 6f6c   candles and fol
-00008340: 6c6f 7765 6420 6472 6f70 2063 616e 646c  lowed drop candl
-00008350: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00008360: 2020 2020 6261 7365 5f63 616e 646c 655f      base_candle_
-00008370: 7072 6963 6573 203d 2064 6174 612e 6c6f  prices = data.lo
-00008380: 635b 2864 6174 615b 2743 616e 646c 6520  c[(data['Candle 
-00008390: 5479 7065 275d 203d 3d20 2742 6173 6520  Type'] == 'Base 
-000083a0: 4361 6e64 6c65 2729 2026 2028 6461 7461  Candle') & (data
-000083b0: 2e69 6e64 6578 203e 3d20 6461 7461 2e69  .index >= data.i
-000083c0: 6e64 6578 5b73 7461 7274 5d29 2026 2028  ndex[start]) & (
-000083d0: 6461 7461 2e69 6e64 6578 203c 3d20 6461  data.index <= da
-000083e0: 7461 2e69 6e64 6578 5b65 6e64 5d29 2c20  ta.index[end]), 
-000083f0: 2748 6967 6827 5d0a 2020 2020 2320 2020  'High'].    #   
-00008400: 2020 2020 2020 2020 2020 6472 6f70 5f63            drop_c
-00008410: 616e 646c 655f 7072 6963 6573 203d 2064  andle_prices = d
-00008420: 6174 612e 6c6f 635b 2864 6174 615b 2743  ata.loc[(data['C
-00008430: 616e 646c 6520 5479 7065 275d 203d 3d20  andle Type'] == 
-00008440: 2744 726f 7020 4361 6e64 6c65 2729 2026  'Drop Candle') &
-00008450: 2028 6461 7461 2e69 6e64 6578 203e 3d20   (data.index >= 
-00008460: 6461 7461 2e69 6e64 6578 5b73 7461 7274  data.index[start
-00008470: 5d29 2026 2028 6461 7461 2e69 6e64 6578  ]) & (data.index
-00008480: 203c 3d20 6461 7461 2e69 6e64 6578 5b65   <= data.index[e
-00008490: 6e64 5d29 2c20 2748 6967 6827 5d0a 2020  nd]), 'High'].  
-000084a0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-000084b0: 616c 6c5f 7072 6963 6573 203d 2070 642e  all_prices = pd.
-000084c0: 636f 6e63 6174 285b 6261 7365 5f63 616e  concat([base_can
-000084d0: 646c 655f 7072 6963 6573 2c20 6472 6f70  dle_prices, drop
-000084e0: 5f63 616e 646c 655f 7072 6963 6573 5d29  _candle_prices])
-000084f0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00008500: 2020 2068 6967 6865 7374 5f70 7269 6365     highest_price
-00008510: 203d 2061 6c6c 5f70 7269 6365 732e 6d61   = all_prices.ma
-00008520: 7828 2920 6966 206e 6f74 2061 6c6c 5f70  x() if not all_p
-00008530: 7269 6365 732e 656d 7074 7920 656c 7365  rices.empty else
-00008540: 204e 6f6e 650a 2020 2020 2320 2020 2020   None.    #     
-00008550: 2020 2020 2020 2020 6469 7374 616c 5f6c          distal_l
-00008560: 696e 655f 7072 6963 6573 2e61 7070 656e  ine_prices.appen
-00008570: 6428 6869 6768 6573 745f 7072 6963 6529  d(highest_price)
-00008580: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
-00008590: 6e20 6469 7374 616c 5f6c 696e 655f 7072  n distal_line_pr
-000085a0: 6963 6573 0a0a 2020 2020 2320 6465 6620  ices..    # def 
-000085b0: 6973 5f7a 6f6e 655f 7465 7374 6564 2873  is_zone_tested(s
-000085c0: 656c 662c 6461 7461 2c20 7374 6172 745f  elf,data, start_
-000085d0: 696e 6465 782c 2065 6e64 5f69 6e64 6578  index, end_index
-000085e0: 2c20 7072 6f78 696d 616c 5f6c 696e 655f  , proximal_line_
-000085f0: 7072 6963 6529 3a0a 2020 2020 2320 2020  price):.    #   
-00008600: 2020 2222 220a 2020 2020 2320 2020 2020    """.    #     
-00008610: 4368 6563 6b20 6966 2074 6865 2070 726f  Check if the pro
-00008620: 7869 6d61 6c20 6c69 6e65 2070 7269 6365  ximal line price
-00008630: 2068 6173 2062 6565 6e20 7465 7374 6564   has been tested
-00008640: 2062 7920 6675 7475 7265 2070 7269 6365   by future price
-00008650: 732e 0a20 2020 2020 2020 200a 2020 2020  s..        .    
-00008660: 2320 2020 2020 4172 6773 3a0a 2020 2020  #     Args:.    
-00008670: 2320 2020 2020 2d20 6461 7461 3a20 4461  #     - data: Da
-00008680: 7461 4672 616d 6520 636f 6e74 6169 6e69  taFrame containi
-00008690: 6e67 2073 746f 636b 2064 6174 610a 2020  ng stock data.  
-000086a0: 2020 2320 2020 2020 2d20 7374 6172 745f    #     - start_
-000086b0: 696e 6465 783a 2053 7461 7274 2069 6e64  index: Start ind
-000086c0: 6578 206f 6620 7468 6520 6465 6d61 6e64  ex of the demand
-000086d0: 2f73 7570 706c 7920 7a6f 6e65 0a20 2020  /supply zone.   
-000086e0: 2023 2020 2020 202d 2065 6e64 5f69 6e64   #     - end_ind
-000086f0: 6578 3a20 456e 6420 696e 6465 7820 6f66  ex: End index of
-00008700: 2074 6865 2064 656d 616e 642f 7375 7070   the demand/supp
-00008710: 6c79 207a 6f6e 650a 2020 2020 2320 2020  ly zone.    #   
-00008720: 2020 2d20 7072 6f78 696d 616c 5f6c 696e    - proximal_lin
-00008730: 655f 7072 6963 653a 2050 726f 7869 6d61  e_price: Proxima
-00008740: 6c20 6c69 6e65 2070 7269 6365 0a20 2020  l line price.   
-00008750: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-00008760: 5265 7475 726e 733a 0a20 2020 2023 2020  Returns:.    #  
-00008770: 2020 202d 2054 7275 6520 6966 2074 6865     - True if the
-00008780: 2070 726f 7869 6d61 6c20 6c69 6e65 2070   proximal line p
-00008790: 7269 6365 2069 7320 7465 7374 6564 2c20  rice is tested, 
-000087a0: 4661 6c73 6520 6f74 6865 7277 6973 650a  False otherwise.
-000087b0: 2020 2020 2320 2020 2020 2222 220a 2020      #     """.  
-000087c0: 2020 2320 2020 2020 666f 7220 6920 696e    #     for i in
-000087d0: 2072 616e 6765 2865 6e64 5f69 6e64 6578   range(end_index
-000087e0: 202b 2031 2c20 6c65 6e28 6461 7461 2929   + 1, len(data))
-000087f0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00008800: 6966 2064 6174 615b 274c 6f77 275d 5b69  if data['Low'][i
-00008810: 5d20 3c3d 2070 726f 7869 6d61 6c5f 6c69  ] <= proximal_li
-00008820: 6e65 5f70 7269 6365 203c 3d20 6461 7461  ne_price <= data
-00008830: 5b27 4869 6768 275d 5b69 5d3a 0a20 2020  ['High'][i]:.   
-00008840: 2023 2020 2020 2020 2020 2020 2020 2072   #             r
-00008850: 6574 7572 6e20 5472 7565 0a20 2020 2023  eturn True.    #
-00008860: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00008870: 650a 0a20 2020 2023 2064 6566 2063 616c  e..    # def cal
-00008880: 6375 6c61 7465 5f7a 6f6e 655f 7261 6e67  culate_zone_rang
-00008890: 6528 7365 6c66 2c70 726f 7869 6d61 6c5f  e(self,proximal_
-000088a0: 6c69 6e65 2c20 6469 7374 616c 5f6c 696e  line, distal_lin
-000088b0: 6529 3a0a 2020 2020 2320 2020 2020 2222  e):.    #     ""
-000088c0: 220a 2020 2020 2320 2020 2020 4361 6c63  ".    #     Calc
-000088d0: 756c 6174 6520 7468 6520 7261 6e67 6520  ulate the range 
-000088e0: 6f66 2061 207a 6f6e 6520 6769 7665 6e20  of a zone given 
-000088f0: 6974 7320 7072 6f78 696d 616c 2061 6e64  its proximal and
-00008900: 2064 6973 7461 6c20 6c69 6e65 732e 0a20   distal lines.. 
-00008910: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
-00008920: 2020 4172 6773 3a0a 2020 2020 2320 2020    Args:.    #   
-00008930: 2020 2d20 7072 6f78 696d 616c 5f6c 696e    - proximal_lin
-00008940: 653a 2050 726f 7869 6d61 6c20 6c69 6e65  e: Proximal line
-00008950: 2070 7269 6365 0a20 2020 2023 2020 2020   price.    #    
-00008960: 202d 2064 6973 7461 6c5f 6c69 6e65 3a20   - distal_line: 
-00008970: 4469 7374 616c 206c 696e 6520 7072 6963  Distal line pric
-00008980: 650a 2020 2020 2020 2020 0a20 2020 2023  e.        .    #
-00008990: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-000089a0: 2020 2320 2020 2020 2d20 5261 6e67 6520    #     - Range 
-000089b0: 6f66 2074 6865 207a 6f6e 650a 2020 2020  of the zone.    
-000089c0: 2320 2020 2020 2222 220a 2020 2020 2320  #     """.    # 
-000089d0: 2020 2020 6966 2070 726f 7869 6d61 6c5f      if proximal_
-000089e0: 6c69 6e65 2069 7320 6e6f 7420 4e6f 6e65  line is not None
-000089f0: 2061 6e64 2064 6973 7461 6c5f 6c69 6e65   and distal_line
-00008a00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00008a10: 2020 2320 2020 2020 2020 2020 7265 7475    #         retu
-00008a20: 726e 2061 6273 2870 726f 7869 6d61 6c5f  rn abs(proximal_
-00008a30: 6c69 6e65 202d 2064 6973 7461 6c5f 6c69  line - distal_li
-00008a40: 6e65 290a 2020 2020 2320 2020 2020 656c  ne).    #     el
-00008a50: 7365 3a0a 2020 2020 2320 2020 2020 2020  se:.    #       
-00008a60: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00008a70: 2020 2023 2064 6566 2063 616c 6375 6c61     # def calcula
-00008a80: 7465 5f64 656d 616e 645f 7a6f 6e65 5f72  te_demand_zone_r
-00008a90: 616e 6765 7328 7365 6c66 2c64 656d 616e  anges(self,deman
-00008aa0: 645f 7a6f 6e65 732c 2064 656d 616e 645f  d_zones, demand_
-00008ab0: 7072 6f78 696d 616c 5f6c 696e 6573 2c20  proximal_lines, 
-00008ac0: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00008ad0: 6e65 7329 3a0a 2020 2020 2320 2020 2020  nes):.    #     
-00008ae0: 2222 220a 2020 2020 2320 2020 2020 4361  """.    #     Ca
-00008af0: 6c63 756c 6174 6520 7468 6520 7261 6e67  lculate the rang
-00008b00: 6520 6f66 2065 6163 6820 6465 6d61 6e64  e of each demand
-00008b10: 207a 6f6e 652e 0a20 2020 2020 2020 200a   zone..        .
-00008b20: 2020 2020 2320 2020 2020 4172 6773 3a0a      #     Args:.
-00008b30: 2020 2020 2320 2020 2020 2d20 6465 6d61      #     - dema
-00008b40: 6e64 5f7a 6f6e 6573 3a20 4c69 7374 206f  nd_zones: List o
-00008b50: 6620 6465 6d61 6e64 207a 6f6e 6520 7475  f demand zone tu
-00008b60: 706c 6573 2028 7374 6172 742c 2065 6e64  ples (start, end
-00008b70: 2c20 7061 7474 6572 6e2c 2062 6173 655f  , pattern, base_
-00008b80: 636f 756e 7429 0a20 2020 2023 2020 2020  count).    #    
-00008b90: 202d 2064 656d 616e 645f 7072 6f78 696d   - demand_proxim
-00008ba0: 616c 5f6c 696e 6573 3a20 4c69 7374 206f  al_lines: List o
-00008bb0: 6620 7072 6f78 696d 616c 206c 696e 6520  f proximal line 
-00008bc0: 7072 6963 6573 2066 6f72 2064 656d 616e  prices for deman
-00008bd0: 6420 7a6f 6e65 730a 2020 2020 2320 2020  d zones.    #   
-00008be0: 2020 2d20 6465 6d61 6e64 5f64 6973 7461    - demand_dista
-00008bf0: 6c5f 6c69 6e65 733a 204c 6973 7420 6f66  l_lines: List of
-00008c00: 2064 6973 7461 6c20 6c69 6e65 2070 7269   distal line pri
-00008c10: 6365 7320 666f 7220 6465 6d61 6e64 207a  ces for demand z
-00008c20: 6f6e 6573 0a20 2020 2020 2020 200a 2020  ones.        .  
-00008c30: 2020 2320 2020 2020 5265 7475 726e 733a    #     Returns:
-00008c40: 0a20 2020 2023 2020 2020 202d 204c 6973  .    #     - Lis
-00008c50: 7420 6f66 2072 616e 6765 7320 636f 7272  t of ranges corr
-00008c60: 6573 706f 6e64 696e 6720 746f 2065 6163  esponding to eac
-00008c70: 6820 6465 6d61 6e64 207a 6f6e 650a 2020  h demand zone.  
-00008c80: 2020 2320 2020 2020 2222 220a 2020 2020    #     """.    
-00008c90: 2320 2020 2020 6465 6d61 6e64 5f7a 6f6e  #     demand_zon
-00008ca0: 655f 7261 6e67 6573 203d 205b 5d0a 2020  e_ranges = [].  
-00008cb0: 2020 2320 2020 2020 666f 7220 692c 2028    #     for i, (
-00008cc0: 7374 6172 742c 2065 6e64 2c20 5f2c 205f  start, end, _, _
-00008cd0: 2920 696e 2065 6e75 6d65 7261 7465 2864  ) in enumerate(d
-00008ce0: 656d 616e 645f 7a6f 6e65 7329 3a0a 2020  emand_zones):.  
-00008cf0: 2020 2320 2020 2020 2020 2020 7261 6e67    #         rang
-00008d00: 655f 6f66 5f7a 6f6e 6520 3d20 7365 6c66  e_of_zone = self
-00008d10: 2e63 616c 6375 6c61 7465 5f7a 6f6e 655f  .calculate_zone_
-00008d20: 7261 6e67 6528 6465 6d61 6e64 5f70 726f  range(demand_pro
-00008d30: 7869 6d61 6c5f 6c69 6e65 735b 695d 2c20  ximal_lines[i], 
-00008d40: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00008d50: 6e65 735b 695d 290a 2020 2020 2320 2020  nes[i]).    #   
-00008d60: 2020 2020 2020 6465 6d61 6e64 5f7a 6f6e        demand_zon
-00008d70: 655f 7261 6e67 6573 2e61 7070 656e 6428  e_ranges.append(
-00008d80: 7261 6e67 655f 6f66 5f7a 6f6e 6529 0a20  range_of_zone). 
-00008d90: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
-00008da0: 6465 6d61 6e64 5f7a 6f6e 655f 7261 6e67  demand_zone_rang
-00008db0: 6573 0a0a 2020 2020 2320 6465 6620 6361  es..    # def ca
-00008dc0: 6c63 756c 6174 655f 7375 7070 6c79 5f7a  lculate_supply_z
-00008dd0: 6f6e 655f 7261 6e67 6573 2873 656c 662c  one_ranges(self,
-00008de0: 7375 7070 6c79 5f7a 6f6e 6573 2c20 7375  supply_zones, su
-00008df0: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
-00008e00: 6e65 732c 2073 7570 706c 795f 6469 7374  nes, supply_dist
-00008e10: 616c 5f6c 696e 6573 293a 0a20 2020 2023  al_lines):.    #
-00008e20: 2020 2020 2022 2222 0a20 2020 2023 2020       """.    #  
-00008e30: 2020 2043 616c 6375 6c61 7465 2074 6865     Calculate the
-00008e40: 2072 616e 6765 206f 6620 6561 6368 2073   range of each s
-00008e50: 7570 706c 7920 7a6f 6e65 2e0a 2020 2020  upply zone..    
-00008e60: 2020 2020 0a20 2020 2023 2020 2020 2041      .    #     A
-00008e70: 7267 733a 0a20 2020 2023 2020 2020 202d  rgs:.    #     -
-00008e80: 2073 7570 706c 795f 7a6f 6e65 733a 204c   supply_zones: L
-00008e90: 6973 7420 6f66 2073 7570 706c 7920 7a6f  ist of supply zo
-00008ea0: 6e65 2074 7570 6c65 7320 2873 7461 7274  ne tuples (start
-00008eb0: 2c20 656e 642c 2070 6174 7465 726e 2c20  , end, pattern, 
-00008ec0: 6261 7365 5f63 6f75 6e74 290a 2020 2020  base_count).    
-00008ed0: 2320 2020 2020 2d20 7375 7070 6c79 5f70  #     - supply_p
-00008ee0: 726f 7869 6d61 6c5f 6c69 6e65 733a 204c  roximal_lines: L
-00008ef0: 6973 7420 6f66 2070 726f 7869 6d61 6c20  ist of proximal 
-00008f00: 6c69 6e65 2070 7269 6365 7320 666f 7220  line prices for 
-00008f10: 7375 7070 6c79 207a 6f6e 6573 0a20 2020  supply zones.   
-00008f20: 2023 2020 2020 202d 2073 7570 706c 795f   #     - supply_
-00008f30: 6469 7374 616c 5f6c 696e 6573 3a20 4c69  distal_lines: Li
-00008f40: 7374 206f 6620 6469 7374 616c 206c 696e  st of distal lin
-00008f50: 6520 7072 6963 6573 2066 6f72 2073 7570  e prices for sup
-00008f60: 706c 7920 7a6f 6e65 730a 2020 2020 2020  ply zones.      
-00008f70: 2020 0a20 2020 2023 2020 2020 2052 6574    .    #     Ret
-00008f80: 7572 6e73 3a0a 2020 2020 2320 2020 2020  urns:.    #     
-00008f90: 2d20 4c69 7374 206f 6620 7261 6e67 6573  - List of ranges
-00008fa0: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-00008fb0: 6f20 6561 6368 2073 7570 706c 7920 7a6f  o each supply zo
-00008fc0: 6e65 0a20 2020 2023 2020 2020 2022 2222  ne.    #     """
-00008fd0: 0a20 2020 2023 2020 2020 2073 7570 706c  .    #     suppl
-00008fe0: 795f 7a6f 6e65 5f72 616e 6765 7320 3d20  y_zone_ranges = 
-00008ff0: 5b5d 0a20 2020 2023 2020 2020 2066 6f72  [].    #     for
-00009000: 2069 2c20 2873 7461 7274 2c20 656e 642c   i, (start, end,
-00009010: 205f 2c20 5f29 2069 6e20 656e 756d 6572   _, _) in enumer
-00009020: 6174 6528 7375 7070 6c79 5f7a 6f6e 6573  ate(supply_zones
-00009030: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
-00009040: 2072 616e 6765 5f6f 665f 7a6f 6e65 203d   range_of_zone =
-00009050: 2073 656c 662e 6361 6c63 756c 6174 655f   self.calculate_
-00009060: 7a6f 6e65 5f72 616e 6765 2873 7570 706c  zone_range(suppl
-00009070: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
-00009080: 5b69 5d2c 2073 7570 706c 795f 6469 7374  [i], supply_dist
-00009090: 616c 5f6c 696e 6573 5b69 5d29 0a20 2020  al_lines[i]).   
-000090a0: 2023 2020 2020 2020 2020 2073 7570 706c   #         suppl
-000090b0: 795f 7a6f 6e65 5f72 616e 6765 732e 6170  y_zone_ranges.ap
-000090c0: 7065 6e64 2872 616e 6765 5f6f 665f 7a6f  pend(range_of_zo
-000090d0: 6e65 290a 2020 2020 2320 2020 2020 7265  ne).    #     re
-000090e0: 7475 726e 2073 7570 706c 795f 7a6f 6e65  turn supply_zone
-000090f0: 5f72 616e 6765 730a 0a20 2020 2023 2064  _ranges..    # d
-00009100: 6566 2066 696c 7465 725f 7374 6f63 6b73  ef filter_stocks
-00009110: 5f62 795f 6469 7374 616e 6365 2873 656c  _by_distance(sel
-00009120: 662c 6461 7461 2c73 796d 626f 6c5f 6c69  f,data,symbol_li
-00009130: 7374 2c20 7468 7265 7368 6f6c 645f 7065  st, threshold_pe
-00009140: 7263 656e 742c 2074 696d 6566 7261 6d65  rcent, timeframe
-00009150: 293a 0a20 2020 2023 2020 2020 2066 696c  ):.    #     fil
-00009160: 7465 7265 645f 7374 6f63 6b73 203d 205b  tered_stocks = [
-00009170: 5d0a 2020 2020 2320 2020 2020 666f 7220  ].    #     for 
-00009180: 7379 6d62 6f6c 2069 6e20 7379 6d62 6f6c  symbol in symbol
-00009190: 5f6c 6973 743a 0a20 2020 2023 2020 2020  _list:.    #    
-000091a0: 2020 2020 2069 6620 6461 7461 2069 7320       if data is 
-000091b0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2320  not None:.    # 
-000091c0: 2020 2020 2020 2020 2020 2020 636d 7020              cmp 
-000091d0: 3d20 6461 7461 2e69 6c6f 635b 2d31 5d5b  = data.iloc[-1][
-000091e0: 2743 6c6f 7365 275d 2020 2320 4375 7272  'Close']  # Curr
-000091f0: 656e 7420 6d61 726b 6574 2070 7269 6365  ent market price
-00009200: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009210: 2020 2064 656d 616e 645f 7a6f 6e65 732c     demand_zones,
-00009220: 205f 2c20 5f2c 2064 656d 616e 645f 7072   _, _, demand_pr
-00009230: 6f78 696d 616c 5f6c 696e 6520 3d20 7365  oximal_line = se
-00009240: 6c66 2e69 6465 6e74 6966 795f 6465 6d61  lf.identify_dema
-00009250: 6e64 5f7a 6f6e 6528 6461 7461 2c20 636d  nd_zone(data, cm
-00009260: 7029 2020 2320 5061 7373 2063 6d70 2061  p)  # Pass cmp a
-00009270: 7267 756d 656e 7420 6865 7265 0a20 2020  rgument here.   
-00009280: 2023 2020 2020 2020 2020 2020 2020 2073   #             s
-00009290: 7570 706c 795f 7a6f 6e65 732c 205f 2c20  upply_zones, _, 
-000092a0: 5f2c 2073 7570 706c 795f 7072 6f78 696d  _, supply_proxim
-000092b0: 616c 5f6c 696e 6520 3d20 7365 6c66 2e69  al_line = self.i
-000092c0: 6465 6e74 6966 795f 7375 7070 6c79 5f7a  dentify_supply_z
-000092d0: 6f6e 6528 6461 7461 2c20 636d 7029 2020  one(data, cmp)  
-000092e0: 2320 5061 7373 2063 6d70 2061 7267 756d  # Pass cmp argum
-000092f0: 656e 7420 6865 7265 0a20 2020 2020 2020  ent here.       
-00009300: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-00009310: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-00009320: 6563 6b20 6966 2065 6974 6865 7220 6465  eck if either de
-00009330: 6d61 6e64 206f 7220 7375 7070 6c79 207a  mand or supply z
-00009340: 6f6e 6573 2065 7869 7374 2066 6f72 2074  ones exist for t
-00009350: 6865 2073 746f 636b 0a20 2020 2023 2020  he stock.    #  
-00009360: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00009370: 6d61 6e64 5f7a 6f6e 6573 206f 7220 7375  mand_zones or su
-00009380: 7070 6c79 5f7a 6f6e 6573 3a0a 2020 2020  pply_zones:.    
-00009390: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000093a0: 2020 6669 6c74 6572 6564 5f73 746f 636b    filtered_stock
-000093b0: 732e 6170 7065 6e64 2873 796d 626f 6c29  s.append(symbol)
-000093c0: 0a0a 2020 2020 2320 2020 2020 7265 7475  ..    #     retu
-000093d0: 726e 2066 696c 7465 7265 645f 7374 6f63  rn filtered_stoc
-000093e0: 6b73 0a20 2020 200a 2020 2020 2320 6465  ks.    .    # de
-000093f0: 6620 6669 6e64 4465 6d61 6e64 5375 7070  f findDemandSupp
-00009400: 6c79 5a6f 6e65 7328 7365 6c66 2c64 6174  lyZones(self,dat
-00009410: 612c 7468 7265 7368 6f6c 645f 7065 7263  a,threshold_perc
-00009420: 656e 743d 3129 3a20 2020 2020 2020 200a  ent=1):        .
-00009430: 2020 2020 2320 2020 2020 2320 496e 6974      #     # Init
-00009440: 6961 6c69 7a65 2063 6f75 6e74 2066 6f72  ialize count for
-00009450: 2066 696c 7465 7265 6420 7374 6f63 6b73   filtered stocks
-00009460: 0a20 2020 2023 2020 2020 2063 6f75 6e74  .    #     count
-00009470: 5f66 696c 7465 7265 645f 7374 6f63 6b73  _filtered_stocks
-00009480: 203d 2030 0a0a 2020 2020 2320 2020 2020   = 0..    #     
-00009490: 2320 416e 616c 797a 6520 6465 6d61 6e64  # Analyze demand
-000094a0: 2061 6e64 2073 7570 706c 7920 7a6f 6e65   and supply zone
-000094b0: 7320 666f 7220 6561 6368 2073 746f 636b  s for each stock
-000094c0: 2061 6e64 2073 6176 6520 7265 7375 6c74   and save result
-000094d0: 7320 696e 2061 2066 696c 650a 2020 2020  s in a file.    
-000094e0: 2320 2020 2020 7769 7468 206f 7065 6e28  #     with open(
-000094f0: 2264 656d 616e 645f 7375 7070 6c79 5f7a  "demand_supply_z
-00009500: 6f6e 6573 2e74 7874 222c 2022 7722 2920  ones.txt", "w") 
-00009510: 6173 2066 696c 653a 0a20 2020 2023 2020  as file:.    #  
-00009520: 2020 2020 2020 2066 6f72 2073 796d 626f         for symbo
-00009530: 6c20 696e 2064 6174 615b 2253 746f 636b  l in data["Stock
-00009540: 225d 3a0a 2020 2020 2320 2020 2020 2020  "]:.    #       
-00009550: 2020 2020 2020 6966 2064 6174 6120 6973        if data is
-00009560: 206e 6f74 204e 6f6e 653a 0a20 2020 2023   not None:.    #
-00009570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009580: 2063 6d70 203d 2064 6174 612e 696c 6f63   cmp = data.iloc
-00009590: 5b2d 315d 5b27 436c 6f73 6527 5d20 2023  [-1]['Close']  #
-000095a0: 2043 7572 7265 6e74 206d 6172 6b65 7420   Current market 
-000095b0: 7072 6963 650a 2020 2020 2320 2020 2020  price.    #     
-000095c0: 2020 2020 2020 2020 2020 2020 6465 6d61              dema
-000095d0: 6e64 5f7a 6f6e 6573 2c20 5f2c 205f 2c20  nd_zones, _, _, 
-000095e0: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
-000095f0: 6c69 6e65 203d 2073 656c 662e 6964 656e  line = self.iden
-00009600: 7469 6679 5f64 656d 616e 645f 7a6f 6e65  tify_demand_zone
-00009610: 2864 6174 612c 2063 6d70 290a 2020 2020  (data, cmp).    
-00009620: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009630: 2020 7375 7070 6c79 5f7a 6f6e 6573 2c20    supply_zones, 
-00009640: 5f2c 205f 2c20 7375 7070 6c79 5f70 726f  _, _, supply_pro
-00009650: 7869 6d61 6c5f 6c69 6e65 203d 2073 656c  ximal_line = sel
-00009660: 662e 6964 656e 7469 6679 5f73 7570 706c  f.identify_suppl
-00009670: 795f 7a6f 6e65 2864 6174 612c 2063 6d70  y_zone(data, cmp
-00009680: 290a 0a20 2020 2023 2020 2020 2020 2020  )..    #        
-00009690: 2020 2020 2020 2020 2023 2053 7465 7020           # Step 
-000096a0: 313a 2043 616c 6375 6c61 7465 2070 726f  1: Calculate pro
-000096b0: 7869 6d61 6c20 6c69 6e65 7320 666f 7220  ximal lines for 
-000096c0: 6465 6d61 6e64 2061 6e64 2073 7570 706c  demand and suppl
-000096d0: 7920 7a6f 6e65 730a 2020 2020 2320 2020  y zones.    #   
-000096e0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000096f0: 6d61 6e64 5f70 726f 7869 6d61 6c5f 6c69  mand_proximal_li
-00009700: 6e65 7320 3d20 7365 6c66 2e63 616c 6375  nes = self.calcu
-00009710: 6c61 7465 5f64 656d 616e 645f 7072 6f78  late_demand_prox
-00009720: 696d 616c 5f6c 696e 6573 2864 6174 612c  imal_lines(data,
-00009730: 2064 656d 616e 645f 7a6f 6e65 7329 0a20   demand_zones). 
-00009740: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009750: 2020 2020 2073 7570 706c 795f 7072 6f78       supply_prox
-00009760: 696d 616c 5f6c 696e 6573 203d 2073 656c  imal_lines = sel
-00009770: 662e 6361 6c63 756c 6174 655f 7375 7070  f.calculate_supp
-00009780: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-00009790: 7328 6461 7461 2c20 7375 7070 6c79 5f7a  s(data, supply_z
-000097a0: 6f6e 6573 290a 2020 2020 2020 2020 2020  ones).          
-000097b0: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-000097c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097d0: 2023 2053 7465 7020 323a 2043 616c 6375   # Step 2: Calcu
-000097e0: 6c61 7465 2064 6973 7461 6c20 6c69 6e65  late distal line
-000097f0: 7320 666f 7220 6465 6d61 6e64 207a 6f6e  s for demand zon
-00009800: 6573 2061 6e64 2073 7570 706c 7920 7a6f  es and supply zo
-00009810: 6e65 730a 2020 2020 2320 2020 2020 2020  nes.    #       
-00009820: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
-00009830: 5f64 6973 7461 6c5f 6c69 6e65 7320 3d20  _distal_lines = 
-00009840: 7365 6c66 2e63 616c 6375 6c61 7465 5f64  self.calculate_d
-00009850: 656d 616e 645f 6469 7374 616c 5f6c 696e  emand_distal_lin
-00009860: 6573 2864 6174 612c 2064 656d 616e 645f  es(data, demand_
-00009870: 7a6f 6e65 7329 0a20 2020 2023 2020 2020  zones).    #    
-00009880: 2020 2020 2020 2020 2020 2020 2073 7570               sup
-00009890: 706c 795f 6469 7374 616c 5f6c 696e 6573  ply_distal_lines
-000098a0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-000098b0: 655f 7375 7070 6c79 5f64 6973 7461 6c5f  e_supply_distal_
-000098c0: 6c69 6e65 7328 6461 7461 2c20 7375 7070  lines(data, supp
-000098d0: 6c79 5f7a 6f6e 6573 290a 0a20 2020 2023  ly_zones)..    #
-000098e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098f0: 2023 2043 616c 6375 6c61 7465 2072 616e   # Calculate ran
-00009900: 6765 206f 6620 6465 6d61 6e64 2061 6e64  ge of demand and
-00009910: 2073 7570 706c 7920 7a6f 6e65 730a 2020   supply zones.  
-00009920: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009930: 2020 2020 6465 6d61 6e64 5f7a 6f6e 655f      demand_zone_
-00009940: 7261 6e67 6573 203d 2073 656c 662e 6361  ranges = self.ca
-00009950: 6c63 756c 6174 655f 6465 6d61 6e64 5f7a  lculate_demand_z
-00009960: 6f6e 655f 7261 6e67 6573 2864 656d 616e  one_ranges(deman
-00009970: 645f 7a6f 6e65 732c 2064 656d 616e 645f  d_zones, demand_
-00009980: 7072 6f78 696d 616c 5f6c 696e 6573 2c20  proximal_lines, 
-00009990: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-000099a0: 6e65 7329 0a20 2020 2023 2020 2020 2020  nes).    #      
-000099b0: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-000099c0: 795f 7a6f 6e65 5f72 616e 6765 7320 3d20  y_zone_ranges = 
-000099d0: 7365 6c66 2e63 616c 6375 6c61 7465 5f73  self.calculate_s
-000099e0: 7570 706c 795f 7a6f 6e65 5f72 616e 6765  upply_zone_range
-000099f0: 7328 7375 7070 6c79 5f7a 6f6e 6573 2c20  s(supply_zones, 
-00009a00: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
-00009a10: 6c69 6e65 732c 2073 7570 706c 795f 6469  lines, supply_di
-00009a20: 7374 616c 5f6c 696e 6573 290a 2020 2020  stal_lines).    
-00009a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a40: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009a50: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-00009a60: 6528 6622 5c6e 5c6e 416e 616c 7973 6973  e(f"\n\nAnalysis
-00009a70: 2066 6f72 207b 7379 6d62 6f6c 7d20 287b   for {symbol} ({
-00009a80: 7469 6d65 6672 616d 657d 293a 2229 0a20  timeframe}):"). 
-00009a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009aa0: 2020 200a 2020 2020 2320 2020 2020 2020     .    #       
-00009ab0: 2020 2020 2020 2020 2020 2320 4465 6d61            # Dema
-00009ac0: 6e64 205a 6f6e 6573 0a20 2020 2023 2020  nd Zones.    #  
-00009ad0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009ae0: 696c 652e 7772 6974 6528 225c 6e5c 6e44  ile.write("\n\nD
-00009af0: 656d 616e 6420 5a6f 6e65 733a 2229 0a20  emand Zones:"). 
-00009b00: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009b10: 2020 2020 2069 6620 6465 6d61 6e64 5f7a       if demand_z
-00009b20: 6f6e 6573 3a20 2023 2043 6865 636b 2069  ones:  # Check i
-00009b30: 6620 6465 6d61 6e64 5f7a 6f6e 6573 2069  f demand_zones i
-00009b40: 7320 6e6f 7420 656d 7074 790a 2020 2020  s not empty.    
-00009b50: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009b60: 2020 2020 2020 666f 7220 692c 2028 7374        for i, (st
-00009b70: 6172 742c 2065 6e64 2c20 7061 7474 6572  art, end, patter
-00009b80: 6e2c 2062 6173 655f 636f 756e 7429 2069  n, base_count) i
-00009b90: 6e20 656e 756d 6572 6174 6528 6465 6d61  n enumerate(dema
-00009ba0: 6e64 5f7a 6f6e 6573 293a 0a20 2020 2023  nd_zones):.    #
-00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bc0: 2020 2020 2020 2020 2064 6973 745f 6672           dist_fr
-00009bd0: 6f6d 5f63 6d70 203d 2061 6273 2828 636d  om_cmp = abs((cm
-00009be0: 7020 2d20 6465 6d61 6e64 5f70 726f 7869  p - demand_proxi
-00009bf0: 6d61 6c5f 6c69 6e65 735b 695d 2920 2f20  mal_lines[i]) / 
-00009c00: 636d 7029 202a 2031 3030 0a20 2020 2023  cmp) * 100.    #
-00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c20: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-00009c30: 6974 6528 6622 5c6e 5c6e 5a6f 6e65 207b  ite(f"\n\nZone {
-00009c40: 692b 317d 3a20 5374 6172 7420 4461 7465  i+1}: Start Date
-00009c50: 3a20 7b64 6174 612e 696e 6465 785b 7374  : {data.index[st
-00009c60: 6172 745d 2e64 6174 6528 297d 2c20 456e  art].date()}, En
-00009c70: 6420 4461 7465 3a20 7b64 6174 612e 696e  d Date: {data.in
-00009c80: 6465 785b 656e 645d 2e64 6174 6528 297d  dex[end].date()}
-00009c90: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cb0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-00009cc0: 5061 7474 6572 6e20 4e61 6d65 3a20 7b70  Pattern Name: {p
-00009cd0: 6174 7465 726e 7d2c 204e 756d 6265 7220  attern}, Number 
-00009ce0: 6f66 2042 6173 6520 4361 6e64 6c65 3a20  of Base Candle: 
-00009cf0: 7b62 6173 655f 636f 756e 747d 2229 0a20  {base_count}"). 
-00009d00: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009d10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00009d20: 652e 7772 6974 6528 6622 5c6e 4469 7374  e.write(f"\nDist
-00009d30: 616e 6365 2066 726f 6d20 434d 503a 207b  ance from CMP: {
-00009d40: 6469 7374 5f66 726f 6d5f 636d 703a 2e32  dist_from_cmp:.2
-00009d50: 667d 2522 290a 2020 2020 2320 2020 2020  f}%").    #     
-00009d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d70: 2020 2020 6966 2064 656d 616e 645f 7072      if demand_pr
-00009d80: 6f78 696d 616c 5f6c 696e 6573 3a0a 2020  oximal_lines:.  
-00009d90: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009db0: 6669 6c65 2e77 7269 7465 2866 225c 6e50  file.write(f"\nP
-00009dc0: 726f 7869 6d61 6c20 4c69 6e65 2050 7269  roximal Line Pri
-00009dd0: 6365 3a20 7b64 656d 616e 645f 7072 6f78  ce: {demand_prox
-00009de0: 696d 616c 5f6c 696e 6573 5b69 5d3a 2e32  imal_lines[i]:.2
-00009df0: 667d 2229 0a20 2020 2023 2020 2020 2020  f}").    #      
-00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e10: 2020 2069 6620 6465 6d61 6e64 5f64 6973     if demand_dis
-00009e20: 7461 6c5f 6c69 6e65 733a 2020 2320 496e  tal_lines:  # In
-00009e30: 636c 7564 6520 6469 7374 616c 206c 696e  clude distal lin
-00009e40: 6520 7072 6963 6520 6966 2061 7661 696c  e price if avail
-00009e50: 6162 6c65 0a20 2020 2023 2020 2020 2020  able.    #      
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-00009e80: 6528 6622 5c6e 4469 7374 616c 204c 696e  e(f"\nDistal Lin
-00009e90: 6520 5072 6963 653a 207b 6465 6d61 6e64  e Price: {demand
-00009ea0: 5f64 6973 7461 6c5f 6c69 6e65 735b 695d  _distal_lines[i]
-00009eb0: 3a2e 3266 7d22 290a 2020 2020 2320 2020  :.2f}").    #   
-00009ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ed0: 2020 2020 2020 2320 496e 636c 7564 6520        # Include 
-00009ee0: 7a6f 6e65 2072 616e 6765 0a20 2020 2023  zone range.    #
-00009ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f00: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00009f10: 652e 7772 6974 6528 6622 5c6e 5a6f 6e65  e.write(f"\nZone
-00009f20: 2052 616e 6765 3a20 7b64 656d 616e 645f   Range: {demand_
-00009f30: 7a6f 6e65 5f72 616e 6765 735b 695d 3a2e  zone_ranges[i]:.
-00009f40: 3266 7d22 2920 2020 2020 2020 0a20 2020  2f}")       .   
-00009f50: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009f60: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00009f70: 636b 2069 6620 7072 6f78 696d 616c 206c  ck if proximal l
-00009f80: 696e 6520 6973 2074 6573 7465 640a 2020  ine is tested.  
-00009f90: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009fa0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00009fb0: 6564 203d 2073 656c 662e 6973 5f7a 6f6e  ed = self.is_zon
-00009fc0: 655f 7465 7374 6564 2864 6174 612c 2073  e_tested(data, s
-00009fd0: 7461 7274 2c20 656e 642c 2064 656d 616e  tart, end, deman
-00009fe0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-00009ff0: 5b69 5d29 0a20 2020 2023 2020 2020 2020  [i]).    #      
-0000a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a010: 2020 2069 6620 7465 7374 6564 3a0a 2020     if tested:.  
-0000a020: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a040: 6669 6c65 2e77 7269 7465 2822 5c6e 5a6f  file.write("\nZo
-0000a050: 6e65 2069 7320 5465 7374 6564 2229 0a20  ne is Tested"). 
-0000a060: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000a070: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000a080: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
-0000a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0a0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-0000a0b0: 225c 6e46 7265 7368 205a 6f6e 6522 290a  "\nFresh Zone").
-0000a0c0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a0d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a0e0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000a0f0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-0000a100: 2822 5c6e 4e6f 2064 656d 616e 6420 7a6f  ("\nNo demand zo
-0000a110: 6e65 2070 6174 7465 726e 7320 666f 756e  ne patterns foun
-0000a120: 642e 2229 0a0a 2020 2020 2320 2020 2020  d.")..    #     
-0000a130: 2020 2020 2020 2020 2020 2020 2320 5375              # Su
-0000a140: 7070 6c79 205a 6f6e 6573 0a20 2020 2023  pply Zones.    #
-0000a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a160: 2066 696c 652e 7772 6974 6528 225c 6e5c   file.write("\n\
-0000a170: 6e53 7570 706c 7920 5a6f 6e65 733a 2229  nSupply Zones:")
-0000a180: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000a190: 2020 2020 2020 2069 6620 7375 7070 6c79         if supply
-0000a1a0: 5f7a 6f6e 6573 3a20 2023 2043 6865 636b  _zones:  # Check
-0000a1b0: 2069 6620 7375 7070 6c79 5f7a 6f6e 6573   if supply_zones
-0000a1c0: 2069 7320 6e6f 7420 656d 7074 790a 2020   is not empty.  
-0000a1d0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000a1e0: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
-0000a1f0: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
-0000a200: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
-0000a210: 2069 6e20 656e 756d 6572 6174 6528 7375   in enumerate(su
-0000a220: 7070 6c79 5f7a 6f6e 6573 293a 0a20 2020  pply_zones):.   
-0000a230: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a240: 2020 2020 2020 2020 2020 2064 6973 745f             dist_
-0000a250: 6672 6f6d 5f63 6d70 203d 2061 6273 2828  from_cmp = abs((
-0000a260: 636d 7020 2d20 7375 7070 6c79 5f70 726f  cmp - supply_pro
-0000a270: 7869 6d61 6c5f 6c69 6e65 735b 695d 2920  ximal_lines[i]) 
-0000a280: 2f20 636d 7029 202a 2031 3030 0a20 2020  / cmp) * 100.   
-0000a290: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a2a0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-0000a2b0: 7772 6974 6528 6622 5c6e 5c6e 5a6f 6e65  write(f"\n\nZone
-0000a2c0: 207b 692b 317d 3a20 5374 6172 7420 4461   {i+1}: Start Da
-0000a2d0: 7465 3a20 7b64 6174 612e 696e 6465 785b  te: {data.index[
-0000a2e0: 7374 6172 745d 2e64 6174 6528 297d 2c20  start].date()}, 
-0000a2f0: 456e 6420 4461 7465 3a20 7b64 6174 612e  End Date: {data.
-0000a300: 696e 6465 785b 656e 645d 2e64 6174 6528  index[end].date(
-0000a310: 297d 2229 0a20 2020 2023 2020 2020 2020  )}").    #      
-0000a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a330: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000a340: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
-0000a350: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
-0000a360: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
-0000a370: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
-0000a380: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a3a0: 696c 652e 7772 6974 6528 6622 5c6e 4469  ile.write(f"\nDi
-0000a3b0: 7374 616e 6365 2066 726f 6d20 434d 503a  stance from CMP:
-0000a3c0: 207b 6469 7374 5f66 726f 6d5f 636d 703a   {dist_from_cmp:
-0000a3d0: 2e32 667d 2522 290a 2020 2020 2320 2020  .2f}%").    #   
-0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3f0: 2020 2020 2020 6966 2073 7570 706c 795f        if supply_
-0000a400: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
-0000a410: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a430: 2020 6669 6c65 2e77 7269 7465 2866 225c    file.write(f"\
-0000a440: 6e50 726f 7869 6d61 6c20 4c69 6e65 2050  nProximal Line P
-0000a450: 7269 6365 3a20 7b73 7570 706c 795f 7072  rice: {supply_pr
-0000a460: 6f78 696d 616c 5f6c 696e 6573 5b69 5d3a  oximal_lines[i]:
-0000a470: 2e32 667d 2229 0a20 2020 2023 2020 2020  .2f}").    #    
-0000a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a490: 2020 2020 2069 6620 7375 7070 6c79 5f64       if supply_d
-0000a4a0: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
-0000a4b0: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
-0000a4c0: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
-0000a4d0: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000a500: 6974 6528 6622 5c6e 4469 7374 616c 204c  ite(f"\nDistal L
-0000a510: 696e 6520 5072 6963 653a 207b 7375 7070  ine Price: {supp
-0000a520: 6c79 5f64 6973 7461 6c5f 6c69 6e65 735b  ly_distal_lines[
-0000a530: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a550: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
-0000a560: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
-0000a570: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a590: 696c 652e 7772 6974 6528 6622 5c6e 5a6f  ile.write(f"\nZo
-0000a5a0: 6e65 2052 616e 6765 3a20 7b73 7570 706c  ne Range: {suppl
-0000a5b0: 795f 7a6f 6e65 5f72 616e 6765 735b 695d  y_zone_ranges[i]
-0000a5c0: 3a2e 3266 7d22 290a 2020 2020 2320 2020  :.2f}").    #   
-0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0000a5f0: 2070 726f 7869 6d61 6c20 6c69 6e65 2069   proximal line i
-0000a600: 7320 7465 7374 6564 0a20 2020 2023 2020  s tested.    #  
-0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a620: 2020 2020 2020 2074 6573 7465 6420 3d20         tested = 
-0000a630: 6973 5f7a 6f6e 655f 7465 7374 6564 2864  is_zone_tested(d
-0000a640: 6174 612c 2073 7461 7274 2c20 656e 642c  ata, start, end,
-0000a650: 2073 7570 706c 795f 7072 6f78 696d 616c   supply_proximal
-0000a660: 5f6c 696e 6573 5b69 5d29 0a20 2020 2023  _lines[i]).    #
-0000a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a680: 2020 2020 2020 2020 2069 6620 7465 7374           if test
-0000a690: 6564 3a0a 2020 2020 2320 2020 2020 2020  ed:.    #       
-0000a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6b0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-0000a6c0: 2822 5c6e 5a6f 6e65 2069 7320 5465 7374  ("\nZone is Test
-0000a6d0: 6564 2229 0a20 2020 2023 2020 2020 2020  ed").    #      
-0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6f0: 2020 2065 6c73 653a 0a20 2020 2023 2020     else:.    #  
-0000a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a710: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-0000a720: 7772 6974 6528 225c 6e46 7265 7368 205a  write("\nFresh Z
-0000a730: 6f6e 6522 290a 2020 2020 2320 2020 2020  one").    #     
-0000a740: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000a750: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-0000a760: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000a770: 2e77 7269 7465 2822 5c6e 4e6f 2073 7570  .write("\nNo sup
-0000a780: 706c 7920 7a6f 6e65 2070 6174 7465 726e  ply zone pattern
-0000a790: 7320 666f 756e 642e 2229 0a0a 2020 2020  s found.")..    
-0000a7a0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000a7b0: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
-0000a7c0: 2073 746f 636b 2068 6173 2065 6974 6865   stock has eithe
-0000a7d0: 7220 6465 6d61 6e64 206f 7220 7375 7070  r demand or supp
-0000a7e0: 6c79 207a 6f6e 6520 7769 7468 696e 2074  ly zone within t
-0000a7f0: 6865 2074 6872 6573 686f 6c64 0a20 2020  he threshold.   
-0000a800: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a810: 2020 2068 6173 5f64 656d 616e 645f 6f72     has_demand_or
-0000a820: 5f73 7570 706c 795f 7769 7468 696e 5f74  _supply_within_t
-0000a830: 6872 6573 686f 6c64 203d 2061 6e79 280a  hreshold = any(.
-0000a840: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a850: 2020 2020 2020 2020 2020 6162 7328 2863            abs((c
-0000a860: 6d70 202d 2070 7269 6365 2920 2f20 636d  mp - price) / cm
-0000a870: 7029 202a 2031 3030 203c 3d20 7468 7265  p) * 100 <= thre
-0000a880: 7368 6f6c 645f 7065 7263 656e 740a 2020  shold_percent.  
-0000a890: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000a8a0: 2020 2020 2020 2020 666f 7220 7072 6963          for pric
-0000a8b0: 6520 696e 2064 656d 616e 645f 7072 6f78  e in demand_prox
-0000a8c0: 696d 616c 5f6c 696e 6573 202b 2073 7570  imal_lines + sup
-0000a8d0: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
-0000a8e0: 6573 0a20 2020 2023 2020 2020 2020 2020  es.    #        
-0000a8f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000a900: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+000068b0: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
+000068c0: 6f72 206f 6e65 206d 6f72 6520 7261 6c6c  or one more rall
+000068d0: 7920 6361 6e64 6c65 206f 7220 6772 6565  y candle or gree
+000068e0: 6e20 6261 7365 2063 616e 646c 650a 2020  n base candle.  
+000068f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006900: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00006910: 6a20 2b20 310a 2020 2020 2320 2020 2020  j + 1.    #     
+00006920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006930: 2020 2020 7768 696c 6520 6b20 3c20 6c65      while k < le
+00006940: 6e28 6461 7461 293a 0a20 2020 2023 2020  n(data):.    #  
+00006950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006960: 2020 2020 2020 2020 2020 2069 6620 6461             if da
+00006970: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00006980: 5d5b 6b5d 203d 3d20 2752 616c 6c79 2043  ][k] == 'Rally C
+00006990: 616e 646c 6527 206f 7220 2864 6174 615b  andle' or (data[
+000069a0: 2743 616e 646c 6520 5479 7065 275d 5b6b  'Candle Type'][k
+000069b0: 5d20 3d3d 2027 4261 7365 2043 616e 646c  ] == 'Base Candl
+000069c0: 6527 2061 6e64 2064 6174 615b 2743 6c6f  e' and data['Clo
+000069d0: 7365 275d 5b6b 5d20 3e20 6461 7461 5b27  se'][k] > data['
+000069e0: 4f70 656e 275d 5b6b 5d29 3a0a 2020 2020  Open'][k]):.    
+000069f0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00006a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a10: 2020 6465 6d61 6e64 5f7a 6f6e 6573 2e61    demand_zones.a
+00006a20: 7070 656e 6428 2869 2c20 6a2c 2027 5261  ppend((i, j, 'Ra
+00006a30: 6c6c 7920 4261 7365 2052 616c 6c79 272c  lly Base Rally',
+00006a40: 2062 6173 655f 636f 756e 7429 290a 2020   base_count)).  
+00006a50: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a70: 2020 2020 7261 6c6c 795f 6261 7365 5f72      rally_base_r
+00006a80: 616c 6c79 5f7a 6f6e 6520 3d20 5472 7565  ally_zone = True
+00006a90: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ab0: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00006ac0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00006ad0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00006ae0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00006af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b00: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
+00006b10: 2023 2043 6f6c 6c65 6374 2062 6173 6520   # Collect base 
+00006b20: 6361 6e64 6c65 2070 7269 6365 7320 666f  candle prices fo
+00006b30: 7220 7072 6f78 696d 616c 206c 696e 6520  r proximal line 
+00006b40: 6361 6c63 756c 6174 696f 6e0a 2020 2020  calculation.    
+00006b50: 2320 2020 2020 2020 2020 6966 2064 6174  #         if dat
+00006b60: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
+00006b70: 5b69 5d20 3d3d 2027 4261 7365 2043 616e  [i] == 'Base Can
+00006b80: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
+00006b90: 2020 2020 2020 2020 6261 7365 5f63 616e          base_can
+00006ba0: 646c 655f 7072 6963 6573 2e61 7070 656e  dle_prices.appen
+00006bb0: 6428 6461 7461 5b27 436c 6f73 6527 5d5b  d(data['Close'][
+00006bc0: 695d 290a 0a20 2020 2023 2020 2020 2023  i])..    #     #
+00006bd0: 2043 616c 6375 6c61 7465 2070 726f 7869   Calculate proxi
+00006be0: 6d61 6c20 6c69 6e65 2070 7269 6365 2028  mal line price (
+00006bf0: 6869 6768 6573 7420 7072 6963 6520 616d  highest price am
+00006c00: 6f6e 6720 6261 7365 2063 616e 646c 6573  ong base candles
+00006c10: 290a 2020 2020 2320 2020 2020 7072 6f78  ).    #     prox
+00006c20: 696d 616c 5f6c 696e 655f 7072 6963 6520  imal_line_price 
+00006c30: 3d20 6d61 7828 6261 7365 5f63 616e 646c  = max(base_candl
+00006c40: 655f 7072 6963 6573 2920 6966 2062 6173  e_prices) if bas
+00006c50: 655f 6361 6e64 6c65 5f70 7269 6365 7320  e_candle_prices 
+00006c60: 656c 7365 204e 6f6e 650a 0a20 2020 2023  else None..    #
+00006c70: 2020 2020 2072 6574 7572 6e20 6465 6d61       return dema
+00006c80: 6e64 5f7a 6f6e 6573 2c20 6472 6f70 5f62  nd_zones, drop_b
+00006c90: 6173 655f 7261 6c6c 795f 7a6f 6e65 2c20  ase_rally_zone, 
+00006ca0: 7261 6c6c 795f 6261 7365 5f72 616c 6c79  rally_base_rally
+00006cb0: 5f7a 6f6e 652c 2070 726f 7869 6d61 6c5f  _zone, proximal_
+00006cc0: 6c69 6e65 5f70 7269 6365 0a0a 2020 2020  line_price..    
+00006cd0: 2320 6465 6620 6964 656e 7469 6679 5f73  # def identify_s
+00006ce0: 7570 706c 795f 7a6f 6e65 2873 656c 662c  upply_zone(self,
+00006cf0: 6461 7461 2c20 636d 7029 3a0a 2020 2020  data, cmp):.    
+00006d00: 2320 2020 2020 7375 7070 6c79 5f7a 6f6e  #     supply_zon
+00006d10: 6573 203d 205b 5d0a 2020 2020 2320 2020  es = [].    #   
+00006d20: 2020 7261 6c6c 795f 6261 7365 5f64 726f    rally_base_dro
+00006d30: 705f 7a6f 6e65 203d 2046 616c 7365 0a20  p_zone = False. 
+00006d40: 2020 2023 2020 2020 2064 726f 705f 6261     #     drop_ba
+00006d50: 7365 5f64 726f 705f 7a6f 6e65 203d 2046  se_drop_zone = F
+00006d60: 616c 7365 0a20 2020 2020 2020 200a 2020  alse.        .  
+00006d70: 2020 2320 2020 2020 2320 4164 6469 7469    #     # Additi
+00006d80: 6f6e 616c 2076 6172 6961 626c 6573 2074  onal variables t
+00006d90: 6f20 7472 6163 6b20 6261 7365 2063 616e  o track base can
+00006da0: 646c 6520 7072 6963 6573 2066 6f72 2070  dle prices for p
+00006db0: 726f 7869 6d61 6c20 6c69 6e65 2063 616c  roximal line cal
+00006dc0: 6375 6c61 7469 6f6e 0a20 2020 2023 2020  culation.    #  
+00006dd0: 2020 2062 6173 655f 6361 6e64 6c65 5f70     base_candle_p
+00006de0: 7269 6365 7320 3d20 5b5d 0a20 2020 2020  rices = [].     
+00006df0: 2020 200a 2020 2020 2320 2020 2020 666f     .    #     fo
+00006e00: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+00006e10: 2864 6174 6129 202d 2032 293a 0a20 2020  (data) - 2):.   
+00006e20: 2023 2020 2020 2020 2020 2069 6620 6461   #         if da
+00006e30: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00006e40: 5d5b 695d 203d 3d20 2744 726f 7020 4361  ][i] == 'Drop Ca
+00006e50: 6e64 6c65 2720 616e 6420 6461 7461 5b27  ndle' and data['
+00006e60: 4361 6e64 6c65 2054 7970 6527 5d5b 6920  Candle Type'][i 
+00006e70: 2b20 315d 203d 3d20 2742 6173 6520 4361  + 1] == 'Base Ca
+00006e80: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
+00006e90: 2020 2020 2020 2020 2062 6173 655f 636f           base_co
+00006ea0: 756e 7420 3d20 310a 2020 2020 2320 2020  unt = 1.    #   
+00006eb0: 2020 2020 2020 2020 2020 6a20 3d20 6920            j = i 
+00006ec0: 2b20 320a 2020 2020 2320 2020 2020 2020  + 2.    #       
+00006ed0: 2020 2020 2020 7768 696c 6520 6a20 3c20        while j < 
+00006ee0: 6c65 6e28 6461 7461 2920 616e 6420 6461  len(data) and da
+00006ef0: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00006f00: 5d5b 6a5d 203d 3d20 2742 6173 6520 4361  ][j] == 'Base Ca
+00006f10: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
+00006f20: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+00006f30: 655f 636f 756e 7420 2b3d 2031 0a20 2020  e_count += 1.   
+00006f40: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00006f50: 2020 206a 202b 3d20 310a 2020 2020 2020     j += 1.      
+00006f60: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
+00006f70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00006f80: 6261 7365 5f63 6f75 6e74 203c 3d20 343a  base_count <= 4:
+00006f90: 2020 2320 4d61 7869 6d75 6d20 6f66 2034    # Maximum of 4
+00006fa0: 2062 6173 6520 6361 6e64 6c65 7320 666f   base candles fo
+00006fb0: 7220 7765 656b 6c79 206f 7220 6d6f 6e74  r weekly or mont
+00006fc0: 686c 7920 7469 6d65 6672 616d 652c 2065  hly timeframe, e
+00006fd0: 6c73 6520 3320 666f 7220 6461 696c 790a  lse 3 for daily.
+00006fe0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00006ff0: 2020 2020 2020 6966 206a 203c 206c 656e        if j < len
+00007000: 2864 6174 6129 2061 6e64 2064 6174 615b  (data) and data[
+00007010: 2743 616e 646c 6520 5479 7065 275d 5b6a  'Candle Type'][j
+00007020: 5d20 3d3d 2027 4472 6f70 2043 616e 646c  ] == 'Drop Candl
+00007030: 6527 3a0a 2020 2020 2320 2020 2020 2020  e':.    #       
+00007040: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00007050: 2064 6174 615b 2743 6c6f 7365 275d 5b69   data['Close'][i
+00007060: 5d20 3c20 6461 7461 5b27 4c6f 7727 5d5b  ] < data['Low'][
+00007070: 6a5d 2061 6e64 2064 6174 615b 274c 6f77  j] and data['Low
+00007080: 275d 5b69 5d20 3e3d 2063 6d70 3a20 2023  '][i] >= cmp:  #
+00007090: 204e 6577 2063 6f6e 6469 7469 6f6e 3a20   New condition: 
+000070a0: 636c 6f73 6520 6f66 2064 726f 7020 6361  close of drop ca
+000070b0: 6e64 6c65 203c 206c 6f77 206f 6620 6261  ndle < low of ba
+000070c0: 7365 2063 616e 646c 650a 2020 2020 2320  se candle.    # 
+000070d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000070e0: 2020 2020 2020 2020 2320 4e65 7720 6c6f          # New lo
+000070f0: 6769 633a 204c 6f6f 6b20 666f 7220 6f6e  gic: Look for on
+00007100: 6520 6d6f 7265 2064 726f 7020 6361 6e64  e more drop cand
+00007110: 6c65 206f 7220 7265 6420 6261 7365 2063  le or red base c
+00007120: 616e 646c 650a 2020 2020 2320 2020 2020  andle.    #     
+00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007140: 2020 2020 6b20 3d20 6a20 2b20 310a 2020      k = j + 1.  
+00007150: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00007160: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00007170: 6520 6b20 3c20 6c65 6e28 6461 7461 2920  e k < len(data) 
+00007180: 616e 6420 2864 6174 615b 2743 616e 646c  and (data['Candl
+00007190: 6520 5479 7065 275d 5b6b 5d20 3d3d 2027  e Type'][k] == '
+000071a0: 4472 6f70 2043 616e 646c 6527 206f 7220  Drop Candle' or 
+000071b0: 6461 7461 5b27 436c 6f73 6527 5d5b 6b5d  data['Close'][k]
+000071c0: 203c 2064 6174 615b 274f 7065 6e27 5d5b   < data['Open'][
+000071d0: 6b5d 293a 0a20 2020 2023 2020 2020 2020  k]):.    #      
+000071e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071f0: 2020 2020 2020 206b 202b 3d20 310a 2020         k += 1.  
+00007200: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00007210: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00007220: 203c 206c 656e 2864 6174 6129 2061 6e64   < len(data) and
+00007230: 2028 6461 7461 5b27 4361 6e64 6c65 2054   (data['Candle T
+00007240: 7970 6527 5d5b 6b5d 203d 3d20 2744 726f  ype'][k] == 'Dro
+00007250: 7020 4361 6e64 6c65 2720 6f72 2064 6174  p Candle' or dat
+00007260: 615b 2743 6c6f 7365 275d 5b6b 5d20 3c20  a['Close'][k] < 
+00007270: 6461 7461 5b27 4f70 656e 275d 5b6b 5d29  data['Open'][k])
+00007280: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+00007290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072a0: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
+000072b0: 2e61 7070 656e 6428 2869 2c20 6a2c 2027  .append((i, j, '
+000072c0: 4472 6f70 2042 6173 6520 4472 6f70 272c  Drop Base Drop',
+000072d0: 2062 6173 655f 636f 756e 7429 290a 2020   base_count)).  
+000072e0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007300: 6472 6f70 5f62 6173 655f 6472 6f70 5f7a  drop_base_drop_z
+00007310: 6f6e 6520 3d20 5472 7565 0a20 2020 2023  one = True.    #
+00007320: 2020 2020 2020 2020 2065 6c69 6620 6461           elif da
+00007330: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00007340: 5d5b 695d 203d 3d20 2752 616c 6c79 2043  ][i] == 'Rally C
+00007350: 616e 646c 6527 2061 6e64 2064 6174 615b  andle' and data[
+00007360: 2743 616e 646c 6520 5479 7065 275d 5b69  'Candle Type'][i
+00007370: 202b 2031 5d20 3d3d 2027 4261 7365 2043   + 1] == 'Base C
+00007380: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+00007390: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
+000073a0: 6f75 6e74 203d 2031 0a20 2020 2023 2020  ount = 1.    #  
+000073b0: 2020 2020 2020 2020 2020 206a 203d 2069             j = i
+000073c0: 202b 2032 0a20 2020 2023 2020 2020 2020   + 2.    #      
+000073d0: 2020 2020 2020 2077 6869 6c65 206a 203c         while j <
+000073e0: 206c 656e 2864 6174 6129 2061 6e64 2064   len(data) and d
+000073f0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+00007400: 275d 5b6a 5d20 3d3d 2027 4261 7365 2043  '][j] == 'Base C
+00007410: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+00007420: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+00007430: 7365 5f63 6f75 6e74 202b 3d20 310a 2020  se_count += 1.  
+00007440: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00007450: 2020 2020 6a20 2b3d 2031 0a20 2020 2020      j += 1.     
+00007460: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00007470: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+00007480: 2062 6173 655f 636f 756e 7420 3e3d 2031   base_count >= 1
+00007490: 3a20 2023 2041 7420 6c65 6173 7420 6f6e  :  # At least on
+000074a0: 6520 6261 7365 2063 616e 646c 6520 7265  e base candle re
+000074b0: 7175 6972 6564 0a20 2020 2023 2020 2020  quired.    #    
+000074c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000074d0: 6a20 3c20 6c65 6e28 6461 7461 2920 616e  j < len(data) an
+000074e0: 6420 6461 7461 5b27 4361 6e64 6c65 2054  d data['Candle T
+000074f0: 7970 6527 5d5b 6a5d 203d 3d20 2744 726f  ype'][j] == 'Dro
+00007500: 7020 4361 6e64 6c65 273a 0a20 2020 2023  p Candle':.    #
+00007510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007520: 2020 2020 2069 6620 6461 7461 5b27 436c       if data['Cl
+00007530: 6f73 6527 5d5b 6a5d 203c 2064 6174 615b  ose'][j] < data[
+00007540: 274f 7065 6e27 5d5b 6a5d 2061 6e64 2064  'Open'][j] and d
+00007550: 6174 615b 274c 6f77 275d 5b69 5d20 3e3d  ata['Low'][i] >=
+00007560: 2063 6d70 3a20 2023 204d 6f64 6966 6965   cmp:  # Modifie
+00007570: 6420 636f 6e64 6974 696f 6e3a 2063 6c6f  d condition: clo
+00007580: 7365 206f 6620 6472 6f70 2063 616e 646c  se of drop candl
+00007590: 6520 3c20 6f70 656e 206f 6620 6472 6f70  e < open of drop
+000075a0: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
+000075b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075c0: 2020 2020 2020 7375 7070 6c79 5f7a 6f6e        supply_zon
+000075d0: 6573 2e61 7070 656e 6428 2869 2c20 6a2c  es.append((i, j,
+000075e0: 2027 5261 6c6c 7920 4261 7365 2044 726f   'Rally Base Dro
+000075f0: 7027 2c20 6261 7365 5f63 6f75 6e74 2929  p', base_count))
+00007600: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00007610: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00007620: 616c 6c79 5f62 6173 655f 6472 6f70 5f7a  ally_base_drop_z
+00007630: 6f6e 6520 3d20 5472 7565 0a20 2020 2020  one = True.     
+00007640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007650: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+00007660: 2020 2020 2020 2320 436f 6c6c 6563 7420        # Collect 
+00007670: 6261 7365 2063 616e 646c 6520 7072 6963  base candle pric
+00007680: 6573 2066 6f72 2070 726f 7869 6d61 6c20  es for proximal 
+00007690: 6c69 6e65 2063 616c 6375 6c61 7469 6f6e  line calculation
+000076a0: 0a20 2020 2023 2020 2020 2020 2020 2069  .    #         i
+000076b0: 6620 6461 7461 5b27 4361 6e64 6c65 2054  f data['Candle T
+000076c0: 7970 6527 5d5b 695d 203d 3d20 2742 6173  ype'][i] == 'Bas
+000076d0: 6520 4361 6e64 6c65 273a 0a20 2020 2023  e Candle':.    #
+000076e0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+000076f0: 655f 6361 6e64 6c65 5f70 7269 6365 732e  e_candle_prices.
+00007700: 6170 7065 6e64 2864 6174 615b 2743 6c6f  append(data['Clo
+00007710: 7365 275d 5b69 5d29 0a0a 2020 2020 2320  se'][i])..    # 
+00007720: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+00007730: 7072 6f78 696d 616c 206c 696e 6520 7072  proximal line pr
+00007740: 6963 6520 286c 6f77 6573 7420 7072 6963  ice (lowest pric
+00007750: 6520 616d 6f6e 6720 6261 7365 2063 616e  e among base can
+00007760: 646c 6573 290a 2020 2020 2320 2020 2020  dles).    #     
+00007770: 7072 6f78 696d 616c 5f6c 696e 655f 7072  proximal_line_pr
+00007780: 6963 6520 3d20 6d69 6e28 6261 7365 5f63  ice = min(base_c
+00007790: 616e 646c 655f 7072 6963 6573 2920 6966  andle_prices) if
+000077a0: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
+000077b0: 6365 7320 656c 7365 204e 6f6e 650a 0a20  ces else None.. 
+000077c0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+000077d0: 7375 7070 6c79 5f7a 6f6e 6573 2c20 7261  supply_zones, ra
+000077e0: 6c6c 795f 6261 7365 5f64 726f 705f 7a6f  lly_base_drop_zo
+000077f0: 6e65 2c20 6472 6f70 5f62 6173 655f 6472  ne, drop_base_dr
+00007800: 6f70 5f7a 6f6e 652c 2070 726f 7869 6d61  op_zone, proxima
+00007810: 6c5f 6c69 6e65 5f70 7269 6365 0a0a 2020  l_line_price..  
+00007820: 2020 2320 6465 6620 6361 6c63 756c 6174    # def calculat
+00007830: 655f 6465 6d61 6e64 5f70 726f 7869 6d61  e_demand_proxima
+00007840: 6c5f 6c69 6e65 7328 7365 6c66 2c64 6174  l_lines(self,dat
+00007850: 612c 2064 656d 616e 645f 7a6f 6e65 7329  a, demand_zones)
+00007860: 3a0a 2020 2020 2320 2020 2020 7072 6f78  :.    #     prox
+00007870: 696d 616c 5f6c 696e 655f 7072 6963 6573  imal_line_prices
+00007880: 203d 205b 5d0a 2020 2020 2320 2020 2020   = [].    #     
+00007890: 666f 7220 7374 6172 742c 2065 6e64 2c20  for start, end, 
+000078a0: 5f2c 205f 2069 6e20 6465 6d61 6e64 5f7a  _, _ in demand_z
+000078b0: 6f6e 6573 3a0a 2020 2020 2320 2020 2020  ones:.    #     
+000078c0: 2020 2020 6261 7365 5f63 616e 646c 655f      base_candle_
+000078d0: 7072 6963 6573 203d 2064 6174 612e 6c6f  prices = data.lo
+000078e0: 635b 2864 6174 615b 2743 616e 646c 6520  c[(data['Candle 
+000078f0: 5479 7065 275d 203d 3d20 2742 6173 6520  Type'] == 'Base 
+00007900: 4361 6e64 6c65 2729 2026 2028 6461 7461  Candle') & (data
+00007910: 2e69 6e64 6578 203e 3d20 6461 7461 2e69  .index >= data.i
+00007920: 6e64 6578 5b73 7461 7274 5d29 2026 2028  ndex[start]) & (
+00007930: 6461 7461 2e69 6e64 6578 203c 3d20 6461  data.index <= da
+00007940: 7461 2e69 6e64 6578 5b65 6e64 5d29 2c20  ta.index[end]), 
+00007950: 5b27 4f70 656e 272c 2027 436c 6f73 6527  ['Open', 'Close'
+00007960: 5d5d 0a20 2020 2023 2020 2020 2020 2020  ]].    #        
+00007970: 206d 6178 5f70 7269 6365 203d 2062 6173   max_price = bas
+00007980: 655f 6361 6e64 6c65 5f70 7269 6365 732e  e_candle_prices.
+00007990: 6d61 7828 6178 6973 3d31 292e 6d61 7828  max(axis=1).max(
+000079a0: 2920 2023 2047 6574 2074 6865 206d 6178  )  # Get the max
+000079b0: 696d 756d 2070 7269 6365 2061 6d6f 6e67  imum price among
+000079c0: 2061 6c6c 2062 6173 6520 6361 6e64 6c65   all base candle
+000079d0: 7327 206f 7065 6e20 616e 6420 636c 6f73  s' open and clos
+000079e0: 6520 7072 6963 6573 0a20 2020 2023 2020  e prices.    #  
+000079f0: 2020 2020 2020 2070 726f 7869 6d61 6c5f         proximal_
+00007a00: 6c69 6e65 5f70 7269 6365 732e 6170 7065  line_prices.appe
+00007a10: 6e64 286d 6178 5f70 7269 6365 290a 2020  nd(max_price).  
+00007a20: 2020 2320 2020 2020 7265 7475 726e 2070    #     return p
+00007a30: 726f 7869 6d61 6c5f 6c69 6e65 5f70 7269  roximal_line_pri
+00007a40: 6365 730a 0a20 2020 2023 2064 6566 2063  ces..    # def c
+00007a50: 616c 6375 6c61 7465 5f73 7570 706c 795f  alculate_supply_
+00007a60: 7072 6f78 696d 616c 5f6c 696e 6573 2873  proximal_lines(s
+00007a70: 656c 662c 6461 7461 2c20 7375 7070 6c79  elf,data, supply
+00007a80: 5f7a 6f6e 6573 293a 0a20 2020 2023 2020  _zones):.    #  
+00007a90: 2020 2070 726f 7869 6d61 6c5f 6c69 6e65     proximal_line
+00007aa0: 5f70 7269 6365 7320 3d20 5b5d 0a20 2020  _prices = [].   
+00007ab0: 2023 2020 2020 2066 6f72 2073 7461 7274   #     for start
+00007ac0: 2c20 656e 642c 205f 2c20 5f20 696e 2073  , end, _, _ in s
+00007ad0: 7570 706c 795f 7a6f 6e65 733a 0a20 2020  upply_zones:.   
+00007ae0: 2023 2020 2020 2020 2020 2062 6173 655f   #         base_
+00007af0: 6361 6e64 6c65 5f70 7269 6365 7320 3d20  candle_prices = 
+00007b00: 6461 7461 2e6c 6f63 5b28 6461 7461 5b27  data.loc[(data['
+00007b10: 4361 6e64 6c65 2054 7970 6527 5d20 3d3d  Candle Type'] ==
+00007b20: 2027 4261 7365 2043 616e 646c 6527 2920   'Base Candle') 
+00007b30: 2620 2864 6174 612e 696e 6465 7820 3e3d  & (data.index >=
+00007b40: 2064 6174 612e 696e 6465 785b 7374 6172   data.index[star
+00007b50: 745d 2920 2620 2864 6174 612e 696e 6465  t]) & (data.inde
+00007b60: 7820 3c3d 2064 6174 612e 696e 6465 785b  x <= data.index[
+00007b70: 656e 645d 292c 205b 274f 7065 6e27 2c20  end]), ['Open', 
+00007b80: 2743 6c6f 7365 275d 5d0a 2020 2020 2320  'Close']].    # 
+00007b90: 2020 2020 2020 2020 6d69 6e5f 7072 6963          min_pric
+00007ba0: 6520 3d20 6261 7365 5f63 616e 646c 655f  e = base_candle_
+00007bb0: 7072 6963 6573 2e6d 696e 2861 7869 733d  prices.min(axis=
+00007bc0: 3129 2e6d 696e 2829 2020 2320 4765 7420  1).min()  # Get 
+00007bd0: 7468 6520 6d69 6e69 6d75 6d20 7072 6963  the minimum pric
+00007be0: 6520 616d 6f6e 6720 616c 6c20 6261 7365  e among all base
+00007bf0: 2063 616e 646c 6573 2720 6f70 656e 2061   candles' open a
+00007c00: 6e64 2063 6c6f 7365 2070 7269 6365 730a  nd close prices.
+00007c10: 2020 2020 2320 2020 2020 2020 2020 7072      #         pr
+00007c20: 6f78 696d 616c 5f6c 696e 655f 7072 6963  oximal_line_pric
+00007c30: 6573 2e61 7070 656e 6428 6d69 6e5f 7072  es.append(min_pr
+00007c40: 6963 6529 0a20 2020 2023 2020 2020 2072  ice).    #     r
+00007c50: 6574 7572 6e20 7072 6f78 696d 616c 5f6c  eturn proximal_l
+00007c60: 696e 655f 7072 6963 6573 0a20 2020 2020  ine_prices.     
+00007c70: 2020 200a 2020 2020 2320 6465 6620 6361     .    # def ca
+00007c80: 6c63 756c 6174 655f 6465 6d61 6e64 5f64  lculate_demand_d
+00007c90: 6973 7461 6c5f 6c69 6e65 7328 7365 6c66  istal_lines(self
+00007ca0: 2c64 6174 612c 2064 656d 616e 645f 7a6f  ,data, demand_zo
+00007cb0: 6e65 7329 3a0a 2020 2020 2320 2020 2020  nes):.    #     
+00007cc0: 6469 7374 616c 5f6c 696e 655f 7072 6963  distal_line_pric
+00007cd0: 6573 203d 205b 5d0a 2020 2020 2320 2020  es = [].    #   
+00007ce0: 2020 666f 7220 7374 6172 742c 2065 6e64    for start, end
+00007cf0: 2c20 7061 7474 6572 6e2c 205f 2069 6e20  , pattern, _ in 
+00007d00: 6465 6d61 6e64 5f7a 6f6e 6573 3a0a 2020  demand_zones:.  
+00007d10: 2020 2320 2020 2020 2020 2020 6966 2070    #         if p
+00007d20: 6174 7465 726e 203d 3d20 2744 726f 7020  attern == 'Drop 
+00007d30: 4261 7365 2052 616c 6c79 273a 0a20 2020  Base Rally':.   
+00007d40: 2023 2020 2020 2020 2020 2020 2020 2023   #             #
+00007d50: 204c 6f67 6963 2066 6f72 2044 726f 7020   Logic for Drop 
+00007d60: 4261 7365 2052 616c 6c79 2070 6174 7465  Base Rally patte
+00007d70: 726e 3a20 5461 6b65 2074 6865 206c 6f77  rn: Take the low
+00007d80: 6573 7420 7072 6963 6520 616d 6f6e 6720  est price among 
+00007d90: 616c 6c20 636f 6d70 6f6e 656e 7473 206f  all components o
+00007da0: 6620 7468 6520 7a6f 6e65 0a20 2020 2023  f the zone.    #
+00007db0: 2020 2020 2020 2020 2020 2020 206c 6f77               low
+00007dc0: 6573 745f 7072 6963 6520 3d20 6d69 6e28  est_price = min(
+00007dd0: 6461 7461 5b27 4c6f 7727 5d5b 7374 6172  data['Low'][star
+00007de0: 743a 656e 6420 2b20 315d 2920 2023 2047  t:end + 1])  # G
+00007df0: 6574 2074 6865 206c 6f77 6573 7420 7072  et the lowest pr
+00007e00: 6963 6520 7769 7468 696e 2074 6865 207a  ice within the z
+00007e10: 6f6e 650a 2020 2020 2320 2020 2020 2020  one.    #       
+00007e20: 2020 2020 2020 6469 7374 616c 5f6c 696e        distal_lin
+00007e30: 655f 7072 6963 6573 2e61 7070 656e 6428  e_prices.append(
+00007e40: 6c6f 7765 7374 5f70 7269 6365 290a 2020  lowest_price).  
+00007e50: 2020 2320 2020 2020 2020 2020 656c 6966    #         elif
+00007e60: 2070 6174 7465 726e 203d 3d20 2752 616c   pattern == 'Ral
+00007e70: 6c79 2042 6173 6520 5261 6c6c 7927 3a0a  ly Base Rally':.
+00007e80: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00007e90: 2020 2320 4c6f 6769 6320 666f 7220 5261    # Logic for Ra
+00007ea0: 6c6c 7920 4261 7365 2052 616c 6c79 2070  lly Base Rally p
+00007eb0: 6174 7465 726e 3a20 5461 6b65 2074 6865  attern: Take the
+00007ec0: 206c 6f77 6573 7420 6f66 206f 6e6c 7920   lowest of only 
+00007ed0: 616c 6c20 6261 7365 2063 616e 646c 6520  all base candle 
+00007ee0: 616e 6420 666f 6c6c 6f77 6564 2072 616c  and followed ral
+00007ef0: 6c79 2063 616e 646c 650a 2020 2020 2320  ly candle.    # 
+00007f00: 2020 2020 2020 2020 2020 2020 6261 7365              base
+00007f10: 5f63 616e 646c 655f 7072 6963 6573 203d  _candle_prices =
+00007f20: 2064 6174 612e 6c6f 635b 2864 6174 615b   data.loc[(data[
+00007f30: 2743 616e 646c 6520 5479 7065 275d 203d  'Candle Type'] =
+00007f40: 3d20 2742 6173 6520 4361 6e64 6c65 2729  = 'Base Candle')
+00007f50: 2026 2028 6461 7461 2e69 6e64 6578 203e   & (data.index >
+00007f60: 3d20 6461 7461 2e69 6e64 6578 5b73 7461  = data.index[sta
+00007f70: 7274 5d29 2026 2028 6461 7461 2e69 6e64  rt]) & (data.ind
+00007f80: 6578 203c 3d20 6461 7461 2e69 6e64 6578  ex <= data.index
+00007f90: 5b65 6e64 5d29 2c20 274c 6f77 275d 0a20  [end]), 'Low']. 
+00007fa0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00007fb0: 2072 616c 6c79 5f63 616e 646c 655f 7072   rally_candle_pr
+00007fc0: 6963 6573 203d 2064 6174 612e 6c6f 635b  ices = data.loc[
+00007fd0: 2864 6174 615b 2743 616e 646c 6520 5479  (data['Candle Ty
+00007fe0: 7065 275d 203d 3d20 2752 616c 6c79 2043  pe'] == 'Rally C
+00007ff0: 616e 646c 6527 2920 2620 2864 6174 612e  andle') & (data.
+00008000: 696e 6465 7820 3e3d 2064 6174 612e 696e  index >= data.in
+00008010: 6465 785b 656e 645d 2920 2620 2864 6174  dex[end]) & (dat
+00008020: 612e 696e 6465 7820 3c20 6461 7461 2e69  a.index < data.i
+00008030: 6e64 6578 5b65 6e64 2b31 5d29 2c20 274c  ndex[end+1]), 'L
+00008040: 6f77 275d 0a20 2020 2023 2020 2020 2020  ow'].    #      
+00008050: 2020 2020 2020 2061 6c6c 5f70 7269 6365         all_price
+00008060: 7320 3d20 7064 2e63 6f6e 6361 7428 5b62  s = pd.concat([b
+00008070: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
+00008080: 732c 2072 616c 6c79 5f63 616e 646c 655f  s, rally_candle_
+00008090: 7072 6963 6573 5d29 0a20 2020 2023 2020  prices]).    #  
+000080a0: 2020 2020 2020 2020 2020 206c 6f77 6573             lowes
+000080b0: 745f 7072 6963 6520 3d20 616c 6c5f 7072  t_price = all_pr
+000080c0: 6963 6573 2e6d 696e 2829 2069 6620 6e6f  ices.min() if no
+000080d0: 7420 616c 6c5f 7072 6963 6573 2e65 6d70  t all_prices.emp
+000080e0: 7479 2065 6c73 6520 4e6f 6e65 0a20 2020  ty else None.   
+000080f0: 2023 2020 2020 2020 2020 2020 2020 2064   #             d
+00008100: 6973 7461 6c5f 6c69 6e65 5f70 7269 6365  istal_line_price
+00008110: 732e 6170 7065 6e64 286c 6f77 6573 745f  s.append(lowest_
+00008120: 7072 6963 6529 0a20 2020 2023 2020 2020  price).    #    
+00008130: 2072 6574 7572 6e20 6469 7374 616c 5f6c   return distal_l
+00008140: 696e 655f 7072 6963 6573 0a0a 2020 2020  ine_prices..    
+00008150: 2320 6465 6620 6361 6c63 756c 6174 655f  # def calculate_
+00008160: 7375 7070 6c79 5f64 6973 7461 6c5f 6c69  supply_distal_li
+00008170: 6e65 7328 7365 6c66 2c64 6174 612c 2073  nes(self,data, s
+00008180: 7570 706c 795f 7a6f 6e65 7329 3a0a 2020  upply_zones):.  
+00008190: 2020 2320 2020 2020 6469 7374 616c 5f6c    #     distal_l
+000081a0: 696e 655f 7072 6963 6573 203d 205b 5d0a  ine_prices = [].
+000081b0: 2020 2020 2320 2020 2020 666f 7220 7374      #     for st
+000081c0: 6172 742c 2065 6e64 2c20 7061 7474 6572  art, end, patter
+000081d0: 6e2c 205f 2069 6e20 7375 7070 6c79 5f7a  n, _ in supply_z
+000081e0: 6f6e 6573 3a0a 2020 2020 2320 2020 2020  ones:.    #     
+000081f0: 2020 2020 6966 2070 6174 7465 726e 203d      if pattern =
+00008200: 3d20 2752 616c 6c79 2042 6173 6520 4472  = 'Rally Base Dr
+00008210: 6f70 273a 0a20 2020 2023 2020 2020 2020  op':.    #      
+00008220: 2020 2020 2020 2023 204c 6f67 6963 2066         # Logic f
+00008230: 6f72 2052 616c 6c79 2042 6173 6520 4472  or Rally Base Dr
+00008240: 6f70 2070 6174 7465 726e 3a20 5461 6b65  op pattern: Take
+00008250: 2074 6865 2068 6967 6865 7374 2070 7269   the highest pri
+00008260: 6365 2061 6d6f 6e67 2061 6c6c 2063 6f6d  ce among all com
+00008270: 706f 6e65 6e74 7320 6f66 2074 6865 207a  ponents of the z
+00008280: 6f6e 650a 2020 2020 2320 2020 2020 2020  one.    #       
+00008290: 2020 2020 2020 6869 6768 6573 745f 7072        highest_pr
+000082a0: 6963 6520 3d20 6d61 7828 6461 7461 5b27  ice = max(data['
+000082b0: 4869 6768 275d 5b73 7461 7274 3a65 6e64  High'][start:end
+000082c0: 202b 2031 5d29 2020 2320 4765 7420 7468   + 1])  # Get th
+000082d0: 6520 6869 6768 6573 7420 7072 6963 6520  e highest price 
+000082e0: 7769 7468 696e 2074 6865 207a 6f6e 650a  within the zone.
+000082f0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00008300: 2020 6469 7374 616c 5f6c 696e 655f 7072    distal_line_pr
+00008310: 6963 6573 2e61 7070 656e 6428 6869 6768  ices.append(high
+00008320: 6573 745f 7072 6963 6529 0a20 2020 2023  est_price).    #
+00008330: 2020 2020 2020 2020 2065 6c69 6620 7061           elif pa
+00008340: 7474 6572 6e20 3d3d 2027 4472 6f70 2042  ttern == 'Drop B
+00008350: 6173 6520 4472 6f70 273a 0a20 2020 2023  ase Drop':.    #
+00008360: 2020 2020 2020 2020 2020 2020 2023 204c               # L
+00008370: 6f67 6963 2066 6f72 2044 726f 7020 4261  ogic for Drop Ba
+00008380: 7365 2044 726f 7020 7061 7474 6572 6e3a  se Drop pattern:
+00008390: 2054 616b 6520 7468 6520 6869 6768 6573   Take the highes
+000083a0: 7420 6f66 206f 6e6c 7920 616c 6c20 6261  t of only all ba
+000083b0: 7365 2063 616e 646c 6573 2061 6e64 2066  se candles and f
+000083c0: 6f6c 6c6f 7765 6420 6472 6f70 2063 616e  ollowed drop can
+000083d0: 646c 650a 2020 2020 2320 2020 2020 2020  dle.    #       
+000083e0: 2020 2020 2020 6261 7365 5f63 616e 646c        base_candl
+000083f0: 655f 7072 6963 6573 203d 2064 6174 612e  e_prices = data.
+00008400: 6c6f 635b 2864 6174 615b 2743 616e 646c  loc[(data['Candl
+00008410: 6520 5479 7065 275d 203d 3d20 2742 6173  e Type'] == 'Bas
+00008420: 6520 4361 6e64 6c65 2729 2026 2028 6461  e Candle') & (da
+00008430: 7461 2e69 6e64 6578 203e 3d20 6461 7461  ta.index >= data
+00008440: 2e69 6e64 6578 5b73 7461 7274 5d29 2026  .index[start]) &
+00008450: 2028 6461 7461 2e69 6e64 6578 203c 3d20   (data.index <= 
+00008460: 6461 7461 2e69 6e64 6578 5b65 6e64 5d29  data.index[end])
+00008470: 2c20 2748 6967 6827 5d0a 2020 2020 2320  , 'High'].    # 
+00008480: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+00008490: 5f63 616e 646c 655f 7072 6963 6573 203d  _candle_prices =
+000084a0: 2064 6174 612e 6c6f 635b 2864 6174 615b   data.loc[(data[
+000084b0: 2743 616e 646c 6520 5479 7065 275d 203d  'Candle Type'] =
+000084c0: 3d20 2744 726f 7020 4361 6e64 6c65 2729  = 'Drop Candle')
+000084d0: 2026 2028 6461 7461 2e69 6e64 6578 203e   & (data.index >
+000084e0: 3d20 6461 7461 2e69 6e64 6578 5b73 7461  = data.index[sta
+000084f0: 7274 5d29 2026 2028 6461 7461 2e69 6e64  rt]) & (data.ind
+00008500: 6578 203c 3d20 6461 7461 2e69 6e64 6578  ex <= data.index
+00008510: 5b65 6e64 5d29 2c20 2748 6967 6827 5d0a  [end]), 'High'].
+00008520: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00008530: 2020 616c 6c5f 7072 6963 6573 203d 2070    all_prices = p
+00008540: 642e 636f 6e63 6174 285b 6261 7365 5f63  d.concat([base_c
+00008550: 616e 646c 655f 7072 6963 6573 2c20 6472  andle_prices, dr
+00008560: 6f70 5f63 616e 646c 655f 7072 6963 6573  op_candle_prices
+00008570: 5d29 0a20 2020 2023 2020 2020 2020 2020  ]).    #        
+00008580: 2020 2020 2068 6967 6865 7374 5f70 7269       highest_pri
+00008590: 6365 203d 2061 6c6c 5f70 7269 6365 732e  ce = all_prices.
+000085a0: 6d61 7828 2920 6966 206e 6f74 2061 6c6c  max() if not all
+000085b0: 5f70 7269 6365 732e 656d 7074 7920 656c  _prices.empty el
+000085c0: 7365 204e 6f6e 650a 2020 2020 2320 2020  se None.    #   
+000085d0: 2020 2020 2020 2020 2020 6469 7374 616c            distal
+000085e0: 5f6c 696e 655f 7072 6963 6573 2e61 7070  _line_prices.app
+000085f0: 656e 6428 6869 6768 6573 745f 7072 6963  end(highest_pric
+00008600: 6529 0a20 2020 2023 2020 2020 2072 6574  e).    #     ret
+00008610: 7572 6e20 6469 7374 616c 5f6c 696e 655f  urn distal_line_
+00008620: 7072 6963 6573 0a0a 2020 2020 2320 6465  prices..    # de
+00008630: 6620 6973 5f7a 6f6e 655f 7465 7374 6564  f is_zone_tested
+00008640: 2873 656c 662c 6461 7461 2c20 7374 6172  (self,data, star
+00008650: 745f 696e 6465 782c 2065 6e64 5f69 6e64  t_index, end_ind
+00008660: 6578 2c20 7072 6f78 696d 616c 5f6c 696e  ex, proximal_lin
+00008670: 655f 7072 6963 6529 3a0a 2020 2020 2320  e_price):.    # 
+00008680: 2020 2020 2222 220a 2020 2020 2320 2020      """.    #   
+00008690: 2020 4368 6563 6b20 6966 2074 6865 2070    Check if the p
+000086a0: 726f 7869 6d61 6c20 6c69 6e65 2070 7269  roximal line pri
+000086b0: 6365 2068 6173 2062 6565 6e20 7465 7374  ce has been test
+000086c0: 6564 2062 7920 6675 7475 7265 2070 7269  ed by future pri
+000086d0: 6365 732e 0a20 2020 2020 2020 200a 2020  ces..        .  
+000086e0: 2020 2320 2020 2020 4172 6773 3a0a 2020    #     Args:.  
+000086f0: 2020 2320 2020 2020 2d20 6461 7461 3a20    #     - data: 
+00008700: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
+00008710: 6e69 6e67 2073 746f 636b 2064 6174 610a  ning stock data.
+00008720: 2020 2020 2320 2020 2020 2d20 7374 6172      #     - star
+00008730: 745f 696e 6465 783a 2053 7461 7274 2069  t_index: Start i
+00008740: 6e64 6578 206f 6620 7468 6520 6465 6d61  ndex of the dema
+00008750: 6e64 2f73 7570 706c 7920 7a6f 6e65 0a20  nd/supply zone. 
+00008760: 2020 2023 2020 2020 202d 2065 6e64 5f69     #     - end_i
+00008770: 6e64 6578 3a20 456e 6420 696e 6465 7820  ndex: End index 
+00008780: 6f66 2074 6865 2064 656d 616e 642f 7375  of the demand/su
+00008790: 7070 6c79 207a 6f6e 650a 2020 2020 2320  pply zone.    # 
+000087a0: 2020 2020 2d20 7072 6f78 696d 616c 5f6c      - proximal_l
+000087b0: 696e 655f 7072 6963 653a 2050 726f 7869  ine_price: Proxi
+000087c0: 6d61 6c20 6c69 6e65 2070 7269 6365 0a20  mal line price. 
+000087d0: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+000087e0: 2020 5265 7475 726e 733a 0a20 2020 2023    Returns:.    #
+000087f0: 2020 2020 202d 2054 7275 6520 6966 2074       - True if t
+00008800: 6865 2070 726f 7869 6d61 6c20 6c69 6e65  he proximal line
+00008810: 2070 7269 6365 2069 7320 7465 7374 6564   price is tested
+00008820: 2c20 4661 6c73 6520 6f74 6865 7277 6973  , False otherwis
+00008830: 650a 2020 2020 2320 2020 2020 2222 220a  e.    #     """.
+00008840: 2020 2020 2320 2020 2020 666f 7220 6920      #     for i 
+00008850: 696e 2072 616e 6765 2865 6e64 5f69 6e64  in range(end_ind
+00008860: 6578 202b 2031 2c20 6c65 6e28 6461 7461  ex + 1, len(data
+00008870: 2929 3a0a 2020 2020 2320 2020 2020 2020  )):.    #       
+00008880: 2020 6966 2064 6174 615b 274c 6f77 275d    if data['Low']
+00008890: 5b69 5d20 3c3d 2070 726f 7869 6d61 6c5f  [i] <= proximal_
+000088a0: 6c69 6e65 5f70 7269 6365 203c 3d20 6461  line_price <= da
+000088b0: 7461 5b27 4869 6768 275d 5b69 5d3a 0a20  ta['High'][i]:. 
+000088c0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+000088d0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+000088e0: 2023 2020 2020 2072 6574 7572 6e20 4661   #     return Fa
+000088f0: 6c73 650a 0a20 2020 2023 2064 6566 2063  lse..    # def c
+00008900: 616c 6375 6c61 7465 5f7a 6f6e 655f 7261  alculate_zone_ra
+00008910: 6e67 6528 7365 6c66 2c70 726f 7869 6d61  nge(self,proxima
+00008920: 6c5f 6c69 6e65 2c20 6469 7374 616c 5f6c  l_line, distal_l
+00008930: 696e 6529 3a0a 2020 2020 2320 2020 2020  ine):.    #     
+00008940: 2222 220a 2020 2020 2320 2020 2020 4361  """.    #     Ca
+00008950: 6c63 756c 6174 6520 7468 6520 7261 6e67  lculate the rang
+00008960: 6520 6f66 2061 207a 6f6e 6520 6769 7665  e of a zone give
+00008970: 6e20 6974 7320 7072 6f78 696d 616c 2061  n its proximal a
+00008980: 6e64 2064 6973 7461 6c20 6c69 6e65 732e  nd distal lines.
+00008990: 0a20 2020 2020 2020 200a 2020 2020 2320  .        .    # 
+000089a0: 2020 2020 4172 6773 3a0a 2020 2020 2320      Args:.    # 
+000089b0: 2020 2020 2d20 7072 6f78 696d 616c 5f6c      - proximal_l
+000089c0: 696e 653a 2050 726f 7869 6d61 6c20 6c69  ine: Proximal li
+000089d0: 6e65 2070 7269 6365 0a20 2020 2023 2020  ne price.    #  
+000089e0: 2020 202d 2064 6973 7461 6c5f 6c69 6e65     - distal_line
+000089f0: 3a20 4469 7374 616c 206c 696e 6520 7072  : Distal line pr
+00008a00: 6963 650a 2020 2020 2020 2020 0a20 2020  ice.        .   
+00008a10: 2023 2020 2020 2052 6574 7572 6e73 3a0a   #     Returns:.
+00008a20: 2020 2020 2320 2020 2020 2d20 5261 6e67      #     - Rang
+00008a30: 6520 6f66 2074 6865 207a 6f6e 650a 2020  e of the zone.  
+00008a40: 2020 2320 2020 2020 2222 220a 2020 2020    #     """.    
+00008a50: 2320 2020 2020 6966 2070 726f 7869 6d61  #     if proxima
+00008a60: 6c5f 6c69 6e65 2069 7320 6e6f 7420 4e6f  l_line is not No
+00008a70: 6e65 2061 6e64 2064 6973 7461 6c5f 6c69  ne and distal_li
+00008a80: 6e65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ne is not None:.
+00008a90: 2020 2020 2320 2020 2020 2020 2020 7265      #         re
+00008aa0: 7475 726e 2061 6273 2870 726f 7869 6d61  turn abs(proxima
+00008ab0: 6c5f 6c69 6e65 202d 2064 6973 7461 6c5f  l_line - distal_
+00008ac0: 6c69 6e65 290a 2020 2020 2320 2020 2020  line).    #     
+00008ad0: 656c 7365 3a0a 2020 2020 2320 2020 2020  else:.    #     
+00008ae0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00008af0: 0a20 2020 2023 2064 6566 2063 616c 6375  .    # def calcu
+00008b00: 6c61 7465 5f64 656d 616e 645f 7a6f 6e65  late_demand_zone
+00008b10: 5f72 616e 6765 7328 7365 6c66 2c64 656d  _ranges(self,dem
+00008b20: 616e 645f 7a6f 6e65 732c 2064 656d 616e  and_zones, deman
+00008b30: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+00008b40: 2c20 6465 6d61 6e64 5f64 6973 7461 6c5f  , demand_distal_
+00008b50: 6c69 6e65 7329 3a0a 2020 2020 2320 2020  lines):.    #   
+00008b60: 2020 2222 220a 2020 2020 2320 2020 2020    """.    #     
+00008b70: 4361 6c63 756c 6174 6520 7468 6520 7261  Calculate the ra
+00008b80: 6e67 6520 6f66 2065 6163 6820 6465 6d61  nge of each dema
+00008b90: 6e64 207a 6f6e 652e 0a20 2020 2020 2020  nd zone..       
+00008ba0: 200a 2020 2020 2320 2020 2020 4172 6773   .    #     Args
+00008bb0: 3a0a 2020 2020 2320 2020 2020 2d20 6465  :.    #     - de
+00008bc0: 6d61 6e64 5f7a 6f6e 6573 3a20 4c69 7374  mand_zones: List
+00008bd0: 206f 6620 6465 6d61 6e64 207a 6f6e 6520   of demand zone 
+00008be0: 7475 706c 6573 2028 7374 6172 742c 2065  tuples (start, e
+00008bf0: 6e64 2c20 7061 7474 6572 6e2c 2062 6173  nd, pattern, bas
+00008c00: 655f 636f 756e 7429 0a20 2020 2023 2020  e_count).    #  
+00008c10: 2020 202d 2064 656d 616e 645f 7072 6f78     - demand_prox
+00008c20: 696d 616c 5f6c 696e 6573 3a20 4c69 7374  imal_lines: List
+00008c30: 206f 6620 7072 6f78 696d 616c 206c 696e   of proximal lin
+00008c40: 6520 7072 6963 6573 2066 6f72 2064 656d  e prices for dem
+00008c50: 616e 6420 7a6f 6e65 730a 2020 2020 2320  and zones.    # 
+00008c60: 2020 2020 2d20 6465 6d61 6e64 5f64 6973      - demand_dis
+00008c70: 7461 6c5f 6c69 6e65 733a 204c 6973 7420  tal_lines: List 
+00008c80: 6f66 2064 6973 7461 6c20 6c69 6e65 2070  of distal line p
+00008c90: 7269 6365 7320 666f 7220 6465 6d61 6e64  rices for demand
+00008ca0: 207a 6f6e 6573 0a20 2020 2020 2020 200a   zones.        .
+00008cb0: 2020 2020 2320 2020 2020 5265 7475 726e      #     Return
+00008cc0: 733a 0a20 2020 2023 2020 2020 202d 204c  s:.    #     - L
+00008cd0: 6973 7420 6f66 2072 616e 6765 7320 636f  ist of ranges co
+00008ce0: 7272 6573 706f 6e64 696e 6720 746f 2065  rresponding to e
+00008cf0: 6163 6820 6465 6d61 6e64 207a 6f6e 650a  ach demand zone.
+00008d00: 2020 2020 2320 2020 2020 2222 220a 2020      #     """.  
+00008d10: 2020 2320 2020 2020 6465 6d61 6e64 5f7a    #     demand_z
+00008d20: 6f6e 655f 7261 6e67 6573 203d 205b 5d0a  one_ranges = [].
+00008d30: 2020 2020 2320 2020 2020 666f 7220 692c      #     for i,
+00008d40: 2028 7374 6172 742c 2065 6e64 2c20 5f2c   (start, end, _,
+00008d50: 205f 2920 696e 2065 6e75 6d65 7261 7465   _) in enumerate
+00008d60: 2864 656d 616e 645f 7a6f 6e65 7329 3a0a  (demand_zones):.
+00008d70: 2020 2020 2320 2020 2020 2020 2020 7261      #         ra
+00008d80: 6e67 655f 6f66 5f7a 6f6e 6520 3d20 7365  nge_of_zone = se
+00008d90: 6c66 2e63 616c 6375 6c61 7465 5f7a 6f6e  lf.calculate_zon
+00008da0: 655f 7261 6e67 6528 6465 6d61 6e64 5f70  e_range(demand_p
+00008db0: 726f 7869 6d61 6c5f 6c69 6e65 735b 695d  roximal_lines[i]
+00008dc0: 2c20 6465 6d61 6e64 5f64 6973 7461 6c5f  , demand_distal_
+00008dd0: 6c69 6e65 735b 695d 290a 2020 2020 2320  lines[i]).    # 
+00008de0: 2020 2020 2020 2020 6465 6d61 6e64 5f7a          demand_z
+00008df0: 6f6e 655f 7261 6e67 6573 2e61 7070 656e  one_ranges.appen
+00008e00: 6428 7261 6e67 655f 6f66 5f7a 6f6e 6529  d(range_of_zone)
+00008e10: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
+00008e20: 6e20 6465 6d61 6e64 5f7a 6f6e 655f 7261  n demand_zone_ra
+00008e30: 6e67 6573 0a0a 2020 2020 2320 6465 6620  nges..    # def 
+00008e40: 6361 6c63 756c 6174 655f 7375 7070 6c79  calculate_supply
+00008e50: 5f7a 6f6e 655f 7261 6e67 6573 2873 656c  _zone_ranges(sel
+00008e60: 662c 7375 7070 6c79 5f7a 6f6e 6573 2c20  f,supply_zones, 
+00008e70: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
+00008e80: 6c69 6e65 732c 2073 7570 706c 795f 6469  lines, supply_di
+00008e90: 7374 616c 5f6c 696e 6573 293a 0a20 2020  stal_lines):.   
+00008ea0: 2023 2020 2020 2022 2222 0a20 2020 2023   #     """.    #
+00008eb0: 2020 2020 2043 616c 6375 6c61 7465 2074       Calculate t
+00008ec0: 6865 2072 616e 6765 206f 6620 6561 6368  he range of each
+00008ed0: 2073 7570 706c 7920 7a6f 6e65 2e0a 2020   supply zone..  
+00008ee0: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+00008ef0: 2041 7267 733a 0a20 2020 2023 2020 2020   Args:.    #    
+00008f00: 202d 2073 7570 706c 795f 7a6f 6e65 733a   - supply_zones:
+00008f10: 204c 6973 7420 6f66 2073 7570 706c 7920   List of supply 
+00008f20: 7a6f 6e65 2074 7570 6c65 7320 2873 7461  zone tuples (sta
+00008f30: 7274 2c20 656e 642c 2070 6174 7465 726e  rt, end, pattern
+00008f40: 2c20 6261 7365 5f63 6f75 6e74 290a 2020  , base_count).  
+00008f50: 2020 2320 2020 2020 2d20 7375 7070 6c79    #     - supply
+00008f60: 5f70 726f 7869 6d61 6c5f 6c69 6e65 733a  _proximal_lines:
+00008f70: 204c 6973 7420 6f66 2070 726f 7869 6d61   List of proxima
+00008f80: 6c20 6c69 6e65 2070 7269 6365 7320 666f  l line prices fo
+00008f90: 7220 7375 7070 6c79 207a 6f6e 6573 0a20  r supply zones. 
+00008fa0: 2020 2023 2020 2020 202d 2073 7570 706c     #     - suppl
+00008fb0: 795f 6469 7374 616c 5f6c 696e 6573 3a20  y_distal_lines: 
+00008fc0: 4c69 7374 206f 6620 6469 7374 616c 206c  List of distal l
+00008fd0: 696e 6520 7072 6963 6573 2066 6f72 2073  ine prices for s
+00008fe0: 7570 706c 7920 7a6f 6e65 730a 2020 2020  upply zones.    
+00008ff0: 2020 2020 0a20 2020 2023 2020 2020 2052      .    #     R
+00009000: 6574 7572 6e73 3a0a 2020 2020 2320 2020  eturns:.    #   
+00009010: 2020 2d20 4c69 7374 206f 6620 7261 6e67    - List of rang
+00009020: 6573 2063 6f72 7265 7370 6f6e 6469 6e67  es corresponding
+00009030: 2074 6f20 6561 6368 2073 7570 706c 7920   to each supply 
+00009040: 7a6f 6e65 0a20 2020 2023 2020 2020 2022  zone.    #     "
+00009050: 2222 0a20 2020 2023 2020 2020 2073 7570  "".    #     sup
+00009060: 706c 795f 7a6f 6e65 5f72 616e 6765 7320  ply_zone_ranges 
+00009070: 3d20 5b5d 0a20 2020 2023 2020 2020 2066  = [].    #     f
+00009080: 6f72 2069 2c20 2873 7461 7274 2c20 656e  or i, (start, en
+00009090: 642c 205f 2c20 5f29 2069 6e20 656e 756d  d, _, _) in enum
+000090a0: 6572 6174 6528 7375 7070 6c79 5f7a 6f6e  erate(supply_zon
+000090b0: 6573 293a 0a20 2020 2023 2020 2020 2020  es):.    #      
+000090c0: 2020 2072 616e 6765 5f6f 665f 7a6f 6e65     range_of_zone
+000090d0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
+000090e0: 655f 7a6f 6e65 5f72 616e 6765 2873 7570  e_zone_range(sup
+000090f0: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
+00009100: 6573 5b69 5d2c 2073 7570 706c 795f 6469  es[i], supply_di
+00009110: 7374 616c 5f6c 696e 6573 5b69 5d29 0a20  stal_lines[i]). 
+00009120: 2020 2023 2020 2020 2020 2020 2073 7570     #         sup
+00009130: 706c 795f 7a6f 6e65 5f72 616e 6765 732e  ply_zone_ranges.
+00009140: 6170 7065 6e64 2872 616e 6765 5f6f 665f  append(range_of_
+00009150: 7a6f 6e65 290a 2020 2020 2320 2020 2020  zone).    #     
+00009160: 7265 7475 726e 2073 7570 706c 795f 7a6f  return supply_zo
+00009170: 6e65 5f72 616e 6765 730a 0a20 2020 2023  ne_ranges..    #
+00009180: 2064 6566 2066 696c 7465 725f 7374 6f63   def filter_stoc
+00009190: 6b73 5f62 795f 6469 7374 616e 6365 2873  ks_by_distance(s
+000091a0: 656c 662c 6461 7461 2c73 796d 626f 6c5f  elf,data,symbol_
+000091b0: 6c69 7374 2c20 7468 7265 7368 6f6c 645f  list, threshold_
+000091c0: 7065 7263 656e 742c 2074 696d 6566 7261  percent, timefra
+000091d0: 6d65 293a 0a20 2020 2023 2020 2020 2066  me):.    #     f
+000091e0: 696c 7465 7265 645f 7374 6f63 6b73 203d  iltered_stocks =
+000091f0: 205b 5d0a 2020 2020 2320 2020 2020 666f   [].    #     fo
+00009200: 7220 7379 6d62 6f6c 2069 6e20 7379 6d62  r symbol in symb
+00009210: 6f6c 5f6c 6973 743a 0a20 2020 2023 2020  ol_list:.    #  
+00009220: 2020 2020 2020 2069 6620 6461 7461 2069         if data i
+00009230: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00009240: 2320 2020 2020 2020 2020 2020 2020 636d  #             cm
+00009250: 7020 3d20 6461 7461 2e69 6c6f 635b 2d31  p = data.iloc[-1
+00009260: 5d5b 2743 6c6f 7365 275d 2020 2320 4375  ]['Close']  # Cu
+00009270: 7272 656e 7420 6d61 726b 6574 2070 7269  rrent market pri
+00009280: 6365 0a20 2020 2023 2020 2020 2020 2020  ce.    #        
+00009290: 2020 2020 2064 656d 616e 645f 7a6f 6e65       demand_zone
+000092a0: 732c 205f 2c20 5f2c 2064 656d 616e 645f  s, _, _, demand_
+000092b0: 7072 6f78 696d 616c 5f6c 696e 6520 3d20  proximal_line = 
+000092c0: 7365 6c66 2e69 6465 6e74 6966 795f 6465  self.identify_de
+000092d0: 6d61 6e64 5f7a 6f6e 6528 6461 7461 2c20  mand_zone(data, 
+000092e0: 636d 7029 2020 2320 5061 7373 2063 6d70  cmp)  # Pass cmp
+000092f0: 2061 7267 756d 656e 7420 6865 7265 0a20   argument here. 
+00009300: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009310: 2073 7570 706c 795f 7a6f 6e65 732c 205f   supply_zones, _
+00009320: 2c20 5f2c 2073 7570 706c 795f 7072 6f78  , _, supply_prox
+00009330: 696d 616c 5f6c 696e 6520 3d20 7365 6c66  imal_line = self
+00009340: 2e69 6465 6e74 6966 795f 7375 7070 6c79  .identify_supply
+00009350: 5f7a 6f6e 6528 6461 7461 2c20 636d 7029  _zone(data, cmp)
+00009360: 2020 2320 5061 7373 2063 6d70 2061 7267    # Pass cmp arg
+00009370: 756d 656e 7420 6865 7265 0a20 2020 2020  ument here.     
+00009380: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00009390: 2320 2020 2020 2020 2020 2020 2020 2320  #             # 
+000093a0: 4368 6563 6b20 6966 2065 6974 6865 7220  Check if either 
+000093b0: 6465 6d61 6e64 206f 7220 7375 7070 6c79  demand or supply
+000093c0: 207a 6f6e 6573 2065 7869 7374 2066 6f72   zones exist for
+000093d0: 2074 6865 2073 746f 636b 0a20 2020 2023   the stock.    #
+000093e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000093f0: 6465 6d61 6e64 5f7a 6f6e 6573 206f 7220  demand_zones or 
+00009400: 7375 7070 6c79 5f7a 6f6e 6573 3a0a 2020  supply_zones:.  
+00009410: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00009420: 2020 2020 6669 6c74 6572 6564 5f73 746f      filtered_sto
+00009430: 636b 732e 6170 7065 6e64 2873 796d 626f  cks.append(symbo
+00009440: 6c29 0a0a 2020 2020 2320 2020 2020 7265  l)..    #     re
+00009450: 7475 726e 2066 696c 7465 7265 645f 7374  turn filtered_st
+00009460: 6f63 6b73 0a20 2020 200a 2020 2020 2320  ocks.    .    # 
+00009470: 6465 6620 6669 6e64 4465 6d61 6e64 5375  def findDemandSu
+00009480: 7070 6c79 5a6f 6e65 7328 7365 6c66 2c64  pplyZones(self,d
+00009490: 6174 612c 7468 7265 7368 6f6c 645f 7065  ata,threshold_pe
+000094a0: 7263 656e 743d 3129 3a20 2020 2020 2020  rcent=1):       
+000094b0: 200a 2020 2020 2320 2020 2020 2320 496e   .    #     # In
+000094c0: 6974 6961 6c69 7a65 2063 6f75 6e74 2066  itialize count f
+000094d0: 6f72 2066 696c 7465 7265 6420 7374 6f63  or filtered stoc
+000094e0: 6b73 0a20 2020 2023 2020 2020 2063 6f75  ks.    #     cou
+000094f0: 6e74 5f66 696c 7465 7265 645f 7374 6f63  nt_filtered_stoc
+00009500: 6b73 203d 2030 0a0a 2020 2020 2320 2020  ks = 0..    #   
+00009510: 2020 2320 416e 616c 797a 6520 6465 6d61    # Analyze dema
+00009520: 6e64 2061 6e64 2073 7570 706c 7920 7a6f  nd and supply zo
+00009530: 6e65 7320 666f 7220 6561 6368 2073 746f  nes for each sto
+00009540: 636b 2061 6e64 2073 6176 6520 7265 7375  ck and save resu
+00009550: 6c74 7320 696e 2061 2066 696c 650a 2020  lts in a file.  
+00009560: 2020 2320 2020 2020 7769 7468 206f 7065    #     with ope
+00009570: 6e28 2264 656d 616e 645f 7375 7070 6c79  n("demand_supply
+00009580: 5f7a 6f6e 6573 2e74 7874 222c 2022 7722  _zones.txt", "w"
+00009590: 2920 6173 2066 696c 653a 0a20 2020 2023  ) as file:.    #
+000095a0: 2020 2020 2020 2020 2066 6f72 2073 796d           for sym
+000095b0: 626f 6c20 696e 2064 6174 615b 2253 746f  bol in data["Sto
+000095c0: 636b 225d 3a0a 2020 2020 2320 2020 2020  ck"]:.    #     
+000095d0: 2020 2020 2020 2020 6966 2064 6174 6120          if data 
+000095e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000095f0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009600: 2020 2063 6d70 203d 2064 6174 612e 696c     cmp = data.il
+00009610: 6f63 5b2d 315d 5b27 436c 6f73 6527 5d20  oc[-1]['Close'] 
+00009620: 2023 2043 7572 7265 6e74 206d 6172 6b65   # Current marke
+00009630: 7420 7072 6963 650a 2020 2020 2320 2020  t price.    #   
+00009640: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00009650: 6d61 6e64 5f7a 6f6e 6573 2c20 5f2c 205f  mand_zones, _, _
+00009660: 2c20 6465 6d61 6e64 5f70 726f 7869 6d61  , demand_proxima
+00009670: 6c5f 6c69 6e65 203d 2073 656c 662e 6964  l_line = self.id
+00009680: 656e 7469 6679 5f64 656d 616e 645f 7a6f  entify_demand_zo
+00009690: 6e65 2864 6174 612c 2063 6d70 290a 2020  ne(data, cmp).  
+000096a0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000096b0: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
+000096c0: 2c20 5f2c 205f 2c20 7375 7070 6c79 5f70  , _, _, supply_p
+000096d0: 726f 7869 6d61 6c5f 6c69 6e65 203d 2073  roximal_line = s
+000096e0: 656c 662e 6964 656e 7469 6679 5f73 7570  elf.identify_sup
+000096f0: 706c 795f 7a6f 6e65 2864 6174 612c 2063  ply_zone(data, c
+00009700: 6d70 290a 0a20 2020 2023 2020 2020 2020  mp)..    #      
+00009710: 2020 2020 2020 2020 2020 2023 2053 7465             # Ste
+00009720: 7020 313a 2043 616c 6375 6c61 7465 2070  p 1: Calculate p
+00009730: 726f 7869 6d61 6c20 6c69 6e65 7320 666f  roximal lines fo
+00009740: 7220 6465 6d61 6e64 2061 6e64 2073 7570  r demand and sup
+00009750: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
+00009760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009770: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
+00009780: 6c69 6e65 7320 3d20 7365 6c66 2e63 616c  lines = self.cal
+00009790: 6375 6c61 7465 5f64 656d 616e 645f 7072  culate_demand_pr
+000097a0: 6f78 696d 616c 5f6c 696e 6573 2864 6174  oximal_lines(dat
+000097b0: 612c 2064 656d 616e 645f 7a6f 6e65 7329  a, demand_zones)
+000097c0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+000097d0: 2020 2020 2020 2073 7570 706c 795f 7072         supply_pr
+000097e0: 6f78 696d 616c 5f6c 696e 6573 203d 2073  oximal_lines = s
+000097f0: 656c 662e 6361 6c63 756c 6174 655f 7375  elf.calculate_su
+00009800: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+00009810: 6e65 7328 6461 7461 2c20 7375 7070 6c79  nes(data, supply
+00009820: 5f7a 6f6e 6573 290a 2020 2020 2020 2020  _zones).        
+00009830: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00009840: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009850: 2020 2023 2053 7465 7020 323a 2043 616c     # Step 2: Cal
+00009860: 6375 6c61 7465 2064 6973 7461 6c20 6c69  culate distal li
+00009870: 6e65 7320 666f 7220 6465 6d61 6e64 207a  nes for demand z
+00009880: 6f6e 6573 2061 6e64 2073 7570 706c 7920  ones and supply 
+00009890: 7a6f 6e65 730a 2020 2020 2320 2020 2020  zones.    #     
+000098a0: 2020 2020 2020 2020 2020 2020 6465 6d61              dema
+000098b0: 6e64 5f64 6973 7461 6c5f 6c69 6e65 7320  nd_distal_lines 
+000098c0: 3d20 7365 6c66 2e63 616c 6375 6c61 7465  = self.calculate
+000098d0: 5f64 656d 616e 645f 6469 7374 616c 5f6c  _demand_distal_l
+000098e0: 696e 6573 2864 6174 612c 2064 656d 616e  ines(data, deman
+000098f0: 645f 7a6f 6e65 7329 0a20 2020 2023 2020  d_zones).    #  
+00009900: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009910: 7570 706c 795f 6469 7374 616c 5f6c 696e  upply_distal_lin
+00009920: 6573 203d 2073 656c 662e 6361 6c63 756c  es = self.calcul
+00009930: 6174 655f 7375 7070 6c79 5f64 6973 7461  ate_supply_dista
+00009940: 6c5f 6c69 6e65 7328 6461 7461 2c20 7375  l_lines(data, su
+00009950: 7070 6c79 5f7a 6f6e 6573 290a 0a20 2020  pply_zones)..   
+00009960: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009970: 2020 2023 2043 616c 6375 6c61 7465 2072     # Calculate r
+00009980: 616e 6765 206f 6620 6465 6d61 6e64 2061  ange of demand a
+00009990: 6e64 2073 7570 706c 7920 7a6f 6e65 730a  nd supply zones.
+000099a0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000099b0: 2020 2020 2020 6465 6d61 6e64 5f7a 6f6e        demand_zon
+000099c0: 655f 7261 6e67 6573 203d 2073 656c 662e  e_ranges = self.
+000099d0: 6361 6c63 756c 6174 655f 6465 6d61 6e64  calculate_demand
+000099e0: 5f7a 6f6e 655f 7261 6e67 6573 2864 656d  _zone_ranges(dem
+000099f0: 616e 645f 7a6f 6e65 732c 2064 656d 616e  and_zones, deman
+00009a00: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+00009a10: 2c20 6465 6d61 6e64 5f64 6973 7461 6c5f  , demand_distal_
+00009a20: 6c69 6e65 7329 0a20 2020 2023 2020 2020  lines).    #    
+00009a30: 2020 2020 2020 2020 2020 2020 2073 7570               sup
+00009a40: 706c 795f 7a6f 6e65 5f72 616e 6765 7320  ply_zone_ranges 
+00009a50: 3d20 7365 6c66 2e63 616c 6375 6c61 7465  = self.calculate
+00009a60: 5f73 7570 706c 795f 7a6f 6e65 5f72 616e  _supply_zone_ran
+00009a70: 6765 7328 7375 7070 6c79 5f7a 6f6e 6573  ges(supply_zones
+00009a80: 2c20 7375 7070 6c79 5f70 726f 7869 6d61  , supply_proxima
+00009a90: 6c5f 6c69 6e65 732c 2073 7570 706c 795f  l_lines, supply_
+00009aa0: 6469 7374 616c 5f6c 696e 6573 290a 2020  distal_lines).  
+00009ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ac0: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
+00009ad0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00009ae0: 6974 6528 6622 5c6e 5c6e 416e 616c 7973  ite(f"\n\nAnalys
+00009af0: 6973 2066 6f72 207b 7379 6d62 6f6c 7d20  is for {symbol} 
+00009b00: 287b 7469 6d65 6672 616d 657d 293a 2229  ({timeframe}):")
+00009b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009b20: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
+00009b30: 2020 2020 2020 2020 2020 2020 2320 4465              # De
+00009b40: 6d61 6e64 205a 6f6e 6573 0a20 2020 2023  mand Zones.    #
+00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b60: 2066 696c 652e 7772 6974 6528 225c 6e5c   file.write("\n\
+00009b70: 6e44 656d 616e 6420 5a6f 6e65 733a 2229  nDemand Zones:")
+00009b80: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009b90: 2020 2020 2020 2069 6620 6465 6d61 6e64         if demand
+00009ba0: 5f7a 6f6e 6573 3a20 2023 2043 6865 636b  _zones:  # Check
+00009bb0: 2069 6620 6465 6d61 6e64 5f7a 6f6e 6573   if demand_zones
+00009bc0: 2069 7320 6e6f 7420 656d 7074 790a 2020   is not empty.  
+00009bd0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00009be0: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
+00009bf0: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
+00009c00: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
+00009c10: 2069 6e20 656e 756d 6572 6174 6528 6465   in enumerate(de
+00009c20: 6d61 6e64 5f7a 6f6e 6573 293a 0a20 2020  mand_zones):.   
+00009c30: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009c40: 2020 2020 2020 2020 2020 2064 6973 745f             dist_
+00009c50: 6672 6f6d 5f63 6d70 203d 2061 6273 2828  from_cmp = abs((
+00009c60: 636d 7020 2d20 6465 6d61 6e64 5f70 726f  cmp - demand_pro
+00009c70: 7869 6d61 6c5f 6c69 6e65 735b 695d 2920  ximal_lines[i]) 
+00009c80: 2f20 636d 7029 202a 2031 3030 0a20 2020  / cmp) * 100.   
+00009c90: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009ca0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+00009cb0: 7772 6974 6528 6622 5c6e 5c6e 5a6f 6e65  write(f"\n\nZone
+00009cc0: 207b 692b 317d 3a20 5374 6172 7420 4461   {i+1}: Start Da
+00009cd0: 7465 3a20 7b64 6174 612e 696e 6465 785b  te: {data.index[
+00009ce0: 7374 6172 745d 2e64 6174 6528 297d 2c20  start].date()}, 
+00009cf0: 456e 6420 4461 7465 3a20 7b64 6174 612e  End Date: {data.
+00009d00: 696e 6465 785b 656e 645d 2e64 6174 6528  index[end].date(
+00009d10: 297d 2229 0a20 2020 2023 2020 2020 2020  )}").    #      
+00009d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d30: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+00009d40: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
+00009d50: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
+00009d60: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
+00009d70: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
+00009d80: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009d90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009da0: 696c 652e 7772 6974 6528 6622 5c6e 4469  ile.write(f"\nDi
+00009db0: 7374 616e 6365 2066 726f 6d20 434d 503a  stance from CMP:
+00009dc0: 207b 6469 7374 5f66 726f 6d5f 636d 703a   {dist_from_cmp:
+00009dd0: 2e32 667d 2522 290a 2020 2020 2320 2020  .2f}%").    #   
+00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009df0: 2020 2020 2020 6966 2064 656d 616e 645f        if demand_
+00009e00: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
+00009e10: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e30: 2020 6669 6c65 2e77 7269 7465 2866 225c    file.write(f"\
+00009e40: 6e50 726f 7869 6d61 6c20 4c69 6e65 2050  nProximal Line P
+00009e50: 7269 6365 3a20 7b64 656d 616e 645f 7072  rice: {demand_pr
+00009e60: 6f78 696d 616c 5f6c 696e 6573 5b69 5d3a  oximal_lines[i]:
+00009e70: 2e32 667d 2229 0a20 2020 2023 2020 2020  .2f}").    #    
+00009e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e90: 2020 2020 2069 6620 6465 6d61 6e64 5f64       if demand_d
+00009ea0: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
+00009eb0: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
+00009ec0: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
+00009ed0: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
+00009ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ef0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00009f00: 6974 6528 6622 5c6e 4469 7374 616c 204c  ite(f"\nDistal L
+00009f10: 696e 6520 5072 6963 653a 207b 6465 6d61  ine Price: {dema
+00009f20: 6e64 5f64 6973 7461 6c5f 6c69 6e65 735b  nd_distal_lines[
+00009f30: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
+00009f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f50: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
+00009f60: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
+00009f70: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009f80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009f90: 696c 652e 7772 6974 6528 6622 5c6e 5a6f  ile.write(f"\nZo
+00009fa0: 6e65 2052 616e 6765 3a20 7b64 656d 616e  ne Range: {deman
+00009fb0: 645f 7a6f 6e65 5f72 616e 6765 735b 695d  d_zone_ranges[i]
+00009fc0: 3a2e 3266 7d22 2920 2020 2020 2020 0a20  :.2f}")       . 
+00009fd0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009fe0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00009ff0: 6865 636b 2069 6620 7072 6f78 696d 616c  heck if proximal
+0000a000: 206c 696e 6520 6973 2074 6573 7465 640a   line is tested.
+0000a010: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a020: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0000a030: 7374 6564 203d 2073 656c 662e 6973 5f7a  sted = self.is_z
+0000a040: 6f6e 655f 7465 7374 6564 2864 6174 612c  one_tested(data,
+0000a050: 2073 7461 7274 2c20 656e 642c 2064 656d   start, end, dem
+0000a060: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
+0000a070: 6573 5b69 5d29 0a20 2020 2023 2020 2020  es[i]).    #    
+0000a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a090: 2020 2020 2069 6620 7465 7374 6564 3a0a       if tested:.
+0000a0a0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
+0000a0d0: 5a6f 6e65 2069 7320 5465 7374 6564 2229  Zone is Tested")
+0000a0e0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000a0f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a100: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a120: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+0000a130: 6528 225c 6e46 7265 7368 205a 6f6e 6522  e("\nFresh Zone"
+0000a140: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000a150: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a160: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a170: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a180: 7465 2822 5c6e 4e6f 2064 656d 616e 6420  te("\nNo demand 
+0000a190: 7a6f 6e65 2070 6174 7465 726e 7320 666f  zone patterns fo
+0000a1a0: 756e 642e 2229 0a0a 2020 2020 2320 2020  und.")..    #   
+0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a1c0: 5375 7070 6c79 205a 6f6e 6573 0a20 2020  Supply Zones.   
+0000a1d0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000a1e0: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
+0000a1f0: 6e5c 6e53 7570 706c 7920 5a6f 6e65 733a  n\nSupply Zones:
+0000a200: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000a210: 2020 2020 2020 2020 2069 6620 7375 7070           if supp
+0000a220: 6c79 5f7a 6f6e 6573 3a20 2023 2043 6865  ly_zones:  # Che
+0000a230: 636b 2069 6620 7375 7070 6c79 5f7a 6f6e  ck if supply_zon
+0000a240: 6573 2069 7320 6e6f 7420 656d 7074 790a  es is not empty.
+0000a250: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a260: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0000a270: 2028 7374 6172 742c 2065 6e64 2c20 7061   (start, end, pa
+0000a280: 7474 6572 6e2c 2062 6173 655f 636f 756e  ttern, base_coun
+0000a290: 7429 2069 6e20 656e 756d 6572 6174 6528  t) in enumerate(
+0000a2a0: 7375 7070 6c79 5f7a 6f6e 6573 293a 0a20  supply_zones):. 
+0000a2b0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a2c0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+0000a2d0: 745f 6672 6f6d 5f63 6d70 203d 2061 6273  t_from_cmp = abs
+0000a2e0: 2828 636d 7020 2d20 7375 7070 6c79 5f70  ((cmp - supply_p
+0000a2f0: 726f 7869 6d61 6c5f 6c69 6e65 735b 695d  roximal_lines[i]
+0000a300: 2920 2f20 636d 7029 202a 2031 3030 0a20  ) / cmp) * 100. 
+0000a310: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a320: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a330: 652e 7772 6974 6528 6622 5c6e 5c6e 5a6f  e.write(f"\n\nZo
+0000a340: 6e65 207b 692b 317d 3a20 5374 6172 7420  ne {i+1}: Start 
+0000a350: 4461 7465 3a20 7b64 6174 612e 696e 6465  Date: {data.inde
+0000a360: 785b 7374 6172 745d 2e64 6174 6528 297d  x[start].date()}
+0000a370: 2c20 456e 6420 4461 7465 3a20 7b64 6174  , End Date: {dat
+0000a380: 612e 696e 6465 785b 656e 645d 2e64 6174  a.index[end].dat
+0000a390: 6528 297d 2229 0a20 2020 2023 2020 2020  e()}").    #    
+0000a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3b0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000a3c0: 6622 5c6e 5061 7474 6572 6e20 4e61 6d65  f"\nPattern Name
+0000a3d0: 3a20 7b70 6174 7465 726e 7d2c 204e 756d  : {pattern}, Num
+0000a3e0: 6265 7220 6f66 2042 6173 6520 4361 6e64  ber of Base Cand
+0000a3f0: 6c65 3a20 7b62 6173 655f 636f 756e 747d  le: {base_count}
+0000a400: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a420: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
+0000a430: 4469 7374 616e 6365 2066 726f 6d20 434d  Distance from CM
+0000a440: 503a 207b 6469 7374 5f66 726f 6d5f 636d  P: {dist_from_cm
+0000a450: 703a 2e32 667d 2522 290a 2020 2020 2320  p:.2f}%").    # 
+0000a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a470: 2020 2020 2020 2020 6966 2073 7570 706c          if suppl
+0000a480: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
+0000a490: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
+0000a4c0: 225c 6e50 726f 7869 6d61 6c20 4c69 6e65  "\nProximal Line
+0000a4d0: 2050 7269 6365 3a20 7b73 7570 706c 795f   Price: {supply_
+0000a4e0: 7072 6f78 696d 616c 5f6c 696e 6573 5b69  proximal_lines[i
+0000a4f0: 5d3a 2e32 667d 2229 0a20 2020 2023 2020  ]:.2f}").    #  
+0000a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a510: 2020 2020 2020 2069 6620 7375 7070 6c79         if supply
+0000a520: 5f64 6973 7461 6c5f 6c69 6e65 733a 2020  _distal_lines:  
+0000a530: 2320 496e 636c 7564 6520 6469 7374 616c  # Include distal
+0000a540: 206c 696e 6520 7072 6963 6520 6966 2061   line price if a
+0000a550: 7661 696c 6162 6c65 0a20 2020 2023 2020  vailable.    #  
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a570: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+0000a580: 7772 6974 6528 6622 5c6e 4469 7374 616c  write(f"\nDistal
+0000a590: 204c 696e 6520 5072 6963 653a 207b 7375   Line Price: {su
+0000a5a0: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
+0000a5b0: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
+0000a5c0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000a5d0: 2020 2020 2020 2020 2020 2320 496e 636c            # Incl
+0000a5e0: 7564 6520 7a6f 6e65 2072 616e 6765 0a20  ude zone range. 
+0000a5f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a610: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
+0000a620: 5a6f 6e65 2052 616e 6765 3a20 7b73 7570  Zone Range: {sup
+0000a630: 706c 795f 7a6f 6e65 5f72 616e 6765 735b  ply_zone_ranges[
+0000a640: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
+0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a660: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000a670: 6966 2070 726f 7869 6d61 6c20 6c69 6e65  if proximal line
+0000a680: 2069 7320 7465 7374 6564 0a20 2020 2023   is tested.    #
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6a0: 2020 2020 2020 2020 2074 6573 7465 6420           tested 
+0000a6b0: 3d20 6973 5f7a 6f6e 655f 7465 7374 6564  = is_zone_tested
+0000a6c0: 2864 6174 612c 2073 7461 7274 2c20 656e  (data, start, en
+0000a6d0: 642c 2073 7570 706c 795f 7072 6f78 696d  d, supply_proxim
+0000a6e0: 616c 5f6c 696e 6573 5b69 5d29 0a20 2020  al_lines[i]).   
+0000a6f0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000a700: 2020 2020 2020 2020 2020 2069 6620 7465             if te
+0000a710: 7374 6564 3a0a 2020 2020 2320 2020 2020  sted:.    #     
+0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a730: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a740: 7465 2822 5c6e 5a6f 6e65 2069 7320 5465  te("\nZone is Te
+0000a750: 7374 6564 2229 0a20 2020 2023 2020 2020  sted").    #    
+0000a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a770: 2020 2020 2065 6c73 653a 0a20 2020 2023       else:.    #
+0000a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a790: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a7a0: 652e 7772 6974 6528 225c 6e46 7265 7368  e.write("\nFresh
+0000a7b0: 205a 6f6e 6522 290a 2020 2020 2320 2020   Zone").    #   
+0000a7c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000a7d0: 7365 3a0a 2020 2020 2320 2020 2020 2020  se:.    #       
+0000a7e0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000a7f0: 6c65 2e77 7269 7465 2822 5c6e 4e6f 2073  le.write("\nNo s
+0000a800: 7570 706c 7920 7a6f 6e65 2070 6174 7465  upply zone patte
+0000a810: 726e 7320 666f 756e 642e 2229 0a0a 2020  rns found.")..  
+0000a820: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a830: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
+0000a840: 6865 2073 746f 636b 2068 6173 2065 6974  he stock has eit
+0000a850: 6865 7220 6465 6d61 6e64 206f 7220 7375  her demand or su
+0000a860: 7070 6c79 207a 6f6e 6520 7769 7468 696e  pply zone within
+0000a870: 2074 6865 2074 6872 6573 686f 6c64 0a20   the threshold. 
+0000a880: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a890: 2020 2020 2068 6173 5f64 656d 616e 645f       has_demand_
+0000a8a0: 6f72 5f73 7570 706c 795f 7769 7468 696e  or_supply_within
+0000a8b0: 5f74 6872 6573 686f 6c64 203d 2061 6e79  _threshold = any
+0000a8c0: 280a 2020 2020 2320 2020 2020 2020 2020  (.    #         
+0000a8d0: 2020 2020 2020 2020 2020 2020 6162 7328              abs(
+0000a8e0: 2863 6d70 202d 2070 7269 6365 2920 2f20  (cmp - price) / 
+0000a8f0: 636d 7029 202a 2031 3030 203c 3d20 7468  cmp) * 100 <= th
+0000a900: 7265 7368 6f6c 645f 7065 7263 656e 740a  reshold_percent.
 0000a910: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a920: 2020 2020 2020 2320 4966 2074 6865 2073        # If the s
-0000a930: 746f 636b 2068 6173 2064 656d 616e 6420  tock has demand 
-0000a940: 6f72 2073 7570 706c 7920 7a6f 6e65 2077  or supply zone w
-0000a950: 6974 6869 6e20 7468 6520 7468 7265 7368  ithin the thresh
-0000a960: 6f6c 642c 2069 6e63 7265 6d65 6e74 2074  old, increment t
-0000a970: 6865 2063 6f75 6e74 0a20 2020 2023 2020  he count.    #  
-0000a980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a990: 6620 6861 735f 6465 6d61 6e64 5f6f 725f  f has_demand_or_
-0000a9a0: 7375 7070 6c79 5f77 6974 6869 6e5f 7468  supply_within_th
-0000a9b0: 7265 7368 6f6c 643a 0a20 2020 2023 2020  reshold:.    #  
-0000a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9d0: 2020 2063 6f75 6e74 5f66 696c 7465 7265     count_filtere
-0000a9e0: 645f 7374 6f63 6b73 202b 3d20 310a 0a20  d_stocks += 1.. 
-0000a9f0: 2020 2023 2020 2020 2023 2046 696c 7465     #     # Filte
-0000aa00: 7220 7374 6f63 6b73 2062 6173 6564 206f  r stocks based o
-0000aa10: 6e20 7468 6520 7065 7263 656e 7461 6765  n the percentage
-0000aa20: 2074 6872 6573 686f 6c64 2061 6e64 2073   threshold and s
-0000aa30: 6176 6520 7468 6520 7265 7375 6c74 7320  ave the results 
-0000aa40: 696e 2061 6e6f 7468 6572 2066 696c 650a  in another file.
-0000aa50: 2020 2020 2320 2020 2020 6669 6c74 6572      #     filter
-0000aa60: 6564 5f73 746f 636b 7320 3d20 7365 6c66  ed_stocks = self
-0000aa70: 2e66 696c 7465 725f 7374 6f63 6b73 5f62  .filter_stocks_b
-0000aa80: 795f 6469 7374 616e 6365 2873 746f 636b  y_distance(stock
-0000aa90: 5f73 796d 626f 6c73 2c20 7468 7265 7368  _symbols, thresh
-0000aaa0: 6f6c 645f 7065 7263 656e 742c 2074 696d  old_percent, tim
-0000aab0: 6566 7261 6d65 290a 0a20 2020 2023 2020  eframe)..    #  
-0000aac0: 2020 2077 6974 6820 6f70 656e 2822 6669     with open("fi
-0000aad0: 6c74 6572 6564 5f73 746f 636b 735f 6461  ltered_stocks_da
-0000aae0: 7461 2e74 7874 222c 2022 7722 2920 6173  ta.txt", "w") as
-0000aaf0: 2066 696c 653a 0a20 2020 2023 2020 2020   file:.    #    
-0000ab00: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-0000ab10: 6622 4e75 6d62 6572 206f 6620 7374 6f63  f"Number of stoc
-0000ab20: 6b73 2046 696c 7465 7265 643a 207b 636f  ks Filtered: {co
-0000ab30: 756e 745f 6669 6c74 6572 6564 5f73 746f  unt_filtered_sto
-0000ab40: 636b 737d 5c6e 5c6e 2229 0a20 2020 2023  cks}\n\n").    #
-0000ab50: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000ab60: 6974 6528 2246 696c 7465 7265 6420 5374  ite("Filtered St
-0000ab70: 6f63 6b20 4461 7461 3a5c 6e5c 6e22 290a  ock Data:\n\n").
-0000ab80: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000ab90: 2023 2020 2020 2020 2020 2066 6f72 2073   #         for s
-0000aba0: 796d 626f 6c20 696e 2066 696c 7465 7265  ymbol in filtere
-0000abb0: 645f 7374 6f63 6b73 3a0a 2020 2020 2320  d_stocks:.    # 
-0000abc0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0000abd0: 6174 6120 6973 206e 6f74 204e 6f6e 653a  ata is not None:
-0000abe0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000abf0: 2020 2020 2020 2063 6d70 203d 2064 6174         cmp = dat
-0000ac00: 612e 696c 6f63 5b2d 315d 5b27 436c 6f73  a.iloc[-1]['Clos
-0000ac10: 6527 5d20 2023 2043 7572 7265 6e74 206d  e']  # Current m
-0000ac20: 6172 6b65 7420 7072 6963 650a 2020 2020  arket price.    
-0000ac30: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000ac40: 2020 6465 6d61 6e64 5f7a 6f6e 6573 2c20    demand_zones, 
-0000ac50: 5f2c 205f 2c20 6465 6d61 6e64 5f70 726f  _, _, demand_pro
-0000ac60: 7869 6d61 6c5f 6c69 6e65 203d 2073 656c  ximal_line = sel
-0000ac70: 662e 6964 656e 7469 6679 5f64 656d 616e  f.identify_deman
-0000ac80: 645f 7a6f 6e65 2864 6174 612c 2063 6d70  d_zone(data, cmp
-0000ac90: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-0000aca0: 2020 2020 2020 2020 7375 7070 6c79 5f7a          supply_z
-0000acb0: 6f6e 6573 2c20 5f2c 205f 2c20 7375 7070  ones, _, _, supp
-0000acc0: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-0000acd0: 203d 2073 656c 662e 6964 656e 7469 6679   = self.identify
-0000ace0: 5f73 7570 706c 795f 7a6f 6e65 2864 6174  _supply_zone(dat
-0000acf0: 612c 2063 6d70 290a 0a20 2020 2023 2020  a, cmp)..    #  
-0000ad00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000ad10: 2053 7465 7020 313a 2043 616c 6375 6c61   Step 1: Calcula
-0000ad20: 7465 2070 726f 7869 6d61 6c20 6c69 6e65  te proximal line
-0000ad30: 7320 666f 7220 6465 6d61 6e64 2061 6e64  s for demand and
-0000ad40: 2073 7570 706c 7920 7a6f 6e65 730a 2020   supply zones.  
-0000ad50: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000ad60: 2020 2020 6465 6d61 6e64 5f70 726f 7869      demand_proxi
-0000ad70: 6d61 6c5f 6c69 6e65 7320 3d20 7365 6c66  mal_lines = self
-0000ad80: 2e63 616c 6375 6c61 7465 5f64 656d 616e  .calculate_deman
-0000ad90: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-0000ada0: 2864 6174 612c 2064 656d 616e 645f 7a6f  (data, demand_zo
-0000adb0: 6e65 7329 0a20 2020 2023 2020 2020 2020  nes).    #      
-0000adc0: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-0000add0: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
-0000ade0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-0000adf0: 655f 7375 7070 6c79 5f70 726f 7869 6d61  e_supply_proxima
-0000ae00: 6c5f 6c69 6e65 7328 6461 7461 2c20 7375  l_lines(data, su
-0000ae10: 7070 6c79 5f7a 6f6e 6573 290a 2020 2020  pply_zones).    
-0000ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae30: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000ae40: 2020 2020 2020 2023 2053 7465 7020 323a         # Step 2:
-0000ae50: 2043 616c 6375 6c61 7465 2064 6973 7461   Calculate dista
-0000ae60: 6c20 6c69 6e65 7320 666f 7220 6465 6d61  l lines for dema
-0000ae70: 6e64 207a 6f6e 6573 2061 6e64 2073 7570  nd zones and sup
-0000ae80: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-0000aeb0: 6e65 7320 3d20 7365 6c66 2e63 616c 6375  nes = self.calcu
-0000aec0: 6c61 7465 5f64 656d 616e 645f 6469 7374  late_demand_dist
-0000aed0: 616c 5f6c 696e 6573 2864 6174 612c 2064  al_lines(data, d
-0000aee0: 656d 616e 645f 7a6f 6e65 7329 0a20 2020  emand_zones).   
-0000aef0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000af00: 2020 2073 7570 706c 795f 6469 7374 616c     supply_distal
-0000af10: 5f6c 696e 6573 203d 2073 656c 662e 6361  _lines = self.ca
-0000af20: 6c63 756c 6174 655f 7375 7070 6c79 5f64  lculate_supply_d
-0000af30: 6973 7461 6c5f 6c69 6e65 7328 6461 7461  istal_lines(data
-0000af40: 2c20 7375 7070 6c79 5f7a 6f6e 6573 290a  , supply_zones).
-0000af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af60: 2020 2020 0a20 2020 2023 2020 2020 2020      .    #      
-0000af70: 2020 2020 2020 2020 2020 2023 2043 616c             # Cal
-0000af80: 6375 6c61 7465 2072 616e 6765 206f 6620  culate range of 
-0000af90: 6465 6d61 6e64 2061 6e64 2073 7570 706c  demand and suppl
-0000afa0: 7920 7a6f 6e65 730a 2020 2020 2320 2020  y zones.    #   
-0000afb0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000afc0: 6d61 6e64 5f7a 6f6e 655f 7261 6e67 6573  mand_zone_ranges
-0000afd0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-0000afe0: 655f 6465 6d61 6e64 5f7a 6f6e 655f 7261  e_demand_zone_ra
-0000aff0: 6e67 6573 2864 656d 616e 645f 7a6f 6e65  nges(demand_zone
-0000b000: 732c 2064 656d 616e 645f 7072 6f78 696d  s, demand_proxim
-0000b010: 616c 5f6c 696e 6573 2c20 6465 6d61 6e64  al_lines, demand
-0000b020: 5f64 6973 7461 6c5f 6c69 6e65 7329 0a20  _distal_lines). 
-0000b030: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b040: 2020 2020 2073 7570 706c 795f 7a6f 6e65       supply_zone
-0000b050: 5f72 616e 6765 7320 3d20 7365 6c66 2e63  _ranges = self.c
-0000b060: 616c 6375 6c61 7465 5f73 7570 706c 795f  alculate_supply_
-0000b070: 7a6f 6e65 5f72 616e 6765 7328 7375 7070  zone_ranges(supp
-0000b080: 6c79 5f7a 6f6e 6573 2c20 7375 7070 6c79  ly_zones, supply
-0000b090: 5f70 726f 7869 6d61 6c5f 6c69 6e65 732c  _proximal_lines,
-0000b0a0: 2073 7570 706c 795f 6469 7374 616c 5f6c   supply_distal_l
-0000b0b0: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
-0000b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0d0: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0f0: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
-0000b100: 7374 6f63 6b20 6861 7320 6569 7468 6572  stock has either
-0000b110: 2064 656d 616e 6420 6f72 2073 7570 706c   demand or suppl
-0000b120: 7920 7a6f 6e65 2077 6974 6869 6e20 7468  y zone within th
-0000b130: 6520 7468 7265 7368 6f6c 640a 2020 2020  e threshold.    
-0000b140: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000b150: 2020 6861 735f 6465 6d61 6e64 5f6f 725f    has_demand_or_
-0000b160: 7375 7070 6c79 5f77 6974 6869 6e5f 7468  supply_within_th
-0000b170: 7265 7368 6f6c 6420 3d20 616e 7928 0a20  reshold = any(. 
-0000b180: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b190: 2020 2020 2020 2020 2061 6273 2828 636d           abs((cm
-0000b1a0: 7020 2d20 7072 6963 6529 202f 2063 6d70  p - price) / cmp
-0000b1b0: 2920 2a20 3130 3020 3c3d 2074 6872 6573  ) * 100 <= thres
-0000b1c0: 686f 6c64 5f70 6572 6365 6e74 0a20 2020  hold_percent.   
-0000b1d0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b1e0: 2020 2020 2020 2066 6f72 2070 7269 6365         for price
-0000b1f0: 2069 6e20 6465 6d61 6e64 5f70 726f 7869   in demand_proxi
-0000b200: 6d61 6c5f 6c69 6e65 7320 2b20 7375 7070  mal_lines + supp
-0000b210: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-0000b220: 730a 2020 2020 2320 2020 2020 2020 2020  s.    #         
-0000b230: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000b240: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+0000a920: 2020 2020 2020 2020 2020 666f 7220 7072            for pr
+0000a930: 6963 6520 696e 2064 656d 616e 645f 7072  ice in demand_pr
+0000a940: 6f78 696d 616c 5f6c 696e 6573 202b 2073  oximal_lines + s
+0000a950: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
+0000a960: 696e 6573 0a20 2020 2023 2020 2020 2020  ines.    #      
+0000a970: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a990: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+0000a9a0: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+0000a9b0: 2073 746f 636b 2068 6173 2064 656d 616e   stock has deman
+0000a9c0: 6420 6f72 2073 7570 706c 7920 7a6f 6e65  d or supply zone
+0000a9d0: 2077 6974 6869 6e20 7468 6520 7468 7265   within the thre
+0000a9e0: 7368 6f6c 642c 2069 6e63 7265 6d65 6e74  shold, increment
+0000a9f0: 2074 6865 2063 6f75 6e74 0a20 2020 2023   the count.    #
+0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa10: 2069 6620 6861 735f 6465 6d61 6e64 5f6f   if has_demand_o
+0000aa20: 725f 7375 7070 6c79 5f77 6974 6869 6e5f  r_supply_within_
+0000aa30: 7468 7265 7368 6f6c 643a 0a20 2020 2023  threshold:.    #
+0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa50: 2020 2020 2063 6f75 6e74 5f66 696c 7465       count_filte
+0000aa60: 7265 645f 7374 6f63 6b73 202b 3d20 310a  red_stocks += 1.
+0000aa70: 0a20 2020 2023 2020 2020 2023 2046 696c  .    #     # Fil
+0000aa80: 7465 7220 7374 6f63 6b73 2062 6173 6564  ter stocks based
+0000aa90: 206f 6e20 7468 6520 7065 7263 656e 7461   on the percenta
+0000aaa0: 6765 2074 6872 6573 686f 6c64 2061 6e64  ge threshold and
+0000aab0: 2073 6176 6520 7468 6520 7265 7375 6c74   save the result
+0000aac0: 7320 696e 2061 6e6f 7468 6572 2066 696c  s in another fil
+0000aad0: 650a 2020 2020 2320 2020 2020 6669 6c74  e.    #     filt
+0000aae0: 6572 6564 5f73 746f 636b 7320 3d20 7365  ered_stocks = se
+0000aaf0: 6c66 2e66 696c 7465 725f 7374 6f63 6b73  lf.filter_stocks
+0000ab00: 5f62 795f 6469 7374 616e 6365 2873 746f  _by_distance(sto
+0000ab10: 636b 5f73 796d 626f 6c73 2c20 7468 7265  ck_symbols, thre
+0000ab20: 7368 6f6c 645f 7065 7263 656e 742c 2074  shold_percent, t
+0000ab30: 696d 6566 7261 6d65 290a 0a20 2020 2023  imeframe)..    #
+0000ab40: 2020 2020 2077 6974 6820 6f70 656e 2822       with open("
+0000ab50: 6669 6c74 6572 6564 5f73 746f 636b 735f  filtered_stocks_
+0000ab60: 6461 7461 2e74 7874 222c 2022 7722 2920  data.txt", "w") 
+0000ab70: 6173 2066 696c 653a 0a20 2020 2023 2020  as file:.    #  
+0000ab80: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+0000ab90: 6528 6622 4e75 6d62 6572 206f 6620 7374  e(f"Number of st
+0000aba0: 6f63 6b73 2046 696c 7465 7265 643a 207b  ocks Filtered: {
+0000abb0: 636f 756e 745f 6669 6c74 6572 6564 5f73  count_filtered_s
+0000abc0: 746f 636b 737d 5c6e 5c6e 2229 0a20 2020  tocks}\n\n").   
+0000abd0: 2023 2020 2020 2020 2020 2066 696c 652e   #         file.
+0000abe0: 7772 6974 6528 2246 696c 7465 7265 6420  write("Filtered 
+0000abf0: 5374 6f63 6b20 4461 7461 3a5c 6e5c 6e22  Stock Data:\n\n"
+0000ac00: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0000ac10: 2020 2023 2020 2020 2020 2020 2066 6f72     #         for
+0000ac20: 2073 796d 626f 6c20 696e 2066 696c 7465   symbol in filte
+0000ac30: 7265 645f 7374 6f63 6b73 3a0a 2020 2020  red_stocks:.    
+0000ac40: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+0000ac50: 2064 6174 6120 6973 206e 6f74 204e 6f6e   data is not Non
+0000ac60: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
+0000ac70: 2020 2020 2020 2020 2063 6d70 203d 2064           cmp = d
+0000ac80: 6174 612e 696c 6f63 5b2d 315d 5b27 436c  ata.iloc[-1]['Cl
+0000ac90: 6f73 6527 5d20 2023 2043 7572 7265 6e74  ose']  # Current
+0000aca0: 206d 6172 6b65 7420 7072 6963 650a 2020   market price.  
+0000acb0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000acc0: 2020 2020 6465 6d61 6e64 5f7a 6f6e 6573      demand_zones
+0000acd0: 2c20 5f2c 205f 2c20 6465 6d61 6e64 5f70  , _, _, demand_p
+0000ace0: 726f 7869 6d61 6c5f 6c69 6e65 203d 2073  roximal_line = s
+0000acf0: 656c 662e 6964 656e 7469 6679 5f64 656d  elf.identify_dem
+0000ad00: 616e 645f 7a6f 6e65 2864 6174 612c 2063  and_zone(data, c
+0000ad10: 6d70 290a 2020 2020 2320 2020 2020 2020  mp).    #       
+0000ad20: 2020 2020 2020 2020 2020 7375 7070 6c79            supply
+0000ad30: 5f7a 6f6e 6573 2c20 5f2c 205f 2c20 7375  _zones, _, _, su
+0000ad40: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+0000ad50: 6e65 203d 2073 656c 662e 6964 656e 7469  ne = self.identi
+0000ad60: 6679 5f73 7570 706c 795f 7a6f 6e65 2864  fy_supply_zone(d
+0000ad70: 6174 612c 2063 6d70 290a 0a20 2020 2023  ata, cmp)..    #
+0000ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad90: 2023 2053 7465 7020 313a 2043 616c 6375   # Step 1: Calcu
+0000ada0: 6c61 7465 2070 726f 7869 6d61 6c20 6c69  late proximal li
+0000adb0: 6e65 7320 666f 7220 6465 6d61 6e64 2061  nes for demand a
+0000adc0: 6e64 2073 7570 706c 7920 7a6f 6e65 730a  nd supply zones.
+0000add0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000ade0: 2020 2020 2020 6465 6d61 6e64 5f70 726f        demand_pro
+0000adf0: 7869 6d61 6c5f 6c69 6e65 7320 3d20 7365  ximal_lines = se
+0000ae00: 6c66 2e63 616c 6375 6c61 7465 5f64 656d  lf.calculate_dem
+0000ae10: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
+0000ae20: 6573 2864 6174 612c 2064 656d 616e 645f  es(data, demand_
+0000ae30: 7a6f 6e65 7329 0a20 2020 2023 2020 2020  zones).    #    
+0000ae40: 2020 2020 2020 2020 2020 2020 2073 7570               sup
+0000ae50: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
+0000ae60: 6573 203d 2073 656c 662e 6361 6c63 756c  es = self.calcul
+0000ae70: 6174 655f 7375 7070 6c79 5f70 726f 7869  ate_supply_proxi
+0000ae80: 6d61 6c5f 6c69 6e65 7328 6461 7461 2c20  mal_lines(data, 
+0000ae90: 7375 7070 6c79 5f7a 6f6e 6573 290a 2020  supply_zones).  
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aeb0: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
+0000aec0: 2020 2020 2020 2020 2023 2053 7465 7020           # Step 
+0000aed0: 323a 2043 616c 6375 6c61 7465 2064 6973  2: Calculate dis
+0000aee0: 7461 6c20 6c69 6e65 7320 666f 7220 6465  tal lines for de
+0000aef0: 6d61 6e64 207a 6f6e 6573 2061 6e64 2073  mand zones and s
+0000af00: 7570 706c 7920 7a6f 6e65 730a 2020 2020  upply zones.    
+0000af10: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000af20: 2020 6465 6d61 6e64 5f64 6973 7461 6c5f    demand_distal_
+0000af30: 6c69 6e65 7320 3d20 7365 6c66 2e63 616c  lines = self.cal
+0000af40: 6375 6c61 7465 5f64 656d 616e 645f 6469  culate_demand_di
+0000af50: 7374 616c 5f6c 696e 6573 2864 6174 612c  stal_lines(data,
+0000af60: 2064 656d 616e 645f 7a6f 6e65 7329 0a20   demand_zones). 
+0000af70: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000af80: 2020 2020 2073 7570 706c 795f 6469 7374       supply_dist
+0000af90: 616c 5f6c 696e 6573 203d 2073 656c 662e  al_lines = self.
+0000afa0: 6361 6c63 756c 6174 655f 7375 7070 6c79  calculate_supply
+0000afb0: 5f64 6973 7461 6c5f 6c69 6e65 7328 6461  _distal_lines(da
+0000afc0: 7461 2c20 7375 7070 6c79 5f7a 6f6e 6573  ta, supply_zones
+0000afd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000afe0: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+0000aff0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+0000b000: 616c 6375 6c61 7465 2072 616e 6765 206f  alculate range o
+0000b010: 6620 6465 6d61 6e64 2061 6e64 2073 7570  f demand and sup
+0000b020: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
+0000b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b040: 6465 6d61 6e64 5f7a 6f6e 655f 7261 6e67  demand_zone_rang
+0000b050: 6573 203d 2073 656c 662e 6361 6c63 756c  es = self.calcul
+0000b060: 6174 655f 6465 6d61 6e64 5f7a 6f6e 655f  ate_demand_zone_
+0000b070: 7261 6e67 6573 2864 656d 616e 645f 7a6f  ranges(demand_zo
+0000b080: 6e65 732c 2064 656d 616e 645f 7072 6f78  nes, demand_prox
+0000b090: 696d 616c 5f6c 696e 6573 2c20 6465 6d61  imal_lines, dema
+0000b0a0: 6e64 5f64 6973 7461 6c5f 6c69 6e65 7329  nd_distal_lines)
+0000b0b0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000b0c0: 2020 2020 2020 2073 7570 706c 795f 7a6f         supply_zo
+0000b0d0: 6e65 5f72 616e 6765 7320 3d20 7365 6c66  ne_ranges = self
+0000b0e0: 2e63 616c 6375 6c61 7465 5f73 7570 706c  .calculate_suppl
+0000b0f0: 795f 7a6f 6e65 5f72 616e 6765 7328 7375  y_zone_ranges(su
+0000b100: 7070 6c79 5f7a 6f6e 6573 2c20 7375 7070  pply_zones, supp
+0000b110: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
+0000b120: 732c 2073 7570 706c 795f 6469 7374 616c  s, supply_distal
+0000b130: 5f6c 696e 6573 290a 2020 2020 2020 2020  _lines).        
+0000b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b150: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0000b160: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b170: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
+0000b180: 6520 7374 6f63 6b20 6861 7320 6569 7468  e stock has eith
+0000b190: 6572 2064 656d 616e 6420 6f72 2073 7570  er demand or sup
+0000b1a0: 706c 7920 7a6f 6e65 2077 6974 6869 6e20  ply zone within 
+0000b1b0: 7468 6520 7468 7265 7368 6f6c 640a 2020  the threshold.  
+0000b1c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000b1d0: 2020 2020 6861 735f 6465 6d61 6e64 5f6f      has_demand_o
+0000b1e0: 725f 7375 7070 6c79 5f77 6974 6869 6e5f  r_supply_within_
+0000b1f0: 7468 7265 7368 6f6c 6420 3d20 616e 7928  threshold = any(
+0000b200: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000b210: 2020 2020 2020 2020 2020 2061 6273 2828             abs((
+0000b220: 636d 7020 2d20 7072 6963 6529 202f 2063  cmp - price) / c
+0000b230: 6d70 2920 2a20 3130 3020 3c3d 2074 6872  mp) * 100 <= thr
+0000b240: 6573 686f 6c64 5f70 6572 6365 6e74 0a20  eshold_percent. 
 0000b250: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b260: 2020 2020 2023 2049 6620 7468 6520 7374       # If the st
-0000b270: 6f63 6b20 6861 7320 6465 6d61 6e64 206f  ock has demand o
-0000b280: 7220 7375 7070 6c79 207a 6f6e 6520 7769  r supply zone wi
-0000b290: 7468 696e 2074 6865 2074 6872 6573 686f  thin the thresho
-0000b2a0: 6c64 2c20 7772 6974 6520 6974 7320 616e  ld, write its an
-0000b2b0: 616c 7973 6973 0a20 2020 2023 2020 2020  alysis.    #    
-0000b2c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b2d0: 6861 735f 6465 6d61 6e64 5f6f 725f 7375  has_demand_or_su
-0000b2e0: 7070 6c79 5f77 6974 6869 6e5f 7468 7265  pply_within_thre
-0000b2f0: 7368 6f6c 643a 0a20 2020 2023 2020 2020  shold:.    #    
-0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b310: 2066 696c 652e 7772 6974 6528 6622 416e   file.write(f"An
-0000b320: 616c 7973 6973 2066 6f72 207b 7379 6d62  alysis for {symb
-0000b330: 6f6c 7d20 287b 7469 6d65 6672 616d 657d  ol} ({timeframe}
-0000b340: 293a 5c6e 2229 0a20 2020 2020 2020 2020  ):\n").         
-0000b350: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-0000b360: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000b370: 2020 2020 2020 2020 2020 2320 4465 6d61            # Dema
-0000b380: 6e64 205a 6f6e 6573 0a20 2020 2023 2020  nd Zones.    #  
-0000b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3a0: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
-0000b3b0: 6e5c 6e44 656d 616e 6420 5a6f 6e65 733a  n\nDemand Zones:
-0000b3c0: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-0000b3d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b3e0: 6465 6d61 6e64 5f7a 6f6e 6573 3a20 2023  demand_zones:  #
-0000b3f0: 2043 6865 636b 2069 6620 6465 6d61 6e64   Check if demand
-0000b400: 5f7a 6f6e 6573 2069 7320 6e6f 7420 656d  _zones is not em
-0000b410: 7074 790a 2020 2020 2320 2020 2020 2020  pty.    #       
-0000b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b430: 2020 666f 7220 692c 2028 7374 6172 742c    for i, (start,
-0000b440: 2065 6e64 2c20 7061 7474 6572 6e2c 2062   end, pattern, b
-0000b450: 6173 655f 636f 756e 7429 2069 6e20 656e  ase_count) in en
-0000b460: 756d 6572 6174 6528 6465 6d61 6e64 5f7a  umerate(demand_z
-0000b470: 6f6e 6573 293a 0a20 2020 2023 2020 2020  ones):.    #    
-0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b490: 2020 2020 2020 2020 2064 6973 745f 6672           dist_fr
-0000b4a0: 6f6d 5f63 6d70 203d 2061 6273 2828 636d  om_cmp = abs((cm
-0000b4b0: 7020 2d20 6465 6d61 6e64 5f70 726f 7869  p - demand_proxi
-0000b4c0: 6d61 6c5f 6c69 6e65 735b 695d 2920 2f20  mal_lines[i]) / 
-0000b4d0: 636d 7029 202a 2031 3030 0a20 2020 2023  cmp) * 100.    #
-0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b500: 6162 7328 6469 7374 5f66 726f 6d5f 636d  abs(dist_from_cm
-0000b510: 7029 203c 3d20 7468 7265 7368 6f6c 645f  p) <= threshold_
-0000b520: 7065 7263 656e 743a 2020 2320 4368 6563  percent:  # Chec
-0000b530: 6b20 6966 2064 6973 745f 6672 6f6d 5f63  k if dist_from_c
-0000b540: 6d70 2069 7320 7769 7468 696e 2074 6872  mp is within thr
-0000b550: 6573 686f 6c64 0a20 2020 2023 2020 2020  eshold.    #    
-0000b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b570: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000b580: 652e 7772 6974 6528 6622 5c6e 5c6e 5a6f  e.write(f"\n\nZo
-0000b590: 6e65 207b 692b 317d 3a20 5374 6172 7420  ne {i+1}: Start 
-0000b5a0: 4461 7465 3a20 7b64 6174 612e 696e 6465  Date: {data.inde
-0000b5b0: 785b 7374 6172 745d 2e64 6174 6528 297d  x[start].date()}
-0000b5c0: 2c20 456e 6420 4461 7465 3a20 7b64 6174  , End Date: {dat
-0000b5d0: 612e 696e 6465 785b 656e 645d 2e64 6174  a.index[end].dat
-0000b5e0: 6528 297d 2229 0a20 2020 2023 2020 2020  e()}").    #    
-0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b600: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000b610: 652e 7772 6974 6528 6622 5c6e 5061 7474  e.write(f"\nPatt
-0000b620: 6572 6e20 4e61 6d65 3a20 7b70 6174 7465  ern Name: {patte
-0000b630: 726e 7d2c 204e 756d 6265 7220 6f66 2042  rn}, Number of B
-0000b640: 6173 6520 4361 6e64 6c65 3a20 7b62 6173  ase Candle: {bas
-0000b650: 655f 636f 756e 747d 2229 0a20 2020 2023  e_count}").    #
-0000b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b260: 2020 2020 2020 2020 2066 6f72 2070 7269           for pri
+0000b270: 6365 2069 6e20 6465 6d61 6e64 5f70 726f  ce in demand_pro
+0000b280: 7869 6d61 6c5f 6c69 6e65 7320 2b20 7375  ximal_lines + su
+0000b290: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+0000b2a0: 6e65 730a 2020 2020 2320 2020 2020 2020  nes.    #       
+0000b2b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000b2e0: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0000b2f0: 7374 6f63 6b20 6861 7320 6465 6d61 6e64  stock has demand
+0000b300: 206f 7220 7375 7070 6c79 207a 6f6e 6520   or supply zone 
+0000b310: 7769 7468 696e 2074 6865 2074 6872 6573  within the thres
+0000b320: 686f 6c64 2c20 7772 6974 6520 6974 7320  hold, write its 
+0000b330: 616e 616c 7973 6973 0a20 2020 2023 2020  analysis.    #  
+0000b340: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b350: 6620 6861 735f 6465 6d61 6e64 5f6f 725f  f has_demand_or_
+0000b360: 7375 7070 6c79 5f77 6974 6869 6e5f 7468  supply_within_th
+0000b370: 7265 7368 6f6c 643a 0a20 2020 2023 2020  reshold:.    #  
+0000b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b390: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000b3a0: 416e 616c 7973 6973 2066 6f72 207b 7379  Analysis for {sy
+0000b3b0: 6d62 6f6c 7d20 287b 7469 6d65 6672 616d  mbol} ({timefram
+0000b3c0: 657d 293a 5c6e 2229 0a20 2020 2020 2020  e}):\n").       
+0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3e0: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+0000b3f0: 2020 2020 2020 2020 2020 2020 2320 4465              # De
+0000b400: 6d61 6e64 205a 6f6e 6573 0a20 2020 2023  mand Zones.    #
+0000b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b420: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000b430: 225c 6e5c 6e44 656d 616e 6420 5a6f 6e65  "\n\nDemand Zone
+0000b440: 733a 2229 0a20 2020 2023 2020 2020 2020  s:").    #      
+0000b450: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b460: 6620 6465 6d61 6e64 5f7a 6f6e 6573 3a20  f demand_zones: 
+0000b470: 2023 2043 6865 636b 2069 6620 6465 6d61   # Check if dema
+0000b480: 6e64 5f7a 6f6e 6573 2069 7320 6e6f 7420  nd_zones is not 
+0000b490: 656d 7074 790a 2020 2020 2320 2020 2020  empty.    #     
+0000b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4b0: 2020 2020 666f 7220 692c 2028 7374 6172      for i, (star
+0000b4c0: 742c 2065 6e64 2c20 7061 7474 6572 6e2c  t, end, pattern,
+0000b4d0: 2062 6173 655f 636f 756e 7429 2069 6e20   base_count) in 
+0000b4e0: 656e 756d 6572 6174 6528 6465 6d61 6e64  enumerate(demand
+0000b4f0: 5f7a 6f6e 6573 293a 0a20 2020 2023 2020  _zones):.    #  
+0000b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b510: 2020 2020 2020 2020 2020 2064 6973 745f             dist_
+0000b520: 6672 6f6d 5f63 6d70 203d 2061 6273 2828  from_cmp = abs((
+0000b530: 636d 7020 2d20 6465 6d61 6e64 5f70 726f  cmp - demand_pro
+0000b540: 7869 6d61 6c5f 6c69 6e65 735b 695d 2920  ximal_lines[i]) 
+0000b550: 2f20 636d 7029 202a 2031 3030 0a20 2020  / cmp) * 100.   
+0000b560: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b570: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b580: 6620 6162 7328 6469 7374 5f66 726f 6d5f  f abs(dist_from_
+0000b590: 636d 7029 203c 3d20 7468 7265 7368 6f6c  cmp) <= threshol
+0000b5a0: 645f 7065 7263 656e 743a 2020 2320 4368  d_percent:  # Ch
+0000b5b0: 6563 6b20 6966 2064 6973 745f 6672 6f6d  eck if dist_from
+0000b5c0: 5f63 6d70 2069 7320 7769 7468 696e 2074  _cmp is within t
+0000b5d0: 6872 6573 686f 6c64 0a20 2020 2023 2020  hreshold.    #  
+0000b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b600: 696c 652e 7772 6974 6528 6622 5c6e 5c6e  ile.write(f"\n\n
+0000b610: 5a6f 6e65 207b 692b 317d 3a20 5374 6172  Zone {i+1}: Star
+0000b620: 7420 4461 7465 3a20 7b64 6174 612e 696e  t Date: {data.in
+0000b630: 6465 785b 7374 6172 745d 2e64 6174 6528  dex[start].date(
+0000b640: 297d 2c20 456e 6420 4461 7465 3a20 7b64  )}, End Date: {d
+0000b650: 6174 612e 696e 6465 785b 656e 645d 2e64  ata.index[end].d
+0000b660: 6174 6528 297d 2229 0a20 2020 2023 2020  ate()}").    #  
 0000b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b680: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000b690: 4469 7374 616e 6365 2066 726f 6d20 434d  Distance from CM
-0000b6a0: 503a 207b 6469 7374 5f66 726f 6d5f 636d  P: {dist_from_cm
-0000b6b0: 703a 2e32 667d 2522 290a 2020 2020 2320  p:.2f}%").    # 
-0000b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 6966 2064 656d 616e 645f 7072 6f78 696d  if demand_proxim
-0000b6f0: 616c 5f6c 696e 6573 3a0a 2020 2020 2320  al_lines:.    # 
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b720: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
-0000b730: 225c 6e50 726f 7869 6d61 6c20 4c69 6e65  "\nProximal Line
-0000b740: 2050 7269 6365 3a20 7b64 656d 616e 645f   Price: {demand_
-0000b750: 7072 6f78 696d 616c 5f6c 696e 6573 5b69  proximal_lines[i
-0000b760: 5d3a 2e32 667d 2229 0a20 2020 2023 2020  ]:.2f}").    #  
-0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b780: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000b790: 6620 6465 6d61 6e64 5f64 6973 7461 6c5f  f demand_distal_
-0000b7a0: 6c69 6e65 733a 2020 2320 496e 636c 7564  lines:  # Includ
-0000b7b0: 6520 6469 7374 616c 206c 696e 6520 7072  e distal line pr
-0000b7c0: 6963 6520 6966 2061 7661 696c 6162 6c65  ice if available
-0000b7d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7f0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-0000b800: 7772 6974 6528 6622 5c6e 4469 7374 616c  write(f"\nDistal
-0000b810: 204c 696e 6520 5072 6963 653a 207b 6465   Line Price: {de
-0000b820: 6d61 6e64 5f64 6973 7461 6c5f 6c69 6e65  mand_distal_line
-0000b830: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
-0000b840: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b860: 2020 2320 496e 636c 7564 6520 7a6f 6e65    # Include zone
-0000b870: 2072 616e 6765 0a20 2020 2023 2020 2020   range.    #    
-0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000b8b0: 5a6f 6e65 2052 616e 6765 3a20 7b64 656d  Zone Range: {dem
-0000b8c0: 616e 645f 7a6f 6e65 5f72 616e 6765 735b  and_zone_ranges[
-0000b8d0: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
-0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b900: 2320 4368 6563 6b20 6966 2070 726f 7869  # Check if proxi
-0000b910: 6d61 6c20 6c69 6e65 2069 7320 7465 7374  mal line is test
-0000b920: 6564 0a20 2020 2023 2020 2020 2020 2020  ed.    #        
-0000b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b940: 2020 2020 2020 2020 2074 6573 7465 6420           tested 
-0000b950: 3d20 6973 5f7a 6f6e 655f 7465 7374 6564  = is_zone_tested
-0000b960: 2864 6174 612c 2073 7461 7274 2c20 656e  (data, start, en
-0000b970: 642c 2064 656d 616e 645f 7072 6f78 696d  d, demand_proxim
-0000b980: 616c 5f6c 696e 6573 5b69 5d29 0a20 2020  al_lines[i]).   
-0000b990: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9b0: 2020 2069 6620 7465 7374 6564 3a0a 2020     if tested:.  
-0000b9c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9e0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
-0000b9f0: 7465 2822 5c6e 5a6f 6e65 2069 7320 5465  te("\nZone is Te
-0000ba00: 7374 6564 2229 0a20 2020 2023 2020 2020  sted").    #    
-0000ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba20: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000ba30: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
-0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba50: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000ba60: 652e 7772 6974 6528 225c 6e46 7265 7368  e.write("\nFresh
-0000ba70: 205a 6f6e 6522 290a 2020 2020 2320 2020   Zone").    #   
-0000ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba90: 2020 656c 7365 3a0a 2020 2020 2320 2020    else:.    #   
-0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bab0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-0000bac0: 2822 5c6e 4e6f 2064 656d 616e 6420 7a6f  ("\nNo demand zo
-0000bad0: 6e65 2070 6174 7465 726e 7320 666f 756e  ne patterns foun
-0000bae0: 642e 2229 0a0a 2020 2020 2320 2020 2020  d.")..    #     
-0000baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb00: 2320 5375 7070 6c79 205a 6f6e 6573 0a20  # Supply Zones. 
-0000bb10: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000bb20: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000bb30: 6974 6528 225c 6e5c 6e53 7570 706c 7920  ite("\n\nSupply 
-0000bb40: 5a6f 6e65 733a 2229 0a20 2020 2023 2020  Zones:").    #  
-0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb60: 2020 2069 6620 7375 7070 6c79 5f7a 6f6e     if supply_zon
-0000bb70: 6573 3a20 2023 2043 6865 636b 2069 6620  es:  # Check if 
-0000bb80: 7375 7070 6c79 5f7a 6f6e 6573 2069 7320  supply_zones is 
-0000bb90: 6e6f 7420 656d 7074 790a 2020 2020 2320  not empty.    # 
-0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbb0: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
-0000bbc0: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
-0000bbd0: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
-0000bbe0: 2069 6e20 656e 756d 6572 6174 6528 7375   in enumerate(su
-0000bbf0: 7070 6c79 5f7a 6f6e 6573 293a 0a20 2020  pply_zones):.   
-0000bc00: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000bc10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000bc20: 6973 745f 6672 6f6d 5f63 6d70 203d 2061  ist_from_cmp = a
-0000bc30: 6273 2828 636d 7020 2d20 7375 7070 6c79  bs((cmp - supply
-0000bc40: 5f70 726f 7869 6d61 6c5f 6c69 6e65 735b  _proximal_lines[
-0000bc50: 695d 2920 2f20 636d 7029 202a 2031 3030  i]) / cmp) * 100
-0000bc60: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc80: 2020 2069 6620 6162 7328 6469 7374 5f66     if abs(dist_f
-0000bc90: 726f 6d5f 636d 7029 203c 3d20 7468 7265  rom_cmp) <= thre
-0000bca0: 7368 6f6c 645f 7065 7263 656e 743a 2020  shold_percent:  
-0000bcb0: 2320 4368 6563 6b20 6966 2064 6973 745f  # Check if dist_
-0000bcc0: 6672 6f6d 5f63 6d70 2069 7320 7769 7468  from_cmp is with
-0000bcd0: 696e 2074 6872 6573 686f 6c64 0a20 2020  in threshold.   
-0000bce0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b680: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b690: 696c 652e 7772 6974 6528 6622 5c6e 5061  ile.write(f"\nPa
+0000b6a0: 7474 6572 6e20 4e61 6d65 3a20 7b70 6174  ttern Name: {pat
+0000b6b0: 7465 726e 7d2c 204e 756d 6265 7220 6f66  tern}, Number of
+0000b6c0: 2042 6173 6520 4361 6e64 6c65 3a20 7b62   Base Candle: {b
+0000b6d0: 6173 655f 636f 756e 747d 2229 0a20 2020  ase_count}").   
+0000b6e0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b700: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000b710: 5c6e 4469 7374 616e 6365 2066 726f 6d20  \nDistance from 
+0000b720: 434d 503a 207b 6469 7374 5f66 726f 6d5f  CMP: {dist_from_
+0000b730: 636d 703a 2e32 667d 2522 290a 2020 2020  cmp:.2f}%").    
+0000b740: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b760: 2020 6966 2064 656d 616e 645f 7072 6f78    if demand_prox
+0000b770: 696d 616c 5f6c 696e 6573 3a0a 2020 2020  imal_lines:.    
+0000b780: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7a0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+0000b7b0: 2866 225c 6e50 726f 7869 6d61 6c20 4c69  (f"\nProximal Li
+0000b7c0: 6e65 2050 7269 6365 3a20 7b64 656d 616e  ne Price: {deman
+0000b7d0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+0000b7e0: 5b69 5d3a 2e32 667d 2229 0a20 2020 2023  [i]:.2f}").    #
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b810: 2069 6620 6465 6d61 6e64 5f64 6973 7461   if demand_dista
+0000b820: 6c5f 6c69 6e65 733a 2020 2320 496e 636c  l_lines:  # Incl
+0000b830: 7564 6520 6469 7374 616c 206c 696e 6520  ude distal line 
+0000b840: 7072 6963 6520 6966 2061 7661 696c 6162  price if availab
+0000b850: 6c65 0a20 2020 2023 2020 2020 2020 2020  le.    #        
+0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b870: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000b880: 652e 7772 6974 6528 6622 5c6e 4469 7374  e.write(f"\nDist
+0000b890: 616c 204c 696e 6520 5072 6963 653a 207b  al Line Price: {
+0000b8a0: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
+0000b8b0: 6e65 735b 695d 3a2e 3266 7d22 290a 2020  nes[i]:.2f}").  
+0000b8c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8e0: 2020 2020 2320 496e 636c 7564 6520 7a6f      # Include zo
+0000b8f0: 6e65 2072 616e 6765 0a20 2020 2023 2020  ne range.    #  
+0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b920: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000b930: 5c6e 5a6f 6e65 2052 616e 6765 3a20 7b64  \nZone Range: {d
+0000b940: 656d 616e 645f 7a6f 6e65 5f72 616e 6765  emand_zone_range
+0000b950: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
+0000b960: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b980: 2020 2320 4368 6563 6b20 6966 2070 726f    # Check if pro
+0000b990: 7869 6d61 6c20 6c69 6e65 2069 7320 7465  ximal line is te
+0000b9a0: 7374 6564 0a20 2020 2023 2020 2020 2020  sted.    #      
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9c0: 2020 2020 2020 2020 2020 2074 6573 7465             teste
+0000b9d0: 6420 3d20 6973 5f7a 6f6e 655f 7465 7374  d = is_zone_test
+0000b9e0: 6564 2864 6174 612c 2073 7461 7274 2c20  ed(data, start, 
+0000b9f0: 656e 642c 2064 656d 616e 645f 7072 6f78  end, demand_prox
+0000ba00: 696d 616c 5f6c 696e 6573 5b69 5d29 0a20  imal_lines[i]). 
+0000ba10: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba30: 2020 2020 2069 6620 7465 7374 6564 3a0a       if tested:.
+0000ba40: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba60: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000ba70: 7269 7465 2822 5c6e 5a6f 6e65 2069 7320  rite("\nZone is 
+0000ba80: 5465 7374 6564 2229 0a20 2020 2023 2020  Tested").    #  
+0000ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000baa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000bab0: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bad0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000bae0: 696c 652e 7772 6974 6528 225c 6e46 7265  ile.write("\nFre
+0000baf0: 7368 205a 6f6e 6522 290a 2020 2020 2320  sh Zone").    # 
+0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb10: 2020 2020 656c 7365 3a0a 2020 2020 2320      else:.    # 
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000bb40: 7465 2822 5c6e 4e6f 2064 656d 616e 6420  te("\nNo demand 
+0000bb50: 7a6f 6e65 2070 6174 7465 726e 7320 666f  zone patterns fo
+0000bb60: 756e 642e 2229 0a0a 2020 2020 2320 2020  und.")..    #   
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb80: 2020 2320 5375 7070 6c79 205a 6f6e 6573    # Supply Zones
+0000bb90: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000bba0: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+0000bbb0: 7772 6974 6528 225c 6e5c 6e53 7570 706c  write("\n\nSuppl
+0000bbc0: 7920 5a6f 6e65 733a 2229 0a20 2020 2023  y Zones:").    #
+0000bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbe0: 2020 2020 2069 6620 7375 7070 6c79 5f7a       if supply_z
+0000bbf0: 6f6e 6573 3a20 2023 2043 6865 636b 2069  ones:  # Check i
+0000bc00: 6620 7375 7070 6c79 5f7a 6f6e 6573 2069  f supply_zones i
+0000bc10: 7320 6e6f 7420 656d 7074 790a 2020 2020  s not empty.    
+0000bc20: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000bc30: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0000bc40: 2028 7374 6172 742c 2065 6e64 2c20 7061   (start, end, pa
+0000bc50: 7474 6572 6e2c 2062 6173 655f 636f 756e  ttern, base_coun
+0000bc60: 7429 2069 6e20 656e 756d 6572 6174 6528  t) in enumerate(
+0000bc70: 7375 7070 6c79 5f7a 6f6e 6573 293a 0a20  supply_zones):. 
+0000bc80: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bca0: 2064 6973 745f 6672 6f6d 5f63 6d70 203d   dist_from_cmp =
+0000bcb0: 2061 6273 2828 636d 7020 2d20 7375 7070   abs((cmp - supp
+0000bcc0: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
+0000bcd0: 735b 695d 2920 2f20 636d 7029 202a 2031  s[i]) / cmp) * 1
+0000bce0: 3030 0a20 2020 2023 2020 2020 2020 2020  00.    #        
 0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd00: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000bd10: 5c6e 5c6e 5a6f 6e65 207b 692b 317d 3a20  \n\nZone {i+1}: 
-0000bd20: 5374 6172 7420 4461 7465 3a20 7b64 6174  Start Date: {dat
-0000bd30: 612e 696e 6465 785b 7374 6172 745d 2e64  a.index[start].d
-0000bd40: 6174 6528 297d 2c20 456e 6420 4461 7465  ate()}, End Date
-0000bd50: 3a20 7b64 6174 612e 696e 6465 785b 656e  : {data.index[en
-0000bd60: 645d 2e64 6174 6528 297d 2229 0a20 2020  d].date()}").   
-0000bd70: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd90: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000bda0: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
-0000bdb0: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
-0000bdc0: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
-0000bdd0: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
-0000bde0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be00: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000be10: 6528 6622 5c6e 4469 7374 616e 6365 2066  e(f"\nDistance f
-0000be20: 726f 6d20 434d 503a 207b 6469 7374 5f66  rom CMP: {dist_f
-0000be30: 726f 6d5f 636d 703a 2e32 667d 2522 290a  rom_cmp:.2f}%").
-0000be40: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 2020 2020 6966 2073 7570 706c 795f        if supply_
-0000be70: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
-0000be80: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bea0: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
-0000beb0: 7269 7465 2866 225c 6e50 726f 7869 6d61  rite(f"\nProxima
-0000bec0: 6c20 4c69 6e65 2050 7269 6365 3a20 7b73  l Line Price: {s
-0000bed0: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
-0000bee0: 696e 6573 5b69 5d3a 2e32 667d 2229 0a20  ines[i]:.2f}"). 
-0000bef0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf10: 2020 2020 2069 6620 7375 7070 6c79 5f64       if supply_d
-0000bf20: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
-0000bf30: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
-0000bf40: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
-0000bf50: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
-0000bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf80: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000bf90: 4469 7374 616c 204c 696e 6520 5072 6963  Distal Line Pric
-0000bfa0: 653a 207b 7375 7070 6c79 5f64 6973 7461  e: {supply_dista
-0000bfb0: 6c5f 6c69 6e65 735b 695d 3a2e 3266 7d22  l_lines[i]:.2f}"
-0000bfc0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-0000bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfe0: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
-0000bff0: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
-0000c000: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c020: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000c030: 6528 6622 5c6e 5a6f 6e65 2052 616e 6765  e(f"\nZone Range
-0000c040: 3a20 7b73 7570 706c 795f 7a6f 6e65 5f72  : {supply_zone_r
-0000c050: 616e 6765 735b 695d 3a2e 3266 7d22 290a  anges[i]:.2f}").
-0000c060: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c080: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0000c090: 2070 726f 7869 6d61 6c20 6c69 6e65 2069   proximal line i
-0000c0a0: 7320 7465 7374 6564 0a20 2020 2023 2020  s tested.    #  
-0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c0d0: 6573 7465 6420 3d20 7365 6c66 2e69 735f  ested = self.is_
-0000c0e0: 7a6f 6e65 5f74 6573 7465 6428 6461 7461  zone_tested(data
-0000c0f0: 2c20 7374 6172 742c 2065 6e64 2c20 7375  , start, end, su
-0000c100: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
-0000c110: 6e65 735b 695d 290a 2020 2020 2320 2020  nes[i]).    #   
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c130: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000c140: 2074 6573 7465 643a 0a20 2020 2023 2020   tested:.    #  
-0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c170: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
-0000c180: 6e5a 6f6e 6520 6973 2054 6573 7465 6422  nZone is Tested"
-0000c190: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000bd00: 2020 2020 2069 6620 6162 7328 6469 7374       if abs(dist
+0000bd10: 5f66 726f 6d5f 636d 7029 203c 3d20 7468  _from_cmp) <= th
+0000bd20: 7265 7368 6f6c 645f 7065 7263 656e 743a  reshold_percent:
+0000bd30: 2020 2320 4368 6563 6b20 6966 2064 6973    # Check if dis
+0000bd40: 745f 6672 6f6d 5f63 6d70 2069 7320 7769  t_from_cmp is wi
+0000bd50: 7468 696e 2074 6872 6573 686f 6c64 0a20  thin threshold. 
+0000bd60: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd80: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000bd90: 6622 5c6e 5c6e 5a6f 6e65 207b 692b 317d  f"\n\nZone {i+1}
+0000bda0: 3a20 5374 6172 7420 4461 7465 3a20 7b64  : Start Date: {d
+0000bdb0: 6174 612e 696e 6465 785b 7374 6172 745d  ata.index[start]
+0000bdc0: 2e64 6174 6528 297d 2c20 456e 6420 4461  .date()}, End Da
+0000bdd0: 7465 3a20 7b64 6174 612e 696e 6465 785b  te: {data.index[
+0000bde0: 656e 645d 2e64 6174 6528 297d 2229 0a20  end].date()}"). 
+0000bdf0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be10: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000be20: 6622 5c6e 5061 7474 6572 6e20 4e61 6d65  f"\nPattern Name
+0000be30: 3a20 7b70 6174 7465 726e 7d2c 204e 756d  : {pattern}, Num
+0000be40: 6265 7220 6f66 2042 6173 6520 4361 6e64  ber of Base Cand
+0000be50: 6c65 3a20 7b62 6173 655f 636f 756e 747d  le: {base_count}
+0000be60: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be80: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+0000be90: 6974 6528 6622 5c6e 4469 7374 616e 6365  ite(f"\nDistance
+0000bea0: 2066 726f 6d20 434d 503a 207b 6469 7374   from CMP: {dist
+0000beb0: 5f66 726f 6d5f 636d 703a 2e32 667d 2522  _from_cmp:.2f}%"
+0000bec0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bee0: 2020 2020 2020 2020 6966 2073 7570 706c          if suppl
+0000bef0: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
+0000bf00: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+0000bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf20: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000bf30: 2e77 7269 7465 2866 225c 6e50 726f 7869  .write(f"\nProxi
+0000bf40: 6d61 6c20 4c69 6e65 2050 7269 6365 3a20  mal Line Price: 
+0000bf50: 7b73 7570 706c 795f 7072 6f78 696d 616c  {supply_proximal
+0000bf60: 5f6c 696e 6573 5b69 5d3a 2e32 667d 2229  _lines[i]:.2f}")
+0000bf70: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 2020 2020 2069 6620 7375 7070 6c79         if supply
+0000bfa0: 5f64 6973 7461 6c5f 6c69 6e65 733a 2020  _distal_lines:  
+0000bfb0: 2320 496e 636c 7564 6520 6469 7374 616c  # Include distal
+0000bfc0: 206c 696e 6520 7072 6963 6520 6966 2061   line price if a
+0000bfd0: 7661 696c 6162 6c65 0a20 2020 2023 2020  vailable.    #  
+0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c000: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000c010: 5c6e 4469 7374 616c 204c 696e 6520 5072  \nDistal Line Pr
+0000c020: 6963 653a 207b 7375 7070 6c79 5f64 6973  ice: {supply_dis
+0000c030: 7461 6c5f 6c69 6e65 735b 695d 3a2e 3266  tal_lines[i]:.2f
+0000c040: 7d22 290a 2020 2020 2320 2020 2020 2020  }").    #       
+0000c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c060: 2020 2020 2020 2020 2020 2320 496e 636c            # Incl
+0000c070: 7564 6520 7a6f 6e65 2072 616e 6765 0a20  ude zone range. 
+0000c080: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0a0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+0000c0b0: 6974 6528 6622 5c6e 5a6f 6e65 2052 616e  ite(f"\nZone Ran
+0000c0c0: 6765 3a20 7b73 7570 706c 795f 7a6f 6e65  ge: {supply_zone
+0000c0d0: 5f72 616e 6765 735b 695d 3a2e 3266 7d22  _ranges[i]:.2f}"
+0000c0e0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c100: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000c110: 6966 2070 726f 7869 6d61 6c20 6c69 6e65  if proximal line
+0000c120: 2069 7320 7465 7374 6564 0a20 2020 2023   is tested.    #
+0000c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c150: 2074 6573 7465 6420 3d20 7365 6c66 2e69   tested = self.i
+0000c160: 735f 7a6f 6e65 5f74 6573 7465 6428 6461  s_zone_tested(da
+0000c170: 7461 2c20 7374 6172 742c 2065 6e64 2c20  ta, start, end, 
+0000c180: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
+0000c190: 6c69 6e65 735b 695d 290a 2020 2020 2320  lines[i]).    # 
 0000c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000c1c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1c0: 6966 2074 6573 7465 643a 0a20 2020 2023  if tested:.    #
 0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1e0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
-0000c1f0: 7465 2822 5c6e 4672 6573 6820 5a6f 6e65  te("\nFresh Zone
-0000c200: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-0000c210: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000c220: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
-0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c240: 2066 696c 652e 7772 6974 6528 225c 6e4e   file.write("\nN
-0000c250: 6f20 7375 7070 6c79 207a 6f6e 6520 7061  o supply zone pa
-0000c260: 7474 6572 6e73 2066 6f75 6e64 2e22 290a  tterns found.").
-0000c270: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000c280: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-0000c290: 7772 6974 6528 225c 6e5c 6e22 290a 2020  write("\n\n").  
-0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2b0: 2020 0a20 2020 2023 2020 2020 2070 7269    .    #     pri
-0000c2c0: 6e74 2822 416e 616c 7973 6973 2063 6f6d  nt("Analysis com
-0000c2d0: 706c 6574 6564 2061 6e64 2072 6573 756c  pleted and resul
-0000c2e0: 7473 2073 6176 6564 2e22 290a 2020 2020  ts saved.").    
-0000c2f0: 2020 2020 0a20 2020 2023 2046 696e 6420      .    # Find 
-0000c300: 6163 6375 7261 7465 2062 7265 616b 6f75  accurate breakou
-0000c310: 7420 7661 6c75 650a 2020 2020 6465 6620  t value.    def 
-0000c320: 6669 6e64 4272 6561 6b69 6e67 6f75 744e  findBreakingoutN
-0000c330: 6f77 2873 656c 662c 2064 662c 2066 756c  ow(self, df, ful
-0000c340: 6c44 6174 612c 2073 6176 6544 6963 742c  lData, saveDict,
-0000c350: 2073 6372 6565 6e44 6963 7429 3a0a 2020   screenDict):.  
-0000c360: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0000c370: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0000c380: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000c390: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000c3a0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0000c3b0: 636f 7079 2829 0a20 2020 2020 2020 2072  copy().        r
-0000c3c0: 6576 6572 7365 6444 6174 6120 3d20 6675  eversedData = fu
-0000c3d0: 6c6c 4461 7461 5b3a 3a2d 315d 2e63 6f70  llData[::-1].cop
-0000c3e0: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
-0000c3f0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
-0000c400: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0000c410: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
-0000c420: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
-0000c430: 2030 290a 2020 2020 2020 2020 7265 6365   0).        rece
-0000c440: 6e74 203d 2064 6174 612e 6865 6164 2831  nt = data.head(1
-0000c450: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
-0000c460: 4361 6e64 6c65 4865 6967 6874 203d 2073  CandleHeight = s
-0000c470: 656c 662e 6765 7443 616e 646c 6542 6f64  elf.getCandleBod
-0000c480: 7948 6569 6768 7428 7265 6365 6e74 290a  yHeight(recent).
-0000c490: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
-0000c4a0: 6174 6129 203c 2031 3120 6f72 2072 6563  ata) < 11 or rec
-0000c4b0: 656e 7443 616e 646c 6548 6569 6768 7420  entCandleHeight 
-0000c4c0: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-0000c4d0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0000c4e0: 2020 2020 2020 2074 6f74 616c 4361 6e64         totalCand
-0000c4f0: 6c65 4865 6967 6874 203d 2030 0a20 2020  leHeight = 0.   
-0000c500: 2020 2020 2063 616e 646c 6520 3d20 300a       candle = 0.
-0000c510: 2020 2020 2020 2020 7768 696c 6520 6361          while ca
-0000c520: 6e64 6c65 203c 2031 303a 0a20 2020 2020  ndle < 10:.     
-0000c530: 2020 2020 2020 2063 616e 646c 6520 2b3d         candle +=
-0000c540: 2031 0a20 2020 2020 2020 2020 2020 2063   1.            c
-0000c550: 616e 646c 6548 6569 6768 7420 3d20 6162  andleHeight = ab
-0000c560: 7328 7365 6c66 2e67 6574 4361 6e64 6c65  s(self.getCandle
-0000c570: 426f 6479 4865 6967 6874 2864 6174 615b  BodyHeight(data[
-0000c580: 6361 6e64 6c65 3a5d 2929 0a20 2020 2020  candle:])).     
-0000c590: 2020 2020 2020 2074 6f74 616c 4361 6e64         totalCand
-0000c5a0: 6c65 4865 6967 6874 202b 3d20 6361 6e64  leHeight += cand
-0000c5b0: 6c65 4865 6967 6874 0a0a 2020 2020 2020  leHeight..      
-0000c5c0: 2020 7265 7665 7273 6564 4461 7461 2e6c    reversedData.l
-0000c5d0: 6f63 5b3a 2c27 4242 616e 6473 2d55 275d  oc[:,'BBands-U']
-0000c5e0: 2c20 7265 7665 7273 6564 4461 7461 2e6c  , reversedData.l
-0000c5f0: 6f63 5b3a 2c27 4242 616e 6473 2d4d 275d  oc[:,'BBands-M']
-0000c600: 2c20 7265 7665 7273 6564 4461 7461 2e6c  , reversedData.l
-0000c610: 6f63 5b3a 2c27 4242 616e 6473 2d4c 275d  oc[:,'BBands-L']
-0000c620: 203d 2070 6b74 616c 6962 2e42 4241 4e44   = pktalib.BBAND
-0000c630: 5328 7265 7665 7273 6564 4461 7461 5b22  S(reversedData["
-0000c640: 436c 6f73 6522 5d2c 2032 3029 0a20 2020  Close"], 20).   
-0000c650: 2020 2020 2072 6576 6572 7365 6444 6174       reversedDat
-0000c660: 6120 3d20 7265 7665 7273 6564 4461 7461  a = reversedData
-0000c670: 5b3a 3a2d 315d 0a20 2020 2020 2020 2072  [::-1].        r
-0000c680: 6563 656e 7473 203d 2072 6576 6572 7365  ecents = reverse
-0000c690: 6444 6174 612e 6865 6164 2836 290a 2020  dData.head(6).  
-0000c6a0: 2020 2020 2020 756c 7220 3d20 7365 6c66        ulr = self
-0000c6b0: 2e6e 6f6e 5f7a 6572 6f5f 7261 6e67 6528  .non_zero_range(
-0000c6c0: 7265 6365 6e74 732e 6c6f 635b 3a2c 2742  recents.loc[:,'B
-0000c6d0: 4261 6e64 732d 5527 5d2c 2072 6563 656e  Bands-U'], recen
-0000c6e0: 7473 2e6c 6f63 5b3a 2c27 4242 616e 6473  ts.loc[:,'BBands
-0000c6f0: 2d4c 275d 290a 2020 2020 2020 2020 6d61  -L']).        ma
-0000c700: 784f 664c 6173 7435 4361 6e64 6c65 7320  xOfLast5Candles 
-0000c710: 3d20 756c 722e 7461 696c 2835 292e 6d61  = ulr.tail(5).ma
-0000c720: 7828 290a 2020 2020 2020 2020 2320 6261  x().        # ba
-0000c730: 6e64 7769 6474 6820 3d20 3130 3020 2a20  ndwidth = 100 * 
-0000c740: 756c 7220 2f20 7265 6365 6e74 732e 6c6f  ulr / recents.lo
-0000c750: 635b 3a2c 2742 4261 6e64 732d 4d27 5d0a  c[:,'BBands-M'].
-0000c760: 2020 2020 2020 2020 2320 7065 7263 656e          # percen
-0000c770: 7420 3d20 7365 6c66 2e6e 6f6e 5f7a 6572  t = self.non_zer
-0000c780: 6f5f 7261 6e67 6528 7265 6365 6e74 732e  o_range(recents.
-0000c790: 6c6f 635b 3a2c 2743 6c6f 7365 275d 2c20  loc[:,'Close'], 
-0000c7a0: 7265 6365 6e74 732e 6c6f 635b 3a2c 2742  recents.loc[:,'B
-0000c7b0: 4261 6e64 732d 4c27 5d29 202f 2075 6c72  Bands-L']) / ulr
-0000c7c0: 0a20 2020 2020 2020 2073 6176 6544 6963  .        saveDic
-0000c7d0: 745b 2262 6261 6e64 735f 756c 725f 7261  t["bbands_ulr_ra
-0000c7e0: 7469 6f5f 6d61 7835 225d 203d 2072 6f75  tio_max5"] = rou
-0000c7f0: 6e64 2875 6c72 2e69 6c6f 635b 305d 2f6d  nd(ulr.iloc[0]/m
-0000c800: 6178 4f66 4c61 7374 3543 616e 646c 6573  axOfLast5Candles
-0000c810: 2c32 2920 2370 6572 6365 6e74 2e69 6c6f  ,2) #percent.ilo
-0000c820: 635b 305d 0a20 2020 2020 2020 2073 6372  c[0].        scr
-0000c830: 6565 6e44 6963 745b 2262 6261 6e64 735f  eenDict["bbands_
-0000c840: 756c 725f 7261 7469 6f5f 6d61 7835 225d  ulr_ratio_max5"]
-0000c850: 203d 2073 6176 6544 6963 745b 2262 6261   = saveDict["bba
-0000c860: 6e64 735f 756c 725f 7261 7469 6f5f 6d61  nds_ulr_ratio_ma
-0000c870: 7835 225d 0a20 2020 2020 2020 2023 2073  x5"].        # s
-0000c880: 6176 6544 6963 745b 2262 6261 6e64 735f  aveDict["bbands_
-0000c890: 6261 6e64 7769 6474 6822 5d20 3d20 6261  bandwidth"] = ba
-0000c8a0: 6e64 7769 6474 682e 696c 6f63 5b30 5d0a  ndwidth.iloc[0].
-0000c8b0: 2020 2020 2020 2020 2320 7363 7265 656e          # screen
-0000c8c0: 4469 6374 5b22 6262 616e 6473 5f62 616e  Dict["bbands_ban
-0000c8d0: 6477 6964 7468 225d 203d 2073 6176 6544  dwidth"] = saveD
-0000c8e0: 6963 745b 2262 6261 6e64 735f 6261 6e64  ict["bbands_band
-0000c8f0: 7769 6474 6822 5d0a 2020 2020 2020 2020  width"].        
-0000c900: 2320 7361 7665 4469 6374 5b22 6262 616e  # saveDict["bban
-0000c910: 6473 5f75 6c72 225d 203d 2075 6c72 2e69  ds_ulr"] = ulr.i
-0000c920: 6c6f 635b 305d 0a20 2020 2020 2020 2023  loc[0].        #
-0000c930: 2073 6372 6565 6e44 6963 745b 2262 6261   screenDict["bba
-0000c940: 6e64 735f 756c 7222 5d20 3d20 7361 7665  nds_ulr"] = save
-0000c950: 4469 6374 5b22 6262 616e 6473 5f75 6c72  Dict["bbands_ulr
-0000c960: 225d 0a0a 2020 2020 2020 2020 7265 7475  "]..        retu
-0000c970: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-0000c980: 2072 6563 656e 7443 616e 646c 6548 6569   recentCandleHei
-0000c990: 6768 7420 3e20 300a 2020 2020 2020 2020  ght > 0.        
-0000c9a0: 2020 2020 616e 6420 746f 7461 6c43 616e      and totalCan
-0000c9b0: 646c 6548 6569 6768 7420 3e20 300a 2020  dleHeight > 0.  
-0000c9c0: 2020 2020 2020 2020 2020 616e 6420 2872            and (r
-0000c9d0: 6563 656e 7443 616e 646c 6548 6569 6768  ecentCandleHeigh
-0000c9e0: 7420 3e3d 2033 202a 2028 666c 6f61 7428  t >= 3 * (float(
-0000c9f0: 746f 7461 6c43 616e 646c 6548 6569 6768  totalCandleHeigh
-0000ca00: 7420 2f20 6361 6e64 6c65 2929 290a 2020  t / candle))).  
-0000ca10: 2020 2020 2020 290a 0a20 2020 2023 406d        )..    #@m
-0000ca20: 6561 7375 7265 5f74 696d 650a 2020 2020  easure_time.    
-0000ca30: 2320 4669 6e64 2061 6363 7572 6174 6520  # Find accurate 
-0000ca40: 6272 6561 6b6f 7574 2076 616c 7565 0a20  breakout value. 
-0000ca50: 2020 2064 6566 2066 696e 6442 7265 616b     def findBreak
-0000ca60: 6f75 7456 616c 7565 280a 2020 2020 2020  outValue(.      
-0000ca70: 2020 7365 6c66 2c20 6466 2c20 7363 7265    self, df, scre
-0000ca80: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-0000ca90: 2c20 6461 7973 546f 4c6f 6f6b 6261 636b  , daysToLookback
-0000caa0: 2c20 616c 7265 6164 7942 726f 6b65 6e6f  , alreadyBrokeno
-0000cab0: 7574 3d46 616c 7365 0a20 2020 2029 3a0a  ut=False.    ):.
-0000cac0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0000cad0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0000cae0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000caf0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000cb00: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000cb10: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0000cb20: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
-0000cb30: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
-0000cb40: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
-0000cb50: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
-0000cb60: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
-0000cb70: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
-0000cb80: 6561 6428 3129 0a20 2020 2020 2020 2064  ead(1).        d
-0000cb90: 6174 6120 3d20 6461 7461 5b31 3a5d 0a20  ata = data[1:]. 
-0000cba0: 2020 2020 2020 206d 6178 4869 6768 203d         maxHigh =
-0000cbb0: 2072 6f75 6e64 2864 6174 612e 6465 7363   round(data.desc
-0000cbc0: 7269 6265 2829 5b22 4869 6768 225d 5b22  ribe()["High"]["
-0000cbd0: 6d61 7822 5d2c 2032 290a 2020 2020 2020  max"], 2).      
-0000cbe0: 2020 6d61 7843 6c6f 7365 203d 2072 6f75    maxClose = rou
-0000cbf0: 6e64 2864 6174 612e 6465 7363 7269 6265  nd(data.describe
-0000cc00: 2829 5b22 436c 6f73 6522 5d5b 226d 6178  ()["Close"]["max
-0000cc10: 225d 2c20 3229 0a20 2020 2020 2020 2072  "], 2).        r
-0000cc20: 6563 656e 7443 6c6f 7365 203d 2072 6f75  ecentClose = rou
-0000cc30: 6e64 2872 6563 656e 745b 2243 6c6f 7365  nd(recent["Close
-0000cc40: 225d 2e69 6c6f 635b 305d 2c20 3229 0a20  "].iloc[0], 2). 
-0000cc50: 2020 2020 2020 2069 6620 6e70 2e69 736e         if np.isn
-0000cc60: 616e 286d 6178 436c 6f73 6529 206f 7220  an(maxClose) or 
-0000cc70: 6e70 2e69 736e 616e 286d 6178 4869 6768  np.isnan(maxHigh
-0000cc80: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000cc90: 6176 6544 6963 745b 2242 7265 616b 6f75  aveDict["Breakou
-0000cca0: 7422 5d20 3d20 2242 4f3a 2030 2052 3a20  t"] = "BO: 0 R: 
-0000ccb0: 3022 0a20 2020 2020 2020 2020 2020 2073  0".            s
-0000ccc0: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
-0000ccd0: 6f75 7422 5d20 3d20 280a 2020 2020 2020  out"] = (.      
-0000cce0: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0000ccf0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-0000cd00: 5465 7874 2e57 4152 4e20 2b20 2242 4f3a  Text.WARN + "BO:
-0000cd10: 2030 2052 3a20 3022 202b 2063 6f6c 6f72   0 R: 0" + color
-0000cd20: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0000cd30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000cd40: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
-0000cd50: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
-0000cd60: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0000cd70: 2066 2746 6f72 2053 746f 636b 3a7b 7361   f'For Stock:{sa
-0000cd80: 7665 4469 6374 5b22 5374 6f63 6b22 5d7d  veDict["Stock"]}
-0000cd90: 2c20 7468 6520 6272 6561 6b6f 7574 2069  , the breakout i
-0000cda0: 7320 756e 6b6e 6f77 6e20 6265 6361 7573  s unknown becaus
-0000cdb0: 6520 6d61 782d 6869 6768 2028 7b6d 6178  e max-high ({max
-0000cdc0: 4869 6768 7d29 206f 7220 6d61 782d 636c  High}) or max-cl
-0000cdd0: 6f73 6520 287b 6d61 7843 6c6f 7365 7d29  ose ({maxClose})
-0000cde0: 2061 7265 206e 6f74 2064 6566 696e 6564   are not defined
-0000cdf0: 2e27 0a20 2020 2020 2020 2020 2020 2023  .'.            #
-0000ce00: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-0000ce10: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000ce20: 2020 2020 6966 206d 6178 4869 6768 203e      if maxHigh >
-0000ce30: 206d 6178 436c 6f73 653a 0a20 2020 2020   maxClose:.     
-0000ce40: 2020 2020 2020 2069 6620 286d 6178 4869         if (maxHi
-0000ce50: 6768 202d 206d 6178 436c 6f73 6529 203c  gh - maxClose) <
-0000ce60: 3d20 286d 6178 4869 6768 202a 2032 202f  = (maxHigh * 2 /
-0000ce70: 2031 3030 293a 0a20 2020 2020 2020 2020   100):.         
-0000ce80: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-0000ce90: 2242 7265 616b 6f75 7422 5d20 3d20 2242  "Breakout"] = "B
-0000cea0: 4f3a 2022 202b 2073 7472 286d 6178 436c  O: " + str(maxCl
-0000ceb0: 6f73 6529 202b 2022 2052 3a20 2220 2b20  ose) + " R: " + 
-0000cec0: 7374 7228 6d61 7848 6967 6829 0a20 2020  str(maxHigh).   
-0000ced0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000cee0: 7265 6365 6e74 436c 6f73 6520 3e3d 206d  recentClose >= m
-0000cef0: 6178 436c 6f73 653a 0a20 2020 2020 2020  axClose:.       
-0000cf00: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-0000cf10: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
-0000cf20: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
-0000cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf40: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf60: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0000cf70: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
-0000cf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf90: 202b 2022 424f 3a20 220a 2020 2020 2020   + "BO: ".      
-0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfb0: 2020 2b20 7374 7228 6d61 7843 6c6f 7365    + str(maxClose
-0000cfc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000cfd0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0000cfe0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d000: 2020 2b20 2863 6f6c 6f72 5465 7874 2e47    + (colorText.G
-0000d010: 5245 454e 2069 6620 7265 6365 6e74 436c  REEN if recentCl
-0000d020: 6f73 6520 3e3d 206d 6178 4869 6768 2065  ose >= maxHigh e
-0000d030: 6c73 6520 636f 6c6f 7254 6578 742e 4641  lse colorText.FA
-0000d040: 494c 290a 2020 2020 2020 2020 2020 2020  IL).            
-0000d050: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0000d060: 523a 2022 0a20 2020 2020 2020 2020 2020  R: ".           
-0000d070: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-0000d080: 7472 286d 6178 4869 6768 290a 2020 2020  tr(maxHigh).    
-0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0a0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0000d0b0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-0000d0c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000d0e0: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
-0000d0f0: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
-0000d100: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000d110: 2020 2020 6627 5374 6f63 6b3a 7b73 6176      f'Stock:{sav
-0000d120: 6544 6963 745b 2253 746f 636b 225d 7d2c  eDict["Stock"]},
-0000d130: 2068 6173 2061 2062 7265 616b 6f75 7420   has a breakout 
-0000d140: 6265 6361 7573 6520 6d61 782d 6869 6768  because max-high
-0000d150: 2028 7b6d 6178 4869 6768 7d29 203e 3d20   ({maxHigh}) >= 
-0000d160: 6d61 782d 636c 6f73 6520 287b 6d61 7843  max-close ({maxC
-0000d170: 6c6f 7365 7d29 270a 2020 2020 2020 2020  lose})'.        
-0000d180: 2020 2020 2020 2020 2020 2020 2320 290a              # ).
-0000d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1a0: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
-0000d1b0: 616e 6420 616c 7265 6164 7942 726f 6b65  and alreadyBroke
-0000d1c0: 6e6f 7574 2061 6e64 2073 656c 662e 6765  nout and self.ge
-0000d1d0: 7443 616e 646c 6554 7970 6528 7265 6365  tCandleType(rece
-0000d1e0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0000d1f0: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
-0000d200: 6c74 5f6c 6f67 6765 722e 696e 666f 280a  lt_logger.info(.
-0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d220: 2320 2020 2020 6627 5374 6f63 6b3a 7b73  #     f'Stock:{s
-0000d230: 6176 6544 6963 745b 2253 746f 636b 225d  aveDict["Stock"]
-0000d240: 7d2c 2064 6f65 7320 6e6f 7420 6861 7665  }, does not have
-0000d250: 2061 2062 7265 616b 6f75 7420 7965 7420   a breakout yet 
-0000d260: 6265 6361 7573 6520 6d61 782d 6869 6768  because max-high
-0000d270: 2028 7b6d 6178 4869 6768 7d29 203c 206d   ({maxHigh}) < m
-0000d280: 6178 2d63 6c6f 7365 2028 7b6d 6178 436c  ax-close ({maxCl
-0000d290: 6f73 657d 2927 0a20 2020 2020 2020 2020  ose})'.         
-0000d2a0: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
-0000d2b0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000d2c0: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000d2d0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000d2e0: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0000d2f0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-0000d300: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000d310: 6f6c 6f72 5465 7874 2e46 4149 4c0a 2020  olorText.FAIL.  
-0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d330: 2020 2b20 2242 4f3a 2022 0a20 2020 2020    + "BO: ".     
-0000d340: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000d350: 2073 7472 286d 6178 436c 6f73 6529 0a20   str(maxClose). 
-0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d370: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0000d380: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-0000d390: 2020 2020 2020 202b 2028 636f 6c6f 7254         + (colorT
-0000d3a0: 6578 742e 4752 4545 4e20 6966 2072 6563  ext.GREEN if rec
-0000d3b0: 656e 7443 6c6f 7365 203e 3d20 6d61 7848  entClose >= maxH
-0000d3c0: 6967 6820 656c 7365 2063 6f6c 6f72 5465  igh else colorTe
-0000d3d0: 7874 2e46 4149 4c29 0a20 2020 2020 2020  xt.FAIL).       
-0000d3e0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0000d3f0: 2052 3a20 220a 2020 2020 2020 2020 2020   R: ".          
-0000d400: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
-0000d410: 6d61 7848 6967 6829 0a20 2020 2020 2020  maxHigh).       
-0000d420: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000d430: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-0000d440: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000d450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d460: 6574 7572 6e20 6e6f 7420 616c 7265 6164  eturn not alread
-0000d470: 7942 726f 6b65 6e6f 7574 0a20 2020 2020  yBrokenout.     
-0000d480: 2020 2020 2020 206e 6f4f 6648 6967 6865         noOfHighe
-0000d490: 7253 6861 646f 7773 203d 206c 656e 2864  rShadows = len(d
-0000d4a0: 6174 615b 6461 7461 2e48 6967 6820 3e20  ata[data.High > 
-0000d4b0: 6d61 7843 6c6f 7365 5d29 0a20 2020 2020  maxClose]).     
-0000d4c0: 2020 2020 2020 2069 6620 6461 7973 546f         if daysTo
-0000d4d0: 4c6f 6f6b 6261 636b 202f 206e 6f4f 6648  Lookback / noOfH
-0000d4e0: 6967 6865 7253 6861 646f 7773 203c 3d20  igherShadows <= 
-0000d4f0: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
-0000d500: 2020 2073 6176 6544 6963 745b 2242 7265     saveDict["Bre
-0000d510: 616b 6f75 7422 5d20 3d20 2242 4f3a 2022  akout"] = "BO: "
-0000d520: 202b 2073 7472 286d 6178 4869 6768 2920   + str(maxHigh) 
-0000d530: 2b20 2220 523a 2030 220a 2020 2020 2020  + " R: 0".      
-0000d540: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-0000d550: 656e 7443 6c6f 7365 203e 3d20 6d61 7848  entClose >= maxH
-0000d560: 6967 683a 0a20 2020 2020 2020 2020 2020  igh:.           
-0000d570: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0000d580: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
-0000d590: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000d5a0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-0000d5b0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5d0: 2020 202b 2063 6f6c 6f72 5465 7874 2e47     + colorText.G
-0000d5e0: 5245 454e 0a20 2020 2020 2020 2020 2020  REEN.           
-0000d5f0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0000d600: 424f 3a20 220a 2020 2020 2020 2020 2020  BO: ".          
-0000d610: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000d620: 7374 7228 6d61 7848 6967 6829 0a20 2020  str(maxHigh).   
-0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d640: 2020 2020 202b 2022 2052 3a20 3022 0a20       + " R: 0". 
-0000d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d660: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0000d670: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0000d680: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1f0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000c200: 225c 6e5a 6f6e 6520 6973 2054 6573 7465  "\nZone is Teste
+0000c210: 6422 290a 2020 2020 2320 2020 2020 2020  d").    #       
+0000c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c230: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c240: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c260: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000c270: 7269 7465 2822 5c6e 4672 6573 6820 5a6f  rite("\nFresh Zo
+0000c280: 6e65 2229 0a20 2020 2023 2020 2020 2020  ne").    #      
+0000c290: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c2a0: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2c0: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
+0000c2d0: 6e4e 6f20 7375 7070 6c79 207a 6f6e 6520  nNo supply zone 
+0000c2e0: 7061 7474 6572 6e73 2066 6f75 6e64 2e22  patterns found."
+0000c2f0: 290a 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+0000c300: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000c310: 652e 7772 6974 6528 225c 6e5c 6e22 290a  e.write("\n\n").
+0000c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c330: 2020 2020 0a20 2020 2023 2020 2020 2070      .    #     p
+0000c340: 7269 6e74 2822 416e 616c 7973 6973 2063  rint("Analysis c
+0000c350: 6f6d 706c 6574 6564 2061 6e64 2072 6573  ompleted and res
+0000c360: 756c 7473 2073 6176 6564 2e22 290a 2020  ults saved.").  
+0000c370: 2020 2020 2020 0a20 2020 2023 2046 696e        .    # Fin
+0000c380: 6420 6163 6375 7261 7465 2062 7265 616b  d accurate break
+0000c390: 6f75 7420 7661 6c75 650a 2020 2020 6465  out value.    de
+0000c3a0: 6620 6669 6e64 4272 6561 6b69 6e67 6f75  f findBreakingou
+0000c3b0: 744e 6f77 2873 656c 662c 2064 662c 2066  tNow(self, df, f
+0000c3c0: 756c 6c44 6174 612c 2073 6176 6544 6963  ullData, saveDic
+0000c3d0: 742c 2073 6372 6565 6e44 6963 7429 3a0a  t, screenDict):.
+0000c3e0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0000c3f0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0000c400: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000c410: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000c420: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000c430: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0000c440: 2072 6576 6572 7365 6444 6174 6120 3d20   reversedData = 
+0000c450: 6675 6c6c 4461 7461 5b3a 3a2d 315d 2e63  fullData[::-1].c
+0000c460: 6f70 7928 290a 2020 2020 2020 2020 6461  opy().        da
+0000c470: 7461 203d 2064 6174 612e 6669 6c6c 6e61  ta = data.fillna
+0000c480: 2830 290a 2020 2020 2020 2020 6461 7461  (0).        data
+0000c490: 203d 2064 6174 612e 7265 706c 6163 6528   = data.replace(
+0000c4a0: 5b6e 702e 696e 662c 202d 6e70 2e69 6e66  [np.inf, -np.inf
+0000c4b0: 5d2c 2030 290a 2020 2020 2020 2020 7265  ], 0).        re
+0000c4c0: 6365 6e74 203d 2064 6174 612e 6865 6164  cent = data.head
+0000c4d0: 2831 290a 2020 2020 2020 2020 7265 6365  (1).        rece
+0000c4e0: 6e74 4361 6e64 6c65 4865 6967 6874 203d  ntCandleHeight =
+0000c4f0: 2073 656c 662e 6765 7443 616e 646c 6542   self.getCandleB
+0000c500: 6f64 7948 6569 6768 7428 7265 6365 6e74  odyHeight(recent
+0000c510: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+0000c520: 2864 6174 6129 203c 2031 3120 6f72 2072  (data) < 11 or r
+0000c530: 6563 656e 7443 616e 646c 6548 6569 6768  ecentCandleHeigh
+0000c540: 7420 3c3d 2030 3a0a 2020 2020 2020 2020  t <= 0:.        
+0000c550: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000c560: 0a20 2020 2020 2020 2074 6f74 616c 4361  .        totalCa
+0000c570: 6e64 6c65 4865 6967 6874 203d 2030 0a20  ndleHeight = 0. 
+0000c580: 2020 2020 2020 2063 616e 646c 6520 3d20         candle = 
+0000c590: 300a 2020 2020 2020 2020 7768 696c 6520  0.        while 
+0000c5a0: 6361 6e64 6c65 203c 2031 303a 0a20 2020  candle < 10:.   
+0000c5b0: 2020 2020 2020 2020 2063 616e 646c 6520           candle 
+0000c5c0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0000c5d0: 2063 616e 646c 6548 6569 6768 7420 3d20   candleHeight = 
+0000c5e0: 6162 7328 7365 6c66 2e67 6574 4361 6e64  abs(self.getCand
+0000c5f0: 6c65 426f 6479 4865 6967 6874 2864 6174  leBodyHeight(dat
+0000c600: 615b 6361 6e64 6c65 3a5d 2929 0a20 2020  a[candle:])).   
+0000c610: 2020 2020 2020 2020 2074 6f74 616c 4361           totalCa
+0000c620: 6e64 6c65 4865 6967 6874 202b 3d20 6361  ndleHeight += ca
+0000c630: 6e64 6c65 4865 6967 6874 0a0a 2020 2020  ndleHeight..    
+0000c640: 2020 2020 7265 7665 7273 6564 4461 7461      reversedData
+0000c650: 2e6c 6f63 5b3a 2c27 4242 616e 6473 2d55  .loc[:,'BBands-U
+0000c660: 275d 2c20 7265 7665 7273 6564 4461 7461  '], reversedData
+0000c670: 2e6c 6f63 5b3a 2c27 4242 616e 6473 2d4d  .loc[:,'BBands-M
+0000c680: 275d 2c20 7265 7665 7273 6564 4461 7461  '], reversedData
+0000c690: 2e6c 6f63 5b3a 2c27 4242 616e 6473 2d4c  .loc[:,'BBands-L
+0000c6a0: 275d 203d 2070 6b74 616c 6962 2e42 4241  '] = pktalib.BBA
+0000c6b0: 4e44 5328 7265 7665 7273 6564 4461 7461  NDS(reversedData
+0000c6c0: 5b22 436c 6f73 6522 5d2c 2032 3029 0a20  ["Close"], 20). 
+0000c6d0: 2020 2020 2020 2072 6576 6572 7365 6444         reversedD
+0000c6e0: 6174 6120 3d20 7265 7665 7273 6564 4461  ata = reversedDa
+0000c6f0: 7461 5b3a 3a2d 315d 0a20 2020 2020 2020  ta[::-1].       
+0000c700: 2072 6563 656e 7473 203d 2072 6576 6572   recents = rever
+0000c710: 7365 6444 6174 612e 6865 6164 2836 290a  sedData.head(6).
+0000c720: 2020 2020 2020 2020 756c 7220 3d20 7365          ulr = se
+0000c730: 6c66 2e6e 6f6e 5f7a 6572 6f5f 7261 6e67  lf.non_zero_rang
+0000c740: 6528 7265 6365 6e74 732e 6c6f 635b 3a2c  e(recents.loc[:,
+0000c750: 2742 4261 6e64 732d 5527 5d2c 2072 6563  'BBands-U'], rec
+0000c760: 656e 7473 2e6c 6f63 5b3a 2c27 4242 616e  ents.loc[:,'BBan
+0000c770: 6473 2d4c 275d 290a 2020 2020 2020 2020  ds-L']).        
+0000c780: 6d61 784f 664c 6173 7435 4361 6e64 6c65  maxOfLast5Candle
+0000c790: 7320 3d20 756c 722e 7461 696c 2835 292e  s = ulr.tail(5).
+0000c7a0: 6d61 7828 290a 2020 2020 2020 2020 2320  max().        # 
+0000c7b0: 6261 6e64 7769 6474 6820 3d20 3130 3020  bandwidth = 100 
+0000c7c0: 2a20 756c 7220 2f20 7265 6365 6e74 732e  * ulr / recents.
+0000c7d0: 6c6f 635b 3a2c 2742 4261 6e64 732d 4d27  loc[:,'BBands-M'
+0000c7e0: 5d0a 2020 2020 2020 2020 2320 7065 7263  ].        # perc
+0000c7f0: 656e 7420 3d20 7365 6c66 2e6e 6f6e 5f7a  ent = self.non_z
+0000c800: 6572 6f5f 7261 6e67 6528 7265 6365 6e74  ero_range(recent
+0000c810: 732e 6c6f 635b 3a2c 2743 6c6f 7365 275d  s.loc[:,'Close']
+0000c820: 2c20 7265 6365 6e74 732e 6c6f 635b 3a2c  , recents.loc[:,
+0000c830: 2742 4261 6e64 732d 4c27 5d29 202f 2075  'BBands-L']) / u
+0000c840: 6c72 0a20 2020 2020 2020 2073 6176 6544  lr.        saveD
+0000c850: 6963 745b 2262 6261 6e64 735f 756c 725f  ict["bbands_ulr_
+0000c860: 7261 7469 6f5f 6d61 7835 225d 203d 2072  ratio_max5"] = r
+0000c870: 6f75 6e64 2875 6c72 2e69 6c6f 635b 305d  ound(ulr.iloc[0]
+0000c880: 2f6d 6178 4f66 4c61 7374 3543 616e 646c  /maxOfLast5Candl
+0000c890: 6573 2c32 2920 2370 6572 6365 6e74 2e69  es,2) #percent.i
+0000c8a0: 6c6f 635b 305d 0a20 2020 2020 2020 2073  loc[0].        s
+0000c8b0: 6372 6565 6e44 6963 745b 2262 6261 6e64  creenDict["bband
+0000c8c0: 735f 756c 725f 7261 7469 6f5f 6d61 7835  s_ulr_ratio_max5
+0000c8d0: 225d 203d 2073 6176 6544 6963 745b 2262  "] = saveDict["b
+0000c8e0: 6261 6e64 735f 756c 725f 7261 7469 6f5f  bands_ulr_ratio_
+0000c8f0: 6d61 7835 225d 0a20 2020 2020 2020 2023  max5"].        #
+0000c900: 2073 6176 6544 6963 745b 2262 6261 6e64   saveDict["bband
+0000c910: 735f 6261 6e64 7769 6474 6822 5d20 3d20  s_bandwidth"] = 
+0000c920: 6261 6e64 7769 6474 682e 696c 6f63 5b30  bandwidth.iloc[0
+0000c930: 5d0a 2020 2020 2020 2020 2320 7363 7265  ].        # scre
+0000c940: 656e 4469 6374 5b22 6262 616e 6473 5f62  enDict["bbands_b
+0000c950: 616e 6477 6964 7468 225d 203d 2073 6176  andwidth"] = sav
+0000c960: 6544 6963 745b 2262 6261 6e64 735f 6261  eDict["bbands_ba
+0000c970: 6e64 7769 6474 6822 5d0a 2020 2020 2020  ndwidth"].      
+0000c980: 2020 2320 7361 7665 4469 6374 5b22 6262    # saveDict["bb
+0000c990: 616e 6473 5f75 6c72 225d 203d 2075 6c72  ands_ulr"] = ulr
+0000c9a0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+0000c9b0: 2023 2073 6372 6565 6e44 6963 745b 2262   # screenDict["b
+0000c9c0: 6261 6e64 735f 756c 7222 5d20 3d20 7361  bands_ulr"] = sa
+0000c9d0: 7665 4469 6374 5b22 6262 616e 6473 5f75  veDict["bbands_u
+0000c9e0: 6c72 225d 0a0a 2020 2020 2020 2020 7265  lr"]..        re
+0000c9f0: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+0000ca00: 2020 2072 6563 656e 7443 616e 646c 6548     recentCandleH
+0000ca10: 6569 6768 7420 3e20 300a 2020 2020 2020  eight > 0.      
+0000ca20: 2020 2020 2020 616e 6420 746f 7461 6c43        and totalC
+0000ca30: 616e 646c 6548 6569 6768 7420 3e20 300a  andleHeight > 0.
+0000ca40: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000ca50: 2872 6563 656e 7443 616e 646c 6548 6569  (recentCandleHei
+0000ca60: 6768 7420 3e3d 2033 202a 2028 666c 6f61  ght >= 3 * (floa
+0000ca70: 7428 746f 7461 6c43 616e 646c 6548 6569  t(totalCandleHei
+0000ca80: 6768 7420 2f20 6361 6e64 6c65 2929 290a  ght / candle))).
+0000ca90: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
+0000caa0: 406d 6561 7375 7265 5f74 696d 650a 2020  @measure_time.  
+0000cab0: 2020 2320 4669 6e64 2061 6363 7572 6174    # Find accurat
+0000cac0: 6520 6272 6561 6b6f 7574 2076 616c 7565  e breakout value
+0000cad0: 0a20 2020 2064 6566 2066 696e 6442 7265  .    def findBre
+0000cae0: 616b 6f75 7456 616c 7565 280a 2020 2020  akoutValue(.    
+0000caf0: 2020 2020 7365 6c66 2c20 6466 2c20 7363      self, df, sc
+0000cb00: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+0000cb10: 6374 2c20 6461 7973 546f 4c6f 6f6b 6261  ct, daysToLookba
+0000cb20: 636b 2c20 616c 7265 6164 7942 726f 6b65  ck, alreadyBroke
+0000cb30: 6e6f 7574 3d46 616c 7365 0a20 2020 2029  nout=False.    )
+0000cb40: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+0000cb50: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+0000cb60: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+0000cb70: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000cb80: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+0000cb90: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+0000cba0: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
+0000cbb0: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+0000cbc0: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
+0000cbd0: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
+0000cbe0: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
+0000cbf0: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000cc00: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
+0000cc10: 2064 6174 6120 3d20 6461 7461 5b31 3a5d   data = data[1:]
+0000cc20: 0a20 2020 2020 2020 206d 6178 4869 6768  .        maxHigh
+0000cc30: 203d 2072 6f75 6e64 2864 6174 612e 6465   = round(data.de
+0000cc40: 7363 7269 6265 2829 5b22 4869 6768 225d  scribe()["High"]
+0000cc50: 5b22 6d61 7822 5d2c 2032 290a 2020 2020  ["max"], 2).    
+0000cc60: 2020 2020 6d61 7843 6c6f 7365 203d 2072      maxClose = r
+0000cc70: 6f75 6e64 2864 6174 612e 6465 7363 7269  ound(data.descri
+0000cc80: 6265 2829 5b22 436c 6f73 6522 5d5b 226d  be()["Close"]["m
+0000cc90: 6178 225d 2c20 3229 0a20 2020 2020 2020  ax"], 2).       
+0000cca0: 2072 6563 656e 7443 6c6f 7365 203d 2072   recentClose = r
+0000ccb0: 6f75 6e64 2872 6563 656e 745b 2243 6c6f  ound(recent["Clo
+0000ccc0: 7365 225d 2e69 6c6f 635b 305d 2c20 3229  se"].iloc[0], 2)
+0000ccd0: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
+0000cce0: 736e 616e 286d 6178 436c 6f73 6529 206f  snan(maxClose) o
+0000ccf0: 7220 6e70 2e69 736e 616e 286d 6178 4869  r np.isnan(maxHi
+0000cd00: 6768 293a 0a20 2020 2020 2020 2020 2020  gh):.           
+0000cd10: 2073 6176 6544 6963 745b 2242 7265 616b   saveDict["Break
+0000cd20: 6f75 7422 5d20 3d20 2242 4f3a 2030 2052  out"] = "BO: 0 R
+0000cd30: 3a20 3022 0a20 2020 2020 2020 2020 2020  : 0".           
+0000cd40: 2073 6372 6565 6e44 6963 745b 2242 7265   screenDict["Bre
+0000cd50: 616b 6f75 7422 5d20 3d20 280a 2020 2020  akout"] = (.    
+0000cd60: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0000cd70: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+0000cd80: 6f72 5465 7874 2e57 4152 4e20 2b20 2242  orText.WARN + "B
+0000cd90: 4f3a 2030 2052 3a20 3022 202b 2063 6f6c  O: 0 R: 0" + col
+0000cda0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0000cdb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cdc0: 2020 2020 2023 2073 656c 662e 6465 6661       # self.defa
+0000cdd0: 756c 745f 6c6f 6767 6572 2e69 6e66 6f28  ult_logger.info(
+0000cde0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0000cdf0: 2020 2066 2746 6f72 2053 746f 636b 3a7b     f'For Stock:{
+0000ce00: 7361 7665 4469 6374 5b22 5374 6f63 6b22  saveDict["Stock"
+0000ce10: 5d7d 2c20 7468 6520 6272 6561 6b6f 7574  ]}, the breakout
+0000ce20: 2069 7320 756e 6b6e 6f77 6e20 6265 6361   is unknown beca
+0000ce30: 7573 6520 6d61 782d 6869 6768 2028 7b6d  use max-high ({m
+0000ce40: 6178 4869 6768 7d29 206f 7220 6d61 782d  axHigh}) or max-
+0000ce50: 636c 6f73 6520 287b 6d61 7843 6c6f 7365  close ({maxClose
+0000ce60: 7d29 2061 7265 206e 6f74 2064 6566 696e  }) are not defin
+0000ce70: 6564 2e27 0a20 2020 2020 2020 2020 2020  ed.'.           
+0000ce80: 2023 2029 0a20 2020 2020 2020 2020 2020   # ).           
+0000ce90: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000cea0: 2020 2020 2020 6966 206d 6178 4869 6768        if maxHigh
+0000ceb0: 203e 206d 6178 436c 6f73 653a 0a20 2020   > maxClose:.   
+0000cec0: 2020 2020 2020 2020 2069 6620 286d 6178           if (max
+0000ced0: 4869 6768 202d 206d 6178 436c 6f73 6529  High - maxClose)
+0000cee0: 203c 3d20 286d 6178 4869 6768 202a 2032   <= (maxHigh * 2
+0000cef0: 202f 2031 3030 293a 0a20 2020 2020 2020   / 100):.       
+0000cf00: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+0000cf10: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
+0000cf20: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
+0000cf30: 436c 6f73 6529 202b 2022 2052 3a20 2220  Close) + " R: " 
+0000cf40: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cf60: 6620 7265 6365 6e74 436c 6f73 6520 3e3d  f recentClose >=
+0000cf70: 206d 6178 436c 6f73 653a 0a20 2020 2020   maxClose:.     
+0000cf80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000cf90: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
+0000cfa0: 6f75 7422 5d20 3d20 280a 2020 2020 2020  out"] = (.      
+0000cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfc0: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
+0000cfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cfe0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000cff0: 5465 7874 2e47 5245 454e 0a20 2020 2020  Text.GREEN.     
+0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d010: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
+0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d030: 2020 2020 2b20 7374 7228 6d61 7843 6c6f      + str(maxClo
+0000d040: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+0000d050: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0000d060: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d080: 2020 2020 2b20 2863 6f6c 6f72 5465 7874      + (colorText
+0000d090: 2e47 5245 454e 2069 6620 7265 6365 6e74  .GREEN if recent
+0000d0a0: 436c 6f73 6520 3e3d 206d 6178 4869 6768  Close >= maxHigh
+0000d0b0: 2065 6c73 6520 636f 6c6f 7254 6578 742e   else colorText.
+0000d0c0: 4641 494c 290a 2020 2020 2020 2020 2020  FAIL).          
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000d0e0: 2220 523a 2022 0a20 2020 2020 2020 2020  " R: ".         
+0000d0f0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d100: 2073 7472 286d 6178 4869 6768 290a 2020   str(maxHigh).  
+0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d120: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0000d130: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0000d140: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d160: 2320 7365 6c66 2e64 6566 6175 6c74 5f6c  # self.default_l
+0000d170: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d190: 2320 2020 2020 6627 5374 6f63 6b3a 7b73  #     f'Stock:{s
+0000d1a0: 6176 6544 6963 745b 2253 746f 636b 225d  aveDict["Stock"]
+0000d1b0: 7d2c 2068 6173 2061 2062 7265 616b 6f75  }, has a breakou
+0000d1c0: 7420 6265 6361 7573 6520 6d61 782d 6869  t because max-hi
+0000d1d0: 6768 2028 7b6d 6178 4869 6768 7d29 203e  gh ({maxHigh}) >
+0000d1e0: 3d20 6d61 782d 636c 6f73 6520 287b 6d61  = max-close ({ma
+0000d1f0: 7843 6c6f 7365 7d29 270a 2020 2020 2020  xClose})'.      
+0000d200: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000d210: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d220: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000d230: 6520 616e 6420 616c 7265 6164 7942 726f  e and alreadyBro
+0000d240: 6b65 6e6f 7574 2061 6e64 2073 656c 662e  kenout and self.
+0000d250: 6765 7443 616e 646c 6554 7970 6528 7265  getCandleType(re
+0000d260: 6365 6e74 290a 2020 2020 2020 2020 2020  cent).          
+0000d270: 2020 2020 2020 2320 7365 6c66 2e64 6566        # self.def
+0000d280: 6175 6c74 5f6c 6f67 6765 722e 696e 666f  ault_logger.info
+0000d290: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d2a0: 2020 2320 2020 2020 6627 5374 6f63 6b3a    #     f'Stock:
+0000d2b0: 7b73 6176 6544 6963 745b 2253 746f 636b  {saveDict["Stock
+0000d2c0: 225d 7d2c 2064 6f65 7320 6e6f 7420 6861  "]}, does not ha
+0000d2d0: 7665 2061 2062 7265 616b 6f75 7420 7965  ve a breakout ye
+0000d2e0: 7420 6265 6361 7573 6520 6d61 782d 6869  t because max-hi
+0000d2f0: 6768 2028 7b6d 6178 4869 6768 7d29 203c  gh ({maxHigh}) <
+0000d300: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
+0000d310: 436c 6f73 657d 2927 0a20 2020 2020 2020  Close})'.       
+0000d320: 2020 2020 2020 2020 2023 2029 0a20 2020           # ).   
+0000d330: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0000d340: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
+0000d350: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
+0000d360: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0000d370: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+0000d380: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d390: 2063 6f6c 6f72 5465 7874 2e46 4149 4c0a   colorText.FAIL.
+0000d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3b0: 2020 2020 2b20 2242 4f3a 2022 0a20 2020      + "BO: ".   
+0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3d0: 202b 2073 7472 286d 6178 436c 6f73 6529   + str(maxClose)
+0000d3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3f0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0000d400: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0000d410: 2020 2020 2020 2020 202b 2028 636f 6c6f           + (colo
+0000d420: 7254 6578 742e 4752 4545 4e20 6966 2072  rText.GREEN if r
+0000d430: 6563 656e 7443 6c6f 7365 203e 3d20 6d61  ecentClose >= ma
+0000d440: 7848 6967 6820 656c 7365 2063 6f6c 6f72  xHigh else color
+0000d450: 5465 7874 2e46 4149 4c29 0a20 2020 2020  Text.FAIL).     
+0000d460: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d470: 2022 2052 3a20 220a 2020 2020 2020 2020   " R: ".        
+0000d480: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
+0000d490: 7228 6d61 7848 6967 6829 0a20 2020 2020  r(maxHigh).     
+0000d4a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d4b0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d4e0: 2072 6574 7572 6e20 6e6f 7420 616c 7265   return not alre
+0000d4f0: 6164 7942 726f 6b65 6e6f 7574 0a20 2020  adyBrokenout.   
+0000d500: 2020 2020 2020 2020 206e 6f4f 6648 6967           noOfHig
+0000d510: 6865 7253 6861 646f 7773 203d 206c 656e  herShadows = len
+0000d520: 2864 6174 615b 6461 7461 2e48 6967 6820  (data[data.High 
+0000d530: 3e20 6d61 7843 6c6f 7365 5d29 0a20 2020  > maxClose]).   
+0000d540: 2020 2020 2020 2020 2069 6620 6461 7973           if days
+0000d550: 546f 4c6f 6f6b 6261 636b 202f 206e 6f4f  ToLookback / noO
+0000d560: 6648 6967 6865 7253 6861 646f 7773 203c  fHigherShadows <
+0000d570: 3d20 333a 0a20 2020 2020 2020 2020 2020  = 3:.           
+0000d580: 2020 2020 2073 6176 6544 6963 745b 2242       saveDict["B
+0000d590: 7265 616b 6f75 7422 5d20 3d20 2242 4f3a  reakout"] = "BO:
+0000d5a0: 2022 202b 2073 7472 286d 6178 4869 6768   " + str(maxHigh
+0000d5b0: 2920 2b20 2220 523a 2030 220a 2020 2020  ) + " R: 0".    
+0000d5c0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0000d5d0: 6563 656e 7443 6c6f 7365 203e 3d20 6d61  ecentClose >= ma
+0000d5e0: 7848 6967 683a 0a20 2020 2020 2020 2020  xHigh:.         
+0000d5f0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000d600: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
+0000d610: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0000d620: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000d630: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d650: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0000d660: 2e47 5245 454e 0a20 2020 2020 2020 2020  .GREEN.         
+0000d670: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d680: 2022 424f 3a20 220a 2020 2020 2020 2020   "BO: ".        
 0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6a0: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
-0000d6b0: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
-0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d6d0: 2023 2020 2020 2066 2753 746f 636b 3a7b   #     f'Stock:{
-0000d6e0: 7361 7665 4469 6374 5b22 5374 6f63 6b22  saveDict["Stock"
-0000d6f0: 5d7d 2c20 6861 7320 6120 6272 6561 6b6f  ]}, has a breako
-0000d700: 7574 2062 6563 6175 7365 2072 6563 656e  ut because recen
-0000d710: 742d 636c 6f73 6520 287b 7265 6365 6e74  t-close ({recent
-0000d720: 436c 6f73 657d 2920 3e3d 206d 6178 2d68  Close}) >= max-h
-0000d730: 6967 6820 287b 6d61 7848 6967 687d 2927  igh ({maxHigh})'
-0000d740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d750: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000d760: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000d770: 7572 6e20 5472 7565 2061 6e64 2061 6c72  urn True and alr
-0000d780: 6561 6479 4272 6f6b 656e 6f75 7420 616e  eadyBrokenout an
-0000d790: 6420 7365 6c66 2e67 6574 4361 6e64 6c65  d self.getCandle
-0000d7a0: 5479 7065 2872 6563 656e 7429 0a20 2020  Type(recent).   
-0000d7b0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0000d7c0: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-0000d7d0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-0000d7e0: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
-0000d7f0: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
-0000d800: 5b22 5374 6f63 6b22 5d7d 2c20 646f 6573  ["Stock"]}, does
-0000d810: 206e 6f74 2068 6176 6520 6120 6272 6561   not have a brea
-0000d820: 6b6f 7574 2079 6574 2062 6563 6175 7365  kout yet because
-0000d830: 2072 6563 656e 742d 636c 6f73 6520 287b   recent-close ({
-0000d840: 7265 6365 6e74 436c 6f73 657d 2920 3c20  recentClose}) < 
-0000d850: 6d61 782d 6869 6768 2028 7b6d 6178 4869  max-high ({maxHi
-0000d860: 6768 7d29 270a 2020 2020 2020 2020 2020  gh})'.          
-0000d870: 2020 2020 2020 2320 290a 2020 2020 2020        # ).      
-0000d880: 2020 2020 2020 2020 2020 7363 7265 656e            screen
-0000d890: 4469 6374 5b22 4272 6561 6b6f 7574 225d  Dict["Breakout"]
-0000d8a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0000d8b0: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
-0000d8c0: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
-0000d8d0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0000d8e0: 6c6f 7254 6578 742e 4641 494c 0a20 2020  lorText.FAIL.   
-0000d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d900: 202b 2022 424f 3a20 220a 2020 2020 2020   + "BO: ".      
-0000d910: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000d920: 7374 7228 6d61 7848 6967 6829 0a20 2020  str(maxHigh).   
-0000d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d940: 202b 2022 2052 3a20 3022 0a20 2020 2020   + " R: 0".     
-0000d950: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000d960: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000d970: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000d980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d990: 2072 6574 7572 6e20 6e6f 7420 616c 7265   return not alre
-0000d9a0: 6164 7942 726f 6b65 6e6f 7574 0a20 2020  adyBrokenout.   
-0000d9b0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000d9c0: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
-0000d9d0: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
-0000d9e0: 436c 6f73 6529 202b 2022 2052 3a20 2220  Close) + " R: " 
-0000d9f0: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
-0000da00: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0000da10: 6365 6e74 436c 6f73 6520 3e3d 206d 6178  centClose >= max
-0000da20: 436c 6f73 653a 0a20 2020 2020 2020 2020  Close:.         
-0000da30: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
-0000da40: 6661 756c 745f 6c6f 6767 6572 2e69 6e66  fault_logger.inf
-0000da50: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-0000da60: 2020 2023 2020 2020 2066 2753 746f 636b     #     f'Stock
-0000da70: 3a7b 7361 7665 4469 6374 5b22 5374 6f63  :{saveDict["Stoc
-0000da80: 6b22 5d7d 2c20 6861 7320 6120 6272 6561  k"]}, has a brea
-0000da90: 6b6f 7574 2062 6563 6175 7365 2072 6563  kout because rec
-0000daa0: 656e 742d 636c 6f73 6520 287b 7265 6365  ent-close ({rece
-0000dab0: 6e74 436c 6f73 657d 2920 3e3d 206d 6178  ntClose}) >= max
-0000dac0: 2d63 6c6f 7365 2028 7b6d 6178 436c 6f73  -close ({maxClos
-0000dad0: 657d 2927 0a20 2020 2020 2020 2020 2020  e})'.           
-0000dae0: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000daf0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0000db00: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
-0000db10: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000db20: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
-0000db30: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-0000db40: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0000db50: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-0000db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db70: 202b 2022 424f 3a20 220a 2020 2020 2020   + "BO: ".      
-0000db80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000db90: 7374 7228 6d61 7843 6c6f 7365 290a 2020  str(maxClose).  
-0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbb0: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0000dbc0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0000dbd0: 2020 2020 2020 2b20 2863 6f6c 6f72 5465        + (colorTe
-0000dbe0: 7874 2e47 5245 454e 2069 6620 7265 6365  xt.GREEN if rece
-0000dbf0: 6e74 436c 6f73 6520 3e3d 206d 6178 4869  ntClose >= maxHi
-0000dc00: 6768 2065 6c73 6520 636f 6c6f 7254 6578  gh else colorTex
-0000dc10: 742e 4641 494c 290a 2020 2020 2020 2020  t.FAIL).        
-0000dc20: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0000dc30: 523a 2022 0a20 2020 2020 2020 2020 2020  R: ".           
-0000dc40: 2020 2020 2020 2020 202b 2073 7472 286d           + str(m
-0000dc50: 6178 4869 6768 290a 2020 2020 2020 2020  axHigh).        
-0000dc60: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0000dc70: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-0000dc80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000dc90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000dca0: 7475 726e 2054 7275 6520 616e 6420 616c  turn True and al
-0000dcb0: 7265 6164 7942 726f 6b65 6e6f 7574 2061  readyBrokenout a
-0000dcc0: 6e64 2073 656c 662e 6765 7443 616e 646c  nd self.getCandl
-0000dcd0: 6554 7970 6528 7265 6365 6e74 290a 2020  eType(recent).  
-0000dce0: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-0000dcf0: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-0000dd00: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-0000dd10: 2020 2320 2020 2020 6627 5374 6f63 6b3a    #     f'Stock:
-0000dd20: 7b73 6176 6544 6963 745b 2253 746f 636b  {saveDict["Stock
-0000dd30: 225d 7d2c 2064 6f65 7320 6e6f 7420 6861  "]}, does not ha
-0000dd40: 7665 2061 2062 7265 616b 6f75 7420 7965  ve a breakout ye
-0000dd50: 7420 6265 6361 7573 6520 7265 6365 6e74  t because recent
-0000dd60: 2d63 6c6f 7365 2028 7b72 6563 656e 7443  -close ({recentC
-0000dd70: 6c6f 7365 7d29 203c 206d 6178 2d68 6967  lose}) < max-hig
-0000dd80: 6820 287b 6d61 7848 6967 687d 2927 0a20  h ({maxHigh})'. 
-0000dd90: 2020 2020 2020 2020 2020 2023 2029 0a20             # ). 
-0000dda0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000ddb0: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000ddc0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000ddd0: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-0000dde0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-0000ddf0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0000de00: 2e46 4149 4c0a 2020 2020 2020 2020 2020  .FAIL.          
-0000de10: 2020 2020 2020 2b20 2242 4f3a 2022 0a20        + "BO: ". 
-0000de20: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000de30: 2073 7472 286d 6178 436c 6f73 6529 0a20   str(maxClose). 
-0000de40: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000de50: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000de60: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000de70: 2028 636f 6c6f 7254 6578 742e 4752 4545   (colorText.GREE
-0000de80: 4e20 6966 2072 6563 656e 7443 6c6f 7365  N if recentClose
-0000de90: 203e 3d20 6d61 7848 6967 6820 656c 7365   >= maxHigh else
-0000dea0: 2063 6f6c 6f72 5465 7874 2e46 4149 4c29   colorText.FAIL)
-0000deb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dec0: 202b 2022 2052 3a20 220a 2020 2020 2020   + " R: ".      
-0000ded0: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
-0000dee0: 6d61 7848 6967 6829 0a20 2020 2020 2020  maxHigh).       
-0000def0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0000df00: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0000df10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000df20: 2020 2072 6574 7572 6e20 6e6f 7420 616c     return not al
-0000df30: 7265 6164 7942 726f 6b65 6e6f 7574 0a20  readyBrokenout. 
-0000df40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000df50: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000df60: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
-0000df70: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
-0000df80: 436c 6f73 6529 202b 2022 2052 3a20 3022  Close) + " R: 0"
-0000df90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000dfa0: 7265 6365 6e74 436c 6f73 6520 3e3d 206d  recentClose >= m
-0000dfb0: 6178 436c 6f73 653a 0a20 2020 2020 2020  axClose:.       
-0000dfc0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
-0000dfd0: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
-0000dfe0: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
-0000dff0: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
-0000e000: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
-0000e010: 6f63 6b22 5d7d 2c20 6861 7320 6120 6272  ock"]}, has a br
-0000e020: 6561 6b6f 7574 2062 6563 6175 7365 2072  eakout because r
-0000e030: 6563 656e 742d 636c 6f73 6520 287b 7265  ecent-close ({re
-0000e040: 6365 6e74 436c 6f73 657d 2920 3e3d 206d  centClose}) >= m
-0000e050: 6178 2d63 6c6f 7365 2028 7b6d 6178 436c  ax-close ({maxCl
-0000e060: 6f73 657d 2927 0a20 2020 2020 2020 2020  ose})'.         
-0000e070: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
-0000e080: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000e090: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000e0a0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000e0b0: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0000e0c0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-0000e0d0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000e0e0: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
-0000e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e100: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
-0000e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e120: 2b20 7374 7228 6d61 7843 6c6f 7365 290a  + str(maxClose).
-0000e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e140: 2020 2020 2b20 2220 523a 2030 220a 2020      + " R: 0".  
-0000e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e160: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0000e170: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0000e180: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000e190: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
-0000e1a0: 616e 6420 616c 7265 6164 7942 726f 6b65  and alreadyBroke
-0000e1b0: 6e6f 7574 2061 6e64 2073 656c 662e 6765  nout and self.ge
-0000e1c0: 7443 616e 646c 6554 7970 6528 7265 6365  tCandleType(rece
-0000e1d0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0000e1e0: 2320 7365 6c66 2e64 6566 6175 6c74 5f6c  # self.default_l
-0000e1f0: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
-0000e200: 2020 2020 2020 2020 2320 2020 2020 6627          #     f'
-0000e210: 5374 6f63 6b3a 7b73 6176 6544 6963 745b  Stock:{saveDict[
-0000e220: 2253 746f 636b 225d 7d2c 2068 6173 2061  "Stock"]}, has a
-0000e230: 2062 7265 616b 6f75 7420 6265 6361 7573   breakout becaus
-0000e240: 6520 7265 6365 6e74 2d63 6c6f 7365 2028  e recent-close (
-0000e250: 7b72 6563 656e 7443 6c6f 7365 7d29 203c  {recentClose}) <
-0000e260: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
-0000e270: 436c 6f73 657d 2927 0a20 2020 2020 2020  Close})'.       
-0000e280: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000e290: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0000e2a0: 2242 7265 616b 6f75 7422 5d20 3d20 280a  "Breakout"] = (.
-0000e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2c0: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0000e2d0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000e2e0: 2063 6f6c 6f72 5465 7874 2e46 4149 4c0a   colorText.FAIL.
-0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e300: 2b20 2242 4f3a 2022 0a20 2020 2020 2020  + "BO: ".       
-0000e310: 2020 2020 2020 2020 202b 2073 7472 286d           + str(m
-0000e320: 6178 436c 6f73 6529 0a20 2020 2020 2020  axClose).       
-0000e330: 2020 2020 2020 2020 202b 2022 2052 3a20           + " R: 
-0000e340: 3022 0a20 2020 2020 2020 2020 2020 2020  0".             
-0000e350: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0000e360: 4e44 0a20 2020 2020 2020 2020 2020 2029  ND.            )
-0000e370: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e380: 7572 6e20 6e6f 7420 616c 7265 6164 7942  urn not alreadyB
-0000e390: 726f 6b65 6e6f 7574 0a0a 2020 2020 2320  rokenout..    # 
-0000e3a0: 4669 6e64 2073 746f 636b 7320 7468 6174  Find stocks that
-0000e3b0: 2061 7265 2062 756c 6c69 7368 2069 6e74   are bullish int
-0000e3c0: 7261 6461 793a 2052 5349 2063 726f 7373  raday: RSI cross
-0000e3d0: 6573 2035 352c 204d 6163 6420 4869 7374  es 55, Macd Hist
-0000e3e0: 6f67 7261 6d20 706f 7369 7469 7665 2c20  ogram positive, 
-0000e3f0: 7072 6963 6520 6162 6f76 6520 454d 4120  price above EMA 
-0000e400: 3130 0a20 2020 2064 6566 2066 696e 6442  10.    def findB
-0000e410: 756c 6c69 7368 496e 7472 6164 6179 5253  ullishIntradayRS
-0000e420: 494d 4143 4428 7365 6c66 2c20 6466 293a  IMACD(self, df):
-0000e430: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
-0000e440: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
-0000e450: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0000e460: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0000e470: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0000e480: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
-0000e490: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
-0000e4a0: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
-0000e4b0: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
-0000e4c0: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
-0000e4d0: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
-0000e4e0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
-0000e4f0: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
-0000e500: 6865 2064 6174 6166 7261 6d65 2073 6f20  he dataframe so 
-0000e510: 7468 6174 2069 7473 2074 6865 206f 6c64  that its the old
-0000e520: 6573 7420 6461 7465 2066 6972 7374 0a20  est date first. 
-0000e530: 2020 2020 2020 2064 6174 615b 2252 5349         data["RSI
-0000e540: 3132 225d 203d 2070 6b74 616c 6962 2e52  12"] = pktalib.R
-0000e550: 5349 2864 6174 615b 2243 6c6f 7365 225d  SI(data["Close"]
-0000e560: 2c20 3132 290a 2020 2020 2020 2020 6461  , 12).        da
-0000e570: 7461 5b22 454d 4131 3022 5d20 3d20 706b  ta["EMA10"] = pk
-0000e580: 7461 6c69 622e 454d 4128 6461 7461 5b22  talib.EMA(data["
-0000e590: 436c 6f73 6522 5d2c 2031 3029 0a20 2020  Close"], 10).   
-0000e5a0: 2020 2020 2064 6174 615b 2245 4d41 3230       data["EMA20
-0000e5b0: 3022 5d20 3d20 706b 7461 6c69 622e 454d  0"] = pktalib.EM
-0000e5c0: 4128 6461 7461 5b22 436c 6f73 6522 5d2c  A(data["Close"],
-0000e5d0: 2032 3030 290a 2020 2020 2020 2020 6d61   200).        ma
-0000e5e0: 6364 203d 2070 6b74 616c 6962 2e4d 4143  cd = pktalib.MAC
-0000e5f0: 4428 6461 7461 5b22 436c 6f73 6522 5d2c  D(data["Close"],
-0000e600: 2031 302c 2031 382c 2039 295b 325d 2e74   10, 18, 9)[2].t
-0000e610: 6169 6c28 3129 0a20 2020 2020 2020 2072  ail(1).        r
-0000e620: 6563 656e 7420 3d20 6461 7461 2e74 6169  ecent = data.tai
-0000e630: 6c28 3129 0a20 2020 2020 2020 2063 6f6e  l(1).        con
-0000e640: 6431 203d 2072 6563 656e 745b 2252 5349  d1 = recent["RSI
-0000e650: 3132 225d 2e69 6c6f 635b 305d 203e 2035  12"].iloc[0] > 5
-0000e660: 350a 2020 2020 2020 2020 636f 6e64 3220  5.        cond2 
-0000e670: 3d20 636f 6e64 3120 616e 6420 286d 6163  = cond1 and (mac
-0000e680: 642e 696c 6f63 5b3a 315d 5b30 5d20 3e20  d.iloc[:1][0] > 
-0000e690: 3029 0a20 2020 2020 2020 2063 6f6e 6433  0).        cond3
-0000e6a0: 203d 2063 6f6e 6432 2061 6e64 2028 7265   = cond2 and (re
-0000e6b0: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
-0000e6c0: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
-0000e6d0: 454d 4131 3022 5d2e 696c 6f63 5b30 5d29  EMA10"].iloc[0])
-0000e6e0: 0a20 2020 2020 2020 2063 6f6e 6434 203d  .        cond4 =
-0000e6f0: 2063 6f6e 6433 2061 6e64 2028 7265 6365   cond3 and (rece
-0000e700: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-0000e710: 5b30 5d20 3e20 7265 6365 6e74 5b22 454d  [0] > recent["EM
-0000e720: 4132 3030 225d 2e69 6c6f 635b 305d 290a  A200"].iloc[0]).
-0000e730: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0000e740: 6f6e 6434 0a20 2020 200a 2020 2020 2320  ond4.    .    # 
-0000e750: 4669 6e64 2073 746f 636b 7320 7468 6174  Find stocks that
-0000e760: 206f 7065 6e65 6420 6869 6768 6572 2074   opened higher t
-0000e770: 6861 6e20 7468 6520 7072 6576 696f 7573  han the previous
-0000e780: 2068 6967 680a 2020 2020 6465 6620 6669   high.    def fi
-0000e790: 6e64 4869 6768 6572 4f70 656e 7328 7365  ndHigherOpens(se
-0000e7a0: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
-0000e7b0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-0000e7c0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-0000e7d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e7e0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0000e7f0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-0000e800: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0000e810: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
-0000e820: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000e830: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-0000e840: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-0000e850: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
-0000e860: 203d 2064 6174 612e 6865 6164 2832 290a   = data.head(2).
-0000e870: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
-0000e880: 6563 656e 7429 203c 2032 3a0a 2020 2020  ecent) < 2:.    
-0000e890: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0000e8a0: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
-0000e8b0: 7572 6e20 7265 6365 6e74 5b22 4f70 656e  urn recent["Open
-0000e8c0: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
-0000e8d0: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
-0000e8e0: 635b 315d 0a0a 2020 2020 6465 6620 6669  c[1]..    def fi
-0000e8f0: 6e64 4869 6768 6572 4275 6c6c 6973 684f  ndHigherBullishO
-0000e900: 7065 6e73 2873 656c 662c 2064 6629 3a0a  pens(self, df):.
-0000e910: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0000e920: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0000e930: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000e940: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000e950: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000e960: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0000e970: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
-0000e980: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
-0000e990: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
-0000e9a0: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
-0000e9b0: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
-0000e9c0: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
-0000e9d0: 6561 6428 3229 0a20 2020 2020 2020 2069  ead(2).        i
-0000e9e0: 6620 6c65 6e28 7265 6365 6e74 2920 3c20  f len(recent) < 
-0000e9f0: 323a 0a20 2020 2020 2020 2020 2020 2072  2:.            r
-0000ea00: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000ea10: 2020 2020 7265 7475 726e 2072 6563 656e      return recen
-0000ea20: 745b 224f 7065 6e22 5d2e 696c 6f63 5b30  t["Open"].iloc[0
-0000ea30: 5d20 3e20 7265 6365 6e74 5b22 4869 6768  ] > recent["High
-0000ea40: 225d 2e69 6c6f 635b 315d 0a20 2020 200a  "].iloc[1].    .
-0000ea50: 2020 2020 6465 6620 6669 6e64 4e52 3444      def findNR4D
-0000ea60: 6179 2873 656c 662c 2064 6629 3a0a 2020  ay(self, df):.  
-0000ea70: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0000ea80: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0000ea90: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000eaa0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000eab0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0000eac0: 636f 7079 2829 0a20 2020 2020 2020 2023  copy().        #
-0000ead0: 2068 7474 7073 3a2f 2f63 6861 7274 696e   https://chartin
-0000eae0: 6b2e 636f 6d2f 7363 7265 656e 6572 2f6e  k.com/screener/n
-0000eaf0: 7234 2d64 6169 6c79 2d74 6f64 6179 0a20  r4-daily-today. 
-0000eb00: 2020 2020 2020 2069 6620 6461 7461 2e74         if data.t
-0000eb10: 6169 6c28 3129 5b22 566f 6c75 6d65 225d  ail(1)["Volume"]
-0000eb20: 2e69 6c6f 635b 305d 203c 3d20 3530 3030  .iloc[0] <= 5000
-0000eb30: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
-0000eb40: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000eb50: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0000eb60: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
-0000eb70: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
-0000eb80: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
-0000eb90: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
-0000eba0: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
-0000ebb0: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
-0000ebc0: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
-0000ebd0: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
-0000ebe0: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
-0000ebf0: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
-0000ec00: 4d41 3130 225d 203d 2070 6b74 616c 6962  MA10"] = pktalib
-0000ec10: 2e53 4d41 2864 6174 615b 2243 6c6f 7365  .SMA(data["Close
-0000ec20: 225d 2c20 3130 290a 2020 2020 2020 2020  "], 10).        
-0000ec30: 6461 7461 5b22 534d 4135 3022 5d20 3d20  data["SMA50"] = 
-0000ec40: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-0000ec50: 5b22 436c 6f73 6522 5d2c 2035 3029 0a20  ["Close"], 50). 
-0000ec60: 2020 2020 2020 2064 6174 615b 2253 4d41         data["SMA
-0000ec70: 3230 3022 5d20 3d20 706b 7461 6c69 622e  200"] = pktalib.
-0000ec80: 534d 4128 6461 7461 5b22 436c 6f73 6522  SMA(data["Close"
-0000ec90: 5d2c 2032 3030 290a 2020 2020 2020 2020  ], 200).        
-0000eca0: 7265 6365 6e74 203d 2064 6174 612e 7461  recent = data.ta
-0000ecb0: 696c 2835 290a 2020 2020 2020 2020 7265  il(5).        re
-0000ecc0: 6365 6e74 203d 2072 6563 656e 745b 3a3a  cent = recent[::
-0000ecd0: 2d31 5d0a 2020 2020 2020 2020 636f 6e64  -1].        cond
-0000ece0: 3120 3d20 2872 6563 656e 745b 2248 6967  1 = (recent["Hig
-0000ecf0: 6822 5d2e 696c 6f63 5b30 5d20 2d20 7265  h"].iloc[0] - re
-0000ed00: 6365 6e74 5b22 4c6f 7722 5d2e 696c 6f63  cent["Low"].iloc
-0000ed10: 5b30 5d29 203c 2028 0a20 2020 2020 2020  [0]) < (.       
-0000ed20: 2020 2020 2072 6563 656e 745b 2248 6967       recent["Hig
-0000ed30: 6822 5d2e 696c 6f63 5b31 5d20 2d20 7265  h"].iloc[1] - re
-0000ed40: 6365 6e74 5b22 4c6f 7722 5d2e 696c 6f63  cent["Low"].iloc
-0000ed50: 5b31 5d0a 2020 2020 2020 2020 290a 2020  [1].        ).  
-0000ed60: 2020 2020 2020 636f 6e64 3220 3d20 636f        cond2 = co
-0000ed70: 6e64 3120 616e 6420 2872 6563 656e 745b  nd1 and (recent[
-0000ed80: 2248 6967 6822 5d2e 696c 6f63 5b30 5d20  "High"].iloc[0] 
-0000ed90: 2d20 7265 6365 6e74 5b22 4c6f 7722 5d2e  - recent["Low"].
-0000eda0: 696c 6f63 5b30 5d29 203c 2028 0a20 2020  iloc[0]) < (.   
-0000edb0: 2020 2020 2020 2020 2072 6563 656e 745b           recent[
-0000edc0: 2248 6967 6822 5d2e 696c 6f63 5b32 5d20  "High"].iloc[2] 
-0000edd0: 2d20 7265 6365 6e74 5b22 4c6f 7722 5d2e  - recent["Low"].
-0000ede0: 696c 6f63 5b32 5d0a 2020 2020 2020 2020  iloc[2].        
-0000edf0: 290a 2020 2020 2020 2020 636f 6e64 3320  ).        cond3 
-0000ee00: 3d20 636f 6e64 3220 616e 6420 2872 6563  = cond2 and (rec
-0000ee10: 656e 745b 2248 6967 6822 5d2e 696c 6f63  ent["High"].iloc
-0000ee20: 5b30 5d20 2d20 7265 6365 6e74 5b22 4c6f  [0] - recent["Lo
-0000ee30: 7722 5d2e 696c 6f63 5b30 5d29 203c 2028  w"].iloc[0]) < (
-0000ee40: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
-0000ee50: 656e 745b 2248 6967 6822 5d2e 696c 6f63  ent["High"].iloc
-0000ee60: 5b33 5d20 2d20 7265 6365 6e74 5b22 4c6f  [3] - recent["Lo
-0000ee70: 7722 5d2e 696c 6f63 5b33 5d0a 2020 2020  w"].iloc[3].    
-0000ee80: 2020 2020 290a 2020 2020 2020 2020 636f      ).        co
-0000ee90: 6e64 3420 3d20 636f 6e64 3320 616e 6420  nd4 = cond3 and 
-0000eea0: 2872 6563 656e 745b 2248 6967 6822 5d2e  (recent["High"].
-0000eeb0: 696c 6f63 5b30 5d20 2d20 7265 6365 6e74  iloc[0] - recent
-0000eec0: 5b22 4c6f 7722 5d2e 696c 6f63 5b30 5d29  ["Low"].iloc[0])
-0000eed0: 203c 2028 0a20 2020 2020 2020 2020 2020   < (.           
-0000eee0: 2072 6563 656e 745b 2248 6967 6822 5d2e   recent["High"].
-0000eef0: 696c 6f63 5b34 5d20 2d20 7265 6365 6e74  iloc[4] - recent
-0000ef00: 5b22 4c6f 7722 5d2e 696c 6f63 5b34 5d0a  ["Low"].iloc[4].
-0000ef10: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ef20: 2020 636f 6e64 3520 3d20 636f 6e64 3420    cond5 = cond4 
-0000ef30: 616e 6420 2872 6563 656e 745b 2253 4d41  and (recent["SMA
-0000ef40: 3130 225d 2e69 6c6f 635b 305d 203e 2072  10"].iloc[0] > r
-0000ef50: 6563 656e 745b 2253 4d41 3530 225d 2e69  ecent["SMA50"].i
-0000ef60: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
-0000ef70: 636f 6e64 3620 3d20 636f 6e64 3520 616e  cond6 = cond5 an
-0000ef80: 6420 2872 6563 656e 745b 2253 4d41 3530  d (recent["SMA50
-0000ef90: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
-0000efa0: 656e 745b 2253 4d41 3230 3022 5d2e 696c  ent["SMA200"].il
-0000efb0: 6f63 5b30 5d29 0a20 2020 2020 2020 2072  oc[0]).        r
-0000efc0: 6574 7572 6e20 636f 6e64 360a 0a20 2020  eturn cond6..   
-0000efd0: 2023 2046 696e 6420 706f 7465 6e74 6961   # Find potentia
-0000efe0: 6c20 6272 6561 6b6f 7574 2073 746f 636b  l breakout stock
-0000eff0: 730a 2020 2020 2320 5468 6973 2073 6361  s.    # This sca
-0000f000: 6e6e 6572 2066 696c 7465 7273 2073 746f  nner filters sto
-0000f010: 636b 7320 7768 6f73 6520 6375 7272 656e  cks whose curren
-0000f020: 7420 636c 6f73 6520 7072 6963 6520 2b20  t close price + 
-0000f030: 3525 2069 7320 6869 6768 6572 0a20 2020  5% is higher.   
-0000f040: 2023 2074 6861 6e20 7468 6520 6869 6768   # than the high
-0000f050: 6573 7420 4869 6768 2070 7269 6365 2069  est High price i
-0000f060: 6e20 7061 7374 2032 3030 2063 616e 646c  n past 200 candl
-0000f070: 6573 2061 6e64 2074 6865 206d 6178 696d  es and the maxim
-0000f080: 756d 2068 6967 680a 2020 2020 2320 696e  um high.    # in
-0000f090: 2074 6865 2070 7265 7669 6f75 7320 3330   the previous 30
-0000f0a0: 2063 616e 646c 6573 2069 7320 6c6f 7765   candles is lowe
-0000f0b0: 7220 7468 616e 2074 6865 2068 6967 6865  r than the highe
-0000f0c0: 7374 2068 6967 6820 6d61 6465 2069 6e20  st high made in 
-0000f0d0: 7468 650a 2020 2020 2320 7072 6576 696f  the.    # previo
-0000f0e0: 7573 2032 3030 2063 616e 646c 6573 2c20  us 200 candles, 
-0000f0f0: 7374 6172 7469 6e67 2066 726f 6d20 7468  starting from th
-0000f100: 6520 7072 6576 696f 7573 2033 3074 6820  e previous 30th 
-0000f110: 6361 6e64 6c65 2e20 4174 2074 6865 0a20  candle. At the. 
-0000f120: 2020 2023 2073 616d 6520 7469 6d65 2074     # same time t
-0000f130: 6865 2063 7572 7265 6e74 2063 616e 646c  he current candl
-0000f140: 6520 766f 6c75 6d65 2069 7320 6869 6768  e volume is high
-0000f150: 6572 2074 6861 6e20 3230 3020 534d 4120  er than 200 SMA 
-0000f160: 6f66 2076 6f6c 756d 652e 0a20 2020 2064  of volume..    d
-0000f170: 6566 2066 696e 6450 6f74 656e 7469 616c  ef findPotential
-0000f180: 4272 6561 6b6f 7574 2873 656c 662c 2064  Breakout(self, d
-0000f190: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-0000f1a0: 6176 6544 6963 742c 2064 6179 7354 6f4c  aveDict, daysToL
-0000f1b0: 6f6f 6b62 6163 6b29 3a0a 2020 2020 2020  ookback):.      
-0000f1c0: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-0000f1d0: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-0000f1e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000f1f0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0000f200: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-0000f210: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-0000f220: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-0000f230: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0000f240: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-0000f250: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-0000f260: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-0000f270: 3d20 6461 7461 2e68 6561 6428 3233 3129  = data.head(231)
-0000f280: 0a20 2020 2020 2020 2072 6563 656e 7420  .        recent 
-0000f290: 3d20 6461 7461 2e68 6561 6428 3129 0a20  = data.head(1). 
-0000f2a0: 2020 2020 2020 2072 6563 656e 7456 6f6c         recentVol
-0000f2b0: 756d 6520 3d20 7265 6365 6e74 5b22 566f  ume = recent["Vo
-0000f2c0: 6c75 6d65 225d 2e69 6c6f 635b 305d 0a20  lume"].iloc[0]. 
-0000f2d0: 2020 2020 2020 2072 6563 656e 7443 6c6f         recentClo
-0000f2e0: 7365 203d 2072 6f75 6e64 2872 6563 656e  se = round(recen
-0000f2f0: 745b 2243 6c6f 7365 225d 2e69 6c6f 635b  t["Close"].iloc[
-0000f300: 305d 202a 2031 2e30 352c 2032 290a 2020  0] * 1.05, 2).  
-0000f310: 2020 2020 2020 6869 6768 6573 7448 6967        highestHig
-0000f320: 6832 3030 203d 2072 6f75 6e64 2864 6174  h200 = round(dat
-0000f330: 612e 6865 6164 2832 3031 292e 7461 696c  a.head(201).tail
-0000f340: 2832 3030 292e 6465 7363 7269 6265 2829  (200).describe()
-0000f350: 5b22 4869 6768 225d 5b22 6d61 7822 5d2c  ["High"]["max"],
-0000f360: 2032 290a 2020 2020 2020 2020 6869 6768   2).        high
-0000f370: 6573 7448 6967 6833 3020 3d20 726f 756e  estHigh30 = roun
-0000f380: 6428 6461 7461 2e68 6561 6428 3331 292e  d(data.head(31).
-0000f390: 7461 696c 2833 3029 2e64 6573 6372 6962  tail(30).describ
-0000f3a0: 6528 295b 2248 6967 6822 5d5b 226d 6178  e()["High"]["max
-0000f3b0: 225d 2c20 3229 0a20 2020 2020 2020 2068  "], 2).        h
-0000f3c0: 6967 6865 7374 4869 6768 3230 3046 726f  ighestHigh200Fro
-0000f3d0: 6d33 3020 3d20 726f 756e 6428 6461 7461  m30 = round(data
-0000f3e0: 2e74 6169 6c28 3230 3029 2e64 6573 6372  .tail(200).descr
-0000f3f0: 6962 6528 295b 2248 6967 6822 5d5b 226d  ibe()["High"]["m
-0000f400: 6178 225d 2c20 3229 0a20 2020 2020 2020  ax"], 2).       
-0000f410: 2068 6967 6865 7374 4869 6768 3846 726f   highestHigh8Fro
-0000f420: 6d33 3020 3d20 726f 756e 6428 6461 7461  m30 = round(data
-0000f430: 2e68 6561 6428 3339 292e 7461 696c 2838  .head(39).tail(8
-0000f440: 292e 6465 7363 7269 6265 2829 5b22 4869  ).describe()["Hi
-0000f450: 6768 225d 5b22 6d61 7822 5d2c 2032 290a  gh"]["max"], 2).
-0000f460: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000f470: 6174 612e 6865 6164 2832 3030 290a 2020  ata.head(200).  
-0000f480: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-0000f490: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
-0000f4a0: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
-0000f4b0: 2073 6f20 7468 6174 2069 7473 2074 6865   so that its the
-0000f4c0: 206f 6c64 6573 7420 6461 7465 2066 6972   oldest date fir
-0000f4d0: 7374 0a20 2020 2020 2020 2076 6f6c 3230  st.        vol20
-0000f4e0: 3020 3d20 706b 7461 6c69 622e 534d 4128  0 = pktalib.SMA(
-0000f4f0: 6461 7461 5b22 566f 6c75 6d65 225d 2c74  data["Volume"],t
-0000f500: 696d 6570 6572 696f 643d 3230 3029 0a20  imeperiod=200). 
-0000f510: 2020 2020 2020 2064 6174 615b 2253 4d41         data["SMA
-0000f520: 3230 3056 225d 203d 2076 6f6c 3230 300a  200V"] = vol200.
-0000f530: 2020 2020 2020 2020 766f 6c35 3020 3d20          vol50 = 
-0000f540: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-0000f550: 5b22 566f 6c75 6d65 225d 2c74 696d 6570  ["Volume"],timep
-0000f560: 6572 696f 643d 3530 290a 2020 2020 2020  eriod=50).      
-0000f570: 2020 6461 7461 5b22 534d 4135 3056 225d    data["SMA50V"]
-0000f580: 203d 2076 6f6c 3530 0a20 2020 2020 2020   = vol50.       
-0000f590: 2072 6563 656e 7420 3d20 6461 7461 2e74   recent = data.t
-0000f5a0: 6169 6c28 3129 0a20 2020 2020 2020 2073  ail(1).        s
-0000f5b0: 6d61 3230 3076 203d 2072 6563 656e 745b  ma200v = recent[
-0000f5c0: 2253 4d41 3230 3056 225d 2e69 6c6f 635b  "SMA200V"].iloc[
-0000f5d0: 305d 0a20 2020 2020 2020 2073 6d61 3530  0].        sma50
-0000f5e0: 7620 3d20 7265 6365 6e74 5b22 534d 4135  v = recent["SMA5
-0000f5f0: 3056 225d 2e69 6c6f 635b 305d 0a20 2020  0V"].iloc[0].   
-0000f600: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-0000f610: 2020 2020 2020 6e70 2e69 736e 616e 2872        np.isnan(r
-0000f620: 6563 656e 7443 6c6f 7365 290a 2020 2020  ecentClose).    
-0000f630: 2020 2020 2020 2020 6f72 206e 702e 6973          or np.is
-0000f640: 6e61 6e28 6869 6768 6573 7448 6967 6832  nan(highestHigh2
-0000f650: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-0000f660: 6f72 206e 702e 6973 6e61 6e28 6869 6768  or np.isnan(high
-0000f670: 6573 7448 6967 6833 3029 0a20 2020 2020  estHigh30).     
-0000f680: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
-0000f690: 616e 2868 6967 6865 7374 4869 6768 3230  an(highestHigh20
-0000f6a0: 3046 726f 6d33 3029 0a20 2020 2020 2020  0From30).       
-0000f6b0: 2020 2020 206f 7220 6e70 2e69 736e 616e       or np.isnan
-0000f6c0: 2868 6967 6865 7374 4869 6768 3846 726f  (highestHigh8Fro
-0000f6d0: 6d33 3029 0a20 2020 2020 2020 2020 2020  m30).           
-0000f6e0: 206f 7220 6e70 2e69 736e 616e 2872 6563   or np.isnan(rec
-0000f6f0: 656e 7456 6f6c 756d 6529 0a20 2020 2020  entVolume).     
-0000f700: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
-0000f710: 616e 2873 6d61 3230 3076 290a 2020 2020  an(sma200v).    
-0000f720: 2020 2020 2020 2020 6f72 206e 702e 6973          or np.is
-0000f730: 6e61 6e28 736d 6135 3076 290a 2020 2020  nan(sma50v).    
-0000f740: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0000f750: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000f760: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-0000f770: 2020 2020 2020 2020 2028 7265 6365 6e74           (recent
-0000f780: 436c 6f73 6520 3e20 6869 6768 6573 7448  Close > highestH
-0000f790: 6967 6832 3030 290a 2020 2020 2020 2020  igh200).        
-0000f7a0: 2020 2020 616e 6420 2828 2868 6967 6865      and (((highe
-0000f7b0: 7374 4869 6768 3330 203c 2068 6967 6865  stHigh30 < highe
-0000f7c0: 7374 4869 6768 3230 3046 726f 6d33 3029  stHigh200From30)
-0000f7d0: 2061 6e64 2028 7265 6365 6e74 566f 6c75   and (recentVolu
-0000f7e0: 6d65 203e 2073 6d61 3230 3076 2929 206f  me > sma200v)) o
-0000f7f0: 7220 5c0a 2020 2020 2020 2020 2020 2020  r \.            
-0000f800: 2020 2020 2028 2868 6967 6865 7374 4869       ((highestHi
-0000f810: 6768 3330 203c 2068 6967 6865 7374 4869  gh30 < highestHi
-0000f820: 6768 3846 726f 6d33 3029 2061 6e64 2028  gh8From30) and (
-0000f830: 7265 6365 6e74 566f 6c75 6d65 203e 2073  recentVolume > s
-0000f840: 6d61 3530 7629 290a 2020 2020 2020 2020  ma50v)).        
-0000f850: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000f860: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000f870: 2073 6176 6544 6963 745b 2242 7265 616b   saveDict["Break
-0000f880: 6f75 7422 5d20 3d20 7361 7665 4469 6374  out"] = saveDict
-0000f890: 5b22 4272 6561 6b6f 7574 225d 202b 2022  ["Breakout"] + "
-0000f8a0: 2850 6f74 656e 7469 616c 2922 0a20 2020  (Potential)".   
-0000f8b0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0000f8c0: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
-0000f8d0: 3d20 7363 7265 656e 4469 6374 5b22 4272  = screenDict["Br
-0000f8e0: 6561 6b6f 7574 225d 202b 2028 0a20 2020  eakout"] + (.   
-0000f8f0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-0000f900: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-0000f910: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
-0000f920: 2220 2850 6f74 656e 7469 616c 2922 202b  " (Potential)" +
-0000f930: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000f940: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000f950: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000f960: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-0000f970: 7572 6e20 4661 6c73 650a 0a20 2020 2023  urn False..    #
-0000f980: 2046 696e 6420 7374 6f63 6b73 2077 6974   Find stocks wit
-0000f990: 6820 7265 7665 7273 696e 6720 5053 4152  h reversing PSAR
-0000f9a0: 2061 6e64 2052 5349 0a20 2020 2064 6566   and RSI.    def
-0000f9b0: 2066 696e 6450 5341 5252 6576 6572 7361   findPSARReversa
-0000f9c0: 6c57 6974 6852 5349 2873 656c 662c 2064  lWithRSI(self, d
-0000f9d0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-0000f9e0: 6176 6544 6963 742c 6d69 6e52 5349 3d35  aveDict,minRSI=5
-0000f9f0: 3029 3a0a 2020 2020 2020 2020 6966 2064  0):.        if d
-0000fa00: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-0000fa10: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-0000fa20: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000fa30: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-0000fa40: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0000fa50: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0000fa60: 5b3a 3a2d 315d 0a20 2020 2020 2020 2070  [::-1].        p
-0000fa70: 7361 7220 3d20 706b 7461 6c69 622e 7073  sar = pktalib.ps
-0000fa80: 6172 2864 6174 615b 2248 6967 6822 5d2c  ar(data["High"],
-0000fa90: 6461 7461 5b22 4c6f 7722 5d29 0a20 2020  data["Low"]).   
-0000faa0: 2020 2020 2069 6620 6c65 6e28 7073 6172       if len(psar
-0000fab0: 2920 3c20 333a 0a20 2020 2020 2020 2020  ) < 3:.         
-0000fac0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000fad0: 2020 2020 2020 2020 7073 6172 203d 2070          psar = p
-0000fae0: 7361 722e 7461 696c 2833 290a 2020 2020  sar.tail(3).    
-0000faf0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0000fb00: 7461 696c 2833 290a 2020 2020 2020 2020  tail(3).        
-0000fb10: 2320 6461 794d 696e 7573 3250 7361 7220  # dayMinus2Psar 
-0000fb20: 3d20 7073 6172 2e69 6c6f 635b 305d 0a20  = psar.iloc[0]. 
-0000fb30: 2020 2020 2020 2064 6179 4d69 6e75 7331         dayMinus1
-0000fb40: 5073 6172 203d 2070 7361 722e 696c 6f63  Psar = psar.iloc
-0000fb50: 5b31 5d0a 2020 2020 2020 2020 6461 7950  [1].        dayP
-0000fb60: 5341 5220 3d20 7073 6172 2e69 6c6f 635b  SAR = psar.iloc[
-0000fb70: 325d 0a20 2020 2020 2020 2023 2064 6179  2].        # day
-0000fb80: 4d69 6e75 7332 436c 6f73 6520 3d20 6461  Minus2Close = da
-0000fb90: 7461 5b22 436c 6f73 6522 5d2e 696c 6f63  ta["Close"].iloc
-0000fba0: 5b30 5d0a 2020 2020 2020 2020 6461 794d  [0].        dayM
-0000fbb0: 696e 7573 3143 6c6f 7365 203d 2064 6174  inus1Close = dat
-0000fbc0: 615b 2243 6c6f 7365 225d 2e69 6c6f 635b  a["Close"].iloc[
-0000fbd0: 315d 0a20 2020 2020 2020 2064 6179 436c  1].        dayCl
-0000fbe0: 6f73 6520 3d20 6461 7461 5b22 436c 6f73  ose = data["Clos
-0000fbf0: 6522 5d2e 696c 6f63 5b32 5d0a 2020 2020  e"].iloc[2].    
-0000fc00: 2020 2020 2320 6461 794d 696e 7573 3252      # dayMinus2R
-0000fc10: 5349 203d 2064 6174 615b 2252 5349 225d  SI = data["RSI"]
-0000fc20: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-0000fc30: 2064 6179 4d69 6e75 7331 5253 4920 3d20   dayMinus1RSI = 
-0000fc40: 6461 7461 5b22 5253 4922 5d2e 696c 6f63  data["RSI"].iloc
-0000fc50: 5b31 5d0a 2020 2020 2020 2020 6461 7952  [1].        dayR
-0000fc60: 5349 203d 2064 6174 615b 2252 5349 225d  SI = data["RSI"]
-0000fc70: 2e69 6c6f 635b 325d 0a20 2020 2020 2020  .iloc[2].       
-0000fc80: 200a 2020 2020 2020 2020 6861 7352 6576   .        hasRev
-0000fc90: 6572 7361 6c3d 2028 2828 6461 794d 696e  ersal= (((dayMin
-0000fca0: 7573 3150 7361 7220 3e3d 2064 6179 4d69  us1Psar >= dayMi
-0000fcb0: 6e75 7331 436c 6f73 6529 2061 6e64 205c  nus1Close) and \
-0000fcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fcd0: 2020 2020 2028 6461 7943 6c6f 7365 203e       (dayClose >
-0000fce0: 3d20 6461 7950 5341 5229 2920 616e 6420  = dayPSAR)) and 
-0000fcf0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0000fd00: 2020 2020 2020 2864 6179 4d69 6e75 7331        (dayMinus1
-0000fd10: 5253 4920 3c3d 206d 696e 5253 4929 2061  RSI <= minRSI) a
-0000fd20: 6e64 205c 0a20 2020 2020 2020 2020 2020  nd \.           
-0000fd30: 2020 2020 2020 2020 2028 6461 7952 5349           (dayRSI
-0000fd40: 203e 3d20 6461 794d 696e 7573 3152 5349   >= dayMinus1RSI
-0000fd50: 2929 0a20 2020 2020 2020 2069 6620 6861  )).        if ha
-0000fd60: 7352 6576 6572 7361 6c3a 0a20 2020 2020  sReversal:.     
-0000fd70: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
-0000fd80: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
-0000fd90: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
-0000fda0: 4469 6374 2c73 6176 6544 6963 742c 2022  Dict,saveDict, "
-0000fdb0: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
-0000fdc0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-0000fdd0: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
-0000fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdf0: 7361 7665 645b 305d 200a 2020 2020 2020  saved[0] .      
-0000fe00: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0000fe10: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-0000fe20: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0000fe30: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-0000fe40: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-0000fe50: 2250 5341 522d 5253 492d 5265 7622 0a20  "PSAR-RSI-Rev". 
-0000fe60: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000fe70: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000fe80: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000fe90: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000fea0: 745b 2250 6174 7465 726e 225d 203d 2073  t["Pattern"] = s
-0000feb0: 6176 6564 5b31 5d20 2b20 6622 5053 4152  aved[1] + f"PSAR
-0000fec0: 2d52 5349 2d52 6576 220a 2020 2020 2020  -RSI-Rev".      
-0000fed0: 2020 2020 2020 2020 2020 2320 2828 2864            # (((d
-0000fee0: 6179 4d69 6e75 7332 5073 6172 203e 3d20  ayMinus2Psar >= 
-0000fef0: 6461 794d 696e 7573 3243 6c6f 7365 2920  dayMinus2Close) 
-0000ff00: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-0000ff10: 2020 2020 2020 2320 2828 6461 794d 696e        # ((dayMin
-0000ff20: 7573 3143 6c6f 7365 203e 3d20 6461 794d  us1Close >= dayM
-0000ff30: 696e 7573 3150 7361 7229 2061 6e64 205c  inus1Psar) and \
-0000ff40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff50: 2023 2028 6461 7943 6c6f 7365 203e 3d20   # (dayClose >= 
-0000ff60: 6461 7950 5341 5229 2929 2061 6e64 205c  dayPSAR))) and \
-0000ff70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff80: 2023 2028 6461 794d 696e 7573 3252 5349   # (dayMinus2RSI
-0000ff90: 203e 3d20 6d69 6e52 5349 2920 616e 6420   >= minRSI) and 
-0000ffa0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0000ffb0: 2020 2320 2864 6179 4d69 6e75 7331 5253    # (dayMinus1RS
-0000ffc0: 4920 3e3d 2064 6179 4d69 6e75 7332 5253  I >= dayMinus2RS
-0000ffd0: 4929 2061 6e64 205c 0a20 2020 2020 2020  I) and \.       
-0000ffe0: 2020 2020 2020 2020 2023 2028 6461 7952           # (dayR
-0000fff0: 5349 203e 3d20 6461 794d 696e 7573 3152  SI >= dayMinus1R
-00010000: 5349 2929 206f 7220 5c0a 2020 2020 2020  SI)) or \.      
-00010010: 2020 7265 7475 726e 2068 6173 5265 7665    return hasReve
-00010020: 7273 616c 0a0a 2020 2020 2320 4669 6e64  rsal..    # Find
-00010030: 2073 746f 636b 2072 6576 6572 7369 6e67   stock reversing
-00010040: 2061 7420 6769 7665 6e20 4d41 0a20 2020   at given MA.   
-00010050: 2064 6566 2066 696e 6452 6576 6572 7361   def findReversa
-00010060: 6c4d 4128 7365 6c66 2c20 6466 2c20 7363  lMA(self, df, sc
-00010070: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-00010080: 6374 2c20 6d61 4c65 6e67 7468 2c20 7065  ct, maLength, pe
-00010090: 7263 656e 7461 6765 3d30 2e30 3229 3a0a  rcentage=0.02):.
-000100a0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-000100b0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-000100c0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-000100d0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-000100e0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000100f0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-00010100: 206d 6152 616e 6765 203d 205b 392c 2031   maRange = [9, 1
-00010110: 302c 2032 302c 2035 302c 2032 3030 5d20  0, 20, 50, 200] 
-00010120: 6966 206d 614c 656e 6774 6820 696e 205b  if maLength in [
-00010130: 392c 3130 2c32 302c 3530 2c31 3030 5d20  9,10,20,50,100] 
-00010140: 656c 7365 205b 392c 3130 2c32 302c 3530  else [9,10,20,50
-00010150: 2c31 3030 2c6d 6152 616e 6765 5d0a 2020  ,100,maRange].  
-00010160: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
-00010170: 5b5d 0a20 2020 2020 2020 2068 6173 5265  [].        hasRe
-00010180: 7665 7273 616c 7320 3d20 4661 6c73 650a  versals = False.
-00010190: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000101a0: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
-000101b0: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
-000101c0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
-000101d0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
-000101e0: 7361 7665 4469 6374 2c20 224d 412d 5369  saveDict, "MA-Si
-000101f0: 676e 616c 2229 0a20 2020 2020 2020 2066  gnal").        f
-00010200: 6f72 206d 614c 656e 6774 6820 696e 206d  or maLength in m
-00010210: 6152 616e 6765 3a0a 2020 2020 2020 2020  aRange:.        
-00010220: 2020 2020 6461 7461 436f 7079 203d 2064      dataCopy = d
-00010230: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
-00010240: 6966 2073 656c 662e 636f 6e66 6967 4d61  if self.configMa
-00010250: 6e61 6765 722e 7573 6545 4d41 206f 7220  nager.useEMA or 
-00010260: 6d61 4c65 6e67 7468 203d 3d20 393a 0a20  maLength == 9:. 
-00010270: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00010280: 6152 6576 203d 2070 6b74 616c 6962 2e45  aRev = pktalib.E
-00010290: 4d41 2864 6174 6143 6f70 795b 2243 6c6f  MA(dataCopy["Clo
-000102a0: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
-000102b0: 3d6d 614c 656e 6774 6829 0a20 2020 2020  =maLength).     
-000102c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000102d0: 2020 2020 2020 2020 2020 2020 206d 6152               maR
-000102e0: 6576 203d 2070 6b74 616c 6962 2e4d 4128  ev = pktalib.MA(
-000102f0: 6461 7461 436f 7079 5b22 436c 6f73 6522  dataCopy["Close"
-00010300: 5d2c 2074 696d 6570 6572 696f 643d 6d61  ], timeperiod=ma
-00010310: 4c65 6e67 7468 290a 2020 2020 2020 2020  Length).        
-00010320: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00010330: 2020 2020 2020 2020 2064 6174 6143 6f70           dataCop
-00010340: 792e 6472 6f70 2822 6d61 5265 7622 2c20  y.drop("maRev", 
-00010350: 6178 6973 3d31 2c20 696e 706c 6163 653d  axis=1, inplace=
-00010360: 5472 7565 2c20 6572 726f 7273 3d22 6967  True, errors="ig
-00010370: 6e6f 7265 2229 0a20 2020 2020 2020 2020  nore").         
-00010380: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00010390: 696f 6e3a 2320 7072 6167 6d61 3a20 6e6f  ion:# pragma: no
-000103a0: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-000103b0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-000103c0: 2020 2020 2020 2020 6461 7461 436f 7079          dataCopy
-000103d0: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-000103e0: 436f 7079 2e63 6f6c 756d 6e73 292c 2022  Copy.columns), "
-000103f0: 6d61 5265 7622 2c20 6d61 5265 7629 0a20  maRev", maRev). 
-00010400: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
-00010410: 6f70 7920 3d20 6461 7461 436f 7079 5b3a  opy = dataCopy[:
-00010420: 3a2d 315d 2e68 6561 6428 3429 0a20 2020  :-1].head(4).   
-00010430: 2020 2020 2020 2020 2062 756c 6c69 7368           bullish
-00010440: 4d41 5265 7665 7273 616c 203d 2064 6174  MAReversal = dat
-00010450: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-00010460: 6c6f 635b 305d 203e 3d20 6461 7461 436f  loc[0] >= dataCo
-00010470: 7079 5b22 6d61 5265 7622 5d2e 696c 6f63  py["maRev"].iloc
-00010480: 5b31 5d20 616e 6420 5c0a 2020 2020 2020  [1] and \.      
-00010490: 2020 2020 2020 2020 2020 6461 7461 436f            dataCo
-000104a0: 7079 5b22 6d61 5265 7622 5d2e 696c 6f63  py["maRev"].iloc
-000104b0: 5b31 5d20 3e3d 2064 6174 6143 6f70 795b  [1] >= dataCopy[
-000104c0: 226d 6152 6576 225d 2e69 6c6f 635b 325d  "maRev"].iloc[2]
-000104d0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-000104e0: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
-000104f0: 6f70 795b 226d 6152 6576 225d 2e69 6c6f  opy["maRev"].ilo
-00010500: 635b 325d 203c 2064 6174 6143 6f70 795b  c[2] < dataCopy[
-00010510: 226d 6152 6576 225d 2e69 6c6f 635b 335d  "maRev"].iloc[3]
-00010520: 0a20 2020 2020 2020 2020 2020 2062 756c  .            bul
-00010530: 6c69 7368 436c 6f73 6520 3d20 6461 7461  lishClose = data
-00010540: 436f 7079 2e68 6561 6428 3129 5b22 436c  Copy.head(1)["Cl
-00010550: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e3d  ose"].iloc[0] >=
-00010560: 2064 6174 6143 6f70 792e 6865 6164 2831   dataCopy.head(1
-00010570: 295b 226d 6152 6576 225d 2e69 6c6f 635b  )["maRev"].iloc[
-00010580: 305d 0a20 2020 2020 2020 2020 2020 2062  0].            b
-00010590: 6561 7269 7368 4d41 5265 7665 7273 616c  earishMAReversal
-000105a0: 203d 2064 6174 6143 6f70 795b 226d 6152   = dataCopy["maR
-000105b0: 6576 225d 2e69 6c6f 635b 305d 203c 3d20  ev"].iloc[0] <= 
-000105c0: 6461 7461 436f 7079 5b22 6d61 5265 7622  dataCopy["maRev"
-000105d0: 5d2e 696c 6f63 5b31 5d20 616e 6420 5c0a  ].iloc[1] and \.
-000105e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105f0: 6461 7461 436f 7079 5b22 6d61 5265 7622  dataCopy["maRev"
-00010600: 5d2e 696c 6f63 5b31 5d20 3c3d 2064 6174  ].iloc[1] <= dat
-00010610: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-00010620: 6c6f 635b 325d 2061 6e64 205c 0a20 2020  loc[2] and \.   
-00010630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010640: 2064 6174 6143 6f70 795b 226d 6152 6576   dataCopy["maRev
-00010650: 225d 2e69 6c6f 635b 325d 203e 2064 6174  "].iloc[2] > dat
-00010660: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-00010670: 6c6f 635b 335d 0a20 2020 2020 2020 2020  loc[3].         
-00010680: 2020 2069 7352 6563 656e 7443 6c6f 7365     isRecentClose
-00010690: 5769 7468 696e 5065 7263 656e 7452 616e  WithinPercentRan
-000106a0: 6765 203d 2064 6174 6143 6f70 792e 6571  ge = dataCopy.eq
-000106b0: 7561 6c73 2864 6174 6143 6f70 795b 2864  uals(dataCopy[(d
-000106c0: 6174 6143 6f70 792e 436c 6f73 6520 3e3d  ataCopy.Close >=
-000106d0: 2028 6461 7461 436f 7079 2e6d 6152 6576   (dataCopy.maRev
-000106e0: 202d 2028 6461 7461 436f 7079 2e6d 6152   - (dataCopy.maR
-000106f0: 6576 202a 2070 6572 6365 6e74 6167 6529  ev * percentage)
-00010700: 2929 2026 2028 6461 7461 436f 7079 2e43  )) & (dataCopy.C
-00010710: 6c6f 7365 203c 3d20 2864 6174 6143 6f70  lose <= (dataCop
-00010720: 792e 6d61 5265 7620 2b20 2864 6174 6143  y.maRev + (dataC
-00010730: 6f70 792e 6d61 5265 7620 2a20 7065 7263  opy.maRev * perc
-00010740: 656e 7461 6765 2929 295d 290a 2020 2020  entage)))]).    
-00010750: 2020 2020 2020 2020 6966 2028 6973 5265          if (isRe
-00010760: 6365 6e74 436c 6f73 6557 6974 6869 6e50  centCloseWithinP
-00010770: 6572 6365 6e74 5261 6e67 6520 616e 6420  ercentRange and 
-00010780: 6275 6c6c 6973 6843 6c6f 7365 2061 6e64  bullishClose and
-00010790: 2062 756c 6c69 7368 4d41 5265 7665 7273   bullishMARevers
-000107a0: 616c 2920 6f72 205c 0a20 2020 2020 2020  al) or \.       
-000107b0: 2020 2020 2020 2020 2028 6973 5265 6365           (isRece
-000107c0: 6e74 436c 6f73 6557 6974 6869 6e50 6572  ntCloseWithinPer
-000107d0: 6365 6e74 5261 6e67 6520 616e 6420 6e6f  centRange and no
-000107e0: 7420 6275 6c6c 6973 6843 6c6f 7365 2061  t bullishClose a
-000107f0: 6e64 2062 6561 7269 7368 4d41 5265 7665  nd bearishMAReve
-00010800: 7273 616c 293a 0a20 2020 2020 2020 2020  rsal):.         
-00010810: 2020 2020 2020 2068 6173 5265 7665 7273         hasRevers
-00010820: 616c 7320 3d20 5472 7565 0a20 2020 2020  als = True.     
-00010830: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00010840: 7473 2e61 7070 656e 6428 7374 7228 6d61  ts.append(str(ma
-00010850: 4c65 6e67 7468 2929 0a20 2020 2020 2020  Length)).       
-00010860: 2069 6620 6861 7352 6576 6572 7361 6c73   if hasReversals
-00010870: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-00010880: 7265 656e 4469 6374 5b22 4d41 2d53 6967  reenDict["MA-Sig
-00010890: 6e61 6c22 5d20 3d20 280a 2020 2020 2020  nal"] = (.      
-000108a0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-000108b0: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-000108c0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-000108d0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-000108e0: 2020 2020 202b 2028 636f 6c6f 7254 6578       + (colorTex
-000108f0: 742e 4752 4545 4e20 6966 2062 756c 6c69  t.GREEN if bulli
-00010900: 7368 4d41 5265 7665 7273 616c 2065 6c73  shMAReversal els
-00010910: 6520 2863 6f6c 6f72 5465 7874 2e46 4149  e (colorText.FAI
-00010920: 4c20 6966 2062 6561 7269 7368 4d41 5265  L if bearishMARe
-00010930: 7665 7273 616c 2065 6c73 6520 636f 6c6f  versal else colo
-00010940: 7254 6578 742e 5741 524e 2929 0a20 2020  rText.WARN)).   
-00010950: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-00010960: 2252 6576 6572 7361 6c2d 5b7b 272c 272e  "Reversal-[{','.
-00010970: 6a6f 696e 2872 6573 756c 7473 297d 5d7b  join(results)}]{
-00010980: 2745 4d41 2720 6966 2028 6d61 4c65 6e67  'EMA' if (maLeng
-00010990: 7468 203d 3d20 3920 6f72 2073 656c 662e  th == 9 or self.
-000109a0: 636f 6e66 6967 4d61 6e61 6765 722e 7573  configManager.us
-000109b0: 6545 4d41 2920 656c 7365 2027 4d41 277d  eEMA) else 'MA'}
-000109c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000109d0: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-000109e0: 440a 2020 2020 2020 2020 2020 2020 290a  D.            ).
-000109f0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00010a00: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-00010a10: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-00010a20: 2252 6576 6572 7361 6c2d 5b7b 272c 272e  "Reversal-[{','.
-00010a30: 6a6f 696e 2872 6573 756c 7473 297d 5d7b  join(results)}]{
-00010a40: 2745 4d41 2720 6966 2028 6d61 4c65 6e67  'EMA' if (maLeng
-00010a50: 7468 203d 3d20 3920 6f72 2073 656c 662e  th == 9 or self.
-00010a60: 636f 6e66 6967 4d61 6e61 6765 722e 7573  configManager.us
-00010a70: 6545 4d41 2920 656c 7365 2027 4d41 277d  eEMA) else 'MA'}
-00010a80: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00010a90: 2068 6173 5265 7665 7273 616c 730a 0a20   hasReversals.. 
-00010aa0: 2020 2064 6566 2066 696e 6443 7572 7265     def findCurre
-00010ab0: 6e74 5361 7665 6456 616c 7565 2873 656c  ntSavedValue(sel
-00010ac0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-00010ad0: 6176 6544 6963 742c 206b 6579 293a 0a20  aveDict, key):. 
-00010ae0: 2020 2020 2020 2065 7869 7374 696e 6753         existingS
-00010af0: 6372 6565 6e20 3d20 7363 7265 656e 4469  creen = screenDi
-00010b00: 6374 2e67 6574 286b 6579 290a 2020 2020  ct.get(key).    
-00010b10: 2020 2020 6578 6973 7469 6e67 5361 7665      existingSave
-00010b20: 203d 2073 6176 6544 6963 742e 6765 7428   = saveDict.get(
-00010b30: 6b65 7929 0a20 2020 2020 2020 2065 7869  key).        exi
-00010b40: 7374 696e 6753 6372 6565 6e20 3d20 6622  stingScreen = f"
-00010b50: 7b65 7869 7374 696e 6753 6372 6565 6e7d  {existingScreen}
-00010b60: 2c20 2220 6966 2028 6578 6973 7469 6e67  , " if (existing
-00010b70: 5363 7265 656e 2069 7320 6e6f 7420 4e6f  Screen is not No
-00010b80: 6e65 2061 6e64 206c 656e 2865 7869 7374  ne and len(exist
-00010b90: 696e 6753 6372 6565 6e29 203e 2030 2920  ingScreen) > 0) 
-00010ba0: 656c 7365 2022 220a 2020 2020 2020 2020  else "".        
-00010bb0: 6578 6973 7469 6e67 5361 7665 203d 2066  existingSave = f
-00010bc0: 227b 6578 6973 7469 6e67 5361 7665 7d2c  "{existingSave},
-00010bd0: 2022 2069 6620 2865 7869 7374 696e 6753   " if (existingS
-00010be0: 6176 6520 6973 206e 6f74 204e 6f6e 6520  ave is not None 
-00010bf0: 616e 6420 6c65 6e28 6578 6973 7469 6e67  and len(existing
-00010c00: 5361 7665 2920 3e20 3029 2065 6c73 6520  Save) > 0) else 
-00010c10: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00010c20: 6e20 6578 6973 7469 6e67 5363 7265 656e  n existingScreen
-00010c30: 2c20 6578 6973 7469 6e67 5361 7665 0a0a  , existingSave..
-00010c40: 2020 2020 2320 406d 6561 7375 7265 5f74      # @measure_t
-00010c50: 696d 650a 2020 2020 6465 6620 6669 6e64  ime.    def find
-00010c60: 4262 616e 6473 5371 7565 657a 6528 7365  BbandsSqueeze(se
-00010c70: 6c66 2c66 756c 6c44 6174 612c 2073 6372  lf,fullData, scr
-00010c80: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-00010c90: 742c 2066 696c 7465 723d 3429 3a0a 2020  t, filter=4):.  
-00010ca0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010cb0: 2020 5468 6520 5454 4d20 5371 7565 657a    The TTM Squeez
-00010cc0: 6520 696e 6469 6361 746f 7220 6d65 6173  e indicator meas
-00010cd0: 7572 6573 2074 6865 2072 656c 6174 696f  ures the relatio
-00010ce0: 6e73 6869 7020 6265 7477 6565 6e20 7468  nship between th
-00010cf0: 6520 0a20 2020 2020 2020 2042 6f6c 6c69  e .        Bolli
-00010d00: 6e67 6572 2042 616e 6473 2061 6e64 204b  nger Bands and K
-00010d10: 656c 746e 6572 2773 2043 6861 6e6e 656c  eltner's Channel
-00010d20: 2e20 5768 656e 2074 6865 2076 6f6c 6174  . When the volat
-00010d30: 696c 6974 7920 696e 6372 6561 7365 732c  ility increases,
-00010d40: 200a 2020 2020 2020 2020 736f 2064 6f65   .        so doe
-00010d50: 7320 7468 6520 6469 7374 616e 6365 2062  s the distance b
-00010d60: 6574 7765 656e 2074 6865 2062 616e 6473  etween the bands
-00010d70: 2c20 616e 6420 636f 6e76 6572 7365 6c79  , and conversely
-00010d80: 2c20 7768 656e 2074 6865 200a 2020 2020  , when the .    
-00010d90: 2020 2020 766f 6c61 7469 6c69 7479 2064      volatility d
-00010da0: 6563 6c69 6e65 732c 2074 6865 2064 6973  eclines, the dis
-00010db0: 7461 6e63 6520 616c 736f 2064 6563 7265  tance also decre
-00010dc0: 6173 6573 2e20 5468 6520 5371 7565 657a  ases. The Squeez
-00010dd0: 6520 696e 6469 6361 746f 7220 0a20 2020  e indicator .   
-00010de0: 2020 2020 2066 696e 6473 2073 6563 7469       finds secti
-00010df0: 6f6e 7320 6f66 2074 6865 2042 6f6c 6c69  ons of the Bolli
-00010e00: 6e67 6572 2042 616e 6473 2073 7475 6479  nger Bands study
-00010e10: 2077 6869 6368 2066 616c 6c20 696e 7369   which fall insi
-00010e20: 6465 2074 6865 200a 2020 2020 2020 2020  de the .        
-00010e30: 4b65 6c74 6e65 7227 7320 4368 616e 6e65  Keltner's Channe
-00010e40: 6c73 2e0a 2020 2020 2020 2020 0a20 2020  ls..        .   
-00010e50: 2020 2020 2041 7420 7468 6520 6d6f 6d65       At the mome
-00010e60: 6e74 2074 6869 7320 7371 7565 657a 6520  nt this squeeze 
-00010e70: 6861 7070 656e 732c 2061 2070 7269 6365  happens, a price
-00010e80: 2062 7265 616b 6f75 7420 6672 6f6d 2074   breakout from t
-00010e90: 6865 2075 7070 6572 200a 2020 2020 2020  he upper .      
-00010ea0: 2020 426f 6c6c 696e 6765 7220 4261 6e64    Bollinger Band
-00010eb0: 2077 6f75 6c64 2069 6e64 6963 6174 6520   would indicate 
-00010ec0: 7468 6520 706f 7373 6962 696c 6974 7920  the possibility 
-00010ed0: 6f66 2061 6e20 7570 7472 656e 6420 696e  of an uptrend in
-00010ee0: 2074 6865 200a 2020 2020 2020 2020 6675   the .        fu
-00010ef0: 7475 7265 2e20 5468 6973 2069 7320 6261  ture. This is ba
-00010f00: 636b 6564 2062 7920 7468 6520 6661 6374  cked by the fact
-00010f10: 2074 6861 7420 6f6e 6365 2074 6865 2070   that once the p
-00010f20: 7269 6365 2073 7461 7274 7320 6272 6561  rice starts brea
-00010f30: 6b69 6e67 200a 2020 2020 2020 2020 6f75  king .        ou
-00010f40: 7420 6f66 2074 6865 2062 616e 6473 2c20  t of the bands, 
-00010f50: 6974 2077 6f75 6c64 206d 6561 6e20 6120  it would mean a 
-00010f60: 7265 6c61 7861 7469 6f6e 206f 6620 7468  relaxation of th
-00010f70: 6520 7371 7565 657a 6520 616e 6420 7468  e squeeze and th
-00010f80: 6520 0a20 2020 2020 2020 2070 6f73 7369  e .        possi
-00010f90: 6269 6c69 7479 206f 6620 6869 6768 206d  bility of high m
-00010fa0: 6172 6b65 7420 766f 6c61 7469 6c69 7479  arket volatility
-00010fb0: 2061 6e64 2070 7269 6365 206d 6f76 656d   and price movem
-00010fc0: 656e 7420 696e 2074 6865 2066 7574 7572  ent in the futur
-00010fd0: 652e 200a 2020 2020 2020 2020 5369 6d69  e. .        Simi
-00010fe0: 6c61 726c 792c 2061 2070 7269 6365 2062  larly, a price b
-00010ff0: 7265 616b 6f75 7420 6672 6f6d 2074 6865  reakout from the
-00011000: 206c 6f77 6572 2042 6f6c 6c69 6e67 6572   lower Bollinger
-00011010: 2042 616e 6420 6166 7465 7220 6120 7371   Band after a sq
-00011020: 7565 657a 6520 0a20 2020 2020 2020 2077  ueeze .        w
-00011030: 6f75 6c64 2069 6e64 6963 6174 6520 7468  ould indicate th
-00011040: 6520 706f 7373 6962 696c 6974 7920 6f66  e possibility of
-00011050: 2061 2064 6f77 6e74 7265 6e64 2069 6e20   a downtrend in 
-00011060: 7468 6520 6675 7475 7265 2061 6e64 2061  the future and a
-00011070: 6e20 0a20 2020 2020 2020 2069 6e63 7265  n .        incre
-00011080: 6173 6564 206d 6172 6b65 7420 766f 6c61  ased market vola
-00011090: 7469 6c69 7479 2069 6e20 7468 6520 7361  tility in the sa
-000110a0: 6d65 2064 6972 6563 7469 6f6e 2e20 5768  me direction. Wh
-000110b0: 656e 2074 6865 206d 6172 6b65 7420 0a20  en the market . 
-000110c0: 2020 2020 2020 2066 696e 6973 6865 7320         finishes 
-000110d0: 6120 6d6f 7665 2c20 7468 6520 696e 6469  a move, the indi
-000110e0: 6361 746f 7220 7475 726e 7320 6f66 662c  cator turns off,
-000110f0: 2077 6869 6368 2063 6f72 7265 7370 6f6e   which correspon
-00011100: 6473 2074 6f20 6261 6e64 7320 0a20 2020  ds to bands .   
-00011110: 2020 2020 2068 6176 696e 6720 7075 7368       having push
-00011120: 6564 2077 656c 6c20 6f75 7473 6964 6520  ed well outside 
-00011130: 7468 6520 7261 6e67 6520 6f66 204b 656c  the range of Kel
-00011140: 746e 6572 2773 2043 6861 6e6e 656c 732e  tner's Channels.
-00011150: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011160: 2020 2020 2069 6620 6675 6c6c 4461 7461       if fullData
-00011170: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
-00011180: 6675 6c6c 4461 7461 2920 3c20 3230 3a0a  fullData) < 20:.
-00011190: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000111a0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-000111b0: 206f 6c64 6573 7452 6563 6f72 6473 4669   oldestRecordsFi
-000111c0: 7273 745f 6466 203d 2066 756c 6c44 6174  rst_df = fullDat
-000111d0: 612e 6865 6164 2833 3029 2e63 6f70 7928  a.head(30).copy(
-000111e0: 290a 2020 2020 2020 2020 6c61 7465 7374  ).        latest
-000111f0: 5265 636f 7264 7346 6972 7374 5f64 6620  RecordsFirst_df 
-00011200: 3d20 6f6c 6465 7374 5265 636f 7264 7346  = oldestRecordsF
-00011210: 6972 7374 5f64 665b 3a3a 2d31 5d2e 7461  irst_df[::-1].ta
-00011220: 696c 2833 3029 0a20 2020 2020 2020 206c  il(30).        l
-00011230: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00011240: 745f 6466 203d 206c 6174 6573 7452 6563  t_df = latestRec
-00011250: 6f72 6473 4669 7273 745f 6466 2e66 696c  ordsFirst_df.fil
-00011260: 6c6e 6128 3029 0a20 2020 2020 2020 206c  lna(0).        l
-00011270: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00011280: 745f 6466 203d 206c 6174 6573 7452 6563  t_df = latestRec
-00011290: 6f72 6473 4669 7273 745f 6466 2e72 6570  ordsFirst_df.rep
-000112a0: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
-000112b0: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
-000112c0: 2020 2023 2042 6f6c 6c69 6e67 6572 2062     # Bollinger b
-000112d0: 616e 6473 0a20 2020 2020 2020 206c 6174  ands.        lat
-000112e0: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
-000112f0: 6466 2e6c 6f63 5b3a 2c27 4242 616e 6473  df.loc[:,'BBands
-00011300: 2d55 275d 2c20 6c61 7465 7374 5265 636f  -U'], latestReco
-00011310: 7264 7346 6972 7374 5f64 662e 6c6f 635b  rdsFirst_df.loc[
-00011320: 3a2c 2742 4261 6e64 732d 4d27 5d2c 206c  :,'BBands-M'], l
-00011330: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00011340: 745f 6466 2e6c 6f63 5b3a 2c27 4242 616e  t_df.loc[:,'BBan
-00011350: 6473 2d4c 275d 203d 2070 6b74 616c 6962  ds-L'] = pktalib
-00011360: 2e42 4241 4e44 5328 6c61 7465 7374 5265  .BBANDS(latestRe
-00011370: 636f 7264 7346 6972 7374 5f64 665b 2243  cordsFirst_df["C
-00011380: 6c6f 7365 225d 2c20 3230 290a 2020 2020  lose"], 20).    
-00011390: 2020 2020 2320 636f 6d70 7574 6520 4b65      # compute Ke
-000113a0: 6c74 6e65 7227 7320 6368 616e 6e65 6c0a  ltner's channel.
-000113b0: 2020 2020 2020 2020 6c61 7465 7374 5265          latestRe
-000113c0: 636f 7264 7346 6972 7374 5f64 665b 276c  cordsFirst_df['l
-000113d0: 6f77 5f6b 656c 275d 2c20 6c61 7465 7374  ow_kel'], latest
-000113e0: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
-000113f0: 2775 7070 5f6b 656c 275d 203d 2070 6b74  'upp_kel'] = pkt
-00011400: 616c 6962 2e4b 656c 746e 6572 7343 6861  alib.KeltnersCha
-00011410: 6e6e 656c 286c 6174 6573 7452 6563 6f72  nnel(latestRecor
-00011420: 6473 4669 7273 745f 6466 5b22 4869 6768  dsFirst_df["High
-00011430: 225d 2c20 6c61 7465 7374 5265 636f 7264  "], latestRecord
-00011440: 7346 6972 7374 5f64 665b 224c 6f77 225d  sFirst_df["Low"]
-00011450: 2c6c 6174 6573 7452 6563 6f72 6473 4669  ,latestRecordsFi
-00011460: 7273 745f 6466 5b22 436c 6f73 6522 5d2c  rst_df["Close"],
-00011470: 3230 290a 2020 2020 2020 2020 2320 7371  20).        # sq
-00011480: 7565 657a 6520 696e 6469 6361 746f 720a  ueeze indicator.
-00011490: 2020 2020 2020 2020 6465 6620 696e 5f73          def in_s
-000114a0: 7175 6565 7a65 2864 6629 3a0a 2020 2020  queeze(df):.    
-000114b0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-000114c0: 665b 276c 6f77 5f6b 656c 275d 203c 2064  f['low_kel'] < d
-000114d0: 665b 2742 4261 6e64 732d 4c27 5d20 3c20  f['BBands-L'] < 
-000114e0: 6466 5b27 4242 616e 6473 2d55 275d 203c  df['BBands-U'] <
-000114f0: 2064 665b 2775 7070 5f6b 656c 275d 0a0a   df['upp_kel']..
-00011500: 2020 2020 2020 2020 6c61 7465 7374 5265          latestRe
-00011510: 636f 7264 7346 6972 7374 5f64 665b 2773  cordsFirst_df['s
-00011520: 7175 6565 7a65 275d 203d 206c 6174 6573  queeze'] = lates
-00011530: 7452 6563 6f72 6473 4669 7273 745f 6466  tRecordsFirst_df
-00011540: 2e61 7070 6c79 2869 6e5f 7371 7565 657a  .apply(in_squeez
-00011550: 652c 2061 7869 733d 3129 0a0a 2020 2020  e, axis=1)..    
-00011560: 2020 2020 2320 4c65 7427 7320 7265 7669      # Let's revi
-00011570: 6577 206a 7573 7420 7468 6520 7072 6576  ew just the prev
-00011580: 696f 7573 2033 2063 616e 646c 6573 2069  ious 3 candles i
-00011590: 6e63 6c75 6469 6e67 2074 6f64 6179 2028  ncluding today (
-000115a0: 6174 2074 6865 2065 6e64 290a 2020 2020  at the end).    
-000115b0: 2020 2020 6c61 7465 7374 5265 636f 7264      latestRecord
-000115c0: 7346 6972 7374 5f64 6620 3d20 6c61 7465  sFirst_df = late
-000115d0: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
-000115e0: 662e 7461 696c 2833 290a 2020 2020 2020  f.tail(3).      
-000115f0: 2020 2320 7374 6f63 6b20 6973 2063 6f6d    # stock is com
-00011600: 696e 6720 6f75 7420 6f66 2074 6865 2073  ing out of the s
-00011610: 7175 6565 7a65 0a20 2020 2020 2020 2073  queeze.        s
-00011620: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-00011630: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00011640: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-00011650: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-00011660: 2229 0a20 2020 2020 2020 2063 616e 646c  ").        candl
-00011670: 6533 5371 7a20 3d20 6c61 7465 7374 5265  e3Sqz = latestRe
-00011680: 636f 7264 7346 6972 7374 5f64 662e 696c  cordsFirst_df.il
-00011690: 6f63 5b2d 335d 5b22 7371 7565 657a 6522  oc[-3]["squeeze"
-000116a0: 5d0a 2020 2020 2020 2020 6361 6e64 6c65  ].        candle
-000116b0: 3153 717a 203d 206c 6174 6573 7452 6563  1Sqz = latestRec
-000116c0: 6f72 6473 4669 7273 745f 6466 2e69 6c6f  ordsFirst_df.ilo
-000116d0: 635b 2d31 5d5b 2273 7175 6565 7a65 225d  c[-1]["squeeze"]
-000116e0: 0a20 2020 2020 2020 2063 616e 646c 6532  .        candle2
-000116f0: 5371 7a20 3d20 6c61 7465 7374 5265 636f  Sqz = latestReco
-00011700: 7264 7346 6972 7374 5f64 662e 696c 6f63  rdsFirst_df.iloc
-00011710: 5b2d 325d 5b22 7371 7565 657a 6522 5d0a  [-2]["squeeze"].
-00011720: 2020 2020 2020 2020 6966 2063 616e 646c          if candl
-00011730: 6533 5371 7a20 616e 6420 6e6f 7420 6361  e3Sqz and not ca
-00011740: 6e64 6c65 3153 717a 3a0a 2020 2020 2020  ndle1Sqz:.      
-00011750: 2020 2020 2020 2320 3372 6420 6361 6e64        # 3rd cand
-00011760: 6c65 2066 726f 6d20 7468 6520 6d6f 7374  le from the most
-00011770: 2072 6563 656e 7420 6f6e 6520 7761 7320   recent one was 
-00011780: 696e 2073 7175 6565 7a65 2062 7574 2074  in squeeze but t
-00011790: 6865 206d 6f73 7420 7265 6365 6e74 206f  he most recent o
-000117a0: 6e65 2069 7320 6e6f 742e 0a20 2020 2020  ne is not..     
-000117b0: 2020 2020 2020 2069 6620 6669 6c74 6572         if filter
-000117c0: 206e 6f74 2069 6e20 5b31 2c33 2c34 5d3a   not in [1,3,4]:
-000117d0: 2023 2042 7579 2f53 656c 6c2f 416c 6c0a   # Buy/Sell/All.
-000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117f0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00011800: 2020 2020 2020 2020 2023 2064 6563 6964           # decid
-00011810: 6520 7768 6963 6820 6163 7469 6f6e 2074  e which action t
-00011820: 6f20 7461 6b65 2062 7920 636f 6d70 6172  o take by compar
-00011830: 696e 6720 6469 7374 616e 6365 7320 2020  ing distances   
-00011840: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00011850: 2020 2020 2020 2020 2020 6469 7374 616e            distan
-00011860: 6365 5f74 6f5f 7570 7065 7220 3d20 6162  ce_to_upper = ab
-00011870: 7328 6c61 7465 7374 5265 636f 7264 7346  s(latestRecordsF
-00011880: 6972 7374 5f64 665b 2742 4261 6e64 732d  irst_df['BBands-
-00011890: 5527 5d2e 7661 6c75 6573 5b2d 315d 202d  U'].values[-1] -
-000118a0: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
-000118b0: 7273 745f 6466 5b27 436c 6f73 6527 5d2e  rst_df['Close'].
-000118c0: 7661 6c75 6573 5b2d 315d 290a 2020 2020  values[-1]).    
-000118d0: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-000118e0: 5f74 6f5f 6c6f 7765 7220 3d20 6162 7328  _to_lower = abs(
-000118f0: 6c61 7465 7374 5265 636f 7264 7346 6972  latestRecordsFir
-00011900: 7374 5f64 665b 2742 4261 6e64 732d 4c27  st_df['BBands-L'
-00011910: 5d2e 7661 6c75 6573 5b2d 315d 202d 206c  ].values[-1] - l
-00011920: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
-00011930: 745f 6466 5b27 436c 6f73 6527 5d2e 7661  t_df['Close'].va
-00011940: 6c75 6573 5b2d 315d 290a 2020 2020 2020  lues[-1]).      
-00011950: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-00011960: 2020 2061 6374 696f 6e20 3d20 4661 6c73     action = Fals
-00011970: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00011980: 2064 6973 7461 6e63 655f 746f 5f75 7070   distance_to_upp
-00011990: 6572 203c 2064 6973 7461 6e63 655f 746f  er < distance_to
-000119a0: 5f6c 6f77 6572 3a0a 2020 2020 2020 2020  _lower:.        
-000119b0: 2020 2020 2020 2020 6966 2066 696c 7465          if filte
-000119c0: 7220 6e6f 7420 696e 205b 312c 345d 3a20  r not in [1,4]: 
-000119d0: 2320 4275 792f 416c 6c0a 2020 2020 2020  # Buy/All.      
-000119e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000119f0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00011a00: 2020 2020 2020 2020 2020 2061 6374 696f             actio
-00011a10: 6e20 3d20 5472 7565 0a20 2020 2020 2020  n = True.       
-00011a20: 2020 2020 2065 6c69 6620 6669 6c74 6572       elif filter
-00011a30: 206e 6f74 2069 6e20 5b33 2c34 5d3a 2023   not in [3,4]: #
-00011a40: 2053 656c 6c2f 416c 6c0a 2020 2020 2020   Sell/All.      
-00011a50: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011a60: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-00011a70: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
-00011a80: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-00011a90: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00011aa0: 424f 4c44 202b 2028 636f 6c6f 7254 6578  BOLD + (colorTex
-00011ab0: 742e 4752 4545 4e20 6966 2061 6374 696f  t.GREEN if actio
-00011ac0: 6e20 656c 7365 2063 6f6c 6f72 5465 7874  n else colorText
-00011ad0: 2e46 4149 4c29 202b 2066 2242 4261 6e64  .FAIL) + f"BBand
-00011ae0: 732d 5351 5a2d 7b27 4275 7927 2069 6620  s-SQZ-{'Buy' if 
-00011af0: 6163 7469 6f6e 2065 6c73 6520 2753 656c  action else 'Sel
-00011b00: 6c27 7d22 202b 2063 6f6c 6f72 5465 7874  l'}" + colorText
-00011b10: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-00011b20: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
-00011b30: 726e 225d 203d 2073 6176 6564 5b31 5d20  rn"] = saved[1] 
-00011b40: 2b20 6622 5454 4d2d 5351 5a2d 7b27 4275  + f"TTM-SQZ-{'Bu
-00011b50: 7927 2069 6620 6163 7469 6f6e 2065 6c73  y' if action els
-00011b60: 6520 2753 656c 6c27 7d22 0a20 2020 2020  e 'Sell'}".     
-00011b70: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00011b80: 7565 0a20 2020 2020 2020 2065 6c69 6620  ue.        elif 
-00011b90: 6361 6e64 6c65 3353 717a 2061 6e64 2063  candle3Sqz and c
-00011ba0: 616e 646c 6532 5371 7a20 616e 6420 6361  andle2Sqz and ca
-00011bb0: 6e64 6c65 3153 717a 3a0a 2020 2020 2020  ndle1Sqz:.      
-00011bc0: 2020 2020 2020 2320 4c61 7374 2033 2063        # Last 3 c
-00011bd0: 616e 646c 6573 2069 6e20 7371 7565 657a  andles in squeez
-00011be0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00011bf0: 2066 696c 7465 7220 6e6f 7420 696e 205b   filter not in [
-00011c00: 322c 345d 3a20 2320 5371 5a2f 416c 6c0a  2,4]: # SqZ/All.
-00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c20: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00011c30: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00011c40: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00011c50: 2066 277b 7361 7665 645b 305d 7d7b 636f   f'{saved[0]}{co
-00011c60: 6c6f 7254 6578 742e 424f 4c44 7d7b 636f  lorText.BOLD}{co
-00011c70: 6c6f 7254 6578 742e 5741 524e 7d54 544d  lorText.WARN}TTM
-00011c80: 2d53 515a 7b63 6f6c 6f72 5465 7874 2e45  -SQZ{colorText.E
-00011c90: 4e44 7d27 0a20 2020 2020 2020 2020 2020  ND}'.           
-00011ca0: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
-00011cb0: 726e 225d 203d 2066 277b 7361 7665 645b  rn"] = f'{saved[
-00011cc0: 315d 7d54 544d 2d53 515a 270a 2020 2020  1]}TTM-SQZ'.    
-00011cd0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00011ce0: 7275 650a 2020 2020 2020 2020 7265 7475  rue.        retu
-00011cf0: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
-00011d00: 6620 6669 6e64 496e 7472 6164 6179 4869  f findIntradayHi
-00011d10: 6768 4372 6f73 736f 7665 7228 7365 6c66  ghCrossover(self
-00011d20: 2c20 6466 2c20 6166 7465 7254 696d 6573  , df, afterTimes
-00011d30: 7461 6d70 3d4e 6f6e 6529 3a0a 2020 2020  tamp=None):.    
-00011d40: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
-00011d50: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
-00011d60: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
-00011d70: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00011d80: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
-00011d90: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
-00011da0: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
-00011db0: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-00011dc0: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
-00011dd0: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
-00011de0: 2c20 3029 0a20 2020 2020 2020 2064 6174  , 0).        dat
-00011df0: 6120 3d20 6461 7461 5b3a 3a2d 315d 2020  a = data[::-1]  
-00011e00: 2320 5265 7665 7273 6520 7468 6520 6461  # Reverse the da
-00011e10: 7461 6672 616d 6520 736f 2074 6861 7420  taframe so that 
-00011e20: 6974 7320 7468 6520 6f6c 6465 7374 2064  its the oldest d
-00011e30: 6174 6520 6669 7273 740a 2020 2020 2020  ate first.      
-00011e40: 2020 6469 6666 5f64 6620 3d20 4e6f 6e65    diff_df = None
-00011e50: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00011e60: 2020 2020 2020 2020 2020 2320 4c65 7427            # Let'
-00011e70: 7320 6f6e 6c79 2063 6f6e 7369 6465 7220  s only consider 
-00011e80: 7468 6f73 6520 6361 6e64 6c65 7320 7468  those candles th
-00011e90: 6174 2061 7265 2061 6674 6572 2074 6865  at are after the
-00011ea0: 2061 6c65 7274 2069 7373 7565 2d74 696d   alert issue-tim
-00011eb0: 6520 696e 2074 6865 206d 6f72 6e69 6e67  e in the morning
-00011ec0: 7320 2b20 3220 6361 6e64 6c65 7320 2866  s + 2 candles (f
-00011ed0: 6f72 2062 7579 2f73 656c 6c29 0a20 2020  or buy/sell).   
-00011ee0: 2020 2020 2020 2020 2064 6966 665f 6466           diff_df
-00011ef0: 203d 2064 6174 615b 6461 7461 2e69 6e64   = data[data.ind
-00011f00: 6578 203e 3d20 2070 642e 746f 5f64 6174  ex >=  pd.to_dat
-00011f10: 6574 696d 6528 6627 7b50 4b44 6174 6555  etime(f'{PKDateU
-00011f20: 7469 6c69 7469 6573 2e74 7261 6469 6e67  tilities.trading
-00011f30: 4461 7465 2829 2e73 7472 6674 696d 6528  Date().strftime(
-00011f40: 6622 2559 2d25 6d2d 2564 2229 7d20 3039  f"%Y-%m-%d")} 09
-00011f50: 3a7b 3135 2b73 656c 662e 636f 6e66 6967  :{15+self.config
-00011f60: 4d61 6e61 6765 722e 6d6f 726e 696e 6761  Manager.morninga
-00011f70: 6e61 6c79 7369 7363 616e 646c 656e 756d  nalysiscandlenum
-00011f80: 6265 7220 2b20 327d 3a30 302b 3035 3a33  ber + 2}:00+05:3
-00011f90: 3027 292e 746f 5f64 6174 6574 696d 6536  0').to_datetime6
-00011fa0: 3428 295d 0a20 2020 2020 2020 2020 2020  4()].           
-00011fb0: 2023 2062 726f 6b65 7253 7172 4f66 6674   # brokerSqrOfft
-00011fc0: 696d 6520 3d20 7064 2e74 6f5f 6461 7465  ime = pd.to_date
-00011fd0: 7469 6d65 2866 277b 504b 4461 7465 5574  time(f'{PKDateUt
-00011fe0: 696c 6974 6965 732e 7472 6164 696e 6744  ilities.tradingD
-00011ff0: 6174 6528 292e 7374 7266 7469 6d65 2866  ate().strftime(f
-00012000: 2225 592d 256d 2d25 6422 297d 2031 353a  "%Y-%m-%d")} 15:
-00012010: 3134 3a30 302b 3035 3a33 3027 292e 746f  14:00+05:30').to
-00012020: 5f64 6174 6574 696d 6536 3428 290a 2020  _datetime64().  
-00012030: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00012040: 2020 2020 2020 2020 2020 6469 6666 5f64            diff_d
-00012050: 6620 3d20 6461 7461 5b64 6174 612e 696e  f = data[data.in
-00012060: 6465 7820 3e3d 2020 7064 2e74 6f5f 6461  dex >=  pd.to_da
-00012070: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
-00012080: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
-00012090: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
-000120a0: 2866 2225 592d 256d 2d25 6422 297d 2030  (f"%Y-%m-%d")} 0
-000120b0: 393a 7b31 352b 7365 6c66 2e63 6f6e 6669  9:{15+self.confi
-000120c0: 674d 616e 6167 6572 2e6d 6f72 6e69 6e67  gManager.morning
-000120d0: 616e 616c 7973 6973 6361 6e64 6c65 6e75  analysiscandlenu
-000120e0: 6d62 6572 202b 2032 7d3a 3030 2b30 353a  mber + 2}:00+05:
-000120f0: 3330 272c 2075 7463 3d54 7275 6529 5d0a  30', utc=True)].
-00012100: 2020 2020 2020 2020 2020 2020 2320 6272              # br
-00012110: 6f6b 6572 5371 724f 6666 7469 6d65 203d  okerSqrOfftime =
-00012120: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00012130: 6627 7b50 4b44 6174 6555 7469 6c69 7469  f'{PKDateUtiliti
-00012140: 6573 2e74 7261 6469 6e67 4461 7465 2829  es.tradingDate()
-00012150: 2e73 7472 6674 696d 6528 6622 2559 2d25  .strftime(f"%Y-%
-00012160: 6d2d 2564 2229 7d20 3135 3a31 343a 3030  m-%d")} 15:14:00
-00012170: 2b30 353a 3330 272c 2075 7463 3d54 7275  +05:30', utc=Tru
-00012180: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-00012190: 6173 730a 2020 2020 2020 2020 6461 7948  ass.        dayH
-000121a0: 6967 6841 6674 6572 416c 6572 7420 3d20  ighAfterAlert = 
-000121b0: 6469 6666 5f64 665b 2248 6967 6822 5d2e  diff_df["High"].
-000121c0: 6d61 7828 290a 2020 2020 2020 2020 6869  max().        hi
-000121d0: 6768 526f 7720 3d20 6469 6666 5f64 665b  ghRow = diff_df[
-000121e0: 6469 6666 5f64 665b 2248 6967 6822 5d20  diff_df["High"] 
-000121f0: 3e3d 2064 6179 4869 6768 4166 7465 7241  >= dayHighAfterA
-00012200: 6c65 7274 5d0a 2020 2020 2020 2020 6966  lert].        if
-00012210: 2068 6967 6852 6f77 2069 7320 6e6f 7420   highRow is not 
-00012220: 4e6f 6e65 2061 6e64 206c 656e 2868 6967  None and len(hig
-00012230: 6852 6f77 2920 3e20 303a 0a20 2020 2020  hRow) > 0:.     
-00012240: 2020 2020 2020 2068 6967 6852 6f77 203d         highRow =
-00012250: 2068 6967 6852 6f77 2e74 6169 6c28 3129   highRow.tail(1)
-00012260: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012270: 6869 6768 526f 772e 696e 6465 785b 2d31  highRow.index[-1
-00012280: 5d2c 2068 6967 6852 6f77 0a0a 0a20 2020  ], highRow...   
-00012290: 2064 6566 2066 696e 644d 4143 4443 726f   def findMACDCro
-000122a0: 7373 6f76 6572 2873 656c 662c 2064 662c  ssover(self, df,
-000122b0: 2061 6674 6572 5469 6d65 7374 616d 703d   afterTimestamp=
-000122c0: 4e6f 6e65 2c20 6e74 6843 726f 7373 6f76  None, nthCrossov
-000122d0: 6572 3d31 2c20 7570 4469 7265 6374 696f  er=1, upDirectio
-000122e0: 6e3d 5472 7565 2c20 6d69 6e52 5349 3d36  n=True, minRSI=6
-000122f0: 3029 3a0a 2020 2020 2020 2020 6966 2064  0):.        if d
-00012300: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00012310: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-00012320: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00012330: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-00012340: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-00012350: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00012360: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-00012370: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-00012380: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-00012390: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-000123a0: 2020 2020 2064 6174 612e 6472 6f70 6e61       data.dropna
-000123b0: 2861 7869 733d 302c 2068 6f77 3d22 616c  (axis=0, how="al
-000123c0: 6c22 2c20 696e 706c 6163 653d 5472 7565  l", inplace=True
-000123d0: 2920 2320 4d61 7962 6520 7468 6572 6520  ) # Maybe there 
-000123e0: 7761 7320 6e6f 2074 7261 6465 2064 6f6e  was no trade don
-000123f0: 6520 6174 2074 6865 7365 2074 696d 6573  e at these times
-00012400: 3f0a 2020 2020 2020 2020 6461 7461 203d  ?.        data =
-00012410: 2064 6174 615b 3a3a 2d31 5d20 2023 2052   data[::-1]  # R
-00012420: 6576 6572 7365 2074 6865 2064 6174 6166  everse the dataf
-00012430: 7261 6d65 2073 6f20 7468 6174 2069 7473  rame so that its
-00012440: 2074 6865 206f 6c64 6573 7420 6461 7465   the oldest date
-00012450: 2066 6972 7374 0a20 2020 2020 2020 206d   first.        m
-00012460: 6163 644c 696e 652c 206d 6163 6453 6967  acdLine, macdSig
-00012470: 6e61 6c2c 206d 6163 6448 6973 7420 3d20  nal, macdHist = 
-00012480: 706b 7461 6c69 622e 4d41 4344 2864 6174  pktalib.MACD(dat
-00012490: 615b 2243 6c6f 7365 225d 2c20 3132 2c20  a["Close"], 12, 
-000124a0: 3236 2c20 3929 0a20 2020 2020 2020 2023  26, 9).        #
-000124b0: 2072 7369 5f64 6620 3d20 706b 7461 6c69   rsi_df = pktali
-000124c0: 622e 5253 4928 6461 7461 5b22 436c 6f73  b.RSI(data["Clos
-000124d0: 6522 5d2c 2031 3429 0a20 2020 2020 2020  e"], 14).       
-000124e0: 206c 696e 655f 6466 203d 2070 642e 4461   line_df = pd.Da
-000124f0: 7461 4672 616d 6528 6d61 6364 4c69 6e65  taFrame(macdLine
-00012500: 290a 2020 2020 2020 2020 7369 676e 616c  ).        signal
-00012510: 5f64 6620 3d20 7064 2e44 6174 6146 7261  _df = pd.DataFra
-00012520: 6d65 286d 6163 6453 6967 6e61 6c29 0a20  me(macdSignal). 
-00012530: 2020 2020 2020 2076 6f6c 5f64 6620 3d20         vol_df = 
-00012540: 6461 7461 5b22 566f 6c75 6d65 225d 0a20  data["Volume"]. 
-00012550: 2020 2020 2020 2064 6966 665f 6466 203d         diff_df =
-00012560: 2070 642e 636f 6e63 6174 285b 6c69 6e65   pd.concat([line
-00012570: 5f64 662c 2073 6967 6e61 6c5f 6466 2c20  _df, signal_df, 
-00012580: 7369 676e 616c 5f64 662d 6c69 6e65 5f64  signal_df-line_d
-00012590: 662c 766f 6c5f 6466 5d2c 2061 7869 733d  f,vol_df], axis=
-000125a0: 3129 0a20 2020 2020 2020 2064 6966 665f  1).        diff_
-000125b0: 6466 2e63 6f6c 756d 6e73 203d 205b 226c  df.columns = ["l
-000125c0: 696e 6522 2c22 7369 676e 616c 222c 2264  ine","signal","d
-000125d0: 6966 6622 2c22 766f 6c22 5d0a 2020 2020  iff","vol"].    
-000125e0: 2020 2020 6469 6666 5f64 6620 3d20 6469      diff_df = di
-000125f0: 6666 5f64 665b 6469 6666 5f64 665b 2276  ff_df[diff_df["v
-00012600: 6f6c 225d 203e 2030 5d20 2320 5765 2772  ol"] > 0] # We'r
-00012610: 6520 6e6f 7420 676f 696e 6720 746f 2064  e not going to d
-00012620: 6f20 616e 7974 6869 6e67 2077 6974 6820  o anything with 
-00012630: 6120 6361 6e64 6c65 2077 6865 7265 2074  a candle where t
-00012640: 6865 7265 2077 6173 206e 6f20 7472 6164  here was no trad
-00012650: 652e 0a20 2020 2020 2020 2023 2062 726f  e..        # bro
-00012660: 6b65 7253 7172 4f66 6674 696d 6520 3d20  kerSqrOfftime = 
-00012670: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
-00012680: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00012690: 4c65 7427 7320 6f6e 6c79 2063 6f6e 7369  Let's only consi
-000126a0: 6465 7220 7468 6f73 6520 6361 6e64 6c65  der those candle
-000126b0: 7320 7468 6174 2061 7265 2061 6674 6572  s that are after
-000126c0: 2074 6865 2061 6c65 7274 2069 7373 7565   the alert issue
-000126d0: 2d74 696d 6520 696e 2074 6865 206d 6f72  -time in the mor
-000126e0: 6e69 6e67 7320 2b20 3220 6361 6e64 6c65  nings + 2 candle
-000126f0: 7320 2866 6f72 2062 7579 2f73 656c 6c29  s (for buy/sell)
-00012700: 0a20 2020 2020 2020 2020 2020 2064 6966  .            dif
-00012710: 665f 6466 203d 2064 6966 665f 6466 5b64  f_df = diff_df[d
-00012720: 6966 665f 6466 2e69 6e64 6578 203e 3d20  iff_df.index >= 
-00012730: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00012740: 6627 7b50 4b44 6174 6555 7469 6c69 7469  f'{PKDateUtiliti
-00012750: 6573 2e74 7261 6469 6e67 4461 7465 2829  es.tradingDate()
-00012760: 2e73 7472 6674 696d 6528 6622 2559 2d25  .strftime(f"%Y-%
-00012770: 6d2d 2564 2229 7d20 3039 3a7b 3135 2b73  m-%d")} 09:{15+s
-00012780: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
-00012790: 722e 6d6f 726e 696e 6761 6e61 6c79 7369  r.morninganalysi
-000127a0: 7363 616e 646c 656e 756d 6265 7220 2b20  scandlenumber + 
-000127b0: 327d 3a30 302b 3035 3a33 3027 292e 746f  2}:00+05:30').to
-000127c0: 5f64 6174 6574 696d 6536 3428 295d 0a20  _datetime64()]. 
-000127d0: 2020 2020 2020 2020 2020 2023 2062 726f             # bro
-000127e0: 6b65 7253 7172 4f66 6674 696d 6520 3d20  kerSqrOfftime = 
-000127f0: 7064 2e74 6f5f 6461 7465 7469 6d65 2866  pd.to_datetime(f
-00012800: 277b 504b 4461 7465 5574 696c 6974 6965  '{PKDateUtilitie
-00012810: 732e 7472 6164 696e 6744 6174 6528 292e  s.tradingDate().
-00012820: 7374 7266 7469 6d65 2866 2225 592d 256d  strftime(f"%Y-%m
-00012830: 2d25 6422 297d 2031 353a 3134 3a30 302b  -%d")} 15:14:00+
-00012840: 3035 3a33 3027 292e 746f 5f64 6174 6574  05:30').to_datet
-00012850: 696d 6536 3428 290a 2020 2020 2020 2020  ime64().        
-00012860: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00012870: 2020 2020 6469 6666 5f64 6620 3d20 6469      diff_df = di
-00012880: 6666 5f64 665b 6469 6666 5f64 662e 696e  ff_df[diff_df.in
-00012890: 6465 7820 3e3d 2020 7064 2e74 6f5f 6461  dex >=  pd.to_da
-000128a0: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
-000128b0: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
-000128c0: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
-000128d0: 2866 2225 592d 256d 2d25 6422 297d 2030  (f"%Y-%m-%d")} 0
-000128e0: 393a 7b31 352b 7365 6c66 2e63 6f6e 6669  9:{15+self.confi
-000128f0: 674d 616e 6167 6572 2e6d 6f72 6e69 6e67  gManager.morning
-00012900: 616e 616c 7973 6973 6361 6e64 6c65 6e75  analysiscandlenu
-00012910: 6d62 6572 202b 2032 7d3a 3030 2b30 353a  mber + 2}:00+05:
-00012920: 3330 272c 2075 7463 3d54 7275 6529 5d0a  30', utc=True)].
-00012930: 2020 2020 2020 2020 2020 2020 2320 6272              # br
-00012940: 6f6b 6572 5371 724f 6666 7469 6d65 203d  okerSqrOfftime =
-00012950: 2070 642e 746f 5f64 6174 6574 696d 6528   pd.to_datetime(
-00012960: 6627 7b50 4b44 6174 6555 7469 6c69 7469  f'{PKDateUtiliti
-00012970: 6573 2e74 7261 6469 6e67 4461 7465 2829  es.tradingDate()
-00012980: 2e73 7472 6674 696d 6528 6622 2559 2d25  .strftime(f"%Y-%
-00012990: 6d2d 2564 2229 7d20 3135 3a31 343a 3030  m-%d")} 15:14:00
-000129a0: 2b30 353a 3330 272c 2075 7463 3d54 7275  +05:30', utc=Tru
-000129b0: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-000129c0: 6173 730a 2020 2020 2020 2020 696e 6465  ass.        inde
-000129d0: 7820 3d20 6c65 6e28 6469 6666 5f64 6629  x = len(diff_df)
-000129e0: 0a20 2020 2020 2020 2063 726f 7373 4f76  .        crossOv
-000129f0: 6572 203d 2030 0a20 2020 2020 2020 200a  er = 0.        .
-00012a00: 2020 2020 2020 2020 2320 4c6f 6f70 2075          # Loop u
-00012a10: 6e74 696c 2077 6527 7665 2066 6f75 6e64  ntil we've found
-00012a20: 2074 6865 206e 7468 2063 726f 7373 6f76   the nth crossov
-00012a30: 6572 2066 6f72 204d 4143 4420 6f72 2077  er for MACD or w
-00012a40: 6527 7665 2072 6561 6368 6564 2074 6865  e've reached the
-00012a50: 206c 6173 7420 706f 696e 7420 696e 2074   last point in t
-00012a60: 696d 650a 2020 2020 2020 2020 7768 696c  ime.        whil
-00012a70: 6520 2863 726f 7373 4f76 6572 203c 206e  e (crossOver < n
-00012a80: 7468 4372 6f73 736f 7665 7220 616e 6420  thCrossover and 
-00012a90: 696e 6465 7820 3e3d 3029 3a0a 2020 2020  index >=0):.    
-00012aa0: 2020 2020 2020 2020 6966 2064 6966 665f          if diff_
-00012ab0: 6466 5b22 6469 6666 225d 5b69 6e64 6578  df["diff"][index
-00012ac0: 2d31 5d20 3c20 303a 2023 2053 6967 6e61  -1] < 0: # Signa
-00012ad0: 6c20 6c69 6e65 2068 6173 206e 6f74 2063  l line has not c
-00012ae0: 726f 7373 6564 2079 6574 2061 6e64 2069  rossed yet and i
-00012af0: 7320 6265 6c6f 7720 7468 6520 7a65 726f  s below the zero
-00012b00: 206c 696e 650a 2020 2020 2020 2020 2020   line.          
-00012b10: 2020 2020 2020 7768 696c 6528 2864 6966        while((dif
-00012b20: 665f 6466 5b22 6469 6666 225d 5b69 6e64  f_df["diff"][ind
-00012b30: 6578 2d31 5d20 3c20 3020 616e 6420 696e  ex-1] < 0 and in
-00012b40: 6465 7820 3e3d 3029 293a 2023 2061 6e64  dex >=0)): # and
-00012b50: 2064 6966 665f 6466 2e69 6e64 6578 203c   diff_df.index <
-00012b60: 3d20 6272 6f6b 6572 5371 724f 6666 7469  = brokerSqrOffti
-00012b70: 6d65 293a 2023 206f 7220 6469 6666 5f64  me): # or diff_d
-00012b80: 665b 2272 7369 225d 5b69 6e64 6578 2d31  f["rsi"][index-1
-00012b90: 5d20 3c3d 206d 696e 5253 4929 3a0a 2020  ] <= minRSI):.  
-00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bb0: 2020 2320 4c6f 6f70 2077 6869 6c65 2053    # Loop while S
-00012bc0: 6967 6e61 6c20 6c69 6e65 2068 6173 206e  ignal line has n
-00012bd0: 6f74 2063 726f 7373 6564 2079 6574 2061  ot crossed yet a
-00012be0: 6e64 2069 7320 6265 6c6f 7720 7468 6520  nd is below the 
-00012bf0: 7a65 726f 206c 696e 6520 616e 6420 7765  zero line and we
-00012c00: 2776 6520 6e6f 7420 7265 6163 6865 6420  've not reached 
-00012c10: 7468 6520 6c61 7374 2070 6f69 6e74 0a20  the last point. 
+0000d6a0: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
+0000d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6c0: 2020 2020 2020 202b 2022 2052 3a20 3022         + " R: 0"
+0000d6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d6e0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000d6f0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0000d700: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d720: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
+0000d730: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
+0000d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d750: 2020 2023 2020 2020 2066 2753 746f 636b     #     f'Stock
+0000d760: 3a7b 7361 7665 4469 6374 5b22 5374 6f63  :{saveDict["Stoc
+0000d770: 6b22 5d7d 2c20 6861 7320 6120 6272 6561  k"]}, has a brea
+0000d780: 6b6f 7574 2062 6563 6175 7365 2072 6563  kout because rec
+0000d790: 656e 742d 636c 6f73 6520 287b 7265 6365  ent-close ({rece
+0000d7a0: 6e74 436c 6f73 657d 2920 3e3d 206d 6178  ntClose}) >= max
+0000d7b0: 2d68 6967 6820 287b 6d61 7848 6967 687d  -high ({maxHigh}
+0000d7c0: 2927 0a20 2020 2020 2020 2020 2020 2020  )'.             
+0000d7d0: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+0000d7e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d7f0: 6574 7572 6e20 5472 7565 2061 6e64 2061  eturn True and a
+0000d800: 6c72 6561 6479 4272 6f6b 656e 6f75 7420  lreadyBrokenout 
+0000d810: 616e 6420 7365 6c66 2e67 6574 4361 6e64  and self.getCand
+0000d820: 6c65 5479 7065 2872 6563 656e 7429 0a20  leType(recent). 
+0000d830: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000d840: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+0000d850: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
+0000d860: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0000d870: 2066 2753 746f 636b 3a7b 7361 7665 4469   f'Stock:{saveDi
+0000d880: 6374 5b22 5374 6f63 6b22 5d7d 2c20 646f  ct["Stock"]}, do
+0000d890: 6573 206e 6f74 2068 6176 6520 6120 6272  es not have a br
+0000d8a0: 6561 6b6f 7574 2079 6574 2062 6563 6175  eakout yet becau
+0000d8b0: 7365 2072 6563 656e 742d 636c 6f73 6520  se recent-close 
+0000d8c0: 287b 7265 6365 6e74 436c 6f73 657d 2920  ({recentClose}) 
+0000d8d0: 3c20 6d61 782d 6869 6768 2028 7b6d 6178  < max-high ({max
+0000d8e0: 4869 6768 7d29 270a 2020 2020 2020 2020  High})'.        
+0000d8f0: 2020 2020 2020 2020 2320 290a 2020 2020          # ).    
+0000d900: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+0000d910: 656e 4469 6374 5b22 4272 6561 6b6f 7574  enDict["Breakout
+0000d920: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0000d930: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0000d940: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+0000d950: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000d960: 636f 6c6f 7254 6578 742e 4641 494c 0a20  colorText.FAIL. 
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d980: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
+0000d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9a0: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
+0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9c0: 2020 202b 2022 2052 3a20 3022 0a20 2020     + " R: 0".   
+0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9e0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000d9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da00: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000da10: 2020 2072 6574 7572 6e20 6e6f 7420 616c     return not al
+0000da20: 7265 6164 7942 726f 6b65 6e6f 7574 0a20  readyBrokenout. 
+0000da30: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0000da40: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
+0000da50: 3d20 2242 4f3a 2022 202b 2073 7472 286d  = "BO: " + str(m
+0000da60: 6178 436c 6f73 6529 202b 2022 2052 3a20  axClose) + " R: 
+0000da70: 2220 2b20 7374 7228 6d61 7848 6967 6829  " + str(maxHigh)
+0000da80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000da90: 7265 6365 6e74 436c 6f73 6520 3e3d 206d  recentClose >= m
+0000daa0: 6178 436c 6f73 653a 0a20 2020 2020 2020  axClose:.       
+0000dab0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+0000dac0: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
+0000dad0: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
+0000dae0: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
+0000daf0: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
+0000db00: 6f63 6b22 5d7d 2c20 6861 7320 6120 6272  ock"]}, has a br
+0000db10: 6561 6b6f 7574 2062 6563 6175 7365 2072  eakout because r
+0000db20: 6563 656e 742d 636c 6f73 6520 287b 7265  ecent-close ({re
+0000db30: 6365 6e74 436c 6f73 657d 2920 3e3d 206d  centClose}) >= m
+0000db40: 6178 2d63 6c6f 7365 2028 7b6d 6178 436c  ax-close ({maxCl
+0000db50: 6f73 657d 2927 0a20 2020 2020 2020 2020  ose})'.         
+0000db60: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+0000db70: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000db80: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
+0000db90: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0000dba0: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
+0000dbb0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
+0000dbc0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0000dbd0: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbf0: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
+0000dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc10: 2b20 7374 7228 6d61 7843 6c6f 7365 290a  + str(maxClose).
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000dc40: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0000dc50: 2020 2020 2020 2020 2b20 2863 6f6c 6f72          + (color
+0000dc60: 5465 7874 2e47 5245 454e 2069 6620 7265  Text.GREEN if re
+0000dc70: 6365 6e74 436c 6f73 6520 3e3d 206d 6178  centClose >= max
+0000dc80: 4869 6768 2065 6c73 6520 636f 6c6f 7254  High else colorT
+0000dc90: 6578 742e 4641 494c 290a 2020 2020 2020  ext.FAIL).      
+0000dca0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000dcb0: 2220 523a 2022 0a20 2020 2020 2020 2020  " R: ".         
+0000dcc0: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+0000dcd0: 286d 6178 4869 6768 290a 2020 2020 2020  (maxHigh).      
+0000dce0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000dcf0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0000dd00: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd20: 7265 7475 726e 2054 7275 6520 616e 6420  return True and 
+0000dd30: 616c 7265 6164 7942 726f 6b65 6e6f 7574  alreadyBrokenout
+0000dd40: 2061 6e64 2073 656c 662e 6765 7443 616e   and self.getCan
+0000dd50: 646c 6554 7970 6528 7265 6365 6e74 290a  dleType(recent).
+0000dd60: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+0000dd70: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+0000dd80: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
+0000dd90: 2020 2020 2320 2020 2020 6627 5374 6f63      #     f'Stoc
+0000dda0: 6b3a 7b73 6176 6544 6963 745b 2253 746f  k:{saveDict["Sto
+0000ddb0: 636b 225d 7d2c 2064 6f65 7320 6e6f 7420  ck"]}, does not 
+0000ddc0: 6861 7665 2061 2062 7265 616b 6f75 7420  have a breakout 
+0000ddd0: 7965 7420 6265 6361 7573 6520 7265 6365  yet because rece
+0000dde0: 6e74 2d63 6c6f 7365 2028 7b72 6563 656e  nt-close ({recen
+0000ddf0: 7443 6c6f 7365 7d29 203c 206d 6178 2d68  tClose}) < max-h
+0000de00: 6967 6820 287b 6d61 7848 6967 687d 2927  igh ({maxHigh})'
+0000de10: 0a20 2020 2020 2020 2020 2020 2023 2029  .            # )
+0000de20: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+0000de30: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
+0000de40: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
+0000de50: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+0000de60: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+0000de70: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+0000de80: 7874 2e46 4149 4c0a 2020 2020 2020 2020  xt.FAIL.        
+0000de90: 2020 2020 2020 2020 2b20 2242 4f3a 2022          + "BO: "
+0000dea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000deb0: 202b 2073 7472 286d 6178 436c 6f73 6529   + str(maxClose)
+0000dec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ded0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000dee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000def0: 202b 2028 636f 6c6f 7254 6578 742e 4752   + (colorText.GR
+0000df00: 4545 4e20 6966 2072 6563 656e 7443 6c6f  EEN if recentClo
+0000df10: 7365 203e 3d20 6d61 7848 6967 6820 656c  se >= maxHigh el
+0000df20: 7365 2063 6f6c 6f72 5465 7874 2e46 4149  se colorText.FAI
+0000df30: 4c29 0a20 2020 2020 2020 2020 2020 2020  L).             
+0000df40: 2020 202b 2022 2052 3a20 220a 2020 2020     + " R: ".    
+0000df50: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
+0000df60: 7228 6d61 7848 6967 6829 0a20 2020 2020  r(maxHigh).     
+0000df70: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0000df80: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0000df90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000dfa0: 2020 2020 2072 6574 7572 6e20 6e6f 7420       return not 
+0000dfb0: 616c 7265 6164 7942 726f 6b65 6e6f 7574  alreadyBrokenout
+0000dfc0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000dfd0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0000dfe0: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
+0000dff0: 3d20 2242 4f3a 2022 202b 2073 7472 286d  = "BO: " + str(m
+0000e000: 6178 436c 6f73 6529 202b 2022 2052 3a20  axClose) + " R: 
+0000e010: 3022 0a20 2020 2020 2020 2020 2020 2069  0".            i
+0000e020: 6620 7265 6365 6e74 436c 6f73 6520 3e3d  f recentClose >=
+0000e030: 206d 6178 436c 6f73 653a 0a20 2020 2020   maxClose:.     
+0000e040: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+0000e050: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+0000e060: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+0000e070: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
+0000e080: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
+0000e090: 5374 6f63 6b22 5d7d 2c20 6861 7320 6120  Stock"]}, has a 
+0000e0a0: 6272 6561 6b6f 7574 2062 6563 6175 7365  breakout because
+0000e0b0: 2072 6563 656e 742d 636c 6f73 6520 287b   recent-close ({
+0000e0c0: 7265 6365 6e74 436c 6f73 657d 2920 3e3d  recentClose}) >=
+0000e0d0: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
+0000e0e0: 436c 6f73 657d 2927 0a20 2020 2020 2020  Close})'.       
+0000e0f0: 2020 2020 2020 2020 2023 2029 0a20 2020           # ).   
+0000e100: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0000e110: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
+0000e120: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
+0000e130: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0000e140: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+0000e150: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000e160: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
+0000e170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e180: 2020 2020 202b 2022 424f 3a20 220a 2020       + "BO: ".  
+0000e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1a0: 2020 2b20 7374 7228 6d61 7843 6c6f 7365    + str(maxClose
+0000e1b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e1c0: 2020 2020 2020 2b20 2220 523a 2030 220a        + " R: 0".
+0000e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1e0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000e1f0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0000e200: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000e210: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000e220: 6520 616e 6420 616c 7265 6164 7942 726f  e and alreadyBro
+0000e230: 6b65 6e6f 7574 2061 6e64 2073 656c 662e  kenout and self.
+0000e240: 6765 7443 616e 646c 6554 7970 6528 7265  getCandleType(re
+0000e250: 6365 6e74 290a 2020 2020 2020 2020 2020  cent).          
+0000e260: 2020 2320 7365 6c66 2e64 6566 6175 6c74    # self.default
+0000e270: 5f6c 6f67 6765 722e 696e 666f 280a 2020  _logger.info(.  
+0000e280: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0000e290: 6627 5374 6f63 6b3a 7b73 6176 6544 6963  f'Stock:{saveDic
+0000e2a0: 745b 2253 746f 636b 225d 7d2c 2068 6173  t["Stock"]}, has
+0000e2b0: 2061 2062 7265 616b 6f75 7420 6265 6361   a breakout beca
+0000e2c0: 7573 6520 7265 6365 6e74 2d63 6c6f 7365  use recent-close
+0000e2d0: 2028 7b72 6563 656e 7443 6c6f 7365 7d29   ({recentClose})
+0000e2e0: 203c 206d 6178 2d63 6c6f 7365 2028 7b6d   < max-close ({m
+0000e2f0: 6178 436c 6f73 657d 2927 0a20 2020 2020  axClose})'.     
+0000e300: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+0000e310: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0000e320: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
+0000e330: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e340: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
+0000e350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e360: 202b 2063 6f6c 6f72 5465 7874 2e46 4149   + colorText.FAI
+0000e370: 4c0a 2020 2020 2020 2020 2020 2020 2020  L.              
+0000e380: 2020 2b20 2242 4f3a 2022 0a20 2020 2020    + "BO: ".     
+0000e390: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+0000e3a0: 286d 6178 436c 6f73 6529 0a20 2020 2020  (maxClose).     
+0000e3b0: 2020 2020 2020 2020 2020 202b 2022 2052             + " R
+0000e3c0: 3a20 3022 0a20 2020 2020 2020 2020 2020  : 0".           
+0000e3d0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0000e3e0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0000e3f0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0000e400: 6574 7572 6e20 6e6f 7420 616c 7265 6164  eturn not alread
+0000e410: 7942 726f 6b65 6e6f 7574 0a0a 2020 2020  yBrokenout..    
+0000e420: 2320 4669 6e64 2073 746f 636b 7320 7468  # Find stocks th
+0000e430: 6174 2061 7265 2062 756c 6c69 7368 2069  at are bullish i
+0000e440: 6e74 7261 6461 793a 2052 5349 2063 726f  ntraday: RSI cro
+0000e450: 7373 6573 2035 352c 204d 6163 6420 4869  sses 55, Macd Hi
+0000e460: 7374 6f67 7261 6d20 706f 7369 7469 7665  stogram positive
+0000e470: 2c20 7072 6963 6520 6162 6f76 6520 454d  , price above EM
+0000e480: 4120 3130 0a20 2020 2064 6566 2066 696e  A 10.    def fin
+0000e490: 6442 756c 6c69 7368 496e 7472 6164 6179  dBullishIntraday
+0000e4a0: 5253 494d 4143 4428 7365 6c66 2c20 6466  RSIMACD(self, df
+0000e4b0: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
+0000e4c0: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+0000e4d0: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
+0000e4e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000e4f0: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+0000e500: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
+0000e510: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0000e520: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
+0000e530: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
+0000e540: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
+0000e550: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
+0000e560: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+0000e570: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
+0000e580: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
+0000e590: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
+0000e5a0: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
+0000e5b0: 0a20 2020 2020 2020 2064 6174 615b 2252  .        data["R
+0000e5c0: 5349 3132 225d 203d 2070 6b74 616c 6962  SI12"] = pktalib
+0000e5d0: 2e52 5349 2864 6174 615b 2243 6c6f 7365  .RSI(data["Close
+0000e5e0: 225d 2c20 3132 290a 2020 2020 2020 2020  "], 12).        
+0000e5f0: 6461 7461 5b22 454d 4131 3022 5d20 3d20  data["EMA10"] = 
+0000e600: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+0000e610: 5b22 436c 6f73 6522 5d2c 2031 3029 0a20  ["Close"], 10). 
+0000e620: 2020 2020 2020 2064 6174 615b 2245 4d41         data["EMA
+0000e630: 3230 3022 5d20 3d20 706b 7461 6c69 622e  200"] = pktalib.
+0000e640: 454d 4128 6461 7461 5b22 436c 6f73 6522  EMA(data["Close"
+0000e650: 5d2c 2032 3030 290a 2020 2020 2020 2020  ], 200).        
+0000e660: 6d61 6364 203d 2070 6b74 616c 6962 2e4d  macd = pktalib.M
+0000e670: 4143 4428 6461 7461 5b22 436c 6f73 6522  ACD(data["Close"
+0000e680: 5d2c 2031 302c 2031 382c 2039 295b 325d  ], 10, 18, 9)[2]
+0000e690: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
+0000e6a0: 2072 6563 656e 7420 3d20 6461 7461 2e74   recent = data.t
+0000e6b0: 6169 6c28 3129 0a20 2020 2020 2020 2063  ail(1).        c
+0000e6c0: 6f6e 6431 203d 2072 6563 656e 745b 2252  ond1 = recent["R
+0000e6d0: 5349 3132 225d 2e69 6c6f 635b 305d 203e  SI12"].iloc[0] >
+0000e6e0: 2035 350a 2020 2020 2020 2020 636f 6e64   55.        cond
+0000e6f0: 3220 3d20 636f 6e64 3120 616e 6420 286d  2 = cond1 and (m
+0000e700: 6163 642e 696c 6f63 5b3a 315d 5b30 5d20  acd.iloc[:1][0] 
+0000e710: 3e20 3029 0a20 2020 2020 2020 2063 6f6e  > 0).        con
+0000e720: 6433 203d 2063 6f6e 6432 2061 6e64 2028  d3 = cond2 and (
+0000e730: 7265 6365 6e74 5b22 436c 6f73 6522 5d2e  recent["Close"].
+0000e740: 696c 6f63 5b30 5d20 3e20 7265 6365 6e74  iloc[0] > recent
+0000e750: 5b22 454d 4131 3022 5d2e 696c 6f63 5b30  ["EMA10"].iloc[0
+0000e760: 5d29 0a20 2020 2020 2020 2063 6f6e 6434  ]).        cond4
+0000e770: 203d 2063 6f6e 6433 2061 6e64 2028 7265   = cond3 and (re
+0000e780: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+0000e790: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
+0000e7a0: 454d 4132 3030 225d 2e69 6c6f 635b 305d  EMA200"].iloc[0]
+0000e7b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000e7c0: 2063 6f6e 6434 0a20 2020 200a 2020 2020   cond4.    .    
+0000e7d0: 2320 4669 6e64 2073 746f 636b 7320 7468  # Find stocks th
+0000e7e0: 6174 206f 7065 6e65 6420 6869 6768 6572  at opened higher
+0000e7f0: 2074 6861 6e20 7468 6520 7072 6576 696f   than the previo
+0000e800: 7573 2068 6967 680a 2020 2020 6465 6620  us high.    def 
+0000e810: 6669 6e64 4869 6768 6572 4f70 656e 7328  findHigherOpens(
+0000e820: 7365 6c66 2c20 6466 293a 0a20 2020 2020  self, df):.     
+0000e830: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+0000e840: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+0000e850: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000e860: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0000e870: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+0000e880: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+0000e890: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+0000e8a0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0000e8b0: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+0000e8c0: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+0000e8d0: 2030 290a 2020 2020 2020 2020 7265 6365   0).        rece
+0000e8e0: 6e74 203d 2064 6174 612e 6865 6164 2832  nt = data.head(2
+0000e8f0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+0000e900: 2872 6563 656e 7429 203c 2032 3a0a 2020  (recent) < 2:.  
+0000e910: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e920: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+0000e930: 6574 7572 6e20 7265 6365 6e74 5b22 4f70  eturn recent["Op
+0000e940: 656e 225d 2e69 6c6f 635b 305d 203e 2072  en"].iloc[0] > r
+0000e950: 6563 656e 745b 2243 6c6f 7365 225d 2e69  ecent["Close"].i
+0000e960: 6c6f 635b 315d 0a0a 2020 2020 6465 6620  loc[1]..    def 
+0000e970: 6669 6e64 4869 6768 6572 4275 6c6c 6973  findHigherBullis
+0000e980: 684f 7065 6e73 2873 656c 662c 2064 6629  hOpens(self, df)
+0000e990: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+0000e9a0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+0000e9b0: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+0000e9c0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000e9d0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+0000e9e0: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+0000e9f0: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
+0000ea00: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+0000ea10: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
+0000ea20: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
+0000ea30: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
+0000ea40: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000ea50: 2e68 6561 6428 3229 0a20 2020 2020 2020  .head(2).       
+0000ea60: 2069 6620 6c65 6e28 7265 6365 6e74 2920   if len(recent) 
+0000ea70: 3c20 323a 0a20 2020 2020 2020 2020 2020  < 2:.           
+0000ea80: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000ea90: 2020 2020 2020 7265 7475 726e 2072 6563        return rec
+0000eaa0: 656e 745b 224f 7065 6e22 5d2e 696c 6f63  ent["Open"].iloc
+0000eab0: 5b30 5d20 3e20 7265 6365 6e74 5b22 4869  [0] > recent["Hi
+0000eac0: 6768 225d 2e69 6c6f 635b 315d 0a20 2020  gh"].iloc[1].   
+0000ead0: 200a 2020 2020 6465 6620 6669 6e64 4e52   .    def findNR
+0000eae0: 3444 6179 2873 656c 662c 2064 6629 3a0a  4Day(self, df):.
+0000eaf0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0000eb00: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0000eb10: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000eb20: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000eb30: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000eb40: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0000eb50: 2023 2068 7474 7073 3a2f 2f63 6861 7274   # https://chart
+0000eb60: 696e 6b2e 636f 6d2f 7363 7265 656e 6572  ink.com/screener
+0000eb70: 2f6e 7234 2d64 6169 6c79 2d74 6f64 6179  /nr4-daily-today
+0000eb80: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
+0000eb90: 2e74 6169 6c28 3129 5b22 566f 6c75 6d65  .tail(1)["Volume
+0000eba0: 225d 2e69 6c6f 635b 305d 203c 3d20 3530  "].iloc[0] <= 50
+0000ebb0: 3030 303a 0a20 2020 2020 2020 2020 2020  000:.           
+0000ebc0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000ebd0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000ebe0: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
+0000ebf0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0000ec00: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
+0000ec10: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
+0000ec20: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000ec30: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
+0000ec40: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
+0000ec50: 2073 6f20 7468 6174 2069 7473 2074 6865   so that its the
+0000ec60: 206f 6c64 6573 7420 6461 7465 2066 6972   oldest date fir
+0000ec70: 7374 0a20 2020 2020 2020 2064 6174 615b  st.        data[
+0000ec80: 2253 4d41 3130 225d 203d 2070 6b74 616c  "SMA10"] = pktal
+0000ec90: 6962 2e53 4d41 2864 6174 615b 2243 6c6f  ib.SMA(data["Clo
+0000eca0: 7365 225d 2c20 3130 290a 2020 2020 2020  se"], 10).      
+0000ecb0: 2020 6461 7461 5b22 534d 4135 3022 5d20    data["SMA50"] 
+0000ecc0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+0000ecd0: 7461 5b22 436c 6f73 6522 5d2c 2035 3029  ta["Close"], 50)
+0000ece0: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
+0000ecf0: 4d41 3230 3022 5d20 3d20 706b 7461 6c69  MA200"] = pktali
+0000ed00: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
+0000ed10: 6522 5d2c 2032 3030 290a 2020 2020 2020  e"], 200).      
+0000ed20: 2020 7265 6365 6e74 203d 2064 6174 612e    recent = data.
+0000ed30: 7461 696c 2835 290a 2020 2020 2020 2020  tail(5).        
+0000ed40: 7265 6365 6e74 203d 2072 6563 656e 745b  recent = recent[
+0000ed50: 3a3a 2d31 5d0a 2020 2020 2020 2020 636f  ::-1].        co
+0000ed60: 6e64 3120 3d20 2872 6563 656e 745b 2248  nd1 = (recent["H
+0000ed70: 6967 6822 5d2e 696c 6f63 5b30 5d20 2d20  igh"].iloc[0] - 
+0000ed80: 7265 6365 6e74 5b22 4c6f 7722 5d2e 696c  recent["Low"].il
+0000ed90: 6f63 5b30 5d29 203c 2028 0a20 2020 2020  oc[0]) < (.     
+0000eda0: 2020 2020 2020 2072 6563 656e 745b 2248         recent["H
+0000edb0: 6967 6822 5d2e 696c 6f63 5b31 5d20 2d20  igh"].iloc[1] - 
+0000edc0: 7265 6365 6e74 5b22 4c6f 7722 5d2e 696c  recent["Low"].il
+0000edd0: 6f63 5b31 5d0a 2020 2020 2020 2020 290a  oc[1].        ).
+0000ede0: 2020 2020 2020 2020 636f 6e64 3220 3d20          cond2 = 
+0000edf0: 636f 6e64 3120 616e 6420 2872 6563 656e  cond1 and (recen
+0000ee00: 745b 2248 6967 6822 5d2e 696c 6f63 5b30  t["High"].iloc[0
+0000ee10: 5d20 2d20 7265 6365 6e74 5b22 4c6f 7722  ] - recent["Low"
+0000ee20: 5d2e 696c 6f63 5b30 5d29 203c 2028 0a20  ].iloc[0]) < (. 
+0000ee30: 2020 2020 2020 2020 2020 2072 6563 656e             recen
+0000ee40: 745b 2248 6967 6822 5d2e 696c 6f63 5b32  t["High"].iloc[2
+0000ee50: 5d20 2d20 7265 6365 6e74 5b22 4c6f 7722  ] - recent["Low"
+0000ee60: 5d2e 696c 6f63 5b32 5d0a 2020 2020 2020  ].iloc[2].      
+0000ee70: 2020 290a 2020 2020 2020 2020 636f 6e64    ).        cond
+0000ee80: 3320 3d20 636f 6e64 3220 616e 6420 2872  3 = cond2 and (r
+0000ee90: 6563 656e 745b 2248 6967 6822 5d2e 696c  ecent["High"].il
+0000eea0: 6f63 5b30 5d20 2d20 7265 6365 6e74 5b22  oc[0] - recent["
+0000eeb0: 4c6f 7722 5d2e 696c 6f63 5b30 5d29 203c  Low"].iloc[0]) <
+0000eec0: 2028 0a20 2020 2020 2020 2020 2020 2072   (.            r
+0000eed0: 6563 656e 745b 2248 6967 6822 5d2e 696c  ecent["High"].il
+0000eee0: 6f63 5b33 5d20 2d20 7265 6365 6e74 5b22  oc[3] - recent["
+0000eef0: 4c6f 7722 5d2e 696c 6f63 5b33 5d0a 2020  Low"].iloc[3].  
+0000ef00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000ef10: 636f 6e64 3420 3d20 636f 6e64 3320 616e  cond4 = cond3 an
+0000ef20: 6420 2872 6563 656e 745b 2248 6967 6822  d (recent["High"
+0000ef30: 5d2e 696c 6f63 5b30 5d20 2d20 7265 6365  ].iloc[0] - rece
+0000ef40: 6e74 5b22 4c6f 7722 5d2e 696c 6f63 5b30  nt["Low"].iloc[0
+0000ef50: 5d29 203c 2028 0a20 2020 2020 2020 2020  ]) < (.         
+0000ef60: 2020 2072 6563 656e 745b 2248 6967 6822     recent["High"
+0000ef70: 5d2e 696c 6f63 5b34 5d20 2d20 7265 6365  ].iloc[4] - rece
+0000ef80: 6e74 5b22 4c6f 7722 5d2e 696c 6f63 5b34  nt["Low"].iloc[4
+0000ef90: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
+0000efa0: 2020 2020 636f 6e64 3520 3d20 636f 6e64      cond5 = cond
+0000efb0: 3420 616e 6420 2872 6563 656e 745b 2253  4 and (recent["S
+0000efc0: 4d41 3130 225d 2e69 6c6f 635b 305d 203e  MA10"].iloc[0] >
+0000efd0: 2072 6563 656e 745b 2253 4d41 3530 225d   recent["SMA50"]
+0000efe0: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0000eff0: 2020 636f 6e64 3620 3d20 636f 6e64 3520    cond6 = cond5 
+0000f000: 616e 6420 2872 6563 656e 745b 2253 4d41  and (recent["SMA
+0000f010: 3530 225d 2e69 6c6f 635b 305d 203e 2072  50"].iloc[0] > r
+0000f020: 6563 656e 745b 2253 4d41 3230 3022 5d2e  ecent["SMA200"].
+0000f030: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
+0000f040: 2072 6574 7572 6e20 636f 6e64 360a 0a20   return cond6.. 
+0000f050: 2020 2023 2046 696e 6420 706f 7465 6e74     # Find potent
+0000f060: 6961 6c20 6272 6561 6b6f 7574 2073 746f  ial breakout sto
+0000f070: 636b 730a 2020 2020 2320 5468 6973 2073  cks.    # This s
+0000f080: 6361 6e6e 6572 2066 696c 7465 7273 2073  canner filters s
+0000f090: 746f 636b 7320 7768 6f73 6520 6375 7272  tocks whose curr
+0000f0a0: 656e 7420 636c 6f73 6520 7072 6963 6520  ent close price 
+0000f0b0: 2b20 3525 2069 7320 6869 6768 6572 0a20  + 5% is higher. 
+0000f0c0: 2020 2023 2074 6861 6e20 7468 6520 6869     # than the hi
+0000f0d0: 6768 6573 7420 4869 6768 2070 7269 6365  ghest High price
+0000f0e0: 2069 6e20 7061 7374 2032 3030 2063 616e   in past 200 can
+0000f0f0: 646c 6573 2061 6e64 2074 6865 206d 6178  dles and the max
+0000f100: 696d 756d 2068 6967 680a 2020 2020 2320  imum high.    # 
+0000f110: 696e 2074 6865 2070 7265 7669 6f75 7320  in the previous 
+0000f120: 3330 2063 616e 646c 6573 2069 7320 6c6f  30 candles is lo
+0000f130: 7765 7220 7468 616e 2074 6865 2068 6967  wer than the hig
+0000f140: 6865 7374 2068 6967 6820 6d61 6465 2069  hest high made i
+0000f150: 6e20 7468 650a 2020 2020 2320 7072 6576  n the.    # prev
+0000f160: 696f 7573 2032 3030 2063 616e 646c 6573  ious 200 candles
+0000f170: 2c20 7374 6172 7469 6e67 2066 726f 6d20  , starting from 
+0000f180: 7468 6520 7072 6576 696f 7573 2033 3074  the previous 30t
+0000f190: 6820 6361 6e64 6c65 2e20 4174 2074 6865  h candle. At the
+0000f1a0: 0a20 2020 2023 2073 616d 6520 7469 6d65  .    # same time
+0000f1b0: 2074 6865 2063 7572 7265 6e74 2063 616e   the current can
+0000f1c0: 646c 6520 766f 6c75 6d65 2069 7320 6869  dle volume is hi
+0000f1d0: 6768 6572 2074 6861 6e20 3230 3020 534d  gher than 200 SM
+0000f1e0: 4120 6f66 2076 6f6c 756d 652e 0a20 2020  A of volume..   
+0000f1f0: 2064 6566 2066 696e 6450 6f74 656e 7469   def findPotenti
+0000f200: 616c 4272 6561 6b6f 7574 2873 656c 662c  alBreakout(self,
+0000f210: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+0000f220: 2073 6176 6544 6963 742c 2064 6179 7354   saveDict, daysT
+0000f230: 6f4c 6f6f 6b62 6163 6b29 3a0a 2020 2020  oLookback):.    
+0000f240: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+0000f250: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+0000f260: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0000f270: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0000f280: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+0000f290: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
+0000f2a0: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
+0000f2b0: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+0000f2c0: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
+0000f2d0: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
+0000f2e0: 2c20 3029 0a20 2020 2020 2020 2064 6174  , 0).        dat
+0000f2f0: 6120 3d20 6461 7461 2e68 6561 6428 3233  a = data.head(23
+0000f300: 3129 0a20 2020 2020 2020 2072 6563 656e  1).        recen
+0000f310: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
+0000f320: 0a20 2020 2020 2020 2072 6563 656e 7456  .        recentV
+0000f330: 6f6c 756d 6520 3d20 7265 6365 6e74 5b22  olume = recent["
+0000f340: 566f 6c75 6d65 225d 2e69 6c6f 635b 305d  Volume"].iloc[0]
+0000f350: 0a20 2020 2020 2020 2072 6563 656e 7443  .        recentC
+0000f360: 6c6f 7365 203d 2072 6f75 6e64 2872 6563  lose = round(rec
+0000f370: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
+0000f380: 635b 305d 202a 2031 2e30 352c 2032 290a  c[0] * 1.05, 2).
+0000f390: 2020 2020 2020 2020 6869 6768 6573 7448          highestH
+0000f3a0: 6967 6832 3030 203d 2072 6f75 6e64 2864  igh200 = round(d
+0000f3b0: 6174 612e 6865 6164 2832 3031 292e 7461  ata.head(201).ta
+0000f3c0: 696c 2832 3030 292e 6465 7363 7269 6265  il(200).describe
+0000f3d0: 2829 5b22 4869 6768 225d 5b22 6d61 7822  ()["High"]["max"
+0000f3e0: 5d2c 2032 290a 2020 2020 2020 2020 6869  ], 2).        hi
+0000f3f0: 6768 6573 7448 6967 6833 3020 3d20 726f  ghestHigh30 = ro
+0000f400: 756e 6428 6461 7461 2e68 6561 6428 3331  und(data.head(31
+0000f410: 292e 7461 696c 2833 3029 2e64 6573 6372  ).tail(30).descr
+0000f420: 6962 6528 295b 2248 6967 6822 5d5b 226d  ibe()["High"]["m
+0000f430: 6178 225d 2c20 3229 0a20 2020 2020 2020  ax"], 2).       
+0000f440: 2068 6967 6865 7374 4869 6768 3230 3046   highestHigh200F
+0000f450: 726f 6d33 3020 3d20 726f 756e 6428 6461  rom30 = round(da
+0000f460: 7461 2e74 6169 6c28 3230 3029 2e64 6573  ta.tail(200).des
+0000f470: 6372 6962 6528 295b 2248 6967 6822 5d5b  cribe()["High"][
+0000f480: 226d 6178 225d 2c20 3229 0a20 2020 2020  "max"], 2).     
+0000f490: 2020 2068 6967 6865 7374 4869 6768 3846     highestHigh8F
+0000f4a0: 726f 6d33 3020 3d20 726f 756e 6428 6461  rom30 = round(da
+0000f4b0: 7461 2e68 6561 6428 3339 292e 7461 696c  ta.head(39).tail
+0000f4c0: 2838 292e 6465 7363 7269 6265 2829 5b22  (8).describe()["
+0000f4d0: 4869 6768 225d 5b22 6d61 7822 5d2c 2032  High"]["max"], 2
+0000f4e0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0000f4f0: 2064 6174 612e 6865 6164 2832 3030 290a   data.head(200).
+0000f500: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000f510: 6174 615b 3a3a 2d31 5d20 2023 2052 6576  ata[::-1]  # Rev
+0000f520: 6572 7365 2074 6865 2064 6174 6166 7261  erse the datafra
+0000f530: 6d65 2073 6f20 7468 6174 2069 7473 2074  me so that its t
+0000f540: 6865 206f 6c64 6573 7420 6461 7465 2066  he oldest date f
+0000f550: 6972 7374 0a20 2020 2020 2020 2076 6f6c  irst.        vol
+0000f560: 3230 3020 3d20 706b 7461 6c69 622e 534d  200 = pktalib.SM
+0000f570: 4128 6461 7461 5b22 566f 6c75 6d65 225d  A(data["Volume"]
+0000f580: 2c74 696d 6570 6572 696f 643d 3230 3029  ,timeperiod=200)
+0000f590: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
+0000f5a0: 4d41 3230 3056 225d 203d 2076 6f6c 3230  MA200V"] = vol20
+0000f5b0: 300a 2020 2020 2020 2020 766f 6c35 3020  0.        vol50 
+0000f5c0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+0000f5d0: 7461 5b22 566f 6c75 6d65 225d 2c74 696d  ta["Volume"],tim
+0000f5e0: 6570 6572 696f 643d 3530 290a 2020 2020  eperiod=50).    
+0000f5f0: 2020 2020 6461 7461 5b22 534d 4135 3056      data["SMA50V
+0000f600: 225d 203d 2076 6f6c 3530 0a20 2020 2020  "] = vol50.     
+0000f610: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000f620: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
+0000f630: 2073 6d61 3230 3076 203d 2072 6563 656e   sma200v = recen
+0000f640: 745b 2253 4d41 3230 3056 225d 2e69 6c6f  t["SMA200V"].ilo
+0000f650: 635b 305d 0a20 2020 2020 2020 2073 6d61  c[0].        sma
+0000f660: 3530 7620 3d20 7265 6365 6e74 5b22 534d  50v = recent["SM
+0000f670: 4135 3056 225d 2e69 6c6f 635b 305d 0a20  A50V"].iloc[0]. 
+0000f680: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+0000f690: 2020 2020 2020 2020 6e70 2e69 736e 616e          np.isnan
+0000f6a0: 2872 6563 656e 7443 6c6f 7365 290a 2020  (recentClose).  
+0000f6b0: 2020 2020 2020 2020 2020 6f72 206e 702e            or np.
+0000f6c0: 6973 6e61 6e28 6869 6768 6573 7448 6967  isnan(highestHig
+0000f6d0: 6832 3030 290a 2020 2020 2020 2020 2020  h200).          
+0000f6e0: 2020 6f72 206e 702e 6973 6e61 6e28 6869    or np.isnan(hi
+0000f6f0: 6768 6573 7448 6967 6833 3029 0a20 2020  ghestHigh30).   
+0000f700: 2020 2020 2020 2020 206f 7220 6e70 2e69           or np.i
+0000f710: 736e 616e 2868 6967 6865 7374 4869 6768  snan(highestHigh
+0000f720: 3230 3046 726f 6d33 3029 0a20 2020 2020  200From30).     
+0000f730: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
+0000f740: 616e 2868 6967 6865 7374 4869 6768 3846  an(highestHigh8F
+0000f750: 726f 6d33 3029 0a20 2020 2020 2020 2020  rom30).         
+0000f760: 2020 206f 7220 6e70 2e69 736e 616e 2872     or np.isnan(r
+0000f770: 6563 656e 7456 6f6c 756d 6529 0a20 2020  ecentVolume).   
+0000f780: 2020 2020 2020 2020 206f 7220 6e70 2e69           or np.i
+0000f790: 736e 616e 2873 6d61 3230 3076 290a 2020  snan(sma200v).  
+0000f7a0: 2020 2020 2020 2020 2020 6f72 206e 702e            or np.
+0000f7b0: 6973 6e61 6e28 736d 6135 3076 290a 2020  isnan(sma50v).  
+0000f7c0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000f7d0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000f7e0: 650a 2020 2020 2020 2020 6966 2028 0a20  e.        if (. 
+0000f7f0: 2020 2020 2020 2020 2020 2028 7265 6365             (rece
+0000f800: 6e74 436c 6f73 6520 3e20 6869 6768 6573  ntClose > highes
+0000f810: 7448 6967 6832 3030 290a 2020 2020 2020  tHigh200).      
+0000f820: 2020 2020 2020 616e 6420 2828 2868 6967        and (((hig
+0000f830: 6865 7374 4869 6768 3330 203c 2068 6967  hestHigh30 < hig
+0000f840: 6865 7374 4869 6768 3230 3046 726f 6d33  hestHigh200From3
+0000f850: 3029 2061 6e64 2028 7265 6365 6e74 566f  0) and (recentVo
+0000f860: 6c75 6d65 203e 2073 6d61 3230 3076 2929  lume > sma200v))
+0000f870: 206f 7220 5c0a 2020 2020 2020 2020 2020   or \.          
+0000f880: 2020 2020 2020 2028 2868 6967 6865 7374         ((highest
+0000f890: 4869 6768 3330 203c 2068 6967 6865 7374  High30 < highest
+0000f8a0: 4869 6768 3846 726f 6d33 3029 2061 6e64  High8From30) and
+0000f8b0: 2028 7265 6365 6e74 566f 6c75 6d65 203e   (recentVolume >
+0000f8c0: 2073 6d61 3530 7629 290a 2020 2020 2020   sma50v)).      
+0000f8d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000f8e0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000f8f0: 2020 2073 6176 6544 6963 745b 2242 7265     saveDict["Bre
+0000f900: 616b 6f75 7422 5d20 3d20 7361 7665 4469  akout"] = saveDi
+0000f910: 6374 5b22 4272 6561 6b6f 7574 225d 202b  ct["Breakout"] +
+0000f920: 2022 2850 6f74 656e 7469 616c 2922 0a20   "(Potential)". 
+0000f930: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000f940: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
+0000f950: 5d20 3d20 7363 7265 656e 4469 6374 5b22  ] = screenDict["
+0000f960: 4272 6561 6b6f 7574 225d 202b 2028 0a20  Breakout"] + (. 
+0000f970: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f980: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+0000f990: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
+0000f9a0: 2b20 2220 2850 6f74 656e 7469 616c 2922  + " (Potential)"
+0000f9b0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000f9c0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000f9d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000f9e0: 6e20 5472 7565 0a20 2020 2020 2020 2072  n True.        r
+0000f9f0: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000fa00: 2023 2046 696e 6420 7374 6f63 6b73 2077   # Find stocks w
+0000fa10: 6974 6820 7265 7665 7273 696e 6720 5053  ith reversing PS
+0000fa20: 4152 2061 6e64 2052 5349 0a20 2020 2064  AR and RSI.    d
+0000fa30: 6566 2066 696e 6450 5341 5252 6576 6572  ef findPSARRever
+0000fa40: 7361 6c57 6974 6852 5349 2873 656c 662c  salWithRSI(self,
+0000fa50: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+0000fa60: 2073 6176 6544 6963 742c 6d69 6e52 5349   saveDict,minRSI
+0000fa70: 3d35 3029 3a0a 2020 2020 2020 2020 6966  =50):.        if
+0000fa80: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+0000fa90: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+0000faa0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fab0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+0000fac0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+0000fad0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0000fae0: 7461 5b3a 3a2d 315d 0a20 2020 2020 2020  ta[::-1].       
+0000faf0: 2070 7361 7220 3d20 706b 7461 6c69 622e   psar = pktalib.
+0000fb00: 7073 6172 2864 6174 615b 2248 6967 6822  psar(data["High"
+0000fb10: 5d2c 6461 7461 5b22 4c6f 7722 5d29 0a20  ],data["Low"]). 
+0000fb20: 2020 2020 2020 2069 6620 6c65 6e28 7073         if len(ps
+0000fb30: 6172 2920 3c20 333a 0a20 2020 2020 2020  ar) < 3:.       
+0000fb40: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000fb50: 650a 2020 2020 2020 2020 7073 6172 203d  e.        psar =
+0000fb60: 2070 7361 722e 7461 696c 2833 290a 2020   psar.tail(3).  
+0000fb70: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000fb80: 612e 7461 696c 2833 290a 2020 2020 2020  a.tail(3).      
+0000fb90: 2020 2320 6461 794d 696e 7573 3250 7361    # dayMinus2Psa
+0000fba0: 7220 3d20 7073 6172 2e69 6c6f 635b 305d  r = psar.iloc[0]
+0000fbb0: 0a20 2020 2020 2020 2064 6179 4d69 6e75  .        dayMinu
+0000fbc0: 7331 5073 6172 203d 2070 7361 722e 696c  s1Psar = psar.il
+0000fbd0: 6f63 5b31 5d0a 2020 2020 2020 2020 6461  oc[1].        da
+0000fbe0: 7950 5341 5220 3d20 7073 6172 2e69 6c6f  yPSAR = psar.ilo
+0000fbf0: 635b 325d 0a20 2020 2020 2020 2023 2064  c[2].        # d
+0000fc00: 6179 4d69 6e75 7332 436c 6f73 6520 3d20  ayMinus2Close = 
+0000fc10: 6461 7461 5b22 436c 6f73 6522 5d2e 696c  data["Close"].il
+0000fc20: 6f63 5b30 5d0a 2020 2020 2020 2020 6461  oc[0].        da
+0000fc30: 794d 696e 7573 3143 6c6f 7365 203d 2064  yMinus1Close = d
+0000fc40: 6174 615b 2243 6c6f 7365 225d 2e69 6c6f  ata["Close"].ilo
+0000fc50: 635b 315d 0a20 2020 2020 2020 2064 6179  c[1].        day
+0000fc60: 436c 6f73 6520 3d20 6461 7461 5b22 436c  Close = data["Cl
+0000fc70: 6f73 6522 5d2e 696c 6f63 5b32 5d0a 2020  ose"].iloc[2].  
+0000fc80: 2020 2020 2020 2320 6461 794d 696e 7573        # dayMinus
+0000fc90: 3252 5349 203d 2064 6174 615b 2252 5349  2RSI = data["RSI
+0000fca0: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+0000fcb0: 2020 2064 6179 4d69 6e75 7331 5253 4920     dayMinus1RSI 
+0000fcc0: 3d20 6461 7461 5b22 5253 4922 5d2e 696c  = data["RSI"].il
+0000fcd0: 6f63 5b31 5d0a 2020 2020 2020 2020 6461  oc[1].        da
+0000fce0: 7952 5349 203d 2064 6174 615b 2252 5349  yRSI = data["RSI
+0000fcf0: 225d 2e69 6c6f 635b 325d 0a20 2020 2020  "].iloc[2].     
+0000fd00: 2020 200a 2020 2020 2020 2020 6861 7352     .        hasR
+0000fd10: 6576 6572 7361 6c3d 2028 2828 6461 794d  eversal= (((dayM
+0000fd20: 696e 7573 3150 7361 7220 3e3d 2064 6179  inus1Psar >= day
+0000fd30: 4d69 6e75 7331 436c 6f73 6529 2061 6e64  Minus1Close) and
+0000fd40: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000fd50: 2020 2020 2020 2028 6461 7943 6c6f 7365         (dayClose
+0000fd60: 203e 3d20 6461 7950 5341 5229 2920 616e   >= dayPSAR)) an
+0000fd70: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+0000fd80: 2020 2020 2020 2020 2864 6179 4d69 6e75          (dayMinu
+0000fd90: 7331 5253 4920 3c3d 206d 696e 5253 4929  s1RSI <= minRSI)
+0000fda0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+0000fdb0: 2020 2020 2020 2020 2020 2028 6461 7952             (dayR
+0000fdc0: 5349 203e 3d20 6461 794d 696e 7573 3152  SI >= dayMinus1R
+0000fdd0: 5349 2929 0a20 2020 2020 2020 2069 6620  SI)).        if 
+0000fde0: 6861 7352 6576 6572 7361 6c3a 0a20 2020  hasReversal:.   
+0000fdf0: 2020 2020 2020 2020 2073 6176 6564 203d           saved =
+0000fe00: 2073 656c 662e 6669 6e64 4375 7272 656e   self.findCurren
+0000fe10: 7453 6176 6564 5661 6c75 6528 7363 7265  tSavedValue(scre
+0000fe20: 656e 4469 6374 2c73 6176 6544 6963 742c  enDict,saveDict,
+0000fe30: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
+0000fe40: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+0000fe50: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
+0000fe60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000fe70: 2020 7361 7665 645b 305d 200a 2020 2020    saved[0] .    
+0000fe80: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0000fe90: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+0000fea0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0000feb0: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+0000fec0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000fed0: 2066 2250 5341 522d 5253 492d 5265 7622   f"PSAR-RSI-Rev"
+0000fee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fef0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000ff00: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000ff10: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0000ff20: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
+0000ff30: 2073 6176 6564 5b31 5d20 2b20 6622 5053   saved[1] + f"PS
+0000ff40: 4152 2d52 5349 2d52 6576 220a 2020 2020  AR-RSI-Rev".    
+0000ff50: 2020 2020 2020 2020 2020 2020 2320 2828              # ((
+0000ff60: 2864 6179 4d69 6e75 7332 5073 6172 203e  (dayMinus2Psar >
+0000ff70: 3d20 6461 794d 696e 7573 3243 6c6f 7365  = dayMinus2Close
+0000ff80: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+0000ff90: 2020 2020 2020 2020 2320 2828 6461 794d          # ((dayM
+0000ffa0: 696e 7573 3143 6c6f 7365 203e 3d20 6461  inus1Close >= da
+0000ffb0: 794d 696e 7573 3150 7361 7229 2061 6e64  yMinus1Psar) and
+0000ffc0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000ffd0: 2020 2023 2028 6461 7943 6c6f 7365 203e     # (dayClose >
+0000ffe0: 3d20 6461 7950 5341 5229 2929 2061 6e64  = dayPSAR))) and
+0000fff0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00010000: 2020 2023 2028 6461 794d 696e 7573 3252     # (dayMinus2R
+00010010: 5349 203e 3d20 6d69 6e52 5349 2920 616e  SI >= minRSI) an
+00010020: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+00010030: 2020 2020 2320 2864 6179 4d69 6e75 7331      # (dayMinus1
+00010040: 5253 4920 3e3d 2064 6179 4d69 6e75 7332  RSI >= dayMinus2
+00010050: 5253 4929 2061 6e64 205c 0a20 2020 2020  RSI) and \.     
+00010060: 2020 2020 2020 2020 2020 2023 2028 6461             # (da
+00010070: 7952 5349 203e 3d20 6461 794d 696e 7573  yRSI >= dayMinus
+00010080: 3152 5349 2929 206f 7220 5c0a 2020 2020  1RSI)) or \.    
+00010090: 2020 2020 7265 7475 726e 2068 6173 5265      return hasRe
+000100a0: 7665 7273 616c 0a0a 2020 2020 2320 4669  versal..    # Fi
+000100b0: 6e64 2073 746f 636b 2072 6576 6572 7369  nd stock reversi
+000100c0: 6e67 2061 7420 6769 7665 6e20 4d41 0a20  ng at given MA. 
+000100d0: 2020 2064 6566 2066 696e 6452 6576 6572     def findRever
+000100e0: 7361 6c4d 4128 7365 6c66 2c20 6466 2c20  salMA(self, df, 
+000100f0: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+00010100: 4469 6374 2c20 6d61 4c65 6e67 7468 2c20  Dict, maLength, 
+00010110: 7065 7263 656e 7461 6765 3d30 2e30 3229  percentage=0.02)
+00010120: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+00010130: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+00010140: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+00010150: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00010160: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+00010170: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+00010180: 2020 206d 6152 616e 6765 203d 205b 392c     maRange = [9,
+00010190: 2031 302c 2032 302c 2035 302c 2032 3030   10, 20, 50, 200
+000101a0: 5d20 6966 206d 614c 656e 6774 6820 696e  ] if maLength in
+000101b0: 205b 392c 3130 2c32 302c 3530 2c31 3030   [9,10,20,50,100
+000101c0: 5d20 656c 7365 205b 392c 3130 2c32 302c  ] else [9,10,20,
+000101d0: 3530 2c31 3030 2c6d 6152 616e 6765 5d0a  50,100,maRange].
+000101e0: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
+000101f0: 3d20 5b5d 0a20 2020 2020 2020 2068 6173  = [].        has
+00010200: 5265 7665 7273 616c 7320 3d20 4661 6c73  Reversals = Fals
+00010210: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+00010220: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
+00010230: 2020 2020 7361 7665 6420 3d20 7365 6c66      saved = self
+00010240: 2e66 696e 6443 7572 7265 6e74 5361 7665  .findCurrentSave
+00010250: 6456 616c 7565 2873 6372 6565 6e44 6963  dValue(screenDic
+00010260: 742c 7361 7665 4469 6374 2c20 224d 412d  t,saveDict, "MA-
+00010270: 5369 676e 616c 2229 0a20 2020 2020 2020  Signal").       
+00010280: 2066 6f72 206d 614c 656e 6774 6820 696e   for maLength in
+00010290: 206d 6152 616e 6765 3a0a 2020 2020 2020   maRange:.      
+000102a0: 2020 2020 2020 6461 7461 436f 7079 203d        dataCopy =
+000102b0: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+000102c0: 2020 6966 2073 656c 662e 636f 6e66 6967    if self.config
+000102d0: 4d61 6e61 6765 722e 7573 6545 4d41 206f  Manager.useEMA o
+000102e0: 7220 6d61 4c65 6e67 7468 203d 3d20 393a  r maLength == 9:
+000102f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010300: 206d 6152 6576 203d 2070 6b74 616c 6962   maRev = pktalib
+00010310: 2e45 4d41 2864 6174 6143 6f70 795b 2243  .EMA(dataCopy["C
+00010320: 6c6f 7365 225d 2c20 7469 6d65 7065 7269  lose"], timeperi
+00010330: 6f64 3d6d 614c 656e 6774 6829 0a20 2020  od=maLength).   
+00010340: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00010350: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00010360: 6152 6576 203d 2070 6b74 616c 6962 2e4d  aRev = pktalib.M
+00010370: 4128 6461 7461 436f 7079 5b22 436c 6f73  A(dataCopy["Clos
+00010380: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+00010390: 6d61 4c65 6e67 7468 290a 2020 2020 2020  maLength).      
+000103a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000103b0: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
+000103c0: 6f70 792e 6472 6f70 2822 6d61 5265 7622  opy.drop("maRev"
+000103d0: 2c20 6178 6973 3d31 2c20 696e 706c 6163  , axis=1, inplac
+000103e0: 653d 5472 7565 2c20 6572 726f 7273 3d22  e=True, errors="
+000103f0: 6967 6e6f 7265 2229 0a20 2020 2020 2020  ignore").       
+00010400: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00010410: 7074 696f 6e3a 2320 7072 6167 6d61 3a20  ption:# pragma: 
+00010420: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
+00010430: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00010440: 2020 2020 2020 2020 2020 6461 7461 436f            dataCo
+00010450: 7079 2e69 6e73 6572 7428 6c65 6e28 6461  py.insert(len(da
+00010460: 7461 436f 7079 2e63 6f6c 756d 6e73 292c  taCopy.columns),
+00010470: 2022 6d61 5265 7622 2c20 6d61 5265 7629   "maRev", maRev)
+00010480: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00010490: 6143 6f70 7920 3d20 6461 7461 436f 7079  aCopy = dataCopy
+000104a0: 5b3a 3a2d 315d 2e68 6561 6428 3429 0a20  [::-1].head(4). 
+000104b0: 2020 2020 2020 2020 2020 2062 756c 6c69             bulli
+000104c0: 7368 4d41 5265 7665 7273 616c 203d 2064  shMAReversal = d
+000104d0: 6174 6143 6f70 795b 226d 6152 6576 225d  ataCopy["maRev"]
+000104e0: 2e69 6c6f 635b 305d 203e 3d20 6461 7461  .iloc[0] >= data
+000104f0: 436f 7079 5b22 6d61 5265 7622 5d2e 696c  Copy["maRev"].il
+00010500: 6f63 5b31 5d20 616e 6420 5c0a 2020 2020  oc[1] and \.    
+00010510: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00010520: 436f 7079 5b22 6d61 5265 7622 5d2e 696c  Copy["maRev"].il
+00010530: 6f63 5b31 5d20 3e3d 2064 6174 6143 6f70  oc[1] >= dataCop
+00010540: 795b 226d 6152 6576 225d 2e69 6c6f 635b  y["maRev"].iloc[
+00010550: 325d 2061 6e64 205c 0a20 2020 2020 2020  2] and \.       
+00010560: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00010570: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
+00010580: 6c6f 635b 325d 203c 2064 6174 6143 6f70  loc[2] < dataCop
+00010590: 795b 226d 6152 6576 225d 2e69 6c6f 635b  y["maRev"].iloc[
+000105a0: 335d 0a20 2020 2020 2020 2020 2020 2062  3].            b
+000105b0: 756c 6c69 7368 436c 6f73 6520 3d20 6461  ullishClose = da
+000105c0: 7461 436f 7079 2e68 6561 6428 3129 5b22  taCopy.head(1)["
+000105d0: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+000105e0: 3e3d 2064 6174 6143 6f70 792e 6865 6164  >= dataCopy.head
+000105f0: 2831 295b 226d 6152 6576 225d 2e69 6c6f  (1)["maRev"].ilo
+00010600: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+00010610: 2062 6561 7269 7368 4d41 5265 7665 7273   bearishMARevers
+00010620: 616c 203d 2064 6174 6143 6f70 795b 226d  al = dataCopy["m
+00010630: 6152 6576 225d 2e69 6c6f 635b 305d 203c  aRev"].iloc[0] <
+00010640: 3d20 6461 7461 436f 7079 5b22 6d61 5265  = dataCopy["maRe
+00010650: 7622 5d2e 696c 6f63 5b31 5d20 616e 6420  v"].iloc[1] and 
+00010660: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00010670: 2020 6461 7461 436f 7079 5b22 6d61 5265    dataCopy["maRe
+00010680: 7622 5d2e 696c 6f63 5b31 5d20 3c3d 2064  v"].iloc[1] <= d
+00010690: 6174 6143 6f70 795b 226d 6152 6576 225d  ataCopy["maRev"]
+000106a0: 2e69 6c6f 635b 325d 2061 6e64 205c 0a20  .iloc[2] and \. 
+000106b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106c0: 2020 2064 6174 6143 6f70 795b 226d 6152     dataCopy["maR
+000106d0: 6576 225d 2e69 6c6f 635b 325d 203e 2064  ev"].iloc[2] > d
+000106e0: 6174 6143 6f70 795b 226d 6152 6576 225d  ataCopy["maRev"]
+000106f0: 2e69 6c6f 635b 335d 0a20 2020 2020 2020  .iloc[3].       
+00010700: 2020 2020 2069 7352 6563 656e 7443 6c6f       isRecentClo
+00010710: 7365 5769 7468 696e 5065 7263 656e 7452  seWithinPercentR
+00010720: 616e 6765 203d 2064 6174 6143 6f70 792e  ange = dataCopy.
+00010730: 6571 7561 6c73 2864 6174 6143 6f70 795b  equals(dataCopy[
+00010740: 2864 6174 6143 6f70 792e 436c 6f73 6520  (dataCopy.Close 
+00010750: 3e3d 2028 6461 7461 436f 7079 2e6d 6152  >= (dataCopy.maR
+00010760: 6576 202d 2028 6461 7461 436f 7079 2e6d  ev - (dataCopy.m
+00010770: 6152 6576 202a 2070 6572 6365 6e74 6167  aRev * percentag
+00010780: 6529 2929 2026 2028 6461 7461 436f 7079  e))) & (dataCopy
+00010790: 2e43 6c6f 7365 203c 3d20 2864 6174 6143  .Close <= (dataC
+000107a0: 6f70 792e 6d61 5265 7620 2b20 2864 6174  opy.maRev + (dat
+000107b0: 6143 6f70 792e 6d61 5265 7620 2a20 7065  aCopy.maRev * pe
+000107c0: 7263 656e 7461 6765 2929 295d 290a 2020  rcentage)))]).  
+000107d0: 2020 2020 2020 2020 2020 6966 2028 6973            if (is
+000107e0: 5265 6365 6e74 436c 6f73 6557 6974 6869  RecentCloseWithi
+000107f0: 6e50 6572 6365 6e74 5261 6e67 6520 616e  nPercentRange an
+00010800: 6420 6275 6c6c 6973 6843 6c6f 7365 2061  d bullishClose a
+00010810: 6e64 2062 756c 6c69 7368 4d41 5265 7665  nd bullishMAReve
+00010820: 7273 616c 2920 6f72 205c 0a20 2020 2020  rsal) or \.     
+00010830: 2020 2020 2020 2020 2020 2028 6973 5265             (isRe
+00010840: 6365 6e74 436c 6f73 6557 6974 6869 6e50  centCloseWithinP
+00010850: 6572 6365 6e74 5261 6e67 6520 616e 6420  ercentRange and 
+00010860: 6e6f 7420 6275 6c6c 6973 6843 6c6f 7365  not bullishClose
+00010870: 2061 6e64 2062 6561 7269 7368 4d41 5265   and bearishMARe
+00010880: 7665 7273 616c 293a 0a20 2020 2020 2020  versal):.       
+00010890: 2020 2020 2020 2020 2068 6173 5265 7665           hasReve
+000108a0: 7273 616c 7320 3d20 5472 7565 0a20 2020  rsals = True.   
+000108b0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000108c0: 756c 7473 2e61 7070 656e 6428 7374 7228  ults.append(str(
+000108d0: 6d61 4c65 6e67 7468 2929 0a20 2020 2020  maLength)).     
+000108e0: 2020 2069 6620 6861 7352 6576 6572 7361     if hasReversa
+000108f0: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+00010900: 7363 7265 656e 4469 6374 5b22 4d41 2d53  screenDict["MA-S
+00010910: 6967 6e61 6c22 5d20 3d20 280a 2020 2020  ignal"] = (.    
+00010920: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00010930: 645b 305d 200a 2020 2020 2020 2020 2020  d[0] .          
+00010940: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+00010950: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+00010960: 2020 2020 2020 202b 2028 636f 6c6f 7254         + (colorT
+00010970: 6578 742e 4752 4545 4e20 6966 2062 756c  ext.GREEN if bul
+00010980: 6c69 7368 4d41 5265 7665 7273 616c 2065  lishMAReversal e
+00010990: 6c73 6520 2863 6f6c 6f72 5465 7874 2e46  lse (colorText.F
+000109a0: 4149 4c20 6966 2062 6561 7269 7368 4d41  AIL if bearishMA
+000109b0: 5265 7665 7273 616c 2065 6c73 6520 636f  Reversal else co
+000109c0: 6c6f 7254 6578 742e 5741 524e 2929 0a20  lorText.WARN)). 
+000109d0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000109e0: 2066 2252 6576 6572 7361 6c2d 5b7b 272c   f"Reversal-[{',
+000109f0: 272e 6a6f 696e 2872 6573 756c 7473 297d  '.join(results)}
+00010a00: 5d7b 2745 4d41 2720 6966 2028 6d61 4c65  ]{'EMA' if (maLe
+00010a10: 6e67 7468 203d 3d20 3920 6f72 2073 656c  ngth == 9 or sel
+00010a20: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
+00010a30: 7573 6545 4d41 2920 656c 7365 2027 4d41  useEMA) else 'MA
+00010a40: 277d 220a 2020 2020 2020 2020 2020 2020  '}".            
+00010a50: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00010a60: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00010a70: 290a 2020 2020 2020 2020 2020 2020 7361  ).            sa
+00010a80: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+00010a90: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
+00010aa0: 2066 2252 6576 6572 7361 6c2d 5b7b 272c   f"Reversal-[{',
+00010ab0: 272e 6a6f 696e 2872 6573 756c 7473 297d  '.join(results)}
+00010ac0: 5d7b 2745 4d41 2720 6966 2028 6d61 4c65  ]{'EMA' if (maLe
+00010ad0: 6e67 7468 203d 3d20 3920 6f72 2073 656c  ngth == 9 or sel
+00010ae0: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
+00010af0: 7573 6545 4d41 2920 656c 7365 2027 4d41  useEMA) else 'MA
+00010b00: 277d 220a 2020 2020 2020 2020 7265 7475  '}".        retu
+00010b10: 726e 2068 6173 5265 7665 7273 616c 730a  rn hasReversals.
+00010b20: 0a20 2020 2064 6566 2066 696e 6443 7572  .    def findCur
+00010b30: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
+00010b40: 656c 662c 2073 6372 6565 6e44 6963 742c  elf, screenDict,
+00010b50: 2073 6176 6544 6963 742c 206b 6579 293a   saveDict, key):
+00010b60: 0a20 2020 2020 2020 2065 7869 7374 696e  .        existin
+00010b70: 6753 6372 6565 6e20 3d20 7363 7265 656e  gScreen = screen
+00010b80: 4469 6374 2e67 6574 286b 6579 290a 2020  Dict.get(key).  
+00010b90: 2020 2020 2020 6578 6973 7469 6e67 5361        existingSa
+00010ba0: 7665 203d 2073 6176 6544 6963 742e 6765  ve = saveDict.ge
+00010bb0: 7428 6b65 7929 0a20 2020 2020 2020 2065  t(key).        e
+00010bc0: 7869 7374 696e 6753 6372 6565 6e20 3d20  xistingScreen = 
+00010bd0: 6622 7b65 7869 7374 696e 6753 6372 6565  f"{existingScree
+00010be0: 6e7d 2c20 2220 6966 2028 6578 6973 7469  n}, " if (existi
+00010bf0: 6e67 5363 7265 656e 2069 7320 6e6f 7420  ngScreen is not 
+00010c00: 4e6f 6e65 2061 6e64 206c 656e 2865 7869  None and len(exi
+00010c10: 7374 696e 6753 6372 6565 6e29 203e 2030  stingScreen) > 0
+00010c20: 2920 656c 7365 2022 220a 2020 2020 2020  ) else "".      
+00010c30: 2020 6578 6973 7469 6e67 5361 7665 203d    existingSave =
+00010c40: 2066 227b 6578 6973 7469 6e67 5361 7665   f"{existingSave
+00010c50: 7d2c 2022 2069 6620 2865 7869 7374 696e  }, " if (existin
+00010c60: 6753 6176 6520 6973 206e 6f74 204e 6f6e  gSave is not Non
+00010c70: 6520 616e 6420 6c65 6e28 6578 6973 7469  e and len(existi
+00010c80: 6e67 5361 7665 2920 3e20 3029 2065 6c73  ngSave) > 0) els
+00010c90: 6520 2222 0a20 2020 2020 2020 2072 6574  e "".        ret
+00010ca0: 7572 6e20 6578 6973 7469 6e67 5363 7265  urn existingScre
+00010cb0: 656e 2c20 6578 6973 7469 6e67 5361 7665  en, existingSave
+00010cc0: 0a0a 2020 2020 2320 406d 6561 7375 7265  ..    # @measure
+00010cd0: 5f74 696d 650a 2020 2020 6465 6620 6669  _time.    def fi
+00010ce0: 6e64 4262 616e 6473 5371 7565 657a 6528  ndBbandsSqueeze(
+00010cf0: 7365 6c66 2c66 756c 6c44 6174 612c 2073  self,fullData, s
+00010d00: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+00010d10: 6963 742c 2066 696c 7465 723d 3429 3a0a  ict, filter=4):.
+00010d20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010d30: 2020 2020 5468 6520 5454 4d20 5371 7565      The TTM Sque
+00010d40: 657a 6520 696e 6469 6361 746f 7220 6d65  eze indicator me
+00010d50: 6173 7572 6573 2074 6865 2072 656c 6174  asures the relat
+00010d60: 696f 6e73 6869 7020 6265 7477 6565 6e20  ionship between 
+00010d70: 7468 6520 0a20 2020 2020 2020 2042 6f6c  the .        Bol
+00010d80: 6c69 6e67 6572 2042 616e 6473 2061 6e64  linger Bands and
+00010d90: 204b 656c 746e 6572 2773 2043 6861 6e6e   Keltner's Chann
+00010da0: 656c 2e20 5768 656e 2074 6865 2076 6f6c  el. When the vol
+00010db0: 6174 696c 6974 7920 696e 6372 6561 7365  atility increase
+00010dc0: 732c 200a 2020 2020 2020 2020 736f 2064  s, .        so d
+00010dd0: 6f65 7320 7468 6520 6469 7374 616e 6365  oes the distance
+00010de0: 2062 6574 7765 656e 2074 6865 2062 616e   between the ban
+00010df0: 6473 2c20 616e 6420 636f 6e76 6572 7365  ds, and converse
+00010e00: 6c79 2c20 7768 656e 2074 6865 200a 2020  ly, when the .  
+00010e10: 2020 2020 2020 766f 6c61 7469 6c69 7479        volatility
+00010e20: 2064 6563 6c69 6e65 732c 2074 6865 2064   declines, the d
+00010e30: 6973 7461 6e63 6520 616c 736f 2064 6563  istance also dec
+00010e40: 7265 6173 6573 2e20 5468 6520 5371 7565  reases. The Sque
+00010e50: 657a 6520 696e 6469 6361 746f 7220 0a20  eze indicator . 
+00010e60: 2020 2020 2020 2066 696e 6473 2073 6563         finds sec
+00010e70: 7469 6f6e 7320 6f66 2074 6865 2042 6f6c  tions of the Bol
+00010e80: 6c69 6e67 6572 2042 616e 6473 2073 7475  linger Bands stu
+00010e90: 6479 2077 6869 6368 2066 616c 6c20 696e  dy which fall in
+00010ea0: 7369 6465 2074 6865 200a 2020 2020 2020  side the .      
+00010eb0: 2020 4b65 6c74 6e65 7227 7320 4368 616e    Keltner's Chan
+00010ec0: 6e65 6c73 2e0a 2020 2020 2020 2020 0a20  nels..        . 
+00010ed0: 2020 2020 2020 2041 7420 7468 6520 6d6f         At the mo
+00010ee0: 6d65 6e74 2074 6869 7320 7371 7565 657a  ment this squeez
+00010ef0: 6520 6861 7070 656e 732c 2061 2070 7269  e happens, a pri
+00010f00: 6365 2062 7265 616b 6f75 7420 6672 6f6d  ce breakout from
+00010f10: 2074 6865 2075 7070 6572 200a 2020 2020   the upper .    
+00010f20: 2020 2020 426f 6c6c 696e 6765 7220 4261      Bollinger Ba
+00010f30: 6e64 2077 6f75 6c64 2069 6e64 6963 6174  nd would indicat
+00010f40: 6520 7468 6520 706f 7373 6962 696c 6974  e the possibilit
+00010f50: 7920 6f66 2061 6e20 7570 7472 656e 6420  y of an uptrend 
+00010f60: 696e 2074 6865 200a 2020 2020 2020 2020  in the .        
+00010f70: 6675 7475 7265 2e20 5468 6973 2069 7320  future. This is 
+00010f80: 6261 636b 6564 2062 7920 7468 6520 6661  backed by the fa
+00010f90: 6374 2074 6861 7420 6f6e 6365 2074 6865  ct that once the
+00010fa0: 2070 7269 6365 2073 7461 7274 7320 6272   price starts br
+00010fb0: 6561 6b69 6e67 200a 2020 2020 2020 2020  eaking .        
+00010fc0: 6f75 7420 6f66 2074 6865 2062 616e 6473  out of the bands
+00010fd0: 2c20 6974 2077 6f75 6c64 206d 6561 6e20  , it would mean 
+00010fe0: 6120 7265 6c61 7861 7469 6f6e 206f 6620  a relaxation of 
+00010ff0: 7468 6520 7371 7565 657a 6520 616e 6420  the squeeze and 
+00011000: 7468 6520 0a20 2020 2020 2020 2070 6f73  the .        pos
+00011010: 7369 6269 6c69 7479 206f 6620 6869 6768  sibility of high
+00011020: 206d 6172 6b65 7420 766f 6c61 7469 6c69   market volatili
+00011030: 7479 2061 6e64 2070 7269 6365 206d 6f76  ty and price mov
+00011040: 656d 656e 7420 696e 2074 6865 2066 7574  ement in the fut
+00011050: 7572 652e 200a 2020 2020 2020 2020 5369  ure. .        Si
+00011060: 6d69 6c61 726c 792c 2061 2070 7269 6365  milarly, a price
+00011070: 2062 7265 616b 6f75 7420 6672 6f6d 2074   breakout from t
+00011080: 6865 206c 6f77 6572 2042 6f6c 6c69 6e67  he lower Bolling
+00011090: 6572 2042 616e 6420 6166 7465 7220 6120  er Band after a 
+000110a0: 7371 7565 657a 6520 0a20 2020 2020 2020  squeeze .       
+000110b0: 2077 6f75 6c64 2069 6e64 6963 6174 6520   would indicate 
+000110c0: 7468 6520 706f 7373 6962 696c 6974 7920  the possibility 
+000110d0: 6f66 2061 2064 6f77 6e74 7265 6e64 2069  of a downtrend i
+000110e0: 6e20 7468 6520 6675 7475 7265 2061 6e64  n the future and
+000110f0: 2061 6e20 0a20 2020 2020 2020 2069 6e63   an .        inc
+00011100: 7265 6173 6564 206d 6172 6b65 7420 766f  reased market vo
+00011110: 6c61 7469 6c69 7479 2069 6e20 7468 6520  latility in the 
+00011120: 7361 6d65 2064 6972 6563 7469 6f6e 2e20  same direction. 
+00011130: 5768 656e 2074 6865 206d 6172 6b65 7420  When the market 
+00011140: 0a20 2020 2020 2020 2066 696e 6973 6865  .        finishe
+00011150: 7320 6120 6d6f 7665 2c20 7468 6520 696e  s a move, the in
+00011160: 6469 6361 746f 7220 7475 726e 7320 6f66  dicator turns of
+00011170: 662c 2077 6869 6368 2063 6f72 7265 7370  f, which corresp
+00011180: 6f6e 6473 2074 6f20 6261 6e64 7320 0a20  onds to bands . 
+00011190: 2020 2020 2020 2068 6176 696e 6720 7075         having pu
+000111a0: 7368 6564 2077 656c 6c20 6f75 7473 6964  shed well outsid
+000111b0: 6520 7468 6520 7261 6e67 6520 6f66 204b  e the range of K
+000111c0: 656c 746e 6572 2773 2043 6861 6e6e 656c  eltner's Channel
+000111d0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+000111e0: 2020 2020 2020 2069 6620 6675 6c6c 4461         if fullDa
+000111f0: 7461 2069 7320 4e6f 6e65 206f 7220 6c65  ta is None or le
+00011200: 6e28 6675 6c6c 4461 7461 2920 3c20 3230  n(fullData) < 20
+00011210: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00011220: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00011230: 2020 206f 6c64 6573 7452 6563 6f72 6473     oldestRecords
+00011240: 4669 7273 745f 6466 203d 2066 756c 6c44  First_df = fullD
+00011250: 6174 612e 6865 6164 2833 3029 2e63 6f70  ata.head(30).cop
+00011260: 7928 290a 2020 2020 2020 2020 6c61 7465  y().        late
+00011270: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
+00011280: 6620 3d20 6f6c 6465 7374 5265 636f 7264  f = oldestRecord
+00011290: 7346 6972 7374 5f64 665b 3a3a 2d31 5d2e  sFirst_df[::-1].
+000112a0: 7461 696c 2833 3029 0a20 2020 2020 2020  tail(30).       
+000112b0: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+000112c0: 7273 745f 6466 203d 206c 6174 6573 7452  rst_df = latestR
+000112d0: 6563 6f72 6473 4669 7273 745f 6466 2e66  ecordsFirst_df.f
+000112e0: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+000112f0: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+00011300: 7273 745f 6466 203d 206c 6174 6573 7452  rst_df = latestR
+00011310: 6563 6f72 6473 4669 7273 745f 6466 2e72  ecordsFirst_df.r
+00011320: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
+00011330: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
+00011340: 2020 2020 2023 2042 6f6c 6c69 6e67 6572       # Bollinger
+00011350: 2062 616e 6473 0a20 2020 2020 2020 206c   bands.        l
+00011360: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
+00011370: 745f 6466 2e6c 6f63 5b3a 2c27 4242 616e  t_df.loc[:,'BBan
+00011380: 6473 2d55 275d 2c20 6c61 7465 7374 5265  ds-U'], latestRe
+00011390: 636f 7264 7346 6972 7374 5f64 662e 6c6f  cordsFirst_df.lo
+000113a0: 635b 3a2c 2742 4261 6e64 732d 4d27 5d2c  c[:,'BBands-M'],
+000113b0: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+000113c0: 7273 745f 6466 2e6c 6f63 5b3a 2c27 4242  rst_df.loc[:,'BB
+000113d0: 616e 6473 2d4c 275d 203d 2070 6b74 616c  ands-L'] = pktal
+000113e0: 6962 2e42 4241 4e44 5328 6c61 7465 7374  ib.BBANDS(latest
+000113f0: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
+00011400: 2243 6c6f 7365 225d 2c20 3230 290a 2020  "Close"], 20).  
+00011410: 2020 2020 2020 2320 636f 6d70 7574 6520        # compute 
+00011420: 4b65 6c74 6e65 7227 7320 6368 616e 6e65  Keltner's channe
+00011430: 6c0a 2020 2020 2020 2020 6c61 7465 7374  l.        latest
+00011440: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
+00011450: 276c 6f77 5f6b 656c 275d 2c20 6c61 7465  'low_kel'], late
+00011460: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
+00011470: 665b 2775 7070 5f6b 656c 275d 203d 2070  f['upp_kel'] = p
+00011480: 6b74 616c 6962 2e4b 656c 746e 6572 7343  ktalib.KeltnersC
+00011490: 6861 6e6e 656c 286c 6174 6573 7452 6563  hannel(latestRec
+000114a0: 6f72 6473 4669 7273 745f 6466 5b22 4869  ordsFirst_df["Hi
+000114b0: 6768 225d 2c20 6c61 7465 7374 5265 636f  gh"], latestReco
+000114c0: 7264 7346 6972 7374 5f64 665b 224c 6f77  rdsFirst_df["Low
+000114d0: 225d 2c6c 6174 6573 7452 6563 6f72 6473  "],latestRecords
+000114e0: 4669 7273 745f 6466 5b22 436c 6f73 6522  First_df["Close"
+000114f0: 5d2c 3230 290a 2020 2020 2020 2020 2320  ],20).        # 
+00011500: 7371 7565 657a 6520 696e 6469 6361 746f  squeeze indicato
+00011510: 720a 2020 2020 2020 2020 6465 6620 696e  r.        def in
+00011520: 5f73 7175 6565 7a65 2864 6629 3a0a 2020  _squeeze(df):.  
+00011530: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011540: 2064 665b 276c 6f77 5f6b 656c 275d 203c   df['low_kel'] <
+00011550: 2064 665b 2742 4261 6e64 732d 4c27 5d20   df['BBands-L'] 
+00011560: 3c20 6466 5b27 4242 616e 6473 2d55 275d  < df['BBands-U']
+00011570: 203c 2064 665b 2775 7070 5f6b 656c 275d   < df['upp_kel']
+00011580: 0a0a 2020 2020 2020 2020 6c61 7465 7374  ..        latest
+00011590: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
+000115a0: 2773 7175 6565 7a65 275d 203d 206c 6174  'squeeze'] = lat
+000115b0: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
+000115c0: 6466 2e61 7070 6c79 2869 6e5f 7371 7565  df.apply(in_sque
+000115d0: 657a 652c 2061 7869 733d 3129 0a0a 2020  eze, axis=1)..  
+000115e0: 2020 2020 2020 2320 4c65 7427 7320 7265        # Let's re
+000115f0: 7669 6577 206a 7573 7420 7468 6520 7072  view just the pr
+00011600: 6576 696f 7573 2033 2063 616e 646c 6573  evious 3 candles
+00011610: 2069 6e63 6c75 6469 6e67 2074 6f64 6179   including today
+00011620: 2028 6174 2074 6865 2065 6e64 290a 2020   (at the end).  
+00011630: 2020 2020 2020 6c61 7465 7374 5265 636f        latestReco
+00011640: 7264 7346 6972 7374 5f64 6620 3d20 6c61  rdsFirst_df = la
+00011650: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
+00011660: 5f64 662e 7461 696c 2833 290a 2020 2020  _df.tail(3).    
+00011670: 2020 2020 2320 7374 6f63 6b20 6973 2063      # stock is c
+00011680: 6f6d 696e 6720 6f75 7420 6f66 2074 6865  oming out of the
+00011690: 2073 7175 6565 7a65 0a20 2020 2020 2020   squeeze.       
+000116a0: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
+000116b0: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+000116c0: 6c75 6528 7363 7265 656e 4469 6374 2c20  lue(screenDict, 
+000116d0: 7361 7665 4469 6374 2c20 2250 6174 7465  saveDict, "Patte
+000116e0: 726e 2229 0a20 2020 2020 2020 2063 616e  rn").        can
+000116f0: 646c 6533 5371 7a20 3d20 6c61 7465 7374  dle3Sqz = latest
+00011700: 5265 636f 7264 7346 6972 7374 5f64 662e  RecordsFirst_df.
+00011710: 696c 6f63 5b2d 335d 5b22 7371 7565 657a  iloc[-3]["squeez
+00011720: 6522 5d0a 2020 2020 2020 2020 6361 6e64  e"].        cand
+00011730: 6c65 3153 717a 203d 206c 6174 6573 7452  le1Sqz = latestR
+00011740: 6563 6f72 6473 4669 7273 745f 6466 2e69  ecordsFirst_df.i
+00011750: 6c6f 635b 2d31 5d5b 2273 7175 6565 7a65  loc[-1]["squeeze
+00011760: 225d 0a20 2020 2020 2020 2063 616e 646c  "].        candl
+00011770: 6532 5371 7a20 3d20 6c61 7465 7374 5265  e2Sqz = latestRe
+00011780: 636f 7264 7346 6972 7374 5f64 662e 696c  cordsFirst_df.il
+00011790: 6f63 5b2d 325d 5b22 7371 7565 657a 6522  oc[-2]["squeeze"
+000117a0: 5d0a 2020 2020 2020 2020 6966 2063 616e  ].        if can
+000117b0: 646c 6533 5371 7a20 616e 6420 6e6f 7420  dle3Sqz and not 
+000117c0: 6361 6e64 6c65 3153 717a 3a0a 2020 2020  candle1Sqz:.    
+000117d0: 2020 2020 2020 2020 2320 3372 6420 6361          # 3rd ca
+000117e0: 6e64 6c65 2066 726f 6d20 7468 6520 6d6f  ndle from the mo
+000117f0: 7374 2072 6563 656e 7420 6f6e 6520 7761  st recent one wa
+00011800: 7320 696e 2073 7175 6565 7a65 2062 7574  s in squeeze but
+00011810: 2074 6865 206d 6f73 7420 7265 6365 6e74   the most recent
+00011820: 206f 6e65 2069 7320 6e6f 742e 0a20 2020   one is not..   
+00011830: 2020 2020 2020 2020 2069 6620 6669 6c74           if filt
+00011840: 6572 206e 6f74 2069 6e20 5b31 2c33 2c34  er not in [1,3,4
+00011850: 5d3a 2023 2042 7579 2f53 656c 6c2f 416c  ]: # Buy/Sell/Al
+00011860: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00011870: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00011880: 2020 2020 2020 2020 2020 2023 2064 6563             # dec
+00011890: 6964 6520 7768 6963 6820 6163 7469 6f6e  ide which action
+000118a0: 2074 6f20 7461 6b65 2062 7920 636f 6d70   to take by comp
+000118b0: 6172 696e 6720 6469 7374 616e 6365 7320  aring distances 
+000118c0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+000118d0: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+000118e0: 616e 6365 5f74 6f5f 7570 7065 7220 3d20  ance_to_upper = 
+000118f0: 6162 7328 6c61 7465 7374 5265 636f 7264  abs(latestRecord
+00011900: 7346 6972 7374 5f64 665b 2742 4261 6e64  sFirst_df['BBand
+00011910: 732d 5527 5d2e 7661 6c75 6573 5b2d 315d  s-U'].values[-1]
+00011920: 202d 206c 6174 6573 7452 6563 6f72 6473   - latestRecords
+00011930: 4669 7273 745f 6466 5b27 436c 6f73 6527  First_df['Close'
+00011940: 5d2e 7661 6c75 6573 5b2d 315d 290a 2020  ].values[-1]).  
+00011950: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+00011960: 6365 5f74 6f5f 6c6f 7765 7220 3d20 6162  ce_to_lower = ab
+00011970: 7328 6c61 7465 7374 5265 636f 7264 7346  s(latestRecordsF
+00011980: 6972 7374 5f64 665b 2742 4261 6e64 732d  irst_df['BBands-
+00011990: 4c27 5d2e 7661 6c75 6573 5b2d 315d 202d  L'].values[-1] -
+000119a0: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+000119b0: 7273 745f 6466 5b27 436c 6f73 6527 5d2e  rst_df['Close'].
+000119c0: 7661 6c75 6573 5b2d 315d 290a 2020 2020  values[-1]).    
+000119d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000119e0: 2020 2020 2061 6374 696f 6e20 3d20 4661       action = Fa
+000119f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00011a00: 6966 2064 6973 7461 6e63 655f 746f 5f75  if distance_to_u
+00011a10: 7070 6572 203c 2064 6973 7461 6e63 655f  pper < distance_
+00011a20: 746f 5f6c 6f77 6572 3a0a 2020 2020 2020  to_lower:.      
+00011a30: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+00011a40: 7465 7220 6e6f 7420 696e 205b 312c 345d  ter not in [1,4]
+00011a50: 3a20 2320 4275 792f 416c 6c0a 2020 2020  : # Buy/All.    
+00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a70: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+00011a80: 2020 2020 2020 2020 2020 2020 2061 6374               act
+00011a90: 696f 6e20 3d20 5472 7565 0a20 2020 2020  ion = True.     
+00011aa0: 2020 2020 2020 2065 6c69 6620 6669 6c74         elif filt
+00011ab0: 6572 206e 6f74 2069 6e20 5b33 2c34 5d3a  er not in [3,4]:
+00011ac0: 2023 2053 656c 6c2f 416c 6c0a 2020 2020   # Sell/All.    
+00011ad0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00011ae0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00011af0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00011b00: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+00011b10: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00011b20: 742e 424f 4c44 202b 2028 636f 6c6f 7254  t.BOLD + (colorT
+00011b30: 6578 742e 4752 4545 4e20 6966 2061 6374  ext.GREEN if act
+00011b40: 696f 6e20 656c 7365 2063 6f6c 6f72 5465  ion else colorTe
+00011b50: 7874 2e46 4149 4c29 202b 2066 2242 4261  xt.FAIL) + f"BBa
+00011b60: 6e64 732d 5351 5a2d 7b27 4275 7927 2069  nds-SQZ-{'Buy' i
+00011b70: 6620 6163 7469 6f6e 2065 6c73 6520 2753  f action else 'S
+00011b80: 656c 6c27 7d22 202b 2063 6f6c 6f72 5465  ell'}" + colorTe
+00011b90: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00011ba0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+00011bb0: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
+00011bc0: 5d20 2b20 6622 5454 4d2d 5351 5a2d 7b27  ] + f"TTM-SQZ-{'
+00011bd0: 4275 7927 2069 6620 6163 7469 6f6e 2065  Buy' if action e
+00011be0: 6c73 6520 2753 656c 6c27 7d22 0a20 2020  lse 'Sell'}".   
+00011bf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011c00: 5472 7565 0a20 2020 2020 2020 2065 6c69  True.        eli
+00011c10: 6620 6361 6e64 6c65 3353 717a 2061 6e64  f candle3Sqz and
+00011c20: 2063 616e 646c 6532 5371 7a20 616e 6420   candle2Sqz and 
+00011c30: 6361 6e64 6c65 3153 717a 3a0a 2020 2020  candle1Sqz:.    
+00011c40: 2020 2020 2020 2020 2320 4c61 7374 2033          # Last 3
+00011c50: 2063 616e 646c 6573 2069 6e20 7371 7565   candles in sque
+00011c60: 657a 650a 2020 2020 2020 2020 2020 2020  eze.            
+00011c70: 6966 2066 696c 7465 7220 6e6f 7420 696e  if filter not in
+00011c80: 205b 322c 345d 3a20 2320 5371 5a2f 416c   [2,4]: # SqZ/Al
+00011c90: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00011ca0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00011cb0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00011cc0: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
+00011cd0: 203d 2066 277b 7361 7665 645b 305d 7d7b   = f'{saved[0]}{
+00011ce0: 636f 6c6f 7254 6578 742e 424f 4c44 7d7b  colorText.BOLD}{
+00011cf0: 636f 6c6f 7254 6578 742e 5741 524e 7d54  colorText.WARN}T
+00011d00: 544d 2d53 515a 7b63 6f6c 6f72 5465 7874  TM-SQZ{colorText
+00011d10: 2e45 4e44 7d27 0a20 2020 2020 2020 2020  .END}'.         
+00011d20: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+00011d30: 7465 726e 225d 203d 2066 277b 7361 7665  tern"] = f'{save
+00011d40: 645b 315d 7d54 544d 2d53 515a 270a 2020  d[1]}TTM-SQZ'.  
+00011d50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011d60: 2054 7275 650a 2020 2020 2020 2020 7265   True.        re
+00011d70: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
+00011d80: 6465 6620 6669 6e64 496e 7472 6164 6179  def findIntraday
+00011d90: 4869 6768 4372 6f73 736f 7665 7228 7365  HighCrossover(se
+00011da0: 6c66 2c20 6466 2c20 6166 7465 7254 696d  lf, df, afterTim
+00011db0: 6573 7461 6d70 3d4e 6f6e 6529 3a0a 2020  estamp=None):.  
+00011dc0: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+00011dd0: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+00011de0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00011df0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00011e00: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+00011e10: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
+00011e20: 6174 6120 3d20 6461 7461 2e66 696c 6c6e  ata = data.filln
+00011e30: 6128 3029 0a20 2020 2020 2020 2064 6174  a(0).        dat
+00011e40: 6120 3d20 6461 7461 2e72 6570 6c61 6365  a = data.replace
+00011e50: 285b 6e70 2e69 6e66 2c20 2d6e 702e 696e  ([np.inf, -np.in
+00011e60: 665d 2c20 3029 0a20 2020 2020 2020 2064  f], 0).        d
+00011e70: 6174 6120 3d20 6461 7461 5b3a 3a2d 315d  ata = data[::-1]
+00011e80: 2020 2320 5265 7665 7273 6520 7468 6520    # Reverse the 
+00011e90: 6461 7461 6672 616d 6520 736f 2074 6861  dataframe so tha
+00011ea0: 7420 6974 7320 7468 6520 6f6c 6465 7374  t its the oldest
+00011eb0: 2064 6174 6520 6669 7273 740a 2020 2020   date first.    
+00011ec0: 2020 2020 6469 6666 5f64 6620 3d20 4e6f      diff_df = No
+00011ed0: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
+00011ee0: 2020 2020 2020 2020 2020 2020 2320 4c65              # Le
+00011ef0: 7427 7320 6f6e 6c79 2063 6f6e 7369 6465  t's only conside
+00011f00: 7220 7468 6f73 6520 6361 6e64 6c65 7320  r those candles 
+00011f10: 7468 6174 2061 7265 2061 6674 6572 2074  that are after t
+00011f20: 6865 2061 6c65 7274 2069 7373 7565 2d74  he alert issue-t
+00011f30: 696d 6520 696e 2074 6865 206d 6f72 6e69  ime in the morni
+00011f40: 6e67 7320 2b20 3220 6361 6e64 6c65 7320  ngs + 2 candles 
+00011f50: 2866 6f72 2062 7579 2f73 656c 6c29 0a20  (for buy/sell). 
+00011f60: 2020 2020 2020 2020 2020 2064 6966 665f             diff_
+00011f70: 6466 203d 2064 6174 615b 6461 7461 2e69  df = data[data.i
+00011f80: 6e64 6578 203e 3d20 2070 642e 746f 5f64  ndex >=  pd.to_d
+00011f90: 6174 6574 696d 6528 6627 7b50 4b44 6174  atetime(f'{PKDat
+00011fa0: 6555 7469 6c69 7469 6573 2e74 7261 6469  eUtilities.tradi
+00011fb0: 6e67 4461 7465 2829 2e73 7472 6674 696d  ngDate().strftim
+00011fc0: 6528 6622 2559 2d25 6d2d 2564 2229 7d20  e(f"%Y-%m-%d")} 
+00011fd0: 3039 3a7b 3135 2b73 656c 662e 636f 6e66  09:{15+self.conf
+00011fe0: 6967 4d61 6e61 6765 722e 6d6f 726e 696e  igManager.mornin
+00011ff0: 6761 6e61 6c79 7369 7363 616e 646c 656e  ganalysiscandlen
+00012000: 756d 6265 7220 2b20 327d 3a30 302b 3035  umber + 2}:00+05
+00012010: 3a33 3027 292e 746f 5f64 6174 6574 696d  :30').to_datetim
+00012020: 6536 3428 295d 0a20 2020 2020 2020 2020  e64()].         
+00012030: 2020 2023 2062 726f 6b65 7253 7172 4f66     # brokerSqrOf
+00012040: 6674 696d 6520 3d20 7064 2e74 6f5f 6461  ftime = pd.to_da
+00012050: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
+00012060: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
+00012070: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
+00012080: 2866 2225 592d 256d 2d25 6422 297d 2031  (f"%Y-%m-%d")} 1
+00012090: 353a 3134 3a30 302b 3035 3a33 3027 292e  5:14:00+05:30').
+000120a0: 746f 5f64 6174 6574 696d 6536 3428 290a  to_datetime64().
+000120b0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+000120c0: 2020 2020 2020 2020 2020 2020 6469 6666              diff
+000120d0: 5f64 6620 3d20 6461 7461 5b64 6174 612e  _df = data[data.
+000120e0: 696e 6465 7820 3e3d 2020 7064 2e74 6f5f  index >=  pd.to_
+000120f0: 6461 7465 7469 6d65 2866 277b 504b 4461  datetime(f'{PKDa
+00012100: 7465 5574 696c 6974 6965 732e 7472 6164  teUtilities.trad
+00012110: 696e 6744 6174 6528 292e 7374 7266 7469  ingDate().strfti
+00012120: 6d65 2866 2225 592d 256d 2d25 6422 297d  me(f"%Y-%m-%d")}
+00012130: 2030 393a 7b31 352b 7365 6c66 2e63 6f6e   09:{15+self.con
+00012140: 6669 674d 616e 6167 6572 2e6d 6f72 6e69  figManager.morni
+00012150: 6e67 616e 616c 7973 6973 6361 6e64 6c65  nganalysiscandle
+00012160: 6e75 6d62 6572 202b 2032 7d3a 3030 2b30  number + 2}:00+0
+00012170: 353a 3330 272c 2075 7463 3d54 7275 6529  5:30', utc=True)
+00012180: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+00012190: 6272 6f6b 6572 5371 724f 6666 7469 6d65  brokerSqrOfftime
+000121a0: 203d 2070 642e 746f 5f64 6174 6574 696d   = pd.to_datetim
+000121b0: 6528 6627 7b50 4b44 6174 6555 7469 6c69  e(f'{PKDateUtili
+000121c0: 7469 6573 2e74 7261 6469 6e67 4461 7465  ties.tradingDate
+000121d0: 2829 2e73 7472 6674 696d 6528 6622 2559  ().strftime(f"%Y
+000121e0: 2d25 6d2d 2564 2229 7d20 3135 3a31 343a  -%m-%d")} 15:14:
+000121f0: 3030 2b30 353a 3330 272c 2075 7463 3d54  00+05:30', utc=T
+00012200: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00012210: 2070 6173 730a 2020 2020 2020 2020 6461   pass.        da
+00012220: 7948 6967 6841 6674 6572 416c 6572 7420  yHighAfterAlert 
+00012230: 3d20 6469 6666 5f64 665b 2248 6967 6822  = diff_df["High"
+00012240: 5d2e 6d61 7828 290a 2020 2020 2020 2020  ].max().        
+00012250: 6869 6768 526f 7720 3d20 6469 6666 5f64  highRow = diff_d
+00012260: 665b 6469 6666 5f64 665b 2248 6967 6822  f[diff_df["High"
+00012270: 5d20 3e3d 2064 6179 4869 6768 4166 7465  ] >= dayHighAfte
+00012280: 7241 6c65 7274 5d0a 2020 2020 2020 2020  rAlert].        
+00012290: 6966 2068 6967 6852 6f77 2069 7320 6e6f  if highRow is no
+000122a0: 7420 4e6f 6e65 2061 6e64 206c 656e 2868  t None and len(h
+000122b0: 6967 6852 6f77 2920 3e20 303a 0a20 2020  ighRow) > 0:.   
+000122c0: 2020 2020 2020 2020 2068 6967 6852 6f77           highRow
+000122d0: 203d 2068 6967 6852 6f77 2e74 6169 6c28   = highRow.tail(
+000122e0: 3129 0a20 2020 2020 2020 2072 6574 7572  1).        retur
+000122f0: 6e20 6869 6768 526f 772e 696e 6465 785b  n highRow.index[
+00012300: 2d31 5d2c 2068 6967 6852 6f77 0a0a 0a20  -1], highRow... 
+00012310: 2020 2064 6566 2066 696e 644d 4143 4443     def findMACDC
+00012320: 726f 7373 6f76 6572 2873 656c 662c 2064  rossover(self, d
+00012330: 662c 2061 6674 6572 5469 6d65 7374 616d  f, afterTimestam
+00012340: 703d 4e6f 6e65 2c20 6e74 6843 726f 7373  p=None, nthCross
+00012350: 6f76 6572 3d31 2c20 7570 4469 7265 6374  over=1, upDirect
+00012360: 696f 6e3d 5472 7565 2c20 6d69 6e52 5349  ion=True, minRSI
+00012370: 3d36 3029 3a0a 2020 2020 2020 2020 6966  =60):.        if
+00012380: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+00012390: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+000123a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000123b0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+000123c0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+000123d0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+000123e0: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+000123f0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+00012400: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+00012410: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+00012420: 2020 2020 2020 2064 6174 612e 6472 6f70         data.drop
+00012430: 6e61 2861 7869 733d 302c 2068 6f77 3d22  na(axis=0, how="
+00012440: 616c 6c22 2c20 696e 706c 6163 653d 5472  all", inplace=Tr
+00012450: 7565 2920 2320 4d61 7962 6520 7468 6572  ue) # Maybe ther
+00012460: 6520 7761 7320 6e6f 2074 7261 6465 2064  e was no trade d
+00012470: 6f6e 6520 6174 2074 6865 7365 2074 696d  one at these tim
+00012480: 6573 3f0a 2020 2020 2020 2020 6461 7461  es?.        data
+00012490: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
+000124a0: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
+000124b0: 6166 7261 6d65 2073 6f20 7468 6174 2069  aframe so that i
+000124c0: 7473 2074 6865 206f 6c64 6573 7420 6461  ts the oldest da
+000124d0: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
+000124e0: 206d 6163 644c 696e 652c 206d 6163 6453   macdLine, macdS
+000124f0: 6967 6e61 6c2c 206d 6163 6448 6973 7420  ignal, macdHist 
+00012500: 3d20 706b 7461 6c69 622e 4d41 4344 2864  = pktalib.MACD(d
+00012510: 6174 615b 2243 6c6f 7365 225d 2c20 3132  ata["Close"], 12
+00012520: 2c20 3236 2c20 3929 0a20 2020 2020 2020  , 26, 9).       
+00012530: 2023 2072 7369 5f64 6620 3d20 706b 7461   # rsi_df = pkta
+00012540: 6c69 622e 5253 4928 6461 7461 5b22 436c  lib.RSI(data["Cl
+00012550: 6f73 6522 5d2c 2031 3429 0a20 2020 2020  ose"], 14).     
+00012560: 2020 206c 696e 655f 6466 203d 2070 642e     line_df = pd.
+00012570: 4461 7461 4672 616d 6528 6d61 6364 4c69  DataFrame(macdLi
+00012580: 6e65 290a 2020 2020 2020 2020 7369 676e  ne).        sign
+00012590: 616c 5f64 6620 3d20 7064 2e44 6174 6146  al_df = pd.DataF
+000125a0: 7261 6d65 286d 6163 6453 6967 6e61 6c29  rame(macdSignal)
+000125b0: 0a20 2020 2020 2020 2076 6f6c 5f64 6620  .        vol_df 
+000125c0: 3d20 6461 7461 5b22 566f 6c75 6d65 225d  = data["Volume"]
+000125d0: 0a20 2020 2020 2020 2064 6966 665f 6466  .        diff_df
+000125e0: 203d 2070 642e 636f 6e63 6174 285b 6c69   = pd.concat([li
+000125f0: 6e65 5f64 662c 2073 6967 6e61 6c5f 6466  ne_df, signal_df
+00012600: 2c20 7369 676e 616c 5f64 662d 6c69 6e65  , signal_df-line
+00012610: 5f64 662c 766f 6c5f 6466 5d2c 2061 7869  _df,vol_df], axi
+00012620: 733d 3129 0a20 2020 2020 2020 2064 6966  s=1).        dif
+00012630: 665f 6466 2e63 6f6c 756d 6e73 203d 205b  f_df.columns = [
+00012640: 226c 696e 6522 2c22 7369 676e 616c 222c  "line","signal",
+00012650: 2264 6966 6622 2c22 766f 6c22 5d0a 2020  "diff","vol"].  
+00012660: 2020 2020 2020 6469 6666 5f64 6620 3d20        diff_df = 
+00012670: 6469 6666 5f64 665b 6469 6666 5f64 665b  diff_df[diff_df[
+00012680: 2276 6f6c 225d 203e 2030 5d20 2320 5765  "vol"] > 0] # We
+00012690: 2772 6520 6e6f 7420 676f 696e 6720 746f  're not going to
+000126a0: 2064 6f20 616e 7974 6869 6e67 2077 6974   do anything wit
+000126b0: 6820 6120 6361 6e64 6c65 2077 6865 7265  h a candle where
+000126c0: 2074 6865 7265 2077 6173 206e 6f20 7472   there was no tr
+000126d0: 6164 652e 0a20 2020 2020 2020 2023 2062  ade..        # b
+000126e0: 726f 6b65 7253 7172 4f66 6674 696d 6520  rokerSqrOfftime 
+000126f0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
+00012700: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00012710: 2320 4c65 7427 7320 6f6e 6c79 2063 6f6e  # Let's only con
+00012720: 7369 6465 7220 7468 6f73 6520 6361 6e64  sider those cand
+00012730: 6c65 7320 7468 6174 2061 7265 2061 6674  les that are aft
+00012740: 6572 2074 6865 2061 6c65 7274 2069 7373  er the alert iss
+00012750: 7565 2d74 696d 6520 696e 2074 6865 206d  ue-time in the m
+00012760: 6f72 6e69 6e67 7320 2b20 3220 6361 6e64  ornings + 2 cand
+00012770: 6c65 7320 2866 6f72 2062 7579 2f73 656c  les (for buy/sel
+00012780: 6c29 0a20 2020 2020 2020 2020 2020 2064  l).            d
+00012790: 6966 665f 6466 203d 2064 6966 665f 6466  iff_df = diff_df
+000127a0: 5b64 6966 665f 6466 2e69 6e64 6578 203e  [diff_df.index >
+000127b0: 3d20 2070 642e 746f 5f64 6174 6574 696d  =  pd.to_datetim
+000127c0: 6528 6627 7b50 4b44 6174 6555 7469 6c69  e(f'{PKDateUtili
+000127d0: 7469 6573 2e74 7261 6469 6e67 4461 7465  ties.tradingDate
+000127e0: 2829 2e73 7472 6674 696d 6528 6622 2559  ().strftime(f"%Y
+000127f0: 2d25 6d2d 2564 2229 7d20 3039 3a7b 3135  -%m-%d")} 09:{15
+00012800: 2b73 656c 662e 636f 6e66 6967 4d61 6e61  +self.configMana
+00012810: 6765 722e 6d6f 726e 696e 6761 6e61 6c79  ger.morninganaly
+00012820: 7369 7363 616e 646c 656e 756d 6265 7220  siscandlenumber 
+00012830: 2b20 327d 3a30 302b 3035 3a33 3027 292e  + 2}:00+05:30').
+00012840: 746f 5f64 6174 6574 696d 6536 3428 295d  to_datetime64()]
+00012850: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
+00012860: 726f 6b65 7253 7172 4f66 6674 696d 6520  rokerSqrOfftime 
+00012870: 3d20 7064 2e74 6f5f 6461 7465 7469 6d65  = pd.to_datetime
+00012880: 2866 277b 504b 4461 7465 5574 696c 6974  (f'{PKDateUtilit
+00012890: 6965 732e 7472 6164 696e 6744 6174 6528  ies.tradingDate(
+000128a0: 292e 7374 7266 7469 6d65 2866 2225 592d  ).strftime(f"%Y-
+000128b0: 256d 2d25 6422 297d 2031 353a 3134 3a30  %m-%d")} 15:14:0
+000128c0: 302b 3035 3a33 3027 292e 746f 5f64 6174  0+05:30').to_dat
+000128d0: 6574 696d 6536 3428 290a 2020 2020 2020  etime64().      
+000128e0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+000128f0: 2020 2020 2020 6469 6666 5f64 6620 3d20        diff_df = 
+00012900: 6469 6666 5f64 665b 6469 6666 5f64 662e  diff_df[diff_df.
+00012910: 696e 6465 7820 3e3d 2020 7064 2e74 6f5f  index >=  pd.to_
+00012920: 6461 7465 7469 6d65 2866 277b 504b 4461  datetime(f'{PKDa
+00012930: 7465 5574 696c 6974 6965 732e 7472 6164  teUtilities.trad
+00012940: 696e 6744 6174 6528 292e 7374 7266 7469  ingDate().strfti
+00012950: 6d65 2866 2225 592d 256d 2d25 6422 297d  me(f"%Y-%m-%d")}
+00012960: 2030 393a 7b31 352b 7365 6c66 2e63 6f6e   09:{15+self.con
+00012970: 6669 674d 616e 6167 6572 2e6d 6f72 6e69  figManager.morni
+00012980: 6e67 616e 616c 7973 6973 6361 6e64 6c65  nganalysiscandle
+00012990: 6e75 6d62 6572 202b 2032 7d3a 3030 2b30  number + 2}:00+0
+000129a0: 353a 3330 272c 2075 7463 3d54 7275 6529  5:30', utc=True)
+000129b0: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+000129c0: 6272 6f6b 6572 5371 724f 6666 7469 6d65  brokerSqrOfftime
+000129d0: 203d 2070 642e 746f 5f64 6174 6574 696d   = pd.to_datetim
+000129e0: 6528 6627 7b50 4b44 6174 6555 7469 6c69  e(f'{PKDateUtili
+000129f0: 7469 6573 2e74 7261 6469 6e67 4461 7465  ties.tradingDate
+00012a00: 2829 2e73 7472 6674 696d 6528 6622 2559  ().strftime(f"%Y
+00012a10: 2d25 6d2d 2564 2229 7d20 3135 3a31 343a  -%m-%d")} 15:14:
+00012a20: 3030 2b30 353a 3330 272c 2075 7463 3d54  00+05:30', utc=T
+00012a30: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00012a40: 2070 6173 730a 2020 2020 2020 2020 696e   pass.        in
+00012a50: 6465 7820 3d20 6c65 6e28 6469 6666 5f64  dex = len(diff_d
+00012a60: 6629 0a20 2020 2020 2020 2063 726f 7373  f).        cross
+00012a70: 4f76 6572 203d 2030 0a20 2020 2020 2020  Over = 0.       
+00012a80: 200a 2020 2020 2020 2020 2320 4c6f 6f70   .        # Loop
+00012a90: 2075 6e74 696c 2077 6527 7665 2066 6f75   until we've fou
+00012aa0: 6e64 2074 6865 206e 7468 2063 726f 7373  nd the nth cross
+00012ab0: 6f76 6572 2066 6f72 204d 4143 4420 6f72  over for MACD or
+00012ac0: 2077 6527 7665 2072 6561 6368 6564 2074   we've reached t
+00012ad0: 6865 206c 6173 7420 706f 696e 7420 696e  he last point in
+00012ae0: 2074 696d 650a 2020 2020 2020 2020 7768   time.        wh
+00012af0: 696c 6520 2863 726f 7373 4f76 6572 203c  ile (crossOver <
+00012b00: 206e 7468 4372 6f73 736f 7665 7220 616e   nthCrossover an
+00012b10: 6420 696e 6465 7820 3e3d 3029 3a0a 2020  d index >=0):.  
+00012b20: 2020 2020 2020 2020 2020 6966 2064 6966            if dif
+00012b30: 665f 6466 5b22 6469 6666 225d 5b69 6e64  f_df["diff"][ind
+00012b40: 6578 2d31 5d20 3c20 303a 2023 2053 6967  ex-1] < 0: # Sig
+00012b50: 6e61 6c20 6c69 6e65 2068 6173 206e 6f74  nal line has not
+00012b60: 2063 726f 7373 6564 2079 6574 2061 6e64   crossed yet and
+00012b70: 2069 7320 6265 6c6f 7720 7468 6520 7a65   is below the ze
+00012b80: 726f 206c 696e 650a 2020 2020 2020 2020  ro line.        
+00012b90: 2020 2020 2020 2020 7768 696c 6528 2864          while((d
+00012ba0: 6966 665f 6466 5b22 6469 6666 225d 5b69  iff_df["diff"][i
+00012bb0: 6e64 6578 2d31 5d20 3c20 3020 616e 6420  ndex-1] < 0 and 
+00012bc0: 696e 6465 7820 3e3d 3029 293a 2023 2061  index >=0)): # a
+00012bd0: 6e64 2064 6966 665f 6466 2e69 6e64 6578  nd diff_df.index
+00012be0: 203c 3d20 6272 6f6b 6572 5371 724f 6666   <= brokerSqrOff
+00012bf0: 7469 6d65 293a 2023 206f 7220 6469 6666  time): # or diff
+00012c00: 5f64 665b 2272 7369 225d 5b69 6e64 6578  _df["rsi"][index
+00012c10: 2d31 5d20 3c3d 206d 696e 5253 4929 3a0a  -1] <= minRSI):.
 00012c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c30: 2020 2069 6e64 6578 202d 3d20 310a 2020     index -= 1.  
-00012c40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00012c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c60: 7768 696c 6528 2864 6966 665f 6466 5b22  while((diff_df["
-00012c70: 6469 6666 225d 5b69 6e64 6578 2d31 5d20  diff"][index-1] 
-00012c80: 3e3d 2030 2061 6e64 2069 6e64 6578 203e  >= 0 and index >
-00012c90: 3d30 2929 3a20 2320 616e 6420 6469 6666  =0)): # and diff
-00012ca0: 5f64 662e 696e 6465 7820 3c3d 2062 726f  _df.index <= bro
-00012cb0: 6b65 7253 7172 4f66 6674 696d 6529 3a20  kerSqrOfftime): 
-00012cc0: 2320 6f72 2064 6966 665f 6466 5b22 7273  # or diff_df["rs
-00012cd0: 6922 5d5b 696e 6465 782d 315d 203c 3d20  i"][index-1] <= 
-00012ce0: 6d69 6e52 5349 293a 0a20 2020 2020 2020  minRSI):.       
-00012cf0: 2020 2020 2020 2020 2020 2020 2023 204c               # L
-00012d00: 6f6f 7020 756e 7469 6c20 7369 676e 616c  oop until signal
-00012d10: 206c 696e 6520 6861 7320 6e6f 7420 6372   line has not cr
-00012d20: 6f73 7365 6420 7965 7420 616e 6420 6973  ossed yet and is
-00012d30: 2061 626f 7665 2074 6865 207a 6572 6f20   above the zero 
-00012d40: 6c69 6e65 0a20 2020 2020 2020 2020 2020  line.           
-00012d50: 2020 2020 2020 2020 2069 6e64 6578 202d           index -
-00012d60: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00012d70: 6372 6f73 734f 7665 7220 2b3d 2031 0a20  crossOver += 1. 
-00012d80: 2020 2020 2020 2074 7320 3d20 6469 6666         ts = diff
-00012d90: 5f64 662e 7461 696c 286c 656e 2864 6966  _df.tail(len(dif
-00012da0: 665f 6466 292d 696e 6465 7820 2b31 292e  f_df)-index +1).
-00012db0: 6865 6164 2831 292e 696e 6465 785b 2d31  head(1).index[-1
-00012dc0: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00012dd0: 2074 732c 2064 6174 615b 6461 7461 2e69   ts, data[data.i
-00012de0: 6e64 6578 203d 3d20 7473 5d20 2364 662e  ndex == ts] #df.
-00012df0: 6865 6164 286c 656e 2864 6629 202d 696e  head(len(df) -in
-00012e00: 6465 7820 2b31 292e 7461 696c 2831 290a  dex +1).tail(1).
-00012e10: 2020 2020 0a20 2020 2023 2046 696e 6420      .    # Find 
-00012e20: 7374 6f63 6b20 7368 6f77 696e 6720 5253  stock showing RS
-00012e30: 4920 6372 6f73 7369 6e67 2077 6974 6820  I crossing with 
-00012e40: 5253 4920 3920 534d 410a 2020 2020 6465  RSI 9 SMA.    de
-00012e50: 6620 6669 6e64 5253 4943 726f 7373 696e  f findRSICrossin
-00012e60: 674d 4128 7365 6c66 2c20 6466 2c20 7363  gMA(self, df, sc
-00012e70: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-00012e80: 6374 2c6c 6f6f 6b46 6f72 3d31 2c20 6d61  ct,lookFor=1, ma
-00012e90: 4c65 6e67 7468 3d39 2c20 7273 694b 6579  Length=9, rsiKey
-00012ea0: 3d22 5253 4922 293a 0a20 2020 2020 2020  ="RSI"):.       
-00012eb0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-00012ec0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-00012ed0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00012ee0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00012ef0: 2069 6620 7273 694b 6579 206e 6f74 2069   if rsiKey not i
-00012f00: 6e20 6466 2e63 6f6c 756d 6e73 3a0a 2020  n df.columns:.  
-00012f10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012f20: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-00012f30: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-00012f40: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00012f50: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
-00012f60: 2020 6d61 5273 6920 3d20 706b 7461 6c69    maRsi = pktali
-00012f70: 622e 4d41 2864 6174 615b 7273 694b 6579  b.MA(data[rsiKey
-00012f80: 5d2c 2074 696d 6570 6572 696f 643d 6d61  ], timeperiod=ma
-00012f90: 4c65 6e67 7468 290a 2020 2020 2020 2020  Length).        
-00012fa0: 6461 7461 203d 2064 6174 615b 3a3a 2d31  data = data[::-1
-00012fb0: 5d2e 6865 6164 2833 290a 2020 2020 2020  ].head(3).      
-00012fc0: 2020 6d61 5273 6920 3d20 6d61 5273 695b    maRsi = maRsi[
-00012fd0: 3a3a 2d31 5d2e 6865 6164 2833 290a 2020  ::-1].head(3).  
-00012fe0: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00012ff0: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00013000: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00013010: 6963 742c 7361 7665 4469 6374 2c22 5472  ict,saveDict,"Tr
-00013020: 656e 6422 290a 2020 2020 2020 2020 6966  end").        if
-00013030: 206c 6f6f 6b46 6f72 2069 6e20 5b31 2c33   lookFor in [1,3
-00013040: 5d20 616e 6420 6d61 5273 692e 696c 6f63  ] and maRsi.iloc
-00013050: 5b30 5d20 3c3d 2064 6174 615b 7273 694b  [0] <= data[rsiK
-00013060: 6579 5d2e 696c 6f63 5b30 5d20 616e 6420  ey].iloc[0] and 
-00013070: 6d61 5273 692e 696c 6f63 5b31 5d20 3e20  maRsi.iloc[1] > 
-00013080: 6461 7461 5b72 7369 4b65 795d 2e69 6c6f  data[rsiKey].ilo
-00013090: 635b 315d 3a0a 2020 2020 2020 2020 2020  c[1]:.          
-000130a0: 2020 7363 7265 656e 4469 6374 5b27 4d41    screenDict['MA
-000130b0: 2d53 6967 6e61 6c27 5d20 3d20 7361 7665  -Signal'] = save
-000130c0: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-000130d0: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-000130e0: 742e 4752 4545 4e20 2b20 6627 5253 492d  t.GREEN + f'RSI-
-000130f0: 4d41 2d42 7579 2720 2b20 636f 6c6f 7254  MA-Buy' + colorT
-00013100: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00013110: 2020 2020 7361 7665 4469 6374 5b27 4d41      saveDict['MA
-00013120: 2d53 6967 6e61 6c27 5d20 3d20 7361 7665  -Signal'] = save
-00013130: 645b 315d 202b 2066 2752 5349 2d4d 412d  d[1] + f'RSI-MA-
-00013140: 4275 7927 0a20 2020 2020 2020 2020 2020  Buy'.           
-00013150: 2072 6574 7572 6e20 5472 7565 2069 6620   return True if 
-00013160: 2872 7369 4b65 7920 3d3d 2022 5253 4969  (rsiKey == "RSIi
-00013170: 2229 2065 6c73 6520 2873 656c 662e 6669  ") else (self.fi
-00013180: 6e64 5253 4943 726f 7373 696e 674d 4128  ndRSICrossingMA(
-00013190: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
-000131a0: 7361 7665 4469 6374 2c6c 6f6f 6b46 6f72  saveDict,lookFor
-000131b0: 3d6c 6f6f 6b46 6f72 2c20 6d61 4c65 6e67  =lookFor, maLeng
-000131c0: 7468 3d6d 614c 656e 6774 682c 2072 7369  th=maLength, rsi
-000131d0: 4b65 793d 2252 5349 6922 2920 6f72 2054  Key="RSIi") or T
-000131e0: 7275 6529 0a20 2020 2020 2020 2065 6c69  rue).        eli
-000131f0: 6620 6c6f 6f6b 466f 7220 696e 205b 322c  f lookFor in [2,
-00013200: 335d 2061 6e64 206d 6152 7369 2e69 6c6f  3] and maRsi.ilo
-00013210: 635b 305d 203e 3d20 6461 7461 5b72 7369  c[0] >= data[rsi
-00013220: 4b65 795d 2e69 6c6f 635b 305d 2061 6e64  Key].iloc[0] and
-00013230: 206d 6152 7369 2e69 6c6f 635b 315d 203c   maRsi.iloc[1] <
-00013240: 2064 6174 615b 7273 694b 6579 5d2e 696c   data[rsiKey].il
-00013250: 6f63 5b31 5d3a 0a20 2020 2020 2020 2020  oc[1]:.         
-00013260: 2020 2073 6372 6565 6e44 6963 745b 274d     screenDict['M
-00013270: 412d 5369 676e 616c 275d 203d 2073 6176  A-Signal'] = sav
-00013280: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
-00013290: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
-000132a0: 7874 2e46 4149 4c20 2b20 6627 5253 492d  xt.FAIL + f'RSI-
-000132b0: 4d41 2d53 656c 6c27 202b 2063 6f6c 6f72  MA-Sell' + color
-000132c0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-000132d0: 2020 2020 2073 6176 6544 6963 745b 274d       saveDict['M
-000132e0: 412d 5369 676e 616c 275d 203d 2073 6176  A-Signal'] = sav
-000132f0: 6564 5b31 5d20 2b20 6627 5253 492d 4d41  ed[1] + f'RSI-MA
-00013300: 2d53 656c 6c27 0a20 2020 2020 2020 2020  -Sell'.         
-00013310: 2020 2072 6574 7572 6e20 5472 7565 2069     return True i
-00013320: 6620 2872 7369 4b65 7920 3d3d 2022 5253  f (rsiKey == "RS
-00013330: 4969 2229 2065 6c73 6520 2873 656c 662e  Ii") else (self.
-00013340: 6669 6e64 5253 4943 726f 7373 696e 674d  findRSICrossingM
-00013350: 4128 6466 2c20 7363 7265 656e 4469 6374  A(df, screenDict
-00013360: 2c20 7361 7665 4469 6374 2c6c 6f6f 6b46  , saveDict,lookF
-00013370: 6f72 3d6c 6f6f 6b46 6f72 2c20 6d61 4c65  or=lookFor, maLe
-00013380: 6e67 7468 3d6d 614c 656e 6774 682c 2072  ngth=maLength, r
-00013390: 7369 4b65 793d 2252 5349 6922 2920 6f72  siKey="RSIi") or
-000133a0: 2054 7275 6529 0a20 2020 2020 2020 2072   True).        r
-000133b0: 6574 7572 6e20 4661 6c73 6520 6966 2028  eturn False if (
-000133c0: 7273 694b 6579 203d 3d20 2252 5349 6922  rsiKey == "RSIi"
-000133d0: 2920 656c 7365 2028 7365 6c66 2e66 696e  ) else (self.fin
-000133e0: 6452 5349 4372 6f73 7369 6e67 4d41 2864  dRSICrossingMA(d
-000133f0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-00013400: 6176 6544 6963 742c 6c6f 6f6b 466f 723d  aveDict,lookFor=
-00013410: 6c6f 6f6b 466f 722c 206d 614c 656e 6774  lookFor, maLengt
-00013420: 683d 6d61 4c65 6e67 7468 2c20 7273 694b  h=maLength, rsiK
-00013430: 6579 3d22 5253 4969 2229 290a 2020 2020  ey="RSIi")).    
-00013440: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
-00013450: 6b73 2077 6974 6820 7269 7369 6e67 2052  ks with rising R
-00013460: 5349 2066 726f 6d20 6c6f 7765 7220 6c65  SI from lower le
-00013470: 7665 6c73 0a20 2020 2064 6566 2066 696e  vels.    def fin
-00013480: 6452 6973 696e 6752 5349 2873 656c 662c  dRisingRSI(self,
-00013490: 2064 662c 2072 7369 4b65 793d 2252 5349   df, rsiKey="RSI
-000134a0: 2229 3a0a 2020 2020 2020 2020 6966 2064  "):.        if d
-000134b0: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-000134c0: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-000134d0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000134e0: 6c73 650a 2020 2020 2020 2020 6966 2072  lse.        if r
-000134f0: 7369 4b65 7920 6e6f 7420 696e 2064 662e  siKey not in df.
-00013500: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
-00013510: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00013520: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-00013530: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-00013540: 2020 2064 6174 6120 3d20 6461 7461 5b3a     data = data[:
-00013550: 3a2d 315d 0a20 2020 2020 2020 2064 6174  :-1].        dat
-00013560: 6120 3d20 6461 7461 2e74 6169 6c28 3329  a = data.tail(3)
-00013570: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00013580: 6461 7461 2920 3c20 333a 0a20 2020 2020  data) < 3:.     
+00012c30: 2020 2020 2320 4c6f 6f70 2077 6869 6c65      # Loop while
+00012c40: 2053 6967 6e61 6c20 6c69 6e65 2068 6173   Signal line has
+00012c50: 206e 6f74 2063 726f 7373 6564 2079 6574   not crossed yet
+00012c60: 2061 6e64 2069 7320 6265 6c6f 7720 7468   and is below th
+00012c70: 6520 7a65 726f 206c 696e 6520 616e 6420  e zero line and 
+00012c80: 7765 2776 6520 6e6f 7420 7265 6163 6865  we've not reache
+00012c90: 6420 7468 6520 6c61 7374 2070 6f69 6e74  d the last point
+00012ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012cb0: 2020 2020 2069 6e64 6578 202d 3d20 310a       index -= 1.
+00012cc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00012cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012ce0: 2020 7768 696c 6528 2864 6966 665f 6466    while((diff_df
+00012cf0: 5b22 6469 6666 225d 5b69 6e64 6578 2d31  ["diff"][index-1
+00012d00: 5d20 3e3d 2030 2061 6e64 2069 6e64 6578  ] >= 0 and index
+00012d10: 203e 3d30 2929 3a20 2320 616e 6420 6469   >=0)): # and di
+00012d20: 6666 5f64 662e 696e 6465 7820 3c3d 2062  ff_df.index <= b
+00012d30: 726f 6b65 7253 7172 4f66 6674 696d 6529  rokerSqrOfftime)
+00012d40: 3a20 2320 6f72 2064 6966 665f 6466 5b22  : # or diff_df["
+00012d50: 7273 6922 5d5b 696e 6465 782d 315d 203c  rsi"][index-1] <
+00012d60: 3d20 6d69 6e52 5349 293a 0a20 2020 2020  = minRSI):.     
+00012d70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00012d80: 204c 6f6f 7020 756e 7469 6c20 7369 676e   Loop until sign
+00012d90: 616c 206c 696e 6520 6861 7320 6e6f 7420  al line has not 
+00012da0: 6372 6f73 7365 6420 7965 7420 616e 6420  crossed yet and 
+00012db0: 6973 2061 626f 7665 2074 6865 207a 6572  is above the zer
+00012dc0: 6f20 6c69 6e65 0a20 2020 2020 2020 2020  o line.         
+00012dd0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00012de0: 202d 3d20 310a 2020 2020 2020 2020 2020   -= 1.          
+00012df0: 2020 6372 6f73 734f 7665 7220 2b3d 2031    crossOver += 1
+00012e00: 0a20 2020 2020 2020 2074 7320 3d20 6469  .        ts = di
+00012e10: 6666 5f64 662e 7461 696c 286c 656e 2864  ff_df.tail(len(d
+00012e20: 6966 665f 6466 292d 696e 6465 7820 2b31  iff_df)-index +1
+00012e30: 292e 6865 6164 2831 292e 696e 6465 785b  ).head(1).index[
+00012e40: 2d31 5d0a 2020 2020 2020 2020 7265 7475  -1].        retu
+00012e50: 726e 2074 732c 2064 6174 615b 6461 7461  rn ts, data[data
+00012e60: 2e69 6e64 6578 203d 3d20 7473 5d20 2364  .index == ts] #d
+00012e70: 662e 6865 6164 286c 656e 2864 6629 202d  f.head(len(df) -
+00012e80: 696e 6465 7820 2b31 292e 7461 696c 2831  index +1).tail(1
+00012e90: 290a 2020 2020 0a20 2020 2023 2046 696e  ).    .    # Fin
+00012ea0: 6420 7374 6f63 6b20 7368 6f77 696e 6720  d stock showing 
+00012eb0: 5253 4920 6372 6f73 7369 6e67 2077 6974  RSI crossing wit
+00012ec0: 6820 5253 4920 3920 534d 410a 2020 2020  h RSI 9 SMA.    
+00012ed0: 6465 6620 6669 6e64 5253 4943 726f 7373  def findRSICross
+00012ee0: 696e 674d 4128 7365 6c66 2c20 6466 2c20  ingMA(self, df, 
+00012ef0: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+00012f00: 4469 6374 2c6c 6f6f 6b46 6f72 3d31 2c20  Dict,lookFor=1, 
+00012f10: 6d61 4c65 6e67 7468 3d39 2c20 7273 694b  maLength=9, rsiK
+00012f20: 6579 3d22 5253 4922 293a 0a20 2020 2020  ey="RSI"):.     
+00012f30: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+00012f40: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+00012f50: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012f60: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00012f70: 2020 2069 6620 7273 694b 6579 206e 6f74     if rsiKey not
+00012f80: 2069 6e20 6466 2e63 6f6c 756d 6e73 3a0a   in df.columns:.
+00012f90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012fa0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00012fb0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00012fc0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+00012fd0: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
+00012fe0: 2020 2020 6d61 5273 6920 3d20 706b 7461      maRsi = pkta
+00012ff0: 6c69 622e 4d41 2864 6174 615b 7273 694b  lib.MA(data[rsiK
+00013000: 6579 5d2c 2074 696d 6570 6572 696f 643d  ey], timeperiod=
+00013010: 6d61 4c65 6e67 7468 290a 2020 2020 2020  maLength).      
+00013020: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
+00013030: 2d31 5d2e 6865 6164 2833 290a 2020 2020  -1].head(3).    
+00013040: 2020 2020 6d61 5273 6920 3d20 6d61 5273      maRsi = maRs
+00013050: 695b 3a3a 2d31 5d2e 6865 6164 2833 290a  i[::-1].head(3).
+00013060: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
+00013070: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
+00013080: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
+00013090: 6e44 6963 742c 7361 7665 4469 6374 2c22  nDict,saveDict,"
+000130a0: 5472 656e 6422 290a 2020 2020 2020 2020  Trend").        
+000130b0: 6966 206c 6f6f 6b46 6f72 2069 6e20 5b31  if lookFor in [1
+000130c0: 2c33 5d20 616e 6420 6d61 5273 692e 696c  ,3] and maRsi.il
+000130d0: 6f63 5b30 5d20 3c3d 2064 6174 615b 7273  oc[0] <= data[rs
+000130e0: 694b 6579 5d2e 696c 6f63 5b30 5d20 616e  iKey].iloc[0] an
+000130f0: 6420 6d61 5273 692e 696c 6f63 5b31 5d20  d maRsi.iloc[1] 
+00013100: 3e20 6461 7461 5b72 7369 4b65 795d 2e69  > data[rsiKey].i
+00013110: 6c6f 635b 315d 3a0a 2020 2020 2020 2020  loc[1]:.        
+00013120: 2020 2020 7363 7265 656e 4469 6374 5b27      screenDict['
+00013130: 4d41 2d53 6967 6e61 6c27 5d20 3d20 7361  MA-Signal'] = sa
+00013140: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+00013150: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+00013160: 6578 742e 4752 4545 4e20 2b20 6627 5253  ext.GREEN + f'RS
+00013170: 492d 4d41 2d42 7579 2720 2b20 636f 6c6f  I-MA-Buy' + colo
+00013180: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00013190: 2020 2020 2020 7361 7665 4469 6374 5b27        saveDict['
+000131a0: 4d41 2d53 6967 6e61 6c27 5d20 3d20 7361  MA-Signal'] = sa
+000131b0: 7665 645b 315d 202b 2066 2752 5349 2d4d  ved[1] + f'RSI-M
+000131c0: 412d 4275 7927 0a20 2020 2020 2020 2020  A-Buy'.         
+000131d0: 2020 2072 6574 7572 6e20 5472 7565 2069     return True i
+000131e0: 6620 2872 7369 4b65 7920 3d3d 2022 5253  f (rsiKey == "RS
+000131f0: 4969 2229 2065 6c73 6520 2873 656c 662e  Ii") else (self.
+00013200: 6669 6e64 5253 4943 726f 7373 696e 674d  findRSICrossingM
+00013210: 4128 6466 2c20 7363 7265 656e 4469 6374  A(df, screenDict
+00013220: 2c20 7361 7665 4469 6374 2c6c 6f6f 6b46  , saveDict,lookF
+00013230: 6f72 3d6c 6f6f 6b46 6f72 2c20 6d61 4c65  or=lookFor, maLe
+00013240: 6e67 7468 3d6d 614c 656e 6774 682c 2072  ngth=maLength, r
+00013250: 7369 4b65 793d 2252 5349 6922 2920 6f72  siKey="RSIi") or
+00013260: 2054 7275 6529 0a20 2020 2020 2020 2065   True).        e
+00013270: 6c69 6620 6c6f 6f6b 466f 7220 696e 205b  lif lookFor in [
+00013280: 322c 335d 2061 6e64 206d 6152 7369 2e69  2,3] and maRsi.i
+00013290: 6c6f 635b 305d 203e 3d20 6461 7461 5b72  loc[0] >= data[r
+000132a0: 7369 4b65 795d 2e69 6c6f 635b 305d 2061  siKey].iloc[0] a
+000132b0: 6e64 206d 6152 7369 2e69 6c6f 635b 315d  nd maRsi.iloc[1]
+000132c0: 203c 2064 6174 615b 7273 694b 6579 5d2e   < data[rsiKey].
+000132d0: 696c 6f63 5b31 5d3a 0a20 2020 2020 2020  iloc[1]:.       
+000132e0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+000132f0: 274d 412d 5369 676e 616c 275d 203d 2073  'MA-Signal'] = s
+00013300: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
+00013310: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
+00013320: 5465 7874 2e46 4149 4c20 2b20 6627 5253  Text.FAIL + f'RS
+00013330: 492d 4d41 2d53 656c 6c27 202b 2063 6f6c  I-MA-Sell' + col
+00013340: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00013350: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00013360: 274d 412d 5369 676e 616c 275d 203d 2073  'MA-Signal'] = s
+00013370: 6176 6564 5b31 5d20 2b20 6627 5253 492d  aved[1] + f'RSI-
+00013380: 4d41 2d53 656c 6c27 0a20 2020 2020 2020  MA-Sell'.       
+00013390: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+000133a0: 2069 6620 2872 7369 4b65 7920 3d3d 2022   if (rsiKey == "
+000133b0: 5253 4969 2229 2065 6c73 6520 2873 656c  RSIi") else (sel
+000133c0: 662e 6669 6e64 5253 4943 726f 7373 696e  f.findRSICrossin
+000133d0: 674d 4128 6466 2c20 7363 7265 656e 4469  gMA(df, screenDi
+000133e0: 6374 2c20 7361 7665 4469 6374 2c6c 6f6f  ct, saveDict,loo
+000133f0: 6b46 6f72 3d6c 6f6f 6b46 6f72 2c20 6d61  kFor=lookFor, ma
+00013400: 4c65 6e67 7468 3d6d 614c 656e 6774 682c  Length=maLength,
+00013410: 2072 7369 4b65 793d 2252 5349 6922 2920   rsiKey="RSIi") 
+00013420: 6f72 2054 7275 6529 0a20 2020 2020 2020  or True).       
+00013430: 2072 6574 7572 6e20 4661 6c73 6520 6966   return False if
+00013440: 2028 7273 694b 6579 203d 3d20 2252 5349   (rsiKey == "RSI
+00013450: 6922 2920 656c 7365 2028 7365 6c66 2e66  i") else (self.f
+00013460: 696e 6452 5349 4372 6f73 7369 6e67 4d41  indRSICrossingMA
+00013470: 2864 662c 2073 6372 6565 6e44 6963 742c  (df, screenDict,
+00013480: 2073 6176 6544 6963 742c 6c6f 6f6b 466f   saveDict,lookFo
+00013490: 723d 6c6f 6f6b 466f 722c 206d 614c 656e  r=lookFor, maLen
+000134a0: 6774 683d 6d61 4c65 6e67 7468 2c20 7273  gth=maLength, rs
+000134b0: 694b 6579 3d22 5253 4969 2229 290a 2020  iKey="RSIi")).  
+000134c0: 2020 0a20 2020 2023 2046 696e 6420 7374    .    # Find st
+000134d0: 6f63 6b73 2077 6974 6820 7269 7369 6e67  ocks with rising
+000134e0: 2052 5349 2066 726f 6d20 6c6f 7765 7220   RSI from lower 
+000134f0: 6c65 7665 6c73 0a20 2020 2064 6566 2066  levels.    def f
+00013500: 696e 6452 6973 696e 6752 5349 2873 656c  indRisingRSI(sel
+00013510: 662c 2064 662c 2072 7369 4b65 793d 2252  f, df, rsiKey="R
+00013520: 5349 2229 3a0a 2020 2020 2020 2020 6966  SI"):.        if
+00013530: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+00013540: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+00013550: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013560: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00013570: 2072 7369 4b65 7920 6e6f 7420 696e 2064   rsiKey not in d
+00013580: 662e 636f 6c75 6d6e 733a 0a20 2020 2020  f.columns:.     
 00013590: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000135a0: 6c73 650a 2020 2020 2020 2020 6461 794d  lse.        dayM
-000135b0: 696e 7573 3252 5349 203d 2064 6174 615b  inus2RSI = data[
-000135c0: 2252 5349 225d 2e69 6c6f 635b 305d 0a20  "RSI"].iloc[0]. 
-000135d0: 2020 2020 2020 2064 6179 4d69 6e75 7331         dayMinus1
-000135e0: 5253 4920 3d20 6461 7461 5b22 5253 4922  RSI = data["RSI"
-000135f0: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
-00013600: 2020 6461 7952 5349 203d 2064 6174 615b    dayRSI = data[
-00013610: 2252 5349 225d 2e69 6c6f 635b 325d 0a20  "RSI"].iloc[2]. 
-00013620: 2020 2020 2020 2072 6574 7572 6e56 616c         returnVal
-00013630: 7565 203d 2028 6461 794d 696e 7573 3252  ue = (dayMinus2R
-00013640: 5349 203c 3d20 3335 2061 6e64 2064 6179  SI <= 35 and day
-00013650: 4d69 6e75 7331 5253 4920 3e20 6461 794d  Minus1RSI > dayM
-00013660: 696e 7573 3252 5349 2061 6e64 2064 6179  inus2RSI and day
-00013670: 5253 4920 3e20 6461 794d 696e 7573 3152  RSI > dayMinus1R
-00013680: 5349 2920 6f72 205c 0a20 2020 2020 2020  SI) or \.       
-00013690: 2020 2020 2020 2020 2028 6461 794d 696e           (dayMin
-000136a0: 7573 3152 5349 203c 3d20 3335 2061 6e64  us1RSI <= 35 and
-000136b0: 2064 6179 5253 4920 3e20 6461 794d 696e   dayRSI > dayMin
-000136c0: 7573 3152 5349 290a 2020 2020 2020 2020  us1RSI).        
-000136d0: 6966 2072 7369 4b65 7920 3d3d 2022 5253  if rsiKey == "RS
-000136e0: 4922 3a0a 2020 2020 2020 2020 2020 2020  I":.            
-000136f0: 7265 7475 726e 5661 6c75 6520 3d20 7365  returnValue = se
-00013700: 6c66 2e66 696e 6452 6973 696e 6752 5349  lf.findRisingRSI
-00013710: 2864 662c 2072 7369 4b65 793d 2252 5349  (df, rsiKey="RSI
-00013720: 6922 2920 6f72 2072 6574 7572 6e56 616c  i") or returnVal
-00013730: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
-00013740: 6e20 7265 7475 726e 5661 6c75 650a 0a20  n returnValue.. 
-00013750: 2020 2023 406d 6561 7375 7265 5f74 696d     #@measure_tim
-00013760: 650a 2020 2020 2320 4669 6e64 206f 7574  e.    # Find out
-00013770: 2074 7265 6e64 2066 6f72 2064 6179 7320   trend for days 
-00013780: 746f 206c 6f6f 6b62 6163 6b0a 2020 2020  to lookback.    
-00013790: 6465 6620 6669 6e64 5472 656e 6428 7365  def findTrend(se
-000137a0: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-000137b0: 6374 2c20 7361 7665 4469 6374 2c20 6461  ct, saveDict, da
-000137c0: 7973 546f 4c6f 6f6b 6261 636b 3d4e 6f6e  ysToLookback=Non
-000137d0: 652c 2073 746f 636b 4e61 6d65 3d22 2229  e, stockName="")
-000137e0: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
-000137f0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-00013800: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
-00013810: 2020 2020 2072 6574 7572 6e20 2255 6e6b       return "Unk
-00013820: 6e6f 776e 220a 2020 2020 2020 2020 6461  nown".        da
-00013830: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-00013840: 2020 2020 2020 2069 6620 6461 7973 546f         if daysTo
-00013850: 4c6f 6f6b 6261 636b 2069 7320 4e6f 6e65  Lookback is None
-00013860: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-00013870: 7973 546f 4c6f 6f6b 6261 636b 203d 2073  ysToLookback = s
-00013880: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
-00013890: 722e 6461 7973 546f 4c6f 6f6b 6261 636b  r.daysToLookback
-000138a0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-000138b0: 6461 7461 2e68 6561 6428 6461 7973 546f  data.head(daysTo
-000138c0: 4c6f 6f6b 6261 636b 290a 2020 2020 2020  Lookback).      
-000138d0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
-000138e0: 2d31 5d0a 2020 2020 2020 2020 6461 7461  -1].        data
-000138f0: 203d 2064 6174 612e 7365 745f 696e 6465   = data.set_inde
-00013900: 7828 6e70 2e61 7261 6e67 6528 6c65 6e28  x(np.arange(len(
-00013910: 6461 7461 2929 290a 2020 2020 2020 2020  data))).        
-00013920: 6461 7461 203d 2064 6174 612e 6669 6c6c  data = data.fill
-00013930: 6e61 2830 290a 2020 2020 2020 2020 6461  na(0).        da
-00013940: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
-00013950: 6528 5b6e 702e 696e 662c 202d 6e70 2e69  e([np.inf, -np.i
-00013960: 6e66 5d2c 2030 290a 2020 2020 2020 2020  nf], 0).        
-00013970: 7361 7665 6420 3d20 7365 6c66 2e66 696e  saved = self.fin
-00013980: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
-00013990: 7565 2873 6372 6565 6e44 6963 742c 7361  ue(screenDict,sa
-000139a0: 7665 4469 6374 2c22 5472 656e 6422 290a  veDict,"Trend").
-000139b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000139c0: 2020 2020 2020 2020 2077 6974 6820 5375           with Su
-000139d0: 7070 7265 7373 4f75 7470 7574 2873 7570  ppressOutput(sup
-000139e0: 7072 6573 735f 7374 646f 7574 3d54 7275  press_stdout=Tru
-000139f0: 652c 2073 7570 7072 6573 735f 7374 6465  e, suppress_stde
-00013a00: 7272 3d54 7275 6529 3a0a 2020 2020 2020  rr=True):.      
-00013a10: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-00013a20: 746f 7073 225d 203d 2064 6174 615b 2243  tops"] = data["C
-00013a30: 6c6f 7365 225d 2e69 6c6f 635b 0a20 2020  lose"].iloc[.   
-00013a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a50: 206c 6973 7428 0a20 2020 2020 2020 2020   list(.         
-00013a60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00013a70: 6b74 616c 6962 2e61 7267 7265 6c65 7874  ktalib.argrelext
-00013a80: 7265 6d61 280a 2020 2020 2020 2020 2020  rema(.          
-00013a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013aa0: 2020 6e70 2e61 7272 6179 2864 6174 615b    np.array(data[
-00013ab0: 2243 6c6f 7365 225d 292c 206e 702e 6772  "Close"]), np.gr
-00013ac0: 6561 7465 725f 6571 7561 6c2c 206f 7264  eater_equal, ord
-00013ad0: 6572 3d31 0a20 2020 2020 2020 2020 2020  er=1.           
-00013ae0: 2020 2020 2020 2020 2020 2020 2029 5b30               )[0
-00013af0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00013b00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00013b10: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00013b20: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00013b30: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
-00013b40: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00013b50: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-00013b60: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-00013b70: 290a 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00013b80: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00013b90: 2020 2020 2320 6966 206c 656e 2864 6174      # if len(dat
-00013ba0: 6129 203c 2064 6179 7354 6f4c 6f6f 6b62  a) < daysToLookb
-00013bb0: 6163 6b3a 0a20 2020 2020 2020 2020 2020  ack:.           
-00013bc0: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
-00013bd0: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
-00013be0: 6562 7567 2864 6174 6129 0a20 2020 2020  ebug(data).     
-00013bf0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00013c00: 2072 6169 7365 2053 746f 636b 4461 7461   raise StockData
-00013c10: 4e6f 7441 6465 7175 6174 650a 2020 2020  NotAdequate.    
-00013c20: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00013c30: 203d 2064 6174 612e 7265 706c 6163 6528   = data.replace(
-00013c40: 6e70 2e69 6e66 2c20 6e70 2e6e 616e 292e  np.inf, np.nan).
-00013c50: 7265 706c 6163 6528 2d6e 702e 696e 662c  replace(-np.inf,
-00013c60: 206e 702e 6e61 6e29 2e64 726f 706e 6128   np.nan).dropna(
-00013c70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013c80: 2020 6966 206c 656e 2864 6174 615b 2274    if len(data["t
-00013c90: 6f70 7322 5d5b 6461 7461 2e74 6f70 7320  ops"][data.tops 
-00013ca0: 3e20 305d 2920 3e20 313a 0a20 2020 2020  > 0]) > 1:.     
-00013cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013cc0: 6c6f 7065 203d 206e 702e 706f 6c79 6669  lope = np.polyfi
-00013cd0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00013ce0: 2020 2020 2020 2020 2020 2064 6174 612e             data.
-00013cf0: 696e 6465 785b 6461 7461 2e74 6f70 7320  index[data.tops 
-00013d00: 3e20 305d 2c20 6461 7461 5b22 746f 7073  > 0], data["tops
-00013d10: 225d 5b64 6174 612e 746f 7073 203e 2030  "][data.tops > 0
-00013d20: 5d2c 2031 0a20 2020 2020 2020 2020 2020  ], 1.           
-00013d30: 2020 2020 2020 2020 2029 5b30 5d0a 2020           )[0].  
-00013d40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00013d50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00013d60: 2020 2020 2020 2020 736c 6f70 6520 3d20          slope = 
-00013d70: 300a 2020 2020 2020 2020 2020 2020 6578  0.            ex
-00013d80: 6365 7074 206e 702e 6c69 6e61 6c67 2e4c  cept np.linalg.L
-00013d90: 696e 416c 6745 7272 6f72 2061 7320 653a  inAlgError as e:
-00013da0: 2023 2070 7261 676d 613a 206e 6f20 636f   # pragma: no co
-00013db0: 7665 720a 2020 2020 2020 2020 2020 2020  ver.            
-00013dc0: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
-00013dd0: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
-00013de0: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
-00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e00: 7363 7265 656e 4469 6374 5b22 5472 656e  screenDict["Tren
-00013e10: 6422 5d20 3d20 280a 2020 2020 2020 2020  d"] = (.        
-00013e20: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00013e30: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00013e40: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-00013e50: 742e 5741 524e 202b 2022 556e 6b6e 6f77  t.WARN + "Unknow
-00013e60: 6e22 202b 2063 6f6c 6f72 5465 7874 2e45  n" + colorText.E
-00013e70: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-00013e80: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00013e90: 2020 2020 2073 6176 6544 6963 745b 2254       saveDict["T
-00013ea0: 7265 6e64 225d 203d 2073 6176 6564 5b31  rend"] = saved[1
-00013eb0: 5d20 2b20 2255 6e6b 6e6f 776e 220a 2020  ] + "Unknown".  
-00013ec0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013ed0: 7475 726e 2073 6176 6544 6963 745b 2254  turn saveDict["T
-00013ee0: 7265 6e64 225d 0a20 2020 2020 2020 2020  rend"].         
-00013ef0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00013f00: 696f 6e20 6173 2065 3a20 2023 2070 7261  ion as e:  # pra
-00013f10: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
-00013f20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013f30: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
-00013f40: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
-00013f50: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
-00013f60: 2020 2020 2020 2020 2020 736c 6f70 652c            slope,
-00013f70: 205f 203d 2030 2c20 300a 2020 2020 2020   _ = 0, 0.      
-00013f80: 2020 2020 2020 616e 676c 6520 3d20 6e70        angle = np
-00013f90: 2e72 6164 3264 6567 286e 702e 6172 6374  .rad2deg(np.arct
-00013fa0: 616e 2873 6c6f 7065 2929 0a20 2020 2020  an(slope)).     
-00013fb0: 2020 2020 2020 2069 6620 616e 676c 6520         if angle 
-00013fc0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00013fd0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00013fe0: 5b22 5472 656e 6422 5d20 3d20 280a 2020  ["Trend"] = (.  
-00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014000: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00014010: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00014020: 6c6f 7254 6578 742e 5741 524e 202b 2022  lorText.WARN + "
-00014030: 556e 6b6e 6f77 6e22 202b 2063 6f6c 6f72  Unknown" + color
-00014040: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00014050: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00014060: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00014070: 6963 745b 2254 7265 6e64 225d 203d 2073  ict["Trend"] = s
-00014080: 6176 6564 5b31 5d20 2b20 2255 6e6b 6e6f  aved[1] + "Unkno
-00014090: 776e 220a 2020 2020 2020 2020 2020 2020  wn".            
-000140a0: 656c 6966 2061 6e67 6c65 203c 3d20 3330  elif angle <= 30
-000140b0: 2061 6e64 2061 6e67 6c65 203e 3d20 2d33   and angle >= -3
-000140c0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-000140d0: 2020 2073 6372 6565 6e44 6963 745b 2254     screenDict["T
-000140e0: 7265 6e64 225d 203d 2028 0a20 2020 2020  rend"] = (.     
-000140f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014100: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00014110: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00014120: 5465 7874 2e57 4152 4e20 2b20 2253 6964  Text.WARN + "Sid
-00014130: 6577 6179 7322 202b 2063 6f6c 6f72 5465  eways" + colorTe
-00014140: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00014150: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00014160: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-00014170: 745b 2254 7265 6e64 225d 203d 2073 6176  t["Trend"] = sav
-00014180: 6564 5b31 5d20 2b20 2253 6964 6577 6179  ed[1] + "Sideway
-00014190: 7322 0a20 2020 2020 2020 2020 2020 2065  s".            e
-000141a0: 6c69 6620 616e 676c 6520 3e3d 2033 3020  lif angle >= 30 
-000141b0: 616e 6420 616e 676c 6520 3c20 3631 3a0a  and angle < 61:.
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141d0: 7363 7265 656e 4469 6374 5b22 5472 656e  screenDict["Tren
-000141e0: 6422 5d20 3d20 280a 2020 2020 2020 2020  d"] = (.        
-000141f0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00014200: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00014210: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-00014220: 742e 4752 4545 4e20 2b20 2257 6561 6b20  t.GREEN + "Weak 
-00014230: 5570 2220 2b20 636f 6c6f 7254 6578 742e  Up" + colorText.
-00014240: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00014250: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00014260: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00014270: 5472 656e 6422 5d20 3d20 7361 7665 645b  Trend"] = saved[
-00014280: 315d 202b 2022 5765 616b 2055 7022 0a20  1] + "Weak Up". 
-00014290: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000142a0: 616e 676c 6520 3e3d 2036 303a 0a20 2020  angle >= 60:.   
-000142b0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-000142c0: 6565 6e44 6963 745b 2254 7265 6e64 225d  eenDict["Trend"]
-000142d0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-000142e0: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
-000142f0: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
-00014300: 4c44 202b 2063 6f6c 6f72 5465 7874 2e47  LD + colorText.G
-00014310: 5245 454e 202b 2022 5374 726f 6e67 2055  REEN + "Strong U
-00014320: 7022 202b 2063 6f6c 6f72 5465 7874 2e45  p" + colorText.E
-00014330: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-00014340: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00014350: 2020 2020 2073 6176 6544 6963 745b 2254       saveDict["T
-00014360: 7265 6e64 225d 203d 2073 6176 6564 5b31  rend"] = saved[1
-00014370: 5d20 2b20 2253 7472 6f6e 6720 5570 220a  ] + "Strong Up".
-00014380: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00014390: 2061 6e67 6c65 203c 3d20 2d33 3020 616e   angle <= -30 an
-000143a0: 6420 616e 676c 6520 3e20 2d36 313a 0a20  d angle > -61:. 
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000143c0: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
-000143d0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-000143e0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-000143f0: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00014400: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-00014410: 2e46 4149 4c20 2b20 2257 6561 6b20 446f  .FAIL + "Weak Do
-00014420: 776e 2220 2b20 636f 6c6f 7254 6578 742e  wn" + colorText.
-00014430: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00014440: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00014450: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00014460: 5472 656e 6422 5d20 3d20 7361 7665 645b  Trend"] = saved[
-00014470: 315d 202b 2022 5765 616b 2044 6f77 6e22  1] + "Weak Down"
-00014480: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00014490: 6620 616e 676c 6520 3c20 2d36 303a 0a20  f angle < -60:. 
-000144a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000144b0: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
-000144c0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-000144d0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-000144e0: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-000144f0: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-00014500: 2e46 4149 4c20 2b20 2253 7472 6f6e 6720  .FAIL + "Strong 
-00014510: 446f 776e 2220 2b20 636f 6c6f 7254 6578  Down" + colorTex
-00014520: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
-00014530: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00014540: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
-00014550: 5b22 5472 656e 6422 5d20 3d20 7361 7665  ["Trend"] = save
-00014560: 645b 315d 202b 2022 5374 726f 6e67 2044  d[1] + "Strong D
-00014570: 6f77 6e22 0a20 2020 2020 2020 2065 7863  own".        exc
-00014580: 6570 7420 6e70 2e6c 696e 616c 672e 4c69  ept np.linalg.Li
-00014590: 6e41 6c67 4572 726f 7220 6173 2065 3a20  nAlgError as e: 
-000145a0: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
-000145b0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-000145c0: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-000145d0: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
-000145e0: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
-000145f0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-00014600: 745b 2254 7265 6e64 225d 203d 2028 0a20  t["Trend"] = (. 
-00014610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014620: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00014630: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00014640: 5465 7874 2e57 4152 4e20 2b20 2255 6e6b  Text.WARN + "Unk
-00014650: 6e6f 776e 2220 2b20 636f 6c6f 7254 6578  nown" + colorTex
-00014660: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
-00014670: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00014680: 7361 7665 4469 6374 5b22 5472 656e 6422  saveDict["Trend"
-00014690: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
-000146a0: 556e 6b6e 6f77 6e22 0a20 2020 2020 2020  Unknown".       
-000146b0: 2072 6574 7572 6e20 7361 7665 4469 6374   return saveDict
-000146c0: 5b22 5472 656e 6422 5d0a 0a20 2020 2023  ["Trend"]..    #
-000146d0: 2046 696e 6420 7374 6f63 6b73 2061 7070   Find stocks app
-000146e0: 726f 6368 696e 6720 746f 206c 6f6e 6720  roching to long 
-000146f0: 7465 726d 2074 7265 6e64 6c69 6e65 730a  term trendlines.
-00014700: 2020 2020 6465 6620 6669 6e64 5472 656e      def findTren
-00014710: 646c 696e 6573 2873 656c 662c 2064 662c  dlines(self, df,
-00014720: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-00014730: 6544 6963 742c 2070 6572 6365 6e74 6167  eDict, percentag
-00014740: 653d 302e 3035 293a 0a20 2020 2020 2020  e=0.05):.       
-00014750: 2023 2070 6572 696f 6420 3d20 696e 7428   # period = int(
-00014760: 2222 2e6a 6f69 6e28 6320 666f 7220 6320  "".join(c for c 
-00014770: 696e 2073 656c 662e 636f 6e66 6967 4d61  in self.configMa
-00014780: 6e61 6765 722e 7065 7269 6f64 2069 6620  nager.period if 
-00014790: 632e 6973 6469 6769 7428 2929 290a 2020  c.isdigit())).  
-000147a0: 2020 2020 2020 2320 6966 206c 656e 2864        # if len(d
-000147b0: 6174 6129 203c 2070 6572 696f 643a 0a20  ata) < period:. 
-000147c0: 2020 2020 2020 2023 2020 2020 2072 6574         #     ret
-000147d0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-000147e0: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-000147f0: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-00014800: 3d20 6461 7461 5b3a 3a2d 315d 0a20 2020  = data[::-1].   
-00014810: 2020 2020 2064 6174 615b 224e 756d 6265       data["Numbe
-00014820: 7222 5d20 3d20 6e70 2e61 7261 6e67 6528  r"] = np.arange(
-00014830: 6c65 6e28 6461 7461 2929 202b 2031 0a20  len(data)) + 1. 
-00014840: 2020 2020 2020 2064 6174 615f 6c6f 7720         data_low 
-00014850: 3d20 6461 7461 2e63 6f70 7928 290a 2020  = data.copy().  
-00014860: 2020 2020 2020 706f 696e 7473 203d 2033        points = 3
-00014870: 300a 0a20 2020 2020 2020 2022 2222 2049  0..        """ I
-00014880: 676e 6f72 696e 6720 7468 6520 5265 7369  gnoring the Resi
-00014890: 7461 6e63 6520 666f 7220 6c6f 6e67 2d74  tance for long-t
-000148a0: 6572 6d20 7075 7270 6f73 650a 2020 2020  erm purpose.    
-000148b0: 2020 2020 7768 696c 6520 6c65 6e28 6461      while len(da
-000148c0: 7461 5f68 6967 6829 203e 2070 6f69 6e74  ta_high) > point
-000148d0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-000148e0: 6c6f 7065 2c20 696e 7465 7263 6570 742c  lope, intercept,
-000148f0: 2072 5f76 616c 7565 2c20 705f 7661 6c75   r_value, p_valu
-00014900: 652c 2073 7464 5f65 7272 203d 206c 696e  e, std_err = lin
-00014910: 7265 6772 6573 7328 783d 6461 7461 5f68  regress(x=data_h
-00014920: 6967 685b 274e 756d 6265 7227 5d2c 2079  igh['Number'], y
-00014930: 3d64 6174 615f 6869 6768 5b27 4869 6768  =data_high['High
-00014940: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00014950: 6461 7461 5f68 6967 6820 3d20 6461 7461  data_high = data
-00014960: 5f68 6967 682e 6c6f 635b 6461 7461 5f68  _high.loc[data_h
-00014970: 6967 685b 2748 6967 6827 5d20 3e20 736c  igh['High'] > sl
-00014980: 6f70 6520 2a20 6461 7461 5f68 6967 685b  ope * data_high[
-00014990: 274e 756d 6265 7227 5d20 2b20 696e 7465  'Number'] + inte
-000149a0: 7263 6570 745d 0a20 2020 2020 2020 2073  rcept].        s
-000149b0: 6c6f 7065 2c20 696e 7465 7263 6570 742c  lope, intercept,
-000149c0: 2072 5f76 616c 7565 2c20 705f 7661 6c75   r_value, p_valu
-000149d0: 652c 2073 7464 5f65 7272 203d 206c 696e  e, std_err = lin
-000149e0: 7265 6772 6573 7328 783d 6461 7461 5f68  regress(x=data_h
-000149f0: 6967 685b 274e 756d 6265 7227 5d2c 2079  igh['Number'], y
-00014a00: 3d64 6174 615f 6869 6768 5b27 436c 6f73  =data_high['Clos
-00014a10: 6527 5d29 0a20 2020 2020 2020 2064 6174  e']).        dat
-00014a20: 615b 2752 6573 6973 7461 6e63 6527 5d20  a['Resistance'] 
-00014a30: 3d20 736c 6f70 6520 2a20 6461 7461 5b27  = slope * data['
-00014a40: 4e75 6d62 6572 275d 202b 2069 6e74 6572  Number'] + inter
-00014a50: 6365 7074 0a20 2020 2020 2020 2022 2222  cept.        """
-00014a60: 0a0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
-00014a70: 6c65 6e28 6461 7461 5f6c 6f77 2920 3e20  len(data_low) > 
-00014a80: 706f 696e 7473 3a0a 2020 2020 2020 2020  points:.        
-00014a90: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00014aa0: 2020 2020 2020 2020 2073 6c6f 7065 2c20           slope, 
-00014ab0: 696e 7465 7263 6570 742c 2072 5f76 616c  intercept, r_val
-00014ac0: 7565 2c20 705f 7661 6c75 652c 2073 7464  ue, p_value, std
-00014ad0: 5f65 7272 203d 206c 696e 7265 6772 6573  _err = linregres
-00014ae0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00014af0: 2020 2020 2020 2078 3d64 6174 615f 6c6f         x=data_lo
-00014b00: 775b 224e 756d 6265 7222 5d2c 2079 3d64  w["Number"], y=d
-00014b10: 6174 615f 6c6f 775b 224c 6f77 225d 0a20  ata_low["Low"]. 
-00014b20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00014b30: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00014b40: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-00014b50: 2065 3a20 2023 2070 7261 676d 613a 206e   e:  # pragma: n
-00014b60: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-00014b70: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
-00014b80: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
-00014b90: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
-00014ba0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00014bb0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00014bc0: 2020 2020 2020 2020 2064 6174 615f 6c6f           data_lo
-00014bd0: 7720 3d20 6461 7461 5f6c 6f77 2e6c 6f63  w = data_low.loc
-00014be0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00014bf0: 2020 6461 7461 5f6c 6f77 5b22 4c6f 7722    data_low["Low"
-00014c00: 5d20 3c20 736c 6f70 6520 2a20 6461 7461  ] < slope * data
-00014c10: 5f6c 6f77 5b22 4e75 6d62 6572 225d 202b  _low["Number"] +
-00014c20: 2069 6e74 6572 6365 7074 0a20 2020 2020   intercept.     
-00014c30: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-00014c40: 2020 736c 6f70 652c 2069 6e74 6572 6365    slope, interce
-00014c50: 7074 2c20 725f 7661 6c75 652c 2070 5f76  pt, r_value, p_v
-00014c60: 616c 7565 2c20 7374 645f 6572 7220 3d20  alue, std_err = 
-00014c70: 6c69 6e72 6567 7265 7373 280a 2020 2020  linregress(.    
-00014c80: 2020 2020 2020 2020 783d 6461 7461 5f6c          x=data_l
-00014c90: 6f77 5b22 4e75 6d62 6572 225d 2c20 793d  ow["Number"], y=
-00014ca0: 6461 7461 5f6c 6f77 5b22 436c 6f73 6522  data_low["Close"
-00014cb0: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
-00014cc0: 2020 2020 6461 7461 5b22 5375 7070 6f72      data["Suppor
-00014cd0: 7422 5d20 3d20 736c 6f70 6520 2a20 6461  t"] = slope * da
-00014ce0: 7461 5b22 4e75 6d62 6572 225d 202b 2069  ta["Number"] + i
-00014cf0: 6e74 6572 6365 7074 0a20 2020 2020 2020  ntercept.       
-00014d00: 206e 6f77 203d 2064 6174 612e 7461 696c   now = data.tail
-00014d10: 2831 290a 0a20 2020 2020 2020 206c 696d  (1)..        lim
-00014d20: 6974 5f75 7070 6572 203d 206e 6f77 5b22  it_upper = now["
-00014d30: 5375 7070 6f72 7422 5d2e 696c 6f63 5b30  Support"].iloc[0
-00014d40: 5d20 2b20 286e 6f77 5b22 5375 7070 6f72  ] + (now["Suppor
-00014d50: 7422 5d2e 696c 6f63 5b30 5d20 2a20 7065  t"].iloc[0] * pe
-00014d60: 7263 656e 7461 6765 290a 2020 2020 2020  rcentage).      
-00014d70: 2020 6c69 6d69 745f 6c6f 7765 7220 3d20    limit_lower = 
-00014d80: 6e6f 775b 2253 7570 706f 7274 225d 2e69  now["Support"].i
-00014d90: 6c6f 635b 305d 202d 2028 6e6f 775b 2253  loc[0] - (now["S
-00014da0: 7570 706f 7274 225d 2e69 6c6f 635b 305d  upport"].iloc[0]
-00014db0: 202a 2070 6572 6365 6e74 6167 6529 0a20   * percentage). 
-00014dc0: 2020 2020 2020 2073 6176 6564 203d 2073         saved = s
-00014dd0: 656c 662e 6669 6e64 4375 7272 656e 7453  elf.findCurrentS
-00014de0: 6176 6564 5661 6c75 6528 7363 7265 656e  avedValue(screen
-00014df0: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
-00014e00: 2250 6174 7465 726e 2229 0a20 2020 2020  "Pattern").     
-00014e10: 2020 2069 6620 6c69 6d69 745f 6c6f 7765     if limit_lowe
-00014e20: 7220 3c20 6e6f 775b 2243 6c6f 7365 225d  r < now["Close"]
-00014e30: 2e69 6c6f 635b 305d 203c 206c 696d 6974  .iloc[0] < limit
-00014e40: 5f75 7070 6572 2061 6e64 2073 6c6f 7065  _upper and slope
-00014e50: 203e 2030 2e31 353a 0a20 2020 2020 2020   > 0.15:.       
-00014e60: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00014e70: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
-00014e80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014e90: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00014ea0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00014eb0: 5465 7874 2e47 5245 454e 202b 2022 5472  Text.GREEN + "Tr
-00014ec0: 656e 646c 696e 652d 5375 7070 6f72 7422  endline-Support"
-00014ed0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-00014ee0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00014ef0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00014f00: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00014f10: 2073 6176 6564 5b31 5d20 2b20 2254 7265   saved[1] + "Tre
-00014f20: 6e64 6c69 6e65 2d53 7570 706f 7274 220a  ndline-Support".
-00014f30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00014f40: 726e 2054 7275 650a 0a20 2020 2020 2020  rn True..       
-00014f50: 2022 2222 2050 6c6f 7473 2066 6f72 2064   """ Plots for d
-00014f60: 6562 7567 6769 6e67 0a20 2020 2020 2020  ebugging.       
-00014f70: 2069 6d70 6f72 7420 6d61 7470 6c6f 746c   import matplotl
-00014f80: 6962 2e70 7970 6c6f 7420 6173 2070 6c74  ib.pyplot as plt
-00014f90: 0a20 2020 2020 2020 2066 6967 2c20 6178  .        fig, ax
-00014fa0: 3120 3d20 706c 742e 7375 6270 6c6f 7473  1 = plt.subplots
-00014fb0: 2866 6967 7369 7a65 3d28 3135 2c31 3029  (figsize=(15,10)
-00014fc0: 290a 2020 2020 2020 2020 636f 6c6f 7220  ).        color 
-00014fd0: 3d20 2774 6162 3a67 7265 656e 270a 2020  = 'tab:green'.  
-00014fe0: 2020 2020 2020 7864 6174 6520 3d20 5b78        xdate = [x
-00014ff0: 2e64 6174 6528 2920 666f 7220 7820 696e  .date() for x in
-00015000: 2064 6174 612e 696e 6465 785d 0a20 2020   data.index].   
-00015010: 2020 2020 2061 7831 2e73 6574 5f78 6c61       ax1.set_xla
-00015020: 6265 6c28 2744 6174 6527 2c20 636f 6c6f  bel('Date', colo
-00015030: 723d 636f 6c6f 7229 0a20 2020 2020 2020  r=color).       
-00015040: 2061 7831 2e70 6c6f 7428 7864 6174 652c   ax1.plot(xdate,
-00015050: 2064 6174 612e 436c 6f73 652c 206c 6162   data.Close, lab
-00015060: 656c 3d22 636c 6f73 6522 2c20 636f 6c6f  el="close", colo
-00015070: 723d 636f 6c6f 7229 0a20 2020 2020 2020  r=color).       
-00015080: 2061 7831 2e74 6963 6b5f 7061 7261 6d73   ax1.tick_params
-00015090: 2861 7869 733d 2778 272c 206c 6162 656c  (axis='x', label
-000150a0: 636f 6c6f 723d 636f 6c6f 7229 0a0a 2020  color=color)..  
-000150b0: 2020 2020 2020 6178 3220 3d20 6178 312e        ax2 = ax1.
-000150c0: 7477 696e 7928 2920 2320 6178 3220 616e  twiny() # ax2 an
-000150d0: 6420 6178 3120 7769 6c6c 2068 6176 6520  d ax1 will have 
-000150e0: 636f 6d6d 6f6e 2079 2061 7869 7320 616e  common y axis an
-000150f0: 6420 6469 6666 6572 656e 7420 7820 6178  d different x ax
-00015100: 6973 2c20 7477 696e 790a 2020 2020 2020  is, twiny.      
-00015110: 2020 6178 322e 706c 6f74 2864 6174 612e    ax2.plot(data.
-00015120: 4e75 6d62 6572 2c20 6461 7461 2e52 6573  Number, data.Res
-00015130: 6973 7461 6e63 652c 206c 6162 656c 3d22  istance, label="
-00015140: 5265 7322 290a 2020 2020 2020 2020 6178  Res").        ax
-00015150: 322e 706c 6f74 2864 6174 612e 4e75 6d62  2.plot(data.Numb
-00015160: 6572 2c20 6461 7461 2e53 7570 706f 7274  er, data.Support
-00015170: 2c20 6c61 6265 6c3d 2253 7570 2229 0a0a  , label="Sup")..
-00015180: 2020 2020 2020 2020 706c 742e 6c65 6765          plt.lege
-00015190: 6e64 2829 0a20 2020 2020 2020 2070 6c74  nd().        plt
-000151a0: 2e67 7269 6428 290a 2020 2020 2020 2020  .grid().        
-000151b0: 706c 742e 7368 6f77 2829 0a20 2020 2020  plt.show().     
-000151c0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-000151d0: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-000151e0: 2023 2040 6d65 6173 7572 655f 7469 6d65   # @measure_time
-000151f0: 0a20 2020 2064 6566 2066 696e 6455 7074  .    def findUpt
-00015200: 7265 6e64 2873 656c 662c 2064 662c 2073  rend(self, df, s
-00015210: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-00015220: 6963 742c 2074 6573 7469 6e67 2c20 7374  ict, testing, st
-00015230: 6f63 6b2c 6f6e 6c79 4d46 3d46 616c 7365  ock,onlyMF=False
-00015240: 2c68 6f73 7444 6174 613d 4e6f 6e65 2c65  ,hostData=None,e
-00015250: 7863 6861 6e67 654e 616d 653d 2249 4e44  xchangeName="IND
-00015260: 4941 222c 7265 6672 6573 684d 4641 6e64  IA",refreshMFAnd
-00015270: 4656 3d54 7275 6529 3a0a 2020 2020 2020  FV=True):.      
-00015280: 2020 2320 7368 6f75 6c64 5072 6f63 6565    # shouldProcee
-00015290: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-000152a0: 2069 7355 7074 7265 6e64 203d 2046 616c   isUptrend = Fal
-000152b0: 7365 0a20 2020 2020 2020 2069 7344 6f77  se.        isDow
-000152c0: 6e74 7265 6e64 203d 2046 616c 7365 0a20  ntrend = False. 
-000152d0: 2020 2020 2020 2069 7335 3044 4d41 5570         is50DMAUp
-000152e0: 7472 656e 6420 3d20 4661 6c73 650a 2020  trend = False.  
-000152f0: 2020 2020 2020 6973 3530 444d 4144 6f77        is50DMADow
-00015300: 6e74 7265 6e64 203d 2046 616c 7365 0a20  ntrend = False. 
-00015310: 2020 2020 2020 2064 6563 6973 696f 6e20         decision 
-00015320: 3d20 2222 0a20 2020 2020 2020 2064 6d61  = "".        dma
-00015330: 3530 6465 6369 7369 6f6e 203d 2022 220a  50decision = "".
-00015340: 2020 2020 2020 2020 6661 6972 5661 6c75          fairValu
-00015350: 6520 3d20 300a 2020 2020 2020 2020 6661  e = 0.        fa
-00015360: 6972 5661 6c75 6544 6966 6620 3d20 300a  irValueDiff = 0.
-00015370: 2020 2020 2020 2020 2320 6966 2064 6620          # if df 
-00015380: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-00015390: 6629 203c 2032 3230 206f 7220 7465 7374  f) < 220 or test
-000153a0: 696e 673a 0a20 2020 2020 2020 2023 2020  ing:.        #  
-000153b0: 2020 2073 686f 756c 6450 726f 6365 6564     shouldProceed
-000153c0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000153d0: 2069 6620 6466 2069 7320 6e6f 7420 4e6f   if df is not No
-000153e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000153f0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00015400: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-00015410: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00015420: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00015430: 615b 3a3a 2d31 5d0a 2020 2020 2020 2020  a[::-1].        
-00015440: 2020 2020 2020 2020 746f 6461 795f 736d          today_sm
-00015450: 6120 3d20 706b 7461 6c69 622e 534d 4128  a = pktalib.SMA(
-00015460: 6461 7461 5b22 436c 6f73 6522 5d2c 2074  data["Close"], t
-00015470: 696d 6570 6572 696f 643d 3530 290a 2020  imeperiod=50).  
-00015480: 2020 2020 2020 2020 2020 2020 2020 736d                sm
-00015490: 615f 6d69 6e75 7339 203d 2070 6b74 616c  a_minus9 = pktal
-000154a0: 6962 2e53 4d41 2864 6174 612e 6865 6164  ib.SMA(data.head
-000154b0: 286c 656e 2864 6174 6129 2d39 295b 2243  (len(data)-9)["C
-000154c0: 6c6f 7365 225d 2c20 7469 6d65 7065 7269  lose"], timeperi
-000154d0: 6f64 3d35 3029 0a20 2020 2020 2020 2020  od=50).         
-000154e0: 2020 2020 2020 2073 6d61 5f6d 696e 7573         sma_minus
-000154f0: 3134 203d 2070 6b74 616c 6962 2e53 4d41  14 = pktalib.SMA
-00015500: 2864 6174 612e 6865 6164 286c 656e 2864  (data.head(len(d
-00015510: 6174 6129 2d31 3429 5b22 436c 6f73 6522  ata)-14)["Close"
-00015520: 5d2c 2074 696d 6570 6572 696f 643d 3530  ], timeperiod=50
-00015530: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015540: 2020 736d 615f 6d69 6e75 7332 3020 3d20    sma_minus20 = 
-00015550: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-00015560: 2e68 6561 6428 6c65 6e28 6461 7461 292d  .head(len(data)-
-00015570: 3230 295b 2243 6c6f 7365 225d 2c20 7469  20)["Close"], ti
-00015580: 6d65 7065 7269 6f64 3d35 3029 0a20 2020  meperiod=50).   
-00015590: 2020 2020 2020 2020 2020 2020 2074 6f64               tod
-000155a0: 6179 5f6c 6d61 203d 2070 6b74 616c 6962  ay_lma = pktalib
-000155b0: 2e53 4d41 2864 6174 615b 2243 6c6f 7365  .SMA(data["Close
-000155c0: 225d 2c20 7469 6d65 7065 7269 6f64 3d32  "], timeperiod=2
-000155d0: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-000155e0: 2020 2020 6c6d 615f 6d69 6e75 7332 3020      lma_minus20 
-000155f0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
-00015600: 7461 2e68 6561 6428 6c65 6e28 6461 7461  ta.head(len(data
-00015610: 292d 3230 295b 2243 6c6f 7365 225d 2c20  )-20)["Close"], 
-00015620: 7469 6d65 7065 7269 6f64 3d32 3030 290a  timeperiod=200).
-00015630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015640: 6c6d 615f 6d69 6e75 7338 3020 3d20 706b  lma_minus80 = pk
-00015650: 7461 6c69 622e 534d 4128 6461 7461 2e68  talib.SMA(data.h
-00015660: 6561 6428 6c65 6e28 6461 7461 292d 3830  ead(len(data)-80
-00015670: 295b 2243 6c6f 7365 225d 2c20 7469 6d65  )["Close"], time
-00015680: 7065 7269 6f64 3d32 3030 290a 2020 2020  period=200).    
-00015690: 2020 2020 2020 2020 2020 2020 6c6d 615f              lma_
-000156a0: 6d69 6e75 7331 3030 203d 2070 6b74 616c  minus100 = pktal
-000156b0: 6962 2e53 4d41 2864 6174 612e 6865 6164  ib.SMA(data.head
-000156c0: 286c 656e 2864 6174 6129 2d31 3030 295b  (len(data)-100)[
-000156d0: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
-000156e0: 7269 6f64 3d32 3030 290a 2020 2020 2020  riod=200).      
-000156f0: 2020 2020 2020 2020 2020 746f 6461 795f            today_
-00015700: 6c6d 6120 3d20 746f 6461 795f 6c6d 612e  lma = today_lma.
-00015710: 696c 6f63 5b6c 656e 2874 6f64 6179 5f6c  iloc[len(today_l
-00015720: 6d61 292d 315d 2069 6620 746f 6461 795f  ma)-1] if today_
-00015730: 6c6d 6120 6973 206e 6f74 204e 6f6e 6520  lma is not None 
-00015740: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
-00015750: 2020 2020 2020 206c 6d61 5f6d 696e 7573         lma_minus
-00015760: 3230 203d 206c 6d61 5f6d 696e 7573 3230  20 = lma_minus20
-00015770: 2e69 6c6f 635b 6c65 6e28 6c6d 615f 6d69  .iloc[len(lma_mi
-00015780: 6e75 7332 3029 2d31 5d20 6966 206c 6d61  nus20)-1] if lma
-00015790: 5f6d 696e 7573 3230 2069 7320 6e6f 7420  _minus20 is not 
-000157a0: 4e6f 6e65 2065 6c73 6520 300a 2020 2020  None else 0.    
-000157b0: 2020 2020 2020 2020 2020 2020 6c6d 615f              lma_
-000157c0: 6d69 6e75 7338 3020 3d20 6c6d 615f 6d69  minus80 = lma_mi
-000157d0: 6e75 7338 302e 696c 6f63 5b6c 656e 286c  nus80.iloc[len(l
-000157e0: 6d61 5f6d 696e 7573 3830 292d 315d 2069  ma_minus80)-1] i
-000157f0: 6620 6c6d 615f 6d69 6e75 7338 3020 6973  f lma_minus80 is
-00015800: 206e 6f74 204e 6f6e 6520 656c 7365 2030   not None else 0
-00015810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015820: 206c 6d61 5f6d 696e 7573 3130 3020 3d20   lma_minus100 = 
-00015830: 6c6d 615f 6d69 6e75 7331 3030 2e69 6c6f  lma_minus100.ilo
-00015840: 635b 6c65 6e28 6c6d 615f 6d69 6e75 7331  c[len(lma_minus1
-00015850: 3030 292d 315d 2069 6620 6c6d 615f 6d69  00)-1] if lma_mi
-00015860: 6e75 7331 3030 2069 7320 6e6f 7420 4e6f  nus100 is not No
-00015870: 6e65 2065 6c73 6520 300a 2020 2020 2020  ne else 0.      
-00015880: 2020 2020 2020 2020 2020 746f 6461 795f            today_
-00015890: 736d 6120 3d20 746f 6461 795f 736d 612e  sma = today_sma.
-000158a0: 696c 6f63 5b6c 656e 2874 6f64 6179 5f73  iloc[len(today_s
-000158b0: 6d61 292d 315d 2069 6620 746f 6461 795f  ma)-1] if today_
-000158c0: 736d 6120 6973 206e 6f74 204e 6f6e 6520  sma is not None 
-000158d0: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
-000158e0: 2020 2020 2020 2073 6d61 5f6d 696e 7573         sma_minus
-000158f0: 3920 3d20 736d 615f 6d69 6e75 7339 2e69  9 = sma_minus9.i
-00015900: 6c6f 635b 6c65 6e28 736d 615f 6d69 6e75  loc[len(sma_minu
-00015910: 7339 292d 315d 2069 6620 736d 615f 6d69  s9)-1] if sma_mi
-00015920: 6e75 7339 2069 7320 6e6f 7420 4e6f 6e65  nus9 is not None
-00015930: 2065 6c73 6520 300a 2020 2020 2020 2020   else 0.        
-00015940: 2020 2020 2020 2020 736d 615f 6d69 6e75          sma_minu
-00015950: 7331 3420 3d20 736d 615f 6d69 6e75 7331  s14 = sma_minus1
-00015960: 342e 696c 6f63 5b6c 656e 2873 6d61 5f6d  4.iloc[len(sma_m
-00015970: 696e 7573 3134 292d 315d 2069 6620 736d  inus14)-1] if sm
-00015980: 615f 6d69 6e75 7331 3420 6973 206e 6f74  a_minus14 is not
-00015990: 204e 6f6e 6520 656c 7365 2030 0a20 2020   None else 0.   
-000159a0: 2020 2020 2020 2020 2020 2020 2073 6d61               sma
-000159b0: 5f6d 696e 7573 3230 203d 2073 6d61 5f6d  _minus20 = sma_m
-000159c0: 696e 7573 3230 2e69 6c6f 635b 6c65 6e28  inus20.iloc[len(
-000159d0: 736d 615f 6d69 6e75 7332 3029 2d31 5d20  sma_minus20)-1] 
-000159e0: 6966 2073 6d61 5f6d 696e 7573 3230 2069  if sma_minus20 i
-000159f0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00015a00: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00015a10: 2020 6973 5570 7472 656e 6420 3d20 2874    isUptrend = (t
-00015a20: 6f64 6179 5f6c 6d61 203e 206c 6d61 5f6d  oday_lma > lma_m
-00015a30: 696e 7573 3230 2920 6f72 2028 746f 6461  inus20) or (toda
-00015a40: 795f 6c6d 6120 3e20 6c6d 615f 6d69 6e75  y_lma > lma_minu
-00015a50: 7338 3029 206f 7220 2874 6f64 6179 5f6c  s80) or (today_l
-00015a60: 6d61 203e 206c 6d61 5f6d 696e 7573 3130  ma > lma_minus10
-00015a70: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00015a80: 2020 2069 7344 6f77 6e74 7265 6e64 203d     isDowntrend =
-00015a90: 2028 746f 6461 795f 6c6d 6120 3c20 6c6d   (today_lma < lm
-00015aa0: 615f 6d69 6e75 7332 3029 2061 6e64 2028  a_minus20) and (
-00015ab0: 746f 6461 795f 6c6d 6120 3c20 6c6d 615f  today_lma < lma_
-00015ac0: 6d69 6e75 7338 3029 2061 6e64 2028 746f  minus80) and (to
-00015ad0: 6461 795f 6c6d 6120 3c20 6c6d 615f 6d69  day_lma < lma_mi
-00015ae0: 6e75 7331 3030 290a 2020 2020 2020 2020  nus100).        
-00015af0: 2020 2020 2020 2020 6973 3530 444d 4155          is50DMAU
-00015b00: 7074 7265 6e64 203d 2028 746f 6461 795f  ptrend = (today_
-00015b10: 736d 6120 3e20 736d 615f 6d69 6e75 7339  sma > sma_minus9
-00015b20: 2920 6f72 2028 746f 6461 795f 736d 6120  ) or (today_sma 
-00015b30: 3e20 736d 615f 6d69 6e75 7331 3429 206f  > sma_minus14) o
-00015b40: 7220 2874 6f64 6179 5f73 6d61 203e 2073  r (today_sma > s
-00015b50: 6d61 5f6d 696e 7573 3230 290a 2020 2020  ma_minus20).    
-00015b60: 2020 2020 2020 2020 2020 2020 6973 3530              is50
-00015b70: 444d 4144 6f77 6e74 7265 6e64 203d 2028  DMADowntrend = (
-00015b80: 746f 6461 795f 736d 6120 3c20 736d 615f  today_sma < sma_
-00015b90: 6d69 6e75 7339 2920 616e 6420 2874 6f64  minus9) and (tod
-00015ba0: 6179 5f73 6d61 203c 2073 6d61 5f6d 696e  ay_sma < sma_min
-00015bb0: 7573 3134 2920 616e 6420 2874 6f64 6179  us14) and (today
-00015bc0: 5f73 6d61 203c 2073 6d61 5f6d 696e 7573  _sma < sma_minus
-00015bd0: 3230 290a 2020 2020 2020 2020 2020 2020  20).            
-00015be0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00015bf0: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
-00015c00: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
-00015c10: 2020 2020 2020 2320 7365 6c66 2e64 6566        # self.def
-00015c20: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
-00015c30: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
-00015c40: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00015c50: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00015c60: 2064 6563 6973 696f 6e20 3d20 2754 3ae2   decision = 'T:.
-00015c70: 96b2 2720 6966 2069 7355 7074 7265 6e64  ..' if isUptrend
-00015c80: 2065 6c73 6520 2827 543a e296 bc27 2069   else ('T:...' i
-00015c90: 6620 6973 446f 776e 7472 656e 6420 656c  f isDowntrend el
-00015ca0: 7365 2027 2729 0a20 2020 2020 2020 2064  se '').        d
-00015cb0: 6d61 3530 6465 6369 7369 6f6e 203d 2027  ma50decision = '
-00015cc0: 743a e296 b227 2069 6620 6973 3530 444d  t:...' if is50DM
-00015cd0: 4155 7074 7265 6e64 2065 6c73 6520 2827  AUptrend else ('
-00015ce0: 743a e296 bc27 2069 6620 6973 3530 444d  t:...' if is50DM
-00015cf0: 4144 6f77 6e74 7265 6e64 2065 6c73 6520  ADowntrend else 
-00015d00: 2727 290a 2020 2020 2020 2020 6d66 5f69  '').        mf_i
-00015d10: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
-00015d20: 6e67 6520 3d20 300a 2020 2020 2020 2020  nge = 0.        
-00015d30: 6368 616e 6765 5f6d 696c 6c69 6f6e 7320  change_millions 
-00015d40: 3d22 220a 2020 2020 2020 2020 6d66 203d  ="".        mf =
-00015d50: 2022 220a 2020 2020 2020 2020 6d66 7320   "".        mfs 
-00015d60: 3d20 2222 0a20 2020 2020 2020 2069 6620  = "".        if 
-00015d70: 7265 6672 6573 684d 4641 6e64 4656 3a0a  refreshMFAndFV:.
-00015d80: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00015d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015da0: 206d 665f 696e 7374 5f6f 776e 6572 7368   mf_inst_ownersh
-00015db0: 6970 4368 616e 6765 203d 2073 656c 662e  ipChange = self.
-00015dc0: 6765 744d 7574 7561 6c46 756e 6453 7461  getMutualFundSta
-00015dd0: 7475 7328 7374 6f63 6b2c 6f6e 6c79 4d46  tus(stock,onlyMF
-00015de0: 3d6f 6e6c 794d 462c 686f 7374 4461 7461  =onlyMF,hostData
-00015df0: 3d68 6f73 7444 6174 612c 666f 7263 653d  =hostData,force=
-00015e00: 2868 6f73 7444 6174 6120 6973 204e 6f6e  (hostData is Non
-00015e10: 6520 6f72 2068 6f73 7444 6174 612e 656d  e or hostData.em
-00015e20: 7074 7920 6f72 206e 6f74 2028 224d 4622  pty or not ("MF"
-00015e30: 2069 6e20 686f 7374 4461 7461 2e63 6f6c   in hostData.col
-00015e40: 756d 6e73 206f 7220 2246 4949 2220 696e  umns or "FII" in
-00015e50: 2068 6f73 7444 6174 612e 636f 6c75 6d6e   hostData.column
-00015e60: 7329 292c 6578 6368 616e 6765 4e61 6d65  s)),exchangeName
-00015e70: 3d65 7863 6861 6e67 654e 616d 6529 0a20  =exchangeName). 
-00015e80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015e90: 6620 6973 696e 7374 616e 6365 286d 665f  f isinstance(mf_
-00015ea0: 696e 7374 5f6f 776e 6572 7368 6970 4368  inst_ownershipCh
-00015eb0: 616e 6765 2c20 7064 2e53 6572 6965 7329  ange, pd.Series)
-00015ec0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015ed0: 2020 2020 2020 6d66 5f69 6e73 745f 6f77        mf_inst_ow
-00015ee0: 6e65 7273 6869 7043 6861 6e67 6520 3d20  nershipChange = 
-00015ef0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00015f00: 2020 726f 756e 644f 6666 203d 2032 0a20    roundOff = 2. 
-00015f10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00015f20: 696c 6c69 6f6e 7320 3d20 726f 756e 6428  illions = round(
-00015f30: 6d66 5f69 6e73 745f 6f77 6e65 7273 6869  mf_inst_ownershi
-00015f40: 7043 6861 6e67 652f 3130 3030 3030 302c  pChange/1000000,
-00015f50: 726f 756e 644f 6666 290a 2020 2020 2020  roundOff).      
-00015f60: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00015f70: 666c 6f61 7428 6d69 6c6c 696f 6e73 2920  float(millions) 
-00015f80: 3d3d 2030 2061 6e64 2072 6f75 6e64 4f66  == 0 and roundOf
-00015f90: 6620 3c3d 353a 0a20 2020 2020 2020 2020  f <=5:.         
-00015fa0: 2020 2020 2020 2020 2020 2072 6f75 6e64             round
-00015fb0: 4f66 6620 2b3d 310a 2020 2020 2020 2020  Off +=1.        
-00015fc0: 2020 2020 2020 2020 2020 2020 6d69 6c6c              mill
-00015fd0: 696f 6e73 203d 2072 6f75 6e64 286d 665f  ions = round(mf_
-00015fe0: 696e 7374 5f6f 776e 6572 7368 6970 4368  inst_ownershipCh
-00015ff0: 616e 6765 2f31 3030 3030 3030 2c72 6f75  ange/1000000,rou
-00016000: 6e64 4f66 6629 0a20 2020 2020 2020 2020  ndOff).         
-00016010: 2020 2020 2020 2063 6861 6e67 655f 6d69         change_mi
-00016020: 6c6c 696f 6e73 203d 2066 2228 7b6d 696c  llions = f"({mil
-00016030: 6c69 6f6e 737d 4d29 220a 2020 2020 2020  lions}M)".      
-00016040: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00016050: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-00016060: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-00016070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016080: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-00016090: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
-000160a0: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
-000160b0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000160c0: 730a 2020 2020 2020 2020 2020 2020 7472  s.            tr
-000160d0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000160e0: 2020 2023 4c65 7427 7320 6765 7420 7468     #Let's get th
-000160f0: 6520 6661 6972 2076 616c 7565 2c20 6569  e fair value, ei
-00016100: 7468 6572 2073 6176 6564 206f 7220 6672  ther saved or fr
-00016110: 6573 6820 6672 6f6d 2073 6572 7669 6365  esh from service
-00016120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016130: 2066 6169 7256 616c 7565 203d 2073 656c   fairValue = sel
-00016140: 662e 6765 7446 6169 7256 616c 7565 2873  f.getFairValue(s
-00016150: 746f 636b 2c68 6f73 7444 6174 612c 666f  tock,hostData,fo
-00016160: 7263 653d 2868 6f73 7444 6174 6120 6973  rce=(hostData is
-00016170: 204e 6f6e 6520 6f72 2068 6f73 7444 6174   None or hostDat
-00016180: 612e 656d 7074 7920 6f72 2022 4661 6972  a.empty or "Fair
-00016190: 5661 6c75 6522 206e 6f74 2069 6e20 686f  Value" not in ho
-000161a0: 7374 4461 7461 2e63 6f6c 756d 6e73 292c  stData.columns),
-000161b0: 6578 6368 616e 6765 4e61 6d65 3d65 7863  exchangeName=exc
-000161c0: 6861 6e67 654e 616d 6529 0a20 2020 2020  hangeName).     
-000161d0: 2020 2020 2020 2020 2020 2069 6620 6661             if fa
-000161e0: 6972 5661 6c75 6520 6973 206e 6f74 204e  irValue is not N
-000161f0: 6f6e 6520 616e 6420 6661 6972 5661 6c75  one and fairValu
-00016200: 6520 213d 2030 3a0a 2020 2020 2020 2020  e != 0:.        
-00016210: 2020 2020 2020 2020 2020 2020 6c74 7020              ltp 
-00016220: 3d20 7361 7665 4469 6374 5b22 4c54 5022  = saveDict["LTP"
-00016230: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00016240: 2020 2020 2020 6661 6972 5661 6c75 6544        fairValueD
-00016250: 6966 6620 3d20 726f 756e 6428 6661 6972  iff = round(fair
-00016260: 5661 6c75 6520 2d20 6c74 702c 3029 0a20  Value - ltp,0). 
-00016270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016280: 2020 2073 6176 6544 6963 745b 2246 6169     saveDict["Fai
-00016290: 7256 616c 7565 225d 203d 2073 7472 2866  rValue"] = str(f
-000162a0: 6169 7256 616c 7565 290a 2020 2020 2020  airValue).      
-000162b0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000162c0: 7665 4469 6374 5b22 4656 4469 6666 225d  veDict["FVDiff"]
-000162d0: 203d 2066 6169 7256 616c 7565 4469 6666   = fairValueDiff
-000162e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000162f0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00016300: 2246 5644 6966 6622 5d20 3d20 6661 6972  "FVDiff"] = fair
-00016310: 5661 6c75 6544 6966 660a 2020 2020 2020  ValueDiff.      
-00016320: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00016330: 7265 656e 4469 6374 5b22 4661 6972 5661  reenDict["FairVa
-00016340: 6c75 6522 5d20 3d20 2863 6f6c 6f72 5465  lue"] = (colorTe
-00016350: 7874 2e47 5245 454e 2069 6620 6661 6972  xt.GREEN if fair
-00016360: 5661 6c75 6520 3e3d 206c 7470 2065 6c73  Value >= ltp els
-00016370: 6520 636f 6c6f 7254 6578 742e 4641 494c  e colorText.FAIL
-00016380: 2920 2b20 7361 7665 4469 6374 5b22 4661  ) + saveDict["Fa
-00016390: 6972 5661 6c75 6522 5d20 2b20 636f 6c6f  irValue"] + colo
-000163a0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-000163b0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000163c0: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-000163d0: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-000163e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000163f0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-00016400: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
-00016410: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
-00016420: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00016430: 730a 2020 2020 2020 2020 2020 2020 0a20  s.            . 
-00016440: 2020 2020 2020 2020 2020 2069 6620 6d66             if mf
-00016450: 5f69 6e73 745f 6f77 6e65 7273 6869 7043  _inst_ownershipC
-00016460: 6861 6e67 6520 3e20 303a 0a20 2020 2020  hange > 0:.     
-00016470: 2020 2020 2020 2020 2020 206d 6620 3d20             mf = 
-00016480: 6622 4d46 493a e296 b220 7b63 6861 6e67  f"MFI:... {chang
-00016490: 655f 6d69 6c6c 696f 6e73 7d22 0a20 2020  e_millions}".   
-000164a0: 2020 2020 2020 2020 2020 2020 206d 6673               mfs
-000164b0: 203d 2063 6f6c 6f72 5465 7874 2e47 5245   = colorText.GRE
-000164c0: 454e 202b 206d 6620 2b20 636f 6c6f 7254  EN + mf + colorT
-000164d0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-000164e0: 2020 2020 656c 6966 206d 665f 696e 7374      elif mf_inst
-000164f0: 5f6f 776e 6572 7368 6970 4368 616e 6765  _ownershipChange
-00016500: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
-00016510: 2020 2020 2020 6d66 203d 2066 224d 4649        mf = f"MFI
-00016520: 3ae2 96bc 207b 6368 616e 6765 5f6d 696c  :... {change_mil
-00016530: 6c69 6f6e 737d 220a 2020 2020 2020 2020  lions}".        
-00016540: 2020 2020 2020 2020 6d66 7320 3d20 636f          mfs = co
-00016550: 6c6f 7254 6578 742e 4641 494c 202b 206d  lorText.FAIL + m
-00016560: 6620 2b20 636f 6c6f 7254 6578 742e 454e  f + colorText.EN
-00016570: 440a 0a20 2020 2020 2020 2073 6176 6564  D..        saved
-00016580: 203d 2073 656c 662e 6669 6e64 4375 7272   = self.findCurr
-00016590: 656e 7453 6176 6564 5661 6c75 6528 7363  entSavedValue(sc
-000165a0: 7265 656e 4469 6374 2c73 6176 6544 6963  reenDict,saveDic
-000165b0: 742c 2254 7265 6e64 2229 0a20 2020 2020  t,"Trend").     
-000165c0: 2020 2064 6563 6973 696f 6e5f 7363 7220     decision_scr 
-000165d0: 3d20 2863 6f6c 6f72 5465 7874 2e47 5245  = (colorText.GRE
-000165e0: 454e 2069 6620 6973 5570 7472 656e 6420  EN if isUptrend 
-000165f0: 656c 7365 2028 636f 6c6f 7254 6578 742e  else (colorText.
-00016600: 4641 494c 2069 6620 6973 446f 776e 7472  FAIL if isDowntr
-00016610: 656e 6420 656c 7365 2063 6f6c 6f72 5465  end else colorTe
-00016620: 7874 2e57 4152 4e29 2920 2b20 6622 7b64  xt.WARN)) + f"{d
-00016630: 6563 6973 696f 6e7d 2220 2b20 636f 6c6f  ecision}" + colo
-00016640: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00016650: 2020 646d 6135 3064 6563 6973 696f 6e5f    dma50decision_
-00016660: 7363 7220 3d20 2863 6f6c 6f72 5465 7874  scr = (colorText
-00016670: 2e47 5245 454e 2069 6620 6973 3530 444d  .GREEN if is50DM
-00016680: 4155 7074 7265 6e64 2065 6c73 6520 2863  AUptrend else (c
-00016690: 6f6c 6f72 5465 7874 2e46 4149 4c20 6966  olorText.FAIL if
-000166a0: 2069 7335 3044 4d41 446f 776e 7472 656e   is50DMADowntren
-000166b0: 6420 656c 7365 2063 6f6c 6f72 5465 7874  d else colorText
-000166c0: 2e57 4152 4e29 2920 2b20 6622 7b64 6d61  .WARN)) + f"{dma
-000166d0: 3530 6465 6369 7369 6f6e 7d22 202b 2063  50decision}" + c
-000166e0: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-000166f0: 2020 2020 2073 6176 6544 6963 745b 2254       saveDict["T
-00016700: 7265 6e64 225d 203d 2066 227b 7361 7665  rend"] = f"{save
-00016710: 645b 315d 7d20 7b64 6563 6973 696f 6e7d  d[1]} {decision}
-00016720: 207b 646d 6135 3064 6563 6973 696f 6e7d   {dma50decision}
-00016730: 207b 6d66 7d22 0a20 2020 2020 2020 2073   {mf}".        s
-00016740: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
-00016750: 225d 203d 2066 227b 7361 7665 645b 305d  "] = f"{saved[0]
-00016760: 7d20 7b64 6563 6973 696f 6e5f 7363 727d  } {decision_scr}
-00016770: 207b 646d 6135 3064 6563 6973 696f 6e5f   {dma50decision_
-00016780: 7363 727d 207b 6d66 737d 220a 2020 2020  scr} {mfs}".    
-00016790: 2020 2020 7361 7665 4469 6374 5b22 4d46      saveDict["MF
-000167a0: 4922 5d20 3d20 6d66 5f69 6e73 745f 6f77  I"] = mf_inst_ow
-000167b0: 6e65 7273 6869 7043 6861 6e67 650a 2020  nershipChange.  
-000167c0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-000167d0: 5b22 4d46 4922 5d20 3d20 6d66 5f69 6e73  ["MFI"] = mf_ins
-000167e0: 745f 6f77 6e65 7273 6869 7043 6861 6e67  t_ownershipChang
-000167f0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00016800: 2069 7355 7074 7265 6e64 2c20 6d66 5f69   isUptrend, mf_i
-00016810: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
-00016820: 6e67 652c 2066 6169 7256 616c 7565 4469  nge, fairValueDi
-00016830: 6666 0a20 2020 200a 2020 2020 2320 5072  ff.    .    # Pr
-00016840: 6976 6174 6520 6d65 7468 6f64 2074 6f20  ivate method to 
-00016850: 6669 6e64 2063 616e 646c 6520 7479 7065  find candle type
-00016860: 0a20 2020 2023 2054 7275 6520 3d20 4275  .    # True = Bu
-00016870: 6c6c 6973 682c 2046 616c 7365 203d 2042  llish, False = B
-00016880: 6561 7269 7368 0a20 2020 2064 6566 2067  earish.    def g
-00016890: 6574 4361 6e64 6c65 5479 7065 2873 656c  etCandleType(sel
-000168a0: 662c 2064 6169 6c79 4461 7461 293a 0a20  f, dailyData):. 
-000168b0: 2020 2020 2020 2072 6574 7572 6e20 626f         return bo
-000168c0: 6f6c 2864 6169 6c79 4461 7461 5b22 436c  ol(dailyData["Cl
-000168d0: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e3d  ose"].iloc[0] >=
-000168e0: 2064 6169 6c79 4461 7461 5b22 4f70 656e   dailyData["Open
-000168f0: 225d 2e69 6c6f 635b 305d 290a 0a20 2020  "].iloc[0])..   
-00016900: 2064 6566 2067 6574 4361 6e64 6c65 426f   def getCandleBo
-00016910: 6479 4865 6967 6874 2873 656c 662c 2064  dyHeight(self, d
-00016920: 6169 6c79 4461 7461 293a 0a20 2020 2020  ailyData):.     
-00016930: 2020 2062 6f64 7948 6569 6768 7420 3d20     bodyHeight = 
-00016940: 6461 696c 7944 6174 615b 2243 6c6f 7365  dailyData["Close
-00016950: 225d 2e69 6c6f 635b 305d 202d 2064 6169  "].iloc[0] - dai
-00016960: 6c79 4461 7461 5b22 4f70 656e 225d 2e69  lyData["Open"].i
-00016970: 6c6f 635b 305d 0a20 2020 2020 2020 2072  loc[0].        r
-00016980: 6574 7572 6e20 626f 6479 4865 6967 6874  eturn bodyHeight
-00016990: 0a0a 2020 2020 6465 6620 6765 7446 6169  ..    def getFai
-000169a0: 7256 616c 7565 2873 656c 662c 2073 746f  rValue(self, sto
-000169b0: 636b 2c20 686f 7374 4461 7461 3d4e 6f6e  ck, hostData=Non
-000169c0: 652c 2066 6f72 6365 3d46 616c 7365 2c65  e, force=False,e
-000169d0: 7863 6861 6e67 654e 616d 653d 2249 4e44  xchangeName="IND
-000169e0: 4941 2229 3a0a 2020 2020 2020 2020 6966  IA"):.        if
-000169f0: 2068 6f73 7444 6174 6120 6973 204e 6f6e   hostData is Non
-00016a00: 6520 6f72 206c 656e 2868 6f73 7444 6174  e or len(hostDat
-00016a10: 6129 203c 2031 3a0a 2020 2020 2020 2020  a) < 1:.        
-00016a20: 2020 2020 686f 7374 4461 7461 203d 2070      hostData = p
-00016a30: 642e 4461 7461 4672 616d 6528 290a 2020  d.DataFrame().  
-00016a40: 2020 2020 2020 2320 4c65 7427 7320 6c6f        # Let's lo
-00016a50: 6f6b 2066 6f72 2066 6169 7220 7661 6c75  ok for fair valu
-00016a60: 6573 0a20 2020 2020 2020 2066 6169 7256  es.        fairV
-00016a70: 616c 7565 203d 2030 0a20 2020 2020 2020  alue = 0.       
-00016a80: 2069 6620 2246 6169 7256 616c 7565 2220   if "FairValue" 
-00016a90: 696e 2068 6f73 7444 6174 612e 636f 6c75  in hostData.colu
-00016aa0: 6d6e 7320 616e 6420 504b 4461 7465 5574  mns and PKDateUt
-00016ab0: 696c 6974 6965 732e 6375 7272 656e 7444  ilities.currentD
-00016ac0: 6174 6554 696d 6528 292e 7765 656b 6461  ateTime().weekda
-00016ad0: 7928 2920 3c3d 2034 3a0a 2020 2020 2020  y() <= 4:.      
-00016ae0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00016af0: 2020 2020 2020 2020 2020 2066 6169 7256             fairV
-00016b00: 616c 7565 203d 2068 6f73 7444 6174 612e  alue = hostData.
-00016b10: 6c6f 635b 686f 7374 4461 7461 2e69 6e64  loc[hostData.ind
-00016b20: 6578 5b2d 315d 2c22 4661 6972 5661 6c75  ex[-1],"FairValu
-00016b30: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-00016b40: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
-00016b50: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
-00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b70: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
-00016b80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00016b90: 2069 6620 504b 4461 7465 5574 696c 6974   if PKDateUtilit
-00016ba0: 6965 732e 6375 7272 656e 7444 6174 6554  ies.currentDateT
-00016bb0: 696d 6528 292e 7765 656b 6461 7928 2920  ime().weekday() 
-00016bc0: 3e3d 2035 206f 7220 666f 7263 653a 0a20  >= 5 or force:. 
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00016be0: 6563 7572 6974 7920 3d20 4e6f 6e65 0a20  ecurity = None. 
-00016bf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016c00: 2052 6566 7265 7368 2065 6163 6820 7361   Refresh each sa
-00016c10: 7475 7264 6179 206f 7220 7375 6e64 6179  turday or sunday
-00016c20: 206f 7220 7768 656e 206e 6f74 2066 6f75   or when not fou
-00016c30: 6e64 2069 6e20 7361 7665 6420 6461 7461  nd in saved data
-00016c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c50: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00016c60: 2020 2020 2020 2020 2020 7769 7468 2053            with S
-00016c70: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
-00016c80: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
-00016c90: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
-00016ca0: 6f75 743d 5472 7565 293a 0a20 2020 2020  out=True):.     
-00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cc0: 2020 2073 6563 7572 6974 7920 3d20 5374     security = St
-00016cd0: 6f63 6b28 7374 6f63 6b2c 6578 6368 616e  ock(stock,exchan
-00016ce0: 6765 3d65 7863 6861 6e67 654e 616d 6529  ge=exchangeName)
-00016cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016d00: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-00016d10: 6f72 3a20 2320 7072 6167 6d61 3a20 6e6f  or: # pragma: no
-00016d20: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-00016d30: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
-00016d40: 6469 6420 6e6f 7420 6669 6e64 2074 6865  did not find the
-00016d50: 2073 746f 636b 3f20 4974 2773 206f 6b61   stock? It's oka
-00016d60: 792e 204d 6f76 6520 6f6e 2074 6f20 7468  y. Move on to th
-00016d70: 6520 6e65 7874 206f 6e65 2e0a 2020 2020  e next one..    
-00016d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d90: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00016da0: 2020 2020 2065 7863 6570 7420 2854 696d       except (Tim
-00016db0: 656f 7574 4572 726f 722c 2043 6f6e 6e65  eoutError, Conne
-00016dc0: 6374 696f 6e45 7272 6f72 2920 6173 2065  ctionError) as e
-00016dd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016de0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
-00016df0: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
-00016e00: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
-00016e10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016e20: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00016e30: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00016e40: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00016e50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016e60: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
-00016e70: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
-00016e80: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
-00016e90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016ea0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00016eb0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00016ec0: 6375 7269 7479 2069 7320 6e6f 7420 4e6f  curity is not No
-00016ed0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00016ee0: 2020 2020 2020 2020 7769 7468 2053 7570          with Sup
-00016ef0: 7072 6573 734f 7574 7075 7428 7375 7070  pressOutput(supp
-00016f00: 7265 7373 5f73 7464 6572 723d 5472 7565  ress_stderr=True
-00016f10: 2c20 7375 7070 7265 7373 5f73 7464 6f75  , suppress_stdou
-00016f20: 743d 5472 7565 293a 0a20 2020 2020 2020  t=True):.       
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 2066 7620 3d20 7365 6375 7269 7479 2e66   fv = security.f
-00016f50: 6169 7256 616c 7565 2829 0a20 2020 2020  airValue().     
-00016f60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016f70: 6620 6676 2069 7320 6e6f 7420 4e6f 6e65  f fv is not None
-00016f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016f90: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00016fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fb0: 2020 2020 2020 2020 2020 2066 7652 6573             fvRes
-00016fc0: 706f 6e73 6556 616c 7565 203d 2066 765b  ponseValue = fv[
-00016fd0: 226c 6174 6573 7446 6169 7256 616c 7565  "latestFairValue
-00016fe0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-00016ff0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017000: 6620 6676 5265 7370 6f6e 7365 5661 6c75  f fvResponseValu
-00017010: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017030: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00017040: 6169 7256 616c 7565 203d 2066 6c6f 6174  airValue = float
-00017050: 2866 7652 6573 706f 6e73 6556 616c 7565  (fvResponseValue
-00017060: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017070: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00017080: 3a20 2320 7072 6167 6d61 3a20 6e6f 2063  : # pragma: no c
-00017090: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
-000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170b0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170d0: 2020 2320 7365 6c66 2e64 6566 6175 6c74    # self.default
-000170e0: 5f6c 6f67 6765 722e 6465 6275 6728 6622  _logger.debug(f"
-000170f0: 7b65 7d5c 6e52 6573 706f 6e73 653a 6676  {e}\nResponse:fv
-00017100: 3a5c 6e7b 6676 7d22 2c20 6578 635f 696e  :\n{fv}", exc_in
-00017110: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00017120: 2020 2020 2020 2020 2020 2020 2066 6169               fai
-00017130: 7256 616c 7565 203d 2072 6f75 6e64 2866  rValue = round(f
-00017140: 6c6f 6174 2866 6169 7256 616c 7565 292c  loat(fairValue),
-00017150: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00017160: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017180: 2020 2020 686f 7374 4461 7461 2e6c 6f63      hostData.loc
-00017190: 5b68 6f73 7444 6174 612e 696e 6465 785b  [hostData.index[
-000171a0: 2d31 5d2c 2246 6169 7256 616c 7565 225d  -1],"FairValue"]
-000171b0: 203d 2066 6169 7256 616c 7565 0a20 2020   = fairValue.   
-000171c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171d0: 2065 7863 6570 7420 284b 6579 4572 726f   except (KeyErro
-000171e0: 722c 496e 6465 7845 7272 6f72 293a 0a20  r,IndexError):. 
+000135a0: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
+000135b0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+000135c0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+000135d0: 5b3a 3a2d 315d 0a20 2020 2020 2020 2064  [::-1].        d
+000135e0: 6174 6120 3d20 6461 7461 2e74 6169 6c28  ata = data.tail(
+000135f0: 3329 0a20 2020 2020 2020 2069 6620 6c65  3).        if le
+00013600: 6e28 6461 7461 2920 3c20 333a 0a20 2020  n(data) < 3:.   
+00013610: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013620: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+00013630: 794d 696e 7573 3252 5349 203d 2064 6174  yMinus2RSI = dat
+00013640: 615b 2252 5349 225d 2e69 6c6f 635b 305d  a["RSI"].iloc[0]
+00013650: 0a20 2020 2020 2020 2064 6179 4d69 6e75  .        dayMinu
+00013660: 7331 5253 4920 3d20 6461 7461 5b22 5253  s1RSI = data["RS
+00013670: 4922 5d2e 696c 6f63 5b31 5d0a 2020 2020  I"].iloc[1].    
+00013680: 2020 2020 6461 7952 5349 203d 2064 6174      dayRSI = dat
+00013690: 615b 2252 5349 225d 2e69 6c6f 635b 325d  a["RSI"].iloc[2]
+000136a0: 0a20 2020 2020 2020 2072 6574 7572 6e56  .        returnV
+000136b0: 616c 7565 203d 2028 6461 794d 696e 7573  alue = (dayMinus
+000136c0: 3252 5349 203c 3d20 3335 2061 6e64 2064  2RSI <= 35 and d
+000136d0: 6179 4d69 6e75 7331 5253 4920 3e20 6461  ayMinus1RSI > da
+000136e0: 794d 696e 7573 3252 5349 2061 6e64 2064  yMinus2RSI and d
+000136f0: 6179 5253 4920 3e20 6461 794d 696e 7573  ayRSI > dayMinus
+00013700: 3152 5349 2920 6f72 205c 0a20 2020 2020  1RSI) or \.     
+00013710: 2020 2020 2020 2020 2020 2028 6461 794d             (dayM
+00013720: 696e 7573 3152 5349 203c 3d20 3335 2061  inus1RSI <= 35 a
+00013730: 6e64 2064 6179 5253 4920 3e20 6461 794d  nd dayRSI > dayM
+00013740: 696e 7573 3152 5349 290a 2020 2020 2020  inus1RSI).      
+00013750: 2020 6966 2072 7369 4b65 7920 3d3d 2022    if rsiKey == "
+00013760: 5253 4922 3a0a 2020 2020 2020 2020 2020  RSI":.          
+00013770: 2020 7265 7475 726e 5661 6c75 6520 3d20    returnValue = 
+00013780: 7365 6c66 2e66 696e 6452 6973 696e 6752  self.findRisingR
+00013790: 5349 2864 662c 2072 7369 4b65 793d 2252  SI(df, rsiKey="R
+000137a0: 5349 6922 2920 6f72 2072 6574 7572 6e56  SIi") or returnV
+000137b0: 616c 7565 0a20 2020 2020 2020 2072 6574  alue.        ret
+000137c0: 7572 6e20 7265 7475 726e 5661 6c75 650a  urn returnValue.
+000137d0: 0a20 2020 2023 406d 6561 7375 7265 5f74  .    #@measure_t
+000137e0: 696d 650a 2020 2020 2320 4669 6e64 206f  ime.    # Find o
+000137f0: 7574 2074 7265 6e64 2066 6f72 2064 6179  ut trend for day
+00013800: 7320 746f 206c 6f6f 6b62 6163 6b0a 2020  s to lookback.  
+00013810: 2020 6465 6620 6669 6e64 5472 656e 6428    def findTrend(
+00013820: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+00013830: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+00013840: 6461 7973 546f 4c6f 6f6b 6261 636b 3d4e  daysToLookback=N
+00013850: 6f6e 652c 2073 746f 636b 4e61 6d65 3d22  one, stockName="
+00013860: 2229 3a0a 2020 2020 2020 2020 6966 2064  "):.        if d
+00013870: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
+00013880: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
+00013890: 2020 2020 2020 2072 6574 7572 6e20 2255         return "U
+000138a0: 6e6b 6e6f 776e 220a 2020 2020 2020 2020  nknown".        
+000138b0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+000138c0: 0a20 2020 2020 2020 2069 6620 6461 7973  .        if days
+000138d0: 546f 4c6f 6f6b 6261 636b 2069 7320 4e6f  ToLookback is No
+000138e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000138f0: 6461 7973 546f 4c6f 6f6b 6261 636b 203d  daysToLookback =
+00013900: 2073 656c 662e 636f 6e66 6967 4d61 6e61   self.configMana
+00013910: 6765 722e 6461 7973 546f 4c6f 6f6b 6261  ger.daysToLookba
+00013920: 636b 0a20 2020 2020 2020 2064 6174 6120  ck.        data 
+00013930: 3d20 6461 7461 2e68 6561 6428 6461 7973  = data.head(days
+00013940: 546f 4c6f 6f6b 6261 636b 290a 2020 2020  ToLookback).    
+00013950: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+00013960: 3a3a 2d31 5d0a 2020 2020 2020 2020 6461  ::-1].        da
+00013970: 7461 203d 2064 6174 612e 7365 745f 696e  ta = data.set_in
+00013980: 6465 7828 6e70 2e61 7261 6e67 6528 6c65  dex(np.arange(le
+00013990: 6e28 6461 7461 2929 290a 2020 2020 2020  n(data))).      
+000139a0: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
+000139b0: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
+000139c0: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
+000139d0: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
+000139e0: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
+000139f0: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
+00013a00: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
+00013a10: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
+00013a20: 7361 7665 4469 6374 2c22 5472 656e 6422  saveDict,"Trend"
+00013a30: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00013a40: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00013a50: 5375 7070 7265 7373 4f75 7470 7574 2873  SuppressOutput(s
+00013a60: 7570 7072 6573 735f 7374 646f 7574 3d54  uppress_stdout=T
+00013a70: 7275 652c 2073 7570 7072 6573 735f 7374  rue, suppress_st
+00013a80: 6465 7272 3d54 7275 6529 3a0a 2020 2020  derr=True):.    
+00013a90: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00013aa0: 5b22 746f 7073 225d 203d 2064 6174 615b  ["tops"] = data[
+00013ab0: 2243 6c6f 7365 225d 2e69 6c6f 635b 0a20  "Close"].iloc[. 
+00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ad0: 2020 206c 6973 7428 0a20 2020 2020 2020     list(.       
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013af0: 2070 6b74 616c 6962 2e61 7267 7265 6c65   pktalib.argrele
+00013b00: 7874 7265 6d61 280a 2020 2020 2020 2020  xtrema(.        
+00013b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b20: 2020 2020 6e70 2e61 7272 6179 2864 6174      np.array(dat
+00013b30: 615b 2243 6c6f 7365 225d 292c 206e 702e  a["Close"]), np.
+00013b40: 6772 6561 7465 725f 6571 7561 6c2c 206f  greater_equal, o
+00013b50: 7264 6572 3d31 0a20 2020 2020 2020 2020  rder=1.         
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00013b70: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00013b80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013b90: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00013ba0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00013bb0: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
+00013bc0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00013bd0: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+00013be0: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+00013bf0: 2030 290a 0a20 2020 2020 2020 2020 2020   0)..           
+00013c00: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00013c10: 2020 2020 2020 2320 6966 206c 656e 2864        # if len(d
+00013c20: 6174 6129 203c 2064 6179 7354 6f4c 6f6f  ata) < daysToLoo
+00013c30: 6b62 6163 6b3a 0a20 2020 2020 2020 2020  kback:.         
+00013c40: 2020 2020 2020 2023 2020 2020 2073 656c         #     sel
+00013c50: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00013c60: 2e64 6562 7567 2864 6174 6129 0a20 2020  .debug(data).   
+00013c70: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00013c80: 2020 2072 6169 7365 2053 746f 636b 4461     raise StockDa
+00013c90: 7461 4e6f 7441 6465 7175 6174 650a 2020  taNotAdequate.  
+00013ca0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00013cb0: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
+00013cc0: 6528 6e70 2e69 6e66 2c20 6e70 2e6e 616e  e(np.inf, np.nan
+00013cd0: 292e 7265 706c 6163 6528 2d6e 702e 696e  ).replace(-np.in
+00013ce0: 662c 206e 702e 6e61 6e29 2e64 726f 706e  f, np.nan).dropn
+00013cf0: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
+00013d00: 2020 2020 6966 206c 656e 2864 6174 615b      if len(data[
+00013d10: 2274 6f70 7322 5d5b 6461 7461 2e74 6f70  "tops"][data.top
+00013d20: 7320 3e20 305d 2920 3e20 313a 0a20 2020  s > 0]) > 1:.   
+00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d40: 2073 6c6f 7065 203d 206e 702e 706f 6c79   slope = np.poly
+00013d50: 6669 7428 0a20 2020 2020 2020 2020 2020  fit(.           
+00013d60: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00013d70: 612e 696e 6465 785b 6461 7461 2e74 6f70  a.index[data.top
+00013d80: 7320 3e20 305d 2c20 6461 7461 5b22 746f  s > 0], data["to
+00013d90: 7073 225d 5b64 6174 612e 746f 7073 203e  ps"][data.tops >
+00013da0: 2030 5d2c 2031 0a20 2020 2020 2020 2020   0], 1.         
+00013db0: 2020 2020 2020 2020 2020 2029 5b30 5d0a             )[0].
+00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013dd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013de0: 2020 2020 2020 2020 2020 736c 6f70 6520            slope 
+00013df0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00013e00: 6578 6365 7074 206e 702e 6c69 6e61 6c67  except np.linalg
+00013e10: 2e4c 696e 416c 6745 7272 6f72 2061 7320  .LinAlgError as 
+00013e20: 653a 2023 2070 7261 676d 613a 206e 6f20  e: # pragma: no 
+00013e30: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
+00013e40: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+00013e50: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+00013e60: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
+00013e70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013e80: 2020 7363 7265 656e 4469 6374 5b22 5472    screenDict["Tr
+00013e90: 656e 6422 5d20 3d20 280a 2020 2020 2020  end"] = (.      
+00013ea0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00013eb0: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+00013ec0: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+00013ed0: 6578 742e 5741 524e 202b 2022 556e 6b6e  ext.WARN + "Unkn
+00013ee0: 6f77 6e22 202b 2063 6f6c 6f72 5465 7874  own" + colorText
+00013ef0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+00013f00: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00013f10: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00013f20: 2254 7265 6e64 225d 203d 2073 6176 6564  "Trend"] = saved
+00013f30: 5b31 5d20 2b20 2255 6e6b 6e6f 776e 220a  [1] + "Unknown".
+00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f50: 7265 7475 726e 2073 6176 6544 6963 745b  return saveDict[
+00013f60: 2254 7265 6e64 225d 0a20 2020 2020 2020  "Trend"].       
+00013f70: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00013f80: 7074 696f 6e20 6173 2065 3a20 2023 2070  ption as e:  # p
+00013f90: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
+00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fb0: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
+00013fc0: 6765 722e 6465 6275 6728 652c 2065 7863  ger.debug(e, exc
+00013fd0: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
+00013fe0: 2020 2020 2020 2020 2020 2020 736c 6f70              slop
+00013ff0: 652c 205f 203d 2030 2c20 300a 2020 2020  e, _ = 0, 0.    
+00014000: 2020 2020 2020 2020 616e 676c 6520 3d20          angle = 
+00014010: 6e70 2e72 6164 3264 6567 286e 702e 6172  np.rad2deg(np.ar
+00014020: 6374 616e 2873 6c6f 7065 2929 0a20 2020  ctan(slope)).   
+00014030: 2020 2020 2020 2020 2069 6620 616e 676c           if angl
+00014040: 6520 3d3d 2030 3a0a 2020 2020 2020 2020  e == 0:.        
+00014050: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+00014060: 6374 5b22 5472 656e 6422 5d20 3d20 280a  ct["Trend"] = (.
+00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014080: 2020 2020 7361 7665 645b 305d 202b 2063      saved[0] + c
+00014090: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+000140a0: 636f 6c6f 7254 6578 742e 5741 524e 202b  colorText.WARN +
+000140b0: 2022 556e 6b6e 6f77 6e22 202b 2063 6f6c   "Unknown" + col
+000140c0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+000140d0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000140e0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+000140f0: 6544 6963 745b 2254 7265 6e64 225d 203d  eDict["Trend"] =
+00014100: 2073 6176 6564 5b31 5d20 2b20 2255 6e6b   saved[1] + "Unk
+00014110: 6e6f 776e 220a 2020 2020 2020 2020 2020  nown".          
+00014120: 2020 656c 6966 2061 6e67 6c65 203c 3d20    elif angle <= 
+00014130: 3330 2061 6e64 2061 6e67 6c65 203e 3d20  30 and angle >= 
+00014140: 2d33 303a 0a20 2020 2020 2020 2020 2020  -30:.           
+00014150: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00014160: 2254 7265 6e64 225d 203d 2028 0a20 2020  "Trend"] = (.   
+00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014180: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00014190: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+000141a0: 6f72 5465 7874 2e57 4152 4e20 2b20 2253  orText.WARN + "S
+000141b0: 6964 6577 6179 7322 202b 2063 6f6c 6f72  ideways" + color
+000141c0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+000141d0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000141e0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+000141f0: 6963 745b 2254 7265 6e64 225d 203d 2073  ict["Trend"] = s
+00014200: 6176 6564 5b31 5d20 2b20 2253 6964 6577  aved[1] + "Sidew
+00014210: 6179 7322 0a20 2020 2020 2020 2020 2020  ays".           
+00014220: 2065 6c69 6620 616e 676c 6520 3e3d 2033   elif angle >= 3
+00014230: 3020 616e 6420 616e 676c 6520 3c20 3631  0 and angle < 61
+00014240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014250: 2020 7363 7265 656e 4469 6374 5b22 5472    screenDict["Tr
+00014260: 656e 6422 5d20 3d20 280a 2020 2020 2020  end"] = (.      
+00014270: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00014280: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+00014290: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+000142a0: 6578 742e 4752 4545 4e20 2b20 2257 6561  ext.GREEN + "Wea
+000142b0: 6b20 5570 2220 2b20 636f 6c6f 7254 6578  k Up" + colorTex
+000142c0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+000142d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000142e0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+000142f0: 5b22 5472 656e 6422 5d20 3d20 7361 7665  ["Trend"] = save
+00014300: 645b 315d 202b 2022 5765 616b 2055 7022  d[1] + "Weak Up"
+00014310: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00014320: 6620 616e 676c 6520 3e3d 2036 303a 0a20  f angle >= 60:. 
+00014330: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00014340: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
+00014350: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+00014360: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00014370: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
+00014380: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
+00014390: 2e47 5245 454e 202b 2022 5374 726f 6e67  .GREEN + "Strong
+000143a0: 2055 7022 202b 2063 6f6c 6f72 5465 7874   Up" + colorText
+000143b0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+000143c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000143d0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+000143e0: 2254 7265 6e64 225d 203d 2073 6176 6564  "Trend"] = saved
+000143f0: 5b31 5d20 2b20 2253 7472 6f6e 6720 5570  [1] + "Strong Up
+00014400: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
+00014410: 6966 2061 6e67 6c65 203c 3d20 2d33 3020  if angle <= -30 
+00014420: 616e 6420 616e 676c 6520 3e20 2d36 313a  and angle > -61:
+00014430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014440: 2073 6372 6565 6e44 6963 745b 2254 7265   screenDict["Tre
+00014450: 6e64 225d 203d 2028 0a20 2020 2020 2020  nd"] = (.       
+00014460: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00014470: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00014480: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+00014490: 7874 2e46 4149 4c20 2b20 2257 6561 6b20  xt.FAIL + "Weak 
+000144a0: 446f 776e 2220 2b20 636f 6c6f 7254 6578  Down" + colorTex
+000144b0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+000144c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000144d0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+000144e0: 5b22 5472 656e 6422 5d20 3d20 7361 7665  ["Trend"] = save
+000144f0: 645b 315d 202b 2022 5765 616b 2044 6f77  d[1] + "Weak Dow
+00014500: 6e22 0a20 2020 2020 2020 2020 2020 2065  n".            e
+00014510: 6c69 6620 616e 676c 6520 3c20 2d36 303a  lif angle < -60:
+00014520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014530: 2073 6372 6565 6e44 6963 745b 2254 7265   screenDict["Tre
+00014540: 6e64 225d 203d 2028 0a20 2020 2020 2020  nd"] = (.       
+00014550: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00014560: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00014570: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+00014580: 7874 2e46 4149 4c20 2b20 2253 7472 6f6e  xt.FAIL + "Stron
+00014590: 6720 446f 776e 2220 2b20 636f 6c6f 7254  g Down" + colorT
+000145a0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+000145b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000145c0: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+000145d0: 6374 5b22 5472 656e 6422 5d20 3d20 7361  ct["Trend"] = sa
+000145e0: 7665 645b 315d 202b 2022 5374 726f 6e67  ved[1] + "Strong
+000145f0: 2044 6f77 6e22 0a20 2020 2020 2020 2065   Down".        e
+00014600: 7863 6570 7420 6e70 2e6c 696e 616c 672e  xcept np.linalg.
+00014610: 4c69 6e41 6c67 4572 726f 7220 6173 2065  LinAlgError as e
+00014620: 3a20 2320 7072 6167 6d61 3a20 6e6f 2063  : # pragma: no c
+00014630: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
+00014640: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+00014650: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
+00014660: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
+00014670: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00014680: 6963 745b 2254 7265 6e64 225d 203d 2028  ict["Trend"] = (
+00014690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000146a0: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+000146b0: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+000146c0: 6f72 5465 7874 2e57 4152 4e20 2b20 2255  orText.WARN + "U
+000146d0: 6e6b 6e6f 776e 2220 2b20 636f 6c6f 7254  nknown" + colorT
+000146e0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+000146f0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00014700: 2020 7361 7665 4469 6374 5b22 5472 656e    saveDict["Tren
+00014710: 6422 5d20 3d20 7361 7665 645b 315d 202b  d"] = saved[1] +
+00014720: 2022 556e 6b6e 6f77 6e22 0a20 2020 2020   "Unknown".     
+00014730: 2020 2072 6574 7572 6e20 7361 7665 4469     return saveDi
+00014740: 6374 5b22 5472 656e 6422 5d0a 0a20 2020  ct["Trend"]..   
+00014750: 2023 2046 696e 6420 7374 6f63 6b73 2061   # Find stocks a
+00014760: 7070 726f 6368 696e 6720 746f 206c 6f6e  pproching to lon
+00014770: 6720 7465 726d 2074 7265 6e64 6c69 6e65  g term trendline
+00014780: 730a 2020 2020 6465 6620 6669 6e64 5472  s.    def findTr
+00014790: 656e 646c 696e 6573 2873 656c 662c 2064  endlines(self, d
+000147a0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+000147b0: 6176 6544 6963 742c 2070 6572 6365 6e74  aveDict, percent
+000147c0: 6167 653d 302e 3035 293a 0a20 2020 2020  age=0.05):.     
+000147d0: 2020 2023 2070 6572 696f 6420 3d20 696e     # period = in
+000147e0: 7428 2222 2e6a 6f69 6e28 6320 666f 7220  t("".join(c for 
+000147f0: 6320 696e 2073 656c 662e 636f 6e66 6967  c in self.config
+00014800: 4d61 6e61 6765 722e 7065 7269 6f64 2069  Manager.period i
+00014810: 6620 632e 6973 6469 6769 7428 2929 290a  f c.isdigit())).
+00014820: 2020 2020 2020 2020 2320 6966 206c 656e          # if len
+00014830: 2864 6174 6129 203c 2070 6572 696f 643a  (data) < period:
+00014840: 0a20 2020 2020 2020 2023 2020 2020 2072  .        #     r
+00014850: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00014860: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+00014870: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
+00014880: 6120 3d20 6461 7461 5b3a 3a2d 315d 0a20  a = data[::-1]. 
+00014890: 2020 2020 2020 2064 6174 615b 224e 756d         data["Num
+000148a0: 6265 7222 5d20 3d20 6e70 2e61 7261 6e67  ber"] = np.arang
+000148b0: 6528 6c65 6e28 6461 7461 2929 202b 2031  e(len(data)) + 1
+000148c0: 0a20 2020 2020 2020 2064 6174 615f 6c6f  .        data_lo
+000148d0: 7720 3d20 6461 7461 2e63 6f70 7928 290a  w = data.copy().
+000148e0: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+000148f0: 2033 300a 0a20 2020 2020 2020 2022 2222   30..        """
+00014900: 2049 676e 6f72 696e 6720 7468 6520 5265   Ignoring the Re
+00014910: 7369 7461 6e63 6520 666f 7220 6c6f 6e67  sitance for long
+00014920: 2d74 6572 6d20 7075 7270 6f73 650a 2020  -term purpose.  
+00014930: 2020 2020 2020 7768 696c 6520 6c65 6e28        while len(
+00014940: 6461 7461 5f68 6967 6829 203e 2070 6f69  data_high) > poi
+00014950: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00014960: 2073 6c6f 7065 2c20 696e 7465 7263 6570   slope, intercep
+00014970: 742c 2072 5f76 616c 7565 2c20 705f 7661  t, r_value, p_va
+00014980: 6c75 652c 2073 7464 5f65 7272 203d 206c  lue, std_err = l
+00014990: 696e 7265 6772 6573 7328 783d 6461 7461  inregress(x=data
+000149a0: 5f68 6967 685b 274e 756d 6265 7227 5d2c  _high['Number'],
+000149b0: 2079 3d64 6174 615f 6869 6768 5b27 4869   y=data_high['Hi
+000149c0: 6768 275d 290a 2020 2020 2020 2020 2020  gh']).          
+000149d0: 2020 6461 7461 5f68 6967 6820 3d20 6461    data_high = da
+000149e0: 7461 5f68 6967 682e 6c6f 635b 6461 7461  ta_high.loc[data
+000149f0: 5f68 6967 685b 2748 6967 6827 5d20 3e20  _high['High'] > 
+00014a00: 736c 6f70 6520 2a20 6461 7461 5f68 6967  slope * data_hig
+00014a10: 685b 274e 756d 6265 7227 5d20 2b20 696e  h['Number'] + in
+00014a20: 7465 7263 6570 745d 0a20 2020 2020 2020  tercept].       
+00014a30: 2073 6c6f 7065 2c20 696e 7465 7263 6570   slope, intercep
+00014a40: 742c 2072 5f76 616c 7565 2c20 705f 7661  t, r_value, p_va
+00014a50: 6c75 652c 2073 7464 5f65 7272 203d 206c  lue, std_err = l
+00014a60: 696e 7265 6772 6573 7328 783d 6461 7461  inregress(x=data
+00014a70: 5f68 6967 685b 274e 756d 6265 7227 5d2c  _high['Number'],
+00014a80: 2079 3d64 6174 615f 6869 6768 5b27 436c   y=data_high['Cl
+00014a90: 6f73 6527 5d29 0a20 2020 2020 2020 2064  ose']).        d
+00014aa0: 6174 615b 2752 6573 6973 7461 6e63 6527  ata['Resistance'
+00014ab0: 5d20 3d20 736c 6f70 6520 2a20 6461 7461  ] = slope * data
+00014ac0: 5b27 4e75 6d62 6572 275d 202b 2069 6e74  ['Number'] + int
+00014ad0: 6572 6365 7074 0a20 2020 2020 2020 2022  ercept.        "
+00014ae0: 2222 0a0a 2020 2020 2020 2020 7768 696c  ""..        whil
+00014af0: 6520 6c65 6e28 6461 7461 5f6c 6f77 2920  e len(data_low) 
+00014b00: 3e20 706f 696e 7473 3a0a 2020 2020 2020  > points:.      
+00014b10: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00014b20: 2020 2020 2020 2020 2020 2073 6c6f 7065             slope
+00014b30: 2c20 696e 7465 7263 6570 742c 2072 5f76  , intercept, r_v
+00014b40: 616c 7565 2c20 705f 7661 6c75 652c 2073  alue, p_value, s
+00014b50: 7464 5f65 7272 203d 206c 696e 7265 6772  td_err = linregr
+00014b60: 6573 7328 0a20 2020 2020 2020 2020 2020  ess(.           
+00014b70: 2020 2020 2020 2020 2078 3d64 6174 615f           x=data_
+00014b80: 6c6f 775b 224e 756d 6265 7222 5d2c 2079  low["Number"], y
+00014b90: 3d64 6174 615f 6c6f 775b 224c 6f77 225d  =data_low["Low"]
+00014ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014bb0: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+00014bc0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00014bd0: 6173 2065 3a20 2023 2070 7261 676d 613a  as e:  # pragma:
+00014be0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+00014bf0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00014c00: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+00014c10: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+00014c20: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00014c30: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00014c40: 2020 2020 2020 2020 2020 2064 6174 615f             data_
+00014c50: 6c6f 7720 3d20 6461 7461 5f6c 6f77 2e6c  low = data_low.l
+00014c60: 6f63 5b0a 2020 2020 2020 2020 2020 2020  oc[.            
+00014c70: 2020 2020 6461 7461 5f6c 6f77 5b22 4c6f      data_low["Lo
+00014c80: 7722 5d20 3c20 736c 6f70 6520 2a20 6461  w"] < slope * da
+00014c90: 7461 5f6c 6f77 5b22 4e75 6d62 6572 225d  ta_low["Number"]
+00014ca0: 202b 2069 6e74 6572 6365 7074 0a20 2020   + intercept.   
+00014cb0: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
+00014cc0: 2020 2020 736c 6f70 652c 2069 6e74 6572      slope, inter
+00014cd0: 6365 7074 2c20 725f 7661 6c75 652c 2070  cept, r_value, p
+00014ce0: 5f76 616c 7565 2c20 7374 645f 6572 7220  _value, std_err 
+00014cf0: 3d20 6c69 6e72 6567 7265 7373 280a 2020  = linregress(.  
+00014d00: 2020 2020 2020 2020 2020 783d 6461 7461            x=data
+00014d10: 5f6c 6f77 5b22 4e75 6d62 6572 225d 2c20  _low["Number"], 
+00014d20: 793d 6461 7461 5f6c 6f77 5b22 436c 6f73  y=data_low["Clos
+00014d30: 6522 5d0a 2020 2020 2020 2020 290a 2020  e"].        ).  
+00014d40: 2020 2020 2020 6461 7461 5b22 5375 7070        data["Supp
+00014d50: 6f72 7422 5d20 3d20 736c 6f70 6520 2a20  ort"] = slope * 
+00014d60: 6461 7461 5b22 4e75 6d62 6572 225d 202b  data["Number"] +
+00014d70: 2069 6e74 6572 6365 7074 0a20 2020 2020   intercept.     
+00014d80: 2020 206e 6f77 203d 2064 6174 612e 7461     now = data.ta
+00014d90: 696c 2831 290a 0a20 2020 2020 2020 206c  il(1)..        l
+00014da0: 696d 6974 5f75 7070 6572 203d 206e 6f77  imit_upper = now
+00014db0: 5b22 5375 7070 6f72 7422 5d2e 696c 6f63  ["Support"].iloc
+00014dc0: 5b30 5d20 2b20 286e 6f77 5b22 5375 7070  [0] + (now["Supp
+00014dd0: 6f72 7422 5d2e 696c 6f63 5b30 5d20 2a20  ort"].iloc[0] * 
+00014de0: 7065 7263 656e 7461 6765 290a 2020 2020  percentage).    
+00014df0: 2020 2020 6c69 6d69 745f 6c6f 7765 7220      limit_lower 
+00014e00: 3d20 6e6f 775b 2253 7570 706f 7274 225d  = now["Support"]
+00014e10: 2e69 6c6f 635b 305d 202d 2028 6e6f 775b  .iloc[0] - (now[
+00014e20: 2253 7570 706f 7274 225d 2e69 6c6f 635b  "Support"].iloc[
+00014e30: 305d 202a 2070 6572 6365 6e74 6167 6529  0] * percentage)
+00014e40: 0a20 2020 2020 2020 2073 6176 6564 203d  .        saved =
+00014e50: 2073 656c 662e 6669 6e64 4375 7272 656e   self.findCurren
+00014e60: 7453 6176 6564 5661 6c75 6528 7363 7265  tSavedValue(scre
+00014e70: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+00014e80: 2c20 2250 6174 7465 726e 2229 0a20 2020  , "Pattern").   
+00014e90: 2020 2020 2069 6620 6c69 6d69 745f 6c6f       if limit_lo
+00014ea0: 7765 7220 3c20 6e6f 775b 2243 6c6f 7365  wer < now["Close
+00014eb0: 225d 2e69 6c6f 635b 305d 203c 206c 696d  "].iloc[0] < lim
+00014ec0: 6974 5f75 7070 6572 2061 6e64 2073 6c6f  it_upper and slo
+00014ed0: 7065 203e 2030 2e31 353a 0a20 2020 2020  pe > 0.15:.     
+00014ee0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00014ef0: 745b 2250 6174 7465 726e 225d 203d 2028  t["Pattern"] = (
+00014f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014f10: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00014f20: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00014f30: 6f72 5465 7874 2e47 5245 454e 202b 2022  orText.GREEN + "
+00014f40: 5472 656e 646c 696e 652d 5375 7070 6f72  Trendline-Suppor
+00014f50: 7422 202b 2063 6f6c 6f72 5465 7874 2e45  t" + colorText.E
+00014f60: 4e44 0a20 2020 2020 2020 2020 2020 2029  ND.            )
+00014f70: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
+00014f80: 6544 6963 745b 2250 6174 7465 726e 225d  eDict["Pattern"]
+00014f90: 203d 2073 6176 6564 5b31 5d20 2b20 2254   = saved[1] + "T
+00014fa0: 7265 6e64 6c69 6e65 2d53 7570 706f 7274  rendline-Support
+00014fb0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+00014fc0: 7475 726e 2054 7275 650a 0a20 2020 2020  turn True..     
+00014fd0: 2020 2022 2222 2050 6c6f 7473 2066 6f72     """ Plots for
+00014fe0: 2064 6562 7567 6769 6e67 0a20 2020 2020   debugging.     
+00014ff0: 2020 2069 6d70 6f72 7420 6d61 7470 6c6f     import matplo
+00015000: 746c 6962 2e70 7970 6c6f 7420 6173 2070  tlib.pyplot as p
+00015010: 6c74 0a20 2020 2020 2020 2066 6967 2c20  lt.        fig, 
+00015020: 6178 3120 3d20 706c 742e 7375 6270 6c6f  ax1 = plt.subplo
+00015030: 7473 2866 6967 7369 7a65 3d28 3135 2c31  ts(figsize=(15,1
+00015040: 3029 290a 2020 2020 2020 2020 636f 6c6f  0)).        colo
+00015050: 7220 3d20 2774 6162 3a67 7265 656e 270a  r = 'tab:green'.
+00015060: 2020 2020 2020 2020 7864 6174 6520 3d20          xdate = 
+00015070: 5b78 2e64 6174 6528 2920 666f 7220 7820  [x.date() for x 
+00015080: 696e 2064 6174 612e 696e 6465 785d 0a20  in data.index]. 
+00015090: 2020 2020 2020 2061 7831 2e73 6574 5f78         ax1.set_x
+000150a0: 6c61 6265 6c28 2744 6174 6527 2c20 636f  label('Date', co
+000150b0: 6c6f 723d 636f 6c6f 7229 0a20 2020 2020  lor=color).     
+000150c0: 2020 2061 7831 2e70 6c6f 7428 7864 6174     ax1.plot(xdat
+000150d0: 652c 2064 6174 612e 436c 6f73 652c 206c  e, data.Close, l
+000150e0: 6162 656c 3d22 636c 6f73 6522 2c20 636f  abel="close", co
+000150f0: 6c6f 723d 636f 6c6f 7229 0a20 2020 2020  lor=color).     
+00015100: 2020 2061 7831 2e74 6963 6b5f 7061 7261     ax1.tick_para
+00015110: 6d73 2861 7869 733d 2778 272c 206c 6162  ms(axis='x', lab
+00015120: 656c 636f 6c6f 723d 636f 6c6f 7229 0a0a  elcolor=color)..
+00015130: 2020 2020 2020 2020 6178 3220 3d20 6178          ax2 = ax
+00015140: 312e 7477 696e 7928 2920 2320 6178 3220  1.twiny() # ax2 
+00015150: 616e 6420 6178 3120 7769 6c6c 2068 6176  and ax1 will hav
+00015160: 6520 636f 6d6d 6f6e 2079 2061 7869 7320  e common y axis 
+00015170: 616e 6420 6469 6666 6572 656e 7420 7820  and different x 
+00015180: 6178 6973 2c20 7477 696e 790a 2020 2020  axis, twiny.    
+00015190: 2020 2020 6178 322e 706c 6f74 2864 6174      ax2.plot(dat
+000151a0: 612e 4e75 6d62 6572 2c20 6461 7461 2e52  a.Number, data.R
+000151b0: 6573 6973 7461 6e63 652c 206c 6162 656c  esistance, label
+000151c0: 3d22 5265 7322 290a 2020 2020 2020 2020  ="Res").        
+000151d0: 6178 322e 706c 6f74 2864 6174 612e 4e75  ax2.plot(data.Nu
+000151e0: 6d62 6572 2c20 6461 7461 2e53 7570 706f  mber, data.Suppo
+000151f0: 7274 2c20 6c61 6265 6c3d 2253 7570 2229  rt, label="Sup")
+00015200: 0a0a 2020 2020 2020 2020 706c 742e 6c65  ..        plt.le
+00015210: 6765 6e64 2829 0a20 2020 2020 2020 2070  gend().        p
+00015220: 6c74 2e67 7269 6428 290a 2020 2020 2020  lt.grid().      
+00015230: 2020 706c 742e 7368 6f77 2829 0a20 2020    plt.show().   
+00015240: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00015250: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00015260: 2020 2023 2040 6d65 6173 7572 655f 7469     # @measure_ti
+00015270: 6d65 0a20 2020 2064 6566 2066 696e 6455  me.    def findU
+00015280: 7074 7265 6e64 2873 656c 662c 2064 662c  ptrend(self, df,
+00015290: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
+000152a0: 6544 6963 742c 2074 6573 7469 6e67 2c20  eDict, testing, 
+000152b0: 7374 6f63 6b2c 6f6e 6c79 4d46 3d46 616c  stock,onlyMF=Fal
+000152c0: 7365 2c68 6f73 7444 6174 613d 4e6f 6e65  se,hostData=None
+000152d0: 2c65 7863 6861 6e67 654e 616d 653d 2249  ,exchangeName="I
+000152e0: 4e44 4941 222c 7265 6672 6573 684d 4641  NDIA",refreshMFA
+000152f0: 6e64 4656 3d54 7275 6529 3a0a 2020 2020  ndFV=True):.    
+00015300: 2020 2020 2320 7368 6f75 6c64 5072 6f63      # shouldProc
+00015310: 6565 6420 3d20 5472 7565 0a20 2020 2020  eed = True.     
+00015320: 2020 2069 7355 7074 7265 6e64 203d 2046     isUptrend = F
+00015330: 616c 7365 0a20 2020 2020 2020 2069 7344  alse.        isD
+00015340: 6f77 6e74 7265 6e64 203d 2046 616c 7365  owntrend = False
+00015350: 0a20 2020 2020 2020 2069 7335 3044 4d41  .        is50DMA
+00015360: 5570 7472 656e 6420 3d20 4661 6c73 650a  Uptrend = False.
+00015370: 2020 2020 2020 2020 6973 3530 444d 4144          is50DMAD
+00015380: 6f77 6e74 7265 6e64 203d 2046 616c 7365  owntrend = False
+00015390: 0a20 2020 2020 2020 2064 6563 6973 696f  .        decisio
+000153a0: 6e20 3d20 2222 0a20 2020 2020 2020 2064  n = "".        d
+000153b0: 6d61 3530 6465 6369 7369 6f6e 203d 2022  ma50decision = "
+000153c0: 220a 2020 2020 2020 2020 6661 6972 5661  ".        fairVa
+000153d0: 6c75 6520 3d20 300a 2020 2020 2020 2020  lue = 0.        
+000153e0: 6661 6972 5661 6c75 6544 6966 6620 3d20  fairValueDiff = 
+000153f0: 300a 2020 2020 2020 2020 2320 6966 2064  0.        # if d
+00015400: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
+00015410: 2864 6629 203c 2032 3230 206f 7220 7465  (df) < 220 or te
+00015420: 7374 696e 673a 0a20 2020 2020 2020 2023  sting:.        #
+00015430: 2020 2020 2073 686f 756c 6450 726f 6365       shouldProce
+00015440: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+00015450: 2020 2069 6620 6466 2069 7320 6e6f 7420     if df is not 
+00015460: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00015470: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00015480: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
+00015490: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+000154a0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+000154b0: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
+000154c0: 2020 2020 2020 2020 2020 746f 6461 795f            today_
+000154d0: 736d 6120 3d20 706b 7461 6c69 622e 534d  sma = pktalib.SM
+000154e0: 4128 6461 7461 5b22 436c 6f73 6522 5d2c  A(data["Close"],
+000154f0: 2074 696d 6570 6572 696f 643d 3530 290a   timeperiod=50).
+00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015510: 736d 615f 6d69 6e75 7339 203d 2070 6b74  sma_minus9 = pkt
+00015520: 616c 6962 2e53 4d41 2864 6174 612e 6865  alib.SMA(data.he
+00015530: 6164 286c 656e 2864 6174 6129 2d39 295b  ad(len(data)-9)[
+00015540: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
+00015550: 7269 6f64 3d35 3029 0a20 2020 2020 2020  riod=50).       
+00015560: 2020 2020 2020 2020 2073 6d61 5f6d 696e           sma_min
+00015570: 7573 3134 203d 2070 6b74 616c 6962 2e53  us14 = pktalib.S
+00015580: 4d41 2864 6174 612e 6865 6164 286c 656e  MA(data.head(len
+00015590: 2864 6174 6129 2d31 3429 5b22 436c 6f73  (data)-14)["Clos
+000155a0: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+000155b0: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
+000155c0: 2020 2020 736d 615f 6d69 6e75 7332 3020      sma_minus20 
+000155d0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+000155e0: 7461 2e68 6561 6428 6c65 6e28 6461 7461  ta.head(len(data
+000155f0: 292d 3230 295b 2243 6c6f 7365 225d 2c20  )-20)["Close"], 
+00015600: 7469 6d65 7065 7269 6f64 3d35 3029 0a20  timeperiod=50). 
+00015610: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00015620: 6f64 6179 5f6c 6d61 203d 2070 6b74 616c  oday_lma = pktal
+00015630: 6962 2e53 4d41 2864 6174 615b 2243 6c6f  ib.SMA(data["Clo
+00015640: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
+00015650: 3d32 3030 290a 2020 2020 2020 2020 2020  =200).          
+00015660: 2020 2020 2020 6c6d 615f 6d69 6e75 7332        lma_minus2
+00015670: 3020 3d20 706b 7461 6c69 622e 534d 4128  0 = pktalib.SMA(
+00015680: 6461 7461 2e68 6561 6428 6c65 6e28 6461  data.head(len(da
+00015690: 7461 292d 3230 295b 2243 6c6f 7365 225d  ta)-20)["Close"]
+000156a0: 2c20 7469 6d65 7065 7269 6f64 3d32 3030  , timeperiod=200
+000156b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000156c0: 2020 6c6d 615f 6d69 6e75 7338 3020 3d20    lma_minus80 = 
+000156d0: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
+000156e0: 2e68 6561 6428 6c65 6e28 6461 7461 292d  .head(len(data)-
+000156f0: 3830 295b 2243 6c6f 7365 225d 2c20 7469  80)["Close"], ti
+00015700: 6d65 7065 7269 6f64 3d32 3030 290a 2020  meperiod=200).  
+00015710: 2020 2020 2020 2020 2020 2020 2020 6c6d                lm
+00015720: 615f 6d69 6e75 7331 3030 203d 2070 6b74  a_minus100 = pkt
+00015730: 616c 6962 2e53 4d41 2864 6174 612e 6865  alib.SMA(data.he
+00015740: 6164 286c 656e 2864 6174 6129 2d31 3030  ad(len(data)-100
+00015750: 295b 2243 6c6f 7365 225d 2c20 7469 6d65  )["Close"], time
+00015760: 7065 7269 6f64 3d32 3030 290a 2020 2020  period=200).    
+00015770: 2020 2020 2020 2020 2020 2020 746f 6461              toda
+00015780: 795f 6c6d 6120 3d20 746f 6461 795f 6c6d  y_lma = today_lm
+00015790: 612e 696c 6f63 5b6c 656e 2874 6f64 6179  a.iloc[len(today
+000157a0: 5f6c 6d61 292d 315d 2069 6620 746f 6461  _lma)-1] if toda
+000157b0: 795f 6c6d 6120 6973 206e 6f74 204e 6f6e  y_lma is not Non
+000157c0: 6520 656c 7365 2030 0a20 2020 2020 2020  e else 0.       
+000157d0: 2020 2020 2020 2020 206c 6d61 5f6d 696e           lma_min
+000157e0: 7573 3230 203d 206c 6d61 5f6d 696e 7573  us20 = lma_minus
+000157f0: 3230 2e69 6c6f 635b 6c65 6e28 6c6d 615f  20.iloc[len(lma_
+00015800: 6d69 6e75 7332 3029 2d31 5d20 6966 206c  minus20)-1] if l
+00015810: 6d61 5f6d 696e 7573 3230 2069 7320 6e6f  ma_minus20 is no
+00015820: 7420 4e6f 6e65 2065 6c73 6520 300a 2020  t None else 0.  
+00015830: 2020 2020 2020 2020 2020 2020 2020 6c6d                lm
+00015840: 615f 6d69 6e75 7338 3020 3d20 6c6d 615f  a_minus80 = lma_
+00015850: 6d69 6e75 7338 302e 696c 6f63 5b6c 656e  minus80.iloc[len
+00015860: 286c 6d61 5f6d 696e 7573 3830 292d 315d  (lma_minus80)-1]
+00015870: 2069 6620 6c6d 615f 6d69 6e75 7338 3020   if lma_minus80 
+00015880: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+00015890: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+000158a0: 2020 206c 6d61 5f6d 696e 7573 3130 3020     lma_minus100 
+000158b0: 3d20 6c6d 615f 6d69 6e75 7331 3030 2e69  = lma_minus100.i
+000158c0: 6c6f 635b 6c65 6e28 6c6d 615f 6d69 6e75  loc[len(lma_minu
+000158d0: 7331 3030 292d 315d 2069 6620 6c6d 615f  s100)-1] if lma_
+000158e0: 6d69 6e75 7331 3030 2069 7320 6e6f 7420  minus100 is not 
+000158f0: 4e6f 6e65 2065 6c73 6520 300a 2020 2020  None else 0.    
+00015900: 2020 2020 2020 2020 2020 2020 746f 6461              toda
+00015910: 795f 736d 6120 3d20 746f 6461 795f 736d  y_sma = today_sm
+00015920: 612e 696c 6f63 5b6c 656e 2874 6f64 6179  a.iloc[len(today
+00015930: 5f73 6d61 292d 315d 2069 6620 746f 6461  _sma)-1] if toda
+00015940: 795f 736d 6120 6973 206e 6f74 204e 6f6e  y_sma is not Non
+00015950: 6520 656c 7365 2030 0a20 2020 2020 2020  e else 0.       
+00015960: 2020 2020 2020 2020 2073 6d61 5f6d 696e           sma_min
+00015970: 7573 3920 3d20 736d 615f 6d69 6e75 7339  us9 = sma_minus9
+00015980: 2e69 6c6f 635b 6c65 6e28 736d 615f 6d69  .iloc[len(sma_mi
+00015990: 6e75 7339 292d 315d 2069 6620 736d 615f  nus9)-1] if sma_
+000159a0: 6d69 6e75 7339 2069 7320 6e6f 7420 4e6f  minus9 is not No
+000159b0: 6e65 2065 6c73 6520 300a 2020 2020 2020  ne else 0.      
+000159c0: 2020 2020 2020 2020 2020 736d 615f 6d69            sma_mi
+000159d0: 6e75 7331 3420 3d20 736d 615f 6d69 6e75  nus14 = sma_minu
+000159e0: 7331 342e 696c 6f63 5b6c 656e 2873 6d61  s14.iloc[len(sma
+000159f0: 5f6d 696e 7573 3134 292d 315d 2069 6620  _minus14)-1] if 
+00015a00: 736d 615f 6d69 6e75 7331 3420 6973 206e  sma_minus14 is n
+00015a10: 6f74 204e 6f6e 6520 656c 7365 2030 0a20  ot None else 0. 
+00015a20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015a30: 6d61 5f6d 696e 7573 3230 203d 2073 6d61  ma_minus20 = sma
+00015a40: 5f6d 696e 7573 3230 2e69 6c6f 635b 6c65  _minus20.iloc[le
+00015a50: 6e28 736d 615f 6d69 6e75 7332 3029 2d31  n(sma_minus20)-1
+00015a60: 5d20 6966 2073 6d61 5f6d 696e 7573 3230  ] if sma_minus20
+00015a70: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+00015a80: 6520 300a 2020 2020 2020 2020 2020 2020  e 0.            
+00015a90: 2020 2020 6973 5570 7472 656e 6420 3d20      isUptrend = 
+00015aa0: 2874 6f64 6179 5f6c 6d61 203e 206c 6d61  (today_lma > lma
+00015ab0: 5f6d 696e 7573 3230 2920 6f72 2028 746f  _minus20) or (to
+00015ac0: 6461 795f 6c6d 6120 3e20 6c6d 615f 6d69  day_lma > lma_mi
+00015ad0: 6e75 7338 3029 206f 7220 2874 6f64 6179  nus80) or (today
+00015ae0: 5f6c 6d61 203e 206c 6d61 5f6d 696e 7573  _lma > lma_minus
+00015af0: 3130 3029 0a20 2020 2020 2020 2020 2020  100).           
+00015b00: 2020 2020 2069 7344 6f77 6e74 7265 6e64       isDowntrend
+00015b10: 203d 2028 746f 6461 795f 6c6d 6120 3c20   = (today_lma < 
+00015b20: 6c6d 615f 6d69 6e75 7332 3029 2061 6e64  lma_minus20) and
+00015b30: 2028 746f 6461 795f 6c6d 6120 3c20 6c6d   (today_lma < lm
+00015b40: 615f 6d69 6e75 7338 3029 2061 6e64 2028  a_minus80) and (
+00015b50: 746f 6461 795f 6c6d 6120 3c20 6c6d 615f  today_lma < lma_
+00015b60: 6d69 6e75 7331 3030 290a 2020 2020 2020  minus100).      
+00015b70: 2020 2020 2020 2020 2020 6973 3530 444d            is50DM
+00015b80: 4155 7074 7265 6e64 203d 2028 746f 6461  AUptrend = (toda
+00015b90: 795f 736d 6120 3e20 736d 615f 6d69 6e75  y_sma > sma_minu
+00015ba0: 7339 2920 6f72 2028 746f 6461 795f 736d  s9) or (today_sm
+00015bb0: 6120 3e20 736d 615f 6d69 6e75 7331 3429  a > sma_minus14)
+00015bc0: 206f 7220 2874 6f64 6179 5f73 6d61 203e   or (today_sma >
+00015bd0: 2073 6d61 5f6d 696e 7573 3230 290a 2020   sma_minus20).  
+00015be0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00015bf0: 3530 444d 4144 6f77 6e74 7265 6e64 203d  50DMADowntrend =
+00015c00: 2028 746f 6461 795f 736d 6120 3c20 736d   (today_sma < sm
+00015c10: 615f 6d69 6e75 7339 2920 616e 6420 2874  a_minus9) and (t
+00015c20: 6f64 6179 5f73 6d61 203c 2073 6d61 5f6d  oday_sma < sma_m
+00015c30: 696e 7573 3134 2920 616e 6420 2874 6f64  inus14) and (tod
+00015c40: 6179 5f73 6d61 203c 2073 6d61 5f6d 696e  ay_sma < sma_min
+00015c50: 7573 3230 290a 2020 2020 2020 2020 2020  us20).          
+00015c60: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00015c70: 6f6e 3a20 2023 2070 7261 676d 613a 206e  on:  # pragma: n
+00015c80: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00015c90: 2020 2020 2020 2020 2320 7365 6c66 2e64          # self.d
+00015ca0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+00015cb0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+00015cc0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00015cd0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00015ce0: 2020 2064 6563 6973 696f 6e20 3d20 2754     decision = 'T
+00015cf0: 3ae2 96b2 2720 6966 2069 7355 7074 7265  :...' if isUptre
+00015d00: 6e64 2065 6c73 6520 2827 543a e296 bc27  nd else ('T:...'
+00015d10: 2069 6620 6973 446f 776e 7472 656e 6420   if isDowntrend 
+00015d20: 656c 7365 2027 2729 0a20 2020 2020 2020  else '').       
+00015d30: 2064 6d61 3530 6465 6369 7369 6f6e 203d   dma50decision =
+00015d40: 2027 743a e296 b227 2069 6620 6973 3530   't:...' if is50
+00015d50: 444d 4155 7074 7265 6e64 2065 6c73 6520  DMAUptrend else 
+00015d60: 2827 743a e296 bc27 2069 6620 6973 3530  ('t:...' if is50
+00015d70: 444d 4144 6f77 6e74 7265 6e64 2065 6c73  DMADowntrend els
+00015d80: 6520 2727 290a 2020 2020 2020 2020 6d66  e '').        mf
+00015d90: 5f69 6e73 745f 6f77 6e65 7273 6869 7043  _inst_ownershipC
+00015da0: 6861 6e67 6520 3d20 300a 2020 2020 2020  hange = 0.      
+00015db0: 2020 6368 616e 6765 5f6d 696c 6c69 6f6e    change_million
+00015dc0: 7320 3d22 220a 2020 2020 2020 2020 6d66  s ="".        mf
+00015dd0: 203d 2022 220a 2020 2020 2020 2020 6d66   = "".        mf
+00015de0: 7320 3d20 2222 0a20 2020 2020 2020 2069  s = "".        i
+00015df0: 6620 7265 6672 6573 684d 4641 6e64 4656  f refreshMFAndFV
+00015e00: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00015e10: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00015e20: 2020 206d 665f 696e 7374 5f6f 776e 6572     mf_inst_owner
+00015e30: 7368 6970 4368 616e 6765 203d 2073 656c  shipChange = sel
+00015e40: 662e 6765 744d 7574 7561 6c46 756e 6453  f.getMutualFundS
+00015e50: 7461 7475 7328 7374 6f63 6b2c 6f6e 6c79  tatus(stock,only
+00015e60: 4d46 3d6f 6e6c 794d 462c 686f 7374 4461  MF=onlyMF,hostDa
+00015e70: 7461 3d68 6f73 7444 6174 612c 666f 7263  ta=hostData,forc
+00015e80: 653d 2868 6f73 7444 6174 6120 6973 204e  e=(hostData is N
+00015e90: 6f6e 6520 6f72 2068 6f73 7444 6174 612e  one or hostData.
+00015ea0: 656d 7074 7920 6f72 206e 6f74 2028 224d  empty or not ("M
+00015eb0: 4622 2069 6e20 686f 7374 4461 7461 2e63  F" in hostData.c
+00015ec0: 6f6c 756d 6e73 206f 7220 2246 4949 2220  olumns or "FII" 
+00015ed0: 696e 2068 6f73 7444 6174 612e 636f 6c75  in hostData.colu
+00015ee0: 6d6e 7329 292c 6578 6368 616e 6765 4e61  mns)),exchangeNa
+00015ef0: 6d65 3d65 7863 6861 6e67 654e 616d 6529  me=exchangeName)
+00015f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015f10: 2069 6620 6973 696e 7374 616e 6365 286d   if isinstance(m
+00015f20: 665f 696e 7374 5f6f 776e 6572 7368 6970  f_inst_ownership
+00015f30: 4368 616e 6765 2c20 7064 2e53 6572 6965  Change, pd.Serie
+00015f40: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00015f50: 2020 2020 2020 2020 6d66 5f69 6e73 745f          mf_inst_
+00015f60: 6f77 6e65 7273 6869 7043 6861 6e67 6520  ownershipChange 
+00015f70: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00015f80: 2020 2020 726f 756e 644f 6666 203d 2032      roundOff = 2
+00015f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015fa0: 206d 696c 6c69 6f6e 7320 3d20 726f 756e   millions = roun
+00015fb0: 6428 6d66 5f69 6e73 745f 6f77 6e65 7273  d(mf_inst_owners
+00015fc0: 6869 7043 6861 6e67 652f 3130 3030 3030  hipChange/100000
+00015fd0: 302c 726f 756e 644f 6666 290a 2020 2020  0,roundOff).    
+00015fe0: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00015ff0: 6520 666c 6f61 7428 6d69 6c6c 696f 6e73  e float(millions
+00016000: 2920 3d3d 2030 2061 6e64 2072 6f75 6e64  ) == 0 and round
+00016010: 4f66 6620 3c3d 353a 0a20 2020 2020 2020  Off <=5:.       
+00016020: 2020 2020 2020 2020 2020 2020 2072 6f75               rou
+00016030: 6e64 4f66 6620 2b3d 310a 2020 2020 2020  ndOff +=1.      
+00016040: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00016050: 6c6c 696f 6e73 203d 2072 6f75 6e64 286d  llions = round(m
+00016060: 665f 696e 7374 5f6f 776e 6572 7368 6970  f_inst_ownership
+00016070: 4368 616e 6765 2f31 3030 3030 3030 2c72  Change/1000000,r
+00016080: 6f75 6e64 4f66 6629 0a20 2020 2020 2020  oundOff).       
+00016090: 2020 2020 2020 2020 2063 6861 6e67 655f           change_
+000160a0: 6d69 6c6c 696f 6e73 203d 2066 2228 7b6d  millions = f"({m
+000160b0: 696c 6c69 6f6e 737d 4d29 220a 2020 2020  illions}M)".    
+000160c0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000160d0: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+000160e0: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+000160f0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+00016100: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00016110: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+00016120: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+00016130: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016140: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00016150: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00016160: 2020 2020 2023 4c65 7427 7320 6765 7420       #Let's get 
+00016170: 7468 6520 6661 6972 2076 616c 7565 2c20  the fair value, 
+00016180: 6569 7468 6572 2073 6176 6564 206f 7220  either saved or 
+00016190: 6672 6573 6820 6672 6f6d 2073 6572 7669  fresh from servi
+000161a0: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+000161b0: 2020 2066 6169 7256 616c 7565 203d 2073     fairValue = s
+000161c0: 656c 662e 6765 7446 6169 7256 616c 7565  elf.getFairValue
+000161d0: 2873 746f 636b 2c68 6f73 7444 6174 612c  (stock,hostData,
+000161e0: 666f 7263 653d 2868 6f73 7444 6174 6120  force=(hostData 
+000161f0: 6973 204e 6f6e 6520 6f72 2068 6f73 7444  is None or hostD
+00016200: 6174 612e 656d 7074 7920 6f72 2022 4661  ata.empty or "Fa
+00016210: 6972 5661 6c75 6522 206e 6f74 2069 6e20  irValue" not in 
+00016220: 686f 7374 4461 7461 2e63 6f6c 756d 6e73  hostData.columns
+00016230: 292c 6578 6368 616e 6765 4e61 6d65 3d65  ),exchangeName=e
+00016240: 7863 6861 6e67 654e 616d 6529 0a20 2020  xchangeName).   
+00016250: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016260: 6661 6972 5661 6c75 6520 6973 206e 6f74  fairValue is not
+00016270: 204e 6f6e 6520 616e 6420 6661 6972 5661   None and fairVa
+00016280: 6c75 6520 213d 2030 3a0a 2020 2020 2020  lue != 0:.      
+00016290: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
+000162a0: 7020 3d20 7361 7665 4469 6374 5b22 4c54  p = saveDict["LT
+000162b0: 5022 5d0a 2020 2020 2020 2020 2020 2020  P"].            
+000162c0: 2020 2020 2020 2020 6661 6972 5661 6c75          fairValu
+000162d0: 6544 6966 6620 3d20 726f 756e 6428 6661  eDiff = round(fa
+000162e0: 6972 5661 6c75 6520 2d20 6c74 702c 3029  irValue - ltp,0)
+000162f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016300: 2020 2020 2073 6176 6544 6963 745b 2246       saveDict["F
+00016310: 6169 7256 616c 7565 225d 203d 2073 7472  airValue"] = str
+00016320: 2866 6169 7256 616c 7565 290a 2020 2020  (fairValue).    
+00016330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016340: 7361 7665 4469 6374 5b22 4656 4469 6666  saveDict["FVDiff
+00016350: 225d 203d 2066 6169 7256 616c 7565 4469  "] = fairValueDi
+00016360: 6666 0a20 2020 2020 2020 2020 2020 2020  ff.             
+00016370: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00016380: 745b 2246 5644 6966 6622 5d20 3d20 6661  t["FVDiff"] = fa
+00016390: 6972 5661 6c75 6544 6966 660a 2020 2020  irValueDiff.    
+000163a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163b0: 7363 7265 656e 4469 6374 5b22 4661 6972  screenDict["Fair
+000163c0: 5661 6c75 6522 5d20 3d20 2863 6f6c 6f72  Value"] = (color
+000163d0: 5465 7874 2e47 5245 454e 2069 6620 6661  Text.GREEN if fa
+000163e0: 6972 5661 6c75 6520 3e3d 206c 7470 2065  irValue >= ltp e
+000163f0: 6c73 6520 636f 6c6f 7254 6578 742e 4641  lse colorText.FA
+00016400: 494c 2920 2b20 7361 7665 4469 6374 5b22  IL) + saveDict["
+00016410: 4661 6972 5661 6c75 6522 5d20 2b20 636f  FairValue"] + co
+00016420: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00016430: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00016440: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+00016450: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+00016460: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+00016470: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00016480: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+00016490: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+000164a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000164b0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+000164c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000164d0: 6d66 5f69 6e73 745f 6f77 6e65 7273 6869  mf_inst_ownershi
+000164e0: 7043 6861 6e67 6520 3e20 303a 0a20 2020  pChange > 0:.   
+000164f0: 2020 2020 2020 2020 2020 2020 206d 6620               mf 
+00016500: 3d20 6622 4d46 493a e296 b220 7b63 6861  = f"MFI:... {cha
+00016510: 6e67 655f 6d69 6c6c 696f 6e73 7d22 0a20  nge_millions}". 
+00016520: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00016530: 6673 203d 2063 6f6c 6f72 5465 7874 2e47  fs = colorText.G
+00016540: 5245 454e 202b 206d 6620 2b20 636f 6c6f  REEN + mf + colo
+00016550: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00016560: 2020 2020 2020 656c 6966 206d 665f 696e        elif mf_in
+00016570: 7374 5f6f 776e 6572 7368 6970 4368 616e  st_ownershipChan
+00016580: 6765 203c 2030 3a0a 2020 2020 2020 2020  ge < 0:.        
+00016590: 2020 2020 2020 2020 6d66 203d 2066 224d          mf = f"M
+000165a0: 4649 3ae2 96bc 207b 6368 616e 6765 5f6d  FI:... {change_m
+000165b0: 696c 6c69 6f6e 737d 220a 2020 2020 2020  illions}".      
+000165c0: 2020 2020 2020 2020 2020 6d66 7320 3d20            mfs = 
+000165d0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+000165e0: 206d 6620 2b20 636f 6c6f 7254 6578 742e   mf + colorText.
+000165f0: 454e 440a 0a20 2020 2020 2020 2073 6176  END..        sav
+00016600: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+00016610: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+00016620: 7363 7265 656e 4469 6374 2c73 6176 6544  screenDict,saveD
+00016630: 6963 742c 2254 7265 6e64 2229 0a20 2020  ict,"Trend").   
+00016640: 2020 2020 2064 6563 6973 696f 6e5f 7363       decision_sc
+00016650: 7220 3d20 2863 6f6c 6f72 5465 7874 2e47  r = (colorText.G
+00016660: 5245 454e 2069 6620 6973 5570 7472 656e  REEN if isUptren
+00016670: 6420 656c 7365 2028 636f 6c6f 7254 6578  d else (colorTex
+00016680: 742e 4641 494c 2069 6620 6973 446f 776e  t.FAIL if isDown
+00016690: 7472 656e 6420 656c 7365 2063 6f6c 6f72  trend else color
+000166a0: 5465 7874 2e57 4152 4e29 2920 2b20 6622  Text.WARN)) + f"
+000166b0: 7b64 6563 6973 696f 6e7d 2220 2b20 636f  {decision}" + co
+000166c0: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+000166d0: 2020 2020 646d 6135 3064 6563 6973 696f      dma50decisio
+000166e0: 6e5f 7363 7220 3d20 2863 6f6c 6f72 5465  n_scr = (colorTe
+000166f0: 7874 2e47 5245 454e 2069 6620 6973 3530  xt.GREEN if is50
+00016700: 444d 4155 7074 7265 6e64 2065 6c73 6520  DMAUptrend else 
+00016710: 2863 6f6c 6f72 5465 7874 2e46 4149 4c20  (colorText.FAIL 
+00016720: 6966 2069 7335 3044 4d41 446f 776e 7472  if is50DMADowntr
+00016730: 656e 6420 656c 7365 2063 6f6c 6f72 5465  end else colorTe
+00016740: 7874 2e57 4152 4e29 2920 2b20 6622 7b64  xt.WARN)) + f"{d
+00016750: 6d61 3530 6465 6369 7369 6f6e 7d22 202b  ma50decision}" +
+00016760: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00016770: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00016780: 2254 7265 6e64 225d 203d 2066 227b 7361  "Trend"] = f"{sa
+00016790: 7665 645b 315d 7d20 7b64 6563 6973 696f  ved[1]} {decisio
+000167a0: 6e7d 207b 646d 6135 3064 6563 6973 696f  n} {dma50decisio
+000167b0: 6e7d 207b 6d66 7d22 0a20 2020 2020 2020  n} {mf}".       
+000167c0: 2073 6372 6565 6e44 6963 745b 2254 7265   screenDict["Tre
+000167d0: 6e64 225d 203d 2066 227b 7361 7665 645b  nd"] = f"{saved[
+000167e0: 305d 7d20 7b64 6563 6973 696f 6e5f 7363  0]} {decision_sc
+000167f0: 727d 207b 646d 6135 3064 6563 6973 696f  r} {dma50decisio
+00016800: 6e5f 7363 727d 207b 6d66 737d 220a 2020  n_scr} {mfs}".  
+00016810: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00016820: 4d46 4922 5d20 3d20 6d66 5f69 6e73 745f  MFI"] = mf_inst_
+00016830: 6f77 6e65 7273 6869 7043 6861 6e67 650a  ownershipChange.
+00016840: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+00016850: 6374 5b22 4d46 4922 5d20 3d20 6d66 5f69  ct["MFI"] = mf_i
+00016860: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
+00016870: 6e67 650a 2020 2020 2020 2020 7265 7475  nge.        retu
+00016880: 726e 2069 7355 7074 7265 6e64 2c20 6d66  rn isUptrend, mf
+00016890: 5f69 6e73 745f 6f77 6e65 7273 6869 7043  _inst_ownershipC
+000168a0: 6861 6e67 652c 2066 6169 7256 616c 7565  hange, fairValue
+000168b0: 4469 6666 0a20 2020 200a 2020 2020 2320  Diff.    .    # 
+000168c0: 5072 6976 6174 6520 6d65 7468 6f64 2074  Private method t
+000168d0: 6f20 6669 6e64 2063 616e 646c 6520 7479  o find candle ty
+000168e0: 7065 0a20 2020 2023 2054 7275 6520 3d20  pe.    # True = 
+000168f0: 4275 6c6c 6973 682c 2046 616c 7365 203d  Bullish, False =
+00016900: 2042 6561 7269 7368 0a20 2020 2064 6566   Bearish.    def
+00016910: 2067 6574 4361 6e64 6c65 5479 7065 2873   getCandleType(s
+00016920: 656c 662c 2064 6169 6c79 4461 7461 293a  elf, dailyData):
+00016930: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016940: 626f 6f6c 2864 6169 6c79 4461 7461 5b22  bool(dailyData["
+00016950: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+00016960: 3e3d 2064 6169 6c79 4461 7461 5b22 4f70  >= dailyData["Op
+00016970: 656e 225d 2e69 6c6f 635b 305d 290a 0a20  en"].iloc[0]).. 
+00016980: 2020 2064 6566 2067 6574 4361 6e64 6c65     def getCandle
+00016990: 426f 6479 4865 6967 6874 2873 656c 662c  BodyHeight(self,
+000169a0: 2064 6169 6c79 4461 7461 293a 0a20 2020   dailyData):.   
+000169b0: 2020 2020 2062 6f64 7948 6569 6768 7420       bodyHeight 
+000169c0: 3d20 6461 696c 7944 6174 615b 2243 6c6f  = dailyData["Clo
+000169d0: 7365 225d 2e69 6c6f 635b 305d 202d 2064  se"].iloc[0] - d
+000169e0: 6169 6c79 4461 7461 5b22 4f70 656e 225d  ailyData["Open"]
+000169f0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00016a00: 2072 6574 7572 6e20 626f 6479 4865 6967   return bodyHeig
+00016a10: 6874 0a0a 2020 2020 6465 6620 6765 7446  ht..    def getF
+00016a20: 6169 7256 616c 7565 2873 656c 662c 2073  airValue(self, s
+00016a30: 746f 636b 2c20 686f 7374 4461 7461 3d4e  tock, hostData=N
+00016a40: 6f6e 652c 2066 6f72 6365 3d46 616c 7365  one, force=False
+00016a50: 2c65 7863 6861 6e67 654e 616d 653d 2249  ,exchangeName="I
+00016a60: 4e44 4941 2229 3a0a 2020 2020 2020 2020  NDIA"):.        
+00016a70: 6966 2068 6f73 7444 6174 6120 6973 204e  if hostData is N
+00016a80: 6f6e 6520 6f72 206c 656e 2868 6f73 7444  one or len(hostD
+00016a90: 6174 6129 203c 2031 3a0a 2020 2020 2020  ata) < 1:.      
+00016aa0: 2020 2020 2020 686f 7374 4461 7461 203d        hostData =
+00016ab0: 2070 642e 4461 7461 4672 616d 6528 290a   pd.DataFrame().
+00016ac0: 2020 2020 2020 2020 2320 4c65 7427 7320          # Let's 
+00016ad0: 6c6f 6f6b 2066 6f72 2066 6169 7220 7661  look for fair va
+00016ae0: 6c75 6573 0a20 2020 2020 2020 2066 6169  lues.        fai
+00016af0: 7256 616c 7565 203d 2030 0a20 2020 2020  rValue = 0.     
+00016b00: 2020 2069 6620 2246 6169 7256 616c 7565     if "FairValue
+00016b10: 2220 696e 2068 6f73 7444 6174 612e 636f  " in hostData.co
+00016b20: 6c75 6d6e 7320 616e 6420 504b 4461 7465  lumns and PKDate
+00016b30: 5574 696c 6974 6965 732e 6375 7272 656e  Utilities.curren
+00016b40: 7444 6174 6554 696d 6528 292e 7765 656b  tDateTime().week
+00016b50: 6461 7928 2920 3c3d 2034 3a0a 2020 2020  day() <= 4:.    
+00016b60: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00016b70: 2020 2020 2020 2020 2020 2020 2066 6169               fai
+00016b80: 7256 616c 7565 203d 2068 6f73 7444 6174  rValue = hostDat
+00016b90: 612e 6c6f 635b 686f 7374 4461 7461 2e69  a.loc[hostData.i
+00016ba0: 6e64 6578 5b2d 315d 2c22 4661 6972 5661  ndex[-1],"FairVa
+00016bb0: 6c75 6522 5d0a 2020 2020 2020 2020 2020  lue"].          
+00016bc0: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00016bd0: 6f72 2c49 6e64 6578 4572 726f 7229 3a0a  or,IndexError):.
+00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bf0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00016c00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016c10: 2020 2069 6620 504b 4461 7465 5574 696c     if PKDateUtil
+00016c20: 6974 6965 732e 6375 7272 656e 7444 6174  ities.currentDat
+00016c30: 6554 696d 6528 292e 7765 656b 6461 7928  eTime().weekday(
+00016c40: 2920 3e3d 2035 206f 7220 666f 7263 653a  ) >= 5 or force:
+00016c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c60: 2073 6563 7572 6974 7920 3d20 4e6f 6e65   security = None
+00016c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c80: 2023 2052 6566 7265 7368 2065 6163 6820   # Refresh each 
+00016c90: 7361 7475 7264 6179 206f 7220 7375 6e64  saturday or sund
+00016ca0: 6179 206f 7220 7768 656e 206e 6f74 2066  ay or when not f
+00016cb0: 6f75 6e64 2069 6e20 7361 7665 6420 6461  ound in saved da
+00016cc0: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
+00016cd0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00016ce0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00016cf0: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
+00016d00: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
+00016d10: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
+00016d20: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
+00016d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d40: 2020 2020 2073 6563 7572 6974 7920 3d20       security = 
+00016d50: 5374 6f63 6b28 7374 6f63 6b2c 6578 6368  Stock(stock,exch
+00016d60: 616e 6765 3d65 7863 6861 6e67 654e 616d  ange=exchangeNam
+00016d70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00016d80: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
+00016d90: 7272 6f72 3a20 2320 7072 6167 6d61 3a20  rror: # pragma: 
+00016da0: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
+00016db0: 2020 2020 2020 2020 2020 2020 2023 2057               # W
+00016dc0: 6520 6469 6420 6e6f 7420 6669 6e64 2074  e did not find t
+00016dd0: 6865 2073 746f 636b 3f20 4974 2773 206f  he stock? It's o
+00016de0: 6b61 792e 204d 6f76 6520 6f6e 2074 6f20  kay. Move on to 
+00016df0: 7468 6520 6e65 7874 206f 6e65 2e0a 2020  the next one..  
+00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e10: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+00016e20: 2020 2020 2020 2065 7863 6570 7420 2854         except (T
+00016e30: 696d 656f 7574 4572 726f 722c 2043 6f6e  imeoutError, Con
+00016e40: 6e65 6374 696f 6e45 7272 6f72 2920 6173  nectionError) as
+00016e50: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00016e60: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
+00016e70: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
+00016e80: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
+00016e90: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00016ea0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00016eb0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00016ec0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00016ed0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00016ee0: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
+00016ef0: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
+00016f00: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
+00016f10: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00016f20: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00016f30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016f40: 7365 6375 7269 7479 2069 7320 6e6f 7420  security is not 
+00016f50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00016f60: 2020 2020 2020 2020 2020 7769 7468 2053            with S
+00016f70: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
+00016f80: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
+00016f90: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
+00016fa0: 6f75 743d 5472 7565 293a 0a20 2020 2020  out=True):.     
+00016fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fc0: 2020 2066 7620 3d20 7365 6375 7269 7479     fv = security
+00016fd0: 2e66 6169 7256 616c 7565 2829 0a20 2020  .fairValue().   
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ff0: 2069 6620 6676 2069 7320 6e6f 7420 4e6f   if fv is not No
+00017000: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00017010: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00017020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017030: 2020 2020 2020 2020 2020 2020 2066 7652               fvR
+00017040: 6573 706f 6e73 6556 616c 7565 203d 2066  esponseValue = f
+00017050: 765b 226c 6174 6573 7446 6169 7256 616c  v["latestFairVal
+00017060: 7565 225d 0a20 2020 2020 2020 2020 2020  ue"].           
+00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017080: 2069 6620 6676 5265 7370 6f6e 7365 5661   if fvResponseVa
+00017090: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
+000170a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000170b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170c0: 2066 6169 7256 616c 7565 203d 2066 6c6f   fairValue = flo
+000170d0: 6174 2866 7652 6573 706f 6e73 6556 616c  at(fvResponseVal
+000170e0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000170f0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00017100: 7074 3a20 2320 7072 6167 6d61 3a20 6e6f  pt: # pragma: no
+00017110: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+00017120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017130: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00017140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017150: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
+00017160: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+00017170: 6622 7b65 7d5c 6e52 6573 706f 6e73 653a  f"{e}\nResponse:
+00017180: 6676 3a5c 6e7b 6676 7d22 2c20 6578 635f  fv:\n{fv}", exc_
+00017190: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+000171a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000171b0: 6169 7256 616c 7565 203d 2072 6f75 6e64  airValue = round
+000171c0: 2866 6c6f 6174 2866 6169 7256 616c 7565  (float(fairValue
+000171d0: 292c 3129 0a20 2020 2020 2020 2020 2020  ),1).           
+000171e0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
 000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017200: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00017210: 2020 2020 7265 7475 726e 2066 6169 7256      return fairV
-00017220: 616c 7565 0a0a 2020 2020 6465 6620 6765  alue..    def ge
-00017230: 744d 7574 7561 6c46 756e 6453 7461 7475  tMutualFundStatu
-00017240: 7328 7365 6c66 2c20 7374 6f63 6b2c 6f6e  s(self, stock,on
-00017250: 6c79 4d46 3d46 616c 7365 2c20 686f 7374  lyMF=False, host
-00017260: 4461 7461 3d4e 6f6e 652c 2066 6f72 6365  Data=None, force
-00017270: 3d46 616c 7365 2c65 7863 6861 6e67 654e  =False,exchangeN
-00017280: 616d 653d 2249 4e44 4941 2229 3a0a 2020  ame="INDIA"):.  
-00017290: 2020 2020 2020 6966 2068 6f73 7444 6174        if hostDat
-000172a0: 6120 6973 204e 6f6e 6520 6f72 206c 656e  a is None or len
-000172b0: 2868 6f73 7444 6174 6129 203c 2031 3a0a  (hostData) < 1:.
-000172c0: 2020 2020 2020 2020 2020 2020 686f 7374              host
-000172d0: 4461 7461 203d 2070 642e 4461 7461 4672  Data = pd.DataFr
-000172e0: 616d 6528 290a 2020 2020 2020 2020 0a20  ame().        . 
-000172f0: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
-00017300: 4d46 203d 2030 0a20 2020 2020 2020 206e  MF = 0.        n
-00017310: 6574 4368 616e 6765 496e 7374 203d 2030  etChangeInst = 0
-00017320: 0a20 2020 2020 2020 206c 6174 6573 745f  .        latest_
-00017330: 6d66 6461 7465 203d 204e 6f6e 650a 2020  mfdate = None.  
-00017340: 2020 2020 2020 6c61 7465 7374 5f69 6e73        latest_ins
-00017350: 7464 6174 6520 3d20 4e6f 6e65 0a20 2020  tdate = None.   
-00017360: 2020 2020 206e 6565 6473 4672 6573 6855       needsFreshU
-00017370: 7064 6174 6520 3d20 5472 7565 0a20 2020  pdate = True.   
-00017380: 2020 2020 206c 6173 7444 6179 4c61 7374       lastDayLast
-00017390: 4d6f 6e74 6820 3d20 504b 4461 7465 5574  Month = PKDateUt
-000173a0: 696c 6974 6965 732e 6c61 7374 5f64 6179  ilities.last_day
-000173b0: 5f6f 665f 7072 6576 696f 7573 5f6d 6f6e  _of_previous_mon
-000173c0: 7468 2850 4b44 6174 6555 7469 6c69 7469  th(PKDateUtiliti
-000173d0: 6573 2e63 7572 7265 6e74 4461 7465 5469  es.currentDateTi
-000173e0: 6d65 2829 290a 2020 2020 2020 2020 6966  me()).        if
-000173f0: 2068 6f73 7444 6174 6120 6973 206e 6f74   hostData is not
-00017400: 204e 6f6e 6520 616e 6420 6c65 6e28 686f   None and len(ho
-00017410: 7374 4461 7461 2920 3e20 303a 0a20 2020  stData) > 0:.   
-00017420: 2020 2020 2020 2020 2069 6620 224d 4622           if "MF"
-00017430: 2069 6e20 686f 7374 4461 7461 2e63 6f6c   in hostData.col
-00017440: 756d 6e73 206f 7220 2246 4949 2220 696e  umns or "FII" in
-00017450: 2068 6f73 7444 6174 612e 636f 6c75 6d6e   hostData.column
-00017460: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00017470: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00017480: 2020 2020 2020 2020 2020 2020 6e65 7443              netC
-00017490: 6861 6e67 654d 4620 3d20 686f 7374 4461  hangeMF = hostDa
-000174a0: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-000174b0: 696e 6465 785b 2d31 5d2c 224d 4622 5d0a  index[-1],"MF"].
-000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174d0: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
-000174e0: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-00017510: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017530: 6e65 7443 6861 6e67 6549 6e73 7420 3d20  netChangeInst = 
-00017540: 686f 7374 4461 7461 2e6c 6f63 5b68 6f73  hostData.loc[hos
-00017550: 7444 6174 612e 696e 6465 785b 2d31 5d2c  tData.index[-1],
-00017560: 2246 4949 225d 0a20 2020 2020 2020 2020  "FII"].         
-00017570: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-00017580: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
-00017590: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-000175a0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-000175b0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-000175c0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000175d0: 2020 2020 2020 206c 6174 6573 745f 6d66         latest_mf
-000175e0: 6461 7465 203d 2068 6f73 7444 6174 612e  date = hostData.
-000175f0: 6c6f 635b 686f 7374 4461 7461 2e69 6e64  loc[hostData.ind
-00017600: 6578 5b2d 315d 2c22 4d46 5f44 6174 6522  ex[-1],"MF_Date"
-00017610: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00017620: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00017630: 6e63 6528 6c61 7465 7374 5f6d 6664 6174  nce(latest_mfdat
-00017640: 652c 2066 6c6f 6174 293a 0a20 2020 2020  e, float):.     
-00017650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017660: 2020 206c 6174 6573 745f 6d66 6461 7465     latest_mfdate
-00017670: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
-00017680: 7469 6d65 2e66 726f 6d74 696d 6573 7461  time.fromtimesta
-00017690: 6d70 286c 6174 6573 745f 6d66 6461 7465  mp(latest_mfdate
-000176a0: 292e 7374 7266 7469 6d65 2827 2559 2d25  ).strftime('%Y-%
-000176b0: 6d2d 2564 2729 0a20 2020 2020 2020 2020  m-%d').         
-000176c0: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-000176d0: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
-000176e0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-000176f0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-00017700: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00017710: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00017720: 2020 2020 2020 206c 6174 6573 745f 696e         latest_in
-00017730: 7374 6461 7465 203d 2068 6f73 7444 6174  stdate = hostDat
-00017740: 612e 6c6f 635b 686f 7374 4461 7461 2e69  a.loc[hostData.i
-00017750: 6e64 6578 5b2d 315d 2c22 4649 495f 4461  ndex[-1],"FII_Da
-00017760: 7465 225d 0a20 2020 2020 2020 2020 2020  te"].           
-00017770: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00017780: 7374 616e 6365 286c 6174 6573 745f 696e  stance(latest_in
-00017790: 7374 6461 7465 2c20 666c 6f61 7429 3a0a  stdate, float):.
-000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177b0: 2020 2020 2020 2020 6c61 7465 7374 5f69          latest_i
-000177c0: 6e73 7464 6174 6520 3d20 6461 7465 7469  nstdate = dateti
-000177d0: 6d65 2e64 6174 6574 696d 652e 6672 6f6d  me.datetime.from
-000177e0: 7469 6d65 7374 616d 7028 6c61 7465 7374  timestamp(latest
-000177f0: 5f69 6e73 7464 6174 6529 2e73 7472 6674  _instdate).strft
-00017800: 696d 6528 2725 592d 256d 2d25 6427 290a  ime('%Y-%m-%d').
-00017810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017820: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
-00017830: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
-00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017850: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-00017860: 2020 2020 2020 2069 6620 6c61 7465 7374         if latest
-00017870: 5f6d 6664 6174 6520 6973 206e 6f74 204e  _mfdate is not N
-00017880: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00017890: 2020 2020 2020 2020 2073 6176 6564 5f6d           saved_m
-000178a0: 6664 6174 6520 3d20 504b 4461 7465 5574  fdate = PKDateUt
-000178b0: 696c 6974 6965 732e 6461 7465 4672 6f6d  ilities.dateFrom
-000178c0: 596d 6453 7472 696e 6728 6c61 7465 7374  YmdString(latest
-000178d0: 5f6d 6664 6174 652e 7370 6c69 7428 2254  _mfdate.split("T
-000178e0: 2229 5b30 5d29 0a20 2020 2020 2020 2020  ")[0]).         
-000178f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00017900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017910: 2073 6176 6564 5f6d 6664 6174 6520 3d20   saved_mfdate = 
-00017920: 6c61 7374 4461 794c 6173 744d 6f6e 7468  lastDayLastMonth
-00017930: 202d 2064 6174 6574 696d 652e 7469 6d65   - datetime.time
-00017940: 6465 6c74 6128 3129 0a20 2020 2020 2020  delta(1).       
-00017950: 2020 2020 2020 2020 2069 6620 6c61 7465           if late
-00017960: 7374 5f69 6e73 7464 6174 6520 6973 206e  st_instdate is n
-00017970: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00017980: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-00017990: 6564 5f69 6e73 7464 6174 6520 3d20 504b  ed_instdate = PK
-000179a0: 4461 7465 5574 696c 6974 6965 732e 6461  DateUtilities.da
-000179b0: 7465 4672 6f6d 596d 6453 7472 696e 6728  teFromYmdString(
-000179c0: 6c61 7465 7374 5f69 6e73 7464 6174 652e  latest_instdate.
-000179d0: 7370 6c69 7428 2254 2229 5b30 5d29 0a20  split("T")[0]). 
-000179e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000179f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00017a00: 2020 2020 2020 2020 2073 6176 6564 5f69           saved_i
-00017a10: 6e73 7464 6174 6520 3d20 6c61 7374 4461  nstdate = lastDa
-00017a20: 794c 6173 744d 6f6e 7468 202d 2064 6174  yLastMonth - dat
-00017a30: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
-00017a40: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00017a50: 2020 2074 6f64 6179 203d 2050 4b44 6174     today = PKDat
-00017a60: 6555 7469 6c69 7469 6573 2e63 7572 7265  eUtilities.curre
-00017a70: 6e74 4461 7465 5469 6d65 2829 0a20 2020  ntDateTime().   
-00017a80: 2020 2020 2020 2020 2020 2020 206e 6565               nee
-00017a90: 6473 4672 6573 6855 7064 6174 6520 3d20  dsFreshUpdate = 
-00017aa0: 2873 6176 6564 5f6d 6664 6174 652e 6461  (saved_mfdate.da
-00017ab0: 7465 2829 203c 206c 6173 7444 6179 4c61  te() < lastDayLa
-00017ac0: 7374 4d6f 6e74 682e 6461 7465 2829 2920  stMonth.date()) 
-00017ad0: 616e 6420 2873 6176 6564 5f69 6e73 7464  and (saved_instd
-00017ae0: 6174 652e 6461 7465 2829 203c 206c 6173  ate.date() < las
-00017af0: 7444 6179 4c61 7374 4d6f 6e74 682e 6461  tDayLastMonth.da
-00017b00: 7465 2829 290a 2020 2020 2020 2020 2020  te()).          
-00017b10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017b20: 2020 2020 2020 2020 6e65 6564 7346 7265          needsFre
-00017b30: 7368 5570 6461 7465 203d 2054 7275 650a  shUpdate = True.
-00017b40: 0a20 2020 2020 2020 2069 6620 6e65 6564  .        if need
-00017b50: 7346 7265 7368 5570 6461 7465 2061 6e64  sFreshUpdate and
-00017b60: 2066 6f72 6365 3a0a 2020 2020 2020 2020   force:.        
-00017b70: 2020 2020 6e65 7443 6861 6e67 654d 462c      netChangeMF,
-00017b80: 206e 6574 4368 616e 6765 496e 7374 2c20   netChangeInst, 
-00017b90: 6c61 7465 7374 5f6d 6664 6174 652c 206c  latest_mfdate, l
-00017ba0: 6174 6573 745f 696e 7374 6461 7465 203d  atest_instdate =
-00017bb0: 2073 656c 662e 6765 7446 7265 7368 4d46   self.getFreshMF
-00017bc0: 4953 7461 7475 7328 7374 6f63 6b2c 6578  IStatus(stock,ex
-00017bd0: 6368 616e 6765 4e61 6d65 3d65 7863 6861  changeName=excha
-00017be0: 6e67 654e 616d 6529 0a20 2020 2020 2020  ngeName).       
-00017bf0: 2020 2020 2069 6620 6e65 7443 6861 6e67       if netChang
-00017c00: 654d 4620 6973 206e 6f74 204e 6f6e 653a  eMF is not None:
-00017c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017c20: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00017c30: 2020 2020 2020 2020 2020 686f 7374 4461            hostDa
-00017c40: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-00017c50: 696e 6465 785b 2d31 5d2c 224d 4622 5d20  index[-1],"MF"] 
-00017c60: 3d20 6e65 7443 6861 6e67 654d 460a 2020  = netChangeMF.  
-00017c70: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00017c80: 6365 7074 2028 4b65 7945 7272 6f72 2c49  cept (KeyError,I
-00017c90: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
-00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cb0: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00017cc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00017cd0: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
-00017ce0: 4d46 203d 2030 0a20 2020 2020 2020 2020  MF = 0.         
-00017cf0: 2020 2069 6620 6c61 7465 7374 5f6d 6664     if latest_mfd
-00017d00: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00017d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017d20: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00017d30: 2020 2020 2020 2020 2020 686f 7374 4461            hostDa
-00017d40: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-00017d50: 696e 6465 785b 2d31 5d2c 224d 465f 4461  index[-1],"MF_Da
-00017d60: 7465 225d 203d 206c 6174 6573 745f 6d66  te"] = latest_mf
-00017d70: 6461 7465 0a20 2020 2020 2020 2020 2020  date.           
-00017d80: 2020 2020 2065 7863 6570 7420 284b 6579       except (Key
-00017d90: 4572 726f 722c 496e 6465 7845 7272 6f72  Error,IndexError
-00017da0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00017db0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00017dc0: 2020 2020 2020 2020 6966 206e 6574 4368          if netCh
-00017dd0: 616e 6765 496e 7374 2069 7320 6e6f 7420  angeInst is not 
-00017de0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00017df0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00017e00: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00017e10: 6f73 7444 6174 612e 6c6f 635b 686f 7374  ostData.loc[host
-00017e20: 4461 7461 2e69 6e64 6578 5b2d 315d 2c22  Data.index[-1],"
-00017e30: 4649 4922 5d20 3d20 6e65 7443 6861 6e67  FII"] = netChang
-00017e40: 6549 6e73 740a 2020 2020 2020 2020 2020  eInst.          
-00017e50: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
-00017e60: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
-00017e70: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00017e80: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00017e90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00017ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00017eb0: 6574 4368 616e 6765 496e 7374 203d 2030  etChangeInst = 0
-00017ec0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017ed0: 6c61 7465 7374 5f69 6e73 7464 6174 6520  latest_instdate 
-00017ee0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00017ef0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00017f00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017f10: 2020 2020 2020 686f 7374 4461 7461 2e6c        hostData.l
-00017f20: 6f63 5b68 6f73 7444 6174 612e 696e 6465  oc[hostData.inde
-00017f30: 785b 2d31 5d2c 2246 4949 5f44 6174 6522  x[-1],"FII_Date"
-00017f40: 5d20 3d20 6c61 7465 7374 5f69 6e73 7464  ] = latest_instd
-00017f50: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00017f60: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
-00017f70: 7272 6f72 2c49 6e64 6578 4572 726f 7229  rror,IndexError)
-00017f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017f90: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00017fa0: 2020 206c 6173 7444 6179 4c61 7374 4d6f     lastDayLastMo
-00017fb0: 6e74 6820 3d20 6c61 7374 4461 794c 6173  nth = lastDayLas
-00017fc0: 744d 6f6e 7468 2e73 7472 6674 696d 6528  tMonth.strftime(
-00017fd0: 2225 592d 256d 2d25 6454 3030 3a30 303a  "%Y-%m-%dT00:00:
-00017fe0: 3030 2e30 3030 2229 0a20 2020 2020 2020  00.000").       
-00017ff0: 2069 6620 6f6e 6c79 4d46 3a0a 2020 2020   if onlyMF:.    
-00018000: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00018010: 6574 4368 616e 6765 4d46 0a20 2020 2020  etChangeMF.     
-00018020: 2020 2069 6620 6c61 7465 7374 5f69 6e73     if latest_ins
-00018030: 7464 6174 6520 3d3d 206c 6174 6573 745f  tdate == latest_
-00018040: 6d66 6461 7465 3a0a 2020 2020 2020 2020  mfdate:.        
-00018050: 2020 2020 7265 7475 726e 2028 6e65 7443      return (netC
-00018060: 6861 6e67 654d 4620 2b20 6e65 7443 6861  hangeMF + netCha
-00018070: 6e67 6549 6e73 7429 0a20 2020 2020 2020  ngeInst).       
-00018080: 2065 6c69 6620 6c61 7465 7374 5f6d 6664   elif latest_mfd
-00018090: 6174 6520 3d3d 206c 6173 7444 6179 4c61  ate == lastDayLa
-000180a0: 7374 4d6f 6e74 683a 0a20 2020 2020 2020  stMonth:.       
-000180b0: 2020 2020 2072 6574 7572 6e20 6e65 7443       return netC
-000180c0: 6861 6e67 654d 460a 2020 2020 2020 2020  hangeMF.        
-000180d0: 656c 6966 206c 6174 6573 745f 696e 7374  elif latest_inst
-000180e0: 6461 7465 203d 3d20 6c61 7374 4461 794c  date == lastDayL
-000180f0: 6173 744d 6f6e 7468 3a0a 2020 2020 2020  astMonth:.      
-00018100: 2020 2020 2020 7265 7475 726e 206e 6574        return net
-00018110: 4368 616e 6765 496e 7374 0a20 2020 2020  ChangeInst.     
-00018120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00018130: 2020 2020 2023 2066 696e 6420 7468 6520       # find the 
-00018140: 6c61 7465 7374 2064 6174 650a 2020 2020  latest date.    
-00018150: 2020 2020 2020 2020 6966 206c 6174 6573          if lates
-00018160: 745f 6d66 6461 7465 2069 7320 6e6f 7420  t_mfdate is not 
-00018170: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00018180: 2020 2020 2020 6c61 7465 7374 5f6d 6664        latest_mfd
-00018190: 6174 6520 3d20 504b 4461 7465 5574 696c  ate = PKDateUtil
-000181a0: 6974 6965 732e 6461 7465 4672 6f6d 596d  ities.dateFromYm
-000181b0: 6453 7472 696e 6728 6c61 7465 7374 5f6d  dString(latest_m
-000181c0: 6664 6174 652e 7370 6c69 7428 2254 2229  fdate.split("T")
-000181d0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-000181e0: 2069 6620 6c61 7465 7374 5f69 6e73 7464   if latest_instd
-000181f0: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00018200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018210: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
-00018220: 203d 2050 4b44 6174 6555 7469 6c69 7469   = PKDateUtiliti
-00018230: 6573 2e64 6174 6546 726f 6d59 6d64 5374  es.dateFromYmdSt
-00018240: 7269 6e67 286c 6174 6573 745f 696e 7374  ring(latest_inst
-00018250: 6461 7465 2e73 706c 6974 2822 5422 295b  date.split("T")[
-00018260: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-00018270: 7265 7475 726e 206e 6574 4368 616e 6765  return netChange
-00018280: 4d46 2069 6620 2828 6c61 7465 7374 5f6d  MF if ((latest_m
-00018290: 6664 6174 6520 6973 206e 6f74 204e 6f6e  fdate is not Non
-000182a0: 6529 2061 6e64 206c 6174 6573 745f 6d66  e) and latest_mf
-000182b0: 6461 7465 203e 2028 6c61 7465 7374 5f69  date > (latest_i
-000182c0: 6e73 7464 6174 6520 6966 206c 6174 6573  nstdate if lates
-000182d0: 745f 696e 7374 6461 7465 2069 7320 6e6f  t_instdate is no
-000182e0: 7420 4e6f 6e65 2065 6c73 6520 286c 6174  t None else (lat
-000182f0: 6573 745f 6d66 6461 7465 202d 2064 6174  est_mfdate - dat
-00018300: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
-00018310: 3129 2929 2920 656c 7365 206e 6574 4368  1)))) else netCh
-00018320: 616e 6765 496e 7374 0a0a 2020 2020 6465  angeInst..    de
-00018330: 6620 6765 7446 7265 7368 4d46 4953 7461  f getFreshMFISta
-00018340: 7475 7328 7365 6c66 2c20 7374 6f63 6b2c  tus(self, stock,
-00018350: 6578 6368 616e 6765 4e61 6d65 3d22 494e  exchangeName="IN
-00018360: 4449 4122 293a 0a20 2020 2020 2020 2063  DIA"):.        c
-00018370: 6861 6e67 6553 7461 7475 7344 6174 614d  hangeStatusDataM
-00018380: 4620 3d20 4e6f 6e65 0a20 2020 2020 2020  F = None.       
-00018390: 2063 6861 6e67 6553 7461 7475 7344 6174   changeStatusDat
-000183a0: 6149 6e73 7420 3d20 4e6f 6e65 0a20 2020  aInst = None.   
-000183b0: 2020 2020 206e 6574 4368 616e 6765 4d46       netChangeMF
-000183c0: 203d 2030 0a20 2020 2020 2020 206e 6574   = 0.        net
-000183d0: 4368 616e 6765 496e 7374 203d 2030 0a20  ChangeInst = 0. 
-000183e0: 2020 2020 2020 206c 6174 6573 745f 6d66         latest_mf
-000183f0: 6461 7465 203d 204e 6f6e 650a 2020 2020  date = None.    
-00018400: 2020 2020 6c61 7465 7374 5f69 6e73 7464      latest_instd
-00018410: 6174 6520 3d20 4e6f 6e65 0a20 2020 2020  ate = None.     
-00018420: 2020 2073 6563 7572 6974 7920 3d20 4e6f     security = No
-00018430: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
-00018440: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00018450: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
-00018460: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
-00018470: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
-00018480: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
-00018490: 2020 2020 2020 2020 2020 2020 2073 6563               sec
-000184a0: 7572 6974 7920 3d20 5374 6f63 6b28 7374  urity = Stock(st
-000184b0: 6f63 6b2c 6578 6368 616e 6765 3d65 7863  ock,exchange=exc
-000184c0: 6861 6e67 654e 616d 6529 0a20 2020 2020  hangeName).     
-000184d0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-000184e0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-000184f0: 2020 2320 5765 2064 6964 206e 6f74 2066    # We did not f
-00018500: 696e 6420 7468 6520 7374 6f63 6b3f 2049  ind the stock? I
-00018510: 7427 7320 6f6b 6179 2e20 4d6f 7665 206f  t's okay. Move o
-00018520: 6e20 746f 2074 6865 206e 6578 7420 6f6e  n to the next on
-00018530: 652e 0a20 2020 2020 2020 2020 2020 2070  e..            p
-00018540: 6173 730a 2020 2020 2020 2020 6578 6365  ass.        exce
-00018550: 7074 2028 5469 6d65 6f75 7445 7272 6f72  pt (TimeoutError
-00018560: 2c20 436f 6e6e 6563 7469 6f6e 4572 726f  , ConnectionErro
-00018570: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00018580: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-00018590: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
-000185a0: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
-000185b0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-000185c0: 730a 2020 2020 2020 2020 6578 6365 7074  s.        except
-000185d0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-000185e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000185f0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00018600: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-00018610: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00018620: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00018630: 2020 6966 2073 6563 7572 6974 7920 6973    if security is
-00018640: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00018650: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00018660: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00018670: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
-00018680: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
-00018690: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
-000186a0: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
-000186b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186c0: 2063 6861 6e67 6553 7461 7475 7352 6f77   changeStatusRow
-000186d0: 734d 4620 3d20 7365 6375 7269 7479 2e6d  sMF = security.m
-000186e0: 7574 7561 6c46 756e 644f 776e 6572 7368  utualFundOwnersh
-000186f0: 6970 2874 6f70 3d35 290a 2020 2020 2020  ip(top=5).      
-00018700: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00018710: 616e 6765 5374 6174 7573 526f 7773 496e  angeStatusRowsIn
-00018720: 7374 203d 2073 6563 7572 6974 792e 696e  st = security.in
-00018730: 7374 6974 7574 696f 6e4f 776e 6572 7368  stitutionOwnersh
-00018740: 6970 2874 6f70 3d35 290a 2020 2020 2020  ip(top=5).      
-00018750: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00018760: 616e 6765 5374 6174 7573 4461 7461 4d46  angeStatusDataMF
-00018770: 203d 2073 6563 7572 6974 792e 6d75 7475   = security.mutu
-00018780: 616c 4675 6e64 4649 4943 6861 6e67 6544  alFundFIIChangeD
-00018790: 6174 6128 6368 616e 6765 5374 6174 7573  ata(changeStatus
-000187a0: 526f 7773 4d46 290a 2020 2020 2020 2020  RowsMF).        
-000187b0: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-000187c0: 6765 5374 6174 7573 4461 7461 496e 7374  geStatusDataInst
-000187d0: 203d 2073 6563 7572 6974 792e 6d75 7475   = security.mutu
-000187e0: 616c 4675 6e64 4649 4943 6861 6e67 6544  alFundFIIChangeD
-000187f0: 6174 6128 6368 616e 6765 5374 6174 7573  ata(changeStatus
-00018800: 526f 7773 496e 7374 290a 2020 2020 2020  RowsInst).      
-00018810: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00018820: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-00018830: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00018840: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00018850: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-00018860: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00018870: 2020 2020 2020 2020 2023 2054 7970 6545           # TypeE
-00018880: 7272 6f72 206f 7220 436f 6e6e 6563 7469  rror or Connecti
-00018890: 6f6e 4572 726f 7220 6265 6361 7573 6520  onError because 
-000188a0: 7765 2063 6f75 6c64 206e 6f74 2066 696e  we could not fin
-000188b0: 6420 7468 6520 7374 6f63 6b20 6f72 204d  d the stock or M
-000188c0: 4649 2064 6174 6120 6973 6e27 7420 6176  FI data isn't av
-000188d0: 6169 6c61 626c 653f 0a20 2020 2020 2020  ailable?.       
-000188e0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-000188f0: 2020 2020 2020 2020 2020 6c61 7374 4461            lastDa
-00018900: 794c 6173 744d 6f6e 7468 203d 2050 4b44  yLastMonth = PKD
-00018910: 6174 6555 7469 6c69 7469 6573 2e6c 6173  ateUtilities.las
-00018920: 745f 6461 795f 6f66 5f70 7265 7669 6f75  t_day_of_previou
-00018930: 735f 6d6f 6e74 6828 504b 4461 7465 5574  s_month(PKDateUt
-00018940: 696c 6974 6965 732e 6375 7272 656e 7444  ilities.currentD
-00018950: 6174 6554 696d 6528 2929 0a20 2020 2020  ateTime()).     
-00018960: 2020 2020 2020 206c 6173 7444 6179 4c61         lastDayLa
-00018970: 7374 4d6f 6e74 6820 3d20 6c61 7374 4461  stMonth = lastDa
-00018980: 794c 6173 744d 6f6e 7468 2e73 7472 6674  yLastMonth.strft
-00018990: 696d 6528 2225 592d 256d 2d25 6454 3030  ime("%Y-%m-%dT00
-000189a0: 3a30 303a 3030 2e30 3030 2229 0a20 2020  :00:00.000").   
-000189b0: 2020 2020 2020 2020 2069 6620 6368 616e           if chan
-000189c0: 6765 5374 6174 7573 4461 7461 4d46 2069  geStatusDataMF i
-000189d0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-000189e0: 656e 2863 6861 6e67 6553 7461 7475 7344  en(changeStatusD
-000189f0: 6174 614d 4629 203e 2030 3a0a 2020 2020  ataMF) > 0:.    
-00018a00: 2020 2020 2020 2020 2020 2020 6466 5f67              df_g
-00018a10: 726f 7570 6564 4d46 203d 2063 6861 6e67  roupedMF = chang
-00018a20: 6553 7461 7475 7344 6174 614d 462e 6772  eStatusDataMF.gr
-00018a30: 6f75 7062 7928 2264 6174 6522 2c20 736f  oupby("date", so
-00018a40: 7274 3d46 616c 7365 290a 2020 2020 2020  rt=False).      
-00018a50: 2020 2020 2020 2020 2020 666f 7220 6d66            for mf
-00018a60: 6461 7465 2c20 6466 5f67 726f 7570 4d46  date, df_groupMF
-00018a70: 2069 6e20 6466 5f67 726f 7570 6564 4d46   in df_groupedMF
-00018a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018a90: 2020 2020 2020 6e65 7443 6861 6e67 654d        netChangeM
-00018aa0: 4620 3d20 6466 5f67 726f 7570 4d46 5b22  F = df_groupMF["
-00018ab0: 6368 616e 6765 416d 6f75 6e74 225d 2e73  changeAmount"].s
-00018ac0: 756d 2829 0a20 2020 2020 2020 2020 2020  um().           
-00018ad0: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
-00018ae0: 6d66 6461 7465 203d 206d 6664 6174 650a  mfdate = mfdate.
-00018af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b00: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00018b10: 2020 2020 2020 6966 2063 6861 6e67 6553        if changeS
-00018b20: 7461 7475 7344 6174 6149 6e73 7420 6973  tatusDataInst is
-00018b30: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
-00018b40: 6e28 6368 616e 6765 5374 6174 7573 4461  n(changeStatusDa
-00018b50: 7461 496e 7374 2920 3e20 303a 0a20 2020  taInst) > 0:.   
-00018b60: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00018b70: 6772 6f75 7065 6449 6e73 7420 3d20 6368  groupedInst = ch
-00018b80: 616e 6765 5374 6174 7573 4461 7461 496e  angeStatusDataIn
-00018b90: 7374 2e67 726f 7570 6279 2822 6461 7465  st.groupby("date
-00018ba0: 222c 2073 6f72 743d 4661 6c73 6529 0a20  ", sort=False). 
-00018bb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018bc0: 6f72 2069 6e73 7464 6174 652c 2064 665f  or instdate, df_
-00018bd0: 6772 6f75 7049 6e73 7420 696e 2064 665f  groupInst in df_
-00018be0: 6772 6f75 7065 6449 6e73 743a 0a20 2020  groupedInst:.   
-00018bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c00: 2069 6620 286c 6174 6573 745f 6d66 6461   if (latest_mfda
-00018c10: 7465 2069 7320 6e6f 7420 4e6f 6e65 2061  te is not None a
-00018c20: 6e64 206c 6174 6573 745f 6d66 6461 7465  nd latest_mfdate
-00018c30: 203d 3d20 696e 7374 6461 7465 2920 6f72   == instdate) or
-00018c40: 2028 6c61 7465 7374 5f6d 6664 6174 6520   (latest_mfdate 
-00018c50: 6973 204e 6f6e 6529 206f 7220 2869 6e73  is None) or (ins
-00018c60: 7464 6174 6520 3d3d 206c 6173 7444 6179  tdate == lastDay
-00018c70: 4c61 7374 4d6f 6e74 6829 3a0a 2020 2020  LastMonth):.    
-00018c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c90: 2020 2020 6e65 7443 6861 6e67 6549 6e73      netChangeIns
-00018ca0: 7420 3d20 6466 5f67 726f 7570 496e 7374  t = df_groupInst
-00018cb0: 5b22 6368 616e 6765 416d 6f75 6e74 225d  ["changeAmount"]
-00018cc0: 2e73 756d 2829 0a20 2020 2020 2020 2020  .sum().         
-00018cd0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00018ce0: 6174 6573 745f 696e 7374 6461 7465 203d  atest_instdate =
-00018cf0: 2069 6e73 7464 6174 650a 2020 2020 2020   instdate.      
-00018d00: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00018d10: 6561 6b0a 2020 2020 2020 2020 7265 7475  eak.        retu
-00018d20: 726e 206e 6574 4368 616e 6765 4d46 2c6e  rn netChangeMF,n
-00018d30: 6574 4368 616e 6765 496e 7374 2c6c 6174  etChangeInst,lat
-00018d40: 6573 745f 6d66 6461 7465 2c6c 6174 6573  est_mfdate,lates
-00018d50: 745f 696e 7374 6461 7465 0a0a 0a20 2020  t_instdate...   
-00018d60: 2064 6566 2067 6574 4e69 6674 7950 7265   def getNiftyPre
-00018d70: 6469 6374 696f 6e28 7365 6c66 2c20 6466  diction(self, df
-00018d80: 293a 0a20 2020 2020 2020 2069 6d70 6f72  ):.        impor
-00018d90: 7420 7761 726e 696e 6773 0a0a 2020 2020  t warnings..    
-00018da0: 2020 2020 7761 726e 696e 6773 2e66 696c      warnings.fil
-00018db0: 7465 7277 6172 6e69 6e67 7328 2269 676e  terwarnings("ign
-00018dc0: 6f72 6522 290a 2020 2020 2020 2020 6461  ore").        da
-00018dd0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-00018de0: 2020 2020 2020 206d 6f64 656c 2c20 706b         model, pk
-00018df0: 6c20 3d20 5574 696c 6974 792e 746f 6f6c  l = Utility.tool
-00018e00: 732e 6765 744e 6966 7479 4d6f 6465 6c28  s.getNiftyModel(
-00018e10: 290a 2020 2020 2020 2020 6966 206d 6f64  ).        if mod
-00018e20: 656c 2069 7320 4e6f 6e65 206f 7220 706b  el is None or pk
-00018e30: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-00018e40: 2020 2020 2020 2072 6574 7572 6e20 302c         return 0,
-00018e50: 2022 556e 6b6e 6f77 6e22 2c20 2255 6e6b   "Unknown", "Unk
-00018e60: 6e6f 776e 220a 2020 2020 2020 2020 7769  nown".        wi
-00018e70: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
-00018e80: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
-00018e90: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
-00018ea0: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
-00018eb0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00018ec0: 3d20 6461 7461 5b70 6b6c 5b22 636f 6c75  = data[pkl["colu
-00018ed0: 6d6e 7322 5d5d 0a20 2020 2020 2020 2020  mns"]].         
-00018ee0: 2020 2023 2323 2076 3220 5072 6570 726f     ### v2 Prepro
-00018ef0: 6365 7373 696e 670a 2020 2020 2020 2020  cessing.        
-00018f00: 2020 2020 6461 7461 5b22 4869 6768 225d      data["High"]
-00018f10: 203d 2064 6174 615b 2248 6967 6822 5d2e   = data["High"].
-00018f20: 7063 745f 6368 616e 6765 2829 202a 2031  pct_change() * 1
-00018f30: 3030 0a20 2020 2020 2020 2020 2020 2064  00.            d
-00018f40: 6174 615b 224c 6f77 225d 203d 2064 6174  ata["Low"] = dat
-00018f50: 615b 224c 6f77 225d 2e70 6374 5f63 6861  a["Low"].pct_cha
-00018f60: 6e67 6528 2920 2a20 3130 300a 2020 2020  nge() * 100.    
-00018f70: 2020 2020 2020 2020 6461 7461 5b22 4f70          data["Op
-00018f80: 656e 225d 203d 2064 6174 615b 224f 7065  en"] = data["Ope
-00018f90: 6e22 5d2e 7063 745f 6368 616e 6765 2829  n"].pct_change()
-00018fa0: 202a 2031 3030 0a20 2020 2020 2020 2020   * 100.         
-00018fb0: 2020 2064 6174 615b 2243 6c6f 7365 225d     data["Close"]
-00018fc0: 203d 2064 6174 615b 2243 6c6f 7365 225d   = data["Close"]
-00018fd0: 2e70 6374 5f63 6861 6e67 6528 2920 2a20  .pct_change() * 
-00018fe0: 3130 300a 2020 2020 2020 2020 2020 2020  100.            
-00018ff0: 6461 7461 203d 2064 6174 612e 696c 6f63  data = data.iloc
-00019000: 5b2d 315d 0a20 2020 2020 2020 2020 2020  [-1].           
-00019010: 2023 2323 0a20 2020 2020 2020 2020 2020   ###.           
-00019020: 2064 6174 6120 3d20 706b 6c5b 2273 6361   data = pkl["sca
-00019030: 6c65 7222 5d2e 7472 616e 7366 6f72 6d28  ler"].transform(
-00019040: 5b64 6174 615d 290a 2020 2020 2020 2020  [data]).        
-00019050: 2020 2020 7769 7468 2053 7570 7072 6573      with Suppres
-00019060: 734f 7574 7075 7428 7375 7070 7265 7373  sOutput(suppress
-00019070: 5f73 7464 6f75 743d 5472 7565 2c20 7375  _stdout=True, su
-00019080: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
-00019090: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
-000190a0: 2020 2020 2070 7265 6420 3d20 6d6f 6465       pred = mode
-000190b0: 6c2e 7072 6564 6963 7428 6461 7461 295b  l.predict(data)[
-000190c0: 305d 0a20 2020 2020 2020 2069 6620 7072  0].        if pr
-000190d0: 6564 203e 2030 2e35 3a0a 2020 2020 2020  ed > 0.5:.      
-000190e0: 2020 2020 2020 6f75 7454 6578 7420 3d20        outText = 
-000190f0: 2242 4541 5249 5348 220a 2020 2020 2020  "BEARISH".      
-00019100: 2020 2020 2020 6f75 7420 3d20 280a 2020        out = (.  
-00019110: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00019120: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
-00019130: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00019140: 6f6c 6f72 5465 7874 2e46 4149 4c0a 2020  olorText.FAIL.  
-00019150: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00019160: 6f75 7454 6578 740a 2020 2020 2020 2020  outText.        
-00019170: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00019180: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00019190: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-000191a0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-000191b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000191c0: 2020 2073 7567 203d 2022 486f 6c64 2079     sug = "Hold y
-000191d0: 6f75 7220 5368 6f72 7420 706f 7369 7469  our Short positi
-000191e0: 6f6e 2122 0a20 2020 2020 2020 2065 6c73  on!".        els
-000191f0: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00019200: 7574 5465 7874 203d 2022 4255 4c4c 4953  utText = "BULLIS
-00019210: 4822 0a20 2020 2020 2020 2020 2020 206f  H".            o
-00019220: 7574 203d 2028 0a20 2020 2020 2020 2020  ut = (.         
-00019230: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-00019240: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
-00019250: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00019260: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
-00019270: 2020 2020 2020 2020 2b20 6f75 7454 6578          + outTex
-00019280: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00019290: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-000192a0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-000192b0: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
-000192c0: 4c44 0a20 2020 2020 2020 2020 2020 2029  LD.            )
-000192d0: 0a20 2020 2020 2020 2020 2020 2073 7567  .            sug
-000192e0: 203d 2022 5374 6179 2042 756c 6c69 7368   = "Stay Bullish
-000192f0: 2122 0a20 2020 2020 2020 2069 6620 504b  !".        if PK
-00019300: 4461 7465 5574 696c 6974 6965 732e 6973  DateUtilities.is
-00019310: 436c 6f73 696e 6748 6f75 7228 293a 0a20  ClosingHour():. 
-00019320: 2020 2020 2020 2020 2020 204f 7574 7075             Outpu
-00019330: 7443 6f6e 7472 6f6c 7328 292e 7072 696e  tControls().prin
-00019340: 744f 7574 7075 7428 0a20 2020 2020 2020  tOutput(.       
-00019350: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
-00019360: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
-00019370: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00019380: 6578 742e 5741 524e 0a20 2020 2020 2020  ext.WARN.       
-00019390: 2020 2020 2020 2020 202b 2022 4e6f 7465           + "Note
-000193a0: 3a20 5468 6520 4149 2070 7265 6469 6374  : The AI predict
-000193b0: 696f 6e20 7368 6f75 6c64 2062 6520 6578  ion should be ex
-000193c0: 6563 7574 6564 2041 6674 6572 2033 2050  ecuted After 3 P
-000193d0: 4d20 6f72 204e 6561 7220 746f 2043 6c6f  M or Near to Clo
-000193e0: 7369 6e67 2074 696d 6520 6173 2074 6865  sing time as the
-000193f0: 2050 7265 6469 6374 696f 6e20 4163 6375   Prediction Accu
-00019400: 7261 6379 2069 7320 6261 7365 6420 6f6e  racy is based on
-00019410: 2074 6865 2043 6c6f 7369 6e67 2070 7269   the Closing pri
-00019420: 6365 2122 0a20 2020 2020 2020 2020 2020  ce!".           
-00019430: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-00019440: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-00019450: 2029 0a20 2020 2020 2020 2070 7265 6469   ).        predi
-00019460: 6374 696f 6e54 6578 7420 3d20 224d 6172  ctionText = "Mar
-00019470: 6b65 7420 6d61 7920 4f70 656e 207b 7d20  ket may Open {} 
-00019480: 6e65 7874 2064 6179 2120 7b7d 222e 666f  next day! {}".fo
-00019490: 726d 6174 286f 7574 2c20 7375 6729 0a20  rmat(out, sug). 
-000194a0: 2020 2020 2020 2073 7472 656e 6774 6854         strengthT
-000194b0: 6578 7420 3d20 2250 726f 6261 6269 6c69  ext = "Probabili
-000194c0: 7479 2f53 7472 656e 6774 6820 6f66 2050  ty/Strength of P
-000194d0: 7265 6469 6374 696f 6e20 3d20 7b7d 2522  rediction = {}%"
-000194e0: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-000194f0: 2020 2020 2055 7469 6c69 7479 2e74 6f6f       Utility.too
-00019500: 6c73 2e67 6574 5369 676d 6f69 6443 6f6e  ls.getSigmoidCon
-00019510: 6669 6465 6e63 6528 7072 6564 5b30 5d29  fidence(pred[0])
-00019520: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00019530: 2020 204f 7574 7075 7443 6f6e 7472 6f6c     OutputControl
-00019540: 7328 292e 7072 696e 744f 7574 7075 7428  s().printOutput(
-00019550: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00019560: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
-00019570: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00019580: 6578 742e 424c 5545 0a20 2020 2020 2020  ext.BLUE.       
-00019590: 2020 2020 202b 2022 5c6e 220a 2020 2020       + "\n".    
-000195a0: 2020 2020 2020 2020 2b20 225b 2b5d 204e          + "[+] N
-000195b0: 6966 7479 2041 4920 5072 6564 6963 7469  ifty AI Predicti
-000195c0: 6f6e 202d 3e20 220a 2020 2020 2020 2020  on -> ".        
-000195d0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-000195e0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-000195f0: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-00019600: 0a20 2020 2020 2020 2020 2020 202b 2070  .            + p
-00019610: 7265 6469 6374 696f 6e54 6578 740a 2020  redictionText.  
-00019620: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-00019630: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00019640: 2020 290a 2020 2020 2020 2020 4f75 7470    ).        Outp
-00019650: 7574 436f 6e74 726f 6c73 2829 2e70 7269  utControls().pri
-00019660: 6e74 4f75 7470 7574 280a 2020 2020 2020  ntOutput(.      
-00019670: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-00019680: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-00019690: 202b 2063 6f6c 6f72 5465 7874 2e42 4c55   + colorText.BLU
-000196a0: 450a 2020 2020 2020 2020 2020 2020 2b20  E.            + 
-000196b0: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
-000196c0: 202b 2022 5b2b 5d20 4e69 6674 7920 4149   + "[+] Nifty AI
-000196d0: 2050 7265 6469 6374 696f 6e20 2d3e 2022   Prediction -> "
-000196e0: 0a20 2020 2020 2020 2020 2020 202b 2063  .            + c
-000196f0: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00019700: 2020 2020 2020 2020 202b 2073 7472 656e           + stren
-00019710: 6774 6854 6578 740a 2020 2020 2020 2020  gthText.        
-00019720: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00019730: 6e20 7072 6564 2c20 7072 6564 6963 7469  n pred, predicti
-00019740: 6f6e 5465 7874 2e72 6570 6c61 6365 286f  onText.replace(o
-00019750: 7574 2c20 6f75 7454 6578 7429 2c20 7374  ut, outText), st
-00019760: 7265 6e67 7468 5465 7874 0a0a 2020 2020  rengthText..    
-00019770: 6465 6620 6d6f 6e69 746f 7246 6976 6545  def monitorFiveE
-00019780: 6d61 2873 656c 662c 2066 6574 6368 6572  ma(self, fetcher
-00019790: 2c20 7265 7375 6c74 5f64 662c 206c 6173  , result_df, las
-000197a0: 745f 7369 676e 616c 2c20 7269 736b 5f72  t_signal, risk_r
-000197b0: 6577 6172 643d 3329 3a0a 2020 2020 2020  eward=3):.      
-000197c0: 2020 636f 6c5f 6e61 6d65 7320 3d20 5b22    col_names = ["
-000197d0: 4869 6768 222c 2022 4c6f 7722 2c20 2243  High", "Low", "C
-000197e0: 6c6f 7365 222c 2022 3545 4d41 225d 0a20  lose", "5EMA"]. 
-000197f0: 2020 2020 2020 2064 6174 615f 6c69 7374         data_list
-00019800: 203d 205b 226e 6966 7479 5f62 7579 222c   = ["nifty_buy",
-00019810: 2022 6261 6e6b 6e69 6674 795f 6275 7922   "banknifty_buy"
-00019820: 2c20 226e 6966 7479 5f73 656c 6c22 2c20  , "nifty_sell", 
-00019830: 2262 616e 6b6e 6966 7479 5f73 656c 6c22  "banknifty_sell"
-00019840: 5d0a 0a20 2020 2020 2020 2064 6174 615f  ]..        data_
-00019850: 7475 706c 6520 3d20 6665 7463 6865 722e  tuple = fetcher.
-00019860: 6665 7463 6846 6976 6545 6d61 4461 7461  fetchFiveEmaData
-00019870: 2829 0a20 2020 2020 2020 2066 6f72 2063  ().        for c
-00019880: 6e74 2069 6e20 7261 6e67 6528 6c65 6e28  nt in range(len(
-00019890: 6461 7461 5f74 7570 6c65 2929 3a0a 2020  data_tuple)):.  
-000198a0: 2020 2020 2020 2020 2020 6420 3d20 6461            d = da
-000198b0: 7461 5f74 7570 6c65 5b63 6e74 5d0a 2020  ta_tuple[cnt].  
-000198c0: 2020 2020 2020 2020 2020 645b 2235 454d            d["5EM
-000198d0: 4122 5d20 3d20 706b 7461 6c69 622e 454d  A"] = pktalib.EM
-000198e0: 4128 645b 2243 6c6f 7365 225d 2c20 7469  A(d["Close"], ti
-000198f0: 6d65 7065 7269 6f64 3d35 290a 2020 2020  meperiod=5).    
-00019900: 2020 2020 2020 2020 6420 3d20 645b 636f          d = d[co
-00019910: 6c5f 6e61 6d65 735d 0a20 2020 2020 2020  l_names].       
-00019920: 2020 2020 2064 203d 2064 2e64 726f 706e       d = d.dropn
-00019930: 6128 292e 726f 756e 6428 3229 0a0a 2020  a().round(2)..  
-00019940: 2020 2020 2020 2020 2020 7769 7468 2053            with S
-00019950: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
-00019960: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
-00019970: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
-00019980: 6f75 743d 5472 7565 293a 0a20 2020 2020  out=True):.     
-00019990: 2020 2020 2020 2020 2020 2069 6620 2273             if "s
-000199a0: 656c 6c22 2069 6e20 6461 7461 5f6c 6973  ell" in data_lis
-000199b0: 745b 636e 745d 3a0a 2020 2020 2020 2020  t[cnt]:.        
-000199c0: 2020 2020 2020 2020 2020 2020 7374 7265              stre
-000199d0: 6368 6564 203d 2064 5b28 642e 4c6f 7720  ched = d[(d.Low 
-000199e0: 3e20 645b 2235 454d 4122 5d29 2026 2028  > d["5EMA"]) & (
-000199f0: 642e 4c6f 7720 2d20 645b 2235 454d 4122  d.Low - d["5EMA"
-00019a00: 5d20 3e20 302e 3529 5d0a 2020 2020 2020  ] > 0.5)].      
-00019a10: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00019a20: 7265 6368 6564 5b22 534c 225d 203d 2073  reched["SL"] = s
-00019a30: 7472 6563 6865 642e 4869 6768 0a20 2020  treched.High.   
-00019a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a50: 2076 616c 6964 6174 6520 3d20 645b 0a20   validate = d[. 
-00019a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a70: 2020 2020 2020 2028 642e 4c6f 772e 7368         (d.Low.sh
-00019a80: 6966 7428 3129 203e 2064 5b22 3545 4d41  ift(1) > d["5EMA
-00019a90: 225d 2e73 6869 6674 2831 2929 0a20 2020  "].shift(1)).   
-00019aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ab0: 2020 2020 2026 2028 642e 4c6f 772e 7368       & (d.Low.sh
-00019ac0: 6966 7428 3129 202d 2064 5b22 3545 4d41  ift(1) - d["5EMA
-00019ad0: 225d 2e73 6869 6674 2831 2920 3e20 302e  "].shift(1) > 0.
-00019ae0: 3529 0a20 2020 2020 2020 2020 2020 2020  5).             
-00019af0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00019b00: 2020 2020 2020 2020 2020 2020 206f 6c64               old
-00019b10: 5f69 6e64 6578 203d 2076 616c 6964 6174  _index = validat
-00019b20: 652e 696e 6465 780a 2020 2020 2020 2020  e.index.        
-00019b30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00019b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b50: 2020 6d61 736b 203d 2028 642e 4869 6768    mask = (d.High
-00019b60: 203c 2064 5b22 3545 4d41 225d 2920 2620   < d["5EMA"]) & 
-00019b70: 2864 5b22 3545 4d41 225d 202d 2064 2e48  (d["5EMA"] - d.H
-00019b80: 6967 6820 3e20 302e 3529 2020 2320 4275  igh > 0.5)  # Bu
-00019b90: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-00019ba0: 2020 2020 2020 7374 7265 6368 6564 203d        streched =
-00019bb0: 2064 5b6d 6173 6b5d 0a20 2020 2020 2020   d[mask].       
-00019bc0: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00019bd0: 6563 6865 645b 2253 4c22 5d20 3d20 7374  eched["SL"] = st
-00019be0: 7265 6368 6564 2e4c 6f77 0a20 2020 2020  reched.Low.     
-00019bf0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00019c00: 616c 6964 6174 6520 3d20 642e 6c6f 635b  alidate = d.loc[
-00019c10: 6d61 736b 2e73 6869 6674 2831 292e 6669  mask.shift(1).fi
-00019c20: 6c6c 6e61 2846 616c 7365 295d 0a20 2020  llna(False)].   
-00019c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c40: 206f 6c64 5f69 6e64 6578 203d 2076 616c   old_index = val
-00019c50: 6964 6174 652e 696e 6465 780a 2020 2020  idate.index.    
-00019c60: 2020 2020 2020 2020 7467 7420 3d20 7064          tgt = pd
-00019c70: 2e44 6174 6146 7261 6d65 280a 2020 2020  .DataFrame(.    
-00019c80: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-00019c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ca0: 2020 7661 6c69 6461 7465 2e43 6c6f 7365    validate.Close
-00019cb0: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
-00019cc0: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
-00019cd0: 2020 2020 2020 2020 2020 2020 2d20 280a              - (.
-00019ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019cf0: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00019d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d10: 2020 2020 2020 7374 7265 6368 6564 2e53        streched.S
-00019d20: 4c2e 7265 7365 745f 696e 6465 7828 6472  L.reset_index(dr
-00019d30: 6f70 3d54 7275 6529 0a20 2020 2020 2020  op=True).       
-00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d50: 2020 2020 202d 2076 616c 6964 6174 652e       - validate.
-00019d60: 436c 6f73 652e 7265 7365 745f 696e 6465  Close.reset_inde
-00019d70: 7828 6472 6f70 3d54 7275 6529 0a20 2020  x(drop=True).   
+00017200: 2020 2020 2020 686f 7374 4461 7461 2e6c        hostData.l
+00017210: 6f63 5b68 6f73 7444 6174 612e 696e 6465  oc[hostData.inde
+00017220: 785b 2d31 5d2c 2246 6169 7256 616c 7565  x[-1],"FairValue
+00017230: 225d 203d 2066 6169 7256 616c 7565 0a20  "] = fairValue. 
+00017240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017250: 2020 2065 7863 6570 7420 284b 6579 4572     except (KeyEr
+00017260: 726f 722c 496e 6465 7845 7272 6f72 293a  ror,IndexError):
+00017270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017280: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00017290: 2020 2020 2020 7265 7475 726e 2066 6169        return fai
+000172a0: 7256 616c 7565 0a0a 2020 2020 6465 6620  rValue..    def 
+000172b0: 6765 744d 7574 7561 6c46 756e 6453 7461  getMutualFundSta
+000172c0: 7475 7328 7365 6c66 2c20 7374 6f63 6b2c  tus(self, stock,
+000172d0: 6f6e 6c79 4d46 3d46 616c 7365 2c20 686f  onlyMF=False, ho
+000172e0: 7374 4461 7461 3d4e 6f6e 652c 2066 6f72  stData=None, for
+000172f0: 6365 3d46 616c 7365 2c65 7863 6861 6e67  ce=False,exchang
+00017300: 654e 616d 653d 2249 4e44 4941 2229 3a0a  eName="INDIA"):.
+00017310: 2020 2020 2020 2020 6966 2068 6f73 7444          if hostD
+00017320: 6174 6120 6973 204e 6f6e 6520 6f72 206c  ata is None or l
+00017330: 656e 2868 6f73 7444 6174 6129 203c 2031  en(hostData) < 1
+00017340: 3a0a 2020 2020 2020 2020 2020 2020 686f  :.            ho
+00017350: 7374 4461 7461 203d 2070 642e 4461 7461  stData = pd.Data
+00017360: 4672 616d 6528 290a 2020 2020 2020 2020  Frame().        
+00017370: 0a20 2020 2020 2020 206e 6574 4368 616e  .        netChan
+00017380: 6765 4d46 203d 2030 0a20 2020 2020 2020  geMF = 0.       
+00017390: 206e 6574 4368 616e 6765 496e 7374 203d   netChangeInst =
+000173a0: 2030 0a20 2020 2020 2020 206c 6174 6573   0.        lates
+000173b0: 745f 6d66 6461 7465 203d 204e 6f6e 650a  t_mfdate = None.
+000173c0: 2020 2020 2020 2020 6c61 7465 7374 5f69          latest_i
+000173d0: 6e73 7464 6174 6520 3d20 4e6f 6e65 0a20  nstdate = None. 
+000173e0: 2020 2020 2020 206e 6565 6473 4672 6573         needsFres
+000173f0: 6855 7064 6174 6520 3d20 5472 7565 0a20  hUpdate = True. 
+00017400: 2020 2020 2020 206c 6173 7444 6179 4c61         lastDayLa
+00017410: 7374 4d6f 6e74 6820 3d20 504b 4461 7465  stMonth = PKDate
+00017420: 5574 696c 6974 6965 732e 6c61 7374 5f64  Utilities.last_d
+00017430: 6179 5f6f 665f 7072 6576 696f 7573 5f6d  ay_of_previous_m
+00017440: 6f6e 7468 2850 4b44 6174 6555 7469 6c69  onth(PKDateUtili
+00017450: 7469 6573 2e63 7572 7265 6e74 4461 7465  ties.currentDate
+00017460: 5469 6d65 2829 290a 2020 2020 2020 2020  Time()).        
+00017470: 6966 2068 6f73 7444 6174 6120 6973 206e  if hostData is n
+00017480: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
+00017490: 686f 7374 4461 7461 2920 3e20 303a 0a20  hostData) > 0:. 
+000174a0: 2020 2020 2020 2020 2020 2069 6620 224d             if "M
+000174b0: 4622 2069 6e20 686f 7374 4461 7461 2e63  F" in hostData.c
+000174c0: 6f6c 756d 6e73 206f 7220 2246 4949 2220  olumns or "FII" 
+000174d0: 696e 2068 6f73 7444 6174 612e 636f 6c75  in hostData.colu
+000174e0: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+000174f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00017500: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00017510: 7443 6861 6e67 654d 4620 3d20 686f 7374  tChangeMF = host
+00017520: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
+00017530: 612e 696e 6465 785b 2d31 5d2c 224d 4622  a.index[-1],"MF"
+00017540: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00017550: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00017560: 6f72 2c49 6e64 6578 4572 726f 7229 3a0a  or,IndexError):.
+00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017580: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00017590: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000175a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175b0: 2020 6e65 7443 6861 6e67 6549 6e73 7420    netChangeInst 
+000175c0: 3d20 686f 7374 4461 7461 2e6c 6f63 5b68  = hostData.loc[h
+000175d0: 6f73 7444 6174 612e 696e 6465 785b 2d31  ostData.index[-1
+000175e0: 5d2c 2246 4949 225d 0a20 2020 2020 2020  ],"FII"].       
+000175f0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00017600: 284b 6579 4572 726f 722c 496e 6465 7845  (KeyError,IndexE
+00017610: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00017620: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00017630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017640: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00017650: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
+00017660: 6d66 6461 7465 203d 2068 6f73 7444 6174  mfdate = hostDat
+00017670: 612e 6c6f 635b 686f 7374 4461 7461 2e69  a.loc[hostData.i
+00017680: 6e64 6578 5b2d 315d 2c22 4d46 5f44 6174  ndex[-1],"MF_Dat
+00017690: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
+000176a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000176b0: 7461 6e63 6528 6c61 7465 7374 5f6d 6664  tance(latest_mfd
+000176c0: 6174 652c 2066 6c6f 6174 293a 0a20 2020  ate, float):.   
+000176d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176e0: 2020 2020 206c 6174 6573 745f 6d66 6461       latest_mfda
+000176f0: 7465 203d 2064 6174 6574 696d 652e 6461  te = datetime.da
+00017700: 7465 7469 6d65 2e66 726f 6d74 696d 6573  tetime.fromtimes
+00017710: 7461 6d70 286c 6174 6573 745f 6d66 6461  tamp(latest_mfda
+00017720: 7465 292e 7374 7266 7469 6d65 2827 2559  te).strftime('%Y
+00017730: 2d25 6d2d 2564 2729 0a20 2020 2020 2020  -%m-%d').       
+00017740: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00017750: 284b 6579 4572 726f 722c 496e 6465 7845  (KeyError,IndexE
+00017760: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00017770: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00017780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017790: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000177a0: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
+000177b0: 696e 7374 6461 7465 203d 2068 6f73 7444  instdate = hostD
+000177c0: 6174 612e 6c6f 635b 686f 7374 4461 7461  ata.loc[hostData
+000177d0: 2e69 6e64 6578 5b2d 315d 2c22 4649 495f  .index[-1],"FII_
+000177e0: 4461 7465 225d 0a20 2020 2020 2020 2020  Date"].         
+000177f0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00017800: 696e 7374 616e 6365 286c 6174 6573 745f  instance(latest_
+00017810: 696e 7374 6461 7465 2c20 666c 6f61 7429  instdate, float)
+00017820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017830: 2020 2020 2020 2020 2020 6c61 7465 7374            latest
+00017840: 5f69 6e73 7464 6174 6520 3d20 6461 7465  _instdate = date
+00017850: 7469 6d65 2e64 6174 6574 696d 652e 6672  time.datetime.fr
+00017860: 6f6d 7469 6d65 7374 616d 7028 6c61 7465  omtimestamp(late
+00017870: 7374 5f69 6e73 7464 6174 6529 2e73 7472  st_instdate).str
+00017880: 6674 696d 6528 2725 592d 256d 2d25 6427  ftime('%Y-%m-%d'
+00017890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000178a0: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+000178b0: 6f72 2c49 6e64 6578 4572 726f 7229 3a0a  or,IndexError):.
+000178c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178d0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+000178e0: 2020 2020 2020 2020 2069 6620 6c61 7465           if late
+000178f0: 7374 5f6d 6664 6174 6520 6973 206e 6f74  st_mfdate is not
+00017900: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00017910: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00017920: 5f6d 6664 6174 6520 3d20 504b 4461 7465  _mfdate = PKDate
+00017930: 5574 696c 6974 6965 732e 6461 7465 4672  Utilities.dateFr
+00017940: 6f6d 596d 6453 7472 696e 6728 6c61 7465  omYmdString(late
+00017950: 7374 5f6d 6664 6174 652e 7370 6c69 7428  st_mfdate.split(
+00017960: 2254 2229 5b30 5d29 0a20 2020 2020 2020  "T")[0]).       
+00017970: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00017980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017990: 2020 2073 6176 6564 5f6d 6664 6174 6520     saved_mfdate 
+000179a0: 3d20 6c61 7374 4461 794c 6173 744d 6f6e  = lastDayLastMon
+000179b0: 7468 202d 2064 6174 6574 696d 652e 7469  th - datetime.ti
+000179c0: 6d65 6465 6c74 6128 3129 0a20 2020 2020  medelta(1).     
+000179d0: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
+000179e0: 7465 7374 5f69 6e73 7464 6174 6520 6973  test_instdate is
+000179f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00017a00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017a10: 6176 6564 5f69 6e73 7464 6174 6520 3d20  aved_instdate = 
+00017a20: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
+00017a30: 6461 7465 4672 6f6d 596d 6453 7472 696e  dateFromYmdStrin
+00017a40: 6728 6c61 7465 7374 5f69 6e73 7464 6174  g(latest_instdat
+00017a50: 652e 7370 6c69 7428 2254 2229 5b30 5d29  e.split("T")[0])
+00017a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017a80: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00017a90: 5f69 6e73 7464 6174 6520 3d20 6c61 7374  _instdate = last
+00017aa0: 4461 794c 6173 744d 6f6e 7468 202d 2064  DayLastMonth - d
+00017ab0: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
+00017ac0: 6128 3129 0a20 2020 2020 2020 2020 2020  a(1).           
+00017ad0: 2020 2020 2074 6f64 6179 203d 2050 4b44       today = PKD
+00017ae0: 6174 6555 7469 6c69 7469 6573 2e63 7572  ateUtilities.cur
+00017af0: 7265 6e74 4461 7465 5469 6d65 2829 0a20  rentDateTime(). 
+00017b00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017b10: 6565 6473 4672 6573 6855 7064 6174 6520  eedsFreshUpdate 
+00017b20: 3d20 2873 6176 6564 5f6d 6664 6174 652e  = (saved_mfdate.
+00017b30: 6461 7465 2829 203c 206c 6173 7444 6179  date() < lastDay
+00017b40: 4c61 7374 4d6f 6e74 682e 6461 7465 2829  LastMonth.date()
+00017b50: 2920 616e 6420 2873 6176 6564 5f69 6e73  ) and (saved_ins
+00017b60: 7464 6174 652e 6461 7465 2829 203c 206c  tdate.date() < l
+00017b70: 6173 7444 6179 4c61 7374 4d6f 6e74 682e  astDayLastMonth.
+00017b80: 6461 7465 2829 290a 2020 2020 2020 2020  date()).        
+00017b90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017ba0: 2020 2020 2020 2020 2020 6e65 6564 7346            needsF
+00017bb0: 7265 7368 5570 6461 7465 203d 2054 7275  reshUpdate = Tru
+00017bc0: 650a 0a20 2020 2020 2020 2069 6620 6e65  e..        if ne
+00017bd0: 6564 7346 7265 7368 5570 6461 7465 2061  edsFreshUpdate a
+00017be0: 6e64 2066 6f72 6365 3a0a 2020 2020 2020  nd force:.      
+00017bf0: 2020 2020 2020 6e65 7443 6861 6e67 654d        netChangeM
+00017c00: 462c 206e 6574 4368 616e 6765 496e 7374  F, netChangeInst
+00017c10: 2c20 6c61 7465 7374 5f6d 6664 6174 652c  , latest_mfdate,
+00017c20: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
+00017c30: 203d 2073 656c 662e 6765 7446 7265 7368   = self.getFresh
+00017c40: 4d46 4953 7461 7475 7328 7374 6f63 6b2c  MFIStatus(stock,
+00017c50: 6578 6368 616e 6765 4e61 6d65 3d65 7863  exchangeName=exc
+00017c60: 6861 6e67 654e 616d 6529 0a20 2020 2020  hangeName).     
+00017c70: 2020 2020 2020 2069 6620 6e65 7443 6861         if netCha
+00017c80: 6e67 654d 4620 6973 206e 6f74 204e 6f6e  ngeMF is not Non
+00017c90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017ca0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00017cb0: 2020 2020 2020 2020 2020 2020 686f 7374              host
+00017cc0: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
+00017cd0: 612e 696e 6465 785b 2d31 5d2c 224d 4622  a.index[-1],"MF"
+00017ce0: 5d20 3d20 6e65 7443 6861 6e67 654d 460a  ] = netChangeMF.
+00017cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d00: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
+00017d10: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
+00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d30: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+00017d40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017d50: 2020 2020 2020 2020 206e 6574 4368 616e           netChan
+00017d60: 6765 4d46 203d 2030 0a20 2020 2020 2020  geMF = 0.       
+00017d70: 2020 2020 2069 6620 6c61 7465 7374 5f6d       if latest_m
+00017d80: 6664 6174 6520 6973 206e 6f74 204e 6f6e  fdate is not Non
+00017d90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017da0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00017db0: 2020 2020 2020 2020 2020 2020 686f 7374              host
+00017dc0: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
+00017dd0: 612e 696e 6465 785b 2d31 5d2c 224d 465f  a.index[-1],"MF_
+00017de0: 4461 7465 225d 203d 206c 6174 6573 745f  Date"] = latest_
+00017df0: 6d66 6461 7465 0a20 2020 2020 2020 2020  mfdate.         
+00017e00: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
+00017e10: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
+00017e20: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00017e30: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00017e40: 2020 2020 2020 2020 2020 6966 206e 6574            if net
+00017e50: 4368 616e 6765 496e 7374 2069 7320 6e6f  ChangeInst is no
+00017e60: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00017e70: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e90: 2068 6f73 7444 6174 612e 6c6f 635b 686f   hostData.loc[ho
+00017ea0: 7374 4461 7461 2e69 6e64 6578 5b2d 315d  stData.index[-1]
+00017eb0: 2c22 4649 4922 5d20 3d20 6e65 7443 6861  ,"FII"] = netCha
+00017ec0: 6e67 6549 6e73 740a 2020 2020 2020 2020  ngeInst.        
+00017ed0: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+00017ee0: 4b65 7945 7272 6f72 2c49 6e64 6578 4572  KeyError,IndexEr
+00017ef0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+00017f00: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00017f10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00017f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017f30: 206e 6574 4368 616e 6765 496e 7374 203d   netChangeInst =
+00017f40: 2030 0a20 2020 2020 2020 2020 2020 2069   0.            i
+00017f50: 6620 6c61 7465 7374 5f69 6e73 7464 6174  f latest_instdat
+00017f60: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00017f80: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017f90: 2020 2020 2020 2020 686f 7374 4461 7461          hostData
+00017fa0: 2e6c 6f63 5b68 6f73 7444 6174 612e 696e  .loc[hostData.in
+00017fb0: 6465 785b 2d31 5d2c 2246 4949 5f44 6174  dex[-1],"FII_Dat
+00017fc0: 6522 5d20 3d20 6c61 7465 7374 5f69 6e73  e"] = latest_ins
+00017fd0: 7464 6174 650a 2020 2020 2020 2020 2020  tdate.          
+00017fe0: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
+00017ff0: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
+00018000: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00018010: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00018020: 2020 2020 206c 6173 7444 6179 4c61 7374       lastDayLast
+00018030: 4d6f 6e74 6820 3d20 6c61 7374 4461 794c  Month = lastDayL
+00018040: 6173 744d 6f6e 7468 2e73 7472 6674 696d  astMonth.strftim
+00018050: 6528 2225 592d 256d 2d25 6454 3030 3a30  e("%Y-%m-%dT00:0
+00018060: 303a 3030 2e30 3030 2229 0a20 2020 2020  0:00.000").     
+00018070: 2020 2069 6620 6f6e 6c79 4d46 3a0a 2020     if onlyMF:.  
+00018080: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018090: 206e 6574 4368 616e 6765 4d46 0a20 2020   netChangeMF.   
+000180a0: 2020 2020 2069 6620 6c61 7465 7374 5f69       if latest_i
+000180b0: 6e73 7464 6174 6520 3d3d 206c 6174 6573  nstdate == lates
+000180c0: 745f 6d66 6461 7465 3a0a 2020 2020 2020  t_mfdate:.      
+000180d0: 2020 2020 2020 7265 7475 726e 2028 6e65        return (ne
+000180e0: 7443 6861 6e67 654d 4620 2b20 6e65 7443  tChangeMF + netC
+000180f0: 6861 6e67 6549 6e73 7429 0a20 2020 2020  hangeInst).     
+00018100: 2020 2065 6c69 6620 6c61 7465 7374 5f6d     elif latest_m
+00018110: 6664 6174 6520 3d3d 206c 6173 7444 6179  fdate == lastDay
+00018120: 4c61 7374 4d6f 6e74 683a 0a20 2020 2020  LastMonth:.     
+00018130: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+00018140: 7443 6861 6e67 654d 460a 2020 2020 2020  tChangeMF.      
+00018150: 2020 656c 6966 206c 6174 6573 745f 696e    elif latest_in
+00018160: 7374 6461 7465 203d 3d20 6c61 7374 4461  stdate == lastDa
+00018170: 794c 6173 744d 6f6e 7468 3a0a 2020 2020  yLastMonth:.    
+00018180: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+00018190: 6574 4368 616e 6765 496e 7374 0a20 2020  etChangeInst.   
+000181a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000181b0: 2020 2020 2020 2023 2066 696e 6420 7468         # find th
+000181c0: 6520 6c61 7465 7374 2064 6174 650a 2020  e latest date.  
+000181d0: 2020 2020 2020 2020 2020 6966 206c 6174            if lat
+000181e0: 6573 745f 6d66 6461 7465 2069 7320 6e6f  est_mfdate is no
+000181f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00018200: 2020 2020 2020 2020 6c61 7465 7374 5f6d          latest_m
+00018210: 6664 6174 6520 3d20 504b 4461 7465 5574  fdate = PKDateUt
+00018220: 696c 6974 6965 732e 6461 7465 4672 6f6d  ilities.dateFrom
+00018230: 596d 6453 7472 696e 6728 6c61 7465 7374  YmdString(latest
+00018240: 5f6d 6664 6174 652e 7370 6c69 7428 2254  _mfdate.split("T
+00018250: 2229 5b30 5d29 0a20 2020 2020 2020 2020  ")[0]).         
+00018260: 2020 2069 6620 6c61 7465 7374 5f69 6e73     if latest_ins
+00018270: 7464 6174 6520 6973 206e 6f74 204e 6f6e  tdate is not Non
+00018280: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00018290: 2020 206c 6174 6573 745f 696e 7374 6461     latest_instda
+000182a0: 7465 203d 2050 4b44 6174 6555 7469 6c69  te = PKDateUtili
+000182b0: 7469 6573 2e64 6174 6546 726f 6d59 6d64  ties.dateFromYmd
+000182c0: 5374 7269 6e67 286c 6174 6573 745f 696e  String(latest_in
+000182d0: 7374 6461 7465 2e73 706c 6974 2822 5422  stdate.split("T"
+000182e0: 295b 305d 290a 2020 2020 2020 2020 2020  )[0]).          
+000182f0: 2020 7265 7475 726e 206e 6574 4368 616e    return netChan
+00018300: 6765 4d46 2069 6620 2828 6c61 7465 7374  geMF if ((latest
+00018310: 5f6d 6664 6174 6520 6973 206e 6f74 204e  _mfdate is not N
+00018320: 6f6e 6529 2061 6e64 206c 6174 6573 745f  one) and latest_
+00018330: 6d66 6461 7465 203e 2028 6c61 7465 7374  mfdate > (latest
+00018340: 5f69 6e73 7464 6174 6520 6966 206c 6174  _instdate if lat
+00018350: 6573 745f 696e 7374 6461 7465 2069 7320  est_instdate is 
+00018360: 6e6f 7420 4e6f 6e65 2065 6c73 6520 286c  not None else (l
+00018370: 6174 6573 745f 6d66 6461 7465 202d 2064  atest_mfdate - d
+00018380: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
+00018390: 6128 3129 2929 2920 656c 7365 206e 6574  a(1)))) else net
+000183a0: 4368 616e 6765 496e 7374 0a0a 2020 2020  ChangeInst..    
+000183b0: 6465 6620 6765 7446 7265 7368 4d46 4953  def getFreshMFIS
+000183c0: 7461 7475 7328 7365 6c66 2c20 7374 6f63  tatus(self, stoc
+000183d0: 6b2c 6578 6368 616e 6765 4e61 6d65 3d22  k,exchangeName="
+000183e0: 494e 4449 4122 293a 0a20 2020 2020 2020  INDIA"):.       
+000183f0: 2063 6861 6e67 6553 7461 7475 7344 6174   changeStatusDat
+00018400: 614d 4620 3d20 4e6f 6e65 0a20 2020 2020  aMF = None.     
+00018410: 2020 2063 6861 6e67 6553 7461 7475 7344     changeStatusD
+00018420: 6174 6149 6e73 7420 3d20 4e6f 6e65 0a20  ataInst = None. 
+00018430: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
+00018440: 4d46 203d 2030 0a20 2020 2020 2020 206e  MF = 0.        n
+00018450: 6574 4368 616e 6765 496e 7374 203d 2030  etChangeInst = 0
+00018460: 0a20 2020 2020 2020 206c 6174 6573 745f  .        latest_
+00018470: 6d66 6461 7465 203d 204e 6f6e 650a 2020  mfdate = None.  
+00018480: 2020 2020 2020 6c61 7465 7374 5f69 6e73        latest_ins
+00018490: 7464 6174 6520 3d20 4e6f 6e65 0a20 2020  tdate = None.   
+000184a0: 2020 2020 2073 6563 7572 6974 7920 3d20       security = 
+000184b0: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
+000184c0: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+000184d0: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
+000184e0: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
+000184f0: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
+00018500: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
+00018510: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018520: 6563 7572 6974 7920 3d20 5374 6f63 6b28  ecurity = Stock(
+00018530: 7374 6f63 6b2c 6578 6368 616e 6765 3d65  stock,exchange=e
+00018540: 7863 6861 6e67 654e 616d 6529 0a20 2020  xchangeName).   
+00018550: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
+00018560: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+00018570: 2020 2020 2320 5765 2064 6964 206e 6f74      # We did not
+00018580: 2066 696e 6420 7468 6520 7374 6f63 6b3f   find the stock?
+00018590: 2049 7427 7320 6f6b 6179 2e20 4d6f 7665   It's okay. Move
+000185a0: 206f 6e20 746f 2074 6865 206e 6578 7420   on to the next 
+000185b0: 6f6e 652e 0a20 2020 2020 2020 2020 2020  one..           
+000185c0: 2070 6173 730a 2020 2020 2020 2020 6578   pass.        ex
+000185d0: 6365 7074 2028 5469 6d65 6f75 7445 7272  cept (TimeoutErr
+000185e0: 6f72 2c20 436f 6e6e 6563 7469 6f6e 4572  or, ConnectionEr
+000185f0: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
+00018600: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
+00018610: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
+00018620: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
+00018630: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
+00018640: 6173 730a 2020 2020 2020 2020 6578 6365  ass.        exce
+00018650: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00018660: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00018670: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+00018680: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+00018690: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+000186a0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+000186b0: 2020 2020 6966 2073 6563 7572 6974 7920      if security 
+000186c0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000186d0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000186e0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+000186f0: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
+00018700: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
+00018710: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
+00018720: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
+00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018740: 2020 2063 6861 6e67 6553 7461 7475 7352     changeStatusR
+00018750: 6f77 734d 4620 3d20 7365 6375 7269 7479  owsMF = security
+00018760: 2e6d 7574 7561 6c46 756e 644f 776e 6572  .mutualFundOwner
+00018770: 7368 6970 2874 6f70 3d35 290a 2020 2020  ship(top=5).    
+00018780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018790: 6368 616e 6765 5374 6174 7573 526f 7773  changeStatusRows
+000187a0: 496e 7374 203d 2073 6563 7572 6974 792e  Inst = security.
+000187b0: 696e 7374 6974 7574 696f 6e4f 776e 6572  institutionOwner
+000187c0: 7368 6970 2874 6f70 3d35 290a 2020 2020  ship(top=5).    
+000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187e0: 6368 616e 6765 5374 6174 7573 4461 7461  changeStatusData
+000187f0: 4d46 203d 2073 6563 7572 6974 792e 6d75  MF = security.mu
+00018800: 7475 616c 4675 6e64 4649 4943 6861 6e67  tualFundFIIChang
+00018810: 6544 6174 6128 6368 616e 6765 5374 6174  eData(changeStat
+00018820: 7573 526f 7773 4d46 290a 2020 2020 2020  usRowsMF).      
+00018830: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00018840: 616e 6765 5374 6174 7573 4461 7461 496e  angeStatusDataIn
+00018850: 7374 203d 2073 6563 7572 6974 792e 6d75  st = security.mu
+00018860: 7475 616c 4675 6e64 4649 4943 6861 6e67  tualFundFIIChang
+00018870: 6544 6174 6128 6368 616e 6765 5374 6174  eData(changeStat
+00018880: 7573 526f 7773 496e 7374 290a 2020 2020  usRowsInst).    
+00018890: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000188a0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+000188b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000188c0: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+000188d0: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+000188e0: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+000188f0: 2020 2020 2020 2020 2020 2023 2054 7970             # Typ
+00018900: 6545 7272 6f72 206f 7220 436f 6e6e 6563  eError or Connec
+00018910: 7469 6f6e 4572 726f 7220 6265 6361 7573  tionError becaus
+00018920: 6520 7765 2063 6f75 6c64 206e 6f74 2066  e we could not f
+00018930: 696e 6420 7468 6520 7374 6f63 6b20 6f72  ind the stock or
+00018940: 204d 4649 2064 6174 6120 6973 6e27 7420   MFI data isn't 
+00018950: 6176 6169 6c61 626c 653f 0a20 2020 2020  available?.     
+00018960: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00018970: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+00018980: 4461 794c 6173 744d 6f6e 7468 203d 2050  DayLastMonth = P
+00018990: 4b44 6174 6555 7469 6c69 7469 6573 2e6c  KDateUtilities.l
+000189a0: 6173 745f 6461 795f 6f66 5f70 7265 7669  ast_day_of_previ
+000189b0: 6f75 735f 6d6f 6e74 6828 504b 4461 7465  ous_month(PKDate
+000189c0: 5574 696c 6974 6965 732e 6375 7272 656e  Utilities.curren
+000189d0: 7444 6174 6554 696d 6528 2929 0a20 2020  tDateTime()).   
+000189e0: 2020 2020 2020 2020 206c 6173 7444 6179           lastDay
+000189f0: 4c61 7374 4d6f 6e74 6820 3d20 6c61 7374  LastMonth = last
+00018a00: 4461 794c 6173 744d 6f6e 7468 2e73 7472  DayLastMonth.str
+00018a10: 6674 696d 6528 2225 592d 256d 2d25 6454  ftime("%Y-%m-%dT
+00018a20: 3030 3a30 303a 3030 2e30 3030 2229 0a20  00:00:00.000"). 
+00018a30: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
+00018a40: 616e 6765 5374 6174 7573 4461 7461 4d46  angeStatusDataMF
+00018a50: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00018a60: 206c 656e 2863 6861 6e67 6553 7461 7475   len(changeStatu
+00018a70: 7344 6174 614d 4629 203e 2030 3a0a 2020  sDataMF) > 0:.  
+00018a80: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00018a90: 5f67 726f 7570 6564 4d46 203d 2063 6861  _groupedMF = cha
+00018aa0: 6e67 6553 7461 7475 7344 6174 614d 462e  ngeStatusDataMF.
+00018ab0: 6772 6f75 7062 7928 2264 6174 6522 2c20  groupby("date", 
+00018ac0: 736f 7274 3d46 616c 7365 290a 2020 2020  sort=False).    
+00018ad0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00018ae0: 6d66 6461 7465 2c20 6466 5f67 726f 7570  mfdate, df_group
+00018af0: 4d46 2069 6e20 6466 5f67 726f 7570 6564  MF in df_grouped
+00018b00: 4d46 3a0a 2020 2020 2020 2020 2020 2020  MF:.            
+00018b10: 2020 2020 2020 2020 6e65 7443 6861 6e67          netChang
+00018b20: 654d 4620 3d20 6466 5f67 726f 7570 4d46  eMF = df_groupMF
+00018b30: 5b22 6368 616e 6765 416d 6f75 6e74 225d  ["changeAmount"]
+00018b40: 2e73 756d 2829 0a20 2020 2020 2020 2020  .sum().         
+00018b50: 2020 2020 2020 2020 2020 206c 6174 6573             lates
+00018b60: 745f 6d66 6461 7465 203d 206d 6664 6174  t_mfdate = mfdat
+00018b70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00018b80: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00018b90: 2020 2020 2020 2020 6966 2063 6861 6e67          if chang
+00018ba0: 6553 7461 7475 7344 6174 6149 6e73 7420  eStatusDataInst 
+00018bb0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00018bc0: 6c65 6e28 6368 616e 6765 5374 6174 7573  len(changeStatus
+00018bd0: 4461 7461 496e 7374 2920 3e20 303a 0a20  DataInst) > 0:. 
+00018be0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00018bf0: 665f 6772 6f75 7065 6449 6e73 7420 3d20  f_groupedInst = 
+00018c00: 6368 616e 6765 5374 6174 7573 4461 7461  changeStatusData
+00018c10: 496e 7374 2e67 726f 7570 6279 2822 6461  Inst.groupby("da
+00018c20: 7465 222c 2073 6f72 743d 4661 6c73 6529  te", sort=False)
+00018c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018c40: 2066 6f72 2069 6e73 7464 6174 652c 2064   for instdate, d
+00018c50: 665f 6772 6f75 7049 6e73 7420 696e 2064  f_groupInst in d
+00018c60: 665f 6772 6f75 7065 6449 6e73 743a 0a20  f_groupedInst:. 
+00018c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c80: 2020 2069 6620 286c 6174 6573 745f 6d66     if (latest_mf
+00018c90: 6461 7465 2069 7320 6e6f 7420 4e6f 6e65  date is not None
+00018ca0: 2061 6e64 206c 6174 6573 745f 6d66 6461   and latest_mfda
+00018cb0: 7465 203d 3d20 696e 7374 6461 7465 2920  te == instdate) 
+00018cc0: 6f72 2028 6c61 7465 7374 5f6d 6664 6174  or (latest_mfdat
+00018cd0: 6520 6973 204e 6f6e 6529 206f 7220 2869  e is None) or (i
+00018ce0: 6e73 7464 6174 6520 3d3d 206c 6173 7444  nstdate == lastD
+00018cf0: 6179 4c61 7374 4d6f 6e74 6829 3a0a 2020  ayLastMonth):.  
+00018d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d10: 2020 2020 2020 6e65 7443 6861 6e67 6549        netChangeI
+00018d20: 6e73 7420 3d20 6466 5f67 726f 7570 496e  nst = df_groupIn
+00018d30: 7374 5b22 6368 616e 6765 416d 6f75 6e74  st["changeAmount
+00018d40: 225d 2e73 756d 2829 0a20 2020 2020 2020  "].sum().       
+00018d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d60: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
+00018d70: 203d 2069 6e73 7464 6174 650a 2020 2020   = instdate.    
+00018d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d90: 6272 6561 6b0a 2020 2020 2020 2020 7265  break.        re
+00018da0: 7475 726e 206e 6574 4368 616e 6765 4d46  turn netChangeMF
+00018db0: 2c6e 6574 4368 616e 6765 496e 7374 2c6c  ,netChangeInst,l
+00018dc0: 6174 6573 745f 6d66 6461 7465 2c6c 6174  atest_mfdate,lat
+00018dd0: 6573 745f 696e 7374 6461 7465 0a0a 0a20  est_instdate... 
+00018de0: 2020 2064 6566 2067 6574 4e69 6674 7950     def getNiftyP
+00018df0: 7265 6469 6374 696f 6e28 7365 6c66 2c20  rediction(self, 
+00018e00: 6466 293a 0a20 2020 2020 2020 2069 6d70  df):.        imp
+00018e10: 6f72 7420 7761 726e 696e 6773 0a0a 2020  ort warnings..  
+00018e20: 2020 2020 2020 7761 726e 696e 6773 2e66        warnings.f
+00018e30: 696c 7465 7277 6172 6e69 6e67 7328 2269  ilterwarnings("i
+00018e40: 676e 6f72 6522 290a 2020 2020 2020 2020  gnore").        
+00018e50: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+00018e60: 0a20 2020 2020 2020 206d 6f64 656c 2c20  .        model, 
+00018e70: 706b 6c20 3d20 5574 696c 6974 792e 746f  pkl = Utility.to
+00018e80: 6f6c 732e 6765 744e 6966 7479 4d6f 6465  ols.getNiftyMode
+00018e90: 6c28 290a 2020 2020 2020 2020 6966 206d  l().        if m
+00018ea0: 6f64 656c 2069 7320 4e6f 6e65 206f 7220  odel is None or 
+00018eb0: 706b 6c20 6973 204e 6f6e 653a 0a20 2020  pkl is None:.   
+00018ec0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018ed0: 302c 2022 556e 6b6e 6f77 6e22 2c20 2255  0, "Unknown", "U
+00018ee0: 6e6b 6e6f 776e 220a 2020 2020 2020 2020  nknown".        
+00018ef0: 7769 7468 2053 7570 7072 6573 734f 7574  with SuppressOut
+00018f00: 7075 7428 7375 7070 7265 7373 5f73 7464  put(suppress_std
+00018f10: 6572 723d 5472 7565 2c20 7375 7070 7265  err=True, suppre
+00018f20: 7373 5f73 7464 6f75 743d 5472 7565 293a  ss_stdout=True):
+00018f30: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00018f40: 6120 3d20 6461 7461 5b70 6b6c 5b22 636f  a = data[pkl["co
+00018f50: 6c75 6d6e 7322 5d5d 0a20 2020 2020 2020  lumns"]].       
+00018f60: 2020 2020 2023 2323 2076 3220 5072 6570       ### v2 Prep
+00018f70: 726f 6365 7373 696e 670a 2020 2020 2020  rocessing.      
+00018f80: 2020 2020 2020 6461 7461 5b22 4869 6768        data["High
+00018f90: 225d 203d 2064 6174 615b 2248 6967 6822  "] = data["High"
+00018fa0: 5d2e 7063 745f 6368 616e 6765 2829 202a  ].pct_change() *
+00018fb0: 2031 3030 0a20 2020 2020 2020 2020 2020   100.           
+00018fc0: 2064 6174 615b 224c 6f77 225d 203d 2064   data["Low"] = d
+00018fd0: 6174 615b 224c 6f77 225d 2e70 6374 5f63  ata["Low"].pct_c
+00018fe0: 6861 6e67 6528 2920 2a20 3130 300a 2020  hange() * 100.  
+00018ff0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+00019000: 4f70 656e 225d 203d 2064 6174 615b 224f  Open"] = data["O
+00019010: 7065 6e22 5d2e 7063 745f 6368 616e 6765  pen"].pct_change
+00019020: 2829 202a 2031 3030 0a20 2020 2020 2020  () * 100.       
+00019030: 2020 2020 2064 6174 615b 2243 6c6f 7365       data["Close
+00019040: 225d 203d 2064 6174 615b 2243 6c6f 7365  "] = data["Close
+00019050: 225d 2e70 6374 5f63 6861 6e67 6528 2920  "].pct_change() 
+00019060: 2a20 3130 300a 2020 2020 2020 2020 2020  * 100.          
+00019070: 2020 6461 7461 203d 2064 6174 612e 696c    data = data.il
+00019080: 6f63 5b2d 315d 0a20 2020 2020 2020 2020  oc[-1].         
+00019090: 2020 2023 2323 0a20 2020 2020 2020 2020     ###.         
+000190a0: 2020 2064 6174 6120 3d20 706b 6c5b 2273     data = pkl["s
+000190b0: 6361 6c65 7222 5d2e 7472 616e 7366 6f72  caler"].transfor
+000190c0: 6d28 5b64 6174 615d 290a 2020 2020 2020  m([data]).      
+000190d0: 2020 2020 2020 7769 7468 2053 7570 7072        with Suppr
+000190e0: 6573 734f 7574 7075 7428 7375 7070 7265  essOutput(suppre
+000190f0: 7373 5f73 7464 6f75 743d 5472 7565 2c20  ss_stdout=True, 
+00019100: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
+00019110: 5472 7565 293a 0a20 2020 2020 2020 2020  True):.         
+00019120: 2020 2020 2020 2070 7265 6420 3d20 6d6f         pred = mo
+00019130: 6465 6c2e 7072 6564 6963 7428 6461 7461  del.predict(data
+00019140: 295b 305d 0a20 2020 2020 2020 2069 6620  )[0].        if 
+00019150: 7072 6564 203e 2030 2e35 3a0a 2020 2020  pred > 0.5:.    
+00019160: 2020 2020 2020 2020 6f75 7454 6578 7420          outText 
+00019170: 3d20 2242 4541 5249 5348 220a 2020 2020  = "BEARISH".    
+00019180: 2020 2020 2020 2020 6f75 7420 3d20 280a          out = (.
+00019190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191a0: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
+000191b0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000191c0: 2063 6f6c 6f72 5465 7874 2e46 4149 4c0a   colorText.FAIL.
+000191d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191e0: 2b20 6f75 7454 6578 740a 2020 2020 2020  + outText.      
+000191f0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+00019200: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00019210: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+00019220: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+00019230: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00019240: 2020 2020 2073 7567 203d 2022 486f 6c64       sug = "Hold
+00019250: 2079 6f75 7220 5368 6f72 7420 706f 7369   your Short posi
+00019260: 7469 6f6e 2122 0a20 2020 2020 2020 2065  tion!".        e
+00019270: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00019280: 206f 7574 5465 7874 203d 2022 4255 4c4c   outText = "BULL
+00019290: 4953 4822 0a20 2020 2020 2020 2020 2020  ISH".           
+000192a0: 206f 7574 203d 2028 0a20 2020 2020 2020   out = (.       
+000192b0: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
+000192c0: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+000192d0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
+000192e0: 6578 742e 4752 4545 4e0a 2020 2020 2020  ext.GREEN.      
+000192f0: 2020 2020 2020 2020 2020 2b20 6f75 7454            + outT
+00019300: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+00019310: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00019320: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00019330: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00019340: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
+00019350: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+00019360: 7567 203d 2022 5374 6179 2042 756c 6c69  ug = "Stay Bulli
+00019370: 7368 2122 0a20 2020 2020 2020 2069 6620  sh!".        if 
+00019380: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
+00019390: 6973 436c 6f73 696e 6748 6f75 7228 293a  isClosingHour():
+000193a0: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
+000193b0: 7075 7443 6f6e 7472 6f6c 7328 292e 7072  putControls().pr
+000193c0: 696e 744f 7574 7075 7428 0a20 2020 2020  intOutput(.     
+000193d0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+000193e0: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+000193f0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+00019400: 7254 6578 742e 5741 524e 0a20 2020 2020  rText.WARN.     
+00019410: 2020 2020 2020 2020 2020 202b 2022 4e6f             + "No
+00019420: 7465 3a20 5468 6520 4149 2070 7265 6469  te: The AI predi
+00019430: 6374 696f 6e20 7368 6f75 6c64 2062 6520  ction should be 
+00019440: 6578 6563 7574 6564 2041 6674 6572 2033  executed After 3
+00019450: 2050 4d20 6f72 204e 6561 7220 746f 2043   PM or Near to C
+00019460: 6c6f 7369 6e67 2074 696d 6520 6173 2074  losing time as t
+00019470: 6865 2050 7265 6469 6374 696f 6e20 4163  he Prediction Ac
+00019480: 6375 7261 6379 2069 7320 6261 7365 6420  curacy is based 
+00019490: 6f6e 2074 6865 2043 6c6f 7369 6e67 2070  on the Closing p
+000194a0: 7269 6365 2122 0a20 2020 2020 2020 2020  rice!".         
+000194b0: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+000194c0: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+000194d0: 2020 2029 0a20 2020 2020 2020 2070 7265     ).        pre
+000194e0: 6469 6374 696f 6e54 6578 7420 3d20 224d  dictionText = "M
+000194f0: 6172 6b65 7420 6d61 7920 4f70 656e 207b  arket may Open {
+00019500: 7d20 6e65 7874 2064 6179 2120 7b7d 222e  } next day! {}".
+00019510: 666f 726d 6174 286f 7574 2c20 7375 6729  format(out, sug)
+00019520: 0a20 2020 2020 2020 2073 7472 656e 6774  .        strengt
+00019530: 6854 6578 7420 3d20 2250 726f 6261 6269  hText = "Probabi
+00019540: 6c69 7479 2f53 7472 656e 6774 6820 6f66  lity/Strength of
+00019550: 2050 7265 6469 6374 696f 6e20 3d20 7b7d   Prediction = {}
+00019560: 2522 2e66 6f72 6d61 7428 0a20 2020 2020  %".format(.     
+00019570: 2020 2020 2020 2055 7469 6c69 7479 2e74         Utility.t
+00019580: 6f6f 6c73 2e67 6574 5369 676d 6f69 6443  ools.getSigmoidC
+00019590: 6f6e 6669 6465 6e63 6528 7072 6564 5b30  onfidence(pred[0
+000195a0: 5d29 0a20 2020 2020 2020 2029 0a20 2020  ]).        ).   
+000195b0: 2020 2020 204f 7574 7075 7443 6f6e 7472       OutputContr
+000195c0: 6f6c 7328 292e 7072 696e 744f 7574 7075  ols().printOutpu
+000195d0: 7428 0a20 2020 2020 2020 2020 2020 2063  t(.            c
+000195e0: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
+000195f0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+00019600: 7254 6578 742e 424c 5545 0a20 2020 2020  rText.BLUE.     
+00019610: 2020 2020 2020 202b 2022 5c6e 220a 2020         + "\n".  
+00019620: 2020 2020 2020 2020 2020 2b20 225b 2b5d            + "[+]
+00019630: 204e 6966 7479 2041 4920 5072 6564 6963   Nifty AI Predic
+00019640: 7469 6f6e 202d 3e20 220a 2020 2020 2020  tion -> ".      
+00019650: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+00019660: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+00019670: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+00019680: 4c44 0a20 2020 2020 2020 2020 2020 202b  LD.            +
+00019690: 2070 7265 6469 6374 696f 6e54 6578 740a   predictionText.
+000196a0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+000196b0: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+000196c0: 2020 2020 290a 2020 2020 2020 2020 4f75      ).        Ou
+000196d0: 7470 7574 436f 6e74 726f 6c73 2829 2e70  tputControls().p
+000196e0: 7269 6e74 4f75 7470 7574 280a 2020 2020  rintOutput(.    
+000196f0: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+00019700: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+00019710: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
+00019720: 4c55 450a 2020 2020 2020 2020 2020 2020  LUE.            
+00019730: 2b20 225c 6e22 0a20 2020 2020 2020 2020  + "\n".         
+00019740: 2020 202b 2022 5b2b 5d20 4e69 6674 7920     + "[+] Nifty 
+00019750: 4149 2050 7265 6469 6374 696f 6e20 2d3e  AI Prediction ->
+00019760: 2022 0a20 2020 2020 2020 2020 2020 202b   ".            +
+00019770: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00019780: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+00019790: 656e 6774 6854 6578 740a 2020 2020 2020  engthText.      
+000197a0: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
+000197b0: 7572 6e20 7072 6564 2c20 7072 6564 6963  urn pred, predic
+000197c0: 7469 6f6e 5465 7874 2e72 6570 6c61 6365  tionText.replace
+000197d0: 286f 7574 2c20 6f75 7454 6578 7429 2c20  (out, outText), 
+000197e0: 7374 7265 6e67 7468 5465 7874 0a0a 2020  strengthText..  
+000197f0: 2020 6465 6620 6d6f 6e69 746f 7246 6976    def monitorFiv
+00019800: 6545 6d61 2873 656c 662c 2066 6574 6368  eEma(self, fetch
+00019810: 6572 2c20 7265 7375 6c74 5f64 662c 206c  er, result_df, l
+00019820: 6173 745f 7369 676e 616c 2c20 7269 736b  ast_signal, risk
+00019830: 5f72 6577 6172 643d 3329 3a0a 2020 2020  _reward=3):.    
+00019840: 2020 2020 636f 6c5f 6e61 6d65 7320 3d20      col_names = 
+00019850: 5b22 4869 6768 222c 2022 4c6f 7722 2c20  ["High", "Low", 
+00019860: 2243 6c6f 7365 222c 2022 3545 4d41 225d  "Close", "5EMA"]
+00019870: 0a20 2020 2020 2020 2064 6174 615f 6c69  .        data_li
+00019880: 7374 203d 205b 226e 6966 7479 5f62 7579  st = ["nifty_buy
+00019890: 222c 2022 6261 6e6b 6e69 6674 795f 6275  ", "banknifty_bu
+000198a0: 7922 2c20 226e 6966 7479 5f73 656c 6c22  y", "nifty_sell"
+000198b0: 2c20 2262 616e 6b6e 6966 7479 5f73 656c  , "banknifty_sel
+000198c0: 6c22 5d0a 0a20 2020 2020 2020 2064 6174  l"]..        dat
+000198d0: 615f 7475 706c 6520 3d20 6665 7463 6865  a_tuple = fetche
+000198e0: 722e 6665 7463 6846 6976 6545 6d61 4461  r.fetchFiveEmaDa
+000198f0: 7461 2829 0a20 2020 2020 2020 2066 6f72  ta().        for
+00019900: 2063 6e74 2069 6e20 7261 6e67 6528 6c65   cnt in range(le
+00019910: 6e28 6461 7461 5f74 7570 6c65 2929 3a0a  n(data_tuple)):.
+00019920: 2020 2020 2020 2020 2020 2020 6420 3d20              d = 
+00019930: 6461 7461 5f74 7570 6c65 5b63 6e74 5d0a  data_tuple[cnt].
+00019940: 2020 2020 2020 2020 2020 2020 645b 2235              d["5
+00019950: 454d 4122 5d20 3d20 706b 7461 6c69 622e  EMA"] = pktalib.
+00019960: 454d 4128 645b 2243 6c6f 7365 225d 2c20  EMA(d["Close"], 
+00019970: 7469 6d65 7065 7269 6f64 3d35 290a 2020  timeperiod=5).  
+00019980: 2020 2020 2020 2020 2020 6420 3d20 645b            d = d[
+00019990: 636f 6c5f 6e61 6d65 735d 0a20 2020 2020  col_names].     
+000199a0: 2020 2020 2020 2064 203d 2064 2e64 726f         d = d.dro
+000199b0: 706e 6128 292e 726f 756e 6428 3229 0a0a  pna().round(2)..
+000199c0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+000199d0: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
+000199e0: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
+000199f0: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
+00019a00: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
+00019a10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019a20: 2273 656c 6c22 2069 6e20 6461 7461 5f6c  "sell" in data_l
+00019a30: 6973 745b 636e 745d 3a0a 2020 2020 2020  ist[cnt]:.      
+00019a40: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00019a50: 7265 6368 6564 203d 2064 5b28 642e 4c6f  reched = d[(d.Lo
+00019a60: 7720 3e20 645b 2235 454d 4122 5d29 2026  w > d["5EMA"]) &
+00019a70: 2028 642e 4c6f 7720 2d20 645b 2235 454d   (d.Low - d["5EM
+00019a80: 4122 5d20 3e20 302e 3529 5d0a 2020 2020  A"] > 0.5)].    
+00019a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019aa0: 7374 7265 6368 6564 5b22 534c 225d 203d  streched["SL"] =
+00019ab0: 2073 7472 6563 6865 642e 4869 6768 0a20   streched.High. 
+00019ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ad0: 2020 2076 616c 6964 6174 6520 3d20 645b     validate = d[
+00019ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019af0: 2020 2020 2020 2020 2028 642e 4c6f 772e           (d.Low.
+00019b00: 7368 6966 7428 3129 203e 2064 5b22 3545  shift(1) > d["5E
+00019b10: 4d41 225d 2e73 6869 6674 2831 2929 0a20  MA"].shift(1)). 
+00019b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b30: 2020 2020 2020 2026 2028 642e 4c6f 772e         & (d.Low.
+00019b40: 7368 6966 7428 3129 202d 2064 5b22 3545  shift(1) - d["5E
+00019b50: 4d41 225d 2e73 6869 6674 2831 2920 3e20  MA"].shift(1) > 
+00019b60: 302e 3529 0a20 2020 2020 2020 2020 2020  0.5).           
+00019b70: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00019b80: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00019b90: 6c64 5f69 6e64 6578 203d 2076 616c 6964  ld_index = valid
+00019ba0: 6174 652e 696e 6465 780a 2020 2020 2020  ate.index.      
+00019bb0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bd0: 2020 2020 6d61 736b 203d 2028 642e 4869      mask = (d.Hi
+00019be0: 6768 203c 2064 5b22 3545 4d41 225d 2920  gh < d["5EMA"]) 
+00019bf0: 2620 2864 5b22 3545 4d41 225d 202d 2064  & (d["5EMA"] - d
+00019c00: 2e48 6967 6820 3e20 302e 3529 2020 2320  .High > 0.5)  # 
+00019c10: 4275 790a 2020 2020 2020 2020 2020 2020  Buy.            
+00019c20: 2020 2020 2020 2020 7374 7265 6368 6564          streched
+00019c30: 203d 2064 5b6d 6173 6b5d 0a20 2020 2020   = d[mask].     
+00019c40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00019c50: 7472 6563 6865 645b 2253 4c22 5d20 3d20  treched["SL"] = 
+00019c60: 7374 7265 6368 6564 2e4c 6f77 0a20 2020  streched.Low.   
+00019c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c80: 2076 616c 6964 6174 6520 3d20 642e 6c6f   validate = d.lo
+00019c90: 635b 6d61 736b 2e73 6869 6674 2831 292e  c[mask.shift(1).
+00019ca0: 6669 6c6c 6e61 2846 616c 7365 295d 0a20  fillna(False)]. 
+00019cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cc0: 2020 206f 6c64 5f69 6e64 6578 203d 2076     old_index = v
+00019cd0: 616c 6964 6174 652e 696e 6465 780a 2020  alidate.index.  
+00019ce0: 2020 2020 2020 2020 2020 7467 7420 3d20            tgt = 
+00019cf0: 7064 2e44 6174 6146 7261 6d65 280a 2020  pd.DataFrame(.  
+00019d00: 2020 2020 2020 2020 2020 2020 2020 280a                (.
+00019d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d20: 2020 2020 7661 6c69 6461 7465 2e43 6c6f      validate.Clo
+00019d30: 7365 2e72 6573 6574 5f69 6e64 6578 2864  se.reset_index(d
+00019d40: 726f 703d 5472 7565 290a 2020 2020 2020  rop=True).      
+00019d50: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+00019d60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019d70: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
 00019d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00019da0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00019db0: 2072 6973 6b5f 7265 7761 7264 0a20 2020   risk_reward.   
+00019d90: 2020 2020 2020 2020 7374 7265 6368 6564          streched
+00019da0: 2e53 4c2e 7265 7365 745f 696e 6465 7828  .SL.reset_index(
+00019db0: 6472 6f70 3d54 7275 6529 0a20 2020 2020  drop=True).     
 00019dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019dd0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00019de0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-00019df0: 2020 2020 2020 636f 6c75 6d6e 733d 5b22        columns=["
-00019e00: 5461 7267 6574 225d 2c0a 2020 2020 2020  Target"],.      
-00019e10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00019e20: 2020 2020 7661 6c69 6461 7465 203d 2070      validate = p
-00019e30: 642e 636f 6e63 6174 280a 2020 2020 2020  d.concat(.      
-00019e40: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-00019e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e60: 7661 6c69 6461 7465 2e72 6573 6574 5f69  validate.reset_i
-00019e70: 6e64 6578 2864 726f 703d 5472 7565 292c  ndex(drop=True),
-00019e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019e90: 2020 2020 2073 7472 6563 6865 645b 2253       streched["S
-00019ea0: 4c22 5d2e 7265 7365 745f 696e 6465 7828  L"].reset_index(
-00019eb0: 6472 6f70 3d54 7275 6529 2c0a 2020 2020  drop=True),.    
-00019ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ed0: 7467 742c 0a20 2020 2020 2020 2020 2020  tgt,.           
-00019ee0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
-00019ef0: 2020 2020 2020 2020 6178 6973 3d31 2c0a          axis=1,.
-00019f00: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00019f10: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
-00019f20: 7465 203d 2076 616c 6964 6174 652e 7461  te = validate.ta
-00019f30: 696c 286c 656e 286f 6c64 5f69 6e64 6578  il(len(old_index
-00019f40: 2929 0a20 2020 2020 2020 2020 2020 2076  )).            v
-00019f50: 616c 6964 6174 6520 3d20 7661 6c69 6461  alidate = valida
-00019f60: 7465 2e73 6574 5f69 6e64 6578 286f 6c64  te.set_index(old
-00019f70: 5f69 6e64 6578 290a 2020 2020 2020 2020  _index).        
-00019f80: 2020 2020 6966 2022 7365 6c6c 2220 696e      if "sell" in
-00019f90: 2064 6174 615f 6c69 7374 5b63 6e74 5d3a   data_list[cnt]:
-00019fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019fb0: 2066 696e 616c 203d 2076 616c 6964 6174   final = validat
-00019fc0: 655b 7661 6c69 6461 7465 2e43 6c6f 7365  e[validate.Close
-00019fd0: 203c 2076 616c 6964 6174 655b 2235 454d   < validate["5EM
-00019fe0: 4122 5d5d 2e74 6169 6c28 3129 0a20 2020  A"]].tail(1).   
-00019ff0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001a000: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001a010: 696e 616c 203d 2076 616c 6964 6174 655b  inal = validate[
-0001a020: 7661 6c69 6461 7465 2e43 6c6f 7365 203e  validate.Close >
-0001a030: 2076 616c 6964 6174 655b 2235 454d 4122   validate["5EMA"
-0001a040: 5d5d 2e74 6169 6c28 3129 0a0a 2020 2020  ]].tail(1)..    
-0001a050: 2020 2020 2020 2020 6966 2064 6174 615f          if data_
-0001a060: 6c69 7374 5b63 6e74 5d20 6e6f 7420 696e  list[cnt] not in
-0001a070: 206c 6173 745f 7369 676e 616c 3a0a 2020   last_signal:.  
-0001a080: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001a090: 7374 5f73 6967 6e61 6c5b 6461 7461 5f6c  st_signal[data_l
-0001a0a0: 6973 745b 636e 745d 5d20 3d20 6669 6e61  ist[cnt]] = fina
-0001a0b0: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
-0001a0c0: 6966 2064 6174 615f 6c69 7374 5b63 6e74  if data_list[cnt
-0001a0d0: 5d20 696e 206c 6173 745f 7369 676e 616c  ] in last_signal
-0001a0e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a0f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001a100: 2020 2020 2020 2020 2020 2063 6f6e 6469             condi
-0001a110: 7469 6f6e 203d 206c 6173 745f 7369 676e  tion = last_sign
-0001a120: 616c 5b64 6174 615f 6c69 7374 5b63 6e74  al[data_list[cnt
-0001a130: 5d5d 5b30 5d5b 2253 4c22 5d5b 305d 0a20  ]][0]["SL"][0]. 
-0001a140: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001a150: 7863 6570 7420 4b65 7945 7272 6f72 2061  xcept KeyError a
-0001a160: 7320 653a 2023 2070 7261 676d 613a 206e  s e: # pragma: n
-0001a170: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
-0001a180: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001a190: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-0001a1a0: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-0001a1b0: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-0001a1c0: 2020 2020 2020 2020 2020 2020 636f 6e64              cond
-0001a1d0: 6974 696f 6e20 3d20 6c61 7374 5f73 6967  ition = last_sig
-0001a1e0: 6e61 6c5b 6461 7461 5f6c 6973 745b 636e  nal[data_list[cn
-0001a1f0: 745d 5d5b 2253 4c22 5d5b 305d 0a20 2020  t]]["SL"][0].   
-0001a200: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-0001a210: 6620 6c61 7374 5f73 6967 6e61 6c5b 6461  f last_signal[da
-0001a220: 7461 5f6c 6973 745b 636e 745d 5d20 6973  ta_list[cnt]] is
-0001a230: 206e 6f74 2066 696e 616c 3a20 2020 2020   not final:     
-0001a240: 2020 2020 2023 2044 6562 7567 202d 2053       # Debug - S
-0001a250: 686f 7773 2061 6c6c 2063 6f6e 6469 7469  hows all conditi
-0001a260: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-0001a270: 2020 2020 6966 206c 656e 2866 696e 616c      if len(final
-0001a280: 5b22 534c 225d 2920 3e20 3020 616e 6420  ["SL"]) > 0 and 
-0001a290: 636f 6e64 6974 696f 6e20 213d 2066 696e  condition != fin
-0001a2a0: 616c 5b22 534c 225d 2e69 6c6f 635b 305d  al["SL"].iloc[0]
-0001a2b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a2c0: 2020 2020 2020 2320 446f 2073 6f6d 6574        # Do somet
-0001a2d0: 6869 6e67 2077 6974 6820 7265 7375 6c74  hing with result
-0001a2e0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0001a2f0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a310: 2020 2072 6573 756c 745f 6466 203d 2070     result_df = p
-0001a320: 642e 636f 6e63 6174 280a 2020 2020 2020  d.concat(.      
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
-0001a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a360: 2020 2020 2020 2020 7265 7375 6c74 5f64          result_d
-0001a370: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+00019dd0: 2020 2020 2020 202d 2076 616c 6964 6174         - validat
+00019de0: 652e 436c 6f73 652e 7265 7365 745f 696e  e.Close.reset_in
+00019df0: 6465 7828 6472 6f70 3d54 7275 6529 0a20  dex(drop=True). 
+00019e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e30: 202a 2072 6973 6b5f 7265 7761 7264 0a20   * risk_reward. 
+00019e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e50: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00019e60: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00019e70: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+00019e80: 5b22 5461 7267 6574 225d 2c0a 2020 2020  ["Target"],.    
+00019e90: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00019ea0: 2020 2020 2020 7661 6c69 6461 7465 203d        validate =
+00019eb0: 2070 642e 636f 6e63 6174 280a 2020 2020   pd.concat(.    
+00019ec0: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
+00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ee0: 2020 7661 6c69 6461 7465 2e72 6573 6574    validate.reset
+00019ef0: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+00019f00: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00019f10: 2020 2020 2020 2073 7472 6563 6865 645b         streched[
+00019f20: 2253 4c22 5d2e 7265 7365 745f 696e 6465  "SL"].reset_inde
+00019f30: 7828 6472 6f70 3d54 7275 6529 2c0a 2020  x(drop=True),.  
+00019f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f50: 2020 7467 742c 0a20 2020 2020 2020 2020    tgt,.         
+00019f60: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+00019f70: 2020 2020 2020 2020 2020 6178 6973 3d31            axis=1
+00019f80: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00019f90: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
+00019fa0: 6461 7465 203d 2076 616c 6964 6174 652e  date = validate.
+00019fb0: 7461 696c 286c 656e 286f 6c64 5f69 6e64  tail(len(old_ind
+00019fc0: 6578 2929 0a20 2020 2020 2020 2020 2020  ex)).           
+00019fd0: 2076 616c 6964 6174 6520 3d20 7661 6c69   validate = vali
+00019fe0: 6461 7465 2e73 6574 5f69 6e64 6578 286f  date.set_index(o
+00019ff0: 6c64 5f69 6e64 6578 290a 2020 2020 2020  ld_index).      
+0001a000: 2020 2020 2020 6966 2022 7365 6c6c 2220        if "sell" 
+0001a010: 696e 2064 6174 615f 6c69 7374 5b63 6e74  in data_list[cnt
+0001a020: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0001a030: 2020 2066 696e 616c 203d 2076 616c 6964     final = valid
+0001a040: 6174 655b 7661 6c69 6461 7465 2e43 6c6f  ate[validate.Clo
+0001a050: 7365 203c 2076 616c 6964 6174 655b 2235  se < validate["5
+0001a060: 454d 4122 5d5d 2e74 6169 6c28 3129 0a20  EMA"]].tail(1). 
+0001a070: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001a080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a090: 2066 696e 616c 203d 2076 616c 6964 6174   final = validat
+0001a0a0: 655b 7661 6c69 6461 7465 2e43 6c6f 7365  e[validate.Close
+0001a0b0: 203e 2076 616c 6964 6174 655b 2235 454d   > validate["5EM
+0001a0c0: 4122 5d5d 2e74 6169 6c28 3129 0a0a 2020  A"]].tail(1)..  
+0001a0d0: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
+0001a0e0: 615f 6c69 7374 5b63 6e74 5d20 6e6f 7420  a_list[cnt] not 
+0001a0f0: 696e 206c 6173 745f 7369 676e 616c 3a0a  in last_signal:.
+0001a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a110: 6c61 7374 5f73 6967 6e61 6c5b 6461 7461  last_signal[data
+0001a120: 5f6c 6973 745b 636e 745d 5d20 3d20 6669  _list[cnt]] = fi
+0001a130: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0001a140: 656c 6966 2064 6174 615f 6c69 7374 5b63  elif data_list[c
+0001a150: 6e74 5d20 696e 206c 6173 745f 7369 676e  nt] in last_sign
+0001a160: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
+0001a170: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001a180: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001a190: 6469 7469 6f6e 203d 206c 6173 745f 7369  dition = last_si
+0001a1a0: 676e 616c 5b64 6174 615f 6c69 7374 5b63  gnal[data_list[c
+0001a1b0: 6e74 5d5d 5b30 5d5b 2253 4c22 5d5b 305d  nt]][0]["SL"][0]
+0001a1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a1d0: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+0001a1e0: 2061 7320 653a 2023 2070 7261 676d 613a   as e: # pragma:
+0001a1f0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+0001a200: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001a210: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+0001a220: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
+0001a230: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
+0001a240: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001a250: 6e64 6974 696f 6e20 3d20 6c61 7374 5f73  ndition = last_s
+0001a260: 6967 6e61 6c5b 6461 7461 5f6c 6973 745b  ignal[data_list[
+0001a270: 636e 745d 5d5b 2253 4c22 5d5b 305d 0a20  cnt]]["SL"][0]. 
+0001a280: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001a290: 2069 6620 6c61 7374 5f73 6967 6e61 6c5b   if last_signal[
+0001a2a0: 6461 7461 5f6c 6973 745b 636e 745d 5d20  data_list[cnt]] 
+0001a2b0: 6973 206e 6f74 2066 696e 616c 3a20 2020  is not final:   
+0001a2c0: 2020 2020 2020 2023 2044 6562 7567 202d         # Debug -
+0001a2d0: 2053 686f 7773 2061 6c6c 2063 6f6e 6469   Shows all condi
+0001a2e0: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
+0001a2f0: 2020 2020 2020 6966 206c 656e 2866 696e        if len(fin
+0001a300: 616c 5b22 534c 225d 2920 3e20 3020 616e  al["SL"]) > 0 an
+0001a310: 6420 636f 6e64 6974 696f 6e20 213d 2066  d condition != f
+0001a320: 696e 616c 5b22 534c 225d 2e69 6c6f 635b  inal["SL"].iloc[
+0001a330: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+0001a340: 2020 2020 2020 2020 2320 446f 2073 6f6d          # Do som
+0001a350: 6574 6869 6e67 2077 6974 6820 7265 7375  ething with resu
+0001a360: 6c74 730a 2020 2020 2020 2020 2020 2020  lts.            
+0001a370: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
 0001a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a390: 2020 2070 642e 4461 7461 4672 616d 6528     pd.DataFrame(
-0001a3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a390: 2020 2020 2072 6573 756c 745f 6466 203d       result_df =
+0001a3a0: 2070 642e 636f 6e63 6174 280a 2020 2020   pd.concat(.    
 0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3c0: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
+0001a3c0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
 0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0001a3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a3e0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0001a3f0: 5f64 662c 0a20 2020 2020 2020 2020 2020  _df,.           
 0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a410: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-0001a420: 6f72 5465 7874 2e42 4c55 450a 2020 2020  orText.BLUE.    
+0001a410: 2020 2020 2070 642e 4461 7461 4672 616d       pd.DataFram
+0001a420: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
 0001a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a450: 2020 2020 2020 2020 2b20 7374 7228 6669          + str(fi
-0001a460: 6e61 6c2e 696e 6465 785b 305d 290a 2020  nal.index[0]).  
-0001a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a440: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+0001a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a470: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
 0001a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a490: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001a4a0: 7254 6578 742e 454e 442c 0a20 2020 2020  rText.END,.     
+0001a490: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001a4a0: 6f6c 6f72 5465 7874 2e42 4c55 450a 2020  olorText.BLUE.  
 0001a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4d0: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-0001a4e0: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0001a4d0: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
+0001a4e0: 6669 6e61 6c2e 696e 6465 785b 305d 290a  final.index[0]).
 0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a510: 2020 2b20 636f 6c6f 7254 6578 742e 5741    + colorText.WA
-0001a520: 524e 0a20 2020 2020 2020 2020 2020 2020  RN.             
+0001a510: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001a520: 6c6f 7254 6578 742e 454e 442c 0a20 2020  lorText.END,.   
 0001a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a540: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001a550: 2064 6174 615f 6c69 7374 5b63 6e74 5d2e   data_list[cnt].
-0001a560: 7370 6c69 7428 225f 2229 5b30 5d2e 7570  split("_")[0].up
-0001a570: 7065 7228 290a 2020 2020 2020 2020 2020  per().          
+0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a550: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
+0001a560: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+0001a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5a0: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0001a5b0: 442c 0a20 2020 2020 2020 2020 2020 2020  D,.             
+0001a590: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0001a5a0: 5741 524e 0a20 2020 2020 2020 2020 2020  WARN.           
+0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001a5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5d0: 202b 2064 6174 615f 6c69 7374 5b63 6e74   + data_list[cnt
+0001a5e0: 5d2e 7370 6c69 7428 225f 2229 5b30 5d2e  ].split("_")[0].
+0001a5f0: 7570 7065 7228 290a 2020 2020 2020 2020  upper().        
 0001a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a610: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a620: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0001a630: 454e 442c 0a20 2020 2020 2020 2020 2020  END,.           
 0001a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a650: 2b20 636f 6c6f 7254 6578 742e 4641 494c  + colorText.FAIL
-0001a660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a660: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
 0001a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a690: 202b 2064 6174 615f 6c69 7374 5b63 6e74   + data_list[cnt
-0001a6a0: 5d2e 7370 6c69 7428 225f 2229 5b31 5d2e  ].split("_")[1].
-0001a6b0: 7570 7065 7228 290a 2020 2020 2020 2020  upper().        
+0001a690: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0001a6a0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6e0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-0001a6f0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+0001a6d0: 2020 2b20 636f 6c6f 7254 6578 742e 4641    + colorText.FA
+0001a6e0: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
+0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a720: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a710: 2020 202b 2064 6174 615f 6c69 7374 5b63     + data_list[c
+0001a720: 6e74 5d2e 7370 6c69 7428 225f 2229 5b31  nt].split("_")[1
+0001a730: 5d2e 7570 7065 7228 290a 2020 2020 2020  ].upper().      
 0001a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a750: 2020 6966 2022 7365 6c6c 2220 696e 2064    if "sell" in d
-0001a760: 6174 615f 6c69 7374 5b63 6e74 5d0a 2020  ata_list[cnt].  
-0001a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a760: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0001a770: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
 0001a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a790: 2020 2020 2020 2020 2020 656c 7365 2028            else (
-0001a7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
 0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7d0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7d0: 2020 2020 6966 2022 7365 6c6c 2220 696e      if "sell" in
+0001a7e0: 2064 6174 615f 6c69 7374 5b63 6e74 5d0a   data_list[cnt].
 0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a810: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
-0001a820: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
+0001a810: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001a820: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
 0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a850: 2020 2b20 6461 7461 5f6c 6973 745b 636e    + data_list[cn
-0001a860: 745d 2e73 706c 6974 2822 5f22 295b 315d  t].split("_")[1]
-0001a870: 2e75 7070 6572 2829 0a20 2020 2020 2020  .upper().       
+0001a850: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0001a860: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8a0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0001a8b0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0001a890: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+0001a8a0: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
+0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8e0: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8d0: 2020 2020 2b20 6461 7461 5f6c 6973 745b      + data_list[
+0001a8e0: 636e 745d 2e73 706c 6974 2822 5f22 295b  cnt].split("_")[
+0001a8f0: 315d 2e75 7070 6572 2829 0a20 2020 2020  1].upper().     
 0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a910: 2020 2020 636f 6c6f 7254 6578 742e 4641      colorText.FA
-0001a920: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
-0001a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a940: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001a950: 2073 7472 2866 696e 616c 2e53 4c5b 305d   str(final.SL[0]
-0001a960: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a920: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0001a930: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0001a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a960: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
 0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a980: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001a990: 636f 6c6f 7254 6578 742e 454e 442c 0a20  colorText.END,. 
-0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a990: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
+0001a9a0: 4641 494c 0a20 2020 2020 2020 2020 2020  FAIL.           
 0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9c0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
-0001a9d0: 5465 7874 2e47 5245 454e 0a20 2020 2020  Text.GREEN.     
-0001a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9d0: 202b 2073 7472 2866 696e 616c 2e53 4c5b   + str(final.SL[
+0001a9e0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
 0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa00: 2020 2020 2020 202b 2073 7472 2866 696e         + str(fin
-0001aa10: 616c 2e54 6172 6765 745b 305d 290a 2020  al.Target[0]).  
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa10: 2b20 636f 6c6f 7254 6578 742e 454e 442c  + colorText.END,
+0001aa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0001aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa40: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001aa50: 7254 6578 742e 454e 442c 0a20 2020 2020  rText.END,.     
+0001aa40: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+0001aa50: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
 0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa80: 2020 2020 2020 2066 2231 3a7b 7269 736b         f"1:{risk
-0001aa90: 5f72 6577 6172 647d 222c 0a20 2020 2020  _reward}",.     
+0001aa80: 2020 2020 2020 2020 202b 2073 7472 2866           + str(f
+0001aa90: 696e 616c 2e54 6172 6765 745b 305d 290a  inal.Target[0]).
 0001aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aac0: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aae0: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
+0001aac0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001aad0: 6c6f 7254 6578 742e 454e 442c 0a20 2020  lorText.END,.   
+0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab10: 636f 6c75 6d6e 733d 7265 7375 6c74 5f64  columns=result_d
-0001ab20: 662e 636f 6c75 6d6e 732c 0a20 2020 2020  f.columns,.     
+0001ab00: 2020 2020 2020 2020 2066 2231 3a7b 7269           f"1:{ri
+0001ab10: 736b 5f72 6577 6172 647d 222c 0a20 2020  sk_reward}",.   
+0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab40: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+0001ab40: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
 0001ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab60: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
+0001ab60: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
 0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab80: 2020 2020 2020 2020 2061 7869 733d 302c           axis=0,
-0001ab90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aba0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab90: 2020 636f 6c75 6d6e 733d 7265 7375 6c74    columns=result
+0001aba0: 5f64 662e 636f 6c75 6d6e 732c 0a20 2020  _df.columns,.   
 0001abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abc0: 2020 2072 6573 756c 745f 6466 2e72 6573     result_df.res
-0001abd0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
-0001abe0: 7565 2c20 696e 706c 6163 653d 5472 7565  ue, inplace=True
-0001abf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ac00: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-0001ac10: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-0001ac20: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-0001ac30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ac40: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-0001ac50: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
-0001ac60: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
-0001ac70: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0001ac80: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-0001ac90: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0001aca0: 2020 2020 2020 2320 5468 656e 2075 7064        # Then upd
-0001acb0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-0001acc0: 2020 2020 2020 2020 6c61 7374 5f73 6967          last_sig
-0001acd0: 6e61 6c5b 6461 7461 5f6c 6973 745b 636e  nal[data_list[cn
-0001ace0: 745d 5d20 3d20 5b66 696e 616c 5d0a 2020  t]] = [final].  
-0001acf0: 2020 2020 2020 6966 2072 6573 756c 745f        if result_
-0001ad00: 6466 2069 7320 6e6f 7420 4e6f 6e65 3a0a  df is not None:.
-0001ad10: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0001ad20: 6c74 5f64 662e 6472 6f70 5f64 7570 6c69  lt_df.drop_dupli
-0001ad30: 6361 7465 7328 6b65 6570 3d22 6c61 7374  cates(keep="last
-0001ad40: 222c 2069 6e70 6c61 6365 3d54 7275 6529  ", inplace=True)
-0001ad50: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0001ad60: 756c 745f 6466 2e73 6f72 745f 7661 6c75  ult_df.sort_valu
-0001ad70: 6573 2862 793d 2254 696d 6522 2c20 696e  es(by="Time", in
-0001ad80: 706c 6163 653d 5472 7565 290a 2020 2020  place=True).    
-0001ad90: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-0001ada0: 745f 6466 5b3a 3a2d 315d 0a0a 2020 2020  t_df[::-1]..    
-0001adb0: 2320 5072 6570 726f 6365 7373 2074 6865  # Preprocess the
-0001adc0: 2061 6371 7569 7265 6420 6461 7461 0a20   acquired data. 
-0001add0: 2020 2064 6566 2070 7265 7072 6f63 6573     def preproces
-0001ade0: 7344 6174 6128 7365 6c66 2c20 6466 2c20  sData(self, df, 
-0001adf0: 6461 7973 546f 4c6f 6f6b 6261 636b 3d4e  daysToLookback=N
-0001ae00: 6f6e 6529 3a0a 2020 2020 2020 2020 6173  one):.        as
-0001ae10: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
-0001ae20: 6466 2c20 7064 2e44 6174 6146 7261 6d65  df, pd.DataFrame
-0001ae30: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0001ae40: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-0001ae50: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001ae60: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0001ae70: 7265 706c 6163 6528 6e70 2e69 6e66 2c20  replace(np.inf, 
-0001ae80: 6e70 2e6e 616e 292e 7265 706c 6163 6528  np.nan).replace(
-0001ae90: 2d6e 702e 696e 662c 206e 702e 6e61 6e29  -np.inf, np.nan)
-0001aea0: 2e64 726f 706e 6128 686f 773d 2261 6c6c  .dropna(how="all
-0001aeb0: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-0001aec0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-0001aed0: 6767 6572 2e69 6e66 6f28 6622 5072 6570  gger.info(f"Prep
-0001aee0: 726f 6365 7373 696e 6720 6461 7461 3a5c  rocessing data:\
-0001aef0: 6e7b 6461 7461 2e68 6561 6428 3129 7d5c  n{data.head(1)}\
-0001af00: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0001af10: 6966 2064 6179 7354 6f4c 6f6f 6b62 6163  if daysToLookbac
-0001af20: 6b20 6973 204e 6f6e 653a 0a20 2020 2020  k is None:.     
-0001af30: 2020 2020 2020 2020 2020 2064 6179 7354             daysT
-0001af40: 6f4c 6f6f 6b62 6163 6b20 3d20 7365 6c66  oLookback = self
-0001af50: 2e63 6f6e 6669 674d 616e 6167 6572 2e64  .configManager.d
-0001af60: 6179 7354 6f4c 6f6f 6b62 6163 6b0a 2020  aysToLookback.  
-0001af70: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0001af80: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
-0001af90: 7573 6545 4d41 3a0a 2020 2020 2020 2020  useEMA:.        
-0001afa0: 2020 2020 2020 2020 736d 6120 3d20 706b          sma = pk
-0001afb0: 7461 6c69 622e 454d 4128 6461 7461 5b22  talib.EMA(data["
-0001afc0: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-0001afd0: 696f 643d 3530 290a 2020 2020 2020 2020  iod=50).        
-0001afe0: 2020 2020 2020 2020 6c6d 6120 3d20 706b          lma = pk
-0001aff0: 7461 6c69 622e 454d 4128 6461 7461 5b22  talib.EMA(data["
-0001b000: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-0001b010: 696f 643d 3230 3029 0a20 2020 2020 2020  iod=200).       
-0001b020: 2020 2020 2020 2020 2073 736d 6120 3d20           ssma = 
+0001abc0: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+0001abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abe0: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+0001abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac00: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+0001ac10: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0001ac20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac40: 2020 2020 2072 6573 756c 745f 6466 2e72       result_df.r
+0001ac50: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+0001ac60: 5472 7565 2c20 696e 706c 6163 653d 5472  True, inplace=Tr
+0001ac70: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0001ac80: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0001ac90: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+0001aca0: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+0001acb0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0001acc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001acd0: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
+0001ace0: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
+0001acf0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0001ad00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001ad10: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+0001ad20: 2020 2020 2020 2020 2320 5468 656e 2075          # Then u
+0001ad30: 7064 6174 650a 2020 2020 2020 2020 2020  pdate.          
+0001ad40: 2020 2020 2020 2020 2020 6c61 7374 5f73            last_s
+0001ad50: 6967 6e61 6c5b 6461 7461 5f6c 6973 745b  ignal[data_list[
+0001ad60: 636e 745d 5d20 3d20 5b66 696e 616c 5d0a  cnt]] = [final].
+0001ad70: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
+0001ad80: 745f 6466 2069 7320 6e6f 7420 4e6f 6e65  t_df is not None
+0001ad90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001ada0: 7375 6c74 5f64 662e 6472 6f70 5f64 7570  sult_df.drop_dup
+0001adb0: 6c69 6361 7465 7328 6b65 6570 3d22 6c61  licates(keep="la
+0001adc0: 7374 222c 2069 6e70 6c61 6365 3d54 7275  st", inplace=Tru
+0001add0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+0001ade0: 6573 756c 745f 6466 2e73 6f72 745f 7661  esult_df.sort_va
+0001adf0: 6c75 6573 2862 793d 2254 696d 6522 2c20  lues(by="Time", 
+0001ae00: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+0001ae10: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0001ae20: 756c 745f 6466 5b3a 3a2d 315d 0a0a 2020  ult_df[::-1]..  
+0001ae30: 2020 2320 5072 6570 726f 6365 7373 2074    # Preprocess t
+0001ae40: 6865 2061 6371 7569 7265 6420 6461 7461  he acquired data
+0001ae50: 0a20 2020 2064 6566 2070 7265 7072 6f63  .    def preproc
+0001ae60: 6573 7344 6174 6128 7365 6c66 2c20 6466  essData(self, df
+0001ae70: 2c20 6461 7973 546f 4c6f 6f6b 6261 636b  , daysToLookback
+0001ae80: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0001ae90: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+0001aea0: 6528 6466 2c20 7064 2e44 6174 6146 7261  e(df, pd.DataFra
+0001aeb0: 6d65 290a 2020 2020 2020 2020 6461 7461  me).        data
+0001aec0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+0001aed0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001aee0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0001aef0: 612e 7265 706c 6163 6528 6e70 2e69 6e66  a.replace(np.inf
+0001af00: 2c20 6e70 2e6e 616e 292e 7265 706c 6163  , np.nan).replac
+0001af10: 6528 2d6e 702e 696e 662c 206e 702e 6e61  e(-np.inf, np.na
+0001af20: 6e29 2e64 726f 706e 6128 686f 773d 2261  n).dropna(how="a
+0001af30: 6c6c 2229 0a20 2020 2020 2020 2020 2020  ll").           
+0001af40: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
+0001af50: 6c6f 6767 6572 2e69 6e66 6f28 6622 5072  logger.info(f"Pr
+0001af60: 6570 726f 6365 7373 696e 6720 6461 7461  eprocessing data
+0001af70: 3a5c 6e7b 6461 7461 2e68 6561 6428 3129  :\n{data.head(1)
+0001af80: 7d5c 6e22 290a 2020 2020 2020 2020 2020  }\n").          
+0001af90: 2020 6966 2064 6179 7354 6f4c 6f6f 6b62    if daysToLookb
+0001afa0: 6163 6b20 6973 204e 6f6e 653a 0a20 2020  ack is None:.   
+0001afb0: 2020 2020 2020 2020 2020 2020 2064 6179               day
+0001afc0: 7354 6f4c 6f6f 6b62 6163 6b20 3d20 7365  sToLookback = se
+0001afd0: 6c66 2e63 6f6e 6669 674d 616e 6167 6572  lf.configManager
+0001afe0: 2e64 6179 7354 6f4c 6f6f 6b62 6163 6b0a  .daysToLookback.
+0001aff0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001b000: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
+0001b010: 722e 7573 6545 4d41 3a0a 2020 2020 2020  r.useEMA:.      
+0001b020: 2020 2020 2020 2020 2020 736d 6120 3d20            sma = 
 0001b030: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
 0001b040: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
-0001b050: 6572 696f 643d 3929 0a20 2020 2020 2020  eriod=9).       
-0001b060: 2020 2020 2020 2020 2073 736d 6132 3020           ssma20 
-0001b070: 3d20 706b 7461 6c69 622e 454d 4128 6461  = pktalib.EMA(da
-0001b080: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
-0001b090: 6570 6572 696f 643d 3230 290a 2020 2020  eperiod=20).    
-0001b0a0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001b0b0: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0001b0c0: 2e63 6f6c 756d 6e73 292c 2022 534d 4122  .columns), "SMA"
-0001b0d0: 2c20 736d 6129 0a20 2020 2020 2020 2020  , sma).         
-0001b0e0: 2020 2020 2020 2064 6174 612e 696e 7365         data.inse
-0001b0f0: 7274 286c 656e 2864 6174 612e 636f 6c75  rt(len(data.colu
-0001b100: 6d6e 7329 2c20 224c 4d41 222c 206c 6d61  mns), "LMA", lma
-0001b110: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b120: 2020 6461 7461 2e69 6e73 6572 7428 6c65    data.insert(le
-0001b130: 6e28 6461 7461 2e63 6f6c 756d 6e73 292c  n(data.columns),
-0001b140: 2022 5353 4d41 222c 2073 736d 6129 0a20   "SSMA", ssma). 
-0001b150: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001b160: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
-0001b170: 6174 612e 636f 6c75 6d6e 7329 2c20 2253  ata.columns), "S
-0001b180: 534d 4132 3022 2c20 7373 6d61 3230 290a  SMA20", ssma20).
-0001b190: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001b1a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b1b0: 2020 736d 6120 3d20 706b 7461 6c69 622e    sma = pktalib.
-0001b1c0: 534d 4128 6461 7461 5b22 436c 6f73 6522  SMA(data["Close"
-0001b1d0: 5d2c 2074 696d 6570 6572 696f 643d 3530  ], timeperiod=50
-0001b1e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b1f0: 2020 6c6d 6120 3d20 706b 7461 6c69 622e    lma = pktalib.
-0001b200: 534d 4128 6461 7461 5b22 436c 6f73 6522  SMA(data["Close"
-0001b210: 5d2c 2074 696d 6570 6572 696f 643d 3230  ], timeperiod=20
-0001b220: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001b230: 2020 2073 736d 6120 3d20 706b 7461 6c69     ssma = pktali
+0001b050: 6572 696f 643d 3530 290a 2020 2020 2020  eriod=50).      
+0001b060: 2020 2020 2020 2020 2020 6c6d 6120 3d20            lma = 
+0001b070: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+0001b080: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
+0001b090: 6572 696f 643d 3230 3029 0a20 2020 2020  eriod=200).     
+0001b0a0: 2020 2020 2020 2020 2020 2073 736d 6120             ssma 
+0001b0b0: 3d20 706b 7461 6c69 622e 454d 4128 6461  = pktalib.EMA(da
+0001b0c0: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
+0001b0d0: 6570 6572 696f 643d 3929 0a20 2020 2020  eperiod=9).     
+0001b0e0: 2020 2020 2020 2020 2020 2073 736d 6132             ssma2
+0001b0f0: 3020 3d20 706b 7461 6c69 622e 454d 4128  0 = pktalib.EMA(
+0001b100: 6461 7461 5b22 436c 6f73 6522 5d2c 2074  data["Close"], t
+0001b110: 696d 6570 6572 696f 643d 3230 290a 2020  imeperiod=20).  
+0001b120: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001b130: 7461 2e69 6e73 6572 7428 6c65 6e28 6461  ta.insert(len(da
+0001b140: 7461 2e63 6f6c 756d 6e73 292c 2022 534d  ta.columns), "SM
+0001b150: 4122 2c20 736d 6129 0a20 2020 2020 2020  A", sma).       
+0001b160: 2020 2020 2020 2020 2064 6174 612e 696e           data.in
+0001b170: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
+0001b180: 6c75 6d6e 7329 2c20 224c 4d41 222c 206c  lumns), "LMA", l
+0001b190: 6d61 290a 2020 2020 2020 2020 2020 2020  ma).            
+0001b1a0: 2020 2020 6461 7461 2e69 6e73 6572 7428      data.insert(
+0001b1b0: 6c65 6e28 6461 7461 2e63 6f6c 756d 6e73  len(data.columns
+0001b1c0: 292c 2022 5353 4d41 222c 2073 736d 6129  ), "SSMA", ssma)
+0001b1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b1e0: 2064 6174 612e 696e 7365 7274 286c 656e   data.insert(len
+0001b1f0: 2864 6174 612e 636f 6c75 6d6e 7329 2c20  (data.columns), 
+0001b200: 2253 534d 4132 3022 2c20 7373 6d61 3230  "SSMA20", ssma20
+0001b210: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0001b220: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b230: 2020 2020 736d 6120 3d20 706b 7461 6c69      sma = pktali
 0001b240: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
 0001b250: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
-0001b260: 3929 0a20 2020 2020 2020 2020 2020 2020  9).             
-0001b270: 2020 2073 736d 6132 3020 3d20 706b 7461     ssma20 = pkta
-0001b280: 6c69 622e 534d 4128 6461 7461 5b22 436c  lib.SMA(data["Cl
-0001b290: 6f73 6522 5d2c 2074 696d 6570 6572 696f  ose"], timeperio
-0001b2a0: 643d 3230 290a 2020 2020 2020 2020 2020  d=20).          
-0001b2b0: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
-0001b2c0: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
-0001b2d0: 6e73 292c 2022 534d 4122 2c20 736d 6129  ns), "SMA", sma)
-0001b2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b2f0: 2064 6174 612e 696e 7365 7274 286c 656e   data.insert(len
-0001b300: 2864 6174 612e 636f 6c75 6d6e 7329 2c20  (data.columns), 
-0001b310: 224c 4d41 222c 206c 6d61 290a 2020 2020  "LMA", lma).    
-0001b320: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001b330: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0001b340: 2e63 6f6c 756d 6e73 292c 2022 5353 4d41  .columns), "SSMA
-0001b350: 222c 2073 736d 6129 0a20 2020 2020 2020  ", ssma).       
-0001b360: 2020 2020 2020 2020 2064 6174 612e 696e           data.in
-0001b370: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
-0001b380: 6c75 6d6e 7329 2c20 2253 534d 4132 3022  lumns), "SSMA20"
-0001b390: 2c20 7373 6d61 3230 290a 2020 2020 2020  , ssma20).      
-0001b3a0: 2020 2020 2020 766f 6c20 3d20 706b 7461        vol = pkta
-0001b3b0: 6c69 622e 534d 4128 6461 7461 5b22 566f  lib.SMA(data["Vo
-0001b3c0: 6c75 6d65 225d 2c20 7469 6d65 7065 7269  lume"], timeperi
-0001b3d0: 6f64 3d32 3029 0a20 2020 2020 2020 2020  od=20).         
-0001b3e0: 2020 2072 7369 203d 2070 6b74 616c 6962     rsi = pktalib
-0001b3f0: 2e52 5349 2864 6174 615b 2243 6c6f 7365  .RSI(data["Close
-0001b400: 225d 2c20 7469 6d65 7065 7269 6f64 3d31  "], timeperiod=1
-0001b410: 3429 0a20 2020 2020 2020 2020 2020 2064  4).            d
-0001b420: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
-0001b430: 6174 612e 636f 6c75 6d6e 7329 2c20 2256  ata.columns), "V
-0001b440: 6f6c 4d41 222c 2076 6f6c 290a 2020 2020  olMA", vol).    
-0001b450: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
-0001b460: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
-0001b470: 756d 6e73 292c 2022 5253 4922 2c20 7273  umns), "RSI", rs
-0001b480: 6929 0a20 2020 2020 2020 2020 2020 2063  i).            c
-0001b490: 6369 203d 2070 6b74 616c 6962 2e43 4349  ci = pktalib.CCI
-0001b4a0: 2864 6174 615b 2248 6967 6822 5d2c 2064  (data["High"], d
-0001b4b0: 6174 615b 224c 6f77 225d 2c20 6461 7461  ata["Low"], data
-0001b4c0: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
-0001b4d0: 6572 696f 643d 3134 290a 2020 2020 2020  eriod=14).      
-0001b4e0: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
-0001b4f0: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
-0001b500: 6e73 292c 2022 4343 4922 2c20 6363 6929  ns), "CCI", cci)
-0001b510: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0001b520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b530: 2020 6661 7374 6b2c 2066 6173 7464 203d    fastk, fastd =
-0001b540: 2070 6b74 616c 6962 2e53 544f 4348 5253   pktalib.STOCHRS
-0001b550: 4928 0a20 2020 2020 2020 2020 2020 2020  I(.             
-0001b560: 2020 2020 2020 2064 6174 615b 2243 6c6f         data["Clo
-0001b570: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
-0001b580: 3d31 342c 2066 6173 746b 5f70 6572 696f  =14, fastk_perio
-0001b590: 643d 352c 2066 6173 7464 5f70 6572 696f  d=5, fastd_perio
-0001b5a0: 643d 332c 2066 6173 7464 5f6d 6174 7970  d=3, fastd_matyp
-0001b5b0: 653d 300a 2020 2020 2020 2020 2020 2020  e=0.            
-0001b5c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001b5d0: 2020 2020 2020 6461 7461 2e69 6e73 6572        data.inser
-0001b5e0: 7428 6c65 6e28 6461 7461 2e63 6f6c 756d  t(len(data.colum
-0001b5f0: 6e73 292c 2022 4641 5354 4b22 2c20 6661  ns), "FASTK", fa
-0001b600: 7374 6b29 0a20 2020 2020 2020 2020 2020  stk).           
-0001b610: 2020 2020 2064 6174 612e 696e 7365 7274       data.insert
-0001b620: 286c 656e 2864 6174 612e 636f 6c75 6d6e  (len(data.column
-0001b630: 7329 2c20 2246 4153 5444 222c 2066 6173  s), "FASTD", fas
-0001b640: 7464 290a 2020 2020 2020 2020 2020 2020  td).            
-0001b650: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001b660: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001b670: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
-0001b680: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
-0001b690: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
-0001b6a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001b6b0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001b6c0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001b6d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001b6e0: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
-0001b6f0: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
-0001b700: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
-0001b710: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001b720: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001b730: 6461 7461 203d 2064 6174 615b 3a3a 2d31  data = data[::-1
-0001b740: 5d20 2023 2052 6576 6572 7365 2074 6865  ]  # Reverse the
-0001b750: 2064 6174 6166 7261 6d65 0a20 2020 2020   dataframe.     
-0001b760: 2020 2023 2064 6174 6120 3d20 6461 7461     # data = data
-0001b770: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001b780: 2020 2023 2064 6174 6120 3d20 6461 7461     # data = data
-0001b790: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
-0001b7a0: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
-0001b7b0: 2020 2020 2020 2066 756c 6c44 6174 6120         fullData 
-0001b7c0: 3d20 6461 7461 0a20 2020 2020 2020 2074  = data.        t
-0001b7d0: 7269 6d6d 6564 4461 7461 203d 2064 6174  rimmedData = dat
-0001b7e0: 612e 6865 6164 2864 6179 7354 6f4c 6f6f  a.head(daysToLoo
-0001b7f0: 6b62 6163 6b29 0a20 2020 2020 2020 2072  kback).        r
-0001b800: 6574 7572 6e20 2866 756c 6c44 6174 612c  eturn (fullData,
-0001b810: 2074 7269 6d6d 6564 4461 7461 290a 0a20   trimmedData).. 
-0001b820: 2020 2023 2056 616c 6964 6174 6520 6966     # Validate if
-0001b830: 2074 6865 2073 746f 636b 2069 7320 6275   the stock is bu
-0001b840: 6c6c 6973 6820 696e 2074 6865 2073 686f  llish in the sho
-0001b850: 7274 2074 6572 6d0a 2020 2020 6465 6620  rt term.    def 
-0001b860: 7661 6c69 6461 7465 3135 4d69 6e75 7465  validate15Minute
-0001b870: 5072 6963 6556 6f6c 756d 6542 7265 616b  PriceVolumeBreak
-0001b880: 6f75 7428 7365 6c66 2c20 6466 293a 0a20  out(self, df):. 
-0001b890: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-0001b8a0: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-0001b8b0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0001b8c0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0001b8d0: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
-0001b8e0: 2f63 6861 7274 696e 6b2e 636f 6d2f 7363  /chartink.com/sc
-0001b8f0: 7265 656e 6572 2f31 352d 6d69 6e2d 7072  reener/15-min-pr
-0001b900: 6963 652d 766f 6c75 6d65 2d62 7265 616b  ice-volume-break
-0001b910: 6f75 740a 2020 2020 2020 2020 6461 7461  out.        data
-0001b920: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0001b930: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001b940: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001b950: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-0001b960: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-0001b970: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-0001b980: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001b990: 5b3a 3a2d 315d 2020 2320 5265 7665 7273  [::-1]  # Revers
-0001b9a0: 6520 7468 6520 6461 7461 6672 616d 6520  e the dataframe 
-0001b9b0: 736f 2074 6861 7420 6974 7320 7468 6520  so that its the 
-0001b9c0: 6f6c 6465 7374 2064 6174 6520 6669 7273  oldest date firs
-0001b9d0: 740a 2020 2020 2020 2020 6461 7461 5b22  t.        data["
-0001b9e0: 534d 4132 3022 5d20 3d20 706b 7461 6c69  SMA20"] = pktali
-0001b9f0: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
-0001ba00: 6522 5d2c 2032 3029 0a20 2020 2020 2020  e"], 20).       
-0001ba10: 2064 6174 615b 2253 4d41 3230 5622 5d20   data["SMA20V"] 
-0001ba20: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
-0001ba30: 7461 5b22 566f 6c75 6d65 225d 2c20 3230  ta["Volume"], 20
-0001ba40: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0001ba50: 2064 6174 615b 0a20 2020 2020 2020 2020   data[.         
-0001ba60: 2020 203a 3a2d 310a 2020 2020 2020 2020     ::-1.        
-0001ba70: 5d20 2023 2052 6576 6572 7365 2074 6865  ]  # Reverse the
-0001ba80: 2064 6174 6166 7261 6d65 2073 6f20 7468   dataframe so th
-0001ba90: 6174 2069 7427 7320 7468 6520 6d6f 7374  at it's the most
-0001baa0: 2072 6563 656e 7420 6461 7465 2066 6972   recent date fir
-0001bab0: 7374 0a20 2020 2020 2020 2072 6563 656e  st.        recen
-0001bac0: 7420 3d20 6461 7461 2e68 6561 6428 3329  t = data.head(3)
-0001bad0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0001bae0: 7265 6365 6e74 2920 3c20 333a 0a20 2020  recent) < 3:.   
-0001baf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001bb00: 4661 6c73 650a 2020 2020 2020 2020 636f  False.        co
-0001bb10: 6e64 3120 3d20 7265 6365 6e74 5b22 436c  nd1 = recent["Cl
-0001bb20: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e20  ose"].iloc[0] > 
-0001bb30: 7265 6365 6e74 5b22 436c 6f73 6522 5d2e  recent["Close"].
-0001bb40: 696c 6f63 5b31 5d0a 2020 2020 2020 2020  iloc[1].        
-0001bb50: 636f 6e64 3220 3d20 636f 6e64 3120 616e  cond2 = cond1 an
-0001bb60: 6420 2872 6563 656e 745b 2243 6c6f 7365  d (recent["Close
-0001bb70: 225d 2e69 6c6f 635b 305d 203e 2072 6563  "].iloc[0] > rec
-0001bb80: 656e 745b 2253 4d41 3230 225d 2e69 6c6f  ent["SMA20"].ilo
-0001bb90: 635b 305d 290a 2020 2020 2020 2020 636f  c[0]).        co
-0001bba0: 6e64 3320 3d20 636f 6e64 3220 616e 6420  nd3 = cond2 and 
-0001bbb0: 2872 6563 656e 745b 2243 6c6f 7365 225d  (recent["Close"]
-0001bbc0: 2e69 6c6f 635b 315d 203e 2072 6563 656e  .iloc[1] > recen
-0001bbd0: 745b 2248 6967 6822 5d2e 696c 6f63 5b32  t["High"].iloc[2
-0001bbe0: 5d29 0a20 2020 2020 2020 2063 6f6e 6434  ]).        cond4
-0001bbf0: 203d 2063 6f6e 6433 2061 6e64 2028 7265   = cond3 and (re
-0001bc00: 6365 6e74 5b22 566f 6c75 6d65 225d 2e69  cent["Volume"].i
-0001bc10: 6c6f 635b 305d 203e 2072 6563 656e 745b  loc[0] > recent[
-0001bc20: 2253 4d41 3230 5622 5d2e 696c 6f63 5b30  "SMA20V"].iloc[0
-0001bc30: 5d29 0a20 2020 2020 2020 2063 6f6e 6435  ]).        cond5
-0001bc40: 203d 2063 6f6e 6434 2061 6e64 2028 7265   = cond4 and (re
-0001bc50: 6365 6e74 5b22 566f 6c75 6d65 225d 2e69  cent["Volume"].i
-0001bc60: 6c6f 635b 315d 203e 2072 6563 656e 745b  loc[1] > recent[
-0001bc70: 2253 4d41 3230 5622 5d2e 696c 6f63 5b30  "SMA20V"].iloc[0
-0001bc80: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
-0001bc90: 6e20 636f 6e64 350a 0a20 2020 2064 6566  n cond5..    def
-0001bca0: 2076 616c 6964 6174 6542 756c 6c69 7368   validateBullish
-0001bcb0: 466f 7254 6f6d 6f72 726f 7728 7365 6c66  ForTomorrow(self
-0001bcc0: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
-0001bcd0: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-0001bce0: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-0001bcf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001bd00: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-0001bd10: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-0001bd20: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-0001bd30: 2f2f 6368 6172 7469 6e6b 2e63 6f6d 2f73  //chartink.com/s
-0001bd40: 6372 6565 6e65 722f 6275 6c6c 6973 682d  creener/bullish-
-0001bd50: 666f 722d 746f 6d6f 7272 6f77 0a20 2020  for-tomorrow.   
-0001bd60: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001bd70: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001bd80: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-0001bd90: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-0001bda0: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-0001bdb0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001bdc0: 5b3a 3a2d 315d 2020 2320 5265 7665 7273  [::-1]  # Revers
-0001bdd0: 6520 7468 6520 6461 7461 6672 616d 6520  e the dataframe 
-0001bde0: 736f 2074 6861 7420 6974 7320 7468 6520  so that its the 
-0001bdf0: 6f6c 6465 7374 2064 6174 6520 6669 7273  oldest date firs
-0001be00: 740a 2020 2020 2020 2020 6d61 6364 4c69  t.        macdLi
-0001be10: 6e65 203d 2070 6b74 616c 6962 2e4d 4143  ne = pktalib.MAC
-0001be20: 4428 6461 7461 5b22 436c 6f73 6522 5d2c  D(data["Close"],
-0001be30: 2031 322c 2032 362c 2039 295b 305d 2e74   12, 26, 9)[0].t
-0001be40: 6169 6c28 3329 0a20 2020 2020 2020 206d  ail(3).        m
-0001be50: 6163 6453 6967 6e61 6c20 3d20 706b 7461  acdSignal = pkta
-0001be60: 6c69 622e 4d41 4344 2864 6174 615b 2243  lib.MACD(data["C
-0001be70: 6c6f 7365 225d 2c20 3132 2c20 3236 2c20  lose"], 12, 26, 
-0001be80: 3929 5b31 5d2e 7461 696c 2833 290a 2020  9)[1].tail(3).  
-0001be90: 2020 2020 2020 6d61 6364 4869 7374 203d        macdHist =
-0001bea0: 2070 6b74 616c 6962 2e4d 4143 4428 6461   pktalib.MACD(da
-0001beb0: 7461 5b22 436c 6f73 6522 5d2c 2031 322c  ta["Close"], 12,
-0001bec0: 2032 362c 2039 295b 325d 2e74 6169 6c28   26, 9)[2].tail(
-0001bed0: 3329 0a0a 2020 2020 2020 2020 7265 7475  3)..        retu
-0001bee0: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-0001bef0: 2028 6d61 6364 4869 7374 2e69 6c6f 635b   (macdHist.iloc[
-0001bf00: 3a31 5d2e 696c 6f63 5b30 5d20 3c20 6d61  :1].iloc[0] < ma
-0001bf10: 6364 4869 7374 2e69 6c6f 635b 3a32 5d2e  cdHist.iloc[:2].
-0001bf20: 696c 6f63 5b31 5d29 0a20 2020 2020 2020  iloc[1]).       
-0001bf30: 2020 2020 2061 6e64 2028 6d61 6364 4869       and (macdHi
-0001bf40: 7374 2e69 6c6f 635b 3a33 5d2e 696c 6f63  st.iloc[:3].iloc
-0001bf50: 5b32 5d20 3e20 6d61 6364 4869 7374 2e69  [2] > macdHist.i
-0001bf60: 6c6f 635b 3a32 5d2e 696c 6f63 5b31 5d29  loc[:2].iloc[1])
-0001bf70: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001bf80: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001bf90: 2020 2028 6d61 6364 4c69 6e65 2e69 6c6f     (macdLine.ilo
-0001bfa0: 635b 3a33 5d2e 696c 6f63 5b32 5d20 2d20  c[:3].iloc[2] - 
-0001bfb0: 6d61 6364 5369 676e 616c 2e69 6c6f 635b  macdSignal.iloc[
-0001bfc0: 3a33 5d2e 696c 6f63 5b32 5d29 0a20 2020  :3].iloc[2]).   
-0001bfd0: 2020 2020 2020 2020 2020 2020 202d 2028               - (
-0001bfe0: 6d61 6364 4c69 6e65 2e69 6c6f 635b 3a32  macdLine.iloc[:2
-0001bff0: 5d2e 696c 6f63 5b31 5d20 2d20 6d61 6364  ].iloc[1] - macd
-0001c000: 5369 676e 616c 2e69 6c6f 635b 3a32 5d2e  Signal.iloc[:2].
-0001c010: 696c 6f63 5b31 5d29 0a20 2020 2020 2020  iloc[1]).       
-0001c020: 2020 2020 2020 2020 203e 3d20 302e 340a           >= 0.4.
-0001c030: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001c040: 2020 2020 2020 2020 2020 616e 6420 280a            and (.
-0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c060: 286d 6163 644c 696e 652e 696c 6f63 5b3a  (macdLine.iloc[:
-0001c070: 325d 2e69 6c6f 635b 315d 202d 206d 6163  2].iloc[1] - mac
-0001c080: 6453 6967 6e61 6c2e 696c 6f63 5b3a 325d  dSignal.iloc[:2]
-0001c090: 2e69 6c6f 635b 315d 290a 2020 2020 2020  .iloc[1]).      
-0001c0a0: 2020 2020 2020 2020 2020 2d20 286d 6163            - (mac
-0001c0b0: 644c 696e 652e 696c 6f63 5b3a 315d 2e69  dLine.iloc[:1].i
-0001c0c0: 6c6f 635b 305d 202d 206d 6163 6453 6967  loc[0] - macdSig
-0001c0d0: 6e61 6c2e 696c 6f63 5b3a 315d 2e69 6c6f  nal.iloc[:1].ilo
-0001c0e0: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
-0001c0f0: 2020 2020 2020 3c3d 2030 2e32 0a20 2020        <= 0.2.   
-0001c100: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001c110: 2020 2020 2020 2061 6e64 2028 6d61 6364         and (macd
-0001c120: 4c69 6e65 2e69 6c6f 635b 3a33 5d2e 696c  Line.iloc[:3].il
-0001c130: 6f63 5b32 5d20 3e20 6d61 6364 5369 676e  oc[2] > macdSign
-0001c140: 616c 2e69 6c6f 635b 3a33 5d2e 696c 6f63  al.iloc[:3].iloc
-0001c150: 5b32 5d29 0a20 2020 2020 2020 2020 2020  [2]).           
-0001c160: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
-0001c170: 2020 2020 2020 2028 6d61 6364 4c69 6e65         (macdLine
-0001c180: 2e69 6c6f 635b 3a33 5d2e 696c 6f63 5b32  .iloc[:3].iloc[2
-0001c190: 5d20 2d20 6d61 6364 5369 676e 616c 2e69  ] - macdSignal.i
-0001c1a0: 6c6f 635b 3a33 5d2e 696c 6f63 5b32 5d29  loc[:3].iloc[2])
-0001c1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c1c0: 202d 2028 6d61 6364 4c69 6e65 2e69 6c6f   - (macdLine.ilo
-0001c1d0: 635b 3a32 5d2e 696c 6f63 5b31 5d20 2d20  c[:2].iloc[1] - 
-0001c1e0: 6d61 6364 5369 676e 616c 2e69 6c6f 635b  macdSignal.iloc[
-0001c1f0: 3a32 5d2e 696c 6f63 5b31 5d29 0a20 2020  :2].iloc[1]).   
-0001c200: 2020 2020 2020 2020 2020 2020 203c 2031               < 1
-0001c210: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001c220: 2020 2020 2020 2029 0a0a 2020 2020 2340         )..    #@
-0001c230: 6d65 6173 7572 655f 7469 6d65 0a20 2020  measure_time.   
-0001c240: 2023 2076 616c 6964 6174 6520 6966 2043   # validate if C
-0001c250: 4349 2069 7320 7769 7468 696e 2067 6976  CI is within giv
-0001c260: 656e 2072 616e 6765 0a20 2020 2064 6566  en range.    def
-0001c270: 2076 616c 6964 6174 6543 4349 2873 656c   validateCCI(sel
-0001c280: 662c 2064 662c 2073 6372 6565 6e44 6963  f, df, screenDic
-0001c290: 742c 2073 6176 6544 6963 742c 206d 696e  t, saveDict, min
-0001c2a0: 4343 492c 206d 6178 4343 4929 3a0a 2020  CCI, maxCCI):.  
-0001c2b0: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-0001c2c0: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-0001c2d0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0001c2e0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0001c2f0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-0001c300: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
-0001c310: 6174 6120 3d20 6461 7461 2e66 696c 6c6e  ata = data.filln
-0001c320: 6128 3029 0a20 2020 2020 2020 2064 6174  a(0).        dat
-0001c330: 6120 3d20 6461 7461 2e72 6570 6c61 6365  a = data.replace
-0001c340: 285b 6e70 2e69 6e66 2c20 2d6e 702e 696e  ([np.inf, -np.in
-0001c350: 665d 2c20 3029 0a20 2020 2020 2020 2063  f], 0).        c
-0001c360: 6369 203d 2069 6e74 2864 6174 612e 6865  ci = int(data.he
-0001c370: 6164 2831 295b 2243 4349 225d 2e69 6c6f  ad(1)["CCI"].ilo
-0001c380: 635b 305d 290a 2020 2020 2020 2020 7361  c[0]).        sa
-0001c390: 7665 4469 6374 5b22 4343 4922 5d20 3d20  veDict["CCI"] = 
-0001c3a0: 6363 690a 2020 2020 2020 2020 6966 2028  cci.        if (
-0001c3b0: 6363 6920 3e3d 206d 696e 4343 4920 616e  cci >= minCCI an
-0001c3c0: 6420 6363 6920 3c3d 206d 6178 4343 4929  d cci <= maxCCI)
-0001c3d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001c3e0: 2028 2255 7022 2069 6e20 7361 7665 4469   ("Up" in saveDi
-0001c3f0: 6374 5b22 5472 656e 6422 5d29 3a0a 2020  ct["Trend"]):.  
-0001c400: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0001c410: 7265 656e 4469 6374 5b22 4343 4922 5d20  reenDict["CCI"] 
-0001c420: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0001c430: 2020 2020 2020 2020 2863 6f6c 6f72 5465          (colorTe
-0001c440: 7874 2e42 4f4c 4420 6966 2028 2253 7472  xt.BOLD if ("Str
-0001c450: 6f6e 6722 2069 6e20 7361 7665 4469 6374  ong" in saveDict
-0001c460: 5b22 5472 656e 6422 5d29 2065 6c73 6520  ["Trend"]) else 
-0001c470: 2222 2920 2b20 636f 6c6f 7254 6578 742e  "") + colorText.
-0001c480: 4752 4545 4e20 2b20 7374 7228 6363 6929  GREEN + str(cci)
-0001c490: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001c4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c4b0: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
-0001c4c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001c4d0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0001c4e0: 2243 4349 225d 203d 2028 0a20 2020 2020  "CCI"] = (.     
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001c500: 636f 6c6f 7254 6578 742e 424f 4c44 2069  colorText.BOLD i
-0001c510: 6620 2822 5374 726f 6e67 2220 696e 2073  f ("Strong" in s
-0001c520: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
-0001c530: 2920 656c 7365 2022 2229 202b 2063 6f6c  ) else "") + col
-0001c540: 6f72 5465 7874 2e46 4149 4c20 2b20 7374  orText.FAIL + st
-0001c550: 7228 6363 6929 202b 2063 6f6c 6f72 5465  r(cci) + colorTe
-0001c560: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001c570: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001c580: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001c590: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
-0001c5a0: 6963 745b 2243 4349 225d 203d 2063 6f6c  ict["CCI"] = col
-0001c5b0: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-0001c5c0: 6c6f 7254 6578 742e 4641 494c 202b 2073  lorText.FAIL + s
-0001c5d0: 7472 2863 6369 2920 2b20 636f 6c6f 7254  tr(cci) + colorT
-0001c5e0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-0001c5f0: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-0001c600: 2020 2320 4669 6e64 2043 6f6e 666c 7563    # Find Confluc
-0001c610: 656e 6365 0a20 2020 2064 6566 2076 616c  ence.    def val
-0001c620: 6964 6174 6543 6f6e 666c 7565 6e63 6528  idateConfluence(
-0001c630: 7365 6c66 2c20 7374 6f63 6b2c 2064 662c  self, stock, df,
-0001c640: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-0001c650: 6544 6963 742c 2070 6572 6365 6e74 6167  eDict, percentag
-0001c660: 653d 302e 312c 636f 6e66 4669 6c74 6572  e=0.1,confFilter
-0001c670: 3d33 293a 0a20 2020 2020 2020 2069 6620  =3):.        if 
-0001c680: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
-0001c690: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
-0001c6a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001c6b0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
-0001c6c0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-0001c6d0: 2020 2020 2020 7265 6365 6e74 203d 2064        recent = d
-0001c6e0: 6174 612e 6865 6164 2832 290a 2020 2020  ata.head(2).    
-0001c6f0: 2020 2020 6966 206c 656e 2872 6563 656e      if len(recen
-0001c700: 7429 203c 2032 3a0a 2020 2020 2020 2020  t) < 2:.        
-0001c710: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001c720: 0a20 2020 2020 2020 206b 6579 3120 3d20  .        key1 = 
-0001c730: 2253 4d41 220a 2020 2020 2020 2020 6b65  "SMA".        ke
-0001c740: 7932 203d 2022 4c4d 4122 0a20 2020 2020  y2 = "LMA".     
-0001c750: 2020 206b 6579 3320 3d20 2235 3044 4d41     key3 = "50DMA
-0001c760: 220a 2020 2020 2020 2020 6b65 7934 203d  ".        key4 =
-0001c770: 2022 3230 3044 4d41 220a 2020 2020 2020   "200DMA".      
-0001c780: 2020 6973 3230 444d 4143 726f 7373 6f76    is20DMACrossov
-0001c790: 6572 3530 444d 4120 3d20 2872 6563 656e  er50DMA = (recen
-0001c7a0: 745b 2253 534d 4132 3022 5d2e 696c 6f63  t["SSMA20"].iloc
-0001c7b0: 5b30 5d20 3e3d 2072 6563 656e 745b 2253  [0] >= recent["S
-0001c7c0: 4d41 225d 2e69 6c6f 635b 305d 2920 616e  MA"].iloc[0]) an
-0001c7d0: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
-0001c7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7f0: 2872 6563 656e 745b 2253 534d 4132 3022  (recent["SSMA20"
-0001c800: 5d2e 696c 6f63 5b31 5d20 3c3d 2072 6563  ].iloc[1] <= rec
-0001c810: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
-0001c820: 315d 290a 2020 2020 2020 2020 6973 3530  1]).        is50
-0001c830: 444d 4143 726f 7373 6f76 6572 3230 3044  DMACrossover200D
-0001c840: 4d41 203d 2028 7265 6365 6e74 5b22 534d  MA = (recent["SM
-0001c850: 4122 5d2e 696c 6f63 5b30 5d20 3e3d 2072  A"].iloc[0] >= r
-0001c860: 6563 656e 745b 224c 4d41 225d 2e69 6c6f  ecent["LMA"].ilo
-0001c870: 635b 305d 2920 616e 6420 5c0a 2020 2020  c[0]) and \.    
-0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c890: 2020 2020 2020 2020 2872 6563 656e 745b          (recent[
-0001c8a0: 2253 4d41 225d 2e69 6c6f 635b 315d 203c  "SMA"].iloc[1] <
-0001c8b0: 3d20 7265 6365 6e74 5b22 4c4d 4122 5d2e  = recent["LMA"].
-0001c8c0: 696c 6f63 5b31 5d29 0a20 2020 2020 2020  iloc[1]).       
-0001c8d0: 2069 7347 6f6c 6465 6e43 726f 7373 4f76   isGoldenCrossOv
-0001c8e0: 6572 203d 2069 7332 3044 4d41 4372 6f73  er = is20DMACros
-0001c8f0: 736f 7665 7235 3044 4d41 206f 7220 6973  sover50DMA or is
-0001c900: 3530 444d 4143 726f 7373 6f76 6572 3230  50DMACrossover20
-0001c910: 3044 4d41 0a20 2020 2020 2020 2069 7335  0DMA.        is5
-0001c920: 3044 4d41 4372 6f73 736f 7665 7232 3030  0DMACrossover200
-0001c930: 444d 4144 6f77 6e20 3d20 2872 6563 656e  DMADown = (recen
-0001c940: 745b 2253 4d41 225d 2e69 6c6f 635b 305d  t["SMA"].iloc[0]
-0001c950: 203c 3d20 7265 6365 6e74 5b22 4c4d 4122   <= recent["LMA"
-0001c960: 5d2e 696c 6f63 5b30 5d29 2061 6e64 205c  ].iloc[0]) and \
-0001c970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c980: 2020 2020 2020 2020 2020 2020 2028 7265               (re
-0001c990: 6365 6e74 5b22 534d 4122 5d2e 696c 6f63  cent["SMA"].iloc
-0001c9a0: 5b31 5d20 3e3d 2072 6563 656e 745b 224c  [1] >= recent["L
-0001c9b0: 4d41 225d 2e69 6c6f 635b 315d 290a 2020  MA"].iloc[1]).  
-0001c9c0: 2020 2020 2020 6973 3230 444d 4143 726f        is20DMACro
-0001c9d0: 7373 6f76 6572 3530 444d 4144 6f77 6e20  ssover50DMADown 
-0001c9e0: 3d20 2872 6563 656e 745b 2253 534d 4132  = (recent["SSMA2
-0001c9f0: 3022 5d2e 696c 6f63 5b30 5d20 3c3d 2072  0"].iloc[0] <= r
-0001ca00: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
-0001ca10: 635b 305d 2920 616e 6420 5c0a 2020 2020  c[0]) and \.    
-0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca30: 2020 2020 2020 2020 2872 6563 656e 745b          (recent[
-0001ca40: 2253 534d 4132 3022 5d2e 696c 6f63 5b31  "SSMA20"].iloc[1
-0001ca50: 5d20 3e3d 2072 6563 656e 745b 2253 4d41  ] >= recent["SMA
-0001ca60: 225d 2e69 6c6f 635b 315d 290a 2020 2020  "].iloc[1]).    
-0001ca70: 2020 2020 6973 4465 6164 4372 6f73 734f      isDeadCrossO
-0001ca80: 7665 7220 3d20 6973 3230 444d 4143 726f  ver = is20DMACro
-0001ca90: 7373 6f76 6572 3530 444d 4144 6f77 6e20  ssover50DMADown 
-0001caa0: 6f72 2069 7335 3044 4d41 4372 6f73 736f  or is50DMACrosso
-0001cab0: 7665 7232 3030 444d 4144 6f77 6e0a 2020  ver200DMADown.  
-0001cac0: 2020 2020 2020 6465 6164 784f 7665 7254        deadxOverT
-0001cad0: 6578 7420 3d20 6627 4465 6164 4372 6f73  ext = f'DeadCros
-0001cae0: 736f 7665 727b 2228 3230 2922 2069 6620  sover{"(20)" if 
-0001caf0: 6973 3230 444d 4143 726f 7373 6f76 6572  is20DMACrossover
-0001cb00: 3530 444d 4144 6f77 6e20 656c 7365 2028  50DMADown else (
-0001cb10: 2228 3530 2922 2069 6620 6973 3530 444d  "(50)" if is50DM
-0001cb20: 4143 726f 7373 6f76 6572 3230 3044 4d41  ACrossover200DMA
-0001cb30: 446f 776e 2065 6c73 6520 2222 297d 270a  Down else "")}'.
-0001cb40: 2020 2020 2020 2020 676f 6c64 656e 784f          goldenxO
-0001cb50: 7665 7254 6578 7420 3d20 6627 476f 6c64  verText = f'Gold
-0001cb60: 656e 4372 6f73 736f 7665 727b 2228 3230  enCrossover{"(20
-0001cb70: 2922 2069 6620 6973 3230 444d 4143 726f  )" if is20DMACro
-0001cb80: 7373 6f76 6572 3530 444d 4120 656c 7365  ssover50DMA else
+0001b260: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
+0001b270: 2020 2020 6c6d 6120 3d20 706b 7461 6c69      lma = pktali
+0001b280: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
+0001b290: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+0001b2a0: 3230 3029 0a20 2020 2020 2020 2020 2020  200).           
+0001b2b0: 2020 2020 2073 736d 6120 3d20 706b 7461       ssma = pkta
+0001b2c0: 6c69 622e 534d 4128 6461 7461 5b22 436c  lib.SMA(data["Cl
+0001b2d0: 6f73 6522 5d2c 2074 696d 6570 6572 696f  ose"], timeperio
+0001b2e0: 643d 3929 0a20 2020 2020 2020 2020 2020  d=9).           
+0001b2f0: 2020 2020 2073 736d 6132 3020 3d20 706b       ssma20 = pk
+0001b300: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
+0001b310: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
+0001b320: 696f 643d 3230 290a 2020 2020 2020 2020  iod=20).        
+0001b330: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
+0001b340: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
+0001b350: 756d 6e73 292c 2022 534d 4122 2c20 736d  umns), "SMA", sm
+0001b360: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
+0001b370: 2020 2064 6174 612e 696e 7365 7274 286c     data.insert(l
+0001b380: 656e 2864 6174 612e 636f 6c75 6d6e 7329  en(data.columns)
+0001b390: 2c20 224c 4d41 222c 206c 6d61 290a 2020  , "LMA", lma).  
+0001b3a0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001b3b0: 7461 2e69 6e73 6572 7428 6c65 6e28 6461  ta.insert(len(da
+0001b3c0: 7461 2e63 6f6c 756d 6e73 292c 2022 5353  ta.columns), "SS
+0001b3d0: 4d41 222c 2073 736d 6129 0a20 2020 2020  MA", ssma).     
+0001b3e0: 2020 2020 2020 2020 2020 2064 6174 612e             data.
+0001b3f0: 696e 7365 7274 286c 656e 2864 6174 612e  insert(len(data.
+0001b400: 636f 6c75 6d6e 7329 2c20 2253 534d 4132  columns), "SSMA2
+0001b410: 3022 2c20 7373 6d61 3230 290a 2020 2020  0", ssma20).    
+0001b420: 2020 2020 2020 2020 766f 6c20 3d20 706b          vol = pk
+0001b430: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
+0001b440: 566f 6c75 6d65 225d 2c20 7469 6d65 7065  Volume"], timepe
+0001b450: 7269 6f64 3d32 3029 0a20 2020 2020 2020  riod=20).       
+0001b460: 2020 2020 2072 7369 203d 2070 6b74 616c       rsi = pktal
+0001b470: 6962 2e52 5349 2864 6174 615b 2243 6c6f  ib.RSI(data["Clo
+0001b480: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
+0001b490: 3d31 3429 0a20 2020 2020 2020 2020 2020  =14).           
+0001b4a0: 2064 6174 612e 696e 7365 7274 286c 656e   data.insert(len
+0001b4b0: 2864 6174 612e 636f 6c75 6d6e 7329 2c20  (data.columns), 
+0001b4c0: 2256 6f6c 4d41 222c 2076 6f6c 290a 2020  "VolMA", vol).  
+0001b4d0: 2020 2020 2020 2020 2020 6461 7461 2e69            data.i
+0001b4e0: 6e73 6572 7428 6c65 6e28 6461 7461 2e63  nsert(len(data.c
+0001b4f0: 6f6c 756d 6e73 292c 2022 5253 4922 2c20  olumns), "RSI", 
+0001b500: 7273 6929 0a20 2020 2020 2020 2020 2020  rsi).           
+0001b510: 2063 6369 203d 2070 6b74 616c 6962 2e43   cci = pktalib.C
+0001b520: 4349 2864 6174 615b 2248 6967 6822 5d2c  CI(data["High"],
+0001b530: 2064 6174 615b 224c 6f77 225d 2c20 6461   data["Low"], da
+0001b540: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
+0001b550: 6570 6572 696f 643d 3134 290a 2020 2020  eperiod=14).    
+0001b560: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
+0001b570: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
+0001b580: 756d 6e73 292c 2022 4343 4922 2c20 6363  umns), "CCI", cc
+0001b590: 6929 0a20 2020 2020 2020 2020 2020 2074  i).            t
+0001b5a0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001b5b0: 2020 2020 6661 7374 6b2c 2066 6173 7464      fastk, fastd
+0001b5c0: 203d 2070 6b74 616c 6962 2e53 544f 4348   = pktalib.STOCH
+0001b5d0: 5253 4928 0a20 2020 2020 2020 2020 2020  RSI(.           
+0001b5e0: 2020 2020 2020 2020 2064 6174 615b 2243           data["C
+0001b5f0: 6c6f 7365 225d 2c20 7469 6d65 7065 7269  lose"], timeperi
+0001b600: 6f64 3d31 342c 2066 6173 746b 5f70 6572  od=14, fastk_per
+0001b610: 696f 643d 352c 2066 6173 7464 5f70 6572  iod=5, fastd_per
+0001b620: 696f 643d 332c 2066 6173 7464 5f6d 6174  iod=3, fastd_mat
+0001b630: 7970 653d 300a 2020 2020 2020 2020 2020  ype=0.          
+0001b640: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b650: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
+0001b660: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
+0001b670: 756d 6e73 292c 2022 4641 5354 4b22 2c20  umns), "FASTK", 
+0001b680: 6661 7374 6b29 0a20 2020 2020 2020 2020  fastk).         
+0001b690: 2020 2020 2020 2064 6174 612e 696e 7365         data.inse
+0001b6a0: 7274 286c 656e 2864 6174 612e 636f 6c75  rt(len(data.colu
+0001b6b0: 6d6e 7329 2c20 2246 4153 5444 222c 2066  mns), "FASTD", f
+0001b6c0: 6173 7464 290a 2020 2020 2020 2020 2020  astd).          
+0001b6d0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0001b6e0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0001b6f0: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+0001b700: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
+0001b710: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
+0001b720: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001b730: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001b740: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0001b750: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0001b760: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+0001b770: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
+0001b780: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
+0001b790: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001b7a0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001b7b0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
+0001b7c0: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
+0001b7d0: 6865 2064 6174 6166 7261 6d65 0a20 2020  he dataframe.   
+0001b7e0: 2020 2020 2023 2064 6174 6120 3d20 6461       # data = da
+0001b7f0: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+0001b800: 2020 2020 2023 2064 6174 6120 3d20 6461       # data = da
+0001b810: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+0001b820: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+0001b830: 0a20 2020 2020 2020 2066 756c 6c44 6174  .        fullDat
+0001b840: 6120 3d20 6461 7461 0a20 2020 2020 2020  a = data.       
+0001b850: 2074 7269 6d6d 6564 4461 7461 203d 2064   trimmedData = d
+0001b860: 6174 612e 6865 6164 2864 6179 7354 6f4c  ata.head(daysToL
+0001b870: 6f6f 6b62 6163 6b29 0a20 2020 2020 2020  ookback).       
+0001b880: 2072 6574 7572 6e20 2866 756c 6c44 6174   return (fullDat
+0001b890: 612c 2074 7269 6d6d 6564 4461 7461 290a  a, trimmedData).
+0001b8a0: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
+0001b8b0: 6966 2074 6865 2073 746f 636b 2069 7320  if the stock is 
+0001b8c0: 6275 6c6c 6973 6820 696e 2074 6865 2073  bullish in the s
+0001b8d0: 686f 7274 2074 6572 6d0a 2020 2020 6465  hort term.    de
+0001b8e0: 6620 7661 6c69 6461 7465 3135 4d69 6e75  f validate15Minu
+0001b8f0: 7465 5072 6963 6556 6f6c 756d 6542 7265  tePriceVolumeBre
+0001b900: 616b 6f75 7428 7365 6c66 2c20 6466 293a  akout(self, df):
+0001b910: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
+0001b920: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
+0001b930: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0001b940: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001b950: 0a20 2020 2020 2020 2023 2068 7474 7073  .        # https
+0001b960: 3a2f 2f63 6861 7274 696e 6b2e 636f 6d2f  ://chartink.com/
+0001b970: 7363 7265 656e 6572 2f31 352d 6d69 6e2d  screener/15-min-
+0001b980: 7072 6963 652d 766f 6c75 6d65 2d62 7265  price-volume-bre
+0001b990: 616b 6f75 740a 2020 2020 2020 2020 6461  akout.        da
+0001b9a0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+0001b9b0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001b9c0: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+0001b9d0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+0001b9e0: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+0001b9f0: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+0001ba00: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001ba10: 7461 5b3a 3a2d 315d 2020 2320 5265 7665  ta[::-1]  # Reve
+0001ba20: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+0001ba30: 6520 736f 2074 6861 7420 6974 7320 7468  e so that its th
+0001ba40: 6520 6f6c 6465 7374 2064 6174 6520 6669  e oldest date fi
+0001ba50: 7273 740a 2020 2020 2020 2020 6461 7461  rst.        data
+0001ba60: 5b22 534d 4132 3022 5d20 3d20 706b 7461  ["SMA20"] = pkta
+0001ba70: 6c69 622e 534d 4128 6461 7461 5b22 436c  lib.SMA(data["Cl
+0001ba80: 6f73 6522 5d2c 2032 3029 0a20 2020 2020  ose"], 20).     
+0001ba90: 2020 2064 6174 615b 2253 4d41 3230 5622     data["SMA20V"
+0001baa0: 5d20 3d20 706b 7461 6c69 622e 534d 4128  ] = pktalib.SMA(
+0001bab0: 6461 7461 5b22 566f 6c75 6d65 225d 2c20  data["Volume"], 
+0001bac0: 3230 290a 2020 2020 2020 2020 6461 7461  20).        data
+0001bad0: 203d 2064 6174 615b 0a20 2020 2020 2020   = data[.       
+0001bae0: 2020 2020 203a 3a2d 310a 2020 2020 2020       ::-1.      
+0001baf0: 2020 5d20 2023 2052 6576 6572 7365 2074    ]  # Reverse t
+0001bb00: 6865 2064 6174 6166 7261 6d65 2073 6f20  he dataframe so 
+0001bb10: 7468 6174 2069 7427 7320 7468 6520 6d6f  that it's the mo
+0001bb20: 7374 2072 6563 656e 7420 6461 7465 2066  st recent date f
+0001bb30: 6972 7374 0a20 2020 2020 2020 2072 6563  irst.        rec
+0001bb40: 656e 7420 3d20 6461 7461 2e68 6561 6428  ent = data.head(
+0001bb50: 3329 0a20 2020 2020 2020 2069 6620 6c65  3).        if le
+0001bb60: 6e28 7265 6365 6e74 2920 3c20 333a 0a20  n(recent) < 3:. 
+0001bb70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001bb80: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001bb90: 636f 6e64 3120 3d20 7265 6365 6e74 5b22  cond1 = recent["
+0001bba0: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+0001bbb0: 3e20 7265 6365 6e74 5b22 436c 6f73 6522  > recent["Close"
+0001bbc0: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
+0001bbd0: 2020 636f 6e64 3220 3d20 636f 6e64 3120    cond2 = cond1 
+0001bbe0: 616e 6420 2872 6563 656e 745b 2243 6c6f  and (recent["Clo
+0001bbf0: 7365 225d 2e69 6c6f 635b 305d 203e 2072  se"].iloc[0] > r
+0001bc00: 6563 656e 745b 2253 4d41 3230 225d 2e69  ecent["SMA20"].i
+0001bc10: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001bc20: 636f 6e64 3320 3d20 636f 6e64 3220 616e  cond3 = cond2 an
+0001bc30: 6420 2872 6563 656e 745b 2243 6c6f 7365  d (recent["Close
+0001bc40: 225d 2e69 6c6f 635b 315d 203e 2072 6563  "].iloc[1] > rec
+0001bc50: 656e 745b 2248 6967 6822 5d2e 696c 6f63  ent["High"].iloc
+0001bc60: 5b32 5d29 0a20 2020 2020 2020 2063 6f6e  [2]).        con
+0001bc70: 6434 203d 2063 6f6e 6433 2061 6e64 2028  d4 = cond3 and (
+0001bc80: 7265 6365 6e74 5b22 566f 6c75 6d65 225d  recent["Volume"]
+0001bc90: 2e69 6c6f 635b 305d 203e 2072 6563 656e  .iloc[0] > recen
+0001bca0: 745b 2253 4d41 3230 5622 5d2e 696c 6f63  t["SMA20V"].iloc
+0001bcb0: 5b30 5d29 0a20 2020 2020 2020 2063 6f6e  [0]).        con
+0001bcc0: 6435 203d 2063 6f6e 6434 2061 6e64 2028  d5 = cond4 and (
+0001bcd0: 7265 6365 6e74 5b22 566f 6c75 6d65 225d  recent["Volume"]
+0001bce0: 2e69 6c6f 635b 315d 203e 2072 6563 656e  .iloc[1] > recen
+0001bcf0: 745b 2253 4d41 3230 5622 5d2e 696c 6f63  t["SMA20V"].iloc
+0001bd00: 5b30 5d29 0a20 2020 2020 2020 2072 6574  [0]).        ret
+0001bd10: 7572 6e20 636f 6e64 350a 0a20 2020 2064  urn cond5..    d
+0001bd20: 6566 2076 616c 6964 6174 6542 756c 6c69  ef validateBulli
+0001bd30: 7368 466f 7254 6f6d 6f72 726f 7728 7365  shForTomorrow(se
+0001bd40: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
+0001bd50: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+0001bd60: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+0001bd70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bd80: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0001bd90: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+0001bda0: 290a 2020 2020 2020 2020 2320 6874 7470  ).        # http
+0001bdb0: 733a 2f2f 6368 6172 7469 6e6b 2e63 6f6d  s://chartink.com
+0001bdc0: 2f73 6372 6565 6e65 722f 6275 6c6c 6973  /screener/bullis
+0001bdd0: 682d 666f 722d 746f 6d6f 7272 6f77 0a20  h-for-tomorrow. 
+0001bde0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001bdf0: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+0001be00: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+0001be10: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+0001be20: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+0001be30: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001be40: 7461 5b3a 3a2d 315d 2020 2320 5265 7665  ta[::-1]  # Reve
+0001be50: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+0001be60: 6520 736f 2074 6861 7420 6974 7320 7468  e so that its th
+0001be70: 6520 6f6c 6465 7374 2064 6174 6520 6669  e oldest date fi
+0001be80: 7273 740a 2020 2020 2020 2020 6d61 6364  rst.        macd
+0001be90: 4c69 6e65 203d 2070 6b74 616c 6962 2e4d  Line = pktalib.M
+0001bea0: 4143 4428 6461 7461 5b22 436c 6f73 6522  ACD(data["Close"
+0001beb0: 5d2c 2031 322c 2032 362c 2039 295b 305d  ], 12, 26, 9)[0]
+0001bec0: 2e74 6169 6c28 3329 0a20 2020 2020 2020  .tail(3).       
+0001bed0: 206d 6163 6453 6967 6e61 6c20 3d20 706b   macdSignal = pk
+0001bee0: 7461 6c69 622e 4d41 4344 2864 6174 615b  talib.MACD(data[
+0001bef0: 2243 6c6f 7365 225d 2c20 3132 2c20 3236  "Close"], 12, 26
+0001bf00: 2c20 3929 5b31 5d2e 7461 696c 2833 290a  , 9)[1].tail(3).
+0001bf10: 2020 2020 2020 2020 6d61 6364 4869 7374          macdHist
+0001bf20: 203d 2070 6b74 616c 6962 2e4d 4143 4428   = pktalib.MACD(
+0001bf30: 6461 7461 5b22 436c 6f73 6522 5d2c 2031  data["Close"], 1
+0001bf40: 322c 2032 362c 2039 295b 325d 2e74 6169  2, 26, 9)[2].tai
+0001bf50: 6c28 3329 0a0a 2020 2020 2020 2020 7265  l(3)..        re
+0001bf60: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+0001bf70: 2020 2028 6d61 6364 4869 7374 2e69 6c6f     (macdHist.ilo
+0001bf80: 635b 3a31 5d2e 696c 6f63 5b30 5d20 3c20  c[:1].iloc[0] < 
+0001bf90: 6d61 6364 4869 7374 2e69 6c6f 635b 3a32  macdHist.iloc[:2
+0001bfa0: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001bfb0: 2020 2020 2020 2061 6e64 2028 6d61 6364         and (macd
+0001bfc0: 4869 7374 2e69 6c6f 635b 3a33 5d2e 696c  Hist.iloc[:3].il
+0001bfd0: 6f63 5b32 5d20 3e20 6d61 6364 4869 7374  oc[2] > macdHist
+0001bfe0: 2e69 6c6f 635b 3a32 5d2e 696c 6f63 5b31  .iloc[:2].iloc[1
+0001bff0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0001c000: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+0001c010: 2020 2020 2028 6d61 6364 4c69 6e65 2e69       (macdLine.i
+0001c020: 6c6f 635b 3a33 5d2e 696c 6f63 5b32 5d20  loc[:3].iloc[2] 
+0001c030: 2d20 6d61 6364 5369 676e 616c 2e69 6c6f  - macdSignal.ilo
+0001c040: 635b 3a33 5d2e 696c 6f63 5b32 5d29 0a20  c[:3].iloc[2]). 
+0001c050: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+0001c060: 2028 6d61 6364 4c69 6e65 2e69 6c6f 635b   (macdLine.iloc[
+0001c070: 3a32 5d2e 696c 6f63 5b31 5d20 2d20 6d61  :2].iloc[1] - ma
+0001c080: 6364 5369 676e 616c 2e69 6c6f 635b 3a32  cdSignal.iloc[:2
+0001c090: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001c0a0: 2020 2020 2020 2020 2020 203e 3d20 302e             >= 0.
+0001c0b0: 340a 2020 2020 2020 2020 2020 2020 290a  4.            ).
+0001c0c0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001c0d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001c0e0: 2020 286d 6163 644c 696e 652e 696c 6f63    (macdLine.iloc
+0001c0f0: 5b3a 325d 2e69 6c6f 635b 315d 202d 206d  [:2].iloc[1] - m
+0001c100: 6163 6453 6967 6e61 6c2e 696c 6f63 5b3a  acdSignal.iloc[:
+0001c110: 325d 2e69 6c6f 635b 315d 290a 2020 2020  2].iloc[1]).    
+0001c120: 2020 2020 2020 2020 2020 2020 2d20 286d              - (m
+0001c130: 6163 644c 696e 652e 696c 6f63 5b3a 315d  acdLine.iloc[:1]
+0001c140: 2e69 6c6f 635b 305d 202d 206d 6163 6453  .iloc[0] - macdS
+0001c150: 6967 6e61 6c2e 696c 6f63 5b3a 315d 2e69  ignal.iloc[:1].i
+0001c160: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001c170: 2020 2020 2020 2020 3c3d 2030 2e32 0a20          <= 0.2. 
+0001c180: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001c190: 2020 2020 2020 2020 2061 6e64 2028 6d61           and (ma
+0001c1a0: 6364 4c69 6e65 2e69 6c6f 635b 3a33 5d2e  cdLine.iloc[:3].
+0001c1b0: 696c 6f63 5b32 5d20 3e20 6d61 6364 5369  iloc[2] > macdSi
+0001c1c0: 676e 616c 2e69 6c6f 635b 3a33 5d2e 696c  gnal.iloc[:3].il
+0001c1d0: 6f63 5b32 5d29 0a20 2020 2020 2020 2020  oc[2]).         
+0001c1e0: 2020 2061 6e64 2028 0a20 2020 2020 2020     and (.       
+0001c1f0: 2020 2020 2020 2020 2028 6d61 6364 4c69           (macdLi
+0001c200: 6e65 2e69 6c6f 635b 3a33 5d2e 696c 6f63  ne.iloc[:3].iloc
+0001c210: 5b32 5d20 2d20 6d61 6364 5369 676e 616c  [2] - macdSignal
+0001c220: 2e69 6c6f 635b 3a33 5d2e 696c 6f63 5b32  .iloc[:3].iloc[2
+0001c230: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001c240: 2020 202d 2028 6d61 6364 4c69 6e65 2e69     - (macdLine.i
+0001c250: 6c6f 635b 3a32 5d2e 696c 6f63 5b31 5d20  loc[:2].iloc[1] 
+0001c260: 2d20 6d61 6364 5369 676e 616c 2e69 6c6f  - macdSignal.ilo
+0001c270: 635b 3a32 5d2e 696c 6f63 5b31 5d29 0a20  c[:2].iloc[1]). 
+0001c280: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+0001c290: 2031 0a20 2020 2020 2020 2020 2020 2029   1.            )
+0001c2a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001c2b0: 2340 6d65 6173 7572 655f 7469 6d65 0a20  #@measure_time. 
+0001c2c0: 2020 2023 2076 616c 6964 6174 6520 6966     # validate if
+0001c2d0: 2043 4349 2069 7320 7769 7468 696e 2067   CCI is within g
+0001c2e0: 6976 656e 2072 616e 6765 0a20 2020 2064  iven range.    d
+0001c2f0: 6566 2076 616c 6964 6174 6543 4349 2873  ef validateCCI(s
+0001c300: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
+0001c310: 6963 742c 2073 6176 6544 6963 742c 206d  ict, saveDict, m
+0001c320: 696e 4343 492c 206d 6178 4343 4929 3a0a  inCCI, maxCCI):.
+0001c330: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0001c340: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0001c350: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0001c360: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0001c370: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0001c380: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0001c390: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+0001c3a0: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
+0001c3b0: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+0001c3c0: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+0001c3d0: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
+0001c3e0: 2063 6369 203d 2069 6e74 2864 6174 612e   cci = int(data.
+0001c3f0: 6865 6164 2831 295b 2243 4349 225d 2e69  head(1)["CCI"].i
+0001c400: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001c410: 7361 7665 4469 6374 5b22 4343 4922 5d20  saveDict["CCI"] 
+0001c420: 3d20 6363 690a 2020 2020 2020 2020 6966  = cci.        if
+0001c430: 2028 6363 6920 3e3d 206d 696e 4343 4920   (cci >= minCCI 
+0001c440: 616e 6420 6363 6920 3c3d 206d 6178 4343  and cci <= maxCC
+0001c450: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
+0001c460: 6966 2028 2255 7022 2069 6e20 7361 7665  if ("Up" in save
+0001c470: 4469 6374 5b22 5472 656e 6422 5d29 3a0a  Dict["Trend"]):.
+0001c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c490: 7363 7265 656e 4469 6374 5b22 4343 4922  screenDict["CCI"
+0001c4a0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0001c4b0: 2020 2020 2020 2020 2020 2863 6f6c 6f72            (color
+0001c4c0: 5465 7874 2e42 4f4c 4420 6966 2028 2253  Text.BOLD if ("S
+0001c4d0: 7472 6f6e 6722 2069 6e20 7361 7665 4469  trong" in saveDi
+0001c4e0: 6374 5b22 5472 656e 6422 5d29 2065 6c73  ct["Trend"]) els
+0001c4f0: 6520 2222 2920 2b20 636f 6c6f 7254 6578  e "") + colorTex
+0001c500: 742e 4752 4545 4e20 2b20 7374 7228 6363  t.GREEN + str(cc
+0001c510: 6929 202b 2063 6f6c 6f72 5465 7874 2e45  i) + colorText.E
+0001c520: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001c530: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001c540: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001c550: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0001c560: 745b 2243 4349 225d 203d 2028 0a20 2020  t["CCI"] = (.   
+0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c580: 2028 636f 6c6f 7254 6578 742e 424f 4c44   (colorText.BOLD
+0001c590: 2069 6620 2822 5374 726f 6e67 2220 696e   if ("Strong" in
+0001c5a0: 2073 6176 6544 6963 745b 2254 7265 6e64   saveDict["Trend
+0001c5b0: 225d 2920 656c 7365 2022 2229 202b 2063  "]) else "") + c
+0001c5c0: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
+0001c5d0: 7374 7228 6363 6929 202b 2063 6f6c 6f72  str(cci) + color
+0001c5e0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0001c5f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001c600: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001c610: 7565 0a20 2020 2020 2020 2073 6372 6565  ue.        scree
+0001c620: 6e44 6963 745b 2243 4349 225d 203d 2063  nDict["CCI"] = c
+0001c630: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+0001c640: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+0001c650: 2073 7472 2863 6369 2920 2b20 636f 6c6f   str(cci) + colo
+0001c660: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0001c670: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+0001c680: 2020 2020 2320 4669 6e64 2043 6f6e 666c      # Find Confl
+0001c690: 7563 656e 6365 0a20 2020 2064 6566 2076  ucence.    def v
+0001c6a0: 616c 6964 6174 6543 6f6e 666c 7565 6e63  alidateConfluenc
+0001c6b0: 6528 7365 6c66 2c20 7374 6f63 6b2c 2064  e(self, stock, d
+0001c6c0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+0001c6d0: 6176 6544 6963 742c 2070 6572 6365 6e74  aveDict, percent
+0001c6e0: 6167 653d 302e 312c 636f 6e66 4669 6c74  age=0.1,confFilt
+0001c6f0: 6572 3d33 293a 0a20 2020 2020 2020 2069  er=3):.        i
+0001c700: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+0001c710: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+0001c720: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001c730: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0001c740: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+0001c750: 2020 2020 2020 2020 7265 6365 6e74 203d          recent =
+0001c760: 2064 6174 612e 6865 6164 2832 290a 2020   data.head(2).  
+0001c770: 2020 2020 2020 6966 206c 656e 2872 6563        if len(rec
+0001c780: 656e 7429 203c 2032 3a0a 2020 2020 2020  ent) < 2:.      
+0001c790: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001c7a0: 7365 0a20 2020 2020 2020 206b 6579 3120  se.        key1 
+0001c7b0: 3d20 2253 4d41 220a 2020 2020 2020 2020  = "SMA".        
+0001c7c0: 6b65 7932 203d 2022 4c4d 4122 0a20 2020  key2 = "LMA".   
+0001c7d0: 2020 2020 206b 6579 3320 3d20 2235 3044       key3 = "50D
+0001c7e0: 4d41 220a 2020 2020 2020 2020 6b65 7934  MA".        key4
+0001c7f0: 203d 2022 3230 3044 4d41 220a 2020 2020   = "200DMA".    
+0001c800: 2020 2020 6973 3230 444d 4143 726f 7373      is20DMACross
+0001c810: 6f76 6572 3530 444d 4120 3d20 2872 6563  over50DMA = (rec
+0001c820: 656e 745b 2253 534d 4132 3022 5d2e 696c  ent["SSMA20"].il
+0001c830: 6f63 5b30 5d20 3e3d 2072 6563 656e 745b  oc[0] >= recent[
+0001c840: 2253 4d41 225d 2e69 6c6f 635b 305d 2920  "SMA"].iloc[0]) 
+0001c850: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2020 2872 6563 656e 745b 2253 534d 4132    (recent["SSMA2
+0001c880: 3022 5d2e 696c 6f63 5b31 5d20 3c3d 2072  0"].iloc[1] <= r
+0001c890: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
+0001c8a0: 635b 315d 290a 2020 2020 2020 2020 6973  c[1]).        is
+0001c8b0: 3530 444d 4143 726f 7373 6f76 6572 3230  50DMACrossover20
+0001c8c0: 3044 4d41 203d 2028 7265 6365 6e74 5b22  0DMA = (recent["
+0001c8d0: 534d 4122 5d2e 696c 6f63 5b30 5d20 3e3d  SMA"].iloc[0] >=
+0001c8e0: 2072 6563 656e 745b 224c 4d41 225d 2e69   recent["LMA"].i
+0001c8f0: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
+0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c910: 2020 2020 2020 2020 2020 2872 6563 656e            (recen
+0001c920: 745b 2253 4d41 225d 2e69 6c6f 635b 315d  t["SMA"].iloc[1]
+0001c930: 203c 3d20 7265 6365 6e74 5b22 4c4d 4122   <= recent["LMA"
+0001c940: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001c950: 2020 2069 7347 6f6c 6465 6e43 726f 7373     isGoldenCross
+0001c960: 4f76 6572 203d 2069 7332 3044 4d41 4372  Over = is20DMACr
+0001c970: 6f73 736f 7665 7235 3044 4d41 206f 7220  ossover50DMA or 
+0001c980: 6973 3530 444d 4143 726f 7373 6f76 6572  is50DMACrossover
+0001c990: 3230 3044 4d41 0a20 2020 2020 2020 2069  200DMA.        i
+0001c9a0: 7335 3044 4d41 4372 6f73 736f 7665 7232  s50DMACrossover2
+0001c9b0: 3030 444d 4144 6f77 6e20 3d20 2872 6563  00DMADown = (rec
+0001c9c0: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
+0001c9d0: 305d 203c 3d20 7265 6365 6e74 5b22 4c4d  0] <= recent["LM
+0001c9e0: 4122 5d2e 696c 6f63 5b30 5d29 2061 6e64  A"].iloc[0]) and
+0001c9f0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001ca10: 7265 6365 6e74 5b22 534d 4122 5d2e 696c  recent["SMA"].il
+0001ca20: 6f63 5b31 5d20 3e3d 2072 6563 656e 745b  oc[1] >= recent[
+0001ca30: 224c 4d41 225d 2e69 6c6f 635b 315d 290a  "LMA"].iloc[1]).
+0001ca40: 2020 2020 2020 2020 6973 3230 444d 4143          is20DMAC
+0001ca50: 726f 7373 6f76 6572 3530 444d 4144 6f77  rossover50DMADow
+0001ca60: 6e20 3d20 2872 6563 656e 745b 2253 534d  n = (recent["SSM
+0001ca70: 4132 3022 5d2e 696c 6f63 5b30 5d20 3c3d  A20"].iloc[0] <=
+0001ca80: 2072 6563 656e 745b 2253 4d41 225d 2e69   recent["SMA"].i
+0001ca90: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cab0: 2020 2020 2020 2020 2020 2872 6563 656e            (recen
+0001cac0: 745b 2253 534d 4132 3022 5d2e 696c 6f63  t["SSMA20"].iloc
+0001cad0: 5b31 5d20 3e3d 2072 6563 656e 745b 2253  [1] >= recent["S
+0001cae0: 4d41 225d 2e69 6c6f 635b 315d 290a 2020  MA"].iloc[1]).  
+0001caf0: 2020 2020 2020 6973 4465 6164 4372 6f73        isDeadCros
+0001cb00: 734f 7665 7220 3d20 6973 3230 444d 4143  sOver = is20DMAC
+0001cb10: 726f 7373 6f76 6572 3530 444d 4144 6f77  rossover50DMADow
+0001cb20: 6e20 6f72 2069 7335 3044 4d41 4372 6f73  n or is50DMACros
+0001cb30: 736f 7665 7232 3030 444d 4144 6f77 6e0a  sover200DMADown.
+0001cb40: 2020 2020 2020 2020 6465 6164 784f 7665          deadxOve
+0001cb50: 7254 6578 7420 3d20 6627 4465 6164 4372  rText = f'DeadCr
+0001cb60: 6f73 736f 7665 727b 2228 3230 2922 2069  ossover{"(20)" i
+0001cb70: 6620 6973 3230 444d 4143 726f 7373 6f76  f is20DMACrossov
+0001cb80: 6572 3530 444d 4144 6f77 6e20 656c 7365  er50DMADown else
 0001cb90: 2028 2228 3530 2922 2069 6620 6973 3530   ("(50)" if is50
 0001cba0: 444d 4143 726f 7373 6f76 6572 3230 3044  DMACrossover200D
-0001cbb0: 4d41 2065 6c73 6520 2222 297d 270a 2020  MA else "")}'.  
-0001cbc0: 2020 2020 2020 6966 2069 7332 3044 4d41        if is20DMA
-0001cbd0: 4372 6f73 736f 7665 7235 3044 4d41 206f  Crossover50DMA o
-0001cbe0: 7220 6973 3230 444d 4143 726f 7373 6f76  r is20DMACrossov
-0001cbf0: 6572 3530 444d 4144 6f77 6e3a 0a20 2020  er50DMADown:.   
-0001cc00: 2020 2020 2020 2020 206b 6579 3120 3d20           key1 = 
-0001cc10: 2253 534d 4132 3022 0a20 2020 2020 2020  "SSMA20".       
-0001cc20: 2020 2020 206b 6579 3220 3d20 2253 4d41       key2 = "SMA
-0001cc30: 220a 2020 2020 2020 2020 2020 2020 6b65  ".            ke
-0001cc40: 7933 203d 2022 3230 444d 4122 0a20 2020  y3 = "20DMA".   
-0001cc50: 2020 2020 2020 2020 206b 6579 3420 3d20           key4 = 
-0001cc60: 2235 3044 4d41 220a 2020 2020 2020 2020  "50DMA".        
-0001cc70: 6973 3530 444d 4155 7054 7265 6e64 203d  is50DMAUpTrend =
-0001cc80: 2028 7265 6365 6e74 5b6b 6579 315d 2e69   (recent[key1].i
-0001cc90: 6c6f 635b 305d 203e 2072 6563 656e 745b  loc[0] > recent[
-0001cca0: 6b65 7932 5d2e 696c 6f63 5b31 5d29 0a20  key2].iloc[1]). 
-0001ccb0: 2020 2020 2020 2069 7335 3044 4d41 446f         is50DMADo
-0001ccc0: 776e 5472 656e 6420 3d20 2872 6563 656e  wnTrend = (recen
-0001ccd0: 745b 6b65 7931 5d2e 696c 6f63 5b30 5d20  t[key1].iloc[0] 
-0001cce0: 3c20 7265 6365 6e74 5b6b 6579 315d 2e69  < recent[key1].i
-0001ccf0: 6c6f 635b 315d 290a 2020 2020 2020 2020  loc[1]).        
-0001cd00: 6973 3530 444d 4120 3d20 2872 6563 656e  is50DMA = (recen
-0001cd10: 745b 6b65 7931 5d2e 696c 6f63 5b30 5d20  t[key1].iloc[0] 
-0001cd20: 3c3d 2072 6563 656e 745b 2243 6c6f 7365  <= recent["Close
-0001cd30: 225d 2e69 6c6f 635b 305d 290a 2020 2020  "].iloc[0]).    
-0001cd40: 2020 2020 6973 3230 3044 4d41 203d 2028      is200DMA = (
-0001cd50: 7265 6365 6e74 5b6b 6579 325d 2e69 6c6f  recent[key2].ilo
-0001cd60: 635b 305d 203c 3d20 7265 6365 6e74 5b22  c[0] <= recent["
-0001cd70: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d29  Close"].iloc[0])
-0001cd80: 0a20 2020 2020 2020 2064 6966 6665 7265  .        differe
-0001cd90: 6e63 6520 3d20 726f 756e 6428 2872 6563  nce = round((rec
-0001cda0: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
-0001cdb0: 5d20 2d20 7265 6365 6e74 5b6b 6579 325d  ] - recent[key2]
-0001cdc0: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
-0001cdd0: 2020 2020 2020 2020 2020 2f20 7265 6365            / rece
-0001cde0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-0001cdf0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001ce00: 2020 2020 2a20 3130 302c 0a20 2020 2020      * 100,.     
-0001ce10: 2020 2020 2020 2020 2020 2032 2c0a 2020             2,.  
-0001ce20: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001ce30: 2020 2020 7361 7665 4469 6374 5b22 436f      saveDict["Co
-0001ce40: 6e66 444d 4144 6966 6665 7265 6e63 6522  nfDMADifference"
-0001ce50: 5d20 3d20 6469 6666 6572 656e 6365 0a20  ] = difference. 
-0001ce60: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-0001ce70: 745b 2243 6f6e 6644 4d41 4469 6666 6572  t["ConfDMADiffer
-0001ce80: 656e 6365 225d 203d 2064 6966 6665 7265  ence"] = differe
-0001ce90: 6e63 650a 2020 2020 2020 2020 7361 7665  nce.        save
-0001cea0: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-0001ceb0: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-0001cec0: 6372 6565 6e44 6963 742c 7361 7665 4469  creenDict,saveDi
-0001ced0: 6374 2c22 4d41 2d53 6967 6e61 6c22 290a  ct,"MA-Signal").
-0001cee0: 2020 2020 2020 2020 2320 6469 6666 6572          # differ
-0001cef0: 656e 6365 203d 2061 6273 2864 6966 6665  ence = abs(diffe
-0001cf00: 7265 6e63 6529 0a20 2020 2020 2020 2063  rence).        c
-0001cf10: 6f6e 6654 6578 7420 3d20 6622 7b67 6f6c  onfText = f"{gol
-0001cf20: 6465 6e78 4f76 6572 5465 7874 2069 6620  denxOverText if 
-0001cf30: 6973 476f 6c64 656e 4372 6f73 734f 7665  isGoldenCrossOve
-0001cf40: 7220 656c 7365 2028 6465 6164 784f 7665  r else (deadxOve
-0001cf50: 7254 6578 7420 6966 2069 7344 6561 6443  rText if isDeadC
-0001cf60: 726f 7373 4f76 6572 2065 6c73 6520 2827  rossOver else ('
-0001cf70: 436f 6e66 2e55 7027 2069 6620 6973 3530  Conf.Up' if is50
-0001cf80: 444d 4155 7054 7265 6e64 2065 6c73 6520  DMAUpTrend else 
-0001cf90: 2827 436f 6e66 2e44 6f77 6e27 2069 6620  ('Conf.Down' if 
-0001cfa0: 6973 3530 444d 4144 6f77 6e54 7265 6e64  is50DMADownTrend
-0001cfb0: 2065 6c73 6520 286b 6579 3320 6966 2069   else (key3 if i
-0001cfc0: 7335 3044 4d41 2065 6c73 6520 286b 6579  s50DMA else (key
-0001cfd0: 3420 6966 2069 7332 3030 444d 4120 656c  4 if is200DMA el
-0001cfe0: 7365 2027 556e 6b6e 6f77 6e27 2929 2929  se 'Unknown'))))
-0001cff0: 297d 220a 2020 2020 2020 2020 6966 2061  )}".        if a
-0001d000: 6273 2872 6563 656e 745b 6b65 7931 5d2e  bs(recent[key1].
-0001d010: 696c 6f63 5b30 5d20 2d20 7265 6365 6e74  iloc[0] - recent
-0001d020: 5b6b 6579 325d 2e69 6c6f 635b 305d 2920  [key2].iloc[0]) 
-0001d030: 3c3d 2028 0a20 2020 2020 2020 2020 2020  <= (.           
-0001d040: 2072 6563 656e 745b 6b65 7931 5d2e 696c   recent[key1].il
-0001d050: 6f63 5b30 5d20 2a20 7065 7263 656e 7461  oc[0] * percenta
-0001d060: 6765 0a20 2020 2020 2020 2029 3a0a 2020  ge.        ):.  
-0001d070: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-0001d080: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
-0001d090: 5d20 3e3d 2072 6563 656e 745b 6b65 7932  ] >= recent[key2
-0001d0a0: 5d2e 696c 6f63 5b30 5d3a 0a20 2020 2020  ].iloc[0]:.     
-0001d0b0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0001d0c0: 6e44 6963 745b 224d 412d 5369 676e 616c  nDict["MA-Signal
-0001d0d0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-0001d0e0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-0001d0f0: 5b30 5d20 0a20 2020 2020 2020 2020 2020  [0] .           
-0001d100: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0001d110: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
-0001d120: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001d130: 2863 6f6c 6f72 5465 7874 2e47 5245 454e  (colorText.GREEN
-0001d140: 2069 6620 6973 3530 444d 4155 7054 7265   if is50DMAUpTre
-0001d150: 6e64 2065 6c73 6520 2863 6f6c 6f72 5465  nd else (colorTe
-0001d160: 7874 2e46 4149 4c20 6966 2069 7335 3044  xt.FAIL if is50D
-0001d170: 4d41 446f 776e 5472 656e 6420 656c 7365  MADownTrend else
-0001d180: 2063 6f6c 6f72 5465 7874 2e57 4152 4e29   colorText.WARN)
-0001d190: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d1a0: 2020 2020 2020 2b20 6622 7b63 6f6e 6654        + f"{confT
-0001d1b0: 6578 747d 2028 7b64 6966 6665 7265 6e63  ext} ({differenc
-0001d1c0: 657d 2529 220a 2020 2020 2020 2020 2020  e}%)".          
-0001d1d0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001d1e0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0001d1f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001d200: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0001d210: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-0001d220: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-0001d230: 227b 636f 6e66 5465 7874 7d20 287b 6469  "{confText} ({di
-0001d240: 6666 6572 656e 6365 7d25 2922 0a20 2020  fference}%)".   
-0001d250: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001d260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d270: 6372 6565 6e44 6963 745b 224d 412d 5369  creenDict["MA-Si
-0001d280: 676e 616c 225d 203d 2028 0a20 2020 2020  gnal"] = (.     
-0001d290: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d2a0: 6176 6564 5b30 5d20 0a20 2020 2020 2020  aved[0] .       
-0001d2b0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0001d2c0: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
-0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2e0: 2020 2b20 2863 6f6c 6f72 5465 7874 2e47    + (colorText.G
-0001d2f0: 5245 454e 2069 6620 6973 3530 444d 4155  REEN if is50DMAU
-0001d300: 7054 7265 6e64 2065 6c73 6520 2863 6f6c  pTrend else (col
-0001d310: 6f72 5465 7874 2e46 4149 4c20 6966 2069  orText.FAIL if i
-0001d320: 7335 3044 4d41 446f 776e 5472 656e 6420  s50DMADownTrend 
-0001d330: 656c 7365 2063 6f6c 6f72 5465 7874 2e57  else colorText.W
-0001d340: 4152 4e29 290a 2020 2020 2020 2020 2020  ARN)).          
-0001d350: 2020 2020 2020 2020 2020 2b20 6622 7b63            + f"{c
-0001d360: 6f6e 6654 6578 747d 2028 7b64 6966 6665  onfText} ({diffe
-0001d370: 7265 6e63 657d 2529 220a 2020 2020 2020  rence}%)".      
-0001d380: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001d390: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-0001d3a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3c0: 7361 7665 4469 6374 5b22 4d41 2d53 6967  saveDict["MA-Sig
-0001d3d0: 6e61 6c22 5d20 3d20 7361 7665 645b 315d  nal"] = saved[1]
-0001d3e0: 202b 2066 227b 636f 6e66 5465 7874 7d20   + f"{confText} 
-0001d3f0: 287b 6469 6666 6572 656e 6365 7d25 2922  ({difference}%)"
-0001d400: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001d410: 7572 6e20 636f 6e66 4669 6c74 6572 203d  urn confFilter =
-0001d420: 3d20 3320 6f72 205c 0a20 2020 2020 2020  = 3 or \.       
-0001d430: 2020 2020 2020 2020 2028 636f 6e66 4669           (confFi
-0001d440: 6c74 6572 203d 3d20 3120 616e 6420 6e6f  lter == 1 and no
-0001d450: 7420 6973 4465 6164 4372 6f73 734f 7665  t isDeadCrossOve
-0001d460: 7220 616e 6420 2869 7335 3044 4d41 5570  r and (is50DMAUp
-0001d470: 5472 656e 6420 6f72 2028 6973 476f 6c64  Trend or (isGold
-0001d480: 656e 4372 6f73 734f 7665 7220 6f72 2027  enCrossOver or '
-0001d490: 5570 2720 696e 2063 6f6e 6654 6578 7429  Up' in confText)
-0001d4a0: 2929 206f 7220 5c0a 2020 2020 2020 2020  )) or \.        
-0001d4b0: 2020 2020 2020 2020 2863 6f6e 6646 696c          (confFil
-0001d4c0: 7465 7220 3d3d 2032 2061 6e64 206e 6f74  ter == 2 and not
-0001d4d0: 2069 7347 6f6c 6465 6e43 726f 7373 4f76   isGoldenCrossOv
-0001d4e0: 6572 2061 6e64 2028 6973 3530 444d 4144  er and (is50DMAD
-0001d4f0: 6f77 6e54 7265 6e64 206f 7220 6973 4465  ownTrend or isDe
-0001d500: 6164 4372 6f73 734f 7665 7220 6f72 2027  adCrossOver or '
-0001d510: 446f 776e 2720 696e 2063 6f6e 6654 6578  Down' in confTex
-0001d520: 7429 290a 2020 2020 2020 2020 2320 4d61  t)).        # Ma
-0001d530: 7962 6520 7468 6520 6469 6666 6572 656e  ybe the differen
-0001d540: 6365 2069 7320 6e6f 7420 7769 7468 696e  ce is not within
-0001d550: 2074 6865 2072 616e 6765 2c20 6275 7420   the range, but 
-0001d560: 7765 2764 2073 7469 6c6c 206c 696b 6520  we'd still like 
-0001d570: 746f 206b 6565 7020 7468 6520 7374 6f63  to keep the stoc
-0001d580: 6b20 696e 0a20 2020 2020 2020 2023 2074  k in.        # t
-0001d590: 6865 206c 6973 7420 6966 2069 7427 7320  he list if it's 
-0001d5a0: 6120 676f 6c64 656e 2063 726f 7373 6f76  a golden crossov
-0001d5b0: 6572 206f 7220 6465 6164 2063 726f 7373  er or dead cross
-0001d5c0: 6f76 6572 0a20 2020 2020 2020 2069 6620  over.        if 
-0001d5d0: 6973 476f 6c64 656e 4372 6f73 734f 7665  isGoldenCrossOve
-0001d5e0: 7220 6f72 2069 7344 6561 6443 726f 7373  r or isDeadCross
-0001d5f0: 4f76 6572 3a0a 2020 2020 2020 2020 2020  Over:.          
-0001d600: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
-0001d610: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
-0001d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d630: 2020 7361 7665 645b 305d 200a 2020 2020    saved[0] .    
-0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d650: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-0001d660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d670: 2020 2020 202b 2028 636f 6c6f 7254 6578       + (colorTex
-0001d680: 742e 4752 4545 4e20 6966 2069 7335 3044  t.GREEN if is50D
-0001d690: 4d41 5570 5472 656e 6420 656c 7365 2028  MAUpTrend else (
-0001d6a0: 636f 6c6f 7254 6578 742e 4641 494c 2069  colorText.FAIL i
-0001d6b0: 6620 6973 3530 444d 4144 6f77 6e54 7265  f is50DMADownTre
-0001d6c0: 6e64 2065 6c73 6520 636f 6c6f 7254 6578  nd else colorTex
-0001d6d0: 742e 5741 524e 2929 0a20 2020 2020 2020  t.WARN)).       
-0001d6e0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-0001d6f0: 227b 636f 6e66 5465 7874 7d20 287b 6469  "{confText} ({di
-0001d700: 6666 6572 656e 6365 7d25 2922 0a20 2020  fference}%)".   
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001d730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d740: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-0001d750: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
-0001d760: 616c 225d 203d 2073 6176 6564 5b31 5d20  al"] = saved[1] 
-0001d770: 2b20 6622 7b63 6f6e 6654 6578 747d 2028  + f"{confText} (
-0001d780: 7b64 6966 6665 7265 6e63 657d 2529 220a  {difference}%)".
-0001d790: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001d7a0: 726e 2063 6f6e 6646 696c 7465 7220 3d3d  rn confFilter ==
-0001d7b0: 2033 206f 7220 5c0a 2020 2020 2020 2020   3 or \.        
-0001d7c0: 2020 2020 2020 2020 2863 6f6e 6646 696c          (confFil
-0001d7d0: 7465 7220 3d3d 2031 2061 6e64 2069 7347  ter == 1 and isG
-0001d7e0: 6f6c 6465 6e43 726f 7373 4f76 6572 2920  oldenCrossOver) 
-0001d7f0: 6f72 205c 0a20 2020 2020 2020 2020 2020  or \.           
-0001d800: 2020 2020 2028 636f 6e66 4669 6c74 6572       (confFilter
-0001d810: 203d 3d20 3220 616e 6420 6973 4465 6164   == 2 and isDead
-0001d820: 4372 6f73 734f 7665 7229 0a20 2020 2020  CrossOver).     
-0001d830: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001d840: 0a20 2020 2023 406d 6561 7375 7265 5f74  .    #@measure_t
-0001d850: 696d 650a 2020 2020 2320 5661 6c69 6461  ime.    # Valida
-0001d860: 7465 2069 6620 7368 6172 6520 7072 6963  te if share pric
-0001d870: 6573 2061 7265 2063 6f6e 736f 6c69 6461  es are consolida
-0001d880: 7469 6e67 0a20 2020 2064 6566 2076 616c  ting.    def val
-0001d890: 6964 6174 6543 6f6e 736f 6c69 6461 7469  idateConsolidati
-0001d8a0: 6f6e 2873 656c 662c 2064 662c 2073 6372  on(self, df, scr
-0001d8b0: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-0001d8c0: 742c 2070 6572 6365 6e74 6167 653d 3130  t, percentage=10
-0001d8d0: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
-0001d8e0: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
-0001d8f0: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
-0001d900: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001d910: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
-0001d920: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
-0001d930: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0001d940: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
-0001d950: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
-0001d960: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
-0001d970: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
-0001d980: 2020 2020 6863 203d 2064 6174 612e 6465      hc = data.de
-0001d990: 7363 7269 6265 2829 5b22 436c 6f73 6522  scribe()["Close"
-0001d9a0: 5d5b 226d 6178 225d 0a20 2020 2020 2020  ]["max"].       
-0001d9b0: 206c 6320 3d20 6461 7461 2e64 6573 6372   lc = data.descr
-0001d9c0: 6962 6528 295b 2243 6c6f 7365 225d 5b22  ibe()["Close"]["
-0001d9d0: 6d69 6e22 5d0a 2020 2020 2020 2020 6966  min"].        if
-0001d9e0: 2028 6863 202d 206c 6329 203c 3d20 2868   (hc - lc) <= (h
-0001d9f0: 6320 2a20 7065 7263 656e 7461 6765 202f  c * percentage /
-0001da00: 2031 3030 2920 616e 6420 2868 6320 2d20   100) and (hc - 
-0001da10: 6c63 2021 3d20 3029 3a0a 2020 2020 2020  lc != 0):.      
-0001da20: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-0001da30: 5b22 436f 6e73 6f6c 2e22 5d20 3d20 280a  ["Consol."] = (.
-0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da50: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0001da60: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001da70: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-0001da80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001da90: 202b 2022 5261 6e67 653a 220a 2020 2020   + "Range:".    
-0001daa0: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
-0001dab0: 7228 726f 756e 6428 2861 6273 2828 6863  r(round((abs((hc
-0001dac0: 202d 206c 6329 202f 2068 6329 202a 2031   - lc) / hc) * 1
-0001dad0: 3030 292c 2031 2929 0a20 2020 2020 2020  00), 1)).       
-0001dae0: 2020 2020 2020 2020 202b 2022 2522 0a20           + "%". 
-0001daf0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001db00: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0001db10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001db20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001db30: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-0001db40: 745b 2243 6f6e 736f 6c2e 225d 203d 2028  t["Consol."] = (
-0001db50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001db60: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db80: 2b20 636f 6c6f 7254 6578 742e 4641 494c  + colorText.FAIL
-0001db90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dba0: 202b 2022 5261 6e67 653a 220a 2020 2020   + "Range:".    
-0001dbb0: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
-0001dbc0: 7228 726f 756e 6428 2861 6273 2828 6863  r(round((abs((hc
-0001dbd0: 202d 206c 6329 202f 2068 6329 202a 2031   - lc) / hc) * 1
-0001dbe0: 3030 292c 2031 2929 0a20 2020 2020 2020  00), 1)).       
-0001dbf0: 2020 2020 2020 2020 202b 2022 2522 0a20           + "%". 
-0001dc00: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001dc10: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0001dc20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001dc30: 2020 2020 2073 6176 6544 6963 745b 2243       saveDict["C
-0001dc40: 6f6e 736f 6c2e 225d 203d 2066 2752 616e  onsol."] = f'Ran
-0001dc50: 6765 3a7b 7374 7228 726f 756e 6428 2861  ge:{str(round((a
-0001dc60: 6273 2828 6863 2d6c 6329 2f68 6329 2a31  bs((hc-lc)/hc)*1
-0001dc70: 3030 292c 3129 292b 2225 227d 270a 2020  00),1))+"%"}'.  
-0001dc80: 2020 2020 2020 7265 7475 726e 2072 6f75        return rou
-0001dc90: 6e64 2828 6162 7328 2868 6320 2d20 6c63  nd((abs((hc - lc
-0001dca0: 2920 2f20 6863 2920 2a20 3130 3029 2c20  ) / hc) * 100), 
-0001dcb0: 3129 0a0a 2020 2020 2320 7661 6c69 6461  1)..    # valida
-0001dcc0: 7465 2069 6620 7468 6520 7374 6f63 6b20  te if the stock 
-0001dcd0: 6861 7320 6265 656e 2068 6176 696e 6720  has been having 
-0001dce0: 6869 6768 6572 2068 6967 6873 2c20 6869  higher highs, hi
-0001dcf0: 6768 6572 206c 6f77 730a 2020 2020 2320  gher lows.    # 
-0001dd00: 616e 6420 6869 6768 6572 2063 6c6f 7365  and higher close
-0001dd10: 2077 6974 6820 6c61 7465 7374 2063 6c6f   with latest clo
-0001dd20: 7365 203e 2073 7570 6572 7472 656e 6420  se > supertrend 
-0001dd30: 616e 6420 382d 454d 412e 0a20 2020 2064  and 8-EMA..    d
-0001dd40: 6566 2076 616c 6964 6174 6548 6967 6865  ef validateHighe
-0001dd50: 7248 6967 6873 4869 6768 6572 4c6f 7773  rHighsHigherLows
-0001dd60: 4869 6768 6572 436c 6f73 6528 7365 6c66  HigherClose(self
-0001dd70: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
-0001dd80: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-0001dd90: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-0001dda0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001ddb0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-0001ddc0: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-0001ddd0: 2020 2020 2020 2020 6461 7930 203d 2064          day0 = d
-0001dde0: 6174 610a 2020 2020 2020 2020 6461 7931  ata.        day1
-0001ddf0: 203d 2064 6174 615b 313a 5d0a 2020 2020   = data[1:].    
-0001de00: 2020 2020 6461 7932 203d 2064 6174 615b      day2 = data[
-0001de10: 323a 5d0a 2020 2020 2020 2020 6461 7933  2:].        day3
-0001de20: 203d 2064 6174 615b 333a 5d0a 2020 2020   = data[3:].    
-0001de30: 2020 2020 6966 206c 656e 2864 6179 3129      if len(day1)
-0001de40: 203c 2031 206f 7220 6c65 6e28 6461 7932   < 1 or len(day2
-0001de50: 2920 3c20 3120 6f72 206c 656e 2864 6179  ) < 1 or len(day
-0001de60: 3329 203c 2031 3a0a 2020 2020 2020 2020  3) < 1:.        
-0001de70: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001de80: 0a20 2020 2020 2020 2068 6967 6865 7248  .        higherH
-0001de90: 6967 6873 203d 2028 0a20 2020 2020 2020  ighs = (.       
-0001dea0: 2020 2020 2028 6461 7930 5b22 4869 6768       (day0["High
-0001deb0: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001dec0: 315b 2248 6967 6822 5d2e 696c 6f63 5b30  1["High"].iloc[0
-0001ded0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-0001dee0: 6e64 2028 6461 7931 5b22 4869 6768 225d  nd (day1["High"]
-0001def0: 2e69 6c6f 635b 305d 203e 2064 6179 325b  .iloc[0] > day2[
-0001df00: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
-0001df10: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001df20: 2028 6461 7932 5b22 4869 6768 225d 2e69   (day2["High"].i
-0001df30: 6c6f 635b 305d 203e 2064 6179 335b 2248  loc[0] > day3["H
-0001df40: 6967 6822 5d2e 696c 6f63 5b30 5d29 0a20  igh"].iloc[0]). 
-0001df50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001df60: 2068 6967 6865 724c 6f77 7320 3d20 280a   higherLows = (.
-0001df70: 2020 2020 2020 2020 2020 2020 2864 6179              (day
-0001df80: 305b 224c 6f77 225d 2e69 6c6f 635b 305d  0["Low"].iloc[0]
-0001df90: 203e 2064 6179 315b 224c 6f77 225d 2e69   > day1["Low"].i
-0001dfa0: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
-0001dfb0: 2020 2020 616e 6420 2864 6179 315b 224c      and (day1["L
-0001dfc0: 6f77 225d 2e69 6c6f 635b 305d 203e 2064  ow"].iloc[0] > d
-0001dfd0: 6179 325b 224c 6f77 225d 2e69 6c6f 635b  ay2["Low"].iloc[
-0001dfe0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-0001dff0: 616e 6420 2864 6179 325b 224c 6f77 225d  and (day2["Low"]
-0001e000: 2e69 6c6f 635b 305d 203e 2064 6179 335b  .iloc[0] > day3[
-0001e010: 224c 6f77 225d 2e69 6c6f 635b 305d 290a  "Low"].iloc[0]).
-0001e020: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001e030: 2020 6869 6768 6572 436c 6f73 6520 3d20    higherClose = 
-0001e040: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
-0001e050: 6179 305b 2243 6c6f 7365 225d 2e69 6c6f  ay0["Close"].ilo
-0001e060: 635b 305d 203e 2064 6179 315b 2243 6c6f  c[0] > day1["Clo
-0001e070: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
-0001e080: 2020 2020 2020 2020 2020 616e 6420 2864            and (d
-0001e090: 6179 315b 2243 6c6f 7365 225d 2e69 6c6f  ay1["Close"].ilo
-0001e0a0: 635b 305d 203e 2064 6179 325b 2243 6c6f  c[0] > day2["Clo
-0001e0b0: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
-0001e0c0: 2020 2020 2020 2020 2020 616e 6420 2864            and (d
-0001e0d0: 6179 325b 2243 6c6f 7365 225d 2e69 6c6f  ay2["Close"].ilo
-0001e0e0: 635b 305d 203e 2064 6179 335b 2243 6c6f  c[0] > day3["Clo
-0001e0f0: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
-0001e100: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001e110: 2320 6869 6768 6572 5253 4920 3d20 2864  # higherRSI = (d
-0001e120: 6179 305b 2252 5349 225d 2e69 6c6f 635b  ay0["RSI"].iloc[
-0001e130: 305d 203e 2064 6179 315b 2252 5349 225d  0] > day1["RSI"]
-0001e140: 2e69 6c6f 635b 305d 2920 616e 6420 5c0a  .iloc[0]) and \.
-0001e150: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0001e160: 2020 2020 2020 2020 2020 2864 6179 315b            (day1[
-0001e170: 2252 5349 225d 2e69 6c6f 635b 305d 203e  "RSI"].iloc[0] >
-0001e180: 2064 6179 325b 2252 5349 225d 2e69 6c6f   day2["RSI"].ilo
-0001e190: 635b 305d 2920 616e 6420 5c0a 2020 2020  c[0]) and \.    
-0001e1a0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001e1b0: 2020 2020 2020 2864 6179 325b 2252 5349        (day2["RSI
-0001e1c0: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001e1d0: 335b 2252 5349 225d 2e69 6c6f 635b 305d  3["RSI"].iloc[0]
-0001e1e0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
-0001e1f0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001e200: 2020 6461 7933 5b22 5253 4922 5d2e 696c    day3["RSI"].il
-0001e210: 6f63 5b30 5d20 3e3d 2035 3020 616e 6420  oc[0] >= 50 and 
-0001e220: 6461 7930 5b22 5253 4922 5d2e 696c 6f63  day0["RSI"].iloc
-0001e230: 5b30 5d20 3e3d 2036 350a 2020 2020 2020  [0] >= 65.      
-0001e240: 2020 7265 7665 7273 6564 4461 7461 203d    reversedData =
-0001e250: 2064 6174 615b 3a3a 2d31 5d2e 636f 7079   data[::-1].copy
-0001e260: 2829 0a20 2020 2020 2020 2072 6576 6572  ().        rever
-0001e270: 7365 6444 6174 615b 2253 5550 4552 5422  sedData["SUPERT"
-0001e280: 5d20 3d20 706b 7461 6c69 622e 7375 7065  ] = pktalib.supe
-0001e290: 7274 7265 6e64 2872 6576 6572 7365 6444  rtrend(reversedD
-0001e2a0: 6174 612c 2037 2c20 3329 5b22 5355 5045  ata, 7, 3)["SUPE
-0001e2b0: 5254 5f37 5f33 2e30 225d 0a20 2020 2020  RT_7_3.0"].     
-0001e2c0: 2020 2072 6576 6572 7365 6444 6174 615b     reversedData[
-0001e2d0: 2245 4d41 3822 5d20 3d20 706b 7461 6c69  "EMA8"] = pktali
-0001e2e0: 622e 454d 4128 7265 7665 7273 6564 4461  b.EMA(reversedDa
-0001e2f0: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
-0001e300: 6570 6572 696f 643d 3929 0a20 2020 2020  eperiod=9).     
-0001e310: 2020 2068 6967 6865 7243 6c6f 7365 203d     higherClose =
-0001e320: 2028 0a20 2020 2020 2020 2020 2020 2068   (.            h
-0001e330: 6967 6865 7243 6c6f 7365 0a20 2020 2020  igherClose.     
-0001e340: 2020 2020 2020 2061 6e64 2064 6179 305b         and day0[
-0001e350: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-0001e360: 203e 2072 6576 6572 7365 6444 6174 612e   > reversedData.
-0001e370: 7461 696c 2831 295b 2253 5550 4552 5422  tail(1)["SUPERT"
-0001e380: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
-0001e390: 2020 2020 2020 616e 6420 6461 7930 5b22        and day0["
-0001e3a0: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
-0001e3b0: 3e20 7265 7665 7273 6564 4461 7461 2e74  > reversedData.t
-0001e3c0: 6169 6c28 3129 5b22 454d 4138 225d 2e69  ail(1)["EMA8"].i
-0001e3d0: 6c6f 635b 305d 0a20 2020 2020 2020 2029  loc[0].        )
-0001e3e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001e3f0: 6869 6768 6572 4869 6768 7320 616e 6420  higherHighs and 
-0001e400: 6869 6768 6572 4c6f 7773 2061 6e64 2068  higherLows and h
-0001e410: 6967 6865 7243 6c6f 7365 0a0a 2020 2020  igherClose..    
-0001e420: 2340 6d65 6173 7572 655f 7469 6d65 0a20  #@measure_time. 
-0001e430: 2020 2023 2056 616c 6964 6174 6520 2749     # Validate 'I
-0001e440: 6e73 6964 6520 4261 7227 2073 7472 7563  nside Bar' struc
-0001e450: 7475 7265 2066 6f72 2072 6563 656e 7420  ture for recent 
-0001e460: 6461 7973 0a20 2020 2064 6566 2076 616c  days.    def val
-0001e470: 6964 6174 6549 6e73 6964 6542 6172 280a  idateInsideBar(.
-0001e480: 2020 2020 2020 2020 7365 6c66 2c20 6466          self, df
-0001e490: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
-0001e4a0: 7665 4469 6374 2c20 6368 6172 7450 6174  veDict, chartPat
-0001e4b0: 7465 726e 3d31 2c20 6461 7973 546f 4c6f  tern=1, daysToLo
-0001e4c0: 6f6b 6261 636b 3d35 0a20 2020 2029 3a0a  okback=5.    ):.
-0001e4d0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0001e4e0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0001e4f0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0001e500: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001e510: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0001e520: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0001e530: 206f 7267 4461 7461 203d 2064 6174 610a   orgData = data.
-0001e540: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
-0001e550: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
-0001e560: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
-0001e570: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
-0001e580: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
-0001e590: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0001e5a0: 6765 2869 6e74 2864 6179 7354 6f4c 6f6f  ge(int(daysToLoo
-0001e5b0: 6b62 6163 6b29 2c20 696e 7428 726f 756e  kback), int(roun
-0001e5c0: 6428 6461 7973 546f 4c6f 6f6b 6261 636b  d(daysToLookback
-0001e5d0: 202a 2030 2e35 2929 202d 2031 2c20 2d31   * 0.5)) - 1, -1
-0001e5e0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001e5f0: 6620 6920 3d3d 2032 3a0a 2020 2020 2020  f i == 2:.      
-0001e600: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001e610: 2030 2020 2320 4578 6974 2069 6620 6f6e   0  # Exit if on
-0001e620: 6c79 206c 6173 7420 3220 6361 6e64 6c65  ly last 2 candle
-0001e630: 7320 6172 6520 6c65 6674 0a20 2020 2020  s are left.     
-0001e640: 2020 2020 2020 2069 6620 6368 6172 7450         if chartP
-0001e650: 6174 7465 726e 203d 3d20 313a 0a20 2020  attern == 1:.   
-0001e660: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001e670: 2255 7022 2069 6e20 7361 7665 4469 6374  "Up" in saveDict
-0001e680: 5b22 5472 656e 6422 5d20 616e 6420 280a  ["Trend"] and (.
-0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6a0: 2020 2020 2242 756c 6c22 2069 6e20 7361      "Bull" in sa
-0001e6b0: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
-0001e6c0: 6c22 5d0a 2020 2020 2020 2020 2020 2020  l"].            
-0001e6d0: 2020 2020 2020 2020 6f72 2022 5375 7070          or "Supp
-0001e6e0: 6f72 7422 2069 6e20 7361 7665 4469 6374  ort" in saveDict
-0001e6f0: 5b22 4d41 2d53 6967 6e61 6c22 5d0a 2020  ["MA-Signal"].  
-0001e700: 2020 2020 2020 2020 2020 2020 2020 293a                ):
-0001e710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e720: 2020 2020 2064 6174 6120 3d20 6f72 6744       data = orgD
-0001e730: 6174 612e 6865 6164 2869 290a 2020 2020  ata.head(i).    
-0001e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e750: 7265 6643 616e 646c 6520 3d20 6461 7461  refCandle = data
-0001e760: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
-0001e770: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001e780: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001e790: 2020 2020 2020 2020 2020 286c 656e 2864            (len(d
-0001e7a0: 6174 612e 4869 6768 5b64 6174 612e 4869  ata.High[data.Hi
-0001e7b0: 6768 203e 2072 6566 4361 6e64 6c65 2e48  gh > refCandle.H
-0001e7c0: 6967 682e 6974 656d 2829 5d29 203d 3d20  igh.item()]) == 
-0001e7d0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001e7e0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001e7f0: 6c65 6e28 6461 7461 2e4c 6f77 5b64 6174  len(data.Low[dat
-0001e800: 612e 4c6f 7720 3c20 7265 6643 616e 646c  a.Low < refCandl
-0001e810: 652e 4c6f 772e 6974 656d 2829 5d29 203d  e.Low.item()]) =
-0001e820: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
-0001e830: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0001e840: 2028 6c65 6e28 6461 7461 2e4f 7065 6e5b   (len(data.Open[
-0001e850: 6461 7461 2e4f 7065 6e20 3e20 7265 6643  data.Open > refC
-0001e860: 616e 646c 652e 4869 6768 2e69 7465 6d28  andle.High.item(
-0001e870: 295d 2920 3d3d 2030 290a 2020 2020 2020  )]) == 0).      
-0001e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e890: 2020 616e 6420 286c 656e 2864 6174 612e    and (len(data.
-0001e8a0: 436c 6f73 655b 6461 7461 2e43 6c6f 7365  Close[data.Close
-0001e8b0: 203c 2072 6566 4361 6e64 6c65 2e4c 6f77   < refCandle.Low
-0001e8c0: 2e69 7465 6d28 295d 2920 3d3d 2030 290a  .item()]) == 0).
-0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8e0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0001e8f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001e900: 6372 6565 6e44 6963 745b 2250 6174 7465  creenDict["Patte
-0001e910: 726e 225d 203d 2028 0a20 2020 2020 2020  rn"] = (.       
-0001e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e930: 2020 2020 2073 6176 6564 5b30 5d0a 2020       saved[0].  
-0001e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e950: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001e960: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+0001cbb0: 4d41 446f 776e 2065 6c73 6520 2222 297d  MADown else "")}
+0001cbc0: 270a 2020 2020 2020 2020 676f 6c64 656e  '.        golden
+0001cbd0: 784f 7665 7254 6578 7420 3d20 6627 476f  xOverText = f'Go
+0001cbe0: 6c64 656e 4372 6f73 736f 7665 727b 2228  ldenCrossover{"(
+0001cbf0: 3230 2922 2069 6620 6973 3230 444d 4143  20)" if is20DMAC
+0001cc00: 726f 7373 6f76 6572 3530 444d 4120 656c  rossover50DMA el
+0001cc10: 7365 2028 2228 3530 2922 2069 6620 6973  se ("(50)" if is
+0001cc20: 3530 444d 4143 726f 7373 6f76 6572 3230  50DMACrossover20
+0001cc30: 3044 4d41 2065 6c73 6520 2222 297d 270a  0DMA else "")}'.
+0001cc40: 2020 2020 2020 2020 6966 2069 7332 3044          if is20D
+0001cc50: 4d41 4372 6f73 736f 7665 7235 3044 4d41  MACrossover50DMA
+0001cc60: 206f 7220 6973 3230 444d 4143 726f 7373   or is20DMACross
+0001cc70: 6f76 6572 3530 444d 4144 6f77 6e3a 0a20  over50DMADown:. 
+0001cc80: 2020 2020 2020 2020 2020 206b 6579 3120             key1 
+0001cc90: 3d20 2253 534d 4132 3022 0a20 2020 2020  = "SSMA20".     
+0001cca0: 2020 2020 2020 206b 6579 3220 3d20 2253         key2 = "S
+0001ccb0: 4d41 220a 2020 2020 2020 2020 2020 2020  MA".            
+0001ccc0: 6b65 7933 203d 2022 3230 444d 4122 0a20  key3 = "20DMA". 
+0001ccd0: 2020 2020 2020 2020 2020 206b 6579 3420             key4 
+0001cce0: 3d20 2235 3044 4d41 220a 2020 2020 2020  = "50DMA".      
+0001ccf0: 2020 6973 3530 444d 4155 7054 7265 6e64    is50DMAUpTrend
+0001cd00: 203d 2028 7265 6365 6e74 5b6b 6579 315d   = (recent[key1]
+0001cd10: 2e69 6c6f 635b 305d 203e 2072 6563 656e  .iloc[0] > recen
+0001cd20: 745b 6b65 7932 5d2e 696c 6f63 5b31 5d29  t[key2].iloc[1])
+0001cd30: 0a20 2020 2020 2020 2069 7335 3044 4d41  .        is50DMA
+0001cd40: 446f 776e 5472 656e 6420 3d20 2872 6563  DownTrend = (rec
+0001cd50: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
+0001cd60: 5d20 3c20 7265 6365 6e74 5b6b 6579 315d  ] < recent[key1]
+0001cd70: 2e69 6c6f 635b 315d 290a 2020 2020 2020  .iloc[1]).      
+0001cd80: 2020 6973 3530 444d 4120 3d20 2872 6563    is50DMA = (rec
+0001cd90: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
+0001cda0: 5d20 3c3d 2072 6563 656e 745b 2243 6c6f  ] <= recent["Clo
+0001cdb0: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
+0001cdc0: 2020 2020 2020 6973 3230 3044 4d41 203d        is200DMA =
+0001cdd0: 2028 7265 6365 6e74 5b6b 6579 325d 2e69   (recent[key2].i
+0001cde0: 6c6f 635b 305d 203c 3d20 7265 6365 6e74  loc[0] <= recent
+0001cdf0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0001ce00: 5d29 0a20 2020 2020 2020 2064 6966 6665  ]).        diffe
+0001ce10: 7265 6e63 6520 3d20 726f 756e 6428 2872  rence = round((r
+0001ce20: 6563 656e 745b 6b65 7931 5d2e 696c 6f63  ecent[key1].iloc
+0001ce30: 5b30 5d20 2d20 7265 6365 6e74 5b6b 6579  [0] - recent[key
+0001ce40: 325d 2e69 6c6f 635b 305d 290a 2020 2020  2].iloc[0]).    
+0001ce50: 2020 2020 2020 2020 2020 2020 2f20 7265              / re
+0001ce60: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+0001ce70: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
+0001ce80: 2020 2020 2020 2a20 3130 302c 0a20 2020        * 100,.   
+0001ce90: 2020 2020 2020 2020 2020 2020 2032 2c0a               2,.
+0001cea0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001ceb0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+0001cec0: 436f 6e66 444d 4144 6966 6665 7265 6e63  ConfDMADifferenc
+0001ced0: 6522 5d20 3d20 6469 6666 6572 656e 6365  e"] = difference
+0001cee0: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
+0001cef0: 6963 745b 2243 6f6e 6644 4d41 4469 6666  ict["ConfDMADiff
+0001cf00: 6572 656e 6365 225d 203d 2064 6966 6665  erence"] = diffe
+0001cf10: 7265 6e63 650a 2020 2020 2020 2020 7361  rence.        sa
+0001cf20: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+0001cf30: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+0001cf40: 2873 6372 6565 6e44 6963 742c 7361 7665  (screenDict,save
+0001cf50: 4469 6374 2c22 4d41 2d53 6967 6e61 6c22  Dict,"MA-Signal"
+0001cf60: 290a 2020 2020 2020 2020 2320 6469 6666  ).        # diff
+0001cf70: 6572 656e 6365 203d 2061 6273 2864 6966  erence = abs(dif
+0001cf80: 6665 7265 6e63 6529 0a20 2020 2020 2020  ference).       
+0001cf90: 2063 6f6e 6654 6578 7420 3d20 6622 7b67   confText = f"{g
+0001cfa0: 6f6c 6465 6e78 4f76 6572 5465 7874 2069  oldenxOverText i
+0001cfb0: 6620 6973 476f 6c64 656e 4372 6f73 734f  f isGoldenCrossO
+0001cfc0: 7665 7220 656c 7365 2028 6465 6164 784f  ver else (deadxO
+0001cfd0: 7665 7254 6578 7420 6966 2069 7344 6561  verText if isDea
+0001cfe0: 6443 726f 7373 4f76 6572 2065 6c73 6520  dCrossOver else 
+0001cff0: 2827 436f 6e66 2e55 7027 2069 6620 6973  ('Conf.Up' if is
+0001d000: 3530 444d 4155 7054 7265 6e64 2065 6c73  50DMAUpTrend els
+0001d010: 6520 2827 436f 6e66 2e44 6f77 6e27 2069  e ('Conf.Down' i
+0001d020: 6620 6973 3530 444d 4144 6f77 6e54 7265  f is50DMADownTre
+0001d030: 6e64 2065 6c73 6520 286b 6579 3320 6966  nd else (key3 if
+0001d040: 2069 7335 3044 4d41 2065 6c73 6520 286b   is50DMA else (k
+0001d050: 6579 3420 6966 2069 7332 3030 444d 4120  ey4 if is200DMA 
+0001d060: 656c 7365 2027 556e 6b6e 6f77 6e27 2929  else 'Unknown'))
+0001d070: 2929 297d 220a 2020 2020 2020 2020 6966  )))}".        if
+0001d080: 2061 6273 2872 6563 656e 745b 6b65 7931   abs(recent[key1
+0001d090: 5d2e 696c 6f63 5b30 5d20 2d20 7265 6365  ].iloc[0] - rece
+0001d0a0: 6e74 5b6b 6579 325d 2e69 6c6f 635b 305d  nt[key2].iloc[0]
+0001d0b0: 2920 3c3d 2028 0a20 2020 2020 2020 2020  ) <= (.         
+0001d0c0: 2020 2072 6563 656e 745b 6b65 7931 5d2e     recent[key1].
+0001d0d0: 696c 6f63 5b30 5d20 2a20 7065 7263 656e  iloc[0] * percen
+0001d0e0: 7461 6765 0a20 2020 2020 2020 2029 3a0a  tage.        ):.
+0001d0f0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0001d100: 6563 656e 745b 6b65 7931 5d2e 696c 6f63  ecent[key1].iloc
+0001d110: 5b30 5d20 3e3d 2072 6563 656e 745b 6b65  [0] >= recent[ke
+0001d120: 7932 5d2e 696c 6f63 5b30 5d3a 0a20 2020  y2].iloc[0]:.   
+0001d130: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0001d140: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
+0001d150: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
+0001d160: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+0001d170: 6564 5b30 5d20 0a20 2020 2020 2020 2020  ed[0] .         
+0001d180: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0001d190: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
+0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1b0: 2b20 2863 6f6c 6f72 5465 7874 2e47 5245  + (colorText.GRE
+0001d1c0: 454e 2069 6620 6973 3530 444d 4155 7054  EN if is50DMAUpT
+0001d1d0: 7265 6e64 2065 6c73 6520 2863 6f6c 6f72  rend else (color
+0001d1e0: 5465 7874 2e46 4149 4c20 6966 2069 7335  Text.FAIL if is5
+0001d1f0: 3044 4d41 446f 776e 5472 656e 6420 656c  0DMADownTrend el
+0001d200: 7365 2063 6f6c 6f72 5465 7874 2e57 4152  se colorText.WAR
+0001d210: 4e29 290a 2020 2020 2020 2020 2020 2020  N)).            
+0001d220: 2020 2020 2020 2020 2b20 6622 7b63 6f6e          + f"{con
+0001d230: 6654 6578 747d 2028 7b64 6966 6665 7265  fText} ({differe
+0001d240: 6e63 657d 2529 220a 2020 2020 2020 2020  nce}%)".        
+0001d250: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001d260: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+0001d270: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001d280: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0001d290: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+0001d2a0: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
+0001d2b0: 2066 227b 636f 6e66 5465 7874 7d20 287b   f"{confText} ({
+0001d2c0: 6469 6666 6572 656e 6365 7d25 2922 0a20  difference}%)". 
+0001d2d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001d2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d2f0: 2073 6372 6565 6e44 6963 745b 224d 412d   screenDict["MA-
+0001d300: 5369 676e 616c 225d 203d 2028 0a20 2020  Signal"] = (.   
+0001d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d320: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
+0001d330: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001d340: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+0001d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d360: 2020 2020 2b20 2863 6f6c 6f72 5465 7874      + (colorText
+0001d370: 2e47 5245 454e 2069 6620 6973 3530 444d  .GREEN if is50DM
+0001d380: 4155 7054 7265 6e64 2065 6c73 6520 2863  AUpTrend else (c
+0001d390: 6f6c 6f72 5465 7874 2e46 4149 4c20 6966  olorText.FAIL if
+0001d3a0: 2069 7335 3044 4d41 446f 776e 5472 656e   is50DMADownTren
+0001d3b0: 6420 656c 7365 2063 6f6c 6f72 5465 7874  d else colorText
+0001d3c0: 2e57 4152 4e29 290a 2020 2020 2020 2020  .WARN)).        
+0001d3d0: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+0001d3e0: 7b63 6f6e 6654 6578 747d 2028 7b64 6966  {confText} ({dif
+0001d3f0: 6665 7265 6e63 657d 2529 220a 2020 2020  ference}%)".    
+0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d410: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+0001d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d430: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d440: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
+0001d450: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
+0001d460: 315d 202b 2066 227b 636f 6e66 5465 7874  1] + f"{confText
+0001d470: 7d20 287b 6469 6666 6572 656e 6365 7d25  } ({difference}%
+0001d480: 2922 0a20 2020 2020 2020 2020 2020 2072  )".            r
+0001d490: 6574 7572 6e20 636f 6e66 4669 6c74 6572  eturn confFilter
+0001d4a0: 203d 3d20 3320 6f72 205c 0a20 2020 2020   == 3 or \.     
+0001d4b0: 2020 2020 2020 2020 2020 2028 636f 6e66             (conf
+0001d4c0: 4669 6c74 6572 203d 3d20 3120 616e 6420  Filter == 1 and 
+0001d4d0: 6e6f 7420 6973 4465 6164 4372 6f73 734f  not isDeadCrossO
+0001d4e0: 7665 7220 616e 6420 2869 7335 3044 4d41  ver and (is50DMA
+0001d4f0: 5570 5472 656e 6420 6f72 2028 6973 476f  UpTrend or (isGo
+0001d500: 6c64 656e 4372 6f73 734f 7665 7220 6f72  ldenCrossOver or
+0001d510: 2027 5570 2720 696e 2063 6f6e 6654 6578   'Up' in confTex
+0001d520: 7429 2929 206f 7220 5c0a 2020 2020 2020  t))) or \.      
+0001d530: 2020 2020 2020 2020 2020 2863 6f6e 6646            (confF
+0001d540: 696c 7465 7220 3d3d 2032 2061 6e64 206e  ilter == 2 and n
+0001d550: 6f74 2069 7347 6f6c 6465 6e43 726f 7373  ot isGoldenCross
+0001d560: 4f76 6572 2061 6e64 2028 6973 3530 444d  Over and (is50DM
+0001d570: 4144 6f77 6e54 7265 6e64 206f 7220 6973  ADownTrend or is
+0001d580: 4465 6164 4372 6f73 734f 7665 7220 6f72  DeadCrossOver or
+0001d590: 2027 446f 776e 2720 696e 2063 6f6e 6654   'Down' in confT
+0001d5a0: 6578 7429 290a 2020 2020 2020 2020 2320  ext)).        # 
+0001d5b0: 4d61 7962 6520 7468 6520 6469 6666 6572  Maybe the differ
+0001d5c0: 656e 6365 2069 7320 6e6f 7420 7769 7468  ence is not with
+0001d5d0: 696e 2074 6865 2072 616e 6765 2c20 6275  in the range, bu
+0001d5e0: 7420 7765 2764 2073 7469 6c6c 206c 696b  t we'd still lik
+0001d5f0: 6520 746f 206b 6565 7020 7468 6520 7374  e to keep the st
+0001d600: 6f63 6b20 696e 0a20 2020 2020 2020 2023  ock in.        #
+0001d610: 2074 6865 206c 6973 7420 6966 2069 7427   the list if it'
+0001d620: 7320 6120 676f 6c64 656e 2063 726f 7373  s a golden cross
+0001d630: 6f76 6572 206f 7220 6465 6164 2063 726f  over or dead cro
+0001d640: 7373 6f76 6572 0a20 2020 2020 2020 2069  ssover.        i
+0001d650: 6620 6973 476f 6c64 656e 4372 6f73 734f  f isGoldenCrossO
+0001d660: 7665 7220 6f72 2069 7344 6561 6443 726f  ver or isDeadCro
+0001d670: 7373 4f76 6572 3a0a 2020 2020 2020 2020  ssOver:.        
+0001d680: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+0001d690: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
+0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6b0: 2020 2020 7361 7665 645b 305d 200a 2020      saved[0] .  
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6d0: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+0001d6e0: 4c44 0a20 2020 2020 2020 2020 2020 2020  LD.             
+0001d6f0: 2020 2020 2020 202b 2028 636f 6c6f 7254         + (colorT
+0001d700: 6578 742e 4752 4545 4e20 6966 2069 7335  ext.GREEN if is5
+0001d710: 3044 4d41 5570 5472 656e 6420 656c 7365  0DMAUpTrend else
+0001d720: 2028 636f 6c6f 7254 6578 742e 4641 494c   (colorText.FAIL
+0001d730: 2069 6620 6973 3530 444d 4144 6f77 6e54   if is50DMADownT
+0001d740: 7265 6e64 2065 6c73 6520 636f 6c6f 7254  rend else colorT
+0001d750: 6578 742e 5741 524e 2929 0a20 2020 2020  ext.WARN)).     
+0001d760: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001d770: 2066 227b 636f 6e66 5465 7874 7d20 287b   f"{confText} ({
+0001d780: 6469 6666 6572 656e 6365 7d25 2922 0a20  difference}%)". 
+0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7a0: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
+0001d7b0: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001d7c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001d7d0: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
+0001d7e0: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
+0001d7f0: 5d20 2b20 6622 7b63 6f6e 6654 6578 747d  ] + f"{confText}
+0001d800: 2028 7b64 6966 6665 7265 6e63 657d 2529   ({difference}%)
+0001d810: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+0001d820: 7475 726e 2063 6f6e 6646 696c 7465 7220  turn confFilter 
+0001d830: 3d3d 2033 206f 7220 5c0a 2020 2020 2020  == 3 or \.      
+0001d840: 2020 2020 2020 2020 2020 2863 6f6e 6646            (confF
+0001d850: 696c 7465 7220 3d3d 2031 2061 6e64 2069  ilter == 1 and i
+0001d860: 7347 6f6c 6465 6e43 726f 7373 4f76 6572  sGoldenCrossOver
+0001d870: 2920 6f72 205c 0a20 2020 2020 2020 2020  ) or \.         
+0001d880: 2020 2020 2020 2028 636f 6e66 4669 6c74         (confFilt
+0001d890: 6572 203d 3d20 3220 616e 6420 6973 4465  er == 2 and isDe
+0001d8a0: 6164 4372 6f73 734f 7665 7229 0a20 2020  adCrossOver).   
+0001d8b0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001d8c0: 650a 0a20 2020 2023 406d 6561 7375 7265  e..    #@measure
+0001d8d0: 5f74 696d 650a 2020 2020 2320 5661 6c69  _time.    # Vali
+0001d8e0: 6461 7465 2069 6620 7368 6172 6520 7072  date if share pr
+0001d8f0: 6963 6573 2061 7265 2063 6f6e 736f 6c69  ices are consoli
+0001d900: 6461 7469 6e67 0a20 2020 2064 6566 2076  dating.    def v
+0001d910: 616c 6964 6174 6543 6f6e 736f 6c69 6461  alidateConsolida
+0001d920: 7469 6f6e 2873 656c 662c 2064 662c 2073  tion(self, df, s
+0001d930: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+0001d940: 6963 742c 2070 6572 6365 6e74 6167 653d  ict, percentage=
+0001d950: 3130 293a 0a20 2020 2020 2020 2069 6620  10):.        if 
+0001d960: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+0001d970: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+0001d980: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001d990: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+0001d9a0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+0001d9b0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0001d9c0: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
+0001d9d0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0001d9e0: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
+0001d9f0: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
+0001da00: 2020 2020 2020 6863 203d 2064 6174 612e        hc = data.
+0001da10: 6465 7363 7269 6265 2829 5b22 436c 6f73  describe()["Clos
+0001da20: 6522 5d5b 226d 6178 225d 0a20 2020 2020  e"]["max"].     
+0001da30: 2020 206c 6320 3d20 6461 7461 2e64 6573     lc = data.des
+0001da40: 6372 6962 6528 295b 2243 6c6f 7365 225d  cribe()["Close"]
+0001da50: 5b22 6d69 6e22 5d0a 2020 2020 2020 2020  ["min"].        
+0001da60: 6966 2028 6863 202d 206c 6329 203c 3d20  if (hc - lc) <= 
+0001da70: 2868 6320 2a20 7065 7263 656e 7461 6765  (hc * percentage
+0001da80: 202f 2031 3030 2920 616e 6420 2868 6320   / 100) and (hc 
+0001da90: 2d20 6c63 2021 3d20 3029 3a0a 2020 2020  - lc != 0):.    
+0001daa0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+0001dab0: 6374 5b22 436f 6e73 6f6c 2e22 5d20 3d20  ct["Consol."] = 
+0001dac0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001dad0: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
+0001dae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001daf0: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
+0001db00: 454e 0a20 2020 2020 2020 2020 2020 2020  EN.             
+0001db10: 2020 202b 2022 5261 6e67 653a 220a 2020     + "Range:".  
+0001db20: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001db30: 7374 7228 726f 756e 6428 2861 6273 2828  str(round((abs((
+0001db40: 6863 202d 206c 6329 202f 2068 6329 202a  hc - lc) / hc) *
+0001db50: 2031 3030 292c 2031 2929 0a20 2020 2020   100), 1)).     
+0001db60: 2020 2020 2020 2020 2020 202b 2022 2522             + "%"
+0001db70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001db80: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0001db90: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001dba0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001dbb0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+0001dbc0: 6963 745b 2243 6f6e 736f 6c2e 225d 203d  ict["Consol."] =
+0001dbd0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001dbe0: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0001dbf0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001dc00: 2020 2b20 636f 6c6f 7254 6578 742e 4641    + colorText.FA
+0001dc10: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
+0001dc20: 2020 202b 2022 5261 6e67 653a 220a 2020     + "Range:".  
+0001dc30: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001dc40: 7374 7228 726f 756e 6428 2861 6273 2828  str(round((abs((
+0001dc50: 6863 202d 206c 6329 202f 2068 6329 202a  hc - lc) / hc) *
+0001dc60: 2031 3030 292c 2031 2929 0a20 2020 2020   100), 1)).     
+0001dc70: 2020 2020 2020 2020 2020 202b 2022 2522             + "%"
+0001dc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dc90: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0001dca0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001dcb0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+0001dcc0: 2243 6f6e 736f 6c2e 225d 203d 2066 2752  "Consol."] = f'R
+0001dcd0: 616e 6765 3a7b 7374 7228 726f 756e 6428  ange:{str(round(
+0001dce0: 2861 6273 2828 6863 2d6c 6329 2f68 6329  (abs((hc-lc)/hc)
+0001dcf0: 2a31 3030 292c 3129 292b 2225 227d 270a  *100),1))+"%"}'.
+0001dd00: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0001dd10: 6f75 6e64 2828 6162 7328 2868 6320 2d20  ound((abs((hc - 
+0001dd20: 6c63 2920 2f20 6863 2920 2a20 3130 3029  lc) / hc) * 100)
+0001dd30: 2c20 3129 0a0a 2020 2020 2320 7661 6c69  , 1)..    # vali
+0001dd40: 6461 7465 2069 6620 7468 6520 7374 6f63  date if the stoc
+0001dd50: 6b20 6861 7320 6265 656e 2068 6176 696e  k has been havin
+0001dd60: 6720 6869 6768 6572 2068 6967 6873 2c20  g higher highs, 
+0001dd70: 6869 6768 6572 206c 6f77 730a 2020 2020  higher lows.    
+0001dd80: 2320 616e 6420 6869 6768 6572 2063 6c6f  # and higher clo
+0001dd90: 7365 2077 6974 6820 6c61 7465 7374 2063  se with latest c
+0001dda0: 6c6f 7365 203e 2073 7570 6572 7472 656e  lose > supertren
+0001ddb0: 6420 616e 6420 382d 454d 412e 0a20 2020  d and 8-EMA..   
+0001ddc0: 2064 6566 2076 616c 6964 6174 6548 6967   def validateHig
+0001ddd0: 6865 7248 6967 6873 4869 6768 6572 4c6f  herHighsHigherLo
+0001dde0: 7773 4869 6768 6572 436c 6f73 6528 7365  wsHigherClose(se
+0001ddf0: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
+0001de00: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+0001de10: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+0001de20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001de30: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0001de40: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+0001de50: 290a 2020 2020 2020 2020 6461 7930 203d  ).        day0 =
+0001de60: 2064 6174 610a 2020 2020 2020 2020 6461   data.        da
+0001de70: 7931 203d 2064 6174 615b 313a 5d0a 2020  y1 = data[1:].  
+0001de80: 2020 2020 2020 6461 7932 203d 2064 6174        day2 = dat
+0001de90: 615b 323a 5d0a 2020 2020 2020 2020 6461  a[2:].        da
+0001dea0: 7933 203d 2064 6174 615b 333a 5d0a 2020  y3 = data[3:].  
+0001deb0: 2020 2020 2020 6966 206c 656e 2864 6179        if len(day
+0001dec0: 3129 203c 2031 206f 7220 6c65 6e28 6461  1) < 1 or len(da
+0001ded0: 7932 2920 3c20 3120 6f72 206c 656e 2864  y2) < 1 or len(d
+0001dee0: 6179 3329 203c 2031 3a0a 2020 2020 2020  ay3) < 1:.      
+0001def0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001df00: 7365 0a20 2020 2020 2020 2068 6967 6865  se.        highe
+0001df10: 7248 6967 6873 203d 2028 0a20 2020 2020  rHighs = (.     
+0001df20: 2020 2020 2020 2028 6461 7930 5b22 4869         (day0["Hi
+0001df30: 6768 225d 2e69 6c6f 635b 305d 203e 2064  gh"].iloc[0] > d
+0001df40: 6179 315b 2248 6967 6822 5d2e 696c 6f63  ay1["High"].iloc
+0001df50: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0001df60: 2061 6e64 2028 6461 7931 5b22 4869 6768   and (day1["High
+0001df70: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
+0001df80: 325b 2248 6967 6822 5d2e 696c 6f63 5b30  2["High"].iloc[0
+0001df90: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0001dfa0: 6e64 2028 6461 7932 5b22 4869 6768 225d  nd (day2["High"]
+0001dfb0: 2e69 6c6f 635b 305d 203e 2064 6179 335b  .iloc[0] > day3[
+0001dfc0: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
+0001dfd0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001dfe0: 2020 2068 6967 6865 724c 6f77 7320 3d20     higherLows = 
+0001dff0: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
+0001e000: 6179 305b 224c 6f77 225d 2e69 6c6f 635b  ay0["Low"].iloc[
+0001e010: 305d 203e 2064 6179 315b 224c 6f77 225d  0] > day1["Low"]
+0001e020: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001e030: 2020 2020 2020 616e 6420 2864 6179 315b        and (day1[
+0001e040: 224c 6f77 225d 2e69 6c6f 635b 305d 203e  "Low"].iloc[0] >
+0001e050: 2064 6179 325b 224c 6f77 225d 2e69 6c6f   day2["Low"].ilo
+0001e060: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
+0001e070: 2020 616e 6420 2864 6179 325b 224c 6f77    and (day2["Low
+0001e080: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
+0001e090: 335b 224c 6f77 225d 2e69 6c6f 635b 305d  3["Low"].iloc[0]
+0001e0a0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0001e0b0: 2020 2020 6869 6768 6572 436c 6f73 6520      higherClose 
+0001e0c0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0001e0d0: 2864 6179 305b 2243 6c6f 7365 225d 2e69  (day0["Close"].i
+0001e0e0: 6c6f 635b 305d 203e 2064 6179 315b 2243  loc[0] > day1["C
+0001e0f0: 6c6f 7365 225d 2e69 6c6f 635b 305d 290a  lose"].iloc[0]).
+0001e100: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001e110: 2864 6179 315b 2243 6c6f 7365 225d 2e69  (day1["Close"].i
+0001e120: 6c6f 635b 305d 203e 2064 6179 325b 2243  loc[0] > day2["C
+0001e130: 6c6f 7365 225d 2e69 6c6f 635b 305d 290a  lose"].iloc[0]).
+0001e140: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001e150: 2864 6179 325b 2243 6c6f 7365 225d 2e69  (day2["Close"].i
+0001e160: 6c6f 635b 305d 203e 2064 6179 335b 2243  loc[0] > day3["C
+0001e170: 6c6f 7365 225d 2e69 6c6f 635b 305d 290a  lose"].iloc[0]).
+0001e180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001e190: 2020 2320 6869 6768 6572 5253 4920 3d20    # higherRSI = 
+0001e1a0: 2864 6179 305b 2252 5349 225d 2e69 6c6f  (day0["RSI"].ilo
+0001e1b0: 635b 305d 203e 2064 6179 315b 2252 5349  c[0] > day1["RSI
+0001e1c0: 225d 2e69 6c6f 635b 305d 2920 616e 6420  "].iloc[0]) and 
+0001e1d0: 5c0a 2020 2020 2020 2020 2320 2020 2020  \.        #     
+0001e1e0: 2020 2020 2020 2020 2020 2020 2864 6179              (day
+0001e1f0: 315b 2252 5349 225d 2e69 6c6f 635b 305d  1["RSI"].iloc[0]
+0001e200: 203e 2064 6179 325b 2252 5349 225d 2e69   > day2["RSI"].i
+0001e210: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
+0001e220: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0001e230: 2020 2020 2020 2020 2864 6179 325b 2252          (day2["R
+0001e240: 5349 225d 2e69 6c6f 635b 305d 203e 2064  SI"].iloc[0] > d
+0001e250: 6179 335b 2252 5349 225d 2e69 6c6f 635b  ay3["RSI"].iloc[
+0001e260: 305d 2920 616e 6420 5c0a 2020 2020 2020  0]) and \.      
+0001e270: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0001e280: 2020 2020 6461 7933 5b22 5253 4922 5d2e      day3["RSI"].
+0001e290: 696c 6f63 5b30 5d20 3e3d 2035 3020 616e  iloc[0] >= 50 an
+0001e2a0: 6420 6461 7930 5b22 5253 4922 5d2e 696c  d day0["RSI"].il
+0001e2b0: 6f63 5b30 5d20 3e3d 2036 350a 2020 2020  oc[0] >= 65.    
+0001e2c0: 2020 2020 7265 7665 7273 6564 4461 7461      reversedData
+0001e2d0: 203d 2064 6174 615b 3a3a 2d31 5d2e 636f   = data[::-1].co
+0001e2e0: 7079 2829 0a20 2020 2020 2020 2072 6576  py().        rev
+0001e2f0: 6572 7365 6444 6174 615b 2253 5550 4552  ersedData["SUPER
+0001e300: 5422 5d20 3d20 706b 7461 6c69 622e 7375  T"] = pktalib.su
+0001e310: 7065 7274 7265 6e64 2872 6576 6572 7365  pertrend(reverse
+0001e320: 6444 6174 612c 2037 2c20 3329 5b22 5355  dData, 7, 3)["SU
+0001e330: 5045 5254 5f37 5f33 2e30 225d 0a20 2020  PERT_7_3.0"].   
+0001e340: 2020 2020 2072 6576 6572 7365 6444 6174       reversedDat
+0001e350: 615b 2245 4d41 3822 5d20 3d20 706b 7461  a["EMA8"] = pkta
+0001e360: 6c69 622e 454d 4128 7265 7665 7273 6564  lib.EMA(reversed
+0001e370: 4461 7461 5b22 436c 6f73 6522 5d2c 2074  Data["Close"], t
+0001e380: 696d 6570 6572 696f 643d 3929 0a20 2020  imeperiod=9).   
+0001e390: 2020 2020 2068 6967 6865 7243 6c6f 7365       higherClose
+0001e3a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0001e3b0: 2068 6967 6865 7243 6c6f 7365 0a20 2020   higherClose.   
+0001e3c0: 2020 2020 2020 2020 2061 6e64 2064 6179           and day
+0001e3d0: 305b 2243 6c6f 7365 225d 2e69 6c6f 635b  0["Close"].iloc[
+0001e3e0: 305d 203e 2072 6576 6572 7365 6444 6174  0] > reversedDat
+0001e3f0: 612e 7461 696c 2831 295b 2253 5550 4552  a.tail(1)["SUPER
+0001e400: 5422 5d2e 696c 6f63 5b30 5d0a 2020 2020  T"].iloc[0].    
+0001e410: 2020 2020 2020 2020 616e 6420 6461 7930          and day0
+0001e420: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0001e430: 5d20 3e20 7265 7665 7273 6564 4461 7461  ] > reversedData
+0001e440: 2e74 6169 6c28 3129 5b22 454d 4138 225d  .tail(1)["EMA8"]
+0001e450: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+0001e460: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+0001e470: 6e20 6869 6768 6572 4869 6768 7320 616e  n higherHighs an
+0001e480: 6420 6869 6768 6572 4c6f 7773 2061 6e64  d higherLows and
+0001e490: 2068 6967 6865 7243 6c6f 7365 0a0a 2020   higherClose..  
+0001e4a0: 2020 2340 6d65 6173 7572 655f 7469 6d65    #@measure_time
+0001e4b0: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
+0001e4c0: 2749 6e73 6964 6520 4261 7227 2073 7472  'Inside Bar' str
+0001e4d0: 7563 7475 7265 2066 6f72 2072 6563 656e  ucture for recen
+0001e4e0: 7420 6461 7973 0a20 2020 2064 6566 2076  t days.    def v
+0001e4f0: 616c 6964 6174 6549 6e73 6964 6542 6172  alidateInsideBar
+0001e500: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+0001e510: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
+0001e520: 7361 7665 4469 6374 2c20 6368 6172 7450  saveDict, chartP
+0001e530: 6174 7465 726e 3d31 2c20 6461 7973 546f  attern=1, daysTo
+0001e540: 4c6f 6f6b 6261 636b 3d35 0a20 2020 2029  Lookback=5.    )
+0001e550: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+0001e560: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+0001e570: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+0001e580: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001e590: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+0001e5a0: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+0001e5b0: 2020 206f 7267 4461 7461 203d 2064 6174     orgData = dat
+0001e5c0: 610a 2020 2020 2020 2020 7361 7665 6420  a.        saved 
+0001e5d0: 3d20 7365 6c66 2e66 696e 6443 7572 7265  = self.findCurre
+0001e5e0: 6e74 5361 7665 6456 616c 7565 2873 6372  ntSavedValue(scr
+0001e5f0: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+0001e600: 742c 2022 5061 7474 6572 6e22 290a 2020  t, "Pattern").  
+0001e610: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+0001e620: 616e 6765 2869 6e74 2864 6179 7354 6f4c  ange(int(daysToL
+0001e630: 6f6f 6b62 6163 6b29 2c20 696e 7428 726f  ookback), int(ro
+0001e640: 756e 6428 6461 7973 546f 4c6f 6f6b 6261  und(daysToLookba
+0001e650: 636b 202a 2030 2e35 2929 202d 2031 2c20  ck * 0.5)) - 1, 
+0001e660: 2d31 293a 0a20 2020 2020 2020 2020 2020  -1):.           
+0001e670: 2069 6620 6920 3d3d 2032 3a0a 2020 2020   if i == 2:.    
+0001e680: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001e690: 726e 2030 2020 2320 4578 6974 2069 6620  rn 0  # Exit if 
+0001e6a0: 6f6e 6c79 206c 6173 7420 3220 6361 6e64  only last 2 cand
+0001e6b0: 6c65 7320 6172 6520 6c65 6674 0a20 2020  les are left.   
+0001e6c0: 2020 2020 2020 2020 2069 6620 6368 6172           if char
+0001e6d0: 7450 6174 7465 726e 203d 3d20 313a 0a20  tPattern == 1:. 
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001e6f0: 6620 2255 7022 2069 6e20 7361 7665 4469  f "Up" in saveDi
+0001e700: 6374 5b22 5472 656e 6422 5d20 616e 6420  ct["Trend"] and 
+0001e710: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001e720: 2020 2020 2020 2242 756c 6c22 2069 6e20        "Bull" in 
+0001e730: 7361 7665 4469 6374 5b22 4d41 2d53 6967  saveDict["MA-Sig
+0001e740: 6e61 6c22 5d0a 2020 2020 2020 2020 2020  nal"].          
+0001e750: 2020 2020 2020 2020 2020 6f72 2022 5375            or "Su
+0001e760: 7070 6f72 7422 2069 6e20 7361 7665 4469  pport" in saveDi
+0001e770: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d0a  ct["MA-Signal"].
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001e7a0: 2020 2020 2020 2064 6174 6120 3d20 6f72         data = or
+0001e7b0: 6744 6174 612e 6865 6164 2869 290a 2020  gData.head(i).  
+0001e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7d0: 2020 7265 6643 616e 646c 6520 3d20 6461    refCandle = da
+0001e7e0: 7461 2e74 6169 6c28 3129 0a20 2020 2020  ta.tail(1).     
+0001e7f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001e800: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0001e810: 2020 2020 2020 2020 2020 2020 286c 656e              (len
+0001e820: 2864 6174 612e 4869 6768 5b64 6174 612e  (data.High[data.
+0001e830: 4869 6768 203e 2072 6566 4361 6e64 6c65  High > refCandle
+0001e840: 2e48 6967 682e 6974 656d 2829 5d29 203d  .High.item()]) =
+0001e850: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
+0001e860: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0001e870: 2028 6c65 6e28 6461 7461 2e4c 6f77 5b64   (len(data.Low[d
+0001e880: 6174 612e 4c6f 7720 3c20 7265 6643 616e  ata.Low < refCan
+0001e890: 646c 652e 4c6f 772e 6974 656d 2829 5d29  dle.Low.item()])
+0001e8a0: 203d 3d20 3029 0a20 2020 2020 2020 2020   == 0).         
+0001e8b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001e8c0: 6e64 2028 6c65 6e28 6461 7461 2e4f 7065  nd (len(data.Ope
+0001e8d0: 6e5b 6461 7461 2e4f 7065 6e20 3e20 7265  n[data.Open > re
+0001e8e0: 6643 616e 646c 652e 4869 6768 2e69 7465  fCandle.High.ite
+0001e8f0: 6d28 295d 2920 3d3d 2030 290a 2020 2020  m()]) == 0).    
+0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e910: 2020 2020 616e 6420 286c 656e 2864 6174      and (len(dat
+0001e920: 612e 436c 6f73 655b 6461 7461 2e43 6c6f  a.Close[data.Clo
+0001e930: 7365 203c 2072 6566 4361 6e64 6c65 2e4c  se < refCandle.L
+0001e940: 6f77 2e69 7465 6d28 295d 2920 3d3d 2030  ow.item()]) == 0
+0001e950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e960: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
 0001e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e980: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0001e990: 7874 2e57 4152 4e0a 2020 2020 2020 2020  xt.WARN.        
+0001e980: 2073 6372 6565 6e44 6963 745b 2250 6174   screenDict["Pat
+0001e990: 7465 726e 225d 203d 2028 0a20 2020 2020  tern"] = (.     
 0001e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9b0: 2020 2020 2b20 2822 496e 7369 6465 2042      + ("Inside B
-0001e9c0: 6172 2028 2564 2922 2025 2069 290a 2020  ar (%d)" % i).  
-0001e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9e0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001e9f0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0001ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001ea20: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0001ea30: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
-0001ea40: 3d20 7361 7665 645b 315d 202b 2022 496e  = saved[1] + "In
-0001ea50: 7369 6465 2042 6172 2028 2564 2922 2025  side Bar (%d)" %
-0001ea60: 2069 0a20 2020 2020 2020 2020 2020 2020   i.             
-0001ea70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ea80: 6e20 690a 2020 2020 2020 2020 2020 2020  n i.            
-0001ea90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001eaa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001eab0: 7475 726e 2030 0a20 2020 2020 2020 2020  turn 0.         
-0001eac0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001ead0: 2020 2020 2020 2020 2069 6620 2244 6f77           if "Dow
-0001eae0: 6e22 2069 6e20 7361 7665 4469 6374 5b22  n" in saveDict["
-0001eaf0: 5472 656e 6422 5d20 616e 6420 280a 2020  Trend"] and (.  
-0001eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb10: 2020 2242 6561 7222 2069 6e20 7361 7665    "Bear" in save
-0001eb20: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-0001eb30: 5d20 6f72 2022 5265 7369 7374 2220 696e  ] or "Resist" in
-0001eb40: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
-0001eb50: 676e 616c 225d 0a20 2020 2020 2020 2020  gnal"].         
-0001eb60: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001eb70: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0001eb80: 7461 203d 206f 7267 4461 7461 2e68 6561  ta = orgData.hea
-0001eb90: 6428 6929 0a20 2020 2020 2020 2020 2020  d(i).           
-0001eba0: 2020 2020 2020 2020 2072 6566 4361 6e64           refCand
-0001ebb0: 6c65 203d 2064 6174 612e 7461 696c 2831  le = data.tail(1
-0001ebc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ebd0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-0001ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ebf0: 2020 2028 6c65 6e28 6461 7461 2e48 6967     (len(data.Hig
-0001ec00: 685b 6461 7461 2e48 6967 6820 3e20 7265  h[data.High > re
-0001ec10: 6643 616e 646c 652e 4869 6768 2e69 7465  fCandle.High.ite
-0001ec20: 6d28 295d 2920 3d3d 2030 290a 2020 2020  m()]) == 0).    
-0001ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec40: 2020 2020 616e 6420 286c 656e 2864 6174      and (len(dat
-0001ec50: 612e 4c6f 775b 6461 7461 2e4c 6f77 203c  a.Low[data.Low <
-0001ec60: 2072 6566 4361 6e64 6c65 2e4c 6f77 2e69   refCandle.Low.i
-0001ec70: 7465 6d28 295d 2920 3d3d 2030 290a 2020  tem()]) == 0).  
-0001ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec90: 2020 2020 2020 616e 6420 286c 656e 2864        and (len(d
-0001eca0: 6174 612e 4f70 656e 5b64 6174 612e 4f70  ata.Open[data.Op
-0001ecb0: 656e 203e 2072 6566 4361 6e64 6c65 2e48  en > refCandle.H
-0001ecc0: 6967 682e 6974 656d 2829 5d29 203d 3d20  igh.item()]) == 
-0001ecd0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001ece0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001ecf0: 6c65 6e28 6461 7461 2e43 6c6f 7365 5b64  len(data.Close[d
-0001ed00: 6174 612e 436c 6f73 6520 3c20 7265 6643  ata.Close < refC
-0001ed10: 616e 646c 652e 4c6f 772e 6974 656d 2829  andle.Low.item()
-0001ed20: 5d29 203d 3d20 3029 0a20 2020 2020 2020  ]) == 0).       
-0001ed30: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-0001ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed50: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-0001ed60: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-0001ed70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001ed80: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-0001ed90: 7665 645b 305d 0a20 2020 2020 2020 2020  ved[0].         
-0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001edb0: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
-0001edc0: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
-0001edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ede0: 2b20 636f 6c6f 7254 6578 742e 5741 524e  + colorText.WARN
-0001edf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ee00: 2020 2020 2020 2020 2020 2020 202b 2028               + (
-0001ee10: 2249 6e73 6964 6520 4261 7220 2825 6429  "Inside Bar (%d)
-0001ee20: 2220 2520 6929 0a20 2020 2020 2020 2020  " % i).         
-0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee40: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0001ee50: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-0001ee60: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee80: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
-0001ee90: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-0001eea0: 5b31 5d20 2b20 2249 6e73 6964 6520 4261  [1] + "Inside Ba
-0001eeb0: 7220 2825 6429 2220 2520 690a 2020 2020  r (%d)" % i.    
-0001eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eed0: 2020 2020 7265 7475 726e 2069 0a20 2020      return i.   
-0001eee0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001eef0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001ef00: 2020 2020 2020 2072 6574 7572 6e20 300a         return 0.
-0001ef10: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
-0001ef20: 0a0a 2020 2020 2320 4669 6e64 2049 504f  ..    # Find IPO
-0001ef30: 2062 6173 650a 2020 2020 6465 6620 7661   base.    def va
-0001ef40: 6c69 6461 7465 4970 6f42 6173 6528 7365  lidateIpoBase(se
-0001ef50: 6c66 2c20 7374 6f63 6b2c 2064 662c 2073  lf, stock, df, s
-0001ef60: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-0001ef70: 6963 742c 2070 6572 6365 6e74 6167 653d  ict, percentage=
-0001ef80: 302e 3329 3a0a 2020 2020 2020 2020 6966  0.3):.        if
-0001ef90: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-0001efa0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-0001efb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001efc0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0001efd0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-0001efe0: 2020 2020 2020 206c 6973 7469 6e67 5072         listingPr
-0001eff0: 6963 6520 3d20 6461 7461 5b3a 3a2d 315d  ice = data[::-1]
-0001f000: 2e68 6561 6428 3129 5b22 4f70 656e 225d  .head(1)["Open"]
-0001f010: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-0001f020: 2063 7572 7265 6e74 5072 6963 6520 3d20   currentPrice = 
-0001f030: 6461 7461 2e68 6561 6428 3129 5b22 436c  data.head(1)["Cl
-0001f040: 6f73 6522 5d2e 696c 6f63 5b30 5d0a 2020  ose"].iloc[0].  
-0001f050: 2020 2020 2020 4154 4820 3d20 6461 7461        ATH = data
-0001f060: 2e64 6573 6372 6962 6528 295b 2248 6967  .describe()["Hig
-0001f070: 6822 5d5b 226d 6178 225d 0a20 2020 2020  h"]["max"].     
-0001f080: 2020 2069 6620 4154 4820 3e20 286c 6973     if ATH > (lis
-0001f090: 7469 6e67 5072 6963 6520 2b20 286c 6973  tingPrice + (lis
-0001f0a0: 7469 6e67 5072 6963 6520 2a20 7065 7263  tingPrice * perc
-0001f0b0: 656e 7461 6765 2929 3a0a 2020 2020 2020  entage)):.      
-0001f0c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001f0d0: 7365 0a20 2020 2020 2020 2061 7761 7920  se.        away 
-0001f0e0: 3d20 726f 756e 6428 2828 6375 7272 656e  = round(((curren
-0001f0f0: 7450 7269 6365 202d 206c 6973 7469 6e67  tPrice - listing
-0001f100: 5072 6963 6529 202f 206c 6973 7469 6e67  Price) / listing
-0001f110: 5072 6963 6529 202a 2031 3030 2c20 3129  Price) * 100, 1)
-0001f120: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-0001f130: 2020 2020 2020 2020 2020 286c 6973 7469            (listi
-0001f140: 6e67 5072 6963 6520 2d20 286c 6973 7469  ngPrice - (listi
-0001f150: 6e67 5072 6963 6520 2a20 7065 7263 656e  ngPrice * percen
-0001f160: 7461 6765 2929 0a20 2020 2020 2020 2020  tage)).         
-0001f170: 2020 203c 3d20 6375 7272 656e 7450 7269     <= currentPri
-0001f180: 6365 0a20 2020 2020 2020 2020 2020 203c  ce.            <
-0001f190: 3d20 286c 6973 7469 6e67 5072 6963 6520  = (listingPrice 
-0001f1a0: 2b20 286c 6973 7469 6e67 5072 6963 6520  + (listingPrice 
-0001f1b0: 2a20 7065 7263 656e 7461 6765 2929 0a20  * percentage)). 
-0001f1c0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001f1d0: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-0001f1e0: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-0001f1f0: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-0001f200: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
-0001f210: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
-0001f220: 2020 2020 2020 6966 2061 7761 7920 3e20        if away > 
-0001f230: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001f240: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
-0001f250: 6174 7465 726e 225d 203d 2028 0a20 2020  attern"] = (.   
-0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f270: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
-0001f280: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001f290: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2b0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0001f2c0: 4752 4545 4e0a 2020 2020 2020 2020 2020  GREEN.          
-0001f2d0: 2020 2020 2020 2020 2020 2b20 6622 4950            + f"IP
-0001f2e0: 4f20 4261 7365 2028 7b61 7761 797d 2025  O Base ({away} %
-0001f2f0: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
-0001f300: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0001f310: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001f320: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001f330: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001f340: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0001f350: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
-0001f360: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0001f370: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
-0001f380: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001f390: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001f3a0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-0001f3b0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0001f3c0: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3e0: 202b 2022 4950 4f20 4261 7365 2022 0a20   + "IPO Base ". 
-0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f400: 2020 202b 2063 6f6c 6f72 5465 7874 2e46     + colorText.F
-0001f410: 4149 4c0a 2020 2020 2020 2020 2020 2020  AIL.            
-0001f420: 2020 2020 2020 2020 2b20 6622 287b 6177          + f"({aw
-0001f430: 6179 7d20 2529 220a 2020 2020 2020 2020  ay} %)".        
-0001f440: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0001f450: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-0001f460: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001f470: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-0001f480: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-0001f490: 7361 7665 645b 315d 202b 2066 2249 504f  saved[1] + f"IPO
-0001f4a0: 2042 6173 6520 287b 6177 6179 7d20 2529   Base ({away} %)
-0001f4b0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
-0001f4c0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001f4d0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0001f4e0: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
-0001f4f0: 6d65 0a20 2020 2023 2056 616c 6964 6174  me.    # Validat
-0001f500: 6520 4c6f 7265 6e74 7a69 616e 2043 6c61  e Lorentzian Cla
-0001f510: 7373 6966 6963 6174 696f 6e20 7369 676e  ssification sign
-0001f520: 616c 0a20 2020 2064 6566 2076 616c 6964  al.    def valid
-0001f530: 6174 654c 6f72 656e 747a 6961 6e28 7365  ateLorentzian(se
-0001f540: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-0001f550: 6374 2c20 7361 7665 4469 6374 2c20 6c6f  ct, saveDict, lo
-0001f560: 6f6b 466f 723d 3329 3a0a 2020 2020 2020  okFor=3):.      
-0001f570: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-0001f580: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-0001f590: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001f5a0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0001f5b0: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-0001f5c0: 2829 0a20 2020 2020 2020 2023 206c 6f6f  ().        # loo
-0001f5d0: 6b46 6f72 3a20 312d 4275 792c 2032 2d53  kFor: 1-Buy, 2-S
-0001f5e0: 656c 6c2c 2033 2d41 6e79 0a20 2020 2020  ell, 3-Any.     
-0001f5f0: 2020 2064 6174 6120 3d20 6461 7461 5b3a     data = data[:
-0001f600: 3a2d 315d 2020 2320 5265 7665 7273 6520  :-1]  # Reverse 
-0001f610: 7468 6520 6461 7461 6672 616d 650a 2020  the dataframe.  
-0001f620: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-0001f630: 612e 7265 6e61 6d65 280a 2020 2020 2020  a.rename(.      
-0001f640: 2020 2020 2020 636f 6c75 6d6e 733d 7b0a        columns={.
-0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f660: 224f 7065 6e22 3a20 226f 7065 6e22 2c0a  "Open": "open",.
-0001f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f680: 2243 6c6f 7365 223a 2022 636c 6f73 6522  "Close": "close"
-0001f690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f6a0: 2020 2248 6967 6822 3a20 2268 6967 6822    "High": "high"
-0001f6b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f6c0: 2020 224c 6f77 223a 2022 6c6f 7722 2c0a    "Low": "low",.
-0001f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6e0: 2256 6f6c 756d 6522 3a20 2276 6f6c 756d  "Volume": "volum
-0001f6f0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0001f700: 7d0a 2020 2020 2020 2020 290a 2020 2020  }.        ).    
-0001f710: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001f720: 2020 2020 2077 6974 6820 5375 7070 7265       with Suppre
-0001f730: 7373 4f75 7470 7574 2873 7570 7072 6573  ssOutput(suppres
-0001f740: 735f 7374 646f 7574 3d54 7275 652c 2073  s_stdout=True, s
-0001f750: 7570 7072 6573 735f 7374 6465 7272 3d54  uppress_stderr=T
-0001f760: 7275 6529 3a0a 2020 2020 2020 2020 2020  rue):.          
-0001f770: 2020 2020 2020 6c63 203d 2061 7461 2e4c        lc = ata.L
-0001f780: 6f72 656e 747a 6961 6e43 6c61 7373 6966  orentzianClassif
-0001f790: 6963 6174 696f 6e28 6461 7461 3d64 6174  ication(data=dat
-0001f7a0: 6129 0a20 2020 2020 2020 2020 2020 2073  a).            s
-0001f7b0: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-0001f7c0: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-0001f7d0: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-0001f7e0: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-0001f7f0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0001f800: 6620 6c63 2e64 662e 696c 6f63 5b2d 315d  f lc.df.iloc[-1]
-0001f810: 5b22 6973 4e65 7742 7579 5369 676e 616c  ["isNewBuySignal
-0001f820: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-0001f830: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-0001f840: 5061 7474 6572 6e22 5d20 3d20 280a 2020  Pattern"] = (.  
-0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f860: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-0001f870: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-0001f880: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
-0001f890: 224c 6f72 656e 747a 6961 6e2d 4275 7922  "Lorentzian-Buy"
-0001f8a0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-0001f8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f8c0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0001f8d0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
-0001f8e0: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
-0001f8f0: 5d20 2b20 224c 6f72 656e 747a 6961 6e2d  ] + "Lorentzian-
-0001f900: 4275 7922 0a20 2020 2020 2020 2020 2020  Buy".           
-0001f910: 2020 2020 2069 6620 6c6f 6f6b 466f 7220       if lookFor 
-0001f920: 213d 2032 3a20 2320 4e6f 7420 5365 6c6c  != 2: # Not Sell
-0001f930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f940: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001f950: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0001f960: 6620 6c63 2e64 662e 696c 6f63 5b2d 315d  f lc.df.iloc[-1]
-0001f970: 5b22 6973 4e65 7753 656c 6c53 6967 6e61  ["isNewSellSigna
-0001f980: 6c22 5d3a 0a20 2020 2020 2020 2020 2020  l"]:.           
-0001f990: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0001f9a0: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
-0001f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9c0: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
-0001f9d0: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
-0001f9e0: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
-0001f9f0: 224c 6f72 656e 747a 6961 6e2d 5365 6c6c  "Lorentzian-Sell
-0001fa00: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-0001fa10: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0001fa20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001fa30: 2020 2020 7361 7665 4469 6374 5b22 5061      saveDict["Pa
-0001fa40: 7474 6572 6e22 5d20 3d20 7361 7665 645b  ttern"] = saved[
-0001fa50: 315d 202b 2022 4c6f 7265 6e74 7a69 616e  1] + "Lorentzian
-0001fa60: 2d53 656c 6c22 0a20 2020 2020 2020 2020  -Sell".         
-0001fa70: 2020 2020 2020 2069 6620 6c6f 6f6b 466f         if lookFo
-0001fa80: 7220 213d 2031 3a20 2320 4e6f 7420 4275  r != 1: # Not Bu
-0001fa90: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-0001faa0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0001fab0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0001fac0: 2045 7863 6570 7469 6f6e 3a20 2023 2070   Exception:  # p
-0001fad0: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-0001fae0: 2020 2020 2020 2020 2020 2020 2320 5661              # Va
-0001faf0: 6c75 6545 7272 6f72 3a20 6f70 6572 616e  lueError: operan
-0001fb00: 6473 2063 6f75 6c64 206e 6f74 2062 6520  ds could not be 
-0001fb10: 6272 6f61 6463 6173 7420 746f 6765 7468  broadcast togeth
-0001fb20: 6572 2077 6974 6820 7368 6170 6573 2028  er with shapes (
-0001fb30: 3230 2c29 2028 3236 2c29 0a20 2020 2020  20,) (26,).     
-0001fb40: 2020 2020 2020 2023 2046 696c 6520 222f         # File "/
-0001fb50: 6f70 742f 686f 6d65 6272 6577 2f6c 6962  opt/homebrew/lib
-0001fb60: 2f70 7974 686f 6e33 2e31 312f 7369 7465  /python3.11/site
-0001fb70: 2d70 6163 6b61 6765 732f 6164 7661 6e63  -packages/advanc
-0001fb80: 6564 5f74 612f 4c6f 7265 6e74 7a69 616e  ed_ta/Lorentzian
-0001fb90: 436c 6173 7369 6669 6361 7469 6f6e 2f43  Classification/C
-0001fba0: 6c61 7373 6966 6965 722e 7079 222c 206c  lassifier.py", l
-0001fbb0: 696e 6520 3138 362c 2069 6e20 5f5f 696e  ine 186, in __in
-0001fbc0: 6974 5f5f 0a20 2020 2020 2020 2020 2020  it__.           
-0001fbd0: 2023 2046 696c 6520 222f 6f70 742f 686f   # File "/opt/ho
-0001fbe0: 6d65 6272 6577 2f6c 6962 2f70 7974 686f  mebrew/lib/pytho
-0001fbf0: 6e33 2e31 312f 7369 7465 2d70 6163 6b61  n3.11/site-packa
-0001fc00: 6765 732f 6164 7661 6e63 6564 5f74 612f  ges/advanced_ta/
-0001fc10: 4c6f 7265 6e74 7a69 616e 436c 6173 7369  LorentzianClassi
-0001fc20: 6669 6361 7469 6f6e 2f43 6c61 7373 6966  fication/Classif
-0001fc30: 6965 722e 7079 222c 206c 696e 6520 3339  ier.py", line 39
-0001fc40: 352c 2069 6e20 5f5f 636c 6173 7369 6679  5, in __classify
-0001fc50: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-0001fc60: 696c 6520 222f 6f70 742f 686f 6d65 6272  ile "/opt/homebr
-0001fc70: 6577 2f6c 6962 2f70 7974 686f 6e33 2e31  ew/lib/python3.1
-0001fc80: 312f 7369 7465 2d70 6163 6b61 6765 732f  1/site-packages/
-0001fc90: 7061 6e64 6173 2f63 6f72 652f 6f70 732f  pandas/core/ops/
-0001fca0: 636f 6d6d 6f6e 2e70 7922 2c20 6c69 6e65  common.py", line
-0001fcb0: 2037 362c 2069 6e20 6e65 775f 6d65 7468   76, in new_meth
-0001fcc0: 6f64 0a20 2020 2020 2020 2020 2020 2023  od.            #
-0001fcd0: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
-0001fce0: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
-0001fcf0: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
-0001fd00: 732f 7061 6e64 6173 2f63 6f72 652f 6172  s/pandas/core/ar
-0001fd10: 7261 796c 696b 652e 7079 222c 206c 696e  raylike.py", lin
-0001fd20: 6520 3730 2c20 696e 205f 5f61 6e64 5f5f  e 70, in __and__
-0001fd30: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-0001fd40: 696c 6520 222f 6f70 742f 686f 6d65 6272  ile "/opt/homebr
-0001fd50: 6577 2f6c 6962 2f70 7974 686f 6e33 2e31  ew/lib/python3.1
-0001fd60: 312f 7369 7465 2d70 6163 6b61 6765 732f  1/site-packages/
-0001fd70: 7061 6e64 6173 2f63 6f72 652f 7365 7269  pandas/core/seri
-0001fd80: 6573 2e70 7922 2c20 6c69 6e65 2035 3831  es.py", line 581
-0001fd90: 302c 2069 6e20 5f6c 6f67 6963 616c 5f6d  0, in _logical_m
-0001fda0: 6574 686f 640a 2020 2020 2020 2020 2020  ethod.          
-0001fdb0: 2020 2320 4669 6c65 2022 2f6f 7074 2f68    # File "/opt/h
-0001fdc0: 6f6d 6562 7265 772f 6c69 622f 7079 7468  omebrew/lib/pyth
-0001fdd0: 6f6e 332e 3131 2f73 6974 652d 7061 636b  on3.11/site-pack
-0001fde0: 6167 6573 2f70 616e 6461 732f 636f 7265  ages/pandas/core
-0001fdf0: 2f6f 7073 2f61 7272 6179 5f6f 7073 2e70  /ops/array_ops.p
-0001fe00: 7922 2c20 6c69 6e65 2034 3536 2c20 696e  y", line 456, in
-0001fe10: 206c 6f67 6963 616c 5f6f 700a 2020 2020   logical_op.    
-0001fe20: 2020 2020 2020 2020 2320 4669 6c65 2022          # File "
-0001fe30: 2f6f 7074 2f68 6f6d 6562 7265 772f 6c69  /opt/homebrew/li
-0001fe40: 622f 7079 7468 6f6e 332e 3131 2f73 6974  b/python3.11/sit
-0001fe50: 652d 7061 636b 6167 6573 2f70 616e 6461  e-packages/panda
-0001fe60: 732f 636f 7265 2f6f 7073 2f61 7272 6179  s/core/ops/array
-0001fe70: 5f6f 7073 2e70 7922 2c20 6c69 6e65 2033  _ops.py", line 3
-0001fe80: 3634 2c20 696e 206e 615f 6c6f 6769 6361  64, in na_logica
-0001fe90: 6c5f 6f70 0a20 2020 2020 2020 2020 2020  l_op.           
-0001fea0: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
-0001feb0: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-0001fec0: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-0001fed0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-0001fee0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001fef0: 616c 7365 0a0a 2020 2020 2320 7661 6c69  alse..    # vali
-0001ff00: 6461 7465 2069 6620 7468 6520 7374 6f63  date if the stoc
-0001ff10: 6b20 6861 7320 6265 656e 2068 6176 696e  k has been havin
-0001ff20: 6720 6c6f 7765 7220 6c6f 7773 2c20 6c6f  g lower lows, lo
-0001ff30: 7765 7220 6869 6768 730a 2020 2020 6465  wer highs.    de
-0001ff40: 6620 7661 6c69 6461 7465 4c6f 7765 7248  f validateLowerH
-0001ff50: 6967 6873 4c6f 7765 724c 6f77 7328 7365  ighsLowerLows(se
-0001ff60: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
-0001ff70: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-0001ff80: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-0001ff90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001ffa0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001ffb0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-0001ffc0: 290a 2020 2020 2020 2020 6461 7930 203d  ).        day0 =
-0001ffd0: 2064 6174 610a 2020 2020 2020 2020 6461   data.        da
-0001ffe0: 7931 203d 2064 6174 615b 313a 5d0a 2020  y1 = data[1:].  
-0001fff0: 2020 2020 2020 6461 7932 203d 2064 6174        day2 = dat
-00020000: 615b 323a 5d0a 2020 2020 2020 2020 6461  a[2:].        da
-00020010: 7933 203d 2064 6174 615b 333a 5d0a 2020  y3 = data[3:].  
-00020020: 2020 2020 2020 6c6f 7765 7248 6967 6873        lowerHighs
-00020030: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00020040: 2028 6461 7930 5b22 4869 6768 225d 2e69   (day0["High"].i
-00020050: 6c6f 635b 305d 203c 2064 6179 315b 2248  loc[0] < day1["H
-00020060: 6967 6822 5d2e 696c 6f63 5b30 5d29 0a20  igh"].iloc[0]). 
-00020070: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-00020080: 6461 7931 5b22 4869 6768 225d 2e69 6c6f  day1["High"].ilo
-00020090: 635b 305d 203c 2064 6179 325b 2248 6967  c[0] < day2["Hig
-000200a0: 6822 5d2e 696c 6f63 5b30 5d29 0a20 2020  h"].iloc[0]).   
-000200b0: 2020 2020 2020 2020 2061 6e64 2028 6461           and (da
-000200c0: 7932 5b22 4869 6768 225d 2e69 6c6f 635b  y2["High"].iloc[
-000200d0: 305d 203c 2064 6179 335b 2248 6967 6822  0] < day3["High"
-000200e0: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
-000200f0: 2020 2029 0a20 2020 2020 2020 206c 6f77     ).        low
-00020100: 6572 4c6f 7773 203d 2028 0a20 2020 2020  erLows = (.     
-00020110: 2020 2020 2020 2028 6461 7930 5b22 4c6f         (day0["Lo
-00020120: 7722 5d2e 696c 6f63 5b30 5d20 3c20 6461  w"].iloc[0] < da
-00020130: 7931 5b22 4c6f 7722 5d2e 696c 6f63 5b30  y1["Low"].iloc[0
-00020140: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-00020150: 6e64 2028 6461 7931 5b22 4c6f 7722 5d2e  nd (day1["Low"].
-00020160: 696c 6f63 5b30 5d20 3c20 6461 7932 5b22  iloc[0] < day2["
-00020170: 4c6f 7722 5d2e 696c 6f63 5b30 5d29 0a20  Low"].iloc[0]). 
-00020180: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-00020190: 6461 7932 5b22 4c6f 7722 5d2e 696c 6f63  day2["Low"].iloc
-000201a0: 5b30 5d20 3c20 6461 7933 5b22 4c6f 7722  [0] < day3["Low"
-000201b0: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
-000201c0: 2020 2029 0a20 2020 2020 2020 2068 6967     ).        hig
-000201d0: 6865 7252 5349 203d 2028 0a20 2020 2020  herRSI = (.     
-000201e0: 2020 2020 2020 2028 6461 7930 5b22 5253         (day0["RS
-000201f0: 4922 5d2e 696c 6f63 5b30 5d20 3c20 6461  I"].iloc[0] < da
-00020200: 7931 5b22 5253 4922 5d2e 696c 6f63 5b30  y1["RSI"].iloc[0
-00020210: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-00020220: 6e64 2028 6461 7931 5b22 5253 4922 5d2e  nd (day1["RSI"].
-00020230: 696c 6f63 5b30 5d20 3c20 6461 7932 5b22  iloc[0] < day2["
-00020240: 5253 4922 5d2e 696c 6f63 5b30 5d29 0a20  RSI"].iloc[0]). 
-00020250: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-00020260: 6461 7932 5b22 5253 4922 5d2e 696c 6f63  day2["RSI"].iloc
-00020270: 5b30 5d20 3c20 6461 7933 5b22 5253 4922  [0] < day3["RSI"
-00020280: 5d2e 696c 6f63 5b30 5d29 0a20 2020 2020  ].iloc[0]).     
-00020290: 2020 2020 2020 2061 6e64 2064 6179 305b         and day0[
-000202a0: 2252 5349 225d 2e69 6c6f 635b 305d 203e  "RSI"].iloc[0] >
-000202b0: 3d20 3530 0a20 2020 2020 2020 2029 0a20  = 50.        ). 
-000202c0: 2020 2020 2020 2072 6574 7572 6e20 6c6f         return lo
-000202d0: 7765 7248 6967 6873 2061 6e64 206c 6f77  werHighs and low
-000202e0: 6572 4c6f 7773 2061 6e64 2068 6967 6865  erLows and highe
-000202f0: 7252 5349 0a0a 2020 2020 2320 5661 6c69  rRSI..    # Vali
-00020300: 6461 7465 2069 6620 7265 6365 6e74 2076  date if recent v
-00020310: 6f6c 756d 6520 6973 206c 6f77 6573 7420  olume is lowest 
-00020320: 6f66 206c 6173 7420 274e 2720 4461 7973  of last 'N' Days
-00020330: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-00020340: 654c 6f77 6573 7456 6f6c 756d 6528 7365  eLowestVolume(se
-00020350: 6c66 2c20 6466 2c20 6461 7973 466f 724c  lf, df, daysForL
-00020360: 6f77 6573 7456 6f6c 756d 6529 3a0a 2020  owestVolume):.  
-00020370: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-00020380: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-00020390: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000203a0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-000203b0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-000203c0: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
-000203d0: 6174 6120 3d20 6461 7461 2e66 696c 6c6e  ata = data.filln
-000203e0: 6128 3029 0a20 2020 2020 2020 2064 6174  a(0).        dat
-000203f0: 6120 3d20 6461 7461 2e72 6570 6c61 6365  a = data.replace
-00020400: 285b 6e70 2e69 6e66 2c20 2d6e 702e 696e  ([np.inf, -np.in
-00020410: 665d 2c20 3029 0a20 2020 2020 2020 2069  f], 0).        i
-00020420: 6620 6461 7973 466f 724c 6f77 6573 7456  f daysForLowestV
-00020430: 6f6c 756d 6520 6973 204e 6f6e 653a 0a20  olume is None:. 
-00020440: 2020 2020 2020 2020 2020 2064 6179 7346             daysF
-00020450: 6f72 4c6f 7765 7374 566f 6c75 6d65 203d  orLowestVolume =
-00020460: 2033 300a 2020 2020 2020 2020 6966 206c   30.        if l
-00020470: 656e 2864 6174 6129 203c 2064 6179 7346  en(data) < daysF
-00020480: 6f72 4c6f 7765 7374 566f 6c75 6d65 3a0a  orLowestVolume:.
-00020490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000204a0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-000204b0: 2064 6174 6120 3d20 6461 7461 2e68 6561   data = data.hea
-000204c0: 6428 6461 7973 466f 724c 6f77 6573 7456  d(daysForLowestV
-000204d0: 6f6c 756d 6529 0a20 2020 2020 2020 2072  olume).        r
-000204e0: 6563 656e 7420 3d20 6461 7461 2e68 6561  ecent = data.hea
-000204f0: 6428 3129 0a20 2020 2020 2020 2069 6620  d(1).        if 
-00020500: 6c65 6e28 7265 6365 6e74 2920 3c20 313a  len(recent) < 1:
-00020510: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00020520: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00020530: 2020 6966 2028 7265 6365 6e74 5b22 566f    if (recent["Vo
-00020540: 6c75 6d65 225d 2e69 6c6f 635b 305d 203c  lume"].iloc[0] <
-00020550: 3d20 6461 7461 2e64 6573 6372 6962 6528  = data.describe(
-00020560: 295b 2256 6f6c 756d 6522 5d5b 226d 696e  )["Volume"]["min
-00020570: 225d 2920 616e 6420 7265 6365 6e74 5b0a  "]) and recent[.
-00020580: 2020 2020 2020 2020 2020 2020 2256 6f6c              "Vol
-00020590: 756d 6522 0a20 2020 2020 2020 205d 5b30  ume".        ][0
-000205a0: 5d20 213d 206e 702e 6e61 6e3a 0a20 2020  ] != np.nan:.   
-000205b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000205c0: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-000205d0: 7572 6e20 4661 6c73 650a 0a20 2020 2023  urn False..    #
-000205e0: 2056 616c 6964 6174 6520 4c54 5020 7769   Validate LTP wi
-000205f0: 7468 696e 206c 696d 6974 730a 2020 2020  thin limits.    
-00020600: 6465 6620 7661 6c69 6461 7465 4c54 5028  def validateLTP(
-00020610: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
-00020620: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
-00020630: 6d69 6e4c 5450 3d4e 6f6e 652c 206d 6178  minLTP=None, max
-00020640: 4c54 503d 4e6f 6e65 2c6d 696e 4368 616e  LTP=None,minChan
-00020650: 6765 3d30 293a 0a20 2020 2020 2020 2064  ge=0):.        d
-00020660: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-00020670: 2020 2020 2020 2020 6c74 7056 616c 6964          ltpValid
-00020680: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00020690: 2069 6620 6d69 6e4c 5450 2069 7320 4e6f   if minLTP is No
-000206a0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000206b0: 6d69 6e4c 5450 203d 2073 656c 662e 636f  minLTP = self.co
-000206c0: 6e66 6967 4d61 6e61 6765 722e 6d69 6e4c  nfigManager.minL
-000206d0: 5450 0a20 2020 2020 2020 2069 6620 6d61  TP.        if ma
-000206e0: 784c 5450 2069 7320 4e6f 6e65 3a0a 2020  xLTP is None:.  
-000206f0: 2020 2020 2020 2020 2020 6d61 784c 5450            maxLTP
-00020700: 203d 2073 656c 662e 636f 6e66 6967 4d61   = self.configMa
-00020710: 6e61 6765 722e 6d61 784c 5450 0a20 2020  nager.maxLTP.   
-00020720: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00020730: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-00020740: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-00020750: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-00020760: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-00020770: 2020 2020 2072 6563 656e 7420 3d20 6461       recent = da
-00020780: 7461 2e68 6561 6428 3129 0a0a 2020 2020  ta.head(1)..    
-00020790: 2020 2020 7063 745f 6368 616e 6765 203d      pct_change =
-000207a0: 2028 6461 7461 5b3a 3a2d 315d 5b22 436c   (data[::-1]["Cl
-000207b0: 6f73 6522 5d2e 7063 745f 6368 616e 6765  ose"].pct_change
-000207c0: 2829 202a 2031 3030 292e 696c 6f63 5b2d  () * 100).iloc[-
-000207d0: 315d 0a20 2020 2020 2020 2069 6620 7063  1].        if pc
-000207e0: 745f 6368 616e 6765 203d 3d20 6e70 2e69  t_change == np.i
-000207f0: 6e66 206f 7220 7063 745f 6368 616e 6765  nf or pct_change
-00020800: 203d 3d20 2d6e 702e 696e 663a 0a20 2020   == -np.inf:.   
-00020810: 2020 2020 2020 2020 2070 6374 5f63 6861           pct_cha
-00020820: 6e67 6520 3d20 300a 2020 2020 2020 2020  nge = 0.        
-00020830: 7063 745f 7361 7665 203d 2022 252e 3166  pct_save = "%.1f
-00020840: 2525 2220 2520 7063 745f 6368 616e 6765  %%" % pct_change
-00020850: 0a20 2020 2020 2020 2069 6620 7063 745f  .        if pct_
-00020860: 6368 616e 6765 203e 2030 2e32 3a0a 2020  change > 0.2:.  
-00020870: 2020 2020 2020 2020 2020 7063 745f 6368            pct_ch
-00020880: 616e 6765 203d 2063 6f6c 6f72 5465 7874  ange = colorText
-00020890: 2e47 5245 454e 202b 2028 2225 2e31 6625  .GREEN + ("%.1f%
-000208a0: 2522 2025 2070 6374 5f63 6861 6e67 6529  %" % pct_change)
-000208b0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-000208c0: 0a20 2020 2020 2020 2065 6c69 6620 7063  .        elif pc
-000208d0: 745f 6368 616e 6765 203c 202d 302e 323a  t_change < -0.2:
-000208e0: 0a20 2020 2020 2020 2020 2020 2070 6374  .            pct
-000208f0: 5f63 6861 6e67 6520 3d20 636f 6c6f 7254  _change = colorT
-00020900: 6578 742e 4641 494c 202b 2028 2225 2e31  ext.FAIL + ("%.1
-00020910: 6625 2522 2025 2070 6374 5f63 6861 6e67  f%%" % pct_chang
-00020920: 6529 202b 2063 6f6c 6f72 5465 7874 2e45  e) + colorText.E
-00020930: 4e44 0a20 2020 2020 2020 2065 6c73 653a  ND.        else:
-00020940: 0a20 2020 2020 2020 2020 2020 2070 6374  .            pct
-00020950: 5f63 6861 6e67 6520 3d20 636f 6c6f 7254  _change = colorT
-00020960: 6578 742e 5741 524e 202b 2028 2225 2e31  ext.WARN + ("%.1
-00020970: 6625 2522 2025 2070 6374 5f63 6861 6e67  f%%" % pct_chang
-00020980: 6529 202b 2063 6f6c 6f72 5465 7874 2e45  e) + colorText.E
-00020990: 4e44 0a20 2020 2020 2020 2073 6176 6544  ND.        saveD
-000209a0: 6963 745b 2225 4368 6e67 225d 203d 2070  ict["%Chng"] = p
-000209b0: 6374 5f73 6176 650a 2020 2020 2020 2020  ct_save.        
-000209c0: 7363 7265 656e 4469 6374 5b22 2543 686e  screenDict["%Chn
-000209d0: 6722 5d20 3d20 7063 745f 6368 616e 6765  g"] = pct_change
-000209e0: 0a20 2020 2020 2020 206c 7470 203d 2072  .        ltp = r
-000209f0: 6f75 6e64 2872 6563 656e 745b 2243 6c6f  ound(recent["Clo
-00020a00: 7365 225d 2e69 6c6f 635b 305d 2c20 3229  se"].iloc[0], 2)
-00020a10: 0a20 2020 2020 2020 2076 6572 6966 7953  .        verifyS
-00020a20: 7461 6765 5477 6f20 3d20 5472 7565 0a20  tageTwo = True. 
-00020a30: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
-00020a40: 7461 2920 3e20 3235 303a 0a20 2020 2020  ta) > 250:.     
-00020a50: 2020 2020 2020 2079 6561 726c 794c 6f77         yearlyLow
-00020a60: 203d 2064 6174 612e 6865 6164 2832 3530   = data.head(250
-00020a70: 295b 2243 6c6f 7365 225d 2e6d 696e 2829  )["Close"].min()
-00020a80: 0a20 2020 2020 2020 2020 2020 2079 6561  .            yea
-00020a90: 726c 7948 6967 6820 3d20 6461 7461 2e68  rlyHigh = data.h
-00020aa0: 6561 6428 3235 3029 5b22 436c 6f73 6522  ead(250)["Close"
-00020ab0: 5d2e 6d61 7828 290a 2020 2020 2020 2020  ].max().        
-00020ac0: 2020 2020 6966 206c 7470 203c 2028 3220      if ltp < (2 
-00020ad0: 2a20 7965 6172 6c79 4c6f 7729 2061 6e64  * yearlyLow) and
-00020ae0: 206c 7470 203c 2028 302e 3735 202a 2079   ltp < (0.75 * y
-00020af0: 6561 726c 7948 6967 6829 3a0a 2020 2020  earlyHigh):.    
-00020b00: 2020 2020 2020 2020 2020 2020 7665 7269              veri
-00020b10: 6679 5374 6167 6554 776f 203d 2046 616c  fyStageTwo = Fal
-00020b20: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00020b30: 2020 2073 6372 6565 6e44 6963 745b 2253     screenDict["S
-00020b40: 746f 636b 225d 203d 2063 6f6c 6f72 5465  tock"] = colorTe
-00020b50: 7874 2e46 4149 4c20 2b20 7361 7665 4469  xt.FAIL + saveDi
-00020b60: 6374 5b22 5374 6f63 6b22 5d20 2b20 636f  ct["Stock"] + co
-00020b70: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-00020b80: 2020 2020 6966 206c 7470 203e 3d20 6d69      if ltp >= mi
-00020b90: 6e4c 5450 2061 6e64 206c 7470 203c 3d20  nLTP and ltp <= 
-00020ba0: 6d61 784c 5450 3a0a 2020 2020 2020 2020  maxLTP:.        
-00020bb0: 2020 2020 6c74 7056 616c 6964 203d 2054      ltpValid = T
-00020bc0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00020bd0: 6966 206d 696e 4368 616e 6765 2021 3d20  if minChange != 
-00020be0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00020bf0: 2020 2023 2055 7365 7220 6861 7320 7375     # User has su
-00020c00: 7070 6c69 6564 2073 6f6d 6520 6669 6c74  pplied some filt
-00020c10: 6572 2066 6f72 2070 6572 6365 6e74 6167  er for percentag
-00020c20: 6520 6368 616e 6765 0a20 2020 2020 2020  e change.       
-00020c30: 2020 2020 2020 2020 206c 7470 5661 6c69           ltpVali
-00020c40: 6420 3d20 666c 6f61 7428 7374 7228 7063  d = float(str(pc
-00020c50: 745f 7361 7665 292e 7265 706c 6163 6528  t_save).replace(
-00020c60: 2225 222c 2222 2929 203e 3d20 6d69 6e43  "%","")) >= minC
-00020c70: 6861 6e67 650a 2020 2020 2020 2020 2020  hange.          
-00020c80: 2020 7361 7665 4469 6374 5b22 4c54 5022    saveDict["LTP"
-00020c90: 5d20 3d20 726f 756e 6428 6c74 702c 2032  ] = round(ltp, 2
-00020ca0: 290a 2020 2020 2020 2020 2020 2020 7363  ).            sc
-00020cb0: 7265 656e 4469 6374 5b22 4c54 5022 5d20  reenDict["LTP"] 
-00020cc0: 3d20 2863 6f6c 6f72 5465 7874 2e47 5245  = (colorText.GRE
-00020cd0: 454e 2069 6620 6c74 7056 616c 6964 2065  EN if ltpValid e
-00020ce0: 6c73 6520 636f 6c6f 7254 6578 742e 4641  lse colorText.FA
-00020cf0: 494c 2920 2b20 2822 252e 3266 2220 2520  IL) + ("%.2f" % 
-00020d00: 6c74 7029 202b 2063 6f6c 6f72 5465 7874  ltp) + colorText
-00020d10: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-00020d20: 2072 6574 7572 6e20 6c74 7056 616c 6964   return ltpValid
-00020d30: 2c20 7665 7269 6679 5374 6167 6554 776f  , verifyStageTwo
-00020d40: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
-00020d50: 6963 745b 224c 5450 225d 203d 2063 6f6c  ict["LTP"] = col
-00020d60: 6f72 5465 7874 2e46 4149 4c20 2b20 2822  orText.FAIL + ("
-00020d70: 252e 3266 2220 2520 6c74 7029 202b 2063  %.2f" % ltp) + c
-00020d80: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00020d90: 2020 2020 2073 6176 6544 6963 745b 224c       saveDict["L
-00020da0: 5450 225d 203d 2072 6f75 6e64 286c 7470  TP"] = round(ltp
-00020db0: 2c20 3229 0a20 2020 2020 2020 2072 6574  , 2).        ret
-00020dc0: 7572 6e20 6c74 7056 616c 6964 2c20 7665  urn ltpValid, ve
-00020dd0: 7269 6679 5374 6167 6554 776f 0a0a 2020  rifyStageTwo..  
-00020de0: 2020 6465 6620 7661 6c69 6461 7465 4c54    def validateLT
-00020df0: 5046 6f72 506f 7274 666f 6c69 6f43 616c  PForPortfolioCal
-00020e00: 6328 7365 6c66 2c20 6466 2c20 7363 7265  c(self, df, scre
-00020e10: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-00020e20: 2c72 6571 7565 7374 6564 5065 7269 6f64  ,requestedPeriod
-00020e30: 3d30 293a 0a20 2020 2020 2020 2064 6174  =0):.        dat
-00020e40: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-00020e50: 2020 2020 2020 7065 7269 6f64 7320 3d20        periods = 
-00020e60: 7365 6c66 2e63 6f6e 6669 674d 616e 6167  self.configManag
-00020e70: 6572 2e70 6572 696f 6473 5261 6e67 650a  er.periodsRange.
-00020e80: 2020 2020 2020 2020 6966 2072 6571 7565          if reque
-00020e90: 7374 6564 5065 7269 6f64 203e 2030 2061  stedPeriod > 0 a
-00020ea0: 6e64 2072 6571 7565 7374 6564 5065 7269  nd requestedPeri
-00020eb0: 6f64 206e 6f74 2069 6e20 7065 7269 6f64  od not in period
-00020ec0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00020ed0: 6572 696f 6473 2e61 7070 656e 6428 7265  eriods.append(re
-00020ee0: 7175 6573 7465 6450 6572 696f 6429 0a20  questedPeriod). 
-00020ef0: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
-00020f00: 7265 6365 6e74 203d 2064 6174 612e 6865  recent = data.he
-00020f10: 6164 2831 290a 2020 2020 2020 2020 7072  ad(1).        pr
-00020f20: 6576 696f 7573 5f72 6563 656e 742e 7265  evious_recent.re
-00020f30: 7365 745f 696e 6465 7828 696e 706c 6163  set_index(inplac
-00020f40: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00020f50: 6361 6c63 5f64 6174 6520 3d20 7374 7228  calc_date = str(
-00020f60: 7072 6576 696f 7573 5f72 6563 656e 742e  previous_recent.
-00020f70: 696c 6f63 5b3a 2c20 305d 5b30 5d29 2e73  iloc[:, 0][0]).s
-00020f80: 706c 6974 2822 2022 295b 305d 0a20 2020  plit(" ")[0].   
-00020f90: 2020 2020 2066 6f72 2070 7264 2069 6e20       for prd in 
-00020fa0: 7065 7269 6f64 733a 0a20 2020 2020 2020  periods:.       
-00020fb0: 2020 2020 2069 6620 6c65 6e28 6461 7461       if len(data
-00020fc0: 2920 3e3d 2070 7264 202b 2031 3a0a 2020  ) >= prd + 1:.  
-00020fd0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00020fe0: 6576 4c74 7020 3d20 6461 7461 5b22 436c  evLtp = data["Cl
-00020ff0: 6f73 6522 5d2e 696c 6f63 5b30 5d0a 2020  ose"].iloc[0].  
-00021000: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
-00021010: 7054 6479 203d 2064 6174 615b 2243 6c6f  pTdy = data["Clo
-00021020: 7365 225d 2e69 6c6f 635b 7072 645d 0a20  se"].iloc[prd]. 
-00021030: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021040: 6620 6973 696e 7374 616e 6365 2870 7265  f isinstance(pre
-00021050: 764c 7470 2c70 642e 5365 7269 6573 293a  vLtp,pd.Series):
-00021060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021070: 2020 2020 2070 7265 764c 7470 203d 2070       prevLtp = p
-00021080: 7265 764c 7470 5b30 5d0a 2020 2020 2020  revLtp[0].      
-00021090: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
-000210a0: 7054 6479 203d 206c 7470 5464 795b 305d  pTdy = ltpTdy[0]
+0001e9b0: 2020 2020 2020 2073 6176 6564 5b30 5d0a         saved[0].
+0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9d0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001e9e0: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+0001e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea00: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0001ea10: 5465 7874 2e57 4152 4e0a 2020 2020 2020  Text.WARN.      
+0001ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea30: 2020 2020 2020 2b20 2822 496e 7369 6465        + ("Inside
+0001ea40: 2042 6172 2028 2564 2922 2025 2069 290a   Bar (%d)" % i).
+0001ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea60: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001ea70: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+0001ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001eaa0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0001eab0: 7665 4469 6374 5b22 5061 7474 6572 6e22  veDict["Pattern"
+0001eac0: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
+0001ead0: 496e 7369 6465 2042 6172 2028 2564 2922  Inside Bar (%d)"
+0001eae0: 2025 2069 0a20 2020 2020 2020 2020 2020   % i.           
+0001eaf0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001eb00: 7572 6e20 690a 2020 2020 2020 2020 2020  urn i.          
+0001eb10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb30: 7265 7475 726e 2030 0a20 2020 2020 2020  return 0.       
+0001eb40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001eb50: 2020 2020 2020 2020 2020 2069 6620 2244             if "D
+0001eb60: 6f77 6e22 2069 6e20 7361 7665 4469 6374  own" in saveDict
+0001eb70: 5b22 5472 656e 6422 5d20 616e 6420 280a  ["Trend"] and (.
+0001eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb90: 2020 2020 2242 6561 7222 2069 6e20 7361      "Bear" in sa
+0001eba0: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+0001ebb0: 6c22 5d20 6f72 2022 5265 7369 7374 2220  l"] or "Resist" 
+0001ebc0: 696e 2073 6176 6544 6963 745b 224d 412d  in saveDict["MA-
+0001ebd0: 5369 676e 616c 225d 0a20 2020 2020 2020  Signal"].       
+0001ebe0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+0001ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec00: 6461 7461 203d 206f 7267 4461 7461 2e68  data = orgData.h
+0001ec10: 6561 6428 6929 0a20 2020 2020 2020 2020  ead(i).         
+0001ec20: 2020 2020 2020 2020 2020 2072 6566 4361             refCa
+0001ec30: 6e64 6c65 203d 2064 6174 612e 7461 696c  ndle = data.tail
+0001ec40: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+0001ec50: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+0001ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec70: 2020 2020 2028 6c65 6e28 6461 7461 2e48       (len(data.H
+0001ec80: 6967 685b 6461 7461 2e48 6967 6820 3e20  igh[data.High > 
+0001ec90: 7265 6643 616e 646c 652e 4869 6768 2e69  refCandle.High.i
+0001eca0: 7465 6d28 295d 2920 3d3d 2030 290a 2020  tem()]) == 0).  
+0001ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecc0: 2020 2020 2020 616e 6420 286c 656e 2864        and (len(d
+0001ecd0: 6174 612e 4c6f 775b 6461 7461 2e4c 6f77  ata.Low[data.Low
+0001ece0: 203c 2072 6566 4361 6e64 6c65 2e4c 6f77   < refCandle.Low
+0001ecf0: 2e69 7465 6d28 295d 2920 3d3d 2030 290a  .item()]) == 0).
+0001ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed10: 2020 2020 2020 2020 616e 6420 286c 656e          and (len
+0001ed20: 2864 6174 612e 4f70 656e 5b64 6174 612e  (data.Open[data.
+0001ed30: 4f70 656e 203e 2072 6566 4361 6e64 6c65  Open > refCandle
+0001ed40: 2e48 6967 682e 6974 656d 2829 5d29 203d  .High.item()]) =
+0001ed50: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
+0001ed60: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0001ed70: 2028 6c65 6e28 6461 7461 2e43 6c6f 7365   (len(data.Close
+0001ed80: 5b64 6174 612e 436c 6f73 6520 3c20 7265  [data.Close < re
+0001ed90: 6643 616e 646c 652e 4c6f 772e 6974 656d  fCandle.Low.item
+0001eda0: 2829 5d29 203d 3d20 3029 0a20 2020 2020  ()]) == 0).     
+0001edb0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001edc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001edd0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+0001ede0: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+0001edf0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0001ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee10: 7361 7665 645b 305d 0a20 2020 2020 2020  saved[0].       
+0001ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee30: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001ee40: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0001ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee60: 2020 2b20 636f 6c6f 7254 6578 742e 5741    + colorText.WA
+0001ee70: 524e 0a20 2020 2020 2020 2020 2020 2020  RN.             
+0001ee80: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001ee90: 2028 2249 6e73 6964 6520 4261 7220 2825   ("Inside Bar (%
+0001eea0: 6429 2220 2520 6929 0a20 2020 2020 2020  d)" % i).       
+0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eec0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001eed0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0001eee0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef00: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+0001ef10: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+0001ef20: 6564 5b31 5d20 2b20 2249 6e73 6964 6520  ed[1] + "Inside 
+0001ef30: 4261 7220 2825 6429 2220 2520 690a 2020  Bar (%d)" % i.  
+0001ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef50: 2020 2020 2020 7265 7475 726e 2069 0a20        return i. 
+0001ef60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001ef70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001ef80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ef90: 300a 2020 2020 2020 2020 7265 7475 726e  0.        return
+0001efa0: 2030 0a0a 2020 2020 2320 4669 6e64 2049   0..    # Find I
+0001efb0: 504f 2062 6173 650a 2020 2020 6465 6620  PO base.    def 
+0001efc0: 7661 6c69 6461 7465 4970 6f42 6173 6528  validateIpoBase(
+0001efd0: 7365 6c66 2c20 7374 6f63 6b2c 2064 662c  self, stock, df,
+0001efe0: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
+0001eff0: 6544 6963 742c 2070 6572 6365 6e74 6167  eDict, percentag
+0001f000: 653d 302e 3329 3a0a 2020 2020 2020 2020  e=0.3):.        
+0001f010: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
+0001f020: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
+0001f030: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001f040: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001f050: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+0001f060: 0a20 2020 2020 2020 206c 6973 7469 6e67  .        listing
+0001f070: 5072 6963 6520 3d20 6461 7461 5b3a 3a2d  Price = data[::-
+0001f080: 315d 2e68 6561 6428 3129 5b22 4f70 656e  1].head(1)["Open
+0001f090: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+0001f0a0: 2020 2063 7572 7265 6e74 5072 6963 6520     currentPrice 
+0001f0b0: 3d20 6461 7461 2e68 6561 6428 3129 5b22  = data.head(1)["
+0001f0c0: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d0a  Close"].iloc[0].
+0001f0d0: 2020 2020 2020 2020 4154 4820 3d20 6461          ATH = da
+0001f0e0: 7461 2e64 6573 6372 6962 6528 295b 2248  ta.describe()["H
+0001f0f0: 6967 6822 5d5b 226d 6178 225d 0a20 2020  igh"]["max"].   
+0001f100: 2020 2020 2069 6620 4154 4820 3e20 286c       if ATH > (l
+0001f110: 6973 7469 6e67 5072 6963 6520 2b20 286c  istingPrice + (l
+0001f120: 6973 7469 6e67 5072 6963 6520 2a20 7065  istingPrice * pe
+0001f130: 7263 656e 7461 6765 2929 3a0a 2020 2020  rcentage)):.    
+0001f140: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001f150: 616c 7365 0a20 2020 2020 2020 2061 7761  alse.        awa
+0001f160: 7920 3d20 726f 756e 6428 2828 6375 7272  y = round(((curr
+0001f170: 656e 7450 7269 6365 202d 206c 6973 7469  entPrice - listi
+0001f180: 6e67 5072 6963 6529 202f 206c 6973 7469  ngPrice) / listi
+0001f190: 6e67 5072 6963 6529 202a 2031 3030 2c20  ngPrice) * 100, 
+0001f1a0: 3129 0a20 2020 2020 2020 2069 6620 280a  1).        if (.
+0001f1b0: 2020 2020 2020 2020 2020 2020 286c 6973              (lis
+0001f1c0: 7469 6e67 5072 6963 6520 2d20 286c 6973  tingPrice - (lis
+0001f1d0: 7469 6e67 5072 6963 6520 2a20 7065 7263  tingPrice * perc
+0001f1e0: 656e 7461 6765 2929 0a20 2020 2020 2020  entage)).       
+0001f1f0: 2020 2020 203c 3d20 6375 7272 656e 7450       <= currentP
+0001f200: 7269 6365 0a20 2020 2020 2020 2020 2020  rice.           
+0001f210: 203c 3d20 286c 6973 7469 6e67 5072 6963   <= (listingPric
+0001f220: 6520 2b20 286c 6973 7469 6e67 5072 6963  e + (listingPric
+0001f230: 6520 2a20 7065 7263 656e 7461 6765 2929  e * percentage))
+0001f240: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+0001f250: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
+0001f260: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
+0001f270: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
+0001f280: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
+0001f290: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
+0001f2a0: 2020 2020 2020 2020 6966 2061 7761 7920          if away 
+0001f2b0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0001f2c0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+0001f2d0: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
+0001f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2f0: 2020 2073 6176 6564 5b30 5d20 0a20 2020     saved[0] .   
+0001f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f310: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+0001f320: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001f330: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0001f340: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
+0001f350: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+0001f360: 4950 4f20 4261 7365 2028 7b61 7761 797d  IPO Base ({away}
+0001f370: 2025 2922 0a20 2020 2020 2020 2020 2020   %)".           
+0001f380: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0001f390: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0001f3a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001f3b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f3c0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0001f3d0: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
+0001f3e0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0001f3f0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+0001f400: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0001f410: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
+0001f420: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
+0001f430: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0001f440: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+0001f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f460: 2020 202b 2022 4950 4f20 4261 7365 2022     + "IPO Base "
+0001f470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f480: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001f490: 2e46 4149 4c0a 2020 2020 2020 2020 2020  .FAIL.          
+0001f4a0: 2020 2020 2020 2020 2020 2b20 6622 287b            + f"({
+0001f4b0: 6177 6179 7d20 2529 220a 2020 2020 2020  away} %)".      
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001f4d0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0001f4e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001f4f0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+0001f500: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+0001f510: 3d20 7361 7665 645b 315d 202b 2066 2249  = saved[1] + f"I
+0001f520: 504f 2042 6173 6520 287b 6177 6179 7d20  PO Base ({away} 
+0001f530: 2529 220a 2020 2020 2020 2020 2020 2020  %)".            
+0001f540: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+0001f550: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001f560: 0a0a 2020 2020 2340 6d65 6173 7572 655f  ..    #@measure_
+0001f570: 7469 6d65 0a20 2020 2023 2056 616c 6964  time.    # Valid
+0001f580: 6174 6520 4c6f 7265 6e74 7a69 616e 2043  ate Lorentzian C
+0001f590: 6c61 7373 6966 6963 6174 696f 6e20 7369  lassification si
+0001f5a0: 676e 616c 0a20 2020 2064 6566 2076 616c  gnal.    def val
+0001f5b0: 6964 6174 654c 6f72 656e 747a 6961 6e28  idateLorentzian(
+0001f5c0: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+0001f5d0: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+0001f5e0: 6c6f 6f6b 466f 723d 3329 3a0a 2020 2020  lookFor=3):.    
+0001f5f0: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+0001f600: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+0001f610: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0001f620: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0001f630: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+0001f640: 7079 2829 0a20 2020 2020 2020 2023 206c  py().        # l
+0001f650: 6f6f 6b46 6f72 3a20 312d 4275 792c 2032  ookFor: 1-Buy, 2
+0001f660: 2d53 656c 6c2c 2033 2d41 6e79 0a20 2020  -Sell, 3-Any.   
+0001f670: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+0001f680: 5b3a 3a2d 315d 2020 2320 5265 7665 7273  [::-1]  # Revers
+0001f690: 6520 7468 6520 6461 7461 6672 616d 650a  e the dataframe.
+0001f6a0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0001f6b0: 6174 612e 7265 6e61 6d65 280a 2020 2020  ata.rename(.    
+0001f6c0: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+0001f6d0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001f6e0: 2020 224f 7065 6e22 3a20 226f 7065 6e22    "Open": "open"
+0001f6f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f700: 2020 2243 6c6f 7365 223a 2022 636c 6f73    "Close": "clos
+0001f710: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+0001f720: 2020 2020 2248 6967 6822 3a20 2268 6967      "High": "hig
+0001f730: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+0001f740: 2020 2020 224c 6f77 223a 2022 6c6f 7722      "Low": "low"
+0001f750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f760: 2020 2256 6f6c 756d 6522 3a20 2276 6f6c    "Volume": "vol
+0001f770: 756d 6522 2c0a 2020 2020 2020 2020 2020  ume",.          
+0001f780: 2020 7d0a 2020 2020 2020 2020 290a 2020    }.        ).  
+0001f790: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001f7a0: 2020 2020 2020 2077 6974 6820 5375 7070         with Supp
+0001f7b0: 7265 7373 4f75 7470 7574 2873 7570 7072  ressOutput(suppr
+0001f7c0: 6573 735f 7374 646f 7574 3d54 7275 652c  ess_stdout=True,
+0001f7d0: 2073 7570 7072 6573 735f 7374 6465 7272   suppress_stderr
+0001f7e0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0001f7f0: 2020 2020 2020 2020 6c63 203d 2061 7461          lc = ata
+0001f800: 2e4c 6f72 656e 747a 6961 6e43 6c61 7373  .LorentzianClass
+0001f810: 6966 6963 6174 696f 6e28 6461 7461 3d64  ification(data=d
+0001f820: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
+0001f830: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
+0001f840: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+0001f850: 6c75 6528 7363 7265 656e 4469 6374 2c20  lue(screenDict, 
+0001f860: 7361 7665 4469 6374 2c20 2250 6174 7465  saveDict, "Patte
+0001f870: 726e 2229 0a20 2020 2020 2020 2020 2020  rn").           
+0001f880: 2069 6620 6c63 2e64 662e 696c 6f63 5b2d   if lc.df.iloc[-
+0001f890: 315d 5b22 6973 4e65 7742 7579 5369 676e  1]["isNewBuySign
+0001f8a0: 616c 225d 3a0a 2020 2020 2020 2020 2020  al"]:.          
+0001f8b0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+0001f8c0: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
+0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8e0: 2020 2020 7361 7665 645b 305d 202b 2063      saved[0] + c
+0001f8f0: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+0001f900: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
+0001f910: 2b20 224c 6f72 656e 747a 6961 6e2d 4275  + "Lorentzian-Bu
+0001f920: 7922 202b 2063 6f6c 6f72 5465 7874 2e45  y" + colorText.E
+0001f930: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001f940: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001f950: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
+0001f960: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
+0001f970: 5b31 5d20 2b20 224c 6f72 656e 747a 6961  [1] + "Lorentzia
+0001f980: 6e2d 4275 7922 0a20 2020 2020 2020 2020  n-Buy".         
+0001f990: 2020 2020 2020 2069 6620 6c6f 6f6b 466f         if lookFo
+0001f9a0: 7220 213d 2032 3a20 2320 4e6f 7420 5365  r != 2: # Not Se
+0001f9b0: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
+0001f9c0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001f9d0: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
+0001f9e0: 6c69 6620 6c63 2e64 662e 696c 6f63 5b2d  lif lc.df.iloc[-
+0001f9f0: 315d 5b22 6973 4e65 7753 656c 6c53 6967  1]["isNewSellSig
+0001fa00: 6e61 6c22 5d3a 0a20 2020 2020 2020 2020  nal"]:.         
+0001fa10: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0001fa20: 745b 2250 6174 7465 726e 225d 203d 2028  t["Pattern"] = (
+0001fa30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fa40: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
+0001fa50: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
+0001fa60: 2063 6f6c 6f72 5465 7874 2e46 4149 4c20   colorText.FAIL 
+0001fa70: 2b20 224c 6f72 656e 747a 6961 6e2d 5365  + "Lorentzian-Se
+0001fa80: 6c6c 2220 2b20 636f 6c6f 7254 6578 742e  ll" + colorText.
+0001fa90: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0001faa0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001fab0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+0001fac0: 5061 7474 6572 6e22 5d20 3d20 7361 7665  Pattern"] = save
+0001fad0: 645b 315d 202b 2022 4c6f 7265 6e74 7a69  d[1] + "Lorentzi
+0001fae0: 616e 2d53 656c 6c22 0a20 2020 2020 2020  an-Sell".       
+0001faf0: 2020 2020 2020 2020 2069 6620 6c6f 6f6b           if look
+0001fb00: 466f 7220 213d 2031 3a20 2320 4e6f 7420  For != 1: # Not 
+0001fb10: 4275 790a 2020 2020 2020 2020 2020 2020  Buy.            
+0001fb20: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001fb30: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
+0001fb40: 7074 2045 7863 6570 7469 6f6e 3a20 2023  pt Exception:  #
+0001fb50: 2070 7261 676d 613a 206e 6f20 636f 7665   pragma: no cove
+0001fb60: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
+0001fb70: 5661 6c75 6545 7272 6f72 3a20 6f70 6572  ValueError: oper
+0001fb80: 616e 6473 2063 6f75 6c64 206e 6f74 2062  ands could not b
+0001fb90: 6520 6272 6f61 6463 6173 7420 746f 6765  e broadcast toge
+0001fba0: 7468 6572 2077 6974 6820 7368 6170 6573  ther with shapes
+0001fbb0: 2028 3230 2c29 2028 3236 2c29 0a20 2020   (20,) (26,).   
+0001fbc0: 2020 2020 2020 2020 2023 2046 696c 6520           # File 
+0001fbd0: 222f 6f70 742f 686f 6d65 6272 6577 2f6c  "/opt/homebrew/l
+0001fbe0: 6962 2f70 7974 686f 6e33 2e31 312f 7369  ib/python3.11/si
+0001fbf0: 7465 2d70 6163 6b61 6765 732f 6164 7661  te-packages/adva
+0001fc00: 6e63 6564 5f74 612f 4c6f 7265 6e74 7a69  nced_ta/Lorentzi
+0001fc10: 616e 436c 6173 7369 6669 6361 7469 6f6e  anClassification
+0001fc20: 2f43 6c61 7373 6966 6965 722e 7079 222c  /Classifier.py",
+0001fc30: 206c 696e 6520 3138 362c 2069 6e20 5f5f   line 186, in __
+0001fc40: 696e 6974 5f5f 0a20 2020 2020 2020 2020  init__.         
+0001fc50: 2020 2023 2046 696c 6520 222f 6f70 742f     # File "/opt/
+0001fc60: 686f 6d65 6272 6577 2f6c 6962 2f70 7974  homebrew/lib/pyt
+0001fc70: 686f 6e33 2e31 312f 7369 7465 2d70 6163  hon3.11/site-pac
+0001fc80: 6b61 6765 732f 6164 7661 6e63 6564 5f74  kages/advanced_t
+0001fc90: 612f 4c6f 7265 6e74 7a69 616e 436c 6173  a/LorentzianClas
+0001fca0: 7369 6669 6361 7469 6f6e 2f43 6c61 7373  sification/Class
+0001fcb0: 6966 6965 722e 7079 222c 206c 696e 6520  ifier.py", line 
+0001fcc0: 3339 352c 2069 6e20 5f5f 636c 6173 7369  395, in __classi
+0001fcd0: 6679 0a20 2020 2020 2020 2020 2020 2023  fy.            #
+0001fce0: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
+0001fcf0: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
+0001fd00: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
+0001fd10: 732f 7061 6e64 6173 2f63 6f72 652f 6f70  s/pandas/core/op
+0001fd20: 732f 636f 6d6d 6f6e 2e70 7922 2c20 6c69  s/common.py", li
+0001fd30: 6e65 2037 362c 2069 6e20 6e65 775f 6d65  ne 76, in new_me
+0001fd40: 7468 6f64 0a20 2020 2020 2020 2020 2020  thod.           
+0001fd50: 2023 2046 696c 6520 222f 6f70 742f 686f   # File "/opt/ho
+0001fd60: 6d65 6272 6577 2f6c 6962 2f70 7974 686f  mebrew/lib/pytho
+0001fd70: 6e33 2e31 312f 7369 7465 2d70 6163 6b61  n3.11/site-packa
+0001fd80: 6765 732f 7061 6e64 6173 2f63 6f72 652f  ges/pandas/core/
+0001fd90: 6172 7261 796c 696b 652e 7079 222c 206c  arraylike.py", l
+0001fda0: 696e 6520 3730 2c20 696e 205f 5f61 6e64  ine 70, in __and
+0001fdb0: 5f5f 0a20 2020 2020 2020 2020 2020 2023  __.            #
+0001fdc0: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
+0001fdd0: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
+0001fde0: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
+0001fdf0: 732f 7061 6e64 6173 2f63 6f72 652f 7365  s/pandas/core/se
+0001fe00: 7269 6573 2e70 7922 2c20 6c69 6e65 2035  ries.py", line 5
+0001fe10: 3831 302c 2069 6e20 5f6c 6f67 6963 616c  810, in _logical
+0001fe20: 5f6d 6574 686f 640a 2020 2020 2020 2020  _method.        
+0001fe30: 2020 2020 2320 4669 6c65 2022 2f6f 7074      # File "/opt
+0001fe40: 2f68 6f6d 6562 7265 772f 6c69 622f 7079  /homebrew/lib/py
+0001fe50: 7468 6f6e 332e 3131 2f73 6974 652d 7061  thon3.11/site-pa
+0001fe60: 636b 6167 6573 2f70 616e 6461 732f 636f  ckages/pandas/co
+0001fe70: 7265 2f6f 7073 2f61 7272 6179 5f6f 7073  re/ops/array_ops
+0001fe80: 2e70 7922 2c20 6c69 6e65 2034 3536 2c20  .py", line 456, 
+0001fe90: 696e 206c 6f67 6963 616c 5f6f 700a 2020  in logical_op.  
+0001fea0: 2020 2020 2020 2020 2020 2320 4669 6c65            # File
+0001feb0: 2022 2f6f 7074 2f68 6f6d 6562 7265 772f   "/opt/homebrew/
+0001fec0: 6c69 622f 7079 7468 6f6e 332e 3131 2f73  lib/python3.11/s
+0001fed0: 6974 652d 7061 636b 6167 6573 2f70 616e  ite-packages/pan
+0001fee0: 6461 732f 636f 7265 2f6f 7073 2f61 7272  das/core/ops/arr
+0001fef0: 6179 5f6f 7073 2e70 7922 2c20 6c69 6e65  ay_ops.py", line
+0001ff00: 2033 3634 2c20 696e 206e 615f 6c6f 6769   364, in na_logi
+0001ff10: 6361 6c5f 6f70 0a20 2020 2020 2020 2020  cal_op.         
+0001ff20: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
+0001ff30: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
+0001ff40: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
+0001ff50: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0001ff60: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+0001ff70: 2046 616c 7365 0a0a 2020 2020 2320 7661   False..    # va
+0001ff80: 6c69 6461 7465 2069 6620 7468 6520 7374  lidate if the st
+0001ff90: 6f63 6b20 6861 7320 6265 656e 2068 6176  ock has been hav
+0001ffa0: 696e 6720 6c6f 7765 7220 6c6f 7773 2c20  ing lower lows, 
+0001ffb0: 6c6f 7765 7220 6869 6768 730a 2020 2020  lower highs.    
+0001ffc0: 6465 6620 7661 6c69 6461 7465 4c6f 7765  def validateLowe
+0001ffd0: 7248 6967 6873 4c6f 7765 724c 6f77 7328  rHighsLowerLows(
+0001ffe0: 7365 6c66 2c20 6466 293a 0a20 2020 2020  self, df):.     
+0001fff0: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+00020000: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+00020010: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00020020: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00020030: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+00020040: 7928 290a 2020 2020 2020 2020 6461 7930  y().        day0
+00020050: 203d 2064 6174 610a 2020 2020 2020 2020   = data.        
+00020060: 6461 7931 203d 2064 6174 615b 313a 5d0a  day1 = data[1:].
+00020070: 2020 2020 2020 2020 6461 7932 203d 2064          day2 = d
+00020080: 6174 615b 323a 5d0a 2020 2020 2020 2020  ata[2:].        
+00020090: 6461 7933 203d 2064 6174 615b 333a 5d0a  day3 = data[3:].
+000200a0: 2020 2020 2020 2020 6c6f 7765 7248 6967          lowerHig
+000200b0: 6873 203d 2028 0a20 2020 2020 2020 2020  hs = (.         
+000200c0: 2020 2028 6461 7930 5b22 4869 6768 225d     (day0["High"]
+000200d0: 2e69 6c6f 635b 305d 203c 2064 6179 315b  .iloc[0] < day1[
+000200e0: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
+000200f0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00020100: 2028 6461 7931 5b22 4869 6768 225d 2e69   (day1["High"].i
+00020110: 6c6f 635b 305d 203c 2064 6179 325b 2248  loc[0] < day2["H
+00020120: 6967 6822 5d2e 696c 6f63 5b30 5d29 0a20  igh"].iloc[0]). 
+00020130: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
+00020140: 6461 7932 5b22 4869 6768 225d 2e69 6c6f  day2["High"].ilo
+00020150: 635b 305d 203c 2064 6179 335b 2248 6967  c[0] < day3["Hig
+00020160: 6822 5d2e 696c 6f63 5b30 5d29 0a20 2020  h"].iloc[0]).   
+00020170: 2020 2020 2029 0a20 2020 2020 2020 206c       ).        l
+00020180: 6f77 6572 4c6f 7773 203d 2028 0a20 2020  owerLows = (.   
+00020190: 2020 2020 2020 2020 2028 6461 7930 5b22           (day0["
+000201a0: 4c6f 7722 5d2e 696c 6f63 5b30 5d20 3c20  Low"].iloc[0] < 
+000201b0: 6461 7931 5b22 4c6f 7722 5d2e 696c 6f63  day1["Low"].iloc
+000201c0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+000201d0: 2061 6e64 2028 6461 7931 5b22 4c6f 7722   and (day1["Low"
+000201e0: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7932  ].iloc[0] < day2
+000201f0: 5b22 4c6f 7722 5d2e 696c 6f63 5b30 5d29  ["Low"].iloc[0])
+00020200: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00020210: 2028 6461 7932 5b22 4c6f 7722 5d2e 696c   (day2["Low"].il
+00020220: 6f63 5b30 5d20 3c20 6461 7933 5b22 4c6f  oc[0] < day3["Lo
+00020230: 7722 5d2e 696c 6f63 5b30 5d29 0a20 2020  w"].iloc[0]).   
+00020240: 2020 2020 2029 0a20 2020 2020 2020 2068       ).        h
+00020250: 6967 6865 7252 5349 203d 2028 0a20 2020  igherRSI = (.   
+00020260: 2020 2020 2020 2020 2028 6461 7930 5b22           (day0["
+00020270: 5253 4922 5d2e 696c 6f63 5b30 5d20 3c20  RSI"].iloc[0] < 
+00020280: 6461 7931 5b22 5253 4922 5d2e 696c 6f63  day1["RSI"].iloc
+00020290: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+000202a0: 2061 6e64 2028 6461 7931 5b22 5253 4922   and (day1["RSI"
+000202b0: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7932  ].iloc[0] < day2
+000202c0: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d29  ["RSI"].iloc[0])
+000202d0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+000202e0: 2028 6461 7932 5b22 5253 4922 5d2e 696c   (day2["RSI"].il
+000202f0: 6f63 5b30 5d20 3c20 6461 7933 5b22 5253  oc[0] < day3["RS
+00020300: 4922 5d2e 696c 6f63 5b30 5d29 0a20 2020  I"].iloc[0]).   
+00020310: 2020 2020 2020 2020 2061 6e64 2064 6179           and day
+00020320: 305b 2252 5349 225d 2e69 6c6f 635b 305d  0["RSI"].iloc[0]
+00020330: 203e 3d20 3530 0a20 2020 2020 2020 2029   >= 50.        )
+00020340: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00020350: 6c6f 7765 7248 6967 6873 2061 6e64 206c  lowerHighs and l
+00020360: 6f77 6572 4c6f 7773 2061 6e64 2068 6967  owerLows and hig
+00020370: 6865 7252 5349 0a0a 2020 2020 2320 5661  herRSI..    # Va
+00020380: 6c69 6461 7465 2069 6620 7265 6365 6e74  lidate if recent
+00020390: 2076 6f6c 756d 6520 6973 206c 6f77 6573   volume is lowes
+000203a0: 7420 6f66 206c 6173 7420 274e 2720 4461  t of last 'N' Da
+000203b0: 7973 0a20 2020 2064 6566 2076 616c 6964  ys.    def valid
+000203c0: 6174 654c 6f77 6573 7456 6f6c 756d 6528  ateLowestVolume(
+000203d0: 7365 6c66 2c20 6466 2c20 6461 7973 466f  self, df, daysFo
+000203e0: 724c 6f77 6573 7456 6f6c 756d 6529 3a0a  rLowestVolume):.
+000203f0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00020400: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+00020410: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00020420: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00020430: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00020440: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+00020450: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+00020460: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
+00020470: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+00020480: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+00020490: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
+000204a0: 2069 6620 6461 7973 466f 724c 6f77 6573   if daysForLowes
+000204b0: 7456 6f6c 756d 6520 6973 204e 6f6e 653a  tVolume is None:
+000204c0: 0a20 2020 2020 2020 2020 2020 2064 6179  .            day
+000204d0: 7346 6f72 4c6f 7765 7374 566f 6c75 6d65  sForLowestVolume
+000204e0: 203d 2033 300a 2020 2020 2020 2020 6966   = 30.        if
+000204f0: 206c 656e 2864 6174 6129 203c 2064 6179   len(data) < day
+00020500: 7346 6f72 4c6f 7765 7374 566f 6c75 6d65  sForLowestVolume
+00020510: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00020520: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00020530: 2020 2064 6174 6120 3d20 6461 7461 2e68     data = data.h
+00020540: 6561 6428 6461 7973 466f 724c 6f77 6573  ead(daysForLowes
+00020550: 7456 6f6c 756d 6529 0a20 2020 2020 2020  tVolume).       
+00020560: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
+00020570: 6561 6428 3129 0a20 2020 2020 2020 2069  ead(1).        i
+00020580: 6620 6c65 6e28 7265 6365 6e74 2920 3c20  f len(recent) < 
+00020590: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
+000205a0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+000205b0: 2020 2020 6966 2028 7265 6365 6e74 5b22      if (recent["
+000205c0: 566f 6c75 6d65 225d 2e69 6c6f 635b 305d  Volume"].iloc[0]
+000205d0: 203c 3d20 6461 7461 2e64 6573 6372 6962   <= data.describ
+000205e0: 6528 295b 2256 6f6c 756d 6522 5d5b 226d  e()["Volume"]["m
+000205f0: 696e 225d 2920 616e 6420 7265 6365 6e74  in"]) and recent
+00020600: 5b0a 2020 2020 2020 2020 2020 2020 2256  [.            "V
+00020610: 6f6c 756d 6522 0a20 2020 2020 2020 205d  olume".        ]
+00020620: 5b30 5d20 213d 206e 702e 6e61 6e3a 0a20  [0] != np.nan:. 
+00020630: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00020640: 6e20 5472 7565 0a20 2020 2020 2020 2072  n True.        r
+00020650: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+00020660: 2023 2056 616c 6964 6174 6520 4c54 5020   # Validate LTP 
+00020670: 7769 7468 696e 206c 696d 6974 730a 2020  within limits.  
+00020680: 2020 6465 6620 7661 6c69 6461 7465 4c54    def validateLT
+00020690: 5028 7365 6c66 2c20 6466 2c20 7363 7265  P(self, df, scre
+000206a0: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+000206b0: 2c20 6d69 6e4c 5450 3d4e 6f6e 652c 206d  , minLTP=None, m
+000206c0: 6178 4c54 503d 4e6f 6e65 2c6d 696e 4368  axLTP=None,minCh
+000206d0: 616e 6765 3d30 293a 0a20 2020 2020 2020  ange=0):.       
+000206e0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+000206f0: 290a 2020 2020 2020 2020 6c74 7056 616c  ).        ltpVal
+00020700: 6964 203d 2046 616c 7365 0a20 2020 2020  id = False.     
+00020710: 2020 2069 6620 6d69 6e4c 5450 2069 7320     if minLTP is 
+00020720: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00020730: 2020 6d69 6e4c 5450 203d 2073 656c 662e    minLTP = self.
+00020740: 636f 6e66 6967 4d61 6e61 6765 722e 6d69  configManager.mi
+00020750: 6e4c 5450 0a20 2020 2020 2020 2069 6620  nLTP.        if 
+00020760: 6d61 784c 5450 2069 7320 4e6f 6e65 3a0a  maxLTP is None:.
+00020770: 2020 2020 2020 2020 2020 2020 6d61 784c              maxL
+00020780: 5450 203d 2073 656c 662e 636f 6e66 6967  TP = self.config
+00020790: 4d61 6e61 6765 722e 6d61 784c 5450 0a20  Manager.maxLTP. 
+000207a0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+000207b0: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+000207c0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+000207d0: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+000207e0: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+000207f0: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
+00020800: 6461 7461 2e68 6561 6428 3129 0a0a 2020  data.head(1)..  
+00020810: 2020 2020 2020 7063 745f 6368 616e 6765        pct_change
+00020820: 203d 2028 6461 7461 5b3a 3a2d 315d 5b22   = (data[::-1]["
+00020830: 436c 6f73 6522 5d2e 7063 745f 6368 616e  Close"].pct_chan
+00020840: 6765 2829 202a 2031 3030 292e 696c 6f63  ge() * 100).iloc
+00020850: 5b2d 315d 0a20 2020 2020 2020 2069 6620  [-1].        if 
+00020860: 7063 745f 6368 616e 6765 203d 3d20 6e70  pct_change == np
+00020870: 2e69 6e66 206f 7220 7063 745f 6368 616e  .inf or pct_chan
+00020880: 6765 203d 3d20 2d6e 702e 696e 663a 0a20  ge == -np.inf:. 
+00020890: 2020 2020 2020 2020 2020 2070 6374 5f63             pct_c
+000208a0: 6861 6e67 6520 3d20 300a 2020 2020 2020  hange = 0.      
+000208b0: 2020 7063 745f 7361 7665 203d 2022 252e    pct_save = "%.
+000208c0: 3166 2525 2220 2520 7063 745f 6368 616e  1f%%" % pct_chan
+000208d0: 6765 0a20 2020 2020 2020 2069 6620 7063  ge.        if pc
+000208e0: 745f 6368 616e 6765 203e 2030 2e32 3a0a  t_change > 0.2:.
+000208f0: 2020 2020 2020 2020 2020 2020 7063 745f              pct_
+00020900: 6368 616e 6765 203d 2063 6f6c 6f72 5465  change = colorTe
+00020910: 7874 2e47 5245 454e 202b 2028 2225 2e31  xt.GREEN + ("%.1
+00020920: 6625 2522 2025 2070 6374 5f63 6861 6e67  f%%" % pct_chang
+00020930: 6529 202b 2063 6f6c 6f72 5465 7874 2e45  e) + colorText.E
+00020940: 4e44 0a20 2020 2020 2020 2065 6c69 6620  ND.        elif 
+00020950: 7063 745f 6368 616e 6765 203c 202d 302e  pct_change < -0.
+00020960: 323a 0a20 2020 2020 2020 2020 2020 2070  2:.            p
+00020970: 6374 5f63 6861 6e67 6520 3d20 636f 6c6f  ct_change = colo
+00020980: 7254 6578 742e 4641 494c 202b 2028 2225  rText.FAIL + ("%
+00020990: 2e31 6625 2522 2025 2070 6374 5f63 6861  .1f%%" % pct_cha
+000209a0: 6e67 6529 202b 2063 6f6c 6f72 5465 7874  nge) + colorText
+000209b0: 2e45 4e44 0a20 2020 2020 2020 2065 6c73  .END.        els
+000209c0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+000209d0: 6374 5f63 6861 6e67 6520 3d20 636f 6c6f  ct_change = colo
+000209e0: 7254 6578 742e 5741 524e 202b 2028 2225  rText.WARN + ("%
+000209f0: 2e31 6625 2522 2025 2070 6374 5f63 6861  .1f%%" % pct_cha
+00020a00: 6e67 6529 202b 2063 6f6c 6f72 5465 7874  nge) + colorText
+00020a10: 2e45 4e44 0a20 2020 2020 2020 2073 6176  .END.        sav
+00020a20: 6544 6963 745b 2225 4368 6e67 225d 203d  eDict["%Chng"] =
+00020a30: 2070 6374 5f73 6176 650a 2020 2020 2020   pct_save.      
+00020a40: 2020 7363 7265 656e 4469 6374 5b22 2543    screenDict["%C
+00020a50: 686e 6722 5d20 3d20 7063 745f 6368 616e  hng"] = pct_chan
+00020a60: 6765 0a20 2020 2020 2020 206c 7470 203d  ge.        ltp =
+00020a70: 2072 6f75 6e64 2872 6563 656e 745b 2243   round(recent["C
+00020a80: 6c6f 7365 225d 2e69 6c6f 635b 305d 2c20  lose"].iloc[0], 
+00020a90: 3229 0a20 2020 2020 2020 2076 6572 6966  2).        verif
+00020aa0: 7953 7461 6765 5477 6f20 3d20 5472 7565  yStageTwo = True
+00020ab0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00020ac0: 6461 7461 2920 3e20 3235 303a 0a20 2020  data) > 250:.   
+00020ad0: 2020 2020 2020 2020 2079 6561 726c 794c           yearlyL
+00020ae0: 6f77 203d 2064 6174 612e 6865 6164 2832  ow = data.head(2
+00020af0: 3530 295b 2243 6c6f 7365 225d 2e6d 696e  50)["Close"].min
+00020b00: 2829 0a20 2020 2020 2020 2020 2020 2079  ().            y
+00020b10: 6561 726c 7948 6967 6820 3d20 6461 7461  earlyHigh = data
+00020b20: 2e68 6561 6428 3235 3029 5b22 436c 6f73  .head(250)["Clos
+00020b30: 6522 5d2e 6d61 7828 290a 2020 2020 2020  e"].max().      
+00020b40: 2020 2020 2020 6966 206c 7470 203c 2028        if ltp < (
+00020b50: 3220 2a20 7965 6172 6c79 4c6f 7729 2061  2 * yearlyLow) a
+00020b60: 6e64 206c 7470 203c 2028 302e 3735 202a  nd ltp < (0.75 *
+00020b70: 2079 6561 726c 7948 6967 6829 3a0a 2020   yearlyHigh):.  
+00020b80: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+00020b90: 7269 6679 5374 6167 6554 776f 203d 2046  rifyStageTwo = F
+00020ba0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00020bb0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00020bc0: 2253 746f 636b 225d 203d 2063 6f6c 6f72  "Stock"] = color
+00020bd0: 5465 7874 2e46 4149 4c20 2b20 7361 7665  Text.FAIL + save
+00020be0: 4469 6374 5b22 5374 6f63 6b22 5d20 2b20  Dict["Stock"] + 
+00020bf0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00020c00: 2020 2020 2020 6966 206c 7470 203e 3d20        if ltp >= 
+00020c10: 6d69 6e4c 5450 2061 6e64 206c 7470 203c  minLTP and ltp <
+00020c20: 3d20 6d61 784c 5450 3a0a 2020 2020 2020  = maxLTP:.      
+00020c30: 2020 2020 2020 6c74 7056 616c 6964 203d        ltpValid =
+00020c40: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00020c50: 2020 6966 206d 696e 4368 616e 6765 2021    if minChange !
+00020c60: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00020c70: 2020 2020 2023 2055 7365 7220 6861 7320       # User has 
+00020c80: 7375 7070 6c69 6564 2073 6f6d 6520 6669  supplied some fi
+00020c90: 6c74 6572 2066 6f72 2070 6572 6365 6e74  lter for percent
+00020ca0: 6167 6520 6368 616e 6765 0a20 2020 2020  age change.     
+00020cb0: 2020 2020 2020 2020 2020 206c 7470 5661             ltpVa
+00020cc0: 6c69 6420 3d20 666c 6f61 7428 7374 7228  lid = float(str(
+00020cd0: 7063 745f 7361 7665 292e 7265 706c 6163  pct_save).replac
+00020ce0: 6528 2225 222c 2222 2929 203e 3d20 6d69  e("%","")) >= mi
+00020cf0: 6e43 6861 6e67 650a 2020 2020 2020 2020  nChange.        
+00020d00: 2020 2020 7361 7665 4469 6374 5b22 4c54      saveDict["LT
+00020d10: 5022 5d20 3d20 726f 756e 6428 6c74 702c  P"] = round(ltp,
+00020d20: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00020d30: 7363 7265 656e 4469 6374 5b22 4c54 5022  screenDict["LTP"
+00020d40: 5d20 3d20 2863 6f6c 6f72 5465 7874 2e47  ] = (colorText.G
+00020d50: 5245 454e 2069 6620 6c74 7056 616c 6964  REEN if ltpValid
+00020d60: 2065 6c73 6520 636f 6c6f 7254 6578 742e   else colorText.
+00020d70: 4641 494c 2920 2b20 2822 252e 3266 2220  FAIL) + ("%.2f" 
+00020d80: 2520 6c74 7029 202b 2063 6f6c 6f72 5465  % ltp) + colorTe
+00020d90: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00020da0: 2020 2072 6574 7572 6e20 6c74 7056 616c     return ltpVal
+00020db0: 6964 2c20 7665 7269 6679 5374 6167 6554  id, verifyStageT
+00020dc0: 776f 0a20 2020 2020 2020 2073 6372 6565  wo.        scree
+00020dd0: 6e44 6963 745b 224c 5450 225d 203d 2063  nDict["LTP"] = c
+00020de0: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
+00020df0: 2822 252e 3266 2220 2520 6c74 7029 202b  ("%.2f" % ltp) +
+00020e00: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00020e10: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00020e20: 224c 5450 225d 203d 2072 6f75 6e64 286c  "LTP"] = round(l
+00020e30: 7470 2c20 3229 0a20 2020 2020 2020 2072  tp, 2).        r
+00020e40: 6574 7572 6e20 6c74 7056 616c 6964 2c20  eturn ltpValid, 
+00020e50: 7665 7269 6679 5374 6167 6554 776f 0a0a  verifyStageTwo..
+00020e60: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00020e70: 4c54 5046 6f72 506f 7274 666f 6c69 6f43  LTPForPortfolioC
+00020e80: 616c 6328 7365 6c66 2c20 6466 2c20 7363  alc(self, df, sc
+00020e90: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+00020ea0: 6374 2c72 6571 7565 7374 6564 5065 7269  ct,requestedPeri
+00020eb0: 6f64 3d30 293a 0a20 2020 2020 2020 2064  od=0):.        d
+00020ec0: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+00020ed0: 2020 2020 2020 2020 7065 7269 6f64 7320          periods 
+00020ee0: 3d20 7365 6c66 2e63 6f6e 6669 674d 616e  = self.configMan
+00020ef0: 6167 6572 2e70 6572 696f 6473 5261 6e67  ager.periodsRang
+00020f00: 650a 2020 2020 2020 2020 6966 2072 6571  e.        if req
+00020f10: 7565 7374 6564 5065 7269 6f64 203e 2030  uestedPeriod > 0
+00020f20: 2061 6e64 2072 6571 7565 7374 6564 5065   and requestedPe
+00020f30: 7269 6f64 206e 6f74 2069 6e20 7065 7269  riod not in peri
+00020f40: 6f64 733a 0a20 2020 2020 2020 2020 2020  ods:.           
+00020f50: 2070 6572 696f 6473 2e61 7070 656e 6428   periods.append(
+00020f60: 7265 7175 6573 7465 6450 6572 696f 6429  requestedPeriod)
+00020f70: 0a20 2020 2020 2020 2070 7265 7669 6f75  .        previou
+00020f80: 735f 7265 6365 6e74 203d 2064 6174 612e  s_recent = data.
+00020f90: 6865 6164 2831 290a 2020 2020 2020 2020  head(1).        
+00020fa0: 7072 6576 696f 7573 5f72 6563 656e 742e  previous_recent.
+00020fb0: 7265 7365 745f 696e 6465 7828 696e 706c  reset_index(inpl
+00020fc0: 6163 653d 5472 7565 290a 2020 2020 2020  ace=True).      
+00020fd0: 2020 6361 6c63 5f64 6174 6520 3d20 7374    calc_date = st
+00020fe0: 7228 7072 6576 696f 7573 5f72 6563 656e  r(previous_recen
+00020ff0: 742e 696c 6f63 5b3a 2c20 305d 5b30 5d29  t.iloc[:, 0][0])
+00021000: 2e73 706c 6974 2822 2022 295b 305d 0a20  .split(" ")[0]. 
+00021010: 2020 2020 2020 2066 6f72 2070 7264 2069         for prd i
+00021020: 6e20 7065 7269 6f64 733a 0a20 2020 2020  n periods:.     
+00021030: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
+00021040: 7461 2920 3e3d 2070 7264 202b 2031 3a0a  ta) >= prd + 1:.
+00021050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021060: 7072 6576 4c74 7020 3d20 6461 7461 5b22  prevLtp = data["
+00021070: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d0a  Close"].iloc[0].
+00021080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021090: 6c74 7054 6479 203d 2064 6174 615b 2243  ltpTdy = data["C
+000210a0: 6c6f 7365 225d 2e69 6c6f 635b 7072 645d  lose"].iloc[prd]
 000210b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000210c0: 2073 6372 6565 6e44 6963 745b 6622 4c54   screenDict[f"LT
-000210d0: 507b 7072 647d 225d 203d 2028 0a20 2020  P{prd}"] = (.   
-000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210f0: 2028 636f 6c6f 7254 6578 742e 4752 4545   (colorText.GREE
-00021100: 4e20 6966 2028 6c74 7054 6479 203e 3d20  N if (ltpTdy >= 
-00021110: 7072 6576 4c74 7029 2065 6c73 6520 2863  prevLtp) else (c
-00021120: 6f6c 6f72 5465 7874 2e46 4149 4c29 290a  olorText.FAIL)).
-00021130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021140: 2020 2020 2b20 7374 7228 227b 3a2e 3266      + str("{:.2f
-00021150: 7d22 2e66 6f72 6d61 7428 6c74 7054 6479  }".format(ltpTdy
-00021160: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00021170: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-00021180: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00021190: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000211a0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-000211b0: 6963 745b 6622 4772 6f77 7468 7b70 7264  ict[f"Growth{prd
-000211c0: 7d22 5d20 3d20 280a 2020 2020 2020 2020  }"] = (.        
-000211d0: 2020 2020 2020 2020 2020 2020 2863 6f6c              (col
-000211e0: 6f72 5465 7874 2e47 5245 454e 2069 6620  orText.GREEN if 
-000211f0: 286c 7470 5464 7920 3e3d 2070 7265 764c  (ltpTdy >= prevL
-00021200: 7470 2920 656c 7365 2028 636f 6c6f 7254  tp) else (colorT
-00021210: 6578 742e 4641 494c 2929 0a20 2020 2020  ext.FAIL)).     
-00021220: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00021230: 2073 7472 2822 7b3a 2e32 667d 222e 666f   str("{:.2f}".fo
-00021240: 726d 6174 286c 7470 5464 7920 2d20 7072  rmat(ltpTdy - pr
-00021250: 6576 4c74 7029 290a 2020 2020 2020 2020  evLtp)).        
-00021260: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-00021270: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-00021280: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00021290: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000212a0: 7665 4469 6374 5b66 224c 5450 7b70 7264  veDict[f"LTP{prd
-000212b0: 7d22 5d20 3d20 726f 756e 6428 6c74 7054  }"] = round(ltpT
-000212c0: 6479 2c20 3229 0a20 2020 2020 2020 2020  dy, 2).         
-000212d0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-000212e0: 6622 4772 6f77 7468 7b70 7264 7d22 5d20  f"Growth{prd}"] 
-000212f0: 3d20 726f 756e 6428 6c74 7054 6479 202d  = round(ltpTdy -
-00021300: 2070 7265 764c 7470 2c20 3229 0a20 2020   prevLtp, 2).   
-00021310: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021320: 7072 6420 3d3d 2032 3220 6f72 2028 7072  prd == 22 or (pr
-00021330: 6420 3d3d 2072 6571 7565 7374 6564 5065  d == requestedPe
-00021340: 7269 6f64 293a 0a20 2020 2020 2020 2020  riod):.         
-00021350: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
-00021360: 6550 6572 6365 6e74 203d 2072 6f75 6e64  ePercent = round
-00021370: 2828 2870 7265 764c 7470 2d6c 7470 5464  (((prevLtp-ltpTd
-00021380: 7929 2069 6620 7265 7175 6573 7465 6450  y) if requestedP
-00021390: 6572 696f 6420 3d3d 3020 656c 7365 2028  eriod ==0 else (
-000213a0: 6c74 7054 6479 202d 2070 7265 764c 7470  ltpTdy - prevLtp
-000213b0: 2929 2a31 3030 2f6c 7470 5464 792c 2032  ))*100/ltpTdy, 2
-000213c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000213d0: 2020 2020 2020 7361 7665 4469 6374 5b66        saveDict[f
-000213e0: 227b 7072 647d 2d50 6420 2522 5d20 3d20  "{prd}-Pd %"] = 
-000213f0: 6622 7b63 6861 6e67 6550 6572 6365 6e74  f"{changePercent
-00021400: 7d25 2220 6966 206e 6f74 2070 642e 6973  }%" if not pd.is
-00021410: 6e61 2863 6861 6e67 6550 6572 6365 6e74  na(changePercent
-00021420: 2920 656c 7365 2027 2d27 0a20 2020 2020  ) else '-'.     
-00021430: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021440: 6372 6565 6e44 6963 745b 6622 7b70 7264  creenDict[f"{prd
-00021450: 7d2d 5064 2025 225d 203d 2028 2863 6f6c  }-Pd %"] = ((col
-00021460: 6f72 5465 7874 2e47 5245 454e 2069 6620  orText.GREEN if 
-00021470: 6368 616e 6765 5065 7263 656e 7420 3e3d  changePercent >=
-00021480: 3020 656c 7365 2063 6f6c 6f72 5465 7874  0 else colorText
-00021490: 2e46 4149 4c29 202b 2066 227b 6368 616e  .FAIL) + f"{chan
-000214a0: 6765 5065 7263 656e 747d 2522 202b 2063  gePercent}%" + c
-000214b0: 6f6c 6f72 5465 7874 2e45 4e44 2920 6966  olorText.END) if
-000214c0: 206e 6f74 2070 642e 6973 6e61 2863 6861   not pd.isna(cha
-000214d0: 6e67 6550 6572 6365 6e74 2920 656c 7365  ngePercent) else
-000214e0: 2027 2d27 0a20 2020 2020 2020 2020 2020   '-'.           
-000214f0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00021500: 2244 6174 6522 5d20 3d20 6361 6c63 5f64  "Date"] = calc_d
-00021510: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00021520: 2020 2020 7361 7665 4469 6374 5b22 4461      saveDict["Da
-00021530: 7465 225d 203d 2063 616c 635f 6461 7465  te"] = calc_date
-00021540: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00021550: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00021560: 2020 2073 6176 6544 6963 745b 6622 4c54     saveDict[f"LT
-00021570: 507b 7072 647d 225d 203d 206e 702e 6e61  P{prd}"] = np.na
-00021580: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00021590: 2020 7361 7665 4469 6374 5b66 2247 726f    saveDict[f"Gro
-000215a0: 7774 687b 7072 647d 225d 203d 206e 702e  wth{prd}"] = np.
-000215b0: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-000215c0: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-000215d0: 4461 7465 225d 203d 2063 616c 635f 6461  Date"] = calc_da
-000215e0: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
-000215f0: 2020 2073 6176 6544 6963 745b 2244 6174     saveDict["Dat
-00021600: 6522 5d20 3d20 6361 6c63 5f64 6174 650a  e"] = calc_date.
-00021610: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
-00021620: 6b73 2074 6861 7420 6172 6520 6265 6172  ks that are bear
-00021630: 6973 6820 696e 7472 6164 6179 3a20 4d61  ish intraday: Ma
-00021640: 6364 2048 6973 746f 6772 616d 206e 6567  cd Histogram neg
-00021650: 6174 6976 650a 2020 2020 6465 6620 7661  ative.    def va
-00021660: 6c69 6461 7465 4d41 4344 4869 7374 6f67  lidateMACDHistog
-00021670: 7261 6d42 656c 6f77 3028 7365 6c66 2c20  ramBelow0(self, 
-00021680: 6466 293a 0a20 2020 2020 2020 2069 6620  df):.        if 
-00021690: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
-000216a0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
-000216b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000216c0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
-000216d0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-000216e0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-000216f0: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
-00021700: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-00021710: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
-00021720: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
-00021730: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00021740: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
-00021750: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
-00021760: 2073 6f20 7468 6174 2069 7473 2074 6865   so that its the
-00021770: 206f 6c64 6573 7420 6461 7465 2066 6972   oldest date fir
-00021780: 7374 0a20 2020 2020 2020 206d 6163 6420  st.        macd 
-00021790: 3d20 706b 7461 6c69 622e 4d41 4344 2864  = pktalib.MACD(d
-000217a0: 6174 615b 2243 6c6f 7365 225d 2c20 3132  ata["Close"], 12
-000217b0: 2c20 3236 2c20 3929 5b32 5d2e 7461 696c  , 26, 9)[2].tail
-000217c0: 2831 290a 2020 2020 2020 2020 7265 7475  (1).        retu
-000217d0: 726e 206d 6163 642e 696c 6f63 5b3a 315d  rn macd.iloc[:1]
-000217e0: 5b30 5d20 3c20 300a 0a20 2020 2023 406d  [0] < 0..    #@m
-000217f0: 6561 7375 7265 5f74 696d 650a 2020 2020  easure_time.    
-00021800: 2320 4669 6e64 2069 6620 7374 6f63 6b20  # Find if stock 
-00021810: 6761 696e 696e 6720 6275 6c6c 6973 6820  gaining bullish 
-00021820: 6d6f 6d65 6e74 756d 0a20 2020 2064 6566  momentum.    def
-00021830: 2076 616c 6964 6174 654d 6f6d 656e 7475   validateMomentu
-00021840: 6d28 7365 6c66 2c20 6466 2c20 7363 7265  m(self, df, scre
-00021850: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-00021860: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
-00021870: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
-00021880: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
-00021890: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000218a0: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
-000218b0: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
-000218c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000218d0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-000218e0: 2e68 6561 6428 3329 0a20 2020 2020 2020  .head(3).       
-000218f0: 2020 2020 2069 6620 6c65 6e28 6461 7461       if len(data
-00021900: 2920 3c20 333a 0a20 2020 2020 2020 2020  ) < 3:.         
-00021910: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00021920: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00021930: 666f 7220 726f 7720 696e 2064 6174 612e  for row in data.
-00021940: 6974 6572 726f 7773 2829 3a0a 2020 2020  iterrows():.    
-00021950: 2020 2020 2020 2020 2020 2020 2320 416c              # Al
-00021960: 6c20 3320 6361 6e64 6c65 7320 7368 6f75  l 3 candles shou
-00021970: 6c64 2062 6520 4772 6565 6e20 616e 6420  ld be Green and 
-00021980: 4e4f 5420 4369 7263 7569 7473 0a20 2020  NOT Circuits.   
-00021990: 2020 2020 2020 2020 2020 2020 2079 6320               yc 
-000219a0: 3d20 726f 775b 315d 5b22 436c 6f73 6522  = row[1]["Close"
-000219b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000219c0: 2020 796f 203d 2072 6f77 5b31 5d5b 224f    yo = row[1]["O
-000219d0: 7065 6e22 5d0a 2020 2020 2020 2020 2020  pen"].          
-000219e0: 2020 2020 2020 6966 2079 6320 3c3d 2079        if yc <= y
-000219f0: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
-00021a00: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
-00021a10: 6661 756c 745f 6c6f 6767 6572 2e69 6e66  fault_logger.inf
-00021a20: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-00021a30: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
-00021a40: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
-00021a50: 5374 6f63 6b22 5d7d 2c20 6973 206e 6f74  Stock"]}, is not
-00021a60: 2061 206d 6f6d 656e 7475 6d2d 6761 696e   a momentum-gain
-00021a70: 6572 2062 6563 6175 7365 2079 6573 7465  er because yeste
-00021a80: 7264 6179 2d63 6c6f 7365 2028 7b79 637d  rday-close ({yc}
-00021a90: 2920 3c3d 2079 6573 7465 7264 6179 2d6f  ) <= yesterday-o
-00021aa0: 7065 6e20 287b 796f 7d29 270a 2020 2020  pen ({yo})'.    
-00021ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ac0: 2320 290a 2020 2020 2020 2020 2020 2020  # ).            
-00021ad0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00021ae0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00021af0: 206f 7065 6e44 6573 6320 3d20 6461 7461   openDesc = data
-00021b00: 2e73 6f72 745f 7661 6c75 6573 2862 793d  .sort_values(by=
-00021b10: 5b22 4f70 656e 225d 2c20 6173 6365 6e64  ["Open"], ascend
-00021b20: 696e 673d 4661 6c73 6529 0a20 2020 2020  ing=False).     
-00021b30: 2020 2020 2020 2063 6c6f 7365 4465 7363         closeDesc
-00021b40: 203d 2064 6174 612e 736f 7274 5f76 616c   = data.sort_val
-00021b50: 7565 7328 6279 3d5b 2243 6c6f 7365 225d  ues(by=["Close"]
-00021b60: 2c20 6173 6365 6e64 696e 673d 4661 6c73  , ascending=Fals
-00021b70: 6529 0a20 2020 2020 2020 2020 2020 2076  e).            v
-00021b80: 6f6c 4465 7363 203d 2064 6174 612e 736f  olDesc = data.so
-00021b90: 7274 5f76 616c 7565 7328 6279 3d5b 2256  rt_values(by=["V
-00021ba0: 6f6c 756d 6522 5d2c 2061 7363 656e 6469  olume"], ascendi
-00021bb0: 6e67 3d46 616c 7365 290a 2020 2020 2020  ng=False).      
-00021bc0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00021bd0: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
-00021be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021bf0: 2020 2020 6461 7461 2e65 7175 616c 7328      data.equals(
-00021c00: 6f70 656e 4465 7363 290a 2020 2020 2020  openDesc).      
-00021c10: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00021c20: 6420 6461 7461 2e65 7175 616c 7328 636c  d data.equals(cl
-00021c30: 6f73 6544 6573 6329 0a20 2020 2020 2020  oseDesc).       
-00021c40: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00021c50: 2064 6174 612e 6571 7561 6c73 2876 6f6c   data.equals(vol
-00021c60: 4465 7363 290a 2020 2020 2020 2020 2020  Desc).          
-00021c70: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00021c80: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00021c90: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-00021ca0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-00021cb0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00021cc0: 2020 2066 2753 746f 636b 3a7b 7361 7665     f'Stock:{save
-00021cd0: 4469 6374 5b22 5374 6f63 6b22 5d7d 2c20  Dict["Stock"]}, 
-00021ce0: 6f70 656e 2c63 6c6f 7365 2061 6e64 2076  open,close and v
-00021cf0: 6f6c 756d 6520 6571 7561 6c20 6672 6f6d  olume equal from
-00021d00: 2064 6179 2062 6566 6f72 6520 7965 7374   day before yest
-00021d10: 6572 6461 792e 2041 2070 6f74 656e 7469  erday. A potenti
-00021d20: 616c 206d 6f6d 656e 7475 6d2d 6761 696e  al momentum-gain
-00021d30: 6572 2127 0a20 2020 2020 2020 2020 2020  er!'.           
-00021d40: 2020 2020 2020 2020 2023 2029 0a20 2020           # ).   
-00021d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d60: 2074 6f20 3d20 6461 7461 5b22 4f70 656e   to = data["Open
-00021d70: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
-00021d80: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00021d90: 6320 3d20 6461 7461 5b22 436c 6f73 6522  c = data["Close"
-00021da0: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
-00021db0: 2020 2020 2020 2020 2020 2020 2020 796f                yo
-00021dc0: 203d 2064 6174 615b 224f 7065 6e22 5d2e   = data["Open"].
-00021dd0: 696c 6f63 5b31 5d0a 2020 2020 2020 2020  iloc[1].        
-00021de0: 2020 2020 2020 2020 2020 2020 6479 6320              dyc 
-00021df0: 3d20 6461 7461 5b22 436c 6f73 6522 5d2e  = data["Close"].
-00021e00: 696c 6f63 5b32 5d0a 2020 2020 2020 2020  iloc[2].        
-00021e10: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00021e20: 746f 203e 3d20 7963 2920 616e 6420 2879  to >= yc) and (y
-00021e30: 6f20 3e3d 2064 7963 293a 0a20 2020 2020  o >= dyc):.     
-00021e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e50: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
-00021e60: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
-00021e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e80: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
-00021e90: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
-00021ea0: 5374 6f63 6b22 5d7d 2c20 6973 2061 206d  Stock"]}, is a m
-00021eb0: 6f6d 656e 7475 6d2d 6761 696e 6572 2062  omentum-gainer b
-00021ec0: 6563 6175 7365 2074 6f64 6179 2d6f 7065  ecause today-ope
-00021ed0: 6e20 287b 746f 7d29 203e 3d20 7965 7374  n ({to}) >= yest
-00021ee0: 6572 6461 792d 636c 6f73 6520 287b 7963  erday-close ({yc
-00021ef0: 7d29 2061 6e64 2079 6573 7465 7264 6179  }) and yesterday
-00021f00: 2d6f 7065 6e28 7b79 6f7d 2920 3e3d 2064  -open({yo}) >= d
-00021f10: 6179 2d62 6566 6f72 652d 636c 6f73 6528  ay-before-close(
-00021f20: 7b64 7963 7d29 270a 2020 2020 2020 2020  {dyc})'.        
-00021f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f40: 2320 290a 2020 2020 2020 2020 2020 2020  # ).            
-00021f50: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00021f60: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-00021f70: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-00021f80: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-00021f90: 6963 742c 2022 5061 7474 6572 6e22 290a  ict, "Pattern").
-00021fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021fb0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00021fc0: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-00021fd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00021fe0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00021ff0: 7665 645b 305d 0a20 2020 2020 2020 2020  ved[0].         
-00022000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022010: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
-00022020: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
-00022030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022040: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
-00022050: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
-00022060: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00022070: 224d 6f6d 656e 7475 6d20 4761 696e 6572  "Momentum Gainer
-00022080: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022090: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-000220a0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-000220b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000220c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000210c0: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
+000210d0: 7265 764c 7470 2c70 642e 5365 7269 6573  revLtp,pd.Series
+000210e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000210f0: 2020 2020 2020 2070 7265 764c 7470 203d         prevLtp =
+00021100: 2070 7265 764c 7470 5b30 5d0a 2020 2020   prevLtp[0].    
+00021110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021120: 6c74 7054 6479 203d 206c 7470 5464 795b  ltpTdy = ltpTdy[
+00021130: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00021140: 2020 2073 6372 6565 6e44 6963 745b 6622     screenDict[f"
+00021150: 4c54 507b 7072 647d 225d 203d 2028 0a20  LTP{prd}"] = (. 
+00021160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021170: 2020 2028 636f 6c6f 7254 6578 742e 4752     (colorText.GR
+00021180: 4545 4e20 6966 2028 6c74 7054 6479 203e  EEN if (ltpTdy >
+00021190: 3d20 7072 6576 4c74 7029 2065 6c73 6520  = prevLtp) else 
+000211a0: 2863 6f6c 6f72 5465 7874 2e46 4149 4c29  (colorText.FAIL)
+000211b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000211c0: 2020 2020 2020 2b20 7374 7228 227b 3a2e        + str("{:.
+000211d0: 3266 7d22 2e66 6f72 6d61 7428 6c74 7054  2f}".format(ltpT
+000211e0: 6479 2929 0a20 2020 2020 2020 2020 2020  dy)).           
+000211f0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+00021200: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00021210: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00021220: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00021230: 6e44 6963 745b 6622 4772 6f77 7468 7b70  nDict[f"Growth{p
+00021240: 7264 7d22 5d20 3d20 280a 2020 2020 2020  rd}"] = (.      
+00021250: 2020 2020 2020 2020 2020 2020 2020 2863                (c
+00021260: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
+00021270: 6620 286c 7470 5464 7920 3e3d 2070 7265  f (ltpTdy >= pre
+00021280: 764c 7470 2920 656c 7365 2028 636f 6c6f  vLtp) else (colo
+00021290: 7254 6578 742e 4641 494c 2929 0a20 2020  rText.FAIL)).   
+000212a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212b0: 202b 2073 7472 2822 7b3a 2e32 667d 222e   + str("{:.2f}".
+000212c0: 666f 726d 6174 286c 7470 5464 7920 2d20  format(ltpTdy - 
+000212d0: 7072 6576 4c74 7029 290a 2020 2020 2020  prevLtp)).      
+000212e0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000212f0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00021300: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00021310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021320: 7361 7665 4469 6374 5b66 224c 5450 7b70  saveDict[f"LTP{p
+00021330: 7264 7d22 5d20 3d20 726f 756e 6428 6c74  rd}"] = round(lt
+00021340: 7054 6479 2c20 3229 0a20 2020 2020 2020  pTdy, 2).       
+00021350: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+00021360: 745b 6622 4772 6f77 7468 7b70 7264 7d22  t[f"Growth{prd}"
+00021370: 5d20 3d20 726f 756e 6428 6c74 7054 6479  ] = round(ltpTdy
+00021380: 202d 2070 7265 764c 7470 2c20 3229 0a20   - prevLtp, 2). 
+00021390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000213a0: 6620 7072 6420 3d3d 2032 3220 6f72 2028  f prd == 22 or (
+000213b0: 7072 6420 3d3d 2072 6571 7565 7374 6564  prd == requested
+000213c0: 5065 7269 6f64 293a 0a20 2020 2020 2020  Period):.       
+000213d0: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+000213e0: 6e67 6550 6572 6365 6e74 203d 2072 6f75  ngePercent = rou
+000213f0: 6e64 2828 2870 7265 764c 7470 2d6c 7470  nd(((prevLtp-ltp
+00021400: 5464 7929 2069 6620 7265 7175 6573 7465  Tdy) if requeste
+00021410: 6450 6572 696f 6420 3d3d 3020 656c 7365  dPeriod ==0 else
+00021420: 2028 6c74 7054 6479 202d 2070 7265 764c   (ltpTdy - prevL
+00021430: 7470 2929 2a31 3030 2f6c 7470 5464 792c  tp))*100/ltpTdy,
+00021440: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00021450: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00021460: 5b66 227b 7072 647d 2d50 6422 5d20 3d20  [f"{prd}-Pd"] = 
+00021470: 6622 7b63 6861 6e67 6550 6572 6365 6e74  f"{changePercent
+00021480: 7d25 2220 6966 206e 6f74 2070 642e 6973  }%" if not pd.is
+00021490: 6e61 2863 6861 6e67 6550 6572 6365 6e74  na(changePercent
+000214a0: 2920 656c 7365 2027 2d27 0a20 2020 2020  ) else '-'.     
+000214b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000214c0: 6372 6565 6e44 6963 745b 6622 7b70 7264  creenDict[f"{prd
+000214d0: 7d2d 5064 225d 203d 2028 2863 6f6c 6f72  }-Pd"] = ((color
+000214e0: 5465 7874 2e47 5245 454e 2069 6620 6368  Text.GREEN if ch
+000214f0: 616e 6765 5065 7263 656e 7420 3e3d 3020  angePercent >=0 
+00021500: 656c 7365 2063 6f6c 6f72 5465 7874 2e46  else colorText.F
+00021510: 4149 4c29 202b 2066 227b 6368 616e 6765  AIL) + f"{change
+00021520: 5065 7263 656e 747d 2522 202b 2063 6f6c  Percent}%" + col
+00021530: 6f72 5465 7874 2e45 4e44 2920 6966 206e  orText.END) if n
+00021540: 6f74 2070 642e 6973 6e61 2863 6861 6e67  ot pd.isna(chang
+00021550: 6550 6572 6365 6e74 2920 656c 7365 2027  ePercent) else '
+00021560: 2d27 0a20 2020 2020 2020 2020 2020 2020  -'.             
+00021570: 2020 2073 6372 6565 6e44 6963 745b 2244     screenDict["D
+00021580: 6174 6522 5d20 3d20 6361 6c63 5f64 6174  ate"] = calc_dat
+00021590: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000215a0: 2020 7361 7665 4469 6374 5b22 4461 7465    saveDict["Date
+000215b0: 225d 203d 2063 616c 635f 6461 7465 0a20  "] = calc_date. 
+000215c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000215d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000215e0: 2073 6176 6544 6963 745b 6622 4c54 507b   saveDict[f"LTP{
+000215f0: 7072 647d 225d 203d 206e 702e 6e61 6e0a  prd}"] = np.nan.
+00021600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021610: 7361 7665 4469 6374 5b66 2247 726f 7774  saveDict[f"Growt
+00021620: 687b 7072 647d 225d 203d 206e 702e 6e61  h{prd}"] = np.na
+00021630: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00021640: 2020 7363 7265 656e 4469 6374 5b22 4461    screenDict["Da
+00021650: 7465 225d 203d 2063 616c 635f 6461 7465  te"] = calc_date
+00021660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021670: 2073 6176 6544 6963 745b 2244 6174 6522   saveDict["Date"
+00021680: 5d20 3d20 6361 6c63 5f64 6174 650a 0a20  ] = calc_date.. 
+00021690: 2020 2023 2046 696e 6420 7374 6f63 6b73     # Find stocks
+000216a0: 2074 6861 7420 6172 6520 6265 6172 6973   that are bearis
+000216b0: 6820 696e 7472 6164 6179 3a20 4d61 6364  h intraday: Macd
+000216c0: 2048 6973 746f 6772 616d 206e 6567 6174   Histogram negat
+000216d0: 6976 650a 2020 2020 6465 6620 7661 6c69  ive.    def vali
+000216e0: 6461 7465 4d41 4344 4869 7374 6f67 7261  dateMACDHistogra
+000216f0: 6d42 656c 6f77 3028 7365 6c66 2c20 6466  mBelow0(self, df
+00021700: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
+00021710: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+00021720: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
+00021730: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00021740: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+00021750: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
+00021760: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+00021770: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
+00021780: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
+00021790: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
+000217a0: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
+000217b0: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+000217c0: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
+000217d0: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
+000217e0: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
+000217f0: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
+00021800: 0a20 2020 2020 2020 206d 6163 6420 3d20  .        macd = 
+00021810: 706b 7461 6c69 622e 4d41 4344 2864 6174  pktalib.MACD(dat
+00021820: 615b 2243 6c6f 7365 225d 2c20 3132 2c20  a["Close"], 12, 
+00021830: 3236 2c20 3929 5b32 5d2e 7461 696c 2831  26, 9)[2].tail(1
+00021840: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00021850: 206d 6163 642e 696c 6f63 5b3a 315d 5b30   macd.iloc[:1][0
+00021860: 5d20 3c20 300a 0a20 2020 2023 406d 6561  ] < 0..    #@mea
+00021870: 7375 7265 5f74 696d 650a 2020 2020 2320  sure_time.    # 
+00021880: 4669 6e64 2069 6620 7374 6f63 6b20 6761  Find if stock ga
+00021890: 696e 696e 6720 6275 6c6c 6973 6820 6d6f  ining bullish mo
+000218a0: 6d65 6e74 756d 0a20 2020 2064 6566 2076  mentum.    def v
+000218b0: 616c 6964 6174 654d 6f6d 656e 7475 6d28  alidateMomentum(
+000218c0: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+000218d0: 4469 6374 2c20 7361 7665 4469 6374 293a  Dict, saveDict):
+000218e0: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
+000218f0: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
+00021900: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00021910: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00021920: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00021930: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+00021940: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00021950: 2020 2064 6174 6120 3d20 6461 7461 2e68     data = data.h
+00021960: 6561 6428 3329 0a20 2020 2020 2020 2020  ead(3).         
+00021970: 2020 2069 6620 6c65 6e28 6461 7461 2920     if len(data) 
+00021980: 3c20 333a 0a20 2020 2020 2020 2020 2020  < 3:.           
+00021990: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000219a0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+000219b0: 7220 726f 7720 696e 2064 6174 612e 6974  r row in data.it
+000219c0: 6572 726f 7773 2829 3a0a 2020 2020 2020  errows():.      
+000219d0: 2020 2020 2020 2020 2020 2320 416c 6c20            # All 
+000219e0: 3320 6361 6e64 6c65 7320 7368 6f75 6c64  3 candles should
+000219f0: 2062 6520 4772 6565 6e20 616e 6420 4e4f   be Green and NO
+00021a00: 5420 4369 7263 7569 7473 0a20 2020 2020  T Circuits.     
+00021a10: 2020 2020 2020 2020 2020 2079 6320 3d20             yc = 
+00021a20: 726f 775b 315d 5b22 436c 6f73 6522 5d0a  row[1]["Close"].
+00021a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a40: 796f 203d 2072 6f77 5b31 5d5b 224f 7065  yo = row[1]["Ope
+00021a50: 6e22 5d0a 2020 2020 2020 2020 2020 2020  n"].            
+00021a60: 2020 2020 6966 2079 6320 3c3d 2079 6f3a      if yc <= yo:
+00021a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021a80: 2020 2020 2023 2073 656c 662e 6465 6661       # self.defa
+00021a90: 756c 745f 6c6f 6767 6572 2e69 6e66 6f28  ult_logger.info(
+00021aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021ab0: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
+00021ac0: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
+00021ad0: 6f63 6b22 5d7d 2c20 6973 206e 6f74 2061  ock"]}, is not a
+00021ae0: 206d 6f6d 656e 7475 6d2d 6761 696e 6572   momentum-gainer
+00021af0: 2062 6563 6175 7365 2079 6573 7465 7264   because yesterd
+00021b00: 6179 2d63 6c6f 7365 2028 7b79 637d 2920  ay-close ({yc}) 
+00021b10: 3c3d 2079 6573 7465 7264 6179 2d6f 7065  <= yesterday-ope
+00021b20: 6e20 287b 796f 7d29 270a 2020 2020 2020  n ({yo})'.      
+00021b30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00021b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021b50: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00021b60: 7365 0a20 2020 2020 2020 2020 2020 206f  se.            o
+00021b70: 7065 6e44 6573 6320 3d20 6461 7461 2e73  penDesc = data.s
+00021b80: 6f72 745f 7661 6c75 6573 2862 793d 5b22  ort_values(by=["
+00021b90: 4f70 656e 225d 2c20 6173 6365 6e64 696e  Open"], ascendin
+00021ba0: 673d 4661 6c73 6529 0a20 2020 2020 2020  g=False).       
+00021bb0: 2020 2020 2063 6c6f 7365 4465 7363 203d       closeDesc =
+00021bc0: 2064 6174 612e 736f 7274 5f76 616c 7565   data.sort_value
+00021bd0: 7328 6279 3d5b 2243 6c6f 7365 225d 2c20  s(by=["Close"], 
+00021be0: 6173 6365 6e64 696e 673d 4661 6c73 6529  ascending=False)
+00021bf0: 0a20 2020 2020 2020 2020 2020 2076 6f6c  .            vol
+00021c00: 4465 7363 203d 2064 6174 612e 736f 7274  Desc = data.sort
+00021c10: 5f76 616c 7565 7328 6279 3d5b 2256 6f6c  _values(by=["Vol
+00021c20: 756d 6522 5d2c 2061 7363 656e 6469 6e67  ume"], ascending
+00021c30: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00021c40: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00021c50: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+00021c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c70: 2020 6461 7461 2e65 7175 616c 7328 6f70    data.equals(op
+00021c80: 656e 4465 7363 290a 2020 2020 2020 2020  enDesc).        
+00021c90: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00021ca0: 6461 7461 2e65 7175 616c 7328 636c 6f73  data.equals(clos
+00021cb0: 6544 6573 6329 0a20 2020 2020 2020 2020  eDesc).         
+00021cc0: 2020 2020 2020 2020 2020 2061 6e64 2064             and d
+00021cd0: 6174 612e 6571 7561 6c73 2876 6f6c 4465  ata.equals(volDe
+00021ce0: 7363 290a 2020 2020 2020 2020 2020 2020  sc).            
+00021cf0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00021d00: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+00021d10: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00021d20: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+00021d30: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00021d40: 2066 2753 746f 636b 3a7b 7361 7665 4469   f'Stock:{saveDi
+00021d50: 6374 5b22 5374 6f63 6b22 5d7d 2c20 6f70  ct["Stock"]}, op
+00021d60: 656e 2c63 6c6f 7365 2061 6e64 2076 6f6c  en,close and vol
+00021d70: 756d 6520 6571 7561 6c20 6672 6f6d 2064  ume equal from d
+00021d80: 6179 2062 6566 6f72 6520 7965 7374 6572  ay before yester
+00021d90: 6461 792e 2041 2070 6f74 656e 7469 616c  day. A potential
+00021da0: 206d 6f6d 656e 7475 6d2d 6761 696e 6572   momentum-gainer
+00021db0: 2127 0a20 2020 2020 2020 2020 2020 2020  !'.             
+00021dc0: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+00021dd0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00021de0: 6f20 3d20 6461 7461 5b22 4f70 656e 225d  o = data["Open"]
+00021df0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00021e00: 2020 2020 2020 2020 2020 2020 2079 6320               yc 
+00021e10: 3d20 6461 7461 5b22 436c 6f73 6522 5d2e  = data["Close"].
+00021e20: 696c 6f63 5b31 5d0a 2020 2020 2020 2020  iloc[1].        
+00021e30: 2020 2020 2020 2020 2020 2020 796f 203d              yo =
+00021e40: 2064 6174 615b 224f 7065 6e22 5d2e 696c   data["Open"].il
+00021e50: 6f63 5b31 5d0a 2020 2020 2020 2020 2020  oc[1].          
+00021e60: 2020 2020 2020 2020 2020 6479 6320 3d20            dyc = 
+00021e70: 6461 7461 5b22 436c 6f73 6522 5d2e 696c  data["Close"].il
+00021e80: 6f63 5b32 5d0a 2020 2020 2020 2020 2020  oc[2].          
+00021e90: 2020 2020 2020 2020 2020 6966 2028 746f            if (to
+00021ea0: 203e 3d20 7963 2920 616e 6420 2879 6f20   >= yc) and (yo 
+00021eb0: 3e3d 2064 7963 293a 0a20 2020 2020 2020  >= dyc):.       
+00021ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ed0: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
+00021ee0: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
+00021ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f00: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
+00021f10: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
+00021f20: 6f63 6b22 5d7d 2c20 6973 2061 206d 6f6d  ock"]}, is a mom
+00021f30: 656e 7475 6d2d 6761 696e 6572 2062 6563  entum-gainer bec
+00021f40: 6175 7365 2074 6f64 6179 2d6f 7065 6e20  ause today-open 
+00021f50: 287b 746f 7d29 203e 3d20 7965 7374 6572  ({to}) >= yester
+00021f60: 6461 792d 636c 6f73 6520 287b 7963 7d29  day-close ({yc})
+00021f70: 2061 6e64 2079 6573 7465 7264 6179 2d6f   and yesterday-o
+00021f80: 7065 6e28 7b79 6f7d 2920 3e3d 2064 6179  pen({yo}) >= day
+00021f90: 2d62 6566 6f72 652d 636c 6f73 6528 7b64  -before-close({d
+00021fa0: 7963 7d29 270a 2020 2020 2020 2020 2020  yc})'.          
+00021fb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00021fc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021fd0: 2020 2020 2020 2020 2020 7361 7665 6420            saved 
+00021fe0: 3d20 7365 6c66 2e66 696e 6443 7572 7265  = self.findCurre
+00021ff0: 6e74 5361 7665 6456 616c 7565 2873 6372  ntSavedValue(scr
+00022000: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+00022010: 742c 2022 5061 7474 6572 6e22 290a 2020  t, "Pattern").  
+00022020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022030: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+00022040: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
+00022050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022060: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00022070: 645b 305d 0a20 2020 2020 2020 2020 2020  d[0].           
+00022080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022090: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+000220a0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+000220b0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000220c0: 636f 6c6f 7254 6578 742e 4752 4545 4e0a  colorText.GREEN.
 000220d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000220e0: 7361 7665 4469 6374 5b22 5061 7474 6572  saveDict["Patter
-000220f0: 6e22 5d20 3d20 7361 7665 645b 315d 202b  n"] = saved[1] +
-00022100: 2022 4d6f 6d65 6e74 756d 2047 6169 6e65   "Momentum Gaine
-00022110: 7222 0a20 2020 2020 2020 2020 2020 2020  r".             
-00022120: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00022130: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
-00022140: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
-00022150: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00022160: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
-00022170: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00022180: 2066 2753 746f 636b 3a7b 7361 7665 4469   f'Stock:{saveDi
-00022190: 6374 5b22 5374 6f63 6b22 5d7d 2c20 6973  ct["Stock"]}, is
-000221a0: 206e 6f74 2061 206d 6f6d 656e 7475 6d2d   not a momentum-
-000221b0: 6761 696e 6572 2062 6563 6175 7365 2065  gainer because e
-000221c0: 6974 6865 7220 746f 6461 792d 6f70 656e  ither today-open
-000221d0: 2028 7b74 6f7d 2920 3c20 7965 7374 6572   ({to}) < yester
-000221e0: 6461 792d 636c 6f73 6520 287b 7963 7d29  day-close ({yc})
-000221f0: 206f 7220 7965 7374 6572 6461 792d 6f70   or yesterday-op
-00022200: 656e 287b 796f 7d29 203c 2064 6179 2d62  en({yo}) < day-b
-00022210: 6566 6f72 652d 636c 6f73 6528 7b64 7963  efore-close({dyc
-00022220: 7d29 270a 2020 2020 2020 2020 2020 2020  })'.            
-00022230: 2020 2020 2020 2020 2320 290a 2020 2020          # ).    
-00022240: 2020 2020 2020 2020 6578 6365 7074 2049          except I
-00022250: 6e64 6578 4572 726f 7220 6173 2065 3a20  ndexError as e: 
-00022260: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
-00022270: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00022280: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
-00022290: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-000222a0: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-000222b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000222c0: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-000222d0: 6572 2e64 6562 7567 2864 6174 6129 0a20  er.debug(data). 
-000222e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000222f0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00022300: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00022310: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00022320: 7074 696f 6e20 6173 2065 3a20 2023 2070  ption as e:  # p
-00022330: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-00022340: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00022350: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-00022360: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-00022370: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-00022380: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00022390: 0a0a 2020 2020 2340 6d65 6173 7572 655f  ..    #@measure_
-000223a0: 7469 6d65 0a20 2020 2023 2056 616c 6964  time.    # Valid
-000223b0: 6174 6520 4d6f 7669 6e67 2061 7665 7261  ate Moving avera
-000223c0: 6765 7320 616e 6420 6c6f 6f6b 2066 6f72  ges and look for
-000223d0: 2062 7579 2f73 656c 6c20 7369 676e 616c   buy/sell signal
-000223e0: 730a 2020 2020 6465 6620 7661 6c69 6461  s.    def valida
-000223f0: 7465 4d6f 7669 6e67 4176 6572 6167 6573  teMovingAverages
-00022400: 2873 656c 662c 2064 662c 2073 6372 6565  (self, df, scree
-00022410: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
-00022420: 206d 6152 616e 6765 3d32 2e35 2c6d 614c   maRange=2.5,maL
-00022430: 656e 6774 683d 3029 3a0a 2020 2020 2020  ength=0):.      
-00022440: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-00022450: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-00022460: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-00022470: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00022480: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00022490: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-000224a0: 3029 0a20 2020 2020 2020 2072 6563 656e  0).        recen
-000224b0: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
-000224c0: 0a20 2020 2020 2020 206d 6153 6967 6e61  .        maSigna
-000224d0: 6c73 203d 205b 5d0a 2020 2020 2020 2020  ls = [].        
-000224e0: 6966 2073 7472 286d 614c 656e 6774 6829  if str(maLength)
-000224f0: 2069 6e20 5b22 3022 2c22 3222 2c22 3322   in ["0","2","3"
-00022500: 5d3a 0a20 2020 2020 2020 2020 2020 2073  ]:.            s
-00022510: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-00022520: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00022530: 6528 7363 7265 656e 4469 6374 2c73 6176  e(screenDict,sav
-00022540: 6544 6963 742c 224d 412d 5369 676e 616c  eDict,"MA-Signal
-00022550: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00022560: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00022570: 2020 2020 7265 6365 6e74 5b22 534d 4122      recent["SMA"
-00022580: 5d2e 696c 6f63 5b30 5d20 3e20 7265 6365  ].iloc[0] > rece
-00022590: 6e74 5b22 4c4d 4122 5d2e 696c 6f63 5b30  nt["LMA"].iloc[0
-000225a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000225b0: 2020 616e 6420 7265 6365 6e74 5b22 436c    and recent["Cl
-000225c0: 6f73 6522 5d2e 696c 6f63 5b30 5d20 3e20  ose"].iloc[0] > 
-000225d0: 7265 6365 6e74 5b22 534d 4122 5d2e 696c  recent["SMA"].il
-000225e0: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
-000225f0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00022600: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00022610: 224d 412d 5369 676e 616c 225d 203d 2028  "MA-Signal"] = (
-00022620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022630: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-00022640: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-00022650: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-00022660: 202b 2022 4275 6c6c 6973 6822 202b 2063   + "Bullish" + c
-00022670: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00022680: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00022690: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000226a0: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
-000226b0: 616c 225d 203d 2073 6176 6564 5b31 5d20  al"] = saved[1] 
-000226c0: 2b20 2242 756c 6c69 7368 220a 2020 2020  + "Bullish".    
-000226d0: 2020 2020 2020 2020 2020 2020 6d61 5369              maSi
-000226e0: 676e 616c 732e 6170 7065 6e64 2822 3322  gnals.append("3"
-000226f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00022700: 6966 2072 6563 656e 745b 2253 4d41 225d  if recent["SMA"]
-00022710: 2e69 6c6f 635b 305d 203c 2072 6563 656e  .iloc[0] < recen
-00022720: 745b 224c 4d41 225d 2e69 6c6f 635b 305d  t["LMA"].iloc[0]
-00022730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022740: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
-00022750: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
-00022760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022770: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00022780: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00022790: 6c6f 7254 6578 742e 4641 494c 202b 2022  lorText.FAIL + "
-000227a0: 4265 6172 6973 6822 202b 2063 6f6c 6f72  Bearish" + color
-000227b0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-000227c0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000227d0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-000227e0: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
-000227f0: 203d 2073 6176 6564 5b31 5d20 2b20 2242   = saved[1] + "B
-00022800: 6561 7269 7368 220a 2020 2020 2020 2020  earish".        
-00022810: 2020 2020 2020 2020 6d61 5369 676e 616c          maSignal
-00022820: 732e 6170 7065 6e64 2822 3222 290a 2020  s.append("2").  
-00022830: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-00022840: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
-00022850: 635b 305d 203d 3d20 303a 0a20 2020 2020  c[0] == 0:.     
-00022860: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00022870: 6e44 6963 745b 224d 412d 5369 676e 616c  nDict["MA-Signal
-00022880: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00022890: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-000228a0: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-000228b0: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-000228c0: 2e57 4152 4e20 2b20 2255 6e6b 6e6f 776e  .WARN + "Unknown
-000228d0: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-000228e0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-000228f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00022900: 2020 2020 7361 7665 4469 6374 5b22 4d41      saveDict["MA
-00022910: 2d53 6967 6e61 6c22 5d20 3d20 7361 7665  -Signal"] = save
-00022920: 645b 315d 202b 2022 556e 6b6e 6f77 6e22  d[1] + "Unknown"
-00022930: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00022940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00022950: 2020 2073 6372 6565 6e44 6963 745b 224d     screenDict["M
-00022960: 412d 5369 676e 616c 225d 203d 2028 0a20  A-Signal"] = (. 
-00022970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022980: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
-00022990: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
-000229a0: 6f6c 6f72 5465 7874 2e57 4152 4e20 2b20  olorText.WARN + 
-000229b0: 224e 6575 7472 616c 2220 2b20 636f 6c6f  "Neutral" + colo
-000229c0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-000229d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000229e0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-000229f0: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
-00022a00: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
-00022a10: 4e65 7574 7261 6c22 0a20 2020 2020 2020  Neutral".       
-00022a20: 2072 6576 6572 7365 6444 6174 6120 3d20   reversedData = 
-00022a30: 6461 7461 5b3a 3a2d 315d 2020 2320 5265  data[::-1]  # Re
-00022a40: 7665 7273 6520 7468 6520 6461 7461 6672  verse the datafr
-00022a50: 616d 650a 2020 2020 2020 2020 656d 615f  ame.        ema_
-00022a60: 3230 203d 2070 6b74 616c 6962 2e45 4d41  20 = pktalib.EMA
-00022a70: 2872 6576 6572 7365 6444 6174 615b 2243  (reversedData["C
-00022a80: 6c6f 7365 225d 2c32 3029 2e74 6169 6c28  lose"],20).tail(
-00022a90: 3129 2e69 6c6f 635b 305d 0a20 2020 2020  1).iloc[0].     
-00022aa0: 2020 2076 7761 7020 3d20 706b 7461 6c69     vwap = pktali
-00022ab0: 622e 5657 4150 2872 6576 6572 7365 6444  b.VWAP(reversedD
-00022ac0: 6174 615b 2248 6967 6822 5d2c 7265 7665  ata["High"],reve
-00022ad0: 7273 6564 4461 7461 5b22 4c6f 7722 5d2c  rsedData["Low"],
-00022ae0: 7265 7665 7273 6564 4461 7461 5b22 436c  reversedData["Cl
-00022af0: 6f73 6522 5d2c 7265 7665 7273 6564 4461  ose"],reversedDa
-00022b00: 7461 5b22 566f 6c75 6d65 225d 292e 7461  ta["Volume"]).ta
-00022b10: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
-00022b20: 2020 2020 2020 736d 6144 6576 203d 2064        smaDev = d
-00022b30: 6174 615b 2253 4d41 225d 2e69 6c6f 635b  ata["SMA"].iloc[
-00022b40: 305d 202a 206d 6152 616e 6765 202f 2031  0] * maRange / 1
-00022b50: 3030 0a20 2020 2020 2020 206c 6d61 4465  00.        lmaDe
-00022b60: 7620 3d20 6461 7461 5b22 4c4d 4122 5d2e  v = data["LMA"].
-00022b70: 696c 6f63 5b30 5d20 2a20 6d61 5261 6e67  iloc[0] * maRang
-00022b80: 6520 2f20 3130 300a 2020 2020 2020 2020  e / 100.        
-00022b90: 656d 6144 6576 203d 2065 6d61 5f32 3020  emaDev = ema_20 
-00022ba0: 2a20 6d61 5261 6e67 6520 2f20 3130 300a  * maRange / 100.
-00022bb0: 2020 2020 2020 2020 7677 6170 4465 7620          vwapDev 
-00022bc0: 3d20 7677 6170 202a 206d 6152 616e 6765  = vwap * maRange
-00022bd0: 202f 2031 3030 0a20 2020 2020 2020 206f   / 100.        o
-00022be0: 7065 6e2c 2068 6967 682c 206c 6f77 2c20  pen, high, low, 
-00022bf0: 636c 6f73 652c 2073 6d61 2c20 6c6d 6120  close, sma, lma 
-00022c00: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00022c10: 6461 7461 5b22 4f70 656e 225d 2e69 6c6f  data["Open"].ilo
-00022c20: 635b 305d 2c0a 2020 2020 2020 2020 2020  c[0],.          
-00022c30: 2020 6461 7461 5b22 4869 6768 225d 2e69    data["High"].i
-00022c40: 6c6f 635b 305d 2c0a 2020 2020 2020 2020  loc[0],.        
-00022c50: 2020 2020 6461 7461 5b22 4c6f 7722 5d2e      data["Low"].
-00022c60: 696c 6f63 5b30 5d2c 0a20 2020 2020 2020  iloc[0],.       
-00022c70: 2020 2020 2064 6174 615b 2243 6c6f 7365       data["Close
-00022c80: 225d 2e69 6c6f 635b 305d 2c0a 2020 2020  "].iloc[0],.    
-00022c90: 2020 2020 2020 2020 6461 7461 5b22 534d          data["SM
-00022ca0: 4122 5d2e 696c 6f63 5b30 5d2c 0a20 2020  A"].iloc[0],.   
-00022cb0: 2020 2020 2020 2020 2064 6174 615b 224c           data["L
-00022cc0: 4d41 225d 2e69 6c6f 635b 305d 2c0a 2020  MA"].iloc[0],.  
-00022cd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00022ce0: 6d61 7320 3d20 5b73 6d61 2c6c 6d61 2c65  mas = [sma,lma,e
-00022cf0: 6d61 5f32 302c 7677 6170 5d20 6966 206d  ma_20,vwap] if m
-00022d00: 614c 656e 6774 683d 3d30 2065 6c73 6520  aLength==0 else 
-00022d10: 5b73 6d61 2c6c 6d61 2c65 6d61 5f32 305d  [sma,lma,ema_20]
-00022d20: 0a20 2020 2020 2020 206d 6144 6576 7320  .        maDevs 
-00022d30: 3d20 5b73 6d61 4465 762c 206c 6d61 4465  = [smaDev, lmaDe
-00022d40: 762c 2065 6d61 4465 762c 2076 7761 7044  v, emaDev, vwapD
-00022d50: 6576 5d20 6966 206d 614c 656e 6774 683d  ev] if maLength=
-00022d60: 3d30 2065 6c73 6520 5b73 6d61 4465 762c  =0 else [smaDev,
-00022d70: 206c 6d61 4465 762c 2065 6d61 4465 765d   lmaDev, emaDev]
-00022d80: 0a20 2020 2020 2020 206d 6154 6578 7473  .        maTexts
-00022d90: 203d 205b 2235 304d 4122 2c22 3230 304d   = ["50MA","200M
-00022da0: 4122 2c22 3230 454d 4122 2c22 5657 4150  A","20EMA","VWAP
-00022db0: 225d 2069 6620 6d61 4c65 6e67 7468 3d3d  "] if maLength==
-00022dc0: 3020 656c 7365 205b 2235 304d 4122 2c22  0 else ["50MA","
-00022dd0: 3230 304d 4122 2c22 3230 454d 4122 5d0a  200MA","20EMA"].
-00022de0: 2020 2020 2020 2020 6d61 5265 7665 7273          maRevers
-00022df0: 616c 203d 2030 0a20 2020 2020 2020 2069  al = 0.        i
-00022e00: 6e64 6578 203d 2030 0a20 2020 2020 2020  ndex = 0.       
-00022e10: 2062 756c 6c69 7368 4361 6e64 6c65 203d   bullishCandle =
-00022e20: 2073 656c 662e 6765 7443 616e 646c 6554   self.getCandleT
-00022e30: 7970 6528 6461 7461 290a 2020 2020 2020  ype(data).      
-00022e40: 2020 6966 2073 7472 286d 614c 656e 6774    if str(maLengt
-00022e50: 6829 206e 6f74 2069 6e20 5b22 3222 2c22  h) not in ["2","
-00022e60: 3322 5d3a 0a20 2020 2020 2020 2020 2020  3"]:.           
-00022e70: 2066 6f72 206d 6120 696e 206d 6173 3a0a   for ma in mas:.
-00022e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e90: 7361 7665 6420 3d20 7365 6c66 2e66 696e  saved = self.fin
-00022ea0: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
-00022eb0: 7565 2873 6372 6565 6e44 6963 742c 7361  ue(screenDict,sa
-00022ec0: 7665 4469 6374 2c22 4d41 2d53 6967 6e61  veDict,"MA-Signa
-00022ed0: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-00022ee0: 2020 2020 2320 5461 6b69 6e67 2053 7570      # Taking Sup
-00022ef0: 706f 7274 0a20 2020 2020 2020 2020 2020  port.           
-00022f00: 2020 2020 2069 6620 636c 6f73 6520 3e20       if close > 
-00022f10: 6d61 2061 6e64 206c 6f77 203c 3d20 286d  ma and low <= (m
-00022f20: 6120 2b20 6d61 4465 7673 5b69 6e64 6578  a + maDevs[index
-00022f30: 5d29 2061 6e64 2073 7472 286d 614c 656e  ]) and str(maLen
-00022f40: 6774 6829 2069 6e20 5b22 3022 2c22 3122  gth) in ["0","1"
-00022f50: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00022f60: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-00022f70: 745b 224d 412d 5369 676e 616c 225d 203d  t["MA-Signal"] =
-00022f80: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00022f90: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-00022fa0: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00022fb0: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-00022fc0: 2e47 5245 454e 202b 2066 227b 6d61 5465  .GREEN + f"{maTe
-00022fd0: 7874 735b 696e 6465 785d 7d2d 5375 7070  xts[index]}-Supp
-00022fe0: 6f72 7422 202b 2063 6f6c 6f72 5465 7874  ort" + colorText
-00022ff0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-00023000: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00023010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00023020: 6176 6544 6963 745b 224d 412d 5369 676e  aveDict["MA-Sign
-00023030: 616c 225d 203d 2073 6176 6564 5b31 5d20  al"] = saved[1] 
-00023040: 2b20 6622 7b6d 6154 6578 7473 5b69 6e64  + f"{maTexts[ind
-00023050: 6578 5d7d 2d53 7570 706f 7274 220a 2020  ex]}-Support".  
-00023060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023070: 2020 6d61 5265 7665 7273 616c 203d 2031    maReversal = 1
-00023080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023090: 2020 2020 206d 6153 6967 6e61 6c73 2e61       maSignals.a
-000230a0: 7070 656e 6428 2231 2229 0a20 2020 2020  ppend("1").     
-000230b0: 2020 2020 2020 2020 2020 2023 2056 616c             # Val
-000230c0: 6964 6174 696e 6720 5265 7369 7374 616e  idating Resistan
-000230d0: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-000230e0: 2020 2065 6c69 6620 636c 6f73 6520 3c20     elif close < 
-000230f0: 6d61 2061 6e64 2068 6967 6820 3e3d 2028  ma and high >= (
-00023100: 6d61 202d 206d 6144 6576 735b 696e 6465  ma - maDevs[inde
-00023110: 785d 2920 616e 6420 7374 7228 6d61 4c65  x]) and str(maLe
-00023120: 6e67 7468 2920 696e 205b 2230 222c 2236  ngth) in ["0","6
-00023130: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00023140: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00023150: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-00023160: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00023170: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00023180: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
-00023190: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
-000231a0: 742e 4641 494c 202b 2066 227b 6d61 5465  t.FAIL + f"{maTe
-000231b0: 7874 735b 696e 6465 785d 7d2d 5265 7369  xts[index]}-Resi
-000231c0: 7374 2220 2b20 636f 6c6f 7254 6578 742e  st" + colorText.
-000231d0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-000231e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000231f0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00023200: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
-00023210: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
-00023220: 2066 227b 6d61 5465 7874 735b 696e 6465   f"{maTexts[inde
-00023230: 785d 7d2d 5265 7369 7374 220a 2020 2020  x]}-Resist".    
-00023240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023250: 6d61 5265 7665 7273 616c 203d 202d 310a  maReversal = -1.
-00023260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023270: 2020 2020 6d61 5369 676e 616c 732e 6170      maSignals.ap
-00023280: 7065 6e64 2822 3622 290a 2020 2020 2020  pend("6").      
-00023290: 2020 2020 2020 2020 2020 2320 466f 7220            # For 
-000232a0: 6120 4275 6c6c 6973 6820 4361 6e64 6c65  a Bullish Candle
-000232b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000232c0: 2069 6620 6275 6c6c 6973 6843 616e 646c   if bullishCandl
-000232d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000232e0: 2020 2020 2020 2023 2043 726f 7373 696e         # Crossin
-000232f0: 6720 7570 0a20 2020 2020 2020 2020 2020  g up.           
-00023300: 2020 2020 2020 2020 2069 6620 6f70 656e           if open
-00023310: 203c 206d 6120 616e 6420 636c 6f73 6520   < ma and close 
-00023320: 3e20 6d61 2061 6e64 2073 7472 286d 614c  > ma and str(maL
-00023330: 656e 6774 6829 2069 6e20 5b22 3022 2c22  ength) in ["0","
-00023340: 3522 5d3a 0a20 2020 2020 2020 2020 2020  5"]:.           
-00023350: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-00023360: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
-00023370: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
-00023380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023390: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-000233a0: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-000233b0: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-000233c0: 202b 2066 2242 756c 6c43 726f 7373 2d7b   + f"BullCross-{
-000233d0: 6d61 5465 7874 735b 696e 6465 785d 7d22  maTexts[index]}"
-000233e0: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-000233f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023400: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00023410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023420: 2020 2073 6176 6544 6963 745b 224d 412d     saveDict["MA-
-00023430: 5369 676e 616c 225d 203d 2073 6176 6564  Signal"] = saved
-00023440: 5b31 5d20 2b20 6622 4275 6c6c 4372 6f73  [1] + f"BullCros
-00023450: 732d 7b6d 6154 6578 7473 5b69 6e64 6578  s-{maTexts[index
-00023460: 5d7d 220a 2020 2020 2020 2020 2020 2020  ]}".            
-00023470: 2020 2020 2020 2020 2020 2020 6d61 5265              maRe
-00023480: 7665 7273 616c 203d 2031 0a20 2020 2020  versal = 1.     
+000220e0: 2020 2020 2020 2020 2020 2020 2b20 224d              + "M
+000220f0: 6f6d 656e 7475 6d20 4761 696e 6572 220a  omentum Gainer".
+00022100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022110: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+00022120: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00022130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022140: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00022150: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00022160: 7665 4469 6374 5b22 5061 7474 6572 6e22  veDict["Pattern"
+00022170: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
+00022180: 4d6f 6d65 6e74 756d 2047 6169 6e65 7222  Momentum Gainer"
+00022190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000221a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000221b0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+000221c0: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+000221d0: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
+000221e0: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
+000221f0: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
+00022200: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
+00022210: 5b22 5374 6f63 6b22 5d7d 2c20 6973 206e  ["Stock"]}, is n
+00022220: 6f74 2061 206d 6f6d 656e 7475 6d2d 6761  ot a momentum-ga
+00022230: 696e 6572 2062 6563 6175 7365 2065 6974  iner because eit
+00022240: 6865 7220 746f 6461 792d 6f70 656e 2028  her today-open (
+00022250: 7b74 6f7d 2920 3c20 7965 7374 6572 6461  {to}) < yesterda
+00022260: 792d 636c 6f73 6520 287b 7963 7d29 206f  y-close ({yc}) o
+00022270: 7220 7965 7374 6572 6461 792d 6f70 656e  r yesterday-open
+00022280: 287b 796f 7d29 203c 2064 6179 2d62 6566  ({yo}) < day-bef
+00022290: 6f72 652d 636c 6f73 6528 7b64 7963 7d29  ore-close({dyc})
+000222a0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+000222b0: 2020 2020 2020 2320 290a 2020 2020 2020        # ).      
+000222c0: 2020 2020 2020 6578 6365 7074 2049 6e64        except Ind
+000222d0: 6578 4572 726f 7220 6173 2065 3a20 2320  exError as e: # 
+000222e0: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
+000222f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022300: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+00022310: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
+00022320: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
+00022330: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00022340: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00022350: 2e64 6562 7567 2864 6174 6129 0a20 2020  .debug(data).   
+00022360: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00022370: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
+00022380: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00022390: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000223a0: 696f 6e20 6173 2065 3a20 2023 2070 7261  ion as e:  # pra
+000223b0: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
+000223c0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+000223d0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+000223e0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+000223f0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00022400: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+00022410: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
+00022420: 6d65 0a20 2020 2023 2056 616c 6964 6174  me.    # Validat
+00022430: 6520 4d6f 7669 6e67 2061 7665 7261 6765  e Moving average
+00022440: 7320 616e 6420 6c6f 6f6b 2066 6f72 2062  s and look for b
+00022450: 7579 2f73 656c 6c20 7369 676e 616c 730a  uy/sell signals.
+00022460: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00022470: 4d6f 7669 6e67 4176 6572 6167 6573 2873  MovingAverages(s
+00022480: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
+00022490: 6963 742c 2073 6176 6544 6963 742c 206d  ict, saveDict, m
+000224a0: 6152 616e 6765 3d32 2e35 2c6d 614c 656e  aRange=2.5,maLen
+000224b0: 6774 683d 3029 3a0a 2020 2020 2020 2020  gth=0):.        
+000224c0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+000224d0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+000224e0: 6461 7461 2e66 696c 6c6e 6128 3029 0a20  data.fillna(0). 
+000224f0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00022500: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+00022510: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+00022520: 0a20 2020 2020 2020 2072 6563 656e 7420  .        recent 
+00022530: 3d20 6461 7461 2e68 6561 6428 3129 0a20  = data.head(1). 
+00022540: 2020 2020 2020 206d 6153 6967 6e61 6c73         maSignals
+00022550: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
+00022560: 2073 7472 286d 614c 656e 6774 6829 2069   str(maLength) i
+00022570: 6e20 5b22 3022 2c22 3222 2c22 3322 5d3a  n ["0","2","3"]:
+00022580: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
+00022590: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+000225a0: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+000225b0: 7363 7265 656e 4469 6374 2c73 6176 6544  screenDict,saveD
+000225c0: 6963 742c 224d 412d 5369 676e 616c 2229  ict,"MA-Signal")
+000225d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000225e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000225f0: 2020 7265 6365 6e74 5b22 534d 4122 5d2e    recent["SMA"].
+00022600: 696c 6f63 5b30 5d20 3e20 7265 6365 6e74  iloc[0] > recent
+00022610: 5b22 4c4d 4122 5d2e 696c 6f63 5b30 5d0a  ["LMA"].iloc[0].
+00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022630: 616e 6420 7265 6365 6e74 5b22 436c 6f73  and recent["Clos
+00022640: 6522 5d2e 696c 6f63 5b30 5d20 3e20 7265  e"].iloc[0] > re
+00022650: 6365 6e74 5b22 534d 4122 5d2e 696c 6f63  cent["SMA"].iloc
+00022660: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00022670: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00022680: 2020 2073 6372 6565 6e44 6963 745b 224d     screenDict["M
+00022690: 412d 5369 676e 616c 225d 203d 2028 0a20  A-Signal"] = (. 
+000226a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226b0: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
+000226c0: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
+000226d0: 6f6c 6f72 5465 7874 2e47 5245 454e 202b  olorText.GREEN +
+000226e0: 2022 4275 6c6c 6973 6822 202b 2063 6f6c   "Bullish" + col
+000226f0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00022700: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00022710: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00022720: 6544 6963 745b 224d 412d 5369 676e 616c  eDict["MA-Signal
+00022730: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
+00022740: 2242 756c 6c69 7368 220a 2020 2020 2020  "Bullish".      
+00022750: 2020 2020 2020 2020 2020 6d61 5369 676e            maSign
+00022760: 616c 732e 6170 7065 6e64 2822 3322 290a  als.append("3").
+00022770: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00022780: 2072 6563 656e 745b 2253 4d41 225d 2e69   recent["SMA"].i
+00022790: 6c6f 635b 305d 203c 2072 6563 656e 745b  loc[0] < recent[
+000227a0: 224c 4d41 225d 2e69 6c6f 635b 305d 3a0a  "LMA"].iloc[0]:.
+000227b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000227c0: 7363 7265 656e 4469 6374 5b22 4d41 2d53  screenDict["MA-S
+000227d0: 6967 6e61 6c22 5d20 3d20 280a 2020 2020  ignal"] = (.    
+000227e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000227f0: 7361 7665 645b 305d 202b 2063 6f6c 6f72  saved[0] + color
+00022800: 5465 7874 2e42 4f4c 4420 2b20 636f 6c6f  Text.BOLD + colo
+00022810: 7254 6578 742e 4641 494c 202b 2022 4265  rText.FAIL + "Be
+00022820: 6172 6973 6822 202b 2063 6f6c 6f72 5465  arish" + colorTe
+00022830: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00022840: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00022850: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+00022860: 745b 224d 412d 5369 676e 616c 225d 203d  t["MA-Signal"] =
+00022870: 2073 6176 6564 5b31 5d20 2b20 2242 6561   saved[1] + "Bea
+00022880: 7269 7368 220a 2020 2020 2020 2020 2020  rish".          
+00022890: 2020 2020 2020 6d61 5369 676e 616c 732e        maSignals.
+000228a0: 6170 7065 6e64 2822 3222 290a 2020 2020  append("2").    
+000228b0: 2020 2020 2020 2020 656c 6966 2072 6563          elif rec
+000228c0: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
+000228d0: 305d 203d 3d20 303a 0a20 2020 2020 2020  0] == 0:.       
+000228e0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+000228f0: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+00022900: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00022910: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
+00022920: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
+00022930: 4c44 202b 2063 6f6c 6f72 5465 7874 2e57  LD + colorText.W
+00022940: 4152 4e20 2b20 2255 6e6b 6e6f 776e 2220  ARN + "Unknown" 
+00022950: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+00022960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022970: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00022980: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
+00022990: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
+000229a0: 315d 202b 2022 556e 6b6e 6f77 6e22 0a20  1] + "Unknown". 
+000229b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000229c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000229d0: 2073 6372 6565 6e44 6963 745b 224d 412d   screenDict["MA-
+000229e0: 5369 676e 616c 225d 203d 2028 0a20 2020  Signal"] = (.   
+000229f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a00: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00022a10: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00022a20: 6f72 5465 7874 2e57 4152 4e20 2b20 224e  orText.WARN + "N
+00022a30: 6575 7472 616c 2220 2b20 636f 6c6f 7254  eutral" + colorT
+00022a40: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+00022a50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022a60: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+00022a70: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
+00022a80: 3d20 7361 7665 645b 315d 202b 2022 4e65  = saved[1] + "Ne
+00022a90: 7574 7261 6c22 0a20 2020 2020 2020 2072  utral".        r
+00022aa0: 6576 6572 7365 6444 6174 6120 3d20 6461  eversedData = da
+00022ab0: 7461 5b3a 3a2d 315d 2020 2320 5265 7665  ta[::-1]  # Reve
+00022ac0: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+00022ad0: 650a 2020 2020 2020 2020 656d 615f 3230  e.        ema_20
+00022ae0: 203d 2070 6b74 616c 6962 2e45 4d41 2872   = pktalib.EMA(r
+00022af0: 6576 6572 7365 6444 6174 615b 2243 6c6f  eversedData["Clo
+00022b00: 7365 225d 2c32 3029 2e74 6169 6c28 3129  se"],20).tail(1)
+00022b10: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00022b20: 2076 7761 7020 3d20 706b 7461 6c69 622e   vwap = pktalib.
+00022b30: 5657 4150 2872 6576 6572 7365 6444 6174  VWAP(reversedDat
+00022b40: 615b 2248 6967 6822 5d2c 7265 7665 7273  a["High"],revers
+00022b50: 6564 4461 7461 5b22 4c6f 7722 5d2c 7265  edData["Low"],re
+00022b60: 7665 7273 6564 4461 7461 5b22 436c 6f73  versedData["Clos
+00022b70: 6522 5d2c 7265 7665 7273 6564 4461 7461  e"],reversedData
+00022b80: 5b22 566f 6c75 6d65 225d 292e 7461 696c  ["Volume"]).tail
+00022b90: 2831 292e 696c 6f63 5b30 5d0a 2020 2020  (1).iloc[0].    
+00022ba0: 2020 2020 736d 6144 6576 203d 2064 6174      smaDev = dat
+00022bb0: 615b 2253 4d41 225d 2e69 6c6f 635b 305d  a["SMA"].iloc[0]
+00022bc0: 202a 206d 6152 616e 6765 202f 2031 3030   * maRange / 100
+00022bd0: 0a20 2020 2020 2020 206c 6d61 4465 7620  .        lmaDev 
+00022be0: 3d20 6461 7461 5b22 4c4d 4122 5d2e 696c  = data["LMA"].il
+00022bf0: 6f63 5b30 5d20 2a20 6d61 5261 6e67 6520  oc[0] * maRange 
+00022c00: 2f20 3130 300a 2020 2020 2020 2020 656d  / 100.        em
+00022c10: 6144 6576 203d 2065 6d61 5f32 3020 2a20  aDev = ema_20 * 
+00022c20: 6d61 5261 6e67 6520 2f20 3130 300a 2020  maRange / 100.  
+00022c30: 2020 2020 2020 7677 6170 4465 7620 3d20        vwapDev = 
+00022c40: 7677 6170 202a 206d 6152 616e 6765 202f  vwap * maRange /
+00022c50: 2031 3030 0a20 2020 2020 2020 206f 7065   100.        ope
+00022c60: 6e2c 2068 6967 682c 206c 6f77 2c20 636c  n, high, low, cl
+00022c70: 6f73 652c 2073 6d61 2c20 6c6d 6120 3d20  ose, sma, lma = 
+00022c80: 280a 2020 2020 2020 2020 2020 2020 6461  (.            da
+00022c90: 7461 5b22 4f70 656e 225d 2e69 6c6f 635b  ta["Open"].iloc[
+00022ca0: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+00022cb0: 6461 7461 5b22 4869 6768 225d 2e69 6c6f  data["High"].ilo
+00022cc0: 635b 305d 2c0a 2020 2020 2020 2020 2020  c[0],.          
+00022cd0: 2020 6461 7461 5b22 4c6f 7722 5d2e 696c    data["Low"].il
+00022ce0: 6f63 5b30 5d2c 0a20 2020 2020 2020 2020  oc[0],.         
+00022cf0: 2020 2064 6174 615b 2243 6c6f 7365 225d     data["Close"]
+00022d00: 2e69 6c6f 635b 305d 2c0a 2020 2020 2020  .iloc[0],.      
+00022d10: 2020 2020 2020 6461 7461 5b22 534d 4122        data["SMA"
+00022d20: 5d2e 696c 6f63 5b30 5d2c 0a20 2020 2020  ].iloc[0],.     
+00022d30: 2020 2020 2020 2064 6174 615b 224c 4d41         data["LMA
+00022d40: 225d 2e69 6c6f 635b 305d 2c0a 2020 2020  "].iloc[0],.    
+00022d50: 2020 2020 290a 2020 2020 2020 2020 6d61      ).        ma
+00022d60: 7320 3d20 5b73 6d61 2c6c 6d61 2c65 6d61  s = [sma,lma,ema
+00022d70: 5f32 302c 7677 6170 5d20 6966 206d 614c  _20,vwap] if maL
+00022d80: 656e 6774 683d 3d30 2065 6c73 6520 5b73  ength==0 else [s
+00022d90: 6d61 2c6c 6d61 2c65 6d61 5f32 305d 0a20  ma,lma,ema_20]. 
+00022da0: 2020 2020 2020 206d 6144 6576 7320 3d20         maDevs = 
+00022db0: 5b73 6d61 4465 762c 206c 6d61 4465 762c  [smaDev, lmaDev,
+00022dc0: 2065 6d61 4465 762c 2076 7761 7044 6576   emaDev, vwapDev
+00022dd0: 5d20 6966 206d 614c 656e 6774 683d 3d30  ] if maLength==0
+00022de0: 2065 6c73 6520 5b73 6d61 4465 762c 206c   else [smaDev, l
+00022df0: 6d61 4465 762c 2065 6d61 4465 765d 0a20  maDev, emaDev]. 
+00022e00: 2020 2020 2020 206d 6154 6578 7473 203d         maTexts =
+00022e10: 205b 2235 304d 4122 2c22 3230 304d 4122   ["50MA","200MA"
+00022e20: 2c22 3230 454d 4122 2c22 5657 4150 225d  ,"20EMA","VWAP"]
+00022e30: 2069 6620 6d61 4c65 6e67 7468 3d3d 3020   if maLength==0 
+00022e40: 656c 7365 205b 2235 304d 4122 2c22 3230  else ["50MA","20
+00022e50: 304d 4122 2c22 3230 454d 4122 5d0a 2020  0MA","20EMA"].  
+00022e60: 2020 2020 2020 6d61 5265 7665 7273 616c        maReversal
+00022e70: 203d 2030 0a20 2020 2020 2020 2069 6e64   = 0.        ind
+00022e80: 6578 203d 2030 0a20 2020 2020 2020 2062  ex = 0.        b
+00022e90: 756c 6c69 7368 4361 6e64 6c65 203d 2073  ullishCandle = s
+00022ea0: 656c 662e 6765 7443 616e 646c 6554 7970  elf.getCandleTyp
+00022eb0: 6528 6461 7461 290a 2020 2020 2020 2020  e(data).        
+00022ec0: 6966 2073 7472 286d 614c 656e 6774 6829  if str(maLength)
+00022ed0: 206e 6f74 2069 6e20 5b22 3222 2c22 3322   not in ["2","3"
+00022ee0: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
+00022ef0: 6f72 206d 6120 696e 206d 6173 3a0a 2020  or ma in mas:.  
+00022f00: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00022f10: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+00022f20: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+00022f30: 2873 6372 6565 6e44 6963 742c 7361 7665  (screenDict,save
+00022f40: 4469 6374 2c22 4d41 2d53 6967 6e61 6c22  Dict,"MA-Signal"
+00022f50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00022f60: 2020 2320 5461 6b69 6e67 2053 7570 706f    # Taking Suppo
+00022f70: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
+00022f80: 2020 2069 6620 636c 6f73 6520 3e20 6d61     if close > ma
+00022f90: 2061 6e64 206c 6f77 203c 3d20 286d 6120   and low <= (ma 
+00022fa0: 2b20 6d61 4465 7673 5b69 6e64 6578 5d29  + maDevs[index])
+00022fb0: 2061 6e64 2073 7472 286d 614c 656e 6774   and str(maLengt
+00022fc0: 6829 2069 6e20 5b22 3022 2c22 3122 5d3a  h) in ["0","1"]:
+00022fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022fe0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00022ff0: 224d 412d 5369 676e 616c 225d 203d 2028  "MA-Signal"] = (
+00023000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023010: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
+00023020: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
+00023030: 4c44 202b 2063 6f6c 6f72 5465 7874 2e47  LD + colorText.G
+00023040: 5245 454e 202b 2066 227b 6d61 5465 7874  REEN + f"{maText
+00023050: 735b 696e 6465 785d 7d2d 5375 7070 6f72  s[index]}-Suppor
+00023060: 7422 202b 2063 6f6c 6f72 5465 7874 2e45  t" + colorText.E
+00023070: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+00023080: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00023090: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+000230a0: 6544 6963 745b 224d 412d 5369 676e 616c  eDict["MA-Signal
+000230b0: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
+000230c0: 6622 7b6d 6154 6578 7473 5b69 6e64 6578  f"{maTexts[index
+000230d0: 5d7d 2d53 7570 706f 7274 220a 2020 2020  ]}-Support".    
+000230e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230f0: 6d61 5265 7665 7273 616c 203d 2031 0a20  maReversal = 1. 
+00023100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023110: 2020 206d 6153 6967 6e61 6c73 2e61 7070     maSignals.app
+00023120: 656e 6428 2231 2229 0a20 2020 2020 2020  end("1").       
+00023130: 2020 2020 2020 2020 2023 2056 616c 6964           # Valid
+00023140: 6174 696e 6720 5265 7369 7374 616e 6365  ating Resistance
+00023150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023160: 2065 6c69 6620 636c 6f73 6520 3c20 6d61   elif close < ma
+00023170: 2061 6e64 2068 6967 6820 3e3d 2028 6d61   and high >= (ma
+00023180: 202d 206d 6144 6576 735b 696e 6465 785d   - maDevs[index]
+00023190: 2920 616e 6420 7374 7228 6d61 4c65 6e67  ) and str(maLeng
+000231a0: 7468 2920 696e 205b 2230 222c 2236 225d  th) in ["0","6"]
+000231b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000231c0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+000231d0: 5b22 4d41 2d53 6967 6e61 6c22 5d20 3d20  ["MA-Signal"] = 
+000231e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000231f0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
+00023200: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
+00023210: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
+00023220: 4641 494c 202b 2066 227b 6d61 5465 7874  FAIL + f"{maText
+00023230: 735b 696e 6465 785d 7d2d 5265 7369 7374  s[index]}-Resist
+00023240: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
+00023250: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+00023260: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00023270: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00023280: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
+00023290: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
+000232a0: 227b 6d61 5465 7874 735b 696e 6465 785d  "{maTexts[index]
+000232b0: 7d2d 5265 7369 7374 220a 2020 2020 2020  }-Resist".      
+000232c0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+000232d0: 5265 7665 7273 616c 203d 202d 310a 2020  Reversal = -1.  
+000232e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000232f0: 2020 6d61 5369 676e 616c 732e 6170 7065    maSignals.appe
+00023300: 6e64 2822 3622 290a 2020 2020 2020 2020  nd("6").        
+00023310: 2020 2020 2020 2020 2320 466f 7220 6120          # For a 
+00023320: 4275 6c6c 6973 6820 4361 6e64 6c65 0a20  Bullish Candle. 
+00023330: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023340: 6620 6275 6c6c 6973 6843 616e 646c 653a  f bullishCandle:
+00023350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023360: 2020 2020 2023 2043 726f 7373 696e 6720       # Crossing 
+00023370: 7570 0a20 2020 2020 2020 2020 2020 2020  up.             
+00023380: 2020 2020 2020 2069 6620 6f70 656e 203c         if open <
+00023390: 206d 6120 616e 6420 636c 6f73 6520 3e20   ma and close > 
+000233a0: 6d61 2061 6e64 2073 7472 286d 614c 656e  ma and str(maLen
+000233b0: 6774 6829 2069 6e20 5b22 3022 2c22 3522  gth) in ["0","5"
+000233c0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+000233d0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+000233e0: 6e44 6963 745b 224d 412d 5369 676e 616c  nDict["MA-Signal
+000233f0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+00023400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023410: 2020 2073 6176 6564 5b30 5d20 2b20 636f     saved[0] + co
+00023420: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
+00023430: 6f6c 6f72 5465 7874 2e47 5245 454e 202b  olorText.GREEN +
+00023440: 2066 2242 756c 6c43 726f 7373 2d7b 6d61   f"BullCross-{ma
+00023450: 5465 7874 735b 696e 6465 785d 7d22 202b  Texts[index]}" +
+00023460: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00023470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023480: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
 00023490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234a0: 2020 206d 6153 6967 6e61 6c73 2e61 7070     maSignals.app
-000234b0: 656e 6428 2235 2229 0a20 2020 2020 2020  end("5").       
-000234c0: 2020 2020 2020 2020 2023 2046 6f72 2061           # For a
-000234d0: 2042 6561 7269 7368 2043 616e 646c 650a   Bearish Candle.
-000234e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234f0: 656c 6966 206e 6f74 2062 756c 6c69 7368  elif not bullish
-00023500: 4361 6e64 6c65 3a0a 2020 2020 2020 2020  Candle:.        
-00023510: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-00023520: 6f73 7369 6e67 2064 6f77 6e0a 2020 2020  ossing down.    
-00023530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023540: 6966 206f 7065 6e20 3e20 736d 6120 616e  if open > sma an
-00023550: 6420 636c 6f73 6520 3c20 736d 6120 616e  d close < sma an
-00023560: 6420 7374 7228 6d61 4c65 6e67 7468 2920  d str(maLength) 
-00023570: 696e 205b 2230 222c 2234 225d 3a0a 2020  in ["0","4"]:.  
-00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023590: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-000235a0: 5b22 4d41 2d53 6967 6e61 6c22 5d20 3d20  ["MA-Signal"] = 
-000235b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000235c0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000235d0: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
-000235e0: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
-000235f0: 6578 742e 4641 494c 202b 2066 2242 6561  ext.FAIL + f"Bea
-00023600: 7243 726f 7373 2d7b 6d61 5465 7874 735b  rCross-{maTexts[
-00023610: 696e 6465 785d 7d22 202b 2063 6f6c 6f72  index]}" + color
-00023620: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+000234a0: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
+000234b0: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
+000234c0: 5d20 2b20 6622 4275 6c6c 4372 6f73 732d  ] + f"BullCross-
+000234d0: 7b6d 6154 6578 7473 5b69 6e64 6578 5d7d  {maTexts[index]}
+000234e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000234f0: 2020 2020 2020 2020 2020 6d61 5265 7665            maReve
+00023500: 7273 616c 203d 2031 0a20 2020 2020 2020  rsal = 1.       
+00023510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023520: 206d 6153 6967 6e61 6c73 2e61 7070 656e   maSignals.appen
+00023530: 6428 2235 2229 0a20 2020 2020 2020 2020  d("5").         
+00023540: 2020 2020 2020 2023 2046 6f72 2061 2042         # For a B
+00023550: 6561 7269 7368 2043 616e 646c 650a 2020  earish Candle.  
+00023560: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00023570: 6966 206e 6f74 2062 756c 6c69 7368 4361  if not bullishCa
+00023580: 6e64 6c65 3a0a 2020 2020 2020 2020 2020  ndle:.          
+00023590: 2020 2020 2020 2020 2020 2320 4372 6f73            # Cros
+000235a0: 7369 6e67 2064 6f77 6e0a 2020 2020 2020  sing down.      
+000235b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000235c0: 206f 7065 6e20 3e20 736d 6120 616e 6420   open > sma and 
+000235d0: 636c 6f73 6520 3c20 736d 6120 616e 6420  close < sma and 
+000235e0: 7374 7228 6d61 4c65 6e67 7468 2920 696e  str(maLength) in
+000235f0: 205b 2230 222c 2234 225d 3a0a 2020 2020   ["0","4"]:.    
+00023600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023610: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00023620: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
 00023630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023640: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00023650: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00023660: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
-00023670: 203d 2073 6176 6564 5b31 5d20 2b20 6622   = saved[1] + f"
-00023680: 4265 6172 4372 6f73 732d 7b6d 6154 6578  BearCross-{maTex
-00023690: 7473 5b69 6e64 6578 5d7d 220a 2020 2020  ts[index]}".    
-000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236b0: 2020 2020 6d61 5265 7665 7273 616c 203d      maReversal =
-000236c0: 202d 310a 2020 2020 2020 2020 2020 2020   -1.            
-000236d0: 2020 2020 2020 2020 2020 2020 6d61 5369              maSi
-000236e0: 676e 616c 732e 6170 7065 6e64 2822 3422  gnals.append("4"
-000236f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00023700: 2020 696e 6465 7820 2b3d 2031 0a20 2020    index += 1.   
-00023710: 2020 2020 2072 6574 7572 6e56 616c 7565       returnValue
-00023720: 203d 206d 6152 6576 6572 7361 6c0a 2020   = maReversal.  
-00023730: 2020 2020 2020 6966 206d 614c 656e 6774        if maLengt
-00023740: 6820 213d 2030 3a0a 2020 2020 2020 2020  h != 0:.        
-00023750: 2020 2020 7265 7475 726e 5661 6c75 6520      returnValue 
-00023760: 3d20 7374 7228 6d61 4c65 6e67 7468 2920  = str(maLength) 
-00023770: 696e 206d 6153 6967 6e61 6c73 0a20 2020  in maSignals.   
-00023780: 2020 2020 2072 6574 7572 6e20 7265 7475       return retu
-00023790: 726e 5661 6c75 650a 0a20 2020 2023 2046  rnValue..    # F
-000237a0: 696e 6420 4e52 7820 7261 6e67 6520 666f  ind NRx range fo
-000237b0: 7220 5265 7665 7273 616c 0a20 2020 2064  r Reversal.    d
-000237c0: 6566 2076 616c 6964 6174 654e 6172 726f  ef validateNarro
-000237d0: 7752 616e 6765 2873 656c 662c 2064 662c  wRange(self, df,
-000237e0: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-000237f0: 6544 6963 742c 206e 723d 3429 3a0a 2020  eDict, nr=4):.  
-00023800: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
-00023810: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
-00023820: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00023830: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00023840: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-00023850: 636f 7079 2829 0a20 2020 2020 2020 2073  copy().        s
-00023860: 6176 6564 203d 2073 656c 662e 6669 6e64  aved = self.find
-00023870: 4375 7272 656e 7453 6176 6564 5661 6c75  CurrentSavedValu
-00023880: 6528 7363 7265 656e 4469 6374 2c20 7361  e(screenDict, sa
-00023890: 7665 4469 6374 2c20 2250 6174 7465 726e  veDict, "Pattern
-000238a0: 2229 0a20 2020 2020 2020 2069 6620 504b  ").        if PK
-000238b0: 4461 7465 5574 696c 6974 6965 732e 6973  DateUtilities.is
-000238c0: 5472 6164 696e 6754 696d 6528 293a 0a20  TradingTime():. 
-000238d0: 2020 2020 2020 2020 2020 2072 616e 6765             range
-000238e0: 4461 7461 203d 2064 6174 612e 6865 6164  Data = data.head
-000238f0: 286e 7220 2b20 3129 5b31 3a5d 0a20 2020  (nr + 1)[1:].   
-00023900: 2020 2020 2020 2020 206e 6f77 5f63 616e           now_can
-00023910: 646c 6520 3d20 6461 7461 2e68 6561 6428  dle = data.head(
-00023920: 3129 0a20 2020 2020 2020 2020 2020 2072  1).            r
-00023930: 616e 6765 4461 7461 5b22 5261 6e67 6522  angeData["Range"
-00023940: 5d20 3d20 6162 7328 7261 6e67 6544 6174  ] = abs(rangeDat
-00023950: 615b 2243 6c6f 7365 225d 202d 2072 616e  a["Close"] - ran
-00023960: 6765 4461 7461 5b22 4f70 656e 225d 290a  geData["Open"]).
-00023970: 2020 2020 2020 2020 2020 2020 7265 6365              rece
-00023980: 6e74 203d 2072 616e 6765 4461 7461 2e68  nt = rangeData.h
-00023990: 6561 6428 3129 0a20 2020 2020 2020 2020  ead(1).         
-000239a0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-000239b0: 2020 2020 2020 2020 6c65 6e28 7265 6365          len(rece
-000239c0: 6e74 2920 3d3d 2031 0a20 2020 2020 2020  nt) == 1.       
-000239d0: 2020 2020 2020 2020 2061 6e64 2072 6563           and rec
-000239e0: 656e 745b 2252 616e 6765 225d 2e69 6c6f  ent["Range"].ilo
-000239f0: 635b 305d 203d 3d20 7261 6e67 6544 6174  c[0] == rangeDat
-00023a00: 612e 6465 7363 7269 6265 2829 5b22 5261  a.describe()["Ra
-00023a10: 6e67 6522 5d5b 226d 696e 225d 0a20 2020  nge"]["min"].   
-00023a20: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-00023a30: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00023a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023a50: 2020 2020 2073 656c 662e 6765 7443 616e       self.getCan
-00023a60: 646c 6554 7970 6528 7265 6365 6e74 290a  dleType(recent).
-00023a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a80: 2020 2020 616e 6420 6e6f 775f 6361 6e64      and now_cand
-00023a90: 6c65 5b22 436c 6f73 6522 5d2e 696c 6f63  le["Close"].iloc
-00023aa0: 5b30 5d20 3e3d 2072 6563 656e 745b 2243  [0] >= recent["C
-00023ab0: 6c6f 7365 225d 2e69 6c6f 635b 305d 0a20  lose"].iloc[0]. 
-00023ac0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00023ad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023ae0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00023af0: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
-00023b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b10: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
-00023b20: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
-00023b30: 4420 2b20 636f 6c6f 7254 6578 742e 4752  D + colorText.GR
-00023b40: 4545 4e20 2b20 6622 4275 792d 4e52 7b6e  EEN + f"Buy-NR{n
-00023b50: 727d 2220 2b20 636f 6c6f 7254 6578 742e  r}" + colorText.
-00023b60: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00023b70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00023b80: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00023b90: 7665 4469 6374 5b22 5061 7474 6572 6e22  veDict["Pattern"
-00023ba0: 5d20 3d20 7361 7665 645b 315d 202b 2066  ] = saved[1] + f
-00023bb0: 2242 7579 2d4e 527b 6e72 7d22 0a20 2020  "Buy-NR{nr}".   
-00023bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023bd0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-00023be0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00023bf0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00023c00: 2020 2020 2020 2020 6e6f 7420 7365 6c66          not self
-00023c10: 2e67 6574 4361 6e64 6c65 5479 7065 2872  .getCandleType(r
-00023c20: 6563 656e 7429 0a20 2020 2020 2020 2020  ecent).         
-00023c30: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
-00023c40: 6f77 5f63 616e 646c 655b 2243 6c6f 7365  ow_candle["Close
-00023c50: 225d 2e69 6c6f 635b 305d 203c 3d20 7265  "].iloc[0] <= re
-00023c60: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
-00023c70: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
-00023c80: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00023c90: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-00023ca0: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
-00023cb0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00023cc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00023cd0: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00023ce0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00023cf0: 5465 7874 2e46 4149 4c20 2b20 6622 5365  Text.FAIL + f"Se
-00023d00: 6c6c 2d4e 527b 6e72 7d22 202b 2063 6f6c  ll-NR{nr}" + col
-00023d10: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00023d20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00023d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023d40: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
-00023d50: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-00023d60: 5b31 5d20 2b20 6622 5365 6c6c 2d4e 527b  [1] + f"Sell-NR{
-00023d70: 6e72 7d22 0a20 2020 2020 2020 2020 2020  nr}".           
-00023d80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00023d90: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00023da0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00023db0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00023dc0: 2020 2020 2020 2020 7261 6e67 6544 6174          rangeDat
-00023dd0: 6120 3d20 6461 7461 2e68 6561 6428 6e72  a = data.head(nr
-00023de0: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
-00023df0: 6e67 6544 6174 612e 6c6f 635b 3a2c 2752  ngeData.loc[:,'R
-00023e00: 616e 6765 275d 203d 2061 6273 2872 616e  ange'] = abs(ran
-00023e10: 6765 4461 7461 5b22 436c 6f73 6522 5d20  geData["Close"] 
-00023e20: 2d20 7261 6e67 6544 6174 615b 224f 7065  - rangeData["Ope
-00023e30: 6e22 5d29 0a20 2020 2020 2020 2020 2020  n"]).           
-00023e40: 2072 6563 656e 7420 3d20 7261 6e67 6544   recent = rangeD
-00023e50: 6174 612e 6865 6164 2831 290a 2020 2020  ata.head(1).    
-00023e60: 2020 2020 2020 2020 6966 2072 6563 656e          if recen
-00023e70: 745b 2252 616e 6765 225d 2e69 6c6f 635b  t["Range"].iloc[
-00023e80: 305d 203d 3d20 7261 6e67 6544 6174 612e  0] == rangeData.
-00023e90: 6465 7363 7269 6265 2829 5b22 5261 6e67  describe()["Rang
-00023ea0: 6522 5d5b 226d 696e 225d 3a0a 2020 2020  e"]["min"]:.    
-00023eb0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-00023ec0: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
-00023ed0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-00023ee0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-00023ef0: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
-00023f00: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
-00023f10: 4752 4545 4e20 2b20 6622 4e52 7b6e 727d  GREEN + f"NR{nr}
-00023f20: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-00023f30: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00023f40: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00023f50: 2020 2020 7361 7665 4469 6374 5b22 5061      saveDict["Pa
-00023f60: 7474 6572 6e22 5d20 3d20 7361 7665 645b  ttern"] = saved[
-00023f70: 315d 202b 2066 224e 527b 6e72 7d22 0a20  1] + f"NR{nr}". 
-00023f80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00023f90: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00023fa0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00023fb0: 6c73 650a 0a20 2020 2023 2046 696e 6420  lse..    # Find 
-00023fc0: 6966 2073 746f 636b 2069 7320 6e65 776c  if stock is newl
-00023fd0: 7920 6c69 7374 6564 0a20 2020 2064 6566  y listed.    def
-00023fe0: 2076 616c 6964 6174 654e 6577 6c79 4c69   validateNewlyLi
-00023ff0: 7374 6564 2873 656c 662c 2064 662c 2064  sted(self, df, d
-00024000: 6179 7354 6f4c 6f6f 6b62 6163 6b29 3a0a  aysToLookback):.
-00024010: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-00024020: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-00024030: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00024040: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00024050: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00024060: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-00024070: 2064 6179 7354 6f4c 6f6f 6b62 6163 6b20   daysToLookback 
-00024080: 3d20 696e 7428 6461 7973 546f 4c6f 6f6b  = int(daysToLook
-00024090: 6261 636b 5b3a 2d31 5d29 0a20 2020 2020  back[:-1]).     
-000240a0: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
-000240b0: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
-000240c0: 2069 6620 6c65 6e28 7265 6365 6e74 2920   if len(recent) 
-000240d0: 3c20 313a 0a20 2020 2020 2020 2020 2020  < 1:.           
-000240e0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-000240f0: 2020 2020 2020 6966 206c 656e 2864 6174        if len(dat
-00024100: 6129 203c 2064 6179 7354 6f4c 6f6f 6b62  a) < daysToLookb
-00024110: 6163 6b20 616e 6420 280a 2020 2020 2020  ack and (.      
-00024120: 2020 2020 2020 7265 6365 6e74 5b22 436c        recent["Cl
-00024130: 6f73 6522 5d2e 696c 6f63 5b30 5d20 213d  ose"].iloc[0] !=
-00024140: 206e 702e 6e61 6e20 616e 6420 7265 6365   np.nan and rece
-00024150: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-00024160: 5b30 5d20 3e20 300a 2020 2020 2020 2020  [0] > 0.        
-00024170: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00024180: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00024190: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-000241a0: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
-000241b0: 6966 2074 6865 2073 746f 636b 2070 7269  if the stock pri
-000241c0: 6365 7320 6172 6520 6174 206c 6561 7374  ces are at least
-000241d0: 2072 6973 696e 6720 6279 2032 2520 666f   rising by 2% fo
-000241e0: 7220 7468 6520 6c61 7374 2033 2073 6573  r the last 3 ses
-000241f0: 7369 6f6e 730a 2020 2020 6465 6620 7661  sions.    def va
-00024200: 6c69 6461 7465 5072 6963 6552 6973 696e  lidatePriceRisin
-00024210: 6742 7941 744c 6561 7374 3250 6572 6365  gByAtLeast2Perce
-00024220: 6e74 2873 656c 662c 2064 662c 2073 6372  nt(self, df, scr
-00024230: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-00024240: 7429 3a0a 2020 2020 2020 2020 6966 2064  t):.        if d
-00024250: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00024260: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-00024270: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00024280: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-00024290: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-000242a0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-000242b0: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-000242c0: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-000242d0: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-000242e0: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-000242f0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00024300: 2e68 6561 6428 3429 0a20 2020 2020 2020  .head(4).       
-00024310: 2069 6620 6c65 6e28 6461 7461 2920 3c20   if len(data) < 
-00024320: 343a 0a20 2020 2020 2020 2020 2020 2072  4:.            r
-00024330: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00024340: 2020 2020 6461 7930 203d 2064 6174 612e      day0 = data.
-00024350: 696c 6f63 5b30 5d5b 2243 6c6f 7365 225d  iloc[0]["Close"]
-00024360: 2e69 7465 6d28 290a 2020 2020 2020 2020  .item().        
-00024370: 6461 794d 696e 7573 3120 3d20 6461 7461  dayMinus1 = data
-00024380: 2e69 6c6f 635b 315d 5b22 436c 6f73 6522  .iloc[1]["Close"
-00024390: 5d2e 6974 656d 2829 0a20 2020 2020 2020  ].item().       
-000243a0: 2064 6179 4d69 6e75 7332 203d 2064 6174   dayMinus2 = dat
-000243b0: 612e 696c 6f63 5b32 5d5b 2243 6c6f 7365  a.iloc[2]["Close
-000243c0: 225d 2e69 7465 6d28 290a 2020 2020 2020  "].item().      
-000243d0: 2020 6461 794d 696e 7573 3320 3d20 6461    dayMinus3 = da
-000243e0: 7461 2e69 6c6f 635b 335d 5b22 436c 6f73  ta.iloc[3]["Clos
-000243f0: 6522 5d2e 6974 656d 2829 0a20 2020 2020  e"].item().     
-00024400: 2020 2070 6572 6365 6e74 3320 3d20 726f     percent3 = ro
-00024410: 756e 6428 2864 6179 4d69 6e75 7332 202d  und((dayMinus2 -
-00024420: 2064 6179 4d69 6e75 7333 2920 2a20 3130   dayMinus3) * 10
-00024430: 3020 2f20 6461 794d 696e 7573 332c 2032  0 / dayMinus3, 2
-00024440: 290a 2020 2020 2020 2020 7065 7263 656e  ).        percen
-00024450: 7432 203d 2072 6f75 6e64 2828 6461 794d  t2 = round((dayM
-00024460: 696e 7573 3120 2d20 6461 794d 696e 7573  inus1 - dayMinus
-00024470: 3229 202a 2031 3030 202f 2064 6179 4d69  2) * 100 / dayMi
-00024480: 6e75 7332 2c20 3229 0a20 2020 2020 2020  nus2, 2).       
-00024490: 2070 6572 6365 6e74 3120 3d20 726f 756e   percent1 = roun
-000244a0: 6428 2864 6179 3020 2d20 6461 794d 696e  d((day0 - dayMin
-000244b0: 7573 3129 202a 2031 3030 202f 2064 6179  us1) * 100 / day
-000244c0: 4d69 6e75 7331 2c20 3229 0a0a 2020 2020  Minus1, 2)..    
-000244d0: 2020 2020 6966 2070 6572 6365 6e74 3120      if percent1 
-000244e0: 3e3d 2032 2061 6e64 2070 6572 6365 6e74  >= 2 and percent
-000244f0: 3220 3e3d 2032 2061 6e64 2070 6572 6365  2 >= 2 and perce
-00024500: 6e74 3320 3e3d 2032 3a0a 2020 2020 2020  nt3 >= 2:.      
-00024510: 2020 2020 2020 7063 745f 6368 616e 6765        pct_change
-00024520: 5f74 6578 7420 3d20 280a 2020 2020 2020  _text = (.      
-00024530: 2020 2020 2020 2020 2020 2822 252e 3166            ("%.1f
-00024540: 2525 2220 2520 7065 7263 656e 7431 290a  %%" % percent1).
-00024550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024560: 2b20 2822 2028 252e 3166 2525 2c22 2025  + (" (%.1f%%," %
-00024570: 2070 6572 6365 6e74 3229 0a20 2020 2020   percent2).     
-00024580: 2020 2020 2020 2020 2020 202b 2028 2220             + (" 
-00024590: 252e 3166 2525 2922 2025 2070 6572 6365  %.1f%%)" % perce
-000245a0: 6e74 3329 0a20 2020 2020 2020 2020 2020  nt3).           
-000245b0: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-000245c0: 6176 6544 6963 745b 2225 4368 6e67 225d  aveDict["%Chng"]
-000245d0: 203d 2070 6374 5f63 6861 6e67 655f 7465   = pct_change_te
-000245e0: 7874 0a20 2020 2020 2020 2020 2020 2073  xt.            s
-000245f0: 6372 6565 6e44 6963 745b 2225 4368 6e67  creenDict["%Chng
-00024600: 225d 203d 2063 6f6c 6f72 5465 7874 2e47  "] = colorText.G
-00024610: 5245 454e 202b 2070 6374 5f63 6861 6e67  REEN + pct_chang
-00024620: 655f 7465 7874 202b 2063 6f6c 6f72 5465  e_text + colorTe
-00024630: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00024640: 2020 2072 6574 7572 6e20 5472 7565 2061     return True a
-00024650: 6e64 2073 656c 662e 6765 7443 616e 646c  nd self.getCandl
-00024660: 6554 7970 6528 6461 7461 2e68 6561 6428  eType(data.head(
-00024670: 3129 290a 2020 2020 2020 2020 7265 7475  1)).        retu
-00024680: 726e 2046 616c 7365 0a0a 2020 2020 2340  rn False..    #@
-00024690: 6d65 6173 7572 655f 7469 6d65 0a20 2020  measure_time.   
-000246a0: 2023 2076 616c 6964 6174 6520 6966 2052   # validate if R
-000246b0: 5349 2069 7320 7769 7468 696e 2067 6976  SI is within giv
-000246c0: 656e 2072 616e 6765 0a20 2020 2064 6566  en range.    def
-000246d0: 2076 616c 6964 6174 6552 5349 2873 656c   validateRSI(sel
-000246e0: 662c 2064 662c 2073 6372 6565 6e44 6963  f, df, screenDic
-000246f0: 742c 2073 6176 6544 6963 742c 206d 696e  t, saveDict, min
-00024700: 5253 492c 206d 6178 5253 492c 7273 694b  RSI, maxRSI,rsiK
-00024710: 6579 3d22 5253 4922 293a 0a20 2020 2020  ey="RSI"):.     
-00024720: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
-00024730: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
-00024740: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00024750: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-00024760: 2020 2069 6620 7273 694b 6579 206e 6f74     if rsiKey not
-00024770: 2069 6e20 6466 2e63 6f6c 756d 6e73 3a0a   in df.columns:.
-00024780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00024790: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-000247a0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-000247b0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-000247c0: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
-000247d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000247e0: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-000247f0: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-00024800: 290a 2020 2020 2020 2020 7273 6920 3d20  ).        rsi = 
-00024810: 696e 7428 6461 7461 2e68 6561 6428 3129  int(data.head(1)
-00024820: 5b72 7369 4b65 795d 2e69 6c6f 635b 305d  [rsiKey].iloc[0]
-00024830: 290a 2020 2020 2020 2020 7361 7665 4469  ).        saveDi
-00024840: 6374 5b72 7369 4b65 795d 203d 2072 7369  ct[rsiKey] = rsi
-00024850: 0a20 2020 2020 2020 2023 2068 7474 7073  .        # https
-00024860: 3a2f 2f63 6861 7274 696e 6b2e 636f 6d2f  ://chartink.com/
-00024870: 7363 7265 656e 6572 2f72 7369 2d73 6372  screener/rsi-scr
-00024880: 6565 6e69 6e67 0a20 2020 2020 2020 2069  eening.        i
-00024890: 6620 7273 693e 2030 2061 6e64 2072 7369  f rsi> 0 and rsi
-000248a0: 203e 3d20 6d69 6e52 5349 2061 6e64 2072   >= minRSI and r
-000248b0: 7369 203c 3d20 6d61 7852 5349 3a20 2023  si <= maxRSI:  #
-000248c0: 206f 7220 2872 7369 203c 3d20 3731 2061   or (rsi <= 71 a
-000248d0: 6e64 2072 7369 203e 3d20 3637 293a 0a20  nd rsi >= 67):. 
-000248e0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-000248f0: 6e44 6963 745b 7273 694b 6579 5d20 3d20  nDict[rsiKey] = 
-00024900: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00024910: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
-00024920: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
-00024930: 454e 202b 2073 7472 2872 7369 2920 2b20  EN + str(rsi) + 
-00024940: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-00024950: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00024960: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00024970: 7275 6520 6966 2028 7273 694b 6579 203d  rue if (rsiKey =
-00024980: 3d20 2252 5349 6922 2920 656c 7365 2028  = "RSIi") else (
-00024990: 7365 6c66 2e76 616c 6964 6174 6552 5349  self.validateRSI
-000249a0: 2864 662c 2073 6372 6565 6e44 6963 742c  (df, screenDict,
-000249b0: 2073 6176 6544 6963 742c 206d 696e 5253   saveDict, minRS
-000249c0: 492c 206d 6178 5253 492c 7273 694b 6579  I, maxRSI,rsiKey
-000249d0: 3d22 5253 4969 2229 206f 7220 5472 7565  ="RSIi") or True
-000249e0: 290a 2020 2020 2020 2020 7363 7265 656e  ).        screen
-000249f0: 4469 6374 5b72 7369 4b65 795d 203d 2063  Dict[rsiKey] = c
-00024a00: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
-00024a10: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
-00024a20: 2073 7472 2872 7369 2920 2b20 636f 6c6f   str(rsi) + colo
-00024a30: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00024a40: 2020 2320 4966 2065 6974 6865 7220 6461    # If either da
-00024a50: 696c 7920 6f72 2069 6e74 7261 6461 7920  ily or intraday 
-00024a60: 5253 4920 636f 6d65 7320 7769 7468 696e  RSI comes within
-00024a70: 2072 616e 6765 3f0a 2020 2020 2020 2020   range?.        
-00024a80: 7265 7475 726e 2046 616c 7365 2069 6620  return False if 
-00024a90: 2872 7369 4b65 7920 3d3d 2022 5253 4969  (rsiKey == "RSIi
-00024aa0: 2229 2065 6c73 6520 2873 656c 662e 7661  ") else (self.va
-00024ab0: 6c69 6461 7465 5253 4928 6466 2c20 7363  lidateRSI(df, sc
-00024ac0: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-00024ad0: 6374 2c20 6d69 6e52 5349 2c20 6d61 7852  ct, minRSI, maxR
-00024ae0: 5349 2c72 7369 4b65 793d 2252 5349 6922  SI,rsiKey="RSIi"
-00024af0: 2929 0a0a 2020 2020 2320 5661 6c69 6461  ))..    # Valida
-00024b00: 7465 2069 6620 7468 6520 7374 6f63 6b20  te if the stock 
-00024b10: 6973 2062 756c 6c69 7368 2069 6e20 7468  is bullish in th
-00024b20: 6520 7368 6f72 7420 7465 726d 0a20 2020  e short term.   
-00024b30: 2064 6566 2076 616c 6964 6174 6553 686f   def validateSho
-00024b40: 7274 5465 726d 4275 6c6c 6973 6828 7365  rtTermBullish(se
-00024b50: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-00024b60: 6374 2c20 7361 7665 4469 6374 293a 0a20  ct, saveDict):. 
-00024b70: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-00024b80: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-00024b90: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00024ba0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00024bb0: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
-00024bc0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-00024bd0: 2320 6874 7470 733a 2f2f 6368 6172 7469  # https://charti
-00024be0: 6e6b 2e63 6f6d 2f73 6372 6565 6e65 722f  nk.com/screener/
-00024bf0: 7368 6f72 742d 7465 726d 2d62 756c 6c69  short-term-bulli
-00024c00: 7368 0a20 2020 2020 2020 2064 6174 6120  sh.        data 
-00024c10: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-00024c20: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00024c30: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00024c40: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-00024c50: 3029 0a20 2020 2020 2020 2072 6563 656e  0).        recen
-00024c60: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
-00024c70: 0a20 2020 2020 2020 2066 6b20 3d20 3020  .        fk = 0 
-00024c80: 6966 206c 656e 2864 6174 6129 203c 2033  if len(data) < 3
-00024c90: 2065 6c73 6520 6e70 2e72 6f75 6e64 2864   else np.round(d
-00024ca0: 6174 615b 2246 4153 544b 225d 2e69 6c6f  ata["FASTK"].ilo
-00024cb0: 635b 325d 2c20 3529 0a20 2020 2020 2020  c[2], 5).       
-00024cc0: 2023 2052 6576 6572 7365 2074 6865 2064   # Reverse the d
-00024cd0: 6174 6166 7261 6d65 2066 6f72 2069 6368  ataframe for ich
-00024ce0: 696d 6f6b 7520 6361 6c63 756c 6174 696f  imoku calculatio
-00024cf0: 6e73 2077 6974 6820 6461 7465 2069 6e20  ns with date in 
-00024d00: 6173 6365 6e64 696e 6720 6f72 6465 720a  ascending order.
-00024d10: 2020 2020 2020 2020 6466 5f6e 6577 203d          df_new =
-00024d20: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
-00024d30: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00024d40: 2020 2020 2064 665f 6963 6869 203d 2064       df_ichi = d
-00024d50: 665f 6e65 772e 7265 6e61 6d65 280a 2020  f_new.rename(.  
-00024d60: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00024d70: 6c75 6d6e 733d 7b0a 2020 2020 2020 2020  lumns={.        
-00024d80: 2020 2020 2020 2020 2020 2020 224f 7065              "Ope
-00024d90: 6e22 3a20 226f 7065 6e22 2c0a 2020 2020  n": "open",.    
-00024da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024db0: 2248 6967 6822 3a20 2268 6967 6822 2c0a  "High": "high",.
-00024dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024dd0: 2020 2020 224c 6f77 223a 2022 6c6f 7722      "Low": "low"
-00024de0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00024df0: 2020 2020 2020 2243 6c6f 7365 223a 2022        "Close": "
-00024e00: 636c 6f73 6522 2c0a 2020 2020 2020 2020  close",.        
-00024e10: 2020 2020 2020 2020 2020 2020 2256 6f6c              "Vol
-00024e20: 756d 6522 3a20 2276 6f6c 756d 6522 2c0a  ume": "volume",.
-00024e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e40: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
-00024e50: 2020 2020 2020 2020 2020 2020 6963 6869              ichi
-00024e60: 203d 2070 6b74 616c 6962 2e69 6368 696d   = pktalib.ichim
-00024e70: 6f6b 7528 6466 5f69 6368 692c 2039 2c20  oku(df_ichi, 9, 
-00024e80: 3236 2c20 3532 2c20 3236 290a 2020 2020  26, 52, 26).    
-00024e90: 2020 2020 2020 2020 6966 2069 6368 6920          if ichi 
-00024ea0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00024eb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00024ec0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00024ed0: 2020 6466 5f6e 6577 203d 2070 642e 636f    df_new = pd.co
-00024ee0: 6e63 6174 285b 6466 5f6e 6577 2c20 6963  ncat([df_new, ic
-00024ef0: 6869 5d2c 2061 7869 733d 3129 0a20 2020  hi], axis=1).   
-00024f00: 2020 2020 2020 2020 2023 2052 6576 6572           # Rever
-00024f10: 7365 2061 6761 696e 2074 6f20 6765 7420  se again to get 
-00024f20: 7468 6520 6d6f 7374 2072 6563 656e 7420  the most recent 
-00024f30: 6461 7465 206f 6e20 746f 700a 2020 2020  date on top.    
-00024f40: 2020 2020 2020 2020 6466 5f6e 6577 203d          df_new =
-00024f50: 2064 665f 6e65 775b 3a3a 2d31 5d0a 2020   df_new[::-1].  
-00024f60: 2020 2020 2020 2020 2020 6466 5f6e 6577            df_new
-00024f70: 203d 2064 665f 6e65 772e 6865 6164 2831   = df_new.head(1
-00024f80: 290a 2020 2020 2020 2020 2020 2020 6466  ).            df
-00024f90: 5f6e 6577 5b22 636c 6f75 645f 6772 6565  _new["cloud_gree
-00024fa0: 6e22 5d20 3d20 6466 5f6e 6577 5b22 4953  n"] = df_new["IS
-00024fb0: 415f 3922 5d2e 696c 6f63 5b30 5d20 3e20  A_9"].iloc[0] > 
-00024fc0: 6466 5f6e 6577 5b22 4953 425f 3236 225d  df_new["ISB_26"]
-00024fd0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-00024fe0: 2020 2020 2064 665f 6e65 775b 2263 6c6f       df_new["clo
-00024ff0: 7564 5f72 6564 225d 203d 2064 665f 6e65  ud_red"] = df_ne
-00025000: 775b 2249 5342 5f32 3622 5d2e 696c 6f63  w["ISB_26"].iloc
-00025010: 5b30 5d20 3e20 6466 5f6e 6577 5b22 4953  [0] > df_new["IS
-00025020: 415f 3922 5d2e 696c 6f63 5b30 5d0a 2020  A_9"].iloc[0].  
-00025030: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00025040: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
-00025050: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
-00025060: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00025070: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00025080: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-00025090: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-000250a0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-000250b0: 2020 6162 6f76 6543 6c6f 7564 546f 7020    aboveCloudTop 
-000250c0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-000250d0: 2320 6261 7365 6c69 6e65 203e 2063 6c6f  # baseline > clo
-000250e0: 7564 2074 6f70 2028 636c 6f75 6420 6973  ud top (cloud is
-000250f0: 2062 6f75 6e64 2062 7920 7370 616e 2061   bound by span a
-00025100: 2061 6e64 2073 7061 6e20 6229 2061 6e64   and span b) and
-00025110: 2063 6c6f 7365 2069 7320 3e20 636c 6f75   close is > clou
-00025120: 6420 746f 700a 2020 2020 2020 2020 6966  d top.        if
-00025130: 2064 665f 6e65 775b 2263 6c6f 7564 5f67   df_new["cloud_g
-00025140: 7265 656e 225d 2e69 6c6f 635b 305d 3a0a  reen"].iloc[0]:.
-00025150: 2020 2020 2020 2020 2020 2020 6162 6f76              abov
-00025160: 6543 6c6f 7564 546f 7020 3d20 280a 2020  eCloudTop = (.  
-00025170: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00025180: 5f6e 6577 5b22 494b 535f 3236 225d 2e69  _new["IKS_26"].i
-00025190: 6c6f 635b 305d 203e 2064 665f 6e65 775b  loc[0] > df_new[
-000251a0: 2249 5341 5f39 225d 2e69 6c6f 635b 305d  "ISA_9"].iloc[0]
-000251b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000251c0: 2061 6e64 2072 6563 656e 745b 2243 6c6f   and recent["Clo
-000251d0: 7365 225d 2e69 6c6f 635b 305d 203e 2064  se"].iloc[0] > d
-000251e0: 665f 6e65 775b 2249 5341 5f39 225d 2e69  f_new["ISA_9"].i
-000251f0: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
-00025200: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00025210: 6620 6466 5f6e 6577 5b22 636c 6f75 645f  f df_new["cloud_
-00025220: 7265 6422 5d2e 696c 6f63 5b30 5d3a 0a20  red"].iloc[0]:. 
-00025230: 2020 2020 2020 2020 2020 2061 626f 7665             above
-00025240: 436c 6f75 6454 6f70 203d 2028 0a20 2020  CloudTop = (.   
-00025250: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00025260: 6e65 775b 2249 4b53 5f32 3622 5d2e 696c  new["IKS_26"].il
-00025270: 6f63 5b30 5d20 3e20 6466 5f6e 6577 5b22  oc[0] > df_new["
-00025280: 4953 425f 3236 225d 2e69 6c6f 635b 305d  ISB_26"].iloc[0]
-00025290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000252a0: 2061 6e64 2072 6563 656e 745b 2243 6c6f   and recent["Clo
-000252b0: 7365 225d 2e69 6c6f 635b 305d 203e 2064  se"].iloc[0] > d
-000252c0: 665f 6e65 775b 2249 5342 5f32 3622 5d2e  f_new["ISB_26"].
-000252d0: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-000252e0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-000252f0: 204c 6174 6573 7420 4963 6869 6d6f 6b75   Latest Ichimoku
-00025300: 2062 6173 656c 696e 6520 6973 203c 206c   baseline is < l
-00025310: 6174 6573 7420 4963 6869 6d6f 6b75 2063  atest Ichimoku c
-00025320: 6f6e 7665 7273 696f 6e20 6c69 6e65 0a20  onversion line. 
-00025330: 2020 2020 2020 2069 6620 6162 6f76 6543         if aboveC
-00025340: 6c6f 7564 546f 7020 616e 6420 6466 5f6e  loudTop and df_n
-00025350: 6577 5b22 494b 535f 3236 225d 2e69 6c6f  ew["IKS_26"].ilo
-00025360: 635b 305d 203c 2064 665f 6e65 775b 2249  c[0] < df_new["I
-00025370: 5453 5f39 225d 2e69 6c6f 635b 305d 3a0a  TS_9"].iloc[0]:.
-00025380: 2020 2020 2020 2020 2020 2020 2320 5374              # St
-00025390: 6f63 6852 5349 2063 726f 7373 6564 2032  ochRSI crossed 2
-000253a0: 3020 616e 6420 5253 4920 3e20 3530 0a20  0 and RSI > 50. 
-000253b0: 2020 2020 2020 2020 2020 2069 6620 666b             if fk
-000253c0: 203e 2032 3020 616e 6420 7265 6365 6e74   > 20 and recent
-000253d0: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d20  ["RSI"].iloc[0] 
-000253e0: 3e20 3530 3a0a 2020 2020 2020 2020 2020  > 50:.          
-000253f0: 2020 2020 2020 2320 636f 6e64 6974 696f        # conditio
-00025400: 6e20 6f66 2063 726f 7373 696e 6720 7468  n of crossing th
-00025410: 6520 5374 6f63 6852 5349 206d 6169 6e20  e StochRSI main 
-00025420: 7369 676e 616c 206c 696e 6520 6672 6f6d  signal line from
-00025430: 2062 6f74 746f 6d20 746f 2074 6f70 0a20   bottom to top. 
-00025440: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00025450: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00025460: 2020 2020 2020 2020 6461 7461 5b22 4641          data["FA
-00025470: 5354 4422 5d2e 696c 6f63 5b31 3030 5d20  STD"].iloc[100] 
-00025480: 3c20 6461 7461 5b22 4641 5354 4b22 5d2e  < data["FASTK"].
-00025490: 696c 6f63 5b31 3030 5d0a 2020 2020 2020  iloc[100].      
-000254a0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-000254b0: 6420 6461 7461 5b22 4641 5354 4422 5d2e  d data["FASTD"].
-000254c0: 696c 6f63 5b31 3031 5d20 3e20 6461 7461  iloc[101] > data
-000254d0: 5b22 4641 5354 4b22 5d2e 696c 6f63 5b31  ["FASTK"].iloc[1
-000254e0: 3031 5d0a 2020 2020 2020 2020 2020 2020  01].            
-000254f0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00025500: 2020 2020 2020 2020 2020 2023 2063 6c6f             # clo
-00025510: 7365 203e 2035 3020 7065 7269 6f64 2053  se > 50 period S
-00025520: 4d41 2f45 4d41 2061 6e64 2032 3030 2070  MA/EMA and 200 p
-00025530: 6572 696f 6420 534d 412f 454d 410a 2020  eriod SMA/EMA.  
-00025540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025550: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00025560: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00025570: 6563 656e 745b 2253 534d 4122 5d2e 696c  ecent["SSMA"].il
-00025580: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
-00025590: 534d 4122 5d2e 696c 6f63 5b30 5d0a 2020  SMA"].iloc[0].  
-000255a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255b0: 2020 2020 2020 616e 6420 7265 6365 6e74        and recent
-000255c0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
-000255d0: 5d20 3e20 7265 6365 6e74 5b22 5353 4d41  ] > recent["SSMA
-000255e0: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
-000255f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025600: 2020 2061 6e64 2072 6563 656e 745b 2243     and recent["C
-00025610: 6c6f 7365 225d 2e69 6c6f 635b 305d 203e  lose"].iloc[0] >
-00025620: 2072 6563 656e 745b 224c 4d41 225d 2e69   recent["LMA"].i
-00025630: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
-00025640: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00025650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025660: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00025670: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00025680: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00025690: 6963 742c 7361 7665 4469 6374 2c22 4d41  ict,saveDict,"MA
-000256a0: 2d53 6967 6e61 6c22 290a 2020 2020 2020  -Signal").      
-000256b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000256c0: 2020 7363 7265 656e 4469 6374 5b22 4d41    screenDict["MA
-000256d0: 2d53 6967 6e61 6c22 5d20 3d20 280a 2020  -Signal"] = (.  
-000256e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000256f0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-00025700: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
-00025710: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
-00025720: 4752 4545 4e20 2b20 2242 756c 6c69 7368  GREEN + "Bullish
-00025730: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
-00025740: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00025750: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00023640: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00023650: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
+00023660: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
+00023670: 742e 4641 494c 202b 2066 2242 6561 7243  t.FAIL + f"BearC
+00023680: 726f 7373 2d7b 6d61 5465 7874 735b 696e  ross-{maTexts[in
+00023690: 6465 785d 7d22 202b 2063 6f6c 6f72 5465  dex]}" + colorTe
+000236a0: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+000236b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000236c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000236d0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+000236e0: 745b 224d 412d 5369 676e 616c 225d 203d  t["MA-Signal"] =
+000236f0: 2073 6176 6564 5b31 5d20 2b20 6622 4265   saved[1] + f"Be
+00023700: 6172 4372 6f73 732d 7b6d 6154 6578 7473  arCross-{maTexts
+00023710: 5b69 6e64 6578 5d7d 220a 2020 2020 2020  [index]}".      
+00023720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023730: 2020 6d61 5265 7665 7273 616c 203d 202d    maReversal = -
+00023740: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00023750: 2020 2020 2020 2020 2020 6d61 5369 676e            maSign
+00023760: 616c 732e 6170 7065 6e64 2822 3422 290a  als.append("4").
+00023770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023780: 696e 6465 7820 2b3d 2031 0a20 2020 2020  index += 1.     
+00023790: 2020 2072 6574 7572 6e56 616c 7565 203d     returnValue =
+000237a0: 206d 6152 6576 6572 7361 6c0a 2020 2020   maReversal.    
+000237b0: 2020 2020 6966 206d 614c 656e 6774 6820      if maLength 
+000237c0: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
+000237d0: 2020 7265 7475 726e 5661 6c75 6520 3d20    returnValue = 
+000237e0: 7374 7228 6d61 4c65 6e67 7468 2920 696e  str(maLength) in
+000237f0: 206d 6153 6967 6e61 6c73 0a20 2020 2020   maSignals.     
+00023800: 2020 2072 6574 7572 6e20 7265 7475 726e     return return
+00023810: 5661 6c75 650a 0a20 2020 2023 2046 696e  Value..    # Fin
+00023820: 6420 4e52 7820 7261 6e67 6520 666f 7220  d NRx range for 
+00023830: 5265 7665 7273 616c 0a20 2020 2064 6566  Reversal.    def
+00023840: 2076 616c 6964 6174 654e 6172 726f 7752   validateNarrowR
+00023850: 616e 6765 2873 656c 662c 2064 662c 2073  ange(self, df, s
+00023860: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+00023870: 6963 742c 206e 723d 3429 3a0a 2020 2020  ict, nr=4):.    
+00023880: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+00023890: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+000238a0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+000238b0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+000238c0: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+000238d0: 7079 2829 0a20 2020 2020 2020 2073 6176  py().        sav
+000238e0: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+000238f0: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+00023900: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+00023910: 4469 6374 2c20 2250 6174 7465 726e 2229  Dict, "Pattern")
+00023920: 0a20 2020 2020 2020 2069 6620 504b 4461  .        if PKDa
+00023930: 7465 5574 696c 6974 6965 732e 6973 5472  teUtilities.isTr
+00023940: 6164 696e 6754 696d 6528 293a 0a20 2020  adingTime():.   
+00023950: 2020 2020 2020 2020 2072 616e 6765 4461           rangeDa
+00023960: 7461 203d 2064 6174 612e 6865 6164 286e  ta = data.head(n
+00023970: 7220 2b20 3129 5b31 3a5d 0a20 2020 2020  r + 1)[1:].     
+00023980: 2020 2020 2020 206e 6f77 5f63 616e 646c         now_candl
+00023990: 6520 3d20 6461 7461 2e68 6561 6428 3129  e = data.head(1)
+000239a0: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
+000239b0: 6765 4461 7461 5b22 5261 6e67 6522 5d20  geData["Range"] 
+000239c0: 3d20 6162 7328 7261 6e67 6544 6174 615b  = abs(rangeData[
+000239d0: 2243 6c6f 7365 225d 202d 2072 616e 6765  "Close"] - range
+000239e0: 4461 7461 5b22 4f70 656e 225d 290a 2020  Data["Open"]).  
+000239f0: 2020 2020 2020 2020 2020 7265 6365 6e74            recent
+00023a00: 203d 2072 616e 6765 4461 7461 2e68 6561   = rangeData.hea
+00023a10: 6428 3129 0a20 2020 2020 2020 2020 2020  d(1).           
+00023a20: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00023a30: 2020 2020 2020 6c65 6e28 7265 6365 6e74        len(recent
+00023a40: 2920 3d3d 2031 0a20 2020 2020 2020 2020  ) == 1.         
+00023a50: 2020 2020 2020 2061 6e64 2072 6563 656e         and recen
+00023a60: 745b 2252 616e 6765 225d 2e69 6c6f 635b  t["Range"].iloc[
+00023a70: 305d 203d 3d20 7261 6e67 6544 6174 612e  0] == rangeData.
+00023a80: 6465 7363 7269 6265 2829 5b22 5261 6e67  describe()["Rang
+00023a90: 6522 5d5b 226d 696e 225d 0a20 2020 2020  e"]["min"].     
+00023aa0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00023ab0: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00023ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ad0: 2020 2073 656c 662e 6765 7443 616e 646c     self.getCandl
+00023ae0: 6554 7970 6528 7265 6365 6e74 290a 2020  eType(recent).  
+00023af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b00: 2020 616e 6420 6e6f 775f 6361 6e64 6c65    and now_candle
+00023b10: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+00023b20: 5d20 3e3d 2072 6563 656e 745b 2243 6c6f  ] >= recent["Clo
+00023b30: 7365 225d 2e69 6c6f 635b 305d 0a20 2020  se"].iloc[0].   
+00023b40: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+00023b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b60: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00023b70: 5061 7474 6572 6e22 5d20 3d20 280a 2020  Pattern"] = (.  
+00023b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b90: 2020 2020 2020 7361 7665 645b 305d 202b        saved[0] +
+00023ba0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+00023bb0: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
+00023bc0: 4e20 2b20 6622 4275 792d 4e52 7b6e 727d  N + f"Buy-NR{nr}
+00023bd0: 2220 2b20 636f 6c6f 7254 6578 742e 454e  " + colorText.EN
+00023be0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+00023bf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00023c00: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00023c10: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+00023c20: 3d20 7361 7665 645b 315d 202b 2066 2242  = saved[1] + f"B
+00023c30: 7579 2d4e 527b 6e72 7d22 0a20 2020 2020  uy-NR{nr}".     
+00023c40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00023c50: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
+00023c60: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00023c70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00023c80: 2020 2020 2020 6e6f 7420 7365 6c66 2e67        not self.g
+00023c90: 6574 4361 6e64 6c65 5479 7065 2872 6563  etCandleType(rec
+00023ca0: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
+00023cb0: 2020 2020 2020 2020 2061 6e64 206e 6f77           and now
+00023cc0: 5f63 616e 646c 655b 2243 6c6f 7365 225d  _candle["Close"]
+00023cd0: 2e69 6c6f 635b 305d 203c 3d20 7265 6365  .iloc[0] <= rece
+00023ce0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
+00023cf0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00023d00: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00023d10: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00023d20: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
+00023d30: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00023d40: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00023d50: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00023d60: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+00023d70: 7874 2e46 4149 4c20 2b20 6622 5365 6c6c  xt.FAIL + f"Sell
+00023d80: 2d4e 527b 6e72 7d22 202b 2063 6f6c 6f72  -NR{nr}" + color
+00023d90: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00023da0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00023db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023dc0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+00023dd0: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
+00023de0: 5d20 2b20 6622 5365 6c6c 2d4e 527b 6e72  ] + f"Sell-NR{nr
+00023df0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00023e00: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00023e10: 7565 0a20 2020 2020 2020 2020 2020 2072  ue.            r
+00023e20: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00023e30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00023e40: 2020 2020 2020 7261 6e67 6544 6174 6120        rangeData 
+00023e50: 3d20 6461 7461 2e68 6561 6428 6e72 290a  = data.head(nr).
+00023e60: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
+00023e70: 6544 6174 612e 6c6f 635b 3a2c 2752 616e  eData.loc[:,'Ran
+00023e80: 6765 275d 203d 2061 6273 2872 616e 6765  ge'] = abs(range
+00023e90: 4461 7461 5b22 436c 6f73 6522 5d20 2d20  Data["Close"] - 
+00023ea0: 7261 6e67 6544 6174 615b 224f 7065 6e22  rangeData["Open"
+00023eb0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+00023ec0: 6563 656e 7420 3d20 7261 6e67 6544 6174  ecent = rangeDat
+00023ed0: 612e 6865 6164 2831 290a 2020 2020 2020  a.head(1).      
+00023ee0: 2020 2020 2020 6966 2072 6563 656e 745b        if recent[
+00023ef0: 2252 616e 6765 225d 2e69 6c6f 635b 305d  "Range"].iloc[0]
+00023f00: 203d 3d20 7261 6e67 6544 6174 612e 6465   == rangeData.de
+00023f10: 7363 7269 6265 2829 5b22 5261 6e67 6522  scribe()["Range"
+00023f20: 5d5b 226d 696e 225d 3a0a 2020 2020 2020  ]["min"]:.      
+00023f30: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00023f40: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+00023f50: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00023f60: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
+00023f70: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+00023f80: 4420 2b20 636f 6c6f 7254 6578 742e 4752  D + colorText.GR
+00023f90: 4545 4e20 2b20 6622 4e52 7b6e 727d 2220  EEN + f"NR{nr}" 
+00023fa0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+00023fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023fd0: 2020 7361 7665 4469 6374 5b22 5061 7474    saveDict["Patt
+00023fe0: 6572 6e22 5d20 3d20 7361 7665 645b 315d  ern"] = saved[1]
+00023ff0: 202b 2066 224e 527b 6e72 7d22 0a20 2020   + f"NR{nr}".   
+00024000: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00024010: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+00024020: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00024030: 650a 0a20 2020 2023 2046 696e 6420 6966  e..    # Find if
+00024040: 2073 746f 636b 2069 7320 6e65 776c 7920   stock is newly 
+00024050: 6c69 7374 6564 0a20 2020 2064 6566 2076  listed.    def v
+00024060: 616c 6964 6174 654e 6577 6c79 4c69 7374  alidateNewlyList
+00024070: 6564 2873 656c 662c 2064 662c 2064 6179  ed(self, df, day
+00024080: 7354 6f4c 6f6f 6b62 6163 6b29 3a0a 2020  sToLookback):.  
+00024090: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+000240a0: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+000240b0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000240c0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+000240d0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+000240e0: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
+000240f0: 6179 7354 6f4c 6f6f 6b62 6163 6b20 3d20  aysToLookback = 
+00024100: 696e 7428 6461 7973 546f 4c6f 6f6b 6261  int(daysToLookba
+00024110: 636b 5b3a 2d31 5d29 0a20 2020 2020 2020  ck[:-1]).       
+00024120: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
+00024130: 6561 6428 3129 0a20 2020 2020 2020 2069  ead(1).        i
+00024140: 6620 6c65 6e28 7265 6365 6e74 2920 3c20  f len(recent) < 
+00024150: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
+00024160: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00024170: 2020 2020 6966 206c 656e 2864 6174 6129      if len(data)
+00024180: 203c 2064 6179 7354 6f4c 6f6f 6b62 6163   < daysToLookbac
+00024190: 6b20 616e 6420 280a 2020 2020 2020 2020  k and (.        
+000241a0: 2020 2020 7265 6365 6e74 5b22 436c 6f73      recent["Clos
+000241b0: 6522 5d2e 696c 6f63 5b30 5d20 213d 206e  e"].iloc[0] != n
+000241c0: 702e 6e61 6e20 616e 6420 7265 6365 6e74  p.nan and recent
+000241d0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+000241e0: 5d20 3e20 300a 2020 2020 2020 2020 293a  ] > 0.        ):
+000241f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00024200: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+00024210: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00024220: 2020 2023 2056 616c 6964 6174 6520 6966     # Validate if
+00024230: 2074 6865 2073 746f 636b 2070 7269 6365   the stock price
+00024240: 7320 6172 6520 6174 206c 6561 7374 2072  s are at least r
+00024250: 6973 696e 6720 6279 2032 2520 666f 7220  ising by 2% for 
+00024260: 7468 6520 6c61 7374 2033 2073 6573 7369  the last 3 sessi
+00024270: 6f6e 730a 2020 2020 6465 6620 7661 6c69  ons.    def vali
+00024280: 6461 7465 5072 6963 6552 6973 696e 6742  datePriceRisingB
+00024290: 7941 744c 6561 7374 3250 6572 6365 6e74  yAtLeast2Percent
+000242a0: 2873 656c 662c 2064 662c 2073 6372 6565  (self, df, scree
+000242b0: 6e44 6963 742c 2073 6176 6544 6963 7429  nDict, saveDict)
+000242c0: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+000242d0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+000242e0: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+000242f0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00024300: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+00024310: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+00024320: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
+00024330: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+00024340: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
+00024350: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
+00024360: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
+00024370: 2020 2064 6174 6120 3d20 6461 7461 2e68     data = data.h
+00024380: 6561 6428 3429 0a20 2020 2020 2020 2069  ead(4).        i
+00024390: 6620 6c65 6e28 6461 7461 2920 3c20 343a  f len(data) < 4:
+000243a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000243b0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+000243c0: 2020 6461 7930 203d 2064 6174 612e 696c    day0 = data.il
+000243d0: 6f63 5b30 5d5b 2243 6c6f 7365 225d 2e69  oc[0]["Close"].i
+000243e0: 7465 6d28 290a 2020 2020 2020 2020 6461  tem().        da
+000243f0: 794d 696e 7573 3120 3d20 6461 7461 2e69  yMinus1 = data.i
+00024400: 6c6f 635b 315d 5b22 436c 6f73 6522 5d2e  loc[1]["Close"].
+00024410: 6974 656d 2829 0a20 2020 2020 2020 2064  item().        d
+00024420: 6179 4d69 6e75 7332 203d 2064 6174 612e  ayMinus2 = data.
+00024430: 696c 6f63 5b32 5d5b 2243 6c6f 7365 225d  iloc[2]["Close"]
+00024440: 2e69 7465 6d28 290a 2020 2020 2020 2020  .item().        
+00024450: 6461 794d 696e 7573 3320 3d20 6461 7461  dayMinus3 = data
+00024460: 2e69 6c6f 635b 335d 5b22 436c 6f73 6522  .iloc[3]["Close"
+00024470: 5d2e 6974 656d 2829 0a20 2020 2020 2020  ].item().       
+00024480: 2070 6572 6365 6e74 3320 3d20 726f 756e   percent3 = roun
+00024490: 6428 2864 6179 4d69 6e75 7332 202d 2064  d((dayMinus2 - d
+000244a0: 6179 4d69 6e75 7333 2920 2a20 3130 3020  ayMinus3) * 100 
+000244b0: 2f20 6461 794d 696e 7573 332c 2032 290a  / dayMinus3, 2).
+000244c0: 2020 2020 2020 2020 7065 7263 656e 7432          percent2
+000244d0: 203d 2072 6f75 6e64 2828 6461 794d 696e   = round((dayMin
+000244e0: 7573 3120 2d20 6461 794d 696e 7573 3229  us1 - dayMinus2)
+000244f0: 202a 2031 3030 202f 2064 6179 4d69 6e75   * 100 / dayMinu
+00024500: 7332 2c20 3229 0a20 2020 2020 2020 2070  s2, 2).        p
+00024510: 6572 6365 6e74 3120 3d20 726f 756e 6428  ercent1 = round(
+00024520: 2864 6179 3020 2d20 6461 794d 696e 7573  (day0 - dayMinus
+00024530: 3129 202a 2031 3030 202f 2064 6179 4d69  1) * 100 / dayMi
+00024540: 6e75 7331 2c20 3229 0a0a 2020 2020 2020  nus1, 2)..      
+00024550: 2020 6966 2070 6572 6365 6e74 3120 3e3d    if percent1 >=
+00024560: 2032 2061 6e64 2070 6572 6365 6e74 3220   2 and percent2 
+00024570: 3e3d 2032 2061 6e64 2070 6572 6365 6e74  >= 2 and percent
+00024580: 3320 3e3d 2032 3a0a 2020 2020 2020 2020  3 >= 2:.        
+00024590: 2020 2020 7063 745f 6368 616e 6765 5f74      pct_change_t
+000245a0: 6578 7420 3d20 280a 2020 2020 2020 2020  ext = (.        
+000245b0: 2020 2020 2020 2020 2822 252e 3166 2525          ("%.1f%%
+000245c0: 2220 2520 7065 7263 656e 7431 290a 2020  " % percent1).  
+000245d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000245e0: 2822 2028 252e 3166 2525 2c22 2025 2070  (" (%.1f%%," % p
+000245f0: 6572 6365 6e74 3229 0a20 2020 2020 2020  ercent2).       
+00024600: 2020 2020 2020 2020 202b 2028 2220 252e           + (" %.
+00024610: 3166 2525 2922 2025 2070 6572 6365 6e74  1f%%)" % percent
+00024620: 3329 0a20 2020 2020 2020 2020 2020 2029  3).            )
+00024630: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
+00024640: 6544 6963 745b 2225 4368 6e67 225d 203d  eDict["%Chng"] =
+00024650: 2070 6374 5f63 6861 6e67 655f 7465 7874   pct_change_text
+00024660: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+00024670: 6565 6e44 6963 745b 2225 4368 6e67 225d  eenDict["%Chng"]
+00024680: 203d 2063 6f6c 6f72 5465 7874 2e47 5245   = colorText.GRE
+00024690: 454e 202b 2070 6374 5f63 6861 6e67 655f  EN + pct_change_
+000246a0: 7465 7874 202b 2063 6f6c 6f72 5465 7874  text + colorText
+000246b0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+000246c0: 2072 6574 7572 6e20 5472 7565 2061 6e64   return True and
+000246d0: 2073 656c 662e 6765 7443 616e 646c 6554   self.getCandleT
+000246e0: 7970 6528 6461 7461 2e68 6561 6428 3129  ype(data.head(1)
+000246f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00024700: 2046 616c 7365 0a0a 2020 2020 2340 6d65   False..    #@me
+00024710: 6173 7572 655f 7469 6d65 0a20 2020 2023  asure_time.    #
+00024720: 2076 616c 6964 6174 6520 6966 2052 5349   validate if RSI
+00024730: 2069 7320 7769 7468 696e 2067 6976 656e   is within given
+00024740: 2072 616e 6765 0a20 2020 2064 6566 2076   range.    def v
+00024750: 616c 6964 6174 6552 5349 2873 656c 662c  alidateRSI(self,
+00024760: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+00024770: 2073 6176 6544 6963 742c 206d 696e 5253   saveDict, minRS
+00024780: 492c 206d 6178 5253 492c 7273 694b 6579  I, maxRSI,rsiKey
+00024790: 3d22 5253 4922 293a 0a20 2020 2020 2020  ="RSI"):.       
+000247a0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+000247b0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+000247c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000247d0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+000247e0: 2069 6620 7273 694b 6579 206e 6f74 2069   if rsiKey not i
+000247f0: 6e20 6466 2e63 6f6c 756d 6e73 3a0a 2020  n df.columns:.  
+00024800: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00024810: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+00024820: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+00024830: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00024840: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
+00024850: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+00024860: 612e 7265 706c 6163 6528 5b6e 702e 696e  a.replace([np.in
+00024870: 662c 202d 6e70 2e69 6e66 5d2c 2030 290a  f, -np.inf], 0).
+00024880: 2020 2020 2020 2020 7273 6920 3d20 696e          rsi = in
+00024890: 7428 6461 7461 2e68 6561 6428 3129 5b72  t(data.head(1)[r
+000248a0: 7369 4b65 795d 2e69 6c6f 635b 305d 290a  siKey].iloc[0]).
+000248b0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+000248c0: 5b72 7369 4b65 795d 203d 2072 7369 0a20  [rsiKey] = rsi. 
+000248d0: 2020 2020 2020 2023 2068 7474 7073 3a2f         # https:/
+000248e0: 2f63 6861 7274 696e 6b2e 636f 6d2f 7363  /chartink.com/sc
+000248f0: 7265 656e 6572 2f72 7369 2d73 6372 6565  reener/rsi-scree
+00024900: 6e69 6e67 0a20 2020 2020 2020 2069 6620  ning.        if 
+00024910: 7273 693e 2030 2061 6e64 2072 7369 203e  rsi> 0 and rsi >
+00024920: 3d20 6d69 6e52 5349 2061 6e64 2072 7369  = minRSI and rsi
+00024930: 203c 3d20 6d61 7852 5349 3a20 2023 206f   <= maxRSI:  # o
+00024940: 7220 2872 7369 203c 3d20 3731 2061 6e64  r (rsi <= 71 and
+00024950: 2072 7369 203e 3d20 3637 293a 0a20 2020   rsi >= 67):.   
+00024960: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00024970: 6963 745b 7273 694b 6579 5d20 3d20 280a  ict[rsiKey] = (.
+00024980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024990: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
+000249a0: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
+000249b0: 202b 2073 7472 2872 7369 2920 2b20 636f   + str(rsi) + co
+000249c0: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+000249d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000249e0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+000249f0: 6520 6966 2028 7273 694b 6579 203d 3d20  e if (rsiKey == 
+00024a00: 2252 5349 6922 2920 656c 7365 2028 7365  "RSIi") else (se
+00024a10: 6c66 2e76 616c 6964 6174 6552 5349 2864  lf.validateRSI(d
+00024a20: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+00024a30: 6176 6544 6963 742c 206d 696e 5253 492c  aveDict, minRSI,
+00024a40: 206d 6178 5253 492c 7273 694b 6579 3d22   maxRSI,rsiKey="
+00024a50: 5253 4969 2229 206f 7220 5472 7565 290a  RSIi") or True).
+00024a60: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+00024a70: 6374 5b72 7369 4b65 795d 203d 2063 6f6c  ct[rsiKey] = col
+00024a80: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
+00024a90: 6c6f 7254 6578 742e 4641 494c 202b 2073  lorText.FAIL + s
+00024aa0: 7472 2872 7369 2920 2b20 636f 6c6f 7254  tr(rsi) + colorT
+00024ab0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+00024ac0: 2320 4966 2065 6974 6865 7220 6461 696c  # If either dail
+00024ad0: 7920 6f72 2069 6e74 7261 6461 7920 5253  y or intraday RS
+00024ae0: 4920 636f 6d65 7320 7769 7468 696e 2072  I comes within r
+00024af0: 616e 6765 3f0a 2020 2020 2020 2020 7265  ange?.        re
+00024b00: 7475 726e 2046 616c 7365 2069 6620 2872  turn False if (r
+00024b10: 7369 4b65 7920 3d3d 2022 5253 4969 2229  siKey == "RSIi")
+00024b20: 2065 6c73 6520 2873 656c 662e 7661 6c69   else (self.vali
+00024b30: 6461 7465 5253 4928 6466 2c20 7363 7265  dateRSI(df, scre
+00024b40: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+00024b50: 2c20 6d69 6e52 5349 2c20 6d61 7852 5349  , minRSI, maxRSI
+00024b60: 2c72 7369 4b65 793d 2252 5349 6922 2929  ,rsiKey="RSIi"))
+00024b70: 0a0a 2020 2020 2320 5661 6c69 6461 7465  ..    # Validate
+00024b80: 2069 6620 7468 6520 7374 6f63 6b20 6973   if the stock is
+00024b90: 2062 756c 6c69 7368 2069 6e20 7468 6520   bullish in the 
+00024ba0: 7368 6f72 7420 7465 726d 0a20 2020 2064  short term.    d
+00024bb0: 6566 2076 616c 6964 6174 6553 686f 7274  ef validateShort
+00024bc0: 5465 726d 4275 6c6c 6973 6828 7365 6c66  TermBullish(self
+00024bd0: 2c20 6466 2c20 7363 7265 656e 4469 6374  , df, screenDict
+00024be0: 2c20 7361 7665 4469 6374 293a 0a20 2020  , saveDict):.   
+00024bf0: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
+00024c00: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
+00024c10: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00024c20: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+00024c30: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
+00024c40: 6f70 7928 290a 2020 2020 2020 2020 2320  opy().        # 
+00024c50: 6874 7470 733a 2f2f 6368 6172 7469 6e6b  https://chartink
+00024c60: 2e63 6f6d 2f73 6372 6565 6e65 722f 7368  .com/screener/sh
+00024c70: 6f72 742d 7465 726d 2d62 756c 6c69 7368  ort-term-bullish
+00024c80: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00024c90: 6461 7461 2e66 696c 6c6e 6128 3029 0a20  data.fillna(0). 
+00024ca0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00024cb0: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+00024cc0: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+00024cd0: 0a20 2020 2020 2020 2072 6563 656e 7420  .        recent 
+00024ce0: 3d20 6461 7461 2e68 6561 6428 3129 0a20  = data.head(1). 
+00024cf0: 2020 2020 2020 2066 6b20 3d20 3020 6966         fk = 0 if
+00024d00: 206c 656e 2864 6174 6129 203c 2033 2065   len(data) < 3 e
+00024d10: 6c73 6520 6e70 2e72 6f75 6e64 2864 6174  lse np.round(dat
+00024d20: 615b 2246 4153 544b 225d 2e69 6c6f 635b  a["FASTK"].iloc[
+00024d30: 325d 2c20 3529 0a20 2020 2020 2020 2023  2], 5).        #
+00024d40: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
+00024d50: 6166 7261 6d65 2066 6f72 2069 6368 696d  aframe for ichim
+00024d60: 6f6b 7520 6361 6c63 756c 6174 696f 6e73  oku calculations
+00024d70: 2077 6974 6820 6461 7465 2069 6e20 6173   with date in as
+00024d80: 6365 6e64 696e 6720 6f72 6465 720a 2020  cending order.  
+00024d90: 2020 2020 2020 6466 5f6e 6577 203d 2064        df_new = d
+00024da0: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
+00024db0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00024dc0: 2020 2064 665f 6963 6869 203d 2064 665f     df_ichi = df_
+00024dd0: 6e65 772e 7265 6e61 6d65 280a 2020 2020  new.rename(.    
+00024de0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00024df0: 6d6e 733d 7b0a 2020 2020 2020 2020 2020  mns={.          
+00024e00: 2020 2020 2020 2020 2020 224f 7065 6e22            "Open"
+00024e10: 3a20 226f 7065 6e22 2c0a 2020 2020 2020  : "open",.      
+00024e20: 2020 2020 2020 2020 2020 2020 2020 2248                "H
+00024e30: 6967 6822 3a20 2268 6967 6822 2c0a 2020  igh": "high",.  
+00024e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e50: 2020 224c 6f77 223a 2022 6c6f 7722 2c0a    "Low": "low",.
+00024e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e70: 2020 2020 2243 6c6f 7365 223a 2022 636c      "Close": "cl
+00024e80: 6f73 6522 2c0a 2020 2020 2020 2020 2020  ose",.          
+00024e90: 2020 2020 2020 2020 2020 2256 6f6c 756d            "Volum
+00024ea0: 6522 3a20 2276 6f6c 756d 6522 2c0a 2020  e": "volume",.  
+00024eb0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00024ec0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00024ed0: 2020 2020 2020 2020 2020 6963 6869 203d            ichi =
+00024ee0: 2070 6b74 616c 6962 2e69 6368 696d 6f6b   pktalib.ichimok
+00024ef0: 7528 6466 5f69 6368 692c 2039 2c20 3236  u(df_ichi, 9, 26
+00024f00: 2c20 3532 2c20 3236 290a 2020 2020 2020  , 52, 26).      
+00024f10: 2020 2020 2020 6966 2069 6368 6920 6973        if ichi is
+00024f20: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00024f30: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00024f40: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00024f50: 6466 5f6e 6577 203d 2070 642e 636f 6e63  df_new = pd.conc
+00024f60: 6174 285b 6466 5f6e 6577 2c20 6963 6869  at([df_new, ichi
+00024f70: 5d2c 2061 7869 733d 3129 0a20 2020 2020  ], axis=1).     
+00024f80: 2020 2020 2020 2023 2052 6576 6572 7365         # Reverse
+00024f90: 2061 6761 696e 2074 6f20 6765 7420 7468   again to get th
+00024fa0: 6520 6d6f 7374 2072 6563 656e 7420 6461  e most recent da
+00024fb0: 7465 206f 6e20 746f 700a 2020 2020 2020  te on top.      
+00024fc0: 2020 2020 2020 6466 5f6e 6577 203d 2064        df_new = d
+00024fd0: 665f 6e65 775b 3a3a 2d31 5d0a 2020 2020  f_new[::-1].    
+00024fe0: 2020 2020 2020 2020 6466 5f6e 6577 203d          df_new =
+00024ff0: 2064 665f 6e65 772e 6865 6164 2831 290a   df_new.head(1).
+00025000: 2020 2020 2020 2020 2020 2020 6466 5f6e              df_n
+00025010: 6577 5b22 636c 6f75 645f 6772 6565 6e22  ew["cloud_green"
+00025020: 5d20 3d20 6466 5f6e 6577 5b22 4953 415f  ] = df_new["ISA_
+00025030: 3922 5d2e 696c 6f63 5b30 5d20 3e20 6466  9"].iloc[0] > df
+00025040: 5f6e 6577 5b22 4953 425f 3236 225d 2e69  _new["ISB_26"].i
+00025050: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
+00025060: 2020 2064 665f 6e65 775b 2263 6c6f 7564     df_new["cloud
+00025070: 5f72 6564 225d 203d 2064 665f 6e65 775b  _red"] = df_new[
+00025080: 2249 5342 5f32 3622 5d2e 696c 6f63 5b30  "ISB_26"].iloc[0
+00025090: 5d20 3e20 6466 5f6e 6577 5b22 4953 415f  ] > df_new["ISA_
+000250a0: 3922 5d2e 696c 6f63 5b30 5d0a 2020 2020  9"].iloc[0].    
+000250b0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+000250c0: 7469 6f6e 2061 7320 653a 2020 2320 7072  tion as e:  # pr
+000250d0: 6167 6d61 3a20 6e6f 2063 6f76 6572 0a20  agma: no cover. 
+000250e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000250f0: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
+00025100: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
+00025110: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00025120: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00025130: 6162 6f76 6543 6c6f 7564 546f 7020 3d20  aboveCloudTop = 
+00025140: 4661 6c73 650a 2020 2020 2020 2020 2320  False.        # 
+00025150: 6261 7365 6c69 6e65 203e 2063 6c6f 7564  baseline > cloud
+00025160: 2074 6f70 2028 636c 6f75 6420 6973 2062   top (cloud is b
+00025170: 6f75 6e64 2062 7920 7370 616e 2061 2061  ound by span a a
+00025180: 6e64 2073 7061 6e20 6229 2061 6e64 2063  nd span b) and c
+00025190: 6c6f 7365 2069 7320 3e20 636c 6f75 6420  lose is > cloud 
+000251a0: 746f 700a 2020 2020 2020 2020 6966 2064  top.        if d
+000251b0: 665f 6e65 775b 2263 6c6f 7564 5f67 7265  f_new["cloud_gre
+000251c0: 656e 225d 2e69 6c6f 635b 305d 3a0a 2020  en"].iloc[0]:.  
+000251d0: 2020 2020 2020 2020 2020 6162 6f76 6543            aboveC
+000251e0: 6c6f 7564 546f 7020 3d20 280a 2020 2020  loudTop = (.    
+000251f0: 2020 2020 2020 2020 2020 2020 6466 5f6e              df_n
+00025200: 6577 5b22 494b 535f 3236 225d 2e69 6c6f  ew["IKS_26"].ilo
+00025210: 635b 305d 203e 2064 665f 6e65 775b 2249  c[0] > df_new["I
+00025220: 5341 5f39 225d 2e69 6c6f 635b 305d 0a20  SA_9"].iloc[0]. 
+00025230: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00025240: 6e64 2072 6563 656e 745b 2243 6c6f 7365  nd recent["Close
+00025250: 225d 2e69 6c6f 635b 305d 203e 2064 665f  "].iloc[0] > df_
+00025260: 6e65 775b 2249 5341 5f39 225d 2e69 6c6f  new["ISA_9"].ilo
+00025270: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+00025280: 2029 0a20 2020 2020 2020 2065 6c69 6620   ).        elif 
+00025290: 6466 5f6e 6577 5b22 636c 6f75 645f 7265  df_new["cloud_re
+000252a0: 6422 5d2e 696c 6f63 5b30 5d3a 0a20 2020  d"].iloc[0]:.   
+000252b0: 2020 2020 2020 2020 2061 626f 7665 436c           aboveCl
+000252c0: 6f75 6454 6f70 203d 2028 0a20 2020 2020  oudTop = (.     
+000252d0: 2020 2020 2020 2020 2020 2064 665f 6e65             df_ne
+000252e0: 775b 2249 4b53 5f32 3622 5d2e 696c 6f63  w["IKS_26"].iloc
+000252f0: 5b30 5d20 3e20 6466 5f6e 6577 5b22 4953  [0] > df_new["IS
+00025300: 425f 3236 225d 2e69 6c6f 635b 305d 0a20  B_26"].iloc[0]. 
+00025310: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00025320: 6e64 2072 6563 656e 745b 2243 6c6f 7365  nd recent["Close
+00025330: 225d 2e69 6c6f 635b 305d 203e 2064 665f  "].iloc[0] > df_
+00025340: 6e65 775b 2249 5342 5f32 3622 5d2e 696c  new["ISB_26"].il
+00025350: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
+00025360: 2020 290a 0a20 2020 2020 2020 2023 204c    )..        # L
+00025370: 6174 6573 7420 4963 6869 6d6f 6b75 2062  atest Ichimoku b
+00025380: 6173 656c 696e 6520 6973 203c 206c 6174  aseline is < lat
+00025390: 6573 7420 4963 6869 6d6f 6b75 2063 6f6e  est Ichimoku con
+000253a0: 7665 7273 696f 6e20 6c69 6e65 0a20 2020  version line.   
+000253b0: 2020 2020 2069 6620 6162 6f76 6543 6c6f       if aboveClo
+000253c0: 7564 546f 7020 616e 6420 6466 5f6e 6577  udTop and df_new
+000253d0: 5b22 494b 535f 3236 225d 2e69 6c6f 635b  ["IKS_26"].iloc[
+000253e0: 305d 203c 2064 665f 6e65 775b 2249 5453  0] < df_new["ITS
+000253f0: 5f39 225d 2e69 6c6f 635b 305d 3a0a 2020  _9"].iloc[0]:.  
+00025400: 2020 2020 2020 2020 2020 2320 5374 6f63            # Stoc
+00025410: 6852 5349 2063 726f 7373 6564 2032 3020  hRSI crossed 20 
+00025420: 616e 6420 5253 4920 3e20 3530 0a20 2020  and RSI > 50.   
+00025430: 2020 2020 2020 2020 2069 6620 666b 203e           if fk >
+00025440: 2032 3020 616e 6420 7265 6365 6e74 5b22   20 and recent["
+00025450: 5253 4922 5d2e 696c 6f63 5b30 5d20 3e20  RSI"].iloc[0] > 
+00025460: 3530 3a0a 2020 2020 2020 2020 2020 2020  50:.            
+00025470: 2020 2020 2320 636f 6e64 6974 696f 6e20      # condition 
+00025480: 6f66 2063 726f 7373 696e 6720 7468 6520  of crossing the 
+00025490: 5374 6f63 6852 5349 206d 6169 6e20 7369  StochRSI main si
+000254a0: 676e 616c 206c 696e 6520 6672 6f6d 2062  gnal line from b
+000254b0: 6f74 746f 6d20 746f 2074 6f70 0a20 2020  ottom to top.   
+000254c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000254d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000254e0: 2020 2020 2020 6461 7461 5b22 4641 5354        data["FAST
+000254f0: 4422 5d2e 696c 6f63 5b31 3030 5d20 3c20  D"].iloc[100] < 
+00025500: 6461 7461 5b22 4641 5354 4b22 5d2e 696c  data["FASTK"].il
+00025510: 6f63 5b31 3030 5d0a 2020 2020 2020 2020  oc[100].        
+00025520: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00025530: 6461 7461 5b22 4641 5354 4422 5d2e 696c  data["FASTD"].il
+00025540: 6f63 5b31 3031 5d20 3e20 6461 7461 5b22  oc[101] > data["
+00025550: 4641 5354 4b22 5d2e 696c 6f63 5b31 3031  FASTK"].iloc[101
+00025560: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00025570: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00025580: 2020 2020 2020 2020 2023 2063 6c6f 7365           # close
+00025590: 203e 2035 3020 7065 7269 6f64 2053 4d41   > 50 period SMA
+000255a0: 2f45 4d41 2061 6e64 2032 3030 2070 6572  /EMA and 200 per
+000255b0: 696f 6420 534d 412f 454d 410a 2020 2020  iod SMA/EMA.    
+000255c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255d0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+000255e0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+000255f0: 656e 745b 2253 534d 4122 5d2e 696c 6f63  ent["SSMA"].iloc
+00025600: 5b30 5d20 3e20 7265 6365 6e74 5b22 534d  [0] > recent["SM
+00025610: 4122 5d2e 696c 6f63 5b30 5d0a 2020 2020  A"].iloc[0].    
+00025620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025630: 2020 2020 616e 6420 7265 6365 6e74 5b22      and recent["
+00025640: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+00025650: 3e20 7265 6365 6e74 5b22 5353 4d41 225d  > recent["SSMA"]
+00025660: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00025670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025680: 2061 6e64 2072 6563 656e 745b 2243 6c6f   and recent["Clo
+00025690: 7365 225d 2e69 6c6f 635b 305d 203e 2072  se"].iloc[0] > r
+000256a0: 6563 656e 745b 224c 4d41 225d 2e69 6c6f  ecent["LMA"].ilo
+000256b0: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+000256c0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+000256d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000256e0: 2020 2020 7361 7665 6420 3d20 7365 6c66      saved = self
+000256f0: 2e66 696e 6443 7572 7265 6e74 5361 7665  .findCurrentSave
+00025700: 6456 616c 7565 2873 6372 6565 6e44 6963  dValue(screenDic
+00025710: 742c 7361 7665 4469 6374 2c22 4d41 2d53  t,saveDict,"MA-S
+00025720: 6967 6e61 6c22 290a 2020 2020 2020 2020  ignal").        
+00025730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025740: 7363 7265 656e 4469 6374 5b22 4d41 2d53  screenDict["MA-S
+00025750: 6967 6e61 6c22 5d20 3d20 280a 2020 2020  ignal"] = (.    
 00025760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025770: 2020 2020 7361 7665 4469 6374 5b22 4d41      saveDict["MA
-00025780: 2d53 6967 6e61 6c22 5d20 3d20 7361 7665  -Signal"] = save
-00025790: 645b 315d 202b 2022 4275 6c6c 6973 6822  d[1] + "Bullish"
-000257a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000257b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000257c0: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-000257d0: 7572 6e20 4661 6c73 650a 2020 2020 0a20  urn False.    . 
-000257e0: 2020 2023 2056 616c 6964 6174 6520 5643     # Validate VC
-000257f0: 5020 6173 2070 6572 204d 6172 6b20 4d69  P as per Mark Mi
-00025800: 6e65 7276 696e 690a 2020 2020 2320 6874  nervini.    # ht
-00025810: 7470 733a 2f2f 6368 6172 7469 6e6b 2e63  tps://chartink.c
-00025820: 6f6d 2f73 6372 6565 6e65 722f 766f 6c61  om/screener/vola
-00025830: 7469 6c69 7479 2d63 6f6d 7072 6573 7369  tility-compressi
-00025840: 6f6e 0a20 2020 2064 6566 2076 616c 6964  on.    def valid
-00025850: 6174 6556 4350 4d61 726b 4d69 6e65 7276  ateVCPMarkMinerv
-00025860: 696e 6928 7365 6c66 2c20 6466 3a70 642e  ini(self, df:pd.
-00025870: 4461 7461 4672 616d 652c 2073 6372 6565  DataFrame, scree
-00025880: 6e44 6963 742c 2073 6176 6544 6963 7429  nDict, saveDict)
-00025890: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
-000258a0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-000258b0: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
-000258c0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000258d0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-000258e0: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-000258f0: 2020 206f 686c 635f 6469 6374 203d 207b     ohlc_dict = {
-00025900: 0a20 2020 2020 2020 2020 2020 2027 4f70  .            'Op
-00025910: 656e 273a 2766 6972 7374 272c 0a20 2020  en':'first',.   
-00025920: 2020 2020 2020 2020 2027 4869 6768 273a           'High':
-00025930: 276d 6178 272c 0a20 2020 2020 2020 2020  'max',.         
-00025940: 2020 2027 4c6f 7727 3a27 6d69 6e27 2c0a     'Low':'min',.
-00025950: 2020 2020 2020 2020 2020 2020 2743 6c6f              'Clo
-00025960: 7365 273a 276c 6173 7427 2c0a 2020 2020  se':'last',.    
-00025970: 2020 2020 2020 2020 2756 6f6c 756d 6527          'Volume'
-00025980: 3a27 7375 6d27 0a20 2020 2020 2020 207d  :'sum'.        }
-00025990: 0a20 2020 2020 2020 2023 2066 696e 616c  .        # final
-000259a0: 5f64 6620 3d20 6466 2e72 6573 616d 706c  _df = df.resampl
-000259b0: 6528 2757 2d46 5249 272c 2063 6c6f 7365  e('W-FRI', close
-000259c0: 643d 276c 6566 7427 292e 6167 6728 6f68  d='left').agg(oh
-000259d0: 6c63 5f64 6963 7429 2e73 6869 6674 2827  lc_dict).shift('
-000259e0: 3164 2729 0a20 2020 2020 2020 2077 6565  1d').        wee
-000259f0: 6b6c 7944 6174 6120 3d20 6461 7461 2e72  klyData = data.r
-00025a00: 6573 616d 706c 6528 2757 2729 2e61 6767  esample('W').agg
-00025a10: 286f 686c 635f 6469 6374 290a 2020 2020  (ohlc_dict).    
-00025a20: 2020 2020 7265 7665 7273 6564 4461 7461      reversedData
-00025a30: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
-00025a40: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
-00025a50: 6166 7261 6d65 0a20 2020 2020 2020 2072  aframe.        r
-00025a60: 6563 656e 745f 636c 6f73 6520 3d20 6461  ecent_close = da
-00025a70: 7461 5b22 436c 6f73 6522 5d2e 6865 6164  ta["Close"].head
-00025a80: 2831 292e 696c 6f63 5b30 5d0a 2020 2020  (1).iloc[0].    
-00025a90: 2020 2020 775f 656d 615f 3133 203d 2070      w_ema_13 = p
-00025aa0: 6b74 616c 6962 2e45 4d41 2877 6565 6b6c  ktalib.EMA(weekl
-00025ab0: 7944 6174 615b 2243 6c6f 7365 225d 2c74  yData["Close"],t
-00025ac0: 696d 6570 6572 696f 643d 3133 292e 7461  imeperiod=13).ta
-00025ad0: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
-00025ae0: 2020 2020 2020 775f 656d 615f 3236 203d        w_ema_26 =
-00025af0: 2070 6b74 616c 6962 2e45 4d41 2877 6565   pktalib.EMA(wee
-00025b00: 6b6c 7944 6174 615b 2243 6c6f 7365 225d  klyData["Close"]
-00025b10: 2c74 696d 6570 6572 696f 643d 3236 292e  ,timeperiod=26).
-00025b20: 7461 696c 2831 292e 696c 6f63 5b30 5d0a  tail(1).iloc[0].
-00025b30: 2020 2020 2020 2020 775f 736d 615f 3530          w_sma_50
-00025b40: 203d 2070 6b74 616c 6962 2e53 4d41 2877   = pktalib.SMA(w
-00025b50: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
-00025b60: 225d 2c74 696d 6570 6572 696f 643d 3530  "],timeperiod=50
-00025b70: 292e 7461 696c 2831 292e 696c 6f63 5b30  ).tail(1).iloc[0
-00025b80: 5d0a 2020 2020 2020 2020 775f 736d 615f  ].        w_sma_
-00025b90: 3430 203d 2070 6b74 616c 6962 2e53 4d41  40 = pktalib.SMA
-00025ba0: 2877 6565 6b6c 7944 6174 615b 2243 6c6f  (weeklyData["Clo
-00025bb0: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
-00025bc0: 3430 292e 7461 696c 2831 292e 696c 6f63  40).tail(1).iloc
-00025bd0: 5b30 5d0a 2020 2020 2020 2020 775f 736d  [0].        w_sm
-00025be0: 615f 3430 5f35 775f 6167 6f20 3d20 706b  a_40_5w_ago = pk
-00025bf0: 7461 6c69 622e 534d 4128 7765 656b 6c79  talib.SMA(weekly
-00025c00: 4461 7461 2e68 6561 6428 6c65 6e28 7765  Data.head(len(we
-00025c10: 656b 6c79 4461 7461 292d 3529 5b22 436c  eklyData)-5)["Cl
-00025c20: 6f73 6522 5d2c 7469 6d65 7065 7269 6f64  ose"],timeperiod
-00025c30: 3d34 3029 2e74 6169 6c28 3129 2e69 6c6f  =40).tail(1).ilo
-00025c40: 635b 305d 0a20 2020 2020 2020 2077 5f6d  c[0].        w_m
-00025c50: 696e 5f35 3020 3d20 6d69 6e28 312e 332a  in_50 = min(1.3*
-00025c60: 7765 656b 6c79 4461 7461 2e74 6169 6c28  weeklyData.tail(
-00025c70: 3530 295b 224c 6f77 225d 290a 2020 2020  50)["Low"]).    
-00025c80: 2020 2020 775f 6d61 785f 3530 203d 206d      w_max_50 = m
-00025c90: 6178 2830 2e37 352a 7765 656b 6c79 4461  ax(0.75*weeklyDa
-00025ca0: 7461 2e74 6169 6c28 3530 295b 2248 6967  ta.tail(50)["Hig
-00025cb0: 6822 5d29 0a20 2020 2020 2020 2077 5f65  h"]).        w_e
-00025cc0: 6d61 5f32 365f 3230 775f 6167 6f20 3d20  ma_26_20w_ago = 
-00025cd0: 706b 7461 6c69 622e 454d 4128 7765 656b  pktalib.EMA(week
-00025ce0: 6c79 4461 7461 2e68 6561 6428 6c65 6e28  lyData.head(len(
-00025cf0: 7765 656b 6c79 4461 7461 292d 3230 295b  weeklyData)-20)[
-00025d00: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00025d10: 696f 643d 3236 292e 7461 696c 2831 292e  iod=26).tail(1).
-00025d20: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-00025d30: 7265 6365 6e74 5f65 6d61 5f31 335f 3230  recent_ema_13_20
-00025d40: 645f 6167 6f20 3d20 706b 7461 6c69 622e  d_ago = pktalib.
-00025d50: 454d 4128 7265 7665 7273 6564 4461 7461  EMA(reversedData
-00025d60: 2e68 6561 6428 6c65 6e28 7265 7665 7273  .head(len(revers
-00025d70: 6564 4461 7461 292d 3230 295b 2243 6c6f  edData)-20)["Clo
-00025d80: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
-00025d90: 3133 292e 7461 696c 2831 292e 696c 6f63  13).tail(1).iloc
-00025da0: 5b30 5d0a 2020 2020 2020 2020 775f 736d  [0].        w_sm
-00025db0: 615f 3430 5f35 775f 6167 6f20 3d20 706b  a_40_5w_ago = pk
-00025dc0: 7461 6c69 622e 534d 4128 7765 656b 6c79  talib.SMA(weekly
-00025dd0: 4461 7461 2e68 6561 6428 6c65 6e28 7765  Data.head(len(we
-00025de0: 656b 6c79 4461 7461 292d 3529 5b22 436c  eklyData)-5)["Cl
-00025df0: 6f73 6522 5d2c 7469 6d65 7065 7269 6f64  ose"],timeperiod
-00025e00: 3d34 3029 2e74 6169 6c28 3129 2e69 6c6f  =40).tail(1).ilo
-00025e10: 635b 305d 0a20 2020 2020 2020 2077 5f73  c[0].        w_s
-00025e20: 6d61 5f34 305f 3130 775f 6167 6f20 3d20  ma_40_10w_ago = 
-00025e30: 706b 7461 6c69 622e 534d 4128 7765 656b  pktalib.SMA(week
-00025e40: 6c79 4461 7461 2e68 6561 6428 6c65 6e28  lyData.head(len(
-00025e50: 7765 656b 6c79 4461 7461 292d 3130 295b  weeklyData)-10)[
-00025e60: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00025e70: 696f 643d 3430 292e 7461 696c 2831 292e  iod=40).tail(1).
-00025e80: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-00025e90: 7265 6365 6e74 5f73 6d61 5f35 3020 3d20  recent_sma_50 = 
-00025ea0: 706b 7461 6c69 622e 534d 4128 7265 7665  pktalib.SMA(reve
-00025eb0: 7273 6564 4461 7461 5b22 436c 6f73 6522  rsedData["Close"
-00025ec0: 5d2c 7469 6d65 7065 7269 6f64 3d35 3029  ],timeperiod=50)
-00025ed0: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00025ee0: 0a20 2020 2020 2020 2077 5f77 6d61 5f38  .        w_wma_8
-00025ef0: 203d 2070 6b74 616c 6962 2e57 4d41 2877   = pktalib.WMA(w
-00025f00: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
-00025f10: 225d 2c74 696d 6570 6572 696f 643d 3829  "],timeperiod=8)
-00025f20: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00025f30: 0a20 2020 2020 2020 2077 5f73 6d61 5f38  .        w_sma_8
-00025f40: 203d 2070 6b74 616c 6962 2e53 4d41 2877   = pktalib.SMA(w
-00025f50: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
-00025f60: 225d 2c74 696d 6570 6572 696f 643d 3829  "],timeperiod=8)
-00025f70: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00025f80: 0a20 2020 2020 2020 206e 756d 5072 6576  .        numPrev
-00025f90: 696f 7573 4361 6e64 6c65 7320 3d20 3230  iousCandles = 20
-00025fa0: 0a20 2020 2020 2020 2070 756c 6c62 6163  .        pullbac
-00025fb0: 6b44 6174 6120 3d20 6461 7461 2e68 6561  kData = data.hea
-00025fc0: 6428 6e75 6d50 7265 7669 6f75 7343 616e  d(numPreviousCan
-00025fd0: 646c 6573 290a 2020 2020 2020 2020 7075  dles).        pu
-00025fe0: 6c6c 6261 636b 4461 7461 2e6c 6f63 5b3a  llbackData.loc[:
-00025ff0: 2c27 5075 6c6c 4261 636b 275d 203d 2070  ,'PullBack'] = p
-00026000: 756c 6c62 6163 6b44 6174 615b 2243 6c6f  ullbackData["Clo
-00026010: 7365 225d 2e6c 7428 7075 6c6c 6261 636b  se"].lt(pullback
-00026020: 4461 7461 5b22 4f70 656e 225d 2920 232e  Data["Open"]) #.
-00026030: 7368 6966 7428 7065 7269 6f64 733d 3129  shift(periods=1)
-00026040: 2920 2326 2064 6174 615b 224c 6f77 225d  ) #& data["Low"]
-00026050: 2e6c 7428 6461 7461 5b22 4c6f 7722 5d2e  .lt(data["Low"].
-00026060: 7368 6966 7428 7065 7269 6f64 733d 3129  shift(periods=1)
-00026070: 290a 2020 2020 2020 2020 7368 7269 6e6b  ).        shrink
-00026080: 6564 566f 6c44 6174 6120 3d20 7075 6c6c  edVolData = pull
-00026090: 6261 636b 4461 7461 5b70 756c 6c62 6163  backData[pullbac
-000260a0: 6b44 6174 615b 2250 756c 6c42 6163 6b22  kData["PullBack"
-000260b0: 5d20 3d3d 2054 7275 655d 2e68 6561 6428  ] == True].head(
-000260c0: 6e75 6d50 7265 7669 6f75 7343 616e 646c  numPreviousCandl
-000260d0: 6573 290a 2020 2020 2020 2020 7265 6365  es).        rece
-000260e0: 6e74 4c61 7267 6573 7456 6f6c 756d 6520  ntLargestVolume 
-000260f0: 3d20 6d61 7828 7075 6c6c 6261 636b 4461  = max(pullbackDa
-00026100: 7461 5b70 756c 6c62 6163 6b44 6174 615b  ta[pullbackData[
-00026110: 2250 756c 6c42 6163 6b22 5d20 3d3d 2046  "PullBack"] == F
-00026120: 616c 7365 5d2e 6865 6164 2833 295b 2256  alse].head(3)["V
-00026130: 6f6c 756d 6522 5d29 0a20 2020 2020 2020  olume"]).       
-00026140: 2023 2070 756c 6c62 6163 6b44 6174 612e   # pullbackData.
-00026150: 6c6f 635b 3a2c 2750 4256 6f6c 5261 7469  loc[:,'PBVolRati
-00026160: 6f27 5d20 3d20 7075 6c6c 6261 636b 4461  o'] = pullbackDa
-00026170: 7461 5b22 566f 6c75 6d65 225d 2f72 6563  ta["Volume"]/rec
-00026180: 656e 744c 6172 6765 7374 566f 6c75 6d65  entLargestVolume
-00026190: 0a20 2020 2020 2020 2076 6f6c 496e 5072  .        volInPr
-000261a0: 6576 696f 7573 5075 6c6c 6261 636b 7353  eviousPullbacksS
-000261b0: 6872 696e 6b65 6420 3d20 4661 6c73 650a  hrinked = False.
-000261c0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000261d0: 6872 696e 6b65 6456 6f6c 4461 7461 2e65  hrinkedVolData.e
-000261e0: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
-000261f0: 2020 696e 6465 7820 3d20 300a 2020 2020    index = 0.    
-00026200: 2020 2020 2020 2020 7768 696c 6520 696e          while in
-00026210: 6465 7820 3c20 6c65 6e28 7368 7269 6e6b  dex < len(shrink
-00026220: 6564 566f 6c44 6174 6129 3a0a 2020 2020  edVolData):.    
-00026230: 2020 2020 2020 2020 2020 2020 766f 6c49              volI
-00026240: 6e50 7265 7669 6f75 7350 756c 6c62 6163  nPreviousPullbac
-00026250: 6b73 5368 7269 6e6b 6564 203d 2073 6872  ksShrinked = shr
-00026260: 696e 6b65 6456 6f6c 4461 7461 5b22 566f  inkedVolData["Vo
-00026270: 6c75 6d65 225d 2e69 6c6f 635b 696e 6465  lume"].iloc[inde
-00026280: 785d 203c 2073 656c 662e 636f 6e66 6967  x] < self.config
-00026290: 4d61 6e61 6765 722e 7663 7056 6f6c 756d  Manager.vcpVolum
-000262a0: 6543 6f6e 7472 6163 7469 6f6e 5261 7469  eContractionRati
-000262b0: 6f20 2a20 7265 6365 6e74 4c61 7267 6573  o * recentLarges
-000262c0: 7456 6f6c 756d 650a 2020 2020 2020 2020  tVolume.        
-000262d0: 2020 2020 2020 2020 6966 206e 6f74 2076          if not v
-000262e0: 6f6c 496e 5072 6576 696f 7573 5075 6c6c  olInPreviousPull
-000262f0: 6261 636b 7353 6872 696e 6b65 643a 0a20  backsShrinked:. 
-00026300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026310: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00026320: 2020 2020 2020 2020 2069 6e64 6578 202b           index +
-00026330: 3d20 310a 2020 2020 2020 2020 7265 6365  = 1.        rece
-00026340: 6e74 566f 6c75 6d65 4861 7341 626f 7665  ntVolumeHasAbove
-00026350: 4176 6756 6f6c 203d 2072 6563 656e 744c  AvgVol = recentL
-00026360: 6172 6765 7374 566f 6c75 6d65 203e 3d20  argestVolume >= 
-00026370: 7365 6c66 2e63 6f6e 6669 674d 616e 6167  self.configManag
-00026380: 6572 2e76 6f6c 756d 6552 6174 696f 202a  er.volumeRatio *
-00026390: 2064 6174 615b 2256 6f6c 4d41 225d 2e69   data["VolMA"].i
-000263a0: 6c6f 635b 305d 0a20 2020 2020 2020 2069  loc[0].        i
-000263b0: 7356 4350 203d 2077 5f65 6d61 5f31 3320  sVCP = w_ema_13 
-000263c0: 3e20 775f 656d 615f 3236 2061 6e64 205c  > w_ema_26 and \
-000263d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000263e0: 2077 5f65 6d61 5f32 3620 3e20 775f 736d   w_ema_26 > w_sm
-000263f0: 615f 3530 2061 6e64 205c 0a20 2020 2020  a_50 and \.     
-00026400: 2020 2020 2020 2020 2020 2077 5f73 6d61             w_sma
-00026410: 5f34 3020 3e20 775f 736d 615f 3430 5f35  _40 > w_sma_40_5
-00026420: 775f 6167 6f20 616e 6420 5c0a 2020 2020  w_ago and \.    
-00026430: 2020 2020 2020 2020 2020 2020 7265 6365              rece
-00026440: 6e74 5f63 6c6f 7365 203e 3d20 775f 6d69  nt_close >= w_mi
-00026450: 6e5f 3530 2061 6e64 205c 0a20 2020 2020  n_50 and \.     
-00026460: 2020 2020 2020 2020 2020 2072 6563 656e             recen
-00026470: 745f 636c 6f73 6520 3e3d 2077 5f6d 6178  t_close >= w_max
-00026480: 5f35 3020 616e 6420 5c0a 2020 2020 2020  _50 and \.      
-00026490: 2020 2020 2020 2020 2020 7265 6365 6e74            recent
-000264a0: 5f65 6d61 5f31 335f 3230 645f 6167 6f20  _ema_13_20d_ago 
-000264b0: 3e20 775f 656d 615f 3236 5f32 3077 5f61  > w_ema_26_20w_a
-000264c0: 676f 2061 6e64 205c 0a20 2020 2020 2020  go and \.       
-000264d0: 2020 2020 2020 2020 2077 5f73 6d61 5f34           w_sma_4
-000264e0: 305f 3577 5f61 676f 203e 2077 5f73 6d61  0_5w_ago > w_sma
-000264f0: 5f34 305f 3130 775f 6167 6f20 616e 6420  _40_10w_ago and 
-00026500: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00026510: 2020 7265 6365 6e74 5f63 6c6f 7365 203e    recent_close >
-00026520: 2072 6563 656e 745f 736d 615f 3530 2061   recent_sma_50 a
-00026530: 6e64 205c 0a20 2020 2020 2020 2020 2020  nd \.           
-00026540: 2020 2020 2028 775f 776d 615f 3820 2d20       (w_wma_8 - 
-00026550: 775f 736d 615f 3829 2a36 2f32 3920 3c20  w_sma_8)*6/29 < 
-00026560: 302e 3520 616e 6420 5c0a 2020 2020 2020  0.5 and \.      
-00026570: 2020 2020 2020 2020 2020 766f 6c49 6e50            volInP
-00026580: 7265 7669 6f75 7350 756c 6c62 6163 6b73  reviousPullbacks
-00026590: 5368 7269 6e6b 6564 2061 6e64 205c 0a20  Shrinked and \. 
-000265a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000265b0: 6563 656e 7456 6f6c 756d 6548 6173 4162  ecentVolumeHasAb
-000265c0: 6f76 6541 7667 566f 6c20 616e 6420 5c0a  oveAvgVol and \.
-000265d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000265e0: 7265 6365 6e74 5f63 6c6f 7365 203e 2031  recent_close > 1
-000265f0: 300a 2020 2020 2020 2020 6966 2069 7356  0.        if isV
-00026600: 4350 3a0a 2020 2020 2020 2020 2020 2020  CP:.            
-00026610: 7361 7665 6420 3d20 7365 6c66 2e66 696e  saved = self.fin
-00026620: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
-00026630: 7565 2873 6372 6565 6e44 6963 742c 2073  ue(screenDict, s
-00026640: 6176 6544 6963 742c 2022 5061 7474 6572  aveDict, "Patter
-00026650: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-00026660: 7363 7265 656e 4469 6374 5b22 5061 7474  screenDict["Patt
-00026670: 6572 6e22 5d20 3d20 280a 2020 2020 2020  ern"] = (.      
-00026680: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-00026690: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-000266a0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-000266b0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-000266c0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-000266d0: 2e47 5245 454e 0a20 2020 2020 2020 2020  .GREEN.         
-000266e0: 2020 2020 2020 202b 2066 2256 4350 284d         + f"VCP(M
-000266f0: 696e 6572 7669 6e69 2922 0a20 2020 2020  inervini)".     
-00026700: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-00026710: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00026720: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00026730: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
-00026740: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-00026750: 5b31 5d20 2b20 6622 5643 5028 4d69 6e65  [1] + f"VCP(Mine
-00026760: 7276 696e 6929 220a 2020 2020 2020 2020  rvini)".        
-00026770: 7265 7475 726e 2069 7356 4350 0a20 2020  return isVCP.   
-00026780: 200a 2020 2020 2320 5661 6c69 6461 7465   .    # Validate
-00026790: 2056 4350 0a20 2020 2064 6566 2076 616c   VCP.    def val
-000267a0: 6964 6174 6556 4350 280a 2020 2020 2020  idateVCP(.      
-000267b0: 2020 7365 6c66 2c20 6466 2c20 7363 7265    self, df, scre
-000267c0: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-000267d0: 2c20 7374 6f63 6b4e 616d 653d 4e6f 6e65  , stockName=None
-000267e0: 2c20 7769 6e64 6f77 3d33 2c20 7065 7263  , window=3, perc
-000267f0: 656e 7461 6765 4672 6f6d 546f 703d 330a  entageFromTop=3.
-00026800: 2020 2020 293a 0a20 2020 2020 2020 2069      ):.        i
-00026810: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-00026820: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-00026830: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00026840: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-00026850: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-00026860: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00026870: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
-00026880: 6167 6546 726f 6d54 6f70 202f 3d20 3130  ageFromTop /= 10
-00026890: 300a 2020 2020 2020 2020 2020 2020 6461  0.            da
-000268a0: 7461 2e72 6573 6574 5f69 6e64 6578 2869  ta.reset_index(i
-000268b0: 6e70 6c61 6365 3d54 7275 6529 0a20 2020  nplace=True).   
-000268c0: 2020 2020 2020 2020 2064 6174 612e 7265           data.re
-000268d0: 6e61 6d65 2863 6f6c 756d 6e73 3d7b 2269  name(columns={"i
-000268e0: 6e64 6578 223a 2022 4461 7465 227d 2c20  ndex": "Date"}, 
-000268f0: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
-00026900: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-00026910: 746f 7073 225d 203d 2028 6461 7461 5b22  tops"] = (data["
-00026920: 4869 6768 225d 2e69 6c6f 635b 6c69 7374  High"].iloc[list
-00026930: 2870 6b74 616c 6962 2e61 7267 7265 6c65  (pktalib.argrele
-00026940: 7874 7265 6d61 286e 702e 6172 7261 7928  xtrema(np.array(
-00026950: 6461 7461 5b22 4869 6768 225d 292c 206e  data["High"]), n
-00026960: 702e 6772 6561 7465 725f 6571 7561 6c2c  p.greater_equal,
-00026970: 206f 7264 6572 3d77 696e 646f 7729 5b30   order=window)[0
-00026980: 5d29 5d2e 6865 6164 2834 2929 0a20 2020  ])].head(4)).   
-00026990: 2020 2020 2020 2020 2064 6174 615b 2262           data["b
-000269a0: 6f74 7322 5d20 3d20 2864 6174 615b 224c  ots"] = (data["L
-000269b0: 6f77 225d 2e69 6c6f 635b 6c69 7374 2870  ow"].iloc[list(p
-000269c0: 6b74 616c 6962 2e61 7267 7265 6c65 7874  ktalib.argrelext
-000269d0: 7265 6d61 286e 702e 6172 7261 7928 6461  rema(np.array(da
-000269e0: 7461 5b22 4c6f 7722 5d29 2c20 6e70 2e6c  ta["Low"]), np.l
-000269f0: 6573 735f 6571 7561 6c2c 206f 7264 6572  ess_equal, order
-00026a00: 3d77 696e 646f 7729 5b30 5d29 5d2e 6865  =window)[0])].he
-00026a10: 6164 2834 2929 0a20 2020 2020 2020 2020  ad(4)).         
-00026a20: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
-00026a30: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
-00026a40: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-00026a50: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
-00026a60: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
-00026a70: 2020 2020 2020 2020 2020 2074 6f70 7320             tops 
-00026a80: 3d20 6461 7461 5b64 6174 612e 746f 7073  = data[data.tops
-00026a90: 203e 2030 5d0a 2020 2020 2020 2020 2020   > 0].          
-00026aa0: 2020 2320 626f 7473 203d 2064 6174 615b    # bots = data[
-00026ab0: 6461 7461 2e62 6f74 7320 3e20 305d 0a20  data.bots > 0]. 
-00026ac0: 2020 2020 2020 2020 2020 2068 6967 6865             highe
-00026ad0: 7374 546f 7020 3d20 726f 756e 6428 746f  stTop = round(to
-00026ae0: 7073 2e64 6573 6372 6962 6528 295b 2248  ps.describe()["H
-00026af0: 6967 6822 5d5b 226d 6178 225d 2c20 3129  igh"]["max"], 1)
-00026b00: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00026b10: 7465 7265 6454 6f70 7320 3d20 746f 7073  teredTops = tops
-00026b20: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00026b30: 2020 746f 7073 2e74 6f70 7320 3e20 2868    tops.tops > (h
-00026b40: 6967 6865 7374 546f 7020 2d20 2868 6967  ighestTop - (hig
-00026b50: 6865 7374 546f 7020 2a20 7065 7263 656e  hestTop * percen
-00026b60: 7461 6765 4672 6f6d 546f 7029 290a 2020  tageFromTop)).  
-00026b70: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00026b80: 2020 2020 2020 2020 6966 2066 696c 7465          if filte
-00026b90: 7265 6454 6f70 732e 6571 7561 6c73 2874  redTops.equals(t
-00026ba0: 6f70 7329 3a20 2023 2054 6f70 7320 6172  ops):  # Tops ar
-00026bb0: 6520 696e 2074 6865 2072 616e 6765 0a20  e in the range. 
-00026bc0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00026bd0: 6f77 506f 696e 7473 203d 205b 5d0a 2020  owPoints = [].  
-00026be0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00026bf0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-00026c00: 2874 6f70 7329 202d 2031 293a 0a20 2020  (tops) - 1):.   
-00026c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026c20: 2065 6e64 4461 7465 203d 2074 6f70 732e   endDate = tops.
-00026c30: 696c 6f63 5b69 5d5b 2244 6174 6522 5d0a  iloc[i]["Date"].
-00026c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026c50: 2020 2020 7374 6172 7444 6174 6520 3d20      startDate = 
-00026c60: 746f 7073 2e69 6c6f 635b 6920 2b20 315d  tops.iloc[i + 1]
-00026c70: 5b22 4461 7465 225d 0a20 2020 2020 2020  ["Date"].       
-00026c80: 2020 2020 2020 2020 2020 2020 206c 6f77               low
-00026c90: 506f 696e 7473 2e61 7070 656e 6428 0a20  Points.append(. 
-00026ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026cb0: 2020 2020 2020 2064 6174 615b 0a20 2020         data[.   
+00025770: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
+00025780: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+00025790: 4420 2b20 636f 6c6f 7254 6578 742e 4752  D + colorText.GR
+000257a0: 4545 4e20 2b20 2242 756c 6c69 7368 2220  EEN + "Bullish" 
+000257b0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+000257c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000257e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257f0: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
+00025800: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
+00025810: 315d 202b 2022 4275 6c6c 6973 6822 0a20  1] + "Bullish". 
+00025820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025830: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00025840: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+00025850: 6e20 4661 6c73 650a 2020 2020 0a20 2020  n False.    .   
+00025860: 2023 2056 616c 6964 6174 6520 5643 5020   # Validate VCP 
+00025870: 6173 2070 6572 204d 6172 6b20 4d69 6e65  as per Mark Mine
+00025880: 7276 696e 690a 2020 2020 2320 6874 7470  rvini.    # http
+00025890: 733a 2f2f 6368 6172 7469 6e6b 2e63 6f6d  s://chartink.com
+000258a0: 2f73 6372 6565 6e65 722f 766f 6c61 7469  /screener/volati
+000258b0: 6c69 7479 2d63 6f6d 7072 6573 7369 6f6e  lity-compression
+000258c0: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
+000258d0: 6556 4350 4d61 726b 4d69 6e65 7276 696e  eVCPMarkMinervin
+000258e0: 6928 7365 6c66 2c20 6466 3a70 642e 4461  i(self, df:pd.Da
+000258f0: 7461 4672 616d 652c 2073 6372 6565 6e44  taFrame, screenD
+00025900: 6963 742c 2073 6176 6544 6963 7429 3a0a  ict, saveDict):.
+00025910: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00025920: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+00025930: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00025940: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00025950: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00025960: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+00025970: 206f 686c 635f 6469 6374 203d 207b 0a20   ohlc_dict = {. 
+00025980: 2020 2020 2020 2020 2020 2027 4f70 656e             'Open
+00025990: 273a 2766 6972 7374 272c 0a20 2020 2020  ':'first',.     
+000259a0: 2020 2020 2020 2027 4869 6768 273a 276d         'High':'m
+000259b0: 6178 272c 0a20 2020 2020 2020 2020 2020  ax',.           
+000259c0: 2027 4c6f 7727 3a27 6d69 6e27 2c0a 2020   'Low':'min',.  
+000259d0: 2020 2020 2020 2020 2020 2743 6c6f 7365            'Close
+000259e0: 273a 276c 6173 7427 2c0a 2020 2020 2020  ':'last',.      
+000259f0: 2020 2020 2020 2756 6f6c 756d 6527 3a27        'Volume':'
+00025a00: 7375 6d27 0a20 2020 2020 2020 207d 0a20  sum'.        }. 
+00025a10: 2020 2020 2020 2023 2066 696e 616c 5f64         # final_d
+00025a20: 6620 3d20 6466 2e72 6573 616d 706c 6528  f = df.resample(
+00025a30: 2757 2d46 5249 272c 2063 6c6f 7365 643d  'W-FRI', closed=
+00025a40: 276c 6566 7427 292e 6167 6728 6f68 6c63  'left').agg(ohlc
+00025a50: 5f64 6963 7429 2e73 6869 6674 2827 3164  _dict).shift('1d
+00025a60: 2729 0a20 2020 2020 2020 2077 6565 6b6c  ').        weekl
+00025a70: 7944 6174 6120 3d20 6461 7461 2e72 6573  yData = data.res
+00025a80: 616d 706c 6528 2757 2729 2e61 6767 286f  ample('W').agg(o
+00025a90: 686c 635f 6469 6374 290a 2020 2020 2020  hlc_dict).      
+00025aa0: 2020 7265 7665 7273 6564 4461 7461 203d    reversedData =
+00025ab0: 2064 6174 615b 3a3a 2d31 5d20 2023 2052   data[::-1]  # R
+00025ac0: 6576 6572 7365 2074 6865 2064 6174 6166  everse the dataf
+00025ad0: 7261 6d65 0a20 2020 2020 2020 2072 6563  rame.        rec
+00025ae0: 656e 745f 636c 6f73 6520 3d20 6461 7461  ent_close = data
+00025af0: 5b22 436c 6f73 6522 5d2e 6865 6164 2831  ["Close"].head(1
+00025b00: 292e 696c 6f63 5b30 5d0a 2020 2020 2020  ).iloc[0].      
+00025b10: 2020 775f 656d 615f 3133 203d 2070 6b74    w_ema_13 = pkt
+00025b20: 616c 6962 2e45 4d41 2877 6565 6b6c 7944  alib.EMA(weeklyD
+00025b30: 6174 615b 2243 6c6f 7365 225d 2c74 696d  ata["Close"],tim
+00025b40: 6570 6572 696f 643d 3133 292e 7461 696c  eperiod=13).tail
+00025b50: 2831 292e 696c 6f63 5b30 5d0a 2020 2020  (1).iloc[0].    
+00025b60: 2020 2020 775f 656d 615f 3236 203d 2070      w_ema_26 = p
+00025b70: 6b74 616c 6962 2e45 4d41 2877 6565 6b6c  ktalib.EMA(weekl
+00025b80: 7944 6174 615b 2243 6c6f 7365 225d 2c74  yData["Close"],t
+00025b90: 696d 6570 6572 696f 643d 3236 292e 7461  imeperiod=26).ta
+00025ba0: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
+00025bb0: 2020 2020 2020 775f 736d 615f 3530 203d        w_sma_50 =
+00025bc0: 2070 6b74 616c 6962 2e53 4d41 2877 6565   pktalib.SMA(wee
+00025bd0: 6b6c 7944 6174 615b 2243 6c6f 7365 225d  klyData["Close"]
+00025be0: 2c74 696d 6570 6572 696f 643d 3530 292e  ,timeperiod=50).
+00025bf0: 7461 696c 2831 292e 696c 6f63 5b30 5d0a  tail(1).iloc[0].
+00025c00: 2020 2020 2020 2020 775f 736d 615f 3430          w_sma_40
+00025c10: 203d 2070 6b74 616c 6962 2e53 4d41 2877   = pktalib.SMA(w
+00025c20: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
+00025c30: 225d 2c74 696d 6570 6572 696f 643d 3430  "],timeperiod=40
+00025c40: 292e 7461 696c 2831 292e 696c 6f63 5b30  ).tail(1).iloc[0
+00025c50: 5d0a 2020 2020 2020 2020 775f 736d 615f  ].        w_sma_
+00025c60: 3430 5f35 775f 6167 6f20 3d20 706b 7461  40_5w_ago = pkta
+00025c70: 6c69 622e 534d 4128 7765 656b 6c79 4461  lib.SMA(weeklyDa
+00025c80: 7461 2e68 6561 6428 6c65 6e28 7765 656b  ta.head(len(week
+00025c90: 6c79 4461 7461 292d 3529 5b22 436c 6f73  lyData)-5)["Clos
+00025ca0: 6522 5d2c 7469 6d65 7065 7269 6f64 3d34  e"],timeperiod=4
+00025cb0: 3029 2e74 6169 6c28 3129 2e69 6c6f 635b  0).tail(1).iloc[
+00025cc0: 305d 0a20 2020 2020 2020 2077 5f6d 696e  0].        w_min
+00025cd0: 5f35 3020 3d20 6d69 6e28 312e 332a 7765  _50 = min(1.3*we
+00025ce0: 656b 6c79 4461 7461 2e74 6169 6c28 3530  eklyData.tail(50
+00025cf0: 295b 224c 6f77 225d 290a 2020 2020 2020  )["Low"]).      
+00025d00: 2020 775f 6d61 785f 3530 203d 206d 6178    w_max_50 = max
+00025d10: 2830 2e37 352a 7765 656b 6c79 4461 7461  (0.75*weeklyData
+00025d20: 2e74 6169 6c28 3530 295b 2248 6967 6822  .tail(50)["High"
+00025d30: 5d29 0a20 2020 2020 2020 2077 5f65 6d61  ]).        w_ema
+00025d40: 5f32 365f 3230 775f 6167 6f20 3d20 706b  _26_20w_ago = pk
+00025d50: 7461 6c69 622e 454d 4128 7765 656b 6c79  talib.EMA(weekly
+00025d60: 4461 7461 2e68 6561 6428 6c65 6e28 7765  Data.head(len(we
+00025d70: 656b 6c79 4461 7461 292d 3230 295b 2243  eklyData)-20)["C
+00025d80: 6c6f 7365 225d 2c74 696d 6570 6572 696f  lose"],timeperio
+00025d90: 643d 3236 292e 7461 696c 2831 292e 696c  d=26).tail(1).il
+00025da0: 6f63 5b30 5d0a 2020 2020 2020 2020 7265  oc[0].        re
+00025db0: 6365 6e74 5f65 6d61 5f31 335f 3230 645f  cent_ema_13_20d_
+00025dc0: 6167 6f20 3d20 706b 7461 6c69 622e 454d  ago = pktalib.EM
+00025dd0: 4128 7265 7665 7273 6564 4461 7461 2e68  A(reversedData.h
+00025de0: 6561 6428 6c65 6e28 7265 7665 7273 6564  ead(len(reversed
+00025df0: 4461 7461 292d 3230 295b 2243 6c6f 7365  Data)-20)["Close
+00025e00: 225d 2c74 696d 6570 6572 696f 643d 3133  "],timeperiod=13
+00025e10: 292e 7461 696c 2831 292e 696c 6f63 5b30  ).tail(1).iloc[0
+00025e20: 5d0a 2020 2020 2020 2020 775f 736d 615f  ].        w_sma_
+00025e30: 3430 5f35 775f 6167 6f20 3d20 706b 7461  40_5w_ago = pkta
+00025e40: 6c69 622e 534d 4128 7765 656b 6c79 4461  lib.SMA(weeklyDa
+00025e50: 7461 2e68 6561 6428 6c65 6e28 7765 656b  ta.head(len(week
+00025e60: 6c79 4461 7461 292d 3529 5b22 436c 6f73  lyData)-5)["Clos
+00025e70: 6522 5d2c 7469 6d65 7065 7269 6f64 3d34  e"],timeperiod=4
+00025e80: 3029 2e74 6169 6c28 3129 2e69 6c6f 635b  0).tail(1).iloc[
+00025e90: 305d 0a20 2020 2020 2020 2077 5f73 6d61  0].        w_sma
+00025ea0: 5f34 305f 3130 775f 6167 6f20 3d20 706b  _40_10w_ago = pk
+00025eb0: 7461 6c69 622e 534d 4128 7765 656b 6c79  talib.SMA(weekly
+00025ec0: 4461 7461 2e68 6561 6428 6c65 6e28 7765  Data.head(len(we
+00025ed0: 656b 6c79 4461 7461 292d 3130 295b 2243  eklyData)-10)["C
+00025ee0: 6c6f 7365 225d 2c74 696d 6570 6572 696f  lose"],timeperio
+00025ef0: 643d 3430 292e 7461 696c 2831 292e 696c  d=40).tail(1).il
+00025f00: 6f63 5b30 5d0a 2020 2020 2020 2020 7265  oc[0].        re
+00025f10: 6365 6e74 5f73 6d61 5f35 3020 3d20 706b  cent_sma_50 = pk
+00025f20: 7461 6c69 622e 534d 4128 7265 7665 7273  talib.SMA(revers
+00025f30: 6564 4461 7461 5b22 436c 6f73 6522 5d2c  edData["Close"],
+00025f40: 7469 6d65 7065 7269 6f64 3d35 3029 2e74  timeperiod=50).t
+00025f50: 6169 6c28 3129 2e69 6c6f 635b 305d 0a20  ail(1).iloc[0]. 
+00025f60: 2020 2020 2020 2077 5f77 6d61 5f38 203d         w_wma_8 =
+00025f70: 2070 6b74 616c 6962 2e57 4d41 2877 6565   pktalib.WMA(wee
+00025f80: 6b6c 7944 6174 615b 2243 6c6f 7365 225d  klyData["Close"]
+00025f90: 2c74 696d 6570 6572 696f 643d 3829 2e74  ,timeperiod=8).t
+00025fa0: 6169 6c28 3129 2e69 6c6f 635b 305d 0a20  ail(1).iloc[0]. 
+00025fb0: 2020 2020 2020 2077 5f73 6d61 5f38 203d         w_sma_8 =
+00025fc0: 2070 6b74 616c 6962 2e53 4d41 2877 6565   pktalib.SMA(wee
+00025fd0: 6b6c 7944 6174 615b 2243 6c6f 7365 225d  klyData["Close"]
+00025fe0: 2c74 696d 6570 6572 696f 643d 3829 2e74  ,timeperiod=8).t
+00025ff0: 6169 6c28 3129 2e69 6c6f 635b 305d 0a20  ail(1).iloc[0]. 
+00026000: 2020 2020 2020 206e 756d 5072 6576 696f         numPrevio
+00026010: 7573 4361 6e64 6c65 7320 3d20 3230 0a20  usCandles = 20. 
+00026020: 2020 2020 2020 2070 756c 6c62 6163 6b44         pullbackD
+00026030: 6174 6120 3d20 6461 7461 2e68 6561 6428  ata = data.head(
+00026040: 6e75 6d50 7265 7669 6f75 7343 616e 646c  numPreviousCandl
+00026050: 6573 290a 2020 2020 2020 2020 7075 6c6c  es).        pull
+00026060: 6261 636b 4461 7461 2e6c 6f63 5b3a 2c27  backData.loc[:,'
+00026070: 5075 6c6c 4261 636b 275d 203d 2070 756c  PullBack'] = pul
+00026080: 6c62 6163 6b44 6174 615b 2243 6c6f 7365  lbackData["Close
+00026090: 225d 2e6c 7428 7075 6c6c 6261 636b 4461  "].lt(pullbackDa
+000260a0: 7461 5b22 4f70 656e 225d 2920 232e 7368  ta["Open"]) #.sh
+000260b0: 6966 7428 7065 7269 6f64 733d 3129 2920  ift(periods=1)) 
+000260c0: 2326 2064 6174 615b 224c 6f77 225d 2e6c  #& data["Low"].l
+000260d0: 7428 6461 7461 5b22 4c6f 7722 5d2e 7368  t(data["Low"].sh
+000260e0: 6966 7428 7065 7269 6f64 733d 3129 290a  ift(periods=1)).
+000260f0: 2020 2020 2020 2020 7368 7269 6e6b 6564          shrinked
+00026100: 566f 6c44 6174 6120 3d20 7075 6c6c 6261  VolData = pullba
+00026110: 636b 4461 7461 5b70 756c 6c62 6163 6b44  ckData[pullbackD
+00026120: 6174 615b 2250 756c 6c42 6163 6b22 5d20  ata["PullBack"] 
+00026130: 3d3d 2054 7275 655d 2e68 6561 6428 6e75  == True].head(nu
+00026140: 6d50 7265 7669 6f75 7343 616e 646c 6573  mPreviousCandles
+00026150: 290a 2020 2020 2020 2020 7265 6365 6e74  ).        recent
+00026160: 4c61 7267 6573 7456 6f6c 756d 6520 3d20  LargestVolume = 
+00026170: 6d61 7828 7075 6c6c 6261 636b 4461 7461  max(pullbackData
+00026180: 5b70 756c 6c62 6163 6b44 6174 615b 2250  [pullbackData["P
+00026190: 756c 6c42 6163 6b22 5d20 3d3d 2046 616c  ullBack"] == Fal
+000261a0: 7365 5d2e 6865 6164 2833 295b 2256 6f6c  se].head(3)["Vol
+000261b0: 756d 6522 5d29 0a20 2020 2020 2020 2023  ume"]).        #
+000261c0: 2070 756c 6c62 6163 6b44 6174 612e 6c6f   pullbackData.lo
+000261d0: 635b 3a2c 2750 4256 6f6c 5261 7469 6f27  c[:,'PBVolRatio'
+000261e0: 5d20 3d20 7075 6c6c 6261 636b 4461 7461  ] = pullbackData
+000261f0: 5b22 566f 6c75 6d65 225d 2f72 6563 656e  ["Volume"]/recen
+00026200: 744c 6172 6765 7374 566f 6c75 6d65 0a20  tLargestVolume. 
+00026210: 2020 2020 2020 2076 6f6c 496e 5072 6576         volInPrev
+00026220: 696f 7573 5075 6c6c 6261 636b 7353 6872  iousPullbacksShr
+00026230: 696e 6b65 6420 3d20 4661 6c73 650a 2020  inked = False.  
+00026240: 2020 2020 2020 6966 206e 6f74 2073 6872        if not shr
+00026250: 696e 6b65 6456 6f6c 4461 7461 2e65 6d70  inkedVolData.emp
+00026260: 7479 3a0a 2020 2020 2020 2020 2020 2020  ty:.            
+00026270: 696e 6465 7820 3d20 300a 2020 2020 2020  index = 0.      
+00026280: 2020 2020 2020 7768 696c 6520 696e 6465        while inde
+00026290: 7820 3c20 6c65 6e28 7368 7269 6e6b 6564  x < len(shrinked
+000262a0: 566f 6c44 6174 6129 3a0a 2020 2020 2020  VolData):.      
+000262b0: 2020 2020 2020 2020 2020 766f 6c49 6e50            volInP
+000262c0: 7265 7669 6f75 7350 756c 6c62 6163 6b73  reviousPullbacks
+000262d0: 5368 7269 6e6b 6564 203d 2073 6872 696e  Shrinked = shrin
+000262e0: 6b65 6456 6f6c 4461 7461 5b22 566f 6c75  kedVolData["Volu
+000262f0: 6d65 225d 2e69 6c6f 635b 696e 6465 785d  me"].iloc[index]
+00026300: 203c 2073 656c 662e 636f 6e66 6967 4d61   < self.configMa
+00026310: 6e61 6765 722e 7663 7056 6f6c 756d 6543  nager.vcpVolumeC
+00026320: 6f6e 7472 6163 7469 6f6e 5261 7469 6f20  ontractionRatio 
+00026330: 2a20 7265 6365 6e74 4c61 7267 6573 7456  * recentLargestV
+00026340: 6f6c 756d 650a 2020 2020 2020 2020 2020  olume.          
+00026350: 2020 2020 2020 6966 206e 6f74 2076 6f6c        if not vol
+00026360: 496e 5072 6576 696f 7573 5075 6c6c 6261  InPreviousPullba
+00026370: 636b 7353 6872 696e 6b65 643a 0a20 2020  cksShrinked:.   
+00026380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026390: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+000263a0: 2020 2020 2020 2069 6e64 6578 202b 3d20         index += 
+000263b0: 310a 2020 2020 2020 2020 7265 6365 6e74  1.        recent
+000263c0: 566f 6c75 6d65 4861 7341 626f 7665 4176  VolumeHasAboveAv
+000263d0: 6756 6f6c 203d 2072 6563 656e 744c 6172  gVol = recentLar
+000263e0: 6765 7374 566f 6c75 6d65 203e 3d20 7365  gestVolume >= se
+000263f0: 6c66 2e63 6f6e 6669 674d 616e 6167 6572  lf.configManager
+00026400: 2e76 6f6c 756d 6552 6174 696f 202a 2064  .volumeRatio * d
+00026410: 6174 615b 2256 6f6c 4d41 225d 2e69 6c6f  ata["VolMA"].ilo
+00026420: 635b 305d 0a20 2020 2020 2020 2069 7356  c[0].        isV
+00026430: 4350 203d 2077 5f65 6d61 5f31 3320 3e20  CP = w_ema_13 > 
+00026440: 775f 656d 615f 3236 2061 6e64 205c 0a20  w_ema_26 and \. 
+00026450: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00026460: 5f65 6d61 5f32 3620 3e20 775f 736d 615f  _ema_26 > w_sma_
+00026470: 3530 2061 6e64 205c 0a20 2020 2020 2020  50 and \.       
+00026480: 2020 2020 2020 2020 2077 5f73 6d61 5f34           w_sma_4
+00026490: 3020 3e20 775f 736d 615f 3430 5f35 775f  0 > w_sma_40_5w_
+000264a0: 6167 6f20 616e 6420 5c0a 2020 2020 2020  ago and \.      
+000264b0: 2020 2020 2020 2020 2020 7265 6365 6e74            recent
+000264c0: 5f63 6c6f 7365 203e 3d20 775f 6d69 6e5f  _close >= w_min_
+000264d0: 3530 2061 6e64 205c 0a20 2020 2020 2020  50 and \.       
+000264e0: 2020 2020 2020 2020 2072 6563 656e 745f           recent_
+000264f0: 636c 6f73 6520 3e3d 2077 5f6d 6178 5f35  close >= w_max_5
+00026500: 3020 616e 6420 5c0a 2020 2020 2020 2020  0 and \.        
+00026510: 2020 2020 2020 2020 7265 6365 6e74 5f65          recent_e
+00026520: 6d61 5f31 335f 3230 645f 6167 6f20 3e20  ma_13_20d_ago > 
+00026530: 775f 656d 615f 3236 5f32 3077 5f61 676f  w_ema_26_20w_ago
+00026540: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+00026550: 2020 2020 2020 2077 5f73 6d61 5f34 305f         w_sma_40_
+00026560: 3577 5f61 676f 203e 2077 5f73 6d61 5f34  5w_ago > w_sma_4
+00026570: 305f 3130 775f 6167 6f20 616e 6420 5c0a  0_10w_ago and \.
+00026580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026590: 7265 6365 6e74 5f63 6c6f 7365 203e 2072  recent_close > r
+000265a0: 6563 656e 745f 736d 615f 3530 2061 6e64  ecent_sma_50 and
+000265b0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+000265c0: 2020 2028 775f 776d 615f 3820 2d20 775f     (w_wma_8 - w_
+000265d0: 736d 615f 3829 2a36 2f32 3920 3c20 302e  sma_8)*6/29 < 0.
+000265e0: 3520 616e 6420 5c0a 2020 2020 2020 2020  5 and \.        
+000265f0: 2020 2020 2020 2020 766f 6c49 6e50 7265          volInPre
+00026600: 7669 6f75 7350 756c 6c62 6163 6b73 5368  viousPullbacksSh
+00026610: 7269 6e6b 6564 2061 6e64 205c 0a20 2020  rinked and \.   
+00026620: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00026630: 656e 7456 6f6c 756d 6548 6173 4162 6f76  entVolumeHasAbov
+00026640: 6541 7667 566f 6c20 616e 6420 5c0a 2020  eAvgVol and \.  
+00026650: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00026660: 6365 6e74 5f63 6c6f 7365 203e 2031 300a  cent_close > 10.
+00026670: 2020 2020 2020 2020 6966 2069 7356 4350          if isVCP
+00026680: 3a0a 2020 2020 2020 2020 2020 2020 7361  :.            sa
+00026690: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+000266a0: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+000266b0: 2873 6372 6565 6e44 6963 742c 2073 6176  (screenDict, sav
+000266c0: 6544 6963 742c 2022 5061 7474 6572 6e22  eDict, "Pattern"
+000266d0: 290a 2020 2020 2020 2020 2020 2020 7363  ).            sc
+000266e0: 7265 656e 4469 6374 5b22 5061 7474 6572  reenDict["Patter
+000266f0: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
+00026700: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
+00026710: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00026720: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+00026730: 4c44 0a20 2020 2020 2020 2020 2020 2020  LD.             
+00026740: 2020 202b 2063 6f6c 6f72 5465 7874 2e47     + colorText.G
+00026750: 5245 454e 0a20 2020 2020 2020 2020 2020  REEN.           
+00026760: 2020 2020 202b 2066 2256 4350 284d 696e       + f"VCP(Min
+00026770: 6572 7669 6e69 2922 0a20 2020 2020 2020  ervini)".       
+00026780: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+00026790: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+000267a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000267b0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+000267c0: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
+000267d0: 5d20 2b20 6622 5643 5028 4d69 6e65 7276  ] + f"VCP(Minerv
+000267e0: 696e 6929 220a 2020 2020 2020 2020 7265  ini)".        re
+000267f0: 7475 726e 2069 7356 4350 0a20 2020 200a  turn isVCP.    .
+00026800: 2020 2020 2320 5661 6c69 6461 7465 2056      # Validate V
+00026810: 4350 0a20 2020 2064 6566 2076 616c 6964  CP.    def valid
+00026820: 6174 6556 4350 280a 2020 2020 2020 2020  ateVCP(.        
+00026830: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+00026840: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+00026850: 7374 6f63 6b4e 616d 653d 4e6f 6e65 2c20  stockName=None, 
+00026860: 7769 6e64 6f77 3d33 2c20 7065 7263 656e  window=3, percen
+00026870: 7461 6765 4672 6f6d 546f 703d 330a 2020  tageFromTop=3.  
+00026880: 2020 293a 0a20 2020 2020 2020 2069 6620    ):.        if 
+00026890: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+000268a0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+000268b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000268c0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+000268d0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+000268e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000268f0: 2020 2020 2020 2070 6572 6365 6e74 6167         percentag
+00026900: 6546 726f 6d54 6f70 202f 3d20 3130 300a  eFromTop /= 100.
+00026910: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00026920: 2e72 6573 6574 5f69 6e64 6578 2869 6e70  .reset_index(inp
+00026930: 6c61 6365 3d54 7275 6529 0a20 2020 2020  lace=True).     
+00026940: 2020 2020 2020 2064 6174 612e 7265 6e61         data.rena
+00026950: 6d65 2863 6f6c 756d 6e73 3d7b 2269 6e64  me(columns={"ind
+00026960: 6578 223a 2022 4461 7465 227d 2c20 696e  ex": "Date"}, in
+00026970: 706c 6163 653d 5472 7565 290a 2020 2020  place=True).    
+00026980: 2020 2020 2020 2020 6461 7461 5b22 746f          data["to
+00026990: 7073 225d 203d 2028 6461 7461 5b22 4869  ps"] = (data["Hi
+000269a0: 6768 225d 2e69 6c6f 635b 6c69 7374 2870  gh"].iloc[list(p
+000269b0: 6b74 616c 6962 2e61 7267 7265 6c65 7874  ktalib.argrelext
+000269c0: 7265 6d61 286e 702e 6172 7261 7928 6461  rema(np.array(da
+000269d0: 7461 5b22 4869 6768 225d 292c 206e 702e  ta["High"]), np.
+000269e0: 6772 6561 7465 725f 6571 7561 6c2c 206f  greater_equal, o
+000269f0: 7264 6572 3d77 696e 646f 7729 5b30 5d29  rder=window)[0])
+00026a00: 5d2e 6865 6164 2834 2929 0a20 2020 2020  ].head(4)).     
+00026a10: 2020 2020 2020 2064 6174 615b 2262 6f74         data["bot
+00026a20: 7322 5d20 3d20 2864 6174 615b 224c 6f77  s"] = (data["Low
+00026a30: 225d 2e69 6c6f 635b 6c69 7374 2870 6b74  "].iloc[list(pkt
+00026a40: 616c 6962 2e61 7267 7265 6c65 7874 7265  alib.argrelextre
+00026a50: 6d61 286e 702e 6172 7261 7928 6461 7461  ma(np.array(data
+00026a60: 5b22 4c6f 7722 5d29 2c20 6e70 2e6c 6573  ["Low"]), np.les
+00026a70: 735f 6571 7561 6c2c 206f 7264 6572 3d77  s_equal, order=w
+00026a80: 696e 646f 7729 5b30 5d29 5d2e 6865 6164  indow)[0])].head
+00026a90: 2834 2929 0a20 2020 2020 2020 2020 2020  (4)).           
+00026aa0: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+00026ab0: 6c6e 6128 3029 0a20 2020 2020 2020 2020  lna(0).         
+00026ac0: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
+00026ad0: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
+00026ae0: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
+00026af0: 2020 2020 2020 2020 2074 6f70 7320 3d20           tops = 
+00026b00: 6461 7461 5b64 6174 612e 746f 7073 203e  data[data.tops >
+00026b10: 2030 5d0a 2020 2020 2020 2020 2020 2020   0].            
+00026b20: 2320 626f 7473 203d 2064 6174 615b 6461  # bots = data[da
+00026b30: 7461 2e62 6f74 7320 3e20 305d 0a20 2020  ta.bots > 0].   
+00026b40: 2020 2020 2020 2020 2068 6967 6865 7374           highest
+00026b50: 546f 7020 3d20 726f 756e 6428 746f 7073  Top = round(tops
+00026b60: 2e64 6573 6372 6962 6528 295b 2248 6967  .describe()["Hig
+00026b70: 6822 5d5b 226d 6178 225d 2c20 3129 0a20  h"]["max"], 1). 
+00026b80: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+00026b90: 7265 6454 6f70 7320 3d20 746f 7073 5b0a  redTops = tops[.
+00026ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026bb0: 746f 7073 2e74 6f70 7320 3e20 2868 6967  tops.tops > (hig
+00026bc0: 6865 7374 546f 7020 2d20 2868 6967 6865  hestTop - (highe
+00026bd0: 7374 546f 7020 2a20 7065 7263 656e 7461  stTop * percenta
+00026be0: 6765 4672 6f6d 546f 7029 290a 2020 2020  geFromTop)).    
+00026bf0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+00026c00: 2020 2020 2020 6966 2066 696c 7465 7265        if filtere
+00026c10: 6454 6f70 732e 6571 7561 6c73 2874 6f70  dTops.equals(top
+00026c20: 7329 3a20 2023 2054 6f70 7320 6172 6520  s):  # Tops are 
+00026c30: 696e 2074 6865 2072 616e 6765 0a20 2020  in the range.   
+00026c40: 2020 2020 2020 2020 2020 2020 206c 6f77               low
+00026c50: 506f 696e 7473 203d 205b 5d0a 2020 2020  Points = [].    
+00026c60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00026c70: 6920 696e 2072 616e 6765 286c 656e 2874  i in range(len(t
+00026c80: 6f70 7329 202d 2031 293a 0a20 2020 2020  ops) - 1):.     
+00026c90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00026ca0: 6e64 4461 7465 203d 2074 6f70 732e 696c  ndDate = tops.il
+00026cb0: 6f63 5b69 5d5b 2244 6174 6522 5d0a 2020  oc[i]["Date"].  
 00026cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026cd0: 2020 2020 2020 2020 2028 6461 7461 2e44           (data.D
-00026ce0: 6174 6520 3e3d 2073 7461 7274 4461 7465  ate >= startDate
-00026cf0: 2920 2620 2864 6174 612e 4461 7465 203c  ) & (data.Date <
-00026d00: 3d20 656e 6444 6174 6529 0a20 2020 2020  = endDate).     
-00026d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026d20: 2020 205d 2e64 6573 6372 6962 6528 295b     ].describe()[
-00026d30: 224c 6f77 225d 5b22 6d69 6e22 5d0a 2020  "Low"]["min"].  
+00026cd0: 2020 7374 6172 7444 6174 6520 3d20 746f    startDate = to
+00026ce0: 7073 2e69 6c6f 635b 6920 2b20 315d 5b22  ps.iloc[i + 1]["
+00026cf0: 4461 7465 225d 0a20 2020 2020 2020 2020  Date"].         
+00026d00: 2020 2020 2020 2020 2020 206c 6f77 506f             lowPo
+00026d10: 696e 7473 2e61 7070 656e 6428 0a20 2020  ints.append(.   
+00026d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026d30: 2020 2020 2064 6174 615b 0a20 2020 2020       data[.     
 00026d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026d50: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00026d60: 2020 2020 6c6f 7750 6f69 6e74 734f 7267      lowPointsOrg
-00026d70: 203d 206c 6f77 506f 696e 7473 0a20 2020   = lowPoints.   
-00026d80: 2020 2020 2020 2020 2020 2020 206c 6f77               low
-00026d90: 506f 696e 7473 2e73 6f72 7428 7265 7665  Points.sort(reve
-00026da0: 7273 653d 5472 7565 290a 2020 2020 2020  rse=True).      
-00026db0: 2020 2020 2020 2020 2020 6c6f 7750 6f69            lowPoi
-00026dc0: 6e74 7353 6f72 7465 6420 3d20 6c6f 7750  ntsSorted = lowP
-00026dd0: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
-00026de0: 2020 2020 2020 6966 2064 6174 612e 656d        if data.em
-00026df0: 7074 7920 6f72 206c 656e 286c 6f77 506f  pty or len(lowPo
-00026e00: 696e 7473 2920 3c20 313a 0a20 2020 2020  ints) < 1:.     
-00026e10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00026e20: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00026e30: 2020 2020 2020 2020 2020 2020 6c74 7020              ltp 
-00026e40: 3d20 6461 7461 2e68 6561 6428 3129 5b22  = data.head(1)["
-00026e50: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d0a  Close"].iloc[0].
-00026e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026e70: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00026e80: 2020 2020 2020 2020 206c 6f77 506f 696e           lowPoin
-00026e90: 7473 4f72 6720 3d3d 206c 6f77 506f 696e  tsOrg == lowPoin
-00026ea0: 7473 536f 7274 6564 0a20 2020 2020 2020  tsSorted.       
-00026eb0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00026ec0: 206c 7470 203c 2068 6967 6865 7374 546f   ltp < highestTo
-00026ed0: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00026ee0: 2020 2020 2020 616e 6420 6c74 7020 3e20        and ltp > 
-00026ef0: 6c6f 7750 6f69 6e74 735b 305d 0a20 2020  lowPoints[0].   
-00026f00: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-00026f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026f20: 2020 2020 7361 7665 6420 3d20 7365 6c66      saved = self
-00026f30: 2e66 696e 6443 7572 7265 6e74 5361 7665  .findCurrentSave
-00026f40: 6456 616c 7565 2873 6372 6565 6e44 6963  dValue(screenDic
-00026f50: 742c 2073 6176 6544 6963 742c 2022 5061  t, saveDict, "Pa
-00026f60: 7474 6572 6e22 290a 2020 2020 2020 2020  ttern").        
-00026f70: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-00026f80: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
-00026f90: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-00026fa0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00026fb0: 7665 645b 305d 200a 2020 2020 2020 2020  ved[0] .        
-00026fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026fd0: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-00026fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026ff0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-00027000: 5465 7874 2e47 5245 454e 0a20 2020 2020  Text.GREEN.     
-00027010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027020: 2020 202b 2066 2256 4350 2028 424f 3a20     + f"VCP (BO: 
-00027030: 7b68 6967 6865 7374 546f 707d 2922 0a20  {highestTop})". 
-00027040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027050: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-00027060: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00027070: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00027080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027090: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
-000270a0: 726e 225d 203d 2073 6176 6564 5b31 5d20  rn"] = saved[1] 
-000270b0: 2b20 6622 5643 5020 2842 4f3a 207b 6869  + f"VCP (BO: {hi
-000270c0: 6768 6573 7454 6f70 7d29 220a 2020 2020  ghestTop})".    
-000270d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000270e0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
-000270f0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00027100: 7469 6f6e 2061 7320 653a 2020 2320 7072  tion as e:  # pr
-00027110: 6167 6d61 3a20 6e6f 2063 6f76 6572 0a20  agma: no cover. 
-00027120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00027130: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
-00027140: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
-00027150: 3d54 7275 6529 0a20 2020 2020 2020 2072  =True).        r
-00027160: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-00027170: 2023 2056 616c 6964 6174 6520 6966 2076   # Validate if v
-00027180: 6f6c 756d 6520 6f66 206c 6173 7420 6461  olume of last da
-00027190: 7920 6973 2068 6967 6865 7220 7468 616e  y is higher than
-000271a0: 2061 7667 0a20 2020 2064 6566 2076 616c   avg.    def val
-000271b0: 6964 6174 6556 6f6c 756d 6528 0a20 2020  idateVolume(.   
-000271c0: 2020 2020 2073 656c 662c 2064 662c 2073       self, df, s
-000271d0: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-000271e0: 6963 742c 2076 6f6c 756d 6552 6174 696f  ict, volumeRatio
-000271f0: 3d32 2e35 2c20 6d69 6e56 6f6c 756d 653d  =2.5, minVolume=
-00027200: 3130 300a 2020 2020 293a 0a20 2020 2020  100.    ):.     
-00027210: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
-00027220: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
-00027230: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00027240: 7475 726e 2046 616c 7365 2c20 4661 6c73  turn False, Fals
-00027250: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-00027260: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-00027270: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
-00027280: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
-00027290: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
-000272a0: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
-000272b0: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
-000272c0: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
-000272d0: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
-000272e0: 2023 2045 6974 6865 7220 7468 6520 726f   # Either the ro
-000272f0: 6c6c 696e 6720 766f 6c75 6d65 206f 6620  lling volume of 
-00027300: 7061 7374 2032 3020 7365 7373 696f 6e73  past 20 sessions
-00027310: 206f 7220 746f 6461 7927 7320 766f 6c75   or today's volu
-00027320: 6d65 2073 686f 756c 6420 6265 203e 206d  me should be > m
-00027330: 696e 2076 6f6c 756d 650a 2020 2020 2020  in volume.      
-00027340: 2020 6861 734d 696e 696d 756d 566f 6c75    hasMinimumVolu
-00027350: 6d65 203d 2028 0a20 2020 2020 2020 2020  me = (.         
-00027360: 2020 2072 6563 656e 745b 2256 6f6c 4d41     recent["VolMA
-00027370: 225d 2e69 6c6f 635b 305d 203e 3d20 6d69  "].iloc[0] >= mi
-00027380: 6e56 6f6c 756d 650a 2020 2020 2020 2020  nVolume.        
-00027390: 2020 2020 6f72 2072 6563 656e 745b 2256      or recent["V
-000273a0: 6f6c 756d 6522 5d2e 696c 6f63 5b30 5d20  olume"].iloc[0] 
-000273b0: 3e3d 206d 696e 566f 6c75 6d65 0a20 2020  >= minVolume.   
-000273c0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-000273d0: 6620 7265 6365 6e74 5b22 566f 6c4d 4122  f recent["VolMA"
-000273e0: 5d2e 696c 6f63 5b30 5d20 3d3d 2030 3a20  ].iloc[0] == 0: 
-000273f0: 2023 2048 616e 646c 6573 2044 6976 6964   # Handles Divid
-00027400: 6520 6279 2030 2077 6172 6e69 6e67 0a20  e by 0 warning. 
-00027410: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00027420: 6963 745b 2256 6f6c 756d 6522 5d20 3d20  ict["Volume"] = 
-00027430: 3020 2023 2022 556e 6b6e 6f77 6e22 0a20  0  # "Unknown". 
-00027440: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00027450: 6e44 6963 745b 2256 6f6c 756d 6522 5d20  nDict["Volume"] 
-00027460: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00027470: 7265 7475 726e 2046 616c 7365 2c20 6861  return False, ha
-00027480: 734d 696e 696d 756d 566f 6c75 6d65 0a20  sMinimumVolume. 
-00027490: 2020 2020 2020 2072 6174 696f 203d 2072         ratio = r
-000274a0: 6f75 6e64 2872 6563 656e 745b 2256 6f6c  ound(recent["Vol
-000274b0: 756d 6522 5d2e 696c 6f63 5b30 5d20 2f20  ume"].iloc[0] / 
-000274c0: 7265 6365 6e74 5b22 566f 6c4d 4122 5d2e  recent["VolMA"].
-000274d0: 696c 6f63 5b30 5d2c 2032 290a 2020 2020  iloc[0], 2).    
-000274e0: 2020 2020 7361 7665 4469 6374 5b22 566f      saveDict["Vo
-000274f0: 6c75 6d65 225d 203d 2072 6174 696f 0a20  lume"] = ratio. 
-00027500: 2020 2020 2020 2069 6620 7261 7469 6f20         if ratio 
-00027510: 3e3d 2076 6f6c 756d 6552 6174 696f 2061  >= volumeRatio a
-00027520: 6e64 2072 6174 696f 2021 3d20 6e70 2e6e  nd ratio != np.n
-00027530: 616e 2061 6e64 2028 6e6f 7420 6d61 7468  an and (not math
-00027540: 2e69 7369 6e66 2872 6174 696f 2929 3a0a  .isinf(ratio)):.
-00027550: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-00027560: 656e 4469 6374 5b22 566f 6c75 6d65 225d  enDict["Volume"]
-00027570: 203d 2072 6174 696f 0a20 2020 2020 2020   = ratio.       
-00027580: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00027590: 2c20 6861 734d 696e 696d 756d 566f 6c75  , hasMinimumVolu
-000275a0: 6d65 0a20 2020 2020 2020 2073 6372 6565  me.        scree
-000275b0: 6e44 6963 745b 2256 6f6c 756d 6522 5d20  nDict["Volume"] 
-000275c0: 3d20 7261 7469 6f0a 2020 2020 2020 2020  = ratio.        
-000275d0: 7265 7475 726e 2046 616c 7365 2c20 6861  return False, ha
-000275e0: 734d 696e 696d 756d 566f 6c75 6d65 0a0a  sMinimumVolume..
-000275f0: 2020 2020 2320 4669 6e64 2069 6620 7374      # Find if st
-00027600: 6f63 6b20 6973 2076 616c 6964 6174 696e  ock is validatin
-00027610: 6720 766f 6c75 6d65 2073 7072 6561 6420  g volume spread 
-00027620: 616e 616c 7973 6973 0a20 2020 2064 6566  analysis.    def
-00027630: 2076 616c 6964 6174 6556 6f6c 756d 6553   validateVolumeS
-00027640: 7072 6561 6441 6e61 6c79 7369 7328 7365  preadAnalysis(se
-00027650: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-00027660: 6374 2c20 7361 7665 4469 6374 293a 0a20  ct, saveDict):. 
-00027670: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00027680: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-00027690: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-000276a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-000276b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000276c0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-000276d0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
-000276e0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-000276f0: 6120 3d20 6461 7461 2e68 6561 6428 3229  a = data.head(2)
-00027700: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00027710: 6c65 6e28 6461 7461 2920 3c20 323a 0a20  len(data) < 2:. 
-00027720: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00027730: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00027740: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00027750: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00027760: 6865 636b 2066 6f72 2070 7265 7669 6f75  heck for previou
-00027770: 7320 5245 4420 6361 6e64 6c65 730a 2020  s RED candles.  
-00027780: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00027790: 4375 7272 656e 7420 6361 6e64 6c65 203d  Current candle =
-000277a0: 2030 7468 2c20 5072 6576 696f 7573 2043   0th, Previous C
-000277b0: 616e 646c 6520 3d20 3173 7420 666f 7220  andle = 1st for 
-000277c0: 666f 6c6c 6f77 696e 6720 6c6f 6769 630a  following logic.
-000277d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000277e0: 6966 2064 6174 612e 696c 6f63 5b31 5d5b  if data.iloc[1][
-000277f0: 224f 7065 6e22 5d20 3e3d 2064 6174 612e  "Open"] >= data.
-00027800: 696c 6f63 5b31 5d5b 2243 6c6f 7365 225d  iloc[1]["Close"]
-00027810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027820: 2020 2020 2020 7370 7265 6164 3120 3d20        spread1 = 
-00027830: 6162 7328 6461 7461 2e69 6c6f 635b 315d  abs(data.iloc[1]
-00027840: 5b22 4f70 656e 225d 202d 2064 6174 612e  ["Open"] - data.
-00027850: 696c 6f63 5b31 5d5b 2243 6c6f 7365 225d  iloc[1]["Close"]
-00027860: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00027870: 2020 2020 2020 7370 7265 6164 3020 3d20        spread0 = 
-00027880: 6162 7328 6461 7461 2e69 6c6f 635b 305d  abs(data.iloc[0]
-00027890: 5b22 4f70 656e 225d 202d 2064 6174 612e  ["Open"] - data.
-000278a0: 696c 6f63 5b30 5d5b 2243 6c6f 7365 225d  iloc[0]["Close"]
-000278b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000278c0: 2020 2020 2020 6c6f 7765 725f 7769 636b        lower_wick
-000278d0: 5f73 7072 6561 6430 203d 2028 0a20 2020  _spread0 = (.   
+00026d50: 2020 2020 2020 2028 6461 7461 2e44 6174         (data.Dat
+00026d60: 6520 3e3d 2073 7461 7274 4461 7465 2920  e >= startDate) 
+00026d70: 2620 2864 6174 612e 4461 7465 203c 3d20  & (data.Date <= 
+00026d80: 656e 6444 6174 6529 0a20 2020 2020 2020  endDate).       
+00026d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026da0: 205d 2e64 6573 6372 6962 6528 295b 224c   ].describe()["L
+00026db0: 6f77 225d 5b22 6d69 6e22 5d0a 2020 2020  ow"]["min"].    
+00026dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026dd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00026de0: 2020 6c6f 7750 6f69 6e74 734f 7267 203d    lowPointsOrg =
+00026df0: 206c 6f77 506f 696e 7473 0a20 2020 2020   lowPoints.     
+00026e00: 2020 2020 2020 2020 2020 206c 6f77 506f             lowPo
+00026e10: 696e 7473 2e73 6f72 7428 7265 7665 7273  ints.sort(revers
+00026e20: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+00026e30: 2020 2020 2020 2020 6c6f 7750 6f69 6e74          lowPoint
+00026e40: 7353 6f72 7465 6420 3d20 6c6f 7750 6f69  sSorted = lowPoi
+00026e50: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
+00026e60: 2020 2020 6966 2064 6174 612e 656d 7074      if data.empt
+00026e70: 7920 6f72 206c 656e 286c 6f77 506f 696e  y or len(lowPoin
+00026e80: 7473 2920 3c20 313a 0a20 2020 2020 2020  ts) < 1:.       
+00026e90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00026ea0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+00026eb0: 2020 2020 2020 2020 2020 6c74 7020 3d20            ltp = 
+00026ec0: 6461 7461 2e68 6561 6428 3129 5b22 436c  data.head(1)["Cl
+00026ed0: 6f73 6522 5d2e 696c 6f63 5b30 5d0a 2020  ose"].iloc[0].  
+00026ee0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00026ef0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00026f00: 2020 2020 2020 206c 6f77 506f 696e 7473         lowPoints
+00026f10: 4f72 6720 3d3d 206c 6f77 506f 696e 7473  Org == lowPoints
+00026f20: 536f 7274 6564 0a20 2020 2020 2020 2020  Sorted.         
+00026f30: 2020 2020 2020 2020 2020 2061 6e64 206c             and l
+00026f40: 7470 203c 2068 6967 6865 7374 546f 700a  tp < highestTop.
+00026f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026f60: 2020 2020 616e 6420 6c74 7020 3e20 6c6f      and ltp > lo
+00026f70: 7750 6f69 6e74 735b 305d 0a20 2020 2020  wPoints[0].     
+00026f80: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00026f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026fa0: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
+00026fb0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
+00026fc0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
+00026fd0: 2073 6176 6544 6963 742c 2022 5061 7474   saveDict, "Patt
+00026fe0: 6572 6e22 290a 2020 2020 2020 2020 2020  ern").          
+00026ff0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00027000: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+00027010: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00027020: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00027030: 645b 305d 200a 2020 2020 2020 2020 2020  d[0] .          
+00027040: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00027050: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
+00027060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027070: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00027080: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
+00027090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270a0: 202b 2066 2256 4350 2028 424f 3a20 7b68   + f"VCP (BO: {h
+000270b0: 6967 6865 7374 546f 707d 2922 0a20 2020  ighestTop})".   
+000270c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270d0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+000270e0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+000270f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00027100: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00027110: 6176 6544 6963 745b 2250 6174 7465 726e  aveDict["Pattern
+00027120: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
+00027130: 6622 5643 5020 2842 4f3a 207b 6869 6768  f"VCP (BO: {high
+00027140: 6573 7454 6f70 7d29 220a 2020 2020 2020  estTop})".      
+00027150: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00027160: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+00027170: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00027180: 6f6e 2061 7320 653a 2020 2320 7072 6167  on as e:  # prag
+00027190: 6d61 3a20 6e6f 2063 6f76 6572 0a20 2020  ma: no cover.   
+000271a0: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+000271b0: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
+000271c0: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
+000271d0: 7275 6529 0a20 2020 2020 2020 2072 6574  rue).        ret
+000271e0: 7572 6e20 4661 6c73 650a 0a20 2020 2023  urn False..    #
+000271f0: 2056 616c 6964 6174 6520 6966 2076 6f6c   Validate if vol
+00027200: 756d 6520 6f66 206c 6173 7420 6461 7920  ume of last day 
+00027210: 6973 2068 6967 6865 7220 7468 616e 2061  is higher than a
+00027220: 7667 0a20 2020 2064 6566 2076 616c 6964  vg.    def valid
+00027230: 6174 6556 6f6c 756d 6528 0a20 2020 2020  ateVolume(.     
+00027240: 2020 2073 656c 662c 2064 662c 2073 6372     self, df, scr
+00027250: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+00027260: 742c 2076 6f6c 756d 6552 6174 696f 3d32  t, volumeRatio=2
+00027270: 2e35 2c20 6d69 6e56 6f6c 756d 653d 3130  .5, minVolume=10
+00027280: 300a 2020 2020 293a 0a20 2020 2020 2020  0.    ):.       
+00027290: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+000272a0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+000272b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000272c0: 726e 2046 616c 7365 2c20 4661 6c73 650a  rn False, False.
+000272d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+000272e0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+000272f0: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+00027300: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
+00027310: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+00027320: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+00027330: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
+00027340: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
+00027350: 6561 6428 3129 0a20 2020 2020 2020 2023  ead(1).        #
+00027360: 2045 6974 6865 7220 7468 6520 726f 6c6c   Either the roll
+00027370: 696e 6720 766f 6c75 6d65 206f 6620 7061  ing volume of pa
+00027380: 7374 2032 3020 7365 7373 696f 6e73 206f  st 20 sessions o
+00027390: 7220 746f 6461 7927 7320 766f 6c75 6d65  r today's volume
+000273a0: 2073 686f 756c 6420 6265 203e 206d 696e   should be > min
+000273b0: 2076 6f6c 756d 650a 2020 2020 2020 2020   volume.        
+000273c0: 6861 734d 696e 696d 756d 566f 6c75 6d65  hasMinimumVolume
+000273d0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000273e0: 2072 6563 656e 745b 2256 6f6c 4d41 225d   recent["VolMA"]
+000273f0: 2e69 6c6f 635b 305d 203e 3d20 6d69 6e56  .iloc[0] >= minV
+00027400: 6f6c 756d 650a 2020 2020 2020 2020 2020  olume.          
+00027410: 2020 6f72 2072 6563 656e 745b 2256 6f6c    or recent["Vol
+00027420: 756d 6522 5d2e 696c 6f63 5b30 5d20 3e3d  ume"].iloc[0] >=
+00027430: 206d 696e 566f 6c75 6d65 0a20 2020 2020   minVolume.     
+00027440: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00027450: 7265 6365 6e74 5b22 566f 6c4d 4122 5d2e  recent["VolMA"].
+00027460: 696c 6f63 5b30 5d20 3d3d 2030 3a20 2023  iloc[0] == 0:  #
+00027470: 2048 616e 646c 6573 2044 6976 6964 6520   Handles Divide 
+00027480: 6279 2030 2077 6172 6e69 6e67 0a20 2020  by 0 warning.   
+00027490: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+000274a0: 745b 2256 6f6c 756d 6522 5d20 3d20 3020  t["Volume"] = 0 
+000274b0: 2023 2022 556e 6b6e 6f77 6e22 0a20 2020   # "Unknown".   
+000274c0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+000274d0: 6963 745b 2256 6f6c 756d 6522 5d20 3d20  ict["Volume"] = 
+000274e0: 300a 2020 2020 2020 2020 2020 2020 7265  0.            re
+000274f0: 7475 726e 2046 616c 7365 2c20 6861 734d  turn False, hasM
+00027500: 696e 696d 756d 566f 6c75 6d65 0a20 2020  inimumVolume.   
+00027510: 2020 2020 2072 6174 696f 203d 2072 6f75       ratio = rou
+00027520: 6e64 2872 6563 656e 745b 2256 6f6c 756d  nd(recent["Volum
+00027530: 6522 5d2e 696c 6f63 5b30 5d20 2f20 7265  e"].iloc[0] / re
+00027540: 6365 6e74 5b22 566f 6c4d 4122 5d2e 696c  cent["VolMA"].il
+00027550: 6f63 5b30 5d2c 2032 290a 2020 2020 2020  oc[0], 2).      
+00027560: 2020 7361 7665 4469 6374 5b22 566f 6c75    saveDict["Volu
+00027570: 6d65 225d 203d 2072 6174 696f 0a20 2020  me"] = ratio.   
+00027580: 2020 2020 2069 6620 7261 7469 6f20 3e3d       if ratio >=
+00027590: 2076 6f6c 756d 6552 6174 696f 2061 6e64   volumeRatio and
+000275a0: 2072 6174 696f 2021 3d20 6e70 2e6e 616e   ratio != np.nan
+000275b0: 2061 6e64 2028 6e6f 7420 6d61 7468 2e69   and (not math.i
+000275c0: 7369 6e66 2872 6174 696f 2929 3a0a 2020  sinf(ratio)):.  
+000275d0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+000275e0: 4469 6374 5b22 566f 6c75 6d65 225d 203d  Dict["Volume"] =
+000275f0: 2072 6174 696f 0a20 2020 2020 2020 2020   ratio.         
+00027600: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+00027610: 6861 734d 696e 696d 756d 566f 6c75 6d65  hasMinimumVolume
+00027620: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
+00027630: 6963 745b 2256 6f6c 756d 6522 5d20 3d20  ict["Volume"] = 
+00027640: 7261 7469 6f0a 2020 2020 2020 2020 7265  ratio.        re
+00027650: 7475 726e 2046 616c 7365 2c20 6861 734d  turn False, hasM
+00027660: 696e 696d 756d 566f 6c75 6d65 0a0a 2020  inimumVolume..  
+00027670: 2020 2320 4669 6e64 2069 6620 7374 6f63    # Find if stoc
+00027680: 6b20 6973 2076 616c 6964 6174 696e 6720  k is validating 
+00027690: 766f 6c75 6d65 2073 7072 6561 6420 616e  volume spread an
+000276a0: 616c 7973 6973 0a20 2020 2064 6566 2076  alysis.    def v
+000276b0: 616c 6964 6174 6556 6f6c 756d 6553 7072  alidateVolumeSpr
+000276c0: 6561 6441 6e61 6c79 7369 7328 7365 6c66  eadAnalysis(self
+000276d0: 2c20 6466 2c20 7363 7265 656e 4469 6374  , df, screenDict
+000276e0: 2c20 7361 7665 4469 6374 293a 0a20 2020  , saveDict):.   
+000276f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00027700: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+00027710: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+00027720: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00027730: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00027740: 650a 2020 2020 2020 2020 2020 2020 6461  e.            da
+00027750: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+00027760: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+00027770: 3d20 6461 7461 2e68 6561 6428 3229 0a20  = data.head(2). 
+00027780: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00027790: 6e28 6461 7461 2920 3c20 323a 0a20 2020  n(data) < 2:.   
+000277a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000277b0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+000277c0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000277d0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+000277e0: 636b 2066 6f72 2070 7265 7669 6f75 7320  ck for previous 
+000277f0: 5245 4420 6361 6e64 6c65 730a 2020 2020  RED candles.    
+00027800: 2020 2020 2020 2020 2020 2020 2320 4375              # Cu
+00027810: 7272 656e 7420 6361 6e64 6c65 203d 2030  rrent candle = 0
+00027820: 7468 2c20 5072 6576 696f 7573 2043 616e  th, Previous Can
+00027830: 646c 6520 3d20 3173 7420 666f 7220 666f  dle = 1st for fo
+00027840: 6c6c 6f77 696e 6720 6c6f 6769 630a 2020  llowing logic.  
+00027850: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00027860: 2064 6174 612e 696c 6f63 5b31 5d5b 224f   data.iloc[1]["O
+00027870: 7065 6e22 5d20 3e3d 2064 6174 612e 696c  pen"] >= data.il
+00027880: 6f63 5b31 5d5b 2243 6c6f 7365 225d 3a0a  oc[1]["Close"]:.
+00027890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278a0: 2020 2020 7370 7265 6164 3120 3d20 6162      spread1 = ab
+000278b0: 7328 6461 7461 2e69 6c6f 635b 315d 5b22  s(data.iloc[1]["
+000278c0: 4f70 656e 225d 202d 2064 6174 612e 696c  Open"] - data.il
+000278d0: 6f63 5b31 5d5b 2243 6c6f 7365 225d 290a  oc[1]["Close"]).
 000278e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278f0: 2020 2020 206d 6178 2864 6174 612e 696c       max(data.il
-00027900: 6f63 5b30 5d5b 224f 7065 6e22 5d2c 2064  oc[0]["Open"], d
-00027910: 6174 612e 696c 6f63 5b30 5d5b 2243 6c6f  ata.iloc[0]["Clo
-00027920: 7365 225d 290a 2020 2020 2020 2020 2020  se"]).          
-00027930: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-00027940: 6461 7461 2e69 6c6f 635b 305d 5b22 4c6f  data.iloc[0]["Lo
-00027950: 7722 5d0a 2020 2020 2020 2020 2020 2020  w"].            
-00027960: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00027970: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-00027980: 6c31 203d 2064 6174 612e 696c 6f63 5b31  l1 = data.iloc[1
-00027990: 5d5b 2256 6f6c 756d 6522 5d0a 2020 2020  ]["Volume"].    
-000279a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279b0: 766f 6c30 203d 2064 6174 612e 696c 6f63  vol0 = data.iloc
-000279c0: 5b30 5d5b 2256 6f6c 756d 6522 5d0a 2020  [0]["Volume"].  
-000279d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279e0: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
-000279f0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
-00027a00: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
-00027a10: 2073 6176 6544 6963 742c 2022 5061 7474   saveDict, "Patt
-00027a20: 6572 6e22 290a 2020 2020 2020 2020 2020  ern").          
-00027a30: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
-00027a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a50: 2020 2020 2020 2073 7072 6561 6430 203e         spread0 >
-00027a60: 2073 7072 6561 6431 0a20 2020 2020 2020   spread1.       
-00027a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a80: 2061 6e64 2076 6f6c 3020 3c20 766f 6c31   and vol0 < vol1
-00027a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027aa0: 2020 2020 2020 2020 2061 6e64 2064 6174           and dat
-00027ab0: 612e 696c 6f63 5b30 5d5b 2256 6f6c 756d  a.iloc[0]["Volum
-00027ac0: 6522 5d20 3c20 6461 7461 2e69 6c6f 635b  e"] < data.iloc[
-00027ad0: 305d 5b22 566f 6c4d 4122 5d0a 2020 2020  0]["VolMA"].    
-00027ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027af0: 2020 2020 616e 6420 6461 7461 2e69 6c6f      and data.ilo
-00027b00: 635b 305d 5b22 436c 6f73 6522 5d20 3c3d  c[0]["Close"] <=
-00027b10: 2064 6174 612e 696c 6f63 5b31 5d5b 224f   data.iloc[1]["O
-00027b20: 7065 6e22 5d0a 2020 2020 2020 2020 2020  pen"].          
-00027b30: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00027b40: 6420 7370 7265 6164 3020 3c20 6c6f 7765  d spread0 < lowe
-00027b50: 725f 7769 636b 5f73 7072 6561 6430 0a20  r_wick_spread0. 
+000278f0: 2020 2020 7370 7265 6164 3020 3d20 6162      spread0 = ab
+00027900: 7328 6461 7461 2e69 6c6f 635b 305d 5b22  s(data.iloc[0]["
+00027910: 4f70 656e 225d 202d 2064 6174 612e 696c  Open"] - data.il
+00027920: 6f63 5b30 5d5b 2243 6c6f 7365 225d 290a  oc[0]["Close"]).
+00027930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027940: 2020 2020 6c6f 7765 725f 7769 636b 5f73      lower_wick_s
+00027950: 7072 6561 6430 203d 2028 0a20 2020 2020  pread0 = (.     
+00027960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027970: 2020 206d 6178 2864 6174 612e 696c 6f63     max(data.iloc
+00027980: 5b30 5d5b 224f 7065 6e22 5d2c 2064 6174  [0]["Open"], dat
+00027990: 612e 696c 6f63 5b30 5d5b 2243 6c6f 7365  a.iloc[0]["Close
+000279a0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+000279b0: 2020 2020 2020 2020 2020 2020 2d20 6461              - da
+000279c0: 7461 2e69 6c6f 635b 305d 5b22 4c6f 7722  ta.iloc[0]["Low"
+000279d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000279e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000279f0: 2020 2020 2020 2020 2020 2020 766f 6c31              vol1
+00027a00: 203d 2064 6174 612e 696c 6f63 5b31 5d5b   = data.iloc[1][
+00027a10: 2256 6f6c 756d 6522 5d0a 2020 2020 2020  "Volume"].      
+00027a20: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00027a30: 6c30 203d 2064 6174 612e 696c 6f63 5b30  l0 = data.iloc[0
+00027a40: 5d5b 2256 6f6c 756d 6522 5d0a 2020 2020  ]["Volume"].    
+00027a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a60: 7361 7665 6420 3d20 7365 6c66 2e66 696e  saved = self.fin
+00027a70: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
+00027a80: 7565 2873 6372 6565 6e44 6963 742c 2073  ue(screenDict, s
+00027a90: 6176 6544 6963 742c 2022 5061 7474 6572  aveDict, "Patter
+00027aa0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00027ab0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00027ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ad0: 2020 2020 2073 7072 6561 6430 203e 2073       spread0 > s
+00027ae0: 7072 6561 6431 0a20 2020 2020 2020 2020  pread1.         
+00027af0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00027b00: 6e64 2076 6f6c 3020 3c20 766f 6c31 0a20  nd vol0 < vol1. 
+00027b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b20: 2020 2020 2020 2061 6e64 2064 6174 612e         and data.
+00027b30: 696c 6f63 5b30 5d5b 2256 6f6c 756d 6522  iloc[0]["Volume"
+00027b40: 5d20 3c20 6461 7461 2e69 6c6f 635b 305d  ] < data.iloc[0]
+00027b50: 5b22 566f 6c4d 4122 5d0a 2020 2020 2020  ["VolMA"].      
 00027b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b70: 2020 2020 2020 2061 6e64 2064 6174 612e         and data.
-00027b80: 696c 6f63 5b30 5d5b 2256 6f6c 756d 6522  iloc[0]["Volume"
-00027b90: 5d20 3c3d 2069 6e74 2864 6174 612e 696c  ] <= int(data.il
-00027ba0: 6f63 5b31 5d5b 2256 6f6c 756d 6522 5d20  oc[1]["Volume"] 
-00027bb0: 2a20 302e 3735 290a 2020 2020 2020 2020  * 0.75).        
-00027bc0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00027bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027be0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-00027bf0: 745b 2250 6174 7465 726e 225d 203d 2028  t["Pattern"] = (
-00027c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027c10: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-00027c20: 6564 5b30 5d20 0a20 2020 2020 2020 2020  ed[0] .         
-00027c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c40: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
-00027c50: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
-00027c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c70: 2b20 636f 6c6f 7254 6578 742e 4752 4545  + colorText.GREE
-00027c80: 4e0a 2020 2020 2020 2020 2020 2020 2020  N.              
-00027c90: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00027ca0: 2253 7570 706c 7920 4472 6f75 6768 7422  "Supply Drought"
-00027cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027cc0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00027cd0: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00027ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027cf0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00027d00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00027d10: 6176 6544 6963 745b 2250 6174 7465 726e  aveDict["Pattern
-00027d20: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
-00027d30: 2253 7570 706c 7920 4472 6f75 6768 7422  "Supply Drought"
-00027d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027d50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00027d60: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00027d70: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-00027d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d90: 2020 2020 2020 7370 7265 6164 3020 3c20        spread0 < 
-00027da0: 7370 7265 6164 310a 2020 2020 2020 2020  spread1.        
-00027db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027dc0: 616e 6420 766f 6c30 203e 2076 6f6c 310a  and vol0 > vol1.
-00027dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027de0: 2020 2020 2020 2020 616e 6420 6461 7461          and data
-00027df0: 2e69 6c6f 635b 305d 5b22 566f 6c75 6d65  .iloc[0]["Volume
-00027e00: 225d 203e 2064 6174 612e 696c 6f63 5b30  "] > data.iloc[0
-00027e10: 5d5b 2256 6f6c 4d41 225d 0a20 2020 2020  ]["VolMA"].     
-00027e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e30: 2020 2061 6e64 2064 6174 612e 696c 6f63     and data.iloc
-00027e40: 5b30 5d5b 2243 6c6f 7365 225d 203c 3d20  [0]["Close"] <= 
-00027e50: 6461 7461 2e69 6c6f 635b 315d 5b22 4f70  data.iloc[1]["Op
-00027e60: 656e 225d 0a20 2020 2020 2020 2020 2020  en"].           
-00027e70: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-00027e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e90: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-00027ea0: 5061 7474 6572 6e22 5d20 3d20 280a 2020  Pattern"] = (.  
-00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ec0: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
-00027ed0: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-00027ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ef0: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-00027f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027f10: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00027f20: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+00027b70: 2020 616e 6420 6461 7461 2e69 6c6f 635b    and data.iloc[
+00027b80: 305d 5b22 436c 6f73 6522 5d20 3c3d 2064  0]["Close"] <= d
+00027b90: 6174 612e 696c 6f63 5b31 5d5b 224f 7065  ata.iloc[1]["Ope
+00027ba0: 6e22 5d0a 2020 2020 2020 2020 2020 2020  n"].            
+00027bb0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00027bc0: 7370 7265 6164 3020 3c20 6c6f 7765 725f  spread0 < lower_
+00027bd0: 7769 636b 5f73 7072 6561 6430 0a20 2020  wick_spread0.   
+00027be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027bf0: 2020 2020 2061 6e64 2064 6174 612e 696c       and data.il
+00027c00: 6f63 5b30 5d5b 2256 6f6c 756d 6522 5d20  oc[0]["Volume"] 
+00027c10: 3c3d 2069 6e74 2864 6174 612e 696c 6f63  <= int(data.iloc
+00027c20: 5b31 5d5b 2256 6f6c 756d 6522 5d20 2a20  [1]["Volume"] * 
+00027c30: 302e 3735 290a 2020 2020 2020 2020 2020  0.75).          
+00027c40: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00027c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c60: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00027c70: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
+00027c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c90: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00027ca0: 5b30 5d20 0a20 2020 2020 2020 2020 2020  [0] .           
+00027cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027cc0: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+00027cd0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+00027ce0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00027cf0: 636f 6c6f 7254 6578 742e 4752 4545 4e0a  colorText.GREEN.
+00027d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d10: 2020 2020 2020 2020 2020 2020 2b20 2253              + "S
+00027d20: 7570 706c 7920 4472 6f75 6768 7422 0a20  upply Drought". 
+00027d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d40: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+00027d50: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00027d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d70: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00027d80: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00027d90: 6544 6963 745b 2250 6174 7465 726e 225d  eDict["Pattern"]
+00027da0: 203d 2073 6176 6564 5b31 5d20 2b20 2253   = saved[1] + "S
+00027db0: 7570 706c 7920 4472 6f75 6768 7422 0a20  upply Drought". 
+00027dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027dd0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00027de0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00027df0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00027e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e10: 2020 2020 7370 7265 6164 3020 3c20 7370      spread0 < sp
+00027e20: 7265 6164 310a 2020 2020 2020 2020 2020  read1.          
+00027e30: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00027e40: 6420 766f 6c30 203e 2076 6f6c 310a 2020  d vol0 > vol1.  
+00027e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e60: 2020 2020 2020 616e 6420 6461 7461 2e69        and data.i
+00027e70: 6c6f 635b 305d 5b22 566f 6c75 6d65 225d  loc[0]["Volume"]
+00027e80: 203e 2064 6174 612e 696c 6f63 5b30 5d5b   > data.iloc[0][
+00027e90: 2256 6f6c 4d41 225d 0a20 2020 2020 2020  "VolMA"].       
+00027ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027eb0: 2061 6e64 2064 6174 612e 696c 6f63 5b30   and data.iloc[0
+00027ec0: 5d5b 2243 6c6f 7365 225d 203c 3d20 6461  ]["Close"] <= da
+00027ed0: 7461 2e69 6c6f 635b 315d 5b22 4f70 656e  ta.iloc[1]["Open
+00027ee0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
+00027ef0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+00027f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f10: 2020 7363 7265 656e 4469 6374 5b22 5061    screenDict["Pa
+00027f20: 7474 6572 6e22 5d20 3d20 280a 2020 2020  ttern"] = (.    
 00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f40: 2020 2020 2020 2020 2020 202b 2022 4465             + "De
-00027f50: 6d61 6e64 2052 6973 6522 0a20 2020 2020  mand Rise".     
-00027f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f70: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-00027f80: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00027f90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00027fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027fb0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-00027fc0: 745b 2250 6174 7465 726e 225d 203d 2073  t["Pattern"] = s
-00027fd0: 6176 6564 5b31 5d20 2b20 2244 656d 616e  aved[1] + "Deman
-00027fe0: 6420 5269 7365 220a 2020 2020 2020 2020  d Rise".        
-00027ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028000: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
-00028010: 2020 2020 2020 2020 6578 6365 7074 2049          except I
-00028020: 6e64 6578 4572 726f 7220 6173 2065 3a20  ndexError as e: 
-00028030: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
-00028040: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00028050: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
-00028060: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-00028070: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-00028080: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00028090: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000280a0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-000280b0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000280c0: 7074 696f 6e20 6173 2065 3a20 2023 2070  ption as e:  # p
-000280d0: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-000280e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000280f0: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-00028100: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-00028110: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-00028120: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00028130: 0a                                       .
+00027f40: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
+00027f50: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00027f60: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00027f70: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
+00027f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f90: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+00027fa0: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
+00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fc0: 2020 2020 2020 2020 202b 2022 4465 6d61           + "Dema
+00027fd0: 6e64 2052 6973 6522 0a20 2020 2020 2020  nd Rise".       
+00027fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ff0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+00028000: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+00028010: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00028020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028030: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00028040: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+00028050: 6564 5b31 5d20 2b20 2244 656d 616e 6420  ed[1] + "Demand 
+00028060: 5269 7365 220a 2020 2020 2020 2020 2020  Rise".          
+00028070: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00028080: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+00028090: 2020 2020 2020 6578 6365 7074 2049 6e64        except Ind
+000280a0: 6578 4572 726f 7220 6173 2065 3a20 2320  exError as e: # 
+000280b0: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
+000280c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000280d0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+000280e0: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
+000280f0: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
+00028100: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00028110: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
+00028120: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00028130: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00028140: 696f 6e20 6173 2065 3a20 2023 2070 7261  ion as e:  # pra
+00028150: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
+00028160: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00028170: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+00028180: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+00028190: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+000281a0: 2020 7265 7475 726e 2046 616c 7365 0a      return False.
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/StockScreener.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/StockScreener.py`

 * *Files 1% similar despite different names*

```diff
@@ -94,16 +94,16 @@
         userArgsLog = printCounter
         start_time = time.time()
         try:
             with hostRef.processingCounter.get_lock():
                 hostRef.processingCounter.value += 1
 
             volumeRatio, period = self.determineBasicConfigs(stock, newlyListedOnly, volumeRatio, logLevel, hostRef, configManager, screener, userArgsLog)
-            if userArgsLog:
-                hostRef.default_logger.info(f"For stock:{stock}, stock exists in objectDictionary:{hostRef.objectDictionaryPrimary.get(stock)}, cacheEnabled:{configManager.cacheEnabled}, isTradingTime:{self.isTradingTime}, downloadOnly:{downloadOnly}")
+            # if userArgsLog:
+            #     hostRef.default_logger.info(f"For stock:{stock}, stock exists in objectDictionary:{hostRef.objectDictionaryPrimary.get(stock)}, cacheEnabled:{configManager.cacheEnabled}, isTradingTime:{self.isTradingTime}, downloadOnly:{downloadOnly}")
             data = None
             data = self.getRelevantDataForStock(totalSymbols, shouldCache, stock, downloadOnly, printCounter, backtestDuration, hostRef,hostRef.objectDictionaryPrimary, configManager, fetcher, period,None, testData,exchangeName)
             if not configManager.isIntradayConfig() and configManager.calculatersiintraday:
                 # Daily data is already available in "data" above.
                 # We need the intraday data for 1-d RSI values when config is not for intraday
                 intraday_data = self.getRelevantDataForStock(totalSymbols, shouldCache, stock, downloadOnly, printCounter, backtestDuration, hostRef, hostRef.objectDictionarySecondary, configManager, fetcher, "1d","1m", testData,exchangeName)
                 
@@ -227,15 +227,15 @@
                 if not screener.validateNewlyListed(fullData, period):
                     raise ScreeningStatistics.NotNewlyListed
 
             if processedData.empty:
                 raise StockDataEmptyException("Empty processedData")
             suppressError = (logLevel==logging.NOTSET)
             suppressOut = (not (printCounter or testbuild))
-            with SuppressOutput(suppress_stderr=False, suppress_stdout=False):
+            with SuppressOutput(suppress_stderr=suppressError, suppress_stdout=suppressOut):
                 self.updateStock(stock, screeningDictionary, saveDictionary, executeOption, exchangeName)
                 
                 self.performBasicLTPChecks(executeOption, screeningDictionary, saveDictionary, fullData, configManager, screener, exchangeName)
                 hasMinVolumeRatio = self.performBasicVolumeChecks(executeOption, volumeRatio, screeningDictionary, saveDictionary, processedData, configManager, screener)
                 if bidGreaterThanAsk:
                     if not hasMinVolumeRatio or bidAskRatio < 2:
                         raise ScreeningStatistics.EligibilityConditionNotMet("Bid/Ask Eligibility Not met.")
@@ -638,32 +638,32 @@
             # Capturing Ctr+C Here isn't a great idea
             pass
         except StockDataEmptyException as e: # pragma: no cover
             if data is None or (data is not None and not data.isnull().values.all(axis=0)[0]):
                 hostRef.default_logger.debug(f"StockDataEmptyException:{stock}: {e}", exc_info=True)
             pass
         except ScreeningStatistics.EligibilityConditionNotMet as e:
-            if userArgsLog:
-                hostRef.default_logger.debug(f"EligibilityConditionNotMet:{stock}: {e}", exc_info=True)
+            # if userArgsLog:
+            #     hostRef.default_logger.debug(f"EligibilityConditionNotMet:{stock}: {e}", exc_info=True)
             pass
         except ScreeningStatistics.NotNewlyListed as e: # pragma: no cover
-            if userArgsLog:
-                hostRef.default_logger.debug(f"NotNewlyListed:{stock}: {e}", exc_info=True)
+            # if userArgsLog:
+            #     hostRef.default_logger.debug(f"NotNewlyListed:{stock}: {e}", exc_info=True)
             pass
         except ScreeningStatistics.NotAStageTwoStock as e: # pragma: no cover
-            if userArgsLog:
-                hostRef.default_logger.debug(f"NotAStageTwoStock:{stock}: {e}", exc_info=True)
+            # if userArgsLog:
+            #     hostRef.default_logger.debug(f"NotAStageTwoStock:{stock}: {e}", exc_info=True)
             pass
         except ScreeningStatistics.NotEnoughVolumeAsPerConfig as e: # pragma: no cover 
-            if userArgsLog:
-                hostRef.default_logger.debug(f"NotEnoughVolumeAsPerConfig:{stock}: {e}", exc_info=True)
+            # if userArgsLog:
+            #     hostRef.default_logger.debug(f"NotEnoughVolumeAsPerConfig:{stock}: {e}", exc_info=True)
             pass
         except ScreeningStatistics.DownloadDataOnly as e: # pragma: no cover
-            if userArgsLog:
-                hostRef.default_logger.debug(f"DownloadDataOnly:{stock}: {e}", exc_info=True)
+            # if userArgsLog:
+            #     hostRef.default_logger.debug(f"DownloadDataOnly:{stock}: {e}", exc_info=True)
             try:
                 data = hostRef.objectDictionaryPrimary.get(stock)
                 if data is not None:
                     data = pd.DataFrame(data["data"], columns=data["columns"], index=data["index"])
                     screener.getMutualFundStatus(stock, hostData=data, force=True, exchangeName=exchangeName)
                     hostRef.objectDictionaryPrimary[stock] = data.to_dict("split")
             except Exception as ex:
@@ -673,16 +673,16 @@
                 screener.getFairValue(stock,hostData=data, force=True,exchangeName=exchangeName)
                 hostRef.objectDictionaryPrimary[stock] = data.to_dict("split")
             except Exception as ex:
                 hostRef.default_logger.debug(f"FairValue: {stock}:\n{ex}", exc_info=True)
                 pass
             pass
         except ScreeningStatistics.LTPNotInConfiguredRange as e: # pragma: no cover
-            if userArgsLog:
-                hostRef.default_logger.debug(f"LTPNotInConfiguredRange:{stock}: {e}", exc_info=True)
+            # if userArgsLog:
+            #     hostRef.default_logger.debug(f"LTPNotInConfiguredRange:{stock}: {e}", exc_info=True)
             pass
         except KeyError as e: # pragma: no cover
             if userArgsLog:
                 hostRef.default_logger.debug(f"KeyError:{stock}: {e}", exc_info=True)
             pass
         except OSError as e: # pragma: no cover
             if userArgsLog:
@@ -978,56 +978,56 @@
 
     def initResultDictionaries(self):
         periods = self.configManager.periodsRange
         columns = [
             "Stock",
             "LTP",
             "%Chng",
-            "52Wk H",
-            "52Wk L",
+            "52Wk-H",
+            "52Wk-L",
             "RSI",
             "RSIi",
             "Volume",
-            "22-Pd %",
+            "22-Pd",
             "Consol.",
             "Breakout",
             "MA-Signal",
             "Trend",
             "Pattern",
             "CCI",
             "FairValue"
         ]
         screeningDictionary = {
             "Stock": "",
             "LTP": 0,
             "%Chng": 0,
-            "52Wk H": 0,
-            "52Wk L": 0,
+            "52Wk-H": 0,
+            "52Wk-L": 0,
             "RSI": 0,
             "RSIi": 0,
             "Volume": "",
-            "22-Pd %": "",
+            "22-Pd": "",
             "Consol.": "Range:0%",
             "Breakout": "BO: 0 R: 0",
             "MA-Signal": "",
             "Trend": "",
             "Pattern": "",
             "CCI": 0,
             "FairValue": "-"
         }
         saveDictionary = {
             "Stock": "",
             "LTP": 0,
             "%Chng": 0,
-            "52Wk H": 0,
-            "52Wk L": 0,
+            "52Wk-H": 0,
+            "52Wk-L": 0,
             "RSI": 0,
             "RSIi": 0,
             "Volume": "",
-            "22-Pd %": "",
+            "22-Pd": "",
             "Consol.": "Range:0%",
             "Breakout": "BO: 0 R: 0",
             "MA-Signal": "",
             "Trend": "",
             "Pattern": "",
             "CCI": 0,
             "FairValue": "-"
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/UserMenuChoicesHandler.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/UserMenuChoicesHandler.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/Utility.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/Utility.py`

 * *Files 0% similar despite different names*

```diff
@@ -540,15 +540,18 @@
         # Report title
         draw.text((startColValue, rowPixelRunValue), reportTitle, font=stdfont, fill=menuColor)
         rowPixelRunValue += stdFont_oneLinelabel_height + 1
         counter = -1
         for df in dfs_to_print:
             counter += 1
             colPixelRunValue = startColValue
-            if df is None or len(df) == 0 or df.empty:
+            try:
+                if df is None or len(df) == 0:
+                    continue
+            except:
                 continue
             # selected menu options and As of DateTime
             draw.text(
                 (colPixelRunValue, rowPixelRunValue),
                 titleLabels[counter],
                 font=stdfont,
                 fill=menuColor,
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/WorkflowManager.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/WorkflowManager.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/classes/keys.py` & `pkscreener-0.45.20240602.429/pkscreener/classes/keys.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/courbd.ttf` & `pkscreener-0.45.20240602.429/pkscreener/courbd.ttf`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/pkscreener/globals.py` & `pkscreener-0.45.20240602.429/pkscreener/globals.py`

 * *Files 1% similar despite different names*

```diff
@@ -2084,20 +2084,33 @@
     eligible = is_token_telegram_configured()
     targetDateG10k = prepareGrowthOf10kResults(saveResults, selectedChoice, menuChoiceHierarchy, testing, user, pngName, pngExtension, eligible)
     if saveResults is not None and "Date" in saveResults.columns and len(saveResults) > 0:
         recordDate = saveResults["Date"].iloc[0].replace("/","-")
     summaryReturns = removedUnusedColumns(screenResults, saveResults, ["Date","Breakout","Resistance"],userArgs=userPassedArgs)
 
     tabulated_results = ""
+    console_results = ""
     if screenResults is not None and len(screenResults) > 0:
         tabulated_results = colorText.miniTabulator().tabulate(
             screenResults, headers="keys", tablefmt=colorText.No_Pad_GridFormat,
             maxcolwidths=Utility.tools.getMaxColumnWidths(screenResults)
         ).encode("utf-8").decode(STD_ENCODING)
-    OutputControls().printOutput(f"{tabulated_results}\n", enableMultipleLineOutput=True)
+        copyScreenResults = screenResults.copy()
+        hiddenColumns = configManager.alwaysHiddenDisplayColumns.split(",")
+        for col in screenResults.columns:
+            if col in hiddenColumns:
+                copyScreenResults.drop(col, axis=1, inplace=True, errors="ignore")
+        try:
+            console_results = colorText.miniTabulator().tabulate(
+                                    copyScreenResults, headers="keys", tablefmt=colorText.No_Pad_GridFormat,
+                                    maxcolwidths=Utility.tools.getMaxColumnWidths(copyScreenResults)
+                                ).encode("utf-8").decode(STD_ENCODING)
+        except:
+            console_results = tabulated_results
+    OutputControls().printOutput(f"{console_results}\n", enableMultipleLineOutput=True)
     _, reportNameInsights = getBacktestReportFilename(
         sortKey="Date", optionalName="Insights"
     )
     strategy_df = PortfolioXRay.bestStrategiesFromSummaryForReport(reportNameInsights,includeLargestDatasets=True)
     addendumLabel = (
         "[+] Strategies that have best results in the past for this scan option (calculated with 1 stock each with matching strategy in the result):"
     )
@@ -2196,30 +2209,31 @@
                             tabulated_backtest_summary,
                             tabulated_backtest_detail,
                         ) = tabulateBacktestResults(
                             saveResultsTrimmed, maxAllowed=MAX_ALLOWED, force=True
                         )
                         try:
                             # import traceback
-                            Utility.tools.tableToImage(
-                                "",
-                                "",
-                                pngName + backtestExtension,
-                                menuChoiceHierarchy,
-                                backtestSummary=tabulated_backtest_summary,
-                                backtestDetail=tabulated_backtest_detail,
-                            )
-                            caption = f"Backtest data for stocks listed in <b>{title}</b> scan results. See more past backtest data at https://pkjmesra.github.io/PKScreener/BacktestReports.html"
-                            sendMessageToTelegramChannel(
-                                message=None,
-                                document_filePath=pngName + backtestExtension,
-                                caption=caption,
-                                user=user,
-                            )
-                            os.remove(pngName + backtestExtension)
+                            if tabulated_backtest_summary is not None:
+                                Utility.tools.tableToImage(
+                                    "",
+                                    "",
+                                    pngName + backtestExtension,
+                                    menuChoiceHierarchy,
+                                    backtestSummary=tabulated_backtest_summary,
+                                    backtestDetail=tabulated_backtest_detail,
+                                )
+                                caption = f"Backtest data for stocks listed in <b>{title}</b> scan results. See more past backtest data at https://pkjmesra.github.io/PKScreener/BacktestReports.html"
+                                sendMessageToTelegramChannel(
+                                    message=None,
+                                    document_filePath=pngName + backtestExtension,
+                                    caption=caption,
+                                    user=user,
+                                )
+                                os.remove(pngName + backtestExtension)
                         except Exception as e:  # pragma: no cover
                             default_logger().debug(e, exc_info=True)
                             pass
                             # OutputControls().printOutput(e)
                             # traceback.print_exc()
                     else:
                         tabulateBacktestResults(saveResults)
@@ -2281,15 +2295,15 @@
             
     return targetDateG10k
 
 
 def removedUnusedColumns(screenResults, saveResults, dropAdditionalColumns=[], userArgs=None):
     periods = configManager.periodsRange
     if userArgs is not None and userArgs.backtestdaysago is not None and int(userArgs.backtestdaysago) < 22:
-        dropAdditionalColumns.append("22-Pd %")
+        dropAdditionalColumns.append("22-Pd")
     summaryReturns = "" #("w.r.t. " + saveResults["Date"].iloc[0]) if "Date" in saveResults.columns else ""
     for period in periods:
         if saveResults is not None:
             # if f"LTP{period}" in saveResults.columns and "MCapWt%" in saveResults.columns:
             #     pdLTP = saveResults[f"LTP{period}"].replace("", np.nan).replace(np.inf, np.nan).replace(-np.inf, np.nan).astype(float)
             #     mktWeight = saveResults["MCapWt%"].replace("", np.nan).replace(np.inf, np.nan).replace(-np.inf, np.nan).astype(float)
             #     ltp = saveResults[f"LTP"].replace("", np.nan).replace(np.inf, np.nan).replace(-np.inf, np.nan).astype(float)
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/pkscreenerbot.py` & `pkscreener-0.45.20240602.429/pkscreener/pkscreenerbot.py`

 * *Files 1% similar despite different names*

```diff
@@ -121,14 +121,15 @@
 
 m0 = menus()
 m1 = menus()
 m2 = menus()
 m3 = menus()
 m4 = menus()
 int_timer = None
+_updater = None
 
 TOP_LEVEL_SCANNER_MENUS = ["X", "B", "MI","DV", "P"]
 TOP_LEVEL_SCANNER_SKIP_MENUS = ["M", "S", "G", "C", "T", "D", "I", "E", "U", "L", "Z", "P"]
 INDEX_SKIP_MENUS = ["W","E","M","Z","0","2","3","4","6","7","9","10","13"]
 SCANNER_SKIP_MENUS_1_TO_6 = ["0","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","42","M","Z"]
 SCANNER_SKIP_MENUS_7_TO_12 = ["0","1","2","3","4","5","6","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","42","M","Z"]
 SCANNER_SKIP_MENUS_13_TO_18 = ["0","1","2","3","4","5","6","7","8","9","10","11","12","19","20","21","22","23","24","25","26","27","28","29","30","31","32","42","M","Z"]
@@ -731,30 +732,38 @@
     global start_time
     timeSinceStarted = datetime.now() - start_time
     if (
         "telegram.error.Conflict" in tb_string
     ):  # A newer 2nd instance was registered. We should politely shutdown.
         if (
             timeSinceStarted.total_seconds() >= MINUTES_2_IN_SECONDS
-        ):  # shutdown only if we have been running for over 5 minutes
+        ):  # shutdown only if we have been running for over 2 minutes.
+            # This also prevents this newer instance to get shutdown.
+            # Instead the older instance will shutdown
             print(
                 f"Stopping due to conflict after running for {timeSinceStarted.total_seconds()/60} minutes."
             )
             try:
                 global int_timer
                 if int_timer is not None:
                     int_timer.cancel()
             except:
                 pass
+                #https://github.com/python-telegram-bot/python-telegram-bot/issues/209
+                # if _updater is not None:
+                #     _updater.stop() # Calling stop from within a handler will cause deadlock
             try:
-                context.application.stop()
-                sys.exit(0)
+                # context.dispatcher.stop()
+                thread.interrupt_main() # causes ctrl + c
+                # sys.exit(0)
             except RuntimeError:
-                context.application.shutdown()
-            sys.exit(0)
+                pass
+            except SystemExit:
+                thread.interrupt_main()
+            # sys.exit(0)
         else:
             print("Other instance running!")
             # context.application.run_polling(allowed_updates=Update.ALL_TYPES)
     # Build the message with some markup and additional information about what happened.
     # You might need to add some logic to deal with messages longer than the 4096 character limit.
     update_str = update.to_dict() if isinstance(update, Update) else str(update)
     message = (
@@ -1287,21 +1296,22 @@
 #     message_id=job.context.message_id
 #   )
 
 
 def runpkscreenerbot(availability=True) -> None:
     """Run the bot."""
     # Create the Application and pass it your bot's token.
-    global chat_idADMIN, Channel_Id, bot_available
+    global chat_idADMIN, Channel_Id, bot_available, _updater
     bot_available = availability
     Channel_Id, TOKEN, chat_idADMIN, GITHUB_TOKEN = get_secrets()
     # TOKEN = '1234567'
     # Channel_Id = 1001785195297
     # application = Application.builder().token(TOKEN).build()
     application = Updater(TOKEN)
+    _updater = application
     # Get the dispatcher to register handlers
     dispatcher = application.dispatcher
     # Setup conversation handler with the states FIRST and SECOND
     # Use the pattern parameter to pass CallbackQueries with specific
     # data pattern to the corresponding handlers.
     # ^ means "start of line/string"
     # $ means "end of line/string"
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener/pkscreenercli.py` & `pkscreener-0.45.20240602.429/pkscreener/pkscreenercli.py`

 * *Files 2% similar despite different names*

```diff
@@ -66,14 +66,15 @@
 
 printenabled=False
 originalStdOut=None
 original__stdout=None
 cron_runs=0
 
 def decorator(func):
+    # @infer_global(new_func)
     def new_func(*args, **kwargs):
         if printenabled:
             try:
                 func(*args,**kwargs)
             except Exception as e:# pragma: no cover
                 default_logger().debug(e, exc_info=True)
                 pass
@@ -262,14 +263,16 @@
         required=False,
     )
     argParser.add_argument(
         "--pipedmenus",
         help="Piped Menus",
         required=False,
     )
+    # args = " -a Y -e -p -u 6186237493 -o X:12:30::D:D:D:D:D".split(" ")
+    # argsv = argParser.parse_known_args(args=args)
     argsv = argParser.parse_known_args()
     args = argsv[0]
     # if sys.argv[0].endswith(".py"):
     #     args.monitor = 'X'
     #     args.answerdefault = 'Y'
     results = None
     resultStocks = None
@@ -370,14 +373,16 @@
     # From a previous call to main with args, it may have been mutated.
     # Let's stock to the original args passed by user
     try:
         savedPipedArgs = None
         savedPipedArgs = args.pipedmenus if args is not None and args.pipedmenus is not None else None
     except:
         pass
+    # args = " -a Y -e -p -u 6186237493 -o X:12:30::D:D:D:D:D".split(" ")
+    # argsv = argParser.parse_known_args(args=args)
     argsv = argParser.parse_known_args()
     args = argsv[0]
     if args.systemlaunched:
         args.systemlaunched = args.options
     
     # if sys.argv[0].endswith(".py"):
     #     args.monitor = 'X'
@@ -651,15 +656,31 @@
         configManager.default_logger = default_logger()
         if originalStdOut is None:
             # Clear only if this is the first time it's being called from some
             # loop within workflowtriggers.
             Utility.tools.clearScreen(userArgs=args, clearAlways=True)
         warnAboutDependencies()
         if args.prodbuild:
-            disableSysOut()
+            if args.options and len(args.options.split(":")) > 0:
+                indexOption = 0
+                doNotDisableGlobalPrint = False
+                while indexOption <= 15: # Max integer menu index in level1_X_MenuDict in MenuOptions.py
+                    # Menu option 30 is for ATR trailing stops which uses vectorbt
+                    # which in turn uses numba which requires print function to be inferred globally
+                    # If we try to override print with new_func, it expects this new_func
+                    # to be globally available. So to avoid these changes, let's just skip
+                    # prodmode for menu option 30
+                    doNotDisableGlobalPrint = f":{indexOption}:30:" in args.options
+                    if doNotDisableGlobalPrint:
+                        break
+                    indexOption += 1
+                if not doNotDisableGlobalPrint:
+                    disableSysOut()
+            else:
+                disableSysOut()
 
         if not configManager.checkConfigFile():
             configManager.setConfig(
                 ConfigManager.parser, default=True, showFileCreatedText=False
             )
         if args.systemlaunched:
             args.systemlaunched = args.options
@@ -719,15 +740,21 @@
             runApplication()
             from pkscreener.globals import closeWorkersAndExit
             closeWorkersAndExit()
             exitGracefully()
             sys.exit(0)
         else:
             runApplicationForScreening()
-    except:
+    except Exception as e:
+        if "RUNNER" not in os.environ.keys() and ('PKDevTools_Default_Log_Level' in os.environ.keys() and os.environ["PKDevTools_Default_Log_Level"] != str(log.logging.NOTSET)):
+                OutputControls().printOutput(
+                    "[+] RuntimeError with 'multiprocessing'.\n[+] Please contact the Developer, if this does not work!"
+                )
+                OutputControls().printOutput(e)
+                traceback.print_exc()
         pass
 
 def runLoopOnScheduleOrStdApplication(hasCronInterval):
     if hasCronInterval:
         scheduleNextRun()
     else:
         runApplication()
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener.egg-info/PKG-INFO` & `pkscreener-0.45.20240602.429/pkscreener.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: pkscreener
-Version: 0.45.20240602.428
+Version: 0.45.20240602.429
 Summary: A Python-based stock screener for NSE, India with alerts to Telegram Channel (pkscreener)
 Home-page: https://github.com/pkjmesra/pkscreener
-Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240602.428.zip
+Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240602.429.zip
 Author: pkjmesra
 Author-email: pkjmesra@gmail.com
 License: OSI Approved (MIT)
 Keywords: NSE,Technical Indicators,Scanning,Stock Scanners
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
@@ -39,15 +39,15 @@
 
 | Fair Value | Mutual funds, FII data | TTM Squeeze | Golden Crossover | Death Crossover|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | RSI screening | MACD scanners | IPO Stocks | Momentum Gainers | Watchlist screening |
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
-| Stock Performance | 52Wk H/L Breakouts | 10 days low breakouts | Aroon Crossover | Next Day Bullish Stocks|
+| Stock Performance | 52Wk-H/L Breakouts | 10 days low breakouts | Aroon Crossover | Next Day Bullish Stocks|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | Today's Breakouts | Breaking out now | Popular stocks by Mutual Funds / FIIs | Higher Highs | Lower Lows|
 | :-----------: | :-----------: | :--------: | :--------------: | ------------------- |
 
 | F&O Stocks screening | Live 5-EMA Index Scan | Logging | Telegram Channel | Early Breakouts |
 | :------------------: | :-------------------: | :-----: | :--------------: | --------------- |
@@ -274,19 +274,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.427/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240602.428/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240602.428/pkscreener.egg-info/SOURCES.txt` & `pkscreener-0.45.20240602.429/pkscreener.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240602.428/setup.py` & `pkscreener-0.45.20240602.429/setup.py`

 * *Files identical despite different names*

