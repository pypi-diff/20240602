# Comparing `tmp/pkscreener-0.45.20240601.424.tar.gz` & `tmp/pkscreener-0.45.20240601.425.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "pkscreener-0.45.20240601.424.tar", last modified: Sat Jun  1 10:57:26 2024, max compression
+gzip compressed data, was "pkscreener-0.45.20240601.425.tar", last modified: Sat Jun  1 22:57:25 2024, max compression
```

## Comparing `pkscreener-0.45.20240601.424.tar` & `pkscreener-0.45.20240601.425.tar`

### file list

```diff
@@ -1,50 +1,50 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 10:57:26.515632 pkscreener-0.45.20240601.424/
--rw-r--r--   0 runner    (1001) docker     (127)     1065 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/LICENSE
--rw-r--r--   0 runner    (1001) docker     (127)     1070 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/LICENSE-Others
--rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-01 10:57:26.515632 pkscreener-0.45.20240601.424/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)    26594 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/README.md
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 10:57:26.511632 pkscreener-0.45.20240601.424/pkscreener/
--rw-r--r--   0 runner    (1001) docker     (127)     1547 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 10:57:26.515632 pkscreener-0.45.20240601.424/pkscreener/classes/
--rw-r--r--   0 runner    (1001) docker     (127)    13194 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/ArtTexts.py
--rw-r--r--   0 runner    (1001) docker     (127)     9908 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Backtest.py
--rw-r--r--   0 runner    (1001) docker     (127)     5537 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Barometer.py
--rw-r--r--   0 runner    (1001) docker     (127)    16986 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/CandlePatterns.py
--rw-r--r--   0 runner    (1001) docker     (127)     1494 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Changelog.py
--rw-r--r--   0 runner    (1001) docker     (127)    34830 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/ConfigManager.py
--rw-r--r--   0 runner    (1001) docker     (127)    10050 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Fetcher.py
--rw-r--r--   0 runner    (1001) docker     (127)    13402 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/MarketMonitor.py
--rw-r--r--   0 runner    (1001) docker     (127)     3591 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/MarketStatus.py
--rw-r--r--   0 runner    (1001) docker     (127)    47230 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/MenuOptions.py
--rw-r--r--   0 runner    (1001) docker     (127)    12232 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/OtaUpdater.py
--rw-r--r--   0 runner    (1001) docker     (127)    24198 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PKMarketOpenCloseAnalyser.py
--rw-r--r--   0 runner    (1001) docker     (127)    22357 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PKScanRunner.py
--rw-r--r--   0 runner    (1001) docker     (127)     1588 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PKScheduledTaskProgress.py
--rw-r--r--   0 runner    (1001) docker     (127)     8143 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PKScheduler.py
--rw-r--r--   0 runner    (1001) docker     (127)     8298 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PKSpreadsheets.py
--rw-r--r--   0 runner    (1001) docker     (127)     1867 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PKTask.py
--rw-r--r--   0 runner    (1001) docker     (127)    19048 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Pktalib.py
--rw-r--r--   0 runner    (1001) docker     (127)    13876 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Portfolio.py
--rw-r--r--   0 runner    (1001) docker     (127)    47779 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/PortfolioXRay.py
--rw-r--r--   0 runner    (1001) docker     (127)   163367 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/ScreeningStatistics.py
--rw-r--r--   0 runner    (1001) docker     (127)    56446 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/StockScreener.py
--rw-r--r--   0 runner    (1001) docker     (127)     4885 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/UserMenuChoicesHandler.py
--rw-r--r--   0 runner    (1001) docker     (127)    85524 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/Utility.py
--rw-r--r--   0 runner    (1001) docker     (127)     3946 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/WorkflowManager.py
--rw-r--r--   0 runner    (1001) docker     (127)       28 2024-06-01 10:57:20.000000 pkscreener-0.45.20240601.424/pkscreener/classes/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     5122 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/classes/keys.py
--rw-r--r--   0 runner    (1001) docker     (127)   791436 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/courbd.ttf
--rw-r--r--   0 runner    (1001) docker     (127)   146905 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/globals.py
--rw-r--r--   0 runner    (1001) docker     (127)     1139 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/pkscreener.ini
--rw-r--r--   0 runner    (1001) docker     (127)    60748 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/pkscreenerbot.py
--rw-r--r--   0 runner    (1001) docker     (127)    34702 2024-06-01 10:55:37.000000 pkscreener-0.45.20240601.424/pkscreener/pkscreenercli.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 10:57:26.511632 pkscreener-0.45.20240601.424/pkscreener.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     1382 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)      120 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (127)      338 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)       11 2024-06-01 10:57:26.000000 pkscreener-0.45.20240601.424/pkscreener.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (127)       79 2024-06-01 10:57:26.515632 pkscreener-0.45.20240601.424/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (127)     5567 2024-06-01 10:55:38.000000 pkscreener-0.45.20240601.424/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 22:57:25.481785 pkscreener-0.45.20240601.425/
+-rw-r--r--   0 runner    (1001) docker     (127)     1065 2024-06-01 22:55:30.000000 pkscreener-0.45.20240601.425/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (127)     1070 2024-06-01 22:55:30.000000 pkscreener-0.45.20240601.425/LICENSE-Others
+-rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-01 22:57:25.481785 pkscreener-0.45.20240601.425/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)    26594 2024-06-01 22:55:30.000000 pkscreener-0.45.20240601.425/README.md
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 22:57:25.477785 pkscreener-0.45.20240601.425/pkscreener/
+-rw-r--r--   0 runner    (1001) docker     (127)     1598 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 22:57:25.481785 pkscreener-0.45.20240601.425/pkscreener/classes/
+-rw-r--r--   0 runner    (1001) docker     (127)    13194 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/ArtTexts.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9908 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Backtest.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5537 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Barometer.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16986 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/CandlePatterns.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1494 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Changelog.py
+-rw-r--r--   0 runner    (1001) docker     (127)    35718 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/ConfigManager.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10122 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Fetcher.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13402 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/MarketMonitor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3591 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/MarketStatus.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47369 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/MenuOptions.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12232 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/OtaUpdater.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24198 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PKMarketOpenCloseAnalyser.py
+-rw-r--r--   0 runner    (1001) docker     (127)    22357 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PKScanRunner.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1588 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PKScheduledTaskProgress.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8143 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PKScheduler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8298 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PKSpreadsheets.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1867 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PKTask.py
+-rw-r--r--   0 runner    (1001) docker     (127)    19048 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Pktalib.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13876 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Portfolio.py
+-rw-r--r--   0 runner    (1001) docker     (127)    47779 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/PortfolioXRay.py
+-rw-r--r--   0 runner    (1001) docker     (127)   164179 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/ScreeningStatistics.py
+-rw-r--r--   0 runner    (1001) docker     (127)    56446 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/StockScreener.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4885 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/UserMenuChoicesHandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)    85524 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/Utility.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3946 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/WorkflowManager.py
+-rw-r--r--   0 runner    (1001) docker     (127)       28 2024-06-01 22:57:19.000000 pkscreener-0.45.20240601.425/pkscreener/classes/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5122 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/classes/keys.py
+-rw-r--r--   0 runner    (1001) docker     (127)   791436 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/courbd.ttf
+-rw-r--r--   0 runner    (1001) docker     (127)   147055 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/globals.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1173 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/pkscreener.ini
+-rw-r--r--   0 runner    (1001) docker     (127)    60748 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/pkscreenerbot.py
+-rw-r--r--   0 runner    (1001) docker     (127)    34702 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/pkscreener/pkscreenercli.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-06-01 22:57:25.477785 pkscreener-0.45.20240601.425/pkscreener.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)    27511 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     1382 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)      120 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (127)      338 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       11 2024-06-01 22:57:25.000000 pkscreener-0.45.20240601.425/pkscreener.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       79 2024-06-01 22:57:25.481785 pkscreener-0.45.20240601.425/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (127)     5567 2024-06-01 22:55:31.000000 pkscreener-0.45.20240601.425/setup.py
```

### Comparing `pkscreener-0.45.20240601.424/LICENSE` & `pkscreener-0.45.20240601.425/LICENSE`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/LICENSE-Others` & `pkscreener-0.45.20240601.425/LICENSE-Others`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/PKG-INFO` & `pkscreener-0.45.20240601.425/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: pkscreener
-Version: 0.45.20240601.424
+Version: 0.45.20240601.425
 Summary: A Python-based stock screener for NSE, India with alerts to Telegram Channel (pkscreener)
 Home-page: https://github.com/pkjmesra/pkscreener
-Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240601.424.zip
+Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240601.425.zip
 Author: pkjmesra
 Author-email: pkjmesra@gmail.com
 License: OSI Approved (MIT)
 Keywords: NSE,Technical Indicators,Scanning,Stock Scanners
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
@@ -274,19 +274,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240601.424/README.md` & `pkscreener-0.45.20240601.425/README.md`

 * *Files 0% similar despite different names*

```diff
@@ -252,19 +252,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/__init__.py` & `pkscreener-0.45.20240601.425/pkscreener/__init__.py`

 * *Files 6% similar despite different names*

```diff
@@ -28,8 +28,9 @@
     "scipy": find_spec("scipy") is not None,
     "sklearn": find_spec("sklearn") is not None,
     "talib": find_spec("talib") is not None,
     "pandas_ta": find_spec("pandas_ta") is not None,
     "tensorflow": find_spec("tensorflow") is not None,
     "keras": find_spec("keras") is not None,
     "yfinance": find_spec("yfinance") is not None,
+    "vectorbt": find_spec("vectorbt") is not None,
 }
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/ArtTexts.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/ArtTexts.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Backtest.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Backtest.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Barometer.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Barometer.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/CandlePatterns.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/CandlePatterns.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Changelog.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Changelog.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/ConfigManager.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/ConfigManager.py`

 * *Files 3% similar despite different names*

```diff
@@ -66,14 +66,15 @@
         self.backtestPeriod = 120
         self.maxBacktestWindow = 30
         self.minVolume = 10000
         self.morninganalysiscandlenumber = 25 # 9:40am IST, since market opens at 9:15am IST
         self.morninganalysiscandleduration = '1m'
         self.logger = None
         self.showPastStrategyData = False
+        self.showPinnedMenuEvenForNoResult = True
         self.atrTrailingStopSensitivity = 1
         self.atrTrailingStopPeriod = 10
         self.atrTrailingStopEMAPeriod = 200
         # This determines how many days apart the backtest calculations are run.
         # For example, for weekly backtest calculations, set this to 5 (5 days = 1 week)
         # For fortnightly, set this to 10 and so on (10 trading sessions = 2 weeks)
         self.backtestPeriodFactor = 1
@@ -167,14 +168,15 @@
             parser.set("config", "maxNetworkRetryCount", str(self.maxNetworkRetryCount))
             parser.set("config", "maxNumResultRowsInMonitor", str(self.maxNumResultRowsInMonitor))
             parser.set("config", "morninganalysiscandlenumber", str(self.morninganalysiscandlenumber))
             parser.set("config", "morninganalysiscandleduration", self.morninganalysiscandleduration)
             parser.set("config", "onlyStageTwoStocks", "y" if self.stageTwo else "n")
             parser.set("config", "period", self.period)
             parser.set("config", "showPastStrategyData", "y" if self.showPastStrategyData else "n")
+            parser.set("config", "showPinnedMenuEvenForNoResult", "y" if self.showPinnedMenuEvenForNoResult else "n")
             parser.set("config", "showunknowntrends", "y" if self.showunknowntrends else "n")
             parser.set("config", "shuffle", "y" if self.shuffleEnabled else "n")
             parser.set("config", "useEMA", "y" if self.useEMA else "n")
             parser.set("config", "vcpVolumeContractionRatio", str(self.vcpVolumeContractionRatio))
 
             parser.set("filters", "consolidationPercentage", str(self.consolidationPercentage))
             parser.set("filters", "maxPrice", str(self.maxLTP))
@@ -275,14 +277,19 @@
                     ) or ('y' if self.enablePortfolioCalculations else 'n')
                 ).lower()
                 self.showPastStrategyData = str(
                     input(
                         f"[+] Enable showing past strategy data? [Y/N, Current: {colorText.FAIL}{'y' if self.showPastStrategyData else 'n'}{colorText.END}]: "
                     ) or ('y' if self.showPastStrategyData else 'n')
                 ).lower()
+                self.showPinnedMenuEvenForNoResult = str(
+                    input(
+                        f"[+] Enable showing pinned menu even when there is no result? [Y/N, Current: {colorText.FAIL}{'y' if self.showPinnedMenuEvenForNoResult else 'n'}{colorText.END}]: "
+                    ) or ('y' if self.showPinnedMenuEvenForNoResult else 'n')
+                ).lower()
                 self.calculatersiintraday = str(
                     input(
                         f"[+] Calculate intraday RSI during trading hours? [Y/N, Current: {colorText.FAIL}{'y' if self.calculatersiintraday else 'n'}{colorText.END}]: "
                     ) or ('y' if self.calculatersiintraday else 'n')
                 ).lower()
                 self.generalTimeout = input(
                     f"[+] General network timeout (in seconds)(Optimal = 2 for good networks, Current: {colorText.FAIL}{self.generalTimeout}{colorText.END}): "
@@ -369,14 +376,15 @@
                 parser.set("config", "morninganalysiscandlenumber", str(self.morninganalysiscandlenumber))
                 parser.set("config", "onlyStageTwoStocks", str(self.stageTwoPrompt))
                 if self.period:
                     endPeriod = str(self.period)[-1].lower()
                     endPeriod = "d" if endPeriod not in ["d","o","y","x"] else ""
                 parser.set("config", "period", str(self.period + endPeriod))
                 parser.set("config", "showPastStrategyData", str(self.showPastStrategyData))
+                parser.set("config", "showPinnedMenuEvenForNoResult", str(self.showPinnedMenuEvenForNoResult))
                 parser.set("config", "showunknowntrends", str(self.showunknowntrendsPrompt))
                 parser.set("config", "shuffle", str(self.shuffle))
                 parser.set("config", "useEMA", str(self.useEmaPrompt))
                 parser.set("config", "vcpVolumeContractionRatio", str(self.vcpVolumeContractionRatio))
 
                 parser.set("filters", "consolidationPercentage", str(self.consolidationPercentage))
                 parser.set("filters", "maxPrice", str(self.maxLTP))
@@ -475,14 +483,19 @@
                     else True
                 )
                 self.showPastStrategyData = (
                     False
                     if "y" not in str(parser.get("config", "showPastStrategyData")).lower()
                     else True
                 )
+                self.showPinnedMenuEvenForNoResult = (
+                    False
+                    if "y" not in str(parser.get("config", "showPinnedMenuEvenForNoResult")).lower()
+                    else True
+                )
                 self.calculatersiintraday = (
                     False
                     if "y" not in str(parser.get("config", "calculatersiintraday")).lower()
                     else True
                 )
                 self.atrTrailingStopEMAPeriod = int(parser.get("config", "atrtrailingstopemaperiod"))
                 self.atrTrailingStopPeriod = int(parser.get("config", "atrtrailingstopperiod"))
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Fetcher.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Fetcher.py`

 * *Files 2% similar despite different names*

```diff
@@ -89,18 +89,18 @@
         printCounter=False,
         start=None, 
         end=None,
         exchangeSuffix=".NS"
     ):
         if isinstance(stockCode,list):
             if len(exchangeSuffix) > 0:
-                stockCode = [(f"{x}{exchangeSuffix}" if not x.endswith(exchangeSuffix) else x) for x in stockCode]
+                stockCode = [(f"{x}{exchangeSuffix}" if (not x.endswith(exchangeSuffix) and not stockCode.startswith("^")) else x) for x in stockCode]
         elif isinstance(stockCode,str):
             if len(exchangeSuffix) > 0:
-                stockCode = f"{stockCode}{exchangeSuffix}" if not stockCode.endswith(exchangeSuffix) else stockCode
+                stockCode = f"{stockCode}{exchangeSuffix}" if (not stockCode.endswith(exchangeSuffix) and not stockCode.startswith("^")) else stockCode
         if (period == '1d' or duration[-1] == "m"):
             # Since this is intraday data, we'd just need to start from the last trading session
             if start is None:
                 start = PKDateUtilities.tradingDate().strftime("%Y-%m-%d")
             if end is None:
                 end = PKDateUtilities.currentDateTime().strftime("%Y-%m-%d")
             if start == end:
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/MarketMonitor.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/MarketMonitor.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/MarketStatus.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/MarketStatus.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/MenuOptions.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/MenuOptions.py`

 * *Files 0% similar despite different names*

```diff
@@ -132,15 +132,15 @@
     "M": "Back to the Top/Main menu",
     "Z": "Exit (Ctrl + C)",
 }
 level1_X_MenuDict = {
     "W": "Screen stocks from my own Watchlist",
     "N": "Nifty Prediction using Artifical Intelligence (Use for Gap-Up/Gap-Down/BTST/STBT)",
     "E": "Live Index Scan : 5 EMA for Intraday",
-    "0": "Screen stocks by the stock names (NSE Stock Code)",
+    "0": "Screen stocks/index by the stock/index names (NSE Stock Code or index, e.g. ^NSEI, ^NSEBANK, ^BSESN)",
     "1": "Nifty 50          ",
     "2": "Nifty Next 50     ",
     "3": "Nifty 100         ",
     "4": "Nifty 200         ",
     "5": "Nifty 500         ",
     "6": "Nifty Smallcap 50 ",
     "7": "Nifty Smallcap 100",
@@ -424,14 +424,16 @@
         substituteIndex = 0
         for key in rawDictionary:
             if skip is not None and key in skip:
                 continue
             m = menu()
             menuText = rawDictionary[key]
             if "{0}" in menuText and len(substitutes) > 0:
+                if substitutes[substituteIndex] == 0:
+                    continue
                 menuText = menuText.format(f"{colorText.WARN}{substitutes[substituteIndex]}{colorText.END}")
                 substituteIndex += 1
             m.create(
                 str(key).upper(), menuText, level=self.level, parent=parent
             )
             if key in renderExceptionKeys:
                 m.isException = True
@@ -845,15 +847,15 @@
             level1_X_MenuDict,
             renderExceptionKeys=["W", "0", "M", "15"],
             renderStyle=renderStyle
             if renderStyle is not None
             else MenuRenderStyle.THREE_PER_ROW,
             skip=skip,
             parent=parent,
-        ).render(asList=asList, coloredValues=["15",str(configManager.defaultIndex)] if not asList else [])
+        ).render(asList=asList, coloredValues=["0", "15",str(configManager.defaultIndex)] if not asList else [])
         if asList:
             return menuText
         else:
             if OutputControls().enableMultipleLineOutput:
                 OutputControls().printOutput(
                     colorText.BOLD
                     + colorText.WARN
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/OtaUpdater.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/OtaUpdater.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PKMarketOpenCloseAnalyser.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PKMarketOpenCloseAnalyser.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PKScanRunner.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PKScanRunner.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PKScheduledTaskProgress.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PKScheduledTaskProgress.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PKScheduler.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PKScheduler.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PKSpreadsheets.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PKSpreadsheets.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PKTask.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PKTask.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Pktalib.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Pktalib.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Portfolio.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Portfolio.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/PortfolioXRay.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/PortfolioXRay.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/ScreeningStatistics.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/ScreeningStatistics.py`

 * *Files 0% similar despite different names*

```diff
@@ -819,9393 +819,9444 @@
 00003320: 7365 7263 6f6e 7465 6e74 2e63 6f6d 2f70  sercontent.com/p
 00003330: 6f6c 616b 6f77 6f2f 7665 6374 6f72 6274  olakowo/vectorbt
 00003340: 2f6d 6173 7465 722f 7665 6374 6f72 6274  /master/vectorbt
 00003350: 2f74 656d 706c 6174 6573 2f73 6561 626f  /templates/seabo
 00003360: 726e 2e6a 736f 6e22 0a20 2020 2020 2020  rn.json".       
 00003370: 2066 696c 6555 524c 7320 3d20 5b6a 736f   fileURLs = [jso
 00003380: 6e31 2c6a 736f 6e32 2c6a 736f 6e33 5d0a  n1,json2,json3].
-00003390: 2020 2020 2020 2020 6620 3d20 6665 7463          f = fetc
-000033a0: 6865 7228 290a 2020 2020 2020 2020 6672  her().        fr
-000033b0: 6f6d 2050 4b44 6576 546f 6f6c 732e 636c  om PKDevTools.cl
-000033c0: 6173 7365 732e 5574 696c 7320 696d 706f  asses.Utils impo
-000033d0: 7274 2072 616e 646f 6d5f 7573 6572 5f61  rt random_user_a
-000033e0: 6765 6e74 0a20 2020 2020 2020 2066 6f72  gent.        for
-000033f0: 2075 726c 2069 6e20 6669 6c65 5552 4c73   url in fileURLs
-00003400: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00003410: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00003420: 2020 2070 6174 6820 3d20 6f73 2e70 6174     path = os.pat
-00003430: 682e 6a6f 696e 286f 7574 7075 7446 6f6c  h.join(outputFol
-00003440: 6465 722c 7572 6c2e 7370 6c69 7428 222f  der,url.split("/
-00003450: 2229 5b2d 315d 290a 2020 2020 2020 2020  ")[-1]).        
-00003460: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00003470: 732e 7061 7468 2e65 7869 7374 7328 7061  s.path.exists(pa
-00003480: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-00003490: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000034a0: 2e73 686f 756c 644c 6f67 3a0a 2020 2020  .shouldLog:.    
-000034b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000034c0: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
-000034d0: 5f6c 6f67 6765 722e 6465 6275 6728 6622  _logger.debug(f"
-000034e0: 4665 7463 6869 6e67 207b 7572 6c7d 2074  Fetching {url} t
-000034f0: 6f20 6b65 6570 2061 7420 7b70 6174 687d  o keep at {path}
-00003500: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00003510: 2020 2020 2020 2072 6573 7020 3d20 662e         resp = f.
-00003520: 6665 7463 6855 524c 2875 726c 3d75 726c  fetchURL(url=url
-00003530: 2c74 7269 616c 3d33 2c74 696d 656f 7574  ,trial=3,timeout
-00003540: 3d35 2c68 6561 6465 7273 3d7b 2775 7365  =5,headers={'use
-00003550: 722d 6167 656e 7427 3a20 6627 7b72 616e  r-agent': f'{ran
-00003560: 646f 6d5f 7573 6572 5f61 6765 6e74 2829  dom_user_agent()
-00003570: 7d27 7d29 0a20 2020 2020 2020 2020 2020  }'}).           
-00003580: 2020 2020 2020 2020 2069 6620 7265 7370           if resp
-00003590: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000035a0: 2072 6573 702e 7374 6174 7573 5f63 6f64   resp.status_cod
-000035b0: 6520 3d3d 2032 3030 3a0a 2020 2020 2020  e == 200:.      
-000035c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035d0: 2020 7769 7468 206f 7065 6e28 7061 7468    with open(path
-000035e0: 2c20 2277 2229 2061 7320 663a 0a20 2020  , "w") as f:.   
-000035f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003600: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-00003610: 2872 6573 702e 7465 7874 290a 2020 2020  (resp.text).    
-00003620: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00003630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003640: 2020 2020 2020 6966 2073 656c 662e 7368        if self.sh
-00003650: 6f75 6c64 4c6f 673a 0a20 2020 2020 2020  ouldLog:.       
-00003660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003670: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-00003680: 6767 6572 2e64 6562 7567 2866 2241 6c72  gger.debug(f"Alr
-00003690: 6561 6479 2065 7869 7374 733a 207b 7061  eady exists: {pa
-000036a0: 7468 7d22 290a 2020 2020 2020 2020 2020  th}").          
-000036b0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000036c0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-000036d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000036e0: 2e73 686f 756c 644c 6f67 3a0a 2020 2020  .shouldLog:.    
-000036f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003700: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
-00003710: 6765 722e 6465 6275 6728 652c 2065 7863  ger.debug(e, exc
-00003720: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
-00003730: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00003740: 696e 7565 0a0a 2020 2020 2343 616c 6375  inue..    #Calcu
-00003750: 6c61 7469 6e67 2073 6967 6e61 6c73 0a20  lating signals. 
-00003760: 2020 2064 6566 2063 6f6d 7075 7465 4275     def computeBu
-00003770: 7953 656c 6c53 6967 6e61 6c73 2873 656c  ySellSignals(sel
-00003780: 662c 6466 2c65 6d61 5f70 6572 696f 643d  f,df,ema_period=
-00003790: 3230 302c 7265 7472 793d 5472 7565 293a  200,retry=True):
-000037a0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000037b0: 2020 2020 2020 2020 2020 6672 6f6d 2076            from v
-000037c0: 6563 746f 7262 742e 696e 6469 6361 746f  ectorbt.indicato
-000037d0: 7273 2069 6d70 6f72 7420 4d41 2061 7320  rs import MA as 
-000037e0: 7662 740a 2020 2020 2020 2020 2020 2020  vbt.            
-000037f0: 656d 6120 3d20 7662 742e 7275 6e28 6466  ema = vbt.run(df
-00003800: 5b22 436c 6f73 6522 5d2c 2031 2c20 7368  ["Close"], 1, sh
-00003810: 6f72 745f 6e61 6d65 3d27 454d 4127 2c20  ort_name='EMA', 
-00003820: 6577 6d3d 5472 7565 290a 2020 2020 2020  ewm=True).      
-00003830: 2020 2020 2020 6466 5b22 4162 6f76 6522        df["Above"
-00003840: 5d20 3d20 656d 612e 6d61 5f63 726f 7373  ] = ema.ma_cross
-00003850: 6564 5f61 626f 7665 2864 665b 2241 5452  ed_above(df["ATR
-00003860: 5472 6169 6c69 6e67 5374 6f70 225d 290a  TrailingStop"]).
-00003870: 2020 2020 2020 2020 2020 2020 6466 5b22              df["
-00003880: 4265 6c6f 7722 5d20 3d20 656d 612e 6d61  Below"] = ema.ma
-00003890: 5f63 726f 7373 6564 5f62 656c 6f77 2864  _crossed_below(d
-000038a0: 665b 2241 5452 5472 6169 6c69 6e67 5374  f["ATRTrailingSt
-000038b0: 6f70 225d 290a 2020 2020 2020 2020 6578  op"]).        ex
-000038c0: 6365 7074 2028 4f53 4572 726f 722c 4669  cept (OSError,Fi
-000038d0: 6c65 4e6f 7446 6f75 6e64 4572 726f 7229  leNotFoundError)
-000038e0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000038f0: 2020 2069 6620 7365 6c66 2e73 686f 756c     if self.shoul
-00003900: 644c 6f67 3a0a 2020 2020 2020 2020 2020  dLog:.          
-00003910: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
-00003920: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
-00003930: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
-00003940: 290a 2020 2020 2020 2020 2020 2020 4f75  ).            Ou
-00003950: 7470 7574 436f 6e74 726f 6c73 2829 2e70  tputControls().p
-00003960: 7269 6e74 4f75 7470 7574 2866 227b 636f  rintOutput(f"{co
-00003970: 6c6f 7254 6578 742e 4641 494c 7d53 6f6d  lorText.FAIL}Som
-00003980: 6520 6465 7065 6e64 656e 6369 6573 2061  e dependencies a
-00003990: 7265 206d 6973 7369 6e67 2e20 5472 7920  re missing. Try 
-000039a0: 616e 6420 7275 6e20 7468 6973 206f 7074  and run this opt
-000039b0: 696f 6e20 6167 6169 6e2e 7b63 6f6c 6f72  ion again.{color
-000039c0: 5465 7874 2e45 4e44 7d22 290a 2020 2020  Text.END}").    
-000039d0: 2020 2020 2020 2020 2320 4f53 4572 726f          # OSErro
-000039e0: 723a 5241 4c4c 4953 3a20 5b45 7272 6e6f  r:RALLIS: [Errno
-000039f0: 2032 5d20 4e6f 2073 7563 6820 6669 6c65   2] No such file
-00003a00: 206f 7220 6469 7265 6374 6f72 793a 2027   or directory: '
-00003a10: 2f74 6d70 2f5f 4d45 497a 6f54 5636 412f  /tmp/_MEIzoTV6A/
-00003a20: 7665 6374 6f72 6274 2f74 656d 706c 6174  vectorbt/templat
-00003a30: 6573 2f6c 6967 6874 2e6a 736f 6e27 0a20  es/light.json'. 
-00003a40: 2020 2020 2020 2020 2020 2069 6620 224e             if "N
-00003a50: 6f20 7375 6368 2066 696c 6520 6f72 2064  o such file or d
-00003a60: 6972 6563 746f 7279 2220 696e 2073 7472  irectory" in str
-00003a70: 2865 293a 0a20 2020 2020 2020 2020 2020  (e):.           
-00003a80: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00003a90: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00003aa0: 706f 7274 206f 730a 2020 2020 2020 2020  port os.        
-00003ab0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-00003ac0: 7574 466f 6c64 6572 203d 204e 6f6e 650a  utFolder = None.
-00003ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ae0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00003af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003b00: 206f 7574 7075 7446 6f6c 6465 7220 3d20   outputFolder = 
-00003b10: 6f73 2e73 6570 2e6a 6f69 6e28 652e 6669  os.sep.join(e.fi
-00003b20: 6c65 6e61 6d65 2e73 706c 6974 286f 732e  lename.split(os.
-00003b30: 7365 7029 5b3a 2d31 5d29 0a20 2020 2020  sep)[:-1]).     
-00003b40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00003b50: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-00003b60: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00003b70: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00003b80: 2073 656c 662e 7368 6f75 6c64 4c6f 673a   self.shouldLog:
-00003b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ba0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00003bb0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-00003bc0: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-00003bd0: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-00003be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003bf0: 206f 7574 7075 7446 6f6c 6465 7220 3d20   outputFolder = 
-00003c00: 6f73 2e73 6570 2e6a 6f69 6e28 7374 7228  os.sep.join(str(
-00003c10: 6529 2e73 706c 6974 2822 5c6e 2229 5b30  e).split("\n")[0
-00003c20: 5d2e 7370 6c69 7428 223a 2022 295b 315d  ].split(": ")[1]
-00003c30: 2e72 6570 6c61 6365 2822 2722 2c22 2229  .replace("'","")
-00003c40: 2e73 706c 6974 286f 732e 7365 7029 5b3a  .split(os.sep)[:
-00003c50: 2d31 5d29 0a20 2020 2020 2020 2020 2020  -1]).           
-00003c60: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00003c70: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00003c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c90: 6966 2073 656c 662e 7368 6f75 6c64 4c6f  if self.shouldLo
-00003ca0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-00003cb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003cc0: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
-00003cd0: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
-00003ce0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00003cf0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00003d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d10: 7365 6c66 2e64 6f77 6e6c 6f61 6453 6176  self.downloadSav
-00003d20: 6554 656d 706c 6174 654a 736f 6e73 286f  eTemplateJsons(o
-00003d30: 7574 7075 7446 6f6c 6465 7229 0a20 2020  utputFolder).   
-00003d40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00003d50: 7265 7472 793a 0a20 2020 2020 2020 2020  retry:.         
-00003d60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003d70: 6e20 7365 6c66 2e63 6f6d 7075 7465 4275  n self.computeBu
-00003d80: 7953 656c 6c53 6967 6e61 6c73 2864 662c  ySellSignals(df,
-00003d90: 656d 615f 7065 7269 6f64 3d65 6d61 5f70  ema_period=ema_p
-00003da0: 6572 696f 642c 7265 7472 793d 4661 6c73  eriod,retry=Fals
-00003db0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00003dc0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-00003dd0: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-00003de0: 706f 7274 4572 726f 7220 6173 2065 3a0a  portError as e:.
-00003df0: 2020 2020 2020 2020 2020 2020 4f75 7470              Outp
-00003e00: 7574 436f 6e74 726f 6c73 2829 2e70 7269  utControls().pri
-00003e10: 6e74 4f75 7470 7574 2866 227b 636f 6c6f  ntOutput(f"{colo
-00003e20: 7254 6578 742e 4641 494c 7d54 6865 206d  rText.FAIL}The m
-00003e30: 6169 6e20 6d6f 6475 6c65 206e 6565 6465  ain module neede
-00003e40: 6420 666f 7220 6265 7374 2042 7579 2f53  d for best Buy/S
-00003e50: 656c 6c20 7265 7375 6c74 2063 616c 6375  ell result calcu
-00003e60: 6c61 7469 6f6e 2069 7320 6d69 7373 696e  lation is missin
-00003e70: 672e 2046 616c 6c69 6e67 2062 6163 6b20  g. Falling back 
-00003e80: 6f6e 2061 6e20 616c 7465 726e 6174 6976  on an alternativ
-00003e90: 652c 2062 7574 2069 7420 6973 206e 6f74  e, but it is not
-00003ea0: 2076 6572 7920 7265 6c69 6162 6c65 2e7b   very reliable.{
-00003eb0: 636f 6c6f 7254 6578 742e 454e 447d 2229  colorText.END}")
-00003ec0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003ed0: 7365 6c66 2e73 686f 756c 644c 6f67 3a0a  self.shouldLog:.
-00003ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ef0: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
-00003f00: 6765 722e 6465 6275 6728 652c 2065 7863  ger.debug(e, exc
-00003f10: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
-00003f20: 2020 2020 2020 2020 656d 6120 3d20 706b          ema = pk
-00003f30: 7461 6c69 622e 454d 4128 6466 5b22 436c  talib.EMA(df["Cl
-00003f40: 6f73 6522 5d2c 2065 6d61 5f70 6572 696f  ose"], ema_perio
-00003f50: 6429 2069 6620 656d 615f 7065 7269 6f64  d) if ema_period
-00003f60: 203e 2031 2065 6c73 6520 6466 5b22 436c   > 1 else df["Cl
-00003f70: 6f73 6522 5d23 7368 6f72 745f 6e61 6d65  ose"]#short_name
-00003f80: 3d27 454d 4127 2c20 6577 6d3d 5472 7565  ='EMA', ewm=True
-00003f90: 2920 2020 2020 2020 200a 2020 2020 2020  )        .      
-00003fa0: 2020 2020 2020 6466 5b22 4162 6f76 6522        df["Above"
-00003fb0: 5d20 3d20 656d 6120 3e20 6466 5b22 4154  ] = ema > df["AT
-00003fc0: 5254 7261 696c 696e 6753 746f 7022 5d0a  RTrailingStop"].
-00003fd0: 2020 2020 2020 2020 2020 2020 6466 5b22              df["
-00003fe0: 4265 6c6f 7722 5d20 3d20 656d 6120 3c20  Below"] = ema < 
-00003ff0: 6466 5b22 4154 5254 7261 696c 696e 6753  df["ATRTrailingS
-00004000: 746f 7022 5d20 2020 2020 2020 200a 2020  top"]        .  
-00004010: 2020 2020 2020 0a20 2020 2020 2020 2064        .        d
-00004020: 665b 2242 7579 225d 203d 2028 6466 5b22  f["Buy"] = (df["
-00004030: 436c 6f73 6522 5d20 3e20 6466 5b22 4154  Close"] > df["AT
-00004040: 5254 7261 696c 696e 6753 746f 7022 5d29  RTrailingStop"])
-00004050: 2026 2028 6466 5b22 4162 6f76 6522 5d3d   & (df["Above"]=
-00004060: 3d54 7275 6529 0a20 2020 2020 2020 2064  =True).        d
-00004070: 665b 2253 656c 6c22 5d20 3d20 2864 665b  f["Sell"] = (df[
-00004080: 2243 6c6f 7365 225d 203c 2064 665b 2241  "Close"] < df["A
-00004090: 5452 5472 6169 6c69 6e67 5374 6f70 225d  TRTrailingStop"]
-000040a0: 2920 2620 2864 665b 2242 656c 6f77 225d  ) & (df["Below"]
-000040b0: 3d3d 5472 7565 290a 0a20 2020 2020 2020  ==True)..       
-000040c0: 2072 6574 7572 6e20 6466 0a0a 2020 2020   return df..    
-000040d0: 6465 6620 6669 6e64 4275 7953 656c 6c53  def findBuySellS
-000040e0: 6967 6e61 6c73 4672 6f6d 4154 5254 7261  ignalsFromATRTra
-000040f0: 696c 696e 6728 7365 6c66 2c64 662c 206b  iling(self,df, k
-00004100: 6579 5f76 616c 7565 3d31 2c20 6174 725f  ey_value=1, atr_
-00004110: 7065 7269 6f64 3d31 302c 2065 6d61 5f70  period=10, ema_p
-00004120: 6572 696f 643d 3230 302c 6275 7953 656c  eriod=200,buySel
-00004130: 6c41 6c6c 3d31 2c73 6176 6544 6963 743d  lAll=1,saveDict=
-00004140: 4e6f 6e65 2c73 6372 6565 6e44 6963 743d  None,screenDict=
-00004150: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-00004160: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-00004170: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-00004180: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00004190: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-000041a0: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-000041b0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000041c0: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
-000041d0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-000041e0: 612e 7265 706c 6163 6528 5b6e 702e 696e  a.replace([np.in
-000041f0: 662c 202d 6e70 2e69 6e66 5d2c 2030 290a  f, -np.inf], 0).
-00004200: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00004210: 6174 615b 3a3a 2d31 5d20 2023 2052 6576  ata[::-1]  # Rev
-00004220: 6572 7365 2074 6865 2064 6174 6166 7261  erse the datafra
-00004230: 6d65 2073 6f20 7468 6174 2069 7473 2074  me so that its t
-00004240: 6865 206f 6c64 6573 7420 6461 7465 2066  he oldest date f
-00004250: 6972 7374 0a0a 2020 2020 2020 2020 2320  irst..        # 
-00004260: 4361 6c63 756c 6174 6520 4154 5220 616e  Calculate ATR an
-00004270: 6420 7841 5452 5472 6169 6c69 6e67 5374  d xATRTrailingSt
-00004280: 6f70 0a20 2020 2020 2020 2078 4154 5220  op.        xATR 
-00004290: 3d20 6e70 2e61 7272 6179 2870 6b74 616c  = np.array(pktal
-000042a0: 6962 2e41 5452 2864 6174 615b 2748 6967  ib.ATR(data['Hig
-000042b0: 6827 5d2c 2064 6174 615b 274c 6f77 275d  h'], data['Low']
-000042c0: 2c20 6461 7461 5b27 436c 6f73 6527 5d2c  , data['Close'],
-000042d0: 2074 696d 6570 6572 696f 643d 6174 725f   timeperiod=atr_
-000042e0: 7065 7269 6f64 2929 0a20 2020 2020 2020  period)).       
-000042f0: 206e 4c6f 7373 203d 206b 6579 5f76 616c   nLoss = key_val
-00004300: 7565 202a 2078 4154 520a 2020 2020 2020  ue * xATR.      
-00004310: 2020 7372 6320 3d20 6461 7461 5b27 436c    src = data['Cl
-00004320: 6f73 6527 5d0a 2020 2020 2020 2020 2320  ose'].        # 
-00004330: 496e 6974 6961 6c69 7a65 2061 7272 6179  Initialize array
-00004340: 730a 2020 2020 2020 2020 7841 5452 5472  s.        xATRTr
-00004350: 6169 6c69 6e67 5374 6f70 203d 206e 702e  ailingStop = np.
-00004360: 7a65 726f 7328 6c65 6e28 6461 7461 2929  zeros(len(data))
-00004370: 0a20 2020 2020 2020 2078 4154 5254 7261  .        xATRTra
-00004380: 696c 696e 6753 746f 705b 305d 203d 2073  ilingStop[0] = s
-00004390: 7263 5b30 5d20 2d20 6e4c 6f73 735b 305d  rc[0] - nLoss[0]
-000043a0: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
-000043b0: 756c 6174 6520 7841 5452 5472 6169 6c69  ulate xATRTraili
-000043c0: 6e67 5374 6f70 2075 7369 6e67 2076 6563  ngStop using vec
-000043d0: 746f 7269 7a65 6420 6f70 6572 6174 696f  torized operatio
-000043e0: 6e73 0a20 2020 2020 2020 206d 6173 6b5f  ns.        mask_
-000043f0: 3120 3d20 2873 7263 203e 206e 702e 726f  1 = (src > np.ro
-00004400: 6c6c 2878 4154 5254 7261 696c 696e 6753  ll(xATRTrailingS
-00004410: 746f 702c 2031 2929 2026 2028 6e70 2e72  top, 1)) & (np.r
-00004420: 6f6c 6c28 7372 632c 2031 2920 3e20 6e70  oll(src, 1) > np
-00004430: 2e72 6f6c 6c28 7841 5452 5472 6169 6c69  .roll(xATRTraili
-00004440: 6e67 5374 6f70 2c20 3129 290a 2020 2020  ngStop, 1)).    
-00004450: 2020 2020 6d61 736b 5f32 203d 2028 7372      mask_2 = (sr
-00004460: 6320 3c20 6e70 2e72 6f6c 6c28 7841 5452  c < np.roll(xATR
-00004470: 5472 6169 6c69 6e67 5374 6f70 2c20 3129  TrailingStop, 1)
-00004480: 2920 2620 286e 702e 726f 6c6c 2873 7263  ) & (np.roll(src
-00004490: 2c20 3129 203c 206e 702e 726f 6c6c 2878  , 1) < np.roll(x
-000044a0: 4154 5254 7261 696c 696e 6753 746f 702c  ATRTrailingStop,
-000044b0: 2031 2929 0a20 2020 2020 2020 206d 6173   1)).        mas
-000044c0: 6b5f 3320 3d20 7372 6320 3e20 6e70 2e72  k_3 = src > np.r
-000044d0: 6f6c 6c28 7841 5452 5472 6169 6c69 6e67  oll(xATRTrailing
-000044e0: 5374 6f70 2c20 3129 0a0a 2020 2020 2020  Stop, 1)..      
-000044f0: 2020 7841 5452 5472 6169 6c69 6e67 5374    xATRTrailingSt
-00004500: 6f70 203d 206e 702e 7768 6572 6528 6d61  op = np.where(ma
-00004510: 736b 5f31 2c20 6e70 2e6d 6178 696d 756d  sk_1, np.maximum
-00004520: 286e 702e 726f 6c6c 2878 4154 5254 7261  (np.roll(xATRTra
-00004530: 696c 696e 6753 746f 702c 2031 292c 2073  ilingStop, 1), s
-00004540: 7263 202d 206e 4c6f 7373 292c 2078 4154  rc - nLoss), xAT
-00004550: 5254 7261 696c 696e 6753 746f 7029 0a20  RTrailingStop). 
-00004560: 2020 2020 2020 2078 4154 5254 7261 696c         xATRTrail
-00004570: 696e 6753 746f 7020 3d20 6e70 2e77 6865  ingStop = np.whe
-00004580: 7265 286d 6173 6b5f 322c 206e 702e 6d69  re(mask_2, np.mi
-00004590: 6e69 6d75 6d28 6e70 2e72 6f6c 6c28 7841  nimum(np.roll(xA
-000045a0: 5452 5472 6169 6c69 6e67 5374 6f70 2c20  TRTrailingStop, 
-000045b0: 3129 2c20 7372 6320 2b20 6e4c 6f73 7329  1), src + nLoss)
-000045c0: 2c20 7841 5452 5472 6169 6c69 6e67 5374  , xATRTrailingSt
-000045d0: 6f70 290a 2020 2020 2020 2020 7841 5452  op).        xATR
-000045e0: 5472 6169 6c69 6e67 5374 6f70 203d 206e  TrailingStop = n
-000045f0: 702e 7768 6572 6528 6d61 736b 5f33 2c20  p.where(mask_3, 
-00004600: 7372 6320 2d20 6e4c 6f73 732c 2078 4154  src - nLoss, xAT
-00004610: 5254 7261 696c 696e 6753 746f 7029 0a0a  RTrailingStop)..
-00004620: 2020 2020 2020 2020 6d61 736b 5f62 7579          mask_buy
-00004630: 203d 2028 6e70 2e72 6f6c 6c28 7372 632c   = (np.roll(src,
-00004640: 2031 2920 3c20 7841 5452 5472 6169 6c69   1) < xATRTraili
-00004650: 6e67 5374 6f70 2920 2620 2873 7263 203e  ngStop) & (src >
-00004660: 206e 702e 726f 6c6c 2878 4154 5254 7261   np.roll(xATRTra
-00004670: 696c 696e 6753 746f 702c 2031 2929 0a20  ilingStop, 1)). 
-00004680: 2020 2020 2020 206d 6173 6b5f 7365 6c6c         mask_sell
-00004690: 203d 2028 6e70 2e72 6f6c 6c28 7372 632c   = (np.roll(src,
-000046a0: 2031 2920 3e20 7841 5452 5472 6169 6c69   1) > xATRTraili
-000046b0: 6e67 5374 6f70 2920 2620 2873 7263 203c  ngStop) & (src <
-000046c0: 206e 702e 726f 6c6c 2878 4154 5254 7261   np.roll(xATRTra
-000046d0: 696c 696e 6753 746f 702c 2031 2929 0a0a  ilingStop, 1))..
-000046e0: 2020 2020 2020 2020 706f 7320 3d20 6e70          pos = np
-000046f0: 2e7a 6572 6f73 286c 656e 2864 6174 6129  .zeros(len(data)
-00004700: 290a 2020 2020 2020 2020 706f 7320 3d20  ).        pos = 
-00004710: 6e70 2e77 6865 7265 286d 6173 6b5f 6275  np.where(mask_bu
-00004720: 792c 2031 2c20 706f 7329 0a20 2020 2020  y, 1, pos).     
-00004730: 2020 2070 6f73 203d 206e 702e 7768 6572     pos = np.wher
-00004740: 6528 6d61 736b 5f73 656c 6c2c 202d 312c  e(mask_sell, -1,
-00004750: 2070 6f73 290a 2020 2020 2020 2020 706f   pos).        po
-00004760: 735b 7e28 2870 6f73 203d 3d20 3129 207c  s[~((pos == 1) |
-00004770: 2028 706f 7320 3d3d 202d 3129 295d 203d   (pos == -1))] =
-00004780: 2030 0a0a 2020 2020 2020 2020 656d 6120   0..        ema 
-00004790: 3d20 6e70 2e61 7272 6179 2870 6b74 616c  = np.array(pktal
-000047a0: 6962 2e45 4d41 2864 6174 615b 2743 6c6f  ib.EMA(data['Clo
-000047b0: 7365 275d 2c20 7469 6d65 7065 7269 6f64  se'], timeperiod
-000047c0: 3d65 6d61 5f70 6572 696f 6429 290a 0a20  =ema_period)).. 
-000047d0: 2020 2020 2020 2062 7579 5f63 6f6e 6469         buy_condi
-000047e0: 7469 6f6e 5f75 7462 6f74 203d 2028 7841  tion_utbot = (xA
-000047f0: 5452 5472 6169 6c69 6e67 5374 6f70 203e  TRTrailingStop >
-00004800: 2065 6d61 2920 2620 2870 6f73 203e 2030   ema) & (pos > 0
-00004810: 2920 2620 2873 7263 203e 2065 6d61 290a  ) & (src > ema).
-00004820: 2020 2020 2020 2020 7365 6c6c 5f63 6f6e          sell_con
-00004830: 6469 7469 6f6e 5f75 7462 6f74 203d 2028  dition_utbot = (
-00004840: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
-00004850: 203c 2065 6d61 2920 2620 2870 6f73 203c   < ema) & (pos <
-00004860: 2030 2920 2620 2873 7263 203c 2065 6d61   0) & (src < ema
-00004870: 290a 0a20 2020 2020 2020 2023 2054 6865  )..        # The
-00004880: 2072 6573 756c 7469 6e67 2074 7265 6e64   resulting trend
-00004890: 2061 7272 6179 2068 6f6c 6473 2076 616c   array holds val
-000048a0: 7565 7320 6f66 2031 2028 6275 7929 2c20  ues of 1 (buy), 
-000048b0: 2d31 2028 7365 6c6c 292c 206f 7220 3020  -1 (sell), or 0 
-000048c0: 286e 6575 7472 616c 292e 0a20 2020 2020  (neutral)..     
-000048d0: 2020 2074 7265 6e64 203d 206e 702e 7768     trend = np.wh
-000048e0: 6572 6528 6275 795f 636f 6e64 6974 696f  ere(buy_conditio
-000048f0: 6e5f 7574 626f 742c 2031 2c20 6e70 2e77  n_utbot, 1, np.w
-00004900: 6865 7265 2873 656c 6c5f 636f 6e64 6974  here(sell_condit
-00004910: 696f 6e5f 7574 626f 742c 202d 312c 2030  ion_utbot, -1, 0
-00004920: 2929 0a20 2020 2020 2020 2074 7265 6e64  )).        trend
-00004930: 5f61 7272 203d 206e 702e 6172 7261 7928  _arr = np.array(
-00004940: 7472 656e 6429 0a20 2020 2020 2020 2064  trend).        d
-00004950: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
-00004960: 6174 612e 636f 6c75 6d6e 7329 2c20 2274  ata.columns), "t
-00004970: 7265 6e64 222c 2074 7265 6e64 5f61 7272  rend", trend_arr
-00004980: 290a 2020 2020 2020 2020 7472 656e 6420  ).        trend 
-00004990: 3d20 7472 656e 645b 305d 0a20 2020 2020  = trend[0].     
-000049a0: 2020 2073 6176 6544 6963 745b 2242 2f53     saveDict["B/S
-000049b0: 225d 203d 2022 4275 7922 2069 6620 7472  "] = "Buy" if tr
-000049c0: 656e 6420 3d3d 2031 2065 6c73 6520 2822  end == 1 else ("
-000049d0: 5365 6c6c 2220 6966 2074 7265 6e64 203d  Sell" if trend =
-000049e0: 3d20 2d31 2065 6c73 6520 224e 4122 290a  = -1 else "NA").
-000049f0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00004a00: 6374 5b22 422f 5322 5d20 3d20 2863 6f6c  ct["B/S"] = (col
-00004a10: 6f72 5465 7874 2e47 5245 454e 202b 2022  orText.GREEN + "
-00004a20: 4275 7922 2920 6966 2074 7265 6e64 203d  Buy") if trend =
-00004a30: 3d20 3120 656c 7365 2028 2863 6f6c 6f72  = 1 else ((color
-00004a40: 5465 7874 2e46 4149 4c2b 2022 5365 6c6c  Text.FAIL+ "Sell
-00004a50: 2229 2069 6620 7472 656e 6420 3d3d 202d  ") if trend == -
-00004a60: 3120 656c 7365 2028 636f 6c6f 7254 6578  1 else (colorTex
-00004a70: 742e 5741 524e 202b 2022 4e41 2229 2920  t.WARN + "NA")) 
-00004a80: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-00004a90: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-00004aa0: 7579 5365 6c6c 416c 6c20 3d3d 2074 7265  uySellAll == tre
-00004ab0: 6e64 0a0a 2020 2020 2320 4578 616d 706c  nd..    # Exampl
-00004ac0: 6520 6f66 2063 6f6d 6269 6e69 6e67 2055  e of combining U
-00004ad0: 5442 6f74 2041 6c65 7274 7320 7769 7468  TBot Alerts with
-00004ae0: 2052 5349 2061 6e64 2041 4458 0a20 2020   RSI and ADX.   
-00004af0: 2064 6566 2063 7573 746f 6d5f 7374 7261   def custom_stra
-00004b00: 7465 6779 2873 656c 662c 6461 7461 6672  tegy(self,datafr
-00004b10: 616d 6529 3a0a 2020 2020 2020 2020 6461  ame):.        da
-00004b20: 7461 6672 616d 6520 3d20 7365 6c66 2e66  taframe = self.f
-00004b30: 696e 6442 7579 5365 6c6c 5369 676e 616c  indBuySellSignal
-00004b40: 7346 726f 6d41 5452 5472 6169 6c69 6e67  sFromATRTrailing
-00004b50: 2864 6174 6166 7261 6d65 2c20 6b65 795f  (dataframe, key_
-00004b60: 7661 6c75 653d 322c 2061 7472 5f70 6572  value=2, atr_per
-00004b70: 696f 643d 372c 2065 6d61 5f70 6572 696f  iod=7, ema_perio
-00004b80: 643d 3130 3029 0a20 2020 2020 2020 200a  d=100).        .
-00004b90: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-00004ba0: 6174 6520 5253 4920 616e 6420 4144 580a  ate RSI and ADX.
-00004bb0: 2020 2020 2020 2020 7273 6920 3d20 706b          rsi = pk
-00004bc0: 7461 6c69 622e 5253 4928 6461 7461 6672  talib.RSI(datafr
-00004bd0: 616d 655b 2743 6c6f 7365 275d 290a 2020  ame['Close']).  
-00004be0: 2020 2020 2020 6164 7820 3d20 706b 7461        adx = pkta
-00004bf0: 6c69 622e 4144 5828 6461 7461 6672 616d  lib.ADX(datafram
-00004c00: 655b 2748 6967 6827 5d2c 2064 6174 6166  e['High'], dataf
-00004c10: 7261 6d65 5b27 4c6f 7727 5d2c 2064 6174  rame['Low'], dat
-00004c20: 6166 7261 6d65 5b27 436c 6f73 6527 5d29  aframe['Close'])
-00004c30: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00004c40: 2020 2320 4465 6669 6e65 2063 6f6e 6469    # Define condi
-00004c50: 7469 6f6e 7320 6261 7365 6420 6f6e 2055  tions based on U
-00004c60: 5442 6f74 2041 6c65 7274 7320 616e 6420  TBot Alerts and 
-00004c70: 6164 6469 7469 6f6e 616c 2069 6e64 6963  additional indic
-00004c80: 6174 6f72 730a 2020 2020 2020 2020 2320  ators.        # 
-00004c90: 2e2e 2e20 2879 6f75 7220 6375 7374 6f6d  ... (your custom
-00004ca0: 2063 6f6e 6469 7469 6f6e 7320 6865 7265   conditions here
-00004cb0: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-00004cc0: 2020 2072 6574 7572 6e20 6461 7461 6672     return datafr
-00004cd0: 616d 650a 2020 2020 0a20 2020 2064 6566  ame.    .    def
-00004ce0: 2070 6f70 756c 6174 655f 696e 6469 6361   populate_indica
-00004cf0: 746f 7273 2873 656c 662c 2064 6174 6166  tors(self, dataf
-00004d00: 7261 6d65 3a20 7064 2e44 6174 6146 7261  rame: pd.DataFra
-00004d10: 6d65 2c20 6d65 7461 6461 7461 3a20 6469  me, metadata: di
-00004d20: 6374 2920 2d3e 2070 642e 4461 7461 4672  ct) -> pd.DataFr
-00004d30: 616d 653a 0a20 2020 2020 2020 2069 6620  ame:.        if 
-00004d40: 6e6f 7420 7365 6c66 2e64 703a 0a20 2020  not self.dp:.   
-00004d50: 2020 2020 2020 2020 2023 2044 6f6e 2774           # Don't
-00004d60: 2064 6f20 616e 7974 6869 6e67 2069 6620   do anything if 
-00004d70: 4461 7461 5072 6f76 6964 6572 2069 7320  DataProvider is 
-00004d80: 6e6f 7420 6176 6169 6c61 626c 652e 0a20  not available.. 
-00004d90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004da0: 6e20 6461 7461 6672 616d 650a 2020 2020  n dataframe.    
-00004db0: 2020 2020 4c5f 6f70 7469 6d69 7a65 5f74      L_optimize_t
-00004dc0: 7265 6e64 5f61 6c65 7274 2020 3d20 7365  rend_alert  = se
-00004dd0: 6c66 2e66 696e 6442 7579 5365 6c6c 5369  lf.findBuySellSi
-00004de0: 676e 616c 7346 726f 6d41 5452 5472 6169  gnalsFromATRTrai
-00004df0: 6c69 6e67 2864 6174 6166 7261 6d65 3d64  ling(dataframe=d
-00004e00: 6174 6166 7261 6d65 2c20 6b65 795f 7661  ataframe, key_va
-00004e10: 6c75 653d 2073 656c 662e 6b65 795f 7661  lue= self.key_va
-00004e20: 6c75 655f 6c2e 7661 6c75 652c 2061 7472  lue_l.value, atr
-00004e30: 5f70 6572 696f 643d 2073 656c 662e 6174  _period= self.at
-00004e40: 725f 7065 7269 6f64 5f6c 2e76 616c 7565  r_period_l.value
-00004e50: 2c20 656d 615f 7065 7269 6f64 3d73 656c  , ema_period=sel
-00004e60: 662e 656d 615f 7065 7269 6f64 5f6c 2e76  f.ema_period_l.v
-00004e70: 616c 7565 290a 2020 2020 2020 2020 2320  alue).        # 
-00004e80: 4c6f 6e67 2070 6f73 6974 696f 6e3f 0a20  Long position?. 
-00004e90: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
-00004ea0: 5b27 7472 656e 645f 6c27 5d20 3d20 4c5f  ['trend_l'] = L_
-00004eb0: 6f70 7469 6d69 7a65 5f74 7265 6e64 5f61  optimize_trend_a
-00004ec0: 6c65 7274 5b27 7472 656e 6427 5d0a 2020  lert['trend'].  
-00004ed0: 2020 2020 2020 535f 6f70 7469 6d69 7a65        S_optimize
-00004ee0: 5f74 7265 6e64 5f61 6c65 7274 2020 3d20  _trend_alert  = 
-00004ef0: 7365 6c66 2e66 696e 6442 7579 5365 6c6c  self.findBuySell
-00004f00: 5369 676e 616c 7346 726f 6d41 5452 5472  SignalsFromATRTr
-00004f10: 6169 6c69 6e67 2864 6174 6166 7261 6d65  ailing(dataframe
-00004f20: 3d64 6174 6166 7261 6d65 2c20 6b65 795f  =dataframe, key_
-00004f30: 7661 6c75 653d 2073 656c 662e 6b65 795f  value= self.key_
-00004f40: 7661 6c75 655f 732e 7661 6c75 652c 2061  value_s.value, a
-00004f50: 7472 5f70 6572 696f 643d 2073 656c 662e  tr_period= self.
-00004f60: 6174 725f 7065 7269 6f64 5f73 2e76 616c  atr_period_s.val
-00004f70: 7565 2c20 656d 615f 7065 7269 6f64 3d73  ue, ema_period=s
-00004f80: 656c 662e 656d 615f 7065 7269 6f64 5f73  elf.ema_period_s
-00004f90: 2e76 616c 7565 290a 2020 2020 2020 2020  .value).        
-00004fa0: 2320 5368 6f72 7420 706f 7369 7469 6f6e  # Short position
-00004fb0: 3f0a 2020 2020 2020 2020 6461 7461 6672  ?.        datafr
-00004fc0: 616d 655b 2774 7265 6e64 5f73 275d 203d  ame['trend_s'] =
-00004fd0: 2053 5f6f 7074 696d 697a 655f 7472 656e   S_optimize_tren
-00004fe0: 645f 616c 6572 745b 2774 7265 6e64 275d  d_alert['trend']
-00004ff0: 0a0a 2020 2020 2020 2020 2320 4144 580a  ..        # ADX.
-00005000: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00005010: 655b 2761 6478 275d 203d 2070 6b74 616c  e['adx'] = pktal
-00005020: 6962 2e41 4458 2864 6174 6166 7261 6d65  ib.ADX(dataframe
-00005030: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-00005040: 2020 2023 2052 5349 0a20 2020 2020 2020     # RSI.       
-00005050: 2023 2064 6174 6166 7261 6d65 5b27 7273   # dataframe['rs
-00005060: 6927 5d20 3d20 7461 2e52 5349 2864 6174  i'] = ta.RSI(dat
-00005070: 6166 7261 6d65 290a 0a20 2020 2020 2020  aframe)..       
-00005080: 2023 2045 4d41 0a20 2020 2020 2020 2064   # EMA.        d
-00005090: 6174 6166 7261 6d65 5b27 656d 615f 6c27  ataframe['ema_l'
-000050a0: 5d20 3d20 706b 7461 6c69 622e 454d 4128  ] = pktalib.EMA(
-000050b0: 6461 7461 6672 616d 655b 2763 6c6f 7365  dataframe['close
-000050c0: 275d 2c20 7469 6d65 7065 7269 6f64 3d73  '], timeperiod=s
-000050d0: 656c 662e 656d 615f 7065 7269 6f64 5f6c  elf.ema_period_l
-000050e0: 5f65 7869 742e 7661 6c75 6529 0a20 2020  _exit.value).   
-000050f0: 2020 2020 2064 6174 6166 7261 6d65 5b27       dataframe['
-00005100: 656d 615f 7327 5d20 3d20 706b 7461 6c69  ema_s'] = pktali
-00005110: 622e 454d 4128 6461 7461 6672 616d 655b  b.EMA(dataframe[
-00005120: 2763 6c6f 7365 275d 2c20 7469 6d65 7065  'close'], timepe
-00005130: 7269 6f64 3d73 656c 662e 656d 615f 7065  riod=self.ema_pe
-00005140: 7269 6f64 5f73 5f65 7869 742e 7661 6c75  riod_s_exit.valu
-00005150: 6529 0a0a 0a20 2020 2020 2020 2023 2056  e)...        # V
-00005160: 6f6c 756d 6520 5765 6967 6874 6564 0a20  olume Weighted. 
-00005170: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
-00005180: 5b27 766f 6c75 6d65 5f6d 6561 6e27 5d20  ['volume_mean'] 
-00005190: 3d20 6461 7461 6672 616d 655b 2776 6f6c  = dataframe['vol
-000051a0: 756d 6527 5d2e 726f 6c6c 696e 6728 7365  ume'].rolling(se
-000051b0: 6c66 2e76 6f6c 756d 655f 6368 6563 6b2e  lf.volume_check.
-000051c0: 7661 6c75 6529 2e6d 6561 6e28 292e 7368  value).mean().sh
-000051d0: 6966 7428 3129 0a20 2020 2020 2020 2064  ift(1).        d
-000051e0: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
-000051f0: 5f6d 6561 6e5f 6578 6974 275d 203d 2064  _mean_exit'] = d
-00005200: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
-00005210: 275d 2e72 6f6c 6c69 6e67 2873 656c 662e  '].rolling(self.
-00005220: 766f 6c75 6d65 5f63 6865 636b 5f65 7869  volume_check_exi
-00005230: 742e 7661 6c75 6529 2e6d 6561 6e28 292e  t.value).mean().
-00005240: 7368 6966 7428 3129 0a0a 2020 2020 2020  shift(1)..      
-00005250: 2020 6461 7461 6672 616d 655b 2776 6f6c    dataframe['vol
-00005260: 756d 655f 6d65 616e 5f73 275d 203d 2064  ume_mean_s'] = d
-00005270: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
-00005280: 275d 2e72 6f6c 6c69 6e67 2873 656c 662e  '].rolling(self.
-00005290: 766f 6c75 6d65 5f63 6865 636b 5f73 2e76  volume_check_s.v
-000052a0: 616c 7565 292e 6d65 616e 2829 2e73 6869  alue).mean().shi
-000052b0: 6674 2831 290a 2020 2020 2020 2020 6461  ft(1).        da
-000052c0: 7461 6672 616d 655b 2776 6f6c 756d 655f  taframe['volume_
-000052d0: 6d65 616e 5f65 7869 745f 7327 5d20 3d20  mean_exit_s'] = 
-000052e0: 6461 7461 6672 616d 655b 2776 6f6c 756d  dataframe['volum
-000052f0: 6527 5d2e 726f 6c6c 696e 6728 7365 6c66  e'].rolling(self
-00005300: 2e76 6f6c 756d 655f 6368 6563 6b5f 6578  .volume_check_ex
-00005310: 6974 5f73 2e76 616c 7565 292e 6d65 616e  it_s.value).mean
-00005320: 2829 2e73 6869 6674 2831 290a 2020 2020  ().shift(1).    
-00005330: 2020 2020 7265 7475 726e 2064 6174 6166      return dataf
-00005340: 7261 6d65 0a20 2020 200a 2020 2020 6465  rame.    .    de
-00005350: 6620 706f 7075 6c61 7465 5f65 6e74 7279  f populate_entry
-00005360: 5f74 7265 6e64 2873 656c 662c 2064 6174  _trend(self, dat
-00005370: 6166 7261 6d65 3a20 7064 2e44 6174 6146  aframe: pd.DataF
-00005380: 7261 6d65 2c20 6d65 7461 6461 7461 3a20  rame, metadata: 
-00005390: 6469 6374 2920 2d3e 2070 642e 4461 7461  dict) -> pd.Data
-000053a0: 4672 616d 653a 0a0a 2020 2020 2020 2020  Frame:..        
-000053b0: 6461 7461 6672 616d 652e 6c6f 635b 0a20  dataframe.loc[. 
-000053c0: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-000053d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053e0: 2020 2020 2028 6461 7461 6672 616d 655b       (dataframe[
-000053f0: 2761 6478 275d 203e 2073 656c 662e 6164  'adx'] > self.ad
-00005400: 785f 6c6f 6e67 5f6d 696e 2e76 616c 7565  x_long_min.value
-00005410: 2920 2620 2320 7472 656e 6420 7374 7265  ) & # trend stre
-00005420: 6e67 7468 2063 6f6e 6669 726d 6174 696f  ngth confirmatio
-00005430: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00005440: 2020 2020 2020 2020 2020 2864 6174 6166            (dataf
-00005450: 7261 6d65 5b27 6164 7827 5d20 3c20 7365  rame['adx'] < se
-00005460: 6c66 2e61 6478 5f6c 6f6e 675f 6d61 782e  lf.adx_long_max.
-00005470: 7661 6c75 6529 2026 2023 2074 7265 6e64  value) & # trend
-00005480: 2073 7472 656e 6774 6820 636f 6e66 6972   strength confir
-00005490: 6d61 7469 6f6e 0a20 2020 2020 2020 2020  mation.         
-000054a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000054b0: 6461 7461 6672 616d 655b 2774 7265 6e64  dataframe['trend
-000054c0: 5f6c 275d 203e 2030 2920 260a 2020 2020  _l'] > 0) &.    
-000054d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054e0: 2020 2020 2864 6174 6166 7261 6d65 5b27      (dataframe['
-000054f0: 766f 6c75 6d65 275d 203e 2064 6174 6166  volume'] > dataf
-00005500: 7261 6d65 5b27 766f 6c75 6d65 5f6d 6561  rame['volume_mea
-00005510: 6e27 5d29 2026 0a20 2020 2020 2020 2020  n']) &.         
-00005520: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00005530: 6461 7461 6672 616d 655b 2776 6f6c 756d  dataframe['volum
-00005540: 6527 5d20 3e20 3029 0a0a 2020 2020 2020  e'] > 0)..      
-00005550: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-00005560: 2020 2020 2027 656e 7465 725f 6c6f 6e67       'enter_long
-00005570: 275d 203d 2031 0a0a 2020 2020 2020 2020  '] = 1..        
-00005580: 6461 7461 6672 616d 652e 6c6f 635b 0a20  dataframe.loc[. 
-00005590: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055b0: 2020 2020 2028 6461 7461 6672 616d 655b       (dataframe[
-000055c0: 2761 6478 275d 203e 2073 656c 662e 6164  'adx'] > self.ad
-000055d0: 785f 7368 6f72 745f 6d69 6e2e 7661 6c75  x_short_min.valu
-000055e0: 6529 2026 2023 2074 7265 6e64 2073 7472  e) & # trend str
-000055f0: 656e 6774 6820 636f 6e66 6972 6d61 7469  ength confirmati
-00005600: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00005610: 2020 2020 2020 2020 2020 2028 6461 7461             (data
-00005620: 6672 616d 655b 2761 6478 275d 203c 2073  frame['adx'] < s
-00005630: 656c 662e 6164 785f 7368 6f72 745f 6d61  elf.adx_short_ma
-00005640: 782e 7661 6c75 6529 2026 2023 2074 7265  x.value) & # tre
-00005650: 6e64 2073 7472 656e 6774 6820 636f 6e66  nd strength conf
-00005660: 6972 6d61 7469 6f6e 0a20 2020 2020 2020  irmation.       
-00005670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005680: 2028 6461 7461 6672 616d 655b 2774 7265   (dataframe['tre
-00005690: 6e64 5f73 275d 203c 2030 2920 260a 2020  nd_s'] < 0) &.  
-000056a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056b0: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
-000056c0: 5b27 766f 6c75 6d65 275d 203e 2064 6174  ['volume'] > dat
-000056d0: 6166 7261 6d65 5b27 766f 6c75 6d65 5f6d  aframe['volume_m
-000056e0: 6561 6e5f 7327 5d29 2023 2076 6f6c 756d  ean_s']) # volum
-000056f0: 6520 7765 6967 6874 6564 2069 6e64 6963  e weighted indic
-00005700: 6174 6f72 0a20 2020 2020 2020 2020 2020  ator.           
-00005710: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00005720: 2765 6e74 6572 5f73 686f 7274 275d 203d  'enter_short'] =
-00005730: 2031 0a20 2020 2020 2020 200a 2020 2020   1.        .    
-00005740: 2020 2020 7265 7475 726e 2064 6174 6166      return dataf
-00005750: 7261 6d65 0a20 2020 200a 2020 2020 6465  rame.    .    de
-00005760: 6620 706f 7075 6c61 7465 5f65 7869 745f  f populate_exit_
-00005770: 7472 656e 6428 7365 6c66 2c20 6461 7461  trend(self, data
-00005780: 6672 616d 653a 2070 642e 4461 7461 4672  frame: pd.DataFr
-00005790: 616d 652c 206d 6574 6164 6174 613a 2064  ame, metadata: d
-000057a0: 6963 7429 202d 3e20 7064 2e44 6174 6146  ict) -> pd.DataF
-000057b0: 7261 6d65 3a0a 0a20 2020 2020 2020 2063  rame:..        c
-000057c0: 6f6e 6469 7469 6f6e 735f 6c6f 6e67 203d  onditions_long =
-000057d0: 205b 5d0a 2020 2020 2020 2020 636f 6e64   [].        cond
-000057e0: 6974 696f 6e73 5f73 686f 7274 203d 205b  itions_short = [
-000057f0: 5d0a 2020 2020 2020 2020 6461 7461 6672  ].        datafr
-00005800: 616d 652e 6c6f 635b 3a2c 2027 6578 6974  ame.loc[:, 'exit
-00005810: 5f74 6167 275d 203d 2027 270a 0a20 2020  _tag'] = ''..   
-00005820: 2020 2020 2065 7869 745f 6c6f 6e67 203d       exit_long =
-00005830: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00005840: 2020 2023 2028 6461 7461 6672 616d 655b     # (dataframe[
-00005850: 2763 6c6f 7365 275d 203c 2064 6174 6166  'close'] < dataf
-00005860: 7261 6d65 5b27 6c6f 7727 5d2e 7368 6966  rame['low'].shif
-00005870: 7428 7365 6c66 2e73 656c 6c5f 7368 6966  t(self.sell_shif
-00005880: 742e 7661 6c75 6529 2920 260a 2020 2020  t.value)) &.    
-00005890: 2020 2020 2020 2020 2020 2020 2864 6174              (dat
-000058a0: 6166 7261 6d65 5b27 636c 6f73 6527 5d20  aframe['close'] 
-000058b0: 3c20 6461 7461 6672 616d 655b 2765 6d61  < dataframe['ema
-000058c0: 5f6c 275d 2920 260a 2020 2020 2020 2020  _l']) &.        
-000058d0: 2020 2020 2020 2020 2864 6174 6166 7261          (datafra
-000058e0: 6d65 5b27 766f 6c75 6d65 275d 203e 2064  me['volume'] > d
-000058f0: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
-00005900: 5f6d 6561 6e5f 6578 6974 275d 290a 2020  _mean_exit']).  
-00005910: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00005920: 2065 7869 745f 7368 6f72 7420 3d20 280a   exit_short = (.
+00003390: 2020 2020 2020 2020 6669 6c65 4665 7463          fileFetc
+000033a0: 6865 7220 3d20 6665 7463 6865 7228 290a  her = fetcher().
+000033b0: 2020 2020 2020 2020 6672 6f6d 2050 4b44          from PKD
+000033c0: 6576 546f 6f6c 732e 636c 6173 7365 732e  evTools.classes.
+000033d0: 5574 696c 7320 696d 706f 7274 2072 616e  Utils import ran
+000033e0: 646f 6d5f 7573 6572 5f61 6765 6e74 0a20  dom_user_agent. 
+000033f0: 2020 2020 2020 2066 6f72 2075 726c 2069         for url i
+00003400: 6e20 6669 6c65 5552 4c73 3a0a 2020 2020  n fileURLs:.    
+00003410: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00003420: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+00003430: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+00003440: 286f 7574 7075 7446 6f6c 6465 722c 7572  (outputFolder,ur
+00003450: 6c2e 7370 6c69 7428 222f 2229 5b2d 315d  l.split("/")[-1]
+00003460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003470: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+00003480: 2e65 7869 7374 7328 7061 7468 293a 0a20  .exists(path):. 
+00003490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034a0: 2020 2069 6620 7365 6c66 2e73 686f 756c     if self.shoul
+000034b0: 644c 6f67 3a0a 2020 2020 2020 2020 2020  dLog:.          
+000034c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000034d0: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+000034e0: 722e 6465 6275 6728 6622 4665 7463 6869  r.debug(f"Fetchi
+000034f0: 6e67 207b 7572 6c7d 2074 6f20 6b65 6570  ng {url} to keep
+00003500: 2061 7420 7b70 6174 687d 2229 0a20 2020   at {path}").   
+00003510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003520: 2072 6573 7020 3d20 6669 6c65 4665 7463   resp = fileFetc
+00003530: 6865 722e 6665 7463 6855 524c 2875 726c  her.fetchURL(url
+00003540: 3d75 726c 2c74 7269 616c 3d33 2c74 696d  =url,trial=3,tim
+00003550: 656f 7574 3d35 2c68 6561 6465 7273 3d7b  eout=5,headers={
+00003560: 2775 7365 722d 6167 656e 7427 3a20 6627  'user-agent': f'
+00003570: 7b72 616e 646f 6d5f 7573 6572 5f61 6765  {random_user_age
+00003580: 6e74 2829 7d27 7d29 0a20 2020 2020 2020  nt()}'}).       
+00003590: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000035a0: 7265 7370 2069 7320 6e6f 7420 4e6f 6e65  resp is not None
+000035b0: 2061 6e64 2072 6573 702e 7374 6174 7573   and resp.status
+000035c0: 5f63 6f64 6520 3d3d 2032 3030 3a0a 2020  _code == 200:.  
+000035d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035e0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+000035f0: 7061 7468 2c20 2277 2229 2061 7320 663a  path, "w") as f:
+00003600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003610: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
+00003620: 7269 7465 2872 6573 702e 7465 7874 290a  rite(resp.text).
+00003630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003640: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00003650: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00003660: 662e 7368 6f75 6c64 4c6f 673a 0a20 2020  f.shouldLog:.   
+00003670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003680: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
+00003690: 745f 6c6f 6767 6572 2e64 6562 7567 2866  t_logger.debug(f
+000036a0: 2241 6c72 6561 6479 2065 7869 7374 733a  "Already exists:
+000036b0: 207b 7061 7468 7d22 290a 2020 2020 2020   {path}").      
+000036c0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+000036d0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+000036e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000036f0: 7365 6c66 2e73 686f 756c 644c 6f67 3a0a  self.shouldLog:.
+00003700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003710: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
+00003720: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
+00003730: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
+00003740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003750: 636f 6e74 696e 7565 0a0a 2020 2020 2343  continue..    #C
+00003760: 616c 6375 6c61 7469 6e67 2073 6967 6e61  alculating signa
+00003770: 6c73 0a20 2020 2064 6566 2063 6f6d 7075  ls.    def compu
+00003780: 7465 4275 7953 656c 6c53 6967 6e61 6c73  teBuySellSignals
+00003790: 2873 656c 662c 6466 2c65 6d61 5f70 6572  (self,df,ema_per
+000037a0: 696f 643d 3230 302c 7265 7472 793d 5472  iod=200,retry=Tr
+000037b0: 7565 293a 0a20 2020 2020 2020 2074 7279  ue):.        try
+000037c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000037d0: 2049 6d70 6f72 7473 5b22 7665 6374 6f72   Imports["vector
+000037e0: 6274 225d 3a0a 2020 2020 2020 2020 2020  bt"]:.          
+000037f0: 2020 2020 2020 6672 6f6d 2076 6563 746f        from vecto
+00003800: 7262 742e 696e 6469 6361 746f 7273 2069  rbt.indicators i
+00003810: 6d70 6f72 7420 4d41 2061 7320 7662 740a  mport MA as vbt.
+00003820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003830: 6966 2064 6620 6973 206e 6f74 204e 6f6e  if df is not Non
+00003840: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00003850: 2020 2020 2020 2065 6d61 203d 2076 6274         ema = vbt
+00003860: 2e72 756e 2864 665b 2243 6c6f 7365 225d  .run(df["Close"]
+00003870: 2c20 312c 2073 686f 7274 5f6e 616d 653d  , 1, short_name=
+00003880: 2745 4d41 272c 2065 776d 3d54 7275 6529  'EMA', ewm=True)
+00003890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000038a0: 2020 2020 2064 665b 2241 626f 7665 225d       df["Above"]
+000038b0: 203d 2065 6d61 2e6d 615f 6372 6f73 7365   = ema.ma_crosse
+000038c0: 645f 6162 6f76 6528 6466 5b22 4154 5254  d_above(df["ATRT
+000038d0: 7261 696c 696e 6753 746f 7022 5d29 0a20  railingStop"]). 
+000038e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038f0: 2020 2064 665b 2242 656c 6f77 225d 203d     df["Below"] =
+00003900: 2065 6d61 2e6d 615f 6372 6f73 7365 645f   ema.ma_crossed_
+00003910: 6265 6c6f 7728 6466 5b22 4154 5254 7261  below(df["ATRTra
+00003920: 696c 696e 6753 746f 7022 5d29 0a20 2020  ilingStop"]).   
+00003930: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00003940: 2020 2020 2020 2020 2020 2020 2020 204f                 O
+00003950: 7574 7075 7443 6f6e 7472 6f6c 7328 292e  utputControls().
+00003960: 7072 696e 744f 7574 7075 7428 6622 7b63  printOutput(f"{c
+00003970: 6f6c 6f72 5465 7874 2e46 4149 4c7d 5468  olorText.FAIL}Th
+00003980: 6520 6d61 696e 206d 6f64 756c 6520 6e65  e main module ne
+00003990: 6564 6564 2066 6f72 2062 6573 7420 4275  eded for best Bu
+000039a0: 792f 5365 6c6c 2072 6573 756c 7420 6361  y/Sell result ca
+000039b0: 6c63 756c 6174 696f 6e20 6973 206d 6973  lculation is mis
+000039c0: 7369 6e67 2e20 4661 6c6c 696e 6720 6261  sing. Falling ba
+000039d0: 636b 206f 6e20 616e 2061 6c74 6572 6e61  ck on an alterna
+000039e0: 7469 7665 2c20 6275 7420 6974 2069 7320  tive, but it is 
+000039f0: 6e6f 7420 7665 7279 2072 656c 6961 626c  not very reliabl
+00003a00: 652e 7b63 6f6c 6f72 5465 7874 2e45 4e44  e.{colorText.END
+00003a10: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00003a20: 2020 2020 6966 2073 656c 662e 7368 6f75      if self.shou
+00003a30: 6c64 4c6f 673a 0a20 2020 2020 2020 2020  ldLog:.         
+00003a40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003a50: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
+00003a60: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
+00003a70: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00003a80: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
+00003a90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00003aa0: 2020 2020 2020 2020 2020 2020 2020 656d                em
+00003ab0: 6120 3d20 706b 7461 6c69 622e 454d 4128  a = pktalib.EMA(
+00003ac0: 6466 5b22 436c 6f73 6522 5d2c 2065 6d61  df["Close"], ema
+00003ad0: 5f70 6572 696f 6429 2069 6620 656d 615f  _period) if ema_
+00003ae0: 7065 7269 6f64 203e 2031 2065 6c73 6520  period > 1 else 
+00003af0: 6466 5b22 436c 6f73 6522 5d23 7368 6f72  df["Close"]#shor
+00003b00: 745f 6e61 6d65 3d27 454d 4127 2c20 6577  t_name='EMA', ew
+00003b10: 6d3d 5472 7565 2920 2020 2020 2020 200a  m=True)        .
+00003b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b30: 2020 2020 6466 5b22 4162 6f76 6522 5d20      df["Above"] 
+00003b40: 3d20 656d 6120 3e20 6466 5b22 4154 5254  = ema > df["ATRT
+00003b50: 7261 696c 696e 6753 746f 7022 5d0a 2020  railingStop"].  
+00003b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b70: 2020 6466 5b22 4265 6c6f 7722 5d20 3d20    df["Below"] = 
+00003b80: 656d 6120 3c20 6466 5b22 4154 5254 7261  ema < df["ATRTra
+00003b90: 696c 696e 6753 746f 7022 5d0a 2020 2020  ilingStop"].    
+00003ba0: 2020 2020 6578 6365 7074 2028 4f53 4572      except (OSEr
+00003bb0: 726f 722c 4669 6c65 4e6f 7446 6f75 6e64  ror,FileNotFound
+00003bc0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+00003bd0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00003be0: 2e73 686f 756c 644c 6f67 3a0a 2020 2020  .shouldLog:.    
+00003bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003c00: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
+00003c10: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
+00003c20: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
+00003c30: 2020 2020 4f75 7470 7574 436f 6e74 726f      OutputContro
+00003c40: 6c73 2829 2e70 7269 6e74 4f75 7470 7574  ls().printOutput
+00003c50: 2866 227b 636f 6c6f 7254 6578 742e 4641  (f"{colorText.FA
+00003c60: 494c 7d53 6f6d 6520 6465 7065 6e64 656e  IL}Some dependen
+00003c70: 6369 6573 2061 7265 206d 6973 7369 6e67  cies are missing
+00003c80: 2e20 5472 7920 616e 6420 7275 6e20 7468  . Try and run th
+00003c90: 6973 206f 7074 696f 6e20 6167 6169 6e2e  is option again.
+00003ca0: 7b63 6f6c 6f72 5465 7874 2e45 4e44 7d22  {colorText.END}"
+00003cb0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00003cc0: 4f53 4572 726f 723a 5241 4c4c 4953 3a20  OSError:RALLIS: 
+00003cd0: 5b45 7272 6e6f 2032 5d20 4e6f 2073 7563  [Errno 2] No suc
+00003ce0: 6820 6669 6c65 206f 7220 6469 7265 6374  h file or direct
+00003cf0: 6f72 793a 2027 2f74 6d70 2f5f 4d45 497a  ory: '/tmp/_MEIz
+00003d00: 6f54 5636 412f 7665 6374 6f72 6274 2f74  oTV6A/vectorbt/t
+00003d10: 656d 706c 6174 6573 2f6c 6967 6874 2e6a  emplates/light.j
+00003d20: 736f 6e27 0a20 2020 2020 2020 2020 2020  son'.           
+00003d30: 2069 6620 224e 6f20 7375 6368 2066 696c   if "No such fil
+00003d40: 6520 6f72 2064 6972 6563 746f 7279 2220  e or directory" 
+00003d50: 696e 2073 7472 2865 293a 0a20 2020 2020  in str(e):.     
+00003d60: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d80: 2020 2020 696d 706f 7274 206f 730a 2020      import os.  
+00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003da0: 2020 6f75 7470 7574 466f 6c64 6572 203d    outputFolder =
+00003db0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00003dc0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00003dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003de0: 2020 2020 2020 206f 7574 7075 7446 6f6c         outputFol
+00003df0: 6465 7220 3d20 6f73 2e73 6570 2e6a 6f69  der = os.sep.joi
+00003e00: 6e28 652e 6669 6c65 6e61 6d65 2e73 706c  n(e.filename.spl
+00003e10: 6974 286f 732e 7365 7029 5b3a 2d31 5d29  it(os.sep)[:-1])
+00003e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003e30: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00003e40: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+00003e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e60: 2020 2020 6966 2073 656c 662e 7368 6f75      if self.shou
+00003e70: 6c64 4c6f 673a 0a20 2020 2020 2020 2020  ldLog:.         
+00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e90: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00003ea0: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+00003eb0: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+00003ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ed0: 2020 2020 2020 206f 7574 7075 7446 6f6c         outputFol
+00003ee0: 6465 7220 3d20 6f73 2e73 6570 2e6a 6f69  der = os.sep.joi
+00003ef0: 6e28 7374 7228 6529 2e73 706c 6974 2822  n(str(e).split("
+00003f00: 5c6e 2229 5b30 5d2e 7370 6c69 7428 223a  \n")[0].split(":
+00003f10: 2022 295b 315d 2e72 6570 6c61 6365 2822   ")[1].replace("
+00003f20: 2722 2c22 2229 2e73 706c 6974 286f 732e  '","").split(os.
+00003f30: 7365 7029 5b3a 2d31 5d29 0a20 2020 2020  sep)[:-1]).     
+00003f40: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00003f50: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00003f60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003f70: 2020 2020 2020 6966 2073 656c 662e 7368        if self.sh
+00003f80: 6f75 6c64 4c6f 673a 0a20 2020 2020 2020  ouldLog:.       
+00003f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fa0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+00003fb0: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
+00003fc0: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
+00003fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fe0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00003ff0: 2020 2020 2020 7365 6c66 2e64 6f77 6e6c        self.downl
+00004000: 6f61 6453 6176 6554 656d 706c 6174 654a  oadSaveTemplateJ
+00004010: 736f 6e73 286f 7574 7075 7446 6f6c 6465  sons(outputFolde
+00004020: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+00004030: 2020 2069 6620 7265 7472 793a 0a20 2020     if retry:.   
+00004040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004050: 2072 6574 7572 6e20 7365 6c66 2e63 6f6d   return self.com
+00004060: 7075 7465 4275 7953 656c 6c53 6967 6e61  puteBuySellSigna
+00004070: 6c73 2864 662c 656d 615f 7065 7269 6f64  ls(df,ema_period
+00004080: 3d65 6d61 5f70 6572 696f 642c 7265 7472  =ema_period,retr
+00004090: 793d 4661 6c73 6529 0a20 2020 2020 2020  y=False).       
+000040a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000040b0: 4e6f 6e65 0a20 2020 2020 2020 2065 7863  None.        exc
+000040c0: 6570 7420 496d 706f 7274 4572 726f 7220  ept ImportError 
+000040d0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+000040e0: 2020 4f75 7470 7574 436f 6e74 726f 6c73    OutputControls
+000040f0: 2829 2e70 7269 6e74 4f75 7470 7574 2866  ().printOutput(f
+00004100: 227b 636f 6c6f 7254 6578 742e 4641 494c  "{colorText.FAIL
+00004110: 7d54 6865 206d 6169 6e20 6d6f 6475 6c65  }The main module
+00004120: 206e 6565 6465 6420 666f 7220 6265 7374   needed for best
+00004130: 2042 7579 2f53 656c 6c20 7265 7375 6c74   Buy/Sell result
+00004140: 2063 616c 6375 6c61 7469 6f6e 2069 7320   calculation is 
+00004150: 6d69 7373 696e 672e 2046 616c 6c69 6e67  missing. Falling
+00004160: 2062 6163 6b20 6f6e 2061 6e20 616c 7465   back on an alte
+00004170: 726e 6174 6976 652c 2062 7574 2069 7420  rnative, but it 
+00004180: 6973 206e 6f74 2076 6572 7920 7265 6c69  is not very reli
+00004190: 6162 6c65 2e7b 636f 6c6f 7254 6578 742e  able.{colorText.
+000041a0: 454e 447d 2229 0a20 2020 2020 2020 2020  END}").         
+000041b0: 2020 2069 6620 7365 6c66 2e73 686f 756c     if self.shoul
+000041c0: 644c 6f67 3a0a 2020 2020 2020 2020 2020  dLog:.          
+000041d0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+000041e0: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+000041f0: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
+00004200: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00004210: 2064 6620 6973 206e 6f74 204e 6f6e 653a   df is not None:
+00004220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004230: 2065 6d61 203d 2070 6b74 616c 6962 2e45   ema = pktalib.E
+00004240: 4d41 2864 665b 2243 6c6f 7365 225d 2c20  MA(df["Close"], 
+00004250: 656d 615f 7065 7269 6f64 2920 6966 2065  ema_period) if e
+00004260: 6d61 5f70 6572 696f 6420 3e20 3120 656c  ma_period > 1 el
+00004270: 7365 2064 665b 2243 6c6f 7365 225d 2373  se df["Close"]#s
+00004280: 686f 7274 5f6e 616d 653d 2745 4d41 272c  hort_name='EMA',
+00004290: 2065 776d 3d54 7275 6529 2020 2020 2020   ewm=True)      
+000042a0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+000042b0: 2020 2064 665b 2241 626f 7665 225d 203d     df["Above"] =
+000042c0: 2065 6d61 203e 2064 665b 2241 5452 5472   ema > df["ATRTr
+000042d0: 6169 6c69 6e67 5374 6f70 225d 0a20 2020  ailingStop"].   
+000042e0: 2020 2020 2020 2020 2020 2020 2064 665b               df[
+000042f0: 2242 656c 6f77 225d 203d 2065 6d61 203c  "Below"] = ema <
+00004300: 2064 665b 2241 5452 5472 6169 6c69 6e67   df["ATRTrailing
+00004310: 5374 6f70 225d 0a20 2020 2020 2020 200a  Stop"].        .
+00004320: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00004330: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00004340: 2020 2020 2020 2064 665b 2242 7579 225d         df["Buy"]
+00004350: 203d 2028 6466 5b22 436c 6f73 6522 5d20   = (df["Close"] 
+00004360: 3e20 6466 5b22 4154 5254 7261 696c 696e  > df["ATRTrailin
+00004370: 6753 746f 7022 5d29 2026 2028 6466 5b22  gStop"]) & (df["
+00004380: 4162 6f76 6522 5d3d 3d54 7275 6529 0a20  Above"]==True). 
+00004390: 2020 2020 2020 2020 2020 2064 665b 2253             df["S
+000043a0: 656c 6c22 5d20 3d20 2864 665b 2243 6c6f  ell"] = (df["Clo
+000043b0: 7365 225d 203c 2064 665b 2241 5452 5472  se"] < df["ATRTr
+000043c0: 6169 6c69 6e67 5374 6f70 225d 2920 2620  ailingStop"]) & 
+000043d0: 2864 665b 2242 656c 6f77 225d 3d3d 5472  (df["Below"]==Tr
+000043e0: 7565 290a 0a20 2020 2020 2020 2072 6574  ue)..        ret
+000043f0: 7572 6e20 6466 0a0a 2020 2020 6465 6620  urn df..    def 
+00004400: 6669 6e64 4275 7953 656c 6c53 6967 6e61  findBuySellSigna
+00004410: 6c73 4672 6f6d 4154 5254 7261 696c 696e  lsFromATRTrailin
+00004420: 6728 7365 6c66 2c64 662c 206b 6579 5f76  g(self,df, key_v
+00004430: 616c 7565 3d31 2c20 6174 725f 7065 7269  alue=1, atr_peri
+00004440: 6f64 3d31 302c 2065 6d61 5f70 6572 696f  od=10, ema_perio
+00004450: 643d 3230 302c 6275 7953 656c 6c41 6c6c  d=200,buySellAll
+00004460: 3d31 2c73 6176 6544 6963 743d 4e6f 6e65  =1,saveDict=None
+00004470: 2c73 6372 6565 6e44 6963 743d 4e6f 6e65  ,screenDict=None
+00004480: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
+00004490: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+000044a0: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
+000044b0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000044c0: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+000044d0: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
+000044e0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+000044f0: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
+00004500: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
+00004510: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
+00004520: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
+00004530: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+00004540: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
+00004550: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
+00004560: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
+00004570: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
+00004580: 0a0a 2020 2020 2020 2020 2320 4361 6c63  ..        # Calc
+00004590: 756c 6174 6520 4154 5220 616e 6420 7841  ulate ATR and xA
+000045a0: 5452 5472 6169 6c69 6e67 5374 6f70 0a20  TRTrailingStop. 
+000045b0: 2020 2020 2020 2078 4154 5220 3d20 6e70         xATR = np
+000045c0: 2e61 7272 6179 2870 6b74 616c 6962 2e41  .array(pktalib.A
+000045d0: 5452 2864 6174 615b 2748 6967 6827 5d2c  TR(data['High'],
+000045e0: 2064 6174 615b 274c 6f77 275d 2c20 6461   data['Low'], da
+000045f0: 7461 5b27 436c 6f73 6527 5d2c 2074 696d  ta['Close'], tim
+00004600: 6570 6572 696f 643d 6174 725f 7065 7269  eperiod=atr_peri
+00004610: 6f64 2929 0a20 2020 2020 2020 206e 4c6f  od)).        nLo
+00004620: 7373 203d 206b 6579 5f76 616c 7565 202a  ss = key_value *
+00004630: 2078 4154 520a 2020 2020 2020 2020 7372   xATR.        sr
+00004640: 6320 3d20 6461 7461 5b27 436c 6f73 6527  c = data['Close'
+00004650: 5d0a 2020 2020 2020 2020 2320 496e 6974  ].        # Init
+00004660: 6961 6c69 7a65 2061 7272 6179 730a 2020  ialize arrays.  
+00004670: 2020 2020 2020 7841 5452 5472 6169 6c69        xATRTraili
+00004680: 6e67 5374 6f70 203d 206e 702e 7a65 726f  ngStop = np.zero
+00004690: 7328 6c65 6e28 6461 7461 2929 0a20 2020  s(len(data)).   
+000046a0: 2020 2020 2078 4154 5254 7261 696c 696e       xATRTrailin
+000046b0: 6753 746f 705b 305d 203d 2073 7263 5b30  gStop[0] = src[0
+000046c0: 5d20 2d20 6e4c 6f73 735b 305d 0a0a 2020  ] - nLoss[0]..  
+000046d0: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+000046e0: 6520 7841 5452 5472 6169 6c69 6e67 5374  e xATRTrailingSt
+000046f0: 6f70 2075 7369 6e67 2076 6563 746f 7269  op using vectori
+00004700: 7a65 6420 6f70 6572 6174 696f 6e73 0a20  zed operations. 
+00004710: 2020 2020 2020 206d 6173 6b5f 3120 3d20         mask_1 = 
+00004720: 2873 7263 203e 206e 702e 726f 6c6c 2878  (src > np.roll(x
+00004730: 4154 5254 7261 696c 696e 6753 746f 702c  ATRTrailingStop,
+00004740: 2031 2929 2026 2028 6e70 2e72 6f6c 6c28   1)) & (np.roll(
+00004750: 7372 632c 2031 2920 3e20 6e70 2e72 6f6c  src, 1) > np.rol
+00004760: 6c28 7841 5452 5472 6169 6c69 6e67 5374  l(xATRTrailingSt
+00004770: 6f70 2c20 3129 290a 2020 2020 2020 2020  op, 1)).        
+00004780: 6d61 736b 5f32 203d 2028 7372 6320 3c20  mask_2 = (src < 
+00004790: 6e70 2e72 6f6c 6c28 7841 5452 5472 6169  np.roll(xATRTrai
+000047a0: 6c69 6e67 5374 6f70 2c20 3129 2920 2620  lingStop, 1)) & 
+000047b0: 286e 702e 726f 6c6c 2873 7263 2c20 3129  (np.roll(src, 1)
+000047c0: 203c 206e 702e 726f 6c6c 2878 4154 5254   < np.roll(xATRT
+000047d0: 7261 696c 696e 6753 746f 702c 2031 2929  railingStop, 1))
+000047e0: 0a20 2020 2020 2020 206d 6173 6b5f 3320  .        mask_3 
+000047f0: 3d20 7372 6320 3e20 6e70 2e72 6f6c 6c28  = src > np.roll(
+00004800: 7841 5452 5472 6169 6c69 6e67 5374 6f70  xATRTrailingStop
+00004810: 2c20 3129 0a0a 2020 2020 2020 2020 7841  , 1)..        xA
+00004820: 5452 5472 6169 6c69 6e67 5374 6f70 203d  TRTrailingStop =
+00004830: 206e 702e 7768 6572 6528 6d61 736b 5f31   np.where(mask_1
+00004840: 2c20 6e70 2e6d 6178 696d 756d 286e 702e  , np.maximum(np.
+00004850: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+00004860: 6753 746f 702c 2031 292c 2073 7263 202d  gStop, 1), src -
+00004870: 206e 4c6f 7373 292c 2078 4154 5254 7261   nLoss), xATRTra
+00004880: 696c 696e 6753 746f 7029 0a20 2020 2020  ilingStop).     
+00004890: 2020 2078 4154 5254 7261 696c 696e 6753     xATRTrailingS
+000048a0: 746f 7020 3d20 6e70 2e77 6865 7265 286d  top = np.where(m
+000048b0: 6173 6b5f 322c 206e 702e 6d69 6e69 6d75  ask_2, np.minimu
+000048c0: 6d28 6e70 2e72 6f6c 6c28 7841 5452 5472  m(np.roll(xATRTr
+000048d0: 6169 6c69 6e67 5374 6f70 2c20 3129 2c20  ailingStop, 1), 
+000048e0: 7372 6320 2b20 6e4c 6f73 7329 2c20 7841  src + nLoss), xA
+000048f0: 5452 5472 6169 6c69 6e67 5374 6f70 290a  TRTrailingStop).
+00004900: 2020 2020 2020 2020 7841 5452 5472 6169          xATRTrai
+00004910: 6c69 6e67 5374 6f70 203d 206e 702e 7768  lingStop = np.wh
+00004920: 6572 6528 6d61 736b 5f33 2c20 7372 6320  ere(mask_3, src 
+00004930: 2d20 6e4c 6f73 732c 2078 4154 5254 7261  - nLoss, xATRTra
+00004940: 696c 696e 6753 746f 7029 0a0a 2020 2020  ilingStop)..    
+00004950: 2020 2020 6d61 736b 5f62 7579 203d 2028      mask_buy = (
+00004960: 6e70 2e72 6f6c 6c28 7372 632c 2031 2920  np.roll(src, 1) 
+00004970: 3c20 7841 5452 5472 6169 6c69 6e67 5374  < xATRTrailingSt
+00004980: 6f70 2920 2620 2873 7263 203e 206e 702e  op) & (src > np.
+00004990: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+000049a0: 6753 746f 702c 2031 2929 0a20 2020 2020  gStop, 1)).     
+000049b0: 2020 206d 6173 6b5f 7365 6c6c 203d 2028     mask_sell = (
+000049c0: 6e70 2e72 6f6c 6c28 7372 632c 2031 2920  np.roll(src, 1) 
+000049d0: 3e20 7841 5452 5472 6169 6c69 6e67 5374  > xATRTrailingSt
+000049e0: 6f70 2920 2620 2873 7263 203c 206e 702e  op) & (src < np.
+000049f0: 726f 6c6c 2878 4154 5254 7261 696c 696e  roll(xATRTrailin
+00004a00: 6753 746f 702c 2031 2929 0a0a 2020 2020  gStop, 1))..    
+00004a10: 2020 2020 706f 7320 3d20 6e70 2e7a 6572      pos = np.zer
+00004a20: 6f73 286c 656e 2864 6174 6129 290a 2020  os(len(data)).  
+00004a30: 2020 2020 2020 706f 7320 3d20 6e70 2e77        pos = np.w
+00004a40: 6865 7265 286d 6173 6b5f 6275 792c 2031  here(mask_buy, 1
+00004a50: 2c20 706f 7329 0a20 2020 2020 2020 2070  , pos).        p
+00004a60: 6f73 203d 206e 702e 7768 6572 6528 6d61  os = np.where(ma
+00004a70: 736b 5f73 656c 6c2c 202d 312c 2070 6f73  sk_sell, -1, pos
+00004a80: 290a 2020 2020 2020 2020 706f 735b 7e28  ).        pos[~(
+00004a90: 2870 6f73 203d 3d20 3129 207c 2028 706f  (pos == 1) | (po
+00004aa0: 7320 3d3d 202d 3129 295d 203d 2030 0a0a  s == -1))] = 0..
+00004ab0: 2020 2020 2020 2020 656d 6120 3d20 6e70          ema = np
+00004ac0: 2e61 7272 6179 2870 6b74 616c 6962 2e45  .array(pktalib.E
+00004ad0: 4d41 2864 6174 615b 2743 6c6f 7365 275d  MA(data['Close']
+00004ae0: 2c20 7469 6d65 7065 7269 6f64 3d65 6d61  , timeperiod=ema
+00004af0: 5f70 6572 696f 6429 290a 0a20 2020 2020  _period))..     
+00004b00: 2020 2062 7579 5f63 6f6e 6469 7469 6f6e     buy_condition
+00004b10: 5f75 7462 6f74 203d 2028 7841 5452 5472  _utbot = (xATRTr
+00004b20: 6169 6c69 6e67 5374 6f70 203e 2065 6d61  ailingStop > ema
+00004b30: 2920 2620 2870 6f73 203e 2030 2920 2620  ) & (pos > 0) & 
+00004b40: 2873 7263 203e 2065 6d61 290a 2020 2020  (src > ema).    
+00004b50: 2020 2020 7365 6c6c 5f63 6f6e 6469 7469      sell_conditi
+00004b60: 6f6e 5f75 7462 6f74 203d 2028 7841 5452  on_utbot = (xATR
+00004b70: 5472 6169 6c69 6e67 5374 6f70 203c 2065  TrailingStop < e
+00004b80: 6d61 2920 2620 2870 6f73 203c 2030 2920  ma) & (pos < 0) 
+00004b90: 2620 2873 7263 203c 2065 6d61 290a 0a20  & (src < ema).. 
+00004ba0: 2020 2020 2020 2023 2054 6865 2072 6573         # The res
+00004bb0: 756c 7469 6e67 2074 7265 6e64 2061 7272  ulting trend arr
+00004bc0: 6179 2068 6f6c 6473 2076 616c 7565 7320  ay holds values 
+00004bd0: 6f66 2031 2028 6275 7929 2c20 2d31 2028  of 1 (buy), -1 (
+00004be0: 7365 6c6c 292c 206f 7220 3020 286e 6575  sell), or 0 (neu
+00004bf0: 7472 616c 292e 0a20 2020 2020 2020 2074  tral)..        t
+00004c00: 7265 6e64 203d 206e 702e 7768 6572 6528  rend = np.where(
+00004c10: 6275 795f 636f 6e64 6974 696f 6e5f 7574  buy_condition_ut
+00004c20: 626f 742c 2031 2c20 6e70 2e77 6865 7265  bot, 1, np.where
+00004c30: 2873 656c 6c5f 636f 6e64 6974 696f 6e5f  (sell_condition_
+00004c40: 7574 626f 742c 202d 312c 2030 2929 0a20  utbot, -1, 0)). 
+00004c50: 2020 2020 2020 2074 7265 6e64 5f61 7272         trend_arr
+00004c60: 203d 206e 702e 6172 7261 7928 7472 656e   = np.array(tren
+00004c70: 6429 0a20 2020 2020 2020 2064 6174 612e  d).        data.
+00004c80: 696e 7365 7274 286c 656e 2864 6174 612e  insert(len(data.
+00004c90: 636f 6c75 6d6e 7329 2c20 2274 7265 6e64  columns), "trend
+00004ca0: 222c 2074 7265 6e64 5f61 7272 290a 2020  ", trend_arr).  
+00004cb0: 2020 2020 2020 7472 656e 6420 3d20 7472        trend = tr
+00004cc0: 656e 645b 305d 0a20 2020 2020 2020 2073  end[0].        s
+00004cd0: 6176 6544 6963 745b 2242 2f53 225d 203d  aveDict["B/S"] =
+00004ce0: 2022 4275 7922 2069 6620 7472 656e 6420   "Buy" if trend 
+00004cf0: 3d3d 2031 2065 6c73 6520 2822 5365 6c6c  == 1 else ("Sell
+00004d00: 2220 6966 2074 7265 6e64 203d 3d20 2d31  " if trend == -1
+00004d10: 2065 6c73 6520 224e 4122 290a 2020 2020   else "NA").    
+00004d20: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00004d30: 422f 5322 5d20 3d20 2863 6f6c 6f72 5465  B/S"] = (colorTe
+00004d40: 7874 2e47 5245 454e 202b 2022 4275 7922  xt.GREEN + "Buy"
+00004d50: 2920 6966 2074 7265 6e64 203d 3d20 3120  ) if trend == 1 
+00004d60: 656c 7365 2028 2863 6f6c 6f72 5465 7874  else ((colorText
+00004d70: 2e46 4149 4c2b 2022 5365 6c6c 2229 2069  .FAIL+ "Sell") i
+00004d80: 6620 7472 656e 6420 3d3d 202d 3120 656c  f trend == -1 el
+00004d90: 7365 2028 636f 6c6f 7254 6578 742e 5741  se (colorText.WA
+00004da0: 524e 202b 2022 4e41 2229 2920 2b20 636f  RN + "NA")) + co
+00004db0: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00004dc0: 2020 2020 7265 7475 726e 2062 7579 5365      return buySe
+00004dd0: 6c6c 416c 6c20 3d3d 2074 7265 6e64 0a0a  llAll == trend..
+00004de0: 2020 2020 2320 4578 616d 706c 6520 6f66      # Example of
+00004df0: 2063 6f6d 6269 6e69 6e67 2055 5442 6f74   combining UTBot
+00004e00: 2041 6c65 7274 7320 7769 7468 2052 5349   Alerts with RSI
+00004e10: 2061 6e64 2041 4458 0a20 2020 2064 6566   and ADX.    def
+00004e20: 2063 7573 746f 6d5f 7374 7261 7465 6779   custom_strategy
+00004e30: 2873 656c 662c 6461 7461 6672 616d 6529  (self,dataframe)
+00004e40: 3a0a 2020 2020 2020 2020 6461 7461 6672  :.        datafr
+00004e50: 616d 6520 3d20 7365 6c66 2e66 696e 6442  ame = self.findB
+00004e60: 7579 5365 6c6c 5369 676e 616c 7346 726f  uySellSignalsFro
+00004e70: 6d41 5452 5472 6169 6c69 6e67 2864 6174  mATRTrailing(dat
+00004e80: 6166 7261 6d65 2c20 6b65 795f 7661 6c75  aframe, key_valu
+00004e90: 653d 322c 2061 7472 5f70 6572 696f 643d  e=2, atr_period=
+00004ea0: 372c 2065 6d61 5f70 6572 696f 643d 3130  7, ema_period=10
+00004eb0: 3029 0a20 2020 2020 2020 200a 2020 2020  0).        .    
+00004ec0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+00004ed0: 5253 4920 616e 6420 4144 580a 2020 2020  RSI and ADX.    
+00004ee0: 2020 2020 7273 6920 3d20 706b 7461 6c69      rsi = pktali
+00004ef0: 622e 5253 4928 6461 7461 6672 616d 655b  b.RSI(dataframe[
+00004f00: 2743 6c6f 7365 275d 290a 2020 2020 2020  'Close']).      
+00004f10: 2020 6164 7820 3d20 706b 7461 6c69 622e    adx = pktalib.
+00004f20: 4144 5828 6461 7461 6672 616d 655b 2748  ADX(dataframe['H
+00004f30: 6967 6827 5d2c 2064 6174 6166 7261 6d65  igh'], dataframe
+00004f40: 5b27 4c6f 7727 5d2c 2064 6174 6166 7261  ['Low'], datafra
+00004f50: 6d65 5b27 436c 6f73 6527 5d29 0a20 2020  me['Close']).   
+00004f60: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
+00004f70: 4465 6669 6e65 2063 6f6e 6469 7469 6f6e  Define condition
+00004f80: 7320 6261 7365 6420 6f6e 2055 5442 6f74  s based on UTBot
+00004f90: 2041 6c65 7274 7320 616e 6420 6164 6469   Alerts and addi
+00004fa0: 7469 6f6e 616c 2069 6e64 6963 6174 6f72  tional indicator
+00004fb0: 730a 2020 2020 2020 2020 2320 2e2e 2e20  s.        # ... 
+00004fc0: 2879 6f75 7220 6375 7374 6f6d 2063 6f6e  (your custom con
+00004fd0: 6469 7469 6f6e 7320 6865 7265 290a 2020  ditions here).  
+00004fe0: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00004ff0: 6574 7572 6e20 6461 7461 6672 616d 650a  eturn dataframe.
+00005000: 2020 2020 0a20 2020 2064 6566 2070 6f70      .    def pop
+00005010: 756c 6174 655f 696e 6469 6361 746f 7273  ulate_indicators
+00005020: 2873 656c 662c 2064 6174 6166 7261 6d65  (self, dataframe
+00005030: 3a20 7064 2e44 6174 6146 7261 6d65 2c20  : pd.DataFrame, 
+00005040: 6d65 7461 6461 7461 3a20 6469 6374 2920  metadata: dict) 
+00005050: 2d3e 2070 642e 4461 7461 4672 616d 653a  -> pd.DataFrame:
+00005060: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00005070: 7365 6c66 2e64 703a 0a20 2020 2020 2020  self.dp:.       
+00005080: 2020 2020 2023 2044 6f6e 2774 2064 6f20       # Don't do 
+00005090: 616e 7974 6869 6e67 2069 6620 4461 7461  anything if Data
+000050a0: 5072 6f76 6964 6572 2069 7320 6e6f 7420  Provider is not 
+000050b0: 6176 6169 6c61 626c 652e 0a20 2020 2020  available..     
+000050c0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+000050d0: 7461 6672 616d 650a 2020 2020 2020 2020  taframe.        
+000050e0: 4c5f 6f70 7469 6d69 7a65 5f74 7265 6e64  L_optimize_trend
+000050f0: 5f61 6c65 7274 2020 3d20 7365 6c66 2e66  _alert  = self.f
+00005100: 696e 6442 7579 5365 6c6c 5369 676e 616c  indBuySellSignal
+00005110: 7346 726f 6d41 5452 5472 6169 6c69 6e67  sFromATRTrailing
+00005120: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
+00005130: 7261 6d65 2c20 6b65 795f 7661 6c75 653d  rame, key_value=
+00005140: 2073 656c 662e 6b65 795f 7661 6c75 655f   self.key_value_
+00005150: 6c2e 7661 6c75 652c 2061 7472 5f70 6572  l.value, atr_per
+00005160: 696f 643d 2073 656c 662e 6174 725f 7065  iod= self.atr_pe
+00005170: 7269 6f64 5f6c 2e76 616c 7565 2c20 656d  riod_l.value, em
+00005180: 615f 7065 7269 6f64 3d73 656c 662e 656d  a_period=self.em
+00005190: 615f 7065 7269 6f64 5f6c 2e76 616c 7565  a_period_l.value
+000051a0: 290a 2020 2020 2020 2020 2320 4c6f 6e67  ).        # Long
+000051b0: 2070 6f73 6974 696f 6e3f 0a20 2020 2020   position?.     
+000051c0: 2020 2064 6174 6166 7261 6d65 5b27 7472     dataframe['tr
+000051d0: 656e 645f 6c27 5d20 3d20 4c5f 6f70 7469  end_l'] = L_opti
+000051e0: 6d69 7a65 5f74 7265 6e64 5f61 6c65 7274  mize_trend_alert
+000051f0: 5b27 7472 656e 6427 5d0a 2020 2020 2020  ['trend'].      
+00005200: 2020 535f 6f70 7469 6d69 7a65 5f74 7265    S_optimize_tre
+00005210: 6e64 5f61 6c65 7274 2020 3d20 7365 6c66  nd_alert  = self
+00005220: 2e66 696e 6442 7579 5365 6c6c 5369 676e  .findBuySellSign
+00005230: 616c 7346 726f 6d41 5452 5472 6169 6c69  alsFromATRTraili
+00005240: 6e67 2864 6174 6166 7261 6d65 3d64 6174  ng(dataframe=dat
+00005250: 6166 7261 6d65 2c20 6b65 795f 7661 6c75  aframe, key_valu
+00005260: 653d 2073 656c 662e 6b65 795f 7661 6c75  e= self.key_valu
+00005270: 655f 732e 7661 6c75 652c 2061 7472 5f70  e_s.value, atr_p
+00005280: 6572 696f 643d 2073 656c 662e 6174 725f  eriod= self.atr_
+00005290: 7065 7269 6f64 5f73 2e76 616c 7565 2c20  period_s.value, 
+000052a0: 656d 615f 7065 7269 6f64 3d73 656c 662e  ema_period=self.
+000052b0: 656d 615f 7065 7269 6f64 5f73 2e76 616c  ema_period_s.val
+000052c0: 7565 290a 2020 2020 2020 2020 2320 5368  ue).        # Sh
+000052d0: 6f72 7420 706f 7369 7469 6f6e 3f0a 2020  ort position?.  
+000052e0: 2020 2020 2020 6461 7461 6672 616d 655b        dataframe[
+000052f0: 2774 7265 6e64 5f73 275d 203d 2053 5f6f  'trend_s'] = S_o
+00005300: 7074 696d 697a 655f 7472 656e 645f 616c  ptimize_trend_al
+00005310: 6572 745b 2774 7265 6e64 275d 0a0a 2020  ert['trend']..  
+00005320: 2020 2020 2020 2320 4144 580a 2020 2020        # ADX.    
+00005330: 2020 2020 6461 7461 6672 616d 655b 2761      dataframe['a
+00005340: 6478 275d 203d 2070 6b74 616c 6962 2e41  dx'] = pktalib.A
+00005350: 4458 2864 6174 6166 7261 6d65 290a 2020  DX(dataframe).  
+00005360: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+00005370: 2052 5349 0a20 2020 2020 2020 2023 2064   RSI.        # d
+00005380: 6174 6166 7261 6d65 5b27 7273 6927 5d20  ataframe['rsi'] 
+00005390: 3d20 7461 2e52 5349 2864 6174 6166 7261  = ta.RSI(datafra
+000053a0: 6d65 290a 0a20 2020 2020 2020 2023 2045  me)..        # E
+000053b0: 4d41 0a20 2020 2020 2020 2064 6174 6166  MA.        dataf
+000053c0: 7261 6d65 5b27 656d 615f 6c27 5d20 3d20  rame['ema_l'] = 
+000053d0: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+000053e0: 6672 616d 655b 2763 6c6f 7365 275d 2c20  frame['close'], 
+000053f0: 7469 6d65 7065 7269 6f64 3d73 656c 662e  timeperiod=self.
+00005400: 656d 615f 7065 7269 6f64 5f6c 5f65 7869  ema_period_l_exi
+00005410: 742e 7661 6c75 6529 0a20 2020 2020 2020  t.value).       
+00005420: 2064 6174 6166 7261 6d65 5b27 656d 615f   dataframe['ema_
+00005430: 7327 5d20 3d20 706b 7461 6c69 622e 454d  s'] = pktalib.EM
+00005440: 4128 6461 7461 6672 616d 655b 2763 6c6f  A(dataframe['clo
+00005450: 7365 275d 2c20 7469 6d65 7065 7269 6f64  se'], timeperiod
+00005460: 3d73 656c 662e 656d 615f 7065 7269 6f64  =self.ema_period
+00005470: 5f73 5f65 7869 742e 7661 6c75 6529 0a0a  _s_exit.value)..
+00005480: 0a20 2020 2020 2020 2023 2056 6f6c 756d  .        # Volum
+00005490: 6520 5765 6967 6874 6564 0a20 2020 2020  e Weighted.     
+000054a0: 2020 2064 6174 6166 7261 6d65 5b27 766f     dataframe['vo
+000054b0: 6c75 6d65 5f6d 6561 6e27 5d20 3d20 6461  lume_mean'] = da
+000054c0: 7461 6672 616d 655b 2776 6f6c 756d 6527  taframe['volume'
+000054d0: 5d2e 726f 6c6c 696e 6728 7365 6c66 2e76  ].rolling(self.v
+000054e0: 6f6c 756d 655f 6368 6563 6b2e 7661 6c75  olume_check.valu
+000054f0: 6529 2e6d 6561 6e28 292e 7368 6966 7428  e).mean().shift(
+00005500: 3129 0a20 2020 2020 2020 2064 6174 6166  1).        dataf
+00005510: 7261 6d65 5b27 766f 6c75 6d65 5f6d 6561  rame['volume_mea
+00005520: 6e5f 6578 6974 275d 203d 2064 6174 6166  n_exit'] = dataf
+00005530: 7261 6d65 5b27 766f 6c75 6d65 275d 2e72  rame['volume'].r
+00005540: 6f6c 6c69 6e67 2873 656c 662e 766f 6c75  olling(self.volu
+00005550: 6d65 5f63 6865 636b 5f65 7869 742e 7661  me_check_exit.va
+00005560: 6c75 6529 2e6d 6561 6e28 292e 7368 6966  lue).mean().shif
+00005570: 7428 3129 0a0a 2020 2020 2020 2020 6461  t(1)..        da
+00005580: 7461 6672 616d 655b 2776 6f6c 756d 655f  taframe['volume_
+00005590: 6d65 616e 5f73 275d 203d 2064 6174 6166  mean_s'] = dataf
+000055a0: 7261 6d65 5b27 766f 6c75 6d65 275d 2e72  rame['volume'].r
+000055b0: 6f6c 6c69 6e67 2873 656c 662e 766f 6c75  olling(self.volu
+000055c0: 6d65 5f63 6865 636b 5f73 2e76 616c 7565  me_check_s.value
+000055d0: 292e 6d65 616e 2829 2e73 6869 6674 2831  ).mean().shift(1
+000055e0: 290a 2020 2020 2020 2020 6461 7461 6672  ).        datafr
+000055f0: 616d 655b 2776 6f6c 756d 655f 6d65 616e  ame['volume_mean
+00005600: 5f65 7869 745f 7327 5d20 3d20 6461 7461  _exit_s'] = data
+00005610: 6672 616d 655b 2776 6f6c 756d 6527 5d2e  frame['volume'].
+00005620: 726f 6c6c 696e 6728 7365 6c66 2e76 6f6c  rolling(self.vol
+00005630: 756d 655f 6368 6563 6b5f 6578 6974 5f73  ume_check_exit_s
+00005640: 2e76 616c 7565 292e 6d65 616e 2829 2e73  .value).mean().s
+00005650: 6869 6674 2831 290a 2020 2020 2020 2020  hift(1).        
+00005660: 7265 7475 726e 2064 6174 6166 7261 6d65  return dataframe
+00005670: 0a20 2020 200a 2020 2020 6465 6620 706f  .    .    def po
+00005680: 7075 6c61 7465 5f65 6e74 7279 5f74 7265  pulate_entry_tre
+00005690: 6e64 2873 656c 662c 2064 6174 6166 7261  nd(self, datafra
+000056a0: 6d65 3a20 7064 2e44 6174 6146 7261 6d65  me: pd.DataFrame
+000056b0: 2c20 6d65 7461 6461 7461 3a20 6469 6374  , metadata: dict
+000056c0: 2920 2d3e 2070 642e 4461 7461 4672 616d  ) -> pd.DataFram
+000056d0: 653a 0a0a 2020 2020 2020 2020 6461 7461  e:..        data
+000056e0: 6672 616d 652e 6c6f 635b 0a20 2020 2020  frame.loc[.     
+000056f0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00005700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005710: 2028 6461 7461 6672 616d 655b 2761 6478   (dataframe['adx
+00005720: 275d 203e 2073 656c 662e 6164 785f 6c6f  '] > self.adx_lo
+00005730: 6e67 5f6d 696e 2e76 616c 7565 2920 2620  ng_min.value) & 
+00005740: 2320 7472 656e 6420 7374 7265 6e67 7468  # trend strength
+00005750: 2063 6f6e 6669 726d 6174 696f 6e0a 2020   confirmation.  
+00005760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005770: 2020 2020 2020 2864 6174 6166 7261 6d65        (dataframe
+00005780: 5b27 6164 7827 5d20 3c20 7365 6c66 2e61  ['adx'] < self.a
+00005790: 6478 5f6c 6f6e 675f 6d61 782e 7661 6c75  dx_long_max.valu
+000057a0: 6529 2026 2023 2074 7265 6e64 2073 7472  e) & # trend str
+000057b0: 656e 6774 6820 636f 6e66 6972 6d61 7469  ength confirmati
+000057c0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+000057d0: 2020 2020 2020 2020 2020 2028 6461 7461             (data
+000057e0: 6672 616d 655b 2774 7265 6e64 5f6c 275d  frame['trend_l']
+000057f0: 203e 2030 2920 260a 2020 2020 2020 2020   > 0) &.        
+00005800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005810: 2864 6174 6166 7261 6d65 5b27 766f 6c75  (dataframe['volu
+00005820: 6d65 275d 203e 2064 6174 6166 7261 6d65  me'] > dataframe
+00005830: 5b27 766f 6c75 6d65 5f6d 6561 6e27 5d29  ['volume_mean'])
+00005840: 2026 0a20 2020 2020 2020 2020 2020 2020   &.             
+00005850: 2020 2020 2020 2020 2020 2028 6461 7461             (data
+00005860: 6672 616d 655b 2776 6f6c 756d 6527 5d20  frame['volume'] 
+00005870: 3e20 3029 0a0a 2020 2020 2020 2020 2020  > 0)..          
+00005880: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00005890: 2027 656e 7465 725f 6c6f 6e67 275d 203d   'enter_long'] =
+000058a0: 2031 0a0a 2020 2020 2020 2020 6461 7461   1..        data
+000058b0: 6672 616d 652e 6c6f 635b 0a20 2020 2020  frame.loc[.     
+000058c0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000058d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058e0: 2028 6461 7461 6672 616d 655b 2761 6478   (dataframe['adx
+000058f0: 275d 203e 2073 656c 662e 6164 785f 7368  '] > self.adx_sh
+00005900: 6f72 745f 6d69 6e2e 7661 6c75 6529 2026  ort_min.value) &
+00005910: 2023 2074 7265 6e64 2073 7472 656e 6774   # trend strengt
+00005920: 6820 636f 6e66 6972 6d61 7469 6f6e 0a20  h confirmation. 
 00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005940: 2320 2864 6174 6166 7261 6d65 5b27 636c  # (dataframe['cl
-00005950: 6f73 6527 5d20 3e20 6461 7461 6672 616d  ose'] > datafram
-00005960: 655b 2768 6967 6827 5d2e 7368 6966 7428  e['high'].shift(
-00005970: 7365 6c66 2e73 656c 6c5f 7368 6966 745f  self.sell_shift_
-00005980: 7368 6f72 742e 7661 6c75 6529 2920 260a  short.value)) &.
-00005990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059a0: 2864 6174 6166 7261 6d65 5b27 636c 6f73  (dataframe['clos
-000059b0: 6527 5d20 3e20 6461 7461 6672 616d 655b  e'] > dataframe[
-000059c0: 2765 6d61 5f73 275d 2920 260a 2020 2020  'ema_s']) &.    
-000059d0: 2020 2020 2020 2020 2020 2020 2864 6174              (dat
-000059e0: 6166 7261 6d65 5b27 766f 6c75 6d65 275d  aframe['volume']
-000059f0: 203e 2064 6174 6166 7261 6d65 5b27 766f   > dataframe['vo
-00005a00: 6c75 6d65 5f6d 6561 6e5f 6578 6974 5f73  lume_mean_exit_s
-00005a10: 275d 290a 2020 2020 2020 2020 290a 0a0a  ']).        )...
-00005a20: 2020 2020 2020 2020 636f 6e64 6974 696f          conditio
-00005a30: 6e73 5f73 686f 7274 2e61 7070 656e 6428  ns_short.append(
-00005a40: 6578 6974 5f73 686f 7274 290a 2020 2020  exit_short).    
-00005a50: 2020 2020 6461 7461 6672 616d 652e 6c6f      dataframe.lo
-00005a60: 635b 6578 6974 5f73 686f 7274 2c20 2765  c[exit_short, 'e
-00005a70: 7869 745f 7461 6727 5d20 2b3d 2027 6578  xit_tag'] += 'ex
-00005a80: 6974 5f73 686f 7274 270a 0a0a 2020 2020  it_short'...    
-00005a90: 2020 2020 636f 6e64 6974 696f 6e73 5f6c      conditions_l
-00005aa0: 6f6e 672e 6170 7065 6e64 2865 7869 745f  ong.append(exit_
-00005ab0: 6c6f 6e67 290a 2020 2020 2020 2020 6461  long).        da
-00005ac0: 7461 6672 616d 652e 6c6f 635b 6578 6974  taframe.loc[exit
-00005ad0: 5f6c 6f6e 672c 2027 6578 6974 5f74 6167  _long, 'exit_tag
-00005ae0: 275d 202b 3d20 2765 7869 745f 6c6f 6e67  '] += 'exit_long
-00005af0: 270a 0a0a 2020 2020 2020 2020 6966 2063  '...        if c
-00005b00: 6f6e 6469 7469 6f6e 735f 6c6f 6e67 3a0a  onditions_long:.
-00005b10: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00005b20: 6672 616d 652e 6c6f 635b 0a20 2020 2020  frame.loc[.     
-00005b30: 2020 2020 2020 2020 2020 2070 642e 7265             pd.re
-00005b40: 6475 6365 286c 616d 6264 6120 782c 2079  duce(lambda x, y
-00005b50: 3a20 7820 7c20 792c 2063 6f6e 6469 7469  : x | y, conditi
-00005b60: 6f6e 735f 6c6f 6e67 292c 0a20 2020 2020  ons_long),.     
-00005b70: 2020 2020 2020 2020 2020 2027 6578 6974             'exit
-00005b80: 5f6c 6f6e 6727 5d20 3d20 310a 0a20 2020  _long'] = 1..   
-00005b90: 2020 2020 2069 6620 636f 6e64 6974 696f       if conditio
-00005ba0: 6e73 5f73 686f 7274 3a0a 2020 2020 2020  ns_short:.      
-00005bb0: 2020 2020 2020 6461 7461 6672 616d 652e        dataframe.
-00005bc0: 6c6f 635b 0a20 2020 2020 2020 2020 2020  loc[.           
-00005bd0: 2020 2020 2070 642e 7265 6475 6365 286c       pd.reduce(l
-00005be0: 616d 6264 6120 782c 2079 3a20 7820 7c20  ambda x, y: x | 
-00005bf0: 792c 2063 6f6e 6469 7469 6f6e 735f 7368  y, conditions_sh
-00005c00: 6f72 7429 2c0a 2020 2020 2020 2020 2020  ort),.          
-00005c10: 2020 2020 2020 2765 7869 745f 7368 6f72        'exit_shor
-00005c20: 7427 5d20 3d20 310a 2020 2020 2020 2020  t'] = 1.        
-00005c30: 2020 2020 0a20 2020 2020 2020 2072 6574      .        ret
-00005c40: 7572 6e20 6461 7461 6672 616d 650a 0a20  urn dataframe.. 
-00005c50: 2020 2023 2064 6566 2069 6465 6e74 6966     # def identif
-00005c60: 795f 6465 6d61 6e64 5f7a 6f6e 6528 7365  y_demand_zone(se
-00005c70: 6c66 2c64 6174 612c 2063 6d70 293a 0a20  lf,data, cmp):. 
-00005c80: 2020 2023 2020 2020 2064 656d 616e 645f     #     demand_
-00005c90: 7a6f 6e65 7320 3d20 5b5d 0a20 2020 2023  zones = [].    #
-00005ca0: 2020 2020 2064 726f 705f 6261 7365 5f72       drop_base_r
-00005cb0: 616c 6c79 5f7a 6f6e 6520 3d20 4661 6c73  ally_zone = Fals
-00005cc0: 650a 2020 2020 2320 2020 2020 7261 6c6c  e.    #     rall
-00005cd0: 795f 6261 7365 5f72 616c 6c79 5f7a 6f6e  y_base_rally_zon
-00005ce0: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
-00005cf0: 2020 0a20 2020 2023 2020 2020 2023 2041    .    #     # A
-00005d00: 6464 6974 696f 6e61 6c20 7661 7269 6162  dditional variab
-00005d10: 6c65 7320 746f 2074 7261 636b 2062 6173  les to track bas
-00005d20: 6520 6361 6e64 6c65 2070 7269 6365 7320  e candle prices 
-00005d30: 666f 7220 7072 6f78 696d 616c 206c 696e  for proximal lin
-00005d40: 6520 6361 6c63 756c 6174 696f 6e0a 2020  e calculation.  
-00005d50: 2020 2320 2020 2020 6261 7365 5f63 616e    #     base_can
-00005d60: 646c 655f 7072 6963 6573 203d 205b 5d0a  dle_prices = [].
-00005d70: 2020 2020 2020 2020 0a20 2020 2023 2020          .    #  
-00005d80: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00005d90: 6528 6c65 6e28 6461 7461 2920 2d20 3229  e(len(data) - 2)
-00005da0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00005db0: 6966 2064 6174 615b 2743 616e 646c 6520  if data['Candle 
-00005dc0: 5479 7065 275d 5b69 5d20 3d3d 2027 4472  Type'][i] == 'Dr
-00005dd0: 6f70 2043 616e 646c 6527 2061 6e64 2064  op Candle' and d
-00005de0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00005df0: 275d 5b69 202b 2031 5d20 3d3d 2027 4261  '][i + 1] == 'Ba
-00005e00: 7365 2043 616e 646c 6527 3a0a 2020 2020  se Candle':.    
-00005e10: 2320 2020 2020 2020 2020 2020 2020 6261  #             ba
-00005e20: 7365 5f63 6f75 6e74 203d 2031 0a20 2020  se_count = 1.   
-00005e30: 2023 2020 2020 2020 2020 2020 2020 206a   #             j
-00005e40: 203d 2069 202b 2032 0a20 2020 2023 2020   = i + 2.    #  
-00005e50: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-00005e60: 206a 203c 206c 656e 2864 6174 6129 2061   j < len(data) a
-00005e70: 6e64 2064 6174 615b 2743 616e 646c 6520  nd data['Candle 
-00005e80: 5479 7065 275d 5b6a 5d20 3d3d 2027 4261  Type'][j] == 'Ba
-00005e90: 7365 2043 616e 646c 6527 3a0a 2020 2020  se Candle':.    
-00005ea0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00005eb0: 2020 6261 7365 5f63 6f75 6e74 202b 3d20    base_count += 
-00005ec0: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
-00005ed0: 2020 2020 2020 2020 6a20 2b3d 2031 0a20          j += 1. 
-00005ee0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00005ef0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00005f00: 2020 6966 2062 6173 655f 636f 756e 7420    if base_count 
-00005f10: 3c3d 2034 3a20 2023 204d 6178 696d 756d  <= 4:  # Maximum
-00005f20: 206f 6620 3420 6261 7365 2063 616e 646c   of 4 base candl
-00005f30: 6573 2066 6f72 2077 6565 6b6c 7920 6f72  es for weekly or
-00005f40: 206d 6f6e 7468 6c79 2074 696d 6566 7261   monthly timefra
-00005f50: 6d65 2c20 656c 7365 2033 2066 6f72 2064  me, else 3 for d
-00005f60: 6169 6c79 0a20 2020 2023 2020 2020 2020  aily.    #      
-00005f70: 2020 2020 2020 2020 2020 2069 6620 6a20             if j 
-00005f80: 3c20 6c65 6e28 6461 7461 2920 616e 6420  < len(data) and 
-00005f90: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-00005fa0: 6527 5d5b 6a5d 203d 3d20 2752 616c 6c79  e'][j] == 'Rally
-00005fb0: 2043 616e 646c 6527 3a0a 2020 2020 2320   Candle':.    # 
-00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fd0: 2020 2020 6966 2064 6174 615b 2743 6c6f      if data['Clo
-00005fe0: 7365 275d 5b6a 5d20 3e20 6461 7461 5b27  se'][j] > data['
-00005ff0: 4c6f 7727 5d5b 695d 202b 2030 2e36 202a  Low'][i] + 0.6 *
-00006000: 2064 6174 615b 2743 616e 646c 6520 5261   data['Candle Ra
-00006010: 6e67 6527 5d5b 695d 2061 6e64 2064 6174  nge'][i] and dat
-00006020: 615b 2748 6967 6827 5d5b 695d 203c 3d20  a['High'][i] <= 
-00006030: 636d 703a 0a20 2020 2023 2020 2020 2020  cmp:.    #      
-00006040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006050: 2020 2023 2043 6865 636b 2066 6f72 206f     # Check for o
-00006060: 6e65 206d 6f72 6520 7261 6c6c 7920 6361  ne more rally ca
-00006070: 6e64 6c65 206f 7220 6772 6565 6e20 6261  ndle or green ba
-00006080: 7365 2063 616e 646c 650a 2020 2020 2320  se candle.    # 
-00006090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060a0: 2020 2020 2020 2020 6b20 3d20 6a20 2b20          k = j + 
-000060b0: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
-000060c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060d0: 7768 696c 6520 6b20 3c20 6c65 6e28 6461  while k < len(da
-000060e0: 7461 293a 0a20 2020 2023 2020 2020 2020  ta):.    #      
-000060f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006100: 2020 2020 2020 2069 6620 6461 7461 5b27         if data['
-00006110: 4361 6e64 6c65 2054 7970 6527 5d5b 6b5d  Candle Type'][k]
-00006120: 203d 3d20 2752 616c 6c79 2043 616e 646c   == 'Rally Candl
-00006130: 6527 206f 7220 2864 6174 615b 2743 616e  e' or (data['Can
-00006140: 646c 6520 5479 7065 275d 5b6b 5d20 3d3d  dle Type'][k] ==
-00006150: 2027 4261 7365 2043 616e 646c 6527 2061   'Base Candle' a
-00006160: 6e64 2064 6174 615b 2743 6c6f 7365 275d  nd data['Close']
-00006170: 5b6b 5d20 3e20 6461 7461 5b27 4f70 656e  [k] > data['Open
-00006180: 275d 5b6b 5d29 3a0a 2020 2020 2320 2020  '][k]):.    #   
-00006190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000061b0: 6d61 6e64 5f7a 6f6e 6573 2e61 7070 656e  mand_zones.appen
-000061c0: 6428 2869 2c20 6a2c 2027 4472 6f70 2042  d((i, j, 'Drop B
-000061d0: 6173 6520 5261 6c6c 7927 2c20 6261 7365  ase Rally', base
-000061e0: 5f63 6f75 6e74 2929 0a20 2020 2023 2020  _count)).    #  
-000061f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006200: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00006210: 726f 705f 6261 7365 5f72 616c 6c79 5f7a  rop_base_rally_z
-00006220: 6f6e 6520 3d20 5472 7565 0a20 2020 2023  one = True.    #
-00006230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006250: 2062 7265 616b 0a20 2020 2023 2020 2020   break.    #    
-00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006270: 2020 2020 2020 2020 206b 202b 3d20 310a           k += 1.
-00006280: 2020 2020 2320 2020 2020 2020 2020 656c      #         el
-00006290: 6966 2064 6174 615b 2743 616e 646c 6520  if data['Candle 
-000062a0: 5479 7065 275d 5b69 5d20 3d3d 2027 5261  Type'][i] == 'Ra
-000062b0: 6c6c 7920 4361 6e64 6c65 2720 616e 6420  lly Candle' and 
-000062c0: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
-000062d0: 6527 5d5b 6920 2b20 315d 203d 3d20 2742  e'][i + 1] == 'B
-000062e0: 6173 6520 4361 6e64 6c65 273a 0a20 2020  ase Candle':.   
-000062f0: 2023 2020 2020 2020 2020 2020 2020 2062   #             b
-00006300: 6173 655f 636f 756e 7420 3d20 310a 2020  ase_count = 1.  
-00006310: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00006320: 6a20 3d20 6920 2b20 320a 2020 2020 2320  j = i + 2.    # 
-00006330: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-00006340: 6520 6a20 3c20 6c65 6e28 6461 7461 2920  e j < len(data) 
-00006350: 616e 6420 6461 7461 5b27 4361 6e64 6c65  and data['Candle
-00006360: 2054 7970 6527 5d5b 6a5d 203d 3d20 2742   Type'][j] == 'B
-00006370: 6173 6520 4361 6e64 6c65 273a 0a20 2020  ase Candle':.   
-00006380: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00006390: 2020 2062 6173 655f 636f 756e 7420 2b3d     base_count +=
-000063a0: 2031 0a20 2020 2023 2020 2020 2020 2020   1.    #        
-000063b0: 2020 2020 2020 2020 206a 202b 3d20 310a           j += 1.
+00005940: 2020 2020 2020 2028 6461 7461 6672 616d         (datafram
+00005950: 655b 2761 6478 275d 203c 2073 656c 662e  e['adx'] < self.
+00005960: 6164 785f 7368 6f72 745f 6d61 782e 7661  adx_short_max.va
+00005970: 6c75 6529 2026 2023 2074 7265 6e64 2073  lue) & # trend s
+00005980: 7472 656e 6774 6820 636f 6e66 6972 6d61  trength confirma
+00005990: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+000059a0: 2020 2020 2020 2020 2020 2020 2028 6461               (da
+000059b0: 7461 6672 616d 655b 2774 7265 6e64 5f73  taframe['trend_s
+000059c0: 275d 203c 2030 2920 260a 2020 2020 2020  '] < 0) &.      
+000059d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059e0: 2020 2864 6174 6166 7261 6d65 5b27 766f    (dataframe['vo
+000059f0: 6c75 6d65 275d 203e 2064 6174 6166 7261  lume'] > datafra
+00005a00: 6d65 5b27 766f 6c75 6d65 5f6d 6561 6e5f  me['volume_mean_
+00005a10: 7327 5d29 2023 2076 6f6c 756d 6520 7765  s']) # volume we
+00005a20: 6967 6874 6564 2069 6e64 6963 6174 6f72  ighted indicator
+00005a30: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00005a40: 2020 2020 2020 2020 2020 2020 2765 6e74              'ent
+00005a50: 6572 5f73 686f 7274 275d 203d 2031 0a20  er_short'] = 1. 
+00005a60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00005a70: 7265 7475 726e 2064 6174 6166 7261 6d65  return dataframe
+00005a80: 0a20 2020 200a 2020 2020 6465 6620 706f  .    .    def po
+00005a90: 7075 6c61 7465 5f65 7869 745f 7472 656e  pulate_exit_tren
+00005aa0: 6428 7365 6c66 2c20 6461 7461 6672 616d  d(self, datafram
+00005ab0: 653a 2070 642e 4461 7461 4672 616d 652c  e: pd.DataFrame,
+00005ac0: 206d 6574 6164 6174 613a 2064 6963 7429   metadata: dict)
+00005ad0: 202d 3e20 7064 2e44 6174 6146 7261 6d65   -> pd.DataFrame
+00005ae0: 3a0a 0a20 2020 2020 2020 2063 6f6e 6469  :..        condi
+00005af0: 7469 6f6e 735f 6c6f 6e67 203d 205b 5d0a  tions_long = [].
+00005b00: 2020 2020 2020 2020 636f 6e64 6974 696f          conditio
+00005b10: 6e73 5f73 686f 7274 203d 205b 5d0a 2020  ns_short = [].  
+00005b20: 2020 2020 2020 6461 7461 6672 616d 652e        dataframe.
+00005b30: 6c6f 635b 3a2c 2027 6578 6974 5f74 6167  loc[:, 'exit_tag
+00005b40: 275d 203d 2027 270a 0a20 2020 2020 2020  '] = ''..       
+00005b50: 2065 7869 745f 6c6f 6e67 203d 2028 0a20   exit_long = (. 
+00005b60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00005b70: 2028 6461 7461 6672 616d 655b 2763 6c6f   (dataframe['clo
+00005b80: 7365 275d 203c 2064 6174 6166 7261 6d65  se'] < dataframe
+00005b90: 5b27 6c6f 7727 5d2e 7368 6966 7428 7365  ['low'].shift(se
+00005ba0: 6c66 2e73 656c 6c5f 7368 6966 742e 7661  lf.sell_shift.va
+00005bb0: 6c75 6529 2920 260a 2020 2020 2020 2020  lue)) &.        
+00005bc0: 2020 2020 2020 2020 2864 6174 6166 7261          (datafra
+00005bd0: 6d65 5b27 636c 6f73 6527 5d20 3c20 6461  me['close'] < da
+00005be0: 7461 6672 616d 655b 2765 6d61 5f6c 275d  taframe['ema_l']
+00005bf0: 2920 260a 2020 2020 2020 2020 2020 2020  ) &.            
+00005c00: 2020 2020 2864 6174 6166 7261 6d65 5b27      (dataframe['
+00005c10: 766f 6c75 6d65 275d 203e 2064 6174 6166  volume'] > dataf
+00005c20: 7261 6d65 5b27 766f 6c75 6d65 5f6d 6561  rame['volume_mea
+00005c30: 6e5f 6578 6974 275d 290a 2020 2020 2020  n_exit']).      
+00005c40: 2020 290a 0a20 2020 2020 2020 2065 7869    )..        exi
+00005c50: 745f 7368 6f72 7420 3d20 280a 2020 2020  t_short = (.    
+00005c60: 2020 2020 2020 2020 2020 2020 2320 2864              # (d
+00005c70: 6174 6166 7261 6d65 5b27 636c 6f73 6527  ataframe['close'
+00005c80: 5d20 3e20 6461 7461 6672 616d 655b 2768  ] > dataframe['h
+00005c90: 6967 6827 5d2e 7368 6966 7428 7365 6c66  igh'].shift(self
+00005ca0: 2e73 656c 6c5f 7368 6966 745f 7368 6f72  .sell_shift_shor
+00005cb0: 742e 7661 6c75 6529 2920 260a 2020 2020  t.value)) &.    
+00005cc0: 2020 2020 2020 2020 2020 2020 2864 6174              (dat
+00005cd0: 6166 7261 6d65 5b27 636c 6f73 6527 5d20  aframe['close'] 
+00005ce0: 3e20 6461 7461 6672 616d 655b 2765 6d61  > dataframe['ema
+00005cf0: 5f73 275d 2920 260a 2020 2020 2020 2020  _s']) &.        
+00005d00: 2020 2020 2020 2020 2864 6174 6166 7261          (datafra
+00005d10: 6d65 5b27 766f 6c75 6d65 275d 203e 2064  me['volume'] > d
+00005d20: 6174 6166 7261 6d65 5b27 766f 6c75 6d65  ataframe['volume
+00005d30: 5f6d 6561 6e5f 6578 6974 5f73 275d 290a  _mean_exit_s']).
+00005d40: 2020 2020 2020 2020 290a 0a0a 2020 2020          )...    
+00005d50: 2020 2020 636f 6e64 6974 696f 6e73 5f73      conditions_s
+00005d60: 686f 7274 2e61 7070 656e 6428 6578 6974  hort.append(exit
+00005d70: 5f73 686f 7274 290a 2020 2020 2020 2020  _short).        
+00005d80: 6461 7461 6672 616d 652e 6c6f 635b 6578  dataframe.loc[ex
+00005d90: 6974 5f73 686f 7274 2c20 2765 7869 745f  it_short, 'exit_
+00005da0: 7461 6727 5d20 2b3d 2027 6578 6974 5f73  tag'] += 'exit_s
+00005db0: 686f 7274 270a 0a0a 2020 2020 2020 2020  hort'...        
+00005dc0: 636f 6e64 6974 696f 6e73 5f6c 6f6e 672e  conditions_long.
+00005dd0: 6170 7065 6e64 2865 7869 745f 6c6f 6e67  append(exit_long
+00005de0: 290a 2020 2020 2020 2020 6461 7461 6672  ).        datafr
+00005df0: 616d 652e 6c6f 635b 6578 6974 5f6c 6f6e  ame.loc[exit_lon
+00005e00: 672c 2027 6578 6974 5f74 6167 275d 202b  g, 'exit_tag'] +
+00005e10: 3d20 2765 7869 745f 6c6f 6e67 270a 0a0a  = 'exit_long'...
+00005e20: 2020 2020 2020 2020 6966 2063 6f6e 6469          if condi
+00005e30: 7469 6f6e 735f 6c6f 6e67 3a0a 2020 2020  tions_long:.    
+00005e40: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+00005e50: 652e 6c6f 635b 0a20 2020 2020 2020 2020  e.loc[.         
+00005e60: 2020 2020 2020 2070 642e 7265 6475 6365         pd.reduce
+00005e70: 286c 616d 6264 6120 782c 2079 3a20 7820  (lambda x, y: x 
+00005e80: 7c20 792c 2063 6f6e 6469 7469 6f6e 735f  | y, conditions_
+00005e90: 6c6f 6e67 292c 0a20 2020 2020 2020 2020  long),.         
+00005ea0: 2020 2020 2020 2027 6578 6974 5f6c 6f6e         'exit_lon
+00005eb0: 6727 5d20 3d20 310a 0a20 2020 2020 2020  g'] = 1..       
+00005ec0: 2069 6620 636f 6e64 6974 696f 6e73 5f73   if conditions_s
+00005ed0: 686f 7274 3a0a 2020 2020 2020 2020 2020  hort:.          
+00005ee0: 2020 6461 7461 6672 616d 652e 6c6f 635b    dataframe.loc[
+00005ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005f00: 2070 642e 7265 6475 6365 286c 616d 6264   pd.reduce(lambd
+00005f10: 6120 782c 2079 3a20 7820 7c20 792c 2063  a x, y: x | y, c
+00005f20: 6f6e 6469 7469 6f6e 735f 7368 6f72 7429  onditions_short)
+00005f30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005f40: 2020 2765 7869 745f 7368 6f72 7427 5d20    'exit_short'] 
+00005f50: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00005f60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005f70: 6461 7461 6672 616d 650a 0a20 2020 2023  dataframe..    #
+00005f80: 2064 6566 2069 6465 6e74 6966 795f 6465   def identify_de
+00005f90: 6d61 6e64 5f7a 6f6e 6528 7365 6c66 2c64  mand_zone(self,d
+00005fa0: 6174 612c 2063 6d70 293a 0a20 2020 2023  ata, cmp):.    #
+00005fb0: 2020 2020 2064 656d 616e 645f 7a6f 6e65       demand_zone
+00005fc0: 7320 3d20 5b5d 0a20 2020 2023 2020 2020  s = [].    #    
+00005fd0: 2064 726f 705f 6261 7365 5f72 616c 6c79   drop_base_rally
+00005fe0: 5f7a 6f6e 6520 3d20 4661 6c73 650a 2020  _zone = False.  
+00005ff0: 2020 2320 2020 2020 7261 6c6c 795f 6261    #     rally_ba
+00006000: 7365 5f72 616c 6c79 5f7a 6f6e 6520 3d20  se_rally_zone = 
+00006010: 4661 6c73 650a 2020 2020 2020 2020 0a20  False.        . 
+00006020: 2020 2023 2020 2020 2023 2041 6464 6974     #     # Addit
+00006030: 696f 6e61 6c20 7661 7269 6162 6c65 7320  ional variables 
+00006040: 746f 2074 7261 636b 2062 6173 6520 6361  to track base ca
+00006050: 6e64 6c65 2070 7269 6365 7320 666f 7220  ndle prices for 
+00006060: 7072 6f78 696d 616c 206c 696e 6520 6361  proximal line ca
+00006070: 6c63 756c 6174 696f 6e0a 2020 2020 2320  lculation.    # 
+00006080: 2020 2020 6261 7365 5f63 616e 646c 655f      base_candle_
+00006090: 7072 6963 6573 203d 205b 5d0a 2020 2020  prices = [].    
+000060a0: 2020 2020 0a20 2020 2023 2020 2020 2066      .    #     f
+000060b0: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+000060c0: 6e28 6461 7461 2920 2d20 3229 3a0a 2020  n(data) - 2):.  
+000060d0: 2020 2320 2020 2020 2020 2020 6966 2064    #         if d
+000060e0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+000060f0: 275d 5b69 5d20 3d3d 2027 4472 6f70 2043  '][i] == 'Drop C
+00006100: 616e 646c 6527 2061 6e64 2064 6174 615b  andle' and data[
+00006110: 2743 616e 646c 6520 5479 7065 275d 5b69  'Candle Type'][i
+00006120: 202b 2031 5d20 3d3d 2027 4261 7365 2043   + 1] == 'Base C
+00006130: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+00006140: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
+00006150: 6f75 6e74 203d 2031 0a20 2020 2023 2020  ount = 1.    #  
+00006160: 2020 2020 2020 2020 2020 206a 203d 2069             j = i
+00006170: 202b 2032 0a20 2020 2023 2020 2020 2020   + 2.    #      
+00006180: 2020 2020 2020 2077 6869 6c65 206a 203c         while j <
+00006190: 206c 656e 2864 6174 6129 2061 6e64 2064   len(data) and d
+000061a0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+000061b0: 275d 5b6a 5d20 3d3d 2027 4261 7365 2043  '][j] == 'Base C
+000061c0: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+000061d0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+000061e0: 7365 5f63 6f75 6e74 202b 3d20 310a 2020  se_count += 1.  
+000061f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006200: 2020 2020 6a20 2b3d 2031 0a20 2020 2020      j += 1.     
+00006210: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00006220: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+00006230: 2062 6173 655f 636f 756e 7420 3c3d 2034   base_count <= 4
+00006240: 3a20 2023 204d 6178 696d 756d 206f 6620  :  # Maximum of 
+00006250: 3420 6261 7365 2063 616e 646c 6573 2066  4 base candles f
+00006260: 6f72 2077 6565 6b6c 7920 6f72 206d 6f6e  or weekly or mon
+00006270: 7468 6c79 2074 696d 6566 7261 6d65 2c20  thly timeframe, 
+00006280: 656c 7365 2033 2066 6f72 2064 6169 6c79  else 3 for daily
+00006290: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+000062a0: 2020 2020 2020 2069 6620 6a20 3c20 6c65         if j < le
+000062b0: 6e28 6461 7461 2920 616e 6420 6461 7461  n(data) and data
+000062c0: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
+000062d0: 6a5d 203d 3d20 2752 616c 6c79 2043 616e  j] == 'Rally Can
+000062e0: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
+000062f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006300: 6966 2064 6174 615b 2743 6c6f 7365 275d  if data['Close']
+00006310: 5b6a 5d20 3e20 6461 7461 5b27 4c6f 7727  [j] > data['Low'
+00006320: 5d5b 695d 202b 2030 2e36 202a 2064 6174  ][i] + 0.6 * dat
+00006330: 615b 2743 616e 646c 6520 5261 6e67 6527  a['Candle Range'
+00006340: 5d5b 695d 2061 6e64 2064 6174 615b 2748  ][i] and data['H
+00006350: 6967 6827 5d5b 695d 203c 3d20 636d 703a  igh'][i] <= cmp:
+00006360: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006370: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00006380: 2043 6865 636b 2066 6f72 206f 6e65 206d   Check for one m
+00006390: 6f72 6520 7261 6c6c 7920 6361 6e64 6c65  ore rally candle
+000063a0: 206f 7220 6772 6565 6e20 6261 7365 2063   or green base c
+000063b0: 616e 646c 650a 2020 2020 2320 2020 2020  andle.    #     
 000063c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000063e0: 2020 2069 6620 6261 7365 5f63 6f75 6e74     if base_count
-000063f0: 203e 3d20 313a 2020 2320 4174 206c 6561   >= 1:  # At lea
-00006400: 7374 206f 6e65 2062 6173 6520 6361 6e64  st one base cand
-00006410: 6c65 2072 6571 7569 7265 640a 2020 2020  le required.    
-00006420: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00006430: 2020 6966 206a 203c 206c 656e 2864 6174    if j < len(dat
-00006440: 6129 2061 6e64 2064 6174 615b 2743 616e  a) and data['Can
-00006450: 646c 6520 5479 7065 275d 5b6a 5d20 3d3d  dle Type'][j] ==
-00006460: 2027 5261 6c6c 7920 4361 6e64 6c65 273a   'Rally Candle':
-00006470: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00006480: 2020 2020 2020 2020 2020 2069 6620 6461             if da
-00006490: 7461 5b27 436c 6f73 6527 5d5b 6a5d 203e  ta['Close'][j] >
-000064a0: 2064 6174 615b 2743 6c6f 7365 275d 5b69   data['Close'][i
-000064b0: 5d20 616e 6420 6461 7461 5b27 4869 6768  ] and data['High
-000064c0: 275d 5b69 5d20 3c3d 2063 6d70 3a20 2023  '][i] <= cmp:  #
-000064d0: 204e 6577 2063 6f6e 6469 7469 6f6e 3a20   New condition: 
-000064e0: 636c 6f73 6520 6f66 2032 6e64 2072 616c  close of 2nd ral
-000064f0: 6c79 2063 616e 646c 6520 3e20 3173 7420  ly candle > 1st 
-00006500: 7261 6c6c 7920 6361 6e64 6c65 0a20 2020  rally candle.   
-00006510: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00006520: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00006530: 636b 2066 6f72 206f 6e65 206d 6f72 6520  ck for one more 
-00006540: 7261 6c6c 7920 6361 6e64 6c65 206f 7220  rally candle or 
-00006550: 6772 6565 6e20 6261 7365 2063 616e 646c  green base candl
-00006560: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 6b20 3d20 6a20 2b20 310a 2020 2020 2320  k = j + 1.    # 
+000063d0: 2020 2020 6b20 3d20 6a20 2b20 310a 2020      k = j + 1.  
+000063e0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000063f0: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00006400: 6520 6b20 3c20 6c65 6e28 6461 7461 293a  e k < len(data):
+00006410: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006430: 2020 2069 6620 6461 7461 5b27 4361 6e64     if data['Cand
+00006440: 6c65 2054 7970 6527 5d5b 6b5d 203d 3d20  le Type'][k] == 
+00006450: 2752 616c 6c79 2043 616e 646c 6527 206f  'Rally Candle' o
+00006460: 7220 2864 6174 615b 2743 616e 646c 6520  r (data['Candle 
+00006470: 5479 7065 275d 5b6b 5d20 3d3d 2027 4261  Type'][k] == 'Ba
+00006480: 7365 2043 616e 646c 6527 2061 6e64 2064  se Candle' and d
+00006490: 6174 615b 2743 6c6f 7365 275d 5b6b 5d20  ata['Close'][k] 
+000064a0: 3e20 6461 7461 5b27 4f70 656e 275d 5b6b  > data['Open'][k
+000064b0: 5d29 3a0a 2020 2020 2320 2020 2020 2020  ]):.    #       
+000064c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064d0: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
+000064e0: 5f7a 6f6e 6573 2e61 7070 656e 6428 2869  _zones.append((i
+000064f0: 2c20 6a2c 2027 4472 6f70 2042 6173 6520  , j, 'Drop Base 
+00006500: 5261 6c6c 7927 2c20 6261 7365 5f63 6f75  Rally', base_cou
+00006510: 6e74 2929 0a20 2020 2023 2020 2020 2020  nt)).    #      
+00006520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006530: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
+00006540: 6261 7365 5f72 616c 6c79 5f7a 6f6e 6520  base_rally_zone 
+00006550: 3d20 5472 7565 0a20 2020 2023 2020 2020  = True.    #    
+00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006570: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00006580: 616b 0a20 2020 2023 2020 2020 2020 2020  ak.    #        
 00006590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065a0: 2020 2020 2020 2020 7768 696c 6520 6b20          while k 
-000065b0: 3c20 6c65 6e28 6461 7461 293a 0a20 2020  < len(data):.   
-000065c0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-000065d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000065e0: 6620 6461 7461 5b27 4361 6e64 6c65 2054  f data['Candle T
-000065f0: 7970 6527 5d5b 6b5d 203d 3d20 2752 616c  ype'][k] == 'Ral
-00006600: 6c79 2043 616e 646c 6527 206f 7220 2864  ly Candle' or (d
-00006610: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00006620: 275d 5b6b 5d20 3d3d 2027 4261 7365 2043  '][k] == 'Base C
-00006630: 616e 646c 6527 2061 6e64 2064 6174 615b  andle' and data[
-00006640: 2743 6c6f 7365 275d 5b6b 5d20 3e20 6461  'Close'][k] > da
-00006650: 7461 5b27 4f70 656e 275d 5b6b 5d29 3a0a  ta['Open'][k]):.
-00006660: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00006670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006680: 2020 2020 2020 6465 6d61 6e64 5f7a 6f6e        demand_zon
-00006690: 6573 2e61 7070 656e 6428 2869 2c20 6a2c  es.append((i, j,
-000066a0: 2027 5261 6c6c 7920 4261 7365 2052 616c   'Rally Base Ral
-000066b0: 6c79 272c 2062 6173 655f 636f 756e 7429  ly', base_count)
-000066c0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-000066d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000066e0: 2020 2020 2020 2020 7261 6c6c 795f 6261          rally_ba
-000066f0: 7365 5f72 616c 6c79 5f7a 6f6e 6520 3d20  se_rally_zone = 
-00006700: 5472 7565 0a20 2020 2023 2020 2020 2020  True.    #      
-00006710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006720: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00006730: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00006740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006750: 2020 206b 202b 3d20 310a 2020 2020 2020     k += 1.      
-00006760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006770: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
-00006780: 2020 2020 2023 2043 6f6c 6c65 6374 2062       # Collect b
-00006790: 6173 6520 6361 6e64 6c65 2070 7269 6365  ase candle price
-000067a0: 7320 666f 7220 7072 6f78 696d 616c 206c  s for proximal l
-000067b0: 696e 6520 6361 6c63 756c 6174 696f 6e0a  ine calculation.
-000067c0: 2020 2020 2320 2020 2020 2020 2020 6966      #         if
-000067d0: 2064 6174 615b 2743 616e 646c 6520 5479   data['Candle Ty
-000067e0: 7065 275d 5b69 5d20 3d3d 2027 4261 7365  pe'][i] == 'Base
-000067f0: 2043 616e 646c 6527 3a0a 2020 2020 2320   Candle':.    # 
-00006800: 2020 2020 2020 2020 2020 2020 6261 7365              base
-00006810: 5f63 616e 646c 655f 7072 6963 6573 2e61  _candle_prices.a
-00006820: 7070 656e 6428 6461 7461 5b27 436c 6f73  ppend(data['Clos
-00006830: 6527 5d5b 695d 290a 0a20 2020 2023 2020  e'][i])..    #  
-00006840: 2020 2023 2043 616c 6375 6c61 7465 2070     # Calculate p
-00006850: 726f 7869 6d61 6c20 6c69 6e65 2070 7269  roximal line pri
-00006860: 6365 2028 6869 6768 6573 7420 7072 6963  ce (highest pric
-00006870: 6520 616d 6f6e 6720 6261 7365 2063 616e  e among base can
-00006880: 646c 6573 290a 2020 2020 2320 2020 2020  dles).    #     
-00006890: 7072 6f78 696d 616c 5f6c 696e 655f 7072  proximal_line_pr
-000068a0: 6963 6520 3d20 6d61 7828 6261 7365 5f63  ice = max(base_c
-000068b0: 616e 646c 655f 7072 6963 6573 2920 6966  andle_prices) if
-000068c0: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
-000068d0: 6365 7320 656c 7365 204e 6f6e 650a 0a20  ces else None.. 
-000068e0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
-000068f0: 6465 6d61 6e64 5f7a 6f6e 6573 2c20 6472  demand_zones, dr
-00006900: 6f70 5f62 6173 655f 7261 6c6c 795f 7a6f  op_base_rally_zo
-00006910: 6e65 2c20 7261 6c6c 795f 6261 7365 5f72  ne, rally_base_r
-00006920: 616c 6c79 5f7a 6f6e 652c 2070 726f 7869  ally_zone, proxi
-00006930: 6d61 6c5f 6c69 6e65 5f70 7269 6365 0a0a  mal_line_price..
-00006940: 2020 2020 2320 6465 6620 6964 656e 7469      # def identi
-00006950: 6679 5f73 7570 706c 795f 7a6f 6e65 2873  fy_supply_zone(s
-00006960: 656c 662c 6461 7461 2c20 636d 7029 3a0a  elf,data, cmp):.
-00006970: 2020 2020 2320 2020 2020 7375 7070 6c79      #     supply
-00006980: 5f7a 6f6e 6573 203d 205b 5d0a 2020 2020  _zones = [].    
-00006990: 2320 2020 2020 7261 6c6c 795f 6261 7365  #     rally_base
-000069a0: 5f64 726f 705f 7a6f 6e65 203d 2046 616c  _drop_zone = Fal
-000069b0: 7365 0a20 2020 2023 2020 2020 2064 726f  se.    #     dro
-000069c0: 705f 6261 7365 5f64 726f 705f 7a6f 6e65  p_base_drop_zone
-000069d0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000069e0: 200a 2020 2020 2320 2020 2020 2320 4164   .    #     # Ad
-000069f0: 6469 7469 6f6e 616c 2076 6172 6961 626c  ditional variabl
-00006a00: 6573 2074 6f20 7472 6163 6b20 6261 7365  es to track base
-00006a10: 2063 616e 646c 6520 7072 6963 6573 2066   candle prices f
-00006a20: 6f72 2070 726f 7869 6d61 6c20 6c69 6e65  or proximal line
-00006a30: 2063 616c 6375 6c61 7469 6f6e 0a20 2020   calculation.   
-00006a40: 2023 2020 2020 2062 6173 655f 6361 6e64   #     base_cand
-00006a50: 6c65 5f70 7269 6365 7320 3d20 5b5d 0a20  le_prices = []. 
-00006a60: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
-00006a70: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00006a80: 286c 656e 2864 6174 6129 202d 2032 293a  (len(data) - 2):
-00006a90: 0a20 2020 2023 2020 2020 2020 2020 2069  .    #         i
-00006aa0: 6620 6461 7461 5b27 4361 6e64 6c65 2054  f data['Candle T
-00006ab0: 7970 6527 5d5b 695d 203d 3d20 2744 726f  ype'][i] == 'Dro
-00006ac0: 7020 4361 6e64 6c65 2720 616e 6420 6461  p Candle' and da
-00006ad0: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
-00006ae0: 5d5b 6920 2b20 315d 203d 3d20 2742 6173  ][i + 1] == 'Bas
-00006af0: 6520 4361 6e64 6c65 273a 0a20 2020 2023  e Candle':.    #
-00006b00: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-00006b10: 655f 636f 756e 7420 3d20 310a 2020 2020  e_count = 1.    
-00006b20: 2320 2020 2020 2020 2020 2020 2020 6a20  #             j 
-00006b30: 3d20 6920 2b20 320a 2020 2020 2320 2020  = i + 2.    #   
-00006b40: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00006b50: 6a20 3c20 6c65 6e28 6461 7461 2920 616e  j < len(data) an
-00006b60: 6420 6461 7461 5b27 4361 6e64 6c65 2054  d data['Candle T
-00006b70: 7970 6527 5d5b 6a5d 203d 3d20 2742 6173  ype'][j] == 'Bas
-00006b80: 6520 4361 6e64 6c65 273a 0a20 2020 2023  e Candle':.    #
-00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ba0: 2062 6173 655f 636f 756e 7420 2b3d 2031   base_count += 1
-00006bb0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00006bc0: 2020 2020 2020 206a 202b 3d20 310a 2020         j += 1.  
-00006bd0: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00006be0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00006bf0: 2069 6620 6261 7365 5f63 6f75 6e74 203c   if base_count <
-00006c00: 3d20 343a 2020 2320 4d61 7869 6d75 6d20  = 4:  # Maximum 
-00006c10: 6f66 2034 2062 6173 6520 6361 6e64 6c65  of 4 base candle
-00006c20: 7320 666f 7220 7765 656b 6c79 206f 7220  s for weekly or 
-00006c30: 6d6f 6e74 686c 7920 7469 6d65 6672 616d  monthly timefram
-00006c40: 652c 2065 6c73 6520 3320 666f 7220 6461  e, else 3 for da
-00006c50: 696c 790a 2020 2020 2320 2020 2020 2020  ily.    #       
-00006c60: 2020 2020 2020 2020 2020 6966 206a 203c            if j <
-00006c70: 206c 656e 2864 6174 6129 2061 6e64 2064   len(data) and d
-00006c80: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00006c90: 275d 5b6a 5d20 3d3d 2027 4472 6f70 2043  '][j] == 'Drop C
-00006ca0: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
-00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cc0: 2020 6966 2064 6174 615b 2743 6c6f 7365    if data['Close
-00006cd0: 275d 5b69 5d20 3c20 6461 7461 5b27 4c6f  '][i] < data['Lo
-00006ce0: 7727 5d5b 6a5d 2061 6e64 2064 6174 615b  w'][j] and data[
-00006cf0: 274c 6f77 275d 5b69 5d20 3e3d 2063 6d70  'Low'][i] >= cmp
-00006d00: 3a20 2023 204e 6577 2063 6f6e 6469 7469  :  # New conditi
-00006d10: 6f6e 3a20 636c 6f73 6520 6f66 2064 726f  on: close of dro
-00006d20: 7020 6361 6e64 6c65 203c 206c 6f77 206f  p candle < low o
-00006d30: 6620 6261 7365 2063 616e 646c 650a 2020  f base candle.  
-00006d40: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00006d50: 2020 2020 2020 2020 2020 2020 2320 4e65              # Ne
-00006d60: 7720 6c6f 6769 633a 204c 6f6f 6b20 666f  w logic: Look fo
-00006d70: 7220 6f6e 6520 6d6f 7265 2064 726f 7020  r one more drop 
-00006d80: 6361 6e64 6c65 206f 7220 7265 6420 6261  candle or red ba
-00006d90: 7365 2063 616e 646c 650a 2020 2020 2320  se candle.    # 
-00006da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006db0: 2020 2020 2020 2020 6b20 3d20 6a20 2b20          k = j + 
-00006dc0: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
-00006dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006de0: 7768 696c 6520 6b20 3c20 6c65 6e28 6461  while k < len(da
-00006df0: 7461 2920 616e 6420 2864 6174 615b 2743  ta) and (data['C
-00006e00: 616e 646c 6520 5479 7065 275d 5b6b 5d20  andle Type'][k] 
-00006e10: 3d3d 2027 4472 6f70 2043 616e 646c 6527  == 'Drop Candle'
-00006e20: 206f 7220 6461 7461 5b27 436c 6f73 6527   or data['Close'
-00006e30: 5d5b 6b5d 203c 2064 6174 615b 274f 7065  ][k] < data['Ope
-00006e40: 6e27 5d5b 6b5d 293a 0a20 2020 2023 2020  n'][k]):.    #  
-00006e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e60: 2020 2020 2020 2020 2020 206b 202b 3d20             k += 
-00006e70: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
-00006e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e90: 6966 206b 203c 206c 656e 2864 6174 6129  if k < len(data)
-00006ea0: 2061 6e64 2028 6461 7461 5b27 4361 6e64   and (data['Cand
-00006eb0: 6c65 2054 7970 6527 5d5b 6b5d 203d 3d20  le Type'][k] == 
-00006ec0: 2744 726f 7020 4361 6e64 6c65 2720 6f72  'Drop Candle' or
-00006ed0: 2064 6174 615b 2743 6c6f 7365 275d 5b6b   data['Close'][k
-00006ee0: 5d20 3c20 6461 7461 5b27 4f70 656e 275d  ] < data['Open']
-00006ef0: 5b6b 5d29 3a0a 2020 2020 2320 2020 2020  [k]):.    #     
-00006f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f10: 2020 2020 2020 2020 7375 7070 6c79 5f7a          supply_z
-00006f20: 6f6e 6573 2e61 7070 656e 6428 2869 2c20  ones.append((i, 
-00006f30: 6a2c 2027 4472 6f70 2042 6173 6520 4472  j, 'Drop Base Dr
-00006f40: 6f70 272c 2062 6173 655f 636f 756e 7429  op', base_count)
-00006f50: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-00006f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f70: 2020 2020 6472 6f70 5f62 6173 655f 6472      drop_base_dr
-00006f80: 6f70 5f7a 6f6e 6520 3d20 5472 7565 0a20  op_zone = True. 
-00006f90: 2020 2023 2020 2020 2020 2020 2065 6c69     #         eli
-00006fa0: 6620 6461 7461 5b27 4361 6e64 6c65 2054  f data['Candle T
-00006fb0: 7970 6527 5d5b 695d 203d 3d20 2752 616c  ype'][i] == 'Ral
-00006fc0: 6c79 2043 616e 646c 6527 2061 6e64 2064  ly Candle' and d
-00006fd0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00006fe0: 275d 5b69 202b 2031 5d20 3d3d 2027 4261  '][i + 1] == 'Ba
-00006ff0: 7365 2043 616e 646c 6527 3a0a 2020 2020  se Candle':.    
-00007000: 2320 2020 2020 2020 2020 2020 2020 6261  #             ba
-00007010: 7365 5f63 6f75 6e74 203d 2031 0a20 2020  se_count = 1.   
-00007020: 2023 2020 2020 2020 2020 2020 2020 206a   #             j
-00007030: 203d 2069 202b 2032 0a20 2020 2023 2020   = i + 2.    #  
-00007040: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-00007050: 206a 203c 206c 656e 2864 6174 6129 2061   j < len(data) a
-00007060: 6e64 2064 6174 615b 2743 616e 646c 6520  nd data['Candle 
-00007070: 5479 7065 275d 5b6a 5d20 3d3d 2027 4261  Type'][j] == 'Ba
-00007080: 7365 2043 616e 646c 6527 3a0a 2020 2020  se Candle':.    
-00007090: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000070a0: 2020 6261 7365 5f63 6f75 6e74 202b 3d20    base_count += 
-000070b0: 310a 2020 2020 2320 2020 2020 2020 2020  1.    #         
-000070c0: 2020 2020 2020 2020 6a20 2b3d 2031 0a20          j += 1. 
-000070d0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-000070e0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-000070f0: 2020 6966 2062 6173 655f 636f 756e 7420    if base_count 
-00007100: 3e3d 2031 3a20 2023 2041 7420 6c65 6173  >= 1:  # At leas
-00007110: 7420 6f6e 6520 6261 7365 2063 616e 646c  t one base candl
-00007120: 6520 7265 7175 6972 6564 0a20 2020 2023  e required.    #
-00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007140: 2069 6620 6a20 3c20 6c65 6e28 6461 7461   if j < len(data
-00007150: 2920 616e 6420 6461 7461 5b27 4361 6e64  ) and data['Cand
-00007160: 6c65 2054 7970 6527 5d5b 6a5d 203d 3d20  le Type'][j] == 
-00007170: 2744 726f 7020 4361 6e64 6c65 273a 0a20  'Drop Candle':. 
-00007180: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00007190: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-000071a0: 5b27 436c 6f73 6527 5d5b 6a5d 203c 2064  ['Close'][j] < d
-000071b0: 6174 615b 274f 7065 6e27 5d5b 6a5d 2061  ata['Open'][j] a
-000071c0: 6e64 2064 6174 615b 274c 6f77 275d 5b69  nd data['Low'][i
-000071d0: 5d20 3e3d 2063 6d70 3a20 2023 204d 6f64  ] >= cmp:  # Mod
-000071e0: 6966 6965 6420 636f 6e64 6974 696f 6e3a  ified condition:
-000071f0: 2063 6c6f 7365 206f 6620 6472 6f70 2063   close of drop c
-00007200: 616e 646c 6520 3c20 6f70 656e 206f 6620  andle < open of 
-00007210: 6472 6f70 2063 616e 646c 650a 2020 2020  drop candle.    
-00007220: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00007230: 2020 2020 2020 2020 2020 7375 7070 6c79            supply
-00007240: 5f7a 6f6e 6573 2e61 7070 656e 6428 2869  _zones.append((i
-00007250: 2c20 6a2c 2027 5261 6c6c 7920 4261 7365  , j, 'Rally Base
-00007260: 2044 726f 7027 2c20 6261 7365 5f63 6f75   Drop', base_cou
-00007270: 6e74 2929 0a20 2020 2023 2020 2020 2020  nt)).    #      
-00007280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007290: 2020 2072 616c 6c79 5f62 6173 655f 6472     rally_base_dr
-000072a0: 6f70 5f7a 6f6e 6520 3d20 5472 7565 0a20  op_zone = True. 
-000072b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072c0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-000072d0: 2320 2020 2020 2020 2020 2320 436f 6c6c  #         # Coll
-000072e0: 6563 7420 6261 7365 2063 616e 646c 6520  ect base candle 
-000072f0: 7072 6963 6573 2066 6f72 2070 726f 7869  prices for proxi
-00007300: 6d61 6c20 6c69 6e65 2063 616c 6375 6c61  mal line calcula
-00007310: 7469 6f6e 0a20 2020 2023 2020 2020 2020  tion.    #      
-00007320: 2020 2069 6620 6461 7461 5b27 4361 6e64     if data['Cand
-00007330: 6c65 2054 7970 6527 5d5b 695d 203d 3d20  le Type'][i] == 
-00007340: 2742 6173 6520 4361 6e64 6c65 273a 0a20  'Base Candle':. 
-00007350: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00007360: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
-00007370: 6365 732e 6170 7065 6e64 2864 6174 615b  ces.append(data[
-00007380: 2743 6c6f 7365 275d 5b69 5d29 0a0a 2020  'Close'][i])..  
-00007390: 2020 2320 2020 2020 2320 4361 6c63 756c    #     # Calcul
-000073a0: 6174 6520 7072 6f78 696d 616c 206c 696e  ate proximal lin
-000073b0: 6520 7072 6963 6520 286c 6f77 6573 7420  e price (lowest 
-000073c0: 7072 6963 6520 616d 6f6e 6720 6261 7365  price among base
-000073d0: 2063 616e 646c 6573 290a 2020 2020 2320   candles).    # 
-000073e0: 2020 2020 7072 6f78 696d 616c 5f6c 696e      proximal_lin
-000073f0: 655f 7072 6963 6520 3d20 6d69 6e28 6261  e_price = min(ba
-00007400: 7365 5f63 616e 646c 655f 7072 6963 6573  se_candle_prices
-00007410: 2920 6966 2062 6173 655f 6361 6e64 6c65  ) if base_candle
-00007420: 5f70 7269 6365 7320 656c 7365 204e 6f6e  _prices else Non
-00007430: 650a 0a20 2020 2023 2020 2020 2072 6574  e..    #     ret
-00007440: 7572 6e20 7375 7070 6c79 5f7a 6f6e 6573  urn supply_zones
-00007450: 2c20 7261 6c6c 795f 6261 7365 5f64 726f  , rally_base_dro
-00007460: 705f 7a6f 6e65 2c20 6472 6f70 5f62 6173  p_zone, drop_bas
-00007470: 655f 6472 6f70 5f7a 6f6e 652c 2070 726f  e_drop_zone, pro
-00007480: 7869 6d61 6c5f 6c69 6e65 5f70 7269 6365  ximal_line_price
-00007490: 0a0a 2020 2020 2320 6465 6620 6361 6c63  ..    # def calc
-000074a0: 756c 6174 655f 6465 6d61 6e64 5f70 726f  ulate_demand_pro
-000074b0: 7869 6d61 6c5f 6c69 6e65 7328 7365 6c66  ximal_lines(self
-000074c0: 2c64 6174 612c 2064 656d 616e 645f 7a6f  ,data, demand_zo
-000074d0: 6e65 7329 3a0a 2020 2020 2320 2020 2020  nes):.    #     
-000074e0: 7072 6f78 696d 616c 5f6c 696e 655f 7072  proximal_line_pr
-000074f0: 6963 6573 203d 205b 5d0a 2020 2020 2320  ices = [].    # 
-00007500: 2020 2020 666f 7220 7374 6172 742c 2065      for start, e
-00007510: 6e64 2c20 5f2c 205f 2069 6e20 6465 6d61  nd, _, _ in dema
-00007520: 6e64 5f7a 6f6e 6573 3a0a 2020 2020 2320  nd_zones:.    # 
-00007530: 2020 2020 2020 2020 6261 7365 5f63 616e          base_can
-00007540: 646c 655f 7072 6963 6573 203d 2064 6174  dle_prices = dat
-00007550: 612e 6c6f 635b 2864 6174 615b 2743 616e  a.loc[(data['Can
-00007560: 646c 6520 5479 7065 275d 203d 3d20 2742  dle Type'] == 'B
-00007570: 6173 6520 4361 6e64 6c65 2729 2026 2028  ase Candle') & (
-00007580: 6461 7461 2e69 6e64 6578 203e 3d20 6461  data.index >= da
-00007590: 7461 2e69 6e64 6578 5b73 7461 7274 5d29  ta.index[start])
-000075a0: 2026 2028 6461 7461 2e69 6e64 6578 203c   & (data.index <
-000075b0: 3d20 6461 7461 2e69 6e64 6578 5b65 6e64  = data.index[end
-000075c0: 5d29 2c20 5b27 4f70 656e 272c 2027 436c  ]), ['Open', 'Cl
-000075d0: 6f73 6527 5d5d 0a20 2020 2023 2020 2020  ose']].    #    
-000075e0: 2020 2020 206d 6178 5f70 7269 6365 203d       max_price =
-000075f0: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
-00007600: 6365 732e 6d61 7828 6178 6973 3d31 292e  ces.max(axis=1).
-00007610: 6d61 7828 2920 2023 2047 6574 2074 6865  max()  # Get the
-00007620: 206d 6178 696d 756d 2070 7269 6365 2061   maximum price a
-00007630: 6d6f 6e67 2061 6c6c 2062 6173 6520 6361  mong all base ca
-00007640: 6e64 6c65 7327 206f 7065 6e20 616e 6420  ndles' open and 
-00007650: 636c 6f73 6520 7072 6963 6573 0a20 2020  close prices.   
-00007660: 2023 2020 2020 2020 2020 2070 726f 7869   #         proxi
-00007670: 6d61 6c5f 6c69 6e65 5f70 7269 6365 732e  mal_line_prices.
-00007680: 6170 7065 6e64 286d 6178 5f70 7269 6365  append(max_price
-00007690: 290a 2020 2020 2320 2020 2020 7265 7475  ).    #     retu
-000076a0: 726e 2070 726f 7869 6d61 6c5f 6c69 6e65  rn proximal_line
-000076b0: 5f70 7269 6365 730a 0a20 2020 2023 2064  _prices..    # d
-000076c0: 6566 2063 616c 6375 6c61 7465 5f73 7570  ef calculate_sup
-000076d0: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
-000076e0: 6573 2873 656c 662c 6461 7461 2c20 7375  es(self,data, su
-000076f0: 7070 6c79 5f7a 6f6e 6573 293a 0a20 2020  pply_zones):.   
-00007700: 2023 2020 2020 2070 726f 7869 6d61 6c5f   #     proximal_
-00007710: 6c69 6e65 5f70 7269 6365 7320 3d20 5b5d  line_prices = []
-00007720: 0a20 2020 2023 2020 2020 2066 6f72 2073  .    #     for s
-00007730: 7461 7274 2c20 656e 642c 205f 2c20 5f20  tart, end, _, _ 
-00007740: 696e 2073 7570 706c 795f 7a6f 6e65 733a  in supply_zones:
-00007750: 0a20 2020 2023 2020 2020 2020 2020 2062  .    #         b
-00007760: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
-00007770: 7320 3d20 6461 7461 2e6c 6f63 5b28 6461  s = data.loc[(da
-00007780: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
-00007790: 5d20 3d3d 2027 4261 7365 2043 616e 646c  ] == 'Base Candl
-000077a0: 6527 2920 2620 2864 6174 612e 696e 6465  e') & (data.inde
-000077b0: 7820 3e3d 2064 6174 612e 696e 6465 785b  x >= data.index[
-000077c0: 7374 6172 745d 2920 2620 2864 6174 612e  start]) & (data.
-000077d0: 696e 6465 7820 3c3d 2064 6174 612e 696e  index <= data.in
-000077e0: 6465 785b 656e 645d 292c 205b 274f 7065  dex[end]), ['Ope
-000077f0: 6e27 2c20 2743 6c6f 7365 275d 5d0a 2020  n', 'Close']].  
-00007800: 2020 2320 2020 2020 2020 2020 6d69 6e5f    #         min_
-00007810: 7072 6963 6520 3d20 6261 7365 5f63 616e  price = base_can
-00007820: 646c 655f 7072 6963 6573 2e6d 696e 2861  dle_prices.min(a
-00007830: 7869 733d 3129 2e6d 696e 2829 2020 2320  xis=1).min()  # 
-00007840: 4765 7420 7468 6520 6d69 6e69 6d75 6d20  Get the minimum 
-00007850: 7072 6963 6520 616d 6f6e 6720 616c 6c20  price among all 
-00007860: 6261 7365 2063 616e 646c 6573 2720 6f70  base candles' op
-00007870: 656e 2061 6e64 2063 6c6f 7365 2070 7269  en and close pri
-00007880: 6365 730a 2020 2020 2320 2020 2020 2020  ces.    #       
-00007890: 2020 7072 6f78 696d 616c 5f6c 696e 655f    proximal_line_
-000078a0: 7072 6963 6573 2e61 7070 656e 6428 6d69  prices.append(mi
-000078b0: 6e5f 7072 6963 6529 0a20 2020 2023 2020  n_price).    #  
-000078c0: 2020 2072 6574 7572 6e20 7072 6f78 696d     return proxim
-000078d0: 616c 5f6c 696e 655f 7072 6963 6573 0a20  al_line_prices. 
-000078e0: 2020 2020 2020 200a 2020 2020 2320 6465         .    # de
-000078f0: 6620 6361 6c63 756c 6174 655f 6465 6d61  f calculate_dema
-00007900: 6e64 5f64 6973 7461 6c5f 6c69 6e65 7328  nd_distal_lines(
-00007910: 7365 6c66 2c64 6174 612c 2064 656d 616e  self,data, deman
-00007920: 645f 7a6f 6e65 7329 3a0a 2020 2020 2320  d_zones):.    # 
-00007930: 2020 2020 6469 7374 616c 5f6c 696e 655f      distal_line_
-00007940: 7072 6963 6573 203d 205b 5d0a 2020 2020  prices = [].    
-00007950: 2320 2020 2020 666f 7220 7374 6172 742c  #     for start,
-00007960: 2065 6e64 2c20 7061 7474 6572 6e2c 205f   end, pattern, _
-00007970: 2069 6e20 6465 6d61 6e64 5f7a 6f6e 6573   in demand_zones
-00007980: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00007990: 6966 2070 6174 7465 726e 203d 3d20 2744  if pattern == 'D
-000079a0: 726f 7020 4261 7365 2052 616c 6c79 273a  rop Base Rally':
-000079b0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000079c0: 2020 2023 204c 6f67 6963 2066 6f72 2044     # Logic for D
-000079d0: 726f 7020 4261 7365 2052 616c 6c79 2070  rop Base Rally p
-000079e0: 6174 7465 726e 3a20 5461 6b65 2074 6865  attern: Take the
-000079f0: 206c 6f77 6573 7420 7072 6963 6520 616d   lowest price am
-00007a00: 6f6e 6720 616c 6c20 636f 6d70 6f6e 656e  ong all componen
-00007a10: 7473 206f 6620 7468 6520 7a6f 6e65 0a20  ts of the zone. 
-00007a20: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00007a30: 206c 6f77 6573 745f 7072 6963 6520 3d20   lowest_price = 
-00007a40: 6d69 6e28 6461 7461 5b27 4c6f 7727 5d5b  min(data['Low'][
-00007a50: 7374 6172 743a 656e 6420 2b20 315d 2920  start:end + 1]) 
-00007a60: 2023 2047 6574 2074 6865 206c 6f77 6573   # Get the lowes
-00007a70: 7420 7072 6963 6520 7769 7468 696e 2074  t price within t
-00007a80: 6865 207a 6f6e 650a 2020 2020 2320 2020  he zone.    #   
-00007a90: 2020 2020 2020 2020 2020 6469 7374 616c            distal
-00007aa0: 5f6c 696e 655f 7072 6963 6573 2e61 7070  _line_prices.app
-00007ab0: 656e 6428 6c6f 7765 7374 5f70 7269 6365  end(lowest_price
-00007ac0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-00007ad0: 656c 6966 2070 6174 7465 726e 203d 3d20  elif pattern == 
-00007ae0: 2752 616c 6c79 2042 6173 6520 5261 6c6c  'Rally Base Rall
-00007af0: 7927 3a0a 2020 2020 2320 2020 2020 2020  y':.    #       
-00007b00: 2020 2020 2020 2320 4c6f 6769 6320 666f        # Logic fo
-00007b10: 7220 5261 6c6c 7920 4261 7365 2052 616c  r Rally Base Ral
-00007b20: 6c79 2070 6174 7465 726e 3a20 5461 6b65  ly pattern: Take
-00007b30: 2074 6865 206c 6f77 6573 7420 6f66 206f   the lowest of o
-00007b40: 6e6c 7920 616c 6c20 6261 7365 2063 616e  nly all base can
-00007b50: 646c 6520 616e 6420 666f 6c6c 6f77 6564  dle and followed
-00007b60: 2072 616c 6c79 2063 616e 646c 650a 2020   rally candle.  
-00007b70: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00007b80: 6261 7365 5f63 616e 646c 655f 7072 6963  base_candle_pric
-00007b90: 6573 203d 2064 6174 612e 6c6f 635b 2864  es = data.loc[(d
-00007ba0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00007bb0: 275d 203d 3d20 2742 6173 6520 4361 6e64  '] == 'Base Cand
-00007bc0: 6c65 2729 2026 2028 6461 7461 2e69 6e64  le') & (data.ind
-00007bd0: 6578 203e 3d20 6461 7461 2e69 6e64 6578  ex >= data.index
-00007be0: 5b73 7461 7274 5d29 2026 2028 6461 7461  [start]) & (data
-00007bf0: 2e69 6e64 6578 203c 3d20 6461 7461 2e69  .index <= data.i
-00007c00: 6e64 6578 5b65 6e64 5d29 2c20 274c 6f77  ndex[end]), 'Low
-00007c10: 275d 0a20 2020 2023 2020 2020 2020 2020  '].    #        
-00007c20: 2020 2020 2072 616c 6c79 5f63 616e 646c       rally_candl
-00007c30: 655f 7072 6963 6573 203d 2064 6174 612e  e_prices = data.
-00007c40: 6c6f 635b 2864 6174 615b 2743 616e 646c  loc[(data['Candl
-00007c50: 6520 5479 7065 275d 203d 3d20 2752 616c  e Type'] == 'Ral
-00007c60: 6c79 2043 616e 646c 6527 2920 2620 2864  ly Candle') & (d
-00007c70: 6174 612e 696e 6465 7820 3e3d 2064 6174  ata.index >= dat
-00007c80: 612e 696e 6465 785b 656e 645d 2920 2620  a.index[end]) & 
-00007c90: 2864 6174 612e 696e 6465 7820 3c20 6461  (data.index < da
-00007ca0: 7461 2e69 6e64 6578 5b65 6e64 2b31 5d29  ta.index[end+1])
-00007cb0: 2c20 274c 6f77 275d 0a20 2020 2023 2020  , 'Low'].    #  
-00007cc0: 2020 2020 2020 2020 2020 2061 6c6c 5f70             all_p
-00007cd0: 7269 6365 7320 3d20 7064 2e63 6f6e 6361  rices = pd.conca
-00007ce0: 7428 5b62 6173 655f 6361 6e64 6c65 5f70  t([base_candle_p
-00007cf0: 7269 6365 732c 2072 616c 6c79 5f63 616e  rices, rally_can
-00007d00: 646c 655f 7072 6963 6573 5d29 0a20 2020  dle_prices]).   
-00007d10: 2023 2020 2020 2020 2020 2020 2020 206c   #             l
-00007d20: 6f77 6573 745f 7072 6963 6520 3d20 616c  owest_price = al
-00007d30: 6c5f 7072 6963 6573 2e6d 696e 2829 2069  l_prices.min() i
-00007d40: 6620 6e6f 7420 616c 6c5f 7072 6963 6573  f not all_prices
-00007d50: 2e65 6d70 7479 2065 6c73 6520 4e6f 6e65  .empty else None
-00007d60: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00007d70: 2020 2064 6973 7461 6c5f 6c69 6e65 5f70     distal_line_p
-00007d80: 7269 6365 732e 6170 7065 6e64 286c 6f77  rices.append(low
-00007d90: 6573 745f 7072 6963 6529 0a20 2020 2023  est_price).    #
-00007da0: 2020 2020 2072 6574 7572 6e20 6469 7374       return dist
-00007db0: 616c 5f6c 696e 655f 7072 6963 6573 0a0a  al_line_prices..
-00007dc0: 2020 2020 2320 6465 6620 6361 6c63 756c      # def calcul
-00007dd0: 6174 655f 7375 7070 6c79 5f64 6973 7461  ate_supply_dista
-00007de0: 6c5f 6c69 6e65 7328 7365 6c66 2c64 6174  l_lines(self,dat
-00007df0: 612c 2073 7570 706c 795f 7a6f 6e65 7329  a, supply_zones)
-00007e00: 3a0a 2020 2020 2320 2020 2020 6469 7374  :.    #     dist
-00007e10: 616c 5f6c 696e 655f 7072 6963 6573 203d  al_line_prices =
-00007e20: 205b 5d0a 2020 2020 2320 2020 2020 666f   [].    #     fo
-00007e30: 7220 7374 6172 742c 2065 6e64 2c20 7061  r start, end, pa
-00007e40: 7474 6572 6e2c 205f 2069 6e20 7375 7070  ttern, _ in supp
-00007e50: 6c79 5f7a 6f6e 6573 3a0a 2020 2020 2320  ly_zones:.    # 
-00007e60: 2020 2020 2020 2020 6966 2070 6174 7465          if patte
-00007e70: 726e 203d 3d20 2752 616c 6c79 2042 6173  rn == 'Rally Bas
-00007e80: 6520 4472 6f70 273a 0a20 2020 2023 2020  e Drop':.    #  
-00007e90: 2020 2020 2020 2020 2020 2023 204c 6f67             # Log
-00007ea0: 6963 2066 6f72 2052 616c 6c79 2042 6173  ic for Rally Bas
-00007eb0: 6520 4472 6f70 2070 6174 7465 726e 3a20  e Drop pattern: 
-00007ec0: 5461 6b65 2074 6865 2068 6967 6865 7374  Take the highest
-00007ed0: 2070 7269 6365 2061 6d6f 6e67 2061 6c6c   price among all
-00007ee0: 2063 6f6d 706f 6e65 6e74 7320 6f66 2074   components of t
-00007ef0: 6865 207a 6f6e 650a 2020 2020 2320 2020  he zone.    #   
-00007f00: 2020 2020 2020 2020 2020 6869 6768 6573            highes
-00007f10: 745f 7072 6963 6520 3d20 6d61 7828 6461  t_price = max(da
-00007f20: 7461 5b27 4869 6768 275d 5b73 7461 7274  ta['High'][start
-00007f30: 3a65 6e64 202b 2031 5d29 2020 2320 4765  :end + 1])  # Ge
-00007f40: 7420 7468 6520 6869 6768 6573 7420 7072  t the highest pr
-00007f50: 6963 6520 7769 7468 696e 2074 6865 207a  ice within the z
-00007f60: 6f6e 650a 2020 2020 2320 2020 2020 2020  one.    #       
-00007f70: 2020 2020 2020 6469 7374 616c 5f6c 696e        distal_lin
-00007f80: 655f 7072 6963 6573 2e61 7070 656e 6428  e_prices.append(
-00007f90: 6869 6768 6573 745f 7072 6963 6529 0a20  highest_price). 
-00007fa0: 2020 2023 2020 2020 2020 2020 2065 6c69     #         eli
-00007fb0: 6620 7061 7474 6572 6e20 3d3d 2027 4472  f pattern == 'Dr
-00007fc0: 6f70 2042 6173 6520 4472 6f70 273a 0a20  op Base Drop':. 
-00007fd0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00007fe0: 2023 204c 6f67 6963 2066 6f72 2044 726f   # Logic for Dro
-00007ff0: 7020 4261 7365 2044 726f 7020 7061 7474  p Base Drop patt
-00008000: 6572 6e3a 2054 616b 6520 7468 6520 6869  ern: Take the hi
-00008010: 6768 6573 7420 6f66 206f 6e6c 7920 616c  ghest of only al
-00008020: 6c20 6261 7365 2063 616e 646c 6573 2061  l base candles a
-00008030: 6e64 2066 6f6c 6c6f 7765 6420 6472 6f70  nd followed drop
-00008040: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
-00008050: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
-00008060: 616e 646c 655f 7072 6963 6573 203d 2064  andle_prices = d
-00008070: 6174 612e 6c6f 635b 2864 6174 615b 2743  ata.loc[(data['C
-00008080: 616e 646c 6520 5479 7065 275d 203d 3d20  andle Type'] == 
-00008090: 2742 6173 6520 4361 6e64 6c65 2729 2026  'Base Candle') &
-000080a0: 2028 6461 7461 2e69 6e64 6578 203e 3d20   (data.index >= 
-000080b0: 6461 7461 2e69 6e64 6578 5b73 7461 7274  data.index[start
-000080c0: 5d29 2026 2028 6461 7461 2e69 6e64 6578  ]) & (data.index
-000080d0: 203c 3d20 6461 7461 2e69 6e64 6578 5b65   <= data.index[e
-000080e0: 6e64 5d29 2c20 2748 6967 6827 5d0a 2020  nd]), 'High'].  
-000080f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008100: 6472 6f70 5f63 616e 646c 655f 7072 6963  drop_candle_pric
-00008110: 6573 203d 2064 6174 612e 6c6f 635b 2864  es = data.loc[(d
-00008120: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
-00008130: 275d 203d 3d20 2744 726f 7020 4361 6e64  '] == 'Drop Cand
-00008140: 6c65 2729 2026 2028 6461 7461 2e69 6e64  le') & (data.ind
-00008150: 6578 203e 3d20 6461 7461 2e69 6e64 6578  ex >= data.index
-00008160: 5b73 7461 7274 5d29 2026 2028 6461 7461  [start]) & (data
-00008170: 2e69 6e64 6578 203c 3d20 6461 7461 2e69  .index <= data.i
-00008180: 6e64 6578 5b65 6e64 5d29 2c20 2748 6967  ndex[end]), 'Hig
-00008190: 6827 5d0a 2020 2020 2320 2020 2020 2020  h'].    #       
-000081a0: 2020 2020 2020 616c 6c5f 7072 6963 6573        all_prices
-000081b0: 203d 2070 642e 636f 6e63 6174 285b 6261   = pd.concat([ba
-000081c0: 7365 5f63 616e 646c 655f 7072 6963 6573  se_candle_prices
-000081d0: 2c20 6472 6f70 5f63 616e 646c 655f 7072  , drop_candle_pr
-000081e0: 6963 6573 5d29 0a20 2020 2023 2020 2020  ices]).    #    
-000081f0: 2020 2020 2020 2020 2068 6967 6865 7374           highest
-00008200: 5f70 7269 6365 203d 2061 6c6c 5f70 7269  _price = all_pri
-00008210: 6365 732e 6d61 7828 2920 6966 206e 6f74  ces.max() if not
-00008220: 2061 6c6c 5f70 7269 6365 732e 656d 7074   all_prices.empt
-00008230: 7920 656c 7365 204e 6f6e 650a 2020 2020  y else None.    
-00008240: 2320 2020 2020 2020 2020 2020 2020 6469  #             di
-00008250: 7374 616c 5f6c 696e 655f 7072 6963 6573  stal_line_prices
-00008260: 2e61 7070 656e 6428 6869 6768 6573 745f  .append(highest_
-00008270: 7072 6963 6529 0a20 2020 2023 2020 2020  price).    #    
-00008280: 2072 6574 7572 6e20 6469 7374 616c 5f6c   return distal_l
-00008290: 696e 655f 7072 6963 6573 0a0a 2020 2020  ine_prices..    
-000082a0: 2320 6465 6620 6973 5f7a 6f6e 655f 7465  # def is_zone_te
-000082b0: 7374 6564 2873 656c 662c 6461 7461 2c20  sted(self,data, 
-000082c0: 7374 6172 745f 696e 6465 782c 2065 6e64  start_index, end
-000082d0: 5f69 6e64 6578 2c20 7072 6f78 696d 616c  _index, proximal
-000082e0: 5f6c 696e 655f 7072 6963 6529 3a0a 2020  _line_price):.  
-000082f0: 2020 2320 2020 2020 2222 220a 2020 2020    #     """.    
-00008300: 2320 2020 2020 4368 6563 6b20 6966 2074  #     Check if t
-00008310: 6865 2070 726f 7869 6d61 6c20 6c69 6e65  he proximal line
-00008320: 2070 7269 6365 2068 6173 2062 6565 6e20   price has been 
-00008330: 7465 7374 6564 2062 7920 6675 7475 7265  tested by future
-00008340: 2070 7269 6365 732e 0a20 2020 2020 2020   prices..       
-00008350: 200a 2020 2020 2320 2020 2020 4172 6773   .    #     Args
-00008360: 3a0a 2020 2020 2320 2020 2020 2d20 6461  :.    #     - da
-00008370: 7461 3a20 4461 7461 4672 616d 6520 636f  ta: DataFrame co
-00008380: 6e74 6169 6e69 6e67 2073 746f 636b 2064  ntaining stock d
-00008390: 6174 610a 2020 2020 2320 2020 2020 2d20  ata.    #     - 
-000083a0: 7374 6172 745f 696e 6465 783a 2053 7461  start_index: Sta
-000083b0: 7274 2069 6e64 6578 206f 6620 7468 6520  rt index of the 
-000083c0: 6465 6d61 6e64 2f73 7570 706c 7920 7a6f  demand/supply zo
-000083d0: 6e65 0a20 2020 2023 2020 2020 202d 2065  ne.    #     - e
-000083e0: 6e64 5f69 6e64 6578 3a20 456e 6420 696e  nd_index: End in
-000083f0: 6465 7820 6f66 2074 6865 2064 656d 616e  dex of the deman
-00008400: 642f 7375 7070 6c79 207a 6f6e 650a 2020  d/supply zone.  
-00008410: 2020 2320 2020 2020 2d20 7072 6f78 696d    #     - proxim
-00008420: 616c 5f6c 696e 655f 7072 6963 653a 2050  al_line_price: P
-00008430: 726f 7869 6d61 6c20 6c69 6e65 2070 7269  roximal line pri
-00008440: 6365 0a20 2020 2020 2020 200a 2020 2020  ce.        .    
-00008450: 2320 2020 2020 5265 7475 726e 733a 0a20  #     Returns:. 
-00008460: 2020 2023 2020 2020 202d 2054 7275 6520     #     - True 
-00008470: 6966 2074 6865 2070 726f 7869 6d61 6c20  if the proximal 
-00008480: 6c69 6e65 2070 7269 6365 2069 7320 7465  line price is te
-00008490: 7374 6564 2c20 4661 6c73 6520 6f74 6865  sted, False othe
-000084a0: 7277 6973 650a 2020 2020 2320 2020 2020  rwise.    #     
-000084b0: 2222 220a 2020 2020 2320 2020 2020 666f  """.    #     fo
-000084c0: 7220 6920 696e 2072 616e 6765 2865 6e64  r i in range(end
-000084d0: 5f69 6e64 6578 202b 2031 2c20 6c65 6e28  _index + 1, len(
-000084e0: 6461 7461 2929 3a0a 2020 2020 2320 2020  data)):.    #   
-000084f0: 2020 2020 2020 6966 2064 6174 615b 274c        if data['L
-00008500: 6f77 275d 5b69 5d20 3c3d 2070 726f 7869  ow'][i] <= proxi
-00008510: 6d61 6c5f 6c69 6e65 5f70 7269 6365 203c  mal_line_price <
-00008520: 3d20 6461 7461 5b27 4869 6768 275d 5b69  = data['High'][i
-00008530: 5d3a 0a20 2020 2023 2020 2020 2020 2020  ]:.    #        
-00008540: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00008550: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
-00008560: 6e20 4661 6c73 650a 0a20 2020 2023 2064  n False..    # d
-00008570: 6566 2063 616c 6375 6c61 7465 5f7a 6f6e  ef calculate_zon
-00008580: 655f 7261 6e67 6528 7365 6c66 2c70 726f  e_range(self,pro
-00008590: 7869 6d61 6c5f 6c69 6e65 2c20 6469 7374  ximal_line, dist
-000085a0: 616c 5f6c 696e 6529 3a0a 2020 2020 2320  al_line):.    # 
-000085b0: 2020 2020 2222 220a 2020 2020 2320 2020      """.    #   
-000085c0: 2020 4361 6c63 756c 6174 6520 7468 6520    Calculate the 
-000085d0: 7261 6e67 6520 6f66 2061 207a 6f6e 6520  range of a zone 
-000085e0: 6769 7665 6e20 6974 7320 7072 6f78 696d  given its proxim
-000085f0: 616c 2061 6e64 2064 6973 7461 6c20 6c69  al and distal li
-00008600: 6e65 732e 0a20 2020 2020 2020 200a 2020  nes..        .  
-00008610: 2020 2320 2020 2020 4172 6773 3a0a 2020    #     Args:.  
-00008620: 2020 2320 2020 2020 2d20 7072 6f78 696d    #     - proxim
-00008630: 616c 5f6c 696e 653a 2050 726f 7869 6d61  al_line: Proxima
-00008640: 6c20 6c69 6e65 2070 7269 6365 0a20 2020  l line price.   
-00008650: 2023 2020 2020 202d 2064 6973 7461 6c5f   #     - distal_
-00008660: 6c69 6e65 3a20 4469 7374 616c 206c 696e  line: Distal lin
-00008670: 6520 7072 6963 650a 2020 2020 2020 2020  e price.        
-00008680: 0a20 2020 2023 2020 2020 2052 6574 7572  .    #     Retur
-00008690: 6e73 3a0a 2020 2020 2320 2020 2020 2d20  ns:.    #     - 
-000086a0: 5261 6e67 6520 6f66 2074 6865 207a 6f6e  Range of the zon
-000086b0: 650a 2020 2020 2320 2020 2020 2222 220a  e.    #     """.
-000086c0: 2020 2020 2320 2020 2020 6966 2070 726f      #     if pro
-000086d0: 7869 6d61 6c5f 6c69 6e65 2069 7320 6e6f  ximal_line is no
-000086e0: 7420 4e6f 6e65 2061 6e64 2064 6973 7461  t None and dista
-000086f0: 6c5f 6c69 6e65 2069 7320 6e6f 7420 4e6f  l_line is not No
-00008700: 6e65 3a0a 2020 2020 2320 2020 2020 2020  ne:.    #       
-00008710: 2020 7265 7475 726e 2061 6273 2870 726f    return abs(pro
-00008720: 7869 6d61 6c5f 6c69 6e65 202d 2064 6973  ximal_line - dis
-00008730: 7461 6c5f 6c69 6e65 290a 2020 2020 2320  tal_line).    # 
-00008740: 2020 2020 656c 7365 3a0a 2020 2020 2320      else:.    # 
-00008750: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00008760: 6f6e 650a 0a20 2020 2023 2064 6566 2063  one..    # def c
-00008770: 616c 6375 6c61 7465 5f64 656d 616e 645f  alculate_demand_
-00008780: 7a6f 6e65 5f72 616e 6765 7328 7365 6c66  zone_ranges(self
-00008790: 2c64 656d 616e 645f 7a6f 6e65 732c 2064  ,demand_zones, d
-000087a0: 656d 616e 645f 7072 6f78 696d 616c 5f6c  emand_proximal_l
-000087b0: 696e 6573 2c20 6465 6d61 6e64 5f64 6973  ines, demand_dis
-000087c0: 7461 6c5f 6c69 6e65 7329 3a0a 2020 2020  tal_lines):.    
-000087d0: 2320 2020 2020 2222 220a 2020 2020 2320  #     """.    # 
-000087e0: 2020 2020 4361 6c63 756c 6174 6520 7468      Calculate th
-000087f0: 6520 7261 6e67 6520 6f66 2065 6163 6820  e range of each 
-00008800: 6465 6d61 6e64 207a 6f6e 652e 0a20 2020  demand zone..   
-00008810: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-00008820: 4172 6773 3a0a 2020 2020 2320 2020 2020  Args:.    #     
-00008830: 2d20 6465 6d61 6e64 5f7a 6f6e 6573 3a20  - demand_zones: 
-00008840: 4c69 7374 206f 6620 6465 6d61 6e64 207a  List of demand z
-00008850: 6f6e 6520 7475 706c 6573 2028 7374 6172  one tuples (star
-00008860: 742c 2065 6e64 2c20 7061 7474 6572 6e2c  t, end, pattern,
-00008870: 2062 6173 655f 636f 756e 7429 0a20 2020   base_count).   
-00008880: 2023 2020 2020 202d 2064 656d 616e 645f   #     - demand_
-00008890: 7072 6f78 696d 616c 5f6c 696e 6573 3a20  proximal_lines: 
-000088a0: 4c69 7374 206f 6620 7072 6f78 696d 616c  List of proximal
-000088b0: 206c 696e 6520 7072 6963 6573 2066 6f72   line prices for
-000088c0: 2064 656d 616e 6420 7a6f 6e65 730a 2020   demand zones.  
-000088d0: 2020 2320 2020 2020 2d20 6465 6d61 6e64    #     - demand
-000088e0: 5f64 6973 7461 6c5f 6c69 6e65 733a 204c  _distal_lines: L
-000088f0: 6973 7420 6f66 2064 6973 7461 6c20 6c69  ist of distal li
-00008900: 6e65 2070 7269 6365 7320 666f 7220 6465  ne prices for de
-00008910: 6d61 6e64 207a 6f6e 6573 0a20 2020 2020  mand zones.     
-00008920: 2020 200a 2020 2020 2320 2020 2020 5265     .    #     Re
-00008930: 7475 726e 733a 0a20 2020 2023 2020 2020  turns:.    #    
-00008940: 202d 204c 6973 7420 6f66 2072 616e 6765   - List of range
-00008950: 7320 636f 7272 6573 706f 6e64 696e 6720  s corresponding 
-00008960: 746f 2065 6163 6820 6465 6d61 6e64 207a  to each demand z
-00008970: 6f6e 650a 2020 2020 2320 2020 2020 2222  one.    #     ""
-00008980: 220a 2020 2020 2320 2020 2020 6465 6d61  ".    #     dema
-00008990: 6e64 5f7a 6f6e 655f 7261 6e67 6573 203d  nd_zone_ranges =
-000089a0: 205b 5d0a 2020 2020 2320 2020 2020 666f   [].    #     fo
-000089b0: 7220 692c 2028 7374 6172 742c 2065 6e64  r i, (start, end
-000089c0: 2c20 5f2c 205f 2920 696e 2065 6e75 6d65  , _, _) in enume
-000089d0: 7261 7465 2864 656d 616e 645f 7a6f 6e65  rate(demand_zone
-000089e0: 7329 3a0a 2020 2020 2320 2020 2020 2020  s):.    #       
-000089f0: 2020 7261 6e67 655f 6f66 5f7a 6f6e 6520    range_of_zone 
-00008a00: 3d20 7365 6c66 2e63 616c 6375 6c61 7465  = self.calculate
-00008a10: 5f7a 6f6e 655f 7261 6e67 6528 6465 6d61  _zone_range(dema
-00008a20: 6e64 5f70 726f 7869 6d61 6c5f 6c69 6e65  nd_proximal_line
-00008a30: 735b 695d 2c20 6465 6d61 6e64 5f64 6973  s[i], demand_dis
-00008a40: 7461 6c5f 6c69 6e65 735b 695d 290a 2020  tal_lines[i]).  
-00008a50: 2020 2320 2020 2020 2020 2020 6465 6d61    #         dema
-00008a60: 6e64 5f7a 6f6e 655f 7261 6e67 6573 2e61  nd_zone_ranges.a
-00008a70: 7070 656e 6428 7261 6e67 655f 6f66 5f7a  ppend(range_of_z
-00008a80: 6f6e 6529 0a20 2020 2023 2020 2020 2072  one).    #     r
-00008a90: 6574 7572 6e20 6465 6d61 6e64 5f7a 6f6e  eturn demand_zon
-00008aa0: 655f 7261 6e67 6573 0a0a 2020 2020 2320  e_ranges..    # 
-00008ab0: 6465 6620 6361 6c63 756c 6174 655f 7375  def calculate_su
-00008ac0: 7070 6c79 5f7a 6f6e 655f 7261 6e67 6573  pply_zone_ranges
-00008ad0: 2873 656c 662c 7375 7070 6c79 5f7a 6f6e  (self,supply_zon
-00008ae0: 6573 2c20 7375 7070 6c79 5f70 726f 7869  es, supply_proxi
-00008af0: 6d61 6c5f 6c69 6e65 732c 2073 7570 706c  mal_lines, suppl
-00008b00: 795f 6469 7374 616c 5f6c 696e 6573 293a  y_distal_lines):
-00008b10: 0a20 2020 2023 2020 2020 2022 2222 0a20  .    #     """. 
-00008b20: 2020 2023 2020 2020 2043 616c 6375 6c61     #     Calcula
-00008b30: 7465 2074 6865 2072 616e 6765 206f 6620  te the range of 
-00008b40: 6561 6368 2073 7570 706c 7920 7a6f 6e65  each supply zone
-00008b50: 2e0a 2020 2020 2020 2020 0a20 2020 2023  ..        .    #
-00008b60: 2020 2020 2041 7267 733a 0a20 2020 2023       Args:.    #
-00008b70: 2020 2020 202d 2073 7570 706c 795f 7a6f       - supply_zo
-00008b80: 6e65 733a 204c 6973 7420 6f66 2073 7570  nes: List of sup
-00008b90: 706c 7920 7a6f 6e65 2074 7570 6c65 7320  ply zone tuples 
-00008ba0: 2873 7461 7274 2c20 656e 642c 2070 6174  (start, end, pat
-00008bb0: 7465 726e 2c20 6261 7365 5f63 6f75 6e74  tern, base_count
-00008bc0: 290a 2020 2020 2320 2020 2020 2d20 7375  ).    #     - su
-00008bd0: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
-00008be0: 6e65 733a 204c 6973 7420 6f66 2070 726f  nes: List of pro
-00008bf0: 7869 6d61 6c20 6c69 6e65 2070 7269 6365  ximal line price
-00008c00: 7320 666f 7220 7375 7070 6c79 207a 6f6e  s for supply zon
-00008c10: 6573 0a20 2020 2023 2020 2020 202d 2073  es.    #     - s
-00008c20: 7570 706c 795f 6469 7374 616c 5f6c 696e  upply_distal_lin
-00008c30: 6573 3a20 4c69 7374 206f 6620 6469 7374  es: List of dist
-00008c40: 616c 206c 696e 6520 7072 6963 6573 2066  al line prices f
-00008c50: 6f72 2073 7570 706c 7920 7a6f 6e65 730a  or supply zones.
-00008c60: 2020 2020 2020 2020 0a20 2020 2023 2020          .    #  
-00008c70: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
-00008c80: 2320 2020 2020 2d20 4c69 7374 206f 6620  #     - List of 
-00008c90: 7261 6e67 6573 2063 6f72 7265 7370 6f6e  ranges correspon
-00008ca0: 6469 6e67 2074 6f20 6561 6368 2073 7570  ding to each sup
-00008cb0: 706c 7920 7a6f 6e65 0a20 2020 2023 2020  ply zone.    #  
-00008cc0: 2020 2022 2222 0a20 2020 2023 2020 2020     """.    #    
-00008cd0: 2073 7570 706c 795f 7a6f 6e65 5f72 616e   supply_zone_ran
-00008ce0: 6765 7320 3d20 5b5d 0a20 2020 2023 2020  ges = [].    #  
-00008cf0: 2020 2066 6f72 2069 2c20 2873 7461 7274     for i, (start
-00008d00: 2c20 656e 642c 205f 2c20 5f29 2069 6e20  , end, _, _) in 
-00008d10: 656e 756d 6572 6174 6528 7375 7070 6c79  enumerate(supply
-00008d20: 5f7a 6f6e 6573 293a 0a20 2020 2023 2020  _zones):.    #  
-00008d30: 2020 2020 2020 2072 616e 6765 5f6f 665f         range_of_
-00008d40: 7a6f 6e65 203d 2073 656c 662e 6361 6c63  zone = self.calc
-00008d50: 756c 6174 655f 7a6f 6e65 5f72 616e 6765  ulate_zone_range
-00008d60: 2873 7570 706c 795f 7072 6f78 696d 616c  (supply_proximal
-00008d70: 5f6c 696e 6573 5b69 5d2c 2073 7570 706c  _lines[i], suppl
-00008d80: 795f 6469 7374 616c 5f6c 696e 6573 5b69  y_distal_lines[i
-00008d90: 5d29 0a20 2020 2023 2020 2020 2020 2020  ]).    #        
-00008da0: 2073 7570 706c 795f 7a6f 6e65 5f72 616e   supply_zone_ran
-00008db0: 6765 732e 6170 7065 6e64 2872 616e 6765  ges.append(range
-00008dc0: 5f6f 665f 7a6f 6e65 290a 2020 2020 2320  _of_zone).    # 
-00008dd0: 2020 2020 7265 7475 726e 2073 7570 706c      return suppl
-00008de0: 795f 7a6f 6e65 5f72 616e 6765 730a 0a20  y_zone_ranges.. 
-00008df0: 2020 2023 2064 6566 2066 696c 7465 725f     # def filter_
-00008e00: 7374 6f63 6b73 5f62 795f 6469 7374 616e  stocks_by_distan
-00008e10: 6365 2873 656c 662c 6461 7461 2c73 796d  ce(self,data,sym
-00008e20: 626f 6c5f 6c69 7374 2c20 7468 7265 7368  bol_list, thresh
-00008e30: 6f6c 645f 7065 7263 656e 742c 2074 696d  old_percent, tim
-00008e40: 6566 7261 6d65 293a 0a20 2020 2023 2020  eframe):.    #  
-00008e50: 2020 2066 696c 7465 7265 645f 7374 6f63     filtered_stoc
-00008e60: 6b73 203d 205b 5d0a 2020 2020 2320 2020  ks = [].    #   
-00008e70: 2020 666f 7220 7379 6d62 6f6c 2069 6e20    for symbol in 
-00008e80: 7379 6d62 6f6c 5f6c 6973 743a 0a20 2020  symbol_list:.   
-00008e90: 2023 2020 2020 2020 2020 2069 6620 6461   #         if da
-00008ea0: 7461 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ta is not None:.
-00008eb0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00008ec0: 2020 636d 7020 3d20 6461 7461 2e69 6c6f    cmp = data.ilo
-00008ed0: 635b 2d31 5d5b 2743 6c6f 7365 275d 2020  c[-1]['Close']  
-00008ee0: 2320 4375 7272 656e 7420 6d61 726b 6574  # Current market
-00008ef0: 2070 7269 6365 0a20 2020 2023 2020 2020   price.    #    
-00008f00: 2020 2020 2020 2020 2064 656d 616e 645f           demand_
-00008f10: 7a6f 6e65 732c 205f 2c20 5f2c 2064 656d  zones, _, _, dem
-00008f20: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
-00008f30: 6520 3d20 7365 6c66 2e69 6465 6e74 6966  e = self.identif
-00008f40: 795f 6465 6d61 6e64 5f7a 6f6e 6528 6461  y_demand_zone(da
-00008f50: 7461 2c20 636d 7029 2020 2320 5061 7373  ta, cmp)  # Pass
-00008f60: 2063 6d70 2061 7267 756d 656e 7420 6865   cmp argument he
-00008f70: 7265 0a20 2020 2023 2020 2020 2020 2020  re.    #        
-00008f80: 2020 2020 2073 7570 706c 795f 7a6f 6e65       supply_zone
-00008f90: 732c 205f 2c20 5f2c 2073 7570 706c 795f  s, _, _, supply_
-00008fa0: 7072 6f78 696d 616c 5f6c 696e 6520 3d20  proximal_line = 
-00008fb0: 7365 6c66 2e69 6465 6e74 6966 795f 7375  self.identify_su
-00008fc0: 7070 6c79 5f7a 6f6e 6528 6461 7461 2c20  pply_zone(data, 
-00008fd0: 636d 7029 2020 2320 5061 7373 2063 6d70  cmp)  # Pass cmp
-00008fe0: 2061 7267 756d 656e 7420 6865 7265 0a20   argument here. 
-00008ff0: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00009000: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00009010: 2020 2320 4368 6563 6b20 6966 2065 6974    # Check if eit
-00009020: 6865 7220 6465 6d61 6e64 206f 7220 7375  her demand or su
-00009030: 7070 6c79 207a 6f6e 6573 2065 7869 7374  pply zones exist
-00009040: 2066 6f72 2074 6865 2073 746f 636b 0a20   for the stock. 
-00009050: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009060: 2069 6620 6465 6d61 6e64 5f7a 6f6e 6573   if demand_zones
-00009070: 206f 7220 7375 7070 6c79 5f7a 6f6e 6573   or supply_zones
-00009080: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00009090: 2020 2020 2020 2020 6669 6c74 6572 6564          filtered
-000090a0: 5f73 746f 636b 732e 6170 7065 6e64 2873  _stocks.append(s
-000090b0: 796d 626f 6c29 0a0a 2020 2020 2320 2020  ymbol)..    #   
-000090c0: 2020 7265 7475 726e 2066 696c 7465 7265    return filtere
-000090d0: 645f 7374 6f63 6b73 0a20 2020 200a 2020  d_stocks.    .  
-000090e0: 2020 2320 6465 6620 6669 6e64 4465 6d61    # def findDema
-000090f0: 6e64 5375 7070 6c79 5a6f 6e65 7328 7365  ndSupplyZones(se
-00009100: 6c66 2c64 6174 612c 7468 7265 7368 6f6c  lf,data,threshol
-00009110: 645f 7065 7263 656e 743d 3129 3a20 2020  d_percent=1):   
-00009120: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-00009130: 2320 496e 6974 6961 6c69 7a65 2063 6f75  # Initialize cou
-00009140: 6e74 2066 6f72 2066 696c 7465 7265 6420  nt for filtered 
-00009150: 7374 6f63 6b73 0a20 2020 2023 2020 2020  stocks.    #    
-00009160: 2063 6f75 6e74 5f66 696c 7465 7265 645f   count_filtered_
-00009170: 7374 6f63 6b73 203d 2030 0a0a 2020 2020  stocks = 0..    
-00009180: 2320 2020 2020 2320 416e 616c 797a 6520  #     # Analyze 
-00009190: 6465 6d61 6e64 2061 6e64 2073 7570 706c  demand and suppl
-000091a0: 7920 7a6f 6e65 7320 666f 7220 6561 6368  y zones for each
-000091b0: 2073 746f 636b 2061 6e64 2073 6176 6520   stock and save 
-000091c0: 7265 7375 6c74 7320 696e 2061 2066 696c  results in a fil
-000091d0: 650a 2020 2020 2320 2020 2020 7769 7468  e.    #     with
-000091e0: 206f 7065 6e28 2264 656d 616e 645f 7375   open("demand_su
-000091f0: 7070 6c79 5f7a 6f6e 6573 2e74 7874 222c  pply_zones.txt",
-00009200: 2022 7722 2920 6173 2066 696c 653a 0a20   "w") as file:. 
-00009210: 2020 2023 2020 2020 2020 2020 2066 6f72     #         for
-00009220: 2073 796d 626f 6c20 696e 2064 6174 615b   symbol in data[
-00009230: 2253 746f 636b 225d 3a0a 2020 2020 2320  "Stock"]:.    # 
-00009240: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00009250: 6174 6120 6973 206e 6f74 204e 6f6e 653a  ata is not None:
-00009260: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009270: 2020 2020 2020 2063 6d70 203d 2064 6174         cmp = dat
-00009280: 612e 696c 6f63 5b2d 315d 5b27 436c 6f73  a.iloc[-1]['Clos
-00009290: 6527 5d20 2023 2043 7572 7265 6e74 206d  e']  # Current m
-000092a0: 6172 6b65 7420 7072 6963 650a 2020 2020  arket price.    
-000092b0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000092c0: 2020 6465 6d61 6e64 5f7a 6f6e 6573 2c20    demand_zones, 
-000092d0: 5f2c 205f 2c20 6465 6d61 6e64 5f70 726f  _, _, demand_pro
-000092e0: 7869 6d61 6c5f 6c69 6e65 203d 2073 656c  ximal_line = sel
-000092f0: 662e 6964 656e 7469 6679 5f64 656d 616e  f.identify_deman
-00009300: 645f 7a6f 6e65 2864 6174 612c 2063 6d70  d_zone(data, cmp
-00009310: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-00009320: 2020 2020 2020 2020 7375 7070 6c79 5f7a          supply_z
-00009330: 6f6e 6573 2c20 5f2c 205f 2c20 7375 7070  ones, _, _, supp
-00009340: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-00009350: 203d 2073 656c 662e 6964 656e 7469 6679   = self.identify
-00009360: 5f73 7570 706c 795f 7a6f 6e65 2864 6174  _supply_zone(dat
-00009370: 612c 2063 6d70 290a 0a20 2020 2023 2020  a, cmp)..    #  
-00009380: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009390: 2053 7465 7020 313a 2043 616c 6375 6c61   Step 1: Calcula
-000093a0: 7465 2070 726f 7869 6d61 6c20 6c69 6e65  te proximal line
-000093b0: 7320 666f 7220 6465 6d61 6e64 2061 6e64  s for demand and
-000093c0: 2073 7570 706c 7920 7a6f 6e65 730a 2020   supply zones.  
-000093d0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-000093e0: 2020 2020 6465 6d61 6e64 5f70 726f 7869      demand_proxi
-000093f0: 6d61 6c5f 6c69 6e65 7320 3d20 7365 6c66  mal_lines = self
-00009400: 2e63 616c 6375 6c61 7465 5f64 656d 616e  .calculate_deman
-00009410: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-00009420: 2864 6174 612c 2064 656d 616e 645f 7a6f  (data, demand_zo
-00009430: 6e65 7329 0a20 2020 2023 2020 2020 2020  nes).    #      
-00009440: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-00009450: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
-00009460: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-00009470: 655f 7375 7070 6c79 5f70 726f 7869 6d61  e_supply_proxima
-00009480: 6c5f 6c69 6e65 7328 6461 7461 2c20 7375  l_lines(data, su
-00009490: 7070 6c79 5f7a 6f6e 6573 290a 2020 2020  pply_zones).    
-000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000094c0: 2020 2020 2020 2023 2053 7465 7020 323a         # Step 2:
-000094d0: 2043 616c 6375 6c61 7465 2064 6973 7461   Calculate dista
-000094e0: 6c20 6c69 6e65 7320 666f 7220 6465 6d61  l lines for dema
-000094f0: 6e64 207a 6f6e 6573 2061 6e64 2073 7570  nd zones and sup
-00009500: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
-00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009520: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00009530: 6e65 7320 3d20 7365 6c66 2e63 616c 6375  nes = self.calcu
-00009540: 6c61 7465 5f64 656d 616e 645f 6469 7374  late_demand_dist
-00009550: 616c 5f6c 696e 6573 2864 6174 612c 2064  al_lines(data, d
-00009560: 656d 616e 645f 7a6f 6e65 7329 0a20 2020  emand_zones).   
-00009570: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00009580: 2020 2073 7570 706c 795f 6469 7374 616c     supply_distal
-00009590: 5f6c 696e 6573 203d 2073 656c 662e 6361  _lines = self.ca
-000095a0: 6c63 756c 6174 655f 7375 7070 6c79 5f64  lculate_supply_d
-000095b0: 6973 7461 6c5f 6c69 6e65 7328 6461 7461  istal_lines(data
-000095c0: 2c20 7375 7070 6c79 5f7a 6f6e 6573 290a  , supply_zones).
-000095d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000095e0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-000095f0: 7465 2072 616e 6765 206f 6620 6465 6d61  te range of dema
-00009600: 6e64 2061 6e64 2073 7570 706c 7920 7a6f  nd and supply zo
-00009610: 6e65 730a 2020 2020 2320 2020 2020 2020  nes.    #       
-00009620: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
-00009630: 5f7a 6f6e 655f 7261 6e67 6573 203d 2073  _zone_ranges = s
-00009640: 656c 662e 6361 6c63 756c 6174 655f 6465  elf.calculate_de
-00009650: 6d61 6e64 5f7a 6f6e 655f 7261 6e67 6573  mand_zone_ranges
-00009660: 2864 656d 616e 645f 7a6f 6e65 732c 2064  (demand_zones, d
-00009670: 656d 616e 645f 7072 6f78 696d 616c 5f6c  emand_proximal_l
-00009680: 696e 6573 2c20 6465 6d61 6e64 5f64 6973  ines, demand_dis
-00009690: 7461 6c5f 6c69 6e65 7329 0a20 2020 2023  tal_lines).    #
-000096a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096b0: 2073 7570 706c 795f 7a6f 6e65 5f72 616e   supply_zone_ran
-000096c0: 6765 7320 3d20 7365 6c66 2e63 616c 6375  ges = self.calcu
-000096d0: 6c61 7465 5f73 7570 706c 795f 7a6f 6e65  late_supply_zone
-000096e0: 5f72 616e 6765 7328 7375 7070 6c79 5f7a  _ranges(supply_z
-000096f0: 6f6e 6573 2c20 7375 7070 6c79 5f70 726f  ones, supply_pro
-00009700: 7869 6d61 6c5f 6c69 6e65 732c 2073 7570  ximal_lines, sup
-00009710: 706c 795f 6469 7374 616c 5f6c 696e 6573  ply_distal_lines
-00009720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00009730: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
-00009740: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00009750: 652e 7772 6974 6528 6622 5c6e 5c6e 416e  e.write(f"\n\nAn
-00009760: 616c 7973 6973 2066 6f72 207b 7379 6d62  alysis for {symb
-00009770: 6f6c 7d20 287b 7469 6d65 6672 616d 657d  ol} ({timeframe}
-00009780: 293a 2229 0a20 2020 2020 2020 2020 2020  ):").           
-00009790: 2020 2020 2020 2020 200a 2020 2020 2320           .    # 
-000097a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097b0: 2320 4465 6d61 6e64 205a 6f6e 6573 0a20  # Demand Zones. 
-000097c0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-000097d0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-000097e0: 225c 6e5c 6e44 656d 616e 6420 5a6f 6e65  "\n\nDemand Zone
-000097f0: 733a 2229 0a20 2020 2023 2020 2020 2020  s:").    #      
-00009800: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00009810: 6d61 6e64 5f7a 6f6e 6573 3a20 2023 2043  mand_zones:  # C
-00009820: 6865 636b 2069 6620 6465 6d61 6e64 5f7a  heck if demand_z
-00009830: 6f6e 6573 2069 7320 6e6f 7420 656d 7074  ones is not empt
-00009840: 790a 2020 2020 2320 2020 2020 2020 2020  y.    #         
-00009850: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00009860: 692c 2028 7374 6172 742c 2065 6e64 2c20  i, (start, end, 
-00009870: 7061 7474 6572 6e2c 2062 6173 655f 636f  pattern, base_co
-00009880: 756e 7429 2069 6e20 656e 756d 6572 6174  unt) in enumerat
-00009890: 6528 6465 6d61 6e64 5f7a 6f6e 6573 293a  e(demand_zones):
-000098a0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-000098b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000098c0: 6973 745f 6672 6f6d 5f63 6d70 203d 2061  ist_from_cmp = a
-000098d0: 6273 2828 636d 7020 2d20 6465 6d61 6e64  bs((cmp - demand
-000098e0: 5f70 726f 7869 6d61 6c5f 6c69 6e65 735b  _proximal_lines[
-000098f0: 695d 2920 2f20 636d 7029 202a 2031 3030  i]) / cmp) * 100
-00009900: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009910: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009920: 696c 652e 7772 6974 6528 6622 5c6e 5c6e  ile.write(f"\n\n
-00009930: 5a6f 6e65 207b 692b 317d 3a20 5374 6172  Zone {i+1}: Star
-00009940: 7420 4461 7465 3a20 7b64 6174 612e 696e  t Date: {data.in
-00009950: 6465 785b 7374 6172 745d 2e64 6174 6528  dex[start].date(
-00009960: 297d 2c20 456e 6420 4461 7465 3a20 7b64  )}, End Date: {d
-00009970: 6174 612e 696e 6465 785b 656e 645d 2e64  ata.index[end].d
-00009980: 6174 6528 297d 2229 0a20 2020 2023 2020  ate()}").    #  
-00009990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099a0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-000099b0: 6528 6622 5c6e 5061 7474 6572 6e20 4e61  e(f"\nPattern Na
-000099c0: 6d65 3a20 7b70 6174 7465 726e 7d2c 204e  me: {pattern}, N
-000099d0: 756d 6265 7220 6f66 2042 6173 6520 4361  umber of Base Ca
-000099e0: 6e64 6c65 3a20 7b62 6173 655f 636f 756e  ndle: {base_coun
-000099f0: 747d 2229 0a20 2020 2023 2020 2020 2020  t}").    #      
-00009a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a10: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-00009a20: 5c6e 4469 7374 616e 6365 2066 726f 6d20  \nDistance from 
-00009a30: 434d 503a 207b 6469 7374 5f66 726f 6d5f  CMP: {dist_from_
-00009a40: 636d 703a 2e32 667d 2522 290a 2020 2020  cmp:.2f}%").    
-00009a50: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009a60: 2020 2020 2020 2020 2020 6966 2064 656d            if dem
-00009a70: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
-00009a80: 6573 3a0a 2020 2020 2320 2020 2020 2020  es:.    #       
-00009a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009aa0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-00009ab0: 2866 225c 6e50 726f 7869 6d61 6c20 4c69  (f"\nProximal Li
-00009ac0: 6e65 2050 7269 6365 3a20 7b64 656d 616e  ne Price: {deman
-00009ad0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-00009ae0: 5b69 5d3a 2e32 667d 2229 0a20 2020 2023  [i]:.2f}").    #
+000065a0: 2020 2020 206b 202b 3d20 310a 2020 2020       k += 1.    
+000065b0: 2320 2020 2020 2020 2020 656c 6966 2064  #         elif d
+000065c0: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+000065d0: 275d 5b69 5d20 3d3d 2027 5261 6c6c 7920  '][i] == 'Rally 
+000065e0: 4361 6e64 6c65 2720 616e 6420 6461 7461  Candle' and data
+000065f0: 5b27 4361 6e64 6c65 2054 7970 6527 5d5b  ['Candle Type'][
+00006600: 6920 2b20 315d 203d 3d20 2742 6173 6520  i + 1] == 'Base 
+00006610: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
+00006620: 2020 2020 2020 2020 2020 2062 6173 655f             base_
+00006630: 636f 756e 7420 3d20 310a 2020 2020 2320  count = 1.    # 
+00006640: 2020 2020 2020 2020 2020 2020 6a20 3d20              j = 
+00006650: 6920 2b20 320a 2020 2020 2320 2020 2020  i + 2.    #     
+00006660: 2020 2020 2020 2020 7768 696c 6520 6a20          while j 
+00006670: 3c20 6c65 6e28 6461 7461 2920 616e 6420  < len(data) and 
+00006680: 6461 7461 5b27 4361 6e64 6c65 2054 7970  data['Candle Typ
+00006690: 6527 5d5b 6a5d 203d 3d20 2742 6173 6520  e'][j] == 'Base 
+000066a0: 4361 6e64 6c65 273a 0a20 2020 2023 2020  Candle':.    #  
+000066b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000066c0: 6173 655f 636f 756e 7420 2b3d 2031 0a20  ase_count += 1. 
+000066d0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+000066e0: 2020 2020 206a 202b 3d20 310a 2020 2020       j += 1.    
+000066f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00006700: 2023 2020 2020 2020 2020 2020 2020 2069   #             i
+00006710: 6620 6261 7365 5f63 6f75 6e74 203e 3d20  f base_count >= 
+00006720: 313a 2020 2320 4174 206c 6561 7374 206f  1:  # At least o
+00006730: 6e65 2062 6173 6520 6361 6e64 6c65 2072  ne base candle r
+00006740: 6571 7569 7265 640a 2020 2020 2320 2020  equired.    #   
+00006750: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006760: 206a 203c 206c 656e 2864 6174 6129 2061   j < len(data) a
+00006770: 6e64 2064 6174 615b 2743 616e 646c 6520  nd data['Candle 
+00006780: 5479 7065 275d 5b6a 5d20 3d3d 2027 5261  Type'][j] == 'Ra
+00006790: 6c6c 7920 4361 6e64 6c65 273a 0a20 2020  lly Candle':.   
+000067a0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+000067b0: 2020 2020 2020 2069 6620 6461 7461 5b27         if data['
+000067c0: 436c 6f73 6527 5d5b 6a5d 203e 2064 6174  Close'][j] > dat
+000067d0: 615b 2743 6c6f 7365 275d 5b69 5d20 616e  a['Close'][i] an
+000067e0: 6420 6461 7461 5b27 4869 6768 275d 5b69  d data['High'][i
+000067f0: 5d20 3c3d 2063 6d70 3a20 2023 204e 6577  ] <= cmp:  # New
+00006800: 2063 6f6e 6469 7469 6f6e 3a20 636c 6f73   condition: clos
+00006810: 6520 6f66 2032 6e64 2072 616c 6c79 2063  e of 2nd rally c
+00006820: 616e 646c 6520 3e20 3173 7420 7261 6c6c  andle > 1st rall
+00006830: 7920 6361 6e64 6c65 0a20 2020 2023 2020  y candle.    #  
+00006840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006850: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
+00006860: 6f72 206f 6e65 206d 6f72 6520 7261 6c6c  or one more rall
+00006870: 7920 6361 6e64 6c65 206f 7220 6772 6565  y candle or gree
+00006880: 6e20 6261 7365 2063 616e 646c 650a 2020  n base candle.  
+00006890: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000068a0: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+000068b0: 6a20 2b20 310a 2020 2020 2320 2020 2020  j + 1.    #     
+000068c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068d0: 2020 2020 7768 696c 6520 6b20 3c20 6c65      while k < le
+000068e0: 6e28 6461 7461 293a 0a20 2020 2023 2020  n(data):.    #  
+000068f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006900: 2020 2020 2020 2020 2020 2069 6620 6461             if da
+00006910: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00006920: 5d5b 6b5d 203d 3d20 2752 616c 6c79 2043  ][k] == 'Rally C
+00006930: 616e 646c 6527 206f 7220 2864 6174 615b  andle' or (data[
+00006940: 2743 616e 646c 6520 5479 7065 275d 5b6b  'Candle Type'][k
+00006950: 5d20 3d3d 2027 4261 7365 2043 616e 646c  ] == 'Base Candl
+00006960: 6527 2061 6e64 2064 6174 615b 2743 6c6f  e' and data['Clo
+00006970: 7365 275d 5b6b 5d20 3e20 6461 7461 5b27  se'][k] > data['
+00006980: 4f70 656e 275d 5b6b 5d29 3a0a 2020 2020  Open'][k]):.    
+00006990: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000069a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069b0: 2020 6465 6d61 6e64 5f7a 6f6e 6573 2e61    demand_zones.a
+000069c0: 7070 656e 6428 2869 2c20 6a2c 2027 5261  ppend((i, j, 'Ra
+000069d0: 6c6c 7920 4261 7365 2052 616c 6c79 272c  lly Base Rally',
+000069e0: 2062 6173 655f 636f 756e 7429 290a 2020   base_count)).  
+000069f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a10: 2020 2020 7261 6c6c 795f 6261 7365 5f72      rally_base_r
+00006a20: 616c 6c79 5f7a 6f6e 6520 3d20 5472 7565  ally_zone = True
+00006a30: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00006a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a50: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00006a60: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00006a70: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00006a80: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00006a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006aa0: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
+00006ab0: 2023 2043 6f6c 6c65 6374 2062 6173 6520   # Collect base 
+00006ac0: 6361 6e64 6c65 2070 7269 6365 7320 666f  candle prices fo
+00006ad0: 7220 7072 6f78 696d 616c 206c 696e 6520  r proximal line 
+00006ae0: 6361 6c63 756c 6174 696f 6e0a 2020 2020  calculation.    
+00006af0: 2320 2020 2020 2020 2020 6966 2064 6174  #         if dat
+00006b00: 615b 2743 616e 646c 6520 5479 7065 275d  a['Candle Type']
+00006b10: 5b69 5d20 3d3d 2027 4261 7365 2043 616e  [i] == 'Base Can
+00006b20: 646c 6527 3a0a 2020 2020 2320 2020 2020  dle':.    #     
+00006b30: 2020 2020 2020 2020 6261 7365 5f63 616e          base_can
+00006b40: 646c 655f 7072 6963 6573 2e61 7070 656e  dle_prices.appen
+00006b50: 6428 6461 7461 5b27 436c 6f73 6527 5d5b  d(data['Close'][
+00006b60: 695d 290a 0a20 2020 2023 2020 2020 2023  i])..    #     #
+00006b70: 2043 616c 6375 6c61 7465 2070 726f 7869   Calculate proxi
+00006b80: 6d61 6c20 6c69 6e65 2070 7269 6365 2028  mal line price (
+00006b90: 6869 6768 6573 7420 7072 6963 6520 616d  highest price am
+00006ba0: 6f6e 6720 6261 7365 2063 616e 646c 6573  ong base candles
+00006bb0: 290a 2020 2020 2320 2020 2020 7072 6f78  ).    #     prox
+00006bc0: 696d 616c 5f6c 696e 655f 7072 6963 6520  imal_line_price 
+00006bd0: 3d20 6d61 7828 6261 7365 5f63 616e 646c  = max(base_candl
+00006be0: 655f 7072 6963 6573 2920 6966 2062 6173  e_prices) if bas
+00006bf0: 655f 6361 6e64 6c65 5f70 7269 6365 7320  e_candle_prices 
+00006c00: 656c 7365 204e 6f6e 650a 0a20 2020 2023  else None..    #
+00006c10: 2020 2020 2072 6574 7572 6e20 6465 6d61       return dema
+00006c20: 6e64 5f7a 6f6e 6573 2c20 6472 6f70 5f62  nd_zones, drop_b
+00006c30: 6173 655f 7261 6c6c 795f 7a6f 6e65 2c20  ase_rally_zone, 
+00006c40: 7261 6c6c 795f 6261 7365 5f72 616c 6c79  rally_base_rally
+00006c50: 5f7a 6f6e 652c 2070 726f 7869 6d61 6c5f  _zone, proximal_
+00006c60: 6c69 6e65 5f70 7269 6365 0a0a 2020 2020  line_price..    
+00006c70: 2320 6465 6620 6964 656e 7469 6679 5f73  # def identify_s
+00006c80: 7570 706c 795f 7a6f 6e65 2873 656c 662c  upply_zone(self,
+00006c90: 6461 7461 2c20 636d 7029 3a0a 2020 2020  data, cmp):.    
+00006ca0: 2320 2020 2020 7375 7070 6c79 5f7a 6f6e  #     supply_zon
+00006cb0: 6573 203d 205b 5d0a 2020 2020 2320 2020  es = [].    #   
+00006cc0: 2020 7261 6c6c 795f 6261 7365 5f64 726f    rally_base_dro
+00006cd0: 705f 7a6f 6e65 203d 2046 616c 7365 0a20  p_zone = False. 
+00006ce0: 2020 2023 2020 2020 2064 726f 705f 6261     #     drop_ba
+00006cf0: 7365 5f64 726f 705f 7a6f 6e65 203d 2046  se_drop_zone = F
+00006d00: 616c 7365 0a20 2020 2020 2020 200a 2020  alse.        .  
+00006d10: 2020 2320 2020 2020 2320 4164 6469 7469    #     # Additi
+00006d20: 6f6e 616c 2076 6172 6961 626c 6573 2074  onal variables t
+00006d30: 6f20 7472 6163 6b20 6261 7365 2063 616e  o track base can
+00006d40: 646c 6520 7072 6963 6573 2066 6f72 2070  dle prices for p
+00006d50: 726f 7869 6d61 6c20 6c69 6e65 2063 616c  roximal line cal
+00006d60: 6375 6c61 7469 6f6e 0a20 2020 2023 2020  culation.    #  
+00006d70: 2020 2062 6173 655f 6361 6e64 6c65 5f70     base_candle_p
+00006d80: 7269 6365 7320 3d20 5b5d 0a20 2020 2020  rices = [].     
+00006d90: 2020 200a 2020 2020 2320 2020 2020 666f     .    #     fo
+00006da0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+00006db0: 2864 6174 6129 202d 2032 293a 0a20 2020  (data) - 2):.   
+00006dc0: 2023 2020 2020 2020 2020 2069 6620 6461   #         if da
+00006dd0: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00006de0: 5d5b 695d 203d 3d20 2744 726f 7020 4361  ][i] == 'Drop Ca
+00006df0: 6e64 6c65 2720 616e 6420 6461 7461 5b27  ndle' and data['
+00006e00: 4361 6e64 6c65 2054 7970 6527 5d5b 6920  Candle Type'][i 
+00006e10: 2b20 315d 203d 3d20 2742 6173 6520 4361  + 1] == 'Base Ca
+00006e20: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
+00006e30: 2020 2020 2020 2020 2062 6173 655f 636f           base_co
+00006e40: 756e 7420 3d20 310a 2020 2020 2320 2020  unt = 1.    #   
+00006e50: 2020 2020 2020 2020 2020 6a20 3d20 6920            j = i 
+00006e60: 2b20 320a 2020 2020 2320 2020 2020 2020  + 2.    #       
+00006e70: 2020 2020 2020 7768 696c 6520 6a20 3c20        while j < 
+00006e80: 6c65 6e28 6461 7461 2920 616e 6420 6461  len(data) and da
+00006e90: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+00006ea0: 5d5b 6a5d 203d 3d20 2742 6173 6520 4361  ][j] == 'Base Ca
+00006eb0: 6e64 6c65 273a 0a20 2020 2023 2020 2020  ndle':.    #    
+00006ec0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+00006ed0: 655f 636f 756e 7420 2b3d 2031 0a20 2020  e_count += 1.   
+00006ee0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00006ef0: 2020 206a 202b 3d20 310a 2020 2020 2020     j += 1.      
+00006f00: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
+00006f10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00006f20: 6261 7365 5f63 6f75 6e74 203c 3d20 343a  base_count <= 4:
+00006f30: 2020 2320 4d61 7869 6d75 6d20 6f66 2034    # Maximum of 4
+00006f40: 2062 6173 6520 6361 6e64 6c65 7320 666f   base candles fo
+00006f50: 7220 7765 656b 6c79 206f 7220 6d6f 6e74  r weekly or mont
+00006f60: 686c 7920 7469 6d65 6672 616d 652c 2065  hly timeframe, e
+00006f70: 6c73 6520 3320 666f 7220 6461 696c 790a  lse 3 for daily.
+00006f80: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00006f90: 2020 2020 2020 6966 206a 203c 206c 656e        if j < len
+00006fa0: 2864 6174 6129 2061 6e64 2064 6174 615b  (data) and data[
+00006fb0: 2743 616e 646c 6520 5479 7065 275d 5b6a  'Candle Type'][j
+00006fc0: 5d20 3d3d 2027 4472 6f70 2043 616e 646c  ] == 'Drop Candl
+00006fd0: 6527 3a0a 2020 2020 2320 2020 2020 2020  e':.    #       
+00006fe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006ff0: 2064 6174 615b 2743 6c6f 7365 275d 5b69   data['Close'][i
+00007000: 5d20 3c20 6461 7461 5b27 4c6f 7727 5d5b  ] < data['Low'][
+00007010: 6a5d 2061 6e64 2064 6174 615b 274c 6f77  j] and data['Low
+00007020: 275d 5b69 5d20 3e3d 2063 6d70 3a20 2023  '][i] >= cmp:  #
+00007030: 204e 6577 2063 6f6e 6469 7469 6f6e 3a20   New condition: 
+00007040: 636c 6f73 6520 6f66 2064 726f 7020 6361  close of drop ca
+00007050: 6e64 6c65 203c 206c 6f77 206f 6620 6261  ndle < low of ba
+00007060: 7365 2063 616e 646c 650a 2020 2020 2320  se candle.    # 
+00007070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007080: 2020 2020 2020 2020 2320 4e65 7720 6c6f          # New lo
+00007090: 6769 633a 204c 6f6f 6b20 666f 7220 6f6e  gic: Look for on
+000070a0: 6520 6d6f 7265 2064 726f 7020 6361 6e64  e more drop cand
+000070b0: 6c65 206f 7220 7265 6420 6261 7365 2063  le or red base c
+000070c0: 616e 646c 650a 2020 2020 2320 2020 2020  andle.    #     
+000070d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000070e0: 2020 2020 6b20 3d20 6a20 2b20 310a 2020      k = j + 1.  
+000070f0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00007100: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00007110: 6520 6b20 3c20 6c65 6e28 6461 7461 2920  e k < len(data) 
+00007120: 616e 6420 2864 6174 615b 2743 616e 646c  and (data['Candl
+00007130: 6520 5479 7065 275d 5b6b 5d20 3d3d 2027  e Type'][k] == '
+00007140: 4472 6f70 2043 616e 646c 6527 206f 7220  Drop Candle' or 
+00007150: 6461 7461 5b27 436c 6f73 6527 5d5b 6b5d  data['Close'][k]
+00007160: 203c 2064 6174 615b 274f 7065 6e27 5d5b   < data['Open'][
+00007170: 6b5d 293a 0a20 2020 2023 2020 2020 2020  k]):.    #      
+00007180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007190: 2020 2020 2020 206b 202b 3d20 310a 2020         k += 1.  
+000071a0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000071b0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+000071c0: 203c 206c 656e 2864 6174 6129 2061 6e64   < len(data) and
+000071d0: 2028 6461 7461 5b27 4361 6e64 6c65 2054   (data['Candle T
+000071e0: 7970 6527 5d5b 6b5d 203d 3d20 2744 726f  ype'][k] == 'Dro
+000071f0: 7020 4361 6e64 6c65 2720 6f72 2064 6174  p Candle' or dat
+00007200: 615b 2743 6c6f 7365 275d 5b6b 5d20 3c20  a['Close'][k] < 
+00007210: 6461 7461 5b27 4f70 656e 275d 5b6b 5d29  data['Open'][k])
+00007220: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+00007230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007240: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
+00007250: 2e61 7070 656e 6428 2869 2c20 6a2c 2027  .append((i, j, '
+00007260: 4472 6f70 2042 6173 6520 4472 6f70 272c  Drop Base Drop',
+00007270: 2062 6173 655f 636f 756e 7429 290a 2020   base_count)).  
+00007280: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00007290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072a0: 6472 6f70 5f62 6173 655f 6472 6f70 5f7a  drop_base_drop_z
+000072b0: 6f6e 6520 3d20 5472 7565 0a20 2020 2023  one = True.    #
+000072c0: 2020 2020 2020 2020 2065 6c69 6620 6461           elif da
+000072d0: 7461 5b27 4361 6e64 6c65 2054 7970 6527  ta['Candle Type'
+000072e0: 5d5b 695d 203d 3d20 2752 616c 6c79 2043  ][i] == 'Rally C
+000072f0: 616e 646c 6527 2061 6e64 2064 6174 615b  andle' and data[
+00007300: 2743 616e 646c 6520 5479 7065 275d 5b69  'Candle Type'][i
+00007310: 202b 2031 5d20 3d3d 2027 4261 7365 2043   + 1] == 'Base C
+00007320: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+00007330: 2020 2020 2020 2020 2020 6261 7365 5f63            base_c
+00007340: 6f75 6e74 203d 2031 0a20 2020 2023 2020  ount = 1.    #  
+00007350: 2020 2020 2020 2020 2020 206a 203d 2069             j = i
+00007360: 202b 2032 0a20 2020 2023 2020 2020 2020   + 2.    #      
+00007370: 2020 2020 2020 2077 6869 6c65 206a 203c         while j <
+00007380: 206c 656e 2864 6174 6129 2061 6e64 2064   len(data) and d
+00007390: 6174 615b 2743 616e 646c 6520 5479 7065  ata['Candle Type
+000073a0: 275d 5b6a 5d20 3d3d 2027 4261 7365 2043  '][j] == 'Base C
+000073b0: 616e 646c 6527 3a0a 2020 2020 2320 2020  andle':.    #   
+000073c0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+000073d0: 7365 5f63 6f75 6e74 202b 3d20 310a 2020  se_count += 1.  
+000073e0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000073f0: 2020 2020 6a20 2b3d 2031 0a20 2020 2020      j += 1.     
+00007400: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00007410: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+00007420: 2062 6173 655f 636f 756e 7420 3e3d 2031   base_count >= 1
+00007430: 3a20 2023 2041 7420 6c65 6173 7420 6f6e  :  # At least on
+00007440: 6520 6261 7365 2063 616e 646c 6520 7265  e base candle re
+00007450: 7175 6972 6564 0a20 2020 2023 2020 2020  quired.    #    
+00007460: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00007470: 6a20 3c20 6c65 6e28 6461 7461 2920 616e  j < len(data) an
+00007480: 6420 6461 7461 5b27 4361 6e64 6c65 2054  d data['Candle T
+00007490: 7970 6527 5d5b 6a5d 203d 3d20 2744 726f  ype'][j] == 'Dro
+000074a0: 7020 4361 6e64 6c65 273a 0a20 2020 2023  p Candle':.    #
+000074b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000074c0: 2020 2020 2069 6620 6461 7461 5b27 436c       if data['Cl
+000074d0: 6f73 6527 5d5b 6a5d 203c 2064 6174 615b  ose'][j] < data[
+000074e0: 274f 7065 6e27 5d5b 6a5d 2061 6e64 2064  'Open'][j] and d
+000074f0: 6174 615b 274c 6f77 275d 5b69 5d20 3e3d  ata['Low'][i] >=
+00007500: 2063 6d70 3a20 2023 204d 6f64 6966 6965   cmp:  # Modifie
+00007510: 6420 636f 6e64 6974 696f 6e3a 2063 6c6f  d condition: clo
+00007520: 7365 206f 6620 6472 6f70 2063 616e 646c  se of drop candl
+00007530: 6520 3c20 6f70 656e 206f 6620 6472 6f70  e < open of drop
+00007540: 2063 616e 646c 650a 2020 2020 2320 2020   candle.    #   
+00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007560: 2020 2020 2020 7375 7070 6c79 5f7a 6f6e        supply_zon
+00007570: 6573 2e61 7070 656e 6428 2869 2c20 6a2c  es.append((i, j,
+00007580: 2027 5261 6c6c 7920 4261 7365 2044 726f   'Rally Base Dro
+00007590: 7027 2c20 6261 7365 5f63 6f75 6e74 2929  p', base_count))
+000075a0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+000075b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000075c0: 616c 6c79 5f62 6173 655f 6472 6f70 5f7a  ally_base_drop_z
+000075d0: 6f6e 6520 3d20 5472 7565 0a20 2020 2020  one = True.     
+000075e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075f0: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+00007600: 2020 2020 2020 2320 436f 6c6c 6563 7420        # Collect 
+00007610: 6261 7365 2063 616e 646c 6520 7072 6963  base candle pric
+00007620: 6573 2066 6f72 2070 726f 7869 6d61 6c20  es for proximal 
+00007630: 6c69 6e65 2063 616c 6375 6c61 7469 6f6e  line calculation
+00007640: 0a20 2020 2023 2020 2020 2020 2020 2069  .    #         i
+00007650: 6620 6461 7461 5b27 4361 6e64 6c65 2054  f data['Candle T
+00007660: 7970 6527 5d5b 695d 203d 3d20 2742 6173  ype'][i] == 'Bas
+00007670: 6520 4361 6e64 6c65 273a 0a20 2020 2023  e Candle':.    #
+00007680: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+00007690: 655f 6361 6e64 6c65 5f70 7269 6365 732e  e_candle_prices.
+000076a0: 6170 7065 6e64 2864 6174 615b 2743 6c6f  append(data['Clo
+000076b0: 7365 275d 5b69 5d29 0a0a 2020 2020 2320  se'][i])..    # 
+000076c0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+000076d0: 7072 6f78 696d 616c 206c 696e 6520 7072  proximal line pr
+000076e0: 6963 6520 286c 6f77 6573 7420 7072 6963  ice (lowest pric
+000076f0: 6520 616d 6f6e 6720 6261 7365 2063 616e  e among base can
+00007700: 646c 6573 290a 2020 2020 2320 2020 2020  dles).    #     
+00007710: 7072 6f78 696d 616c 5f6c 696e 655f 7072  proximal_line_pr
+00007720: 6963 6520 3d20 6d69 6e28 6261 7365 5f63  ice = min(base_c
+00007730: 616e 646c 655f 7072 6963 6573 2920 6966  andle_prices) if
+00007740: 2062 6173 655f 6361 6e64 6c65 5f70 7269   base_candle_pri
+00007750: 6365 7320 656c 7365 204e 6f6e 650a 0a20  ces else None.. 
+00007760: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+00007770: 7375 7070 6c79 5f7a 6f6e 6573 2c20 7261  supply_zones, ra
+00007780: 6c6c 795f 6261 7365 5f64 726f 705f 7a6f  lly_base_drop_zo
+00007790: 6e65 2c20 6472 6f70 5f62 6173 655f 6472  ne, drop_base_dr
+000077a0: 6f70 5f7a 6f6e 652c 2070 726f 7869 6d61  op_zone, proxima
+000077b0: 6c5f 6c69 6e65 5f70 7269 6365 0a0a 2020  l_line_price..  
+000077c0: 2020 2320 6465 6620 6361 6c63 756c 6174    # def calculat
+000077d0: 655f 6465 6d61 6e64 5f70 726f 7869 6d61  e_demand_proxima
+000077e0: 6c5f 6c69 6e65 7328 7365 6c66 2c64 6174  l_lines(self,dat
+000077f0: 612c 2064 656d 616e 645f 7a6f 6e65 7329  a, demand_zones)
+00007800: 3a0a 2020 2020 2320 2020 2020 7072 6f78  :.    #     prox
+00007810: 696d 616c 5f6c 696e 655f 7072 6963 6573  imal_line_prices
+00007820: 203d 205b 5d0a 2020 2020 2320 2020 2020   = [].    #     
+00007830: 666f 7220 7374 6172 742c 2065 6e64 2c20  for start, end, 
+00007840: 5f2c 205f 2069 6e20 6465 6d61 6e64 5f7a  _, _ in demand_z
+00007850: 6f6e 6573 3a0a 2020 2020 2320 2020 2020  ones:.    #     
+00007860: 2020 2020 6261 7365 5f63 616e 646c 655f      base_candle_
+00007870: 7072 6963 6573 203d 2064 6174 612e 6c6f  prices = data.lo
+00007880: 635b 2864 6174 615b 2743 616e 646c 6520  c[(data['Candle 
+00007890: 5479 7065 275d 203d 3d20 2742 6173 6520  Type'] == 'Base 
+000078a0: 4361 6e64 6c65 2729 2026 2028 6461 7461  Candle') & (data
+000078b0: 2e69 6e64 6578 203e 3d20 6461 7461 2e69  .index >= data.i
+000078c0: 6e64 6578 5b73 7461 7274 5d29 2026 2028  ndex[start]) & (
+000078d0: 6461 7461 2e69 6e64 6578 203c 3d20 6461  data.index <= da
+000078e0: 7461 2e69 6e64 6578 5b65 6e64 5d29 2c20  ta.index[end]), 
+000078f0: 5b27 4f70 656e 272c 2027 436c 6f73 6527  ['Open', 'Close'
+00007900: 5d5d 0a20 2020 2023 2020 2020 2020 2020  ]].    #        
+00007910: 206d 6178 5f70 7269 6365 203d 2062 6173   max_price = bas
+00007920: 655f 6361 6e64 6c65 5f70 7269 6365 732e  e_candle_prices.
+00007930: 6d61 7828 6178 6973 3d31 292e 6d61 7828  max(axis=1).max(
+00007940: 2920 2023 2047 6574 2074 6865 206d 6178  )  # Get the max
+00007950: 696d 756d 2070 7269 6365 2061 6d6f 6e67  imum price among
+00007960: 2061 6c6c 2062 6173 6520 6361 6e64 6c65   all base candle
+00007970: 7327 206f 7065 6e20 616e 6420 636c 6f73  s' open and clos
+00007980: 6520 7072 6963 6573 0a20 2020 2023 2020  e prices.    #  
+00007990: 2020 2020 2020 2070 726f 7869 6d61 6c5f         proximal_
+000079a0: 6c69 6e65 5f70 7269 6365 732e 6170 7065  line_prices.appe
+000079b0: 6e64 286d 6178 5f70 7269 6365 290a 2020  nd(max_price).  
+000079c0: 2020 2320 2020 2020 7265 7475 726e 2070    #     return p
+000079d0: 726f 7869 6d61 6c5f 6c69 6e65 5f70 7269  roximal_line_pri
+000079e0: 6365 730a 0a20 2020 2023 2064 6566 2063  ces..    # def c
+000079f0: 616c 6375 6c61 7465 5f73 7570 706c 795f  alculate_supply_
+00007a00: 7072 6f78 696d 616c 5f6c 696e 6573 2873  proximal_lines(s
+00007a10: 656c 662c 6461 7461 2c20 7375 7070 6c79  elf,data, supply
+00007a20: 5f7a 6f6e 6573 293a 0a20 2020 2023 2020  _zones):.    #  
+00007a30: 2020 2070 726f 7869 6d61 6c5f 6c69 6e65     proximal_line
+00007a40: 5f70 7269 6365 7320 3d20 5b5d 0a20 2020  _prices = [].   
+00007a50: 2023 2020 2020 2066 6f72 2073 7461 7274   #     for start
+00007a60: 2c20 656e 642c 205f 2c20 5f20 696e 2073  , end, _, _ in s
+00007a70: 7570 706c 795f 7a6f 6e65 733a 0a20 2020  upply_zones:.   
+00007a80: 2023 2020 2020 2020 2020 2062 6173 655f   #         base_
+00007a90: 6361 6e64 6c65 5f70 7269 6365 7320 3d20  candle_prices = 
+00007aa0: 6461 7461 2e6c 6f63 5b28 6461 7461 5b27  data.loc[(data['
+00007ab0: 4361 6e64 6c65 2054 7970 6527 5d20 3d3d  Candle Type'] ==
+00007ac0: 2027 4261 7365 2043 616e 646c 6527 2920   'Base Candle') 
+00007ad0: 2620 2864 6174 612e 696e 6465 7820 3e3d  & (data.index >=
+00007ae0: 2064 6174 612e 696e 6465 785b 7374 6172   data.index[star
+00007af0: 745d 2920 2620 2864 6174 612e 696e 6465  t]) & (data.inde
+00007b00: 7820 3c3d 2064 6174 612e 696e 6465 785b  x <= data.index[
+00007b10: 656e 645d 292c 205b 274f 7065 6e27 2c20  end]), ['Open', 
+00007b20: 2743 6c6f 7365 275d 5d0a 2020 2020 2320  'Close']].    # 
+00007b30: 2020 2020 2020 2020 6d69 6e5f 7072 6963          min_pric
+00007b40: 6520 3d20 6261 7365 5f63 616e 646c 655f  e = base_candle_
+00007b50: 7072 6963 6573 2e6d 696e 2861 7869 733d  prices.min(axis=
+00007b60: 3129 2e6d 696e 2829 2020 2320 4765 7420  1).min()  # Get 
+00007b70: 7468 6520 6d69 6e69 6d75 6d20 7072 6963  the minimum pric
+00007b80: 6520 616d 6f6e 6720 616c 6c20 6261 7365  e among all base
+00007b90: 2063 616e 646c 6573 2720 6f70 656e 2061   candles' open a
+00007ba0: 6e64 2063 6c6f 7365 2070 7269 6365 730a  nd close prices.
+00007bb0: 2020 2020 2320 2020 2020 2020 2020 7072      #         pr
+00007bc0: 6f78 696d 616c 5f6c 696e 655f 7072 6963  oximal_line_pric
+00007bd0: 6573 2e61 7070 656e 6428 6d69 6e5f 7072  es.append(min_pr
+00007be0: 6963 6529 0a20 2020 2023 2020 2020 2072  ice).    #     r
+00007bf0: 6574 7572 6e20 7072 6f78 696d 616c 5f6c  eturn proximal_l
+00007c00: 696e 655f 7072 6963 6573 0a20 2020 2020  ine_prices.     
+00007c10: 2020 200a 2020 2020 2320 6465 6620 6361     .    # def ca
+00007c20: 6c63 756c 6174 655f 6465 6d61 6e64 5f64  lculate_demand_d
+00007c30: 6973 7461 6c5f 6c69 6e65 7328 7365 6c66  istal_lines(self
+00007c40: 2c64 6174 612c 2064 656d 616e 645f 7a6f  ,data, demand_zo
+00007c50: 6e65 7329 3a0a 2020 2020 2320 2020 2020  nes):.    #     
+00007c60: 6469 7374 616c 5f6c 696e 655f 7072 6963  distal_line_pric
+00007c70: 6573 203d 205b 5d0a 2020 2020 2320 2020  es = [].    #   
+00007c80: 2020 666f 7220 7374 6172 742c 2065 6e64    for start, end
+00007c90: 2c20 7061 7474 6572 6e2c 205f 2069 6e20  , pattern, _ in 
+00007ca0: 6465 6d61 6e64 5f7a 6f6e 6573 3a0a 2020  demand_zones:.  
+00007cb0: 2020 2320 2020 2020 2020 2020 6966 2070    #         if p
+00007cc0: 6174 7465 726e 203d 3d20 2744 726f 7020  attern == 'Drop 
+00007cd0: 4261 7365 2052 616c 6c79 273a 0a20 2020  Base Rally':.   
+00007ce0: 2023 2020 2020 2020 2020 2020 2020 2023   #             #
+00007cf0: 204c 6f67 6963 2066 6f72 2044 726f 7020   Logic for Drop 
+00007d00: 4261 7365 2052 616c 6c79 2070 6174 7465  Base Rally patte
+00007d10: 726e 3a20 5461 6b65 2074 6865 206c 6f77  rn: Take the low
+00007d20: 6573 7420 7072 6963 6520 616d 6f6e 6720  est price among 
+00007d30: 616c 6c20 636f 6d70 6f6e 656e 7473 206f  all components o
+00007d40: 6620 7468 6520 7a6f 6e65 0a20 2020 2023  f the zone.    #
+00007d50: 2020 2020 2020 2020 2020 2020 206c 6f77               low
+00007d60: 6573 745f 7072 6963 6520 3d20 6d69 6e28  est_price = min(
+00007d70: 6461 7461 5b27 4c6f 7727 5d5b 7374 6172  data['Low'][star
+00007d80: 743a 656e 6420 2b20 315d 2920 2023 2047  t:end + 1])  # G
+00007d90: 6574 2074 6865 206c 6f77 6573 7420 7072  et the lowest pr
+00007da0: 6963 6520 7769 7468 696e 2074 6865 207a  ice within the z
+00007db0: 6f6e 650a 2020 2020 2320 2020 2020 2020  one.    #       
+00007dc0: 2020 2020 2020 6469 7374 616c 5f6c 696e        distal_lin
+00007dd0: 655f 7072 6963 6573 2e61 7070 656e 6428  e_prices.append(
+00007de0: 6c6f 7765 7374 5f70 7269 6365 290a 2020  lowest_price).  
+00007df0: 2020 2320 2020 2020 2020 2020 656c 6966    #         elif
+00007e00: 2070 6174 7465 726e 203d 3d20 2752 616c   pattern == 'Ral
+00007e10: 6c79 2042 6173 6520 5261 6c6c 7927 3a0a  ly Base Rally':.
+00007e20: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00007e30: 2020 2320 4c6f 6769 6320 666f 7220 5261    # Logic for Ra
+00007e40: 6c6c 7920 4261 7365 2052 616c 6c79 2070  lly Base Rally p
+00007e50: 6174 7465 726e 3a20 5461 6b65 2074 6865  attern: Take the
+00007e60: 206c 6f77 6573 7420 6f66 206f 6e6c 7920   lowest of only 
+00007e70: 616c 6c20 6261 7365 2063 616e 646c 6520  all base candle 
+00007e80: 616e 6420 666f 6c6c 6f77 6564 2072 616c  and followed ral
+00007e90: 6c79 2063 616e 646c 650a 2020 2020 2320  ly candle.    # 
+00007ea0: 2020 2020 2020 2020 2020 2020 6261 7365              base
+00007eb0: 5f63 616e 646c 655f 7072 6963 6573 203d  _candle_prices =
+00007ec0: 2064 6174 612e 6c6f 635b 2864 6174 615b   data.loc[(data[
+00007ed0: 2743 616e 646c 6520 5479 7065 275d 203d  'Candle Type'] =
+00007ee0: 3d20 2742 6173 6520 4361 6e64 6c65 2729  = 'Base Candle')
+00007ef0: 2026 2028 6461 7461 2e69 6e64 6578 203e   & (data.index >
+00007f00: 3d20 6461 7461 2e69 6e64 6578 5b73 7461  = data.index[sta
+00007f10: 7274 5d29 2026 2028 6461 7461 2e69 6e64  rt]) & (data.ind
+00007f20: 6578 203c 3d20 6461 7461 2e69 6e64 6578  ex <= data.index
+00007f30: 5b65 6e64 5d29 2c20 274c 6f77 275d 0a20  [end]), 'Low']. 
+00007f40: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00007f50: 2072 616c 6c79 5f63 616e 646c 655f 7072   rally_candle_pr
+00007f60: 6963 6573 203d 2064 6174 612e 6c6f 635b  ices = data.loc[
+00007f70: 2864 6174 615b 2743 616e 646c 6520 5479  (data['Candle Ty
+00007f80: 7065 275d 203d 3d20 2752 616c 6c79 2043  pe'] == 'Rally C
+00007f90: 616e 646c 6527 2920 2620 2864 6174 612e  andle') & (data.
+00007fa0: 696e 6465 7820 3e3d 2064 6174 612e 696e  index >= data.in
+00007fb0: 6465 785b 656e 645d 2920 2620 2864 6174  dex[end]) & (dat
+00007fc0: 612e 696e 6465 7820 3c20 6461 7461 2e69  a.index < data.i
+00007fd0: 6e64 6578 5b65 6e64 2b31 5d29 2c20 274c  ndex[end+1]), 'L
+00007fe0: 6f77 275d 0a20 2020 2023 2020 2020 2020  ow'].    #      
+00007ff0: 2020 2020 2020 2061 6c6c 5f70 7269 6365         all_price
+00008000: 7320 3d20 7064 2e63 6f6e 6361 7428 5b62  s = pd.concat([b
+00008010: 6173 655f 6361 6e64 6c65 5f70 7269 6365  ase_candle_price
+00008020: 732c 2072 616c 6c79 5f63 616e 646c 655f  s, rally_candle_
+00008030: 7072 6963 6573 5d29 0a20 2020 2023 2020  prices]).    #  
+00008040: 2020 2020 2020 2020 2020 206c 6f77 6573             lowes
+00008050: 745f 7072 6963 6520 3d20 616c 6c5f 7072  t_price = all_pr
+00008060: 6963 6573 2e6d 696e 2829 2069 6620 6e6f  ices.min() if no
+00008070: 7420 616c 6c5f 7072 6963 6573 2e65 6d70  t all_prices.emp
+00008080: 7479 2065 6c73 6520 4e6f 6e65 0a20 2020  ty else None.   
+00008090: 2023 2020 2020 2020 2020 2020 2020 2064   #             d
+000080a0: 6973 7461 6c5f 6c69 6e65 5f70 7269 6365  istal_line_price
+000080b0: 732e 6170 7065 6e64 286c 6f77 6573 745f  s.append(lowest_
+000080c0: 7072 6963 6529 0a20 2020 2023 2020 2020  price).    #    
+000080d0: 2072 6574 7572 6e20 6469 7374 616c 5f6c   return distal_l
+000080e0: 696e 655f 7072 6963 6573 0a0a 2020 2020  ine_prices..    
+000080f0: 2320 6465 6620 6361 6c63 756c 6174 655f  # def calculate_
+00008100: 7375 7070 6c79 5f64 6973 7461 6c5f 6c69  supply_distal_li
+00008110: 6e65 7328 7365 6c66 2c64 6174 612c 2073  nes(self,data, s
+00008120: 7570 706c 795f 7a6f 6e65 7329 3a0a 2020  upply_zones):.  
+00008130: 2020 2320 2020 2020 6469 7374 616c 5f6c    #     distal_l
+00008140: 696e 655f 7072 6963 6573 203d 205b 5d0a  ine_prices = [].
+00008150: 2020 2020 2320 2020 2020 666f 7220 7374      #     for st
+00008160: 6172 742c 2065 6e64 2c20 7061 7474 6572  art, end, patter
+00008170: 6e2c 205f 2069 6e20 7375 7070 6c79 5f7a  n, _ in supply_z
+00008180: 6f6e 6573 3a0a 2020 2020 2320 2020 2020  ones:.    #     
+00008190: 2020 2020 6966 2070 6174 7465 726e 203d      if pattern =
+000081a0: 3d20 2752 616c 6c79 2042 6173 6520 4472  = 'Rally Base Dr
+000081b0: 6f70 273a 0a20 2020 2023 2020 2020 2020  op':.    #      
+000081c0: 2020 2020 2020 2023 204c 6f67 6963 2066         # Logic f
+000081d0: 6f72 2052 616c 6c79 2042 6173 6520 4472  or Rally Base Dr
+000081e0: 6f70 2070 6174 7465 726e 3a20 5461 6b65  op pattern: Take
+000081f0: 2074 6865 2068 6967 6865 7374 2070 7269   the highest pri
+00008200: 6365 2061 6d6f 6e67 2061 6c6c 2063 6f6d  ce among all com
+00008210: 706f 6e65 6e74 7320 6f66 2074 6865 207a  ponents of the z
+00008220: 6f6e 650a 2020 2020 2320 2020 2020 2020  one.    #       
+00008230: 2020 2020 2020 6869 6768 6573 745f 7072        highest_pr
+00008240: 6963 6520 3d20 6d61 7828 6461 7461 5b27  ice = max(data['
+00008250: 4869 6768 275d 5b73 7461 7274 3a65 6e64  High'][start:end
+00008260: 202b 2031 5d29 2020 2320 4765 7420 7468   + 1])  # Get th
+00008270: 6520 6869 6768 6573 7420 7072 6963 6520  e highest price 
+00008280: 7769 7468 696e 2074 6865 207a 6f6e 650a  within the zone.
+00008290: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000082a0: 2020 6469 7374 616c 5f6c 696e 655f 7072    distal_line_pr
+000082b0: 6963 6573 2e61 7070 656e 6428 6869 6768  ices.append(high
+000082c0: 6573 745f 7072 6963 6529 0a20 2020 2023  est_price).    #
+000082d0: 2020 2020 2020 2020 2065 6c69 6620 7061           elif pa
+000082e0: 7474 6572 6e20 3d3d 2027 4472 6f70 2042  ttern == 'Drop B
+000082f0: 6173 6520 4472 6f70 273a 0a20 2020 2023  ase Drop':.    #
+00008300: 2020 2020 2020 2020 2020 2020 2023 204c               # L
+00008310: 6f67 6963 2066 6f72 2044 726f 7020 4261  ogic for Drop Ba
+00008320: 7365 2044 726f 7020 7061 7474 6572 6e3a  se Drop pattern:
+00008330: 2054 616b 6520 7468 6520 6869 6768 6573   Take the highes
+00008340: 7420 6f66 206f 6e6c 7920 616c 6c20 6261  t of only all ba
+00008350: 7365 2063 616e 646c 6573 2061 6e64 2066  se candles and f
+00008360: 6f6c 6c6f 7765 6420 6472 6f70 2063 616e  ollowed drop can
+00008370: 646c 650a 2020 2020 2320 2020 2020 2020  dle.    #       
+00008380: 2020 2020 2020 6261 7365 5f63 616e 646c        base_candl
+00008390: 655f 7072 6963 6573 203d 2064 6174 612e  e_prices = data.
+000083a0: 6c6f 635b 2864 6174 615b 2743 616e 646c  loc[(data['Candl
+000083b0: 6520 5479 7065 275d 203d 3d20 2742 6173  e Type'] == 'Bas
+000083c0: 6520 4361 6e64 6c65 2729 2026 2028 6461  e Candle') & (da
+000083d0: 7461 2e69 6e64 6578 203e 3d20 6461 7461  ta.index >= data
+000083e0: 2e69 6e64 6578 5b73 7461 7274 5d29 2026  .index[start]) &
+000083f0: 2028 6461 7461 2e69 6e64 6578 203c 3d20   (data.index <= 
+00008400: 6461 7461 2e69 6e64 6578 5b65 6e64 5d29  data.index[end])
+00008410: 2c20 2748 6967 6827 5d0a 2020 2020 2320  , 'High'].    # 
+00008420: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+00008430: 5f63 616e 646c 655f 7072 6963 6573 203d  _candle_prices =
+00008440: 2064 6174 612e 6c6f 635b 2864 6174 615b   data.loc[(data[
+00008450: 2743 616e 646c 6520 5479 7065 275d 203d  'Candle Type'] =
+00008460: 3d20 2744 726f 7020 4361 6e64 6c65 2729  = 'Drop Candle')
+00008470: 2026 2028 6461 7461 2e69 6e64 6578 203e   & (data.index >
+00008480: 3d20 6461 7461 2e69 6e64 6578 5b73 7461  = data.index[sta
+00008490: 7274 5d29 2026 2028 6461 7461 2e69 6e64  rt]) & (data.ind
+000084a0: 6578 203c 3d20 6461 7461 2e69 6e64 6578  ex <= data.index
+000084b0: 5b65 6e64 5d29 2c20 2748 6967 6827 5d0a  [end]), 'High'].
+000084c0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000084d0: 2020 616c 6c5f 7072 6963 6573 203d 2070    all_prices = p
+000084e0: 642e 636f 6e63 6174 285b 6261 7365 5f63  d.concat([base_c
+000084f0: 616e 646c 655f 7072 6963 6573 2c20 6472  andle_prices, dr
+00008500: 6f70 5f63 616e 646c 655f 7072 6963 6573  op_candle_prices
+00008510: 5d29 0a20 2020 2023 2020 2020 2020 2020  ]).    #        
+00008520: 2020 2020 2068 6967 6865 7374 5f70 7269       highest_pri
+00008530: 6365 203d 2061 6c6c 5f70 7269 6365 732e  ce = all_prices.
+00008540: 6d61 7828 2920 6966 206e 6f74 2061 6c6c  max() if not all
+00008550: 5f70 7269 6365 732e 656d 7074 7920 656c  _prices.empty el
+00008560: 7365 204e 6f6e 650a 2020 2020 2320 2020  se None.    #   
+00008570: 2020 2020 2020 2020 2020 6469 7374 616c            distal
+00008580: 5f6c 696e 655f 7072 6963 6573 2e61 7070  _line_prices.app
+00008590: 656e 6428 6869 6768 6573 745f 7072 6963  end(highest_pric
+000085a0: 6529 0a20 2020 2023 2020 2020 2072 6574  e).    #     ret
+000085b0: 7572 6e20 6469 7374 616c 5f6c 696e 655f  urn distal_line_
+000085c0: 7072 6963 6573 0a0a 2020 2020 2320 6465  prices..    # de
+000085d0: 6620 6973 5f7a 6f6e 655f 7465 7374 6564  f is_zone_tested
+000085e0: 2873 656c 662c 6461 7461 2c20 7374 6172  (self,data, star
+000085f0: 745f 696e 6465 782c 2065 6e64 5f69 6e64  t_index, end_ind
+00008600: 6578 2c20 7072 6f78 696d 616c 5f6c 696e  ex, proximal_lin
+00008610: 655f 7072 6963 6529 3a0a 2020 2020 2320  e_price):.    # 
+00008620: 2020 2020 2222 220a 2020 2020 2320 2020      """.    #   
+00008630: 2020 4368 6563 6b20 6966 2074 6865 2070    Check if the p
+00008640: 726f 7869 6d61 6c20 6c69 6e65 2070 7269  roximal line pri
+00008650: 6365 2068 6173 2062 6565 6e20 7465 7374  ce has been test
+00008660: 6564 2062 7920 6675 7475 7265 2070 7269  ed by future pri
+00008670: 6365 732e 0a20 2020 2020 2020 200a 2020  ces..        .  
+00008680: 2020 2320 2020 2020 4172 6773 3a0a 2020    #     Args:.  
+00008690: 2020 2320 2020 2020 2d20 6461 7461 3a20    #     - data: 
+000086a0: 4461 7461 4672 616d 6520 636f 6e74 6169  DataFrame contai
+000086b0: 6e69 6e67 2073 746f 636b 2064 6174 610a  ning stock data.
+000086c0: 2020 2020 2320 2020 2020 2d20 7374 6172      #     - star
+000086d0: 745f 696e 6465 783a 2053 7461 7274 2069  t_index: Start i
+000086e0: 6e64 6578 206f 6620 7468 6520 6465 6d61  ndex of the dema
+000086f0: 6e64 2f73 7570 706c 7920 7a6f 6e65 0a20  nd/supply zone. 
+00008700: 2020 2023 2020 2020 202d 2065 6e64 5f69     #     - end_i
+00008710: 6e64 6578 3a20 456e 6420 696e 6465 7820  ndex: End index 
+00008720: 6f66 2074 6865 2064 656d 616e 642f 7375  of the demand/su
+00008730: 7070 6c79 207a 6f6e 650a 2020 2020 2320  pply zone.    # 
+00008740: 2020 2020 2d20 7072 6f78 696d 616c 5f6c      - proximal_l
+00008750: 696e 655f 7072 6963 653a 2050 726f 7869  ine_price: Proxi
+00008760: 6d61 6c20 6c69 6e65 2070 7269 6365 0a20  mal line price. 
+00008770: 2020 2020 2020 200a 2020 2020 2320 2020         .    #   
+00008780: 2020 5265 7475 726e 733a 0a20 2020 2023    Returns:.    #
+00008790: 2020 2020 202d 2054 7275 6520 6966 2074       - True if t
+000087a0: 6865 2070 726f 7869 6d61 6c20 6c69 6e65  he proximal line
+000087b0: 2070 7269 6365 2069 7320 7465 7374 6564   price is tested
+000087c0: 2c20 4661 6c73 6520 6f74 6865 7277 6973  , False otherwis
+000087d0: 650a 2020 2020 2320 2020 2020 2222 220a  e.    #     """.
+000087e0: 2020 2020 2320 2020 2020 666f 7220 6920      #     for i 
+000087f0: 696e 2072 616e 6765 2865 6e64 5f69 6e64  in range(end_ind
+00008800: 6578 202b 2031 2c20 6c65 6e28 6461 7461  ex + 1, len(data
+00008810: 2929 3a0a 2020 2020 2320 2020 2020 2020  )):.    #       
+00008820: 2020 6966 2064 6174 615b 274c 6f77 275d    if data['Low']
+00008830: 5b69 5d20 3c3d 2070 726f 7869 6d61 6c5f  [i] <= proximal_
+00008840: 6c69 6e65 5f70 7269 6365 203c 3d20 6461  line_price <= da
+00008850: 7461 5b27 4869 6768 275d 5b69 5d3a 0a20  ta['High'][i]:. 
+00008860: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00008870: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+00008880: 2023 2020 2020 2072 6574 7572 6e20 4661   #     return Fa
+00008890: 6c73 650a 0a20 2020 2023 2064 6566 2063  lse..    # def c
+000088a0: 616c 6375 6c61 7465 5f7a 6f6e 655f 7261  alculate_zone_ra
+000088b0: 6e67 6528 7365 6c66 2c70 726f 7869 6d61  nge(self,proxima
+000088c0: 6c5f 6c69 6e65 2c20 6469 7374 616c 5f6c  l_line, distal_l
+000088d0: 696e 6529 3a0a 2020 2020 2320 2020 2020  ine):.    #     
+000088e0: 2222 220a 2020 2020 2320 2020 2020 4361  """.    #     Ca
+000088f0: 6c63 756c 6174 6520 7468 6520 7261 6e67  lculate the rang
+00008900: 6520 6f66 2061 207a 6f6e 6520 6769 7665  e of a zone give
+00008910: 6e20 6974 7320 7072 6f78 696d 616c 2061  n its proximal a
+00008920: 6e64 2064 6973 7461 6c20 6c69 6e65 732e  nd distal lines.
+00008930: 0a20 2020 2020 2020 200a 2020 2020 2320  .        .    # 
+00008940: 2020 2020 4172 6773 3a0a 2020 2020 2320      Args:.    # 
+00008950: 2020 2020 2d20 7072 6f78 696d 616c 5f6c      - proximal_l
+00008960: 696e 653a 2050 726f 7869 6d61 6c20 6c69  ine: Proximal li
+00008970: 6e65 2070 7269 6365 0a20 2020 2023 2020  ne price.    #  
+00008980: 2020 202d 2064 6973 7461 6c5f 6c69 6e65     - distal_line
+00008990: 3a20 4469 7374 616c 206c 696e 6520 7072  : Distal line pr
+000089a0: 6963 650a 2020 2020 2020 2020 0a20 2020  ice.        .   
+000089b0: 2023 2020 2020 2052 6574 7572 6e73 3a0a   #     Returns:.
+000089c0: 2020 2020 2320 2020 2020 2d20 5261 6e67      #     - Rang
+000089d0: 6520 6f66 2074 6865 207a 6f6e 650a 2020  e of the zone.  
+000089e0: 2020 2320 2020 2020 2222 220a 2020 2020    #     """.    
+000089f0: 2320 2020 2020 6966 2070 726f 7869 6d61  #     if proxima
+00008a00: 6c5f 6c69 6e65 2069 7320 6e6f 7420 4e6f  l_line is not No
+00008a10: 6e65 2061 6e64 2064 6973 7461 6c5f 6c69  ne and distal_li
+00008a20: 6e65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ne is not None:.
+00008a30: 2020 2020 2320 2020 2020 2020 2020 7265      #         re
+00008a40: 7475 726e 2061 6273 2870 726f 7869 6d61  turn abs(proxima
+00008a50: 6c5f 6c69 6e65 202d 2064 6973 7461 6c5f  l_line - distal_
+00008a60: 6c69 6e65 290a 2020 2020 2320 2020 2020  line).    #     
+00008a70: 656c 7365 3a0a 2020 2020 2320 2020 2020  else:.    #     
+00008a80: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00008a90: 0a20 2020 2023 2064 6566 2063 616c 6375  .    # def calcu
+00008aa0: 6c61 7465 5f64 656d 616e 645f 7a6f 6e65  late_demand_zone
+00008ab0: 5f72 616e 6765 7328 7365 6c66 2c64 656d  _ranges(self,dem
+00008ac0: 616e 645f 7a6f 6e65 732c 2064 656d 616e  and_zones, deman
+00008ad0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+00008ae0: 2c20 6465 6d61 6e64 5f64 6973 7461 6c5f  , demand_distal_
+00008af0: 6c69 6e65 7329 3a0a 2020 2020 2320 2020  lines):.    #   
+00008b00: 2020 2222 220a 2020 2020 2320 2020 2020    """.    #     
+00008b10: 4361 6c63 756c 6174 6520 7468 6520 7261  Calculate the ra
+00008b20: 6e67 6520 6f66 2065 6163 6820 6465 6d61  nge of each dema
+00008b30: 6e64 207a 6f6e 652e 0a20 2020 2020 2020  nd zone..       
+00008b40: 200a 2020 2020 2320 2020 2020 4172 6773   .    #     Args
+00008b50: 3a0a 2020 2020 2320 2020 2020 2d20 6465  :.    #     - de
+00008b60: 6d61 6e64 5f7a 6f6e 6573 3a20 4c69 7374  mand_zones: List
+00008b70: 206f 6620 6465 6d61 6e64 207a 6f6e 6520   of demand zone 
+00008b80: 7475 706c 6573 2028 7374 6172 742c 2065  tuples (start, e
+00008b90: 6e64 2c20 7061 7474 6572 6e2c 2062 6173  nd, pattern, bas
+00008ba0: 655f 636f 756e 7429 0a20 2020 2023 2020  e_count).    #  
+00008bb0: 2020 202d 2064 656d 616e 645f 7072 6f78     - demand_prox
+00008bc0: 696d 616c 5f6c 696e 6573 3a20 4c69 7374  imal_lines: List
+00008bd0: 206f 6620 7072 6f78 696d 616c 206c 696e   of proximal lin
+00008be0: 6520 7072 6963 6573 2066 6f72 2064 656d  e prices for dem
+00008bf0: 616e 6420 7a6f 6e65 730a 2020 2020 2320  and zones.    # 
+00008c00: 2020 2020 2d20 6465 6d61 6e64 5f64 6973      - demand_dis
+00008c10: 7461 6c5f 6c69 6e65 733a 204c 6973 7420  tal_lines: List 
+00008c20: 6f66 2064 6973 7461 6c20 6c69 6e65 2070  of distal line p
+00008c30: 7269 6365 7320 666f 7220 6465 6d61 6e64  rices for demand
+00008c40: 207a 6f6e 6573 0a20 2020 2020 2020 200a   zones.        .
+00008c50: 2020 2020 2320 2020 2020 5265 7475 726e      #     Return
+00008c60: 733a 0a20 2020 2023 2020 2020 202d 204c  s:.    #     - L
+00008c70: 6973 7420 6f66 2072 616e 6765 7320 636f  ist of ranges co
+00008c80: 7272 6573 706f 6e64 696e 6720 746f 2065  rresponding to e
+00008c90: 6163 6820 6465 6d61 6e64 207a 6f6e 650a  ach demand zone.
+00008ca0: 2020 2020 2320 2020 2020 2222 220a 2020      #     """.  
+00008cb0: 2020 2320 2020 2020 6465 6d61 6e64 5f7a    #     demand_z
+00008cc0: 6f6e 655f 7261 6e67 6573 203d 205b 5d0a  one_ranges = [].
+00008cd0: 2020 2020 2320 2020 2020 666f 7220 692c      #     for i,
+00008ce0: 2028 7374 6172 742c 2065 6e64 2c20 5f2c   (start, end, _,
+00008cf0: 205f 2920 696e 2065 6e75 6d65 7261 7465   _) in enumerate
+00008d00: 2864 656d 616e 645f 7a6f 6e65 7329 3a0a  (demand_zones):.
+00008d10: 2020 2020 2320 2020 2020 2020 2020 7261      #         ra
+00008d20: 6e67 655f 6f66 5f7a 6f6e 6520 3d20 7365  nge_of_zone = se
+00008d30: 6c66 2e63 616c 6375 6c61 7465 5f7a 6f6e  lf.calculate_zon
+00008d40: 655f 7261 6e67 6528 6465 6d61 6e64 5f70  e_range(demand_p
+00008d50: 726f 7869 6d61 6c5f 6c69 6e65 735b 695d  roximal_lines[i]
+00008d60: 2c20 6465 6d61 6e64 5f64 6973 7461 6c5f  , demand_distal_
+00008d70: 6c69 6e65 735b 695d 290a 2020 2020 2320  lines[i]).    # 
+00008d80: 2020 2020 2020 2020 6465 6d61 6e64 5f7a          demand_z
+00008d90: 6f6e 655f 7261 6e67 6573 2e61 7070 656e  one_ranges.appen
+00008da0: 6428 7261 6e67 655f 6f66 5f7a 6f6e 6529  d(range_of_zone)
+00008db0: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
+00008dc0: 6e20 6465 6d61 6e64 5f7a 6f6e 655f 7261  n demand_zone_ra
+00008dd0: 6e67 6573 0a0a 2020 2020 2320 6465 6620  nges..    # def 
+00008de0: 6361 6c63 756c 6174 655f 7375 7070 6c79  calculate_supply
+00008df0: 5f7a 6f6e 655f 7261 6e67 6573 2873 656c  _zone_ranges(sel
+00008e00: 662c 7375 7070 6c79 5f7a 6f6e 6573 2c20  f,supply_zones, 
+00008e10: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
+00008e20: 6c69 6e65 732c 2073 7570 706c 795f 6469  lines, supply_di
+00008e30: 7374 616c 5f6c 696e 6573 293a 0a20 2020  stal_lines):.   
+00008e40: 2023 2020 2020 2022 2222 0a20 2020 2023   #     """.    #
+00008e50: 2020 2020 2043 616c 6375 6c61 7465 2074       Calculate t
+00008e60: 6865 2072 616e 6765 206f 6620 6561 6368  he range of each
+00008e70: 2073 7570 706c 7920 7a6f 6e65 2e0a 2020   supply zone..  
+00008e80: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+00008e90: 2041 7267 733a 0a20 2020 2023 2020 2020   Args:.    #    
+00008ea0: 202d 2073 7570 706c 795f 7a6f 6e65 733a   - supply_zones:
+00008eb0: 204c 6973 7420 6f66 2073 7570 706c 7920   List of supply 
+00008ec0: 7a6f 6e65 2074 7570 6c65 7320 2873 7461  zone tuples (sta
+00008ed0: 7274 2c20 656e 642c 2070 6174 7465 726e  rt, end, pattern
+00008ee0: 2c20 6261 7365 5f63 6f75 6e74 290a 2020  , base_count).  
+00008ef0: 2020 2320 2020 2020 2d20 7375 7070 6c79    #     - supply
+00008f00: 5f70 726f 7869 6d61 6c5f 6c69 6e65 733a  _proximal_lines:
+00008f10: 204c 6973 7420 6f66 2070 726f 7869 6d61   List of proxima
+00008f20: 6c20 6c69 6e65 2070 7269 6365 7320 666f  l line prices fo
+00008f30: 7220 7375 7070 6c79 207a 6f6e 6573 0a20  r supply zones. 
+00008f40: 2020 2023 2020 2020 202d 2073 7570 706c     #     - suppl
+00008f50: 795f 6469 7374 616c 5f6c 696e 6573 3a20  y_distal_lines: 
+00008f60: 4c69 7374 206f 6620 6469 7374 616c 206c  List of distal l
+00008f70: 696e 6520 7072 6963 6573 2066 6f72 2073  ine prices for s
+00008f80: 7570 706c 7920 7a6f 6e65 730a 2020 2020  upply zones.    
+00008f90: 2020 2020 0a20 2020 2023 2020 2020 2052      .    #     R
+00008fa0: 6574 7572 6e73 3a0a 2020 2020 2320 2020  eturns:.    #   
+00008fb0: 2020 2d20 4c69 7374 206f 6620 7261 6e67    - List of rang
+00008fc0: 6573 2063 6f72 7265 7370 6f6e 6469 6e67  es corresponding
+00008fd0: 2074 6f20 6561 6368 2073 7570 706c 7920   to each supply 
+00008fe0: 7a6f 6e65 0a20 2020 2023 2020 2020 2022  zone.    #     "
+00008ff0: 2222 0a20 2020 2023 2020 2020 2073 7570  "".    #     sup
+00009000: 706c 795f 7a6f 6e65 5f72 616e 6765 7320  ply_zone_ranges 
+00009010: 3d20 5b5d 0a20 2020 2023 2020 2020 2066  = [].    #     f
+00009020: 6f72 2069 2c20 2873 7461 7274 2c20 656e  or i, (start, en
+00009030: 642c 205f 2c20 5f29 2069 6e20 656e 756d  d, _, _) in enum
+00009040: 6572 6174 6528 7375 7070 6c79 5f7a 6f6e  erate(supply_zon
+00009050: 6573 293a 0a20 2020 2023 2020 2020 2020  es):.    #      
+00009060: 2020 2072 616e 6765 5f6f 665f 7a6f 6e65     range_of_zone
+00009070: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
+00009080: 655f 7a6f 6e65 5f72 616e 6765 2873 7570  e_zone_range(sup
+00009090: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
+000090a0: 6573 5b69 5d2c 2073 7570 706c 795f 6469  es[i], supply_di
+000090b0: 7374 616c 5f6c 696e 6573 5b69 5d29 0a20  stal_lines[i]). 
+000090c0: 2020 2023 2020 2020 2020 2020 2073 7570     #         sup
+000090d0: 706c 795f 7a6f 6e65 5f72 616e 6765 732e  ply_zone_ranges.
+000090e0: 6170 7065 6e64 2872 616e 6765 5f6f 665f  append(range_of_
+000090f0: 7a6f 6e65 290a 2020 2020 2320 2020 2020  zone).    #     
+00009100: 7265 7475 726e 2073 7570 706c 795f 7a6f  return supply_zo
+00009110: 6e65 5f72 616e 6765 730a 0a20 2020 2023  ne_ranges..    #
+00009120: 2064 6566 2066 696c 7465 725f 7374 6f63   def filter_stoc
+00009130: 6b73 5f62 795f 6469 7374 616e 6365 2873  ks_by_distance(s
+00009140: 656c 662c 6461 7461 2c73 796d 626f 6c5f  elf,data,symbol_
+00009150: 6c69 7374 2c20 7468 7265 7368 6f6c 645f  list, threshold_
+00009160: 7065 7263 656e 742c 2074 696d 6566 7261  percent, timefra
+00009170: 6d65 293a 0a20 2020 2023 2020 2020 2066  me):.    #     f
+00009180: 696c 7465 7265 645f 7374 6f63 6b73 203d  iltered_stocks =
+00009190: 205b 5d0a 2020 2020 2320 2020 2020 666f   [].    #     fo
+000091a0: 7220 7379 6d62 6f6c 2069 6e20 7379 6d62  r symbol in symb
+000091b0: 6f6c 5f6c 6973 743a 0a20 2020 2023 2020  ol_list:.    #  
+000091c0: 2020 2020 2020 2069 6620 6461 7461 2069         if data i
+000091d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000091e0: 2320 2020 2020 2020 2020 2020 2020 636d  #             cm
+000091f0: 7020 3d20 6461 7461 2e69 6c6f 635b 2d31  p = data.iloc[-1
+00009200: 5d5b 2743 6c6f 7365 275d 2020 2320 4375  ]['Close']  # Cu
+00009210: 7272 656e 7420 6d61 726b 6574 2070 7269  rrent market pri
+00009220: 6365 0a20 2020 2023 2020 2020 2020 2020  ce.    #        
+00009230: 2020 2020 2064 656d 616e 645f 7a6f 6e65       demand_zone
+00009240: 732c 205f 2c20 5f2c 2064 656d 616e 645f  s, _, _, demand_
+00009250: 7072 6f78 696d 616c 5f6c 696e 6520 3d20  proximal_line = 
+00009260: 7365 6c66 2e69 6465 6e74 6966 795f 6465  self.identify_de
+00009270: 6d61 6e64 5f7a 6f6e 6528 6461 7461 2c20  mand_zone(data, 
+00009280: 636d 7029 2020 2320 5061 7373 2063 6d70  cmp)  # Pass cmp
+00009290: 2061 7267 756d 656e 7420 6865 7265 0a20   argument here. 
+000092a0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+000092b0: 2073 7570 706c 795f 7a6f 6e65 732c 205f   supply_zones, _
+000092c0: 2c20 5f2c 2073 7570 706c 795f 7072 6f78  , _, supply_prox
+000092d0: 696d 616c 5f6c 696e 6520 3d20 7365 6c66  imal_line = self
+000092e0: 2e69 6465 6e74 6966 795f 7375 7070 6c79  .identify_supply
+000092f0: 5f7a 6f6e 6528 6461 7461 2c20 636d 7029  _zone(data, cmp)
+00009300: 2020 2320 5061 7373 2063 6d70 2061 7267    # Pass cmp arg
+00009310: 756d 656e 7420 6865 7265 0a20 2020 2020  ument here.     
+00009320: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00009330: 2320 2020 2020 2020 2020 2020 2020 2320  #             # 
+00009340: 4368 6563 6b20 6966 2065 6974 6865 7220  Check if either 
+00009350: 6465 6d61 6e64 206f 7220 7375 7070 6c79  demand or supply
+00009360: 207a 6f6e 6573 2065 7869 7374 2066 6f72   zones exist for
+00009370: 2074 6865 2073 746f 636b 0a20 2020 2023   the stock.    #
+00009380: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009390: 6465 6d61 6e64 5f7a 6f6e 6573 206f 7220  demand_zones or 
+000093a0: 7375 7070 6c79 5f7a 6f6e 6573 3a0a 2020  supply_zones:.  
+000093b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+000093c0: 2020 2020 6669 6c74 6572 6564 5f73 746f      filtered_sto
+000093d0: 636b 732e 6170 7065 6e64 2873 796d 626f  cks.append(symbo
+000093e0: 6c29 0a0a 2020 2020 2320 2020 2020 7265  l)..    #     re
+000093f0: 7475 726e 2066 696c 7465 7265 645f 7374  turn filtered_st
+00009400: 6f63 6b73 0a20 2020 200a 2020 2020 2320  ocks.    .    # 
+00009410: 6465 6620 6669 6e64 4465 6d61 6e64 5375  def findDemandSu
+00009420: 7070 6c79 5a6f 6e65 7328 7365 6c66 2c64  pplyZones(self,d
+00009430: 6174 612c 7468 7265 7368 6f6c 645f 7065  ata,threshold_pe
+00009440: 7263 656e 743d 3129 3a20 2020 2020 2020  rcent=1):       
+00009450: 200a 2020 2020 2320 2020 2020 2320 496e   .    #     # In
+00009460: 6974 6961 6c69 7a65 2063 6f75 6e74 2066  itialize count f
+00009470: 6f72 2066 696c 7465 7265 6420 7374 6f63  or filtered stoc
+00009480: 6b73 0a20 2020 2023 2020 2020 2063 6f75  ks.    #     cou
+00009490: 6e74 5f66 696c 7465 7265 645f 7374 6f63  nt_filtered_stoc
+000094a0: 6b73 203d 2030 0a0a 2020 2020 2320 2020  ks = 0..    #   
+000094b0: 2020 2320 416e 616c 797a 6520 6465 6d61    # Analyze dema
+000094c0: 6e64 2061 6e64 2073 7570 706c 7920 7a6f  nd and supply zo
+000094d0: 6e65 7320 666f 7220 6561 6368 2073 746f  nes for each sto
+000094e0: 636b 2061 6e64 2073 6176 6520 7265 7375  ck and save resu
+000094f0: 6c74 7320 696e 2061 2066 696c 650a 2020  lts in a file.  
+00009500: 2020 2320 2020 2020 7769 7468 206f 7065    #     with ope
+00009510: 6e28 2264 656d 616e 645f 7375 7070 6c79  n("demand_supply
+00009520: 5f7a 6f6e 6573 2e74 7874 222c 2022 7722  _zones.txt", "w"
+00009530: 2920 6173 2066 696c 653a 0a20 2020 2023  ) as file:.    #
+00009540: 2020 2020 2020 2020 2066 6f72 2073 796d           for sym
+00009550: 626f 6c20 696e 2064 6174 615b 2253 746f  bol in data["Sto
+00009560: 636b 225d 3a0a 2020 2020 2320 2020 2020  ck"]:.    #     
+00009570: 2020 2020 2020 2020 6966 2064 6174 6120          if data 
+00009580: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00009590: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+000095a0: 2020 2063 6d70 203d 2064 6174 612e 696c     cmp = data.il
+000095b0: 6f63 5b2d 315d 5b27 436c 6f73 6527 5d20  oc[-1]['Close'] 
+000095c0: 2023 2043 7572 7265 6e74 206d 6172 6b65   # Current marke
+000095d0: 7420 7072 6963 650a 2020 2020 2320 2020  t price.    #   
+000095e0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+000095f0: 6d61 6e64 5f7a 6f6e 6573 2c20 5f2c 205f  mand_zones, _, _
+00009600: 2c20 6465 6d61 6e64 5f70 726f 7869 6d61  , demand_proxima
+00009610: 6c5f 6c69 6e65 203d 2073 656c 662e 6964  l_line = self.id
+00009620: 656e 7469 6679 5f64 656d 616e 645f 7a6f  entify_demand_zo
+00009630: 6e65 2864 6174 612c 2063 6d70 290a 2020  ne(data, cmp).  
+00009640: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00009650: 2020 2020 7375 7070 6c79 5f7a 6f6e 6573      supply_zones
+00009660: 2c20 5f2c 205f 2c20 7375 7070 6c79 5f70  , _, _, supply_p
+00009670: 726f 7869 6d61 6c5f 6c69 6e65 203d 2073  roximal_line = s
+00009680: 656c 662e 6964 656e 7469 6679 5f73 7570  elf.identify_sup
+00009690: 706c 795f 7a6f 6e65 2864 6174 612c 2063  ply_zone(data, c
+000096a0: 6d70 290a 0a20 2020 2023 2020 2020 2020  mp)..    #      
+000096b0: 2020 2020 2020 2020 2020 2023 2053 7465             # Ste
+000096c0: 7020 313a 2043 616c 6375 6c61 7465 2070  p 1: Calculate p
+000096d0: 726f 7869 6d61 6c20 6c69 6e65 7320 666f  roximal lines fo
+000096e0: 7220 6465 6d61 6e64 2061 6e64 2073 7570  r demand and sup
+000096f0: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
+00009700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009710: 6465 6d61 6e64 5f70 726f 7869 6d61 6c5f  demand_proximal_
+00009720: 6c69 6e65 7320 3d20 7365 6c66 2e63 616c  lines = self.cal
+00009730: 6375 6c61 7465 5f64 656d 616e 645f 7072  culate_demand_pr
+00009740: 6f78 696d 616c 5f6c 696e 6573 2864 6174  oximal_lines(dat
+00009750: 612c 2064 656d 616e 645f 7a6f 6e65 7329  a, demand_zones)
+00009760: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009770: 2020 2020 2020 2073 7570 706c 795f 7072         supply_pr
+00009780: 6f78 696d 616c 5f6c 696e 6573 203d 2073  oximal_lines = s
+00009790: 656c 662e 6361 6c63 756c 6174 655f 7375  elf.calculate_su
+000097a0: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+000097b0: 6e65 7328 6461 7461 2c20 7375 7070 6c79  nes(data, supply
+000097c0: 5f7a 6f6e 6573 290a 2020 2020 2020 2020  _zones).        
+000097d0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000097e0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+000097f0: 2020 2023 2053 7465 7020 323a 2043 616c     # Step 2: Cal
+00009800: 6375 6c61 7465 2064 6973 7461 6c20 6c69  culate distal li
+00009810: 6e65 7320 666f 7220 6465 6d61 6e64 207a  nes for demand z
+00009820: 6f6e 6573 2061 6e64 2073 7570 706c 7920  ones and supply 
+00009830: 7a6f 6e65 730a 2020 2020 2320 2020 2020  zones.    #     
+00009840: 2020 2020 2020 2020 2020 2020 6465 6d61              dema
+00009850: 6e64 5f64 6973 7461 6c5f 6c69 6e65 7320  nd_distal_lines 
+00009860: 3d20 7365 6c66 2e63 616c 6375 6c61 7465  = self.calculate
+00009870: 5f64 656d 616e 645f 6469 7374 616c 5f6c  _demand_distal_l
+00009880: 696e 6573 2864 6174 612c 2064 656d 616e  ines(data, deman
+00009890: 645f 7a6f 6e65 7329 0a20 2020 2023 2020  d_zones).    #  
+000098a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000098b0: 7570 706c 795f 6469 7374 616c 5f6c 696e  upply_distal_lin
+000098c0: 6573 203d 2073 656c 662e 6361 6c63 756c  es = self.calcul
+000098d0: 6174 655f 7375 7070 6c79 5f64 6973 7461  ate_supply_dista
+000098e0: 6c5f 6c69 6e65 7328 6461 7461 2c20 7375  l_lines(data, su
+000098f0: 7070 6c79 5f7a 6f6e 6573 290a 0a20 2020  pply_zones)..   
+00009900: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009910: 2020 2023 2043 616c 6375 6c61 7465 2072     # Calculate r
+00009920: 616e 6765 206f 6620 6465 6d61 6e64 2061  ange of demand a
+00009930: 6e64 2073 7570 706c 7920 7a6f 6e65 730a  nd supply zones.
+00009940: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009950: 2020 2020 2020 6465 6d61 6e64 5f7a 6f6e        demand_zon
+00009960: 655f 7261 6e67 6573 203d 2073 656c 662e  e_ranges = self.
+00009970: 6361 6c63 756c 6174 655f 6465 6d61 6e64  calculate_demand
+00009980: 5f7a 6f6e 655f 7261 6e67 6573 2864 656d  _zone_ranges(dem
+00009990: 616e 645f 7a6f 6e65 732c 2064 656d 616e  and_zones, deman
+000099a0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+000099b0: 2c20 6465 6d61 6e64 5f64 6973 7461 6c5f  , demand_distal_
+000099c0: 6c69 6e65 7329 0a20 2020 2023 2020 2020  lines).    #    
+000099d0: 2020 2020 2020 2020 2020 2020 2073 7570               sup
+000099e0: 706c 795f 7a6f 6e65 5f72 616e 6765 7320  ply_zone_ranges 
+000099f0: 3d20 7365 6c66 2e63 616c 6375 6c61 7465  = self.calculate
+00009a00: 5f73 7570 706c 795f 7a6f 6e65 5f72 616e  _supply_zone_ran
+00009a10: 6765 7328 7375 7070 6c79 5f7a 6f6e 6573  ges(supply_zones
+00009a20: 2c20 7375 7070 6c79 5f70 726f 7869 6d61  , supply_proxima
+00009a30: 6c5f 6c69 6e65 732c 2073 7570 706c 795f  l_lines, supply_
+00009a40: 6469 7374 616c 5f6c 696e 6573 290a 2020  distal_lines).  
+00009a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a60: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
+00009a70: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00009a80: 6974 6528 6622 5c6e 5c6e 416e 616c 7973  ite(f"\n\nAnalys
+00009a90: 6973 2066 6f72 207b 7379 6d62 6f6c 7d20  is for {symbol} 
+00009aa0: 287b 7469 6d65 6672 616d 657d 293a 2229  ({timeframe}):")
+00009ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009ac0: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
+00009ad0: 2020 2020 2020 2020 2020 2020 2320 4465              # De
+00009ae0: 6d61 6e64 205a 6f6e 6573 0a20 2020 2023  mand Zones.    #
 00009af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b00: 2020 2020 2020 2020 2069 6620 6465 6d61           if dema
-00009b10: 6e64 5f64 6973 7461 6c5f 6c69 6e65 733a  nd_distal_lines:
-00009b20: 2020 2320 496e 636c 7564 6520 6469 7374    # Include dist
-00009b30: 616c 206c 696e 6520 7072 6963 6520 6966  al line price if
-00009b40: 2061 7661 696c 6162 6c65 0a20 2020 2023   available.    #
-00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b60: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00009b70: 652e 7772 6974 6528 6622 5c6e 4469 7374  e.write(f"\nDist
-00009b80: 616c 204c 696e 6520 5072 6963 653a 207b  al Line Price: {
-00009b90: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-00009ba0: 6e65 735b 695d 3a2e 3266 7d22 290a 2020  nes[i]:.2f}").  
-00009bb0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009bc0: 2020 2020 2020 2020 2020 2020 2320 496e              # In
-00009bd0: 636c 7564 6520 7a6f 6e65 2072 616e 6765  clude zone range
-00009be0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-00009c10: 5c6e 5a6f 6e65 2052 616e 6765 3a20 7b64  \nZone Range: {d
-00009c20: 656d 616e 645f 7a6f 6e65 5f72 616e 6765  emand_zone_range
-00009c30: 735b 695d 3a2e 3266 7d22 2920 2020 2020  s[i]:.2f}")     
-00009c40: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 2023 2043 6865 636b 2069 6620 7072 6f78   # Check if prox
-00009c70: 696d 616c 206c 696e 6520 6973 2074 6573  imal line is tes
-00009c80: 7465 640a 2020 2020 2320 2020 2020 2020  ted.    #       
-00009c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ca0: 2020 7465 7374 6564 203d 2073 656c 662e    tested = self.
-00009cb0: 6973 5f7a 6f6e 655f 7465 7374 6564 2864  is_zone_tested(d
-00009cc0: 6174 612c 2073 7461 7274 2c20 656e 642c  ata, start, end,
-00009cd0: 2064 656d 616e 645f 7072 6f78 696d 616c   demand_proximal
-00009ce0: 5f6c 696e 6573 5b69 5d29 0a20 2020 2023  _lines[i]).    #
-00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d00: 2020 2020 2020 2020 2069 6620 7465 7374           if test
-00009d10: 6564 3a0a 2020 2020 2320 2020 2020 2020  ed:.    #       
-00009d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d30: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-00009d40: 2822 5c6e 5a6f 6e65 2069 7320 5465 7374  ("\nZone is Test
-00009d50: 6564 2229 0a20 2020 2023 2020 2020 2020  ed").    #      
-00009d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d70: 2020 2065 6c73 653a 0a20 2020 2023 2020     else:.    #  
+00009b00: 2066 696c 652e 7772 6974 6528 225c 6e5c   file.write("\n\
+00009b10: 6e44 656d 616e 6420 5a6f 6e65 733a 2229  nDemand Zones:")
+00009b20: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009b30: 2020 2020 2020 2069 6620 6465 6d61 6e64         if demand
+00009b40: 5f7a 6f6e 6573 3a20 2023 2043 6865 636b  _zones:  # Check
+00009b50: 2069 6620 6465 6d61 6e64 5f7a 6f6e 6573   if demand_zones
+00009b60: 2069 7320 6e6f 7420 656d 7074 790a 2020   is not empty.  
+00009b70: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00009b80: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
+00009b90: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
+00009ba0: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
+00009bb0: 2069 6e20 656e 756d 6572 6174 6528 6465   in enumerate(de
+00009bc0: 6d61 6e64 5f7a 6f6e 6573 293a 0a20 2020  mand_zones):.   
+00009bd0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009be0: 2020 2020 2020 2020 2020 2064 6973 745f             dist_
+00009bf0: 6672 6f6d 5f63 6d70 203d 2061 6273 2828  from_cmp = abs((
+00009c00: 636d 7020 2d20 6465 6d61 6e64 5f70 726f  cmp - demand_pro
+00009c10: 7869 6d61 6c5f 6c69 6e65 735b 695d 2920  ximal_lines[i]) 
+00009c20: 2f20 636d 7029 202a 2031 3030 0a20 2020  / cmp) * 100.   
+00009c30: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009c40: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+00009c50: 7772 6974 6528 6622 5c6e 5c6e 5a6f 6e65  write(f"\n\nZone
+00009c60: 207b 692b 317d 3a20 5374 6172 7420 4461   {i+1}: Start Da
+00009c70: 7465 3a20 7b64 6174 612e 696e 6465 785b  te: {data.index[
+00009c80: 7374 6172 745d 2e64 6174 6528 297d 2c20  start].date()}, 
+00009c90: 456e 6420 4461 7465 3a20 7b64 6174 612e  End Date: {data.
+00009ca0: 696e 6465 785b 656e 645d 2e64 6174 6528  index[end].date(
+00009cb0: 297d 2229 0a20 2020 2023 2020 2020 2020  )}").    #      
+00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cd0: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+00009ce0: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
+00009cf0: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
+00009d00: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
+00009d10: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
+00009d20: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+00009d30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009d40: 696c 652e 7772 6974 6528 6622 5c6e 4469  ile.write(f"\nDi
+00009d50: 7374 616e 6365 2066 726f 6d20 434d 503a  stance from CMP:
+00009d60: 207b 6469 7374 5f66 726f 6d5f 636d 703a   {dist_from_cmp:
+00009d70: 2e32 667d 2522 290a 2020 2020 2320 2020  .2f}%").    #   
 00009d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d90: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-00009da0: 7772 6974 6528 225c 6e46 7265 7368 205a  write("\nFresh Z
-00009db0: 6f6e 6522 290a 2020 2020 2320 2020 2020  one").    #     
-00009dc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00009dd0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-00009de0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00009df0: 2e77 7269 7465 2822 5c6e 4e6f 2064 656d  .write("\nNo dem
-00009e00: 616e 6420 7a6f 6e65 2070 6174 7465 726e  and zone pattern
-00009e10: 7320 666f 756e 642e 2229 0a0a 2020 2020  s found.")..    
-00009e20: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009e30: 2020 2320 5375 7070 6c79 205a 6f6e 6573    # Supply Zones
-00009e40: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-00009e50: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-00009e60: 6528 225c 6e5c 6e53 7570 706c 7920 5a6f  e("\n\nSupply Zo
-00009e70: 6e65 733a 2229 0a20 2020 2023 2020 2020  nes:").    #    
-00009e80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009e90: 7375 7070 6c79 5f7a 6f6e 6573 3a20 2023  supply_zones:  #
-00009ea0: 2043 6865 636b 2069 6620 7375 7070 6c79   Check if supply
-00009eb0: 5f7a 6f6e 6573 2069 7320 6e6f 7420 656d  _zones is not em
-00009ec0: 7074 790a 2020 2020 2320 2020 2020 2020  pty.    #       
-00009ed0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00009ee0: 7220 692c 2028 7374 6172 742c 2065 6e64  r i, (start, end
-00009ef0: 2c20 7061 7474 6572 6e2c 2062 6173 655f  , pattern, base_
-00009f00: 636f 756e 7429 2069 6e20 656e 756d 6572  count) in enumer
-00009f10: 6174 6528 7375 7070 6c79 5f7a 6f6e 6573  ate(supply_zones
-00009f20: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
-00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f40: 2064 6973 745f 6672 6f6d 5f63 6d70 203d   dist_from_cmp =
-00009f50: 2061 6273 2828 636d 7020 2d20 7375 7070   abs((cmp - supp
-00009f60: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
-00009f70: 735b 695d 2920 2f20 636d 7029 202a 2031  s[i]) / cmp) * 1
-00009f80: 3030 0a20 2020 2023 2020 2020 2020 2020  00.    #        
-00009f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fa0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-00009fb0: 5c6e 5a6f 6e65 207b 692b 317d 3a20 5374  \nZone {i+1}: St
-00009fc0: 6172 7420 4461 7465 3a20 7b64 6174 612e  art Date: {data.
-00009fd0: 696e 6465 785b 7374 6172 745d 2e64 6174  index[start].dat
-00009fe0: 6528 297d 2c20 456e 6420 4461 7465 3a20  e()}, End Date: 
-00009ff0: 7b64 6174 612e 696e 6465 785b 656e 645d  {data.index[end]
-0000a000: 2e64 6174 6528 297d 2229 0a20 2020 2023  .date()}").    #
-0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a020: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000a030: 6974 6528 6622 5c6e 5061 7474 6572 6e20  ite(f"\nPattern 
-0000a040: 4e61 6d65 3a20 7b70 6174 7465 726e 7d2c  Name: {pattern},
-0000a050: 204e 756d 6265 7220 6f66 2042 6173 6520   Number of Base 
-0000a060: 4361 6e64 6c65 3a20 7b62 6173 655f 636f  Candle: {base_co
-0000a070: 756e 747d 2229 0a20 2020 2023 2020 2020  unt}").    #    
-0000a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a090: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-0000a0a0: 6622 5c6e 4469 7374 616e 6365 2066 726f  f"\nDistance fro
-0000a0b0: 6d20 434d 503a 207b 6469 7374 5f66 726f  m CMP: {dist_fro
-0000a0c0: 6d5f 636d 703a 2e32 667d 2522 290a 2020  m_cmp:.2f}%").  
-0000a0d0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000a0e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000a0f0: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
-0000a100: 696e 6573 3a0a 2020 2020 2320 2020 2020  ines:.    #     
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
-0000a130: 7465 2866 225c 6e50 726f 7869 6d61 6c20  te(f"\nProximal 
-0000a140: 4c69 6e65 2050 7269 6365 3a20 7b73 7570  Line Price: {sup
-0000a150: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
-0000a160: 6573 5b69 5d3a 2e32 667d 2229 0a20 2020  es[i]:.2f}").   
+00009d90: 2020 2020 2020 6966 2064 656d 616e 645f        if demand_
+00009da0: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
+00009db0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dd0: 2020 6669 6c65 2e77 7269 7465 2866 225c    file.write(f"\
+00009de0: 6e50 726f 7869 6d61 6c20 4c69 6e65 2050  nProximal Line P
+00009df0: 7269 6365 3a20 7b64 656d 616e 645f 7072  rice: {demand_pr
+00009e00: 6f78 696d 616c 5f6c 696e 6573 5b69 5d3a  oximal_lines[i]:
+00009e10: 2e32 667d 2229 0a20 2020 2023 2020 2020  .2f}").    #    
+00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e30: 2020 2020 2069 6620 6465 6d61 6e64 5f64       if demand_d
+00009e40: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
+00009e50: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
+00009e60: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
+00009e70: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
+00009e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e90: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+00009ea0: 6974 6528 6622 5c6e 4469 7374 616c 204c  ite(f"\nDistal L
+00009eb0: 696e 6520 5072 6963 653a 207b 6465 6d61  ine Price: {dema
+00009ec0: 6e64 5f64 6973 7461 6c5f 6c69 6e65 735b  nd_distal_lines[
+00009ed0: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
+00009ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ef0: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
+00009f00: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
+00009f10: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00009f20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009f30: 696c 652e 7772 6974 6528 6622 5c6e 5a6f  ile.write(f"\nZo
+00009f40: 6e65 2052 616e 6765 3a20 7b64 656d 616e  ne Range: {deman
+00009f50: 645f 7a6f 6e65 5f72 616e 6765 735b 695d  d_zone_ranges[i]
+00009f60: 3a2e 3266 7d22 2920 2020 2020 2020 0a20  :.2f}")       . 
+00009f70: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00009f80: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00009f90: 6865 636b 2069 6620 7072 6f78 696d 616c  heck if proximal
+00009fa0: 206c 696e 6520 6973 2074 6573 7465 640a   line is tested.
+00009fb0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00009fc0: 2020 2020 2020 2020 2020 2020 2020 7465                te
+00009fd0: 7374 6564 203d 2073 656c 662e 6973 5f7a  sted = self.is_z
+00009fe0: 6f6e 655f 7465 7374 6564 2864 6174 612c  one_tested(data,
+00009ff0: 2073 7461 7274 2c20 656e 642c 2064 656d   start, end, dem
+0000a000: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
+0000a010: 6573 5b69 5d29 0a20 2020 2023 2020 2020  es[i]).    #    
+0000a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a030: 2020 2020 2069 6620 7465 7374 6564 3a0a       if tested:.
+0000a040: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a060: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
+0000a070: 5a6f 6e65 2069 7320 5465 7374 6564 2229  Zone is Tested")
+0000a080: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000a090: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a0a0: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+0000a0d0: 6528 225c 6e46 7265 7368 205a 6f6e 6522  e("\nFresh Zone"
+0000a0e0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000a0f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a100: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a110: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a120: 7465 2822 5c6e 4e6f 2064 656d 616e 6420  te("\nNo demand 
+0000a130: 7a6f 6e65 2070 6174 7465 726e 7320 666f  zone patterns fo
+0000a140: 756e 642e 2229 0a0a 2020 2020 2320 2020  und.")..    #   
+0000a150: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a160: 5375 7070 6c79 205a 6f6e 6573 0a20 2020  Supply Zones.   
 0000a170: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a180: 2020 2020 2020 2020 2020 2069 6620 7375             if su
-0000a190: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
-0000a1a0: 733a 2020 2320 496e 636c 7564 6520 6469  s:  # Include di
-0000a1b0: 7374 616c 206c 696e 6520 7072 6963 6520  stal line price 
-0000a1c0: 6966 2061 7661 696c 6162 6c65 0a20 2020  if available.   
-0000a1d0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000a1e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a1f0: 696c 652e 7772 6974 6528 6622 5c6e 4469  ile.write(f"\nDi
-0000a200: 7374 616c 204c 696e 6520 5072 6963 653a  stal Line Price:
-0000a210: 207b 7375 7070 6c79 5f64 6973 7461 6c5f   {supply_distal_
-0000a220: 6c69 6e65 735b 695d 3a2e 3266 7d22 290a  lines[i]:.2f}").
-0000a230: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a240: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a250: 496e 636c 7564 6520 7a6f 6e65 2072 616e  Include zone ran
-0000a260: 6765 0a20 2020 2023 2020 2020 2020 2020  ge.    #        
-0000a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a280: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
-0000a290: 6622 5c6e 5a6f 6e65 2052 616e 6765 3a20  f"\nZone Range: 
-0000a2a0: 7b73 7570 706c 795f 7a6f 6e65 5f72 616e  {supply_zone_ran
-0000a2b0: 6765 735b 695d 3a2e 3266 7d22 290a 2020  ges[i]:.2f}").  
-0000a2c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000a2d0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0000a2e0: 6563 6b20 6966 2070 726f 7869 6d61 6c20  eck if proximal 
-0000a2f0: 6c69 6e65 2069 7320 7465 7374 6564 0a20  line is tested. 
-0000a300: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000a310: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-0000a320: 7465 6420 3d20 6973 5f7a 6f6e 655f 7465  ted = is_zone_te
-0000a330: 7374 6564 2864 6174 612c 2073 7461 7274  sted(data, start
-0000a340: 2c20 656e 642c 2073 7570 706c 795f 7072  , end, supply_pr
-0000a350: 6f78 696d 616c 5f6c 696e 6573 5b69 5d29  oximal_lines[i])
-0000a360: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000a370: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a380: 6620 7465 7374 6564 3a0a 2020 2020 2320  f tested:.    # 
-0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3a0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000a3b0: 2e77 7269 7465 2822 5c6e 5a6f 6e65 2069  .write("\nZone i
-0000a3c0: 7320 5465 7374 6564 2229 0a20 2020 2023  s Tested").    #
-0000a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000a3f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a180: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
+0000a190: 6e5c 6e53 7570 706c 7920 5a6f 6e65 733a  n\nSupply Zones:
+0000a1a0: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000a1b0: 2020 2020 2020 2020 2069 6620 7375 7070           if supp
+0000a1c0: 6c79 5f7a 6f6e 6573 3a20 2023 2043 6865  ly_zones:  # Che
+0000a1d0: 636b 2069 6620 7375 7070 6c79 5f7a 6f6e  ck if supply_zon
+0000a1e0: 6573 2069 7320 6e6f 7420 656d 7074 790a  es is not empty.
+0000a1f0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000a200: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0000a210: 2028 7374 6172 742c 2065 6e64 2c20 7061   (start, end, pa
+0000a220: 7474 6572 6e2c 2062 6173 655f 636f 756e  ttern, base_coun
+0000a230: 7429 2069 6e20 656e 756d 6572 6174 6528  t) in enumerate(
+0000a240: 7375 7070 6c79 5f7a 6f6e 6573 293a 0a20  supply_zones):. 
+0000a250: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a260: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+0000a270: 745f 6672 6f6d 5f63 6d70 203d 2061 6273  t_from_cmp = abs
+0000a280: 2828 636d 7020 2d20 7375 7070 6c79 5f70  ((cmp - supply_p
+0000a290: 726f 7869 6d61 6c5f 6c69 6e65 735b 695d  roximal_lines[i]
+0000a2a0: 2920 2f20 636d 7029 202a 2031 3030 0a20  ) / cmp) * 100. 
+0000a2b0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a2c0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a2d0: 652e 7772 6974 6528 6622 5c6e 5c6e 5a6f  e.write(f"\n\nZo
+0000a2e0: 6e65 207b 692b 317d 3a20 5374 6172 7420  ne {i+1}: Start 
+0000a2f0: 4461 7465 3a20 7b64 6174 612e 696e 6465  Date: {data.inde
+0000a300: 785b 7374 6172 745d 2e64 6174 6528 297d  x[start].date()}
+0000a310: 2c20 456e 6420 4461 7465 3a20 7b64 6174  , End Date: {dat
+0000a320: 612e 696e 6465 785b 656e 645d 2e64 6174  a.index[end].dat
+0000a330: 6528 297d 2229 0a20 2020 2023 2020 2020  e()}").    #    
+0000a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a350: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000a360: 6622 5c6e 5061 7474 6572 6e20 4e61 6d65  f"\nPattern Name
+0000a370: 3a20 7b70 6174 7465 726e 7d2c 204e 756d  : {pattern}, Num
+0000a380: 6265 7220 6f66 2042 6173 6520 4361 6e64  ber of Base Cand
+0000a390: 6c65 3a20 7b62 6173 655f 636f 756e 747d  le: {base_count}
+0000a3a0: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3c0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
+0000a3d0: 4469 7374 616e 6365 2066 726f 6d20 434d  Distance from CM
+0000a3e0: 503a 207b 6469 7374 5f66 726f 6d5f 636d  P: {dist_from_cm
+0000a3f0: 703a 2e32 667d 2522 290a 2020 2020 2320  p:.2f}%").    # 
 0000a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a410: 2066 696c 652e 7772 6974 6528 225c 6e46   file.write("\nF
-0000a420: 7265 7368 205a 6f6e 6522 290a 2020 2020  resh Zone").    
-0000a430: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000a440: 2020 656c 7365 3a0a 2020 2020 2320 2020    else:.    #   
-0000a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a460: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
-0000a470: 4e6f 2073 7570 706c 7920 7a6f 6e65 2070  No supply zone p
-0000a480: 6174 7465 726e 7320 666f 756e 642e 2229  atterns found.")
-0000a490: 0a0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000a4a0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-0000a4b0: 6966 2074 6865 2073 746f 636b 2068 6173  if the stock has
-0000a4c0: 2065 6974 6865 7220 6465 6d61 6e64 206f   either demand o
-0000a4d0: 7220 7375 7070 6c79 207a 6f6e 6520 7769  r supply zone wi
-0000a4e0: 7468 696e 2074 6865 2074 6872 6573 686f  thin the thresho
-0000a4f0: 6c64 0a20 2020 2023 2020 2020 2020 2020  ld.    #        
-0000a500: 2020 2020 2020 2020 2068 6173 5f64 656d           has_dem
-0000a510: 616e 645f 6f72 5f73 7570 706c 795f 7769  and_or_supply_wi
-0000a520: 7468 696e 5f74 6872 6573 686f 6c64 203d  thin_threshold =
-0000a530: 2061 6e79 280a 2020 2020 2320 2020 2020   any(.    #     
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a550: 6162 7328 2863 6d70 202d 2070 7269 6365  abs((cmp - price
-0000a560: 2920 2f20 636d 7029 202a 2031 3030 203c  ) / cmp) * 100 <
-0000a570: 3d20 7468 7265 7368 6f6c 645f 7065 7263  = threshold_perc
-0000a580: 656e 740a 2020 2020 2320 2020 2020 2020  ent.    #       
-0000a590: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000a5a0: 7220 7072 6963 6520 696e 2064 656d 616e  r price in deman
-0000a5b0: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
-0000a5c0: 202b 2073 7570 706c 795f 7072 6f78 696d   + supply_proxim
-0000a5d0: 616c 5f6c 696e 6573 0a20 2020 2023 2020  al_lines.    #  
-0000a5e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000a5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a600: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-0000a610: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-0000a620: 2074 6865 2073 746f 636b 2068 6173 2064   the stock has d
-0000a630: 656d 616e 6420 6f72 2073 7570 706c 7920  emand or supply 
-0000a640: 7a6f 6e65 2077 6974 6869 6e20 7468 6520  zone within the 
-0000a650: 7468 7265 7368 6f6c 642c 2069 6e63 7265  threshold, incre
-0000a660: 6d65 6e74 2074 6865 2063 6f75 6e74 0a20  ment the count. 
-0000a670: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000a680: 2020 2020 2069 6620 6861 735f 6465 6d61       if has_dema
-0000a690: 6e64 5f6f 725f 7375 7070 6c79 5f77 6974  nd_or_supply_wit
-0000a6a0: 6869 6e5f 7468 7265 7368 6f6c 643a 0a20  hin_threshold:. 
-0000a6b0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000a6c0: 2020 2020 2020 2020 2063 6f75 6e74 5f66           count_f
-0000a6d0: 696c 7465 7265 645f 7374 6f63 6b73 202b  iltered_stocks +
-0000a6e0: 3d20 310a 0a20 2020 2023 2020 2020 2023  = 1..    #     #
-0000a6f0: 2046 696c 7465 7220 7374 6f63 6b73 2062   Filter stocks b
-0000a700: 6173 6564 206f 6e20 7468 6520 7065 7263  ased on the perc
-0000a710: 656e 7461 6765 2074 6872 6573 686f 6c64  entage threshold
-0000a720: 2061 6e64 2073 6176 6520 7468 6520 7265   and save the re
-0000a730: 7375 6c74 7320 696e 2061 6e6f 7468 6572  sults in another
-0000a740: 2066 696c 650a 2020 2020 2320 2020 2020   file.    #     
-0000a750: 6669 6c74 6572 6564 5f73 746f 636b 7320  filtered_stocks 
-0000a760: 3d20 7365 6c66 2e66 696c 7465 725f 7374  = self.filter_st
-0000a770: 6f63 6b73 5f62 795f 6469 7374 616e 6365  ocks_by_distance
-0000a780: 2873 746f 636b 5f73 796d 626f 6c73 2c20  (stock_symbols, 
-0000a790: 7468 7265 7368 6f6c 645f 7065 7263 656e  threshold_percen
-0000a7a0: 742c 2074 696d 6566 7261 6d65 290a 0a20  t, timeframe).. 
-0000a7b0: 2020 2023 2020 2020 2077 6974 6820 6f70     #     with op
-0000a7c0: 656e 2822 6669 6c74 6572 6564 5f73 746f  en("filtered_sto
-0000a7d0: 636b 735f 6461 7461 2e74 7874 222c 2022  cks_data.txt", "
-0000a7e0: 7722 2920 6173 2066 696c 653a 0a20 2020  w") as file:.   
-0000a7f0: 2023 2020 2020 2020 2020 2066 696c 652e   #         file.
-0000a800: 7772 6974 6528 6622 4e75 6d62 6572 206f  write(f"Number o
-0000a810: 6620 7374 6f63 6b73 2046 696c 7465 7265  f stocks Filtere
-0000a820: 643a 207b 636f 756e 745f 6669 6c74 6572  d: {count_filter
-0000a830: 6564 5f73 746f 636b 737d 5c6e 5c6e 2229  ed_stocks}\n\n")
-0000a840: 0a20 2020 2023 2020 2020 2020 2020 2066  .    #         f
-0000a850: 696c 652e 7772 6974 6528 2246 696c 7465  ile.write("Filte
-0000a860: 7265 6420 5374 6f63 6b20 4461 7461 3a5c  red Stock Data:\
-0000a870: 6e5c 6e22 290a 2020 2020 2020 2020 2020  n\n").          
-0000a880: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
-0000a890: 2066 6f72 2073 796d 626f 6c20 696e 2066   for symbol in f
-0000a8a0: 696c 7465 7265 645f 7374 6f63 6b73 3a0a  iltered_stocks:.
+0000a410: 2020 2020 2020 2020 6966 2073 7570 706c          if suppl
+0000a420: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
+0000a430: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a450: 2020 2020 6669 6c65 2e77 7269 7465 2866      file.write(f
+0000a460: 225c 6e50 726f 7869 6d61 6c20 4c69 6e65  "\nProximal Line
+0000a470: 2050 7269 6365 3a20 7b73 7570 706c 795f   Price: {supply_
+0000a480: 7072 6f78 696d 616c 5f6c 696e 6573 5b69  proximal_lines[i
+0000a490: 5d3a 2e32 667d 2229 0a20 2020 2023 2020  ]:.2f}").    #  
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 2020 2020 2020 2069 6620 7375 7070 6c79         if supply
+0000a4c0: 5f64 6973 7461 6c5f 6c69 6e65 733a 2020  _distal_lines:  
+0000a4d0: 2320 496e 636c 7564 6520 6469 7374 616c  # Include distal
+0000a4e0: 206c 696e 6520 7072 6963 6520 6966 2061   line price if a
+0000a4f0: 7661 696c 6162 6c65 0a20 2020 2023 2020  vailable.    #  
+0000a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a510: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+0000a520: 7772 6974 6528 6622 5c6e 4469 7374 616c  write(f"\nDistal
+0000a530: 204c 696e 6520 5072 6963 653a 207b 7375   Line Price: {su
+0000a540: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
+0000a550: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
+0000a560: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000a570: 2020 2020 2020 2020 2020 2320 496e 636c            # Incl
+0000a580: 7564 6520 7a6f 6e65 2072 616e 6765 0a20  ude zone range. 
+0000a590: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5b0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
+0000a5c0: 5a6f 6e65 2052 616e 6765 3a20 7b73 7570  Zone Range: {sup
+0000a5d0: 706c 795f 7a6f 6e65 5f72 616e 6765 735b  ply_zone_ranges[
+0000a5e0: 695d 3a2e 3266 7d22 290a 2020 2020 2320  i]:.2f}").    # 
+0000a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a600: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000a610: 6966 2070 726f 7869 6d61 6c20 6c69 6e65  if proximal line
+0000a620: 2069 7320 7465 7374 6564 0a20 2020 2023   is tested.    #
+0000a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a640: 2020 2020 2020 2020 2074 6573 7465 6420           tested 
+0000a650: 3d20 6973 5f7a 6f6e 655f 7465 7374 6564  = is_zone_tested
+0000a660: 2864 6174 612c 2073 7461 7274 2c20 656e  (data, start, en
+0000a670: 642c 2073 7570 706c 795f 7072 6f78 696d  d, supply_proxim
+0000a680: 616c 5f6c 696e 6573 5b69 5d29 0a20 2020  al_lines[i]).   
+0000a690: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000a6a0: 2020 2020 2020 2020 2020 2069 6620 7465             if te
+0000a6b0: 7374 6564 3a0a 2020 2020 2320 2020 2020  sted:.    #     
+0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6d0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000a6e0: 7465 2822 5c6e 5a6f 6e65 2069 7320 5465  te("\nZone is Te
+0000a6f0: 7374 6564 2229 0a20 2020 2023 2020 2020  sted").    #    
+0000a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a710: 2020 2020 2065 6c73 653a 0a20 2020 2023       else:.    #
+0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a730: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a740: 652e 7772 6974 6528 225c 6e46 7265 7368  e.write("\nFresh
+0000a750: 205a 6f6e 6522 290a 2020 2020 2320 2020   Zone").    #   
+0000a760: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000a770: 7365 3a0a 2020 2020 2320 2020 2020 2020  se:.    #       
+0000a780: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000a790: 6c65 2e77 7269 7465 2822 5c6e 4e6f 2073  le.write("\nNo s
+0000a7a0: 7570 706c 7920 7a6f 6e65 2070 6174 7465  upply zone patte
+0000a7b0: 726e 7320 666f 756e 642e 2229 0a0a 2020  rns found.")..  
+0000a7c0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000a7d0: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
+0000a7e0: 6865 2073 746f 636b 2068 6173 2065 6974  he stock has eit
+0000a7f0: 6865 7220 6465 6d61 6e64 206f 7220 7375  her demand or su
+0000a800: 7070 6c79 207a 6f6e 6520 7769 7468 696e  pply zone within
+0000a810: 2074 6865 2074 6872 6573 686f 6c64 0a20   the threshold. 
+0000a820: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000a830: 2020 2020 2068 6173 5f64 656d 616e 645f       has_demand_
+0000a840: 6f72 5f73 7570 706c 795f 7769 7468 696e  or_supply_within
+0000a850: 5f74 6872 6573 686f 6c64 203d 2061 6e79  _threshold = any
+0000a860: 280a 2020 2020 2320 2020 2020 2020 2020  (.    #         
+0000a870: 2020 2020 2020 2020 2020 2020 6162 7328              abs(
+0000a880: 2863 6d70 202d 2070 7269 6365 2920 2f20  (cmp - price) / 
+0000a890: 636d 7029 202a 2031 3030 203c 3d20 7468  cmp) * 100 <= th
+0000a8a0: 7265 7368 6f6c 645f 7065 7263 656e 740a  reshold_percent.
 0000a8b0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000a8c0: 2020 6966 2064 6174 6120 6973 206e 6f74    if data is not
-0000a8d0: 204e 6f6e 653a 0a20 2020 2023 2020 2020   None:.    #    
-0000a8e0: 2020 2020 2020 2020 2020 2020 2063 6d70               cmp
-0000a8f0: 203d 2064 6174 612e 696c 6f63 5b2d 315d   = data.iloc[-1]
-0000a900: 5b27 436c 6f73 6527 5d20 2023 2043 7572  ['Close']  # Cur
-0000a910: 7265 6e74 206d 6172 6b65 7420 7072 6963  rent market pric
-0000a920: 650a 2020 2020 2320 2020 2020 2020 2020  e.    #         
-0000a930: 2020 2020 2020 2020 6465 6d61 6e64 5f7a          demand_z
-0000a940: 6f6e 6573 2c20 5f2c 205f 2c20 6465 6d61  ones, _, _, dema
-0000a950: 6e64 5f70 726f 7869 6d61 6c5f 6c69 6e65  nd_proximal_line
-0000a960: 203d 2073 656c 662e 6964 656e 7469 6679   = self.identify
-0000a970: 5f64 656d 616e 645f 7a6f 6e65 2864 6174  _demand_zone(dat
-0000a980: 612c 2063 6d70 290a 2020 2020 2320 2020  a, cmp).    #   
-0000a990: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0000a9a0: 7070 6c79 5f7a 6f6e 6573 2c20 5f2c 205f  pply_zones, _, _
-0000a9b0: 2c20 7375 7070 6c79 5f70 726f 7869 6d61  , supply_proxima
-0000a9c0: 6c5f 6c69 6e65 203d 2073 656c 662e 6964  l_line = self.id
-0000a9d0: 656e 7469 6679 5f73 7570 706c 795f 7a6f  entify_supply_zo
-0000a9e0: 6e65 2864 6174 612c 2063 6d70 290a 0a20  ne(data, cmp).. 
-0000a9f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000aa00: 2020 2020 2023 2053 7465 7020 313a 2043       # Step 1: C
-0000aa10: 616c 6375 6c61 7465 2070 726f 7869 6d61  alculate proxima
-0000aa20: 6c20 6c69 6e65 7320 666f 7220 6465 6d61  l lines for dema
-0000aa30: 6e64 2061 6e64 2073 7570 706c 7920 7a6f  nd and supply zo
-0000aa40: 6e65 730a 2020 2020 2320 2020 2020 2020  nes.    #       
-0000aa50: 2020 2020 2020 2020 2020 6465 6d61 6e64            demand
-0000aa60: 5f70 726f 7869 6d61 6c5f 6c69 6e65 7320  _proximal_lines 
-0000aa70: 3d20 7365 6c66 2e63 616c 6375 6c61 7465  = self.calculate
-0000aa80: 5f64 656d 616e 645f 7072 6f78 696d 616c  _demand_proximal
-0000aa90: 5f6c 696e 6573 2864 6174 612c 2064 656d  _lines(data, dem
-0000aaa0: 616e 645f 7a6f 6e65 7329 0a20 2020 2023  and_zones).    #
-0000aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aac0: 2073 7570 706c 795f 7072 6f78 696d 616c   supply_proximal
-0000aad0: 5f6c 696e 6573 203d 2073 656c 662e 6361  _lines = self.ca
-0000aae0: 6c63 756c 6174 655f 7375 7070 6c79 5f70  lculate_supply_p
-0000aaf0: 726f 7869 6d61 6c5f 6c69 6e65 7328 6461  roximal_lines(da
-0000ab00: 7461 2c20 7375 7070 6c79 5f7a 6f6e 6573  ta, supply_zones
-0000ab10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ab20: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
-0000ab30: 2020 2020 2020 2020 2020 2020 2023 2053               # S
-0000ab40: 7465 7020 323a 2043 616c 6375 6c61 7465  tep 2: Calculate
-0000ab50: 2064 6973 7461 6c20 6c69 6e65 7320 666f   distal lines fo
-0000ab60: 7220 6465 6d61 6e64 207a 6f6e 6573 2061  r demand zones a
-0000ab70: 6e64 2073 7570 706c 7920 7a6f 6e65 730a  nd supply zones.
-0000ab80: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000ab90: 2020 2020 2020 6465 6d61 6e64 5f64 6973        demand_dis
-0000aba0: 7461 6c5f 6c69 6e65 7320 3d20 7365 6c66  tal_lines = self
-0000abb0: 2e63 616c 6375 6c61 7465 5f64 656d 616e  .calculate_deman
-0000abc0: 645f 6469 7374 616c 5f6c 696e 6573 2864  d_distal_lines(d
-0000abd0: 6174 612c 2064 656d 616e 645f 7a6f 6e65  ata, demand_zone
-0000abe0: 7329 0a20 2020 2023 2020 2020 2020 2020  s).    #        
-0000abf0: 2020 2020 2020 2020 2073 7570 706c 795f           supply_
-0000ac00: 6469 7374 616c 5f6c 696e 6573 203d 2073  distal_lines = s
-0000ac10: 656c 662e 6361 6c63 756c 6174 655f 7375  elf.calculate_su
-0000ac20: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
-0000ac30: 7328 6461 7461 2c20 7375 7070 6c79 5f7a  s(data, supply_z
-0000ac40: 6f6e 6573 290a 2020 2020 2020 2020 2020  ones).          
-0000ac50: 2020 2020 2020 2020 2020 0a20 2020 2023            .    #
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2023 2043 616c 6375 6c61 7465 2072 616e   # Calculate ran
-0000ac80: 6765 206f 6620 6465 6d61 6e64 2061 6e64  ge of demand and
-0000ac90: 2073 7570 706c 7920 7a6f 6e65 730a 2020   supply zones.  
-0000aca0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000acb0: 2020 2020 6465 6d61 6e64 5f7a 6f6e 655f      demand_zone_
-0000acc0: 7261 6e67 6573 203d 2073 656c 662e 6361  ranges = self.ca
-0000acd0: 6c63 756c 6174 655f 6465 6d61 6e64 5f7a  lculate_demand_z
-0000ace0: 6f6e 655f 7261 6e67 6573 2864 656d 616e  one_ranges(deman
-0000acf0: 645f 7a6f 6e65 732c 2064 656d 616e 645f  d_zones, demand_
-0000ad00: 7072 6f78 696d 616c 5f6c 696e 6573 2c20  proximal_lines, 
-0000ad10: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
-0000ad20: 6e65 7329 0a20 2020 2023 2020 2020 2020  nes).    #      
-0000ad30: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
-0000ad40: 795f 7a6f 6e65 5f72 616e 6765 7320 3d20  y_zone_ranges = 
-0000ad50: 7365 6c66 2e63 616c 6375 6c61 7465 5f73  self.calculate_s
-0000ad60: 7570 706c 795f 7a6f 6e65 5f72 616e 6765  upply_zone_range
-0000ad70: 7328 7375 7070 6c79 5f7a 6f6e 6573 2c20  s(supply_zones, 
-0000ad80: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
-0000ad90: 6c69 6e65 732c 2073 7570 706c 795f 6469  lines, supply_di
-0000ada0: 7374 616c 5f6c 696e 6573 290a 2020 2020  stal_lines).    
-0000adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000add0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000ade0: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-0000adf0: 6620 7468 6520 7374 6f63 6b20 6861 7320  f the stock has 
-0000ae00: 6569 7468 6572 2064 656d 616e 6420 6f72  either demand or
-0000ae10: 2073 7570 706c 7920 7a6f 6e65 2077 6974   supply zone wit
-0000ae20: 6869 6e20 7468 6520 7468 7265 7368 6f6c  hin the threshol
-0000ae30: 640a 2020 2020 2320 2020 2020 2020 2020  d.    #         
-0000ae40: 2020 2020 2020 2020 6861 735f 6465 6d61          has_dema
-0000ae50: 6e64 5f6f 725f 7375 7070 6c79 5f77 6974  nd_or_supply_wit
-0000ae60: 6869 6e5f 7468 7265 7368 6f6c 6420 3d20  hin_threshold = 
-0000ae70: 616e 7928 0a20 2020 2023 2020 2020 2020  any(.    #      
-0000ae80: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000ae90: 6273 2828 636d 7020 2d20 7072 6963 6529  bs((cmp - price)
-0000aea0: 202f 2063 6d70 2920 2a20 3130 3020 3c3d   / cmp) * 100 <=
-0000aeb0: 2074 6872 6573 686f 6c64 5f70 6572 6365   threshold_perce
-0000aec0: 6e74 0a20 2020 2023 2020 2020 2020 2020  nt.    #        
-0000aed0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000aee0: 2070 7269 6365 2069 6e20 6465 6d61 6e64   price in demand
-0000aef0: 5f70 726f 7869 6d61 6c5f 6c69 6e65 7320  _proximal_lines 
-0000af00: 2b20 7375 7070 6c79 5f70 726f 7869 6d61  + supply_proxima
-0000af10: 6c5f 6c69 6e65 730a 2020 2020 2320 2020  l_lines.    #   
-0000af20: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af40: 2020 2020 0a20 2020 2023 2020 2020 2020      .    #      
-0000af50: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0000af60: 7468 6520 7374 6f63 6b20 6861 7320 6465  the stock has de
-0000af70: 6d61 6e64 206f 7220 7375 7070 6c79 207a  mand or supply z
-0000af80: 6f6e 6520 7769 7468 696e 2074 6865 2074  one within the t
-0000af90: 6872 6573 686f 6c64 2c20 7772 6974 6520  hreshold, write 
-0000afa0: 6974 7320 616e 616c 7973 6973 0a20 2020  its analysis.   
-0000afb0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000afc0: 2020 2069 6620 6861 735f 6465 6d61 6e64     if has_demand
-0000afd0: 5f6f 725f 7375 7070 6c79 5f77 6974 6869  _or_supply_withi
-0000afe0: 6e5f 7468 7265 7368 6f6c 643a 0a20 2020  n_threshold:.   
-0000aff0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b000: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000b010: 6528 6622 416e 616c 7973 6973 2066 6f72  e(f"Analysis for
-0000b020: 207b 7379 6d62 6f6c 7d20 287b 7469 6d65   {symbol} ({time
-0000b030: 6672 616d 657d 293a 5c6e 2229 0a20 2020  frame}):\n").   
-0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b050: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-0000b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b070: 2320 4465 6d61 6e64 205a 6f6e 6573 0a20  # Demand Zones. 
-0000b080: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b090: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000b0a0: 6974 6528 225c 6e5c 6e44 656d 616e 6420  ite("\n\nDemand 
-0000b0b0: 5a6f 6e65 733a 2229 0a20 2020 2023 2020  Zones:").    #  
-0000b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0d0: 2020 2069 6620 6465 6d61 6e64 5f7a 6f6e     if demand_zon
-0000b0e0: 6573 3a20 2023 2043 6865 636b 2069 6620  es:  # Check if 
-0000b0f0: 6465 6d61 6e64 5f7a 6f6e 6573 2069 7320  demand_zones is 
-0000b100: 6e6f 7420 656d 7074 790a 2020 2020 2320  not empty.    # 
-0000b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b120: 2020 2020 2020 2020 666f 7220 692c 2028          for i, (
-0000b130: 7374 6172 742c 2065 6e64 2c20 7061 7474  start, end, patt
-0000b140: 6572 6e2c 2062 6173 655f 636f 756e 7429  ern, base_count)
-0000b150: 2069 6e20 656e 756d 6572 6174 6528 6465   in enumerate(de
-0000b160: 6d61 6e64 5f7a 6f6e 6573 293a 0a20 2020  mand_zones):.   
-0000b170: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b180: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000b190: 6973 745f 6672 6f6d 5f63 6d70 203d 2061  ist_from_cmp = a
-0000b1a0: 6273 2828 636d 7020 2d20 6465 6d61 6e64  bs((cmp - demand
-0000b1b0: 5f70 726f 7869 6d61 6c5f 6c69 6e65 735b  _proximal_lines[
-0000b1c0: 695d 2920 2f20 636d 7029 202a 2031 3030  i]) / cmp) * 100
-0000b1d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2069 6620 6162 7328 6469 7374 5f66     if abs(dist_f
-0000b200: 726f 6d5f 636d 7029 203c 3d20 7468 7265  rom_cmp) <= thre
-0000b210: 7368 6f6c 645f 7065 7263 656e 743a 2020  shold_percent:  
-0000b220: 2320 4368 6563 6b20 6966 2064 6973 745f  # Check if dist_
-0000b230: 6672 6f6d 5f63 6d70 2069 7320 7769 7468  from_cmp is with
-0000b240: 696e 2074 6872 6573 686f 6c64 0a20 2020  in threshold.   
-0000b250: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000a8c0: 2020 2020 2020 2020 2020 666f 7220 7072            for pr
+0000a8d0: 6963 6520 696e 2064 656d 616e 645f 7072  ice in demand_pr
+0000a8e0: 6f78 696d 616c 5f6c 696e 6573 202b 2073  oximal_lines + s
+0000a8f0: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
+0000a900: 696e 6573 0a20 2020 2023 2020 2020 2020  ines.    #      
+0000a910: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a930: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+0000a940: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+0000a950: 2073 746f 636b 2068 6173 2064 656d 616e   stock has deman
+0000a960: 6420 6f72 2073 7570 706c 7920 7a6f 6e65  d or supply zone
+0000a970: 2077 6974 6869 6e20 7468 6520 7468 7265   within the thre
+0000a980: 7368 6f6c 642c 2069 6e63 7265 6d65 6e74  shold, increment
+0000a990: 2074 6865 2063 6f75 6e74 0a20 2020 2023   the count.    #
+0000a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9b0: 2069 6620 6861 735f 6465 6d61 6e64 5f6f   if has_demand_o
+0000a9c0: 725f 7375 7070 6c79 5f77 6974 6869 6e5f  r_supply_within_
+0000a9d0: 7468 7265 7368 6f6c 643a 0a20 2020 2023  threshold:.    #
+0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9f0: 2020 2020 2063 6f75 6e74 5f66 696c 7465       count_filte
+0000aa00: 7265 645f 7374 6f63 6b73 202b 3d20 310a  red_stocks += 1.
+0000aa10: 0a20 2020 2023 2020 2020 2023 2046 696c  .    #     # Fil
+0000aa20: 7465 7220 7374 6f63 6b73 2062 6173 6564  ter stocks based
+0000aa30: 206f 6e20 7468 6520 7065 7263 656e 7461   on the percenta
+0000aa40: 6765 2074 6872 6573 686f 6c64 2061 6e64  ge threshold and
+0000aa50: 2073 6176 6520 7468 6520 7265 7375 6c74   save the result
+0000aa60: 7320 696e 2061 6e6f 7468 6572 2066 696c  s in another fil
+0000aa70: 650a 2020 2020 2320 2020 2020 6669 6c74  e.    #     filt
+0000aa80: 6572 6564 5f73 746f 636b 7320 3d20 7365  ered_stocks = se
+0000aa90: 6c66 2e66 696c 7465 725f 7374 6f63 6b73  lf.filter_stocks
+0000aaa0: 5f62 795f 6469 7374 616e 6365 2873 746f  _by_distance(sto
+0000aab0: 636b 5f73 796d 626f 6c73 2c20 7468 7265  ck_symbols, thre
+0000aac0: 7368 6f6c 645f 7065 7263 656e 742c 2074  shold_percent, t
+0000aad0: 696d 6566 7261 6d65 290a 0a20 2020 2023  imeframe)..    #
+0000aae0: 2020 2020 2077 6974 6820 6f70 656e 2822       with open("
+0000aaf0: 6669 6c74 6572 6564 5f73 746f 636b 735f  filtered_stocks_
+0000ab00: 6461 7461 2e74 7874 222c 2022 7722 2920  data.txt", "w") 
+0000ab10: 6173 2066 696c 653a 0a20 2020 2023 2020  as file:.    #  
+0000ab20: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+0000ab30: 6528 6622 4e75 6d62 6572 206f 6620 7374  e(f"Number of st
+0000ab40: 6f63 6b73 2046 696c 7465 7265 643a 207b  ocks Filtered: {
+0000ab50: 636f 756e 745f 6669 6c74 6572 6564 5f73  count_filtered_s
+0000ab60: 746f 636b 737d 5c6e 5c6e 2229 0a20 2020  tocks}\n\n").   
+0000ab70: 2023 2020 2020 2020 2020 2066 696c 652e   #         file.
+0000ab80: 7772 6974 6528 2246 696c 7465 7265 6420  write("Filtered 
+0000ab90: 5374 6f63 6b20 4461 7461 3a5c 6e5c 6e22  Stock Data:\n\n"
+0000aba0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
+0000abb0: 2020 2023 2020 2020 2020 2020 2066 6f72     #         for
+0000abc0: 2073 796d 626f 6c20 696e 2066 696c 7465   symbol in filte
+0000abd0: 7265 645f 7374 6f63 6b73 3a0a 2020 2020  red_stocks:.    
+0000abe0: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+0000abf0: 2064 6174 6120 6973 206e 6f74 204e 6f6e   data is not Non
+0000ac00: 653a 0a20 2020 2023 2020 2020 2020 2020  e:.    #        
+0000ac10: 2020 2020 2020 2020 2063 6d70 203d 2064           cmp = d
+0000ac20: 6174 612e 696c 6f63 5b2d 315d 5b27 436c  ata.iloc[-1]['Cl
+0000ac30: 6f73 6527 5d20 2023 2043 7572 7265 6e74  ose']  # Current
+0000ac40: 206d 6172 6b65 7420 7072 6963 650a 2020   market price.  
+0000ac50: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000ac60: 2020 2020 6465 6d61 6e64 5f7a 6f6e 6573      demand_zones
+0000ac70: 2c20 5f2c 205f 2c20 6465 6d61 6e64 5f70  , _, _, demand_p
+0000ac80: 726f 7869 6d61 6c5f 6c69 6e65 203d 2073  roximal_line = s
+0000ac90: 656c 662e 6964 656e 7469 6679 5f64 656d  elf.identify_dem
+0000aca0: 616e 645f 7a6f 6e65 2864 6174 612c 2063  and_zone(data, c
+0000acb0: 6d70 290a 2020 2020 2320 2020 2020 2020  mp).    #       
+0000acc0: 2020 2020 2020 2020 2020 7375 7070 6c79            supply
+0000acd0: 5f7a 6f6e 6573 2c20 5f2c 205f 2c20 7375  _zones, _, _, su
+0000ace0: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+0000acf0: 6e65 203d 2073 656c 662e 6964 656e 7469  ne = self.identi
+0000ad00: 6679 5f73 7570 706c 795f 7a6f 6e65 2864  fy_supply_zone(d
+0000ad10: 6174 612c 2063 6d70 290a 0a20 2020 2023  ata, cmp)..    #
+0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad30: 2023 2053 7465 7020 313a 2043 616c 6375   # Step 1: Calcu
+0000ad40: 6c61 7465 2070 726f 7869 6d61 6c20 6c69  late proximal li
+0000ad50: 6e65 7320 666f 7220 6465 6d61 6e64 2061  nes for demand a
+0000ad60: 6e64 2073 7570 706c 7920 7a6f 6e65 730a  nd supply zones.
+0000ad70: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000ad80: 2020 2020 2020 6465 6d61 6e64 5f70 726f        demand_pro
+0000ad90: 7869 6d61 6c5f 6c69 6e65 7320 3d20 7365  ximal_lines = se
+0000ada0: 6c66 2e63 616c 6375 6c61 7465 5f64 656d  lf.calculate_dem
+0000adb0: 616e 645f 7072 6f78 696d 616c 5f6c 696e  and_proximal_lin
+0000adc0: 6573 2864 6174 612c 2064 656d 616e 645f  es(data, demand_
+0000add0: 7a6f 6e65 7329 0a20 2020 2023 2020 2020  zones).    #    
+0000ade0: 2020 2020 2020 2020 2020 2020 2073 7570               sup
+0000adf0: 706c 795f 7072 6f78 696d 616c 5f6c 696e  ply_proximal_lin
+0000ae00: 6573 203d 2073 656c 662e 6361 6c63 756c  es = self.calcul
+0000ae10: 6174 655f 7375 7070 6c79 5f70 726f 7869  ate_supply_proxi
+0000ae20: 6d61 6c5f 6c69 6e65 7328 6461 7461 2c20  mal_lines(data, 
+0000ae30: 7375 7070 6c79 5f7a 6f6e 6573 290a 2020  supply_zones).  
+0000ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae50: 2020 0a20 2020 2023 2020 2020 2020 2020    .    #        
+0000ae60: 2020 2020 2020 2020 2023 2053 7465 7020           # Step 
+0000ae70: 323a 2043 616c 6375 6c61 7465 2064 6973  2: Calculate dis
+0000ae80: 7461 6c20 6c69 6e65 7320 666f 7220 6465  tal lines for de
+0000ae90: 6d61 6e64 207a 6f6e 6573 2061 6e64 2073  mand zones and s
+0000aea0: 7570 706c 7920 7a6f 6e65 730a 2020 2020  upply zones.    
+0000aeb0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000aec0: 2020 6465 6d61 6e64 5f64 6973 7461 6c5f    demand_distal_
+0000aed0: 6c69 6e65 7320 3d20 7365 6c66 2e63 616c  lines = self.cal
+0000aee0: 6375 6c61 7465 5f64 656d 616e 645f 6469  culate_demand_di
+0000aef0: 7374 616c 5f6c 696e 6573 2864 6174 612c  stal_lines(data,
+0000af00: 2064 656d 616e 645f 7a6f 6e65 7329 0a20   demand_zones). 
+0000af10: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000af20: 2020 2020 2073 7570 706c 795f 6469 7374       supply_dist
+0000af30: 616c 5f6c 696e 6573 203d 2073 656c 662e  al_lines = self.
+0000af40: 6361 6c63 756c 6174 655f 7375 7070 6c79  calculate_supply
+0000af50: 5f64 6973 7461 6c5f 6c69 6e65 7328 6461  _distal_lines(da
+0000af60: 7461 2c20 7375 7070 6c79 5f7a 6f6e 6573  ta, supply_zones
+0000af70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000af80: 2020 2020 2020 0a20 2020 2023 2020 2020        .    #    
+0000af90: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+0000afa0: 616c 6375 6c61 7465 2072 616e 6765 206f  alculate range o
+0000afb0: 6620 6465 6d61 6e64 2061 6e64 2073 7570  f demand and sup
+0000afc0: 706c 7920 7a6f 6e65 730a 2020 2020 2320  ply zones.    # 
+0000afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afe0: 6465 6d61 6e64 5f7a 6f6e 655f 7261 6e67  demand_zone_rang
+0000aff0: 6573 203d 2073 656c 662e 6361 6c63 756c  es = self.calcul
+0000b000: 6174 655f 6465 6d61 6e64 5f7a 6f6e 655f  ate_demand_zone_
+0000b010: 7261 6e67 6573 2864 656d 616e 645f 7a6f  ranges(demand_zo
+0000b020: 6e65 732c 2064 656d 616e 645f 7072 6f78  nes, demand_prox
+0000b030: 696d 616c 5f6c 696e 6573 2c20 6465 6d61  imal_lines, dema
+0000b040: 6e64 5f64 6973 7461 6c5f 6c69 6e65 7329  nd_distal_lines)
+0000b050: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000b060: 2020 2020 2020 2073 7570 706c 795f 7a6f         supply_zo
+0000b070: 6e65 5f72 616e 6765 7320 3d20 7365 6c66  ne_ranges = self
+0000b080: 2e63 616c 6375 6c61 7465 5f73 7570 706c  .calculate_suppl
+0000b090: 795f 7a6f 6e65 5f72 616e 6765 7328 7375  y_zone_ranges(su
+0000b0a0: 7070 6c79 5f7a 6f6e 6573 2c20 7375 7070  pply_zones, supp
+0000b0b0: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
+0000b0c0: 732c 2073 7570 706c 795f 6469 7374 616c  s, supply_distal
+0000b0d0: 5f6c 696e 6573 290a 2020 2020 2020 2020  _lines).        
+0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0f0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0000b100: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b110: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
+0000b120: 6520 7374 6f63 6b20 6861 7320 6569 7468  e stock has eith
+0000b130: 6572 2064 656d 616e 6420 6f72 2073 7570  er demand or sup
+0000b140: 706c 7920 7a6f 6e65 2077 6974 6869 6e20  ply zone within 
+0000b150: 7468 6520 7468 7265 7368 6f6c 640a 2020  the threshold.  
+0000b160: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000b170: 2020 2020 6861 735f 6465 6d61 6e64 5f6f      has_demand_o
+0000b180: 725f 7375 7070 6c79 5f77 6974 6869 6e5f  r_supply_within_
+0000b190: 7468 7265 7368 6f6c 6420 3d20 616e 7928  threshold = any(
+0000b1a0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000b1b0: 2020 2020 2020 2020 2020 2061 6273 2828             abs((
+0000b1c0: 636d 7020 2d20 7072 6963 6529 202f 2063  cmp - price) / c
+0000b1d0: 6d70 2920 2a20 3130 3020 3c3d 2074 6872  mp) * 100 <= thr
+0000b1e0: 6573 686f 6c64 5f70 6572 6365 6e74 0a20  eshold_percent. 
+0000b1f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000b200: 2020 2020 2020 2020 2066 6f72 2070 7269           for pri
+0000b210: 6365 2069 6e20 6465 6d61 6e64 5f70 726f  ce in demand_pro
+0000b220: 7869 6d61 6c5f 6c69 6e65 7320 2b20 7375  ximal_lines + su
+0000b230: 7070 6c79 5f70 726f 7869 6d61 6c5f 6c69  pply_proximal_li
+0000b240: 6e65 730a 2020 2020 2320 2020 2020 2020  nes.    #       
+0000b250: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
 0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b270: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000b280: 5c6e 5c6e 5a6f 6e65 207b 692b 317d 3a20  \n\nZone {i+1}: 
-0000b290: 5374 6172 7420 4461 7465 3a20 7b64 6174  Start Date: {dat
-0000b2a0: 612e 696e 6465 785b 7374 6172 745d 2e64  a.index[start].d
-0000b2b0: 6174 6528 297d 2c20 456e 6420 4461 7465  ate()}, End Date
-0000b2c0: 3a20 7b64 6174 612e 696e 6465 785b 656e  : {data.index[en
-0000b2d0: 645d 2e64 6174 6528 297d 2229 0a20 2020  d].date()}").   
-0000b2e0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b300: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
-0000b310: 5c6e 5061 7474 6572 6e20 4e61 6d65 3a20  \nPattern Name: 
-0000b320: 7b70 6174 7465 726e 7d2c 204e 756d 6265  {pattern}, Numbe
-0000b330: 7220 6f66 2042 6173 6520 4361 6e64 6c65  r of Base Candle
-0000b340: 3a20 7b62 6173 655f 636f 756e 747d 2229  : {base_count}")
-0000b350: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b370: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000b380: 6528 6622 5c6e 4469 7374 616e 6365 2066  e(f"\nDistance f
-0000b390: 726f 6d20 434d 503a 207b 6469 7374 5f66  rom CMP: {dist_f
-0000b3a0: 726f 6d5f 636d 703a 2e32 667d 2522 290a  rom_cmp:.2f}%").
-0000b3b0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3d0: 2020 2020 2020 6966 2064 656d 616e 645f        if demand_
-0000b3e0: 7072 6f78 696d 616c 5f6c 696e 6573 3a0a  proximal_lines:.
-0000b3f0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b410: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
-0000b420: 7269 7465 2866 225c 6e50 726f 7869 6d61  rite(f"\nProxima
-0000b430: 6c20 4c69 6e65 2050 7269 6365 3a20 7b64  l Line Price: {d
-0000b440: 656d 616e 645f 7072 6f78 696d 616c 5f6c  emand_proximal_l
-0000b450: 696e 6573 5b69 5d3a 2e32 667d 2229 0a20  ines[i]:.2f}"). 
-0000b460: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b480: 2020 2020 2069 6620 6465 6d61 6e64 5f64       if demand_d
-0000b490: 6973 7461 6c5f 6c69 6e65 733a 2020 2320  istal_lines:  # 
-0000b4a0: 496e 636c 7564 6520 6469 7374 616c 206c  Include distal l
-0000b4b0: 696e 6520 7072 6963 6520 6966 2061 7661  ine price if ava
-0000b4c0: 696c 6162 6c65 0a20 2020 2023 2020 2020  ilable.    #    
-0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4f0: 2066 696c 652e 7772 6974 6528 6622 5c6e   file.write(f"\n
-0000b500: 4469 7374 616c 204c 696e 6520 5072 6963  Distal Line Pric
-0000b510: 653a 207b 6465 6d61 6e64 5f64 6973 7461  e: {demand_dista
-0000b520: 6c5f 6c69 6e65 735b 695d 3a2e 3266 7d22  l_lines[i]:.2f}"
-0000b530: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b550: 2020 2020 2020 2020 2320 496e 636c 7564          # Includ
-0000b560: 6520 7a6f 6e65 2072 616e 6765 0a20 2020  e zone range.   
-0000b570: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b270: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000b280: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+0000b290: 7374 6f63 6b20 6861 7320 6465 6d61 6e64  stock has demand
+0000b2a0: 206f 7220 7375 7070 6c79 207a 6f6e 6520   or supply zone 
+0000b2b0: 7769 7468 696e 2074 6865 2074 6872 6573  within the thres
+0000b2c0: 686f 6c64 2c20 7772 6974 6520 6974 7320  hold, write its 
+0000b2d0: 616e 616c 7973 6973 0a20 2020 2023 2020  analysis.    #  
+0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b2f0: 6620 6861 735f 6465 6d61 6e64 5f6f 725f  f has_demand_or_
+0000b300: 7375 7070 6c79 5f77 6974 6869 6e5f 7468  supply_within_th
+0000b310: 7265 7368 6f6c 643a 0a20 2020 2023 2020  reshold:.    #  
+0000b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b330: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000b340: 416e 616c 7973 6973 2066 6f72 207b 7379  Analysis for {sy
+0000b350: 6d62 6f6c 7d20 287b 7469 6d65 6672 616d  mbol} ({timefram
+0000b360: 657d 293a 5c6e 2229 0a20 2020 2020 2020  e}):\n").       
+0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b380: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+0000b390: 2020 2020 2020 2020 2020 2020 2320 4465              # De
+0000b3a0: 6d61 6e64 205a 6f6e 6573 0a20 2020 2023  mand Zones.    #
+0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3c0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000b3d0: 225c 6e5c 6e44 656d 616e 6420 5a6f 6e65  "\n\nDemand Zone
+0000b3e0: 733a 2229 0a20 2020 2023 2020 2020 2020  s:").    #      
+0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b400: 6620 6465 6d61 6e64 5f7a 6f6e 6573 3a20  f demand_zones: 
+0000b410: 2023 2043 6865 636b 2069 6620 6465 6d61   # Check if dema
+0000b420: 6e64 5f7a 6f6e 6573 2069 7320 6e6f 7420  nd_zones is not 
+0000b430: 656d 7074 790a 2020 2020 2320 2020 2020  empty.    #     
+0000b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b450: 2020 2020 666f 7220 692c 2028 7374 6172      for i, (star
+0000b460: 742c 2065 6e64 2c20 7061 7474 6572 6e2c  t, end, pattern,
+0000b470: 2062 6173 655f 636f 756e 7429 2069 6e20   base_count) in 
+0000b480: 656e 756d 6572 6174 6528 6465 6d61 6e64  enumerate(demand
+0000b490: 5f7a 6f6e 6573 293a 0a20 2020 2023 2020  _zones):.    #  
+0000b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4b0: 2020 2020 2020 2020 2020 2064 6973 745f             dist_
+0000b4c0: 6672 6f6d 5f63 6d70 203d 2061 6273 2828  from_cmp = abs((
+0000b4d0: 636d 7020 2d20 6465 6d61 6e64 5f70 726f  cmp - demand_pro
+0000b4e0: 7869 6d61 6c5f 6c69 6e65 735b 695d 2920  ximal_lines[i]) 
+0000b4f0: 2f20 636d 7029 202a 2031 3030 0a20 2020  / cmp) * 100.   
+0000b500: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0000b510: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b520: 6620 6162 7328 6469 7374 5f66 726f 6d5f  f abs(dist_from_
+0000b530: 636d 7029 203c 3d20 7468 7265 7368 6f6c  cmp) <= threshol
+0000b540: 645f 7065 7263 656e 743a 2020 2320 4368  d_percent:  # Ch
+0000b550: 6563 6b20 6966 2064 6973 745f 6672 6f6d  eck if dist_from
+0000b560: 5f63 6d70 2069 7320 7769 7468 696e 2074  _cmp is within t
+0000b570: 6872 6573 686f 6c64 0a20 2020 2023 2020  hreshold.    #  
 0000b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b590: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000b5a0: 6528 6622 5c6e 5a6f 6e65 2052 616e 6765  e(f"\nZone Range
-0000b5b0: 3a20 7b64 656d 616e 645f 7a6f 6e65 5f72  : {demand_zone_r
-0000b5c0: 616e 6765 735b 695d 3a2e 3266 7d22 290a  anges[i]:.2f}").
-0000b5d0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5f0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0000b600: 2070 726f 7869 6d61 6c20 6c69 6e65 2069   proximal line i
-0000b610: 7320 7465 7374 6564 0a20 2020 2023 2020  s tested.    #  
-0000b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b630: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000b640: 6573 7465 6420 3d20 6973 5f7a 6f6e 655f  ested = is_zone_
-0000b650: 7465 7374 6564 2864 6174 612c 2073 7461  tested(data, sta
-0000b660: 7274 2c20 656e 642c 2064 656d 616e 645f  rt, end, demand_
-0000b670: 7072 6f78 696d 616c 5f6c 696e 6573 5b69  proximal_lines[i
-0000b680: 5d29 0a20 2020 2023 2020 2020 2020 2020  ]).    #        
+0000b590: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b5a0: 696c 652e 7772 6974 6528 6622 5c6e 5c6e  ile.write(f"\n\n
+0000b5b0: 5a6f 6e65 207b 692b 317d 3a20 5374 6172  Zone {i+1}: Star
+0000b5c0: 7420 4461 7465 3a20 7b64 6174 612e 696e  t Date: {data.in
+0000b5d0: 6465 785b 7374 6172 745d 2e64 6174 6528  dex[start].date(
+0000b5e0: 297d 2c20 456e 6420 4461 7465 3a20 7b64  )}, End Date: {d
+0000b5f0: 6174 612e 696e 6465 785b 656e 645d 2e64  ata.index[end].d
+0000b600: 6174 6528 297d 2229 0a20 2020 2023 2020  ate()}").    #  
+0000b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b620: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b630: 696c 652e 7772 6974 6528 6622 5c6e 5061  ile.write(f"\nPa
+0000b640: 7474 6572 6e20 4e61 6d65 3a20 7b70 6174  ttern Name: {pat
+0000b650: 7465 726e 7d2c 204e 756d 6265 7220 6f66  tern}, Number of
+0000b660: 2042 6173 6520 4361 6e64 6c65 3a20 7b62   Base Candle: {b
+0000b670: 6173 655f 636f 756e 747d 2229 0a20 2020  ase_count}").   
+0000b680: 2023 2020 2020 2020 2020 2020 2020 2020   #              
 0000b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6a0: 2020 2020 2020 2020 2069 6620 7465 7374           if test
-0000b6b0: 6564 3a0a 2020 2020 2320 2020 2020 2020  ed:.    #       
-0000b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000b6e0: 6c65 2e77 7269 7465 2822 5c6e 5a6f 6e65  le.write("\nZone
-0000b6f0: 2069 7320 5465 7374 6564 2229 0a20 2020   is Tested").   
-0000b700: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b720: 2020 2065 6c73 653a 0a20 2020 2023 2020     else:.    #  
+0000b6a0: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000b6b0: 5c6e 4469 7374 616e 6365 2066 726f 6d20  \nDistance from 
+0000b6c0: 434d 503a 207b 6469 7374 5f66 726f 6d5f  CMP: {dist_from_
+0000b6d0: 636d 703a 2e32 667d 2522 290a 2020 2020  cmp:.2f}%").    
+0000b6e0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b700: 2020 6966 2064 656d 616e 645f 7072 6f78    if demand_prox
+0000b710: 696d 616c 5f6c 696e 6573 3a0a 2020 2020  imal_lines:.    
+0000b720: 2320 2020 2020 2020 2020 2020 2020 2020  #               
 0000b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b750: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
-0000b760: 6e46 7265 7368 205a 6f6e 6522 290a 2020  nFresh Zone").  
-0000b770: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000b780: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000b790: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000b7a0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0000b7b0: 2e77 7269 7465 2822 5c6e 4e6f 2064 656d  .write("\nNo dem
-0000b7c0: 616e 6420 7a6f 6e65 2070 6174 7465 726e  and zone pattern
-0000b7d0: 7320 666f 756e 642e 2229 0a0a 2020 2020  s found.")..    
-0000b7e0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000b7f0: 2020 2020 2020 2320 5375 7070 6c79 205a        # Supply Z
-0000b800: 6f6e 6573 0a20 2020 2023 2020 2020 2020  ones.    #      
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b820: 696c 652e 7772 6974 6528 225c 6e5c 6e53  ile.write("\n\nS
-0000b830: 7570 706c 7920 5a6f 6e65 733a 2229 0a20  upply Zones:"). 
-0000b840: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000b850: 2020 2020 2020 2020 2069 6620 7375 7070           if supp
-0000b860: 6c79 5f7a 6f6e 6573 3a20 2023 2043 6865  ly_zones:  # Che
-0000b870: 636b 2069 6620 7375 7070 6c79 5f7a 6f6e  ck if supply_zon
-0000b880: 6573 2069 7320 6e6f 7420 656d 7074 790a  es is not empty.
-0000b890: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000b8a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000b8b0: 7220 692c 2028 7374 6172 742c 2065 6e64  r i, (start, end
-0000b8c0: 2c20 7061 7474 6572 6e2c 2062 6173 655f  , pattern, base_
-0000b8d0: 636f 756e 7429 2069 6e20 656e 756d 6572  count) in enumer
-0000b8e0: 6174 6528 7375 7070 6c79 5f7a 6f6e 6573  ate(supply_zones
-0000b8f0: 293a 0a20 2020 2023 2020 2020 2020 2020  ):.    #        
-0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b910: 2020 2020 2064 6973 745f 6672 6f6d 5f63       dist_from_c
-0000b920: 6d70 203d 2061 6273 2828 636d 7020 2d20  mp = abs((cmp - 
-0000b930: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
-0000b940: 6c69 6e65 735b 695d 2920 2f20 636d 7029  lines[i]) / cmp)
-0000b950: 202a 2031 3030 0a20 2020 2023 2020 2020   * 100.    #    
-0000b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b970: 2020 2020 2020 2020 2069 6620 6162 7328           if abs(
-0000b980: 6469 7374 5f66 726f 6d5f 636d 7029 203c  dist_from_cmp) <
-0000b990: 3d20 7468 7265 7368 6f6c 645f 7065 7263  = threshold_perc
-0000b9a0: 656e 743a 2020 2320 4368 6563 6b20 6966  ent:  # Check if
-0000b9b0: 2064 6973 745f 6672 6f6d 5f63 6d70 2069   dist_from_cmp i
-0000b9c0: 7320 7769 7468 696e 2074 6872 6573 686f  s within thresho
-0000b9d0: 6c64 0a20 2020 2023 2020 2020 2020 2020  ld.    #        
-0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9f0: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000ba00: 6974 6528 6622 5c6e 5c6e 5a6f 6e65 207b  ite(f"\n\nZone {
-0000ba10: 692b 317d 3a20 5374 6172 7420 4461 7465  i+1}: Start Date
-0000ba20: 3a20 7b64 6174 612e 696e 6465 785b 7374  : {data.index[st
-0000ba30: 6172 745d 2e64 6174 6528 297d 2c20 456e  art].date()}, En
-0000ba40: 6420 4461 7465 3a20 7b64 6174 612e 696e  d Date: {data.in
-0000ba50: 6465 785b 656e 645d 2e64 6174 6528 297d  dex[end].date()}
-0000ba60: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
-0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba80: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000ba90: 6974 6528 6622 5c6e 5061 7474 6572 6e20  ite(f"\nPattern 
-0000baa0: 4e61 6d65 3a20 7b70 6174 7465 726e 7d2c  Name: {pattern},
-0000bab0: 204e 756d 6265 7220 6f66 2042 6173 6520   Number of Base 
-0000bac0: 4361 6e64 6c65 3a20 7b62 6173 655f 636f  Candle: {base_co
-0000bad0: 756e 747d 2229 0a20 2020 2023 2020 2020  unt}").    #    
-0000bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000baf0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000bb00: 652e 7772 6974 6528 6622 5c6e 4469 7374  e.write(f"\nDist
-0000bb10: 616e 6365 2066 726f 6d20 434d 503a 207b  ance from CMP: {
-0000bb20: 6469 7374 5f66 726f 6d5f 636d 703a 2e32  dist_from_cmp:.2
-0000bb30: 667d 2522 290a 2020 2020 2320 2020 2020  f}%").    #     
-0000bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb50: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000bb60: 7570 706c 795f 7072 6f78 696d 616c 5f6c  upply_proximal_l
-0000bb70: 696e 6573 3a0a 2020 2020 2320 2020 2020  ines:.    #     
-0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bba0: 6669 6c65 2e77 7269 7465 2866 225c 6e50  file.write(f"\nP
-0000bbb0: 726f 7869 6d61 6c20 4c69 6e65 2050 7269  roximal Line Pri
-0000bbc0: 6365 3a20 7b73 7570 706c 795f 7072 6f78  ce: {supply_prox
-0000bbd0: 696d 616c 5f6c 696e 6573 5b69 5d3a 2e32  imal_lines[i]:.2
-0000bbe0: 667d 2229 0a20 2020 2023 2020 2020 2020  f}").    #      
-0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc00: 2020 2020 2020 2020 2020 2069 6620 7375             if su
-0000bc10: 7070 6c79 5f64 6973 7461 6c5f 6c69 6e65  pply_distal_line
-0000bc20: 733a 2020 2320 496e 636c 7564 6520 6469  s:  # Include di
-0000bc30: 7374 616c 206c 696e 6520 7072 6963 6520  stal line price 
-0000bc40: 6966 2061 7661 696c 6162 6c65 0a20 2020  if available.   
-0000bc50: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc70: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000bc80: 6528 6622 5c6e 4469 7374 616c 204c 696e  e(f"\nDistal Lin
-0000bc90: 6520 5072 6963 653a 207b 7375 7070 6c79  e Price: {supply
-0000bca0: 5f64 6973 7461 6c5f 6c69 6e65 735b 695d  _distal_lines[i]
-0000bcb0: 3a2e 3266 7d22 290a 2020 2020 2320 2020  :.2f}").    #   
-0000bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000bce0: 496e 636c 7564 6520 7a6f 6e65 2072 616e  Include zone ran
-0000bcf0: 6765 0a20 2020 2023 2020 2020 2020 2020  ge.    #        
-0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000bd20: 652e 7772 6974 6528 6622 5c6e 5a6f 6e65  e.write(f"\nZone
-0000bd30: 2052 616e 6765 3a20 7b73 7570 706c 795f   Range: {supply_
-0000bd40: 7a6f 6e65 5f72 616e 6765 735b 695d 3a2e  zone_ranges[i]:.
-0000bd50: 3266 7d22 290a 2020 2020 2320 2020 2020  2f}").    #     
-0000bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd70: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0000bd80: 6563 6b20 6966 2070 726f 7869 6d61 6c20  eck if proximal 
-0000bd90: 6c69 6e65 2069 7320 7465 7374 6564 0a20  line is tested. 
-0000bda0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdc0: 2020 2020 2074 6573 7465 6420 3d20 7365       tested = se
-0000bdd0: 6c66 2e69 735f 7a6f 6e65 5f74 6573 7465  lf.is_zone_teste
-0000bde0: 6428 6461 7461 2c20 7374 6172 742c 2065  d(data, start, e
-0000bdf0: 6e64 2c20 7375 7070 6c79 5f70 726f 7869  nd, supply_proxi
-0000be00: 6d61 6c5f 6c69 6e65 735b 695d 290a 2020  mal_lines[i]).  
-0000be10: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be30: 2020 2020 6966 2074 6573 7465 643a 0a20      if tested:. 
-0000be40: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
-0000be70: 6974 6528 225c 6e5a 6f6e 6520 6973 2054  ite("\nZone is T
-0000be80: 6573 7465 6422 290a 2020 2020 2320 2020  ested").    #   
-0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bea0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000beb0: 7365 3a0a 2020 2020 2320 2020 2020 2020  se:.    #       
-0000bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bed0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000bee0: 6c65 2e77 7269 7465 2822 5c6e 4672 6573  le.write("\nFres
-0000bef0: 6820 5a6f 6e65 2229 0a20 2020 2023 2020  h Zone").    #  
-0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf10: 2020 2065 6c73 653a 0a20 2020 2023 2020     else:.    #  
+0000b740: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
+0000b750: 2866 225c 6e50 726f 7869 6d61 6c20 4c69  (f"\nProximal Li
+0000b760: 6e65 2050 7269 6365 3a20 7b64 656d 616e  ne Price: {deman
+0000b770: 645f 7072 6f78 696d 616c 5f6c 696e 6573  d_proximal_lines
+0000b780: 5b69 5d3a 2e32 667d 2229 0a20 2020 2023  [i]:.2f}").    #
+0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7b0: 2069 6620 6465 6d61 6e64 5f64 6973 7461   if demand_dista
+0000b7c0: 6c5f 6c69 6e65 733a 2020 2320 496e 636c  l_lines:  # Incl
+0000b7d0: 7564 6520 6469 7374 616c 206c 696e 6520  ude distal line 
+0000b7e0: 7072 6963 6520 6966 2061 7661 696c 6162  price if availab
+0000b7f0: 6c65 0a20 2020 2023 2020 2020 2020 2020  le.    #        
+0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b810: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000b820: 652e 7772 6974 6528 6622 5c6e 4469 7374  e.write(f"\nDist
+0000b830: 616c 204c 696e 6520 5072 6963 653a 207b  al Line Price: {
+0000b840: 6465 6d61 6e64 5f64 6973 7461 6c5f 6c69  demand_distal_li
+0000b850: 6e65 735b 695d 3a2e 3266 7d22 290a 2020  nes[i]:.2f}").  
+0000b860: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b880: 2020 2020 2320 496e 636c 7564 6520 7a6f      # Include zo
+0000b890: 6e65 2072 616e 6765 0a20 2020 2023 2020  ne range.    #  
+0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000b8d0: 5c6e 5a6f 6e65 2052 616e 6765 3a20 7b64  \nZone Range: {d
+0000b8e0: 656d 616e 645f 7a6f 6e65 5f72 616e 6765  emand_zone_range
+0000b8f0: 735b 695d 3a2e 3266 7d22 290a 2020 2020  s[i]:.2f}").    
+0000b900: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b920: 2020 2320 4368 6563 6b20 6966 2070 726f    # Check if pro
+0000b930: 7869 6d61 6c20 6c69 6e65 2069 7320 7465  ximal line is te
+0000b940: 7374 6564 0a20 2020 2023 2020 2020 2020  sted.    #      
+0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b960: 2020 2020 2020 2020 2020 2074 6573 7465             teste
+0000b970: 6420 3d20 6973 5f7a 6f6e 655f 7465 7374  d = is_zone_test
+0000b980: 6564 2864 6174 612c 2073 7461 7274 2c20  ed(data, start, 
+0000b990: 656e 642c 2064 656d 616e 645f 7072 6f78  end, demand_prox
+0000b9a0: 696d 616c 5f6c 696e 6573 5b69 5d29 0a20  imal_lines[i]). 
+0000b9b0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9d0: 2020 2020 2069 6620 7465 7374 6564 3a0a       if tested:.
+0000b9e0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba00: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000ba10: 7269 7465 2822 5c6e 5a6f 6e65 2069 7320  rite("\nZone is 
+0000ba20: 5465 7374 6564 2229 0a20 2020 2023 2020  Tested").    #  
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ba50: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ba80: 696c 652e 7772 6974 6528 225c 6e46 7265  ile.write("\nFre
+0000ba90: 7368 205a 6f6e 6522 290a 2020 2020 2320  sh Zone").    # 
+0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bab0: 2020 2020 656c 7365 3a0a 2020 2020 2320      else:.    # 
+0000bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bad0: 2020 2020 2020 2020 6669 6c65 2e77 7269          file.wri
+0000bae0: 7465 2822 5c6e 4e6f 2064 656d 616e 6420  te("\nNo demand 
+0000baf0: 7a6f 6e65 2070 6174 7465 726e 7320 666f  zone patterns fo
+0000bb00: 756e 642e 2229 0a0a 2020 2020 2320 2020  und.")..    #   
+0000bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb20: 2020 2320 5375 7070 6c79 205a 6f6e 6573    # Supply Zones
+0000bb30: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0000bb40: 2020 2020 2020 2020 2020 2066 696c 652e             file.
+0000bb50: 7772 6974 6528 225c 6e5c 6e53 7570 706c  write("\n\nSuppl
+0000bb60: 7920 5a6f 6e65 733a 2229 0a20 2020 2023  y Zones:").    #
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb80: 2020 2020 2069 6620 7375 7070 6c79 5f7a       if supply_z
+0000bb90: 6f6e 6573 3a20 2023 2043 6865 636b 2069  ones:  # Check i
+0000bba0: 6620 7375 7070 6c79 5f7a 6f6e 6573 2069  f supply_zones i
+0000bbb0: 7320 6e6f 7420 656d 7074 790a 2020 2020  s not empty.    
+0000bbc0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0000bbd0: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+0000bbe0: 2028 7374 6172 742c 2065 6e64 2c20 7061   (start, end, pa
+0000bbf0: 7474 6572 6e2c 2062 6173 655f 636f 756e  ttern, base_coun
+0000bc00: 7429 2069 6e20 656e 756d 6572 6174 6528  t) in enumerate(
+0000bc10: 7375 7070 6c79 5f7a 6f6e 6573 293a 0a20  supply_zones):. 
+0000bc20: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc40: 2064 6973 745f 6672 6f6d 5f63 6d70 203d   dist_from_cmp =
+0000bc50: 2061 6273 2828 636d 7020 2d20 7375 7070   abs((cmp - supp
+0000bc60: 6c79 5f70 726f 7869 6d61 6c5f 6c69 6e65  ly_proximal_line
+0000bc70: 735b 695d 2920 2f20 636d 7029 202a 2031  s[i]) / cmp) * 1
+0000bc80: 3030 0a20 2020 2023 2020 2020 2020 2020  00.    #        
+0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bca0: 2020 2020 2069 6620 6162 7328 6469 7374       if abs(dist
+0000bcb0: 5f66 726f 6d5f 636d 7029 203c 3d20 7468  _from_cmp) <= th
+0000bcc0: 7265 7368 6f6c 645f 7065 7263 656e 743a  reshold_percent:
+0000bcd0: 2020 2320 4368 6563 6b20 6966 2064 6973    # Check if dis
+0000bce0: 745f 6672 6f6d 5f63 6d70 2069 7320 7769  t_from_cmp is wi
+0000bcf0: 7468 696e 2074 6872 6573 686f 6c64 0a20  thin threshold. 
+0000bd00: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd20: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000bd30: 6622 5c6e 5c6e 5a6f 6e65 207b 692b 317d  f"\n\nZone {i+1}
+0000bd40: 3a20 5374 6172 7420 4461 7465 3a20 7b64  : Start Date: {d
+0000bd50: 6174 612e 696e 6465 785b 7374 6172 745d  ata.index[start]
+0000bd60: 2e64 6174 6528 297d 2c20 456e 6420 4461  .date()}, End Da
+0000bd70: 7465 3a20 7b64 6174 612e 696e 6465 785b  te: {data.index[
+0000bd80: 656e 645d 2e64 6174 6528 297d 2229 0a20  end].date()}"). 
+0000bd90: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdb0: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000bdc0: 6622 5c6e 5061 7474 6572 6e20 4e61 6d65  f"\nPattern Name
+0000bdd0: 3a20 7b70 6174 7465 726e 7d2c 204e 756d  : {pattern}, Num
+0000bde0: 6265 7220 6f66 2042 6173 6520 4361 6e64  ber of Base Cand
+0000bdf0: 6c65 3a20 7b62 6173 655f 636f 756e 747d  le: {base_count}
+0000be00: 2229 0a20 2020 2023 2020 2020 2020 2020  ").    #        
+0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be20: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+0000be30: 6974 6528 6622 5c6e 4469 7374 616e 6365  ite(f"\nDistance
+0000be40: 2066 726f 6d20 434d 503a 207b 6469 7374   from CMP: {dist
+0000be50: 5f66 726f 6d5f 636d 703a 2e32 667d 2522  _from_cmp:.2f}%"
+0000be60: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be80: 2020 2020 2020 2020 6966 2073 7570 706c          if suppl
+0000be90: 795f 7072 6f78 696d 616c 5f6c 696e 6573  y_proximal_lines
+0000bea0: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bec0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0000bed0: 2e77 7269 7465 2866 225c 6e50 726f 7869  .write(f"\nProxi
+0000bee0: 6d61 6c20 4c69 6e65 2050 7269 6365 3a20  mal Line Price: 
+0000bef0: 7b73 7570 706c 795f 7072 6f78 696d 616c  {supply_proximal
+0000bf00: 5f6c 696e 6573 5b69 5d3a 2e32 667d 2229  _lines[i]:.2f}")
+0000bf10: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
 0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf30: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-0000bf40: 6528 225c 6e4e 6f20 7375 7070 6c79 207a  e("\nNo supply z
-0000bf50: 6f6e 6520 7061 7474 6572 6e73 2066 6f75  one patterns fou
-0000bf60: 6e64 2e22 290a 0a20 2020 2023 2020 2020  nd.")..    #    
-0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf80: 2066 696c 652e 7772 6974 6528 225c 6e5c   file.write("\n\
-0000bf90: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0000bfa0: 2020 2020 2020 2020 0a20 2020 2023 2020          .    #  
-0000bfb0: 2020 2070 7269 6e74 2822 416e 616c 7973     print("Analys
-0000bfc0: 6973 2063 6f6d 706c 6574 6564 2061 6e64  is completed and
-0000bfd0: 2072 6573 756c 7473 2073 6176 6564 2e22   results saved."
-0000bfe0: 290a 2020 2020 2020 2020 0a20 2020 2023  ).        .    #
-0000bff0: 2046 696e 6420 6163 6375 7261 7465 2062   Find accurate b
-0000c000: 7265 616b 6f75 7420 7661 6c75 650a 2020  reakout value.  
-0000c010: 2020 6465 6620 6669 6e64 4272 6561 6b69    def findBreaki
-0000c020: 6e67 6f75 744e 6f77 2873 656c 662c 2064  ngoutNow(self, d
-0000c030: 662c 2066 756c 6c44 6174 612c 2073 6176  f, fullData, sav
-0000c040: 6544 6963 742c 2073 6372 6565 6e44 6963  eDict, screenDic
-0000c050: 7429 3a0a 2020 2020 2020 2020 6966 2064  t):.        if d
-0000c060: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-0000c070: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-0000c080: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000c090: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-0000c0a0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0000c0b0: 2020 2020 2072 6576 6572 7365 6444 6174       reversedDat
-0000c0c0: 6120 3d20 6675 6c6c 4461 7461 5b3a 3a2d  a = fullData[::-
-0000c0d0: 315d 2e63 6f70 7928 290a 2020 2020 2020  1].copy().      
-0000c0e0: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
-0000c0f0: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
-0000c100: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
-0000c110: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
-0000c120: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
-0000c130: 2020 7265 6365 6e74 203d 2064 6174 612e    recent = data.
-0000c140: 6865 6164 2831 290a 2020 2020 2020 2020  head(1).        
-0000c150: 7265 6365 6e74 4361 6e64 6c65 4865 6967  recentCandleHeig
-0000c160: 6874 203d 2073 656c 662e 6765 7443 616e  ht = self.getCan
-0000c170: 646c 6542 6f64 7948 6569 6768 7428 7265  dleBodyHeight(re
-0000c180: 6365 6e74 290a 2020 2020 2020 2020 6966  cent).        if
-0000c190: 206c 656e 2864 6174 6129 203c 2031 3120   len(data) < 11 
-0000c1a0: 6f72 2072 6563 656e 7443 616e 646c 6548  or recentCandleH
-0000c1b0: 6569 6768 7420 3c3d 2030 3a0a 2020 2020  eight <= 0:.    
-0000c1c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0000c1d0: 616c 7365 0a20 2020 2020 2020 2074 6f74  alse.        tot
-0000c1e0: 616c 4361 6e64 6c65 4865 6967 6874 203d  alCandleHeight =
-0000c1f0: 2030 0a20 2020 2020 2020 2063 616e 646c   0.        candl
-0000c200: 6520 3d20 300a 2020 2020 2020 2020 7768  e = 0.        wh
-0000c210: 696c 6520 6361 6e64 6c65 203c 2031 303a  ile candle < 10:
-0000c220: 0a20 2020 2020 2020 2020 2020 2063 616e  .            can
-0000c230: 646c 6520 2b3d 2031 0a20 2020 2020 2020  dle += 1.       
-0000c240: 2020 2020 2063 616e 646c 6548 6569 6768       candleHeigh
-0000c250: 7420 3d20 6162 7328 7365 6c66 2e67 6574  t = abs(self.get
-0000c260: 4361 6e64 6c65 426f 6479 4865 6967 6874  CandleBodyHeight
-0000c270: 2864 6174 615b 6361 6e64 6c65 3a5d 2929  (data[candle:]))
-0000c280: 0a20 2020 2020 2020 2020 2020 2074 6f74  .            tot
-0000c290: 616c 4361 6e64 6c65 4865 6967 6874 202b  alCandleHeight +
-0000c2a0: 3d20 6361 6e64 6c65 4865 6967 6874 0a0a  = candleHeight..
-0000c2b0: 2020 2020 2020 2020 7265 7665 7273 6564          reversed
-0000c2c0: 4461 7461 2e6c 6f63 5b3a 2c27 4242 616e  Data.loc[:,'BBan
-0000c2d0: 6473 2d55 275d 2c20 7265 7665 7273 6564  ds-U'], reversed
-0000c2e0: 4461 7461 2e6c 6f63 5b3a 2c27 4242 616e  Data.loc[:,'BBan
-0000c2f0: 6473 2d4d 275d 2c20 7265 7665 7273 6564  ds-M'], reversed
-0000c300: 4461 7461 2e6c 6f63 5b3a 2c27 4242 616e  Data.loc[:,'BBan
-0000c310: 6473 2d4c 275d 203d 2070 6b74 616c 6962  ds-L'] = pktalib
-0000c320: 2e42 4241 4e44 5328 7265 7665 7273 6564  .BBANDS(reversed
-0000c330: 4461 7461 5b22 436c 6f73 6522 5d2c 2032  Data["Close"], 2
-0000c340: 3029 0a20 2020 2020 2020 2072 6576 6572  0).        rever
-0000c350: 7365 6444 6174 6120 3d20 7265 7665 7273  sedData = revers
-0000c360: 6564 4461 7461 5b3a 3a2d 315d 0a20 2020  edData[::-1].   
-0000c370: 2020 2020 2072 6563 656e 7473 203d 2072       recents = r
-0000c380: 6576 6572 7365 6444 6174 612e 6865 6164  eversedData.head
-0000c390: 2836 290a 2020 2020 2020 2020 756c 7220  (6).        ulr 
-0000c3a0: 3d20 7365 6c66 2e6e 6f6e 5f7a 6572 6f5f  = self.non_zero_
-0000c3b0: 7261 6e67 6528 7265 6365 6e74 732e 6c6f  range(recents.lo
-0000c3c0: 635b 3a2c 2742 4261 6e64 732d 5527 5d2c  c[:,'BBands-U'],
-0000c3d0: 2072 6563 656e 7473 2e6c 6f63 5b3a 2c27   recents.loc[:,'
-0000c3e0: 4242 616e 6473 2d4c 275d 290a 2020 2020  BBands-L']).    
-0000c3f0: 2020 2020 6d61 784f 664c 6173 7435 4361      maxOfLast5Ca
-0000c400: 6e64 6c65 7320 3d20 756c 722e 7461 696c  ndles = ulr.tail
-0000c410: 2835 292e 6d61 7828 290a 2020 2020 2020  (5).max().      
-0000c420: 2020 2320 6261 6e64 7769 6474 6820 3d20    # bandwidth = 
-0000c430: 3130 3020 2a20 756c 7220 2f20 7265 6365  100 * ulr / rece
-0000c440: 6e74 732e 6c6f 635b 3a2c 2742 4261 6e64  nts.loc[:,'BBand
-0000c450: 732d 4d27 5d0a 2020 2020 2020 2020 2320  s-M'].        # 
-0000c460: 7065 7263 656e 7420 3d20 7365 6c66 2e6e  percent = self.n
-0000c470: 6f6e 5f7a 6572 6f5f 7261 6e67 6528 7265  on_zero_range(re
-0000c480: 6365 6e74 732e 6c6f 635b 3a2c 2743 6c6f  cents.loc[:,'Clo
-0000c490: 7365 275d 2c20 7265 6365 6e74 732e 6c6f  se'], recents.lo
-0000c4a0: 635b 3a2c 2742 4261 6e64 732d 4c27 5d29  c[:,'BBands-L'])
-0000c4b0: 202f 2075 6c72 0a20 2020 2020 2020 2073   / ulr.        s
-0000c4c0: 6176 6544 6963 745b 2262 6261 6e64 735f  aveDict["bbands_
-0000c4d0: 756c 725f 7261 7469 6f5f 6d61 7835 225d  ulr_ratio_max5"]
-0000c4e0: 203d 2072 6f75 6e64 2875 6c72 2e69 6c6f   = round(ulr.ilo
-0000c4f0: 635b 305d 2f6d 6178 4f66 4c61 7374 3543  c[0]/maxOfLast5C
-0000c500: 616e 646c 6573 2c32 2920 2370 6572 6365  andles,2) #perce
-0000c510: 6e74 2e69 6c6f 635b 305d 0a20 2020 2020  nt.iloc[0].     
-0000c520: 2020 2073 6372 6565 6e44 6963 745b 2262     screenDict["b
-0000c530: 6261 6e64 735f 756c 725f 7261 7469 6f5f  bands_ulr_ratio_
-0000c540: 6d61 7835 225d 203d 2073 6176 6544 6963  max5"] = saveDic
-0000c550: 745b 2262 6261 6e64 735f 756c 725f 7261  t["bbands_ulr_ra
-0000c560: 7469 6f5f 6d61 7835 225d 0a20 2020 2020  tio_max5"].     
-0000c570: 2020 2023 2073 6176 6544 6963 745b 2262     # saveDict["b
-0000c580: 6261 6e64 735f 6261 6e64 7769 6474 6822  bands_bandwidth"
-0000c590: 5d20 3d20 6261 6e64 7769 6474 682e 696c  ] = bandwidth.il
-0000c5a0: 6f63 5b30 5d0a 2020 2020 2020 2020 2320  oc[0].        # 
-0000c5b0: 7363 7265 656e 4469 6374 5b22 6262 616e  screenDict["bban
-0000c5c0: 6473 5f62 616e 6477 6964 7468 225d 203d  ds_bandwidth"] =
-0000c5d0: 2073 6176 6544 6963 745b 2262 6261 6e64   saveDict["bband
-0000c5e0: 735f 6261 6e64 7769 6474 6822 5d0a 2020  s_bandwidth"].  
-0000c5f0: 2020 2020 2020 2320 7361 7665 4469 6374        # saveDict
-0000c600: 5b22 6262 616e 6473 5f75 6c72 225d 203d  ["bbands_ulr"] =
-0000c610: 2075 6c72 2e69 6c6f 635b 305d 0a20 2020   ulr.iloc[0].   
-0000c620: 2020 2020 2023 2073 6372 6565 6e44 6963       # screenDic
-0000c630: 745b 2262 6261 6e64 735f 756c 7222 5d20  t["bbands_ulr"] 
-0000c640: 3d20 7361 7665 4469 6374 5b22 6262 616e  = saveDict["bban
-0000c650: 6473 5f75 6c72 225d 0a0a 2020 2020 2020  ds_ulr"]..      
-0000c660: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-0000c670: 2020 2020 2020 2072 6563 656e 7443 616e         recentCan
-0000c680: 646c 6548 6569 6768 7420 3e20 300a 2020  dleHeight > 0.  
-0000c690: 2020 2020 2020 2020 2020 616e 6420 746f            and to
-0000c6a0: 7461 6c43 616e 646c 6548 6569 6768 7420  talCandleHeight 
-0000c6b0: 3e20 300a 2020 2020 2020 2020 2020 2020  > 0.            
-0000c6c0: 616e 6420 2872 6563 656e 7443 616e 646c  and (recentCandl
-0000c6d0: 6548 6569 6768 7420 3e3d 2033 202a 2028  eHeight >= 3 * (
-0000c6e0: 666c 6f61 7428 746f 7461 6c43 616e 646c  float(totalCandl
-0000c6f0: 6548 6569 6768 7420 2f20 6361 6e64 6c65  eHeight / candle
-0000c700: 2929 290a 2020 2020 2020 2020 290a 0a20  ))).        ).. 
-0000c710: 2020 2023 406d 6561 7375 7265 5f74 696d     #@measure_tim
-0000c720: 650a 2020 2020 2320 4669 6e64 2061 6363  e.    # Find acc
-0000c730: 7572 6174 6520 6272 6561 6b6f 7574 2076  urate breakout v
-0000c740: 616c 7565 0a20 2020 2064 6566 2066 696e  alue.    def fin
-0000c750: 6442 7265 616b 6f75 7456 616c 7565 280a  dBreakoutValue(.
-0000c760: 2020 2020 2020 2020 7365 6c66 2c20 6466          self, df
-0000c770: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
-0000c780: 7665 4469 6374 2c20 6461 7973 546f 4c6f  veDict, daysToLo
-0000c790: 6f6b 6261 636b 2c20 616c 7265 6164 7942  okback, alreadyB
-0000c7a0: 726f 6b65 6e6f 7574 3d46 616c 7365 0a20  rokenout=False. 
-0000c7b0: 2020 2029 3a0a 2020 2020 2020 2020 6966     ):.        if
-0000c7c0: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-0000c7d0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-0000c7e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000c7f0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0000c800: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-0000c810: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
-0000c820: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
-0000c830: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0000c840: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
-0000c850: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
-0000c860: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
-0000c870: 6461 7461 2e68 6561 6428 3129 0a20 2020  data.head(1).   
-0000c880: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0000c890: 5b31 3a5d 0a20 2020 2020 2020 206d 6178  [1:].        max
-0000c8a0: 4869 6768 203d 2072 6f75 6e64 2864 6174  High = round(dat
-0000c8b0: 612e 6465 7363 7269 6265 2829 5b22 4869  a.describe()["Hi
-0000c8c0: 6768 225d 5b22 6d61 7822 5d2c 2032 290a  gh"]["max"], 2).
-0000c8d0: 2020 2020 2020 2020 6d61 7843 6c6f 7365          maxClose
-0000c8e0: 203d 2072 6f75 6e64 2864 6174 612e 6465   = round(data.de
-0000c8f0: 7363 7269 6265 2829 5b22 436c 6f73 6522  scribe()["Close"
-0000c900: 5d5b 226d 6178 225d 2c20 3229 0a20 2020  ]["max"], 2).   
-0000c910: 2020 2020 2072 6563 656e 7443 6c6f 7365       recentClose
-0000c920: 203d 2072 6f75 6e64 2872 6563 656e 745b   = round(recent[
-0000c930: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-0000c940: 2c20 3229 0a20 2020 2020 2020 2069 6620  , 2).        if 
-0000c950: 6e70 2e69 736e 616e 286d 6178 436c 6f73  np.isnan(maxClos
-0000c960: 6529 206f 7220 6e70 2e69 736e 616e 286d  e) or np.isnan(m
-0000c970: 6178 4869 6768 293a 0a20 2020 2020 2020  axHigh):.       
-0000c980: 2020 2020 2073 6176 6544 6963 745b 2242       saveDict["B
-0000c990: 7265 616b 6f75 7422 5d20 3d20 2242 4f3a  reakout"] = "BO:
-0000c9a0: 2030 2052 3a20 3022 0a20 2020 2020 2020   0 R: 0".       
-0000c9b0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0000c9c0: 2242 7265 616b 6f75 7422 5d20 3d20 280a  "Breakout"] = (.
-0000c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9e0: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-0000c9f0: 2063 6f6c 6f72 5465 7874 2e57 4152 4e20   colorText.WARN 
-0000ca00: 2b20 2242 4f3a 2030 2052 3a20 3022 202b  + "BO: 0 R: 0" +
-0000ca10: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000ca20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000ca30: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
-0000ca40: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
-0000ca50: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
-0000ca60: 2023 2020 2020 2066 2746 6f72 2053 746f   #     f'For Sto
-0000ca70: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
-0000ca80: 6f63 6b22 5d7d 2c20 7468 6520 6272 6561  ock"]}, the brea
-0000ca90: 6b6f 7574 2069 7320 756e 6b6e 6f77 6e20  kout is unknown 
-0000caa0: 6265 6361 7573 6520 6d61 782d 6869 6768  because max-high
-0000cab0: 2028 7b6d 6178 4869 6768 7d29 206f 7220   ({maxHigh}) or 
-0000cac0: 6d61 782d 636c 6f73 6520 287b 6d61 7843  max-close ({maxC
-0000cad0: 6c6f 7365 7d29 2061 7265 206e 6f74 2064  lose}) are not d
-0000cae0: 6566 696e 6564 2e27 0a20 2020 2020 2020  efined.'.       
-0000caf0: 2020 2020 2023 2029 0a20 2020 2020 2020       # ).       
-0000cb00: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0000cb10: 650a 2020 2020 2020 2020 6966 206d 6178  e.        if max
-0000cb20: 4869 6768 203e 206d 6178 436c 6f73 653a  High > maxClose:
-0000cb30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000cb40: 286d 6178 4869 6768 202d 206d 6178 436c  (maxHigh - maxCl
-0000cb50: 6f73 6529 203c 3d20 286d 6178 4869 6768  ose) <= (maxHigh
-0000cb60: 202a 2032 202f 2031 3030 293a 0a20 2020   * 2 / 100):.   
-0000cb70: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-0000cb80: 6544 6963 745b 2242 7265 616b 6f75 7422  eDict["Breakout"
-0000cb90: 5d20 3d20 2242 4f3a 2022 202b 2073 7472  ] = "BO: " + str
-0000cba0: 286d 6178 436c 6f73 6529 202b 2022 2052  (maxClose) + " R
-0000cbb0: 3a20 2220 2b20 7374 7228 6d61 7848 6967  : " + str(maxHig
-0000cbc0: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-0000cbd0: 2020 2069 6620 7265 6365 6e74 436c 6f73     if recentClos
-0000cbe0: 6520 3e3d 206d 6178 436c 6f73 653a 0a20  e >= maxClose:. 
-0000cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc00: 2020 2073 6372 6565 6e44 6963 745b 2242     screenDict["B
-0000cc10: 7265 616b 6f75 7422 5d20 3d20 280a 2020  reakout"] = (.  
-0000cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc30: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-0000cc40: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-0000cc50: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000cc60: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
-0000cc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc80: 2020 2020 2020 202b 2022 424f 3a20 220a         + "BO: ".
-0000cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cca0: 2020 2020 2020 2020 2b20 7374 7228 6d61          + str(ma
-0000ccb0: 7843 6c6f 7365 290a 2020 2020 2020 2020  xClose).        
-0000ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ccd0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-0000cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ccf0: 2020 2020 2020 2020 2b20 2863 6f6c 6f72          + (color
-0000cd00: 5465 7874 2e47 5245 454e 2069 6620 7265  Text.GREEN if re
-0000cd10: 6365 6e74 436c 6f73 6520 3e3d 206d 6178  centClose >= max
-0000cd20: 4869 6768 2065 6c73 6520 636f 6c6f 7254  High else colorT
-0000cd30: 6578 742e 4641 494c 290a 2020 2020 2020  ext.FAIL).      
-0000cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd50: 2020 2b20 2220 523a 2022 0a20 2020 2020    + " R: ".     
-0000cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd70: 2020 202b 2073 7472 286d 6178 4869 6768     + str(maxHigh
-0000cd80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000cd90: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0000cda0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-0000cdb0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdd0: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
-0000cde0: 6c74 5f6c 6f67 6765 722e 696e 666f 280a  lt_logger.info(.
-0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce00: 2020 2020 2320 2020 2020 6627 5374 6f63      #     f'Stoc
-0000ce10: 6b3a 7b73 6176 6544 6963 745b 2253 746f  k:{saveDict["Sto
-0000ce20: 636b 225d 7d2c 2068 6173 2061 2062 7265  ck"]}, has a bre
-0000ce30: 616b 6f75 7420 6265 6361 7573 6520 6d61  akout because ma
-0000ce40: 782d 6869 6768 2028 7b6d 6178 4869 6768  x-high ({maxHigh
-0000ce50: 7d29 203e 3d20 6d61 782d 636c 6f73 6520  }) >= max-close 
-0000ce60: 287b 6d61 7843 6c6f 7365 7d29 270a 2020  ({maxClose})'.  
-0000ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce80: 2020 2320 290a 2020 2020 2020 2020 2020    # ).          
-0000ce90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000cea0: 2054 7275 6520 616e 6420 616c 7265 6164   True and alread
-0000ceb0: 7942 726f 6b65 6e6f 7574 2061 6e64 2073  yBrokenout and s
-0000cec0: 656c 662e 6765 7443 616e 646c 6554 7970  elf.getCandleTyp
-0000ced0: 6528 7265 6365 6e74 290a 2020 2020 2020  e(recent).      
-0000cee0: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-0000cef0: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-0000cf00: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-0000cf10: 2020 2020 2020 2320 2020 2020 6627 5374        #     f'St
-0000cf20: 6f63 6b3a 7b73 6176 6544 6963 745b 2253  ock:{saveDict["S
-0000cf30: 746f 636b 225d 7d2c 2064 6f65 7320 6e6f  tock"]}, does no
-0000cf40: 7420 6861 7665 2061 2062 7265 616b 6f75  t have a breakou
-0000cf50: 7420 7965 7420 6265 6361 7573 6520 6d61  t yet because ma
-0000cf60: 782d 6869 6768 2028 7b6d 6178 4869 6768  x-high ({maxHigh
-0000cf70: 7d29 203c 206d 6178 2d63 6c6f 7365 2028  }) < max-close (
-0000cf80: 7b6d 6178 436c 6f73 657d 2927 0a20 2020  {maxClose})'.   
-0000cf90: 2020 2020 2020 2020 2020 2020 2023 2029               # )
-0000cfa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cfb0: 2073 6372 6565 6e44 6963 745b 2242 7265   screenDict["Bre
-0000cfc0: 616b 6f75 7422 5d20 3d20 280a 2020 2020  akout"] = (.    
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfe0: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d000: 2020 202b 2063 6f6c 6f72 5465 7874 2e46     + colorText.F
-0000d010: 4149 4c0a 2020 2020 2020 2020 2020 2020  AIL.            
-0000d020: 2020 2020 2020 2020 2b20 2242 4f3a 2022          + "BO: "
-0000d030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d040: 2020 2020 202b 2073 7472 286d 6178 436c       + str(maxCl
-0000d050: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
-0000d060: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0000d070: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0000d080: 2020 2020 2020 2020 2020 2020 202b 2028               + (
-0000d090: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
-0000d0a0: 6966 2072 6563 656e 7443 6c6f 7365 203e  if recentClose >
-0000d0b0: 3d20 6d61 7848 6967 6820 656c 7365 2063  = maxHigh else c
-0000d0c0: 6f6c 6f72 5465 7874 2e46 4149 4c29 0a20  olorText.FAIL). 
-0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0e0: 2020 202b 2022 2052 3a20 220a 2020 2020     + " R: ".    
+0000bf30: 2020 2020 2020 2069 6620 7375 7070 6c79         if supply
+0000bf40: 5f64 6973 7461 6c5f 6c69 6e65 733a 2020  _distal_lines:  
+0000bf50: 2320 496e 636c 7564 6520 6469 7374 616c  # Include distal
+0000bf60: 206c 696e 6520 7072 6963 6520 6966 2061   line price if a
+0000bf70: 7661 696c 6162 6c65 0a20 2020 2023 2020  vailable.    #  
+0000bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfa0: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+0000bfb0: 5c6e 4469 7374 616c 204c 696e 6520 5072  \nDistal Line Pr
+0000bfc0: 6963 653a 207b 7375 7070 6c79 5f64 6973  ice: {supply_dis
+0000bfd0: 7461 6c5f 6c69 6e65 735b 695d 3a2e 3266  tal_lines[i]:.2f
+0000bfe0: 7d22 290a 2020 2020 2320 2020 2020 2020  }").    #       
+0000bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c000: 2020 2020 2020 2020 2020 2320 496e 636c            # Incl
+0000c010: 7564 6520 7a6f 6e65 2072 616e 6765 0a20  ude zone range. 
+0000c020: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c040: 2020 2020 2020 2020 2066 696c 652e 7772           file.wr
+0000c050: 6974 6528 6622 5c6e 5a6f 6e65 2052 616e  ite(f"\nZone Ran
+0000c060: 6765 3a20 7b73 7570 706c 795f 7a6f 6e65  ge: {supply_zone
+0000c070: 5f72 616e 6765 735b 695d 3a2e 3266 7d22  _ranges[i]:.2f}"
+0000c080: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
+0000c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0a0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000c0b0: 6966 2070 726f 7869 6d61 6c20 6c69 6e65  if proximal line
+0000c0c0: 2069 7320 7465 7374 6564 0a20 2020 2023   is tested.    #
+0000c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0f0: 2074 6573 7465 6420 3d20 7365 6c66 2e69   tested = self.i
+0000c100: 735f 7a6f 6e65 5f74 6573 7465 6428 6461  s_zone_tested(da
+0000c110: 7461 2c20 7374 6172 742c 2065 6e64 2c20  ta, start, end, 
+0000c120: 7375 7070 6c79 5f70 726f 7869 6d61 6c5f  supply_proximal_
+0000c130: 6c69 6e65 735b 695d 290a 2020 2020 2320  lines[i]).    # 
+0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c160: 6966 2074 6573 7465 643a 0a20 2020 2023  if tested:.    #
+0000c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c190: 2020 2020 2066 696c 652e 7772 6974 6528       file.write(
+0000c1a0: 225c 6e5a 6f6e 6520 6973 2054 6573 7465  "\nZone is Teste
+0000c1b0: 6422 290a 2020 2020 2320 2020 2020 2020  d").    #       
+0000c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c1e0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c200: 2020 2020 2020 2020 2020 6669 6c65 2e77            file.w
+0000c210: 7269 7465 2822 5c6e 4672 6573 6820 5a6f  rite("\nFresh Zo
+0000c220: 6e65 2229 0a20 2020 2023 2020 2020 2020  ne").    #      
+0000c230: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c240: 6c73 653a 0a20 2020 2023 2020 2020 2020  lse:.    #      
+0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c260: 2020 2066 696c 652e 7772 6974 6528 225c     file.write("\
+0000c270: 6e4e 6f20 7375 7070 6c79 207a 6f6e 6520  nNo supply zone 
+0000c280: 7061 7474 6572 6e73 2066 6f75 6e64 2e22  patterns found."
+0000c290: 290a 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+0000c2a0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000c2b0: 652e 7772 6974 6528 225c 6e5c 6e22 290a  e.write("\n\n").
+0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2d0: 2020 2020 0a20 2020 2023 2020 2020 2070      .    #     p
+0000c2e0: 7269 6e74 2822 416e 616c 7973 6973 2063  rint("Analysis c
+0000c2f0: 6f6d 706c 6574 6564 2061 6e64 2072 6573  ompleted and res
+0000c300: 756c 7473 2073 6176 6564 2e22 290a 2020  ults saved.").  
+0000c310: 2020 2020 2020 0a20 2020 2023 2046 696e        .    # Fin
+0000c320: 6420 6163 6375 7261 7465 2062 7265 616b  d accurate break
+0000c330: 6f75 7420 7661 6c75 650a 2020 2020 6465  out value.    de
+0000c340: 6620 6669 6e64 4272 6561 6b69 6e67 6f75  f findBreakingou
+0000c350: 744e 6f77 2873 656c 662c 2064 662c 2066  tNow(self, df, f
+0000c360: 756c 6c44 6174 612c 2073 6176 6544 6963  ullData, saveDic
+0000c370: 742c 2073 6372 6565 6e44 6963 7429 3a0a  t, screenDict):.
+0000c380: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0000c390: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0000c3a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000c3b0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000c3c0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000c3d0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0000c3e0: 2072 6576 6572 7365 6444 6174 6120 3d20   reversedData = 
+0000c3f0: 6675 6c6c 4461 7461 5b3a 3a2d 315d 2e63  fullData[::-1].c
+0000c400: 6f70 7928 290a 2020 2020 2020 2020 6461  opy().        da
+0000c410: 7461 203d 2064 6174 612e 6669 6c6c 6e61  ta = data.fillna
+0000c420: 2830 290a 2020 2020 2020 2020 6461 7461  (0).        data
+0000c430: 203d 2064 6174 612e 7265 706c 6163 6528   = data.replace(
+0000c440: 5b6e 702e 696e 662c 202d 6e70 2e69 6e66  [np.inf, -np.inf
+0000c450: 5d2c 2030 290a 2020 2020 2020 2020 7265  ], 0).        re
+0000c460: 6365 6e74 203d 2064 6174 612e 6865 6164  cent = data.head
+0000c470: 2831 290a 2020 2020 2020 2020 7265 6365  (1).        rece
+0000c480: 6e74 4361 6e64 6c65 4865 6967 6874 203d  ntCandleHeight =
+0000c490: 2073 656c 662e 6765 7443 616e 646c 6542   self.getCandleB
+0000c4a0: 6f64 7948 6569 6768 7428 7265 6365 6e74  odyHeight(recent
+0000c4b0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+0000c4c0: 2864 6174 6129 203c 2031 3120 6f72 2072  (data) < 11 or r
+0000c4d0: 6563 656e 7443 616e 646c 6548 6569 6768  ecentCandleHeigh
+0000c4e0: 7420 3c3d 2030 3a0a 2020 2020 2020 2020  t <= 0:.        
+0000c4f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000c500: 0a20 2020 2020 2020 2074 6f74 616c 4361  .        totalCa
+0000c510: 6e64 6c65 4865 6967 6874 203d 2030 0a20  ndleHeight = 0. 
+0000c520: 2020 2020 2020 2063 616e 646c 6520 3d20         candle = 
+0000c530: 300a 2020 2020 2020 2020 7768 696c 6520  0.        while 
+0000c540: 6361 6e64 6c65 203c 2031 303a 0a20 2020  candle < 10:.   
+0000c550: 2020 2020 2020 2020 2063 616e 646c 6520           candle 
+0000c560: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0000c570: 2063 616e 646c 6548 6569 6768 7420 3d20   candleHeight = 
+0000c580: 6162 7328 7365 6c66 2e67 6574 4361 6e64  abs(self.getCand
+0000c590: 6c65 426f 6479 4865 6967 6874 2864 6174  leBodyHeight(dat
+0000c5a0: 615b 6361 6e64 6c65 3a5d 2929 0a20 2020  a[candle:])).   
+0000c5b0: 2020 2020 2020 2020 2074 6f74 616c 4361           totalCa
+0000c5c0: 6e64 6c65 4865 6967 6874 202b 3d20 6361  ndleHeight += ca
+0000c5d0: 6e64 6c65 4865 6967 6874 0a0a 2020 2020  ndleHeight..    
+0000c5e0: 2020 2020 7265 7665 7273 6564 4461 7461      reversedData
+0000c5f0: 2e6c 6f63 5b3a 2c27 4242 616e 6473 2d55  .loc[:,'BBands-U
+0000c600: 275d 2c20 7265 7665 7273 6564 4461 7461  '], reversedData
+0000c610: 2e6c 6f63 5b3a 2c27 4242 616e 6473 2d4d  .loc[:,'BBands-M
+0000c620: 275d 2c20 7265 7665 7273 6564 4461 7461  '], reversedData
+0000c630: 2e6c 6f63 5b3a 2c27 4242 616e 6473 2d4c  .loc[:,'BBands-L
+0000c640: 275d 203d 2070 6b74 616c 6962 2e42 4241  '] = pktalib.BBA
+0000c650: 4e44 5328 7265 7665 7273 6564 4461 7461  NDS(reversedData
+0000c660: 5b22 436c 6f73 6522 5d2c 2032 3029 0a20  ["Close"], 20). 
+0000c670: 2020 2020 2020 2072 6576 6572 7365 6444         reversedD
+0000c680: 6174 6120 3d20 7265 7665 7273 6564 4461  ata = reversedDa
+0000c690: 7461 5b3a 3a2d 315d 0a20 2020 2020 2020  ta[::-1].       
+0000c6a0: 2072 6563 656e 7473 203d 2072 6576 6572   recents = rever
+0000c6b0: 7365 6444 6174 612e 6865 6164 2836 290a  sedData.head(6).
+0000c6c0: 2020 2020 2020 2020 756c 7220 3d20 7365          ulr = se
+0000c6d0: 6c66 2e6e 6f6e 5f7a 6572 6f5f 7261 6e67  lf.non_zero_rang
+0000c6e0: 6528 7265 6365 6e74 732e 6c6f 635b 3a2c  e(recents.loc[:,
+0000c6f0: 2742 4261 6e64 732d 5527 5d2c 2072 6563  'BBands-U'], rec
+0000c700: 656e 7473 2e6c 6f63 5b3a 2c27 4242 616e  ents.loc[:,'BBan
+0000c710: 6473 2d4c 275d 290a 2020 2020 2020 2020  ds-L']).        
+0000c720: 6d61 784f 664c 6173 7435 4361 6e64 6c65  maxOfLast5Candle
+0000c730: 7320 3d20 756c 722e 7461 696c 2835 292e  s = ulr.tail(5).
+0000c740: 6d61 7828 290a 2020 2020 2020 2020 2320  max().        # 
+0000c750: 6261 6e64 7769 6474 6820 3d20 3130 3020  bandwidth = 100 
+0000c760: 2a20 756c 7220 2f20 7265 6365 6e74 732e  * ulr / recents.
+0000c770: 6c6f 635b 3a2c 2742 4261 6e64 732d 4d27  loc[:,'BBands-M'
+0000c780: 5d0a 2020 2020 2020 2020 2320 7065 7263  ].        # perc
+0000c790: 656e 7420 3d20 7365 6c66 2e6e 6f6e 5f7a  ent = self.non_z
+0000c7a0: 6572 6f5f 7261 6e67 6528 7265 6365 6e74  ero_range(recent
+0000c7b0: 732e 6c6f 635b 3a2c 2743 6c6f 7365 275d  s.loc[:,'Close']
+0000c7c0: 2c20 7265 6365 6e74 732e 6c6f 635b 3a2c  , recents.loc[:,
+0000c7d0: 2742 4261 6e64 732d 4c27 5d29 202f 2075  'BBands-L']) / u
+0000c7e0: 6c72 0a20 2020 2020 2020 2073 6176 6544  lr.        saveD
+0000c7f0: 6963 745b 2262 6261 6e64 735f 756c 725f  ict["bbands_ulr_
+0000c800: 7261 7469 6f5f 6d61 7835 225d 203d 2072  ratio_max5"] = r
+0000c810: 6f75 6e64 2875 6c72 2e69 6c6f 635b 305d  ound(ulr.iloc[0]
+0000c820: 2f6d 6178 4f66 4c61 7374 3543 616e 646c  /maxOfLast5Candl
+0000c830: 6573 2c32 2920 2370 6572 6365 6e74 2e69  es,2) #percent.i
+0000c840: 6c6f 635b 305d 0a20 2020 2020 2020 2073  loc[0].        s
+0000c850: 6372 6565 6e44 6963 745b 2262 6261 6e64  creenDict["bband
+0000c860: 735f 756c 725f 7261 7469 6f5f 6d61 7835  s_ulr_ratio_max5
+0000c870: 225d 203d 2073 6176 6544 6963 745b 2262  "] = saveDict["b
+0000c880: 6261 6e64 735f 756c 725f 7261 7469 6f5f  bands_ulr_ratio_
+0000c890: 6d61 7835 225d 0a20 2020 2020 2020 2023  max5"].        #
+0000c8a0: 2073 6176 6544 6963 745b 2262 6261 6e64   saveDict["bband
+0000c8b0: 735f 6261 6e64 7769 6474 6822 5d20 3d20  s_bandwidth"] = 
+0000c8c0: 6261 6e64 7769 6474 682e 696c 6f63 5b30  bandwidth.iloc[0
+0000c8d0: 5d0a 2020 2020 2020 2020 2320 7363 7265  ].        # scre
+0000c8e0: 656e 4469 6374 5b22 6262 616e 6473 5f62  enDict["bbands_b
+0000c8f0: 616e 6477 6964 7468 225d 203d 2073 6176  andwidth"] = sav
+0000c900: 6544 6963 745b 2262 6261 6e64 735f 6261  eDict["bbands_ba
+0000c910: 6e64 7769 6474 6822 5d0a 2020 2020 2020  ndwidth"].      
+0000c920: 2020 2320 7361 7665 4469 6374 5b22 6262    # saveDict["bb
+0000c930: 616e 6473 5f75 6c72 225d 203d 2075 6c72  ands_ulr"] = ulr
+0000c940: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+0000c950: 2023 2073 6372 6565 6e44 6963 745b 2262   # screenDict["b
+0000c960: 6261 6e64 735f 756c 7222 5d20 3d20 7361  bands_ulr"] = sa
+0000c970: 7665 4469 6374 5b22 6262 616e 6473 5f75  veDict["bbands_u
+0000c980: 6c72 225d 0a0a 2020 2020 2020 2020 7265  lr"]..        re
+0000c990: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+0000c9a0: 2020 2072 6563 656e 7443 616e 646c 6548     recentCandleH
+0000c9b0: 6569 6768 7420 3e20 300a 2020 2020 2020  eight > 0.      
+0000c9c0: 2020 2020 2020 616e 6420 746f 7461 6c43        and totalC
+0000c9d0: 616e 646c 6548 6569 6768 7420 3e20 300a  andleHeight > 0.
+0000c9e0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000c9f0: 2872 6563 656e 7443 616e 646c 6548 6569  (recentCandleHei
+0000ca00: 6768 7420 3e3d 2033 202a 2028 666c 6f61  ght >= 3 * (floa
+0000ca10: 7428 746f 7461 6c43 616e 646c 6548 6569  t(totalCandleHei
+0000ca20: 6768 7420 2f20 6361 6e64 6c65 2929 290a  ght / candle))).
+0000ca30: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
+0000ca40: 406d 6561 7375 7265 5f74 696d 650a 2020  @measure_time.  
+0000ca50: 2020 2320 4669 6e64 2061 6363 7572 6174    # Find accurat
+0000ca60: 6520 6272 6561 6b6f 7574 2076 616c 7565  e breakout value
+0000ca70: 0a20 2020 2064 6566 2066 696e 6442 7265  .    def findBre
+0000ca80: 616b 6f75 7456 616c 7565 280a 2020 2020  akoutValue(.    
+0000ca90: 2020 2020 7365 6c66 2c20 6466 2c20 7363      self, df, sc
+0000caa0: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+0000cab0: 6374 2c20 6461 7973 546f 4c6f 6f6b 6261  ct, daysToLookba
+0000cac0: 636b 2c20 616c 7265 6164 7942 726f 6b65  ck, alreadyBroke
+0000cad0: 6e6f 7574 3d46 616c 7365 0a20 2020 2029  nout=False.    )
+0000cae0: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+0000caf0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+0000cb00: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+0000cb10: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000cb20: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+0000cb30: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+0000cb40: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
+0000cb50: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+0000cb60: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
+0000cb70: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
+0000cb80: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
+0000cb90: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000cba0: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
+0000cbb0: 2064 6174 6120 3d20 6461 7461 5b31 3a5d   data = data[1:]
+0000cbc0: 0a20 2020 2020 2020 206d 6178 4869 6768  .        maxHigh
+0000cbd0: 203d 2072 6f75 6e64 2864 6174 612e 6465   = round(data.de
+0000cbe0: 7363 7269 6265 2829 5b22 4869 6768 225d  scribe()["High"]
+0000cbf0: 5b22 6d61 7822 5d2c 2032 290a 2020 2020  ["max"], 2).    
+0000cc00: 2020 2020 6d61 7843 6c6f 7365 203d 2072      maxClose = r
+0000cc10: 6f75 6e64 2864 6174 612e 6465 7363 7269  ound(data.descri
+0000cc20: 6265 2829 5b22 436c 6f73 6522 5d5b 226d  be()["Close"]["m
+0000cc30: 6178 225d 2c20 3229 0a20 2020 2020 2020  ax"], 2).       
+0000cc40: 2072 6563 656e 7443 6c6f 7365 203d 2072   recentClose = r
+0000cc50: 6f75 6e64 2872 6563 656e 745b 2243 6c6f  ound(recent["Clo
+0000cc60: 7365 225d 2e69 6c6f 635b 305d 2c20 3229  se"].iloc[0], 2)
+0000cc70: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
+0000cc80: 736e 616e 286d 6178 436c 6f73 6529 206f  snan(maxClose) o
+0000cc90: 7220 6e70 2e69 736e 616e 286d 6178 4869  r np.isnan(maxHi
+0000cca0: 6768 293a 0a20 2020 2020 2020 2020 2020  gh):.           
+0000ccb0: 2073 6176 6544 6963 745b 2242 7265 616b   saveDict["Break
+0000ccc0: 6f75 7422 5d20 3d20 2242 4f3a 2030 2052  out"] = "BO: 0 R
+0000ccd0: 3a20 3022 0a20 2020 2020 2020 2020 2020  : 0".           
+0000cce0: 2073 6372 6565 6e44 6963 745b 2242 7265   screenDict["Bre
+0000ccf0: 616b 6f75 7422 5d20 3d20 280a 2020 2020  akout"] = (.    
+0000cd00: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0000cd10: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+0000cd20: 6f72 5465 7874 2e57 4152 4e20 2b20 2242  orText.WARN + "B
+0000cd30: 4f3a 2030 2052 3a20 3022 202b 2063 6f6c  O: 0 R: 0" + col
+0000cd40: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0000cd50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000cd60: 2020 2020 2023 2073 656c 662e 6465 6661       # self.defa
+0000cd70: 756c 745f 6c6f 6767 6572 2e69 6e66 6f28  ult_logger.info(
+0000cd80: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0000cd90: 2020 2066 2746 6f72 2053 746f 636b 3a7b     f'For Stock:{
+0000cda0: 7361 7665 4469 6374 5b22 5374 6f63 6b22  saveDict["Stock"
+0000cdb0: 5d7d 2c20 7468 6520 6272 6561 6b6f 7574  ]}, the breakout
+0000cdc0: 2069 7320 756e 6b6e 6f77 6e20 6265 6361   is unknown beca
+0000cdd0: 7573 6520 6d61 782d 6869 6768 2028 7b6d  use max-high ({m
+0000cde0: 6178 4869 6768 7d29 206f 7220 6d61 782d  axHigh}) or max-
+0000cdf0: 636c 6f73 6520 287b 6d61 7843 6c6f 7365  close ({maxClose
+0000ce00: 7d29 2061 7265 206e 6f74 2064 6566 696e  }) are not defin
+0000ce10: 6564 2e27 0a20 2020 2020 2020 2020 2020  ed.'.           
+0000ce20: 2023 2029 0a20 2020 2020 2020 2020 2020   # ).           
+0000ce30: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000ce40: 2020 2020 2020 6966 206d 6178 4869 6768        if maxHigh
+0000ce50: 203e 206d 6178 436c 6f73 653a 0a20 2020   > maxClose:.   
+0000ce60: 2020 2020 2020 2020 2069 6620 286d 6178           if (max
+0000ce70: 4869 6768 202d 206d 6178 436c 6f73 6529  High - maxClose)
+0000ce80: 203c 3d20 286d 6178 4869 6768 202a 2032   <= (maxHigh * 2
+0000ce90: 202f 2031 3030 293a 0a20 2020 2020 2020   / 100):.       
+0000cea0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+0000ceb0: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
+0000cec0: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
+0000ced0: 436c 6f73 6529 202b 2022 2052 3a20 2220  Close) + " R: " 
+0000cee0: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cf00: 6620 7265 6365 6e74 436c 6f73 6520 3e3d  f recentClose >=
+0000cf10: 206d 6178 436c 6f73 653a 0a20 2020 2020   maxClose:.     
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000cf30: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
+0000cf40: 6f75 7422 5d20 3d20 280a 2020 2020 2020  out"] = (.      
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf60: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
+0000cf70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cf80: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000cf90: 5465 7874 2e47 5245 454e 0a20 2020 2020  Text.GREEN.     
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfb0: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfd0: 2020 2020 2b20 7374 7228 6d61 7843 6c6f      + str(maxClo
+0000cfe0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+0000cff0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0000d000: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+0000d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d020: 2020 2020 2b20 2863 6f6c 6f72 5465 7874      + (colorText
+0000d030: 2e47 5245 454e 2069 6620 7265 6365 6e74  .GREEN if recent
+0000d040: 436c 6f73 6520 3e3d 206d 6178 4869 6768  Close >= maxHigh
+0000d050: 2065 6c73 6520 636f 6c6f 7254 6578 742e   else colorText.
+0000d060: 4641 494c 290a 2020 2020 2020 2020 2020  FAIL).          
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000d080: 2220 523a 2022 0a20 2020 2020 2020 2020  " R: ".         
+0000d090: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d0a0: 2073 7472 286d 6178 4869 6768 290a 2020   str(maxHigh).  
+0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0c0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0000d0d0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+0000d0e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
 0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d100: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d120: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-0000d130: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-0000d140: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d150: 2020 2020 2072 6574 7572 6e20 6e6f 7420       return not 
-0000d160: 616c 7265 6164 7942 726f 6b65 6e6f 7574  alreadyBrokenout
-0000d170: 0a20 2020 2020 2020 2020 2020 206e 6f4f  .            noO
-0000d180: 6648 6967 6865 7253 6861 646f 7773 203d  fHigherShadows =
-0000d190: 206c 656e 2864 6174 615b 6461 7461 2e48   len(data[data.H
-0000d1a0: 6967 6820 3e20 6d61 7843 6c6f 7365 5d29  igh > maxClose])
-0000d1b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d1c0: 6461 7973 546f 4c6f 6f6b 6261 636b 202f  daysToLookback /
-0000d1d0: 206e 6f4f 6648 6967 6865 7253 6861 646f   noOfHigherShado
-0000d1e0: 7773 203c 3d20 333a 0a20 2020 2020 2020  ws <= 3:.       
-0000d1f0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0000d200: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
-0000d210: 2242 4f3a 2022 202b 2073 7472 286d 6178  "BO: " + str(max
-0000d220: 4869 6768 2920 2b20 2220 523a 2030 220a  High) + " R: 0".
-0000d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d240: 6966 2072 6563 656e 7443 6c6f 7365 203e  if recentClose >
-0000d250: 3d20 6d61 7848 6967 683a 0a20 2020 2020  = maxHigh:.     
-0000d260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d270: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
-0000d280: 6f75 7422 5d20 3d20 280a 2020 2020 2020  out"] = (.      
-0000d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2a0: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
-0000d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d2c0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0000d2d0: 5465 7874 2e47 5245 454e 0a20 2020 2020  Text.GREEN.     
-0000d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2f0: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
-0000d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d310: 2020 2020 2b20 7374 7228 6d61 7848 6967      + str(maxHig
-0000d320: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-0000d330: 2020 2020 2020 2020 2020 202b 2022 2052             + " R
-0000d340: 3a20 3022 0a20 2020 2020 2020 2020 2020  : 0".           
-0000d350: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0000d360: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d380: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000d390: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
-0000d3a0: 6661 756c 745f 6c6f 6767 6572 2e69 6e66  fault_logger.inf
-0000d3b0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
-0000d3c0: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
-0000d3d0: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
-0000d3e0: 5374 6f63 6b22 5d7d 2c20 6861 7320 6120  Stock"]}, has a 
-0000d3f0: 6272 6561 6b6f 7574 2062 6563 6175 7365  breakout because
-0000d400: 2072 6563 656e 742d 636c 6f73 6520 287b   recent-close ({
-0000d410: 7265 6365 6e74 436c 6f73 657d 2920 3e3d  recentClose}) >=
-0000d420: 206d 6178 2d68 6967 6820 287b 6d61 7848   max-high ({maxH
-0000d430: 6967 687d 2927 0a20 2020 2020 2020 2020  igh})'.         
-0000d440: 2020 2020 2020 2020 2020 2023 2029 0a20             # ). 
-0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d460: 2020 2072 6574 7572 6e20 5472 7565 2061     return True a
-0000d470: 6e64 2061 6c72 6561 6479 4272 6f6b 656e  nd alreadyBroken
-0000d480: 6f75 7420 616e 6420 7365 6c66 2e67 6574  out and self.get
-0000d490: 4361 6e64 6c65 5479 7065 2872 6563 656e  CandleType(recen
-0000d4a0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0000d4b0: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
-0000d4c0: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
-0000d4d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000d4e0: 2020 2020 2066 2753 746f 636b 3a7b 7361       f'Stock:{sa
-0000d4f0: 7665 4469 6374 5b22 5374 6f63 6b22 5d7d  veDict["Stock"]}
-0000d500: 2c20 646f 6573 206e 6f74 2068 6176 6520  , does not have 
-0000d510: 6120 6272 6561 6b6f 7574 2079 6574 2062  a breakout yet b
-0000d520: 6563 6175 7365 2072 6563 656e 742d 636c  ecause recent-cl
-0000d530: 6f73 6520 287b 7265 6365 6e74 436c 6f73  ose ({recentClos
-0000d540: 657d 2920 3c20 6d61 782d 6869 6768 2028  e}) < max-high (
-0000d550: 7b6d 6178 4869 6768 7d29 270a 2020 2020  {maxHigh})'.    
-0000d560: 2020 2020 2020 2020 2020 2020 2320 290a              # ).
-0000d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d580: 7363 7265 656e 4469 6374 5b22 4272 6561  screenDict["Brea
-0000d590: 6b6f 7574 225d 203d 2028 0a20 2020 2020  kout"] = (.     
-0000d5a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000d5b0: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
-0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5d0: 2020 2b20 636f 6c6f 7254 6578 742e 4641    + colorText.FA
-0000d5e0: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
-0000d5f0: 2020 2020 2020 202b 2022 424f 3a20 220a         + "BO: ".
-0000d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d610: 2020 2020 2b20 7374 7228 6d61 7848 6967      + str(maxHig
-0000d620: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-0000d630: 2020 2020 2020 202b 2022 2052 3a20 3022         + " R: 0"
-0000d640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d650: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0000d660: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0000d670: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000d680: 2020 2020 2020 2072 6574 7572 6e20 6e6f         return no
-0000d690: 7420 616c 7265 6164 7942 726f 6b65 6e6f  t alreadyBrokeno
-0000d6a0: 7574 0a20 2020 2020 2020 2020 2020 2073  ut.            s
-0000d6b0: 6176 6544 6963 745b 2242 7265 616b 6f75  aveDict["Breakou
-0000d6c0: 7422 5d20 3d20 2242 4f3a 2022 202b 2073  t"] = "BO: " + s
-0000d6d0: 7472 286d 6178 436c 6f73 6529 202b 2022  tr(maxClose) + "
-0000d6e0: 2052 3a20 2220 2b20 7374 7228 6d61 7848   R: " + str(maxH
-0000d6f0: 6967 6829 0a20 2020 2020 2020 2020 2020  igh).           
-0000d700: 2069 6620 7265 6365 6e74 436c 6f73 6520   if recentClose 
-0000d710: 3e3d 206d 6178 436c 6f73 653a 0a20 2020  >= maxClose:.   
-0000d720: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0000d730: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-0000d740: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-0000d750: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
-0000d760: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
-0000d770: 5b22 5374 6f63 6b22 5d7d 2c20 6861 7320  ["Stock"]}, has 
-0000d780: 6120 6272 6561 6b6f 7574 2062 6563 6175  a breakout becau
-0000d790: 7365 2072 6563 656e 742d 636c 6f73 6520  se recent-close 
-0000d7a0: 287b 7265 6365 6e74 436c 6f73 657d 2920  ({recentClose}) 
-0000d7b0: 3e3d 206d 6178 2d63 6c6f 7365 2028 7b6d  >= max-close ({m
-0000d7c0: 6178 436c 6f73 657d 2927 0a20 2020 2020  axClose})'.     
-0000d7d0: 2020 2020 2020 2020 2020 2023 2029 0a20             # ). 
-0000d7e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d7f0: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
-0000d800: 6f75 7422 5d20 3d20 280a 2020 2020 2020  out"] = (.      
-0000d810: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000d820: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
-0000d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d840: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
-0000d850: 454e 0a20 2020 2020 2020 2020 2020 2020  EN.             
-0000d860: 2020 2020 2020 202b 2022 424f 3a20 220a         + "BO: ".
-0000d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d880: 2020 2020 2b20 7374 7228 6d61 7843 6c6f      + str(maxClo
-0000d890: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-0000d8a0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-0000d8b0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-0000d8c0: 2020 2020 2020 2020 2020 2020 2b20 2863              + (c
-0000d8d0: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
-0000d8e0: 6620 7265 6365 6e74 436c 6f73 6520 3e3d  f recentClose >=
-0000d8f0: 206d 6178 4869 6768 2065 6c73 6520 636f   maxHigh else co
-0000d900: 6c6f 7254 6578 742e 4641 494c 290a 2020  lorText.FAIL).  
+0000d100: 2320 7365 6c66 2e64 6566 6175 6c74 5f6c  # self.default_l
+0000d110: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+0000d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d130: 2320 2020 2020 6627 5374 6f63 6b3a 7b73  #     f'Stock:{s
+0000d140: 6176 6544 6963 745b 2253 746f 636b 225d  aveDict["Stock"]
+0000d150: 7d2c 2068 6173 2061 2062 7265 616b 6f75  }, has a breakou
+0000d160: 7420 6265 6361 7573 6520 6d61 782d 6869  t because max-hi
+0000d170: 6768 2028 7b6d 6178 4869 6768 7d29 203e  gh ({maxHigh}) >
+0000d180: 3d20 6d61 782d 636c 6f73 6520 287b 6d61  = max-close ({ma
+0000d190: 7843 6c6f 7365 7d29 270a 2020 2020 2020  xClose})'.      
+0000d1a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000d1b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d1c0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000d1d0: 6520 616e 6420 616c 7265 6164 7942 726f  e and alreadyBro
+0000d1e0: 6b65 6e6f 7574 2061 6e64 2073 656c 662e  kenout and self.
+0000d1f0: 6765 7443 616e 646c 6554 7970 6528 7265  getCandleType(re
+0000d200: 6365 6e74 290a 2020 2020 2020 2020 2020  cent).          
+0000d210: 2020 2020 2020 2320 7365 6c66 2e64 6566        # self.def
+0000d220: 6175 6c74 5f6c 6f67 6765 722e 696e 666f  ault_logger.info
+0000d230: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d240: 2020 2320 2020 2020 6627 5374 6f63 6b3a    #     f'Stock:
+0000d250: 7b73 6176 6544 6963 745b 2253 746f 636b  {saveDict["Stock
+0000d260: 225d 7d2c 2064 6f65 7320 6e6f 7420 6861  "]}, does not ha
+0000d270: 7665 2061 2062 7265 616b 6f75 7420 7965  ve a breakout ye
+0000d280: 7420 6265 6361 7573 6520 6d61 782d 6869  t because max-hi
+0000d290: 6768 2028 7b6d 6178 4869 6768 7d29 203c  gh ({maxHigh}) <
+0000d2a0: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
+0000d2b0: 436c 6f73 657d 2927 0a20 2020 2020 2020  Close})'.       
+0000d2c0: 2020 2020 2020 2020 2023 2029 0a20 2020           # ).   
+0000d2d0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0000d2e0: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
+0000d2f0: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
+0000d300: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0000d310: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+0000d320: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d330: 2063 6f6c 6f72 5465 7874 2e46 4149 4c0a   colorText.FAIL.
+0000d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d350: 2020 2020 2b20 2242 4f3a 2022 0a20 2020      + "BO: ".   
+0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d370: 202b 2073 7472 286d 6178 436c 6f73 6529   + str(maxClose)
+0000d380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d390: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0000d3a0: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0000d3b0: 2020 2020 2020 2020 202b 2028 636f 6c6f           + (colo
+0000d3c0: 7254 6578 742e 4752 4545 4e20 6966 2072  rText.GREEN if r
+0000d3d0: 6563 656e 7443 6c6f 7365 203e 3d20 6d61  ecentClose >= ma
+0000d3e0: 7848 6967 6820 656c 7365 2063 6f6c 6f72  xHigh else color
+0000d3f0: 5465 7874 2e46 4149 4c29 0a20 2020 2020  Text.FAIL).     
+0000d400: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d410: 2022 2052 3a20 220a 2020 2020 2020 2020   " R: ".        
+0000d420: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
+0000d430: 7228 6d61 7848 6967 6829 0a20 2020 2020  r(maxHigh).     
+0000d440: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d450: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+0000d460: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d480: 2072 6574 7572 6e20 6e6f 7420 616c 7265   return not alre
+0000d490: 6164 7942 726f 6b65 6e6f 7574 0a20 2020  adyBrokenout.   
+0000d4a0: 2020 2020 2020 2020 206e 6f4f 6648 6967           noOfHig
+0000d4b0: 6865 7253 6861 646f 7773 203d 206c 656e  herShadows = len
+0000d4c0: 2864 6174 615b 6461 7461 2e48 6967 6820  (data[data.High 
+0000d4d0: 3e20 6d61 7843 6c6f 7365 5d29 0a20 2020  > maxClose]).   
+0000d4e0: 2020 2020 2020 2020 2069 6620 6461 7973           if days
+0000d4f0: 546f 4c6f 6f6b 6261 636b 202f 206e 6f4f  ToLookback / noO
+0000d500: 6648 6967 6865 7253 6861 646f 7773 203c  fHigherShadows <
+0000d510: 3d20 333a 0a20 2020 2020 2020 2020 2020  = 3:.           
+0000d520: 2020 2020 2073 6176 6544 6963 745b 2242       saveDict["B
+0000d530: 7265 616b 6f75 7422 5d20 3d20 2242 4f3a  reakout"] = "BO:
+0000d540: 2022 202b 2073 7472 286d 6178 4869 6768   " + str(maxHigh
+0000d550: 2920 2b20 2220 523a 2030 220a 2020 2020  ) + " R: 0".    
+0000d560: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0000d570: 6563 656e 7443 6c6f 7365 203e 3d20 6d61  ecentClose >= ma
+0000d580: 7848 6967 683a 0a20 2020 2020 2020 2020  xHigh:.         
+0000d590: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000d5a0: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
+0000d5b0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000d5d0: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+0000d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5f0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0000d600: 2e47 5245 454e 0a20 2020 2020 2020 2020  .GREEN.         
+0000d610: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000d620: 2022 424f 3a20 220a 2020 2020 2020 2020   "BO: ".        
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d640: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
+0000d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d660: 2020 2020 2020 202b 2022 2052 3a20 3022         + " R: 0"
+0000d670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d680: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0000d690: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0000d6a0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6c0: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
+0000d6d0: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
+0000d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6f0: 2020 2023 2020 2020 2066 2753 746f 636b     #     f'Stock
+0000d700: 3a7b 7361 7665 4469 6374 5b22 5374 6f63  :{saveDict["Stoc
+0000d710: 6b22 5d7d 2c20 6861 7320 6120 6272 6561  k"]}, has a brea
+0000d720: 6b6f 7574 2062 6563 6175 7365 2072 6563  kout because rec
+0000d730: 656e 742d 636c 6f73 6520 287b 7265 6365  ent-close ({rece
+0000d740: 6e74 436c 6f73 657d 2920 3e3d 206d 6178  ntClose}) >= max
+0000d750: 2d68 6967 6820 287b 6d61 7848 6967 687d  -high ({maxHigh}
+0000d760: 2927 0a20 2020 2020 2020 2020 2020 2020  )'.             
+0000d770: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+0000d780: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d790: 6574 7572 6e20 5472 7565 2061 6e64 2061  eturn True and a
+0000d7a0: 6c72 6561 6479 4272 6f6b 656e 6f75 7420  lreadyBrokenout 
+0000d7b0: 616e 6420 7365 6c66 2e67 6574 4361 6e64  and self.getCand
+0000d7c0: 6c65 5479 7065 2872 6563 656e 7429 0a20  leType(recent). 
+0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000d7e0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+0000d7f0: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
+0000d800: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0000d810: 2066 2753 746f 636b 3a7b 7361 7665 4469   f'Stock:{saveDi
+0000d820: 6374 5b22 5374 6f63 6b22 5d7d 2c20 646f  ct["Stock"]}, do
+0000d830: 6573 206e 6f74 2068 6176 6520 6120 6272  es not have a br
+0000d840: 6561 6b6f 7574 2079 6574 2062 6563 6175  eakout yet becau
+0000d850: 7365 2072 6563 656e 742d 636c 6f73 6520  se recent-close 
+0000d860: 287b 7265 6365 6e74 436c 6f73 657d 2920  ({recentClose}) 
+0000d870: 3c20 6d61 782d 6869 6768 2028 7b6d 6178  < max-high ({max
+0000d880: 4869 6768 7d29 270a 2020 2020 2020 2020  High})'.        
+0000d890: 2020 2020 2020 2020 2320 290a 2020 2020          # ).    
+0000d8a0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+0000d8b0: 656e 4469 6374 5b22 4272 6561 6b6f 7574  enDict["Breakout
+0000d8c0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0000d8d0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0000d8e0: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+0000d8f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000d900: 636f 6c6f 7254 6578 742e 4641 494c 0a20  colorText.FAIL. 
 0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d920: 2020 2b20 2220 523a 2022 0a20 2020 2020    + " R: ".     
-0000d930: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000d940: 2073 7472 286d 6178 4869 6768 290a 2020   str(maxHigh).  
+0000d920: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
+0000d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d940: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
 0000d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d960: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0000d970: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0000d980: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000d990: 2020 2020 7265 7475 726e 2054 7275 6520      return True 
-0000d9a0: 616e 6420 616c 7265 6164 7942 726f 6b65  and alreadyBroke
-0000d9b0: 6e6f 7574 2061 6e64 2073 656c 662e 6765  nout and self.ge
-0000d9c0: 7443 616e 646c 6554 7970 6528 7265 6365  tCandleType(rece
-0000d9d0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0000d9e0: 2320 7365 6c66 2e64 6566 6175 6c74 5f6c  # self.default_l
-0000d9f0: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
-0000da00: 2020 2020 2020 2020 2320 2020 2020 6627          #     f'
-0000da10: 5374 6f63 6b3a 7b73 6176 6544 6963 745b  Stock:{saveDict[
-0000da20: 2253 746f 636b 225d 7d2c 2064 6f65 7320  "Stock"]}, does 
-0000da30: 6e6f 7420 6861 7665 2061 2062 7265 616b  not have a break
-0000da40: 6f75 7420 7965 7420 6265 6361 7573 6520  out yet because 
-0000da50: 7265 6365 6e74 2d63 6c6f 7365 2028 7b72  recent-close ({r
-0000da60: 6563 656e 7443 6c6f 7365 7d29 203c 206d  ecentClose}) < m
-0000da70: 6178 2d68 6967 6820 287b 6d61 7848 6967  ax-high ({maxHig
-0000da80: 687d 2927 0a20 2020 2020 2020 2020 2020  h})'.           
-0000da90: 2023 2029 0a20 2020 2020 2020 2020 2020   # ).           
-0000daa0: 2073 6372 6565 6e44 6963 745b 2242 7265   screenDict["Bre
-0000dab0: 616b 6f75 7422 5d20 3d20 280a 2020 2020  akout"] = (.    
-0000dac0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-0000dad0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-0000dae0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-0000daf0: 6f72 5465 7874 2e46 4149 4c0a 2020 2020  orText.FAIL.    
-0000db00: 2020 2020 2020 2020 2020 2020 2b20 2242              + "B
-0000db10: 4f3a 2022 0a20 2020 2020 2020 2020 2020  O: ".           
-0000db20: 2020 2020 202b 2073 7472 286d 6178 436c       + str(maxCl
-0000db30: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
-0000db40: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0000db50: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0000db60: 2020 2020 202b 2028 636f 6c6f 7254 6578       + (colorTex
-0000db70: 742e 4752 4545 4e20 6966 2072 6563 656e  t.GREEN if recen
-0000db80: 7443 6c6f 7365 203e 3d20 6d61 7848 6967  tClose >= maxHig
-0000db90: 6820 656c 7365 2063 6f6c 6f72 5465 7874  h else colorText
-0000dba0: 2e46 4149 4c29 0a20 2020 2020 2020 2020  .FAIL).         
-0000dbb0: 2020 2020 2020 202b 2022 2052 3a20 220a         + " R: ".
+0000d960: 2020 202b 2022 2052 3a20 3022 0a20 2020     + " R: 0".   
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d980: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000d990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d9a0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0000d9b0: 2020 2072 6574 7572 6e20 6e6f 7420 616c     return not al
+0000d9c0: 7265 6164 7942 726f 6b65 6e6f 7574 0a20  readyBrokenout. 
+0000d9d0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0000d9e0: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
+0000d9f0: 3d20 2242 4f3a 2022 202b 2073 7472 286d  = "BO: " + str(m
+0000da00: 6178 436c 6f73 6529 202b 2022 2052 3a20  axClose) + " R: 
+0000da10: 2220 2b20 7374 7228 6d61 7848 6967 6829  " + str(maxHigh)
+0000da20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000da30: 7265 6365 6e74 436c 6f73 6520 3e3d 206d  recentClose >= m
+0000da40: 6178 436c 6f73 653a 0a20 2020 2020 2020  axClose:.       
+0000da50: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+0000da60: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
+0000da70: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
+0000da80: 2020 2020 2023 2020 2020 2066 2753 746f       #     f'Sto
+0000da90: 636b 3a7b 7361 7665 4469 6374 5b22 5374  ck:{saveDict["St
+0000daa0: 6f63 6b22 5d7d 2c20 6861 7320 6120 6272  ock"]}, has a br
+0000dab0: 6561 6b6f 7574 2062 6563 6175 7365 2072  eakout because r
+0000dac0: 6563 656e 742d 636c 6f73 6520 287b 7265  ecent-close ({re
+0000dad0: 6365 6e74 436c 6f73 657d 2920 3e3d 206d  centClose}) >= m
+0000dae0: 6178 2d63 6c6f 7365 2028 7b6d 6178 436c  ax-close ({maxCl
+0000daf0: 6f73 657d 2927 0a20 2020 2020 2020 2020  ose})'.         
+0000db00: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+0000db10: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000db20: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
+0000db30: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0000db40: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
+0000db50: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
+0000db60: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0000db70: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+0000db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db90: 2020 202b 2022 424f 3a20 220a 2020 2020     + "BO: ".    
+0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbb0: 2b20 7374 7228 6d61 7843 6c6f 7365 290a  + str(maxClose).
 0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbd0: 2b20 7374 7228 6d61 7848 6967 6829 0a20  + str(maxHigh). 
-0000dbe0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000dbf0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-0000dc00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000dc10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000dc20: 6e6f 7420 616c 7265 6164 7942 726f 6b65  not alreadyBroke
-0000dc30: 6e6f 7574 0a20 2020 2020 2020 2065 6c73  nout.        els
-0000dc40: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0000dc50: 6176 6544 6963 745b 2242 7265 616b 6f75  aveDict["Breakou
-0000dc60: 7422 5d20 3d20 2242 4f3a 2022 202b 2073  t"] = "BO: " + s
-0000dc70: 7472 286d 6178 436c 6f73 6529 202b 2022  tr(maxClose) + "
-0000dc80: 2052 3a20 3022 0a20 2020 2020 2020 2020   R: 0".         
-0000dc90: 2020 2069 6620 7265 6365 6e74 436c 6f73     if recentClos
-0000dca0: 6520 3e3d 206d 6178 436c 6f73 653a 0a20  e >= maxClose:. 
-0000dcb0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000dcc0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-0000dcd0: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
-0000dce0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0000dcf0: 2066 2753 746f 636b 3a7b 7361 7665 4469   f'Stock:{saveDi
-0000dd00: 6374 5b22 5374 6f63 6b22 5d7d 2c20 6861  ct["Stock"]}, ha
-0000dd10: 7320 6120 6272 6561 6b6f 7574 2062 6563  s a breakout bec
-0000dd20: 6175 7365 2072 6563 656e 742d 636c 6f73  ause recent-clos
-0000dd30: 6520 287b 7265 6365 6e74 436c 6f73 657d  e ({recentClose}
-0000dd40: 2920 3e3d 206d 6178 2d63 6c6f 7365 2028  ) >= max-close (
-0000dd50: 7b6d 6178 436c 6f73 657d 2927 0a20 2020  {maxClose})'.   
-0000dd60: 2020 2020 2020 2020 2020 2020 2023 2029               # )
-0000dd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dd80: 2073 6372 6565 6e44 6963 745b 2242 7265   screenDict["Bre
-0000dd90: 616b 6f75 7422 5d20 3d20 280a 2020 2020  akout"] = (.    
-0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddb0: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-0000ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddd0: 2020 202b 2063 6f6c 6f72 5465 7874 2e47     + colorText.G
-0000dde0: 5245 454e 0a20 2020 2020 2020 2020 2020  REEN.           
-0000ddf0: 2020 2020 2020 2020 202b 2022 424f 3a20           + "BO: 
-0000de00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000de10: 2020 2020 2020 2b20 7374 7228 6d61 7843        + str(maxC
-0000de20: 6c6f 7365 290a 2020 2020 2020 2020 2020  lose).          
-0000de30: 2020 2020 2020 2020 2020 2b20 2220 523a            + " R:
-0000de40: 2030 220a 2020 2020 2020 2020 2020 2020   0".            
-0000de50: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-0000de60: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-0000de70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000de80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000de90: 2054 7275 6520 616e 6420 616c 7265 6164   True and alread
-0000dea0: 7942 726f 6b65 6e6f 7574 2061 6e64 2073  yBrokenout and s
-0000deb0: 656c 662e 6765 7443 616e 646c 6554 7970  elf.getCandleTyp
-0000dec0: 6528 7265 6365 6e74 290a 2020 2020 2020  e(recent).      
-0000ded0: 2020 2020 2020 2320 7365 6c66 2e64 6566        # self.def
-0000dee0: 6175 6c74 5f6c 6f67 6765 722e 696e 666f  ault_logger.info
-0000def0: 280a 2020 2020 2020 2020 2020 2020 2320  (.            # 
-0000df00: 2020 2020 6627 5374 6f63 6b3a 7b73 6176      f'Stock:{sav
-0000df10: 6544 6963 745b 2253 746f 636b 225d 7d2c  eDict["Stock"]},
-0000df20: 2068 6173 2061 2062 7265 616b 6f75 7420   has a breakout 
-0000df30: 6265 6361 7573 6520 7265 6365 6e74 2d63  because recent-c
-0000df40: 6c6f 7365 2028 7b72 6563 656e 7443 6c6f  lose ({recentClo
-0000df50: 7365 7d29 203c 206d 6178 2d63 6c6f 7365  se}) < max-close
-0000df60: 2028 7b6d 6178 436c 6f73 657d 2927 0a20   ({maxClose})'. 
-0000df70: 2020 2020 2020 2020 2020 2023 2029 0a20             # ). 
-0000df80: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0000df90: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
-0000dfa0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000dfb0: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-0000dfc0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-0000dfd0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0000dfe0: 2e46 4149 4c0a 2020 2020 2020 2020 2020  .FAIL.          
-0000dff0: 2020 2020 2020 2b20 2242 4f3a 2022 0a20        + "BO: ". 
-0000e000: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000e010: 2073 7472 286d 6178 436c 6f73 6529 0a20   str(maxClose). 
-0000e020: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000e030: 2022 2052 3a20 3022 0a20 2020 2020 2020   " R: 0".       
-0000e040: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0000e050: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0000e060: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000e070: 2020 2072 6574 7572 6e20 6e6f 7420 616c     return not al
-0000e080: 7265 6164 7942 726f 6b65 6e6f 7574 0a0a  readyBrokenout..
-0000e090: 2020 2020 2320 4669 6e64 2073 746f 636b      # Find stock
-0000e0a0: 7320 7468 6174 2061 7265 2062 756c 6c69  s that are bulli
-0000e0b0: 7368 2069 6e74 7261 6461 793a 2052 5349  sh intraday: RSI
-0000e0c0: 2063 726f 7373 6573 2035 352c 204d 6163   crosses 55, Mac
-0000e0d0: 6420 4869 7374 6f67 7261 6d20 706f 7369  d Histogram posi
-0000e0e0: 7469 7665 2c20 7072 6963 6520 6162 6f76  tive, price abov
-0000e0f0: 6520 454d 4120 3130 0a20 2020 2064 6566  e EMA 10.    def
-0000e100: 2066 696e 6442 756c 6c69 7368 496e 7472   findBullishIntr
-0000e110: 6164 6179 5253 494d 4143 4428 7365 6c66  adayRSIMACD(self
-0000e120: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
-0000e130: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
-0000e140: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
-0000e150: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000e160: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
-0000e170: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
-0000e180: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000e190: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
-0000e1a0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-0000e1b0: 612e 7265 706c 6163 6528 5b6e 702e 696e  a.replace([np.in
-0000e1c0: 662c 202d 6e70 2e69 6e66 5d2c 2030 290a  f, -np.inf], 0).
-0000e1d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000e1e0: 6174 615b 3a3a 2d31 5d20 2023 2052 6576  ata[::-1]  # Rev
-0000e1f0: 6572 7365 2074 6865 2064 6174 6166 7261  erse the datafra
-0000e200: 6d65 2073 6f20 7468 6174 2069 7473 2074  me so that its t
-0000e210: 6865 206f 6c64 6573 7420 6461 7465 2066  he oldest date f
-0000e220: 6972 7374 0a20 2020 2020 2020 2064 6174  irst.        dat
-0000e230: 615b 2252 5349 3132 225d 203d 2070 6b74  a["RSI12"] = pkt
-0000e240: 616c 6962 2e52 5349 2864 6174 615b 2243  alib.RSI(data["C
-0000e250: 6c6f 7365 225d 2c20 3132 290a 2020 2020  lose"], 12).    
-0000e260: 2020 2020 6461 7461 5b22 454d 4131 3022      data["EMA10"
-0000e270: 5d20 3d20 706b 7461 6c69 622e 454d 4128  ] = pktalib.EMA(
-0000e280: 6461 7461 5b22 436c 6f73 6522 5d2c 2031  data["Close"], 1
-0000e290: 3029 0a20 2020 2020 2020 2064 6174 615b  0).        data[
-0000e2a0: 2245 4d41 3230 3022 5d20 3d20 706b 7461  "EMA200"] = pkta
-0000e2b0: 6c69 622e 454d 4128 6461 7461 5b22 436c  lib.EMA(data["Cl
-0000e2c0: 6f73 6522 5d2c 2032 3030 290a 2020 2020  ose"], 200).    
-0000e2d0: 2020 2020 6d61 6364 203d 2070 6b74 616c      macd = pktal
-0000e2e0: 6962 2e4d 4143 4428 6461 7461 5b22 436c  ib.MACD(data["Cl
-0000e2f0: 6f73 6522 5d2c 2031 302c 2031 382c 2039  ose"], 10, 18, 9
-0000e300: 295b 325d 2e74 6169 6c28 3129 0a20 2020  )[2].tail(1).   
-0000e310: 2020 2020 2072 6563 656e 7420 3d20 6461       recent = da
-0000e320: 7461 2e74 6169 6c28 3129 0a20 2020 2020  ta.tail(1).     
-0000e330: 2020 2063 6f6e 6431 203d 2072 6563 656e     cond1 = recen
-0000e340: 745b 2252 5349 3132 225d 2e69 6c6f 635b  t["RSI12"].iloc[
-0000e350: 305d 203e 2035 350a 2020 2020 2020 2020  0] > 55.        
-0000e360: 636f 6e64 3220 3d20 636f 6e64 3120 616e  cond2 = cond1 an
-0000e370: 6420 286d 6163 642e 696c 6f63 5b3a 315d  d (macd.iloc[:1]
-0000e380: 5b30 5d20 3e20 3029 0a20 2020 2020 2020  [0] > 0).       
-0000e390: 2063 6f6e 6433 203d 2063 6f6e 6432 2061   cond3 = cond2 a
-0000e3a0: 6e64 2028 7265 6365 6e74 5b22 436c 6f73  nd (recent["Clos
-0000e3b0: 6522 5d2e 696c 6f63 5b30 5d20 3e20 7265  e"].iloc[0] > re
-0000e3c0: 6365 6e74 5b22 454d 4131 3022 5d2e 696c  cent["EMA10"].il
-0000e3d0: 6f63 5b30 5d29 0a20 2020 2020 2020 2063  oc[0]).        c
-0000e3e0: 6f6e 6434 203d 2063 6f6e 6433 2061 6e64  ond4 = cond3 and
-0000e3f0: 2028 7265 6365 6e74 5b22 436c 6f73 6522   (recent["Close"
-0000e400: 5d2e 696c 6f63 5b30 5d20 3e20 7265 6365  ].iloc[0] > rece
-0000e410: 6e74 5b22 454d 4132 3030 225d 2e69 6c6f  nt["EMA200"].ilo
-0000e420: 635b 305d 290a 2020 2020 2020 2020 7265  c[0]).        re
-0000e430: 7475 726e 2063 6f6e 6434 0a20 2020 200a  turn cond4.    .
-0000e440: 2020 2020 2320 4669 6e64 2073 746f 636b      # Find stock
-0000e450: 7320 7468 6174 206f 7065 6e65 6420 6869  s that opened hi
-0000e460: 6768 6572 2074 6861 6e20 7468 6520 7072  gher than the pr
-0000e470: 6576 696f 7573 2068 6967 680a 2020 2020  evious high.    
-0000e480: 6465 6620 6669 6e64 4869 6768 6572 4f70  def findHigherOp
-0000e490: 656e 7328 7365 6c66 2c20 6466 293a 0a20  ens(self, df):. 
-0000e4a0: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-0000e4b0: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-0000e4c0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0000e4d0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0000e4e0: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
-0000e4f0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-0000e500: 6461 7461 203d 2064 6174 612e 6669 6c6c  data = data.fill
-0000e510: 6e61 2830 290a 2020 2020 2020 2020 6461  na(0).        da
-0000e520: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
-0000e530: 6528 5b6e 702e 696e 662c 202d 6e70 2e69  e([np.inf, -np.i
-0000e540: 6e66 5d2c 2030 290a 2020 2020 2020 2020  nf], 0).        
-0000e550: 7265 6365 6e74 203d 2064 6174 612e 6865  recent = data.he
-0000e560: 6164 2832 290a 2020 2020 2020 2020 6966  ad(2).        if
-0000e570: 206c 656e 2872 6563 656e 7429 203c 2032   len(recent) < 2
-0000e580: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000e590: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-0000e5a0: 2020 2072 6574 7572 6e20 7265 6365 6e74     return recent
-0000e5b0: 5b22 4f70 656e 225d 2e69 6c6f 635b 305d  ["Open"].iloc[0]
-0000e5c0: 203e 2072 6563 656e 745b 2243 6c6f 7365   > recent["Close
-0000e5d0: 225d 2e69 6c6f 635b 315d 0a0a 2020 2020  "].iloc[1]..    
-0000e5e0: 6465 6620 6669 6e64 4869 6768 6572 4275  def findHigherBu
-0000e5f0: 6c6c 6973 684f 7065 6e73 2873 656c 662c  llishOpens(self,
-0000e600: 2064 6629 3a0a 2020 2020 2020 2020 6966   df):.        if
-0000e610: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-0000e620: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-0000e630: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e640: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0000e650: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-0000e660: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
-0000e670: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
-0000e680: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0000e690: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
-0000e6a0: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
-0000e6b0: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
-0000e6c0: 6461 7461 2e68 6561 6428 3229 0a20 2020  data.head(2).   
-0000e6d0: 2020 2020 2069 6620 6c65 6e28 7265 6365       if len(rece
-0000e6e0: 6e74 2920 3c20 323a 0a20 2020 2020 2020  nt) < 2:.       
-0000e6f0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0000e700: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-0000e710: 2072 6563 656e 745b 224f 7065 6e22 5d2e   recent["Open"].
-0000e720: 696c 6f63 5b30 5d20 3e20 7265 6365 6e74  iloc[0] > recent
-0000e730: 5b22 4869 6768 225d 2e69 6c6f 635b 315d  ["High"].iloc[1]
-0000e740: 0a20 2020 200a 2020 2020 6465 6620 6669  .    .    def fi
-0000e750: 6e64 4e52 3444 6179 2873 656c 662c 2064  ndNR4Day(self, d
-0000e760: 6629 3a0a 2020 2020 2020 2020 6966 2064  f):.        if d
-0000e770: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-0000e780: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-0000e790: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000e7a0: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-0000e7b0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0000e7c0: 2020 2020 2023 2068 7474 7073 3a2f 2f63       # https://c
-0000e7d0: 6861 7274 696e 6b2e 636f 6d2f 7363 7265  hartink.com/scre
-0000e7e0: 656e 6572 2f6e 7234 2d64 6169 6c79 2d74  ener/nr4-daily-t
-0000e7f0: 6f64 6179 0a20 2020 2020 2020 2069 6620  oday.        if 
-0000e800: 6461 7461 2e74 6169 6c28 3129 5b22 566f  data.tail(1)["Vo
-0000e810: 6c75 6d65 225d 2e69 6c6f 635b 305d 203c  lume"].iloc[0] <
-0000e820: 3d20 3530 3030 303a 0a20 2020 2020 2020  = 50000:.       
-0000e830: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-0000e840: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-0000e850: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
-0000e860: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000e870: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-0000e880: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-0000e890: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0000e8a0: 2064 6174 615b 3a3a 2d31 5d20 2023 2052   data[::-1]  # R
-0000e8b0: 6576 6572 7365 2074 6865 2064 6174 6166  everse the dataf
-0000e8c0: 7261 6d65 2073 6f20 7468 6174 2069 7473  rame so that its
-0000e8d0: 2074 6865 206f 6c64 6573 7420 6461 7465   the oldest date
-0000e8e0: 2066 6972 7374 0a20 2020 2020 2020 2064   first.        d
-0000e8f0: 6174 615b 2253 4d41 3130 225d 203d 2070  ata["SMA10"] = p
-0000e900: 6b74 616c 6962 2e53 4d41 2864 6174 615b  ktalib.SMA(data[
-0000e910: 2243 6c6f 7365 225d 2c20 3130 290a 2020  "Close"], 10).  
-0000e920: 2020 2020 2020 6461 7461 5b22 534d 4135        data["SMA5
-0000e930: 3022 5d20 3d20 706b 7461 6c69 622e 534d  0"] = pktalib.SM
-0000e940: 4128 6461 7461 5b22 436c 6f73 6522 5d2c  A(data["Close"],
-0000e950: 2035 3029 0a20 2020 2020 2020 2064 6174   50).        dat
-0000e960: 615b 2253 4d41 3230 3022 5d20 3d20 706b  a["SMA200"] = pk
-0000e970: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
-0000e980: 436c 6f73 6522 5d2c 2032 3030 290a 2020  Close"], 200).  
-0000e990: 2020 2020 2020 7265 6365 6e74 203d 2064        recent = d
-0000e9a0: 6174 612e 7461 696c 2835 290a 2020 2020  ata.tail(5).    
-0000e9b0: 2020 2020 7265 6365 6e74 203d 2072 6563      recent = rec
-0000e9c0: 656e 745b 3a3a 2d31 5d0a 2020 2020 2020  ent[::-1].      
-0000e9d0: 2020 636f 6e64 3120 3d20 2872 6563 656e    cond1 = (recen
-0000e9e0: 745b 2248 6967 6822 5d2e 696c 6f63 5b30  t["High"].iloc[0
-0000e9f0: 5d20 2d20 7265 6365 6e74 5b22 4c6f 7722  ] - recent["Low"
-0000ea00: 5d2e 696c 6f63 5b30 5d29 203c 2028 0a20  ].iloc[0]) < (. 
-0000ea10: 2020 2020 2020 2020 2020 2072 6563 656e             recen
-0000ea20: 745b 2248 6967 6822 5d2e 696c 6f63 5b31  t["High"].iloc[1
-0000ea30: 5d20 2d20 7265 6365 6e74 5b22 4c6f 7722  ] - recent["Low"
-0000ea40: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
-0000ea50: 2020 290a 2020 2020 2020 2020 636f 6e64    ).        cond
-0000ea60: 3220 3d20 636f 6e64 3120 616e 6420 2872  2 = cond1 and (r
-0000ea70: 6563 656e 745b 2248 6967 6822 5d2e 696c  ecent["High"].il
-0000ea80: 6f63 5b30 5d20 2d20 7265 6365 6e74 5b22  oc[0] - recent["
-0000ea90: 4c6f 7722 5d2e 696c 6f63 5b30 5d29 203c  Low"].iloc[0]) <
-0000eaa0: 2028 0a20 2020 2020 2020 2020 2020 2072   (.            r
-0000eab0: 6563 656e 745b 2248 6967 6822 5d2e 696c  ecent["High"].il
-0000eac0: 6f63 5b32 5d20 2d20 7265 6365 6e74 5b22  oc[2] - recent["
-0000ead0: 4c6f 7722 5d2e 696c 6f63 5b32 5d0a 2020  Low"].iloc[2].  
-0000eae0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000eaf0: 636f 6e64 3320 3d20 636f 6e64 3220 616e  cond3 = cond2 an
-0000eb00: 6420 2872 6563 656e 745b 2248 6967 6822  d (recent["High"
-0000eb10: 5d2e 696c 6f63 5b30 5d20 2d20 7265 6365  ].iloc[0] - rece
-0000eb20: 6e74 5b22 4c6f 7722 5d2e 696c 6f63 5b30  nt["Low"].iloc[0
-0000eb30: 5d29 203c 2028 0a20 2020 2020 2020 2020  ]) < (.         
-0000eb40: 2020 2072 6563 656e 745b 2248 6967 6822     recent["High"
-0000eb50: 5d2e 696c 6f63 5b33 5d20 2d20 7265 6365  ].iloc[3] - rece
-0000eb60: 6e74 5b22 4c6f 7722 5d2e 696c 6f63 5b33  nt["Low"].iloc[3
-0000eb70: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
-0000eb80: 2020 2020 636f 6e64 3420 3d20 636f 6e64      cond4 = cond
-0000eb90: 3320 616e 6420 2872 6563 656e 745b 2248  3 and (recent["H
-0000eba0: 6967 6822 5d2e 696c 6f63 5b30 5d20 2d20  igh"].iloc[0] - 
-0000ebb0: 7265 6365 6e74 5b22 4c6f 7722 5d2e 696c  recent["Low"].il
-0000ebc0: 6f63 5b30 5d29 203c 2028 0a20 2020 2020  oc[0]) < (.     
-0000ebd0: 2020 2020 2020 2072 6563 656e 745b 2248         recent["H
-0000ebe0: 6967 6822 5d2e 696c 6f63 5b34 5d20 2d20  igh"].iloc[4] - 
-0000ebf0: 7265 6365 6e74 5b22 4c6f 7722 5d2e 696c  recent["Low"].il
-0000ec00: 6f63 5b34 5d0a 2020 2020 2020 2020 290a  oc[4].        ).
-0000ec10: 2020 2020 2020 2020 636f 6e64 3520 3d20          cond5 = 
-0000ec20: 636f 6e64 3420 616e 6420 2872 6563 656e  cond4 and (recen
-0000ec30: 745b 2253 4d41 3130 225d 2e69 6c6f 635b  t["SMA10"].iloc[
-0000ec40: 305d 203e 2072 6563 656e 745b 2253 4d41  0] > recent["SMA
-0000ec50: 3530 225d 2e69 6c6f 635b 305d 290a 2020  50"].iloc[0]).  
-0000ec60: 2020 2020 2020 636f 6e64 3620 3d20 636f        cond6 = co
-0000ec70: 6e64 3520 616e 6420 2872 6563 656e 745b  nd5 and (recent[
-0000ec80: 2253 4d41 3530 225d 2e69 6c6f 635b 305d  "SMA50"].iloc[0]
-0000ec90: 203e 2072 6563 656e 745b 2253 4d41 3230   > recent["SMA20
-0000eca0: 3022 5d2e 696c 6f63 5b30 5d29 0a20 2020  0"].iloc[0]).   
-0000ecb0: 2020 2020 2072 6574 7572 6e20 636f 6e64       return cond
-0000ecc0: 360a 0a20 2020 2023 2046 696e 6420 706f  6..    # Find po
-0000ecd0: 7465 6e74 6961 6c20 6272 6561 6b6f 7574  tential breakout
-0000ece0: 2073 746f 636b 730a 2020 2020 2320 5468   stocks.    # Th
-0000ecf0: 6973 2073 6361 6e6e 6572 2066 696c 7465  is scanner filte
-0000ed00: 7273 2073 746f 636b 7320 7768 6f73 6520  rs stocks whose 
-0000ed10: 6375 7272 656e 7420 636c 6f73 6520 7072  current close pr
-0000ed20: 6963 6520 2b20 3525 2069 7320 6869 6768  ice + 5% is high
-0000ed30: 6572 0a20 2020 2023 2074 6861 6e20 7468  er.    # than th
-0000ed40: 6520 6869 6768 6573 7420 4869 6768 2070  e highest High p
-0000ed50: 7269 6365 2069 6e20 7061 7374 2032 3030  rice in past 200
-0000ed60: 2063 616e 646c 6573 2061 6e64 2074 6865   candles and the
-0000ed70: 206d 6178 696d 756d 2068 6967 680a 2020   maximum high.  
-0000ed80: 2020 2320 696e 2074 6865 2070 7265 7669    # in the previ
-0000ed90: 6f75 7320 3330 2063 616e 646c 6573 2069  ous 30 candles i
-0000eda0: 7320 6c6f 7765 7220 7468 616e 2074 6865  s lower than the
-0000edb0: 2068 6967 6865 7374 2068 6967 6820 6d61   highest high ma
-0000edc0: 6465 2069 6e20 7468 650a 2020 2020 2320  de in the.    # 
-0000edd0: 7072 6576 696f 7573 2032 3030 2063 616e  previous 200 can
-0000ede0: 646c 6573 2c20 7374 6172 7469 6e67 2066  dles, starting f
-0000edf0: 726f 6d20 7468 6520 7072 6576 696f 7573  rom the previous
-0000ee00: 2033 3074 6820 6361 6e64 6c65 2e20 4174   30th candle. At
-0000ee10: 2074 6865 0a20 2020 2023 2073 616d 6520   the.    # same 
-0000ee20: 7469 6d65 2074 6865 2063 7572 7265 6e74  time the current
-0000ee30: 2063 616e 646c 6520 766f 6c75 6d65 2069   candle volume i
-0000ee40: 7320 6869 6768 6572 2074 6861 6e20 3230  s higher than 20
-0000ee50: 3020 534d 4120 6f66 2076 6f6c 756d 652e  0 SMA of volume.
-0000ee60: 0a20 2020 2064 6566 2066 696e 6450 6f74  .    def findPot
-0000ee70: 656e 7469 616c 4272 6561 6b6f 7574 2873  entialBreakout(s
-0000ee80: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
-0000ee90: 6963 742c 2073 6176 6544 6963 742c 2064  ict, saveDict, d
-0000eea0: 6179 7354 6f4c 6f6f 6b62 6163 6b29 3a0a  aysToLookback):.
-0000eeb0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0000eec0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0000eed0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000eee0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000eef0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0000ef00: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0000ef10: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
-0000ef20: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
-0000ef30: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
-0000ef40: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
-0000ef50: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
-0000ef60: 2064 6174 6120 3d20 6461 7461 2e68 6561   data = data.hea
-0000ef70: 6428 3233 3129 0a20 2020 2020 2020 2072  d(231).        r
-0000ef80: 6563 656e 7420 3d20 6461 7461 2e68 6561  ecent = data.hea
-0000ef90: 6428 3129 0a20 2020 2020 2020 2072 6563  d(1).        rec
-0000efa0: 656e 7456 6f6c 756d 6520 3d20 7265 6365  entVolume = rece
-0000efb0: 6e74 5b22 566f 6c75 6d65 225d 2e69 6c6f  nt["Volume"].ilo
-0000efc0: 635b 305d 0a20 2020 2020 2020 2072 6563  c[0].        rec
-0000efd0: 656e 7443 6c6f 7365 203d 2072 6f75 6e64  entClose = round
-0000efe0: 2872 6563 656e 745b 2243 6c6f 7365 225d  (recent["Close"]
-0000eff0: 2e69 6c6f 635b 305d 202a 2031 2e30 352c  .iloc[0] * 1.05,
-0000f000: 2032 290a 2020 2020 2020 2020 6869 6768   2).        high
-0000f010: 6573 7448 6967 6832 3030 203d 2072 6f75  estHigh200 = rou
-0000f020: 6e64 2864 6174 612e 6865 6164 2832 3031  nd(data.head(201
-0000f030: 292e 7461 696c 2832 3030 292e 6465 7363  ).tail(200).desc
-0000f040: 7269 6265 2829 5b22 4869 6768 225d 5b22  ribe()["High"]["
-0000f050: 6d61 7822 5d2c 2032 290a 2020 2020 2020  max"], 2).      
-0000f060: 2020 6869 6768 6573 7448 6967 6833 3020    highestHigh30 
-0000f070: 3d20 726f 756e 6428 6461 7461 2e68 6561  = round(data.hea
-0000f080: 6428 3331 292e 7461 696c 2833 3029 2e64  d(31).tail(30).d
-0000f090: 6573 6372 6962 6528 295b 2248 6967 6822  escribe()["High"
-0000f0a0: 5d5b 226d 6178 225d 2c20 3229 0a20 2020  ]["max"], 2).   
-0000f0b0: 2020 2020 2068 6967 6865 7374 4869 6768       highestHigh
-0000f0c0: 3230 3046 726f 6d33 3020 3d20 726f 756e  200From30 = roun
-0000f0d0: 6428 6461 7461 2e74 6169 6c28 3230 3029  d(data.tail(200)
-0000f0e0: 2e64 6573 6372 6962 6528 295b 2248 6967  .describe()["Hig
-0000f0f0: 6822 5d5b 226d 6178 225d 2c20 3229 0a20  h"]["max"], 2). 
-0000f100: 2020 2020 2020 2068 6967 6865 7374 4869         highestHi
-0000f110: 6768 3846 726f 6d33 3020 3d20 726f 756e  gh8From30 = roun
-0000f120: 6428 6461 7461 2e68 6561 6428 3339 292e  d(data.head(39).
-0000f130: 7461 696c 2838 292e 6465 7363 7269 6265  tail(8).describe
-0000f140: 2829 5b22 4869 6768 225d 5b22 6d61 7822  ()["High"]["max"
-0000f150: 5d2c 2032 290a 2020 2020 2020 2020 6461  ], 2).        da
-0000f160: 7461 203d 2064 6174 612e 6865 6164 2832  ta = data.head(2
-0000f170: 3030 290a 2020 2020 2020 2020 6461 7461  00).        data
-0000f180: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
-0000f190: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
-0000f1a0: 6166 7261 6d65 2073 6f20 7468 6174 2069  aframe so that i
-0000f1b0: 7473 2074 6865 206f 6c64 6573 7420 6461  ts the oldest da
-0000f1c0: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
-0000f1d0: 2076 6f6c 3230 3020 3d20 706b 7461 6c69   vol200 = pktali
-0000f1e0: 622e 534d 4128 6461 7461 5b22 566f 6c75  b.SMA(data["Volu
-0000f1f0: 6d65 225d 2c74 696d 6570 6572 696f 643d  me"],timeperiod=
-0000f200: 3230 3029 0a20 2020 2020 2020 2064 6174  200).        dat
-0000f210: 615b 2253 4d41 3230 3056 225d 203d 2076  a["SMA200V"] = v
-0000f220: 6f6c 3230 300a 2020 2020 2020 2020 766f  ol200.        vo
-0000f230: 6c35 3020 3d20 706b 7461 6c69 622e 534d  l50 = pktalib.SM
-0000f240: 4128 6461 7461 5b22 566f 6c75 6d65 225d  A(data["Volume"]
-0000f250: 2c74 696d 6570 6572 696f 643d 3530 290a  ,timeperiod=50).
-0000f260: 2020 2020 2020 2020 6461 7461 5b22 534d          data["SM
-0000f270: 4135 3056 225d 203d 2076 6f6c 3530 0a20  A50V"] = vol50. 
-0000f280: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
-0000f290: 6461 7461 2e74 6169 6c28 3129 0a20 2020  data.tail(1).   
-0000f2a0: 2020 2020 2073 6d61 3230 3076 203d 2072       sma200v = r
-0000f2b0: 6563 656e 745b 2253 4d41 3230 3056 225d  ecent["SMA200V"]
-0000f2c0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-0000f2d0: 2073 6d61 3530 7620 3d20 7265 6365 6e74   sma50v = recent
-0000f2e0: 5b22 534d 4135 3056 225d 2e69 6c6f 635b  ["SMA50V"].iloc[
-0000f2f0: 305d 0a20 2020 2020 2020 2069 6620 280a  0].        if (.
-0000f300: 2020 2020 2020 2020 2020 2020 6e70 2e69              np.i
-0000f310: 736e 616e 2872 6563 656e 7443 6c6f 7365  snan(recentClose
-0000f320: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-0000f330: 206e 702e 6973 6e61 6e28 6869 6768 6573   np.isnan(highes
-0000f340: 7448 6967 6832 3030 290a 2020 2020 2020  tHigh200).      
-0000f350: 2020 2020 2020 6f72 206e 702e 6973 6e61        or np.isna
-0000f360: 6e28 6869 6768 6573 7448 6967 6833 3029  n(highestHigh30)
-0000f370: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-0000f380: 6e70 2e69 736e 616e 2868 6967 6865 7374  np.isnan(highest
-0000f390: 4869 6768 3230 3046 726f 6d33 3029 0a20  High200From30). 
-0000f3a0: 2020 2020 2020 2020 2020 206f 7220 6e70             or np
-0000f3b0: 2e69 736e 616e 2868 6967 6865 7374 4869  .isnan(highestHi
-0000f3c0: 6768 3846 726f 6d33 3029 0a20 2020 2020  gh8From30).     
-0000f3d0: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
-0000f3e0: 616e 2872 6563 656e 7456 6f6c 756d 6529  an(recentVolume)
-0000f3f0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-0000f400: 6e70 2e69 736e 616e 2873 6d61 3230 3076  np.isnan(sma200v
-0000f410: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-0000f420: 206e 702e 6973 6e61 6e28 736d 6135 3076   np.isnan(sma50v
-0000f430: 290a 2020 2020 2020 2020 293a 0a20 2020  ).        ):.   
-0000f440: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000f450: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-0000f460: 2028 0a20 2020 2020 2020 2020 2020 2028   (.            (
-0000f470: 7265 6365 6e74 436c 6f73 6520 3e20 6869  recentClose > hi
-0000f480: 6768 6573 7448 6967 6832 3030 290a 2020  ghestHigh200).  
-0000f490: 2020 2020 2020 2020 2020 616e 6420 2828            and ((
-0000f4a0: 2868 6967 6865 7374 4869 6768 3330 203c  (highestHigh30 <
-0000f4b0: 2068 6967 6865 7374 4869 6768 3230 3046   highestHigh200F
-0000f4c0: 726f 6d33 3029 2061 6e64 2028 7265 6365  rom30) and (rece
-0000f4d0: 6e74 566f 6c75 6d65 203e 2073 6d61 3230  ntVolume > sma20
-0000f4e0: 3076 2929 206f 7220 5c0a 2020 2020 2020  0v)) or \.      
-0000f4f0: 2020 2020 2020 2020 2020 2028 2868 6967             ((hig
-0000f500: 6865 7374 4869 6768 3330 203c 2068 6967  hestHigh30 < hig
-0000f510: 6865 7374 4869 6768 3846 726f 6d33 3029  hestHigh8From30)
-0000f520: 2061 6e64 2028 7265 6365 6e74 566f 6c75   and (recentVolu
-0000f530: 6d65 203e 2073 6d61 3530 7629 290a 2020  me > sma50v)).  
-0000f540: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000f550: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000f560: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-0000f570: 2242 7265 616b 6f75 7422 5d20 3d20 7361  "Breakout"] = sa
-0000f580: 7665 4469 6374 5b22 4272 6561 6b6f 7574  veDict["Breakout
-0000f590: 225d 202b 2022 2850 6f74 656e 7469 616c  "] + "(Potential
-0000f5a0: 2922 0a20 2020 2020 2020 2020 2020 2073  )".            s
-0000f5b0: 6372 6565 6e44 6963 745b 2242 7265 616b  creenDict["Break
-0000f5c0: 6f75 7422 5d20 3d20 7363 7265 656e 4469  out"] = screenDi
-0000f5d0: 6374 5b22 4272 6561 6b6f 7574 225d 202b  ct["Breakout"] +
-0000f5e0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000f5f0: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
-0000f600: 4420 2b20 636f 6c6f 7254 6578 742e 4752  D + colorText.GR
-0000f610: 4545 4e20 2b20 2220 2850 6f74 656e 7469  EEN + " (Potenti
-0000f620: 616c 2922 202b 2063 6f6c 6f72 5465 7874  al)" + colorText
-0000f630: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0000f640: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-0000f650: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-0000f660: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000f670: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
-0000f680: 6b73 2077 6974 6820 7265 7665 7273 696e  ks with reversin
-0000f690: 6720 5053 4152 2061 6e64 2052 5349 0a20  g PSAR and RSI. 
-0000f6a0: 2020 2064 6566 2066 696e 6450 5341 5252     def findPSARR
-0000f6b0: 6576 6572 7361 6c57 6974 6852 5349 2873  eversalWithRSI(s
-0000f6c0: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
-0000f6d0: 6963 742c 2073 6176 6544 6963 742c 6d69  ict, saveDict,mi
-0000f6e0: 6e52 5349 3d35 3029 3a0a 2020 2020 2020  nRSI=50):.      
-0000f6f0: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-0000f700: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-0000f710: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000f720: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0000f730: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-0000f740: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-0000f750: 3d20 6461 7461 5b3a 3a2d 315d 0a20 2020  = data[::-1].   
-0000f760: 2020 2020 2070 7361 7220 3d20 706b 7461       psar = pkta
-0000f770: 6c69 622e 7073 6172 2864 6174 615b 2248  lib.psar(data["H
-0000f780: 6967 6822 5d2c 6461 7461 5b22 4c6f 7722  igh"],data["Low"
-0000f790: 5d29 0a20 2020 2020 2020 2069 6620 6c65  ]).        if le
-0000f7a0: 6e28 7073 6172 2920 3c20 333a 0a20 2020  n(psar) < 3:.   
-0000f7b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000f7c0: 4661 6c73 650a 2020 2020 2020 2020 7073  False.        ps
-0000f7d0: 6172 203d 2070 7361 722e 7461 696c 2833  ar = psar.tail(3
-0000f7e0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0000f7f0: 2064 6174 612e 7461 696c 2833 290a 2020   data.tail(3).  
-0000f800: 2020 2020 2020 2320 6461 794d 696e 7573        # dayMinus
-0000f810: 3250 7361 7220 3d20 7073 6172 2e69 6c6f  2Psar = psar.ilo
-0000f820: 635b 305d 0a20 2020 2020 2020 2064 6179  c[0].        day
-0000f830: 4d69 6e75 7331 5073 6172 203d 2070 7361  Minus1Psar = psa
-0000f840: 722e 696c 6f63 5b31 5d0a 2020 2020 2020  r.iloc[1].      
-0000f850: 2020 6461 7950 5341 5220 3d20 7073 6172    dayPSAR = psar
-0000f860: 2e69 6c6f 635b 325d 0a20 2020 2020 2020  .iloc[2].       
-0000f870: 2023 2064 6179 4d69 6e75 7332 436c 6f73   # dayMinus2Clos
-0000f880: 6520 3d20 6461 7461 5b22 436c 6f73 6522  e = data["Close"
-0000f890: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
-0000f8a0: 2020 6461 794d 696e 7573 3143 6c6f 7365    dayMinus1Close
-0000f8b0: 203d 2064 6174 615b 2243 6c6f 7365 225d   = data["Close"]
-0000f8c0: 2e69 6c6f 635b 315d 0a20 2020 2020 2020  .iloc[1].       
-0000f8d0: 2064 6179 436c 6f73 6520 3d20 6461 7461   dayClose = data
-0000f8e0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b32  ["Close"].iloc[2
-0000f8f0: 5d0a 2020 2020 2020 2020 2320 6461 794d  ].        # dayM
-0000f900: 696e 7573 3252 5349 203d 2064 6174 615b  inus2RSI = data[
-0000f910: 2252 5349 225d 2e69 6c6f 635b 305d 0a20  "RSI"].iloc[0]. 
-0000f920: 2020 2020 2020 2064 6179 4d69 6e75 7331         dayMinus1
-0000f930: 5253 4920 3d20 6461 7461 5b22 5253 4922  RSI = data["RSI"
-0000f940: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
-0000f950: 2020 6461 7952 5349 203d 2064 6174 615b    dayRSI = data[
-0000f960: 2252 5349 225d 2e69 6c6f 635b 325d 0a20  "RSI"].iloc[2]. 
-0000f970: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000f980: 6861 7352 6576 6572 7361 6c3d 2028 2828  hasReversal= (((
-0000f990: 6461 794d 696e 7573 3150 7361 7220 3e3d  dayMinus1Psar >=
-0000f9a0: 2064 6179 4d69 6e75 7331 436c 6f73 6529   dayMinus1Close)
-0000f9b0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-0000f9c0: 2020 2020 2020 2020 2020 2028 6461 7943             (dayC
-0000f9d0: 6c6f 7365 203e 3d20 6461 7950 5341 5229  lose >= dayPSAR)
-0000f9e0: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
-0000f9f0: 2020 2020 2020 2020 2020 2020 2864 6179              (day
-0000fa00: 4d69 6e75 7331 5253 4920 3c3d 206d 696e  Minus1RSI <= min
-0000fa10: 5253 4929 2061 6e64 205c 0a20 2020 2020  RSI) and \.     
-0000fa20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000fa30: 6461 7952 5349 203e 3d20 6461 794d 696e  dayRSI >= dayMin
-0000fa40: 7573 3152 5349 2929 0a20 2020 2020 2020  us1RSI)).       
-0000fa50: 2069 6620 6861 7352 6576 6572 7361 6c3a   if hasReversal:
-0000fa60: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
-0000fa70: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
-0000fa80: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
-0000fa90: 7363 7265 656e 4469 6374 2c73 6176 6544  screenDict,saveD
-0000faa0: 6963 742c 2022 5061 7474 6572 6e22 290a  ict, "Pattern").
-0000fab0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-0000fac0: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
-0000fad0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0000fae0: 2020 2020 2020 7361 7665 645b 305d 200a        saved[0] .
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb00: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-0000fb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb20: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
-0000fb30: 454e 0a20 2020 2020 2020 2020 2020 2020  EN.             
-0000fb40: 2020 202b 2066 2250 5341 522d 5253 492d     + f"PSAR-RSI-
-0000fb50: 5265 7622 0a20 2020 2020 2020 2020 2020  Rev".           
-0000fb60: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0000fb70: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0000fb80: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
-0000fb90: 6176 6544 6963 745b 2250 6174 7465 726e  aveDict["Pattern
-0000fba0: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
-0000fbb0: 6622 5053 4152 2d52 5349 2d52 6576 220a  f"PSAR-RSI-Rev".
-0000fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbd0: 2320 2828 2864 6179 4d69 6e75 7332 5073  # (((dayMinus2Ps
-0000fbe0: 6172 203e 3d20 6461 794d 696e 7573 3243  ar >= dayMinus2C
-0000fbf0: 6c6f 7365 2920 616e 6420 5c0a 2020 2020  lose) and \.    
-0000fc00: 2020 2020 2020 2020 2020 2020 2320 2828              # ((
-0000fc10: 6461 794d 696e 7573 3143 6c6f 7365 203e  dayMinus1Close >
-0000fc20: 3d20 6461 794d 696e 7573 3150 7361 7229  = dayMinus1Psar)
-0000fc30: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-0000fc40: 2020 2020 2020 2023 2028 6461 7943 6c6f         # (dayClo
-0000fc50: 7365 203e 3d20 6461 7950 5341 5229 2929  se >= dayPSAR)))
-0000fc60: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-0000fc70: 2020 2020 2020 2023 2028 6461 794d 696e         # (dayMin
-0000fc80: 7573 3252 5349 203e 3d20 6d69 6e52 5349  us2RSI >= minRSI
-0000fc90: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
-0000fca0: 2020 2020 2020 2020 2320 2864 6179 4d69          # (dayMi
-0000fcb0: 6e75 7331 5253 4920 3e3d 2064 6179 4d69  nus1RSI >= dayMi
-0000fcc0: 6e75 7332 5253 4929 2061 6e64 205c 0a20  nus2RSI) and \. 
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000fce0: 2028 6461 7952 5349 203e 3d20 6461 794d   (dayRSI >= dayM
-0000fcf0: 696e 7573 3152 5349 2929 206f 7220 5c0a  inus1RSI)) or \.
-0000fd00: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-0000fd10: 6173 5265 7665 7273 616c 0a0a 2020 2020  asReversal..    
-0000fd20: 2320 4669 6e64 2073 746f 636b 2072 6576  # Find stock rev
-0000fd30: 6572 7369 6e67 2061 7420 6769 7665 6e20  ersing at given 
-0000fd40: 4d41 0a20 2020 2064 6566 2066 696e 6452  MA.    def findR
-0000fd50: 6576 6572 7361 6c4d 4128 7365 6c66 2c20  eversalMA(self, 
-0000fd60: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
-0000fd70: 7361 7665 4469 6374 2c20 6d61 4c65 6e67  saveDict, maLeng
-0000fd80: 7468 2c20 7065 7263 656e 7461 6765 3d30  th, percentage=0
-0000fd90: 2e30 3229 3a0a 2020 2020 2020 2020 6966  .02):.        if
-0000fda0: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-0000fdb0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-0000fdc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fdd0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0000fde0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-0000fdf0: 2020 2020 2020 206d 6152 616e 6765 203d         maRange =
-0000fe00: 205b 392c 2031 302c 2032 302c 2035 302c   [9, 10, 20, 50,
-0000fe10: 2032 3030 5d20 6966 206d 614c 656e 6774   200] if maLengt
-0000fe20: 6820 696e 205b 392c 3130 2c32 302c 3530  h in [9,10,20,50
-0000fe30: 2c31 3030 5d20 656c 7365 205b 392c 3130  ,100] else [9,10
-0000fe40: 2c32 302c 3530 2c31 3030 2c6d 6152 616e  ,20,50,100,maRan
-0000fe50: 6765 5d0a 2020 2020 2020 2020 7265 7375  ge].        resu
-0000fe60: 6c74 7320 3d20 5b5d 0a20 2020 2020 2020  lts = [].       
-0000fe70: 2068 6173 5265 7665 7273 616c 7320 3d20   hasReversals = 
-0000fe80: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0000fe90: 7461 203d 2064 6174 615b 3a3a 2d31 5d0a  ta = data[::-1].
-0000fea0: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
-0000feb0: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
-0000fec0: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
-0000fed0: 6e44 6963 742c 7361 7665 4469 6374 2c20  nDict,saveDict, 
-0000fee0: 224d 412d 5369 676e 616c 2229 0a20 2020  "MA-Signal").   
-0000fef0: 2020 2020 2066 6f72 206d 614c 656e 6774       for maLengt
-0000ff00: 6820 696e 206d 6152 616e 6765 3a0a 2020  h in maRange:.  
-0000ff10: 2020 2020 2020 2020 2020 6461 7461 436f            dataCo
-0000ff20: 7079 203d 2064 6174 610a 2020 2020 2020  py = data.      
-0000ff30: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-0000ff40: 6e66 6967 4d61 6e61 6765 722e 7573 6545  nfigManager.useE
-0000ff50: 4d41 206f 7220 6d61 4c65 6e67 7468 203d  MA or maLength =
-0000ff60: 3d20 393a 0a20 2020 2020 2020 2020 2020  = 9:.           
-0000ff70: 2020 2020 206d 6152 6576 203d 2070 6b74       maRev = pkt
-0000ff80: 616c 6962 2e45 4d41 2864 6174 6143 6f70  alib.EMA(dataCop
-0000ff90: 795b 2243 6c6f 7365 225d 2c20 7469 6d65  y["Close"], time
-0000ffa0: 7065 7269 6f64 3d6d 614c 656e 6774 6829  period=maLength)
-0000ffb0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000ffc0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ffd0: 2020 206d 6152 6576 203d 2070 6b74 616c     maRev = pktal
-0000ffe0: 6962 2e4d 4128 6461 7461 436f 7079 5b22  ib.MA(dataCopy["
-0000fff0: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-00010000: 696f 643d 6d61 4c65 6e67 7468 290a 2020  iod=maLength).  
-00010010: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00010020: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00010030: 6174 6143 6f70 792e 6472 6f70 2822 6d61  ataCopy.drop("ma
-00010040: 5265 7622 2c20 6178 6973 3d31 2c20 696e  Rev", axis=1, in
-00010050: 706c 6163 653d 5472 7565 2c20 6572 726f  place=True, erro
-00010060: 7273 3d22 6967 6e6f 7265 2229 0a20 2020  rs="ignore").   
-00010070: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00010080: 4578 6365 7074 696f 6e3a 2320 7072 6167  Exception:# prag
-00010090: 6d61 3a20 6e6f 2063 6f76 6572 0a20 2020  ma: no cover.   
-000100a0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-000100b0: 730a 2020 2020 2020 2020 2020 2020 6461  s.            da
-000100c0: 7461 436f 7079 2e69 6e73 6572 7428 6c65  taCopy.insert(le
-000100d0: 6e28 6461 7461 436f 7079 2e63 6f6c 756d  n(dataCopy.colum
-000100e0: 6e73 292c 2022 6d61 5265 7622 2c20 6d61  ns), "maRev", ma
-000100f0: 5265 7629 0a20 2020 2020 2020 2020 2020  Rev).           
-00010100: 2064 6174 6143 6f70 7920 3d20 6461 7461   dataCopy = data
-00010110: 436f 7079 5b3a 3a2d 315d 2e68 6561 6428  Copy[::-1].head(
-00010120: 3429 0a20 2020 2020 2020 2020 2020 2062  4).            b
-00010130: 756c 6c69 7368 4d41 5265 7665 7273 616c  ullishMAReversal
-00010140: 203d 2064 6174 6143 6f70 795b 226d 6152   = dataCopy["maR
-00010150: 6576 225d 2e69 6c6f 635b 305d 203e 3d20  ev"].iloc[0] >= 
-00010160: 6461 7461 436f 7079 5b22 6d61 5265 7622  dataCopy["maRev"
-00010170: 5d2e 696c 6f63 5b31 5d20 616e 6420 5c0a  ].iloc[1] and \.
-00010180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010190: 6461 7461 436f 7079 5b22 6d61 5265 7622  dataCopy["maRev"
-000101a0: 5d2e 696c 6f63 5b31 5d20 3e3d 2064 6174  ].iloc[1] >= dat
-000101b0: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-000101c0: 6c6f 635b 325d 2061 6e64 205c 0a20 2020  loc[2] and \.   
-000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101e0: 2064 6174 6143 6f70 795b 226d 6152 6576   dataCopy["maRev
-000101f0: 225d 2e69 6c6f 635b 325d 203c 2064 6174  "].iloc[2] < dat
-00010200: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
-00010210: 6c6f 635b 335d 0a20 2020 2020 2020 2020  loc[3].         
-00010220: 2020 2062 756c 6c69 7368 436c 6f73 6520     bullishClose 
-00010230: 3d20 6461 7461 436f 7079 2e68 6561 6428  = dataCopy.head(
-00010240: 3129 5b22 436c 6f73 6522 5d2e 696c 6f63  1)["Close"].iloc
-00010250: 5b30 5d20 3e3d 2064 6174 6143 6f70 792e  [0] >= dataCopy.
-00010260: 6865 6164 2831 295b 226d 6152 6576 225d  head(1)["maRev"]
-00010270: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
-00010280: 2020 2020 2062 6561 7269 7368 4d41 5265       bearishMARe
-00010290: 7665 7273 616c 203d 2064 6174 6143 6f70  versal = dataCop
-000102a0: 795b 226d 6152 6576 225d 2e69 6c6f 635b  y["maRev"].iloc[
-000102b0: 305d 203c 3d20 6461 7461 436f 7079 5b22  0] <= dataCopy["
-000102c0: 6d61 5265 7622 5d2e 696c 6f63 5b31 5d20  maRev"].iloc[1] 
-000102d0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-000102e0: 2020 2020 2020 6461 7461 436f 7079 5b22        dataCopy["
-000102f0: 6d61 5265 7622 5d2e 696c 6f63 5b31 5d20  maRev"].iloc[1] 
-00010300: 3c3d 2064 6174 6143 6f70 795b 226d 6152  <= dataCopy["maR
-00010310: 6576 225d 2e69 6c6f 635b 325d 2061 6e64  ev"].iloc[2] and
-00010320: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00010330: 2020 2020 2020 2064 6174 6143 6f70 795b         dataCopy[
-00010340: 226d 6152 6576 225d 2e69 6c6f 635b 325d  "maRev"].iloc[2]
-00010350: 203e 2064 6174 6143 6f70 795b 226d 6152   > dataCopy["maR
-00010360: 6576 225d 2e69 6c6f 635b 335d 0a20 2020  ev"].iloc[3].   
-00010370: 2020 2020 2020 2020 2069 7352 6563 656e           isRecen
-00010380: 7443 6c6f 7365 5769 7468 696e 5065 7263  tCloseWithinPerc
-00010390: 656e 7452 616e 6765 203d 2064 6174 6143  entRange = dataC
-000103a0: 6f70 792e 6571 7561 6c73 2864 6174 6143  opy.equals(dataC
-000103b0: 6f70 795b 2864 6174 6143 6f70 792e 436c  opy[(dataCopy.Cl
-000103c0: 6f73 6520 3e3d 2028 6461 7461 436f 7079  ose >= (dataCopy
-000103d0: 2e6d 6152 6576 202d 2028 6461 7461 436f  .maRev - (dataCo
-000103e0: 7079 2e6d 6152 6576 202a 2070 6572 6365  py.maRev * perce
-000103f0: 6e74 6167 6529 2929 2026 2028 6461 7461  ntage))) & (data
-00010400: 436f 7079 2e43 6c6f 7365 203c 3d20 2864  Copy.Close <= (d
-00010410: 6174 6143 6f70 792e 6d61 5265 7620 2b20  ataCopy.maRev + 
-00010420: 2864 6174 6143 6f70 792e 6d61 5265 7620  (dataCopy.maRev 
-00010430: 2a20 7065 7263 656e 7461 6765 2929 295d  * percentage)))]
-00010440: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00010450: 2028 6973 5265 6365 6e74 436c 6f73 6557   (isRecentCloseW
-00010460: 6974 6869 6e50 6572 6365 6e74 5261 6e67  ithinPercentRang
-00010470: 6520 616e 6420 6275 6c6c 6973 6843 6c6f  e and bullishClo
-00010480: 7365 2061 6e64 2062 756c 6c69 7368 4d41  se and bullishMA
-00010490: 5265 7665 7273 616c 2920 6f72 205c 0a20  Reversal) or \. 
-000104a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000104b0: 6973 5265 6365 6e74 436c 6f73 6557 6974  isRecentCloseWit
-000104c0: 6869 6e50 6572 6365 6e74 5261 6e67 6520  hinPercentRange 
-000104d0: 616e 6420 6e6f 7420 6275 6c6c 6973 6843  and not bullishC
-000104e0: 6c6f 7365 2061 6e64 2062 6561 7269 7368  lose and bearish
-000104f0: 4d41 5265 7665 7273 616c 293a 0a20 2020  MAReversal):.   
-00010500: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00010510: 5265 7665 7273 616c 7320 3d20 5472 7565  Reversals = True
-00010520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010530: 2072 6573 756c 7473 2e61 7070 656e 6428   results.append(
-00010540: 7374 7228 6d61 4c65 6e67 7468 2929 0a20  str(maLength)). 
-00010550: 2020 2020 2020 2069 6620 6861 7352 6576         if hasRev
-00010560: 6572 7361 6c73 3a0a 2020 2020 2020 2020  ersals:.        
-00010570: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-00010580: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
-00010590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105a0: 7361 7665 645b 305d 200a 2020 2020 2020  saved[0] .      
-000105b0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-000105c0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-000105d0: 2020 2020 2020 2020 2020 202b 2028 636f             + (co
-000105e0: 6c6f 7254 6578 742e 4752 4545 4e20 6966  lorText.GREEN if
-000105f0: 2062 756c 6c69 7368 4d41 5265 7665 7273   bullishMARevers
-00010600: 616c 2065 6c73 6520 2863 6f6c 6f72 5465  al else (colorTe
-00010610: 7874 2e46 4149 4c20 6966 2062 6561 7269  xt.FAIL if beari
-00010620: 7368 4d41 5265 7665 7273 616c 2065 6c73  shMAReversal els
-00010630: 6520 636f 6c6f 7254 6578 742e 5741 524e  e colorText.WARN
-00010640: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00010650: 2020 202b 2066 2252 6576 6572 7361 6c2d     + f"Reversal-
-00010660: 5b7b 272c 272e 6a6f 696e 2872 6573 756c  [{','.join(resul
-00010670: 7473 297d 5d7b 2745 4d41 2720 6966 2028  ts)}]{'EMA' if (
-00010680: 6d61 4c65 6e67 7468 203d 3d20 3920 6f72  maLength == 9 or
-00010690: 2073 656c 662e 636f 6e66 6967 4d61 6e61   self.configMana
-000106a0: 6765 722e 7573 6545 4d41 2920 656c 7365  ger.useEMA) else
-000106b0: 2027 4d41 277d 220a 2020 2020 2020 2020   'MA'}".        
-000106c0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-000106d0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-000106e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000106f0: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
-00010700: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
-00010710: 315d 202b 2066 2252 6576 6572 7361 6c2d  1] + f"Reversal-
-00010720: 5b7b 272c 272e 6a6f 696e 2872 6573 756c  [{','.join(resul
-00010730: 7473 297d 5d7b 2745 4d41 2720 6966 2028  ts)}]{'EMA' if (
-00010740: 6d61 4c65 6e67 7468 203d 3d20 3920 6f72  maLength == 9 or
-00010750: 2073 656c 662e 636f 6e66 6967 4d61 6e61   self.configMana
-00010760: 6765 722e 7573 6545 4d41 2920 656c 7365  ger.useEMA) else
-00010770: 2027 4d41 277d 220a 2020 2020 2020 2020   'MA'}".        
-00010780: 7265 7475 726e 2068 6173 5265 7665 7273  return hasRevers
-00010790: 616c 730a 0a20 2020 2064 6566 2066 696e  als..    def fin
-000107a0: 6443 7572 7265 6e74 5361 7665 6456 616c  dCurrentSavedVal
-000107b0: 7565 2873 656c 662c 2073 6372 6565 6e44  ue(self, screenD
-000107c0: 6963 742c 2073 6176 6544 6963 742c 206b  ict, saveDict, k
-000107d0: 6579 293a 0a20 2020 2020 2020 2065 7869  ey):.        exi
-000107e0: 7374 696e 6753 6372 6565 6e20 3d20 7363  stingScreen = sc
-000107f0: 7265 656e 4469 6374 2e67 6574 286b 6579  reenDict.get(key
-00010800: 290a 2020 2020 2020 2020 6578 6973 7469  ).        existi
-00010810: 6e67 5361 7665 203d 2073 6176 6544 6963  ngSave = saveDic
-00010820: 742e 6765 7428 6b65 7929 0a20 2020 2020  t.get(key).     
-00010830: 2020 2065 7869 7374 696e 6753 6372 6565     existingScree
-00010840: 6e20 3d20 6622 7b65 7869 7374 696e 6753  n = f"{existingS
-00010850: 6372 6565 6e7d 2c20 2220 6966 2028 6578  creen}, " if (ex
-00010860: 6973 7469 6e67 5363 7265 656e 2069 7320  istingScreen is 
-00010870: 6e6f 7420 4e6f 6e65 2061 6e64 206c 656e  not None and len
-00010880: 2865 7869 7374 696e 6753 6372 6565 6e29  (existingScreen)
-00010890: 203e 2030 2920 656c 7365 2022 220a 2020   > 0) else "".  
-000108a0: 2020 2020 2020 6578 6973 7469 6e67 5361        existingSa
-000108b0: 7665 203d 2066 227b 6578 6973 7469 6e67  ve = f"{existing
-000108c0: 5361 7665 7d2c 2022 2069 6620 2865 7869  Save}, " if (exi
-000108d0: 7374 696e 6753 6176 6520 6973 206e 6f74  stingSave is not
-000108e0: 204e 6f6e 6520 616e 6420 6c65 6e28 6578   None and len(ex
-000108f0: 6973 7469 6e67 5361 7665 2920 3e20 3029  istingSave) > 0)
-00010900: 2065 6c73 6520 2222 0a20 2020 2020 2020   else "".       
-00010910: 2072 6574 7572 6e20 6578 6973 7469 6e67   return existing
-00010920: 5363 7265 656e 2c20 6578 6973 7469 6e67  Screen, existing
-00010930: 5361 7665 0a0a 2020 2020 2320 406d 6561  Save..    # @mea
-00010940: 7375 7265 5f74 696d 650a 2020 2020 6465  sure_time.    de
-00010950: 6620 6669 6e64 4262 616e 6473 5371 7565  f findBbandsSque
-00010960: 657a 6528 7365 6c66 2c66 756c 6c44 6174  eze(self,fullDat
-00010970: 612c 2073 6372 6565 6e44 6963 742c 2073  a, screenDict, s
-00010980: 6176 6544 6963 742c 2066 696c 7465 723d  aveDict, filter=
-00010990: 3429 3a0a 2020 2020 2020 2020 2222 220a  4):.        """.
-000109a0: 2020 2020 2020 2020 5468 6520 5454 4d20          The TTM 
-000109b0: 5371 7565 657a 6520 696e 6469 6361 746f  Squeeze indicato
-000109c0: 7220 6d65 6173 7572 6573 2074 6865 2072  r measures the r
-000109d0: 656c 6174 696f 6e73 6869 7020 6265 7477  elationship betw
-000109e0: 6565 6e20 7468 6520 0a20 2020 2020 2020  een the .       
-000109f0: 2042 6f6c 6c69 6e67 6572 2042 616e 6473   Bollinger Bands
-00010a00: 2061 6e64 204b 656c 746e 6572 2773 2043   and Keltner's C
-00010a10: 6861 6e6e 656c 2e20 5768 656e 2074 6865  hannel. When the
-00010a20: 2076 6f6c 6174 696c 6974 7920 696e 6372   volatility incr
-00010a30: 6561 7365 732c 200a 2020 2020 2020 2020  eases, .        
-00010a40: 736f 2064 6f65 7320 7468 6520 6469 7374  so does the dist
-00010a50: 616e 6365 2062 6574 7765 656e 2074 6865  ance between the
-00010a60: 2062 616e 6473 2c20 616e 6420 636f 6e76   bands, and conv
-00010a70: 6572 7365 6c79 2c20 7768 656e 2074 6865  ersely, when the
-00010a80: 200a 2020 2020 2020 2020 766f 6c61 7469   .        volati
-00010a90: 6c69 7479 2064 6563 6c69 6e65 732c 2074  lity declines, t
-00010aa0: 6865 2064 6973 7461 6e63 6520 616c 736f  he distance also
-00010ab0: 2064 6563 7265 6173 6573 2e20 5468 6520   decreases. The 
-00010ac0: 5371 7565 657a 6520 696e 6469 6361 746f  Squeeze indicato
-00010ad0: 7220 0a20 2020 2020 2020 2066 696e 6473  r .        finds
-00010ae0: 2073 6563 7469 6f6e 7320 6f66 2074 6865   sections of the
-00010af0: 2042 6f6c 6c69 6e67 6572 2042 616e 6473   Bollinger Bands
-00010b00: 2073 7475 6479 2077 6869 6368 2066 616c   study which fal
-00010b10: 6c20 696e 7369 6465 2074 6865 200a 2020  l inside the .  
-00010b20: 2020 2020 2020 4b65 6c74 6e65 7227 7320        Keltner's 
-00010b30: 4368 616e 6e65 6c73 2e0a 2020 2020 2020  Channels..      
-00010b40: 2020 0a20 2020 2020 2020 2041 7420 7468    .        At th
-00010b50: 6520 6d6f 6d65 6e74 2074 6869 7320 7371  e moment this sq
-00010b60: 7565 657a 6520 6861 7070 656e 732c 2061  ueeze happens, a
-00010b70: 2070 7269 6365 2062 7265 616b 6f75 7420   price breakout 
-00010b80: 6672 6f6d 2074 6865 2075 7070 6572 200a  from the upper .
-00010b90: 2020 2020 2020 2020 426f 6c6c 696e 6765          Bollinge
-00010ba0: 7220 4261 6e64 2077 6f75 6c64 2069 6e64  r Band would ind
-00010bb0: 6963 6174 6520 7468 6520 706f 7373 6962  icate the possib
-00010bc0: 696c 6974 7920 6f66 2061 6e20 7570 7472  ility of an uptr
-00010bd0: 656e 6420 696e 2074 6865 200a 2020 2020  end in the .    
-00010be0: 2020 2020 6675 7475 7265 2e20 5468 6973      future. This
-00010bf0: 2069 7320 6261 636b 6564 2062 7920 7468   is backed by th
-00010c00: 6520 6661 6374 2074 6861 7420 6f6e 6365  e fact that once
-00010c10: 2074 6865 2070 7269 6365 2073 7461 7274   the price start
-00010c20: 7320 6272 6561 6b69 6e67 200a 2020 2020  s breaking .    
-00010c30: 2020 2020 6f75 7420 6f66 2074 6865 2062      out of the b
-00010c40: 616e 6473 2c20 6974 2077 6f75 6c64 206d  ands, it would m
-00010c50: 6561 6e20 6120 7265 6c61 7861 7469 6f6e  ean a relaxation
-00010c60: 206f 6620 7468 6520 7371 7565 657a 6520   of the squeeze 
-00010c70: 616e 6420 7468 6520 0a20 2020 2020 2020  and the .       
-00010c80: 2070 6f73 7369 6269 6c69 7479 206f 6620   possibility of 
-00010c90: 6869 6768 206d 6172 6b65 7420 766f 6c61  high market vola
-00010ca0: 7469 6c69 7479 2061 6e64 2070 7269 6365  tility and price
-00010cb0: 206d 6f76 656d 656e 7420 696e 2074 6865   movement in the
-00010cc0: 2066 7574 7572 652e 200a 2020 2020 2020   future. .      
-00010cd0: 2020 5369 6d69 6c61 726c 792c 2061 2070    Similarly, a p
-00010ce0: 7269 6365 2062 7265 616b 6f75 7420 6672  rice breakout fr
-00010cf0: 6f6d 2074 6865 206c 6f77 6572 2042 6f6c  om the lower Bol
-00010d00: 6c69 6e67 6572 2042 616e 6420 6166 7465  linger Band afte
-00010d10: 7220 6120 7371 7565 657a 6520 0a20 2020  r a squeeze .   
-00010d20: 2020 2020 2077 6f75 6c64 2069 6e64 6963       would indic
-00010d30: 6174 6520 7468 6520 706f 7373 6962 696c  ate the possibil
-00010d40: 6974 7920 6f66 2061 2064 6f77 6e74 7265  ity of a downtre
-00010d50: 6e64 2069 6e20 7468 6520 6675 7475 7265  nd in the future
-00010d60: 2061 6e64 2061 6e20 0a20 2020 2020 2020   and an .       
-00010d70: 2069 6e63 7265 6173 6564 206d 6172 6b65   increased marke
-00010d80: 7420 766f 6c61 7469 6c69 7479 2069 6e20  t volatility in 
-00010d90: 7468 6520 7361 6d65 2064 6972 6563 7469  the same directi
-00010da0: 6f6e 2e20 5768 656e 2074 6865 206d 6172  on. When the mar
-00010db0: 6b65 7420 0a20 2020 2020 2020 2066 696e  ket .        fin
-00010dc0: 6973 6865 7320 6120 6d6f 7665 2c20 7468  ishes a move, th
-00010dd0: 6520 696e 6469 6361 746f 7220 7475 726e  e indicator turn
-00010de0: 7320 6f66 662c 2077 6869 6368 2063 6f72  s off, which cor
-00010df0: 7265 7370 6f6e 6473 2074 6f20 6261 6e64  responds to band
-00010e00: 7320 0a20 2020 2020 2020 2068 6176 696e  s .        havin
-00010e10: 6720 7075 7368 6564 2077 656c 6c20 6f75  g pushed well ou
-00010e20: 7473 6964 6520 7468 6520 7261 6e67 6520  tside the range 
-00010e30: 6f66 204b 656c 746e 6572 2773 2043 6861  of Keltner's Cha
-00010e40: 6e6e 656c 732e 0a20 2020 2020 2020 2022  nnels..        "
-00010e50: 2222 0a20 2020 2020 2020 2069 6620 6675  "".        if fu
-00010e60: 6c6c 4461 7461 2069 7320 4e6f 6e65 206f  llData is None o
-00010e70: 7220 6c65 6e28 6675 6c6c 4461 7461 2920  r len(fullData) 
-00010e80: 3c20 3230 3a0a 2020 2020 2020 2020 2020  < 20:.          
-00010e90: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00010ea0: 2020 2020 2020 206f 6c64 6573 7452 6563         oldestRec
-00010eb0: 6f72 6473 4669 7273 745f 6466 203d 2066  ordsFirst_df = f
-00010ec0: 756c 6c44 6174 612e 6865 6164 2833 3029  ullData.head(30)
-00010ed0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-00010ee0: 6c61 7465 7374 5265 636f 7264 7346 6972  latestRecordsFir
-00010ef0: 7374 5f64 6620 3d20 6f6c 6465 7374 5265  st_df = oldestRe
-00010f00: 636f 7264 7346 6972 7374 5f64 665b 3a3a  cordsFirst_df[::
-00010f10: 2d31 5d2e 7461 696c 2833 3029 0a20 2020  -1].tail(30).   
-00010f20: 2020 2020 206c 6174 6573 7452 6563 6f72       latestRecor
-00010f30: 6473 4669 7273 745f 6466 203d 206c 6174  dsFirst_df = lat
-00010f40: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
-00010f50: 6466 2e66 696c 6c6e 6128 3029 0a20 2020  df.fillna(0).   
-00010f60: 2020 2020 206c 6174 6573 7452 6563 6f72       latestRecor
-00010f70: 6473 4669 7273 745f 6466 203d 206c 6174  dsFirst_df = lat
-00010f80: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
-00010f90: 6466 2e72 6570 6c61 6365 285b 6e70 2e69  df.replace([np.i
-00010fa0: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
-00010fb0: 0a20 2020 2020 2020 2023 2042 6f6c 6c69  .        # Bolli
-00010fc0: 6e67 6572 2062 616e 6473 0a20 2020 2020  nger bands.     
-00010fd0: 2020 206c 6174 6573 7452 6563 6f72 6473     latestRecords
-00010fe0: 4669 7273 745f 6466 2e6c 6f63 5b3a 2c27  First_df.loc[:,'
-00010ff0: 4242 616e 6473 2d55 275d 2c20 6c61 7465  BBands-U'], late
-00011000: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
-00011010: 662e 6c6f 635b 3a2c 2742 4261 6e64 732d  f.loc[:,'BBands-
-00011020: 4d27 5d2c 206c 6174 6573 7452 6563 6f72  M'], latestRecor
-00011030: 6473 4669 7273 745f 6466 2e6c 6f63 5b3a  dsFirst_df.loc[:
-00011040: 2c27 4242 616e 6473 2d4c 275d 203d 2070  ,'BBands-L'] = p
-00011050: 6b74 616c 6962 2e42 4241 4e44 5328 6c61  ktalib.BBANDS(la
-00011060: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
-00011070: 5f64 665b 2243 6c6f 7365 225d 2c20 3230  _df["Close"], 20
-00011080: 290a 2020 2020 2020 2020 2320 636f 6d70  ).        # comp
-00011090: 7574 6520 4b65 6c74 6e65 7227 7320 6368  ute Keltner's ch
-000110a0: 616e 6e65 6c0a 2020 2020 2020 2020 6c61  annel.        la
-000110b0: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
-000110c0: 5f64 665b 276c 6f77 5f6b 656c 275d 2c20  _df['low_kel'], 
-000110d0: 6c61 7465 7374 5265 636f 7264 7346 6972  latestRecordsFir
-000110e0: 7374 5f64 665b 2775 7070 5f6b 656c 275d  st_df['upp_kel']
-000110f0: 203d 2070 6b74 616c 6962 2e4b 656c 746e   = pktalib.Keltn
-00011100: 6572 7343 6861 6e6e 656c 286c 6174 6573  ersChannel(lates
-00011110: 7452 6563 6f72 6473 4669 7273 745f 6466  tRecordsFirst_df
-00011120: 5b22 4869 6768 225d 2c20 6c61 7465 7374  ["High"], latest
-00011130: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
-00011140: 224c 6f77 225d 2c6c 6174 6573 7452 6563  "Low"],latestRec
-00011150: 6f72 6473 4669 7273 745f 6466 5b22 436c  ordsFirst_df["Cl
-00011160: 6f73 6522 5d2c 3230 290a 2020 2020 2020  ose"],20).      
-00011170: 2020 2320 7371 7565 657a 6520 696e 6469    # squeeze indi
-00011180: 6361 746f 720a 2020 2020 2020 2020 6465  cator.        de
-00011190: 6620 696e 5f73 7175 6565 7a65 2864 6629  f in_squeeze(df)
-000111a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000111b0: 7475 726e 2064 665b 276c 6f77 5f6b 656c  turn df['low_kel
-000111c0: 275d 203c 2064 665b 2742 4261 6e64 732d  '] < df['BBands-
-000111d0: 4c27 5d20 3c20 6466 5b27 4242 616e 6473  L'] < df['BBands
-000111e0: 2d55 275d 203c 2064 665b 2775 7070 5f6b  -U'] < df['upp_k
-000111f0: 656c 275d 0a0a 2020 2020 2020 2020 6c61  el']..        la
-00011200: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
-00011210: 5f64 665b 2773 7175 6565 7a65 275d 203d  _df['squeeze'] =
-00011220: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
-00011230: 7273 745f 6466 2e61 7070 6c79 2869 6e5f  rst_df.apply(in_
-00011240: 7371 7565 657a 652c 2061 7869 733d 3129  squeeze, axis=1)
-00011250: 0a0a 2020 2020 2020 2020 2320 4c65 7427  ..        # Let'
-00011260: 7320 7265 7669 6577 206a 7573 7420 7468  s review just th
-00011270: 6520 7072 6576 696f 7573 2033 2063 616e  e previous 3 can
-00011280: 646c 6573 2069 6e63 6c75 6469 6e67 2074  dles including t
-00011290: 6f64 6179 2028 6174 2074 6865 2065 6e64  oday (at the end
-000112a0: 290a 2020 2020 2020 2020 6c61 7465 7374  ).        latest
-000112b0: 5265 636f 7264 7346 6972 7374 5f64 6620  RecordsFirst_df 
-000112c0: 3d20 6c61 7465 7374 5265 636f 7264 7346  = latestRecordsF
-000112d0: 6972 7374 5f64 662e 7461 696c 2833 290a  irst_df.tail(3).
-000112e0: 2020 2020 2020 2020 2320 7374 6f63 6b20          # stock 
-000112f0: 6973 2063 6f6d 696e 6720 6f75 7420 6f66  is coming out of
-00011300: 2074 6865 2073 7175 6565 7a65 0a20 2020   the squeeze.   
-00011310: 2020 2020 2073 6176 6564 203d 2073 656c       saved = sel
-00011320: 662e 6669 6e64 4375 7272 656e 7453 6176  f.findCurrentSav
-00011330: 6564 5661 6c75 6528 7363 7265 656e 4469  edValue(screenDi
-00011340: 6374 2c20 7361 7665 4469 6374 2c20 2250  ct, saveDict, "P
-00011350: 6174 7465 726e 2229 0a20 2020 2020 2020  attern").       
-00011360: 2063 616e 646c 6533 5371 7a20 3d20 6c61   candle3Sqz = la
-00011370: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
-00011380: 5f64 662e 696c 6f63 5b2d 335d 5b22 7371  _df.iloc[-3]["sq
-00011390: 7565 657a 6522 5d0a 2020 2020 2020 2020  ueeze"].        
-000113a0: 6361 6e64 6c65 3153 717a 203d 206c 6174  candle1Sqz = lat
-000113b0: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
-000113c0: 6466 2e69 6c6f 635b 2d31 5d5b 2273 7175  df.iloc[-1]["squ
-000113d0: 6565 7a65 225d 0a20 2020 2020 2020 2063  eeze"].        c
-000113e0: 616e 646c 6532 5371 7a20 3d20 6c61 7465  andle2Sqz = late
-000113f0: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
-00011400: 662e 696c 6f63 5b2d 325d 5b22 7371 7565  f.iloc[-2]["sque
-00011410: 657a 6522 5d0a 2020 2020 2020 2020 6966  eze"].        if
-00011420: 2063 616e 646c 6533 5371 7a20 616e 6420   candle3Sqz and 
-00011430: 6e6f 7420 6361 6e64 6c65 3153 717a 3a0a  not candle1Sqz:.
-00011440: 2020 2020 2020 2020 2020 2020 2320 3372              # 3r
-00011450: 6420 6361 6e64 6c65 2066 726f 6d20 7468  d candle from th
-00011460: 6520 6d6f 7374 2072 6563 656e 7420 6f6e  e most recent on
-00011470: 6520 7761 7320 696e 2073 7175 6565 7a65  e was in squeeze
-00011480: 2062 7574 2074 6865 206d 6f73 7420 7265   but the most re
-00011490: 6365 6e74 206f 6e65 2069 7320 6e6f 742e  cent one is not.
-000114a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000114b0: 6669 6c74 6572 206e 6f74 2069 6e20 5b31  filter not in [1
-000114c0: 2c33 2c34 5d3a 2023 2042 7579 2f53 656c  ,3,4]: # Buy/Sel
-000114d0: 6c2f 416c 6c0a 2020 2020 2020 2020 2020  l/All.          
-000114e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000114f0: 7365 0a20 2020 2020 2020 2020 2020 2023  se.            #
-00011500: 2064 6563 6964 6520 7768 6963 6820 6163   decide which ac
-00011510: 7469 6f6e 2074 6f20 7461 6b65 2062 7920  tion to take by 
-00011520: 636f 6d70 6172 696e 6720 6469 7374 616e  comparing distan
-00011530: 6365 7320 2020 2020 2020 2020 2020 2020  ces             
-00011540: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00011550: 6469 7374 616e 6365 5f74 6f5f 7570 7065  distance_to_uppe
-00011560: 7220 3d20 6162 7328 6c61 7465 7374 5265  r = abs(latestRe
-00011570: 636f 7264 7346 6972 7374 5f64 665b 2742  cordsFirst_df['B
-00011580: 4261 6e64 732d 5527 5d2e 7661 6c75 6573  Bands-U'].values
-00011590: 5b2d 315d 202d 206c 6174 6573 7452 6563  [-1] - latestRec
-000115a0: 6f72 6473 4669 7273 745f 6466 5b27 436c  ordsFirst_df['Cl
-000115b0: 6f73 6527 5d2e 7661 6c75 6573 5b2d 315d  ose'].values[-1]
-000115c0: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-000115d0: 7374 616e 6365 5f74 6f5f 6c6f 7765 7220  stance_to_lower 
-000115e0: 3d20 6162 7328 6c61 7465 7374 5265 636f  = abs(latestReco
-000115f0: 7264 7346 6972 7374 5f64 665b 2742 4261  rdsFirst_df['BBa
-00011600: 6e64 732d 4c27 5d2e 7661 6c75 6573 5b2d  nds-L'].values[-
-00011610: 315d 202d 206c 6174 6573 7452 6563 6f72  1] - latestRecor
-00011620: 6473 4669 7273 745f 6466 5b27 436c 6f73  dsFirst_df['Clos
-00011630: 6527 5d2e 7661 6c75 6573 5b2d 315d 290a  e'].values[-1]).
-00011640: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00011650: 2020 2020 2020 2020 2061 6374 696f 6e20           action 
-00011660: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00011670: 2020 2020 6966 2064 6973 7461 6e63 655f      if distance_
-00011680: 746f 5f75 7070 6572 203c 2064 6973 7461  to_upper < dista
-00011690: 6e63 655f 746f 5f6c 6f77 6572 3a0a 2020  nce_to_lower:.  
-000116a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000116b0: 2066 696c 7465 7220 6e6f 7420 696e 205b   filter not in [
-000116c0: 312c 345d 3a20 2320 4275 792f 416c 6c0a  1,4]: # Buy/All.
-000116d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116e0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000116f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011700: 2061 6374 696f 6e20 3d20 5472 7565 0a20   action = True. 
-00011710: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00011720: 6669 6c74 6572 206e 6f74 2069 6e20 5b33  filter not in [3
-00011730: 2c34 5d3a 2023 2053 656c 6c2f 416c 6c0a  ,4]: # Sell/All.
-00011740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011750: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00011760: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00011770: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00011780: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
-00011790: 7254 6578 742e 424f 4c44 202b 2028 636f  rText.BOLD + (co
-000117a0: 6c6f 7254 6578 742e 4752 4545 4e20 6966  lorText.GREEN if
-000117b0: 2061 6374 696f 6e20 656c 7365 2063 6f6c   action else col
-000117c0: 6f72 5465 7874 2e46 4149 4c29 202b 2066  orText.FAIL) + f
-000117d0: 2242 4261 6e64 732d 5351 5a2d 7b27 4275  "BBands-SQZ-{'Bu
-000117e0: 7927 2069 6620 6163 7469 6f6e 2065 6c73  y' if action els
-000117f0: 6520 2753 656c 6c27 7d22 202b 2063 6f6c  e 'Sell'}" + col
-00011800: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00011810: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-00011820: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
-00011830: 6564 5b31 5d20 2b20 6622 5454 4d2d 5351  ed[1] + f"TTM-SQ
-00011840: 5a2d 7b27 4275 7927 2069 6620 6163 7469  Z-{'Buy' if acti
-00011850: 6f6e 2065 6c73 6520 2753 656c 6c27 7d22  on else 'Sell'}"
-00011860: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00011870: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-00011880: 2065 6c69 6620 6361 6e64 6c65 3353 717a   elif candle3Sqz
-00011890: 2061 6e64 2063 616e 646c 6532 5371 7a20   and candle2Sqz 
-000118a0: 616e 6420 6361 6e64 6c65 3153 717a 3a0a  and candle1Sqz:.
-000118b0: 2020 2020 2020 2020 2020 2020 2320 4c61              # La
-000118c0: 7374 2033 2063 616e 646c 6573 2069 6e20  st 3 candles in 
-000118d0: 7371 7565 657a 650a 2020 2020 2020 2020  squeeze.        
-000118e0: 2020 2020 6966 2066 696c 7465 7220 6e6f      if filter no
-000118f0: 7420 696e 205b 322c 345d 3a20 2320 5371  t in [2,4]: # Sq
-00011900: 5a2f 416c 6c0a 2020 2020 2020 2020 2020  Z/All.          
-00011910: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00011920: 7365 0a20 2020 2020 2020 2020 2020 2073  se.            s
-00011930: 6372 6565 6e44 6963 745b 2250 6174 7465  creenDict["Patte
-00011940: 726e 225d 203d 2066 277b 7361 7665 645b  rn"] = f'{saved[
-00011950: 305d 7d7b 636f 6c6f 7254 6578 742e 424f  0]}{colorText.BO
-00011960: 4c44 7d7b 636f 6c6f 7254 6578 742e 5741  LD}{colorText.WA
-00011970: 524e 7d54 544d 2d53 515a 7b63 6f6c 6f72  RN}TTM-SQZ{color
-00011980: 5465 7874 2e45 4e44 7d27 0a20 2020 2020  Text.END}'.     
-00011990: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-000119a0: 2250 6174 7465 726e 225d 203d 2066 277b  "Pattern"] = f'{
-000119b0: 7361 7665 645b 315d 7d54 544d 2d53 515a  saved[1]}TTM-SQZ
-000119c0: 270a 2020 2020 2020 2020 2020 2020 7265  '.            re
-000119d0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-000119e0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-000119f0: 2020 2020 6465 6620 6669 6e64 496e 7472      def findIntr
-00011a00: 6164 6179 4869 6768 4372 6f73 736f 7665  adayHighCrossove
-00011a10: 7228 7365 6c66 2c20 6466 2c20 6166 7465  r(self, df, afte
-00011a20: 7254 696d 6573 7461 6d70 3d4e 6f6e 6529  rTimestamp=None)
-00011a30: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
-00011a40: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
-00011a50: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
-00011a60: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00011a70: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-00011a80: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
-00011a90: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
-00011aa0: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
-00011ab0: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
-00011ac0: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
-00011ad0: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
-00011ae0: 2020 2064 6174 6120 3d20 6461 7461 5b3a     data = data[:
-00011af0: 3a2d 315d 2020 2320 5265 7665 7273 6520  :-1]  # Reverse 
-00011b00: 7468 6520 6461 7461 6672 616d 6520 736f  the dataframe so
-00011b10: 2074 6861 7420 6974 7320 7468 6520 6f6c   that its the ol
-00011b20: 6465 7374 2064 6174 6520 6669 7273 740a  dest date first.
-00011b30: 2020 2020 2020 2020 6469 6666 5f64 6620          diff_df 
-00011b40: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
-00011b50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00011b60: 2320 4c65 7427 7320 6f6e 6c79 2063 6f6e  # Let's only con
-00011b70: 7369 6465 7220 7468 6f73 6520 6361 6e64  sider those cand
-00011b80: 6c65 7320 7468 6174 2061 7265 2061 6674  les that are aft
-00011b90: 6572 2074 6865 2061 6c65 7274 2069 7373  er the alert iss
-00011ba0: 7565 2d74 696d 6520 696e 2074 6865 206d  ue-time in the m
-00011bb0: 6f72 6e69 6e67 7320 2b20 3220 6361 6e64  ornings + 2 cand
-00011bc0: 6c65 7320 2866 6f72 2062 7579 2f73 656c  les (for buy/sel
-00011bd0: 6c29 0a20 2020 2020 2020 2020 2020 2064  l).            d
-00011be0: 6966 665f 6466 203d 2064 6174 615b 6461  iff_df = data[da
-00011bf0: 7461 2e69 6e64 6578 203e 3d20 2070 642e  ta.index >=  pd.
-00011c00: 746f 5f64 6174 6574 696d 6528 6627 7b50  to_datetime(f'{P
-00011c10: 4b44 6174 6555 7469 6c69 7469 6573 2e74  KDateUtilities.t
-00011c20: 7261 6469 6e67 4461 7465 2829 2e73 7472  radingDate().str
-00011c30: 6674 696d 6528 6622 2559 2d25 6d2d 2564  ftime(f"%Y-%m-%d
-00011c40: 2229 7d20 3039 3a7b 3135 2b73 656c 662e  ")} 09:{15+self.
-00011c50: 636f 6e66 6967 4d61 6e61 6765 722e 6d6f  configManager.mo
-00011c60: 726e 696e 6761 6e61 6c79 7369 7363 616e  rninganalysiscan
-00011c70: 646c 656e 756d 6265 7220 2b20 327d 3a30  dlenumber + 2}:0
-00011c80: 302b 3035 3a33 3027 292e 746f 5f64 6174  0+05:30').to_dat
-00011c90: 6574 696d 6536 3428 295d 0a20 2020 2020  etime64()].     
-00011ca0: 2020 2020 2020 2023 2062 726f 6b65 7253         # brokerS
-00011cb0: 7172 4f66 6674 696d 6520 3d20 7064 2e74  qrOfftime = pd.t
-00011cc0: 6f5f 6461 7465 7469 6d65 2866 277b 504b  o_datetime(f'{PK
-00011cd0: 4461 7465 5574 696c 6974 6965 732e 7472  DateUtilities.tr
-00011ce0: 6164 696e 6744 6174 6528 292e 7374 7266  adingDate().strf
-00011cf0: 7469 6d65 2866 2225 592d 256d 2d25 6422  time(f"%Y-%m-%d"
-00011d00: 297d 2031 353a 3134 3a30 302b 3035 3a33  )} 15:14:00+05:3
-00011d10: 3027 292e 746f 5f64 6174 6574 696d 6536  0').to_datetime6
-00011d20: 3428 290a 2020 2020 2020 2020 6578 6365  4().        exce
-00011d30: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-00011d40: 6469 6666 5f64 6620 3d20 6461 7461 5b64  diff_df = data[d
-00011d50: 6174 612e 696e 6465 7820 3e3d 2020 7064  ata.index >=  pd
-00011d60: 2e74 6f5f 6461 7465 7469 6d65 2866 277b  .to_datetime(f'{
-00011d70: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
-00011d80: 7472 6164 696e 6744 6174 6528 292e 7374  tradingDate().st
-00011d90: 7266 7469 6d65 2866 2225 592d 256d 2d25  rftime(f"%Y-%m-%
-00011da0: 6422 297d 2030 393a 7b31 352b 7365 6c66  d")} 09:{15+self
-00011db0: 2e63 6f6e 6669 674d 616e 6167 6572 2e6d  .configManager.m
-00011dc0: 6f72 6e69 6e67 616e 616c 7973 6973 6361  orninganalysisca
-00011dd0: 6e64 6c65 6e75 6d62 6572 202b 2032 7d3a  ndlenumber + 2}:
-00011de0: 3030 2b30 353a 3330 272c 2075 7463 3d54  00+05:30', utc=T
-00011df0: 7275 6529 5d0a 2020 2020 2020 2020 2020  rue)].          
-00011e00: 2020 2320 6272 6f6b 6572 5371 724f 6666    # brokerSqrOff
-00011e10: 7469 6d65 203d 2070 642e 746f 5f64 6174  time = pd.to_dat
-00011e20: 6574 696d 6528 6627 7b50 4b44 6174 6555  etime(f'{PKDateU
-00011e30: 7469 6c69 7469 6573 2e74 7261 6469 6e67  tilities.trading
-00011e40: 4461 7465 2829 2e73 7472 6674 696d 6528  Date().strftime(
-00011e50: 6622 2559 2d25 6d2d 2564 2229 7d20 3135  f"%Y-%m-%d")} 15
-00011e60: 3a31 343a 3030 2b30 353a 3330 272c 2075  :14:00+05:30', u
-00011e70: 7463 3d54 7275 6529 0a20 2020 2020 2020  tc=True).       
-00011e80: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00011e90: 2020 6461 7948 6967 6841 6674 6572 416c    dayHighAfterAl
-00011ea0: 6572 7420 3d20 6469 6666 5f64 665b 2248  ert = diff_df["H
-00011eb0: 6967 6822 5d2e 6d61 7828 290a 2020 2020  igh"].max().    
-00011ec0: 2020 2020 6869 6768 526f 7720 3d20 6469      highRow = di
-00011ed0: 6666 5f64 665b 6469 6666 5f64 665b 2248  ff_df[diff_df["H
-00011ee0: 6967 6822 5d20 3e3d 2064 6179 4869 6768  igh"] >= dayHigh
-00011ef0: 4166 7465 7241 6c65 7274 5d0a 2020 2020  AfterAlert].    
-00011f00: 2020 2020 6966 2068 6967 6852 6f77 2069      if highRow i
-00011f10: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-00011f20: 656e 2868 6967 6852 6f77 2920 3e20 303a  en(highRow) > 0:
-00011f30: 0a20 2020 2020 2020 2020 2020 2068 6967  .            hig
-00011f40: 6852 6f77 203d 2068 6967 6852 6f77 2e74  hRow = highRow.t
-00011f50: 6169 6c28 3129 0a20 2020 2020 2020 2072  ail(1).        r
-00011f60: 6574 7572 6e20 6869 6768 526f 772e 696e  eturn highRow.in
-00011f70: 6465 785b 2d31 5d2c 2068 6967 6852 6f77  dex[-1], highRow
-00011f80: 0a0a 0a20 2020 2064 6566 2066 696e 644d  ...    def findM
-00011f90: 4143 4443 726f 7373 6f76 6572 2873 656c  ACDCrossover(sel
-00011fa0: 662c 2064 662c 2061 6674 6572 5469 6d65  f, df, afterTime
-00011fb0: 7374 616d 703d 4e6f 6e65 2c20 6e74 6843  stamp=None, nthC
-00011fc0: 726f 7373 6f76 6572 3d31 2c20 7570 4469  rossover=1, upDi
-00011fd0: 7265 6374 696f 6e3d 5472 7565 2c20 6d69  rection=True, mi
-00011fe0: 6e52 5349 3d36 3029 3a0a 2020 2020 2020  nRSI=60):.      
-00011ff0: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-00012000: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-00012010: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00012020: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00012030: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-00012040: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-00012050: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-00012060: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00012070: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00012080: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-00012090: 3029 0a20 2020 2020 2020 2064 6174 612e  0).        data.
-000120a0: 6472 6f70 6e61 2861 7869 733d 302c 2068  dropna(axis=0, h
-000120b0: 6f77 3d22 616c 6c22 2c20 696e 706c 6163  ow="all", inplac
-000120c0: 653d 5472 7565 2920 2320 4d61 7962 6520  e=True) # Maybe 
-000120d0: 7468 6572 6520 7761 7320 6e6f 2074 7261  there was no tra
-000120e0: 6465 2064 6f6e 6520 6174 2074 6865 7365  de done at these
-000120f0: 2074 696d 6573 3f0a 2020 2020 2020 2020   times?.        
-00012100: 6461 7461 203d 2064 6174 615b 3a3a 2d31  data = data[::-1
-00012110: 5d20 2023 2052 6576 6572 7365 2074 6865  ]  # Reverse the
-00012120: 2064 6174 6166 7261 6d65 2073 6f20 7468   dataframe so th
-00012130: 6174 2069 7473 2074 6865 206f 6c64 6573  at its the oldes
-00012140: 7420 6461 7465 2066 6972 7374 0a20 2020  t date first.   
-00012150: 2020 2020 206d 6163 644c 696e 652c 206d       macdLine, m
-00012160: 6163 6453 6967 6e61 6c2c 206d 6163 6448  acdSignal, macdH
-00012170: 6973 7420 3d20 706b 7461 6c69 622e 4d41  ist = pktalib.MA
-00012180: 4344 2864 6174 615b 2243 6c6f 7365 225d  CD(data["Close"]
-00012190: 2c20 3132 2c20 3236 2c20 3929 0a20 2020  , 12, 26, 9).   
-000121a0: 2020 2020 2023 2072 7369 5f64 6620 3d20       # rsi_df = 
-000121b0: 706b 7461 6c69 622e 5253 4928 6461 7461  pktalib.RSI(data
-000121c0: 5b22 436c 6f73 6522 5d2c 2031 3429 0a20  ["Close"], 14). 
-000121d0: 2020 2020 2020 206c 696e 655f 6466 203d         line_df =
-000121e0: 2070 642e 4461 7461 4672 616d 6528 6d61   pd.DataFrame(ma
-000121f0: 6364 4c69 6e65 290a 2020 2020 2020 2020  cdLine).        
-00012200: 7369 676e 616c 5f64 6620 3d20 7064 2e44  signal_df = pd.D
-00012210: 6174 6146 7261 6d65 286d 6163 6453 6967  ataFrame(macdSig
-00012220: 6e61 6c29 0a20 2020 2020 2020 2076 6f6c  nal).        vol
-00012230: 5f64 6620 3d20 6461 7461 5b22 566f 6c75  _df = data["Volu
-00012240: 6d65 225d 0a20 2020 2020 2020 2064 6966  me"].        dif
-00012250: 665f 6466 203d 2070 642e 636f 6e63 6174  f_df = pd.concat
-00012260: 285b 6c69 6e65 5f64 662c 2073 6967 6e61  ([line_df, signa
-00012270: 6c5f 6466 2c20 7369 676e 616c 5f64 662d  l_df, signal_df-
-00012280: 6c69 6e65 5f64 662c 766f 6c5f 6466 5d2c  line_df,vol_df],
-00012290: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
-000122a0: 2064 6966 665f 6466 2e63 6f6c 756d 6e73   diff_df.columns
-000122b0: 203d 205b 226c 696e 6522 2c22 7369 676e   = ["line","sign
-000122c0: 616c 222c 2264 6966 6622 2c22 766f 6c22  al","diff","vol"
-000122d0: 5d0a 2020 2020 2020 2020 6469 6666 5f64  ].        diff_d
-000122e0: 6620 3d20 6469 6666 5f64 665b 6469 6666  f = diff_df[diff
-000122f0: 5f64 665b 2276 6f6c 225d 203e 2030 5d20  _df["vol"] > 0] 
-00012300: 2320 5765 2772 6520 6e6f 7420 676f 696e  # We're not goin
-00012310: 6720 746f 2064 6f20 616e 7974 6869 6e67  g to do anything
-00012320: 2077 6974 6820 6120 6361 6e64 6c65 2077   with a candle w
-00012330: 6865 7265 2074 6865 7265 2077 6173 206e  here there was n
-00012340: 6f20 7472 6164 652e 0a20 2020 2020 2020  o trade..       
-00012350: 2023 2062 726f 6b65 7253 7172 4f66 6674   # brokerSqrOfft
-00012360: 696d 6520 3d20 4e6f 6e65 0a20 2020 2020  ime = None.     
-00012370: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00012380: 2020 2020 2320 4c65 7427 7320 6f6e 6c79      # Let's only
-00012390: 2063 6f6e 7369 6465 7220 7468 6f73 6520   consider those 
-000123a0: 6361 6e64 6c65 7320 7468 6174 2061 7265  candles that are
-000123b0: 2061 6674 6572 2074 6865 2061 6c65 7274   after the alert
-000123c0: 2069 7373 7565 2d74 696d 6520 696e 2074   issue-time in t
-000123d0: 6865 206d 6f72 6e69 6e67 7320 2b20 3220  he mornings + 2 
-000123e0: 6361 6e64 6c65 7320 2866 6f72 2062 7579  candles (for buy
-000123f0: 2f73 656c 6c29 0a20 2020 2020 2020 2020  /sell).         
-00012400: 2020 2064 6966 665f 6466 203d 2064 6966     diff_df = dif
-00012410: 665f 6466 5b64 6966 665f 6466 2e69 6e64  f_df[diff_df.ind
-00012420: 6578 203e 3d20 2070 642e 746f 5f64 6174  ex >=  pd.to_dat
-00012430: 6574 696d 6528 6627 7b50 4b44 6174 6555  etime(f'{PKDateU
-00012440: 7469 6c69 7469 6573 2e74 7261 6469 6e67  tilities.trading
-00012450: 4461 7465 2829 2e73 7472 6674 696d 6528  Date().strftime(
-00012460: 6622 2559 2d25 6d2d 2564 2229 7d20 3039  f"%Y-%m-%d")} 09
-00012470: 3a7b 3135 2b73 656c 662e 636f 6e66 6967  :{15+self.config
-00012480: 4d61 6e61 6765 722e 6d6f 726e 696e 6761  Manager.morninga
-00012490: 6e61 6c79 7369 7363 616e 646c 656e 756d  nalysiscandlenum
-000124a0: 6265 7220 2b20 327d 3a30 302b 3035 3a33  ber + 2}:00+05:3
-000124b0: 3027 292e 746f 5f64 6174 6574 696d 6536  0').to_datetime6
-000124c0: 3428 295d 0a20 2020 2020 2020 2020 2020  4()].           
-000124d0: 2023 2062 726f 6b65 7253 7172 4f66 6674   # brokerSqrOfft
-000124e0: 696d 6520 3d20 7064 2e74 6f5f 6461 7465  ime = pd.to_date
-000124f0: 7469 6d65 2866 277b 504b 4461 7465 5574  time(f'{PKDateUt
-00012500: 696c 6974 6965 732e 7472 6164 696e 6744  ilities.tradingD
-00012510: 6174 6528 292e 7374 7266 7469 6d65 2866  ate().strftime(f
-00012520: 2225 592d 256d 2d25 6422 297d 2031 353a  "%Y-%m-%d")} 15:
-00012530: 3134 3a30 302b 3035 3a33 3027 292e 746f  14:00+05:30').to
-00012540: 5f64 6174 6574 696d 6536 3428 290a 2020  _datetime64().  
-00012550: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00012560: 2020 2020 2020 2020 2020 6469 6666 5f64            diff_d
-00012570: 6620 3d20 6469 6666 5f64 665b 6469 6666  f = diff_df[diff
-00012580: 5f64 662e 696e 6465 7820 3e3d 2020 7064  _df.index >=  pd
-00012590: 2e74 6f5f 6461 7465 7469 6d65 2866 277b  .to_datetime(f'{
-000125a0: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
-000125b0: 7472 6164 696e 6744 6174 6528 292e 7374  tradingDate().st
-000125c0: 7266 7469 6d65 2866 2225 592d 256d 2d25  rftime(f"%Y-%m-%
-000125d0: 6422 297d 2030 393a 7b31 352b 7365 6c66  d")} 09:{15+self
-000125e0: 2e63 6f6e 6669 674d 616e 6167 6572 2e6d  .configManager.m
-000125f0: 6f72 6e69 6e67 616e 616c 7973 6973 6361  orninganalysisca
-00012600: 6e64 6c65 6e75 6d62 6572 202b 2032 7d3a  ndlenumber + 2}:
-00012610: 3030 2b30 353a 3330 272c 2075 7463 3d54  00+05:30', utc=T
-00012620: 7275 6529 5d0a 2020 2020 2020 2020 2020  rue)].          
-00012630: 2020 2320 6272 6f6b 6572 5371 724f 6666    # brokerSqrOff
-00012640: 7469 6d65 203d 2070 642e 746f 5f64 6174  time = pd.to_dat
-00012650: 6574 696d 6528 6627 7b50 4b44 6174 6555  etime(f'{PKDateU
-00012660: 7469 6c69 7469 6573 2e74 7261 6469 6e67  tilities.trading
-00012670: 4461 7465 2829 2e73 7472 6674 696d 6528  Date().strftime(
-00012680: 6622 2559 2d25 6d2d 2564 2229 7d20 3135  f"%Y-%m-%d")} 15
-00012690: 3a31 343a 3030 2b30 353a 3330 272c 2075  :14:00+05:30', u
-000126a0: 7463 3d54 7275 6529 0a20 2020 2020 2020  tc=True).       
-000126b0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-000126c0: 2020 696e 6465 7820 3d20 6c65 6e28 6469    index = len(di
-000126d0: 6666 5f64 6629 0a20 2020 2020 2020 2063  ff_df).        c
-000126e0: 726f 7373 4f76 6572 203d 2030 0a20 2020  rossOver = 0.   
-000126f0: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
-00012700: 4c6f 6f70 2075 6e74 696c 2077 6527 7665  Loop until we've
-00012710: 2066 6f75 6e64 2074 6865 206e 7468 2063   found the nth c
-00012720: 726f 7373 6f76 6572 2066 6f72 204d 4143  rossover for MAC
-00012730: 4420 6f72 2077 6527 7665 2072 6561 6368  D or we've reach
-00012740: 6564 2074 6865 206c 6173 7420 706f 696e  ed the last poin
-00012750: 7420 696e 2074 696d 650a 2020 2020 2020  t in time.      
-00012760: 2020 7768 696c 6520 2863 726f 7373 4f76    while (crossOv
-00012770: 6572 203c 206e 7468 4372 6f73 736f 7665  er < nthCrossove
-00012780: 7220 616e 6420 696e 6465 7820 3e3d 3029  r and index >=0)
-00012790: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000127a0: 2064 6966 665f 6466 5b22 6469 6666 225d   diff_df["diff"]
-000127b0: 5b69 6e64 6578 2d31 5d20 3c20 303a 2023  [index-1] < 0: #
-000127c0: 2053 6967 6e61 6c20 6c69 6e65 2068 6173   Signal line has
-000127d0: 206e 6f74 2063 726f 7373 6564 2079 6574   not crossed yet
-000127e0: 2061 6e64 2069 7320 6265 6c6f 7720 7468   and is below th
-000127f0: 6520 7a65 726f 206c 696e 650a 2020 2020  e zero line.    
-00012800: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-00012810: 6528 2864 6966 665f 6466 5b22 6469 6666  e((diff_df["diff
-00012820: 225d 5b69 6e64 6578 2d31 5d20 3c20 3020  "][index-1] < 0 
-00012830: 616e 6420 696e 6465 7820 3e3d 3029 293a  and index >=0)):
-00012840: 2023 2061 6e64 2064 6966 665f 6466 2e69   # and diff_df.i
-00012850: 6e64 6578 203c 3d20 6272 6f6b 6572 5371  ndex <= brokerSq
-00012860: 724f 6666 7469 6d65 293a 2023 206f 7220  rOfftime): # or 
-00012870: 6469 6666 5f64 665b 2272 7369 225d 5b69  diff_df["rsi"][i
-00012880: 6e64 6578 2d31 5d20 3c3d 206d 696e 5253  ndex-1] <= minRS
-00012890: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
-000128a0: 2020 2020 2020 2020 2320 4c6f 6f70 2077          # Loop w
-000128b0: 6869 6c65 2053 6967 6e61 6c20 6c69 6e65  hile Signal line
-000128c0: 2068 6173 206e 6f74 2063 726f 7373 6564   has not crossed
-000128d0: 2079 6574 2061 6e64 2069 7320 6265 6c6f   yet and is belo
-000128e0: 7720 7468 6520 7a65 726f 206c 696e 6520  w the zero line 
-000128f0: 616e 6420 7765 2776 6520 6e6f 7420 7265  and we've not re
-00012900: 6163 6865 6420 7468 6520 6c61 7374 2070  ached the last p
-00012910: 6f69 6e74 0a20 2020 2020 2020 2020 2020  oint.           
-00012920: 2020 2020 2020 2020 2069 6e64 6578 202d           index -
-00012930: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00012940: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00012950: 2020 2020 2020 7768 696c 6528 2864 6966        while((dif
-00012960: 665f 6466 5b22 6469 6666 225d 5b69 6e64  f_df["diff"][ind
-00012970: 6578 2d31 5d20 3e3d 2030 2061 6e64 2069  ex-1] >= 0 and i
-00012980: 6e64 6578 203e 3d30 2929 3a20 2320 616e  ndex >=0)): # an
-00012990: 6420 6469 6666 5f64 662e 696e 6465 7820  d diff_df.index 
-000129a0: 3c3d 2062 726f 6b65 7253 7172 4f66 6674  <= brokerSqrOfft
-000129b0: 696d 6529 3a20 2320 6f72 2064 6966 665f  ime): # or diff_
-000129c0: 6466 5b22 7273 6922 5d5b 696e 6465 782d  df["rsi"][index-
-000129d0: 315d 203c 3d20 6d69 6e52 5349 293a 0a20  1] <= minRSI):. 
-000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129f0: 2020 2023 204c 6f6f 7020 756e 7469 6c20     # Loop until 
-00012a00: 7369 676e 616c 206c 696e 6520 6861 7320  signal line has 
-00012a10: 6e6f 7420 6372 6f73 7365 6420 7965 7420  not crossed yet 
-00012a20: 616e 6420 6973 2061 626f 7665 2074 6865  and is above the
-00012a30: 207a 6572 6f20 6c69 6e65 0a20 2020 2020   zero line.     
-00012a40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012a50: 6e64 6578 202d 3d20 310a 2020 2020 2020  ndex -= 1.      
-00012a60: 2020 2020 2020 6372 6f73 734f 7665 7220        crossOver 
-00012a70: 2b3d 2031 0a20 2020 2020 2020 2074 7320  += 1.        ts 
-00012a80: 3d20 6469 6666 5f64 662e 7461 696c 286c  = diff_df.tail(l
-00012a90: 656e 2864 6966 665f 6466 292d 696e 6465  en(diff_df)-inde
-00012aa0: 7820 2b31 292e 6865 6164 2831 292e 696e  x +1).head(1).in
-00012ab0: 6465 785b 2d31 5d0a 2020 2020 2020 2020  dex[-1].        
-00012ac0: 7265 7475 726e 2074 732c 2064 6174 615b  return ts, data[
-00012ad0: 6461 7461 2e69 6e64 6578 203d 3d20 7473  data.index == ts
-00012ae0: 5d20 2364 662e 6865 6164 286c 656e 2864  ] #df.head(len(d
-00012af0: 6629 202d 696e 6465 7820 2b31 292e 7461  f) -index +1).ta
-00012b00: 696c 2831 290a 2020 2020 0a20 2020 2023  il(1).    .    #
-00012b10: 2046 696e 6420 7374 6f63 6b20 7368 6f77   Find stock show
-00012b20: 696e 6720 5253 4920 6372 6f73 7369 6e67  ing RSI crossing
-00012b30: 2077 6974 6820 5253 4920 3920 534d 410a   with RSI 9 SMA.
-00012b40: 2020 2020 6465 6620 6669 6e64 5253 4943      def findRSIC
-00012b50: 726f 7373 696e 674d 4128 7365 6c66 2c20  rossingMA(self, 
-00012b60: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
-00012b70: 7361 7665 4469 6374 2c6c 6f6f 6b46 6f72  saveDict,lookFor
-00012b80: 3d31 2c20 6d61 4c65 6e67 7468 3d39 2c20  =1, maLength=9, 
-00012b90: 7273 694b 6579 3d22 5253 4922 293a 0a20  rsiKey="RSI"):. 
-00012ba0: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-00012bb0: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-00012bc0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00012bd0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00012be0: 2020 2020 2020 2069 6620 7273 694b 6579         if rsiKey
-00012bf0: 206e 6f74 2069 6e20 6466 2e63 6f6c 756d   not in df.colum
-00012c00: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00012c10: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00012c20: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-00012c30: 6f70 7928 290a 2020 2020 2020 2020 6461  opy().        da
-00012c40: 7461 203d 2064 6174 615b 3a3a 2d31 5d0a  ta = data[::-1].
-00012c50: 2020 2020 2020 2020 6d61 5273 6920 3d20          maRsi = 
-00012c60: 706b 7461 6c69 622e 4d41 2864 6174 615b  pktalib.MA(data[
-00012c70: 7273 694b 6579 5d2c 2074 696d 6570 6572  rsiKey], timeper
-00012c80: 696f 643d 6d61 4c65 6e67 7468 290a 2020  iod=maLength).  
-00012c90: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00012ca0: 615b 3a3a 2d31 5d2e 6865 6164 2833 290a  a[::-1].head(3).
-00012cb0: 2020 2020 2020 2020 6d61 5273 6920 3d20          maRsi = 
-00012cc0: 6d61 5273 695b 3a3a 2d31 5d2e 6865 6164  maRsi[::-1].head
-00012cd0: 2833 290a 2020 2020 2020 2020 7361 7665  (3).        save
-00012ce0: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-00012cf0: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-00012d00: 6372 6565 6e44 6963 742c 7361 7665 4469  creenDict,saveDi
-00012d10: 6374 2c22 5472 656e 6422 290a 2020 2020  ct,"Trend").    
-00012d20: 2020 2020 6966 206c 6f6f 6b46 6f72 2069      if lookFor i
-00012d30: 6e20 5b31 2c33 5d20 616e 6420 6d61 5273  n [1,3] and maRs
-00012d40: 692e 696c 6f63 5b30 5d20 3c3d 2064 6174  i.iloc[0] <= dat
-00012d50: 615b 7273 694b 6579 5d2e 696c 6f63 5b30  a[rsiKey].iloc[0
-00012d60: 5d20 616e 6420 6d61 5273 692e 696c 6f63  ] and maRsi.iloc
-00012d70: 5b31 5d20 3e20 6461 7461 5b72 7369 4b65  [1] > data[rsiKe
-00012d80: 795d 2e69 6c6f 635b 315d 3a0a 2020 2020  y].iloc[1]:.    
-00012d90: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00012da0: 6374 5b27 4d41 2d53 6967 6e61 6c27 5d20  ct['MA-Signal'] 
-00012db0: 3d20 7361 7665 645b 305d 202b 2063 6f6c  = saved[0] + col
-00012dc0: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00012dd0: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
-00012de0: 6627 5253 492d 4d41 2d42 7579 2720 2b20  f'RSI-MA-Buy' + 
-00012df0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-00012e00: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-00012e10: 6374 5b27 4d41 2d53 6967 6e61 6c27 5d20  ct['MA-Signal'] 
-00012e20: 3d20 7361 7665 645b 315d 202b 2066 2752  = saved[1] + f'R
-00012e30: 5349 2d4d 412d 4275 7927 0a20 2020 2020  SI-MA-Buy'.     
-00012e40: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00012e50: 7565 2069 6620 2872 7369 4b65 7920 3d3d  ue if (rsiKey ==
-00012e60: 2022 5253 4969 2229 2065 6c73 6520 2873   "RSIi") else (s
-00012e70: 656c 662e 6669 6e64 5253 4943 726f 7373  elf.findRSICross
-00012e80: 696e 674d 4128 6466 2c20 7363 7265 656e  ingMA(df, screen
-00012e90: 4469 6374 2c20 7361 7665 4469 6374 2c6c  Dict, saveDict,l
-00012ea0: 6f6f 6b46 6f72 3d6c 6f6f 6b46 6f72 2c20  ookFor=lookFor, 
-00012eb0: 6d61 4c65 6e67 7468 3d6d 614c 656e 6774  maLength=maLengt
-00012ec0: 682c 2072 7369 4b65 793d 2252 5349 6922  h, rsiKey="RSIi"
-00012ed0: 2920 6f72 2054 7275 6529 0a20 2020 2020  ) or True).     
-00012ee0: 2020 2065 6c69 6620 6c6f 6f6b 466f 7220     elif lookFor 
-00012ef0: 696e 205b 322c 335d 2061 6e64 206d 6152  in [2,3] and maR
-00012f00: 7369 2e69 6c6f 635b 305d 203e 3d20 6461  si.iloc[0] >= da
-00012f10: 7461 5b72 7369 4b65 795d 2e69 6c6f 635b  ta[rsiKey].iloc[
-00012f20: 305d 2061 6e64 206d 6152 7369 2e69 6c6f  0] and maRsi.ilo
-00012f30: 635b 315d 203c 2064 6174 615b 7273 694b  c[1] < data[rsiK
-00012f40: 6579 5d2e 696c 6f63 5b31 5d3a 0a20 2020  ey].iloc[1]:.   
-00012f50: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00012f60: 6963 745b 274d 412d 5369 676e 616c 275d  ict['MA-Signal']
-00012f70: 203d 2073 6176 6564 5b30 5d20 2b20 636f   = saved[0] + co
-00012f80: 6c6f 7254 6578 742e 424f 4c44 202b 2063  lorText.BOLD + c
-00012f90: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
-00012fa0: 6627 5253 492d 4d41 2d53 656c 6c27 202b  f'RSI-MA-Sell' +
-00012fb0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-00012fc0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00012fd0: 6963 745b 274d 412d 5369 676e 616c 275d  ict['MA-Signal']
-00012fe0: 203d 2073 6176 6564 5b31 5d20 2b20 6627   = saved[1] + f'
-00012ff0: 5253 492d 4d41 2d53 656c 6c27 0a20 2020  RSI-MA-Sell'.   
-00013000: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013010: 5472 7565 2069 6620 2872 7369 4b65 7920  True if (rsiKey 
-00013020: 3d3d 2022 5253 4969 2229 2065 6c73 6520  == "RSIi") else 
-00013030: 2873 656c 662e 6669 6e64 5253 4943 726f  (self.findRSICro
-00013040: 7373 696e 674d 4128 6466 2c20 7363 7265  ssingMA(df, scre
-00013050: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
-00013060: 2c6c 6f6f 6b46 6f72 3d6c 6f6f 6b46 6f72  ,lookFor=lookFor
-00013070: 2c20 6d61 4c65 6e67 7468 3d6d 614c 656e  , maLength=maLen
-00013080: 6774 682c 2072 7369 4b65 793d 2252 5349  gth, rsiKey="RSI
-00013090: 6922 2920 6f72 2054 7275 6529 0a20 2020  i") or True).   
-000130a0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-000130b0: 6520 6966 2028 7273 694b 6579 203d 3d20  e if (rsiKey == 
-000130c0: 2252 5349 6922 2920 656c 7365 2028 7365  "RSIi") else (se
-000130d0: 6c66 2e66 696e 6452 5349 4372 6f73 7369  lf.findRSICrossi
-000130e0: 6e67 4d41 2864 662c 2073 6372 6565 6e44  ngMA(df, screenD
-000130f0: 6963 742c 2073 6176 6544 6963 742c 6c6f  ict, saveDict,lo
-00013100: 6f6b 466f 723d 6c6f 6f6b 466f 722c 206d  okFor=lookFor, m
-00013110: 614c 656e 6774 683d 6d61 4c65 6e67 7468  aLength=maLength
-00013120: 2c20 7273 694b 6579 3d22 5253 4969 2229  , rsiKey="RSIi")
-00013130: 290a 2020 2020 0a20 2020 2023 2046 696e  ).    .    # Fin
-00013140: 6420 7374 6f63 6b73 2077 6974 6820 7269  d stocks with ri
-00013150: 7369 6e67 2052 5349 2066 726f 6d20 6c6f  sing RSI from lo
-00013160: 7765 7220 6c65 7665 6c73 0a20 2020 2064  wer levels.    d
-00013170: 6566 2066 696e 6452 6973 696e 6752 5349  ef findRisingRSI
-00013180: 2873 656c 662c 2064 662c 2072 7369 4b65  (self, df, rsiKe
-00013190: 793d 2252 5349 2229 3a0a 2020 2020 2020  y="RSI"):.      
-000131a0: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-000131b0: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-000131c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000131d0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-000131e0: 2020 6966 2072 7369 4b65 7920 6e6f 7420    if rsiKey not 
-000131f0: 696e 2064 662e 636f 6c75 6d6e 733a 0a20  in df.columns:. 
-00013200: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013210: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-00013220: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
-00013230: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00013240: 6461 7461 5b3a 3a2d 315d 0a20 2020 2020  data[::-1].     
-00013250: 2020 2064 6174 6120 3d20 6461 7461 2e74     data = data.t
-00013260: 6169 6c28 3329 0a20 2020 2020 2020 2069  ail(3).        i
-00013270: 6620 6c65 6e28 6461 7461 2920 3c20 333a  f len(data) < 3:
-00013280: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013290: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-000132a0: 2020 6461 794d 696e 7573 3252 5349 203d    dayMinus2RSI =
-000132b0: 2064 6174 615b 2252 5349 225d 2e69 6c6f   data["RSI"].ilo
-000132c0: 635b 305d 0a20 2020 2020 2020 2064 6179  c[0].        day
-000132d0: 4d69 6e75 7331 5253 4920 3d20 6461 7461  Minus1RSI = data
-000132e0: 5b22 5253 4922 5d2e 696c 6f63 5b31 5d0a  ["RSI"].iloc[1].
-000132f0: 2020 2020 2020 2020 6461 7952 5349 203d          dayRSI =
-00013300: 2064 6174 615b 2252 5349 225d 2e69 6c6f   data["RSI"].ilo
-00013310: 635b 325d 0a20 2020 2020 2020 2072 6574  c[2].        ret
-00013320: 7572 6e56 616c 7565 203d 2028 6461 794d  urnValue = (dayM
-00013330: 696e 7573 3252 5349 203c 3d20 3335 2061  inus2RSI <= 35 a
-00013340: 6e64 2064 6179 4d69 6e75 7331 5253 4920  nd dayMinus1RSI 
-00013350: 3e20 6461 794d 696e 7573 3252 5349 2061  > dayMinus2RSI a
-00013360: 6e64 2064 6179 5253 4920 3e20 6461 794d  nd dayRSI > dayM
-00013370: 696e 7573 3152 5349 2920 6f72 205c 0a20  inus1RSI) or \. 
-00013380: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00013390: 6461 794d 696e 7573 3152 5349 203c 3d20  dayMinus1RSI <= 
-000133a0: 3335 2061 6e64 2064 6179 5253 4920 3e20  35 and dayRSI > 
-000133b0: 6461 794d 696e 7573 3152 5349 290a 2020  dayMinus1RSI).  
-000133c0: 2020 2020 2020 6966 2072 7369 4b65 7920        if rsiKey 
-000133d0: 3d3d 2022 5253 4922 3a0a 2020 2020 2020  == "RSI":.      
-000133e0: 2020 2020 2020 7265 7475 726e 5661 6c75        returnValu
-000133f0: 6520 3d20 7365 6c66 2e66 696e 6452 6973  e = self.findRis
-00013400: 696e 6752 5349 2864 662c 2072 7369 4b65  ingRSI(df, rsiKe
-00013410: 793d 2252 5349 6922 2920 6f72 2072 6574  y="RSIi") or ret
-00013420: 7572 6e56 616c 7565 0a20 2020 2020 2020  urnValue.       
-00013430: 2072 6574 7572 6e20 7265 7475 726e 5661   return returnVa
-00013440: 6c75 650a 0a20 2020 2023 406d 6561 7375  lue..    #@measu
-00013450: 7265 5f74 696d 650a 2020 2020 2320 4669  re_time.    # Fi
-00013460: 6e64 206f 7574 2074 7265 6e64 2066 6f72  nd out trend for
-00013470: 2064 6179 7320 746f 206c 6f6f 6b62 6163   days to lookbac
-00013480: 6b0a 2020 2020 6465 6620 6669 6e64 5472  k.    def findTr
-00013490: 656e 6428 7365 6c66 2c20 6466 2c20 7363  end(self, df, sc
-000134a0: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-000134b0: 6374 2c20 6461 7973 546f 4c6f 6f6b 6261  ct, daysToLookba
-000134c0: 636b 3d4e 6f6e 652c 2073 746f 636b 4e61  ck=None, stockNa
-000134d0: 6d65 3d22 2229 3a0a 2020 2020 2020 2020  me=""):.        
-000134e0: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
-000134f0: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
-00013500: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013510: 6e20 2255 6e6b 6e6f 776e 220a 2020 2020  n "Unknown".    
-00013520: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
-00013530: 7079 2829 0a20 2020 2020 2020 2069 6620  py().        if 
-00013540: 6461 7973 546f 4c6f 6f6b 6261 636b 2069  daysToLookback i
-00013550: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00013560: 2020 2020 6461 7973 546f 4c6f 6f6b 6261      daysToLookba
-00013570: 636b 203d 2073 656c 662e 636f 6e66 6967  ck = self.config
-00013580: 4d61 6e61 6765 722e 6461 7973 546f 4c6f  Manager.daysToLo
-00013590: 6f6b 6261 636b 0a20 2020 2020 2020 2064  okback.        d
-000135a0: 6174 6120 3d20 6461 7461 2e68 6561 6428  ata = data.head(
-000135b0: 6461 7973 546f 4c6f 6f6b 6261 636b 290a  daysToLookback).
-000135c0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000135d0: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
-000135e0: 2020 6461 7461 203d 2064 6174 612e 7365    data = data.se
-000135f0: 745f 696e 6465 7828 6e70 2e61 7261 6e67  t_index(np.arang
-00013600: 6528 6c65 6e28 6461 7461 2929 290a 2020  e(len(data))).  
-00013610: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00013620: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
-00013630: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-00013640: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
-00013650: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
-00013660: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00013670: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00013680: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00013690: 6963 742c 7361 7665 4469 6374 2c22 5472  ict,saveDict,"Tr
-000136a0: 656e 6422 290a 2020 2020 2020 2020 7472  end").        tr
-000136b0: 793a 0a20 2020 2020 2020 2020 2020 2077  y:.            w
-000136c0: 6974 6820 5375 7070 7265 7373 4f75 7470  ith SuppressOutp
-000136d0: 7574 2873 7570 7072 6573 735f 7374 646f  ut(suppress_stdo
-000136e0: 7574 3d54 7275 652c 2073 7570 7072 6573  ut=True, suppres
-000136f0: 735f 7374 6465 7272 3d54 7275 6529 3a0a  s_stderr=True):.
-00013700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013710: 6461 7461 5b22 746f 7073 225d 203d 2064  data["tops"] = d
-00013720: 6174 615b 2243 6c6f 7365 225d 2e69 6c6f  ata["Close"].ilo
-00013730: 635b 0a20 2020 2020 2020 2020 2020 2020  c[.             
-00013740: 2020 2020 2020 206c 6973 7428 0a20 2020         list(.   
-00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013760: 2020 2020 2070 6b74 616c 6962 2e61 7267       pktalib.arg
-00013770: 7265 6c65 7874 7265 6d61 280a 2020 2020  relextrema(.    
-00013780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013790: 2020 2020 2020 2020 6e70 2e61 7272 6179          np.array
-000137a0: 2864 6174 615b 2243 6c6f 7365 225d 292c  (data["Close"]),
-000137b0: 206e 702e 6772 6561 7465 725f 6571 7561   np.greater_equa
-000137c0: 6c2c 206f 7264 6572 3d31 0a20 2020 2020  l, order=1.     
-000137d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137e0: 2020 2029 5b30 5d0a 2020 2020 2020 2020     )[0].        
-000137f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00013800: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-00013810: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00013820: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
-00013830: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-00013840: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
-00013850: 6528 5b6e 702e 696e 662c 202d 6e70 2e69  e([np.inf, -np.i
-00013860: 6e66 5d2c 2030 290a 0a20 2020 2020 2020  nf], 0)..       
-00013870: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00013880: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
-00013890: 656e 2864 6174 6129 203c 2064 6179 7354  en(data) < daysT
-000138a0: 6f4c 6f6f 6b62 6163 6b3a 0a20 2020 2020  oLookback:.     
-000138b0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-000138c0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-000138d0: 6767 6572 2e64 6562 7567 2864 6174 6129  gger.debug(data)
-000138e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000138f0: 2023 2020 2020 2072 6169 7365 2053 746f   #     raise Sto
-00013900: 636b 4461 7461 4e6f 7441 6465 7175 6174  ckDataNotAdequat
-00013910: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00013920: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
-00013930: 706c 6163 6528 6e70 2e69 6e66 2c20 6e70  place(np.inf, np
-00013940: 2e6e 616e 292e 7265 706c 6163 6528 2d6e  .nan).replace(-n
-00013950: 702e 696e 662c 206e 702e 6e61 6e29 2e64  p.inf, np.nan).d
-00013960: 726f 706e 6128 290a 2020 2020 2020 2020  ropna().        
-00013970: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
-00013980: 6174 615b 2274 6f70 7322 5d5b 6461 7461  ata["tops"][data
-00013990: 2e74 6f70 7320 3e20 305d 2920 3e20 313a  .tops > 0]) > 1:
-000139a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000139b0: 2020 2020 2073 6c6f 7065 203d 206e 702e       slope = np.
-000139c0: 706f 6c79 6669 7428 0a20 2020 2020 2020  polyfit(.       
-000139d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139e0: 2064 6174 612e 696e 6465 785b 6461 7461   data.index[data
-000139f0: 2e74 6f70 7320 3e20 305d 2c20 6461 7461  .tops > 0], data
-00013a00: 5b22 746f 7073 225d 5b64 6174 612e 746f  ["tops"][data.to
-00013a10: 7073 203e 2030 5d2c 2031 0a20 2020 2020  ps > 0], 1.     
-00013a20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00013a30: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00013a40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00013a50: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-00013a60: 6f70 6520 3d20 300a 2020 2020 2020 2020  ope = 0.        
-00013a70: 2020 2020 6578 6365 7074 206e 702e 6c69      except np.li
-00013a80: 6e61 6c67 2e4c 696e 416c 6745 7272 6f72  nalg.LinAlgError
-00013a90: 2061 7320 653a 2023 2070 7261 676d 613a   as e: # pragma:
-00013aa0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
-00013ab0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00013ac0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
-00013ad0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
-00013ae0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00013af0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00013b00: 5b22 5472 656e 6422 5d20 3d20 280a 2020  ["Trend"] = (.  
-00013b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b20: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00013b30: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00013b40: 6c6f 7254 6578 742e 5741 524e 202b 2022  lorText.WARN + "
-00013b50: 556e 6b6e 6f77 6e22 202b 2063 6f6c 6f72  Unknown" + color
-00013b60: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00013b70: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00013b80: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00013b90: 6963 745b 2254 7265 6e64 225d 203d 2073  ict["Trend"] = s
-00013ba0: 6176 6564 5b31 5d20 2b20 2255 6e6b 6e6f  aved[1] + "Unkno
-00013bb0: 776e 220a 2020 2020 2020 2020 2020 2020  wn".            
-00013bc0: 2020 2020 7265 7475 726e 2073 6176 6544      return saveD
-00013bd0: 6963 745b 2254 7265 6e64 225d 0a20 2020  ict["Trend"].   
-00013be0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00013bf0: 4578 6365 7074 696f 6e20 6173 2065 3a20  Exception as e: 
-00013c00: 2023 2070 7261 676d 613a 206e 6f20 636f   # pragma: no co
-00013c10: 7665 720a 2020 2020 2020 2020 2020 2020  ver.            
-00013c20: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
-00013c30: 5f6c 6f67 6765 722e 6465 6275 6728 652c  _logger.debug(e,
-00013c40: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
-00013c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c60: 736c 6f70 652c 205f 203d 2030 2c20 300a  slope, _ = 0, 0.
-00013c70: 2020 2020 2020 2020 2020 2020 616e 676c              angl
-00013c80: 6520 3d20 6e70 2e72 6164 3264 6567 286e  e = np.rad2deg(n
-00013c90: 702e 6172 6374 616e 2873 6c6f 7065 2929  p.arctan(slope))
-00013ca0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013cb0: 616e 676c 6520 3d3d 2030 3a0a 2020 2020  angle == 0:.    
-00013cc0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-00013cd0: 656e 4469 6374 5b22 5472 656e 6422 5d20  enDict["Trend"] 
-00013ce0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00013cf0: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
-00013d00: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
-00013d10: 4420 2b20 636f 6c6f 7254 6578 742e 5741  D + colorText.WA
-00013d20: 524e 202b 2022 556e 6b6e 6f77 6e22 202b  RN + "Unknown" +
-00013d30: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-00013d40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00013d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d60: 2073 6176 6544 6963 745b 2254 7265 6e64   saveDict["Trend
-00013d70: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
-00013d80: 2255 6e6b 6e6f 776e 220a 2020 2020 2020  "Unknown".      
-00013d90: 2020 2020 2020 656c 6966 2061 6e67 6c65        elif angle
-00013da0: 203c 3d20 3330 2061 6e64 2061 6e67 6c65   <= 30 and angle
-00013db0: 203e 3d20 2d33 303a 0a20 2020 2020 2020   >= -30:.       
-00013dc0: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00013dd0: 6963 745b 2254 7265 6e64 225d 203d 2028  ict["Trend"] = (
-00013de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013df0: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-00013e00: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-00013e10: 2063 6f6c 6f72 5465 7874 2e57 4152 4e20   colorText.WARN 
-00013e20: 2b20 2253 6964 6577 6179 7322 202b 2063  + "Sideways" + c
-00013e30: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00013e40: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00013e50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013e60: 6176 6544 6963 745b 2254 7265 6e64 225d  aveDict["Trend"]
-00013e70: 203d 2073 6176 6564 5b31 5d20 2b20 2253   = saved[1] + "S
-00013e80: 6964 6577 6179 7322 0a20 2020 2020 2020  ideways".       
-00013e90: 2020 2020 2065 6c69 6620 616e 676c 6520       elif angle 
-00013ea0: 3e3d 2033 3020 616e 6420 616e 676c 6520  >= 30 and angle 
-00013eb0: 3c20 3631 3a0a 2020 2020 2020 2020 2020  < 61:.          
-00013ec0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00013ed0: 5b22 5472 656e 6422 5d20 3d20 280a 2020  ["Trend"] = (.  
+0000dbd0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000dbe0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0000dbf0: 2020 2020 2020 2020 2b20 2863 6f6c 6f72          + (color
+0000dc00: 5465 7874 2e47 5245 454e 2069 6620 7265  Text.GREEN if re
+0000dc10: 6365 6e74 436c 6f73 6520 3e3d 206d 6178  centClose >= max
+0000dc20: 4869 6768 2065 6c73 6520 636f 6c6f 7254  High else colorT
+0000dc30: 6578 742e 4641 494c 290a 2020 2020 2020  ext.FAIL).      
+0000dc40: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000dc50: 2220 523a 2022 0a20 2020 2020 2020 2020  " R: ".         
+0000dc60: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+0000dc70: 286d 6178 4869 6768 290a 2020 2020 2020  (maxHigh).      
+0000dc80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000dc90: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0000dca0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcc0: 7265 7475 726e 2054 7275 6520 616e 6420  return True and 
+0000dcd0: 616c 7265 6164 7942 726f 6b65 6e6f 7574  alreadyBrokenout
+0000dce0: 2061 6e64 2073 656c 662e 6765 7443 616e   and self.getCan
+0000dcf0: 646c 6554 7970 6528 7265 6365 6e74 290a  dleType(recent).
+0000dd00: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+0000dd10: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+0000dd20: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
+0000dd30: 2020 2020 2320 2020 2020 6627 5374 6f63      #     f'Stoc
+0000dd40: 6b3a 7b73 6176 6544 6963 745b 2253 746f  k:{saveDict["Sto
+0000dd50: 636b 225d 7d2c 2064 6f65 7320 6e6f 7420  ck"]}, does not 
+0000dd60: 6861 7665 2061 2062 7265 616b 6f75 7420  have a breakout 
+0000dd70: 7965 7420 6265 6361 7573 6520 7265 6365  yet because rece
+0000dd80: 6e74 2d63 6c6f 7365 2028 7b72 6563 656e  nt-close ({recen
+0000dd90: 7443 6c6f 7365 7d29 203c 206d 6178 2d68  tClose}) < max-h
+0000dda0: 6967 6820 287b 6d61 7848 6967 687d 2927  igh ({maxHigh})'
+0000ddb0: 0a20 2020 2020 2020 2020 2020 2023 2029  .            # )
+0000ddc0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+0000ddd0: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
+0000dde0: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
+0000ddf0: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+0000de00: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+0000de10: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+0000de20: 7874 2e46 4149 4c0a 2020 2020 2020 2020  xt.FAIL.        
+0000de30: 2020 2020 2020 2020 2b20 2242 4f3a 2022          + "BO: "
+0000de40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de50: 202b 2073 7472 286d 6178 436c 6f73 6529   + str(maxClose)
+0000de60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de70: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000de80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de90: 202b 2028 636f 6c6f 7254 6578 742e 4752   + (colorText.GR
+0000dea0: 4545 4e20 6966 2072 6563 656e 7443 6c6f  EEN if recentClo
+0000deb0: 7365 203e 3d20 6d61 7848 6967 6820 656c  se >= maxHigh el
+0000dec0: 7365 2063 6f6c 6f72 5465 7874 2e46 4149  se colorText.FAI
+0000ded0: 4c29 0a20 2020 2020 2020 2020 2020 2020  L).             
+0000dee0: 2020 202b 2022 2052 3a20 220a 2020 2020     + " R: ".    
+0000def0: 2020 2020 2020 2020 2020 2020 2b20 7374              + st
+0000df00: 7228 6d61 7848 6967 6829 0a20 2020 2020  r(maxHigh).     
+0000df10: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0000df20: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0000df30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000df40: 2020 2020 2072 6574 7572 6e20 6e6f 7420       return not 
+0000df50: 616c 7265 6164 7942 726f 6b65 6e6f 7574  alreadyBrokenout
+0000df60: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000df70: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0000df80: 6963 745b 2242 7265 616b 6f75 7422 5d20  ict["Breakout"] 
+0000df90: 3d20 2242 4f3a 2022 202b 2073 7472 286d  = "BO: " + str(m
+0000dfa0: 6178 436c 6f73 6529 202b 2022 2052 3a20  axClose) + " R: 
+0000dfb0: 3022 0a20 2020 2020 2020 2020 2020 2069  0".            i
+0000dfc0: 6620 7265 6365 6e74 436c 6f73 6520 3e3d  f recentClose >=
+0000dfd0: 206d 6178 436c 6f73 653a 0a20 2020 2020   maxClose:.     
+0000dfe0: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+0000dff0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+0000e000: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+0000e010: 2020 2020 2020 2023 2020 2020 2066 2753         #     f'S
+0000e020: 746f 636b 3a7b 7361 7665 4469 6374 5b22  tock:{saveDict["
+0000e030: 5374 6f63 6b22 5d7d 2c20 6861 7320 6120  Stock"]}, has a 
+0000e040: 6272 6561 6b6f 7574 2062 6563 6175 7365  breakout because
+0000e050: 2072 6563 656e 742d 636c 6f73 6520 287b   recent-close ({
+0000e060: 7265 6365 6e74 436c 6f73 657d 2920 3e3d  recentClose}) >=
+0000e070: 206d 6178 2d63 6c6f 7365 2028 7b6d 6178   max-close ({max
+0000e080: 436c 6f73 657d 2927 0a20 2020 2020 2020  Close})'.       
+0000e090: 2020 2020 2020 2020 2023 2029 0a20 2020           # ).   
+0000e0a0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0000e0b0: 6565 6e44 6963 745b 2242 7265 616b 6f75  eenDict["Breakou
+0000e0c0: 7422 5d20 3d20 280a 2020 2020 2020 2020  t"] = (.        
+0000e0d0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0000e0e0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+0000e0f0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000e100: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
+0000e110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e120: 2020 2020 202b 2022 424f 3a20 220a 2020       + "BO: ".  
+0000e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e140: 2020 2b20 7374 7228 6d61 7843 6c6f 7365    + str(maxClose
+0000e150: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e160: 2020 2020 2020 2b20 2220 523a 2030 220a        + " R: 0".
+0000e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e180: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0000e190: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0000e1a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000e1b0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000e1c0: 6520 616e 6420 616c 7265 6164 7942 726f  e and alreadyBro
+0000e1d0: 6b65 6e6f 7574 2061 6e64 2073 656c 662e  kenout and self.
+0000e1e0: 6765 7443 616e 646c 6554 7970 6528 7265  getCandleType(re
+0000e1f0: 6365 6e74 290a 2020 2020 2020 2020 2020  cent).          
+0000e200: 2020 2320 7365 6c66 2e64 6566 6175 6c74    # self.default
+0000e210: 5f6c 6f67 6765 722e 696e 666f 280a 2020  _logger.info(.  
+0000e220: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0000e230: 6627 5374 6f63 6b3a 7b73 6176 6544 6963  f'Stock:{saveDic
+0000e240: 745b 2253 746f 636b 225d 7d2c 2068 6173  t["Stock"]}, has
+0000e250: 2061 2062 7265 616b 6f75 7420 6265 6361   a breakout beca
+0000e260: 7573 6520 7265 6365 6e74 2d63 6c6f 7365  use recent-close
+0000e270: 2028 7b72 6563 656e 7443 6c6f 7365 7d29   ({recentClose})
+0000e280: 203c 206d 6178 2d63 6c6f 7365 2028 7b6d   < max-close ({m
+0000e290: 6178 436c 6f73 657d 2927 0a20 2020 2020  axClose})'.     
+0000e2a0: 2020 2020 2020 2023 2029 0a20 2020 2020         # ).     
+0000e2b0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0000e2c0: 745b 2242 7265 616b 6f75 7422 5d20 3d20  t["Breakout"] = 
+0000e2d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e2e0: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
+0000e2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e300: 202b 2063 6f6c 6f72 5465 7874 2e46 4149   + colorText.FAI
+0000e310: 4c0a 2020 2020 2020 2020 2020 2020 2020  L.              
+0000e320: 2020 2b20 2242 4f3a 2022 0a20 2020 2020    + "BO: ".     
+0000e330: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+0000e340: 286d 6178 436c 6f73 6529 0a20 2020 2020  (maxClose).     
+0000e350: 2020 2020 2020 2020 2020 202b 2022 2052             + " R
+0000e360: 3a20 3022 0a20 2020 2020 2020 2020 2020  : 0".           
+0000e370: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0000e380: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0000e390: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0000e3a0: 6574 7572 6e20 6e6f 7420 616c 7265 6164  eturn not alread
+0000e3b0: 7942 726f 6b65 6e6f 7574 0a0a 2020 2020  yBrokenout..    
+0000e3c0: 2320 4669 6e64 2073 746f 636b 7320 7468  # Find stocks th
+0000e3d0: 6174 2061 7265 2062 756c 6c69 7368 2069  at are bullish i
+0000e3e0: 6e74 7261 6461 793a 2052 5349 2063 726f  ntraday: RSI cro
+0000e3f0: 7373 6573 2035 352c 204d 6163 6420 4869  sses 55, Macd Hi
+0000e400: 7374 6f67 7261 6d20 706f 7369 7469 7665  stogram positive
+0000e410: 2c20 7072 6963 6520 6162 6f76 6520 454d  , price above EM
+0000e420: 4120 3130 0a20 2020 2064 6566 2066 696e  A 10.    def fin
+0000e430: 6442 756c 6c69 7368 496e 7472 6164 6179  dBullishIntraday
+0000e440: 5253 494d 4143 4428 7365 6c66 2c20 6466  RSIMACD(self, df
+0000e450: 293a 0a20 2020 2020 2020 2069 6620 6466  ):.        if df
+0000e460: 2069 7320 4e6f 6e65 206f 7220 6c65 6e28   is None or len(
+0000e470: 6466 2920 3d3d 2030 3a0a 2020 2020 2020  df) == 0:.      
+0000e480: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0000e490: 7365 0a20 2020 2020 2020 2064 6174 6120  se.        data 
+0000e4a0: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
+0000e4b0: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0000e4c0: 6669 6c6c 6e61 2830 290a 2020 2020 2020  fillna(0).      
+0000e4d0: 2020 6461 7461 203d 2064 6174 612e 7265    data = data.re
+0000e4e0: 706c 6163 6528 5b6e 702e 696e 662c 202d  place([np.inf, -
+0000e4f0: 6e70 2e69 6e66 5d2c 2030 290a 2020 2020  np.inf], 0).    
+0000e500: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+0000e510: 3a3a 2d31 5d20 2023 2052 6576 6572 7365  ::-1]  # Reverse
+0000e520: 2074 6865 2064 6174 6166 7261 6d65 2073   the dataframe s
+0000e530: 6f20 7468 6174 2069 7473 2074 6865 206f  o that its the o
+0000e540: 6c64 6573 7420 6461 7465 2066 6972 7374  ldest date first
+0000e550: 0a20 2020 2020 2020 2064 6174 615b 2252  .        data["R
+0000e560: 5349 3132 225d 203d 2070 6b74 616c 6962  SI12"] = pktalib
+0000e570: 2e52 5349 2864 6174 615b 2243 6c6f 7365  .RSI(data["Close
+0000e580: 225d 2c20 3132 290a 2020 2020 2020 2020  "], 12).        
+0000e590: 6461 7461 5b22 454d 4131 3022 5d20 3d20  data["EMA10"] = 
+0000e5a0: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+0000e5b0: 5b22 436c 6f73 6522 5d2c 2031 3029 0a20  ["Close"], 10). 
+0000e5c0: 2020 2020 2020 2064 6174 615b 2245 4d41         data["EMA
+0000e5d0: 3230 3022 5d20 3d20 706b 7461 6c69 622e  200"] = pktalib.
+0000e5e0: 454d 4128 6461 7461 5b22 436c 6f73 6522  EMA(data["Close"
+0000e5f0: 5d2c 2032 3030 290a 2020 2020 2020 2020  ], 200).        
+0000e600: 6d61 6364 203d 2070 6b74 616c 6962 2e4d  macd = pktalib.M
+0000e610: 4143 4428 6461 7461 5b22 436c 6f73 6522  ACD(data["Close"
+0000e620: 5d2c 2031 302c 2031 382c 2039 295b 325d  ], 10, 18, 9)[2]
+0000e630: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
+0000e640: 2072 6563 656e 7420 3d20 6461 7461 2e74   recent = data.t
+0000e650: 6169 6c28 3129 0a20 2020 2020 2020 2063  ail(1).        c
+0000e660: 6f6e 6431 203d 2072 6563 656e 745b 2252  ond1 = recent["R
+0000e670: 5349 3132 225d 2e69 6c6f 635b 305d 203e  SI12"].iloc[0] >
+0000e680: 2035 350a 2020 2020 2020 2020 636f 6e64   55.        cond
+0000e690: 3220 3d20 636f 6e64 3120 616e 6420 286d  2 = cond1 and (m
+0000e6a0: 6163 642e 696c 6f63 5b3a 315d 5b30 5d20  acd.iloc[:1][0] 
+0000e6b0: 3e20 3029 0a20 2020 2020 2020 2063 6f6e  > 0).        con
+0000e6c0: 6433 203d 2063 6f6e 6432 2061 6e64 2028  d3 = cond2 and (
+0000e6d0: 7265 6365 6e74 5b22 436c 6f73 6522 5d2e  recent["Close"].
+0000e6e0: 696c 6f63 5b30 5d20 3e20 7265 6365 6e74  iloc[0] > recent
+0000e6f0: 5b22 454d 4131 3022 5d2e 696c 6f63 5b30  ["EMA10"].iloc[0
+0000e700: 5d29 0a20 2020 2020 2020 2063 6f6e 6434  ]).        cond4
+0000e710: 203d 2063 6f6e 6433 2061 6e64 2028 7265   = cond3 and (re
+0000e720: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+0000e730: 6f63 5b30 5d20 3e20 7265 6365 6e74 5b22  oc[0] > recent["
+0000e740: 454d 4132 3030 225d 2e69 6c6f 635b 305d  EMA200"].iloc[0]
+0000e750: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000e760: 2063 6f6e 6434 0a20 2020 200a 2020 2020   cond4.    .    
+0000e770: 2320 4669 6e64 2073 746f 636b 7320 7468  # Find stocks th
+0000e780: 6174 206f 7065 6e65 6420 6869 6768 6572  at opened higher
+0000e790: 2074 6861 6e20 7468 6520 7072 6576 696f   than the previo
+0000e7a0: 7573 2068 6967 680a 2020 2020 6465 6620  us high.    def 
+0000e7b0: 6669 6e64 4869 6768 6572 4f70 656e 7328  findHigherOpens(
+0000e7c0: 7365 6c66 2c20 6466 293a 0a20 2020 2020  self, df):.     
+0000e7d0: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+0000e7e0: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+0000e7f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000e800: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0000e810: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+0000e820: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+0000e830: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+0000e840: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0000e850: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+0000e860: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+0000e870: 2030 290a 2020 2020 2020 2020 7265 6365   0).        rece
+0000e880: 6e74 203d 2064 6174 612e 6865 6164 2832  nt = data.head(2
+0000e890: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+0000e8a0: 2872 6563 656e 7429 203c 2032 3a0a 2020  (recent) < 2:.  
+0000e8b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e8c0: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+0000e8d0: 6574 7572 6e20 7265 6365 6e74 5b22 4f70  eturn recent["Op
+0000e8e0: 656e 225d 2e69 6c6f 635b 305d 203e 2072  en"].iloc[0] > r
+0000e8f0: 6563 656e 745b 2243 6c6f 7365 225d 2e69  ecent["Close"].i
+0000e900: 6c6f 635b 315d 0a0a 2020 2020 6465 6620  loc[1]..    def 
+0000e910: 6669 6e64 4869 6768 6572 4275 6c6c 6973  findHigherBullis
+0000e920: 684f 7065 6e73 2873 656c 662c 2064 6629  hOpens(self, df)
+0000e930: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+0000e940: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+0000e950: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+0000e960: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000e970: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+0000e980: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+0000e990: 2020 2064 6174 6120 3d20 6461 7461 2e66     data = data.f
+0000e9a0: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+0000e9b0: 2064 6174 6120 3d20 6461 7461 2e72 6570   data = data.rep
+0000e9c0: 6c61 6365 285b 6e70 2e69 6e66 2c20 2d6e  lace([np.inf, -n
+0000e9d0: 702e 696e 665d 2c20 3029 0a20 2020 2020  p.inf], 0).     
+0000e9e0: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000e9f0: 2e68 6561 6428 3229 0a20 2020 2020 2020  .head(2).       
+0000ea00: 2069 6620 6c65 6e28 7265 6365 6e74 2920   if len(recent) 
+0000ea10: 3c20 323a 0a20 2020 2020 2020 2020 2020  < 2:.           
+0000ea20: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000ea30: 2020 2020 2020 7265 7475 726e 2072 6563        return rec
+0000ea40: 656e 745b 224f 7065 6e22 5d2e 696c 6f63  ent["Open"].iloc
+0000ea50: 5b30 5d20 3e20 7265 6365 6e74 5b22 4869  [0] > recent["Hi
+0000ea60: 6768 225d 2e69 6c6f 635b 315d 0a20 2020  gh"].iloc[1].   
+0000ea70: 200a 2020 2020 6465 6620 6669 6e64 4e52   .    def findNR
+0000ea80: 3444 6179 2873 656c 662c 2064 6629 3a0a  4Day(self, df):.
+0000ea90: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0000eaa0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0000eab0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000eac0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000ead0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000eae0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0000eaf0: 2023 2068 7474 7073 3a2f 2f63 6861 7274   # https://chart
+0000eb00: 696e 6b2e 636f 6d2f 7363 7265 656e 6572  ink.com/screener
+0000eb10: 2f6e 7234 2d64 6169 6c79 2d74 6f64 6179  /nr4-daily-today
+0000eb20: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
+0000eb30: 2e74 6169 6c28 3129 5b22 566f 6c75 6d65  .tail(1)["Volume
+0000eb40: 225d 2e69 6c6f 635b 305d 203c 3d20 3530  "].iloc[0] <= 50
+0000eb50: 3030 303a 0a20 2020 2020 2020 2020 2020  000:.           
+0000eb60: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0000eb70: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000eb80: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
+0000eb90: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0000eba0: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
+0000ebb0: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
+0000ebc0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000ebd0: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
+0000ebe0: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
+0000ebf0: 2073 6f20 7468 6174 2069 7473 2074 6865   so that its the
+0000ec00: 206f 6c64 6573 7420 6461 7465 2066 6972   oldest date fir
+0000ec10: 7374 0a20 2020 2020 2020 2064 6174 615b  st.        data[
+0000ec20: 2253 4d41 3130 225d 203d 2070 6b74 616c  "SMA10"] = pktal
+0000ec30: 6962 2e53 4d41 2864 6174 615b 2243 6c6f  ib.SMA(data["Clo
+0000ec40: 7365 225d 2c20 3130 290a 2020 2020 2020  se"], 10).      
+0000ec50: 2020 6461 7461 5b22 534d 4135 3022 5d20    data["SMA50"] 
+0000ec60: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+0000ec70: 7461 5b22 436c 6f73 6522 5d2c 2035 3029  ta["Close"], 50)
+0000ec80: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
+0000ec90: 4d41 3230 3022 5d20 3d20 706b 7461 6c69  MA200"] = pktali
+0000eca0: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
+0000ecb0: 6522 5d2c 2032 3030 290a 2020 2020 2020  e"], 200).      
+0000ecc0: 2020 7265 6365 6e74 203d 2064 6174 612e    recent = data.
+0000ecd0: 7461 696c 2835 290a 2020 2020 2020 2020  tail(5).        
+0000ece0: 7265 6365 6e74 203d 2072 6563 656e 745b  recent = recent[
+0000ecf0: 3a3a 2d31 5d0a 2020 2020 2020 2020 636f  ::-1].        co
+0000ed00: 6e64 3120 3d20 2872 6563 656e 745b 2248  nd1 = (recent["H
+0000ed10: 6967 6822 5d2e 696c 6f63 5b30 5d20 2d20  igh"].iloc[0] - 
+0000ed20: 7265 6365 6e74 5b22 4c6f 7722 5d2e 696c  recent["Low"].il
+0000ed30: 6f63 5b30 5d29 203c 2028 0a20 2020 2020  oc[0]) < (.     
+0000ed40: 2020 2020 2020 2072 6563 656e 745b 2248         recent["H
+0000ed50: 6967 6822 5d2e 696c 6f63 5b31 5d20 2d20  igh"].iloc[1] - 
+0000ed60: 7265 6365 6e74 5b22 4c6f 7722 5d2e 696c  recent["Low"].il
+0000ed70: 6f63 5b31 5d0a 2020 2020 2020 2020 290a  oc[1].        ).
+0000ed80: 2020 2020 2020 2020 636f 6e64 3220 3d20          cond2 = 
+0000ed90: 636f 6e64 3120 616e 6420 2872 6563 656e  cond1 and (recen
+0000eda0: 745b 2248 6967 6822 5d2e 696c 6f63 5b30  t["High"].iloc[0
+0000edb0: 5d20 2d20 7265 6365 6e74 5b22 4c6f 7722  ] - recent["Low"
+0000edc0: 5d2e 696c 6f63 5b30 5d29 203c 2028 0a20  ].iloc[0]) < (. 
+0000edd0: 2020 2020 2020 2020 2020 2072 6563 656e             recen
+0000ede0: 745b 2248 6967 6822 5d2e 696c 6f63 5b32  t["High"].iloc[2
+0000edf0: 5d20 2d20 7265 6365 6e74 5b22 4c6f 7722  ] - recent["Low"
+0000ee00: 5d2e 696c 6f63 5b32 5d0a 2020 2020 2020  ].iloc[2].      
+0000ee10: 2020 290a 2020 2020 2020 2020 636f 6e64    ).        cond
+0000ee20: 3320 3d20 636f 6e64 3220 616e 6420 2872  3 = cond2 and (r
+0000ee30: 6563 656e 745b 2248 6967 6822 5d2e 696c  ecent["High"].il
+0000ee40: 6f63 5b30 5d20 2d20 7265 6365 6e74 5b22  oc[0] - recent["
+0000ee50: 4c6f 7722 5d2e 696c 6f63 5b30 5d29 203c  Low"].iloc[0]) <
+0000ee60: 2028 0a20 2020 2020 2020 2020 2020 2072   (.            r
+0000ee70: 6563 656e 745b 2248 6967 6822 5d2e 696c  ecent["High"].il
+0000ee80: 6f63 5b33 5d20 2d20 7265 6365 6e74 5b22  oc[3] - recent["
+0000ee90: 4c6f 7722 5d2e 696c 6f63 5b33 5d0a 2020  Low"].iloc[3].  
+0000eea0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000eeb0: 636f 6e64 3420 3d20 636f 6e64 3320 616e  cond4 = cond3 an
+0000eec0: 6420 2872 6563 656e 745b 2248 6967 6822  d (recent["High"
+0000eed0: 5d2e 696c 6f63 5b30 5d20 2d20 7265 6365  ].iloc[0] - rece
+0000eee0: 6e74 5b22 4c6f 7722 5d2e 696c 6f63 5b30  nt["Low"].iloc[0
+0000eef0: 5d29 203c 2028 0a20 2020 2020 2020 2020  ]) < (.         
+0000ef00: 2020 2072 6563 656e 745b 2248 6967 6822     recent["High"
+0000ef10: 5d2e 696c 6f63 5b34 5d20 2d20 7265 6365  ].iloc[4] - rece
+0000ef20: 6e74 5b22 4c6f 7722 5d2e 696c 6f63 5b34  nt["Low"].iloc[4
+0000ef30: 5d0a 2020 2020 2020 2020 290a 2020 2020  ].        ).    
+0000ef40: 2020 2020 636f 6e64 3520 3d20 636f 6e64      cond5 = cond
+0000ef50: 3420 616e 6420 2872 6563 656e 745b 2253  4 and (recent["S
+0000ef60: 4d41 3130 225d 2e69 6c6f 635b 305d 203e  MA10"].iloc[0] >
+0000ef70: 2072 6563 656e 745b 2253 4d41 3530 225d   recent["SMA50"]
+0000ef80: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0000ef90: 2020 636f 6e64 3620 3d20 636f 6e64 3520    cond6 = cond5 
+0000efa0: 616e 6420 2872 6563 656e 745b 2253 4d41  and (recent["SMA
+0000efb0: 3530 225d 2e69 6c6f 635b 305d 203e 2072  50"].iloc[0] > r
+0000efc0: 6563 656e 745b 2253 4d41 3230 3022 5d2e  ecent["SMA200"].
+0000efd0: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
+0000efe0: 2072 6574 7572 6e20 636f 6e64 360a 0a20   return cond6.. 
+0000eff0: 2020 2023 2046 696e 6420 706f 7465 6e74     # Find potent
+0000f000: 6961 6c20 6272 6561 6b6f 7574 2073 746f  ial breakout sto
+0000f010: 636b 730a 2020 2020 2320 5468 6973 2073  cks.    # This s
+0000f020: 6361 6e6e 6572 2066 696c 7465 7273 2073  canner filters s
+0000f030: 746f 636b 7320 7768 6f73 6520 6375 7272  tocks whose curr
+0000f040: 656e 7420 636c 6f73 6520 7072 6963 6520  ent close price 
+0000f050: 2b20 3525 2069 7320 6869 6768 6572 0a20  + 5% is higher. 
+0000f060: 2020 2023 2074 6861 6e20 7468 6520 6869     # than the hi
+0000f070: 6768 6573 7420 4869 6768 2070 7269 6365  ghest High price
+0000f080: 2069 6e20 7061 7374 2032 3030 2063 616e   in past 200 can
+0000f090: 646c 6573 2061 6e64 2074 6865 206d 6178  dles and the max
+0000f0a0: 696d 756d 2068 6967 680a 2020 2020 2320  imum high.    # 
+0000f0b0: 696e 2074 6865 2070 7265 7669 6f75 7320  in the previous 
+0000f0c0: 3330 2063 616e 646c 6573 2069 7320 6c6f  30 candles is lo
+0000f0d0: 7765 7220 7468 616e 2074 6865 2068 6967  wer than the hig
+0000f0e0: 6865 7374 2068 6967 6820 6d61 6465 2069  hest high made i
+0000f0f0: 6e20 7468 650a 2020 2020 2320 7072 6576  n the.    # prev
+0000f100: 696f 7573 2032 3030 2063 616e 646c 6573  ious 200 candles
+0000f110: 2c20 7374 6172 7469 6e67 2066 726f 6d20  , starting from 
+0000f120: 7468 6520 7072 6576 696f 7573 2033 3074  the previous 30t
+0000f130: 6820 6361 6e64 6c65 2e20 4174 2074 6865  h candle. At the
+0000f140: 0a20 2020 2023 2073 616d 6520 7469 6d65  .    # same time
+0000f150: 2074 6865 2063 7572 7265 6e74 2063 616e   the current can
+0000f160: 646c 6520 766f 6c75 6d65 2069 7320 6869  dle volume is hi
+0000f170: 6768 6572 2074 6861 6e20 3230 3020 534d  gher than 200 SM
+0000f180: 4120 6f66 2076 6f6c 756d 652e 0a20 2020  A of volume..   
+0000f190: 2064 6566 2066 696e 6450 6f74 656e 7469   def findPotenti
+0000f1a0: 616c 4272 6561 6b6f 7574 2873 656c 662c  alBreakout(self,
+0000f1b0: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+0000f1c0: 2073 6176 6544 6963 742c 2064 6179 7354   saveDict, daysT
+0000f1d0: 6f4c 6f6f 6b62 6163 6b29 3a0a 2020 2020  oLookback):.    
+0000f1e0: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+0000f1f0: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+0000f200: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0000f210: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0000f220: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+0000f230: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
+0000f240: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
+0000f250: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+0000f260: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
+0000f270: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
+0000f280: 2c20 3029 0a20 2020 2020 2020 2064 6174  , 0).        dat
+0000f290: 6120 3d20 6461 7461 2e68 6561 6428 3233  a = data.head(23
+0000f2a0: 3129 0a20 2020 2020 2020 2072 6563 656e  1).        recen
+0000f2b0: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
+0000f2c0: 0a20 2020 2020 2020 2072 6563 656e 7456  .        recentV
+0000f2d0: 6f6c 756d 6520 3d20 7265 6365 6e74 5b22  olume = recent["
+0000f2e0: 566f 6c75 6d65 225d 2e69 6c6f 635b 305d  Volume"].iloc[0]
+0000f2f0: 0a20 2020 2020 2020 2072 6563 656e 7443  .        recentC
+0000f300: 6c6f 7365 203d 2072 6f75 6e64 2872 6563  lose = round(rec
+0000f310: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
+0000f320: 635b 305d 202a 2031 2e30 352c 2032 290a  c[0] * 1.05, 2).
+0000f330: 2020 2020 2020 2020 6869 6768 6573 7448          highestH
+0000f340: 6967 6832 3030 203d 2072 6f75 6e64 2864  igh200 = round(d
+0000f350: 6174 612e 6865 6164 2832 3031 292e 7461  ata.head(201).ta
+0000f360: 696c 2832 3030 292e 6465 7363 7269 6265  il(200).describe
+0000f370: 2829 5b22 4869 6768 225d 5b22 6d61 7822  ()["High"]["max"
+0000f380: 5d2c 2032 290a 2020 2020 2020 2020 6869  ], 2).        hi
+0000f390: 6768 6573 7448 6967 6833 3020 3d20 726f  ghestHigh30 = ro
+0000f3a0: 756e 6428 6461 7461 2e68 6561 6428 3331  und(data.head(31
+0000f3b0: 292e 7461 696c 2833 3029 2e64 6573 6372  ).tail(30).descr
+0000f3c0: 6962 6528 295b 2248 6967 6822 5d5b 226d  ibe()["High"]["m
+0000f3d0: 6178 225d 2c20 3229 0a20 2020 2020 2020  ax"], 2).       
+0000f3e0: 2068 6967 6865 7374 4869 6768 3230 3046   highestHigh200F
+0000f3f0: 726f 6d33 3020 3d20 726f 756e 6428 6461  rom30 = round(da
+0000f400: 7461 2e74 6169 6c28 3230 3029 2e64 6573  ta.tail(200).des
+0000f410: 6372 6962 6528 295b 2248 6967 6822 5d5b  cribe()["High"][
+0000f420: 226d 6178 225d 2c20 3229 0a20 2020 2020  "max"], 2).     
+0000f430: 2020 2068 6967 6865 7374 4869 6768 3846     highestHigh8F
+0000f440: 726f 6d33 3020 3d20 726f 756e 6428 6461  rom30 = round(da
+0000f450: 7461 2e68 6561 6428 3339 292e 7461 696c  ta.head(39).tail
+0000f460: 2838 292e 6465 7363 7269 6265 2829 5b22  (8).describe()["
+0000f470: 4869 6768 225d 5b22 6d61 7822 5d2c 2032  High"]["max"], 2
+0000f480: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+0000f490: 2064 6174 612e 6865 6164 2832 3030 290a   data.head(200).
+0000f4a0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0000f4b0: 6174 615b 3a3a 2d31 5d20 2023 2052 6576  ata[::-1]  # Rev
+0000f4c0: 6572 7365 2074 6865 2064 6174 6166 7261  erse the datafra
+0000f4d0: 6d65 2073 6f20 7468 6174 2069 7473 2074  me so that its t
+0000f4e0: 6865 206f 6c64 6573 7420 6461 7465 2066  he oldest date f
+0000f4f0: 6972 7374 0a20 2020 2020 2020 2076 6f6c  irst.        vol
+0000f500: 3230 3020 3d20 706b 7461 6c69 622e 534d  200 = pktalib.SM
+0000f510: 4128 6461 7461 5b22 566f 6c75 6d65 225d  A(data["Volume"]
+0000f520: 2c74 696d 6570 6572 696f 643d 3230 3029  ,timeperiod=200)
+0000f530: 0a20 2020 2020 2020 2064 6174 615b 2253  .        data["S
+0000f540: 4d41 3230 3056 225d 203d 2076 6f6c 3230  MA200V"] = vol20
+0000f550: 300a 2020 2020 2020 2020 766f 6c35 3020  0.        vol50 
+0000f560: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+0000f570: 7461 5b22 566f 6c75 6d65 225d 2c74 696d  ta["Volume"],tim
+0000f580: 6570 6572 696f 643d 3530 290a 2020 2020  eperiod=50).    
+0000f590: 2020 2020 6461 7461 5b22 534d 4135 3056      data["SMA50V
+0000f5a0: 225d 203d 2076 6f6c 3530 0a20 2020 2020  "] = vol50.     
+0000f5b0: 2020 2072 6563 656e 7420 3d20 6461 7461     recent = data
+0000f5c0: 2e74 6169 6c28 3129 0a20 2020 2020 2020  .tail(1).       
+0000f5d0: 2073 6d61 3230 3076 203d 2072 6563 656e   sma200v = recen
+0000f5e0: 745b 2253 4d41 3230 3056 225d 2e69 6c6f  t["SMA200V"].ilo
+0000f5f0: 635b 305d 0a20 2020 2020 2020 2073 6d61  c[0].        sma
+0000f600: 3530 7620 3d20 7265 6365 6e74 5b22 534d  50v = recent["SM
+0000f610: 4135 3056 225d 2e69 6c6f 635b 305d 0a20  A50V"].iloc[0]. 
+0000f620: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+0000f630: 2020 2020 2020 2020 6e70 2e69 736e 616e          np.isnan
+0000f640: 2872 6563 656e 7443 6c6f 7365 290a 2020  (recentClose).  
+0000f650: 2020 2020 2020 2020 2020 6f72 206e 702e            or np.
+0000f660: 6973 6e61 6e28 6869 6768 6573 7448 6967  isnan(highestHig
+0000f670: 6832 3030 290a 2020 2020 2020 2020 2020  h200).          
+0000f680: 2020 6f72 206e 702e 6973 6e61 6e28 6869    or np.isnan(hi
+0000f690: 6768 6573 7448 6967 6833 3029 0a20 2020  ghestHigh30).   
+0000f6a0: 2020 2020 2020 2020 206f 7220 6e70 2e69           or np.i
+0000f6b0: 736e 616e 2868 6967 6865 7374 4869 6768  snan(highestHigh
+0000f6c0: 3230 3046 726f 6d33 3029 0a20 2020 2020  200From30).     
+0000f6d0: 2020 2020 2020 206f 7220 6e70 2e69 736e         or np.isn
+0000f6e0: 616e 2868 6967 6865 7374 4869 6768 3846  an(highestHigh8F
+0000f6f0: 726f 6d33 3029 0a20 2020 2020 2020 2020  rom30).         
+0000f700: 2020 206f 7220 6e70 2e69 736e 616e 2872     or np.isnan(r
+0000f710: 6563 656e 7456 6f6c 756d 6529 0a20 2020  ecentVolume).   
+0000f720: 2020 2020 2020 2020 206f 7220 6e70 2e69           or np.i
+0000f730: 736e 616e 2873 6d61 3230 3076 290a 2020  snan(sma200v).  
+0000f740: 2020 2020 2020 2020 2020 6f72 206e 702e            or np.
+0000f750: 6973 6e61 6e28 736d 6135 3076 290a 2020  isnan(sma50v).  
+0000f760: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000f770: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000f780: 650a 2020 2020 2020 2020 6966 2028 0a20  e.        if (. 
+0000f790: 2020 2020 2020 2020 2020 2028 7265 6365             (rece
+0000f7a0: 6e74 436c 6f73 6520 3e20 6869 6768 6573  ntClose > highes
+0000f7b0: 7448 6967 6832 3030 290a 2020 2020 2020  tHigh200).      
+0000f7c0: 2020 2020 2020 616e 6420 2828 2868 6967        and (((hig
+0000f7d0: 6865 7374 4869 6768 3330 203c 2068 6967  hestHigh30 < hig
+0000f7e0: 6865 7374 4869 6768 3230 3046 726f 6d33  hestHigh200From3
+0000f7f0: 3029 2061 6e64 2028 7265 6365 6e74 566f  0) and (recentVo
+0000f800: 6c75 6d65 203e 2073 6d61 3230 3076 2929  lume > sma200v))
+0000f810: 206f 7220 5c0a 2020 2020 2020 2020 2020   or \.          
+0000f820: 2020 2020 2020 2028 2868 6967 6865 7374         ((highest
+0000f830: 4869 6768 3330 203c 2068 6967 6865 7374  High30 < highest
+0000f840: 4869 6768 3846 726f 6d33 3029 2061 6e64  High8From30) and
+0000f850: 2028 7265 6365 6e74 566f 6c75 6d65 203e   (recentVolume >
+0000f860: 2073 6d61 3530 7629 290a 2020 2020 2020   sma50v)).      
+0000f870: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000f880: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000f890: 2020 2073 6176 6544 6963 745b 2242 7265     saveDict["Bre
+0000f8a0: 616b 6f75 7422 5d20 3d20 7361 7665 4469  akout"] = saveDi
+0000f8b0: 6374 5b22 4272 6561 6b6f 7574 225d 202b  ct["Breakout"] +
+0000f8c0: 2022 2850 6f74 656e 7469 616c 2922 0a20   "(Potential)". 
+0000f8d0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000f8e0: 6e44 6963 745b 2242 7265 616b 6f75 7422  nDict["Breakout"
+0000f8f0: 5d20 3d20 7363 7265 656e 4469 6374 5b22  ] = screenDict["
+0000f900: 4272 6561 6b6f 7574 225d 202b 2028 0a20  Breakout"] + (. 
+0000f910: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f920: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+0000f930: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
+0000f940: 2b20 2220 2850 6f74 656e 7469 616c 2922  + " (Potential)"
+0000f950: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000f960: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000f970: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000f980: 6e20 5472 7565 0a20 2020 2020 2020 2072  n True.        r
+0000f990: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000f9a0: 2023 2046 696e 6420 7374 6f63 6b73 2077   # Find stocks w
+0000f9b0: 6974 6820 7265 7665 7273 696e 6720 5053  ith reversing PS
+0000f9c0: 4152 2061 6e64 2052 5349 0a20 2020 2064  AR and RSI.    d
+0000f9d0: 6566 2066 696e 6450 5341 5252 6576 6572  ef findPSARRever
+0000f9e0: 7361 6c57 6974 6852 5349 2873 656c 662c  salWithRSI(self,
+0000f9f0: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
+0000fa00: 2073 6176 6544 6963 742c 6d69 6e52 5349   saveDict,minRSI
+0000fa10: 3d35 3029 3a0a 2020 2020 2020 2020 6966  =50):.        if
+0000fa20: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+0000fa30: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+0000fa40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fa50: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+0000fa60: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+0000fa70: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0000fa80: 7461 5b3a 3a2d 315d 0a20 2020 2020 2020  ta[::-1].       
+0000fa90: 2070 7361 7220 3d20 706b 7461 6c69 622e   psar = pktalib.
+0000faa0: 7073 6172 2864 6174 615b 2248 6967 6822  psar(data["High"
+0000fab0: 5d2c 6461 7461 5b22 4c6f 7722 5d29 0a20  ],data["Low"]). 
+0000fac0: 2020 2020 2020 2069 6620 6c65 6e28 7073         if len(ps
+0000fad0: 6172 2920 3c20 333a 0a20 2020 2020 2020  ar) < 3:.       
+0000fae0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0000faf0: 650a 2020 2020 2020 2020 7073 6172 203d  e.        psar =
+0000fb00: 2070 7361 722e 7461 696c 2833 290a 2020   psar.tail(3).  
+0000fb10: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0000fb20: 612e 7461 696c 2833 290a 2020 2020 2020  a.tail(3).      
+0000fb30: 2020 2320 6461 794d 696e 7573 3250 7361    # dayMinus2Psa
+0000fb40: 7220 3d20 7073 6172 2e69 6c6f 635b 305d  r = psar.iloc[0]
+0000fb50: 0a20 2020 2020 2020 2064 6179 4d69 6e75  .        dayMinu
+0000fb60: 7331 5073 6172 203d 2070 7361 722e 696c  s1Psar = psar.il
+0000fb70: 6f63 5b31 5d0a 2020 2020 2020 2020 6461  oc[1].        da
+0000fb80: 7950 5341 5220 3d20 7073 6172 2e69 6c6f  yPSAR = psar.ilo
+0000fb90: 635b 325d 0a20 2020 2020 2020 2023 2064  c[2].        # d
+0000fba0: 6179 4d69 6e75 7332 436c 6f73 6520 3d20  ayMinus2Close = 
+0000fbb0: 6461 7461 5b22 436c 6f73 6522 5d2e 696c  data["Close"].il
+0000fbc0: 6f63 5b30 5d0a 2020 2020 2020 2020 6461  oc[0].        da
+0000fbd0: 794d 696e 7573 3143 6c6f 7365 203d 2064  yMinus1Close = d
+0000fbe0: 6174 615b 2243 6c6f 7365 225d 2e69 6c6f  ata["Close"].ilo
+0000fbf0: 635b 315d 0a20 2020 2020 2020 2064 6179  c[1].        day
+0000fc00: 436c 6f73 6520 3d20 6461 7461 5b22 436c  Close = data["Cl
+0000fc10: 6f73 6522 5d2e 696c 6f63 5b32 5d0a 2020  ose"].iloc[2].  
+0000fc20: 2020 2020 2020 2320 6461 794d 696e 7573        # dayMinus
+0000fc30: 3252 5349 203d 2064 6174 615b 2252 5349  2RSI = data["RSI
+0000fc40: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+0000fc50: 2020 2064 6179 4d69 6e75 7331 5253 4920     dayMinus1RSI 
+0000fc60: 3d20 6461 7461 5b22 5253 4922 5d2e 696c  = data["RSI"].il
+0000fc70: 6f63 5b31 5d0a 2020 2020 2020 2020 6461  oc[1].        da
+0000fc80: 7952 5349 203d 2064 6174 615b 2252 5349  yRSI = data["RSI
+0000fc90: 225d 2e69 6c6f 635b 325d 0a20 2020 2020  "].iloc[2].     
+0000fca0: 2020 200a 2020 2020 2020 2020 6861 7352     .        hasR
+0000fcb0: 6576 6572 7361 6c3d 2028 2828 6461 794d  eversal= (((dayM
+0000fcc0: 696e 7573 3150 7361 7220 3e3d 2064 6179  inus1Psar >= day
+0000fcd0: 4d69 6e75 7331 436c 6f73 6529 2061 6e64  Minus1Close) and
+0000fce0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000fcf0: 2020 2020 2020 2028 6461 7943 6c6f 7365         (dayClose
+0000fd00: 203e 3d20 6461 7950 5341 5229 2920 616e   >= dayPSAR)) an
+0000fd10: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+0000fd20: 2020 2020 2020 2020 2864 6179 4d69 6e75          (dayMinu
+0000fd30: 7331 5253 4920 3c3d 206d 696e 5253 4929  s1RSI <= minRSI)
+0000fd40: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+0000fd50: 2020 2020 2020 2020 2020 2028 6461 7952             (dayR
+0000fd60: 5349 203e 3d20 6461 794d 696e 7573 3152  SI >= dayMinus1R
+0000fd70: 5349 2929 0a20 2020 2020 2020 2069 6620  SI)).        if 
+0000fd80: 6861 7352 6576 6572 7361 6c3a 0a20 2020  hasReversal:.   
+0000fd90: 2020 2020 2020 2020 2073 6176 6564 203d           saved =
+0000fda0: 2073 656c 662e 6669 6e64 4375 7272 656e   self.findCurren
+0000fdb0: 7453 6176 6564 5661 6c75 6528 7363 7265  tSavedValue(scre
+0000fdc0: 656e 4469 6374 2c73 6176 6544 6963 742c  enDict,saveDict,
+0000fdd0: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
+0000fde0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+0000fdf0: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
+0000fe00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000fe10: 2020 7361 7665 645b 305d 200a 2020 2020    saved[0] .    
+0000fe20: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0000fe30: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+0000fe40: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0000fe50: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+0000fe60: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0000fe70: 2066 2250 5341 522d 5253 492d 5265 7622   f"PSAR-RSI-Rev"
+0000fe80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe90: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0000fea0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000feb0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+0000fec0: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
+0000fed0: 2073 6176 6564 5b31 5d20 2b20 6622 5053   saved[1] + f"PS
+0000fee0: 4152 2d52 5349 2d52 6576 220a 2020 2020  AR-RSI-Rev".    
+0000fef0: 2020 2020 2020 2020 2020 2020 2320 2828              # ((
+0000ff00: 2864 6179 4d69 6e75 7332 5073 6172 203e  (dayMinus2Psar >
+0000ff10: 3d20 6461 794d 696e 7573 3243 6c6f 7365  = dayMinus2Close
+0000ff20: 2920 616e 6420 5c0a 2020 2020 2020 2020  ) and \.        
+0000ff30: 2020 2020 2020 2020 2320 2828 6461 794d          # ((dayM
+0000ff40: 696e 7573 3143 6c6f 7365 203e 3d20 6461  inus1Close >= da
+0000ff50: 794d 696e 7573 3150 7361 7229 2061 6e64  yMinus1Psar) and
+0000ff60: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000ff70: 2020 2023 2028 6461 7943 6c6f 7365 203e     # (dayClose >
+0000ff80: 3d20 6461 7950 5341 5229 2929 2061 6e64  = dayPSAR))) and
+0000ff90: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000ffa0: 2020 2023 2028 6461 794d 696e 7573 3252     # (dayMinus2R
+0000ffb0: 5349 203e 3d20 6d69 6e52 5349 2920 616e  SI >= minRSI) an
+0000ffc0: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+0000ffd0: 2020 2020 2320 2864 6179 4d69 6e75 7331      # (dayMinus1
+0000ffe0: 5253 4920 3e3d 2064 6179 4d69 6e75 7332  RSI >= dayMinus2
+0000fff0: 5253 4929 2061 6e64 205c 0a20 2020 2020  RSI) and \.     
+00010000: 2020 2020 2020 2020 2020 2023 2028 6461             # (da
+00010010: 7952 5349 203e 3d20 6461 794d 696e 7573  yRSI >= dayMinus
+00010020: 3152 5349 2929 206f 7220 5c0a 2020 2020  1RSI)) or \.    
+00010030: 2020 2020 7265 7475 726e 2068 6173 5265      return hasRe
+00010040: 7665 7273 616c 0a0a 2020 2020 2320 4669  versal..    # Fi
+00010050: 6e64 2073 746f 636b 2072 6576 6572 7369  nd stock reversi
+00010060: 6e67 2061 7420 6769 7665 6e20 4d41 0a20  ng at given MA. 
+00010070: 2020 2064 6566 2066 696e 6452 6576 6572     def findRever
+00010080: 7361 6c4d 4128 7365 6c66 2c20 6466 2c20  salMA(self, df, 
+00010090: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+000100a0: 4469 6374 2c20 6d61 4c65 6e67 7468 2c20  Dict, maLength, 
+000100b0: 7065 7263 656e 7461 6765 3d30 2e30 3229  percentage=0.02)
+000100c0: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+000100d0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+000100e0: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+000100f0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00010100: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+00010110: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+00010120: 2020 206d 6152 616e 6765 203d 205b 392c     maRange = [9,
+00010130: 2031 302c 2032 302c 2035 302c 2032 3030   10, 20, 50, 200
+00010140: 5d20 6966 206d 614c 656e 6774 6820 696e  ] if maLength in
+00010150: 205b 392c 3130 2c32 302c 3530 2c31 3030   [9,10,20,50,100
+00010160: 5d20 656c 7365 205b 392c 3130 2c32 302c  ] else [9,10,20,
+00010170: 3530 2c31 3030 2c6d 6152 616e 6765 5d0a  50,100,maRange].
+00010180: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
+00010190: 3d20 5b5d 0a20 2020 2020 2020 2068 6173  = [].        has
+000101a0: 5265 7665 7273 616c 7320 3d20 4661 6c73  Reversals = Fals
+000101b0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+000101c0: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
+000101d0: 2020 2020 7361 7665 6420 3d20 7365 6c66      saved = self
+000101e0: 2e66 696e 6443 7572 7265 6e74 5361 7665  .findCurrentSave
+000101f0: 6456 616c 7565 2873 6372 6565 6e44 6963  dValue(screenDic
+00010200: 742c 7361 7665 4469 6374 2c20 224d 412d  t,saveDict, "MA-
+00010210: 5369 676e 616c 2229 0a20 2020 2020 2020  Signal").       
+00010220: 2066 6f72 206d 614c 656e 6774 6820 696e   for maLength in
+00010230: 206d 6152 616e 6765 3a0a 2020 2020 2020   maRange:.      
+00010240: 2020 2020 2020 6461 7461 436f 7079 203d        dataCopy =
+00010250: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+00010260: 2020 6966 2073 656c 662e 636f 6e66 6967    if self.config
+00010270: 4d61 6e61 6765 722e 7573 6545 4d41 206f  Manager.useEMA o
+00010280: 7220 6d61 4c65 6e67 7468 203d 3d20 393a  r maLength == 9:
+00010290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000102a0: 206d 6152 6576 203d 2070 6b74 616c 6962   maRev = pktalib
+000102b0: 2e45 4d41 2864 6174 6143 6f70 795b 2243  .EMA(dataCopy["C
+000102c0: 6c6f 7365 225d 2c20 7469 6d65 7065 7269  lose"], timeperi
+000102d0: 6f64 3d6d 614c 656e 6774 6829 0a20 2020  od=maLength).   
+000102e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000102f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00010300: 6152 6576 203d 2070 6b74 616c 6962 2e4d  aRev = pktalib.M
+00010310: 4128 6461 7461 436f 7079 5b22 436c 6f73  A(dataCopy["Clos
+00010320: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+00010330: 6d61 4c65 6e67 7468 290a 2020 2020 2020  maLength).      
+00010340: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00010350: 2020 2020 2020 2020 2020 2064 6174 6143             dataC
+00010360: 6f70 792e 6472 6f70 2822 6d61 5265 7622  opy.drop("maRev"
+00010370: 2c20 6178 6973 3d31 2c20 696e 706c 6163  , axis=1, inplac
+00010380: 653d 5472 7565 2c20 6572 726f 7273 3d22  e=True, errors="
+00010390: 6967 6e6f 7265 2229 0a20 2020 2020 2020  ignore").       
+000103a0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+000103b0: 7074 696f 6e3a 2320 7072 6167 6d61 3a20  ption:# pragma: 
+000103c0: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
+000103d0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+000103e0: 2020 2020 2020 2020 2020 6461 7461 436f            dataCo
+000103f0: 7079 2e69 6e73 6572 7428 6c65 6e28 6461  py.insert(len(da
+00010400: 7461 436f 7079 2e63 6f6c 756d 6e73 292c  taCopy.columns),
+00010410: 2022 6d61 5265 7622 2c20 6d61 5265 7629   "maRev", maRev)
+00010420: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00010430: 6143 6f70 7920 3d20 6461 7461 436f 7079  aCopy = dataCopy
+00010440: 5b3a 3a2d 315d 2e68 6561 6428 3429 0a20  [::-1].head(4). 
+00010450: 2020 2020 2020 2020 2020 2062 756c 6c69             bulli
+00010460: 7368 4d41 5265 7665 7273 616c 203d 2064  shMAReversal = d
+00010470: 6174 6143 6f70 795b 226d 6152 6576 225d  ataCopy["maRev"]
+00010480: 2e69 6c6f 635b 305d 203e 3d20 6461 7461  .iloc[0] >= data
+00010490: 436f 7079 5b22 6d61 5265 7622 5d2e 696c  Copy["maRev"].il
+000104a0: 6f63 5b31 5d20 616e 6420 5c0a 2020 2020  oc[1] and \.    
+000104b0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000104c0: 436f 7079 5b22 6d61 5265 7622 5d2e 696c  Copy["maRev"].il
+000104d0: 6f63 5b31 5d20 3e3d 2064 6174 6143 6f70  oc[1] >= dataCop
+000104e0: 795b 226d 6152 6576 225d 2e69 6c6f 635b  y["maRev"].iloc[
+000104f0: 325d 2061 6e64 205c 0a20 2020 2020 2020  2] and \.       
+00010500: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00010510: 6143 6f70 795b 226d 6152 6576 225d 2e69  aCopy["maRev"].i
+00010520: 6c6f 635b 325d 203c 2064 6174 6143 6f70  loc[2] < dataCop
+00010530: 795b 226d 6152 6576 225d 2e69 6c6f 635b  y["maRev"].iloc[
+00010540: 335d 0a20 2020 2020 2020 2020 2020 2062  3].            b
+00010550: 756c 6c69 7368 436c 6f73 6520 3d20 6461  ullishClose = da
+00010560: 7461 436f 7079 2e68 6561 6428 3129 5b22  taCopy.head(1)["
+00010570: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+00010580: 3e3d 2064 6174 6143 6f70 792e 6865 6164  >= dataCopy.head
+00010590: 2831 295b 226d 6152 6576 225d 2e69 6c6f  (1)["maRev"].ilo
+000105a0: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
+000105b0: 2062 6561 7269 7368 4d41 5265 7665 7273   bearishMARevers
+000105c0: 616c 203d 2064 6174 6143 6f70 795b 226d  al = dataCopy["m
+000105d0: 6152 6576 225d 2e69 6c6f 635b 305d 203c  aRev"].iloc[0] <
+000105e0: 3d20 6461 7461 436f 7079 5b22 6d61 5265  = dataCopy["maRe
+000105f0: 7622 5d2e 696c 6f63 5b31 5d20 616e 6420  v"].iloc[1] and 
+00010600: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00010610: 2020 6461 7461 436f 7079 5b22 6d61 5265    dataCopy["maRe
+00010620: 7622 5d2e 696c 6f63 5b31 5d20 3c3d 2064  v"].iloc[1] <= d
+00010630: 6174 6143 6f70 795b 226d 6152 6576 225d  ataCopy["maRev"]
+00010640: 2e69 6c6f 635b 325d 2061 6e64 205c 0a20  .iloc[2] and \. 
+00010650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010660: 2020 2064 6174 6143 6f70 795b 226d 6152     dataCopy["maR
+00010670: 6576 225d 2e69 6c6f 635b 325d 203e 2064  ev"].iloc[2] > d
+00010680: 6174 6143 6f70 795b 226d 6152 6576 225d  ataCopy["maRev"]
+00010690: 2e69 6c6f 635b 335d 0a20 2020 2020 2020  .iloc[3].       
+000106a0: 2020 2020 2069 7352 6563 656e 7443 6c6f       isRecentClo
+000106b0: 7365 5769 7468 696e 5065 7263 656e 7452  seWithinPercentR
+000106c0: 616e 6765 203d 2064 6174 6143 6f70 792e  ange = dataCopy.
+000106d0: 6571 7561 6c73 2864 6174 6143 6f70 795b  equals(dataCopy[
+000106e0: 2864 6174 6143 6f70 792e 436c 6f73 6520  (dataCopy.Close 
+000106f0: 3e3d 2028 6461 7461 436f 7079 2e6d 6152  >= (dataCopy.maR
+00010700: 6576 202d 2028 6461 7461 436f 7079 2e6d  ev - (dataCopy.m
+00010710: 6152 6576 202a 2070 6572 6365 6e74 6167  aRev * percentag
+00010720: 6529 2929 2026 2028 6461 7461 436f 7079  e))) & (dataCopy
+00010730: 2e43 6c6f 7365 203c 3d20 2864 6174 6143  .Close <= (dataC
+00010740: 6f70 792e 6d61 5265 7620 2b20 2864 6174  opy.maRev + (dat
+00010750: 6143 6f70 792e 6d61 5265 7620 2a20 7065  aCopy.maRev * pe
+00010760: 7263 656e 7461 6765 2929 295d 290a 2020  rcentage)))]).  
+00010770: 2020 2020 2020 2020 2020 6966 2028 6973            if (is
+00010780: 5265 6365 6e74 436c 6f73 6557 6974 6869  RecentCloseWithi
+00010790: 6e50 6572 6365 6e74 5261 6e67 6520 616e  nPercentRange an
+000107a0: 6420 6275 6c6c 6973 6843 6c6f 7365 2061  d bullishClose a
+000107b0: 6e64 2062 756c 6c69 7368 4d41 5265 7665  nd bullishMAReve
+000107c0: 7273 616c 2920 6f72 205c 0a20 2020 2020  rsal) or \.     
+000107d0: 2020 2020 2020 2020 2020 2028 6973 5265             (isRe
+000107e0: 6365 6e74 436c 6f73 6557 6974 6869 6e50  centCloseWithinP
+000107f0: 6572 6365 6e74 5261 6e67 6520 616e 6420  ercentRange and 
+00010800: 6e6f 7420 6275 6c6c 6973 6843 6c6f 7365  not bullishClose
+00010810: 2061 6e64 2062 6561 7269 7368 4d41 5265   and bearishMARe
+00010820: 7665 7273 616c 293a 0a20 2020 2020 2020  versal):.       
+00010830: 2020 2020 2020 2020 2068 6173 5265 7665           hasReve
+00010840: 7273 616c 7320 3d20 5472 7565 0a20 2020  rsals = True.   
+00010850: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00010860: 756c 7473 2e61 7070 656e 6428 7374 7228  ults.append(str(
+00010870: 6d61 4c65 6e67 7468 2929 0a20 2020 2020  maLength)).     
+00010880: 2020 2069 6620 6861 7352 6576 6572 7361     if hasReversa
+00010890: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+000108a0: 7363 7265 656e 4469 6374 5b22 4d41 2d53  screenDict["MA-S
+000108b0: 6967 6e61 6c22 5d20 3d20 280a 2020 2020  ignal"] = (.    
+000108c0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+000108d0: 645b 305d 200a 2020 2020 2020 2020 2020  d[0] .          
+000108e0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+000108f0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+00010900: 2020 2020 2020 202b 2028 636f 6c6f 7254         + (colorT
+00010910: 6578 742e 4752 4545 4e20 6966 2062 756c  ext.GREEN if bul
+00010920: 6c69 7368 4d41 5265 7665 7273 616c 2065  lishMAReversal e
+00010930: 6c73 6520 2863 6f6c 6f72 5465 7874 2e46  lse (colorText.F
+00010940: 4149 4c20 6966 2062 6561 7269 7368 4d41  AIL if bearishMA
+00010950: 5265 7665 7273 616c 2065 6c73 6520 636f  Reversal else co
+00010960: 6c6f 7254 6578 742e 5741 524e 2929 0a20  lorText.WARN)). 
+00010970: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00010980: 2066 2252 6576 6572 7361 6c2d 5b7b 272c   f"Reversal-[{',
+00010990: 272e 6a6f 696e 2872 6573 756c 7473 297d  '.join(results)}
+000109a0: 5d7b 2745 4d41 2720 6966 2028 6d61 4c65  ]{'EMA' if (maLe
+000109b0: 6e67 7468 203d 3d20 3920 6f72 2073 656c  ngth == 9 or sel
+000109c0: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
+000109d0: 7573 6545 4d41 2920 656c 7365 2027 4d41  useEMA) else 'MA
+000109e0: 277d 220a 2020 2020 2020 2020 2020 2020  '}".            
+000109f0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+00010a00: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00010a10: 290a 2020 2020 2020 2020 2020 2020 7361  ).            sa
+00010a20: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+00010a30: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
+00010a40: 2066 2252 6576 6572 7361 6c2d 5b7b 272c   f"Reversal-[{',
+00010a50: 272e 6a6f 696e 2872 6573 756c 7473 297d  '.join(results)}
+00010a60: 5d7b 2745 4d41 2720 6966 2028 6d61 4c65  ]{'EMA' if (maLe
+00010a70: 6e67 7468 203d 3d20 3920 6f72 2073 656c  ngth == 9 or sel
+00010a80: 662e 636f 6e66 6967 4d61 6e61 6765 722e  f.configManager.
+00010a90: 7573 6545 4d41 2920 656c 7365 2027 4d41  useEMA) else 'MA
+00010aa0: 277d 220a 2020 2020 2020 2020 7265 7475  '}".        retu
+00010ab0: 726e 2068 6173 5265 7665 7273 616c 730a  rn hasReversals.
+00010ac0: 0a20 2020 2064 6566 2066 696e 6443 7572  .    def findCur
+00010ad0: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
+00010ae0: 656c 662c 2073 6372 6565 6e44 6963 742c  elf, screenDict,
+00010af0: 2073 6176 6544 6963 742c 206b 6579 293a   saveDict, key):
+00010b00: 0a20 2020 2020 2020 2065 7869 7374 696e  .        existin
+00010b10: 6753 6372 6565 6e20 3d20 7363 7265 656e  gScreen = screen
+00010b20: 4469 6374 2e67 6574 286b 6579 290a 2020  Dict.get(key).  
+00010b30: 2020 2020 2020 6578 6973 7469 6e67 5361        existingSa
+00010b40: 7665 203d 2073 6176 6544 6963 742e 6765  ve = saveDict.ge
+00010b50: 7428 6b65 7929 0a20 2020 2020 2020 2065  t(key).        e
+00010b60: 7869 7374 696e 6753 6372 6565 6e20 3d20  xistingScreen = 
+00010b70: 6622 7b65 7869 7374 696e 6753 6372 6565  f"{existingScree
+00010b80: 6e7d 2c20 2220 6966 2028 6578 6973 7469  n}, " if (existi
+00010b90: 6e67 5363 7265 656e 2069 7320 6e6f 7420  ngScreen is not 
+00010ba0: 4e6f 6e65 2061 6e64 206c 656e 2865 7869  None and len(exi
+00010bb0: 7374 696e 6753 6372 6565 6e29 203e 2030  stingScreen) > 0
+00010bc0: 2920 656c 7365 2022 220a 2020 2020 2020  ) else "".      
+00010bd0: 2020 6578 6973 7469 6e67 5361 7665 203d    existingSave =
+00010be0: 2066 227b 6578 6973 7469 6e67 5361 7665   f"{existingSave
+00010bf0: 7d2c 2022 2069 6620 2865 7869 7374 696e  }, " if (existin
+00010c00: 6753 6176 6520 6973 206e 6f74 204e 6f6e  gSave is not Non
+00010c10: 6520 616e 6420 6c65 6e28 6578 6973 7469  e and len(existi
+00010c20: 6e67 5361 7665 2920 3e20 3029 2065 6c73  ngSave) > 0) els
+00010c30: 6520 2222 0a20 2020 2020 2020 2072 6574  e "".        ret
+00010c40: 7572 6e20 6578 6973 7469 6e67 5363 7265  urn existingScre
+00010c50: 656e 2c20 6578 6973 7469 6e67 5361 7665  en, existingSave
+00010c60: 0a0a 2020 2020 2320 406d 6561 7375 7265  ..    # @measure
+00010c70: 5f74 696d 650a 2020 2020 6465 6620 6669  _time.    def fi
+00010c80: 6e64 4262 616e 6473 5371 7565 657a 6528  ndBbandsSqueeze(
+00010c90: 7365 6c66 2c66 756c 6c44 6174 612c 2073  self,fullData, s
+00010ca0: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+00010cb0: 6963 742c 2066 696c 7465 723d 3429 3a0a  ict, filter=4):.
+00010cc0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010cd0: 2020 2020 5468 6520 5454 4d20 5371 7565      The TTM Sque
+00010ce0: 657a 6520 696e 6469 6361 746f 7220 6d65  eze indicator me
+00010cf0: 6173 7572 6573 2074 6865 2072 656c 6174  asures the relat
+00010d00: 696f 6e73 6869 7020 6265 7477 6565 6e20  ionship between 
+00010d10: 7468 6520 0a20 2020 2020 2020 2042 6f6c  the .        Bol
+00010d20: 6c69 6e67 6572 2042 616e 6473 2061 6e64  linger Bands and
+00010d30: 204b 656c 746e 6572 2773 2043 6861 6e6e   Keltner's Chann
+00010d40: 656c 2e20 5768 656e 2074 6865 2076 6f6c  el. When the vol
+00010d50: 6174 696c 6974 7920 696e 6372 6561 7365  atility increase
+00010d60: 732c 200a 2020 2020 2020 2020 736f 2064  s, .        so d
+00010d70: 6f65 7320 7468 6520 6469 7374 616e 6365  oes the distance
+00010d80: 2062 6574 7765 656e 2074 6865 2062 616e   between the ban
+00010d90: 6473 2c20 616e 6420 636f 6e76 6572 7365  ds, and converse
+00010da0: 6c79 2c20 7768 656e 2074 6865 200a 2020  ly, when the .  
+00010db0: 2020 2020 2020 766f 6c61 7469 6c69 7479        volatility
+00010dc0: 2064 6563 6c69 6e65 732c 2074 6865 2064   declines, the d
+00010dd0: 6973 7461 6e63 6520 616c 736f 2064 6563  istance also dec
+00010de0: 7265 6173 6573 2e20 5468 6520 5371 7565  reases. The Sque
+00010df0: 657a 6520 696e 6469 6361 746f 7220 0a20  eze indicator . 
+00010e00: 2020 2020 2020 2066 696e 6473 2073 6563         finds sec
+00010e10: 7469 6f6e 7320 6f66 2074 6865 2042 6f6c  tions of the Bol
+00010e20: 6c69 6e67 6572 2042 616e 6473 2073 7475  linger Bands stu
+00010e30: 6479 2077 6869 6368 2066 616c 6c20 696e  dy which fall in
+00010e40: 7369 6465 2074 6865 200a 2020 2020 2020  side the .      
+00010e50: 2020 4b65 6c74 6e65 7227 7320 4368 616e    Keltner's Chan
+00010e60: 6e65 6c73 2e0a 2020 2020 2020 2020 0a20  nels..        . 
+00010e70: 2020 2020 2020 2041 7420 7468 6520 6d6f         At the mo
+00010e80: 6d65 6e74 2074 6869 7320 7371 7565 657a  ment this squeez
+00010e90: 6520 6861 7070 656e 732c 2061 2070 7269  e happens, a pri
+00010ea0: 6365 2062 7265 616b 6f75 7420 6672 6f6d  ce breakout from
+00010eb0: 2074 6865 2075 7070 6572 200a 2020 2020   the upper .    
+00010ec0: 2020 2020 426f 6c6c 696e 6765 7220 4261      Bollinger Ba
+00010ed0: 6e64 2077 6f75 6c64 2069 6e64 6963 6174  nd would indicat
+00010ee0: 6520 7468 6520 706f 7373 6962 696c 6974  e the possibilit
+00010ef0: 7920 6f66 2061 6e20 7570 7472 656e 6420  y of an uptrend 
+00010f00: 696e 2074 6865 200a 2020 2020 2020 2020  in the .        
+00010f10: 6675 7475 7265 2e20 5468 6973 2069 7320  future. This is 
+00010f20: 6261 636b 6564 2062 7920 7468 6520 6661  backed by the fa
+00010f30: 6374 2074 6861 7420 6f6e 6365 2074 6865  ct that once the
+00010f40: 2070 7269 6365 2073 7461 7274 7320 6272   price starts br
+00010f50: 6561 6b69 6e67 200a 2020 2020 2020 2020  eaking .        
+00010f60: 6f75 7420 6f66 2074 6865 2062 616e 6473  out of the bands
+00010f70: 2c20 6974 2077 6f75 6c64 206d 6561 6e20  , it would mean 
+00010f80: 6120 7265 6c61 7861 7469 6f6e 206f 6620  a relaxation of 
+00010f90: 7468 6520 7371 7565 657a 6520 616e 6420  the squeeze and 
+00010fa0: 7468 6520 0a20 2020 2020 2020 2070 6f73  the .        pos
+00010fb0: 7369 6269 6c69 7479 206f 6620 6869 6768  sibility of high
+00010fc0: 206d 6172 6b65 7420 766f 6c61 7469 6c69   market volatili
+00010fd0: 7479 2061 6e64 2070 7269 6365 206d 6f76  ty and price mov
+00010fe0: 656d 656e 7420 696e 2074 6865 2066 7574  ement in the fut
+00010ff0: 7572 652e 200a 2020 2020 2020 2020 5369  ure. .        Si
+00011000: 6d69 6c61 726c 792c 2061 2070 7269 6365  milarly, a price
+00011010: 2062 7265 616b 6f75 7420 6672 6f6d 2074   breakout from t
+00011020: 6865 206c 6f77 6572 2042 6f6c 6c69 6e67  he lower Bolling
+00011030: 6572 2042 616e 6420 6166 7465 7220 6120  er Band after a 
+00011040: 7371 7565 657a 6520 0a20 2020 2020 2020  squeeze .       
+00011050: 2077 6f75 6c64 2069 6e64 6963 6174 6520   would indicate 
+00011060: 7468 6520 706f 7373 6962 696c 6974 7920  the possibility 
+00011070: 6f66 2061 2064 6f77 6e74 7265 6e64 2069  of a downtrend i
+00011080: 6e20 7468 6520 6675 7475 7265 2061 6e64  n the future and
+00011090: 2061 6e20 0a20 2020 2020 2020 2069 6e63   an .        inc
+000110a0: 7265 6173 6564 206d 6172 6b65 7420 766f  reased market vo
+000110b0: 6c61 7469 6c69 7479 2069 6e20 7468 6520  latility in the 
+000110c0: 7361 6d65 2064 6972 6563 7469 6f6e 2e20  same direction. 
+000110d0: 5768 656e 2074 6865 206d 6172 6b65 7420  When the market 
+000110e0: 0a20 2020 2020 2020 2066 696e 6973 6865  .        finishe
+000110f0: 7320 6120 6d6f 7665 2c20 7468 6520 696e  s a move, the in
+00011100: 6469 6361 746f 7220 7475 726e 7320 6f66  dicator turns of
+00011110: 662c 2077 6869 6368 2063 6f72 7265 7370  f, which corresp
+00011120: 6f6e 6473 2074 6f20 6261 6e64 7320 0a20  onds to bands . 
+00011130: 2020 2020 2020 2068 6176 696e 6720 7075         having pu
+00011140: 7368 6564 2077 656c 6c20 6f75 7473 6964  shed well outsid
+00011150: 6520 7468 6520 7261 6e67 6520 6f66 204b  e the range of K
+00011160: 656c 746e 6572 2773 2043 6861 6e6e 656c  eltner's Channel
+00011170: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00011180: 2020 2020 2020 2069 6620 6675 6c6c 4461         if fullDa
+00011190: 7461 2069 7320 4e6f 6e65 206f 7220 6c65  ta is None or le
+000111a0: 6e28 6675 6c6c 4461 7461 2920 3c20 3230  n(fullData) < 20
+000111b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000111c0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+000111d0: 2020 206f 6c64 6573 7452 6563 6f72 6473     oldestRecords
+000111e0: 4669 7273 745f 6466 203d 2066 756c 6c44  First_df = fullD
+000111f0: 6174 612e 6865 6164 2833 3029 2e63 6f70  ata.head(30).cop
+00011200: 7928 290a 2020 2020 2020 2020 6c61 7465  y().        late
+00011210: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
+00011220: 6620 3d20 6f6c 6465 7374 5265 636f 7264  f = oldestRecord
+00011230: 7346 6972 7374 5f64 665b 3a3a 2d31 5d2e  sFirst_df[::-1].
+00011240: 7461 696c 2833 3029 0a20 2020 2020 2020  tail(30).       
+00011250: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+00011260: 7273 745f 6466 203d 206c 6174 6573 7452  rst_df = latestR
+00011270: 6563 6f72 6473 4669 7273 745f 6466 2e66  ecordsFirst_df.f
+00011280: 696c 6c6e 6128 3029 0a20 2020 2020 2020  illna(0).       
+00011290: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+000112a0: 7273 745f 6466 203d 206c 6174 6573 7452  rst_df = latestR
+000112b0: 6563 6f72 6473 4669 7273 745f 6466 2e72  ecordsFirst_df.r
+000112c0: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
+000112d0: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
+000112e0: 2020 2020 2023 2042 6f6c 6c69 6e67 6572       # Bollinger
+000112f0: 2062 616e 6473 0a20 2020 2020 2020 206c   bands.        l
+00011300: 6174 6573 7452 6563 6f72 6473 4669 7273  atestRecordsFirs
+00011310: 745f 6466 2e6c 6f63 5b3a 2c27 4242 616e  t_df.loc[:,'BBan
+00011320: 6473 2d55 275d 2c20 6c61 7465 7374 5265  ds-U'], latestRe
+00011330: 636f 7264 7346 6972 7374 5f64 662e 6c6f  cordsFirst_df.lo
+00011340: 635b 3a2c 2742 4261 6e64 732d 4d27 5d2c  c[:,'BBands-M'],
+00011350: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+00011360: 7273 745f 6466 2e6c 6f63 5b3a 2c27 4242  rst_df.loc[:,'BB
+00011370: 616e 6473 2d4c 275d 203d 2070 6b74 616c  ands-L'] = pktal
+00011380: 6962 2e42 4241 4e44 5328 6c61 7465 7374  ib.BBANDS(latest
+00011390: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
+000113a0: 2243 6c6f 7365 225d 2c20 3230 290a 2020  "Close"], 20).  
+000113b0: 2020 2020 2020 2320 636f 6d70 7574 6520        # compute 
+000113c0: 4b65 6c74 6e65 7227 7320 6368 616e 6e65  Keltner's channe
+000113d0: 6c0a 2020 2020 2020 2020 6c61 7465 7374  l.        latest
+000113e0: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
+000113f0: 276c 6f77 5f6b 656c 275d 2c20 6c61 7465  'low_kel'], late
+00011400: 7374 5265 636f 7264 7346 6972 7374 5f64  stRecordsFirst_d
+00011410: 665b 2775 7070 5f6b 656c 275d 203d 2070  f['upp_kel'] = p
+00011420: 6b74 616c 6962 2e4b 656c 746e 6572 7343  ktalib.KeltnersC
+00011430: 6861 6e6e 656c 286c 6174 6573 7452 6563  hannel(latestRec
+00011440: 6f72 6473 4669 7273 745f 6466 5b22 4869  ordsFirst_df["Hi
+00011450: 6768 225d 2c20 6c61 7465 7374 5265 636f  gh"], latestReco
+00011460: 7264 7346 6972 7374 5f64 665b 224c 6f77  rdsFirst_df["Low
+00011470: 225d 2c6c 6174 6573 7452 6563 6f72 6473  "],latestRecords
+00011480: 4669 7273 745f 6466 5b22 436c 6f73 6522  First_df["Close"
+00011490: 5d2c 3230 290a 2020 2020 2020 2020 2320  ],20).        # 
+000114a0: 7371 7565 657a 6520 696e 6469 6361 746f  squeeze indicato
+000114b0: 720a 2020 2020 2020 2020 6465 6620 696e  r.        def in
+000114c0: 5f73 7175 6565 7a65 2864 6629 3a0a 2020  _squeeze(df):.  
+000114d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000114e0: 2064 665b 276c 6f77 5f6b 656c 275d 203c   df['low_kel'] <
+000114f0: 2064 665b 2742 4261 6e64 732d 4c27 5d20   df['BBands-L'] 
+00011500: 3c20 6466 5b27 4242 616e 6473 2d55 275d  < df['BBands-U']
+00011510: 203c 2064 665b 2775 7070 5f6b 656c 275d   < df['upp_kel']
+00011520: 0a0a 2020 2020 2020 2020 6c61 7465 7374  ..        latest
+00011530: 5265 636f 7264 7346 6972 7374 5f64 665b  RecordsFirst_df[
+00011540: 2773 7175 6565 7a65 275d 203d 206c 6174  'squeeze'] = lat
+00011550: 6573 7452 6563 6f72 6473 4669 7273 745f  estRecordsFirst_
+00011560: 6466 2e61 7070 6c79 2869 6e5f 7371 7565  df.apply(in_sque
+00011570: 657a 652c 2061 7869 733d 3129 0a0a 2020  eze, axis=1)..  
+00011580: 2020 2020 2020 2320 4c65 7427 7320 7265        # Let's re
+00011590: 7669 6577 206a 7573 7420 7468 6520 7072  view just the pr
+000115a0: 6576 696f 7573 2033 2063 616e 646c 6573  evious 3 candles
+000115b0: 2069 6e63 6c75 6469 6e67 2074 6f64 6179   including today
+000115c0: 2028 6174 2074 6865 2065 6e64 290a 2020   (at the end).  
+000115d0: 2020 2020 2020 6c61 7465 7374 5265 636f        latestReco
+000115e0: 7264 7346 6972 7374 5f64 6620 3d20 6c61  rdsFirst_df = la
+000115f0: 7465 7374 5265 636f 7264 7346 6972 7374  testRecordsFirst
+00011600: 5f64 662e 7461 696c 2833 290a 2020 2020  _df.tail(3).    
+00011610: 2020 2020 2320 7374 6f63 6b20 6973 2063      # stock is c
+00011620: 6f6d 696e 6720 6f75 7420 6f66 2074 6865  oming out of the
+00011630: 2073 7175 6565 7a65 0a20 2020 2020 2020   squeeze.       
+00011640: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
+00011650: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+00011660: 6c75 6528 7363 7265 656e 4469 6374 2c20  lue(screenDict, 
+00011670: 7361 7665 4469 6374 2c20 2250 6174 7465  saveDict, "Patte
+00011680: 726e 2229 0a20 2020 2020 2020 2063 616e  rn").        can
+00011690: 646c 6533 5371 7a20 3d20 6c61 7465 7374  dle3Sqz = latest
+000116a0: 5265 636f 7264 7346 6972 7374 5f64 662e  RecordsFirst_df.
+000116b0: 696c 6f63 5b2d 335d 5b22 7371 7565 657a  iloc[-3]["squeez
+000116c0: 6522 5d0a 2020 2020 2020 2020 6361 6e64  e"].        cand
+000116d0: 6c65 3153 717a 203d 206c 6174 6573 7452  le1Sqz = latestR
+000116e0: 6563 6f72 6473 4669 7273 745f 6466 2e69  ecordsFirst_df.i
+000116f0: 6c6f 635b 2d31 5d5b 2273 7175 6565 7a65  loc[-1]["squeeze
+00011700: 225d 0a20 2020 2020 2020 2063 616e 646c  "].        candl
+00011710: 6532 5371 7a20 3d20 6c61 7465 7374 5265  e2Sqz = latestRe
+00011720: 636f 7264 7346 6972 7374 5f64 662e 696c  cordsFirst_df.il
+00011730: 6f63 5b2d 325d 5b22 7371 7565 657a 6522  oc[-2]["squeeze"
+00011740: 5d0a 2020 2020 2020 2020 6966 2063 616e  ].        if can
+00011750: 646c 6533 5371 7a20 616e 6420 6e6f 7420  dle3Sqz and not 
+00011760: 6361 6e64 6c65 3153 717a 3a0a 2020 2020  candle1Sqz:.    
+00011770: 2020 2020 2020 2020 2320 3372 6420 6361          # 3rd ca
+00011780: 6e64 6c65 2066 726f 6d20 7468 6520 6d6f  ndle from the mo
+00011790: 7374 2072 6563 656e 7420 6f6e 6520 7761  st recent one wa
+000117a0: 7320 696e 2073 7175 6565 7a65 2062 7574  s in squeeze but
+000117b0: 2074 6865 206d 6f73 7420 7265 6365 6e74   the most recent
+000117c0: 206f 6e65 2069 7320 6e6f 742e 0a20 2020   one is not..   
+000117d0: 2020 2020 2020 2020 2069 6620 6669 6c74           if filt
+000117e0: 6572 206e 6f74 2069 6e20 5b31 2c33 2c34  er not in [1,3,4
+000117f0: 5d3a 2023 2042 7579 2f53 656c 6c2f 416c  ]: # Buy/Sell/Al
+00011800: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00011810: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00011820: 2020 2020 2020 2020 2020 2023 2064 6563             # dec
+00011830: 6964 6520 7768 6963 6820 6163 7469 6f6e  ide which action
+00011840: 2074 6f20 7461 6b65 2062 7920 636f 6d70   to take by comp
+00011850: 6172 696e 6720 6469 7374 616e 6365 7320  aring distances 
+00011860: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00011870: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+00011880: 616e 6365 5f74 6f5f 7570 7065 7220 3d20  ance_to_upper = 
+00011890: 6162 7328 6c61 7465 7374 5265 636f 7264  abs(latestRecord
+000118a0: 7346 6972 7374 5f64 665b 2742 4261 6e64  sFirst_df['BBand
+000118b0: 732d 5527 5d2e 7661 6c75 6573 5b2d 315d  s-U'].values[-1]
+000118c0: 202d 206c 6174 6573 7452 6563 6f72 6473   - latestRecords
+000118d0: 4669 7273 745f 6466 5b27 436c 6f73 6527  First_df['Close'
+000118e0: 5d2e 7661 6c75 6573 5b2d 315d 290a 2020  ].values[-1]).  
+000118f0: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+00011900: 6365 5f74 6f5f 6c6f 7765 7220 3d20 6162  ce_to_lower = ab
+00011910: 7328 6c61 7465 7374 5265 636f 7264 7346  s(latestRecordsF
+00011920: 6972 7374 5f64 665b 2742 4261 6e64 732d  irst_df['BBands-
+00011930: 4c27 5d2e 7661 6c75 6573 5b2d 315d 202d  L'].values[-1] -
+00011940: 206c 6174 6573 7452 6563 6f72 6473 4669   latestRecordsFi
+00011950: 7273 745f 6466 5b27 436c 6f73 6527 5d2e  rst_df['Close'].
+00011960: 7661 6c75 6573 5b2d 315d 290a 2020 2020  values[-1]).    
+00011970: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00011980: 2020 2020 2061 6374 696f 6e20 3d20 4661       action = Fa
+00011990: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+000119a0: 6966 2064 6973 7461 6e63 655f 746f 5f75  if distance_to_u
+000119b0: 7070 6572 203c 2064 6973 7461 6e63 655f  pper < distance_
+000119c0: 746f 5f6c 6f77 6572 3a0a 2020 2020 2020  to_lower:.      
+000119d0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+000119e0: 7465 7220 6e6f 7420 696e 205b 312c 345d  ter not in [1,4]
+000119f0: 3a20 2320 4275 792f 416c 6c0a 2020 2020  : # Buy/All.    
+00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a10: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+00011a20: 2020 2020 2020 2020 2020 2020 2061 6374               act
+00011a30: 696f 6e20 3d20 5472 7565 0a20 2020 2020  ion = True.     
+00011a40: 2020 2020 2020 2065 6c69 6620 6669 6c74         elif filt
+00011a50: 6572 206e 6f74 2069 6e20 5b33 2c34 5d3a  er not in [3,4]:
+00011a60: 2023 2053 656c 6c2f 416c 6c0a 2020 2020   # Sell/All.    
+00011a70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00011a80: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00011a90: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00011aa0: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+00011ab0: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00011ac0: 742e 424f 4c44 202b 2028 636f 6c6f 7254  t.BOLD + (colorT
+00011ad0: 6578 742e 4752 4545 4e20 6966 2061 6374  ext.GREEN if act
+00011ae0: 696f 6e20 656c 7365 2063 6f6c 6f72 5465  ion else colorTe
+00011af0: 7874 2e46 4149 4c29 202b 2066 2242 4261  xt.FAIL) + f"BBa
+00011b00: 6e64 732d 5351 5a2d 7b27 4275 7927 2069  nds-SQZ-{'Buy' i
+00011b10: 6620 6163 7469 6f6e 2065 6c73 6520 2753  f action else 'S
+00011b20: 656c 6c27 7d22 202b 2063 6f6c 6f72 5465  ell'}" + colorTe
+00011b30: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00011b40: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+00011b50: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
+00011b60: 5d20 2b20 6622 5454 4d2d 5351 5a2d 7b27  ] + f"TTM-SQZ-{'
+00011b70: 4275 7927 2069 6620 6163 7469 6f6e 2065  Buy' if action e
+00011b80: 6c73 6520 2753 656c 6c27 7d22 0a20 2020  lse 'Sell'}".   
+00011b90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011ba0: 5472 7565 0a20 2020 2020 2020 2065 6c69  True.        eli
+00011bb0: 6620 6361 6e64 6c65 3353 717a 2061 6e64  f candle3Sqz and
+00011bc0: 2063 616e 646c 6532 5371 7a20 616e 6420   candle2Sqz and 
+00011bd0: 6361 6e64 6c65 3153 717a 3a0a 2020 2020  candle1Sqz:.    
+00011be0: 2020 2020 2020 2020 2320 4c61 7374 2033          # Last 3
+00011bf0: 2063 616e 646c 6573 2069 6e20 7371 7565   candles in sque
+00011c00: 657a 650a 2020 2020 2020 2020 2020 2020  eze.            
+00011c10: 6966 2066 696c 7465 7220 6e6f 7420 696e  if filter not in
+00011c20: 205b 322c 345d 3a20 2320 5371 5a2f 416c   [2,4]: # SqZ/Al
+00011c30: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00011c40: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00011c50: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00011c60: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
+00011c70: 203d 2066 277b 7361 7665 645b 305d 7d7b   = f'{saved[0]}{
+00011c80: 636f 6c6f 7254 6578 742e 424f 4c44 7d7b  colorText.BOLD}{
+00011c90: 636f 6c6f 7254 6578 742e 5741 524e 7d54  colorText.WARN}T
+00011ca0: 544d 2d53 515a 7b63 6f6c 6f72 5465 7874  TM-SQZ{colorText
+00011cb0: 2e45 4e44 7d27 0a20 2020 2020 2020 2020  .END}'.         
+00011cc0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+00011cd0: 7465 726e 225d 203d 2066 277b 7361 7665  tern"] = f'{save
+00011ce0: 645b 315d 7d54 544d 2d53 515a 270a 2020  d[1]}TTM-SQZ'.  
+00011cf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011d00: 2054 7275 650a 2020 2020 2020 2020 7265   True.        re
+00011d10: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
+00011d20: 6465 6620 6669 6e64 496e 7472 6164 6179  def findIntraday
+00011d30: 4869 6768 4372 6f73 736f 7665 7228 7365  HighCrossover(se
+00011d40: 6c66 2c20 6466 2c20 6166 7465 7254 696d  lf, df, afterTim
+00011d50: 6573 7461 6d70 3d4e 6f6e 6529 3a0a 2020  estamp=None):.  
+00011d60: 2020 2020 2020 6966 2064 6620 6973 204e        if df is N
+00011d70: 6f6e 6520 6f72 206c 656e 2864 6629 203d  one or len(df) =
+00011d80: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00011d90: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00011da0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
+00011db0: 636f 7079 2829 0a20 2020 2020 2020 2064  copy().        d
+00011dc0: 6174 6120 3d20 6461 7461 2e66 696c 6c6e  ata = data.filln
+00011dd0: 6128 3029 0a20 2020 2020 2020 2064 6174  a(0).        dat
+00011de0: 6120 3d20 6461 7461 2e72 6570 6c61 6365  a = data.replace
+00011df0: 285b 6e70 2e69 6e66 2c20 2d6e 702e 696e  ([np.inf, -np.in
+00011e00: 665d 2c20 3029 0a20 2020 2020 2020 2064  f], 0).        d
+00011e10: 6174 6120 3d20 6461 7461 5b3a 3a2d 315d  ata = data[::-1]
+00011e20: 2020 2320 5265 7665 7273 6520 7468 6520    # Reverse the 
+00011e30: 6461 7461 6672 616d 6520 736f 2074 6861  dataframe so tha
+00011e40: 7420 6974 7320 7468 6520 6f6c 6465 7374  t its the oldest
+00011e50: 2064 6174 6520 6669 7273 740a 2020 2020   date first.    
+00011e60: 2020 2020 6469 6666 5f64 6620 3d20 4e6f      diff_df = No
+00011e70: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
+00011e80: 2020 2020 2020 2020 2020 2020 2320 4c65              # Le
+00011e90: 7427 7320 6f6e 6c79 2063 6f6e 7369 6465  t's only conside
+00011ea0: 7220 7468 6f73 6520 6361 6e64 6c65 7320  r those candles 
+00011eb0: 7468 6174 2061 7265 2061 6674 6572 2074  that are after t
+00011ec0: 6865 2061 6c65 7274 2069 7373 7565 2d74  he alert issue-t
+00011ed0: 696d 6520 696e 2074 6865 206d 6f72 6e69  ime in the morni
+00011ee0: 6e67 7320 2b20 3220 6361 6e64 6c65 7320  ngs + 2 candles 
+00011ef0: 2866 6f72 2062 7579 2f73 656c 6c29 0a20  (for buy/sell). 
+00011f00: 2020 2020 2020 2020 2020 2064 6966 665f             diff_
+00011f10: 6466 203d 2064 6174 615b 6461 7461 2e69  df = data[data.i
+00011f20: 6e64 6578 203e 3d20 2070 642e 746f 5f64  ndex >=  pd.to_d
+00011f30: 6174 6574 696d 6528 6627 7b50 4b44 6174  atetime(f'{PKDat
+00011f40: 6555 7469 6c69 7469 6573 2e74 7261 6469  eUtilities.tradi
+00011f50: 6e67 4461 7465 2829 2e73 7472 6674 696d  ngDate().strftim
+00011f60: 6528 6622 2559 2d25 6d2d 2564 2229 7d20  e(f"%Y-%m-%d")} 
+00011f70: 3039 3a7b 3135 2b73 656c 662e 636f 6e66  09:{15+self.conf
+00011f80: 6967 4d61 6e61 6765 722e 6d6f 726e 696e  igManager.mornin
+00011f90: 6761 6e61 6c79 7369 7363 616e 646c 656e  ganalysiscandlen
+00011fa0: 756d 6265 7220 2b20 327d 3a30 302b 3035  umber + 2}:00+05
+00011fb0: 3a33 3027 292e 746f 5f64 6174 6574 696d  :30').to_datetim
+00011fc0: 6536 3428 295d 0a20 2020 2020 2020 2020  e64()].         
+00011fd0: 2020 2023 2062 726f 6b65 7253 7172 4f66     # brokerSqrOf
+00011fe0: 6674 696d 6520 3d20 7064 2e74 6f5f 6461  ftime = pd.to_da
+00011ff0: 7465 7469 6d65 2866 277b 504b 4461 7465  tetime(f'{PKDate
+00012000: 5574 696c 6974 6965 732e 7472 6164 696e  Utilities.tradin
+00012010: 6744 6174 6528 292e 7374 7266 7469 6d65  gDate().strftime
+00012020: 2866 2225 592d 256d 2d25 6422 297d 2031  (f"%Y-%m-%d")} 1
+00012030: 353a 3134 3a30 302b 3035 3a33 3027 292e  5:14:00+05:30').
+00012040: 746f 5f64 6174 6574 696d 6536 3428 290a  to_datetime64().
+00012050: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+00012060: 2020 2020 2020 2020 2020 2020 6469 6666              diff
+00012070: 5f64 6620 3d20 6461 7461 5b64 6174 612e  _df = data[data.
+00012080: 696e 6465 7820 3e3d 2020 7064 2e74 6f5f  index >=  pd.to_
+00012090: 6461 7465 7469 6d65 2866 277b 504b 4461  datetime(f'{PKDa
+000120a0: 7465 5574 696c 6974 6965 732e 7472 6164  teUtilities.trad
+000120b0: 696e 6744 6174 6528 292e 7374 7266 7469  ingDate().strfti
+000120c0: 6d65 2866 2225 592d 256d 2d25 6422 297d  me(f"%Y-%m-%d")}
+000120d0: 2030 393a 7b31 352b 7365 6c66 2e63 6f6e   09:{15+self.con
+000120e0: 6669 674d 616e 6167 6572 2e6d 6f72 6e69  figManager.morni
+000120f0: 6e67 616e 616c 7973 6973 6361 6e64 6c65  nganalysiscandle
+00012100: 6e75 6d62 6572 202b 2032 7d3a 3030 2b30  number + 2}:00+0
+00012110: 353a 3330 272c 2075 7463 3d54 7275 6529  5:30', utc=True)
+00012120: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+00012130: 6272 6f6b 6572 5371 724f 6666 7469 6d65  brokerSqrOfftime
+00012140: 203d 2070 642e 746f 5f64 6174 6574 696d   = pd.to_datetim
+00012150: 6528 6627 7b50 4b44 6174 6555 7469 6c69  e(f'{PKDateUtili
+00012160: 7469 6573 2e74 7261 6469 6e67 4461 7465  ties.tradingDate
+00012170: 2829 2e73 7472 6674 696d 6528 6622 2559  ().strftime(f"%Y
+00012180: 2d25 6d2d 2564 2229 7d20 3135 3a31 343a  -%m-%d")} 15:14:
+00012190: 3030 2b30 353a 3330 272c 2075 7463 3d54  00+05:30', utc=T
+000121a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000121b0: 2070 6173 730a 2020 2020 2020 2020 6461   pass.        da
+000121c0: 7948 6967 6841 6674 6572 416c 6572 7420  yHighAfterAlert 
+000121d0: 3d20 6469 6666 5f64 665b 2248 6967 6822  = diff_df["High"
+000121e0: 5d2e 6d61 7828 290a 2020 2020 2020 2020  ].max().        
+000121f0: 6869 6768 526f 7720 3d20 6469 6666 5f64  highRow = diff_d
+00012200: 665b 6469 6666 5f64 665b 2248 6967 6822  f[diff_df["High"
+00012210: 5d20 3e3d 2064 6179 4869 6768 4166 7465  ] >= dayHighAfte
+00012220: 7241 6c65 7274 5d0a 2020 2020 2020 2020  rAlert].        
+00012230: 6966 2068 6967 6852 6f77 2069 7320 6e6f  if highRow is no
+00012240: 7420 4e6f 6e65 2061 6e64 206c 656e 2868  t None and len(h
+00012250: 6967 6852 6f77 2920 3e20 303a 0a20 2020  ighRow) > 0:.   
+00012260: 2020 2020 2020 2020 2068 6967 6852 6f77           highRow
+00012270: 203d 2068 6967 6852 6f77 2e74 6169 6c28   = highRow.tail(
+00012280: 3129 0a20 2020 2020 2020 2072 6574 7572  1).        retur
+00012290: 6e20 6869 6768 526f 772e 696e 6465 785b  n highRow.index[
+000122a0: 2d31 5d2c 2068 6967 6852 6f77 0a0a 0a20  -1], highRow... 
+000122b0: 2020 2064 6566 2066 696e 644d 4143 4443     def findMACDC
+000122c0: 726f 7373 6f76 6572 2873 656c 662c 2064  rossover(self, d
+000122d0: 662c 2061 6674 6572 5469 6d65 7374 616d  f, afterTimestam
+000122e0: 703d 4e6f 6e65 2c20 6e74 6843 726f 7373  p=None, nthCross
+000122f0: 6f76 6572 3d31 2c20 7570 4469 7265 6374  over=1, upDirect
+00012300: 696f 6e3d 5472 7565 2c20 6d69 6e52 5349  ion=True, minRSI
+00012310: 3d36 3029 3a0a 2020 2020 2020 2020 6966  =60):.        if
+00012320: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+00012330: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+00012340: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012350: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+00012360: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+00012370: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00012380: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+00012390: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+000123a0: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+000123b0: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+000123c0: 2020 2020 2020 2064 6174 612e 6472 6f70         data.drop
+000123d0: 6e61 2861 7869 733d 302c 2068 6f77 3d22  na(axis=0, how="
+000123e0: 616c 6c22 2c20 696e 706c 6163 653d 5472  all", inplace=Tr
+000123f0: 7565 2920 2320 4d61 7962 6520 7468 6572  ue) # Maybe ther
+00012400: 6520 7761 7320 6e6f 2074 7261 6465 2064  e was no trade d
+00012410: 6f6e 6520 6174 2074 6865 7365 2074 696d  one at these tim
+00012420: 6573 3f0a 2020 2020 2020 2020 6461 7461  es?.        data
+00012430: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
+00012440: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
+00012450: 6166 7261 6d65 2073 6f20 7468 6174 2069  aframe so that i
+00012460: 7473 2074 6865 206f 6c64 6573 7420 6461  ts the oldest da
+00012470: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
+00012480: 206d 6163 644c 696e 652c 206d 6163 6453   macdLine, macdS
+00012490: 6967 6e61 6c2c 206d 6163 6448 6973 7420  ignal, macdHist 
+000124a0: 3d20 706b 7461 6c69 622e 4d41 4344 2864  = pktalib.MACD(d
+000124b0: 6174 615b 2243 6c6f 7365 225d 2c20 3132  ata["Close"], 12
+000124c0: 2c20 3236 2c20 3929 0a20 2020 2020 2020  , 26, 9).       
+000124d0: 2023 2072 7369 5f64 6620 3d20 706b 7461   # rsi_df = pkta
+000124e0: 6c69 622e 5253 4928 6461 7461 5b22 436c  lib.RSI(data["Cl
+000124f0: 6f73 6522 5d2c 2031 3429 0a20 2020 2020  ose"], 14).     
+00012500: 2020 206c 696e 655f 6466 203d 2070 642e     line_df = pd.
+00012510: 4461 7461 4672 616d 6528 6d61 6364 4c69  DataFrame(macdLi
+00012520: 6e65 290a 2020 2020 2020 2020 7369 676e  ne).        sign
+00012530: 616c 5f64 6620 3d20 7064 2e44 6174 6146  al_df = pd.DataF
+00012540: 7261 6d65 286d 6163 6453 6967 6e61 6c29  rame(macdSignal)
+00012550: 0a20 2020 2020 2020 2076 6f6c 5f64 6620  .        vol_df 
+00012560: 3d20 6461 7461 5b22 566f 6c75 6d65 225d  = data["Volume"]
+00012570: 0a20 2020 2020 2020 2064 6966 665f 6466  .        diff_df
+00012580: 203d 2070 642e 636f 6e63 6174 285b 6c69   = pd.concat([li
+00012590: 6e65 5f64 662c 2073 6967 6e61 6c5f 6466  ne_df, signal_df
+000125a0: 2c20 7369 676e 616c 5f64 662d 6c69 6e65  , signal_df-line
+000125b0: 5f64 662c 766f 6c5f 6466 5d2c 2061 7869  _df,vol_df], axi
+000125c0: 733d 3129 0a20 2020 2020 2020 2064 6966  s=1).        dif
+000125d0: 665f 6466 2e63 6f6c 756d 6e73 203d 205b  f_df.columns = [
+000125e0: 226c 696e 6522 2c22 7369 676e 616c 222c  "line","signal",
+000125f0: 2264 6966 6622 2c22 766f 6c22 5d0a 2020  "diff","vol"].  
+00012600: 2020 2020 2020 6469 6666 5f64 6620 3d20        diff_df = 
+00012610: 6469 6666 5f64 665b 6469 6666 5f64 665b  diff_df[diff_df[
+00012620: 2276 6f6c 225d 203e 2030 5d20 2320 5765  "vol"] > 0] # We
+00012630: 2772 6520 6e6f 7420 676f 696e 6720 746f  're not going to
+00012640: 2064 6f20 616e 7974 6869 6e67 2077 6974   do anything wit
+00012650: 6820 6120 6361 6e64 6c65 2077 6865 7265  h a candle where
+00012660: 2074 6865 7265 2077 6173 206e 6f20 7472   there was no tr
+00012670: 6164 652e 0a20 2020 2020 2020 2023 2062  ade..        # b
+00012680: 726f 6b65 7253 7172 4f66 6674 696d 6520  rokerSqrOfftime 
+00012690: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
+000126a0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000126b0: 2320 4c65 7427 7320 6f6e 6c79 2063 6f6e  # Let's only con
+000126c0: 7369 6465 7220 7468 6f73 6520 6361 6e64  sider those cand
+000126d0: 6c65 7320 7468 6174 2061 7265 2061 6674  les that are aft
+000126e0: 6572 2074 6865 2061 6c65 7274 2069 7373  er the alert iss
+000126f0: 7565 2d74 696d 6520 696e 2074 6865 206d  ue-time in the m
+00012700: 6f72 6e69 6e67 7320 2b20 3220 6361 6e64  ornings + 2 cand
+00012710: 6c65 7320 2866 6f72 2062 7579 2f73 656c  les (for buy/sel
+00012720: 6c29 0a20 2020 2020 2020 2020 2020 2064  l).            d
+00012730: 6966 665f 6466 203d 2064 6966 665f 6466  iff_df = diff_df
+00012740: 5b64 6966 665f 6466 2e69 6e64 6578 203e  [diff_df.index >
+00012750: 3d20 2070 642e 746f 5f64 6174 6574 696d  =  pd.to_datetim
+00012760: 6528 6627 7b50 4b44 6174 6555 7469 6c69  e(f'{PKDateUtili
+00012770: 7469 6573 2e74 7261 6469 6e67 4461 7465  ties.tradingDate
+00012780: 2829 2e73 7472 6674 696d 6528 6622 2559  ().strftime(f"%Y
+00012790: 2d25 6d2d 2564 2229 7d20 3039 3a7b 3135  -%m-%d")} 09:{15
+000127a0: 2b73 656c 662e 636f 6e66 6967 4d61 6e61  +self.configMana
+000127b0: 6765 722e 6d6f 726e 696e 6761 6e61 6c79  ger.morninganaly
+000127c0: 7369 7363 616e 646c 656e 756d 6265 7220  siscandlenumber 
+000127d0: 2b20 327d 3a30 302b 3035 3a33 3027 292e  + 2}:00+05:30').
+000127e0: 746f 5f64 6174 6574 696d 6536 3428 295d  to_datetime64()]
+000127f0: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
+00012800: 726f 6b65 7253 7172 4f66 6674 696d 6520  rokerSqrOfftime 
+00012810: 3d20 7064 2e74 6f5f 6461 7465 7469 6d65  = pd.to_datetime
+00012820: 2866 277b 504b 4461 7465 5574 696c 6974  (f'{PKDateUtilit
+00012830: 6965 732e 7472 6164 696e 6744 6174 6528  ies.tradingDate(
+00012840: 292e 7374 7266 7469 6d65 2866 2225 592d  ).strftime(f"%Y-
+00012850: 256d 2d25 6422 297d 2031 353a 3134 3a30  %m-%d")} 15:14:0
+00012860: 302b 3035 3a33 3027 292e 746f 5f64 6174  0+05:30').to_dat
+00012870: 6574 696d 6536 3428 290a 2020 2020 2020  etime64().      
+00012880: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+00012890: 2020 2020 2020 6469 6666 5f64 6620 3d20        diff_df = 
+000128a0: 6469 6666 5f64 665b 6469 6666 5f64 662e  diff_df[diff_df.
+000128b0: 696e 6465 7820 3e3d 2020 7064 2e74 6f5f  index >=  pd.to_
+000128c0: 6461 7465 7469 6d65 2866 277b 504b 4461  datetime(f'{PKDa
+000128d0: 7465 5574 696c 6974 6965 732e 7472 6164  teUtilities.trad
+000128e0: 696e 6744 6174 6528 292e 7374 7266 7469  ingDate().strfti
+000128f0: 6d65 2866 2225 592d 256d 2d25 6422 297d  me(f"%Y-%m-%d")}
+00012900: 2030 393a 7b31 352b 7365 6c66 2e63 6f6e   09:{15+self.con
+00012910: 6669 674d 616e 6167 6572 2e6d 6f72 6e69  figManager.morni
+00012920: 6e67 616e 616c 7973 6973 6361 6e64 6c65  nganalysiscandle
+00012930: 6e75 6d62 6572 202b 2032 7d3a 3030 2b30  number + 2}:00+0
+00012940: 353a 3330 272c 2075 7463 3d54 7275 6529  5:30', utc=True)
+00012950: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+00012960: 6272 6f6b 6572 5371 724f 6666 7469 6d65  brokerSqrOfftime
+00012970: 203d 2070 642e 746f 5f64 6174 6574 696d   = pd.to_datetim
+00012980: 6528 6627 7b50 4b44 6174 6555 7469 6c69  e(f'{PKDateUtili
+00012990: 7469 6573 2e74 7261 6469 6e67 4461 7465  ties.tradingDate
+000129a0: 2829 2e73 7472 6674 696d 6528 6622 2559  ().strftime(f"%Y
+000129b0: 2d25 6d2d 2564 2229 7d20 3135 3a31 343a  -%m-%d")} 15:14:
+000129c0: 3030 2b30 353a 3330 272c 2075 7463 3d54  00+05:30', utc=T
+000129d0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000129e0: 2070 6173 730a 2020 2020 2020 2020 696e   pass.        in
+000129f0: 6465 7820 3d20 6c65 6e28 6469 6666 5f64  dex = len(diff_d
+00012a00: 6629 0a20 2020 2020 2020 2063 726f 7373  f).        cross
+00012a10: 4f76 6572 203d 2030 0a20 2020 2020 2020  Over = 0.       
+00012a20: 200a 2020 2020 2020 2020 2320 4c6f 6f70   .        # Loop
+00012a30: 2075 6e74 696c 2077 6527 7665 2066 6f75   until we've fou
+00012a40: 6e64 2074 6865 206e 7468 2063 726f 7373  nd the nth cross
+00012a50: 6f76 6572 2066 6f72 204d 4143 4420 6f72  over for MACD or
+00012a60: 2077 6527 7665 2072 6561 6368 6564 2074   we've reached t
+00012a70: 6865 206c 6173 7420 706f 696e 7420 696e  he last point in
+00012a80: 2074 696d 650a 2020 2020 2020 2020 7768   time.        wh
+00012a90: 696c 6520 2863 726f 7373 4f76 6572 203c  ile (crossOver <
+00012aa0: 206e 7468 4372 6f73 736f 7665 7220 616e   nthCrossover an
+00012ab0: 6420 696e 6465 7820 3e3d 3029 3a0a 2020  d index >=0):.  
+00012ac0: 2020 2020 2020 2020 2020 6966 2064 6966            if dif
+00012ad0: 665f 6466 5b22 6469 6666 225d 5b69 6e64  f_df["diff"][ind
+00012ae0: 6578 2d31 5d20 3c20 303a 2023 2053 6967  ex-1] < 0: # Sig
+00012af0: 6e61 6c20 6c69 6e65 2068 6173 206e 6f74  nal line has not
+00012b00: 2063 726f 7373 6564 2079 6574 2061 6e64   crossed yet and
+00012b10: 2069 7320 6265 6c6f 7720 7468 6520 7a65   is below the ze
+00012b20: 726f 206c 696e 650a 2020 2020 2020 2020  ro line.        
+00012b30: 2020 2020 2020 2020 7768 696c 6528 2864          while((d
+00012b40: 6966 665f 6466 5b22 6469 6666 225d 5b69  iff_df["diff"][i
+00012b50: 6e64 6578 2d31 5d20 3c20 3020 616e 6420  ndex-1] < 0 and 
+00012b60: 696e 6465 7820 3e3d 3029 293a 2023 2061  index >=0)): # a
+00012b70: 6e64 2064 6966 665f 6466 2e69 6e64 6578  nd diff_df.index
+00012b80: 203c 3d20 6272 6f6b 6572 5371 724f 6666   <= brokerSqrOff
+00012b90: 7469 6d65 293a 2023 206f 7220 6469 6666  time): # or diff
+00012ba0: 5f64 665b 2272 7369 225d 5b69 6e64 6578  _df["rsi"][index
+00012bb0: 2d31 5d20 3c3d 206d 696e 5253 4929 3a0a  -1] <= minRSI):.
+00012bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bd0: 2020 2020 2320 4c6f 6f70 2077 6869 6c65      # Loop while
+00012be0: 2053 6967 6e61 6c20 6c69 6e65 2068 6173   Signal line has
+00012bf0: 206e 6f74 2063 726f 7373 6564 2079 6574   not crossed yet
+00012c00: 2061 6e64 2069 7320 6265 6c6f 7720 7468   and is below th
+00012c10: 6520 7a65 726f 206c 696e 6520 616e 6420  e zero line and 
+00012c20: 7765 2776 6520 6e6f 7420 7265 6163 6865  we've not reache
+00012c30: 6420 7468 6520 6c61 7374 2070 6f69 6e74  d the last point
+00012c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012c50: 2020 2020 2069 6e64 6578 202d 3d20 310a       index -= 1.
+00012c60: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00012c70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012c80: 2020 7768 696c 6528 2864 6966 665f 6466    while((diff_df
+00012c90: 5b22 6469 6666 225d 5b69 6e64 6578 2d31  ["diff"][index-1
+00012ca0: 5d20 3e3d 2030 2061 6e64 2069 6e64 6578  ] >= 0 and index
+00012cb0: 203e 3d30 2929 3a20 2320 616e 6420 6469   >=0)): # and di
+00012cc0: 6666 5f64 662e 696e 6465 7820 3c3d 2062  ff_df.index <= b
+00012cd0: 726f 6b65 7253 7172 4f66 6674 696d 6529  rokerSqrOfftime)
+00012ce0: 3a20 2320 6f72 2064 6966 665f 6466 5b22  : # or diff_df["
+00012cf0: 7273 6922 5d5b 696e 6465 782d 315d 203c  rsi"][index-1] <
+00012d00: 3d20 6d69 6e52 5349 293a 0a20 2020 2020  = minRSI):.     
+00012d10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00012d20: 204c 6f6f 7020 756e 7469 6c20 7369 676e   Loop until sign
+00012d30: 616c 206c 696e 6520 6861 7320 6e6f 7420  al line has not 
+00012d40: 6372 6f73 7365 6420 7965 7420 616e 6420  crossed yet and 
+00012d50: 6973 2061 626f 7665 2074 6865 207a 6572  is above the zer
+00012d60: 6f20 6c69 6e65 0a20 2020 2020 2020 2020  o line.         
+00012d70: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00012d80: 202d 3d20 310a 2020 2020 2020 2020 2020   -= 1.          
+00012d90: 2020 6372 6f73 734f 7665 7220 2b3d 2031    crossOver += 1
+00012da0: 0a20 2020 2020 2020 2074 7320 3d20 6469  .        ts = di
+00012db0: 6666 5f64 662e 7461 696c 286c 656e 2864  ff_df.tail(len(d
+00012dc0: 6966 665f 6466 292d 696e 6465 7820 2b31  iff_df)-index +1
+00012dd0: 292e 6865 6164 2831 292e 696e 6465 785b  ).head(1).index[
+00012de0: 2d31 5d0a 2020 2020 2020 2020 7265 7475  -1].        retu
+00012df0: 726e 2074 732c 2064 6174 615b 6461 7461  rn ts, data[data
+00012e00: 2e69 6e64 6578 203d 3d20 7473 5d20 2364  .index == ts] #d
+00012e10: 662e 6865 6164 286c 656e 2864 6629 202d  f.head(len(df) -
+00012e20: 696e 6465 7820 2b31 292e 7461 696c 2831  index +1).tail(1
+00012e30: 290a 2020 2020 0a20 2020 2023 2046 696e  ).    .    # Fin
+00012e40: 6420 7374 6f63 6b20 7368 6f77 696e 6720  d stock showing 
+00012e50: 5253 4920 6372 6f73 7369 6e67 2077 6974  RSI crossing wit
+00012e60: 6820 5253 4920 3920 534d 410a 2020 2020  h RSI 9 SMA.    
+00012e70: 6465 6620 6669 6e64 5253 4943 726f 7373  def findRSICross
+00012e80: 696e 674d 4128 7365 6c66 2c20 6466 2c20  ingMA(self, df, 
+00012e90: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+00012ea0: 4469 6374 2c6c 6f6f 6b46 6f72 3d31 2c20  Dict,lookFor=1, 
+00012eb0: 6d61 4c65 6e67 7468 3d39 2c20 7273 694b  maLength=9, rsiK
+00012ec0: 6579 3d22 5253 4922 293a 0a20 2020 2020  ey="RSI"):.     
+00012ed0: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+00012ee0: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+00012ef0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012f00: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00012f10: 2020 2069 6620 7273 694b 6579 206e 6f74     if rsiKey not
+00012f20: 2069 6e20 6466 2e63 6f6c 756d 6e73 3a0a   in df.columns:.
+00012f30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012f40: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00012f50: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00012f60: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+00012f70: 2064 6174 615b 3a3a 2d31 5d0a 2020 2020   data[::-1].    
+00012f80: 2020 2020 6d61 5273 6920 3d20 706b 7461      maRsi = pkta
+00012f90: 6c69 622e 4d41 2864 6174 615b 7273 694b  lib.MA(data[rsiK
+00012fa0: 6579 5d2c 2074 696d 6570 6572 696f 643d  ey], timeperiod=
+00012fb0: 6d61 4c65 6e67 7468 290a 2020 2020 2020  maLength).      
+00012fc0: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
+00012fd0: 2d31 5d2e 6865 6164 2833 290a 2020 2020  -1].head(3).    
+00012fe0: 2020 2020 6d61 5273 6920 3d20 6d61 5273      maRsi = maRs
+00012ff0: 695b 3a3a 2d31 5d2e 6865 6164 2833 290a  i[::-1].head(3).
+00013000: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
+00013010: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
+00013020: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
+00013030: 6e44 6963 742c 7361 7665 4469 6374 2c22  nDict,saveDict,"
+00013040: 5472 656e 6422 290a 2020 2020 2020 2020  Trend").        
+00013050: 6966 206c 6f6f 6b46 6f72 2069 6e20 5b31  if lookFor in [1
+00013060: 2c33 5d20 616e 6420 6d61 5273 692e 696c  ,3] and maRsi.il
+00013070: 6f63 5b30 5d20 3c3d 2064 6174 615b 7273  oc[0] <= data[rs
+00013080: 694b 6579 5d2e 696c 6f63 5b30 5d20 616e  iKey].iloc[0] an
+00013090: 6420 6d61 5273 692e 696c 6f63 5b31 5d20  d maRsi.iloc[1] 
+000130a0: 3e20 6461 7461 5b72 7369 4b65 795d 2e69  > data[rsiKey].i
+000130b0: 6c6f 635b 315d 3a0a 2020 2020 2020 2020  loc[1]:.        
+000130c0: 2020 2020 7363 7265 656e 4469 6374 5b27      screenDict['
+000130d0: 4d41 2d53 6967 6e61 6c27 5d20 3d20 7361  MA-Signal'] = sa
+000130e0: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+000130f0: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+00013100: 6578 742e 4752 4545 4e20 2b20 6627 5253  ext.GREEN + f'RS
+00013110: 492d 4d41 2d42 7579 2720 2b20 636f 6c6f  I-MA-Buy' + colo
+00013120: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00013130: 2020 2020 2020 7361 7665 4469 6374 5b27        saveDict['
+00013140: 4d41 2d53 6967 6e61 6c27 5d20 3d20 7361  MA-Signal'] = sa
+00013150: 7665 645b 315d 202b 2066 2752 5349 2d4d  ved[1] + f'RSI-M
+00013160: 412d 4275 7927 0a20 2020 2020 2020 2020  A-Buy'.         
+00013170: 2020 2072 6574 7572 6e20 5472 7565 2069     return True i
+00013180: 6620 2872 7369 4b65 7920 3d3d 2022 5253  f (rsiKey == "RS
+00013190: 4969 2229 2065 6c73 6520 2873 656c 662e  Ii") else (self.
+000131a0: 6669 6e64 5253 4943 726f 7373 696e 674d  findRSICrossingM
+000131b0: 4128 6466 2c20 7363 7265 656e 4469 6374  A(df, screenDict
+000131c0: 2c20 7361 7665 4469 6374 2c6c 6f6f 6b46  , saveDict,lookF
+000131d0: 6f72 3d6c 6f6f 6b46 6f72 2c20 6d61 4c65  or=lookFor, maLe
+000131e0: 6e67 7468 3d6d 614c 656e 6774 682c 2072  ngth=maLength, r
+000131f0: 7369 4b65 793d 2252 5349 6922 2920 6f72  siKey="RSIi") or
+00013200: 2054 7275 6529 0a20 2020 2020 2020 2065   True).        e
+00013210: 6c69 6620 6c6f 6f6b 466f 7220 696e 205b  lif lookFor in [
+00013220: 322c 335d 2061 6e64 206d 6152 7369 2e69  2,3] and maRsi.i
+00013230: 6c6f 635b 305d 203e 3d20 6461 7461 5b72  loc[0] >= data[r
+00013240: 7369 4b65 795d 2e69 6c6f 635b 305d 2061  siKey].iloc[0] a
+00013250: 6e64 206d 6152 7369 2e69 6c6f 635b 315d  nd maRsi.iloc[1]
+00013260: 203c 2064 6174 615b 7273 694b 6579 5d2e   < data[rsiKey].
+00013270: 696c 6f63 5b31 5d3a 0a20 2020 2020 2020  iloc[1]:.       
+00013280: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00013290: 274d 412d 5369 676e 616c 275d 203d 2073  'MA-Signal'] = s
+000132a0: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
+000132b0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
+000132c0: 5465 7874 2e46 4149 4c20 2b20 6627 5253  Text.FAIL + f'RS
+000132d0: 492d 4d41 2d53 656c 6c27 202b 2063 6f6c  I-MA-Sell' + col
+000132e0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+000132f0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00013300: 274d 412d 5369 676e 616c 275d 203d 2073  'MA-Signal'] = s
+00013310: 6176 6564 5b31 5d20 2b20 6627 5253 492d  aved[1] + f'RSI-
+00013320: 4d41 2d53 656c 6c27 0a20 2020 2020 2020  MA-Sell'.       
+00013330: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00013340: 2069 6620 2872 7369 4b65 7920 3d3d 2022   if (rsiKey == "
+00013350: 5253 4969 2229 2065 6c73 6520 2873 656c  RSIi") else (sel
+00013360: 662e 6669 6e64 5253 4943 726f 7373 696e  f.findRSICrossin
+00013370: 674d 4128 6466 2c20 7363 7265 656e 4469  gMA(df, screenDi
+00013380: 6374 2c20 7361 7665 4469 6374 2c6c 6f6f  ct, saveDict,loo
+00013390: 6b46 6f72 3d6c 6f6f 6b46 6f72 2c20 6d61  kFor=lookFor, ma
+000133a0: 4c65 6e67 7468 3d6d 614c 656e 6774 682c  Length=maLength,
+000133b0: 2072 7369 4b65 793d 2252 5349 6922 2920   rsiKey="RSIi") 
+000133c0: 6f72 2054 7275 6529 0a20 2020 2020 2020  or True).       
+000133d0: 2072 6574 7572 6e20 4661 6c73 6520 6966   return False if
+000133e0: 2028 7273 694b 6579 203d 3d20 2252 5349   (rsiKey == "RSI
+000133f0: 6922 2920 656c 7365 2028 7365 6c66 2e66  i") else (self.f
+00013400: 696e 6452 5349 4372 6f73 7369 6e67 4d41  indRSICrossingMA
+00013410: 2864 662c 2073 6372 6565 6e44 6963 742c  (df, screenDict,
+00013420: 2073 6176 6544 6963 742c 6c6f 6f6b 466f   saveDict,lookFo
+00013430: 723d 6c6f 6f6b 466f 722c 206d 614c 656e  r=lookFor, maLen
+00013440: 6774 683d 6d61 4c65 6e67 7468 2c20 7273  gth=maLength, rs
+00013450: 694b 6579 3d22 5253 4969 2229 290a 2020  iKey="RSIi")).  
+00013460: 2020 0a20 2020 2023 2046 696e 6420 7374    .    # Find st
+00013470: 6f63 6b73 2077 6974 6820 7269 7369 6e67  ocks with rising
+00013480: 2052 5349 2066 726f 6d20 6c6f 7765 7220   RSI from lower 
+00013490: 6c65 7665 6c73 0a20 2020 2064 6566 2066  levels.    def f
+000134a0: 696e 6452 6973 696e 6752 5349 2873 656c  indRisingRSI(sel
+000134b0: 662c 2064 662c 2072 7369 4b65 793d 2252  f, df, rsiKey="R
+000134c0: 5349 2229 3a0a 2020 2020 2020 2020 6966  SI"):.        if
+000134d0: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+000134e0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+000134f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013500: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00013510: 2072 7369 4b65 7920 6e6f 7420 696e 2064   rsiKey not in d
+00013520: 662e 636f 6c75 6d6e 733a 0a20 2020 2020  f.columns:.     
+00013530: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00013540: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
+00013550: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+00013560: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+00013570: 5b3a 3a2d 315d 0a20 2020 2020 2020 2064  [::-1].        d
+00013580: 6174 6120 3d20 6461 7461 2e74 6169 6c28  ata = data.tail(
+00013590: 3329 0a20 2020 2020 2020 2069 6620 6c65  3).        if le
+000135a0: 6e28 6461 7461 2920 3c20 333a 0a20 2020  n(data) < 3:.   
+000135b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000135c0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+000135d0: 794d 696e 7573 3252 5349 203d 2064 6174  yMinus2RSI = dat
+000135e0: 615b 2252 5349 225d 2e69 6c6f 635b 305d  a["RSI"].iloc[0]
+000135f0: 0a20 2020 2020 2020 2064 6179 4d69 6e75  .        dayMinu
+00013600: 7331 5253 4920 3d20 6461 7461 5b22 5253  s1RSI = data["RS
+00013610: 4922 5d2e 696c 6f63 5b31 5d0a 2020 2020  I"].iloc[1].    
+00013620: 2020 2020 6461 7952 5349 203d 2064 6174      dayRSI = dat
+00013630: 615b 2252 5349 225d 2e69 6c6f 635b 325d  a["RSI"].iloc[2]
+00013640: 0a20 2020 2020 2020 2072 6574 7572 6e56  .        returnV
+00013650: 616c 7565 203d 2028 6461 794d 696e 7573  alue = (dayMinus
+00013660: 3252 5349 203c 3d20 3335 2061 6e64 2064  2RSI <= 35 and d
+00013670: 6179 4d69 6e75 7331 5253 4920 3e20 6461  ayMinus1RSI > da
+00013680: 794d 696e 7573 3252 5349 2061 6e64 2064  yMinus2RSI and d
+00013690: 6179 5253 4920 3e20 6461 794d 696e 7573  ayRSI > dayMinus
+000136a0: 3152 5349 2920 6f72 205c 0a20 2020 2020  1RSI) or \.     
+000136b0: 2020 2020 2020 2020 2020 2028 6461 794d             (dayM
+000136c0: 696e 7573 3152 5349 203c 3d20 3335 2061  inus1RSI <= 35 a
+000136d0: 6e64 2064 6179 5253 4920 3e20 6461 794d  nd dayRSI > dayM
+000136e0: 696e 7573 3152 5349 290a 2020 2020 2020  inus1RSI).      
+000136f0: 2020 6966 2072 7369 4b65 7920 3d3d 2022    if rsiKey == "
+00013700: 5253 4922 3a0a 2020 2020 2020 2020 2020  RSI":.          
+00013710: 2020 7265 7475 726e 5661 6c75 6520 3d20    returnValue = 
+00013720: 7365 6c66 2e66 696e 6452 6973 696e 6752  self.findRisingR
+00013730: 5349 2864 662c 2072 7369 4b65 793d 2252  SI(df, rsiKey="R
+00013740: 5349 6922 2920 6f72 2072 6574 7572 6e56  SIi") or returnV
+00013750: 616c 7565 0a20 2020 2020 2020 2072 6574  alue.        ret
+00013760: 7572 6e20 7265 7475 726e 5661 6c75 650a  urn returnValue.
+00013770: 0a20 2020 2023 406d 6561 7375 7265 5f74  .    #@measure_t
+00013780: 696d 650a 2020 2020 2320 4669 6e64 206f  ime.    # Find o
+00013790: 7574 2074 7265 6e64 2066 6f72 2064 6179  ut trend for day
+000137a0: 7320 746f 206c 6f6f 6b62 6163 6b0a 2020  s to lookback.  
+000137b0: 2020 6465 6620 6669 6e64 5472 656e 6428    def findTrend(
+000137c0: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+000137d0: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+000137e0: 6461 7973 546f 4c6f 6f6b 6261 636b 3d4e  daysToLookback=N
+000137f0: 6f6e 652c 2073 746f 636b 4e61 6d65 3d22  one, stockName="
+00013800: 2229 3a0a 2020 2020 2020 2020 6966 2064  "):.        if d
+00013810: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
+00013820: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
+00013830: 2020 2020 2020 2072 6574 7572 6e20 2255         return "U
+00013840: 6e6b 6e6f 776e 220a 2020 2020 2020 2020  nknown".        
+00013850: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+00013860: 0a20 2020 2020 2020 2069 6620 6461 7973  .        if days
+00013870: 546f 4c6f 6f6b 6261 636b 2069 7320 4e6f  ToLookback is No
+00013880: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00013890: 6461 7973 546f 4c6f 6f6b 6261 636b 203d  daysToLookback =
+000138a0: 2073 656c 662e 636f 6e66 6967 4d61 6e61   self.configMana
+000138b0: 6765 722e 6461 7973 546f 4c6f 6f6b 6261  ger.daysToLookba
+000138c0: 636b 0a20 2020 2020 2020 2064 6174 6120  ck.        data 
+000138d0: 3d20 6461 7461 2e68 6561 6428 6461 7973  = data.head(days
+000138e0: 546f 4c6f 6f6b 6261 636b 290a 2020 2020  ToLookback).    
+000138f0: 2020 2020 6461 7461 203d 2064 6174 615b      data = data[
+00013900: 3a3a 2d31 5d0a 2020 2020 2020 2020 6461  ::-1].        da
+00013910: 7461 203d 2064 6174 612e 7365 745f 696e  ta = data.set_in
+00013920: 6465 7828 6e70 2e61 7261 6e67 6528 6c65  dex(np.arange(le
+00013930: 6e28 6461 7461 2929 290a 2020 2020 2020  n(data))).      
+00013940: 2020 6461 7461 203d 2064 6174 612e 6669    data = data.fi
+00013950: 6c6c 6e61 2830 290a 2020 2020 2020 2020  llna(0).        
+00013960: 6461 7461 203d 2064 6174 612e 7265 706c  data = data.repl
+00013970: 6163 6528 5b6e 702e 696e 662c 202d 6e70  ace([np.inf, -np
+00013980: 2e69 6e66 5d2c 2030 290a 2020 2020 2020  .inf], 0).      
+00013990: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
+000139a0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
+000139b0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
+000139c0: 7361 7665 4469 6374 2c22 5472 656e 6422  saveDict,"Trend"
+000139d0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+000139e0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+000139f0: 5375 7070 7265 7373 4f75 7470 7574 2873  SuppressOutput(s
+00013a00: 7570 7072 6573 735f 7374 646f 7574 3d54  uppress_stdout=T
+00013a10: 7275 652c 2073 7570 7072 6573 735f 7374  rue, suppress_st
+00013a20: 6465 7272 3d54 7275 6529 3a0a 2020 2020  derr=True):.    
+00013a30: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00013a40: 5b22 746f 7073 225d 203d 2064 6174 615b  ["tops"] = data[
+00013a50: 2243 6c6f 7365 225d 2e69 6c6f 635b 0a20  "Close"].iloc[. 
+00013a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a70: 2020 206c 6973 7428 0a20 2020 2020 2020     list(.       
+00013a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a90: 2070 6b74 616c 6962 2e61 7267 7265 6c65   pktalib.argrele
+00013aa0: 7874 7265 6d61 280a 2020 2020 2020 2020  xtrema(.        
+00013ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ac0: 2020 2020 6e70 2e61 7272 6179 2864 6174      np.array(dat
+00013ad0: 615b 2243 6c6f 7365 225d 292c 206e 702e  a["Close"]), np.
+00013ae0: 6772 6561 7465 725f 6571 7561 6c2c 206f  greater_equal, o
+00013af0: 7264 6572 3d31 0a20 2020 2020 2020 2020  rder=1.         
+00013b00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00013b10: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00013b20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013b30: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00013b40: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00013b50: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
+00013b60: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00013b70: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+00013b80: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+00013b90: 2030 290a 0a20 2020 2020 2020 2020 2020   0)..           
+00013ba0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00013bb0: 2020 2020 2020 2320 6966 206c 656e 2864        # if len(d
+00013bc0: 6174 6129 203c 2064 6179 7354 6f4c 6f6f  ata) < daysToLoo
+00013bd0: 6b62 6163 6b3a 0a20 2020 2020 2020 2020  kback:.         
+00013be0: 2020 2020 2020 2023 2020 2020 2073 656c         #     sel
+00013bf0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00013c00: 2e64 6562 7567 2864 6174 6129 0a20 2020  .debug(data).   
+00013c10: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00013c20: 2020 2072 6169 7365 2053 746f 636b 4461     raise StockDa
+00013c30: 7461 4e6f 7441 6465 7175 6174 650a 2020  taNotAdequate.  
+00013c40: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00013c50: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
+00013c60: 6528 6e70 2e69 6e66 2c20 6e70 2e6e 616e  e(np.inf, np.nan
+00013c70: 292e 7265 706c 6163 6528 2d6e 702e 696e  ).replace(-np.in
+00013c80: 662c 206e 702e 6e61 6e29 2e64 726f 706e  f, np.nan).dropn
+00013c90: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
+00013ca0: 2020 2020 6966 206c 656e 2864 6174 615b      if len(data[
+00013cb0: 2274 6f70 7322 5d5b 6461 7461 2e74 6f70  "tops"][data.top
+00013cc0: 7320 3e20 305d 2920 3e20 313a 0a20 2020  s > 0]) > 1:.   
+00013cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ce0: 2073 6c6f 7065 203d 206e 702e 706f 6c79   slope = np.poly
+00013cf0: 6669 7428 0a20 2020 2020 2020 2020 2020  fit(.           
+00013d00: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00013d10: 612e 696e 6465 785b 6461 7461 2e74 6f70  a.index[data.top
+00013d20: 7320 3e20 305d 2c20 6461 7461 5b22 746f  s > 0], data["to
+00013d30: 7073 225d 5b64 6174 612e 746f 7073 203e  ps"][data.tops >
+00013d40: 2030 5d2c 2031 0a20 2020 2020 2020 2020   0], 1.         
+00013d50: 2020 2020 2020 2020 2020 2029 5b30 5d0a             )[0].
+00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00013d80: 2020 2020 2020 2020 2020 736c 6f70 6520            slope 
+00013d90: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00013da0: 6578 6365 7074 206e 702e 6c69 6e61 6c67  except np.linalg
+00013db0: 2e4c 696e 416c 6745 7272 6f72 2061 7320  .LinAlgError as 
+00013dc0: 653a 2023 2070 7261 676d 613a 206e 6f20  e: # pragma: no 
+00013dd0: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
+00013de0: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+00013df0: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+00013e00: 652c 2065 7863 5f69 6e66 6f3d 5472 7565  e, exc_info=True
+00013e10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013e20: 2020 7363 7265 656e 4469 6374 5b22 5472    screenDict["Tr
+00013e30: 656e 6422 5d20 3d20 280a 2020 2020 2020  end"] = (.      
+00013e40: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00013e50: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+00013e60: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+00013e70: 6578 742e 5741 524e 202b 2022 556e 6b6e  ext.WARN + "Unkn
+00013e80: 6f77 6e22 202b 2063 6f6c 6f72 5465 7874  own" + colorText
+00013e90: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+00013ea0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00013eb0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00013ec0: 2254 7265 6e64 225d 203d 2073 6176 6564  "Trend"] = saved
+00013ed0: 5b31 5d20 2b20 2255 6e6b 6e6f 776e 220a  [1] + "Unknown".
 00013ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ef0: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00013f00: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00013f10: 6c6f 7254 6578 742e 4752 4545 4e20 2b20  lorText.GREEN + 
-00013f20: 2257 6561 6b20 5570 2220 2b20 636f 6c6f  "Weak Up" + colo
-00013f30: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00013f40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00013f50: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00013f60: 4469 6374 5b22 5472 656e 6422 5d20 3d20  Dict["Trend"] = 
-00013f70: 7361 7665 645b 315d 202b 2022 5765 616b  saved[1] + "Weak
-00013f80: 2055 7022 0a20 2020 2020 2020 2020 2020   Up".           
-00013f90: 2065 6c69 6620 616e 676c 6520 3e3d 2036   elif angle >= 6
-00013fa0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00013fb0: 2020 2073 6372 6565 6e44 6963 745b 2254     screenDict["T
-00013fc0: 7265 6e64 225d 203d 2028 0a20 2020 2020  rend"] = (.     
-00013fd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013fe0: 6176 6564 5b30 5d20 2b20 636f 6c6f 7254  aved[0] + colorT
-00013ff0: 6578 742e 424f 4c44 202b 2063 6f6c 6f72  ext.BOLD + color
-00014000: 5465 7874 2e47 5245 454e 202b 2022 5374  Text.GREEN + "St
-00014010: 726f 6e67 2055 7022 202b 2063 6f6c 6f72  rong Up" + color
-00014020: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00014030: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00014040: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00014050: 6963 745b 2254 7265 6e64 225d 203d 2073  ict["Trend"] = s
-00014060: 6176 6564 5b31 5d20 2b20 2253 7472 6f6e  aved[1] + "Stron
-00014070: 6720 5570 220a 2020 2020 2020 2020 2020  g Up".          
-00014080: 2020 656c 6966 2061 6e67 6c65 203c 3d20    elif angle <= 
-00014090: 2d33 3020 616e 6420 616e 676c 6520 3e20  -30 and angle > 
-000140a0: 2d36 313a 0a20 2020 2020 2020 2020 2020  -61:.           
-000140b0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-000140c0: 2254 7265 6e64 225d 203d 2028 0a20 2020  "Trend"] = (.   
-000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140e0: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
-000140f0: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
-00014100: 6f72 5465 7874 2e46 4149 4c20 2b20 2257  orText.FAIL + "W
-00014110: 6561 6b20 446f 776e 2220 2b20 636f 6c6f  eak Down" + colo
-00014120: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00014130: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00014140: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00014150: 4469 6374 5b22 5472 656e 6422 5d20 3d20  Dict["Trend"] = 
-00014160: 7361 7665 645b 315d 202b 2022 5765 616b  saved[1] + "Weak
-00014170: 2044 6f77 6e22 0a20 2020 2020 2020 2020   Down".         
-00014180: 2020 2065 6c69 6620 616e 676c 6520 3c20     elif angle < 
-00014190: 2d36 303a 0a20 2020 2020 2020 2020 2020  -60:.           
-000141a0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-000141b0: 2254 7265 6e64 225d 203d 2028 0a20 2020  "Trend"] = (.   
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141d0: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
-000141e0: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
-000141f0: 6f72 5465 7874 2e46 4149 4c20 2b20 2253  orText.FAIL + "S
-00014200: 7472 6f6e 6720 446f 776e 2220 2b20 636f  trong Down" + co
-00014210: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-00014220: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00014230: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00014240: 7665 4469 6374 5b22 5472 656e 6422 5d20  veDict["Trend"] 
-00014250: 3d20 7361 7665 645b 315d 202b 2022 5374  = saved[1] + "St
-00014260: 726f 6e67 2044 6f77 6e22 0a20 2020 2020  rong Down".     
-00014270: 2020 2065 7863 6570 7420 6e70 2e6c 696e     except np.lin
-00014280: 616c 672e 4c69 6e41 6c67 4572 726f 7220  alg.LinAlgError 
-00014290: 6173 2065 3a20 2320 7072 6167 6d61 3a20  as e: # pragma: 
-000142a0: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
-000142b0: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-000142c0: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
-000142d0: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
-000142e0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
-000142f0: 6565 6e44 6963 745b 2254 7265 6e64 225d  eenDict["Trend"]
-00014300: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00014310: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-00014320: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-00014330: 2063 6f6c 6f72 5465 7874 2e57 4152 4e20   colorText.WARN 
-00014340: 2b20 2255 6e6b 6e6f 776e 2220 2b20 636f  + "Unknown" + co
-00014350: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
-00014360: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00014370: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00014380: 5472 656e 6422 5d20 3d20 7361 7665 645b  Trend"] = saved[
-00014390: 315d 202b 2022 556e 6b6e 6f77 6e22 0a20  1] + "Unknown". 
-000143a0: 2020 2020 2020 2072 6574 7572 6e20 7361         return sa
-000143b0: 7665 4469 6374 5b22 5472 656e 6422 5d0a  veDict["Trend"].
-000143c0: 0a20 2020 2023 2046 696e 6420 7374 6f63  .    # Find stoc
-000143d0: 6b73 2061 7070 726f 6368 696e 6720 746f  ks approching to
-000143e0: 206c 6f6e 6720 7465 726d 2074 7265 6e64   long term trend
-000143f0: 6c69 6e65 730a 2020 2020 6465 6620 6669  lines.    def fi
-00014400: 6e64 5472 656e 646c 696e 6573 2873 656c  ndTrendlines(sel
-00014410: 662c 2064 662c 2073 6372 6565 6e44 6963  f, df, screenDic
-00014420: 742c 2073 6176 6544 6963 742c 2070 6572  t, saveDict, per
-00014430: 6365 6e74 6167 653d 302e 3035 293a 0a20  centage=0.05):. 
-00014440: 2020 2020 2020 2023 2070 6572 696f 6420         # period 
-00014450: 3d20 696e 7428 2222 2e6a 6f69 6e28 6320  = int("".join(c 
-00014460: 666f 7220 6320 696e 2073 656c 662e 636f  for c in self.co
-00014470: 6e66 6967 4d61 6e61 6765 722e 7065 7269  nfigManager.peri
-00014480: 6f64 2069 6620 632e 6973 6469 6769 7428  od if c.isdigit(
-00014490: 2929 290a 2020 2020 2020 2020 2320 6966  ))).        # if
-000144a0: 206c 656e 2864 6174 6129 203c 2070 6572   len(data) < per
-000144b0: 696f 643a 0a20 2020 2020 2020 2023 2020  iod:.        #  
-000144c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-000144d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-000144e0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-000144f0: 2064 6174 6120 3d20 6461 7461 5b3a 3a2d   data = data[::-
-00014500: 315d 0a20 2020 2020 2020 2064 6174 615b  1].        data[
-00014510: 224e 756d 6265 7222 5d20 3d20 6e70 2e61  "Number"] = np.a
-00014520: 7261 6e67 6528 6c65 6e28 6461 7461 2929  range(len(data))
-00014530: 202b 2031 0a20 2020 2020 2020 2064 6174   + 1.        dat
-00014540: 615f 6c6f 7720 3d20 6461 7461 2e63 6f70  a_low = data.cop
-00014550: 7928 290a 2020 2020 2020 2020 706f 696e  y().        poin
-00014560: 7473 203d 2033 300a 0a20 2020 2020 2020  ts = 30..       
-00014570: 2022 2222 2049 676e 6f72 696e 6720 7468   """ Ignoring th
-00014580: 6520 5265 7369 7461 6e63 6520 666f 7220  e Resitance for 
-00014590: 6c6f 6e67 2d74 6572 6d20 7075 7270 6f73  long-term purpos
-000145a0: 650a 2020 2020 2020 2020 7768 696c 6520  e.        while 
-000145b0: 6c65 6e28 6461 7461 5f68 6967 6829 203e  len(data_high) >
-000145c0: 2070 6f69 6e74 733a 0a20 2020 2020 2020   points:.       
-000145d0: 2020 2020 2073 6c6f 7065 2c20 696e 7465       slope, inte
-000145e0: 7263 6570 742c 2072 5f76 616c 7565 2c20  rcept, r_value, 
-000145f0: 705f 7661 6c75 652c 2073 7464 5f65 7272  p_value, std_err
-00014600: 203d 206c 696e 7265 6772 6573 7328 783d   = linregress(x=
-00014610: 6461 7461 5f68 6967 685b 274e 756d 6265  data_high['Numbe
-00014620: 7227 5d2c 2079 3d64 6174 615f 6869 6768  r'], y=data_high
-00014630: 5b27 4869 6768 275d 290a 2020 2020 2020  ['High']).      
-00014640: 2020 2020 2020 6461 7461 5f68 6967 6820        data_high 
-00014650: 3d20 6461 7461 5f68 6967 682e 6c6f 635b  = data_high.loc[
-00014660: 6461 7461 5f68 6967 685b 2748 6967 6827  data_high['High'
-00014670: 5d20 3e20 736c 6f70 6520 2a20 6461 7461  ] > slope * data
-00014680: 5f68 6967 685b 274e 756d 6265 7227 5d20  _high['Number'] 
-00014690: 2b20 696e 7465 7263 6570 745d 0a20 2020  + intercept].   
-000146a0: 2020 2020 2073 6c6f 7065 2c20 696e 7465       slope, inte
-000146b0: 7263 6570 742c 2072 5f76 616c 7565 2c20  rcept, r_value, 
-000146c0: 705f 7661 6c75 652c 2073 7464 5f65 7272  p_value, std_err
-000146d0: 203d 206c 696e 7265 6772 6573 7328 783d   = linregress(x=
-000146e0: 6461 7461 5f68 6967 685b 274e 756d 6265  data_high['Numbe
-000146f0: 7227 5d2c 2079 3d64 6174 615f 6869 6768  r'], y=data_high
-00014700: 5b27 436c 6f73 6527 5d29 0a20 2020 2020  ['Close']).     
-00014710: 2020 2064 6174 615b 2752 6573 6973 7461     data['Resista
-00014720: 6e63 6527 5d20 3d20 736c 6f70 6520 2a20  nce'] = slope * 
-00014730: 6461 7461 5b27 4e75 6d62 6572 275d 202b  data['Number'] +
-00014740: 2069 6e74 6572 6365 7074 0a20 2020 2020   intercept.     
-00014750: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00014760: 7768 696c 6520 6c65 6e28 6461 7461 5f6c  while len(data_l
-00014770: 6f77 2920 3e20 706f 696e 7473 3a0a 2020  ow) > points:.  
-00014780: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00014790: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000147a0: 6c6f 7065 2c20 696e 7465 7263 6570 742c  lope, intercept,
-000147b0: 2072 5f76 616c 7565 2c20 705f 7661 6c75   r_value, p_valu
-000147c0: 652c 2073 7464 5f65 7272 203d 206c 696e  e, std_err = lin
-000147d0: 7265 6772 6573 7328 0a20 2020 2020 2020  regress(.       
-000147e0: 2020 2020 2020 2020 2020 2020 2078 3d64               x=d
-000147f0: 6174 615f 6c6f 775b 224e 756d 6265 7222  ata_low["Number"
-00014800: 5d2c 2079 3d64 6174 615f 6c6f 775b 224c  ], y=data_low["L
-00014810: 6f77 225d 0a20 2020 2020 2020 2020 2020  ow"].           
-00014820: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00014830: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00014840: 696f 6e20 6173 2065 3a20 2023 2070 7261  ion as e:  # pra
-00014850: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
-00014860: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00014870: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
-00014880: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
-00014890: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
-000148a0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000148b0: 7565 0a20 2020 2020 2020 2020 2020 2064  ue.            d
-000148c0: 6174 615f 6c6f 7720 3d20 6461 7461 5f6c  ata_low = data_l
-000148d0: 6f77 2e6c 6f63 5b0a 2020 2020 2020 2020  ow.loc[.        
-000148e0: 2020 2020 2020 2020 6461 7461 5f6c 6f77          data_low
-000148f0: 5b22 4c6f 7722 5d20 3c20 736c 6f70 6520  ["Low"] < slope 
-00014900: 2a20 6461 7461 5f6c 6f77 5b22 4e75 6d62  * data_low["Numb
-00014910: 6572 225d 202b 2069 6e74 6572 6365 7074  er"] + intercept
-00014920: 0a20 2020 2020 2020 2020 2020 205d 0a0a  .            ]..
-00014930: 2020 2020 2020 2020 736c 6f70 652c 2069          slope, i
-00014940: 6e74 6572 6365 7074 2c20 725f 7661 6c75  ntercept, r_valu
-00014950: 652c 2070 5f76 616c 7565 2c20 7374 645f  e, p_value, std_
-00014960: 6572 7220 3d20 6c69 6e72 6567 7265 7373  err = linregress
-00014970: 280a 2020 2020 2020 2020 2020 2020 783d  (.            x=
-00014980: 6461 7461 5f6c 6f77 5b22 4e75 6d62 6572  data_low["Number
-00014990: 225d 2c20 793d 6461 7461 5f6c 6f77 5b22  "], y=data_low["
-000149a0: 436c 6f73 6522 5d0a 2020 2020 2020 2020  Close"].        
-000149b0: 290a 2020 2020 2020 2020 6461 7461 5b22  ).        data["
-000149c0: 5375 7070 6f72 7422 5d20 3d20 736c 6f70  Support"] = slop
-000149d0: 6520 2a20 6461 7461 5b22 4e75 6d62 6572  e * data["Number
-000149e0: 225d 202b 2069 6e74 6572 6365 7074 0a20  "] + intercept. 
-000149f0: 2020 2020 2020 206e 6f77 203d 2064 6174         now = dat
-00014a00: 612e 7461 696c 2831 290a 0a20 2020 2020  a.tail(1)..     
-00014a10: 2020 206c 696d 6974 5f75 7070 6572 203d     limit_upper =
-00014a20: 206e 6f77 5b22 5375 7070 6f72 7422 5d2e   now["Support"].
-00014a30: 696c 6f63 5b30 5d20 2b20 286e 6f77 5b22  iloc[0] + (now["
-00014a40: 5375 7070 6f72 7422 5d2e 696c 6f63 5b30  Support"].iloc[0
-00014a50: 5d20 2a20 7065 7263 656e 7461 6765 290a  ] * percentage).
-00014a60: 2020 2020 2020 2020 6c69 6d69 745f 6c6f          limit_lo
-00014a70: 7765 7220 3d20 6e6f 775b 2253 7570 706f  wer = now["Suppo
-00014a80: 7274 225d 2e69 6c6f 635b 305d 202d 2028  rt"].iloc[0] - (
-00014a90: 6e6f 775b 2253 7570 706f 7274 225d 2e69  now["Support"].i
-00014aa0: 6c6f 635b 305d 202a 2070 6572 6365 6e74  loc[0] * percent
-00014ab0: 6167 6529 0a20 2020 2020 2020 2073 6176  age).        sav
-00014ac0: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
-00014ad0: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
-00014ae0: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
-00014af0: 4469 6374 2c20 2250 6174 7465 726e 2229  Dict, "Pattern")
-00014b00: 0a20 2020 2020 2020 2069 6620 6c69 6d69  .        if limi
-00014b10: 745f 6c6f 7765 7220 3c20 6e6f 775b 2243  t_lower < now["C
-00014b20: 6c6f 7365 225d 2e69 6c6f 635b 305d 203c  lose"].iloc[0] <
-00014b30: 206c 696d 6974 5f75 7070 6572 2061 6e64   limit_upper and
-00014b40: 2073 6c6f 7065 203e 2030 2e31 353a 0a20   slope > 0.15:. 
-00014b50: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00014b60: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
-00014b70: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00014b80: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-00014b90: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-00014ba0: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-00014bb0: 202b 2022 5472 656e 646c 696e 652d 5375   + "Trendline-Su
-00014bc0: 7070 6f72 7422 202b 2063 6f6c 6f72 5465  pport" + colorTe
-00014bd0: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-00014be0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00014bf0: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
-00014c00: 726e 225d 203d 2073 6176 6564 5b31 5d20  rn"] = saved[1] 
-00014c10: 2b20 2254 7265 6e64 6c69 6e65 2d53 7570  + "Trendline-Sup
-00014c20: 706f 7274 220a 2020 2020 2020 2020 2020  port".          
-00014c30: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-00014c40: 2020 2020 2020 2022 2222 2050 6c6f 7473         """ Plots
-00014c50: 2066 6f72 2064 6562 7567 6769 6e67 0a20   for debugging. 
-00014c60: 2020 2020 2020 2069 6d70 6f72 7420 6d61         import ma
-00014c70: 7470 6c6f 746c 6962 2e70 7970 6c6f 7420  tplotlib.pyplot 
-00014c80: 6173 2070 6c74 0a20 2020 2020 2020 2066  as plt.        f
-00014c90: 6967 2c20 6178 3120 3d20 706c 742e 7375  ig, ax1 = plt.su
-00014ca0: 6270 6c6f 7473 2866 6967 7369 7a65 3d28  bplots(figsize=(
-00014cb0: 3135 2c31 3029 290a 2020 2020 2020 2020  15,10)).        
-00014cc0: 636f 6c6f 7220 3d20 2774 6162 3a67 7265  color = 'tab:gre
-00014cd0: 656e 270a 2020 2020 2020 2020 7864 6174  en'.        xdat
-00014ce0: 6520 3d20 5b78 2e64 6174 6528 2920 666f  e = [x.date() fo
-00014cf0: 7220 7820 696e 2064 6174 612e 696e 6465  r x in data.inde
-00014d00: 785d 0a20 2020 2020 2020 2061 7831 2e73  x].        ax1.s
-00014d10: 6574 5f78 6c61 6265 6c28 2744 6174 6527  et_xlabel('Date'
-00014d20: 2c20 636f 6c6f 723d 636f 6c6f 7229 0a20  , color=color). 
-00014d30: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
-00014d40: 7864 6174 652c 2064 6174 612e 436c 6f73  xdate, data.Clos
-00014d50: 652c 206c 6162 656c 3d22 636c 6f73 6522  e, label="close"
-00014d60: 2c20 636f 6c6f 723d 636f 6c6f 7229 0a20  , color=color). 
-00014d70: 2020 2020 2020 2061 7831 2e74 6963 6b5f         ax1.tick_
-00014d80: 7061 7261 6d73 2861 7869 733d 2778 272c  params(axis='x',
-00014d90: 206c 6162 656c 636f 6c6f 723d 636f 6c6f   labelcolor=colo
-00014da0: 7229 0a0a 2020 2020 2020 2020 6178 3220  r)..        ax2 
-00014db0: 3d20 6178 312e 7477 696e 7928 2920 2320  = ax1.twiny() # 
-00014dc0: 6178 3220 616e 6420 6178 3120 7769 6c6c  ax2 and ax1 will
-00014dd0: 2068 6176 6520 636f 6d6d 6f6e 2079 2061   have common y a
-00014de0: 7869 7320 616e 6420 6469 6666 6572 656e  xis and differen
-00014df0: 7420 7820 6178 6973 2c20 7477 696e 790a  t x axis, twiny.
-00014e00: 2020 2020 2020 2020 6178 322e 706c 6f74          ax2.plot
-00014e10: 2864 6174 612e 4e75 6d62 6572 2c20 6461  (data.Number, da
-00014e20: 7461 2e52 6573 6973 7461 6e63 652c 206c  ta.Resistance, l
-00014e30: 6162 656c 3d22 5265 7322 290a 2020 2020  abel="Res").    
-00014e40: 2020 2020 6178 322e 706c 6f74 2864 6174      ax2.plot(dat
-00014e50: 612e 4e75 6d62 6572 2c20 6461 7461 2e53  a.Number, data.S
-00014e60: 7570 706f 7274 2c20 6c61 6265 6c3d 2253  upport, label="S
-00014e70: 7570 2229 0a0a 2020 2020 2020 2020 706c  up")..        pl
-00014e80: 742e 6c65 6765 6e64 2829 0a20 2020 2020  t.legend().     
-00014e90: 2020 2070 6c74 2e67 7269 6428 290a 2020     plt.grid().  
-00014ea0: 2020 2020 2020 706c 742e 7368 6f77 2829        plt.show()
-00014eb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014ec0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00014ed0: 650a 0a20 2020 2023 2040 6d65 6173 7572  e..    # @measur
-00014ee0: 655f 7469 6d65 0a20 2020 2064 6566 2066  e_time.    def f
-00014ef0: 696e 6455 7074 7265 6e64 2873 656c 662c  indUptrend(self,
-00014f00: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
-00014f10: 2073 6176 6544 6963 742c 2074 6573 7469   saveDict, testi
-00014f20: 6e67 2c20 7374 6f63 6b2c 6f6e 6c79 4d46  ng, stock,onlyMF
-00014f30: 3d46 616c 7365 2c68 6f73 7444 6174 613d  =False,hostData=
-00014f40: 4e6f 6e65 2c65 7863 6861 6e67 654e 616d  None,exchangeNam
-00014f50: 653d 2249 4e44 4941 222c 7265 6672 6573  e="INDIA",refres
-00014f60: 684d 4641 6e64 4656 3d54 7275 6529 3a0a  hMFAndFV=True):.
-00014f70: 2020 2020 2020 2020 2320 7368 6f75 6c64          # should
-00014f80: 5072 6f63 6565 6420 3d20 5472 7565 0a20  Proceed = True. 
-00014f90: 2020 2020 2020 2069 7355 7074 7265 6e64         isUptrend
-00014fa0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00014fb0: 2069 7344 6f77 6e74 7265 6e64 203d 2046   isDowntrend = F
-00014fc0: 616c 7365 0a20 2020 2020 2020 2069 7335  alse.        is5
-00014fd0: 3044 4d41 5570 7472 656e 6420 3d20 4661  0DMAUptrend = Fa
-00014fe0: 6c73 650a 2020 2020 2020 2020 6973 3530  lse.        is50
-00014ff0: 444d 4144 6f77 6e74 7265 6e64 203d 2046  DMADowntrend = F
-00015000: 616c 7365 0a20 2020 2020 2020 2064 6563  alse.        dec
-00015010: 6973 696f 6e20 3d20 2222 0a20 2020 2020  ision = "".     
-00015020: 2020 2064 6d61 3530 6465 6369 7369 6f6e     dma50decision
-00015030: 203d 2022 220a 2020 2020 2020 2020 6661   = "".        fa
-00015040: 6972 5661 6c75 6520 3d20 300a 2020 2020  irValue = 0.    
-00015050: 2020 2020 6661 6972 5661 6c75 6544 6966      fairValueDif
-00015060: 6620 3d20 300a 2020 2020 2020 2020 2320  f = 0.        # 
-00015070: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
-00015080: 206c 656e 2864 6629 203c 2032 3230 206f   len(df) < 220 o
-00015090: 7220 7465 7374 696e 673a 0a20 2020 2020  r testing:.     
-000150a0: 2020 2023 2020 2020 2073 686f 756c 6450     #     shouldP
-000150b0: 726f 6365 6564 203d 2046 616c 7365 0a20  roceed = False. 
-000150c0: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-000150d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000150e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000150f0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00015100: 3d20 6466 2e63 6f70 7928 290a 2020 2020  = df.copy().    
-00015110: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00015120: 203d 2064 6174 615b 3a3a 2d31 5d0a 2020   = data[::-1].  
-00015130: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00015140: 6461 795f 736d 6120 3d20 706b 7461 6c69  day_sma = pktali
-00015150: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
-00015160: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
-00015170: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
-00015180: 2020 2020 736d 615f 6d69 6e75 7339 203d      sma_minus9 =
-00015190: 2070 6b74 616c 6962 2e53 4d41 2864 6174   pktalib.SMA(dat
-000151a0: 612e 6865 6164 286c 656e 2864 6174 6129  a.head(len(data)
-000151b0: 2d39 295b 2243 6c6f 7365 225d 2c20 7469  -9)["Close"], ti
-000151c0: 6d65 7065 7269 6f64 3d35 3029 0a20 2020  meperiod=50).   
-000151d0: 2020 2020 2020 2020 2020 2020 2073 6d61               sma
-000151e0: 5f6d 696e 7573 3134 203d 2070 6b74 616c  _minus14 = pktal
-000151f0: 6962 2e53 4d41 2864 6174 612e 6865 6164  ib.SMA(data.head
-00015200: 286c 656e 2864 6174 6129 2d31 3429 5b22  (len(data)-14)["
-00015210: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-00015220: 696f 643d 3530 290a 2020 2020 2020 2020  iod=50).        
-00015230: 2020 2020 2020 2020 736d 615f 6d69 6e75          sma_minu
-00015240: 7332 3020 3d20 706b 7461 6c69 622e 534d  s20 = pktalib.SM
-00015250: 4128 6461 7461 2e68 6561 6428 6c65 6e28  A(data.head(len(
-00015260: 6461 7461 292d 3230 295b 2243 6c6f 7365  data)-20)["Close
-00015270: 225d 2c20 7469 6d65 7065 7269 6f64 3d35  "], timeperiod=5
-00015280: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00015290: 2020 2074 6f64 6179 5f6c 6d61 203d 2070     today_lma = p
-000152a0: 6b74 616c 6962 2e53 4d41 2864 6174 615b  ktalib.SMA(data[
-000152b0: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
-000152c0: 7269 6f64 3d32 3030 290a 2020 2020 2020  riod=200).      
-000152d0: 2020 2020 2020 2020 2020 6c6d 615f 6d69            lma_mi
-000152e0: 6e75 7332 3020 3d20 706b 7461 6c69 622e  nus20 = pktalib.
-000152f0: 534d 4128 6461 7461 2e68 6561 6428 6c65  SMA(data.head(le
-00015300: 6e28 6461 7461 292d 3230 295b 2243 6c6f  n(data)-20)["Clo
-00015310: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
-00015320: 3d32 3030 290a 2020 2020 2020 2020 2020  =200).          
-00015330: 2020 2020 2020 6c6d 615f 6d69 6e75 7338        lma_minus8
-00015340: 3020 3d20 706b 7461 6c69 622e 534d 4128  0 = pktalib.SMA(
-00015350: 6461 7461 2e68 6561 6428 6c65 6e28 6461  data.head(len(da
-00015360: 7461 292d 3830 295b 2243 6c6f 7365 225d  ta)-80)["Close"]
-00015370: 2c20 7469 6d65 7065 7269 6f64 3d32 3030  , timeperiod=200
-00015380: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015390: 2020 6c6d 615f 6d69 6e75 7331 3030 203d    lma_minus100 =
-000153a0: 2070 6b74 616c 6962 2e53 4d41 2864 6174   pktalib.SMA(dat
-000153b0: 612e 6865 6164 286c 656e 2864 6174 6129  a.head(len(data)
-000153c0: 2d31 3030 295b 2243 6c6f 7365 225d 2c20  -100)["Close"], 
-000153d0: 7469 6d65 7065 7269 6f64 3d32 3030 290a  timeperiod=200).
-000153e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153f0: 746f 6461 795f 6c6d 6120 3d20 746f 6461  today_lma = toda
-00015400: 795f 6c6d 612e 696c 6f63 5b6c 656e 2874  y_lma.iloc[len(t
-00015410: 6f64 6179 5f6c 6d61 292d 315d 2069 6620  oday_lma)-1] if 
-00015420: 746f 6461 795f 6c6d 6120 6973 206e 6f74  today_lma is not
-00015430: 204e 6f6e 6520 656c 7365 2030 0a20 2020   None else 0.   
-00015440: 2020 2020 2020 2020 2020 2020 206c 6d61               lma
-00015450: 5f6d 696e 7573 3230 203d 206c 6d61 5f6d  _minus20 = lma_m
-00015460: 696e 7573 3230 2e69 6c6f 635b 6c65 6e28  inus20.iloc[len(
-00015470: 6c6d 615f 6d69 6e75 7332 3029 2d31 5d20  lma_minus20)-1] 
-00015480: 6966 206c 6d61 5f6d 696e 7573 3230 2069  if lma_minus20 i
-00015490: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-000154a0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-000154b0: 2020 6c6d 615f 6d69 6e75 7338 3020 3d20    lma_minus80 = 
-000154c0: 6c6d 615f 6d69 6e75 7338 302e 696c 6f63  lma_minus80.iloc
-000154d0: 5b6c 656e 286c 6d61 5f6d 696e 7573 3830  [len(lma_minus80
-000154e0: 292d 315d 2069 6620 6c6d 615f 6d69 6e75  )-1] if lma_minu
-000154f0: 7338 3020 6973 206e 6f74 204e 6f6e 6520  s80 is not None 
-00015500: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
-00015510: 2020 2020 2020 206c 6d61 5f6d 696e 7573         lma_minus
-00015520: 3130 3020 3d20 6c6d 615f 6d69 6e75 7331  100 = lma_minus1
-00015530: 3030 2e69 6c6f 635b 6c65 6e28 6c6d 615f  00.iloc[len(lma_
-00015540: 6d69 6e75 7331 3030 292d 315d 2069 6620  minus100)-1] if 
-00015550: 6c6d 615f 6d69 6e75 7331 3030 2069 7320  lma_minus100 is 
-00015560: 6e6f 7420 4e6f 6e65 2065 6c73 6520 300a  not None else 0.
-00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015580: 746f 6461 795f 736d 6120 3d20 746f 6461  today_sma = toda
-00015590: 795f 736d 612e 696c 6f63 5b6c 656e 2874  y_sma.iloc[len(t
-000155a0: 6f64 6179 5f73 6d61 292d 315d 2069 6620  oday_sma)-1] if 
-000155b0: 746f 6461 795f 736d 6120 6973 206e 6f74  today_sma is not
-000155c0: 204e 6f6e 6520 656c 7365 2030 0a20 2020   None else 0.   
-000155d0: 2020 2020 2020 2020 2020 2020 2073 6d61               sma
-000155e0: 5f6d 696e 7573 3920 3d20 736d 615f 6d69  _minus9 = sma_mi
-000155f0: 6e75 7339 2e69 6c6f 635b 6c65 6e28 736d  nus9.iloc[len(sm
-00015600: 615f 6d69 6e75 7339 292d 315d 2069 6620  a_minus9)-1] if 
-00015610: 736d 615f 6d69 6e75 7339 2069 7320 6e6f  sma_minus9 is no
-00015620: 7420 4e6f 6e65 2065 6c73 6520 300a 2020  t None else 0.  
-00015630: 2020 2020 2020 2020 2020 2020 2020 736d                sm
-00015640: 615f 6d69 6e75 7331 3420 3d20 736d 615f  a_minus14 = sma_
-00015650: 6d69 6e75 7331 342e 696c 6f63 5b6c 656e  minus14.iloc[len
-00015660: 2873 6d61 5f6d 696e 7573 3134 292d 315d  (sma_minus14)-1]
-00015670: 2069 6620 736d 615f 6d69 6e75 7331 3420   if sma_minus14 
-00015680: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-00015690: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-000156a0: 2020 2073 6d61 5f6d 696e 7573 3230 203d     sma_minus20 =
-000156b0: 2073 6d61 5f6d 696e 7573 3230 2e69 6c6f   sma_minus20.ilo
-000156c0: 635b 6c65 6e28 736d 615f 6d69 6e75 7332  c[len(sma_minus2
-000156d0: 3029 2d31 5d20 6966 2073 6d61 5f6d 696e  0)-1] if sma_min
-000156e0: 7573 3230 2069 7320 6e6f 7420 4e6f 6e65  us20 is not None
-000156f0: 2065 6c73 6520 300a 2020 2020 2020 2020   else 0.        
-00015700: 2020 2020 2020 2020 6973 5570 7472 656e          isUptren
-00015710: 6420 3d20 2874 6f64 6179 5f6c 6d61 203e  d = (today_lma >
-00015720: 206c 6d61 5f6d 696e 7573 3230 2920 6f72   lma_minus20) or
-00015730: 2028 746f 6461 795f 6c6d 6120 3e20 6c6d   (today_lma > lm
-00015740: 615f 6d69 6e75 7338 3029 206f 7220 2874  a_minus80) or (t
-00015750: 6f64 6179 5f6c 6d61 203e 206c 6d61 5f6d  oday_lma > lma_m
-00015760: 696e 7573 3130 3029 0a20 2020 2020 2020  inus100).       
-00015770: 2020 2020 2020 2020 2069 7344 6f77 6e74           isDownt
-00015780: 7265 6e64 203d 2028 746f 6461 795f 6c6d  rend = (today_lm
-00015790: 6120 3c20 6c6d 615f 6d69 6e75 7332 3029  a < lma_minus20)
-000157a0: 2061 6e64 2028 746f 6461 795f 6c6d 6120   and (today_lma 
-000157b0: 3c20 6c6d 615f 6d69 6e75 7338 3029 2061  < lma_minus80) a
-000157c0: 6e64 2028 746f 6461 795f 6c6d 6120 3c20  nd (today_lma < 
-000157d0: 6c6d 615f 6d69 6e75 7331 3030 290a 2020  lma_minus100).  
-000157e0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-000157f0: 3530 444d 4155 7074 7265 6e64 203d 2028  50DMAUptrend = (
-00015800: 746f 6461 795f 736d 6120 3e20 736d 615f  today_sma > sma_
-00015810: 6d69 6e75 7339 2920 6f72 2028 746f 6461  minus9) or (toda
-00015820: 795f 736d 6120 3e20 736d 615f 6d69 6e75  y_sma > sma_minu
-00015830: 7331 3429 206f 7220 2874 6f64 6179 5f73  s14) or (today_s
-00015840: 6d61 203e 2073 6d61 5f6d 696e 7573 3230  ma > sma_minus20
-00015850: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015860: 2020 6973 3530 444d 4144 6f77 6e74 7265    is50DMADowntre
-00015870: 6e64 203d 2028 746f 6461 795f 736d 6120  nd = (today_sma 
-00015880: 3c20 736d 615f 6d69 6e75 7339 2920 616e  < sma_minus9) an
-00015890: 6420 2874 6f64 6179 5f73 6d61 203c 2073  d (today_sma < s
-000158a0: 6d61 5f6d 696e 7573 3134 2920 616e 6420  ma_minus14) and 
-000158b0: 2874 6f64 6179 5f73 6d61 203c 2073 6d61  (today_sma < sma
-000158c0: 5f6d 696e 7573 3230 290a 2020 2020 2020  _minus20).      
-000158d0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000158e0: 6570 7469 6f6e 3a20 2023 2070 7261 676d  eption:  # pragm
-000158f0: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
-00015900: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-00015910: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
-00015920: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
-00015930: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
-00015940: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00015950: 2020 2020 2020 2064 6563 6973 696f 6e20         decision 
-00015960: 3d20 2754 3ae2 96b2 2720 6966 2069 7355  = 'T:...' if isU
-00015970: 7074 7265 6e64 2065 6c73 6520 2827 543a  ptrend else ('T:
-00015980: e296 bc27 2069 6620 6973 446f 776e 7472  ...' if isDowntr
-00015990: 656e 6420 656c 7365 2027 2729 0a20 2020  end else '').   
-000159a0: 2020 2020 2064 6d61 3530 6465 6369 7369       dma50decisi
-000159b0: 6f6e 203d 2027 743a e296 b227 2069 6620  on = 't:...' if 
-000159c0: 6973 3530 444d 4155 7074 7265 6e64 2065  is50DMAUptrend e
-000159d0: 6c73 6520 2827 743a e296 bc27 2069 6620  lse ('t:...' if 
-000159e0: 6973 3530 444d 4144 6f77 6e74 7265 6e64  is50DMADowntrend
-000159f0: 2065 6c73 6520 2727 290a 2020 2020 2020   else '').      
-00015a00: 2020 6d66 5f69 6e73 745f 6f77 6e65 7273    mf_inst_owners
-00015a10: 6869 7043 6861 6e67 6520 3d20 300a 2020  hipChange = 0.  
-00015a20: 2020 2020 2020 6368 616e 6765 5f6d 696c        change_mil
-00015a30: 6c69 6f6e 7320 3d22 220a 2020 2020 2020  lions ="".      
-00015a40: 2020 6d66 203d 2022 220a 2020 2020 2020    mf = "".      
-00015a50: 2020 6d66 7320 3d20 2222 0a20 2020 2020    mfs = "".     
-00015a60: 2020 2069 6620 7265 6672 6573 684d 4641     if refreshMFA
-00015a70: 6e64 4656 3a0a 2020 2020 2020 2020 2020  ndFV:.          
-00015a80: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00015a90: 2020 2020 2020 206d 665f 696e 7374 5f6f         mf_inst_o
-00015aa0: 776e 6572 7368 6970 4368 616e 6765 203d  wnershipChange =
-00015ab0: 2073 656c 662e 6765 744d 7574 7561 6c46   self.getMutualF
-00015ac0: 756e 6453 7461 7475 7328 7374 6f63 6b2c  undStatus(stock,
-00015ad0: 6f6e 6c79 4d46 3d6f 6e6c 794d 462c 686f  onlyMF=onlyMF,ho
-00015ae0: 7374 4461 7461 3d68 6f73 7444 6174 612c  stData=hostData,
-00015af0: 666f 7263 653d 2868 6f73 7444 6174 6120  force=(hostData 
-00015b00: 6973 204e 6f6e 6520 6f72 2068 6f73 7444  is None or hostD
-00015b10: 6174 612e 656d 7074 7920 6f72 206e 6f74  ata.empty or not
-00015b20: 2028 224d 4622 2069 6e20 686f 7374 4461   ("MF" in hostDa
-00015b30: 7461 2e63 6f6c 756d 6e73 206f 7220 2246  ta.columns or "F
-00015b40: 4949 2220 696e 2068 6f73 7444 6174 612e  II" in hostData.
-00015b50: 636f 6c75 6d6e 7329 292c 6578 6368 616e  columns)),exchan
-00015b60: 6765 4e61 6d65 3d65 7863 6861 6e67 654e  geName=exchangeN
-00015b70: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00015b80: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00015b90: 6365 286d 665f 696e 7374 5f6f 776e 6572  ce(mf_inst_owner
-00015ba0: 7368 6970 4368 616e 6765 2c20 7064 2e53  shipChange, pd.S
-00015bb0: 6572 6965 7329 3a0a 2020 2020 2020 2020  eries):.        
-00015bc0: 2020 2020 2020 2020 2020 2020 6d66 5f69              mf_i
-00015bd0: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
-00015be0: 6e67 6520 3d20 300a 2020 2020 2020 2020  nge = 0.        
-00015bf0: 2020 2020 2020 2020 726f 756e 644f 6666          roundOff
-00015c00: 203d 2032 0a20 2020 2020 2020 2020 2020   = 2.           
-00015c10: 2020 2020 206d 696c 6c69 6f6e 7320 3d20       millions = 
-00015c20: 726f 756e 6428 6d66 5f69 6e73 745f 6f77  round(mf_inst_ow
-00015c30: 6e65 7273 6869 7043 6861 6e67 652f 3130  nershipChange/10
-00015c40: 3030 3030 302c 726f 756e 644f 6666 290a  00000,roundOff).
-00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c60: 7768 696c 6520 666c 6f61 7428 6d69 6c6c  while float(mill
-00015c70: 696f 6e73 2920 3d3d 2030 2061 6e64 2072  ions) == 0 and r
-00015c80: 6f75 6e64 4f66 6620 3c3d 353a 0a20 2020  oundOff <=5:.   
-00015c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ca0: 2072 6f75 6e64 4f66 6620 2b3d 310a 2020   roundOff +=1.  
-00015cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015cc0: 2020 6d69 6c6c 696f 6e73 203d 2072 6f75    millions = rou
-00015cd0: 6e64 286d 665f 696e 7374 5f6f 776e 6572  nd(mf_inst_owner
-00015ce0: 7368 6970 4368 616e 6765 2f31 3030 3030  shipChange/10000
-00015cf0: 3030 2c72 6f75 6e64 4f66 6629 0a20 2020  00,roundOff).   
-00015d00: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00015d10: 6e67 655f 6d69 6c6c 696f 6e73 203d 2066  nge_millions = f
-00015d20: 2228 7b6d 696c 6c69 6f6e 737d 4d29 220a  "({millions}M)".
-00015d30: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00015d40: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00015d50: 653a 2020 2320 7072 6167 6d61 3a20 6e6f  e:  # pragma: no
-00015d60: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-00015d70: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
-00015d80: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
-00015d90: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
-00015da0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00015db0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00015dc0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00015dd0: 2020 2020 2020 2020 2023 4c65 7427 7320           #Let's 
-00015de0: 6765 7420 7468 6520 6661 6972 2076 616c  get the fair val
-00015df0: 7565 2c20 6569 7468 6572 2073 6176 6564  ue, either saved
-00015e00: 206f 7220 6672 6573 6820 6672 6f6d 2073   or fresh from s
-00015e10: 6572 7669 6365 0a20 2020 2020 2020 2020  ervice.         
-00015e20: 2020 2020 2020 2066 6169 7256 616c 7565         fairValue
-00015e30: 203d 2073 656c 662e 6765 7446 6169 7256   = self.getFairV
-00015e40: 616c 7565 2873 746f 636b 2c68 6f73 7444  alue(stock,hostD
-00015e50: 6174 612c 666f 7263 653d 2868 6f73 7444  ata,force=(hostD
-00015e60: 6174 6120 6973 204e 6f6e 6520 6f72 2068  ata is None or h
-00015e70: 6f73 7444 6174 612e 656d 7074 7920 6f72  ostData.empty or
-00015e80: 2022 4661 6972 5661 6c75 6522 206e 6f74   "FairValue" not
-00015e90: 2069 6e20 686f 7374 4461 7461 2e63 6f6c   in hostData.col
-00015ea0: 756d 6e73 292c 6578 6368 616e 6765 4e61  umns),exchangeNa
-00015eb0: 6d65 3d65 7863 6861 6e67 654e 616d 6529  me=exchangeName)
-00015ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ed0: 2069 6620 6661 6972 5661 6c75 6520 6973   if fairValue is
-00015ee0: 206e 6f74 204e 6f6e 6520 616e 6420 6661   not None and fa
-00015ef0: 6972 5661 6c75 6520 213d 2030 3a0a 2020  irValue != 0:.  
-00015f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f10: 2020 6c74 7020 3d20 7361 7665 4469 6374    ltp = saveDict
-00015f20: 5b22 4c54 5022 5d0a 2020 2020 2020 2020  ["LTP"].        
-00015f30: 2020 2020 2020 2020 2020 2020 6661 6972              fair
-00015f40: 5661 6c75 6544 6966 6620 3d20 726f 756e  ValueDiff = roun
-00015f50: 6428 6661 6972 5661 6c75 6520 2d20 6c74  d(fairValue - lt
-00015f60: 702c 3029 0a20 2020 2020 2020 2020 2020  p,0).           
-00015f70: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-00015f80: 745b 2246 6169 7256 616c 7565 225d 203d  t["FairValue"] =
-00015f90: 2073 7472 2866 6169 7256 616c 7565 290a   str(fairValue).
-00015fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fb0: 2020 2020 7361 7665 4469 6374 5b22 4656      saveDict["FV
-00015fc0: 4469 6666 225d 203d 2066 6169 7256 616c  Diff"] = fairVal
-00015fd0: 7565 4469 6666 0a20 2020 2020 2020 2020  ueDiff.         
-00015fe0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00015ff0: 6e44 6963 745b 2246 5644 6966 6622 5d20  nDict["FVDiff"] 
-00016000: 3d20 6661 6972 5661 6c75 6544 6966 660a  = fairValueDiff.
-00016010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016020: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-00016030: 4661 6972 5661 6c75 6522 5d20 3d20 2863  FairValue"] = (c
-00016040: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
-00016050: 6620 6661 6972 5661 6c75 6520 3e3d 206c  f fairValue >= l
-00016060: 7470 2065 6c73 6520 636f 6c6f 7254 6578  tp else colorTex
-00016070: 742e 4641 494c 2920 2b20 7361 7665 4469  t.FAIL) + saveDi
-00016080: 6374 5b22 4661 6972 5661 6c75 6522 5d20  ct["FairValue"] 
-00016090: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-000160a0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000160b0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-000160c0: 653a 2020 2320 7072 6167 6d61 3a20 6e6f  e:  # pragma: no
-000160d0: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-000160e0: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
-000160f0: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
-00016100: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
-00016110: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00016120: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00016130: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00016140: 2069 6620 6d66 5f69 6e73 745f 6f77 6e65   if mf_inst_owne
-00016150: 7273 6869 7043 6861 6e67 6520 3e20 303a  rshipChange > 0:
-00016160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016170: 206d 6620 3d20 6622 4d46 493a e296 b220   mf = f"MFI:... 
-00016180: 7b63 6861 6e67 655f 6d69 6c6c 696f 6e73  {change_millions
-00016190: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-000161a0: 2020 206d 6673 203d 2063 6f6c 6f72 5465     mfs = colorTe
-000161b0: 7874 2e47 5245 454e 202b 206d 6620 2b20  xt.GREEN + mf + 
-000161c0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-000161d0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-000161e0: 665f 696e 7374 5f6f 776e 6572 7368 6970  f_inst_ownership
-000161f0: 4368 616e 6765 203c 2030 3a0a 2020 2020  Change < 0:.    
-00016200: 2020 2020 2020 2020 2020 2020 6d66 203d              mf =
-00016210: 2066 224d 4649 3ae2 96bc 207b 6368 616e   f"MFI:... {chan
-00016220: 6765 5f6d 696c 6c69 6f6e 737d 220a 2020  ge_millions}".  
-00016230: 2020 2020 2020 2020 2020 2020 2020 6d66                mf
-00016240: 7320 3d20 636f 6c6f 7254 6578 742e 4641  s = colorText.FA
-00016250: 494c 202b 206d 6620 2b20 636f 6c6f 7254  IL + mf + colorT
-00016260: 6578 742e 454e 440a 0a20 2020 2020 2020  ext.END..       
-00016270: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
-00016280: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
-00016290: 6c75 6528 7363 7265 656e 4469 6374 2c73  lue(screenDict,s
-000162a0: 6176 6544 6963 742c 2254 7265 6e64 2229  aveDict,"Trend")
-000162b0: 0a20 2020 2020 2020 2064 6563 6973 696f  .        decisio
-000162c0: 6e5f 7363 7220 3d20 2863 6f6c 6f72 5465  n_scr = (colorTe
-000162d0: 7874 2e47 5245 454e 2069 6620 6973 5570  xt.GREEN if isUp
-000162e0: 7472 656e 6420 656c 7365 2028 636f 6c6f  trend else (colo
-000162f0: 7254 6578 742e 4641 494c 2069 6620 6973  rText.FAIL if is
-00016300: 446f 776e 7472 656e 6420 656c 7365 2063  Downtrend else c
-00016310: 6f6c 6f72 5465 7874 2e57 4152 4e29 2920  olorText.WARN)) 
-00016320: 2b20 6622 7b64 6563 6973 696f 6e7d 2220  + f"{decision}" 
-00016330: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-00016340: 2020 2020 2020 2020 646d 6135 3064 6563          dma50dec
-00016350: 6973 696f 6e5f 7363 7220 3d20 2863 6f6c  ision_scr = (col
-00016360: 6f72 5465 7874 2e47 5245 454e 2069 6620  orText.GREEN if 
-00016370: 6973 3530 444d 4155 7074 7265 6e64 2065  is50DMAUptrend e
-00016380: 6c73 6520 2863 6f6c 6f72 5465 7874 2e46  lse (colorText.F
-00016390: 4149 4c20 6966 2069 7335 3044 4d41 446f  AIL if is50DMADo
-000163a0: 776e 7472 656e 6420 656c 7365 2063 6f6c  wntrend else col
-000163b0: 6f72 5465 7874 2e57 4152 4e29 2920 2b20  orText.WARN)) + 
-000163c0: 6622 7b64 6d61 3530 6465 6369 7369 6f6e  f"{dma50decision
-000163d0: 7d22 202b 2063 6f6c 6f72 5465 7874 2e45  }" + colorText.E
-000163e0: 4e44 0a20 2020 2020 2020 2073 6176 6544  ND.        saveD
-000163f0: 6963 745b 2254 7265 6e64 225d 203d 2066  ict["Trend"] = f
-00016400: 227b 7361 7665 645b 315d 7d20 7b64 6563  "{saved[1]} {dec
-00016410: 6973 696f 6e7d 207b 646d 6135 3064 6563  ision} {dma50dec
-00016420: 6973 696f 6e7d 207b 6d66 7d22 0a20 2020  ision} {mf}".   
-00016430: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00016440: 2254 7265 6e64 225d 203d 2066 227b 7361  "Trend"] = f"{sa
-00016450: 7665 645b 305d 7d20 7b64 6563 6973 696f  ved[0]} {decisio
-00016460: 6e5f 7363 727d 207b 646d 6135 3064 6563  n_scr} {dma50dec
-00016470: 6973 696f 6e5f 7363 727d 207b 6d66 737d  ision_scr} {mfs}
-00016480: 220a 2020 2020 2020 2020 7361 7665 4469  ".        saveDi
-00016490: 6374 5b22 4d46 4922 5d20 3d20 6d66 5f69  ct["MFI"] = mf_i
-000164a0: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
-000164b0: 6e67 650a 2020 2020 2020 2020 7363 7265  nge.        scre
-000164c0: 656e 4469 6374 5b22 4d46 4922 5d20 3d20  enDict["MFI"] = 
-000164d0: 6d66 5f69 6e73 745f 6f77 6e65 7273 6869  mf_inst_ownershi
-000164e0: 7043 6861 6e67 650a 2020 2020 2020 2020  pChange.        
-000164f0: 7265 7475 726e 2069 7355 7074 7265 6e64  return isUptrend
-00016500: 2c20 6d66 5f69 6e73 745f 6f77 6e65 7273  , mf_inst_owners
-00016510: 6869 7043 6861 6e67 652c 2066 6169 7256  hipChange, fairV
-00016520: 616c 7565 4469 6666 0a20 2020 200a 2020  alueDiff.    .  
-00016530: 2020 2320 5072 6976 6174 6520 6d65 7468    # Private meth
-00016540: 6f64 2074 6f20 6669 6e64 2063 616e 646c  od to find candl
-00016550: 6520 7479 7065 0a20 2020 2023 2054 7275  e type.    # Tru
-00016560: 6520 3d20 4275 6c6c 6973 682c 2046 616c  e = Bullish, Fal
-00016570: 7365 203d 2042 6561 7269 7368 0a20 2020  se = Bearish.   
-00016580: 2064 6566 2067 6574 4361 6e64 6c65 5479   def getCandleTy
-00016590: 7065 2873 656c 662c 2064 6169 6c79 4461  pe(self, dailyDa
-000165a0: 7461 293a 0a20 2020 2020 2020 2072 6574  ta):.        ret
-000165b0: 7572 6e20 626f 6f6c 2864 6169 6c79 4461  urn bool(dailyDa
-000165c0: 7461 5b22 436c 6f73 6522 5d2e 696c 6f63  ta["Close"].iloc
-000165d0: 5b30 5d20 3e3d 2064 6169 6c79 4461 7461  [0] >= dailyData
-000165e0: 5b22 4f70 656e 225d 2e69 6c6f 635b 305d  ["Open"].iloc[0]
-000165f0: 290a 0a20 2020 2064 6566 2067 6574 4361  )..    def getCa
-00016600: 6e64 6c65 426f 6479 4865 6967 6874 2873  ndleBodyHeight(s
-00016610: 656c 662c 2064 6169 6c79 4461 7461 293a  elf, dailyData):
-00016620: 0a20 2020 2020 2020 2062 6f64 7948 6569  .        bodyHei
-00016630: 6768 7420 3d20 6461 696c 7944 6174 615b  ght = dailyData[
-00016640: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-00016650: 202d 2064 6169 6c79 4461 7461 5b22 4f70   - dailyData["Op
-00016660: 656e 225d 2e69 6c6f 635b 305d 0a20 2020  en"].iloc[0].   
-00016670: 2020 2020 2072 6574 7572 6e20 626f 6479       return body
-00016680: 4865 6967 6874 0a0a 2020 2020 6465 6620  Height..    def 
-00016690: 6765 7446 6169 7256 616c 7565 2873 656c  getFairValue(sel
-000166a0: 662c 2073 746f 636b 2c20 686f 7374 4461  f, stock, hostDa
-000166b0: 7461 3d4e 6f6e 652c 2066 6f72 6365 3d46  ta=None, force=F
-000166c0: 616c 7365 2c65 7863 6861 6e67 654e 616d  alse,exchangeNam
-000166d0: 653d 2249 4e44 4941 2229 3a0a 2020 2020  e="INDIA"):.    
-000166e0: 2020 2020 6966 2068 6f73 7444 6174 6120      if hostData 
-000166f0: 6973 204e 6f6e 6520 6f72 206c 656e 2868  is None or len(h
-00016700: 6f73 7444 6174 6129 203c 2031 3a0a 2020  ostData) < 1:.  
-00016710: 2020 2020 2020 2020 2020 686f 7374 4461            hostDa
-00016720: 7461 203d 2070 642e 4461 7461 4672 616d  ta = pd.DataFram
-00016730: 6528 290a 2020 2020 2020 2020 2320 4c65  e().        # Le
-00016740: 7427 7320 6c6f 6f6b 2066 6f72 2066 6169  t's look for fai
-00016750: 7220 7661 6c75 6573 0a20 2020 2020 2020  r values.       
-00016760: 2066 6169 7256 616c 7565 203d 2030 0a20   fairValue = 0. 
-00016770: 2020 2020 2020 2069 6620 2246 6169 7256         if "FairV
-00016780: 616c 7565 2220 696e 2068 6f73 7444 6174  alue" in hostDat
-00016790: 612e 636f 6c75 6d6e 7320 616e 6420 504b  a.columns and PK
-000167a0: 4461 7465 5574 696c 6974 6965 732e 6375  DateUtilities.cu
-000167b0: 7272 656e 7444 6174 6554 696d 6528 292e  rrentDateTime().
-000167c0: 7765 656b 6461 7928 2920 3c3d 2034 3a0a  weekday() <= 4:.
-000167d0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-000167e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000167f0: 2066 6169 7256 616c 7565 203d 2068 6f73   fairValue = hos
-00016800: 7444 6174 612e 6c6f 635b 686f 7374 4461  tData.loc[hostDa
-00016810: 7461 2e69 6e64 6578 5b2d 315d 2c22 4661  ta.index[-1],"Fa
-00016820: 6972 5661 6c75 6522 5d0a 2020 2020 2020  irValue"].      
-00016830: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
-00016840: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
-00016850: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00016860: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00016870: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00016880: 2020 2020 2020 2069 6620 504b 4461 7465         if PKDate
-00016890: 5574 696c 6974 6965 732e 6375 7272 656e  Utilities.curren
-000168a0: 7444 6174 6554 696d 6528 292e 7765 656b  tDateTime().week
-000168b0: 6461 7928 2920 3e3d 2035 206f 7220 666f  day() >= 5 or fo
-000168c0: 7263 653a 0a20 2020 2020 2020 2020 2020  rce:.           
-000168d0: 2020 2020 2073 6563 7572 6974 7920 3d20       security = 
-000168e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000168f0: 2020 2020 2023 2052 6566 7265 7368 2065       # Refresh e
-00016900: 6163 6820 7361 7475 7264 6179 206f 7220  ach saturday or 
-00016910: 7375 6e64 6179 206f 7220 7768 656e 206e  sunday or when n
-00016920: 6f74 2066 6f75 6e64 2069 6e20 7361 7665  ot found in save
-00016930: 6420 6461 7461 0a20 2020 2020 2020 2020  d data.         
-00016940: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00016950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016960: 7769 7468 2053 7570 7072 6573 734f 7574  with SuppressOut
-00016970: 7075 7428 7375 7070 7265 7373 5f73 7464  put(suppress_std
-00016980: 6572 723d 5472 7565 2c20 7375 7070 7265  err=True, suppre
-00016990: 7373 5f73 7464 6f75 743d 5472 7565 293a  ss_stdout=True):
-000169a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000169b0: 2020 2020 2020 2020 2073 6563 7572 6974           securit
-000169c0: 7920 3d20 5374 6f63 6b28 7374 6f63 6b2c  y = Stock(stock,
-000169d0: 6578 6368 616e 6765 3d65 7863 6861 6e67  exchange=exchang
-000169e0: 654e 616d 6529 0a20 2020 2020 2020 2020  eName).         
-000169f0: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
-00016a00: 6c75 6545 7272 6f72 3a20 2320 7072 6167  lueError: # prag
-00016a10: 6d61 3a20 6e6f 2063 6f76 6572 0a20 2020  ma: no cover.   
-00016a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a30: 2023 2057 6520 6469 6420 6e6f 7420 6669   # We did not fi
-00016a40: 6e64 2074 6865 2073 746f 636b 3f20 4974  nd the stock? It
-00016a50: 2773 206f 6b61 792e 204d 6f76 6520 6f6e  's okay. Move on
-00016a60: 2074 6f20 7468 6520 6e65 7874 206f 6e65   to the next one
-00016a70: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016a80: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-00016a90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00016aa0: 7420 2854 696d 656f 7574 4572 726f 722c  t (TimeoutError,
-00016ab0: 2043 6f6e 6e65 6374 696f 6e45 7272 6f72   ConnectionError
-00016ac0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-00016ad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016ae0: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-00016af0: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-00016b00: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-00016b10: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00016b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016b30: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00016b40: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00016b50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016b60: 2e64 6566 6175 6c74 5f6c 6f67 6765 722e  .default_logger.
-00016b70: 6465 6275 6728 652c 2065 7863 5f69 6e66  debug(e, exc_inf
-00016b80: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-00016b90: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00016ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016bb0: 2069 6620 7365 6375 7269 7479 2069 7320   if security is 
-00016bc0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-00016be0: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
-00016bf0: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
-00016c00: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
-00016c10: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
-00016c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c30: 2020 2020 2020 2066 7620 3d20 7365 6375         fv = secu
-00016c40: 7269 7479 2e66 6169 7256 616c 7565 2829  rity.fairValue()
-00016c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c60: 2020 2020 2069 6620 6676 2069 7320 6e6f       if fv is no
-00016c70: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00016c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00016ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cb0: 2066 7652 6573 706f 6e73 6556 616c 7565   fvResponseValue
-00016cc0: 203d 2066 765b 226c 6174 6573 7446 6169   = fv["latestFai
-00016cd0: 7256 616c 7565 225d 0a20 2020 2020 2020  rValue"].       
-00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cf0: 2020 2020 2069 6620 6676 5265 7370 6f6e       if fvRespon
-00016d00: 7365 5661 6c75 6520 6973 206e 6f74 204e  seValue is not N
-00016d10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00016d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d30: 2020 2020 2066 6169 7256 616c 7565 203d       fairValue =
-00016d40: 2066 6c6f 6174 2866 7652 6573 706f 6e73   float(fvRespons
-00016d50: 6556 616c 7565 290a 2020 2020 2020 2020  eValue).        
-00016d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d70: 6578 6365 7074 3a20 2320 7072 6167 6d61  except: # pragma
-00016d80: 3a20 6e6f 2063 6f76 6572 0a20 2020 2020  : no cover.     
-00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016da0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00016db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016dc0: 2020 2020 2020 2020 2320 7365 6c66 2e64          # self.d
-00016dd0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
-00016de0: 6275 6728 6622 7b65 7d5c 6e52 6573 706f  bug(f"{e}\nRespo
-00016df0: 6e73 653a 6676 3a5c 6e7b 6676 7d22 2c20  nse:fv:\n{fv}", 
-00016e00: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e20: 2020 2066 6169 7256 616c 7565 203d 2072     fairValue = r
-00016e30: 6f75 6e64 2866 6c6f 6174 2866 6169 7256  ound(float(fairV
-00016e40: 616c 7565 292c 3129 0a20 2020 2020 2020  alue),1).       
-00016e50: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00016e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016e70: 2020 2020 2020 2020 2020 686f 7374 4461            hostDa
-00016e80: 7461 2e6c 6f63 5b68 6f73 7444 6174 612e  ta.loc[hostData.
-00016e90: 696e 6465 785b 2d31 5d2c 2246 6169 7256  index[-1],"FairV
-00016ea0: 616c 7565 225d 203d 2066 6169 7256 616c  alue"] = fairVal
-00016eb0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00016ec0: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
-00016ed0: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
-00016ee0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00016ef0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00016f00: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-00016f10: 2066 6169 7256 616c 7565 0a0a 2020 2020   fairValue..    
-00016f20: 6465 6620 6765 744d 7574 7561 6c46 756e  def getMutualFun
-00016f30: 6453 7461 7475 7328 7365 6c66 2c20 7374  dStatus(self, st
-00016f40: 6f63 6b2c 6f6e 6c79 4d46 3d46 616c 7365  ock,onlyMF=False
-00016f50: 2c20 686f 7374 4461 7461 3d4e 6f6e 652c  , hostData=None,
-00016f60: 2066 6f72 6365 3d46 616c 7365 2c65 7863   force=False,exc
-00016f70: 6861 6e67 654e 616d 653d 2249 4e44 4941  hangeName="INDIA
-00016f80: 2229 3a0a 2020 2020 2020 2020 6966 2068  "):.        if h
-00016f90: 6f73 7444 6174 6120 6973 204e 6f6e 6520  ostData is None 
-00016fa0: 6f72 206c 656e 2868 6f73 7444 6174 6129  or len(hostData)
-00016fb0: 203c 2031 3a0a 2020 2020 2020 2020 2020   < 1:.          
-00016fc0: 2020 686f 7374 4461 7461 203d 2070 642e    hostData = pd.
-00016fd0: 4461 7461 4672 616d 6528 290a 2020 2020  DataFrame().    
-00016fe0: 2020 2020 0a20 2020 2020 2020 206e 6574      .        net
-00016ff0: 4368 616e 6765 4d46 203d 2030 0a20 2020  ChangeMF = 0.   
-00017000: 2020 2020 206e 6574 4368 616e 6765 496e       netChangeIn
-00017010: 7374 203d 2030 0a20 2020 2020 2020 206c  st = 0.        l
-00017020: 6174 6573 745f 6d66 6461 7465 203d 204e  atest_mfdate = N
-00017030: 6f6e 650a 2020 2020 2020 2020 6c61 7465  one.        late
-00017040: 7374 5f69 6e73 7464 6174 6520 3d20 4e6f  st_instdate = No
-00017050: 6e65 0a20 2020 2020 2020 206e 6565 6473  ne.        needs
-00017060: 4672 6573 6855 7064 6174 6520 3d20 5472  FreshUpdate = Tr
-00017070: 7565 0a20 2020 2020 2020 206c 6173 7444  ue.        lastD
-00017080: 6179 4c61 7374 4d6f 6e74 6820 3d20 504b  ayLastMonth = PK
-00017090: 4461 7465 5574 696c 6974 6965 732e 6c61  DateUtilities.la
-000170a0: 7374 5f64 6179 5f6f 665f 7072 6576 696f  st_day_of_previo
-000170b0: 7573 5f6d 6f6e 7468 2850 4b44 6174 6555  us_month(PKDateU
-000170c0: 7469 6c69 7469 6573 2e63 7572 7265 6e74  tilities.current
-000170d0: 4461 7465 5469 6d65 2829 290a 2020 2020  DateTime()).    
-000170e0: 2020 2020 6966 2068 6f73 7444 6174 6120      if hostData 
-000170f0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00017100: 6c65 6e28 686f 7374 4461 7461 2920 3e20  len(hostData) > 
-00017110: 303a 0a20 2020 2020 2020 2020 2020 2069  0:.            i
-00017120: 6620 224d 4622 2069 6e20 686f 7374 4461  f "MF" in hostDa
-00017130: 7461 2e63 6f6c 756d 6e73 206f 7220 2246  ta.columns or "F
-00017140: 4949 2220 696e 2068 6f73 7444 6174 612e  II" in hostData.
-00017150: 636f 6c75 6d6e 733a 0a20 2020 2020 2020  columns:.       
-00017160: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017180: 2020 6e65 7443 6861 6e67 654d 4620 3d20    netChangeMF = 
-00017190: 686f 7374 4461 7461 2e6c 6f63 5b68 6f73  hostData.loc[hos
-000171a0: 7444 6174 612e 696e 6465 785b 2d31 5d2c  tData.index[-1],
-000171b0: 224d 4622 5d0a 2020 2020 2020 2020 2020  "MF"].          
-000171c0: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
-000171d0: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
-000171e0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000171f0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00017200: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00017210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017220: 2020 2020 2020 6e65 7443 6861 6e67 6549        netChangeI
-00017230: 6e73 7420 3d20 686f 7374 4461 7461 2e6c  nst = hostData.l
-00017240: 6f63 5b68 6f73 7444 6174 612e 696e 6465  oc[hostData.inde
-00017250: 785b 2d31 5d2c 2246 4949 225d 0a20 2020  x[-1],"FII"].   
-00017260: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00017270: 6570 7420 284b 6579 4572 726f 722c 496e  ept (KeyError,In
-00017280: 6465 7845 7272 6f72 293a 0a20 2020 2020  dexError):.     
-00017290: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000172a0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000172b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000172c0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
-000172d0: 6573 745f 6d66 6461 7465 203d 2068 6f73  est_mfdate = hos
-000172e0: 7444 6174 612e 6c6f 635b 686f 7374 4461  tData.loc[hostDa
-000172f0: 7461 2e69 6e64 6578 5b2d 315d 2c22 4d46  ta.index[-1],"MF
-00017300: 5f44 6174 6522 5d0a 2020 2020 2020 2020  _Date"].        
-00017310: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00017320: 7369 6e73 7461 6e63 6528 6c61 7465 7374  sinstance(latest
-00017330: 5f6d 6664 6174 652c 2066 6c6f 6174 293a  _mfdate, float):
-00017340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017350: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
-00017360: 6d66 6461 7465 203d 2064 6174 6574 696d  mfdate = datetim
-00017370: 652e 6461 7465 7469 6d65 2e66 726f 6d74  e.datetime.fromt
-00017380: 696d 6573 7461 6d70 286c 6174 6573 745f  imestamp(latest_
-00017390: 6d66 6461 7465 292e 7374 7266 7469 6d65  mfdate).strftime
-000173a0: 2827 2559 2d25 6d2d 2564 2729 0a20 2020  ('%Y-%m-%d').   
-000173b0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000173c0: 6570 7420 284b 6579 4572 726f 722c 496e  ept (KeyError,In
-000173d0: 6465 7845 7272 6f72 293a 0a20 2020 2020  dexError):.     
-000173e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000173f0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00017400: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00017410: 2020 2020 2020 2020 2020 2020 206c 6174               lat
-00017420: 6573 745f 696e 7374 6461 7465 203d 2068  est_instdate = h
-00017430: 6f73 7444 6174 612e 6c6f 635b 686f 7374  ostData.loc[host
-00017440: 4461 7461 2e69 6e64 6578 5b2d 315d 2c22  Data.index[-1],"
-00017450: 4649 495f 4461 7465 225d 0a20 2020 2020  FII_Date"].     
-00017460: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017470: 6620 6973 696e 7374 616e 6365 286c 6174  f isinstance(lat
-00017480: 6573 745f 696e 7374 6461 7465 2c20 666c  est_instdate, fl
-00017490: 6f61 7429 3a0a 2020 2020 2020 2020 2020  oat):.          
-000174a0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-000174b0: 7465 7374 5f69 6e73 7464 6174 6520 3d20  test_instdate = 
-000174c0: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-000174d0: 652e 6672 6f6d 7469 6d65 7374 616d 7028  e.fromtimestamp(
-000174e0: 6c61 7465 7374 5f69 6e73 7464 6174 6529  latest_instdate)
-000174f0: 2e73 7472 6674 696d 6528 2725 592d 256d  .strftime('%Y-%m
-00017500: 2d25 6427 290a 2020 2020 2020 2020 2020  -%d').          
-00017510: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
-00017520: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
-00017530: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00017540: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00017550: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017560: 6c61 7465 7374 5f6d 6664 6174 6520 6973  latest_mfdate is
-00017570: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00017580: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017590: 6176 6564 5f6d 6664 6174 6520 3d20 504b  aved_mfdate = PK
-000175a0: 4461 7465 5574 696c 6974 6965 732e 6461  DateUtilities.da
-000175b0: 7465 4672 6f6d 596d 6453 7472 696e 6728  teFromYmdString(
-000175c0: 6c61 7465 7374 5f6d 6664 6174 652e 7370  latest_mfdate.sp
-000175d0: 6c69 7428 2254 2229 5b30 5d29 0a20 2020  lit("T")[0]).   
-000175e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000175f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017600: 2020 2020 2020 2073 6176 6564 5f6d 6664         saved_mfd
-00017610: 6174 6520 3d20 6c61 7374 4461 794c 6173  ate = lastDayLas
-00017620: 744d 6f6e 7468 202d 2064 6174 6574 696d  tMonth - datetim
-00017630: 652e 7469 6d65 6465 6c74 6128 3129 0a20  e.timedelta(1). 
-00017640: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017650: 6620 6c61 7465 7374 5f69 6e73 7464 6174  f latest_instdat
-00017660: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00013ef0: 7265 7475 726e 2073 6176 6544 6963 745b  return saveDict[
+00013f00: 2254 7265 6e64 225d 0a20 2020 2020 2020  "Trend"].       
+00013f10: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00013f20: 7074 696f 6e20 6173 2065 3a20 2023 2070  ption as e:  # p
+00013f30: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
+00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f50: 7365 6c66 2e64 6566 6175 6c74 5f6c 6f67  self.default_log
+00013f60: 6765 722e 6465 6275 6728 652c 2065 7863  ger.debug(e, exc
+00013f70: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
+00013f80: 2020 2020 2020 2020 2020 2020 736c 6f70              slop
+00013f90: 652c 205f 203d 2030 2c20 300a 2020 2020  e, _ = 0, 0.    
+00013fa0: 2020 2020 2020 2020 616e 676c 6520 3d20          angle = 
+00013fb0: 6e70 2e72 6164 3264 6567 286e 702e 6172  np.rad2deg(np.ar
+00013fc0: 6374 616e 2873 6c6f 7065 2929 0a20 2020  ctan(slope)).   
+00013fd0: 2020 2020 2020 2020 2069 6620 616e 676c           if angl
+00013fe0: 6520 3d3d 2030 3a0a 2020 2020 2020 2020  e == 0:.        
+00013ff0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+00014000: 6374 5b22 5472 656e 6422 5d20 3d20 280a  ct["Trend"] = (.
+00014010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014020: 2020 2020 7361 7665 645b 305d 202b 2063      saved[0] + c
+00014030: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+00014040: 636f 6c6f 7254 6578 742e 5741 524e 202b  colorText.WARN +
+00014050: 2022 556e 6b6e 6f77 6e22 202b 2063 6f6c   "Unknown" + col
+00014060: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00014070: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00014080: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00014090: 6544 6963 745b 2254 7265 6e64 225d 203d  eDict["Trend"] =
+000140a0: 2073 6176 6564 5b31 5d20 2b20 2255 6e6b   saved[1] + "Unk
+000140b0: 6e6f 776e 220a 2020 2020 2020 2020 2020  nown".          
+000140c0: 2020 656c 6966 2061 6e67 6c65 203c 3d20    elif angle <= 
+000140d0: 3330 2061 6e64 2061 6e67 6c65 203e 3d20  30 and angle >= 
+000140e0: 2d33 303a 0a20 2020 2020 2020 2020 2020  -30:.           
+000140f0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00014100: 2254 7265 6e64 225d 203d 2028 0a20 2020  "Trend"] = (.   
+00014110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014120: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00014130: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00014140: 6f72 5465 7874 2e57 4152 4e20 2b20 2253  orText.WARN + "S
+00014150: 6964 6577 6179 7322 202b 2063 6f6c 6f72  ideways" + color
+00014160: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00014170: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00014180: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+00014190: 6963 745b 2254 7265 6e64 225d 203d 2073  ict["Trend"] = s
+000141a0: 6176 6564 5b31 5d20 2b20 2253 6964 6577  aved[1] + "Sidew
+000141b0: 6179 7322 0a20 2020 2020 2020 2020 2020  ays".           
+000141c0: 2065 6c69 6620 616e 676c 6520 3e3d 2033   elif angle >= 3
+000141d0: 3020 616e 6420 616e 676c 6520 3c20 3631  0 and angle < 61
+000141e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000141f0: 2020 7363 7265 656e 4469 6374 5b22 5472    screenDict["Tr
+00014200: 656e 6422 5d20 3d20 280a 2020 2020 2020  end"] = (.      
+00014210: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00014220: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+00014230: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+00014240: 6578 742e 4752 4545 4e20 2b20 2257 6561  ext.GREEN + "Wea
+00014250: 6b20 5570 2220 2b20 636f 6c6f 7254 6578  k Up" + colorTex
+00014260: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+00014270: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00014280: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00014290: 5b22 5472 656e 6422 5d20 3d20 7361 7665  ["Trend"] = save
+000142a0: 645b 315d 202b 2022 5765 616b 2055 7022  d[1] + "Weak Up"
+000142b0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000142c0: 6620 616e 676c 6520 3e3d 2036 303a 0a20  f angle >= 60:. 
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000142e0: 6372 6565 6e44 6963 745b 2254 7265 6e64  creenDict["Trend
+000142f0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+00014300: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00014310: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
+00014320: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
+00014330: 2e47 5245 454e 202b 2022 5374 726f 6e67  .GREEN + "Strong
+00014340: 2055 7022 202b 2063 6f6c 6f72 5465 7874   Up" + colorText
+00014350: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+00014360: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00014370: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00014380: 2254 7265 6e64 225d 203d 2073 6176 6564  "Trend"] = saved
+00014390: 5b31 5d20 2b20 2253 7472 6f6e 6720 5570  [1] + "Strong Up
+000143a0: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
+000143b0: 6966 2061 6e67 6c65 203c 3d20 2d33 3020  if angle <= -30 
+000143c0: 616e 6420 616e 676c 6520 3e20 2d36 313a  and angle > -61:
+000143d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000143e0: 2073 6372 6565 6e44 6963 745b 2254 7265   screenDict["Tre
+000143f0: 6e64 225d 203d 2028 0a20 2020 2020 2020  nd"] = (.       
+00014400: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00014410: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00014420: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+00014430: 7874 2e46 4149 4c20 2b20 2257 6561 6b20  xt.FAIL + "Weak 
+00014440: 446f 776e 2220 2b20 636f 6c6f 7254 6578  Down" + colorTex
+00014450: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+00014460: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00014470: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00014480: 5b22 5472 656e 6422 5d20 3d20 7361 7665  ["Trend"] = save
+00014490: 645b 315d 202b 2022 5765 616b 2044 6f77  d[1] + "Weak Dow
+000144a0: 6e22 0a20 2020 2020 2020 2020 2020 2065  n".            e
+000144b0: 6c69 6620 616e 676c 6520 3c20 2d36 303a  lif angle < -60:
+000144c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000144d0: 2073 6372 6565 6e44 6963 745b 2254 7265   screenDict["Tre
+000144e0: 6e64 225d 203d 2028 0a20 2020 2020 2020  nd"] = (.       
+000144f0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00014500: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00014510: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+00014520: 7874 2e46 4149 4c20 2b20 2253 7472 6f6e  xt.FAIL + "Stron
+00014530: 6720 446f 776e 2220 2b20 636f 6c6f 7254  g Down" + colorT
+00014540: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+00014550: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00014560: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
+00014570: 6374 5b22 5472 656e 6422 5d20 3d20 7361  ct["Trend"] = sa
+00014580: 7665 645b 315d 202b 2022 5374 726f 6e67  ved[1] + "Strong
+00014590: 2044 6f77 6e22 0a20 2020 2020 2020 2065   Down".        e
+000145a0: 7863 6570 7420 6e70 2e6c 696e 616c 672e  xcept np.linalg.
+000145b0: 4c69 6e41 6c67 4572 726f 7220 6173 2065  LinAlgError as e
+000145c0: 3a20 2320 7072 6167 6d61 3a20 6e6f 2063  : # pragma: no c
+000145d0: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
+000145e0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+000145f0: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
+00014600: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
+00014610: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00014620: 6963 745b 2254 7265 6e64 225d 203d 2028  ict["Trend"] = (
+00014630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014640: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00014650: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00014660: 6f72 5465 7874 2e57 4152 4e20 2b20 2255  orText.WARN + "U
+00014670: 6e6b 6e6f 776e 2220 2b20 636f 6c6f 7254  nknown" + colorT
+00014680: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
+00014690: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000146a0: 2020 7361 7665 4469 6374 5b22 5472 656e    saveDict["Tren
+000146b0: 6422 5d20 3d20 7361 7665 645b 315d 202b  d"] = saved[1] +
+000146c0: 2022 556e 6b6e 6f77 6e22 0a20 2020 2020   "Unknown".     
+000146d0: 2020 2072 6574 7572 6e20 7361 7665 4469     return saveDi
+000146e0: 6374 5b22 5472 656e 6422 5d0a 0a20 2020  ct["Trend"]..   
+000146f0: 2023 2046 696e 6420 7374 6f63 6b73 2061   # Find stocks a
+00014700: 7070 726f 6368 696e 6720 746f 206c 6f6e  pproching to lon
+00014710: 6720 7465 726d 2074 7265 6e64 6c69 6e65  g term trendline
+00014720: 730a 2020 2020 6465 6620 6669 6e64 5472  s.    def findTr
+00014730: 656e 646c 696e 6573 2873 656c 662c 2064  endlines(self, d
+00014740: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+00014750: 6176 6544 6963 742c 2070 6572 6365 6e74  aveDict, percent
+00014760: 6167 653d 302e 3035 293a 0a20 2020 2020  age=0.05):.     
+00014770: 2020 2023 2070 6572 696f 6420 3d20 696e     # period = in
+00014780: 7428 2222 2e6a 6f69 6e28 6320 666f 7220  t("".join(c for 
+00014790: 6320 696e 2073 656c 662e 636f 6e66 6967  c in self.config
+000147a0: 4d61 6e61 6765 722e 7065 7269 6f64 2069  Manager.period i
+000147b0: 6620 632e 6973 6469 6769 7428 2929 290a  f c.isdigit())).
+000147c0: 2020 2020 2020 2020 2320 6966 206c 656e          # if len
+000147d0: 2864 6174 6129 203c 2070 6572 696f 643a  (data) < period:
+000147e0: 0a20 2020 2020 2020 2023 2020 2020 2072  .        #     r
+000147f0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00014800: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+00014810: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
+00014820: 6120 3d20 6461 7461 5b3a 3a2d 315d 0a20  a = data[::-1]. 
+00014830: 2020 2020 2020 2064 6174 615b 224e 756d         data["Num
+00014840: 6265 7222 5d20 3d20 6e70 2e61 7261 6e67  ber"] = np.arang
+00014850: 6528 6c65 6e28 6461 7461 2929 202b 2031  e(len(data)) + 1
+00014860: 0a20 2020 2020 2020 2064 6174 615f 6c6f  .        data_lo
+00014870: 7720 3d20 6461 7461 2e63 6f70 7928 290a  w = data.copy().
+00014880: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+00014890: 2033 300a 0a20 2020 2020 2020 2022 2222   30..        """
+000148a0: 2049 676e 6f72 696e 6720 7468 6520 5265   Ignoring the Re
+000148b0: 7369 7461 6e63 6520 666f 7220 6c6f 6e67  sitance for long
+000148c0: 2d74 6572 6d20 7075 7270 6f73 650a 2020  -term purpose.  
+000148d0: 2020 2020 2020 7768 696c 6520 6c65 6e28        while len(
+000148e0: 6461 7461 5f68 6967 6829 203e 2070 6f69  data_high) > poi
+000148f0: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00014900: 2073 6c6f 7065 2c20 696e 7465 7263 6570   slope, intercep
+00014910: 742c 2072 5f76 616c 7565 2c20 705f 7661  t, r_value, p_va
+00014920: 6c75 652c 2073 7464 5f65 7272 203d 206c  lue, std_err = l
+00014930: 696e 7265 6772 6573 7328 783d 6461 7461  inregress(x=data
+00014940: 5f68 6967 685b 274e 756d 6265 7227 5d2c  _high['Number'],
+00014950: 2079 3d64 6174 615f 6869 6768 5b27 4869   y=data_high['Hi
+00014960: 6768 275d 290a 2020 2020 2020 2020 2020  gh']).          
+00014970: 2020 6461 7461 5f68 6967 6820 3d20 6461    data_high = da
+00014980: 7461 5f68 6967 682e 6c6f 635b 6461 7461  ta_high.loc[data
+00014990: 5f68 6967 685b 2748 6967 6827 5d20 3e20  _high['High'] > 
+000149a0: 736c 6f70 6520 2a20 6461 7461 5f68 6967  slope * data_hig
+000149b0: 685b 274e 756d 6265 7227 5d20 2b20 696e  h['Number'] + in
+000149c0: 7465 7263 6570 745d 0a20 2020 2020 2020  tercept].       
+000149d0: 2073 6c6f 7065 2c20 696e 7465 7263 6570   slope, intercep
+000149e0: 742c 2072 5f76 616c 7565 2c20 705f 7661  t, r_value, p_va
+000149f0: 6c75 652c 2073 7464 5f65 7272 203d 206c  lue, std_err = l
+00014a00: 696e 7265 6772 6573 7328 783d 6461 7461  inregress(x=data
+00014a10: 5f68 6967 685b 274e 756d 6265 7227 5d2c  _high['Number'],
+00014a20: 2079 3d64 6174 615f 6869 6768 5b27 436c   y=data_high['Cl
+00014a30: 6f73 6527 5d29 0a20 2020 2020 2020 2064  ose']).        d
+00014a40: 6174 615b 2752 6573 6973 7461 6e63 6527  ata['Resistance'
+00014a50: 5d20 3d20 736c 6f70 6520 2a20 6461 7461  ] = slope * data
+00014a60: 5b27 4e75 6d62 6572 275d 202b 2069 6e74  ['Number'] + int
+00014a70: 6572 6365 7074 0a20 2020 2020 2020 2022  ercept.        "
+00014a80: 2222 0a0a 2020 2020 2020 2020 7768 696c  ""..        whil
+00014a90: 6520 6c65 6e28 6461 7461 5f6c 6f77 2920  e len(data_low) 
+00014aa0: 3e20 706f 696e 7473 3a0a 2020 2020 2020  > points:.      
+00014ab0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00014ac0: 2020 2020 2020 2020 2020 2073 6c6f 7065             slope
+00014ad0: 2c20 696e 7465 7263 6570 742c 2072 5f76  , intercept, r_v
+00014ae0: 616c 7565 2c20 705f 7661 6c75 652c 2073  alue, p_value, s
+00014af0: 7464 5f65 7272 203d 206c 696e 7265 6772  td_err = linregr
+00014b00: 6573 7328 0a20 2020 2020 2020 2020 2020  ess(.           
+00014b10: 2020 2020 2020 2020 2078 3d64 6174 615f           x=data_
+00014b20: 6c6f 775b 224e 756d 6265 7222 5d2c 2079  low["Number"], y
+00014b30: 3d64 6174 615f 6c6f 775b 224c 6f77 225d  =data_low["Low"]
+00014b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014b50: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+00014b60: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00014b70: 6173 2065 3a20 2023 2070 7261 676d 613a  as e:  # pragma:
+00014b80: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+00014b90: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00014ba0: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+00014bb0: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+00014bc0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00014bd0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00014be0: 2020 2020 2020 2020 2020 2064 6174 615f             data_
+00014bf0: 6c6f 7720 3d20 6461 7461 5f6c 6f77 2e6c  low = data_low.l
+00014c00: 6f63 5b0a 2020 2020 2020 2020 2020 2020  oc[.            
+00014c10: 2020 2020 6461 7461 5f6c 6f77 5b22 4c6f      data_low["Lo
+00014c20: 7722 5d20 3c20 736c 6f70 6520 2a20 6461  w"] < slope * da
+00014c30: 7461 5f6c 6f77 5b22 4e75 6d62 6572 225d  ta_low["Number"]
+00014c40: 202b 2069 6e74 6572 6365 7074 0a20 2020   + intercept.   
+00014c50: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
+00014c60: 2020 2020 736c 6f70 652c 2069 6e74 6572      slope, inter
+00014c70: 6365 7074 2c20 725f 7661 6c75 652c 2070  cept, r_value, p
+00014c80: 5f76 616c 7565 2c20 7374 645f 6572 7220  _value, std_err 
+00014c90: 3d20 6c69 6e72 6567 7265 7373 280a 2020  = linregress(.  
+00014ca0: 2020 2020 2020 2020 2020 783d 6461 7461            x=data
+00014cb0: 5f6c 6f77 5b22 4e75 6d62 6572 225d 2c20  _low["Number"], 
+00014cc0: 793d 6461 7461 5f6c 6f77 5b22 436c 6f73  y=data_low["Clos
+00014cd0: 6522 5d0a 2020 2020 2020 2020 290a 2020  e"].        ).  
+00014ce0: 2020 2020 2020 6461 7461 5b22 5375 7070        data["Supp
+00014cf0: 6f72 7422 5d20 3d20 736c 6f70 6520 2a20  ort"] = slope * 
+00014d00: 6461 7461 5b22 4e75 6d62 6572 225d 202b  data["Number"] +
+00014d10: 2069 6e74 6572 6365 7074 0a20 2020 2020   intercept.     
+00014d20: 2020 206e 6f77 203d 2064 6174 612e 7461     now = data.ta
+00014d30: 696c 2831 290a 0a20 2020 2020 2020 206c  il(1)..        l
+00014d40: 696d 6974 5f75 7070 6572 203d 206e 6f77  imit_upper = now
+00014d50: 5b22 5375 7070 6f72 7422 5d2e 696c 6f63  ["Support"].iloc
+00014d60: 5b30 5d20 2b20 286e 6f77 5b22 5375 7070  [0] + (now["Supp
+00014d70: 6f72 7422 5d2e 696c 6f63 5b30 5d20 2a20  ort"].iloc[0] * 
+00014d80: 7065 7263 656e 7461 6765 290a 2020 2020  percentage).    
+00014d90: 2020 2020 6c69 6d69 745f 6c6f 7765 7220      limit_lower 
+00014da0: 3d20 6e6f 775b 2253 7570 706f 7274 225d  = now["Support"]
+00014db0: 2e69 6c6f 635b 305d 202d 2028 6e6f 775b  .iloc[0] - (now[
+00014dc0: 2253 7570 706f 7274 225d 2e69 6c6f 635b  "Support"].iloc[
+00014dd0: 305d 202a 2070 6572 6365 6e74 6167 6529  0] * percentage)
+00014de0: 0a20 2020 2020 2020 2073 6176 6564 203d  .        saved =
+00014df0: 2073 656c 662e 6669 6e64 4375 7272 656e   self.findCurren
+00014e00: 7453 6176 6564 5661 6c75 6528 7363 7265  tSavedValue(scre
+00014e10: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+00014e20: 2c20 2250 6174 7465 726e 2229 0a20 2020  , "Pattern").   
+00014e30: 2020 2020 2069 6620 6c69 6d69 745f 6c6f       if limit_lo
+00014e40: 7765 7220 3c20 6e6f 775b 2243 6c6f 7365  wer < now["Close
+00014e50: 225d 2e69 6c6f 635b 305d 203c 206c 696d  "].iloc[0] < lim
+00014e60: 6974 5f75 7070 6572 2061 6e64 2073 6c6f  it_upper and slo
+00014e70: 7065 203e 2030 2e31 353a 0a20 2020 2020  pe > 0.15:.     
+00014e80: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00014e90: 745b 2250 6174 7465 726e 225d 203d 2028  t["Pattern"] = (
+00014ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014eb0: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00014ec0: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00014ed0: 6f72 5465 7874 2e47 5245 454e 202b 2022  orText.GREEN + "
+00014ee0: 5472 656e 646c 696e 652d 5375 7070 6f72  Trendline-Suppor
+00014ef0: 7422 202b 2063 6f6c 6f72 5465 7874 2e45  t" + colorText.E
+00014f00: 4e44 0a20 2020 2020 2020 2020 2020 2029  ND.            )
+00014f10: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
+00014f20: 6544 6963 745b 2250 6174 7465 726e 225d  eDict["Pattern"]
+00014f30: 203d 2073 6176 6564 5b31 5d20 2b20 2254   = saved[1] + "T
+00014f40: 7265 6e64 6c69 6e65 2d53 7570 706f 7274  rendline-Support
+00014f50: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+00014f60: 7475 726e 2054 7275 650a 0a20 2020 2020  turn True..     
+00014f70: 2020 2022 2222 2050 6c6f 7473 2066 6f72     """ Plots for
+00014f80: 2064 6562 7567 6769 6e67 0a20 2020 2020   debugging.     
+00014f90: 2020 2069 6d70 6f72 7420 6d61 7470 6c6f     import matplo
+00014fa0: 746c 6962 2e70 7970 6c6f 7420 6173 2070  tlib.pyplot as p
+00014fb0: 6c74 0a20 2020 2020 2020 2066 6967 2c20  lt.        fig, 
+00014fc0: 6178 3120 3d20 706c 742e 7375 6270 6c6f  ax1 = plt.subplo
+00014fd0: 7473 2866 6967 7369 7a65 3d28 3135 2c31  ts(figsize=(15,1
+00014fe0: 3029 290a 2020 2020 2020 2020 636f 6c6f  0)).        colo
+00014ff0: 7220 3d20 2774 6162 3a67 7265 656e 270a  r = 'tab:green'.
+00015000: 2020 2020 2020 2020 7864 6174 6520 3d20          xdate = 
+00015010: 5b78 2e64 6174 6528 2920 666f 7220 7820  [x.date() for x 
+00015020: 696e 2064 6174 612e 696e 6465 785d 0a20  in data.index]. 
+00015030: 2020 2020 2020 2061 7831 2e73 6574 5f78         ax1.set_x
+00015040: 6c61 6265 6c28 2744 6174 6527 2c20 636f  label('Date', co
+00015050: 6c6f 723d 636f 6c6f 7229 0a20 2020 2020  lor=color).     
+00015060: 2020 2061 7831 2e70 6c6f 7428 7864 6174     ax1.plot(xdat
+00015070: 652c 2064 6174 612e 436c 6f73 652c 206c  e, data.Close, l
+00015080: 6162 656c 3d22 636c 6f73 6522 2c20 636f  abel="close", co
+00015090: 6c6f 723d 636f 6c6f 7229 0a20 2020 2020  lor=color).     
+000150a0: 2020 2061 7831 2e74 6963 6b5f 7061 7261     ax1.tick_para
+000150b0: 6d73 2861 7869 733d 2778 272c 206c 6162  ms(axis='x', lab
+000150c0: 656c 636f 6c6f 723d 636f 6c6f 7229 0a0a  elcolor=color)..
+000150d0: 2020 2020 2020 2020 6178 3220 3d20 6178          ax2 = ax
+000150e0: 312e 7477 696e 7928 2920 2320 6178 3220  1.twiny() # ax2 
+000150f0: 616e 6420 6178 3120 7769 6c6c 2068 6176  and ax1 will hav
+00015100: 6520 636f 6d6d 6f6e 2079 2061 7869 7320  e common y axis 
+00015110: 616e 6420 6469 6666 6572 656e 7420 7820  and different x 
+00015120: 6178 6973 2c20 7477 696e 790a 2020 2020  axis, twiny.    
+00015130: 2020 2020 6178 322e 706c 6f74 2864 6174      ax2.plot(dat
+00015140: 612e 4e75 6d62 6572 2c20 6461 7461 2e52  a.Number, data.R
+00015150: 6573 6973 7461 6e63 652c 206c 6162 656c  esistance, label
+00015160: 3d22 5265 7322 290a 2020 2020 2020 2020  ="Res").        
+00015170: 6178 322e 706c 6f74 2864 6174 612e 4e75  ax2.plot(data.Nu
+00015180: 6d62 6572 2c20 6461 7461 2e53 7570 706f  mber, data.Suppo
+00015190: 7274 2c20 6c61 6265 6c3d 2253 7570 2229  rt, label="Sup")
+000151a0: 0a0a 2020 2020 2020 2020 706c 742e 6c65  ..        plt.le
+000151b0: 6765 6e64 2829 0a20 2020 2020 2020 2070  gend().        p
+000151c0: 6c74 2e67 7269 6428 290a 2020 2020 2020  lt.grid().      
+000151d0: 2020 706c 742e 7368 6f77 2829 0a20 2020    plt.show().   
+000151e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000151f0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00015200: 2020 2023 2040 6d65 6173 7572 655f 7469     # @measure_ti
+00015210: 6d65 0a20 2020 2064 6566 2066 696e 6455  me.    def findU
+00015220: 7074 7265 6e64 2873 656c 662c 2064 662c  ptrend(self, df,
+00015230: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
+00015240: 6544 6963 742c 2074 6573 7469 6e67 2c20  eDict, testing, 
+00015250: 7374 6f63 6b2c 6f6e 6c79 4d46 3d46 616c  stock,onlyMF=Fal
+00015260: 7365 2c68 6f73 7444 6174 613d 4e6f 6e65  se,hostData=None
+00015270: 2c65 7863 6861 6e67 654e 616d 653d 2249  ,exchangeName="I
+00015280: 4e44 4941 222c 7265 6672 6573 684d 4641  NDIA",refreshMFA
+00015290: 6e64 4656 3d54 7275 6529 3a0a 2020 2020  ndFV=True):.    
+000152a0: 2020 2020 2320 7368 6f75 6c64 5072 6f63      # shouldProc
+000152b0: 6565 6420 3d20 5472 7565 0a20 2020 2020  eed = True.     
+000152c0: 2020 2069 7355 7074 7265 6e64 203d 2046     isUptrend = F
+000152d0: 616c 7365 0a20 2020 2020 2020 2069 7344  alse.        isD
+000152e0: 6f77 6e74 7265 6e64 203d 2046 616c 7365  owntrend = False
+000152f0: 0a20 2020 2020 2020 2069 7335 3044 4d41  .        is50DMA
+00015300: 5570 7472 656e 6420 3d20 4661 6c73 650a  Uptrend = False.
+00015310: 2020 2020 2020 2020 6973 3530 444d 4144          is50DMAD
+00015320: 6f77 6e74 7265 6e64 203d 2046 616c 7365  owntrend = False
+00015330: 0a20 2020 2020 2020 2064 6563 6973 696f  .        decisio
+00015340: 6e20 3d20 2222 0a20 2020 2020 2020 2064  n = "".        d
+00015350: 6d61 3530 6465 6369 7369 6f6e 203d 2022  ma50decision = "
+00015360: 220a 2020 2020 2020 2020 6661 6972 5661  ".        fairVa
+00015370: 6c75 6520 3d20 300a 2020 2020 2020 2020  lue = 0.        
+00015380: 6661 6972 5661 6c75 6544 6966 6620 3d20  fairValueDiff = 
+00015390: 300a 2020 2020 2020 2020 2320 6966 2064  0.        # if d
+000153a0: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
+000153b0: 2864 6629 203c 2032 3230 206f 7220 7465  (df) < 220 or te
+000153c0: 7374 696e 673a 0a20 2020 2020 2020 2023  sting:.        #
+000153d0: 2020 2020 2073 686f 756c 6450 726f 6365       shouldProce
+000153e0: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+000153f0: 2020 2069 6620 6466 2069 7320 6e6f 7420     if df is not 
+00015400: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00015410: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00015420: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
+00015430: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00015440: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00015450: 6174 615b 3a3a 2d31 5d0a 2020 2020 2020  ata[::-1].      
+00015460: 2020 2020 2020 2020 2020 746f 6461 795f            today_
+00015470: 736d 6120 3d20 706b 7461 6c69 622e 534d  sma = pktalib.SM
+00015480: 4128 6461 7461 5b22 436c 6f73 6522 5d2c  A(data["Close"],
+00015490: 2074 696d 6570 6572 696f 643d 3530 290a   timeperiod=50).
+000154a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154b0: 736d 615f 6d69 6e75 7339 203d 2070 6b74  sma_minus9 = pkt
+000154c0: 616c 6962 2e53 4d41 2864 6174 612e 6865  alib.SMA(data.he
+000154d0: 6164 286c 656e 2864 6174 6129 2d39 295b  ad(len(data)-9)[
+000154e0: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
+000154f0: 7269 6f64 3d35 3029 0a20 2020 2020 2020  riod=50).       
+00015500: 2020 2020 2020 2020 2073 6d61 5f6d 696e           sma_min
+00015510: 7573 3134 203d 2070 6b74 616c 6962 2e53  us14 = pktalib.S
+00015520: 4d41 2864 6174 612e 6865 6164 286c 656e  MA(data.head(len
+00015530: 2864 6174 6129 2d31 3429 5b22 436c 6f73  (data)-14)["Clos
+00015540: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+00015550: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
+00015560: 2020 2020 736d 615f 6d69 6e75 7332 3020      sma_minus20 
+00015570: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
+00015580: 7461 2e68 6561 6428 6c65 6e28 6461 7461  ta.head(len(data
+00015590: 292d 3230 295b 2243 6c6f 7365 225d 2c20  )-20)["Close"], 
+000155a0: 7469 6d65 7065 7269 6f64 3d35 3029 0a20  timeperiod=50). 
+000155b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000155c0: 6f64 6179 5f6c 6d61 203d 2070 6b74 616c  oday_lma = pktal
+000155d0: 6962 2e53 4d41 2864 6174 615b 2243 6c6f  ib.SMA(data["Clo
+000155e0: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
+000155f0: 3d32 3030 290a 2020 2020 2020 2020 2020  =200).          
+00015600: 2020 2020 2020 6c6d 615f 6d69 6e75 7332        lma_minus2
+00015610: 3020 3d20 706b 7461 6c69 622e 534d 4128  0 = pktalib.SMA(
+00015620: 6461 7461 2e68 6561 6428 6c65 6e28 6461  data.head(len(da
+00015630: 7461 292d 3230 295b 2243 6c6f 7365 225d  ta)-20)["Close"]
+00015640: 2c20 7469 6d65 7065 7269 6f64 3d32 3030  , timeperiod=200
+00015650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015660: 2020 6c6d 615f 6d69 6e75 7338 3020 3d20    lma_minus80 = 
+00015670: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
+00015680: 2e68 6561 6428 6c65 6e28 6461 7461 292d  .head(len(data)-
+00015690: 3830 295b 2243 6c6f 7365 225d 2c20 7469  80)["Close"], ti
+000156a0: 6d65 7065 7269 6f64 3d32 3030 290a 2020  meperiod=200).  
+000156b0: 2020 2020 2020 2020 2020 2020 2020 6c6d                lm
+000156c0: 615f 6d69 6e75 7331 3030 203d 2070 6b74  a_minus100 = pkt
+000156d0: 616c 6962 2e53 4d41 2864 6174 612e 6865  alib.SMA(data.he
+000156e0: 6164 286c 656e 2864 6174 6129 2d31 3030  ad(len(data)-100
+000156f0: 295b 2243 6c6f 7365 225d 2c20 7469 6d65  )["Close"], time
+00015700: 7065 7269 6f64 3d32 3030 290a 2020 2020  period=200).    
+00015710: 2020 2020 2020 2020 2020 2020 746f 6461              toda
+00015720: 795f 6c6d 6120 3d20 746f 6461 795f 6c6d  y_lma = today_lm
+00015730: 612e 696c 6f63 5b6c 656e 2874 6f64 6179  a.iloc[len(today
+00015740: 5f6c 6d61 292d 315d 2069 6620 746f 6461  _lma)-1] if toda
+00015750: 795f 6c6d 6120 6973 206e 6f74 204e 6f6e  y_lma is not Non
+00015760: 6520 656c 7365 2030 0a20 2020 2020 2020  e else 0.       
+00015770: 2020 2020 2020 2020 206c 6d61 5f6d 696e           lma_min
+00015780: 7573 3230 203d 206c 6d61 5f6d 696e 7573  us20 = lma_minus
+00015790: 3230 2e69 6c6f 635b 6c65 6e28 6c6d 615f  20.iloc[len(lma_
+000157a0: 6d69 6e75 7332 3029 2d31 5d20 6966 206c  minus20)-1] if l
+000157b0: 6d61 5f6d 696e 7573 3230 2069 7320 6e6f  ma_minus20 is no
+000157c0: 7420 4e6f 6e65 2065 6c73 6520 300a 2020  t None else 0.  
+000157d0: 2020 2020 2020 2020 2020 2020 2020 6c6d                lm
+000157e0: 615f 6d69 6e75 7338 3020 3d20 6c6d 615f  a_minus80 = lma_
+000157f0: 6d69 6e75 7338 302e 696c 6f63 5b6c 656e  minus80.iloc[len
+00015800: 286c 6d61 5f6d 696e 7573 3830 292d 315d  (lma_minus80)-1]
+00015810: 2069 6620 6c6d 615f 6d69 6e75 7338 3020   if lma_minus80 
+00015820: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+00015830: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+00015840: 2020 206c 6d61 5f6d 696e 7573 3130 3020     lma_minus100 
+00015850: 3d20 6c6d 615f 6d69 6e75 7331 3030 2e69  = lma_minus100.i
+00015860: 6c6f 635b 6c65 6e28 6c6d 615f 6d69 6e75  loc[len(lma_minu
+00015870: 7331 3030 292d 315d 2069 6620 6c6d 615f  s100)-1] if lma_
+00015880: 6d69 6e75 7331 3030 2069 7320 6e6f 7420  minus100 is not 
+00015890: 4e6f 6e65 2065 6c73 6520 300a 2020 2020  None else 0.    
+000158a0: 2020 2020 2020 2020 2020 2020 746f 6461              toda
+000158b0: 795f 736d 6120 3d20 746f 6461 795f 736d  y_sma = today_sm
+000158c0: 612e 696c 6f63 5b6c 656e 2874 6f64 6179  a.iloc[len(today
+000158d0: 5f73 6d61 292d 315d 2069 6620 746f 6461  _sma)-1] if toda
+000158e0: 795f 736d 6120 6973 206e 6f74 204e 6f6e  y_sma is not Non
+000158f0: 6520 656c 7365 2030 0a20 2020 2020 2020  e else 0.       
+00015900: 2020 2020 2020 2020 2073 6d61 5f6d 696e           sma_min
+00015910: 7573 3920 3d20 736d 615f 6d69 6e75 7339  us9 = sma_minus9
+00015920: 2e69 6c6f 635b 6c65 6e28 736d 615f 6d69  .iloc[len(sma_mi
+00015930: 6e75 7339 292d 315d 2069 6620 736d 615f  nus9)-1] if sma_
+00015940: 6d69 6e75 7339 2069 7320 6e6f 7420 4e6f  minus9 is not No
+00015950: 6e65 2065 6c73 6520 300a 2020 2020 2020  ne else 0.      
+00015960: 2020 2020 2020 2020 2020 736d 615f 6d69            sma_mi
+00015970: 6e75 7331 3420 3d20 736d 615f 6d69 6e75  nus14 = sma_minu
+00015980: 7331 342e 696c 6f63 5b6c 656e 2873 6d61  s14.iloc[len(sma
+00015990: 5f6d 696e 7573 3134 292d 315d 2069 6620  _minus14)-1] if 
+000159a0: 736d 615f 6d69 6e75 7331 3420 6973 206e  sma_minus14 is n
+000159b0: 6f74 204e 6f6e 6520 656c 7365 2030 0a20  ot None else 0. 
+000159c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000159d0: 6d61 5f6d 696e 7573 3230 203d 2073 6d61  ma_minus20 = sma
+000159e0: 5f6d 696e 7573 3230 2e69 6c6f 635b 6c65  _minus20.iloc[le
+000159f0: 6e28 736d 615f 6d69 6e75 7332 3029 2d31  n(sma_minus20)-1
+00015a00: 5d20 6966 2073 6d61 5f6d 696e 7573 3230  ] if sma_minus20
+00015a10: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+00015a20: 6520 300a 2020 2020 2020 2020 2020 2020  e 0.            
+00015a30: 2020 2020 6973 5570 7472 656e 6420 3d20      isUptrend = 
+00015a40: 2874 6f64 6179 5f6c 6d61 203e 206c 6d61  (today_lma > lma
+00015a50: 5f6d 696e 7573 3230 2920 6f72 2028 746f  _minus20) or (to
+00015a60: 6461 795f 6c6d 6120 3e20 6c6d 615f 6d69  day_lma > lma_mi
+00015a70: 6e75 7338 3029 206f 7220 2874 6f64 6179  nus80) or (today
+00015a80: 5f6c 6d61 203e 206c 6d61 5f6d 696e 7573  _lma > lma_minus
+00015a90: 3130 3029 0a20 2020 2020 2020 2020 2020  100).           
+00015aa0: 2020 2020 2069 7344 6f77 6e74 7265 6e64       isDowntrend
+00015ab0: 203d 2028 746f 6461 795f 6c6d 6120 3c20   = (today_lma < 
+00015ac0: 6c6d 615f 6d69 6e75 7332 3029 2061 6e64  lma_minus20) and
+00015ad0: 2028 746f 6461 795f 6c6d 6120 3c20 6c6d   (today_lma < lm
+00015ae0: 615f 6d69 6e75 7338 3029 2061 6e64 2028  a_minus80) and (
+00015af0: 746f 6461 795f 6c6d 6120 3c20 6c6d 615f  today_lma < lma_
+00015b00: 6d69 6e75 7331 3030 290a 2020 2020 2020  minus100).      
+00015b10: 2020 2020 2020 2020 2020 6973 3530 444d            is50DM
+00015b20: 4155 7074 7265 6e64 203d 2028 746f 6461  AUptrend = (toda
+00015b30: 795f 736d 6120 3e20 736d 615f 6d69 6e75  y_sma > sma_minu
+00015b40: 7339 2920 6f72 2028 746f 6461 795f 736d  s9) or (today_sm
+00015b50: 6120 3e20 736d 615f 6d69 6e75 7331 3429  a > sma_minus14)
+00015b60: 206f 7220 2874 6f64 6179 5f73 6d61 203e   or (today_sma >
+00015b70: 2073 6d61 5f6d 696e 7573 3230 290a 2020   sma_minus20).  
+00015b80: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00015b90: 3530 444d 4144 6f77 6e74 7265 6e64 203d  50DMADowntrend =
+00015ba0: 2028 746f 6461 795f 736d 6120 3c20 736d   (today_sma < sm
+00015bb0: 615f 6d69 6e75 7339 2920 616e 6420 2874  a_minus9) and (t
+00015bc0: 6f64 6179 5f73 6d61 203c 2073 6d61 5f6d  oday_sma < sma_m
+00015bd0: 696e 7573 3134 2920 616e 6420 2874 6f64  inus14) and (tod
+00015be0: 6179 5f73 6d61 203c 2073 6d61 5f6d 696e  ay_sma < sma_min
+00015bf0: 7573 3230 290a 2020 2020 2020 2020 2020  us20).          
+00015c00: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00015c10: 6f6e 3a20 2023 2070 7261 676d 613a 206e  on:  # pragma: n
+00015c20: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00015c30: 2020 2020 2020 2020 2320 7365 6c66 2e64          # self.d
+00015c40: 6566 6175 6c74 5f6c 6f67 6765 722e 6465  efault_logger.de
+00015c50: 6275 6728 652c 2065 7863 5f69 6e66 6f3d  bug(e, exc_info=
+00015c60: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00015c70: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00015c80: 2020 2064 6563 6973 696f 6e20 3d20 2754     decision = 'T
+00015c90: 3ae2 96b2 2720 6966 2069 7355 7074 7265  :...' if isUptre
+00015ca0: 6e64 2065 6c73 6520 2827 543a e296 bc27  nd else ('T:...'
+00015cb0: 2069 6620 6973 446f 776e 7472 656e 6420   if isDowntrend 
+00015cc0: 656c 7365 2027 2729 0a20 2020 2020 2020  else '').       
+00015cd0: 2064 6d61 3530 6465 6369 7369 6f6e 203d   dma50decision =
+00015ce0: 2027 743a e296 b227 2069 6620 6973 3530   't:...' if is50
+00015cf0: 444d 4155 7074 7265 6e64 2065 6c73 6520  DMAUptrend else 
+00015d00: 2827 743a e296 bc27 2069 6620 6973 3530  ('t:...' if is50
+00015d10: 444d 4144 6f77 6e74 7265 6e64 2065 6c73  DMADowntrend els
+00015d20: 6520 2727 290a 2020 2020 2020 2020 6d66  e '').        mf
+00015d30: 5f69 6e73 745f 6f77 6e65 7273 6869 7043  _inst_ownershipC
+00015d40: 6861 6e67 6520 3d20 300a 2020 2020 2020  hange = 0.      
+00015d50: 2020 6368 616e 6765 5f6d 696c 6c69 6f6e    change_million
+00015d60: 7320 3d22 220a 2020 2020 2020 2020 6d66  s ="".        mf
+00015d70: 203d 2022 220a 2020 2020 2020 2020 6d66   = "".        mf
+00015d80: 7320 3d20 2222 0a20 2020 2020 2020 2069  s = "".        i
+00015d90: 6620 7265 6672 6573 684d 4641 6e64 4656  f refreshMFAndFV
+00015da0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+00015db0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00015dc0: 2020 206d 665f 696e 7374 5f6f 776e 6572     mf_inst_owner
+00015dd0: 7368 6970 4368 616e 6765 203d 2073 656c  shipChange = sel
+00015de0: 662e 6765 744d 7574 7561 6c46 756e 6453  f.getMutualFundS
+00015df0: 7461 7475 7328 7374 6f63 6b2c 6f6e 6c79  tatus(stock,only
+00015e00: 4d46 3d6f 6e6c 794d 462c 686f 7374 4461  MF=onlyMF,hostDa
+00015e10: 7461 3d68 6f73 7444 6174 612c 666f 7263  ta=hostData,forc
+00015e20: 653d 2868 6f73 7444 6174 6120 6973 204e  e=(hostData is N
+00015e30: 6f6e 6520 6f72 2068 6f73 7444 6174 612e  one or hostData.
+00015e40: 656d 7074 7920 6f72 206e 6f74 2028 224d  empty or not ("M
+00015e50: 4622 2069 6e20 686f 7374 4461 7461 2e63  F" in hostData.c
+00015e60: 6f6c 756d 6e73 206f 7220 2246 4949 2220  olumns or "FII" 
+00015e70: 696e 2068 6f73 7444 6174 612e 636f 6c75  in hostData.colu
+00015e80: 6d6e 7329 292c 6578 6368 616e 6765 4e61  mns)),exchangeNa
+00015e90: 6d65 3d65 7863 6861 6e67 654e 616d 6529  me=exchangeName)
+00015ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015eb0: 2069 6620 6973 696e 7374 616e 6365 286d   if isinstance(m
+00015ec0: 665f 696e 7374 5f6f 776e 6572 7368 6970  f_inst_ownership
+00015ed0: 4368 616e 6765 2c20 7064 2e53 6572 6965  Change, pd.Serie
+00015ee0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00015ef0: 2020 2020 2020 2020 6d66 5f69 6e73 745f          mf_inst_
+00015f00: 6f77 6e65 7273 6869 7043 6861 6e67 6520  ownershipChange 
+00015f10: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00015f20: 2020 2020 726f 756e 644f 6666 203d 2032      roundOff = 2
+00015f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015f40: 206d 696c 6c69 6f6e 7320 3d20 726f 756e   millions = roun
+00015f50: 6428 6d66 5f69 6e73 745f 6f77 6e65 7273  d(mf_inst_owners
+00015f60: 6869 7043 6861 6e67 652f 3130 3030 3030  hipChange/100000
+00015f70: 302c 726f 756e 644f 6666 290a 2020 2020  0,roundOff).    
+00015f80: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00015f90: 6520 666c 6f61 7428 6d69 6c6c 696f 6e73  e float(millions
+00015fa0: 2920 3d3d 2030 2061 6e64 2072 6f75 6e64  ) == 0 and round
+00015fb0: 4f66 6620 3c3d 353a 0a20 2020 2020 2020  Off <=5:.       
+00015fc0: 2020 2020 2020 2020 2020 2020 2072 6f75               rou
+00015fd0: 6e64 4f66 6620 2b3d 310a 2020 2020 2020  ndOff +=1.      
+00015fe0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00015ff0: 6c6c 696f 6e73 203d 2072 6f75 6e64 286d  llions = round(m
+00016000: 665f 696e 7374 5f6f 776e 6572 7368 6970  f_inst_ownership
+00016010: 4368 616e 6765 2f31 3030 3030 3030 2c72  Change/1000000,r
+00016020: 6f75 6e64 4f66 6629 0a20 2020 2020 2020  oundOff).       
+00016030: 2020 2020 2020 2020 2063 6861 6e67 655f           change_
+00016040: 6d69 6c6c 696f 6e73 203d 2066 2228 7b6d  millions = f"({m
+00016050: 696c 6c69 6f6e 737d 4d29 220a 2020 2020  illions}M)".    
+00016060: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00016070: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+00016080: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+00016090: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+000160a0: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+000160b0: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+000160c0: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+000160d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000160e0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+000160f0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00016100: 2020 2020 2023 4c65 7427 7320 6765 7420       #Let's get 
+00016110: 7468 6520 6661 6972 2076 616c 7565 2c20  the fair value, 
+00016120: 6569 7468 6572 2073 6176 6564 206f 7220  either saved or 
+00016130: 6672 6573 6820 6672 6f6d 2073 6572 7669  fresh from servi
+00016140: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00016150: 2020 2066 6169 7256 616c 7565 203d 2073     fairValue = s
+00016160: 656c 662e 6765 7446 6169 7256 616c 7565  elf.getFairValue
+00016170: 2873 746f 636b 2c68 6f73 7444 6174 612c  (stock,hostData,
+00016180: 666f 7263 653d 2868 6f73 7444 6174 6120  force=(hostData 
+00016190: 6973 204e 6f6e 6520 6f72 2068 6f73 7444  is None or hostD
+000161a0: 6174 612e 656d 7074 7920 6f72 2022 4661  ata.empty or "Fa
+000161b0: 6972 5661 6c75 6522 206e 6f74 2069 6e20  irValue" not in 
+000161c0: 686f 7374 4461 7461 2e63 6f6c 756d 6e73  hostData.columns
+000161d0: 292c 6578 6368 616e 6765 4e61 6d65 3d65  ),exchangeName=e
+000161e0: 7863 6861 6e67 654e 616d 6529 0a20 2020  xchangeName).   
+000161f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016200: 6661 6972 5661 6c75 6520 6973 206e 6f74  fairValue is not
+00016210: 204e 6f6e 6520 616e 6420 6661 6972 5661   None and fairVa
+00016220: 6c75 6520 213d 2030 3a0a 2020 2020 2020  lue != 0:.      
+00016230: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
+00016240: 7020 3d20 7361 7665 4469 6374 5b22 4c54  p = saveDict["LT
+00016250: 5022 5d0a 2020 2020 2020 2020 2020 2020  P"].            
+00016260: 2020 2020 2020 2020 6661 6972 5661 6c75          fairValu
+00016270: 6544 6966 6620 3d20 726f 756e 6428 6661  eDiff = round(fa
+00016280: 6972 5661 6c75 6520 2d20 6c74 702c 3029  irValue - ltp,0)
+00016290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000162a0: 2020 2020 2073 6176 6544 6963 745b 2246       saveDict["F
+000162b0: 6169 7256 616c 7565 225d 203d 2073 7472  airValue"] = str
+000162c0: 2866 6169 7256 616c 7565 290a 2020 2020  (fairValue).    
+000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162e0: 7361 7665 4469 6374 5b22 4656 4469 6666  saveDict["FVDiff
+000162f0: 225d 203d 2066 6169 7256 616c 7565 4469  "] = fairValueDi
+00016300: 6666 0a20 2020 2020 2020 2020 2020 2020  ff.             
+00016310: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00016320: 745b 2246 5644 6966 6622 5d20 3d20 6661  t["FVDiff"] = fa
+00016330: 6972 5661 6c75 6544 6966 660a 2020 2020  irValueDiff.    
+00016340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016350: 7363 7265 656e 4469 6374 5b22 4661 6972  screenDict["Fair
+00016360: 5661 6c75 6522 5d20 3d20 2863 6f6c 6f72  Value"] = (color
+00016370: 5465 7874 2e47 5245 454e 2069 6620 6661  Text.GREEN if fa
+00016380: 6972 5661 6c75 6520 3e3d 206c 7470 2065  irValue >= ltp e
+00016390: 6c73 6520 636f 6c6f 7254 6578 742e 4641  lse colorText.FA
+000163a0: 494c 2920 2b20 7361 7665 4469 6374 5b22  IL) + saveDict["
+000163b0: 4661 6972 5661 6c75 6522 5d20 2b20 636f  FairValue"] + co
+000163c0: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+000163d0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000163e0: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+000163f0: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+00016400: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+00016410: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
+00016420: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
+00016430: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
+00016440: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016450: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00016460: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016470: 6d66 5f69 6e73 745f 6f77 6e65 7273 6869  mf_inst_ownershi
+00016480: 7043 6861 6e67 6520 3e20 303a 0a20 2020  pChange > 0:.   
+00016490: 2020 2020 2020 2020 2020 2020 206d 6620               mf 
+000164a0: 3d20 6622 4d46 493a e296 b220 7b63 6861  = f"MFI:... {cha
+000164b0: 6e67 655f 6d69 6c6c 696f 6e73 7d22 0a20  nge_millions}". 
+000164c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000164d0: 6673 203d 2063 6f6c 6f72 5465 7874 2e47  fs = colorText.G
+000164e0: 5245 454e 202b 206d 6620 2b20 636f 6c6f  REEN + mf + colo
+000164f0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+00016500: 2020 2020 2020 656c 6966 206d 665f 696e        elif mf_in
+00016510: 7374 5f6f 776e 6572 7368 6970 4368 616e  st_ownershipChan
+00016520: 6765 203c 2030 3a0a 2020 2020 2020 2020  ge < 0:.        
+00016530: 2020 2020 2020 2020 6d66 203d 2066 224d          mf = f"M
+00016540: 4649 3ae2 96bc 207b 6368 616e 6765 5f6d  FI:... {change_m
+00016550: 696c 6c69 6f6e 737d 220a 2020 2020 2020  illions}".      
+00016560: 2020 2020 2020 2020 2020 6d66 7320 3d20            mfs = 
+00016570: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+00016580: 206d 6620 2b20 636f 6c6f 7254 6578 742e   mf + colorText.
+00016590: 454e 440a 0a20 2020 2020 2020 2073 6176  END..        sav
+000165a0: 6564 203d 2073 656c 662e 6669 6e64 4375  ed = self.findCu
+000165b0: 7272 656e 7453 6176 6564 5661 6c75 6528  rrentSavedValue(
+000165c0: 7363 7265 656e 4469 6374 2c73 6176 6544  screenDict,saveD
+000165d0: 6963 742c 2254 7265 6e64 2229 0a20 2020  ict,"Trend").   
+000165e0: 2020 2020 2064 6563 6973 696f 6e5f 7363       decision_sc
+000165f0: 7220 3d20 2863 6f6c 6f72 5465 7874 2e47  r = (colorText.G
+00016600: 5245 454e 2069 6620 6973 5570 7472 656e  REEN if isUptren
+00016610: 6420 656c 7365 2028 636f 6c6f 7254 6578  d else (colorTex
+00016620: 742e 4641 494c 2069 6620 6973 446f 776e  t.FAIL if isDown
+00016630: 7472 656e 6420 656c 7365 2063 6f6c 6f72  trend else color
+00016640: 5465 7874 2e57 4152 4e29 2920 2b20 6622  Text.WARN)) + f"
+00016650: 7b64 6563 6973 696f 6e7d 2220 2b20 636f  {decision}" + co
+00016660: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00016670: 2020 2020 646d 6135 3064 6563 6973 696f      dma50decisio
+00016680: 6e5f 7363 7220 3d20 2863 6f6c 6f72 5465  n_scr = (colorTe
+00016690: 7874 2e47 5245 454e 2069 6620 6973 3530  xt.GREEN if is50
+000166a0: 444d 4155 7074 7265 6e64 2065 6c73 6520  DMAUptrend else 
+000166b0: 2863 6f6c 6f72 5465 7874 2e46 4149 4c20  (colorText.FAIL 
+000166c0: 6966 2069 7335 3044 4d41 446f 776e 7472  if is50DMADowntr
+000166d0: 656e 6420 656c 7365 2063 6f6c 6f72 5465  end else colorTe
+000166e0: 7874 2e57 4152 4e29 2920 2b20 6622 7b64  xt.WARN)) + f"{d
+000166f0: 6d61 3530 6465 6369 7369 6f6e 7d22 202b  ma50decision}" +
+00016700: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00016710: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00016720: 2254 7265 6e64 225d 203d 2066 227b 7361  "Trend"] = f"{sa
+00016730: 7665 645b 315d 7d20 7b64 6563 6973 696f  ved[1]} {decisio
+00016740: 6e7d 207b 646d 6135 3064 6563 6973 696f  n} {dma50decisio
+00016750: 6e7d 207b 6d66 7d22 0a20 2020 2020 2020  n} {mf}".       
+00016760: 2073 6372 6565 6e44 6963 745b 2254 7265   screenDict["Tre
+00016770: 6e64 225d 203d 2066 227b 7361 7665 645b  nd"] = f"{saved[
+00016780: 305d 7d20 7b64 6563 6973 696f 6e5f 7363  0]} {decision_sc
+00016790: 727d 207b 646d 6135 3064 6563 6973 696f  r} {dma50decisio
+000167a0: 6e5f 7363 727d 207b 6d66 737d 220a 2020  n_scr} {mfs}".  
+000167b0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+000167c0: 4d46 4922 5d20 3d20 6d66 5f69 6e73 745f  MFI"] = mf_inst_
+000167d0: 6f77 6e65 7273 6869 7043 6861 6e67 650a  ownershipChange.
+000167e0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+000167f0: 6374 5b22 4d46 4922 5d20 3d20 6d66 5f69  ct["MFI"] = mf_i
+00016800: 6e73 745f 6f77 6e65 7273 6869 7043 6861  nst_ownershipCha
+00016810: 6e67 650a 2020 2020 2020 2020 7265 7475  nge.        retu
+00016820: 726e 2069 7355 7074 7265 6e64 2c20 6d66  rn isUptrend, mf
+00016830: 5f69 6e73 745f 6f77 6e65 7273 6869 7043  _inst_ownershipC
+00016840: 6861 6e67 652c 2066 6169 7256 616c 7565  hange, fairValue
+00016850: 4469 6666 0a20 2020 200a 2020 2020 2320  Diff.    .    # 
+00016860: 5072 6976 6174 6520 6d65 7468 6f64 2074  Private method t
+00016870: 6f20 6669 6e64 2063 616e 646c 6520 7479  o find candle ty
+00016880: 7065 0a20 2020 2023 2054 7275 6520 3d20  pe.    # True = 
+00016890: 4275 6c6c 6973 682c 2046 616c 7365 203d  Bullish, False =
+000168a0: 2042 6561 7269 7368 0a20 2020 2064 6566   Bearish.    def
+000168b0: 2067 6574 4361 6e64 6c65 5479 7065 2873   getCandleType(s
+000168c0: 656c 662c 2064 6169 6c79 4461 7461 293a  elf, dailyData):
+000168d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000168e0: 626f 6f6c 2864 6169 6c79 4461 7461 5b22  bool(dailyData["
+000168f0: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+00016900: 3e3d 2064 6169 6c79 4461 7461 5b22 4f70  >= dailyData["Op
+00016910: 656e 225d 2e69 6c6f 635b 305d 290a 0a20  en"].iloc[0]).. 
+00016920: 2020 2064 6566 2067 6574 4361 6e64 6c65     def getCandle
+00016930: 426f 6479 4865 6967 6874 2873 656c 662c  BodyHeight(self,
+00016940: 2064 6169 6c79 4461 7461 293a 0a20 2020   dailyData):.   
+00016950: 2020 2020 2062 6f64 7948 6569 6768 7420       bodyHeight 
+00016960: 3d20 6461 696c 7944 6174 615b 2243 6c6f  = dailyData["Clo
+00016970: 7365 225d 2e69 6c6f 635b 305d 202d 2064  se"].iloc[0] - d
+00016980: 6169 6c79 4461 7461 5b22 4f70 656e 225d  ailyData["Open"]
+00016990: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+000169a0: 2072 6574 7572 6e20 626f 6479 4865 6967   return bodyHeig
+000169b0: 6874 0a0a 2020 2020 6465 6620 6765 7446  ht..    def getF
+000169c0: 6169 7256 616c 7565 2873 656c 662c 2073  airValue(self, s
+000169d0: 746f 636b 2c20 686f 7374 4461 7461 3d4e  tock, hostData=N
+000169e0: 6f6e 652c 2066 6f72 6365 3d46 616c 7365  one, force=False
+000169f0: 2c65 7863 6861 6e67 654e 616d 653d 2249  ,exchangeName="I
+00016a00: 4e44 4941 2229 3a0a 2020 2020 2020 2020  NDIA"):.        
+00016a10: 6966 2068 6f73 7444 6174 6120 6973 204e  if hostData is N
+00016a20: 6f6e 6520 6f72 206c 656e 2868 6f73 7444  one or len(hostD
+00016a30: 6174 6129 203c 2031 3a0a 2020 2020 2020  ata) < 1:.      
+00016a40: 2020 2020 2020 686f 7374 4461 7461 203d        hostData =
+00016a50: 2070 642e 4461 7461 4672 616d 6528 290a   pd.DataFrame().
+00016a60: 2020 2020 2020 2020 2320 4c65 7427 7320          # Let's 
+00016a70: 6c6f 6f6b 2066 6f72 2066 6169 7220 7661  look for fair va
+00016a80: 6c75 6573 0a20 2020 2020 2020 2066 6169  lues.        fai
+00016a90: 7256 616c 7565 203d 2030 0a20 2020 2020  rValue = 0.     
+00016aa0: 2020 2069 6620 2246 6169 7256 616c 7565     if "FairValue
+00016ab0: 2220 696e 2068 6f73 7444 6174 612e 636f  " in hostData.co
+00016ac0: 6c75 6d6e 7320 616e 6420 504b 4461 7465  lumns and PKDate
+00016ad0: 5574 696c 6974 6965 732e 6375 7272 656e  Utilities.curren
+00016ae0: 7444 6174 6554 696d 6528 292e 7765 656b  tDateTime().week
+00016af0: 6461 7928 2920 3c3d 2034 3a0a 2020 2020  day() <= 4:.    
+00016b00: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00016b10: 2020 2020 2020 2020 2020 2020 2066 6169               fai
+00016b20: 7256 616c 7565 203d 2068 6f73 7444 6174  rValue = hostDat
+00016b30: 612e 6c6f 635b 686f 7374 4461 7461 2e69  a.loc[hostData.i
+00016b40: 6e64 6578 5b2d 315d 2c22 4661 6972 5661  ndex[-1],"FairVa
+00016b50: 6c75 6522 5d0a 2020 2020 2020 2020 2020  lue"].          
+00016b60: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00016b70: 6f72 2c49 6e64 6578 4572 726f 7229 3a0a  or,IndexError):.
+00016b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b90: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00016ba0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016bb0: 2020 2069 6620 504b 4461 7465 5574 696c     if PKDateUtil
+00016bc0: 6974 6965 732e 6375 7272 656e 7444 6174  ities.currentDat
+00016bd0: 6554 696d 6528 292e 7765 656b 6461 7928  eTime().weekday(
+00016be0: 2920 3e3d 2035 206f 7220 666f 7263 653a  ) >= 5 or force:
+00016bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c00: 2073 6563 7572 6974 7920 3d20 4e6f 6e65   security = None
+00016c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c20: 2023 2052 6566 7265 7368 2065 6163 6820   # Refresh each 
+00016c30: 7361 7475 7264 6179 206f 7220 7375 6e64  saturday or sund
+00016c40: 6179 206f 7220 7768 656e 206e 6f74 2066  ay or when not f
+00016c50: 6f75 6e64 2069 6e20 7361 7665 6420 6461  ound in saved da
+00016c60: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
+00016c70: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00016c80: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00016c90: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
+00016ca0: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
+00016cb0: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
+00016cc0: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ce0: 2020 2020 2073 6563 7572 6974 7920 3d20       security = 
+00016cf0: 5374 6f63 6b28 7374 6f63 6b2c 6578 6368  Stock(stock,exch
+00016d00: 616e 6765 3d65 7863 6861 6e67 654e 616d  ange=exchangeNam
+00016d10: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00016d20: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
+00016d30: 7272 6f72 3a20 2320 7072 6167 6d61 3a20  rror: # pragma: 
+00016d40: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
+00016d50: 2020 2020 2020 2020 2020 2020 2023 2057               # W
+00016d60: 6520 6469 6420 6e6f 7420 6669 6e64 2074  e did not find t
+00016d70: 6865 2073 746f 636b 3f20 4974 2773 206f  he stock? It's o
+00016d80: 6b61 792e 204d 6f76 6520 6f6e 2074 6f20  kay. Move on to 
+00016d90: 7468 6520 6e65 7874 206f 6e65 2e0a 2020  the next one..  
+00016da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016db0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+00016dc0: 2020 2020 2020 2065 7863 6570 7420 2854         except (T
+00016dd0: 696d 656f 7574 4572 726f 722c 2043 6f6e  imeoutError, Con
+00016de0: 6e65 6374 696f 6e45 7272 6f72 2920 6173  nectionError) as
+00016df0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00016e00: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
+00016e10: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
+00016e20: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
+00016e30: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00016e40: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00016e50: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00016e60: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00016e70: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00016e80: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
+00016e90: 6175 6c74 5f6c 6f67 6765 722e 6465 6275  ault_logger.debu
+00016ea0: 6728 652c 2065 7863 5f69 6e66 6f3d 5472  g(e, exc_info=Tr
+00016eb0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00016ec0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00016ed0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016ee0: 7365 6375 7269 7479 2069 7320 6e6f 7420  security is not 
+00016ef0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00016f00: 2020 2020 2020 2020 2020 7769 7468 2053            with S
+00016f10: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
+00016f20: 7070 7265 7373 5f73 7464 6572 723d 5472  ppress_stderr=Tr
+00016f30: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
+00016f40: 6f75 743d 5472 7565 293a 0a20 2020 2020  out=True):.     
+00016f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f60: 2020 2066 7620 3d20 7365 6375 7269 7479     fv = security
+00016f70: 2e66 6169 7256 616c 7565 2829 0a20 2020  .fairValue().   
+00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f90: 2069 6620 6676 2069 7320 6e6f 7420 4e6f   if fv is not No
+00016fa0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00016fb0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00016fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016fd0: 2020 2020 2020 2020 2020 2020 2066 7652               fvR
+00016fe0: 6573 706f 6e73 6556 616c 7565 203d 2066  esponseValue = f
+00016ff0: 765b 226c 6174 6573 7446 6169 7256 616c  v["latestFairVal
+00017000: 7565 225d 0a20 2020 2020 2020 2020 2020  ue"].           
+00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017020: 2069 6620 6676 5265 7370 6f6e 7365 5661   if fvResponseVa
+00017030: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
+00017040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017060: 2066 6169 7256 616c 7565 203d 2066 6c6f   fairValue = flo
+00017070: 6174 2866 7652 6573 706f 6e73 6556 616c  at(fvResponseVal
+00017080: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00017090: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+000170a0: 7074 3a20 2320 7072 6167 6d61 3a20 6e6f  pt: # pragma: no
+000170b0: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170d0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+000170e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170f0: 2020 2020 2320 7365 6c66 2e64 6566 6175      # self.defau
+00017100: 6c74 5f6c 6f67 6765 722e 6465 6275 6728  lt_logger.debug(
+00017110: 6622 7b65 7d5c 6e52 6573 706f 6e73 653a  f"{e}\nResponse:
+00017120: 6676 3a5c 6e7b 6676 7d22 2c20 6578 635f  fv:\n{fv}", exc_
+00017130: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+00017140: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00017150: 6169 7256 616c 7565 203d 2072 6f75 6e64  airValue = round
+00017160: 2866 6c6f 6174 2866 6169 7256 616c 7565  (float(fairValue
+00017170: 292c 3129 0a20 2020 2020 2020 2020 2020  ),1).           
+00017180: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00017190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171a0: 2020 2020 2020 686f 7374 4461 7461 2e6c        hostData.l
+000171b0: 6f63 5b68 6f73 7444 6174 612e 696e 6465  oc[hostData.inde
+000171c0: 785b 2d31 5d2c 2246 6169 7256 616c 7565  x[-1],"FairValue
+000171d0: 225d 203d 2066 6169 7256 616c 7565 0a20  "] = fairValue. 
+000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171f0: 2020 2065 7863 6570 7420 284b 6579 4572     except (KeyEr
+00017200: 726f 722c 496e 6465 7845 7272 6f72 293a  ror,IndexError):
+00017210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017220: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00017230: 2020 2020 2020 7265 7475 726e 2066 6169        return fai
+00017240: 7256 616c 7565 0a0a 2020 2020 6465 6620  rValue..    def 
+00017250: 6765 744d 7574 7561 6c46 756e 6453 7461  getMutualFundSta
+00017260: 7475 7328 7365 6c66 2c20 7374 6f63 6b2c  tus(self, stock,
+00017270: 6f6e 6c79 4d46 3d46 616c 7365 2c20 686f  onlyMF=False, ho
+00017280: 7374 4461 7461 3d4e 6f6e 652c 2066 6f72  stData=None, for
+00017290: 6365 3d46 616c 7365 2c65 7863 6861 6e67  ce=False,exchang
+000172a0: 654e 616d 653d 2249 4e44 4941 2229 3a0a  eName="INDIA"):.
+000172b0: 2020 2020 2020 2020 6966 2068 6f73 7444          if hostD
+000172c0: 6174 6120 6973 204e 6f6e 6520 6f72 206c  ata is None or l
+000172d0: 656e 2868 6f73 7444 6174 6129 203c 2031  en(hostData) < 1
+000172e0: 3a0a 2020 2020 2020 2020 2020 2020 686f  :.            ho
+000172f0: 7374 4461 7461 203d 2070 642e 4461 7461  stData = pd.Data
+00017300: 4672 616d 6528 290a 2020 2020 2020 2020  Frame().        
+00017310: 0a20 2020 2020 2020 206e 6574 4368 616e  .        netChan
+00017320: 6765 4d46 203d 2030 0a20 2020 2020 2020  geMF = 0.       
+00017330: 206e 6574 4368 616e 6765 496e 7374 203d   netChangeInst =
+00017340: 2030 0a20 2020 2020 2020 206c 6174 6573   0.        lates
+00017350: 745f 6d66 6461 7465 203d 204e 6f6e 650a  t_mfdate = None.
+00017360: 2020 2020 2020 2020 6c61 7465 7374 5f69          latest_i
+00017370: 6e73 7464 6174 6520 3d20 4e6f 6e65 0a20  nstdate = None. 
+00017380: 2020 2020 2020 206e 6565 6473 4672 6573         needsFres
+00017390: 6855 7064 6174 6520 3d20 5472 7565 0a20  hUpdate = True. 
+000173a0: 2020 2020 2020 206c 6173 7444 6179 4c61         lastDayLa
+000173b0: 7374 4d6f 6e74 6820 3d20 504b 4461 7465  stMonth = PKDate
+000173c0: 5574 696c 6974 6965 732e 6c61 7374 5f64  Utilities.last_d
+000173d0: 6179 5f6f 665f 7072 6576 696f 7573 5f6d  ay_of_previous_m
+000173e0: 6f6e 7468 2850 4b44 6174 6555 7469 6c69  onth(PKDateUtili
+000173f0: 7469 6573 2e63 7572 7265 6e74 4461 7465  ties.currentDate
+00017400: 5469 6d65 2829 290a 2020 2020 2020 2020  Time()).        
+00017410: 6966 2068 6f73 7444 6174 6120 6973 206e  if hostData is n
+00017420: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
+00017430: 686f 7374 4461 7461 2920 3e20 303a 0a20  hostData) > 0:. 
+00017440: 2020 2020 2020 2020 2020 2069 6620 224d             if "M
+00017450: 4622 2069 6e20 686f 7374 4461 7461 2e63  F" in hostData.c
+00017460: 6f6c 756d 6e73 206f 7220 2246 4949 2220  olumns or "FII" 
+00017470: 696e 2068 6f73 7444 6174 612e 636f 6c75  in hostData.colu
+00017480: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+00017490: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000174a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000174b0: 7443 6861 6e67 654d 4620 3d20 686f 7374  tChangeMF = host
+000174c0: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
+000174d0: 612e 696e 6465 785b 2d31 5d2c 224d 4622  a.index[-1],"MF"
+000174e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000174f0: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00017500: 6f72 2c49 6e64 6578 4572 726f 7229 3a0a  or,IndexError):.
+00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017520: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00017530: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017550: 2020 6e65 7443 6861 6e67 6549 6e73 7420    netChangeInst 
+00017560: 3d20 686f 7374 4461 7461 2e6c 6f63 5b68  = hostData.loc[h
+00017570: 6f73 7444 6174 612e 696e 6465 785b 2d31  ostData.index[-1
+00017580: 5d2c 2246 4949 225d 0a20 2020 2020 2020  ],"FII"].       
+00017590: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000175a0: 284b 6579 4572 726f 722c 496e 6465 7845  (KeyError,IndexE
+000175b0: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+000175c0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+000175d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000175f0: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
+00017600: 6d66 6461 7465 203d 2068 6f73 7444 6174  mfdate = hostDat
+00017610: 612e 6c6f 635b 686f 7374 4461 7461 2e69  a.loc[hostData.i
+00017620: 6e64 6578 5b2d 315d 2c22 4d46 5f44 6174  ndex[-1],"MF_Dat
+00017630: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
+00017640: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00017650: 7461 6e63 6528 6c61 7465 7374 5f6d 6664  tance(latest_mfd
+00017660: 6174 652c 2066 6c6f 6174 293a 0a20 2020  ate, float):.   
 00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017680: 2020 2073 6176 6564 5f69 6e73 7464 6174     saved_instdat
-00017690: 6520 3d20 504b 4461 7465 5574 696c 6974  e = PKDateUtilit
-000176a0: 6965 732e 6461 7465 4672 6f6d 596d 6453  ies.dateFromYmdS
-000176b0: 7472 696e 6728 6c61 7465 7374 5f69 6e73  tring(latest_ins
-000176c0: 7464 6174 652e 7370 6c69 7428 2254 2229  tdate.split("T")
-000176d0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-000176e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000176f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017700: 6176 6564 5f69 6e73 7464 6174 6520 3d20  aved_instdate = 
-00017710: 6c61 7374 4461 794c 6173 744d 6f6e 7468  lastDayLastMonth
-00017720: 202d 2064 6174 6574 696d 652e 7469 6d65   - datetime.time
-00017730: 6465 6c74 6128 3129 0a20 2020 2020 2020  delta(1).       
-00017740: 2020 2020 2020 2020 2074 6f64 6179 203d           today =
-00017750: 2050 4b44 6174 6555 7469 6c69 7469 6573   PKDateUtilities
-00017760: 2e63 7572 7265 6e74 4461 7465 5469 6d65  .currentDateTime
-00017770: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00017780: 2020 206e 6565 6473 4672 6573 6855 7064     needsFreshUpd
-00017790: 6174 6520 3d20 2873 6176 6564 5f6d 6664  ate = (saved_mfd
-000177a0: 6174 652e 6461 7465 2829 203c 206c 6173  ate.date() < las
-000177b0: 7444 6179 4c61 7374 4d6f 6e74 682e 6461  tDayLastMonth.da
-000177c0: 7465 2829 2920 616e 6420 2873 6176 6564  te()) and (saved
-000177d0: 5f69 6e73 7464 6174 652e 6461 7465 2829  _instdate.date()
-000177e0: 203c 206c 6173 7444 6179 4c61 7374 4d6f   < lastDayLastMo
-000177f0: 6e74 682e 6461 7465 2829 290a 2020 2020  nth.date()).    
-00017800: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00017810: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00017820: 6564 7346 7265 7368 5570 6461 7465 203d  edsFreshUpdate =
-00017830: 2054 7275 650a 0a20 2020 2020 2020 2069   True..        i
-00017840: 6620 6e65 6564 7346 7265 7368 5570 6461  f needsFreshUpda
-00017850: 7465 2061 6e64 2066 6f72 6365 3a0a 2020  te and force:.  
-00017860: 2020 2020 2020 2020 2020 6e65 7443 6861            netCha
-00017870: 6e67 654d 462c 206e 6574 4368 616e 6765  ngeMF, netChange
-00017880: 496e 7374 2c20 6c61 7465 7374 5f6d 6664  Inst, latest_mfd
-00017890: 6174 652c 206c 6174 6573 745f 696e 7374  ate, latest_inst
-000178a0: 6461 7465 203d 2073 656c 662e 6765 7446  date = self.getF
-000178b0: 7265 7368 4d46 4953 7461 7475 7328 7374  reshMFIStatus(st
-000178c0: 6f63 6b2c 6578 6368 616e 6765 4e61 6d65  ock,exchangeName
-000178d0: 3d65 7863 6861 6e67 654e 616d 6529 0a20  =exchangeName). 
-000178e0: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
-000178f0: 7443 6861 6e67 654d 4620 6973 206e 6f74  tChangeMF is not
-00017900: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00017910: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00017680: 2020 2020 206c 6174 6573 745f 6d66 6461       latest_mfda
+00017690: 7465 203d 2064 6174 6574 696d 652e 6461  te = datetime.da
+000176a0: 7465 7469 6d65 2e66 726f 6d74 696d 6573  tetime.fromtimes
+000176b0: 7461 6d70 286c 6174 6573 745f 6d66 6461  tamp(latest_mfda
+000176c0: 7465 292e 7374 7266 7469 6d65 2827 2559  te).strftime('%Y
+000176d0: 2d25 6d2d 2564 2729 0a20 2020 2020 2020  -%m-%d').       
+000176e0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000176f0: 284b 6579 4572 726f 722c 496e 6465 7845  (KeyError,IndexE
+00017700: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00017710: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00017720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017730: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00017740: 2020 2020 2020 2020 206c 6174 6573 745f           latest_
+00017750: 696e 7374 6461 7465 203d 2068 6f73 7444  instdate = hostD
+00017760: 6174 612e 6c6f 635b 686f 7374 4461 7461  ata.loc[hostData
+00017770: 2e69 6e64 6578 5b2d 315d 2c22 4649 495f  .index[-1],"FII_
+00017780: 4461 7465 225d 0a20 2020 2020 2020 2020  Date"].         
+00017790: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000177a0: 696e 7374 616e 6365 286c 6174 6573 745f  instance(latest_
+000177b0: 696e 7374 6461 7465 2c20 666c 6f61 7429  instdate, float)
+000177c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000177d0: 2020 2020 2020 2020 2020 6c61 7465 7374            latest
+000177e0: 5f69 6e73 7464 6174 6520 3d20 6461 7465  _instdate = date
+000177f0: 7469 6d65 2e64 6174 6574 696d 652e 6672  time.datetime.fr
+00017800: 6f6d 7469 6d65 7374 616d 7028 6c61 7465  omtimestamp(late
+00017810: 7374 5f69 6e73 7464 6174 6529 2e73 7472  st_instdate).str
+00017820: 6674 696d 6528 2725 592d 256d 2d25 6427  ftime('%Y-%m-%d'
+00017830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017840: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
+00017850: 6f72 2c49 6e64 6578 4572 726f 7229 3a0a  or,IndexError):.
+00017860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017870: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00017880: 2020 2020 2020 2020 2069 6620 6c61 7465           if late
+00017890: 7374 5f6d 6664 6174 6520 6973 206e 6f74  st_mfdate is not
+000178a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000178b0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+000178c0: 5f6d 6664 6174 6520 3d20 504b 4461 7465  _mfdate = PKDate
+000178d0: 5574 696c 6974 6965 732e 6461 7465 4672  Utilities.dateFr
+000178e0: 6f6d 596d 6453 7472 696e 6728 6c61 7465  omYmdString(late
+000178f0: 7374 5f6d 6664 6174 652e 7370 6c69 7428  st_mfdate.split(
+00017900: 2254 2229 5b30 5d29 0a20 2020 2020 2020  "T")[0]).       
+00017910: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 00017920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017930: 686f 7374 4461 7461 2e6c 6f63 5b68 6f73  hostData.loc[hos
-00017940: 7444 6174 612e 696e 6465 785b 2d31 5d2c  tData.index[-1],
-00017950: 224d 4622 5d20 3d20 6e65 7443 6861 6e67  "MF"] = netChang
-00017960: 654d 460a 2020 2020 2020 2020 2020 2020  eMF.            
-00017970: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
-00017980: 7272 6f72 2c49 6e64 6578 4572 726f 7229  rror,IndexError)
-00017990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000179a0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-000179b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000179c0: 2020 2020 2020 2020 2020 2020 206e 6574               net
-000179d0: 4368 616e 6765 4d46 203d 2030 0a20 2020  ChangeMF = 0.   
-000179e0: 2020 2020 2020 2020 2069 6620 6c61 7465           if late
-000179f0: 7374 5f6d 6664 6174 6520 6973 206e 6f74  st_mfdate is not
-00017a00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00017a10: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00017a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a30: 686f 7374 4461 7461 2e6c 6f63 5b68 6f73  hostData.loc[hos
-00017a40: 7444 6174 612e 696e 6465 785b 2d31 5d2c  tData.index[-1],
-00017a50: 224d 465f 4461 7465 225d 203d 206c 6174  "MF_Date"] = lat
-00017a60: 6573 745f 6d66 6461 7465 0a20 2020 2020  est_mfdate.     
-00017a70: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00017a80: 7420 284b 6579 4572 726f 722c 496e 6465  t (KeyError,Inde
-00017a90: 7845 7272 6f72 293a 0a20 2020 2020 2020  xError):.       
-00017aa0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00017ab0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
-00017ac0: 206e 6574 4368 616e 6765 496e 7374 2069   netChangeInst i
-00017ad0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00017ae0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00017af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017b00: 2020 2020 2068 6f73 7444 6174 612e 6c6f       hostData.lo
-00017b10: 635b 686f 7374 4461 7461 2e69 6e64 6578  c[hostData.index
-00017b20: 5b2d 315d 2c22 4649 4922 5d20 3d20 6e65  [-1],"FII"] = ne
-00017b30: 7443 6861 6e67 6549 6e73 740a 2020 2020  tChangeInst.    
-00017b40: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00017b50: 7074 2028 4b65 7945 7272 6f72 2c49 6e64  pt (KeyError,Ind
-00017b60: 6578 4572 726f 7229 3a0a 2020 2020 2020  exError):.      
-00017b70: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00017b80: 7373 0a20 2020 2020 2020 2020 2020 2065  ss.            e
-00017b90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00017ba0: 2020 2020 206e 6574 4368 616e 6765 496e       netChangeIn
-00017bb0: 7374 203d 2030 0a20 2020 2020 2020 2020  st = 0.         
-00017bc0: 2020 2069 6620 6c61 7465 7374 5f69 6e73     if latest_ins
-00017bd0: 7464 6174 6520 6973 206e 6f74 204e 6f6e  tdate is not Non
-00017be0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017bf0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00017c00: 2020 2020 2020 2020 2020 2020 686f 7374              host
-00017c10: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
-00017c20: 612e 696e 6465 785b 2d31 5d2c 2246 4949  a.index[-1],"FII
-00017c30: 5f44 6174 6522 5d20 3d20 6c61 7465 7374  _Date"] = latest
-00017c40: 5f69 6e73 7464 6174 650a 2020 2020 2020  _instdate.      
-00017c50: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00017c60: 2028 4b65 7945 7272 6f72 2c49 6e64 6578   (KeyError,Index
-00017c70: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00017c80: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00017c90: 0a20 2020 2020 2020 206c 6173 7444 6179  .        lastDay
-00017ca0: 4c61 7374 4d6f 6e74 6820 3d20 6c61 7374  LastMonth = last
-00017cb0: 4461 794c 6173 744d 6f6e 7468 2e73 7472  DayLastMonth.str
-00017cc0: 6674 696d 6528 2225 592d 256d 2d25 6454  ftime("%Y-%m-%dT
-00017cd0: 3030 3a30 303a 3030 2e30 3030 2229 0a20  00:00:00.000"). 
-00017ce0: 2020 2020 2020 2069 6620 6f6e 6c79 4d46         if onlyMF
-00017cf0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00017d00: 7475 726e 206e 6574 4368 616e 6765 4d46  turn netChangeMF
-00017d10: 0a20 2020 2020 2020 2069 6620 6c61 7465  .        if late
-00017d20: 7374 5f69 6e73 7464 6174 6520 3d3d 206c  st_instdate == l
-00017d30: 6174 6573 745f 6d66 6461 7465 3a0a 2020  atest_mfdate:.  
-00017d40: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017d50: 2028 6e65 7443 6861 6e67 654d 4620 2b20   (netChangeMF + 
-00017d60: 6e65 7443 6861 6e67 6549 6e73 7429 0a20  netChangeInst). 
-00017d70: 2020 2020 2020 2065 6c69 6620 6c61 7465         elif late
-00017d80: 7374 5f6d 6664 6174 6520 3d3d 206c 6173  st_mfdate == las
-00017d90: 7444 6179 4c61 7374 4d6f 6e74 683a 0a20  tDayLastMonth:. 
-00017da0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017db0: 6e20 6e65 7443 6861 6e67 654d 460a 2020  n netChangeMF.  
-00017dc0: 2020 2020 2020 656c 6966 206c 6174 6573        elif lates
-00017dd0: 745f 696e 7374 6461 7465 203d 3d20 6c61  t_instdate == la
-00017de0: 7374 4461 794c 6173 744d 6f6e 7468 3a0a  stDayLastMonth:.
-00017df0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00017e00: 726e 206e 6574 4368 616e 6765 496e 7374  rn netChangeInst
-00017e10: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00017e20: 2020 2020 2020 2020 2020 2023 2066 696e             # fin
-00017e30: 6420 7468 6520 6c61 7465 7374 2064 6174  d the latest dat
-00017e40: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00017e50: 206c 6174 6573 745f 6d66 6461 7465 2069   latest_mfdate i
-00017e60: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00017e70: 2020 2020 2020 2020 2020 2020 6c61 7465              late
-00017e80: 7374 5f6d 6664 6174 6520 3d20 504b 4461  st_mfdate = PKDa
-00017e90: 7465 5574 696c 6974 6965 732e 6461 7465  teUtilities.date
-00017ea0: 4672 6f6d 596d 6453 7472 696e 6728 6c61  FromYmdString(la
-00017eb0: 7465 7374 5f6d 6664 6174 652e 7370 6c69  test_mfdate.spli
-00017ec0: 7428 2254 2229 5b30 5d29 0a20 2020 2020  t("T")[0]).     
-00017ed0: 2020 2020 2020 2069 6620 6c61 7465 7374         if latest
-00017ee0: 5f69 6e73 7464 6174 6520 6973 206e 6f74  _instdate is not
-00017ef0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00017f00: 2020 2020 2020 206c 6174 6573 745f 696e         latest_in
-00017f10: 7374 6461 7465 203d 2050 4b44 6174 6555  stdate = PKDateU
-00017f20: 7469 6c69 7469 6573 2e64 6174 6546 726f  tilities.dateFro
-00017f30: 6d59 6d64 5374 7269 6e67 286c 6174 6573  mYmdString(lates
-00017f40: 745f 696e 7374 6461 7465 2e73 706c 6974  t_instdate.split
-00017f50: 2822 5422 295b 305d 290a 2020 2020 2020  ("T")[0]).      
-00017f60: 2020 2020 2020 7265 7475 726e 206e 6574        return net
-00017f70: 4368 616e 6765 4d46 2069 6620 2828 6c61  ChangeMF if ((la
-00017f80: 7465 7374 5f6d 6664 6174 6520 6973 206e  test_mfdate is n
-00017f90: 6f74 204e 6f6e 6529 2061 6e64 206c 6174  ot None) and lat
-00017fa0: 6573 745f 6d66 6461 7465 203e 2028 6c61  est_mfdate > (la
-00017fb0: 7465 7374 5f69 6e73 7464 6174 6520 6966  test_instdate if
-00017fc0: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
-00017fd0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00017fe0: 6520 286c 6174 6573 745f 6d66 6461 7465  e (latest_mfdate
-00017ff0: 202d 2064 6174 6574 696d 652e 7469 6d65   - datetime.time
-00018000: 6465 6c74 6128 3129 2929 2920 656c 7365  delta(1)))) else
-00018010: 206e 6574 4368 616e 6765 496e 7374 0a0a   netChangeInst..
-00018020: 2020 2020 6465 6620 6765 7446 7265 7368      def getFresh
-00018030: 4d46 4953 7461 7475 7328 7365 6c66 2c20  MFIStatus(self, 
-00018040: 7374 6f63 6b2c 6578 6368 616e 6765 4e61  stock,exchangeNa
-00018050: 6d65 3d22 494e 4449 4122 293a 0a20 2020  me="INDIA"):.   
-00018060: 2020 2020 2063 6861 6e67 6553 7461 7475       changeStatu
-00018070: 7344 6174 614d 4620 3d20 4e6f 6e65 0a20  sDataMF = None. 
-00018080: 2020 2020 2020 2063 6861 6e67 6553 7461         changeSta
-00018090: 7475 7344 6174 6149 6e73 7420 3d20 4e6f  tusDataInst = No
-000180a0: 6e65 0a20 2020 2020 2020 206e 6574 4368  ne.        netCh
-000180b0: 616e 6765 4d46 203d 2030 0a20 2020 2020  angeMF = 0.     
-000180c0: 2020 206e 6574 4368 616e 6765 496e 7374     netChangeInst
-000180d0: 203d 2030 0a20 2020 2020 2020 206c 6174   = 0.        lat
-000180e0: 6573 745f 6d66 6461 7465 203d 204e 6f6e  est_mfdate = Non
-000180f0: 650a 2020 2020 2020 2020 6c61 7465 7374  e.        latest
-00018100: 5f69 6e73 7464 6174 6520 3d20 4e6f 6e65  _instdate = None
-00018110: 0a20 2020 2020 2020 2073 6563 7572 6974  .        securit
-00018120: 7920 3d20 4e6f 6e65 0a20 2020 2020 2020  y = None.       
-00018130: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00018140: 2020 7769 7468 2053 7570 7072 6573 734f    with SuppressO
-00018150: 7574 7075 7428 7375 7070 7265 7373 5f73  utput(suppress_s
-00018160: 7464 6572 723d 5472 7565 2c20 7375 7070  tderr=True, supp
-00018170: 7265 7373 5f73 7464 6f75 743d 5472 7565  ress_stdout=True
-00018180: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00018190: 2020 2073 6563 7572 6974 7920 3d20 5374     security = St
-000181a0: 6f63 6b28 7374 6f63 6b2c 6578 6368 616e  ock(stock,exchan
-000181b0: 6765 3d65 7863 6861 6e67 654e 616d 6529  ge=exchangeName)
-000181c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000181d0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-000181e0: 2020 2020 2020 2020 2320 5765 2064 6964          # We did
-000181f0: 206e 6f74 2066 696e 6420 7468 6520 7374   not find the st
-00018200: 6f63 6b3f 2049 7427 7320 6f6b 6179 2e20  ock? It's okay. 
-00018210: 4d6f 7665 206f 6e20 746f 2074 6865 206e  Move on to the n
-00018220: 6578 7420 6f6e 652e 0a20 2020 2020 2020  ext one..       
-00018230: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00018240: 2020 6578 6365 7074 2028 5469 6d65 6f75    except (Timeou
-00018250: 7445 7272 6f72 2c20 436f 6e6e 6563 7469  tError, Connecti
-00018260: 6f6e 4572 726f 7229 2061 7320 653a 0a20  onError) as e:. 
-00018270: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00018280: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
-00018290: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
-000182a0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-000182b0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-000182c0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000182d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000182e0: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
-000182f0: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-00018300: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-00018310: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00018320: 2020 2020 2020 2020 6966 2073 6563 7572          if secur
-00018330: 6974 7920 6973 206e 6f74 204e 6f6e 653a  ity is not None:
-00018340: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00018350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018360: 2020 7769 7468 2053 7570 7072 6573 734f    with SuppressO
-00018370: 7574 7075 7428 7375 7070 7265 7373 5f73  utput(suppress_s
-00018380: 7464 6572 723d 5472 7565 2c20 7375 7070  tderr=True, supp
-00018390: 7265 7373 5f73 7464 6f75 743d 5472 7565  ress_stdout=True
-000183a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000183b0: 2020 2020 2020 2063 6861 6e67 6553 7461         changeSta
-000183c0: 7475 7352 6f77 734d 4620 3d20 7365 6375  tusRowsMF = secu
-000183d0: 7269 7479 2e6d 7574 7561 6c46 756e 644f  rity.mutualFundO
-000183e0: 776e 6572 7368 6970 2874 6f70 3d35 290a  wnership(top=5).
-000183f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018400: 2020 2020 6368 616e 6765 5374 6174 7573      changeStatus
-00018410: 526f 7773 496e 7374 203d 2073 6563 7572  RowsInst = secur
-00018420: 6974 792e 696e 7374 6974 7574 696f 6e4f  ity.institutionO
-00018430: 776e 6572 7368 6970 2874 6f70 3d35 290a  wnership(top=5).
-00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018450: 2020 2020 6368 616e 6765 5374 6174 7573      changeStatus
-00018460: 4461 7461 4d46 203d 2073 6563 7572 6974  DataMF = securit
-00018470: 792e 6d75 7475 616c 4675 6e64 4649 4943  y.mutualFundFIIC
-00018480: 6861 6e67 6544 6174 6128 6368 616e 6765  hangeData(change
-00018490: 5374 6174 7573 526f 7773 4d46 290a 2020  StatusRowsMF).  
-000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184b0: 2020 6368 616e 6765 5374 6174 7573 4461    changeStatusDa
-000184c0: 7461 496e 7374 203d 2073 6563 7572 6974  taInst = securit
-000184d0: 792e 6d75 7475 616c 4675 6e64 4649 4943  y.mutualFundFIIC
-000184e0: 6861 6e67 6544 6174 6128 6368 616e 6765  hangeData(change
-000184f0: 5374 6174 7573 526f 7773 496e 7374 290a  StatusRowsInst).
-00018500: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00018510: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00018520: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018530: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
-00018540: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-00018550: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-00018560: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00018570: 2054 7970 6545 7272 6f72 206f 7220 436f   TypeError or Co
-00018580: 6e6e 6563 7469 6f6e 4572 726f 7220 6265  nnectionError be
-00018590: 6361 7573 6520 7765 2063 6f75 6c64 206e  cause we could n
-000185a0: 6f74 2066 696e 6420 7468 6520 7374 6f63  ot find the stoc
-000185b0: 6b20 6f72 204d 4649 2064 6174 6120 6973  k or MFI data is
-000185c0: 6e27 7420 6176 6169 6c61 626c 653f 0a20  n't available?. 
-000185d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000185e0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000185f0: 6c61 7374 4461 794c 6173 744d 6f6e 7468  lastDayLastMonth
-00018600: 203d 2050 4b44 6174 6555 7469 6c69 7469   = PKDateUtiliti
-00018610: 6573 2e6c 6173 745f 6461 795f 6f66 5f70  es.last_day_of_p
-00018620: 7265 7669 6f75 735f 6d6f 6e74 6828 504b  revious_month(PK
-00018630: 4461 7465 5574 696c 6974 6965 732e 6375  DateUtilities.cu
-00018640: 7272 656e 7444 6174 6554 696d 6528 2929  rrentDateTime())
-00018650: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-00018660: 7444 6179 4c61 7374 4d6f 6e74 6820 3d20  tDayLastMonth = 
-00018670: 6c61 7374 4461 794c 6173 744d 6f6e 7468  lastDayLastMonth
-00018680: 2e73 7472 6674 696d 6528 2225 592d 256d  .strftime("%Y-%m
-00018690: 2d25 6454 3030 3a30 303a 3030 2e30 3030  -%dT00:00:00.000
-000186a0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-000186b0: 6620 6368 616e 6765 5374 6174 7573 4461  f changeStatusDa
-000186c0: 7461 4d46 2069 7320 6e6f 7420 4e6f 6e65  taMF is not None
-000186d0: 2061 6e64 206c 656e 2863 6861 6e67 6553   and len(changeS
-000186e0: 7461 7475 7344 6174 614d 4629 203e 2030  tatusDataMF) > 0
-000186f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018700: 2020 6466 5f67 726f 7570 6564 4d46 203d    df_groupedMF =
-00018710: 2063 6861 6e67 6553 7461 7475 7344 6174   changeStatusDat
-00018720: 614d 462e 6772 6f75 7062 7928 2264 6174  aMF.groupby("dat
-00018730: 6522 2c20 736f 7274 3d46 616c 7365 290a  e", sort=False).
-00018740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018750: 666f 7220 6d66 6461 7465 2c20 6466 5f67  for mfdate, df_g
-00018760: 726f 7570 4d46 2069 6e20 6466 5f67 726f  roupMF in df_gro
-00018770: 7570 6564 4d46 3a0a 2020 2020 2020 2020  upedMF:.        
-00018780: 2020 2020 2020 2020 2020 2020 6e65 7443              netC
-00018790: 6861 6e67 654d 4620 3d20 6466 5f67 726f  hangeMF = df_gro
-000187a0: 7570 4d46 5b22 6368 616e 6765 416d 6f75  upMF["changeAmou
-000187b0: 6e74 225d 2e73 756d 2829 0a20 2020 2020  nt"].sum().     
-000187c0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000187d0: 6174 6573 745f 6d66 6461 7465 203d 206d  atest_mfdate = m
-000187e0: 6664 6174 650a 2020 2020 2020 2020 2020  fdate.          
-000187f0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00018800: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00018810: 6861 6e67 6553 7461 7475 7344 6174 6149  hangeStatusDataI
-00018820: 6e73 7420 6973 206e 6f74 204e 6f6e 6520  nst is not None 
-00018830: 616e 6420 6c65 6e28 6368 616e 6765 5374  and len(changeSt
-00018840: 6174 7573 4461 7461 496e 7374 2920 3e20  atusDataInst) > 
-00018850: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00018860: 2020 2064 665f 6772 6f75 7065 6449 6e73     df_groupedIns
-00018870: 7420 3d20 6368 616e 6765 5374 6174 7573  t = changeStatus
-00018880: 4461 7461 496e 7374 2e67 726f 7570 6279  DataInst.groupby
-00018890: 2822 6461 7465 222c 2073 6f72 743d 4661  ("date", sort=Fa
-000188a0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-000188b0: 2020 2020 2066 6f72 2069 6e73 7464 6174       for instdat
-000188c0: 652c 2064 665f 6772 6f75 7049 6e73 7420  e, df_groupInst 
-000188d0: 696e 2064 665f 6772 6f75 7065 6449 6e73  in df_groupedIns
-000188e0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000188f0: 2020 2020 2020 2069 6620 286c 6174 6573         if (lates
-00018900: 745f 6d66 6461 7465 2069 7320 6e6f 7420  t_mfdate is not 
-00018910: 4e6f 6e65 2061 6e64 206c 6174 6573 745f  None and latest_
-00018920: 6d66 6461 7465 203d 3d20 696e 7374 6461  mfdate == instda
-00018930: 7465 2920 6f72 2028 6c61 7465 7374 5f6d  te) or (latest_m
-00018940: 6664 6174 6520 6973 204e 6f6e 6529 206f  fdate is None) o
-00018950: 7220 2869 6e73 7464 6174 6520 3d3d 206c  r (instdate == l
-00018960: 6173 7444 6179 4c61 7374 4d6f 6e74 6829  astDayLastMonth)
-00018970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018980: 2020 2020 2020 2020 2020 6e65 7443 6861            netCha
-00018990: 6e67 6549 6e73 7420 3d20 6466 5f67 726f  ngeInst = df_gro
-000189a0: 7570 496e 7374 5b22 6368 616e 6765 416d  upInst["changeAm
-000189b0: 6f75 6e74 225d 2e73 756d 2829 0a20 2020  ount"].sum().   
-000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189d0: 2020 2020 206c 6174 6573 745f 696e 7374       latest_inst
-000189e0: 6461 7465 203d 2069 6e73 7464 6174 650a  date = instdate.
-000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a00: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-00018a10: 2020 7265 7475 726e 206e 6574 4368 616e    return netChan
-00018a20: 6765 4d46 2c6e 6574 4368 616e 6765 496e  geMF,netChangeIn
-00018a30: 7374 2c6c 6174 6573 745f 6d66 6461 7465  st,latest_mfdate
-00018a40: 2c6c 6174 6573 745f 696e 7374 6461 7465  ,latest_instdate
-00018a50: 0a0a 0a20 2020 2064 6566 2067 6574 4e69  ...    def getNi
-00018a60: 6674 7950 7265 6469 6374 696f 6e28 7365  ftyPrediction(se
-00018a70: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
-00018a80: 2069 6d70 6f72 7420 7761 726e 696e 6773   import warnings
-00018a90: 0a0a 2020 2020 2020 2020 7761 726e 696e  ..        warnin
-00018aa0: 6773 2e66 696c 7465 7277 6172 6e69 6e67  gs.filterwarning
-00018ab0: 7328 2269 676e 6f72 6522 290a 2020 2020  s("ignore").    
-00018ac0: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
-00018ad0: 7079 2829 0a20 2020 2020 2020 206d 6f64  py().        mod
-00018ae0: 656c 2c20 706b 6c20 3d20 5574 696c 6974  el, pkl = Utilit
-00018af0: 792e 746f 6f6c 732e 6765 744e 6966 7479  y.tools.getNifty
-00018b00: 4d6f 6465 6c28 290a 2020 2020 2020 2020  Model().        
-00018b10: 6966 206d 6f64 656c 2069 7320 4e6f 6e65  if model is None
-00018b20: 206f 7220 706b 6c20 6973 204e 6f6e 653a   or pkl is None:
-00018b30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00018b40: 7572 6e20 302c 2022 556e 6b6e 6f77 6e22  urn 0, "Unknown"
-00018b50: 2c20 2255 6e6b 6e6f 776e 220a 2020 2020  , "Unknown".    
-00018b60: 2020 2020 7769 7468 2053 7570 7072 6573      with Suppres
-00018b70: 734f 7574 7075 7428 7375 7070 7265 7373  sOutput(suppress
-00018b80: 5f73 7464 6572 723d 5472 7565 2c20 7375  _stderr=True, su
-00018b90: 7070 7265 7373 5f73 7464 6f75 743d 5472  ppress_stdout=Tr
-00018ba0: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
-00018bb0: 2064 6174 6120 3d20 6461 7461 5b70 6b6c   data = data[pkl
-00018bc0: 5b22 636f 6c75 6d6e 7322 5d5d 0a20 2020  ["columns"]].   
-00018bd0: 2020 2020 2020 2020 2023 2323 2076 3220           ### v2 
-00018be0: 5072 6570 726f 6365 7373 696e 670a 2020  Preprocessing.  
-00018bf0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-00018c00: 4869 6768 225d 203d 2064 6174 615b 2248  High"] = data["H
-00018c10: 6967 6822 5d2e 7063 745f 6368 616e 6765  igh"].pct_change
-00018c20: 2829 202a 2031 3030 0a20 2020 2020 2020  () * 100.       
-00018c30: 2020 2020 2064 6174 615b 224c 6f77 225d       data["Low"]
-00018c40: 203d 2064 6174 615b 224c 6f77 225d 2e70   = data["Low"].p
-00018c50: 6374 5f63 6861 6e67 6528 2920 2a20 3130  ct_change() * 10
-00018c60: 300a 2020 2020 2020 2020 2020 2020 6461  0.            da
-00018c70: 7461 5b22 4f70 656e 225d 203d 2064 6174  ta["Open"] = dat
-00018c80: 615b 224f 7065 6e22 5d2e 7063 745f 6368  a["Open"].pct_ch
-00018c90: 616e 6765 2829 202a 2031 3030 0a20 2020  ange() * 100.   
-00018ca0: 2020 2020 2020 2020 2064 6174 615b 2243           data["C
-00018cb0: 6c6f 7365 225d 203d 2064 6174 615b 2243  lose"] = data["C
-00018cc0: 6c6f 7365 225d 2e70 6374 5f63 6861 6e67  lose"].pct_chang
-00018cd0: 6528 2920 2a20 3130 300a 2020 2020 2020  e() * 100.      
-00018ce0: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-00018cf0: 612e 696c 6f63 5b2d 315d 0a20 2020 2020  a.iloc[-1].     
-00018d00: 2020 2020 2020 2023 2323 0a20 2020 2020         ###.     
-00018d10: 2020 2020 2020 2064 6174 6120 3d20 706b         data = pk
-00018d20: 6c5b 2273 6361 6c65 7222 5d2e 7472 616e  l["scaler"].tran
-00018d30: 7366 6f72 6d28 5b64 6174 615d 290a 2020  sform([data]).  
-00018d40: 2020 2020 2020 2020 2020 7769 7468 2053            with S
-00018d50: 7570 7072 6573 734f 7574 7075 7428 7375  uppressOutput(su
-00018d60: 7070 7265 7373 5f73 7464 6f75 743d 5472  ppress_stdout=Tr
-00018d70: 7565 2c20 7375 7070 7265 7373 5f73 7464  ue, suppress_std
-00018d80: 6572 723d 5472 7565 293a 0a20 2020 2020  err=True):.     
-00018d90: 2020 2020 2020 2020 2020 2070 7265 6420             pred 
-00018da0: 3d20 6d6f 6465 6c2e 7072 6564 6963 7428  = model.predict(
-00018db0: 6461 7461 295b 305d 0a20 2020 2020 2020  data)[0].       
-00018dc0: 2069 6620 7072 6564 203e 2030 2e35 3a0a   if pred > 0.5:.
-00018dd0: 2020 2020 2020 2020 2020 2020 6f75 7454              outT
-00018de0: 6578 7420 3d20 2242 4541 5249 5348 220a  ext = "BEARISH".
-00018df0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-00018e00: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00018e10: 2020 2020 636f 6c6f 7254 6578 742e 424f      colorText.BO
-00018e20: 4c44 0a20 2020 2020 2020 2020 2020 2020  LD.             
-00018e30: 2020 202b 2063 6f6c 6f72 5465 7874 2e46     + colorText.F
-00018e40: 4149 4c0a 2020 2020 2020 2020 2020 2020  AIL.            
-00018e50: 2020 2020 2b20 6f75 7454 6578 740a 2020      + outText.  
-00018e60: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00018e70: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-00018e80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00018e90: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
-00018ea0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00018eb0: 2020 2020 2020 2020 2073 7567 203d 2022           sug = "
-00018ec0: 486f 6c64 2079 6f75 7220 5368 6f72 7420  Hold your Short 
-00018ed0: 706f 7369 7469 6f6e 2122 0a20 2020 2020  position!".     
-00018ee0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00018ef0: 2020 2020 206f 7574 5465 7874 203d 2022       outText = "
-00018f00: 4255 4c4c 4953 4822 0a20 2020 2020 2020  BULLISH".       
-00018f10: 2020 2020 206f 7574 203d 2028 0a20 2020       out = (.   
-00018f20: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00018f30: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
-00018f40: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-00018f50: 6c6f 7254 6578 742e 4752 4545 4e0a 2020  lorText.GREEN.  
-00018f60: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00018f70: 6f75 7454 6578 740a 2020 2020 2020 2020  outText.        
-00018f80: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00018f90: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00018fa0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-00018fb0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
-00018fc0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00018fd0: 2020 2073 7567 203d 2022 5374 6179 2042     sug = "Stay B
-00018fe0: 756c 6c69 7368 2122 0a20 2020 2020 2020  ullish!".       
-00018ff0: 2069 6620 504b 4461 7465 5574 696c 6974   if PKDateUtilit
-00019000: 6965 732e 6973 436c 6f73 696e 6748 6f75  ies.isClosingHou
-00019010: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
-00019020: 204f 7574 7075 7443 6f6e 7472 6f6c 7328   OutputControls(
-00019030: 292e 7072 696e 744f 7574 7075 7428 0a20  ).printOutput(. 
-00019040: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00019050: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
-00019060: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00019070: 636f 6c6f 7254 6578 742e 5741 524e 0a20  colorText.WARN. 
-00019080: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00019090: 2022 4e6f 7465 3a20 5468 6520 4149 2070   "Note: The AI p
-000190a0: 7265 6469 6374 696f 6e20 7368 6f75 6c64  rediction should
-000190b0: 2062 6520 6578 6563 7574 6564 2041 6674   be executed Aft
-000190c0: 6572 2033 2050 4d20 6f72 204e 6561 7220  er 3 PM or Near 
-000190d0: 746f 2043 6c6f 7369 6e67 2074 696d 6520  to Closing time 
-000190e0: 6173 2074 6865 2050 7265 6469 6374 696f  as the Predictio
-000190f0: 6e20 4163 6375 7261 6379 2069 7320 6261  n Accuracy is ba
-00019100: 7365 6420 6f6e 2074 6865 2043 6c6f 7369  sed on the Closi
-00019110: 6e67 2070 7269 6365 2122 0a20 2020 2020  ng price!".     
-00019120: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-00019130: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00019140: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00019150: 2070 7265 6469 6374 696f 6e54 6578 7420   predictionText 
-00019160: 3d20 224d 6172 6b65 7420 6d61 7920 4f70  = "Market may Op
-00019170: 656e 207b 7d20 6e65 7874 2064 6179 2120  en {} next day! 
-00019180: 7b7d 222e 666f 726d 6174 286f 7574 2c20  {}".format(out, 
-00019190: 7375 6729 0a20 2020 2020 2020 2073 7472  sug).        str
-000191a0: 656e 6774 6854 6578 7420 3d20 2250 726f  engthText = "Pro
-000191b0: 6261 6269 6c69 7479 2f53 7472 656e 6774  bability/Strengt
-000191c0: 6820 6f66 2050 7265 6469 6374 696f 6e20  h of Prediction 
-000191d0: 3d20 7b7d 2522 2e66 6f72 6d61 7428 0a20  = {}%".format(. 
-000191e0: 2020 2020 2020 2020 2020 2055 7469 6c69             Utili
-000191f0: 7479 2e74 6f6f 6c73 2e67 6574 5369 676d  ty.tools.getSigm
-00019200: 6f69 6443 6f6e 6669 6465 6e63 6528 7072  oidConfidence(pr
-00019210: 6564 5b30 5d29 0a20 2020 2020 2020 2029  ed[0]).        )
-00019220: 0a20 2020 2020 2020 204f 7574 7075 7443  .        OutputC
-00019230: 6f6e 7472 6f6c 7328 292e 7072 696e 744f  ontrols().printO
-00019240: 7574 7075 7428 0a20 2020 2020 2020 2020  utput(.         
-00019250: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
-00019260: 440a 2020 2020 2020 2020 2020 2020 2b20  D.            + 
-00019270: 636f 6c6f 7254 6578 742e 424c 5545 0a20  colorText.BLUE. 
-00019280: 2020 2020 2020 2020 2020 202b 2022 5c6e             + "\n
-00019290: 220a 2020 2020 2020 2020 2020 2020 2b20  ".            + 
-000192a0: 225b 2b5d 204e 6966 7479 2041 4920 5072  "[+] Nifty AI Pr
-000192b0: 6564 6963 7469 6f6e 202d 3e20 220a 2020  ediction -> ".  
-000192c0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-000192d0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-000192e0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-000192f0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-00019300: 2020 202b 2070 7265 6469 6374 696f 6e54     + predictionT
-00019310: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
-00019320: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-00019330: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00019340: 2020 4f75 7470 7574 436f 6e74 726f 6c73    OutputControls
-00019350: 2829 2e70 7269 6e74 4f75 7470 7574 280a  ().printOutput(.
-00019360: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00019370: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-00019380: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-00019390: 7874 2e42 4c55 450a 2020 2020 2020 2020  xt.BLUE.        
-000193a0: 2020 2020 2b20 225c 6e22 0a20 2020 2020      + "\n".     
-000193b0: 2020 2020 2020 202b 2022 5b2b 5d20 4e69         + "[+] Ni
-000193c0: 6674 7920 4149 2050 7265 6469 6374 696f  fty AI Predictio
-000193d0: 6e20 2d3e 2022 0a20 2020 2020 2020 2020  n -> ".         
-000193e0: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-000193f0: 4e44 0a20 2020 2020 2020 2020 2020 202b  ND.            +
-00019400: 2073 7472 656e 6774 6854 6578 740a 2020   strengthText.  
-00019410: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00019420: 2072 6574 7572 6e20 7072 6564 2c20 7072   return pred, pr
-00019430: 6564 6963 7469 6f6e 5465 7874 2e72 6570  edictionText.rep
-00019440: 6c61 6365 286f 7574 2c20 6f75 7454 6578  lace(out, outTex
-00019450: 7429 2c20 7374 7265 6e67 7468 5465 7874  t), strengthText
-00019460: 0a0a 2020 2020 6465 6620 6d6f 6e69 746f  ..    def monito
-00019470: 7246 6976 6545 6d61 2873 656c 662c 2066  rFiveEma(self, f
-00019480: 6574 6368 6572 2c20 7265 7375 6c74 5f64  etcher, result_d
-00019490: 662c 206c 6173 745f 7369 676e 616c 2c20  f, last_signal, 
-000194a0: 7269 736b 5f72 6577 6172 643d 3329 3a0a  risk_reward=3):.
-000194b0: 2020 2020 2020 2020 636f 6c5f 6e61 6d65          col_name
-000194c0: 7320 3d20 5b22 4869 6768 222c 2022 4c6f  s = ["High", "Lo
-000194d0: 7722 2c20 2243 6c6f 7365 222c 2022 3545  w", "Close", "5E
-000194e0: 4d41 225d 0a20 2020 2020 2020 2064 6174  MA"].        dat
-000194f0: 615f 6c69 7374 203d 205b 226e 6966 7479  a_list = ["nifty
-00019500: 5f62 7579 222c 2022 6261 6e6b 6e69 6674  _buy", "banknift
-00019510: 795f 6275 7922 2c20 226e 6966 7479 5f73  y_buy", "nifty_s
-00019520: 656c 6c22 2c20 2262 616e 6b6e 6966 7479  ell", "banknifty
-00019530: 5f73 656c 6c22 5d0a 0a20 2020 2020 2020  _sell"]..       
-00019540: 2064 6174 615f 7475 706c 6520 3d20 6665   data_tuple = fe
-00019550: 7463 6865 722e 6665 7463 6846 6976 6545  tcher.fetchFiveE
-00019560: 6d61 4461 7461 2829 0a20 2020 2020 2020  maData().       
-00019570: 2066 6f72 2063 6e74 2069 6e20 7261 6e67   for cnt in rang
-00019580: 6528 6c65 6e28 6461 7461 5f74 7570 6c65  e(len(data_tuple
-00019590: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000195a0: 6420 3d20 6461 7461 5f74 7570 6c65 5b63  d = data_tuple[c
-000195b0: 6e74 5d0a 2020 2020 2020 2020 2020 2020  nt].            
-000195c0: 645b 2235 454d 4122 5d20 3d20 706b 7461  d["5EMA"] = pkta
-000195d0: 6c69 622e 454d 4128 645b 2243 6c6f 7365  lib.EMA(d["Close
-000195e0: 225d 2c20 7469 6d65 7065 7269 6f64 3d35  "], timeperiod=5
-000195f0: 290a 2020 2020 2020 2020 2020 2020 6420  ).            d 
-00019600: 3d20 645b 636f 6c5f 6e61 6d65 735d 0a20  = d[col_names]. 
-00019610: 2020 2020 2020 2020 2020 2064 203d 2064             d = d
-00019620: 2e64 726f 706e 6128 292e 726f 756e 6428  .dropna().round(
-00019630: 3229 0a0a 2020 2020 2020 2020 2020 2020  2)..            
-00019640: 7769 7468 2053 7570 7072 6573 734f 7574  with SuppressOut
-00019650: 7075 7428 7375 7070 7265 7373 5f73 7464  put(suppress_std
-00019660: 6572 723d 5472 7565 2c20 7375 7070 7265  err=True, suppre
-00019670: 7373 5f73 7464 6f75 743d 5472 7565 293a  ss_stdout=True):
-00019680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019690: 2069 6620 2273 656c 6c22 2069 6e20 6461   if "sell" in da
-000196a0: 7461 5f6c 6973 745b 636e 745d 3a0a 2020  ta_list[cnt]:.  
-000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196c0: 2020 7374 7265 6368 6564 203d 2064 5b28    streched = d[(
-000196d0: 642e 4c6f 7720 3e20 645b 2235 454d 4122  d.Low > d["5EMA"
-000196e0: 5d29 2026 2028 642e 4c6f 7720 2d20 645b  ]) & (d.Low - d[
-000196f0: 2235 454d 4122 5d20 3e20 302e 3529 5d0a  "5EMA"] > 0.5)].
-00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019710: 2020 2020 7374 7265 6368 6564 5b22 534c      streched["SL
-00019720: 225d 203d 2073 7472 6563 6865 642e 4869  "] = streched.Hi
-00019730: 6768 0a20 2020 2020 2020 2020 2020 2020  gh.             
-00019740: 2020 2020 2020 2076 616c 6964 6174 6520         validate 
-00019750: 3d20 645b 0a20 2020 2020 2020 2020 2020  = d[.           
-00019760: 2020 2020 2020 2020 2020 2020 2028 642e               (d.
-00019770: 4c6f 772e 7368 6966 7428 3129 203e 2064  Low.shift(1) > d
-00019780: 5b22 3545 4d41 225d 2e73 6869 6674 2831  ["5EMA"].shift(1
-00019790: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000197a0: 2020 2020 2020 2020 2020 2026 2028 642e             & (d.
-000197b0: 4c6f 772e 7368 6966 7428 3129 202d 2064  Low.shift(1) - d
-000197c0: 5b22 3545 4d41 225d 2e73 6869 6674 2831  ["5EMA"].shift(1
-000197d0: 2920 3e20 302e 3529 0a20 2020 2020 2020  ) > 0.5).       
-000197e0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019800: 2020 206f 6c64 5f69 6e64 6578 203d 2076     old_index = v
-00019810: 616c 6964 6174 652e 696e 6465 780a 2020  alidate.index.  
-00019820: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00019830: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019840: 2020 2020 2020 2020 6d61 736b 203d 2028          mask = (
-00019850: 642e 4869 6768 203c 2064 5b22 3545 4d41  d.High < d["5EMA
-00019860: 225d 2920 2620 2864 5b22 3545 4d41 225d  "]) & (d["5EMA"]
-00019870: 202d 2064 2e48 6967 6820 3e20 302e 3529   - d.High > 0.5)
-00019880: 2020 2320 4275 790a 2020 2020 2020 2020    # Buy.        
-00019890: 2020 2020 2020 2020 2020 2020 7374 7265              stre
-000198a0: 6368 6564 203d 2064 5b6d 6173 6b5d 0a20  ched = d[mask]. 
-000198b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198c0: 2020 2073 7472 6563 6865 645b 2253 4c22     streched["SL"
-000198d0: 5d20 3d20 7374 7265 6368 6564 2e4c 6f77  ] = streched.Low
-000198e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000198f0: 2020 2020 2076 616c 6964 6174 6520 3d20       validate = 
-00019900: 642e 6c6f 635b 6d61 736b 2e73 6869 6674  d.loc[mask.shift
-00019910: 2831 292e 6669 6c6c 6e61 2846 616c 7365  (1).fillna(False
-00019920: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
-00019930: 2020 2020 2020 206f 6c64 5f69 6e64 6578         old_index
-00019940: 203d 2076 616c 6964 6174 652e 696e 6465   = validate.inde
-00019950: 780a 2020 2020 2020 2020 2020 2020 7467  x.            tg
-00019960: 7420 3d20 7064 2e44 6174 6146 7261 6d65  t = pd.DataFrame
-00019970: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00019980: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-00019990: 2020 2020 2020 2020 7661 6c69 6461 7465          validate
-000199a0: 2e43 6c6f 7365 2e72 6573 6574 5f69 6e64  .Close.reset_ind
-000199b0: 6578 2864 726f 703d 5472 7565 290a 2020  ex(drop=True).  
-000199c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199d0: 2020 2d20 280a 2020 2020 2020 2020 2020    - (.          
-000199e0: 2020 2020 2020 2020 2020 2020 2020 280a                (.
-000199f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a00: 2020 2020 2020 2020 2020 2020 7374 7265              stre
-00019a10: 6368 6564 2e53 4c2e 7265 7365 745f 696e  ched.SL.reset_in
-00019a20: 6465 7828 6472 6f70 3d54 7275 6529 0a20  dex(drop=True). 
+00017930: 2020 2073 6176 6564 5f6d 6664 6174 6520     saved_mfdate 
+00017940: 3d20 6c61 7374 4461 794c 6173 744d 6f6e  = lastDayLastMon
+00017950: 7468 202d 2064 6174 6574 696d 652e 7469  th - datetime.ti
+00017960: 6d65 6465 6c74 6128 3129 0a20 2020 2020  medelta(1).     
+00017970: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
+00017980: 7465 7374 5f69 6e73 7464 6174 6520 6973  test_instdate is
+00017990: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000179a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000179b0: 6176 6564 5f69 6e73 7464 6174 6520 3d20  aved_instdate = 
+000179c0: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
+000179d0: 6461 7465 4672 6f6d 596d 6453 7472 696e  dateFromYmdStrin
+000179e0: 6728 6c61 7465 7374 5f69 6e73 7464 6174  g(latest_instdat
+000179f0: 652e 7370 6c69 7428 2254 2229 5b30 5d29  e.split("T")[0])
+00017a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017a20: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+00017a30: 5f69 6e73 7464 6174 6520 3d20 6c61 7374  _instdate = last
+00017a40: 4461 794c 6173 744d 6f6e 7468 202d 2064  DayLastMonth - d
+00017a50: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
+00017a60: 6128 3129 0a20 2020 2020 2020 2020 2020  a(1).           
+00017a70: 2020 2020 2074 6f64 6179 203d 2050 4b44       today = PKD
+00017a80: 6174 6555 7469 6c69 7469 6573 2e63 7572  ateUtilities.cur
+00017a90: 7265 6e74 4461 7465 5469 6d65 2829 0a20  rentDateTime(). 
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017ab0: 6565 6473 4672 6573 6855 7064 6174 6520  eedsFreshUpdate 
+00017ac0: 3d20 2873 6176 6564 5f6d 6664 6174 652e  = (saved_mfdate.
+00017ad0: 6461 7465 2829 203c 206c 6173 7444 6179  date() < lastDay
+00017ae0: 4c61 7374 4d6f 6e74 682e 6461 7465 2829  LastMonth.date()
+00017af0: 2920 616e 6420 2873 6176 6564 5f69 6e73  ) and (saved_ins
+00017b00: 7464 6174 652e 6461 7465 2829 203c 206c  tdate.date() < l
+00017b10: 6173 7444 6179 4c61 7374 4d6f 6e74 682e  astDayLastMonth.
+00017b20: 6461 7465 2829 290a 2020 2020 2020 2020  date()).        
+00017b30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017b40: 2020 2020 2020 2020 2020 6e65 6564 7346            needsF
+00017b50: 7265 7368 5570 6461 7465 203d 2054 7275  reshUpdate = Tru
+00017b60: 650a 0a20 2020 2020 2020 2069 6620 6e65  e..        if ne
+00017b70: 6564 7346 7265 7368 5570 6461 7465 2061  edsFreshUpdate a
+00017b80: 6e64 2066 6f72 6365 3a0a 2020 2020 2020  nd force:.      
+00017b90: 2020 2020 2020 6e65 7443 6861 6e67 654d        netChangeM
+00017ba0: 462c 206e 6574 4368 616e 6765 496e 7374  F, netChangeInst
+00017bb0: 2c20 6c61 7465 7374 5f6d 6664 6174 652c  , latest_mfdate,
+00017bc0: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
+00017bd0: 203d 2073 656c 662e 6765 7446 7265 7368   = self.getFresh
+00017be0: 4d46 4953 7461 7475 7328 7374 6f63 6b2c  MFIStatus(stock,
+00017bf0: 6578 6368 616e 6765 4e61 6d65 3d65 7863  exchangeName=exc
+00017c00: 6861 6e67 654e 616d 6529 0a20 2020 2020  hangeName).     
+00017c10: 2020 2020 2020 2069 6620 6e65 7443 6861         if netCha
+00017c20: 6e67 654d 4620 6973 206e 6f74 204e 6f6e  ngeMF is not Non
+00017c30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017c40: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00017c50: 2020 2020 2020 2020 2020 2020 686f 7374              host
+00017c60: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
+00017c70: 612e 696e 6465 785b 2d31 5d2c 224d 4622  a.index[-1],"MF"
+00017c80: 5d20 3d20 6e65 7443 6861 6e67 654d 460a  ] = netChangeMF.
+00017c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ca0: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
+00017cb0: 2c49 6e64 6578 4572 726f 7229 3a0a 2020  ,IndexError):.  
+00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cd0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+00017ce0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017cf0: 2020 2020 2020 2020 206e 6574 4368 616e           netChan
+00017d00: 6765 4d46 203d 2030 0a20 2020 2020 2020  geMF = 0.       
+00017d10: 2020 2020 2069 6620 6c61 7465 7374 5f6d       if latest_m
+00017d20: 6664 6174 6520 6973 206e 6f74 204e 6f6e  fdate is not Non
+00017d30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017d40: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00017d50: 2020 2020 2020 2020 2020 2020 686f 7374              host
+00017d60: 4461 7461 2e6c 6f63 5b68 6f73 7444 6174  Data.loc[hostDat
+00017d70: 612e 696e 6465 785b 2d31 5d2c 224d 465f  a.index[-1],"MF_
+00017d80: 4461 7465 225d 203d 206c 6174 6573 745f  Date"] = latest_
+00017d90: 6d66 6461 7465 0a20 2020 2020 2020 2020  mfdate.         
+00017da0: 2020 2020 2020 2065 7863 6570 7420 284b         except (K
+00017db0: 6579 4572 726f 722c 496e 6465 7845 7272  eyError,IndexErr
+00017dc0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00017dd0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00017de0: 2020 2020 2020 2020 2020 6966 206e 6574            if net
+00017df0: 4368 616e 6765 496e 7374 2069 7320 6e6f  ChangeInst is no
+00017e00: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00017e10: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00017e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e30: 2068 6f73 7444 6174 612e 6c6f 635b 686f   hostData.loc[ho
+00017e40: 7374 4461 7461 2e69 6e64 6578 5b2d 315d  stData.index[-1]
+00017e50: 2c22 4649 4922 5d20 3d20 6e65 7443 6861  ,"FII"] = netCha
+00017e60: 6e67 6549 6e73 740a 2020 2020 2020 2020  ngeInst.        
+00017e70: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+00017e80: 4b65 7945 7272 6f72 2c49 6e64 6578 4572  KeyError,IndexEr
+00017e90: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+00017ea0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00017eb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00017ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017ed0: 206e 6574 4368 616e 6765 496e 7374 203d   netChangeInst =
+00017ee0: 2030 0a20 2020 2020 2020 2020 2020 2069   0.            i
+00017ef0: 6620 6c61 7465 7374 5f69 6e73 7464 6174  f latest_instdat
+00017f00: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00017f10: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00017f20: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00017f30: 2020 2020 2020 2020 686f 7374 4461 7461          hostData
+00017f40: 2e6c 6f63 5b68 6f73 7444 6174 612e 696e  .loc[hostData.in
+00017f50: 6465 785b 2d31 5d2c 2246 4949 5f44 6174  dex[-1],"FII_Dat
+00017f60: 6522 5d20 3d20 6c61 7465 7374 5f69 6e73  e"] = latest_ins
+00017f70: 7464 6174 650a 2020 2020 2020 2020 2020  tdate.          
+00017f80: 2020 2020 2020 6578 6365 7074 2028 4b65        except (Ke
+00017f90: 7945 7272 6f72 2c49 6e64 6578 4572 726f  yError,IndexErro
+00017fa0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00017fb0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00017fc0: 2020 2020 206c 6173 7444 6179 4c61 7374       lastDayLast
+00017fd0: 4d6f 6e74 6820 3d20 6c61 7374 4461 794c  Month = lastDayL
+00017fe0: 6173 744d 6f6e 7468 2e73 7472 6674 696d  astMonth.strftim
+00017ff0: 6528 2225 592d 256d 2d25 6454 3030 3a30  e("%Y-%m-%dT00:0
+00018000: 303a 3030 2e30 3030 2229 0a20 2020 2020  0:00.000").     
+00018010: 2020 2069 6620 6f6e 6c79 4d46 3a0a 2020     if onlyMF:.  
+00018020: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018030: 206e 6574 4368 616e 6765 4d46 0a20 2020   netChangeMF.   
+00018040: 2020 2020 2069 6620 6c61 7465 7374 5f69       if latest_i
+00018050: 6e73 7464 6174 6520 3d3d 206c 6174 6573  nstdate == lates
+00018060: 745f 6d66 6461 7465 3a0a 2020 2020 2020  t_mfdate:.      
+00018070: 2020 2020 2020 7265 7475 726e 2028 6e65        return (ne
+00018080: 7443 6861 6e67 654d 4620 2b20 6e65 7443  tChangeMF + netC
+00018090: 6861 6e67 6549 6e73 7429 0a20 2020 2020  hangeInst).     
+000180a0: 2020 2065 6c69 6620 6c61 7465 7374 5f6d     elif latest_m
+000180b0: 6664 6174 6520 3d3d 206c 6173 7444 6179  fdate == lastDay
+000180c0: 4c61 7374 4d6f 6e74 683a 0a20 2020 2020  LastMonth:.     
+000180d0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+000180e0: 7443 6861 6e67 654d 460a 2020 2020 2020  tChangeMF.      
+000180f0: 2020 656c 6966 206c 6174 6573 745f 696e    elif latest_in
+00018100: 7374 6461 7465 203d 3d20 6c61 7374 4461  stdate == lastDa
+00018110: 794c 6173 744d 6f6e 7468 3a0a 2020 2020  yLastMonth:.    
+00018120: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+00018130: 6574 4368 616e 6765 496e 7374 0a20 2020  etChangeInst.   
+00018140: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00018150: 2020 2020 2020 2023 2066 696e 6420 7468         # find th
+00018160: 6520 6c61 7465 7374 2064 6174 650a 2020  e latest date.  
+00018170: 2020 2020 2020 2020 2020 6966 206c 6174            if lat
+00018180: 6573 745f 6d66 6461 7465 2069 7320 6e6f  est_mfdate is no
+00018190: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000181a0: 2020 2020 2020 2020 6c61 7465 7374 5f6d          latest_m
+000181b0: 6664 6174 6520 3d20 504b 4461 7465 5574  fdate = PKDateUt
+000181c0: 696c 6974 6965 732e 6461 7465 4672 6f6d  ilities.dateFrom
+000181d0: 596d 6453 7472 696e 6728 6c61 7465 7374  YmdString(latest
+000181e0: 5f6d 6664 6174 652e 7370 6c69 7428 2254  _mfdate.split("T
+000181f0: 2229 5b30 5d29 0a20 2020 2020 2020 2020  ")[0]).         
+00018200: 2020 2069 6620 6c61 7465 7374 5f69 6e73     if latest_ins
+00018210: 7464 6174 6520 6973 206e 6f74 204e 6f6e  tdate is not Non
+00018220: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00018230: 2020 206c 6174 6573 745f 696e 7374 6461     latest_instda
+00018240: 7465 203d 2050 4b44 6174 6555 7469 6c69  te = PKDateUtili
+00018250: 7469 6573 2e64 6174 6546 726f 6d59 6d64  ties.dateFromYmd
+00018260: 5374 7269 6e67 286c 6174 6573 745f 696e  String(latest_in
+00018270: 7374 6461 7465 2e73 706c 6974 2822 5422  stdate.split("T"
+00018280: 295b 305d 290a 2020 2020 2020 2020 2020  )[0]).          
+00018290: 2020 7265 7475 726e 206e 6574 4368 616e    return netChan
+000182a0: 6765 4d46 2069 6620 2828 6c61 7465 7374  geMF if ((latest
+000182b0: 5f6d 6664 6174 6520 6973 206e 6f74 204e  _mfdate is not N
+000182c0: 6f6e 6529 2061 6e64 206c 6174 6573 745f  one) and latest_
+000182d0: 6d66 6461 7465 203e 2028 6c61 7465 7374  mfdate > (latest
+000182e0: 5f69 6e73 7464 6174 6520 6966 206c 6174  _instdate if lat
+000182f0: 6573 745f 696e 7374 6461 7465 2069 7320  est_instdate is 
+00018300: 6e6f 7420 4e6f 6e65 2065 6c73 6520 286c  not None else (l
+00018310: 6174 6573 745f 6d66 6461 7465 202d 2064  atest_mfdate - d
+00018320: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
+00018330: 6128 3129 2929 2920 656c 7365 206e 6574  a(1)))) else net
+00018340: 4368 616e 6765 496e 7374 0a0a 2020 2020  ChangeInst..    
+00018350: 6465 6620 6765 7446 7265 7368 4d46 4953  def getFreshMFIS
+00018360: 7461 7475 7328 7365 6c66 2c20 7374 6f63  tatus(self, stoc
+00018370: 6b2c 6578 6368 616e 6765 4e61 6d65 3d22  k,exchangeName="
+00018380: 494e 4449 4122 293a 0a20 2020 2020 2020  INDIA"):.       
+00018390: 2063 6861 6e67 6553 7461 7475 7344 6174   changeStatusDat
+000183a0: 614d 4620 3d20 4e6f 6e65 0a20 2020 2020  aMF = None.     
+000183b0: 2020 2063 6861 6e67 6553 7461 7475 7344     changeStatusD
+000183c0: 6174 6149 6e73 7420 3d20 4e6f 6e65 0a20  ataInst = None. 
+000183d0: 2020 2020 2020 206e 6574 4368 616e 6765         netChange
+000183e0: 4d46 203d 2030 0a20 2020 2020 2020 206e  MF = 0.        n
+000183f0: 6574 4368 616e 6765 496e 7374 203d 2030  etChangeInst = 0
+00018400: 0a20 2020 2020 2020 206c 6174 6573 745f  .        latest_
+00018410: 6d66 6461 7465 203d 204e 6f6e 650a 2020  mfdate = None.  
+00018420: 2020 2020 2020 6c61 7465 7374 5f69 6e73        latest_ins
+00018430: 7464 6174 6520 3d20 4e6f 6e65 0a20 2020  tdate = None.   
+00018440: 2020 2020 2073 6563 7572 6974 7920 3d20       security = 
+00018450: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
+00018460: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+00018470: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
+00018480: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
+00018490: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
+000184a0: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
+000184b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000184c0: 6563 7572 6974 7920 3d20 5374 6f63 6b28  ecurity = Stock(
+000184d0: 7374 6f63 6b2c 6578 6368 616e 6765 3d65  stock,exchange=e
+000184e0: 7863 6861 6e67 654e 616d 6529 0a20 2020  xchangeName).   
+000184f0: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
+00018500: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+00018510: 2020 2020 2320 5765 2064 6964 206e 6f74      # We did not
+00018520: 2066 696e 6420 7468 6520 7374 6f63 6b3f   find the stock?
+00018530: 2049 7427 7320 6f6b 6179 2e20 4d6f 7665   It's okay. Move
+00018540: 206f 6e20 746f 2074 6865 206e 6578 7420   on to the next 
+00018550: 6f6e 652e 0a20 2020 2020 2020 2020 2020  one..           
+00018560: 2070 6173 730a 2020 2020 2020 2020 6578   pass.        ex
+00018570: 6365 7074 2028 5469 6d65 6f75 7445 7272  cept (TimeoutErr
+00018580: 6f72 2c20 436f 6e6e 6563 7469 6f6e 4572  or, ConnectionEr
+00018590: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
+000185a0: 2020 2020 2020 2073 656c 662e 6465 6661         self.defa
+000185b0: 756c 745f 6c6f 6767 6572 2e64 6562 7567  ult_logger.debug
+000185c0: 2865 2c20 6578 635f 696e 666f 3d54 7275  (e, exc_info=Tru
+000185d0: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
+000185e0: 6173 730a 2020 2020 2020 2020 6578 6365  ass.        exce
+000185f0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00018600: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00018610: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+00018620: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+00018630: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+00018640: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00018650: 2020 2020 6966 2073 6563 7572 6974 7920      if security 
+00018660: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00018670: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00018680: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+00018690: 7468 2053 7570 7072 6573 734f 7574 7075  th SuppressOutpu
+000186a0: 7428 7375 7070 7265 7373 5f73 7464 6572  t(suppress_stder
+000186b0: 723d 5472 7565 2c20 7375 7070 7265 7373  r=True, suppress
+000186c0: 5f73 7464 6f75 743d 5472 7565 293a 0a20  _stdout=True):. 
+000186d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186e0: 2020 2063 6861 6e67 6553 7461 7475 7352     changeStatusR
+000186f0: 6f77 734d 4620 3d20 7365 6375 7269 7479  owsMF = security
+00018700: 2e6d 7574 7561 6c46 756e 644f 776e 6572  .mutualFundOwner
+00018710: 7368 6970 2874 6f70 3d35 290a 2020 2020  ship(top=5).    
+00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018730: 6368 616e 6765 5374 6174 7573 526f 7773  changeStatusRows
+00018740: 496e 7374 203d 2073 6563 7572 6974 792e  Inst = security.
+00018750: 696e 7374 6974 7574 696f 6e4f 776e 6572  institutionOwner
+00018760: 7368 6970 2874 6f70 3d35 290a 2020 2020  ship(top=5).    
+00018770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018780: 6368 616e 6765 5374 6174 7573 4461 7461  changeStatusData
+00018790: 4d46 203d 2073 6563 7572 6974 792e 6d75  MF = security.mu
+000187a0: 7475 616c 4675 6e64 4649 4943 6861 6e67  tualFundFIIChang
+000187b0: 6544 6174 6128 6368 616e 6765 5374 6174  eData(changeStat
+000187c0: 7573 526f 7773 4d46 290a 2020 2020 2020  usRowsMF).      
+000187d0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000187e0: 616e 6765 5374 6174 7573 4461 7461 496e  angeStatusDataIn
+000187f0: 7374 203d 2073 6563 7572 6974 792e 6d75  st = security.mu
+00018800: 7475 616c 4675 6e64 4649 4943 6861 6e67  tualFundFIIChang
+00018810: 6544 6174 6128 6368 616e 6765 5374 6174  eData(changeStat
+00018820: 7573 526f 7773 496e 7374 290a 2020 2020  usRowsInst).    
+00018830: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00018840: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+00018850: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018860: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+00018870: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+00018880: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+00018890: 2020 2020 2020 2020 2020 2023 2054 7970             # Typ
+000188a0: 6545 7272 6f72 206f 7220 436f 6e6e 6563  eError or Connec
+000188b0: 7469 6f6e 4572 726f 7220 6265 6361 7573  tionError becaus
+000188c0: 6520 7765 2063 6f75 6c64 206e 6f74 2066  e we could not f
+000188d0: 696e 6420 7468 6520 7374 6f63 6b20 6f72  ind the stock or
+000188e0: 204d 4649 2064 6174 6120 6973 6e27 7420   MFI data isn't 
+000188f0: 6176 6169 6c61 626c 653f 0a20 2020 2020  available?.     
+00018900: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00018910: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+00018920: 4461 794c 6173 744d 6f6e 7468 203d 2050  DayLastMonth = P
+00018930: 4b44 6174 6555 7469 6c69 7469 6573 2e6c  KDateUtilities.l
+00018940: 6173 745f 6461 795f 6f66 5f70 7265 7669  ast_day_of_previ
+00018950: 6f75 735f 6d6f 6e74 6828 504b 4461 7465  ous_month(PKDate
+00018960: 5574 696c 6974 6965 732e 6375 7272 656e  Utilities.curren
+00018970: 7444 6174 6554 696d 6528 2929 0a20 2020  tDateTime()).   
+00018980: 2020 2020 2020 2020 206c 6173 7444 6179           lastDay
+00018990: 4c61 7374 4d6f 6e74 6820 3d20 6c61 7374  LastMonth = last
+000189a0: 4461 794c 6173 744d 6f6e 7468 2e73 7472  DayLastMonth.str
+000189b0: 6674 696d 6528 2225 592d 256d 2d25 6454  ftime("%Y-%m-%dT
+000189c0: 3030 3a30 303a 3030 2e30 3030 2229 0a20  00:00:00.000"). 
+000189d0: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
+000189e0: 616e 6765 5374 6174 7573 4461 7461 4d46  angeStatusDataMF
+000189f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00018a00: 206c 656e 2863 6861 6e67 6553 7461 7475   len(changeStatu
+00018a10: 7344 6174 614d 4629 203e 2030 3a0a 2020  sDataMF) > 0:.  
+00018a20: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00018a30: 5f67 726f 7570 6564 4d46 203d 2063 6861  _groupedMF = cha
+00018a40: 6e67 6553 7461 7475 7344 6174 614d 462e  ngeStatusDataMF.
+00018a50: 6772 6f75 7062 7928 2264 6174 6522 2c20  groupby("date", 
+00018a60: 736f 7274 3d46 616c 7365 290a 2020 2020  sort=False).    
+00018a70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00018a80: 6d66 6461 7465 2c20 6466 5f67 726f 7570  mfdate, df_group
+00018a90: 4d46 2069 6e20 6466 5f67 726f 7570 6564  MF in df_grouped
+00018aa0: 4d46 3a0a 2020 2020 2020 2020 2020 2020  MF:.            
+00018ab0: 2020 2020 2020 2020 6e65 7443 6861 6e67          netChang
+00018ac0: 654d 4620 3d20 6466 5f67 726f 7570 4d46  eMF = df_groupMF
+00018ad0: 5b22 6368 616e 6765 416d 6f75 6e74 225d  ["changeAmount"]
+00018ae0: 2e73 756d 2829 0a20 2020 2020 2020 2020  .sum().         
+00018af0: 2020 2020 2020 2020 2020 206c 6174 6573             lates
+00018b00: 745f 6d66 6461 7465 203d 206d 6664 6174  t_mfdate = mfdat
+00018b10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00018b20: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00018b30: 2020 2020 2020 2020 6966 2063 6861 6e67          if chang
+00018b40: 6553 7461 7475 7344 6174 6149 6e73 7420  eStatusDataInst 
+00018b50: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00018b60: 6c65 6e28 6368 616e 6765 5374 6174 7573  len(changeStatus
+00018b70: 4461 7461 496e 7374 2920 3e20 303a 0a20  DataInst) > 0:. 
+00018b80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00018b90: 665f 6772 6f75 7065 6449 6e73 7420 3d20  f_groupedInst = 
+00018ba0: 6368 616e 6765 5374 6174 7573 4461 7461  changeStatusData
+00018bb0: 496e 7374 2e67 726f 7570 6279 2822 6461  Inst.groupby("da
+00018bc0: 7465 222c 2073 6f72 743d 4661 6c73 6529  te", sort=False)
+00018bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018be0: 2066 6f72 2069 6e73 7464 6174 652c 2064   for instdate, d
+00018bf0: 665f 6772 6f75 7049 6e73 7420 696e 2064  f_groupInst in d
+00018c00: 665f 6772 6f75 7065 6449 6e73 743a 0a20  f_groupedInst:. 
+00018c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c20: 2020 2069 6620 286c 6174 6573 745f 6d66     if (latest_mf
+00018c30: 6461 7465 2069 7320 6e6f 7420 4e6f 6e65  date is not None
+00018c40: 2061 6e64 206c 6174 6573 745f 6d66 6461   and latest_mfda
+00018c50: 7465 203d 3d20 696e 7374 6461 7465 2920  te == instdate) 
+00018c60: 6f72 2028 6c61 7465 7374 5f6d 6664 6174  or (latest_mfdat
+00018c70: 6520 6973 204e 6f6e 6529 206f 7220 2869  e is None) or (i
+00018c80: 6e73 7464 6174 6520 3d3d 206c 6173 7444  nstdate == lastD
+00018c90: 6179 4c61 7374 4d6f 6e74 6829 3a0a 2020  ayLastMonth):.  
+00018ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cb0: 2020 2020 2020 6e65 7443 6861 6e67 6549        netChangeI
+00018cc0: 6e73 7420 3d20 6466 5f67 726f 7570 496e  nst = df_groupIn
+00018cd0: 7374 5b22 6368 616e 6765 416d 6f75 6e74  st["changeAmount
+00018ce0: 225d 2e73 756d 2829 0a20 2020 2020 2020  "].sum().       
+00018cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d00: 206c 6174 6573 745f 696e 7374 6461 7465   latest_instdate
+00018d10: 203d 2069 6e73 7464 6174 650a 2020 2020   = instdate.    
+00018d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d30: 6272 6561 6b0a 2020 2020 2020 2020 7265  break.        re
+00018d40: 7475 726e 206e 6574 4368 616e 6765 4d46  turn netChangeMF
+00018d50: 2c6e 6574 4368 616e 6765 496e 7374 2c6c  ,netChangeInst,l
+00018d60: 6174 6573 745f 6d66 6461 7465 2c6c 6174  atest_mfdate,lat
+00018d70: 6573 745f 696e 7374 6461 7465 0a0a 0a20  est_instdate... 
+00018d80: 2020 2064 6566 2067 6574 4e69 6674 7950     def getNiftyP
+00018d90: 7265 6469 6374 696f 6e28 7365 6c66 2c20  rediction(self, 
+00018da0: 6466 293a 0a20 2020 2020 2020 2069 6d70  df):.        imp
+00018db0: 6f72 7420 7761 726e 696e 6773 0a0a 2020  ort warnings..  
+00018dc0: 2020 2020 2020 7761 726e 696e 6773 2e66        warnings.f
+00018dd0: 696c 7465 7277 6172 6e69 6e67 7328 2269  ilterwarnings("i
+00018de0: 676e 6f72 6522 290a 2020 2020 2020 2020  gnore").        
+00018df0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+00018e00: 0a20 2020 2020 2020 206d 6f64 656c 2c20  .        model, 
+00018e10: 706b 6c20 3d20 5574 696c 6974 792e 746f  pkl = Utility.to
+00018e20: 6f6c 732e 6765 744e 6966 7479 4d6f 6465  ols.getNiftyMode
+00018e30: 6c28 290a 2020 2020 2020 2020 6966 206d  l().        if m
+00018e40: 6f64 656c 2069 7320 4e6f 6e65 206f 7220  odel is None or 
+00018e50: 706b 6c20 6973 204e 6f6e 653a 0a20 2020  pkl is None:.   
+00018e60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018e70: 302c 2022 556e 6b6e 6f77 6e22 2c20 2255  0, "Unknown", "U
+00018e80: 6e6b 6e6f 776e 220a 2020 2020 2020 2020  nknown".        
+00018e90: 7769 7468 2053 7570 7072 6573 734f 7574  with SuppressOut
+00018ea0: 7075 7428 7375 7070 7265 7373 5f73 7464  put(suppress_std
+00018eb0: 6572 723d 5472 7565 2c20 7375 7070 7265  err=True, suppre
+00018ec0: 7373 5f73 7464 6f75 743d 5472 7565 293a  ss_stdout=True):
+00018ed0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00018ee0: 6120 3d20 6461 7461 5b70 6b6c 5b22 636f  a = data[pkl["co
+00018ef0: 6c75 6d6e 7322 5d5d 0a20 2020 2020 2020  lumns"]].       
+00018f00: 2020 2020 2023 2323 2076 3220 5072 6570       ### v2 Prep
+00018f10: 726f 6365 7373 696e 670a 2020 2020 2020  rocessing.      
+00018f20: 2020 2020 2020 6461 7461 5b22 4869 6768        data["High
+00018f30: 225d 203d 2064 6174 615b 2248 6967 6822  "] = data["High"
+00018f40: 5d2e 7063 745f 6368 616e 6765 2829 202a  ].pct_change() *
+00018f50: 2031 3030 0a20 2020 2020 2020 2020 2020   100.           
+00018f60: 2064 6174 615b 224c 6f77 225d 203d 2064   data["Low"] = d
+00018f70: 6174 615b 224c 6f77 225d 2e70 6374 5f63  ata["Low"].pct_c
+00018f80: 6861 6e67 6528 2920 2a20 3130 300a 2020  hange() * 100.  
+00018f90: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+00018fa0: 4f70 656e 225d 203d 2064 6174 615b 224f  Open"] = data["O
+00018fb0: 7065 6e22 5d2e 7063 745f 6368 616e 6765  pen"].pct_change
+00018fc0: 2829 202a 2031 3030 0a20 2020 2020 2020  () * 100.       
+00018fd0: 2020 2020 2064 6174 615b 2243 6c6f 7365       data["Close
+00018fe0: 225d 203d 2064 6174 615b 2243 6c6f 7365  "] = data["Close
+00018ff0: 225d 2e70 6374 5f63 6861 6e67 6528 2920  "].pct_change() 
+00019000: 2a20 3130 300a 2020 2020 2020 2020 2020  * 100.          
+00019010: 2020 6461 7461 203d 2064 6174 612e 696c    data = data.il
+00019020: 6f63 5b2d 315d 0a20 2020 2020 2020 2020  oc[-1].         
+00019030: 2020 2023 2323 0a20 2020 2020 2020 2020     ###.         
+00019040: 2020 2064 6174 6120 3d20 706b 6c5b 2273     data = pkl["s
+00019050: 6361 6c65 7222 5d2e 7472 616e 7366 6f72  caler"].transfor
+00019060: 6d28 5b64 6174 615d 290a 2020 2020 2020  m([data]).      
+00019070: 2020 2020 2020 7769 7468 2053 7570 7072        with Suppr
+00019080: 6573 734f 7574 7075 7428 7375 7070 7265  essOutput(suppre
+00019090: 7373 5f73 7464 6f75 743d 5472 7565 2c20  ss_stdout=True, 
+000190a0: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
+000190b0: 5472 7565 293a 0a20 2020 2020 2020 2020  True):.         
+000190c0: 2020 2020 2020 2070 7265 6420 3d20 6d6f         pred = mo
+000190d0: 6465 6c2e 7072 6564 6963 7428 6461 7461  del.predict(data
+000190e0: 295b 305d 0a20 2020 2020 2020 2069 6620  )[0].        if 
+000190f0: 7072 6564 203e 2030 2e35 3a0a 2020 2020  pred > 0.5:.    
+00019100: 2020 2020 2020 2020 6f75 7454 6578 7420          outText 
+00019110: 3d20 2242 4541 5249 5348 220a 2020 2020  = "BEARISH".    
+00019120: 2020 2020 2020 2020 6f75 7420 3d20 280a          out = (.
+00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019140: 636f 6c6f 7254 6578 742e 424f 4c44 0a20  colorText.BOLD. 
+00019150: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00019160: 2063 6f6c 6f72 5465 7874 2e46 4149 4c0a   colorText.FAIL.
+00019170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019180: 2b20 6f75 7454 6578 740a 2020 2020 2020  + outText.      
+00019190: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+000191a0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+000191b0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+000191c0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
+000191d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000191e0: 2020 2020 2073 7567 203d 2022 486f 6c64       sug = "Hold
+000191f0: 2079 6f75 7220 5368 6f72 7420 706f 7369   your Short posi
+00019200: 7469 6f6e 2122 0a20 2020 2020 2020 2065  tion!".        e
+00019210: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00019220: 206f 7574 5465 7874 203d 2022 4255 4c4c   outText = "BULL
+00019230: 4953 4822 0a20 2020 2020 2020 2020 2020  ISH".           
+00019240: 206f 7574 203d 2028 0a20 2020 2020 2020   out = (.       
+00019250: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
+00019260: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+00019270: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
+00019280: 6578 742e 4752 4545 4e0a 2020 2020 2020  ext.GREEN.      
+00019290: 2020 2020 2020 2020 2020 2b20 6f75 7454            + outT
+000192a0: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
+000192b0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+000192c0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+000192d0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+000192e0: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
+000192f0: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+00019300: 7567 203d 2022 5374 6179 2042 756c 6c69  ug = "Stay Bulli
+00019310: 7368 2122 0a20 2020 2020 2020 2069 6620  sh!".        if 
+00019320: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
+00019330: 6973 436c 6f73 696e 6748 6f75 7228 293a  isClosingHour():
+00019340: 0a20 2020 2020 2020 2020 2020 204f 7574  .            Out
+00019350: 7075 7443 6f6e 7472 6f6c 7328 292e 7072  putControls().pr
+00019360: 696e 744f 7574 7075 7428 0a20 2020 2020  intOutput(.     
+00019370: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+00019380: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+00019390: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+000193a0: 7254 6578 742e 5741 524e 0a20 2020 2020  rText.WARN.     
+000193b0: 2020 2020 2020 2020 2020 202b 2022 4e6f             + "No
+000193c0: 7465 3a20 5468 6520 4149 2070 7265 6469  te: The AI predi
+000193d0: 6374 696f 6e20 7368 6f75 6c64 2062 6520  ction should be 
+000193e0: 6578 6563 7574 6564 2041 6674 6572 2033  executed After 3
+000193f0: 2050 4d20 6f72 204e 6561 7220 746f 2043   PM or Near to C
+00019400: 6c6f 7369 6e67 2074 696d 6520 6173 2074  losing time as t
+00019410: 6865 2050 7265 6469 6374 696f 6e20 4163  he Prediction Ac
+00019420: 6375 7261 6379 2069 7320 6261 7365 6420  curacy is based 
+00019430: 6f6e 2074 6865 2043 6c6f 7369 6e67 2070  on the Closing p
+00019440: 7269 6365 2122 0a20 2020 2020 2020 2020  rice!".         
+00019450: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+00019460: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00019470: 2020 2029 0a20 2020 2020 2020 2070 7265     ).        pre
+00019480: 6469 6374 696f 6e54 6578 7420 3d20 224d  dictionText = "M
+00019490: 6172 6b65 7420 6d61 7920 4f70 656e 207b  arket may Open {
+000194a0: 7d20 6e65 7874 2064 6179 2120 7b7d 222e  } next day! {}".
+000194b0: 666f 726d 6174 286f 7574 2c20 7375 6729  format(out, sug)
+000194c0: 0a20 2020 2020 2020 2073 7472 656e 6774  .        strengt
+000194d0: 6854 6578 7420 3d20 2250 726f 6261 6269  hText = "Probabi
+000194e0: 6c69 7479 2f53 7472 656e 6774 6820 6f66  lity/Strength of
+000194f0: 2050 7265 6469 6374 696f 6e20 3d20 7b7d   Prediction = {}
+00019500: 2522 2e66 6f72 6d61 7428 0a20 2020 2020  %".format(.     
+00019510: 2020 2020 2020 2055 7469 6c69 7479 2e74         Utility.t
+00019520: 6f6f 6c73 2e67 6574 5369 676d 6f69 6443  ools.getSigmoidC
+00019530: 6f6e 6669 6465 6e63 6528 7072 6564 5b30  onfidence(pred[0
+00019540: 5d29 0a20 2020 2020 2020 2029 0a20 2020  ]).        ).   
+00019550: 2020 2020 204f 7574 7075 7443 6f6e 7472       OutputContr
+00019560: 6f6c 7328 292e 7072 696e 744f 7574 7075  ols().printOutpu
+00019570: 7428 0a20 2020 2020 2020 2020 2020 2063  t(.            c
+00019580: 6f6c 6f72 5465 7874 2e42 4f4c 440a 2020  olorText.BOLD.  
+00019590: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+000195a0: 7254 6578 742e 424c 5545 0a20 2020 2020  rText.BLUE.     
+000195b0: 2020 2020 2020 202b 2022 5c6e 220a 2020         + "\n".  
+000195c0: 2020 2020 2020 2020 2020 2b20 225b 2b5d            + "[+]
+000195d0: 204e 6966 7479 2041 4920 5072 6564 6963   Nifty AI Predic
+000195e0: 7469 6f6e 202d 3e20 220a 2020 2020 2020  tion -> ".      
+000195f0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+00019600: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+00019610: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+00019620: 4c44 0a20 2020 2020 2020 2020 2020 202b  LD.            +
+00019630: 2070 7265 6469 6374 696f 6e54 6578 740a   predictionText.
+00019640: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+00019650: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00019660: 2020 2020 290a 2020 2020 2020 2020 4f75      ).        Ou
+00019670: 7470 7574 436f 6e74 726f 6c73 2829 2e70  tputControls().p
+00019680: 7269 6e74 4f75 7470 7574 280a 2020 2020  rintOutput(.    
+00019690: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
+000196a0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+000196b0: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
+000196c0: 4c55 450a 2020 2020 2020 2020 2020 2020  LUE.            
+000196d0: 2b20 225c 6e22 0a20 2020 2020 2020 2020  + "\n".         
+000196e0: 2020 202b 2022 5b2b 5d20 4e69 6674 7920     + "[+] Nifty 
+000196f0: 4149 2050 7265 6469 6374 696f 6e20 2d3e  AI Prediction ->
+00019700: 2022 0a20 2020 2020 2020 2020 2020 202b   ".            +
+00019710: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00019720: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+00019730: 656e 6774 6854 6578 740a 2020 2020 2020  engthText.      
+00019740: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
+00019750: 7572 6e20 7072 6564 2c20 7072 6564 6963  urn pred, predic
+00019760: 7469 6f6e 5465 7874 2e72 6570 6c61 6365  tionText.replace
+00019770: 286f 7574 2c20 6f75 7454 6578 7429 2c20  (out, outText), 
+00019780: 7374 7265 6e67 7468 5465 7874 0a0a 2020  strengthText..  
+00019790: 2020 6465 6620 6d6f 6e69 746f 7246 6976    def monitorFiv
+000197a0: 6545 6d61 2873 656c 662c 2066 6574 6368  eEma(self, fetch
+000197b0: 6572 2c20 7265 7375 6c74 5f64 662c 206c  er, result_df, l
+000197c0: 6173 745f 7369 676e 616c 2c20 7269 736b  ast_signal, risk
+000197d0: 5f72 6577 6172 643d 3329 3a0a 2020 2020  _reward=3):.    
+000197e0: 2020 2020 636f 6c5f 6e61 6d65 7320 3d20      col_names = 
+000197f0: 5b22 4869 6768 222c 2022 4c6f 7722 2c20  ["High", "Low", 
+00019800: 2243 6c6f 7365 222c 2022 3545 4d41 225d  "Close", "5EMA"]
+00019810: 0a20 2020 2020 2020 2064 6174 615f 6c69  .        data_li
+00019820: 7374 203d 205b 226e 6966 7479 5f62 7579  st = ["nifty_buy
+00019830: 222c 2022 6261 6e6b 6e69 6674 795f 6275  ", "banknifty_bu
+00019840: 7922 2c20 226e 6966 7479 5f73 656c 6c22  y", "nifty_sell"
+00019850: 2c20 2262 616e 6b6e 6966 7479 5f73 656c  , "banknifty_sel
+00019860: 6c22 5d0a 0a20 2020 2020 2020 2064 6174  l"]..        dat
+00019870: 615f 7475 706c 6520 3d20 6665 7463 6865  a_tuple = fetche
+00019880: 722e 6665 7463 6846 6976 6545 6d61 4461  r.fetchFiveEmaDa
+00019890: 7461 2829 0a20 2020 2020 2020 2066 6f72  ta().        for
+000198a0: 2063 6e74 2069 6e20 7261 6e67 6528 6c65   cnt in range(le
+000198b0: 6e28 6461 7461 5f74 7570 6c65 2929 3a0a  n(data_tuple)):.
+000198c0: 2020 2020 2020 2020 2020 2020 6420 3d20              d = 
+000198d0: 6461 7461 5f74 7570 6c65 5b63 6e74 5d0a  data_tuple[cnt].
+000198e0: 2020 2020 2020 2020 2020 2020 645b 2235              d["5
+000198f0: 454d 4122 5d20 3d20 706b 7461 6c69 622e  EMA"] = pktalib.
+00019900: 454d 4128 645b 2243 6c6f 7365 225d 2c20  EMA(d["Close"], 
+00019910: 7469 6d65 7065 7269 6f64 3d35 290a 2020  timeperiod=5).  
+00019920: 2020 2020 2020 2020 2020 6420 3d20 645b            d = d[
+00019930: 636f 6c5f 6e61 6d65 735d 0a20 2020 2020  col_names].     
+00019940: 2020 2020 2020 2064 203d 2064 2e64 726f         d = d.dro
+00019950: 706e 6128 292e 726f 756e 6428 3229 0a0a  pna().round(2)..
+00019960: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00019970: 2053 7570 7072 6573 734f 7574 7075 7428   SuppressOutput(
+00019980: 7375 7070 7265 7373 5f73 7464 6572 723d  suppress_stderr=
+00019990: 5472 7565 2c20 7375 7070 7265 7373 5f73  True, suppress_s
+000199a0: 7464 6f75 743d 5472 7565 293a 0a20 2020  tdout=True):.   
+000199b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000199c0: 2273 656c 6c22 2069 6e20 6461 7461 5f6c  "sell" in data_l
+000199d0: 6973 745b 636e 745d 3a0a 2020 2020 2020  ist[cnt]:.      
+000199e0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000199f0: 7265 6368 6564 203d 2064 5b28 642e 4c6f  reched = d[(d.Lo
+00019a00: 7720 3e20 645b 2235 454d 4122 5d29 2026  w > d["5EMA"]) &
+00019a10: 2028 642e 4c6f 7720 2d20 645b 2235 454d   (d.Low - d["5EM
+00019a20: 4122 5d20 3e20 302e 3529 5d0a 2020 2020  A"] > 0.5)].    
 00019a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a40: 2020 2020 2020 2020 2020 202d 2076 616c             - val
-00019a50: 6964 6174 652e 436c 6f73 652e 7265 7365  idate.Close.rese
-00019a60: 745f 696e 6465 7828 6472 6f70 3d54 7275  t_index(drop=Tru
-00019a70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00019a80: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00019a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019aa0: 2020 2020 202a 2072 6973 6b5f 7265 7761       * risk_rewa
-00019ab0: 7264 0a20 2020 2020 2020 2020 2020 2020  rd.             
-00019ac0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00019ad0: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-00019ae0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-00019af0: 6d6e 733d 5b22 5461 7267 6574 225d 2c0a  mns=["Target"],.
-00019b00: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00019b10: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
-00019b20: 7465 203d 2070 642e 636f 6e63 6174 280a  te = pd.concat(.
-00019b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b40: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00019b50: 2020 2020 2020 7661 6c69 6461 7465 2e72        validate.r
-00019b60: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
-00019b70: 5472 7565 292c 0a20 2020 2020 2020 2020  True),.         
-00019b80: 2020 2020 2020 2020 2020 2073 7472 6563             strec
-00019b90: 6865 645b 2253 4c22 5d2e 7265 7365 745f  hed["SL"].reset_
-00019ba0: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
-00019bb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019bc0: 2020 2020 2020 7467 742c 0a20 2020 2020        tgt,.     
-00019bd0: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
-00019be0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00019bf0: 6973 3d31 2c0a 2020 2020 2020 2020 2020  is=1,.          
-00019c00: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00019c10: 7661 6c69 6461 7465 203d 2076 616c 6964  validate = valid
-00019c20: 6174 652e 7461 696c 286c 656e 286f 6c64  ate.tail(len(old
-00019c30: 5f69 6e64 6578 2929 0a20 2020 2020 2020  _index)).       
-00019c40: 2020 2020 2076 616c 6964 6174 6520 3d20       validate = 
-00019c50: 7661 6c69 6461 7465 2e73 6574 5f69 6e64  validate.set_ind
-00019c60: 6578 286f 6c64 5f69 6e64 6578 290a 2020  ex(old_index).  
-00019c70: 2020 2020 2020 2020 2020 6966 2022 7365            if "se
-00019c80: 6c6c 2220 696e 2064 6174 615f 6c69 7374  ll" in data_list
-00019c90: 5b63 6e74 5d3a 0a20 2020 2020 2020 2020  [cnt]:.         
-00019ca0: 2020 2020 2020 2066 696e 616c 203d 2076         final = v
-00019cb0: 616c 6964 6174 655b 7661 6c69 6461 7465  alidate[validate
-00019cc0: 2e43 6c6f 7365 203c 2076 616c 6964 6174  .Close < validat
-00019cd0: 655b 2235 454d 4122 5d5d 2e74 6169 6c28  e["5EMA"]].tail(
-00019ce0: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
-00019cf0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00019d00: 2020 2020 2066 696e 616c 203d 2076 616c       final = val
-00019d10: 6964 6174 655b 7661 6c69 6461 7465 2e43  idate[validate.C
-00019d20: 6c6f 7365 203e 2076 616c 6964 6174 655b  lose > validate[
-00019d30: 2235 454d 4122 5d5d 2e74 6169 6c28 3129  "5EMA"]].tail(1)
-00019d40: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00019d50: 2064 6174 615f 6c69 7374 5b63 6e74 5d20   data_list[cnt] 
-00019d60: 6e6f 7420 696e 206c 6173 745f 7369 676e  not in last_sign
-00019d70: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
-00019d80: 2020 2020 6c61 7374 5f73 6967 6e61 6c5b      last_signal[
-00019d90: 6461 7461 5f6c 6973 745b 636e 745d 5d20  data_list[cnt]] 
-00019da0: 3d20 6669 6e61 6c0a 2020 2020 2020 2020  = final.        
-00019db0: 2020 2020 656c 6966 2064 6174 615f 6c69      elif data_li
-00019dc0: 7374 5b63 6e74 5d20 696e 206c 6173 745f  st[cnt] in last_
-00019dd0: 7369 676e 616c 3a0a 2020 2020 2020 2020  signal:.        
-00019de0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e00: 2063 6f6e 6469 7469 6f6e 203d 206c 6173   condition = las
-00019e10: 745f 7369 676e 616c 5b64 6174 615f 6c69  t_signal[data_li
-00019e20: 7374 5b63 6e74 5d5d 5b30 5d5b 2253 4c22  st[cnt]][0]["SL"
-00019e30: 5d5b 305d 0a20 2020 2020 2020 2020 2020  ][0].           
-00019e40: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00019e50: 7272 6f72 2061 7320 653a 2023 2070 7261  rror as e: # pra
-00019e60: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
+00019a40: 7374 7265 6368 6564 5b22 534c 225d 203d  streched["SL"] =
+00019a50: 2073 7472 6563 6865 642e 4869 6768 0a20   streched.High. 
+00019a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a70: 2020 2076 616c 6964 6174 6520 3d20 645b     validate = d[
+00019a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019a90: 2020 2020 2020 2020 2028 642e 4c6f 772e           (d.Low.
+00019aa0: 7368 6966 7428 3129 203e 2064 5b22 3545  shift(1) > d["5E
+00019ab0: 4d41 225d 2e73 6869 6674 2831 2929 0a20  MA"].shift(1)). 
+00019ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ad0: 2020 2020 2020 2026 2028 642e 4c6f 772e         & (d.Low.
+00019ae0: 7368 6966 7428 3129 202d 2064 5b22 3545  shift(1) - d["5E
+00019af0: 4d41 225d 2e73 6869 6674 2831 2920 3e20  MA"].shift(1) > 
+00019b00: 302e 3529 0a20 2020 2020 2020 2020 2020  0.5).           
+00019b10: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00019b20: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00019b30: 6c64 5f69 6e64 6578 203d 2076 616c 6964  ld_index = valid
+00019b40: 6174 652e 696e 6465 780a 2020 2020 2020  ate.index.      
+00019b50: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00019b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b70: 2020 2020 6d61 736b 203d 2028 642e 4869      mask = (d.Hi
+00019b80: 6768 203c 2064 5b22 3545 4d41 225d 2920  gh < d["5EMA"]) 
+00019b90: 2620 2864 5b22 3545 4d41 225d 202d 2064  & (d["5EMA"] - d
+00019ba0: 2e48 6967 6820 3e20 302e 3529 2020 2320  .High > 0.5)  # 
+00019bb0: 4275 790a 2020 2020 2020 2020 2020 2020  Buy.            
+00019bc0: 2020 2020 2020 2020 7374 7265 6368 6564          streched
+00019bd0: 203d 2064 5b6d 6173 6b5d 0a20 2020 2020   = d[mask].     
+00019be0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00019bf0: 7472 6563 6865 645b 2253 4c22 5d20 3d20  treched["SL"] = 
+00019c00: 7374 7265 6368 6564 2e4c 6f77 0a20 2020  streched.Low.   
+00019c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c20: 2076 616c 6964 6174 6520 3d20 642e 6c6f   validate = d.lo
+00019c30: 635b 6d61 736b 2e73 6869 6674 2831 292e  c[mask.shift(1).
+00019c40: 6669 6c6c 6e61 2846 616c 7365 295d 0a20  fillna(False)]. 
+00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c60: 2020 206f 6c64 5f69 6e64 6578 203d 2076     old_index = v
+00019c70: 616c 6964 6174 652e 696e 6465 780a 2020  alidate.index.  
+00019c80: 2020 2020 2020 2020 2020 7467 7420 3d20            tgt = 
+00019c90: 7064 2e44 6174 6146 7261 6d65 280a 2020  pd.DataFrame(.  
+00019ca0: 2020 2020 2020 2020 2020 2020 2020 280a                (.
+00019cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cc0: 2020 2020 7661 6c69 6461 7465 2e43 6c6f      validate.Clo
+00019cd0: 7365 2e72 6573 6574 5f69 6e64 6578 2864  se.reset_index(d
+00019ce0: 726f 703d 5472 7565 290a 2020 2020 2020  rop=True).      
+00019cf0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+00019d00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019d10: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
+00019d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d30: 2020 2020 2020 2020 7374 7265 6368 6564          streched
+00019d40: 2e53 4c2e 7265 7365 745f 696e 6465 7828  .SL.reset_index(
+00019d50: 6472 6f70 3d54 7275 6529 0a20 2020 2020  drop=True).     
+00019d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d70: 2020 2020 2020 202d 2076 616c 6964 6174         - validat
+00019d80: 652e 436c 6f73 652e 7265 7365 745f 696e  e.Close.reset_in
+00019d90: 6465 7828 6472 6f70 3d54 7275 6529 0a20  dex(drop=True). 
+00019da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019db0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00019dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019dd0: 202a 2072 6973 6b5f 7265 7761 7264 0a20   * risk_reward. 
+00019de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019df0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00019e00: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00019e10: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+00019e20: 5b22 5461 7267 6574 225d 2c0a 2020 2020  ["Target"],.    
+00019e30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00019e40: 2020 2020 2020 7661 6c69 6461 7465 203d        validate =
+00019e50: 2070 642e 636f 6e63 6174 280a 2020 2020   pd.concat(.    
+00019e60: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
 00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e80: 2020 7365 6c66 2e64 6566 6175 6c74 5f6c    self.default_l
-00019e90: 6f67 6765 722e 6465 6275 6728 652c 2065  ogger.debug(e, e
-00019ea0: 7863 5f69 6e66 6f3d 5472 7565 290a 2020  xc_info=True).  
-00019eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ec0: 2020 636f 6e64 6974 696f 6e20 3d20 6c61    condition = la
-00019ed0: 7374 5f73 6967 6e61 6c5b 6461 7461 5f6c  st_signal[data_l
-00019ee0: 6973 745b 636e 745d 5d5b 2253 4c22 5d5b  ist[cnt]]["SL"][
-00019ef0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-00019f00: 2020 2023 2069 6620 6c61 7374 5f73 6967     # if last_sig
-00019f10: 6e61 6c5b 6461 7461 5f6c 6973 745b 636e  nal[data_list[cn
-00019f20: 745d 5d20 6973 206e 6f74 2066 696e 616c  t]] is not final
-00019f30: 3a20 2020 2020 2020 2020 2023 2044 6562  :          # Deb
-00019f40: 7567 202d 2053 686f 7773 2061 6c6c 2063  ug - Shows all c
-00019f50: 6f6e 6469 7469 6f6e 730a 2020 2020 2020  onditions.      
-00019f60: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00019f70: 2866 696e 616c 5b22 534c 225d 2920 3e20  (final["SL"]) > 
-00019f80: 3020 616e 6420 636f 6e64 6974 696f 6e20  0 and condition 
-00019f90: 213d 2066 696e 616c 5b22 534c 225d 2e69  != final["SL"].i
-00019fa0: 6c6f 635b 305d 3a0a 2020 2020 2020 2020  loc[0]:.        
-00019fb0: 2020 2020 2020 2020 2020 2020 2320 446f              # Do
-00019fc0: 2073 6f6d 6574 6869 6e67 2077 6974 6820   something with 
-00019fd0: 7265 7375 6c74 730a 2020 2020 2020 2020  results.        
-00019fe0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00019ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a000: 2020 2020 2020 2020 2072 6573 756c 745f           result_
-0001a010: 6466 203d 2070 642e 636f 6e63 6174 280a  df = pd.concat(.
-0001a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a030: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
-0001a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a050: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001a060: 7375 6c74 5f64 662c 0a20 2020 2020 2020  sult_df,.       
-0001a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a080: 2020 2020 2020 2020 2070 642e 4461 7461           pd.Data
-0001a090: 4672 616d 6528 0a20 2020 2020 2020 2020  Frame(.         
+00019e80: 2020 7661 6c69 6461 7465 2e72 6573 6574    validate.reset
+00019e90: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+00019ea0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00019eb0: 2020 2020 2020 2073 7472 6563 6865 645b         streched[
+00019ec0: 2253 4c22 5d2e 7265 7365 745f 696e 6465  "SL"].reset_inde
+00019ed0: 7828 6472 6f70 3d54 7275 6529 2c0a 2020  x(drop=True),.  
+00019ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ef0: 2020 7467 742c 0a20 2020 2020 2020 2020    tgt,.         
+00019f00: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+00019f10: 2020 2020 2020 2020 2020 6178 6973 3d31            axis=1
+00019f20: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00019f30: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
+00019f40: 6461 7465 203d 2076 616c 6964 6174 652e  date = validate.
+00019f50: 7461 696c 286c 656e 286f 6c64 5f69 6e64  tail(len(old_ind
+00019f60: 6578 2929 0a20 2020 2020 2020 2020 2020  ex)).           
+00019f70: 2076 616c 6964 6174 6520 3d20 7661 6c69   validate = vali
+00019f80: 6461 7465 2e73 6574 5f69 6e64 6578 286f  date.set_index(o
+00019f90: 6c64 5f69 6e64 6578 290a 2020 2020 2020  ld_index).      
+00019fa0: 2020 2020 2020 6966 2022 7365 6c6c 2220        if "sell" 
+00019fb0: 696e 2064 6174 615f 6c69 7374 5b63 6e74  in data_list[cnt
+00019fc0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00019fd0: 2020 2066 696e 616c 203d 2076 616c 6964     final = valid
+00019fe0: 6174 655b 7661 6c69 6461 7465 2e43 6c6f  ate[validate.Clo
+00019ff0: 7365 203c 2076 616c 6964 6174 655b 2235  se < validate["5
+0001a000: 454d 4122 5d5d 2e74 6169 6c28 3129 0a20  EMA"]].tail(1). 
+0001a010: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001a020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a030: 2066 696e 616c 203d 2076 616c 6964 6174   final = validat
+0001a040: 655b 7661 6c69 6461 7465 2e43 6c6f 7365  e[validate.Close
+0001a050: 203e 2076 616c 6964 6174 655b 2235 454d   > validate["5EM
+0001a060: 4122 5d5d 2e74 6169 6c28 3129 0a0a 2020  A"]].tail(1)..  
+0001a070: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
+0001a080: 615f 6c69 7374 5b63 6e74 5d20 6e6f 7420  a_list[cnt] not 
+0001a090: 696e 206c 6173 745f 7369 676e 616c 3a0a  in last_signal:.
 0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0b0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-0001a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0e0: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
-0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a110: 2020 2063 6f6c 6f72 5465 7874 2e42 4c55     colorText.BLU
-0001a120: 450a 2020 2020 2020 2020 2020 2020 2020  E.              
-0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a140: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001a150: 7374 7228 6669 6e61 6c2e 696e 6465 785b  str(final.index[
-0001a160: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-0001a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a190: 2b20 636f 6c6f 7254 6578 742e 454e 442c  + colorText.END,
-0001a1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1c0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-0001a1d0: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
-0001a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a200: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-0001a210: 6578 742e 5741 524e 0a20 2020 2020 2020  ext.WARN.       
-0001a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a240: 2020 2020 202b 2064 6174 615f 6c69 7374       + data_list
-0001a250: 5b63 6e74 5d2e 7370 6c69 7428 225f 2229  [cnt].split("_")
-0001a260: 5b30 5d2e 7570 7065 7228 290a 2020 2020  [0].upper().    
-0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
-0001a2a0: 6578 742e 454e 442c 0a20 2020 2020 2020  ext.END,.       
-0001a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2d0: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
-0001a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a300: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-0001a310: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0001a0b0: 6c61 7374 5f73 6967 6e61 6c5b 6461 7461  last_signal[data
+0001a0c0: 5f6c 6973 745b 636e 745d 5d20 3d20 6669  _list[cnt]] = fi
+0001a0d0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0001a0e0: 656c 6966 2064 6174 615f 6c69 7374 5b63  elif data_list[c
+0001a0f0: 6e74 5d20 696e 206c 6173 745f 7369 676e  nt] in last_sign
+0001a100: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
+0001a110: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001a120: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001a130: 6469 7469 6f6e 203d 206c 6173 745f 7369  dition = last_si
+0001a140: 676e 616c 5b64 6174 615f 6c69 7374 5b63  gnal[data_list[c
+0001a150: 6e74 5d5d 5b30 5d5b 2253 4c22 5d5b 305d  nt]][0]["SL"][0]
+0001a160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a170: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+0001a180: 2061 7320 653a 2023 2070 7261 676d 613a   as e: # pragma:
+0001a190: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+0001a1a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001a1b0: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+0001a1c0: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
+0001a1d0: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
+0001a1e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001a1f0: 6e64 6974 696f 6e20 3d20 6c61 7374 5f73  ndition = last_s
+0001a200: 6967 6e61 6c5b 6461 7461 5f6c 6973 745b  ignal[data_list[
+0001a210: 636e 745d 5d5b 2253 4c22 5d5b 305d 0a20  cnt]]["SL"][0]. 
+0001a220: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001a230: 2069 6620 6c61 7374 5f73 6967 6e61 6c5b   if last_signal[
+0001a240: 6461 7461 5f6c 6973 745b 636e 745d 5d20  data_list[cnt]] 
+0001a250: 6973 206e 6f74 2066 696e 616c 3a20 2020  is not final:   
+0001a260: 2020 2020 2020 2023 2044 6562 7567 202d         # Debug -
+0001a270: 2053 686f 7773 2061 6c6c 2063 6f6e 6469   Shows all condi
+0001a280: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
+0001a290: 2020 2020 2020 6966 206c 656e 2866 696e        if len(fin
+0001a2a0: 616c 5b22 534c 225d 2920 3e20 3020 616e  al["SL"]) > 0 an
+0001a2b0: 6420 636f 6e64 6974 696f 6e20 213d 2066  d condition != f
+0001a2c0: 696e 616c 5b22 534c 225d 2e69 6c6f 635b  inal["SL"].iloc[
+0001a2d0: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+0001a2e0: 2020 2020 2020 2020 2320 446f 2073 6f6d          # Do som
+0001a2f0: 6574 6869 6e67 2077 6974 6820 7265 7375  ething with resu
+0001a300: 6c74 730a 2020 2020 2020 2020 2020 2020  lts.            
+0001a310: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
 0001a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001a350: 742e 4641 494c 0a20 2020 2020 2020 2020  t.FAIL.         
-0001a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a330: 2020 2020 2072 6573 756c 745f 6466 203d       result_df =
+0001a340: 2070 642e 636f 6e63 6174 280a 2020 2020   pd.concat(.    
+0001a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a360: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
 0001a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a380: 2020 2020 2020 202b 2064 6174 615f 6c69         + data_li
-0001a390: 7374 5b63 6e74 5d2e 7370 6c69 7428 225f  st[cnt].split("_
-0001a3a0: 2229 5b31 5d2e 7570 7065 7228 290a 2020  ")[1].upper().  
-0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001a3e0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0001a380: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0001a390: 5f64 662c 0a20 2020 2020 2020 2020 2020  _df,.           
+0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3b0: 2020 2020 2070 642e 4461 7461 4672 616d       pd.DataFram
+0001a3c0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3e0: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
 0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a410: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001a410: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
 0001a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a440: 2020 2020 2020 2020 6966 2022 7365 6c6c          if "sell
-0001a450: 2220 696e 2064 6174 615f 6c69 7374 5b63  " in data_list[c
-0001a460: 6e74 5d0a 2020 2020 2020 2020 2020 2020  nt].            
-0001a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a490: 656c 7365 2028 0a20 2020 2020 2020 2020  else (.         
+0001a430: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001a440: 6f6c 6f72 5465 7874 2e42 4c55 450a 2020  olorText.BLUE.  
+0001a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a470: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
+0001a480: 6669 6e61 6c2e 696e 6465 785b 305d 290a  final.index[0]).
+0001a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4c0: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-0001a4d0: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0001a4b0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001a4c0: 6c6f 7254 6578 742e 454e 442c 0a20 2020  lorText.END,.   
+0001a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a500: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001a510: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
+0001a4f0: 2020 2020 2020 2020 2063 6f6c 6f72 5465           colorTe
+0001a500: 7874 2e42 4f4c 440a 2020 2020 2020 2020  xt.BOLD.        
+0001a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a540: 2020 2020 2020 2020 2b20 6461 7461 5f6c          + data_l
-0001a550: 6973 745b 636e 745d 2e73 706c 6974 2822  ist[cnt].split("
-0001a560: 5f22 295b 315d 2e75 7070 6572 2829 0a20  _")[1].upper(). 
-0001a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a590: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001a5a0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+0001a530: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0001a540: 5741 524e 0a20 2020 2020 2020 2020 2020  WARN.           
+0001a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a570: 202b 2064 6174 615f 6c69 7374 5b63 6e74   + data_list[cnt
+0001a580: 5d2e 7370 6c69 7428 225f 2229 5b30 5d2e  ].split("_")[0].
+0001a590: 7570 7065 7228 290a 2020 2020 2020 2020  upper().        
+0001a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5d0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+0001a5c0: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
+0001a5d0: 454e 442c 0a20 2020 2020 2020 2020 2020  END,.           
 0001a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a600: 2020 2020 2020 2020 2020 636f 6c6f 7254            colorT
-0001a610: 6578 742e 4641 494c 0a20 2020 2020 2020  ext.FAIL.       
+0001a600: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 2020 2020 202b 2073 7472 2866 696e 616c       + str(final
-0001a650: 2e53 4c5b 305d 290a 2020 2020 2020 2020  .SL[0]).        
+0001a630: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0001a640: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a680: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0001a690: 454e 442c 0a20 2020 2020 2020 2020 2020  END,.           
+0001a670: 2020 2b20 636f 6c6f 7254 6578 742e 4641    + colorText.FA
+0001a680: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
+0001a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-0001a6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a6b0: 2020 202b 2064 6174 615f 6c69 7374 5b63     + data_list[c
+0001a6c0: 6e74 5d2e 7370 6c69 7428 225f 2229 5b31  nt].split("_")[1
+0001a6d0: 5d2e 7570 7065 7228 290a 2020 2020 2020  ].upper().      
 0001a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6f0: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-0001a700: 7472 2866 696e 616c 2e54 6172 6765 745b  tr(final.Target[
-0001a710: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a700: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
+0001a710: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
 0001a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a740: 2b20 636f 6c6f 7254 6578 742e 454e 442c  + colorText.END,
-0001a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a740: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a770: 2020 2020 2020 2020 2020 2020 2066 2231               f"1
-0001a780: 3a7b 7269 736b 5f72 6577 6172 647d 222c  :{risk_reward}",
-0001a790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a770: 2020 2020 6966 2022 7365 6c6c 2220 696e      if "sell" in
+0001a780: 2064 6174 615f 6c69 7374 5b63 6e74 5d0a   data_list[cnt].
+0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7b0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0001a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7d0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-0001a7e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a800: 2020 2020 2020 636f 6c75 6d6e 733d 7265        columns=re
-0001a810: 7375 6c74 5f64 662e 636f 6c75 6d6e 732c  sult_df.columns,
-0001a820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a840: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0001a7b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001a7c0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7f0: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0001a800: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a830: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+0001a840: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
 0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a860: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001a870: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001a880: 7869 733d 302c 0a20 2020 2020 2020 2020  xis=0,.         
-0001a890: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001a8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a8b0: 2020 2020 2020 2020 2072 6573 756c 745f           result_
-0001a8c0: 6466 2e72 6573 6574 5f69 6e64 6578 2864  df.reset_index(d
-0001a8d0: 726f 703d 5472 7565 2c20 696e 706c 6163  rop=True, inplac
-0001a8e0: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-0001a8f0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0001a900: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0001a910: 653a 2020 2320 7072 6167 6d61 3a20 6e6f  e:  # pragma: no
-0001a920: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-0001a930: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001a940: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-0001a950: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
-0001a960: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
-0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a980: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001a990: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-0001a9a0: 656e 2075 7064 6174 650a 2020 2020 2020  en update.      
-0001a9b0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001a9c0: 7374 5f73 6967 6e61 6c5b 6461 7461 5f6c  st_signal[data_l
-0001a9d0: 6973 745b 636e 745d 5d20 3d20 5b66 696e  ist[cnt]] = [fin
-0001a9e0: 616c 5d0a 2020 2020 2020 2020 6966 2072  al].        if r
-0001a9f0: 6573 756c 745f 6466 2069 7320 6e6f 7420  esult_df is not 
-0001aa00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001aa10: 2020 7265 7375 6c74 5f64 662e 6472 6f70    result_df.drop
-0001aa20: 5f64 7570 6c69 6361 7465 7328 6b65 6570  _duplicates(keep
-0001aa30: 3d22 6c61 7374 222c 2069 6e70 6c61 6365  ="last", inplace
-0001aa40: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-0001aa50: 2020 2072 6573 756c 745f 6466 2e73 6f72     result_df.sor
-0001aa60: 745f 7661 6c75 6573 2862 793d 2254 696d  t_values(by="Tim
-0001aa70: 6522 2c20 696e 706c 6163 653d 5472 7565  e", inplace=True
-0001aa80: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001aa90: 2072 6573 756c 745f 6466 5b3a 3a2d 315d   result_df[::-1]
-0001aaa0: 0a0a 2020 2020 2320 5072 6570 726f 6365  ..    # Preproce
-0001aab0: 7373 2074 6865 2061 6371 7569 7265 6420  ss the acquired 
-0001aac0: 6461 7461 0a20 2020 2064 6566 2070 7265  data.    def pre
-0001aad0: 7072 6f63 6573 7344 6174 6128 7365 6c66  processData(self
-0001aae0: 2c20 6466 2c20 6461 7973 546f 4c6f 6f6b  , df, daysToLook
-0001aaf0: 6261 636b 3d4e 6f6e 6529 3a0a 2020 2020  back=None):.    
-0001ab00: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-0001ab10: 7461 6e63 6528 6466 2c20 7064 2e44 6174  tance(df, pd.Dat
-0001ab20: 6146 7261 6d65 290a 2020 2020 2020 2020  aFrame).        
-0001ab30: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
-0001ab40: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0001ab50: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0001ab60: 2064 6174 612e 7265 706c 6163 6528 6e70   data.replace(np
-0001ab70: 2e69 6e66 2c20 6e70 2e6e 616e 292e 7265  .inf, np.nan).re
-0001ab80: 706c 6163 6528 2d6e 702e 696e 662c 206e  place(-np.inf, n
-0001ab90: 702e 6e61 6e29 2e64 726f 706e 6128 686f  p.nan).dropna(ho
-0001aba0: 773d 2261 6c6c 2229 0a20 2020 2020 2020  w="all").       
-0001abb0: 2020 2020 2023 2073 656c 662e 6465 6661       # self.defa
-0001abc0: 756c 745f 6c6f 6767 6572 2e69 6e66 6f28  ult_logger.info(
-0001abd0: 6622 5072 6570 726f 6365 7373 696e 6720  f"Preprocessing 
-0001abe0: 6461 7461 3a5c 6e7b 6461 7461 2e68 6561  data:\n{data.hea
-0001abf0: 6428 3129 7d5c 6e22 290a 2020 2020 2020  d(1)}\n").      
-0001ac00: 2020 2020 2020 6966 2064 6179 7354 6f4c        if daysToL
-0001ac10: 6f6f 6b62 6163 6b20 6973 204e 6f6e 653a  ookback is None:
-0001ac20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ac30: 2064 6179 7354 6f4c 6f6f 6b62 6163 6b20   daysToLookback 
-0001ac40: 3d20 7365 6c66 2e63 6f6e 6669 674d 616e  = self.configMan
-0001ac50: 6167 6572 2e64 6179 7354 6f4c 6f6f 6b62  ager.daysToLookb
-0001ac60: 6163 6b0a 2020 2020 2020 2020 2020 2020  ack.            
-0001ac70: 6966 2073 656c 662e 636f 6e66 6967 4d61  if self.configMa
-0001ac80: 6e61 6765 722e 7573 6545 4d41 3a0a 2020  nager.useEMA:.  
-0001ac90: 2020 2020 2020 2020 2020 2020 2020 736d                sm
-0001aca0: 6120 3d20 706b 7461 6c69 622e 454d 4128  a = pktalib.EMA(
-0001acb0: 6461 7461 5b22 436c 6f73 6522 5d2c 2074  data["Close"], t
-0001acc0: 696d 6570 6572 696f 643d 3530 290a 2020  imeperiod=50).  
-0001acd0: 2020 2020 2020 2020 2020 2020 2020 6c6d                lm
-0001ace0: 6120 3d20 706b 7461 6c69 622e 454d 4128  a = pktalib.EMA(
-0001acf0: 6461 7461 5b22 436c 6f73 6522 5d2c 2074  data["Close"], t
-0001ad00: 696d 6570 6572 696f 643d 3230 3029 0a20  imeperiod=200). 
-0001ad10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001ad20: 736d 6120 3d20 706b 7461 6c69 622e 454d  sma = pktalib.EM
-0001ad30: 4128 6461 7461 5b22 436c 6f73 6522 5d2c  A(data["Close"],
-0001ad40: 2074 696d 6570 6572 696f 643d 3929 0a20   timeperiod=9). 
-0001ad50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001ad60: 736d 6132 3020 3d20 706b 7461 6c69 622e  sma20 = pktalib.
-0001ad70: 454d 4128 6461 7461 5b22 436c 6f73 6522  EMA(data["Close"
-0001ad80: 5d2c 2074 696d 6570 6572 696f 643d 3230  ], timeperiod=20
-0001ad90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ada0: 2020 6461 7461 2e69 6e73 6572 7428 6c65    data.insert(le
-0001adb0: 6e28 6461 7461 2e63 6f6c 756d 6e73 292c  n(data.columns),
-0001adc0: 2022 534d 4122 2c20 736d 6129 0a20 2020   "SMA", sma).   
-0001add0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0001ade0: 612e 696e 7365 7274 286c 656e 2864 6174  a.insert(len(dat
-0001adf0: 612e 636f 6c75 6d6e 7329 2c20 224c 4d41  a.columns), "LMA
-0001ae00: 222c 206c 6d61 290a 2020 2020 2020 2020  ", lma).        
-0001ae10: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
-0001ae20: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
-0001ae30: 756d 6e73 292c 2022 5353 4d41 222c 2073  umns), "SSMA", s
-0001ae40: 736d 6129 0a20 2020 2020 2020 2020 2020  sma).           
-0001ae50: 2020 2020 2064 6174 612e 696e 7365 7274       data.insert
-0001ae60: 286c 656e 2864 6174 612e 636f 6c75 6d6e  (len(data.column
-0001ae70: 7329 2c20 2253 534d 4132 3022 2c20 7373  s), "SSMA20", ss
-0001ae80: 6d61 3230 290a 2020 2020 2020 2020 2020  ma20).          
-0001ae90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001aea0: 2020 2020 2020 2020 736d 6120 3d20 706b          sma = pk
-0001aeb0: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
-0001aec0: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-0001aed0: 696f 643d 3530 290a 2020 2020 2020 2020  iod=50).        
-0001aee0: 2020 2020 2020 2020 6c6d 6120 3d20 706b          lma = pk
-0001aef0: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
-0001af00: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
-0001af10: 696f 643d 3230 3029 0a20 2020 2020 2020  iod=200).       
-0001af20: 2020 2020 2020 2020 2073 736d 6120 3d20           ssma = 
-0001af30: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-0001af40: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
-0001af50: 6572 696f 643d 3929 0a20 2020 2020 2020  eriod=9).       
-0001af60: 2020 2020 2020 2020 2073 736d 6132 3020           ssma20 
-0001af70: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
-0001af80: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
-0001af90: 6570 6572 696f 643d 3230 290a 2020 2020  eperiod=20).    
-0001afa0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001afb0: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0001afc0: 2e63 6f6c 756d 6e73 292c 2022 534d 4122  .columns), "SMA"
-0001afd0: 2c20 736d 6129 0a20 2020 2020 2020 2020  , sma).         
-0001afe0: 2020 2020 2020 2064 6174 612e 696e 7365         data.inse
-0001aff0: 7274 286c 656e 2864 6174 612e 636f 6c75  rt(len(data.colu
-0001b000: 6d6e 7329 2c20 224c 4d41 222c 206c 6d61  mns), "LMA", lma
-0001b010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b020: 2020 6461 7461 2e69 6e73 6572 7428 6c65    data.insert(le
-0001b030: 6e28 6461 7461 2e63 6f6c 756d 6e73 292c  n(data.columns),
-0001b040: 2022 5353 4d41 222c 2073 736d 6129 0a20   "SSMA", ssma). 
-0001b050: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001b060: 6174 612e 696e 7365 7274 286c 656e 2864  ata.insert(len(d
-0001b070: 6174 612e 636f 6c75 6d6e 7329 2c20 2253  ata.columns), "S
-0001b080: 534d 4132 3022 2c20 7373 6d61 3230 290a  SMA20", ssma20).
-0001b090: 2020 2020 2020 2020 2020 2020 766f 6c20              vol 
-0001b0a0: 3d20 706b 7461 6c69 622e 534d 4128 6461  = pktalib.SMA(da
-0001b0b0: 7461 5b22 566f 6c75 6d65 225d 2c20 7469  ta["Volume"], ti
-0001b0c0: 6d65 7065 7269 6f64 3d32 3029 0a20 2020  meperiod=20).   
-0001b0d0: 2020 2020 2020 2020 2072 7369 203d 2070           rsi = p
-0001b0e0: 6b74 616c 6962 2e52 5349 2864 6174 615b  ktalib.RSI(data[
-0001b0f0: 2243 6c6f 7365 225d 2c20 7469 6d65 7065  "Close"], timepe
-0001b100: 7269 6f64 3d31 3429 0a20 2020 2020 2020  riod=14).       
-0001b110: 2020 2020 2064 6174 612e 696e 7365 7274       data.insert
-0001b120: 286c 656e 2864 6174 612e 636f 6c75 6d6e  (len(data.column
-0001b130: 7329 2c20 2256 6f6c 4d41 222c 2076 6f6c  s), "VolMA", vol
-0001b140: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-0001b150: 7461 2e69 6e73 6572 7428 6c65 6e28 6461  ta.insert(len(da
-0001b160: 7461 2e63 6f6c 756d 6e73 292c 2022 5253  ta.columns), "RS
-0001b170: 4922 2c20 7273 6929 0a20 2020 2020 2020  I", rsi).       
-0001b180: 2020 2020 2063 6369 203d 2070 6b74 616c       cci = pktal
-0001b190: 6962 2e43 4349 2864 6174 615b 2248 6967  ib.CCI(data["Hig
-0001b1a0: 6822 5d2c 2064 6174 615b 224c 6f77 225d  h"], data["Low"]
-0001b1b0: 2c20 6461 7461 5b22 436c 6f73 6522 5d2c  , data["Close"],
-0001b1c0: 2074 696d 6570 6572 696f 643d 3134 290a   timeperiod=14).
-0001b1d0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001b1e0: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0001b1f0: 2e63 6f6c 756d 6e73 292c 2022 4343 4922  .columns), "CCI"
-0001b200: 2c20 6363 6929 0a20 2020 2020 2020 2020  , cci).         
-0001b210: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001b220: 2020 2020 2020 2020 6661 7374 6b2c 2066          fastk, f
-0001b230: 6173 7464 203d 2070 6b74 616c 6962 2e53  astd = pktalib.S
-0001b240: 544f 4348 5253 4928 0a20 2020 2020 2020  TOCHRSI(.       
-0001b250: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0001b260: 615b 2243 6c6f 7365 225d 2c20 7469 6d65  a["Close"], time
-0001b270: 7065 7269 6f64 3d31 342c 2066 6173 746b  period=14, fastk
-0001b280: 5f70 6572 696f 643d 352c 2066 6173 7464  _period=5, fastd
-0001b290: 5f70 6572 696f 643d 332c 2066 6173 7464  _period=3, fastd
-0001b2a0: 5f6d 6174 7970 653d 300a 2020 2020 2020  _matype=0.      
-0001b2b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001b2c0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0001b2d0: 2e69 6e73 6572 7428 6c65 6e28 6461 7461  .insert(len(data
-0001b2e0: 2e63 6f6c 756d 6e73 292c 2022 4641 5354  .columns), "FAST
-0001b2f0: 4b22 2c20 6661 7374 6b29 0a20 2020 2020  K", fastk).     
-0001b300: 2020 2020 2020 2020 2020 2064 6174 612e             data.
-0001b310: 696e 7365 7274 286c 656e 2864 6174 612e  insert(len(data.
-0001b320: 636f 6c75 6d6e 7329 2c20 2246 4153 5444  columns), "FASTD
-0001b330: 222c 2066 6173 7464 290a 2020 2020 2020  ", fastd).      
-0001b340: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-0001b350: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0001b360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001b370: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-0001b380: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-0001b390: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-0001b3a0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0001b3b0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-0001b3c0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0001b3d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001b3e0: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
-0001b3f0: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
-0001b400: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
-0001b410: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0001b420: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
-0001b430: 615b 3a3a 2d31 5d20 2023 2052 6576 6572  a[::-1]  # Rever
-0001b440: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
-0001b450: 0a20 2020 2020 2020 2023 2064 6174 6120  .        # data 
-0001b460: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-0001b470: 0a20 2020 2020 2020 2023 2064 6174 6120  .        # data 
-0001b480: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
-0001b490: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
-0001b4a0: 2c20 3029 0a20 2020 2020 2020 2066 756c  , 0).        ful
-0001b4b0: 6c44 6174 6120 3d20 6461 7461 0a20 2020  lData = data.   
-0001b4c0: 2020 2020 2074 7269 6d6d 6564 4461 7461       trimmedData
-0001b4d0: 203d 2064 6174 612e 6865 6164 2864 6179   = data.head(day
-0001b4e0: 7354 6f4c 6f6f 6b62 6163 6b29 0a20 2020  sToLookback).   
-0001b4f0: 2020 2020 2072 6574 7572 6e20 2866 756c       return (ful
-0001b500: 6c44 6174 612c 2074 7269 6d6d 6564 4461  lData, trimmedDa
-0001b510: 7461 290a 0a20 2020 2023 2056 616c 6964  ta)..    # Valid
-0001b520: 6174 6520 6966 2074 6865 2073 746f 636b  ate if the stock
-0001b530: 2069 7320 6275 6c6c 6973 6820 696e 2074   is bullish in t
-0001b540: 6865 2073 686f 7274 2074 6572 6d0a 2020  he short term.  
-0001b550: 2020 6465 6620 7661 6c69 6461 7465 3135    def validate15
-0001b560: 4d69 6e75 7465 5072 6963 6556 6f6c 756d  MinutePriceVolum
-0001b570: 6542 7265 616b 6f75 7428 7365 6c66 2c20  eBreakout(self, 
-0001b580: 6466 293a 0a20 2020 2020 2020 2069 6620  df):.        if 
-0001b590: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
-0001b5a0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
-0001b5b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001b5c0: 616c 7365 0a20 2020 2020 2020 2023 2068  alse.        # h
-0001b5d0: 7474 7073 3a2f 2f63 6861 7274 696e 6b2e  ttps://chartink.
-0001b5e0: 636f 6d2f 7363 7265 656e 6572 2f31 352d  com/screener/15-
-0001b5f0: 6d69 6e2d 7072 6963 652d 766f 6c75 6d65  min-price-volume
-0001b600: 2d62 7265 616b 6f75 740a 2020 2020 2020  -breakout.      
-0001b610: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-0001b620: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-0001b630: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-0001b640: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0001b650: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-0001b660: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-0001b670: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-0001b680: 3d20 6461 7461 5b3a 3a2d 315d 2020 2320  = data[::-1]  # 
-0001b690: 5265 7665 7273 6520 7468 6520 6461 7461  Reverse the data
-0001b6a0: 6672 616d 6520 736f 2074 6861 7420 6974  frame so that it
-0001b6b0: 7320 7468 6520 6f6c 6465 7374 2064 6174  s the oldest dat
-0001b6c0: 6520 6669 7273 740a 2020 2020 2020 2020  e first.        
-0001b6d0: 6461 7461 5b22 534d 4132 3022 5d20 3d20  data["SMA20"] = 
-0001b6e0: 706b 7461 6c69 622e 534d 4128 6461 7461  pktalib.SMA(data
-0001b6f0: 5b22 436c 6f73 6522 5d2c 2032 3029 0a20  ["Close"], 20). 
-0001b700: 2020 2020 2020 2064 6174 615b 2253 4d41         data["SMA
-0001b710: 3230 5622 5d20 3d20 706b 7461 6c69 622e  20V"] = pktalib.
-0001b720: 534d 4128 6461 7461 5b22 566f 6c75 6d65  SMA(data["Volume
-0001b730: 225d 2c20 3230 290a 2020 2020 2020 2020  "], 20).        
-0001b740: 6461 7461 203d 2064 6174 615b 0a20 2020  data = data[.   
-0001b750: 2020 2020 2020 2020 203a 3a2d 310a 2020           ::-1.  
-0001b760: 2020 2020 2020 5d20 2023 2052 6576 6572        ]  # Rever
-0001b770: 7365 2074 6865 2064 6174 6166 7261 6d65  se the dataframe
-0001b780: 2073 6f20 7468 6174 2069 7427 7320 7468   so that it's th
-0001b790: 6520 6d6f 7374 2072 6563 656e 7420 6461  e most recent da
-0001b7a0: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
-0001b7b0: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
-0001b7c0: 6561 6428 3329 0a20 2020 2020 2020 2069  ead(3).        i
-0001b7d0: 6620 6c65 6e28 7265 6365 6e74 2920 3c20  f len(recent) < 
-0001b7e0: 333a 0a20 2020 2020 2020 2020 2020 2072  3:.            r
-0001b7f0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0001b800: 2020 2020 636f 6e64 3120 3d20 7265 6365      cond1 = rece
-0001b810: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-0001b820: 5b30 5d20 3e20 7265 6365 6e74 5b22 436c  [0] > recent["Cl
-0001b830: 6f73 6522 5d2e 696c 6f63 5b31 5d0a 2020  ose"].iloc[1].  
-0001b840: 2020 2020 2020 636f 6e64 3220 3d20 636f        cond2 = co
-0001b850: 6e64 3120 616e 6420 2872 6563 656e 745b  nd1 and (recent[
-0001b860: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-0001b870: 203e 2072 6563 656e 745b 2253 4d41 3230   > recent["SMA20
-0001b880: 225d 2e69 6c6f 635b 305d 290a 2020 2020  "].iloc[0]).    
-0001b890: 2020 2020 636f 6e64 3320 3d20 636f 6e64      cond3 = cond
-0001b8a0: 3220 616e 6420 2872 6563 656e 745b 2243  2 and (recent["C
-0001b8b0: 6c6f 7365 225d 2e69 6c6f 635b 315d 203e  lose"].iloc[1] >
-0001b8c0: 2072 6563 656e 745b 2248 6967 6822 5d2e   recent["High"].
-0001b8d0: 696c 6f63 5b32 5d29 0a20 2020 2020 2020  iloc[2]).       
-0001b8e0: 2063 6f6e 6434 203d 2063 6f6e 6433 2061   cond4 = cond3 a
-0001b8f0: 6e64 2028 7265 6365 6e74 5b22 566f 6c75  nd (recent["Volu
-0001b900: 6d65 225d 2e69 6c6f 635b 305d 203e 2072  me"].iloc[0] > r
-0001b910: 6563 656e 745b 2253 4d41 3230 5622 5d2e  ecent["SMA20V"].
-0001b920: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
-0001b930: 2063 6f6e 6435 203d 2063 6f6e 6434 2061   cond5 = cond4 a
-0001b940: 6e64 2028 7265 6365 6e74 5b22 566f 6c75  nd (recent["Volu
-0001b950: 6d65 225d 2e69 6c6f 635b 315d 203e 2072  me"].iloc[1] > r
-0001b960: 6563 656e 745b 2253 4d41 3230 5622 5d2e  ecent["SMA20V"].
-0001b970: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
-0001b980: 2072 6574 7572 6e20 636f 6e64 350a 0a20   return cond5.. 
-0001b990: 2020 2064 6566 2076 616c 6964 6174 6542     def validateB
-0001b9a0: 756c 6c69 7368 466f 7254 6f6d 6f72 726f  ullishForTomorro
-0001b9b0: 7728 7365 6c66 2c20 6466 293a 0a20 2020  w(self, df):.   
-0001b9c0: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
-0001b9d0: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
-0001b9e0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0001b9f0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-0001ba00: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-0001ba10: 6f70 7928 290a 2020 2020 2020 2020 2320  opy().        # 
-0001ba20: 6874 7470 733a 2f2f 6368 6172 7469 6e6b  https://chartink
-0001ba30: 2e63 6f6d 2f73 6372 6565 6e65 722f 6275  .com/screener/bu
-0001ba40: 6c6c 6973 682d 666f 722d 746f 6d6f 7272  llish-for-tomorr
-0001ba50: 6f77 0a20 2020 2020 2020 2064 6174 6120  ow.        data 
-0001ba60: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-0001ba70: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0001ba80: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-0001ba90: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-0001baa0: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-0001bab0: 3d20 6461 7461 5b3a 3a2d 315d 2020 2320  = data[::-1]  # 
-0001bac0: 5265 7665 7273 6520 7468 6520 6461 7461  Reverse the data
-0001bad0: 6672 616d 6520 736f 2074 6861 7420 6974  frame so that it
-0001bae0: 7320 7468 6520 6f6c 6465 7374 2064 6174  s the oldest dat
-0001baf0: 6520 6669 7273 740a 2020 2020 2020 2020  e first.        
-0001bb00: 6d61 6364 4c69 6e65 203d 2070 6b74 616c  macdLine = pktal
-0001bb10: 6962 2e4d 4143 4428 6461 7461 5b22 436c  ib.MACD(data["Cl
-0001bb20: 6f73 6522 5d2c 2031 322c 2032 362c 2039  ose"], 12, 26, 9
-0001bb30: 295b 305d 2e74 6169 6c28 3329 0a20 2020  )[0].tail(3).   
-0001bb40: 2020 2020 206d 6163 6453 6967 6e61 6c20       macdSignal 
-0001bb50: 3d20 706b 7461 6c69 622e 4d41 4344 2864  = pktalib.MACD(d
-0001bb60: 6174 615b 2243 6c6f 7365 225d 2c20 3132  ata["Close"], 12
-0001bb70: 2c20 3236 2c20 3929 5b31 5d2e 7461 696c  , 26, 9)[1].tail
-0001bb80: 2833 290a 2020 2020 2020 2020 6d61 6364  (3).        macd
-0001bb90: 4869 7374 203d 2070 6b74 616c 6962 2e4d  Hist = pktalib.M
-0001bba0: 4143 4428 6461 7461 5b22 436c 6f73 6522  ACD(data["Close"
-0001bbb0: 5d2c 2031 322c 2032 362c 2039 295b 325d  ], 12, 26, 9)[2]
-0001bbc0: 2e74 6169 6c28 3329 0a0a 2020 2020 2020  .tail(3)..      
-0001bbd0: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-0001bbe0: 2020 2020 2020 2028 6d61 6364 4869 7374         (macdHist
-0001bbf0: 2e69 6c6f 635b 3a31 5d2e 696c 6f63 5b30  .iloc[:1].iloc[0
-0001bc00: 5d20 3c20 6d61 6364 4869 7374 2e69 6c6f  ] < macdHist.ilo
-0001bc10: 635b 3a32 5d2e 696c 6f63 5b31 5d29 0a20  c[:2].iloc[1]). 
-0001bc20: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0001bc30: 6d61 6364 4869 7374 2e69 6c6f 635b 3a33  macdHist.iloc[:3
-0001bc40: 5d2e 696c 6f63 5b32 5d20 3e20 6d61 6364  ].iloc[2] > macd
-0001bc50: 4869 7374 2e69 6c6f 635b 3a32 5d2e 696c  Hist.iloc[:2].il
-0001bc60: 6f63 5b31 5d29 0a20 2020 2020 2020 2020  oc[1]).         
-0001bc70: 2020 2061 6e64 2028 0a20 2020 2020 2020     and (.       
-0001bc80: 2020 2020 2020 2020 2028 6d61 6364 4c69           (macdLi
-0001bc90: 6e65 2e69 6c6f 635b 3a33 5d2e 696c 6f63  ne.iloc[:3].iloc
-0001bca0: 5b32 5d20 2d20 6d61 6364 5369 676e 616c  [2] - macdSignal
-0001bcb0: 2e69 6c6f 635b 3a33 5d2e 696c 6f63 5b32  .iloc[:3].iloc[2
-0001bcc0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001bcd0: 2020 202d 2028 6d61 6364 4c69 6e65 2e69     - (macdLine.i
-0001bce0: 6c6f 635b 3a32 5d2e 696c 6f63 5b31 5d20  loc[:2].iloc[1] 
-0001bcf0: 2d20 6d61 6364 5369 676e 616c 2e69 6c6f  - macdSignal.ilo
-0001bd00: 635b 3a32 5d2e 696c 6f63 5b31 5d29 0a20  c[:2].iloc[1]). 
-0001bd10: 2020 2020 2020 2020 2020 2020 2020 203e                 >
-0001bd20: 3d20 302e 340a 2020 2020 2020 2020 2020  = 0.4.          
-0001bd30: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001bd40: 616e 6420 280a 2020 2020 2020 2020 2020  and (.          
-0001bd50: 2020 2020 2020 286d 6163 644c 696e 652e        (macdLine.
-0001bd60: 696c 6f63 5b3a 325d 2e69 6c6f 635b 315d  iloc[:2].iloc[1]
-0001bd70: 202d 206d 6163 6453 6967 6e61 6c2e 696c   - macdSignal.il
-0001bd80: 6f63 5b3a 325d 2e69 6c6f 635b 315d 290a  oc[:2].iloc[1]).
-0001bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bda0: 2d20 286d 6163 644c 696e 652e 696c 6f63  - (macdLine.iloc
-0001bdb0: 5b3a 315d 2e69 6c6f 635b 305d 202d 206d  [:1].iloc[0] - m
-0001bdc0: 6163 6453 6967 6e61 6c2e 696c 6f63 5b3a  acdSignal.iloc[:
-0001bdd0: 315d 2e69 6c6f 635b 305d 290a 2020 2020  1].iloc[0]).    
-0001bde0: 2020 2020 2020 2020 2020 2020 3c3d 2030              <= 0
-0001bdf0: 2e32 0a20 2020 2020 2020 2020 2020 2029  .2.            )
-0001be00: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001be10: 2028 6d61 6364 4c69 6e65 2e69 6c6f 635b   (macdLine.iloc[
-0001be20: 3a33 5d2e 696c 6f63 5b32 5d20 3e20 6d61  :3].iloc[2] > ma
-0001be30: 6364 5369 676e 616c 2e69 6c6f 635b 3a33  cdSignal.iloc[:3
-0001be40: 5d2e 696c 6f63 5b32 5d29 0a20 2020 2020  ].iloc[2]).     
-0001be50: 2020 2020 2020 2061 6e64 2028 0a20 2020         and (.   
-0001be60: 2020 2020 2020 2020 2020 2020 2028 6d61               (ma
-0001be70: 6364 4c69 6e65 2e69 6c6f 635b 3a33 5d2e  cdLine.iloc[:3].
-0001be80: 696c 6f63 5b32 5d20 2d20 6d61 6364 5369  iloc[2] - macdSi
-0001be90: 676e 616c 2e69 6c6f 635b 3a33 5d2e 696c  gnal.iloc[:3].il
-0001bea0: 6f63 5b32 5d29 0a20 2020 2020 2020 2020  oc[2]).         
-0001beb0: 2020 2020 2020 202d 2028 6d61 6364 4c69         - (macdLi
-0001bec0: 6e65 2e69 6c6f 635b 3a32 5d2e 696c 6f63  ne.iloc[:2].iloc
-0001bed0: 5b31 5d20 2d20 6d61 6364 5369 676e 616c  [1] - macdSignal
-0001bee0: 2e69 6c6f 635b 3a32 5d2e 696c 6f63 5b31  .iloc[:2].iloc[1
-0001bef0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001bf00: 2020 203c 2031 0a20 2020 2020 2020 2020     < 1.         
-0001bf10: 2020 2029 0a20 2020 2020 2020 2029 0a0a     ).        )..
-0001bf20: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
-0001bf30: 6d65 0a20 2020 2023 2076 616c 6964 6174  me.    # validat
-0001bf40: 6520 6966 2043 4349 2069 7320 7769 7468  e if CCI is with
-0001bf50: 696e 2067 6976 656e 2072 616e 6765 0a20  in given range. 
-0001bf60: 2020 2064 6566 2076 616c 6964 6174 6543     def validateC
-0001bf70: 4349 2873 656c 662c 2064 662c 2073 6372  CI(self, df, scr
-0001bf80: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-0001bf90: 742c 206d 696e 4343 492c 206d 6178 4343  t, minCCI, maxCC
-0001bfa0: 4929 3a0a 2020 2020 2020 2020 6966 2064  I):.        if d
-0001bfb0: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-0001bfc0: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-0001bfd0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0001bfe0: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-0001bff0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-0001c000: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-0001c010: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-0001c020: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-0001c030: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-0001c040: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-0001c050: 2020 2020 2063 6369 203d 2069 6e74 2864       cci = int(d
-0001c060: 6174 612e 6865 6164 2831 295b 2243 4349  ata.head(1)["CCI
-0001c070: 225d 2e69 6c6f 635b 305d 290a 2020 2020  "].iloc[0]).    
-0001c080: 2020 2020 7361 7665 4469 6374 5b22 4343      saveDict["CC
-0001c090: 4922 5d20 3d20 6363 690a 2020 2020 2020  I"] = cci.      
-0001c0a0: 2020 6966 2028 6363 6920 3e3d 206d 696e    if (cci >= min
-0001c0b0: 4343 4920 616e 6420 6363 6920 3c3d 206d  CCI and cci <= m
-0001c0c0: 6178 4343 4929 3a0a 2020 2020 2020 2020  axCCI):.        
-0001c0d0: 2020 2020 6966 2028 2255 7022 2069 6e20      if ("Up" in 
-0001c0e0: 7361 7665 4469 6374 5b22 5472 656e 6422  saveDict["Trend"
-0001c0f0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0001c100: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-0001c110: 4343 4922 5d20 3d20 280a 2020 2020 2020  CCI"] = (.      
-0001c120: 2020 2020 2020 2020 2020 2020 2020 2863                (c
-0001c130: 6f6c 6f72 5465 7874 2e42 4f4c 4420 6966  olorText.BOLD if
-0001c140: 2028 2253 7472 6f6e 6722 2069 6e20 7361   ("Strong" in sa
-0001c150: 7665 4469 6374 5b22 5472 656e 6422 5d29  veDict["Trend"])
-0001c160: 2065 6c73 6520 2222 2920 2b20 636f 6c6f   else "") + colo
-0001c170: 7254 6578 742e 4752 4545 4e20 2b20 7374  rText.GREEN + st
-0001c180: 7228 6363 6929 202b 2063 6f6c 6f72 5465  r(cci) + colorTe
-0001c190: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001c1a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001c1b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001c1c0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0001c1d0: 6e44 6963 745b 2243 4349 225d 203d 2028  nDict["CCI"] = (
-0001c1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c1f0: 2020 2020 2028 636f 6c6f 7254 6578 742e       (colorText.
-0001c200: 424f 4c44 2069 6620 2822 5374 726f 6e67  BOLD if ("Strong
-0001c210: 2220 696e 2073 6176 6544 6963 745b 2254  " in saveDict["T
-0001c220: 7265 6e64 225d 2920 656c 7365 2022 2229  rend"]) else "")
-0001c230: 202b 2063 6f6c 6f72 5465 7874 2e46 4149   + colorText.FAI
-0001c240: 4c20 2b20 7374 7228 6363 6929 202b 2063  L + str(cci) + c
-0001c250: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-0001c260: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0001c270: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001c280: 6e20 5472 7565 0a20 2020 2020 2020 2073  n True.        s
-0001c290: 6372 6565 6e44 6963 745b 2243 4349 225d  creenDict["CCI"]
-0001c2a0: 203d 2063 6f6c 6f72 5465 7874 2e42 4f4c   = colorText.BOL
-0001c2b0: 4420 2b20 636f 6c6f 7254 6578 742e 4641  D + colorText.FA
-0001c2c0: 494c 202b 2073 7472 2863 6369 2920 2b20  IL + str(cci) + 
-0001c2d0: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
-0001c2e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001c2f0: 7365 0a0a 2020 2020 2320 4669 6e64 2043  se..    # Find C
-0001c300: 6f6e 666c 7563 656e 6365 0a20 2020 2064  onflucence.    d
-0001c310: 6566 2076 616c 6964 6174 6543 6f6e 666c  ef validateConfl
-0001c320: 7565 6e63 6528 7365 6c66 2c20 7374 6f63  uence(self, stoc
-0001c330: 6b2c 2064 662c 2073 6372 6565 6e44 6963  k, df, screenDic
-0001c340: 742c 2073 6176 6544 6963 742c 2070 6572  t, saveDict, per
-0001c350: 6365 6e74 6167 653d 302e 312c 636f 6e66  centage=0.1,conf
-0001c360: 4669 6c74 6572 3d33 293a 0a20 2020 2020  Filter=3):.     
-0001c370: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
-0001c380: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
-0001c390: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001c3a0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-0001c3b0: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
-0001c3c0: 7928 290a 2020 2020 2020 2020 7265 6365  y().        rece
-0001c3d0: 6e74 203d 2064 6174 612e 6865 6164 2832  nt = data.head(2
-0001c3e0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-0001c3f0: 2872 6563 656e 7429 203c 2032 3a0a 2020  (recent) < 2:.  
-0001c400: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001c410: 2046 616c 7365 0a20 2020 2020 2020 206b   False.        k
-0001c420: 6579 3120 3d20 2253 4d41 220a 2020 2020  ey1 = "SMA".    
-0001c430: 2020 2020 6b65 7932 203d 2022 4c4d 4122      key2 = "LMA"
-0001c440: 0a20 2020 2020 2020 206b 6579 3320 3d20  .        key3 = 
-0001c450: 2235 3044 4d41 220a 2020 2020 2020 2020  "50DMA".        
-0001c460: 6b65 7934 203d 2022 3230 3044 4d41 220a  key4 = "200DMA".
-0001c470: 2020 2020 2020 2020 6973 3230 444d 4143          is20DMAC
-0001c480: 726f 7373 6f76 6572 3530 444d 4120 3d20  rossover50DMA = 
-0001c490: 2872 6563 656e 745b 2253 534d 4132 3022  (recent["SSMA20"
-0001c4a0: 5d2e 696c 6f63 5b30 5d20 3e3d 2072 6563  ].iloc[0] >= rec
-0001c4b0: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
-0001c4c0: 305d 2920 616e 6420 5c0a 2020 2020 2020  0]) and \.      
-0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4e0: 2020 2020 2020 2872 6563 656e 745b 2253        (recent["S
-0001c4f0: 534d 4132 3022 5d2e 696c 6f63 5b31 5d20  SMA20"].iloc[1] 
-0001c500: 3c3d 2072 6563 656e 745b 2253 4d41 225d  <= recent["SMA"]
-0001c510: 2e69 6c6f 635b 315d 290a 2020 2020 2020  .iloc[1]).      
-0001c520: 2020 6973 3530 444d 4143 726f 7373 6f76    is50DMACrossov
-0001c530: 6572 3230 3044 4d41 203d 2028 7265 6365  er200DMA = (rece
-0001c540: 6e74 5b22 534d 4122 5d2e 696c 6f63 5b30  nt["SMA"].iloc[0
-0001c550: 5d20 3e3d 2072 6563 656e 745b 224c 4d41  ] >= recent["LMA
-0001c560: 225d 2e69 6c6f 635b 305d 2920 616e 6420  "].iloc[0]) and 
-0001c570: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0001c580: 2020 2020 2020 2020 2020 2020 2020 2872                (r
-0001c590: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
-0001c5a0: 635b 315d 203c 3d20 7265 6365 6e74 5b22  c[1] <= recent["
-0001c5b0: 4c4d 4122 5d2e 696c 6f63 5b31 5d29 0a20  LMA"].iloc[1]). 
-0001c5c0: 2020 2020 2020 2069 7347 6f6c 6465 6e43         isGoldenC
-0001c5d0: 726f 7373 4f76 6572 203d 2069 7332 3044  rossOver = is20D
-0001c5e0: 4d41 4372 6f73 736f 7665 7235 3044 4d41  MACrossover50DMA
-0001c5f0: 206f 7220 6973 3530 444d 4143 726f 7373   or is50DMACross
-0001c600: 6f76 6572 3230 3044 4d41 0a20 2020 2020  over200DMA.     
-0001c610: 2020 2069 7335 3044 4d41 4372 6f73 736f     is50DMACrosso
-0001c620: 7665 7232 3030 444d 4144 6f77 6e20 3d20  ver200DMADown = 
-0001c630: 2872 6563 656e 745b 2253 4d41 225d 2e69  (recent["SMA"].i
-0001c640: 6c6f 635b 305d 203c 3d20 7265 6365 6e74  loc[0] <= recent
-0001c650: 5b22 4c4d 4122 5d2e 696c 6f63 5b30 5d29  ["LMA"].iloc[0])
-0001c660: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-0001c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c680: 2020 2028 7265 6365 6e74 5b22 534d 4122     (recent["SMA"
-0001c690: 5d2e 696c 6f63 5b31 5d20 3e3d 2072 6563  ].iloc[1] >= rec
-0001c6a0: 656e 745b 224c 4d41 225d 2e69 6c6f 635b  ent["LMA"].iloc[
-0001c6b0: 315d 290a 2020 2020 2020 2020 6973 3230  1]).        is20
-0001c6c0: 444d 4143 726f 7373 6f76 6572 3530 444d  DMACrossover50DM
-0001c6d0: 4144 6f77 6e20 3d20 2872 6563 656e 745b  ADown = (recent[
-0001c6e0: 2253 534d 4132 3022 5d2e 696c 6f63 5b30  "SSMA20"].iloc[0
-0001c6f0: 5d20 3c3d 2072 6563 656e 745b 2253 4d41  ] <= recent["SMA
-0001c700: 225d 2e69 6c6f 635b 305d 2920 616e 6420  "].iloc[0]) and 
-0001c710: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0001c720: 2020 2020 2020 2020 2020 2020 2020 2872                (r
-0001c730: 6563 656e 745b 2253 534d 4132 3022 5d2e  ecent["SSMA20"].
-0001c740: 696c 6f63 5b31 5d20 3e3d 2072 6563 656e  iloc[1] >= recen
-0001c750: 745b 2253 4d41 225d 2e69 6c6f 635b 315d  t["SMA"].iloc[1]
-0001c760: 290a 2020 2020 2020 2020 6973 4465 6164  ).        isDead
-0001c770: 4372 6f73 734f 7665 7220 3d20 6973 3230  CrossOver = is20
-0001c780: 444d 4143 726f 7373 6f76 6572 3530 444d  DMACrossover50DM
-0001c790: 4144 6f77 6e20 6f72 2069 7335 3044 4d41  ADown or is50DMA
-0001c7a0: 4372 6f73 736f 7665 7232 3030 444d 4144  Crossover200DMAD
-0001c7b0: 6f77 6e0a 2020 2020 2020 2020 6465 6164  own.        dead
-0001c7c0: 784f 7665 7254 6578 7420 3d20 6627 4465  xOverText = f'De
-0001c7d0: 6164 4372 6f73 736f 7665 727b 2228 3230  adCrossover{"(20
-0001c7e0: 2922 2069 6620 6973 3230 444d 4143 726f  )" if is20DMACro
-0001c7f0: 7373 6f76 6572 3530 444d 4144 6f77 6e20  ssover50DMADown 
-0001c800: 656c 7365 2028 2228 3530 2922 2069 6620  else ("(50)" if 
-0001c810: 6973 3530 444d 4143 726f 7373 6f76 6572  is50DMACrossover
-0001c820: 3230 3044 4d41 446f 776e 2065 6c73 6520  200DMADown else 
-0001c830: 2222 297d 270a 2020 2020 2020 2020 676f  "")}'.        go
-0001c840: 6c64 656e 784f 7665 7254 6578 7420 3d20  ldenxOverText = 
-0001c850: 6627 476f 6c64 656e 4372 6f73 736f 7665  f'GoldenCrossove
-0001c860: 727b 2228 3230 2922 2069 6620 6973 3230  r{"(20)" if is20
-0001c870: 444d 4143 726f 7373 6f76 6572 3530 444d  DMACrossover50DM
-0001c880: 4120 656c 7365 2028 2228 3530 2922 2069  A else ("(50)" i
-0001c890: 6620 6973 3530 444d 4143 726f 7373 6f76  f is50DMACrossov
-0001c8a0: 6572 3230 3044 4d41 2065 6c73 6520 2222  er200DMA else ""
-0001c8b0: 297d 270a 2020 2020 2020 2020 6966 2069  )}'.        if i
-0001c8c0: 7332 3044 4d41 4372 6f73 736f 7665 7235  s20DMACrossover5
-0001c8d0: 3044 4d41 206f 7220 6973 3230 444d 4143  0DMA or is20DMAC
-0001c8e0: 726f 7373 6f76 6572 3530 444d 4144 6f77  rossover50DMADow
-0001c8f0: 6e3a 0a20 2020 2020 2020 2020 2020 206b  n:.            k
-0001c900: 6579 3120 3d20 2253 534d 4132 3022 0a20  ey1 = "SSMA20". 
-0001c910: 2020 2020 2020 2020 2020 206b 6579 3220             key2 
-0001c920: 3d20 2253 4d41 220a 2020 2020 2020 2020  = "SMA".        
-0001c930: 2020 2020 6b65 7933 203d 2022 3230 444d      key3 = "20DM
-0001c940: 4122 0a20 2020 2020 2020 2020 2020 206b  A".            k
-0001c950: 6579 3420 3d20 2235 3044 4d41 220a 2020  ey4 = "50DMA".  
-0001c960: 2020 2020 2020 6973 3530 444d 4155 7054        is50DMAUpT
-0001c970: 7265 6e64 203d 2028 7265 6365 6e74 5b6b  rend = (recent[k
-0001c980: 6579 315d 2e69 6c6f 635b 305d 203e 2072  ey1].iloc[0] > r
-0001c990: 6563 656e 745b 6b65 7932 5d2e 696c 6f63  ecent[key2].iloc
-0001c9a0: 5b31 5d29 0a20 2020 2020 2020 2069 7335  [1]).        is5
-0001c9b0: 3044 4d41 446f 776e 5472 656e 6420 3d20  0DMADownTrend = 
-0001c9c0: 2872 6563 656e 745b 6b65 7931 5d2e 696c  (recent[key1].il
-0001c9d0: 6f63 5b30 5d20 3c20 7265 6365 6e74 5b6b  oc[0] < recent[k
-0001c9e0: 6579 315d 2e69 6c6f 635b 315d 290a 2020  ey1].iloc[1]).  
-0001c9f0: 2020 2020 2020 6973 3530 444d 4120 3d20        is50DMA = 
-0001ca00: 2872 6563 656e 745b 6b65 7931 5d2e 696c  (recent[key1].il
-0001ca10: 6f63 5b30 5d20 3c3d 2072 6563 656e 745b  oc[0] <= recent[
-0001ca20: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-0001ca30: 290a 2020 2020 2020 2020 6973 3230 3044  ).        is200D
-0001ca40: 4d41 203d 2028 7265 6365 6e74 5b6b 6579  MA = (recent[key
-0001ca50: 325d 2e69 6c6f 635b 305d 203c 3d20 7265  2].iloc[0] <= re
-0001ca60: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
-0001ca70: 6f63 5b30 5d29 0a20 2020 2020 2020 2064  oc[0]).        d
-0001ca80: 6966 6665 7265 6e63 6520 3d20 726f 756e  ifference = roun
-0001ca90: 6428 2872 6563 656e 745b 6b65 7931 5d2e  d((recent[key1].
-0001caa0: 696c 6f63 5b30 5d20 2d20 7265 6365 6e74  iloc[0] - recent
-0001cab0: 5b6b 6579 325d 2e69 6c6f 635b 305d 290a  [key2].iloc[0]).
-0001cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cad0: 2f20 7265 6365 6e74 5b22 436c 6f73 6522  / recent["Close"
-0001cae0: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
-0001caf0: 2020 2020 2020 2020 2020 2a20 3130 302c            * 100,
-0001cb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cb10: 2032 2c0a 2020 2020 2020 2020 2020 2020   2,.            
-0001cb20: 290a 2020 2020 2020 2020 7361 7665 4469  ).        saveDi
-0001cb30: 6374 5b22 436f 6e66 444d 4144 6966 6665  ct["ConfDMADiffe
-0001cb40: 7265 6e63 6522 5d20 3d20 6469 6666 6572  rence"] = differ
-0001cb50: 656e 6365 0a20 2020 2020 2020 2073 6372  ence.        scr
-0001cb60: 6565 6e44 6963 745b 2243 6f6e 6644 4d41  eenDict["ConfDMA
-0001cb70: 4469 6666 6572 656e 6365 225d 203d 2064  Difference"] = d
-0001cb80: 6966 6665 7265 6e63 650a 2020 2020 2020  ifference.      
-0001cb90: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
-0001cba0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
-0001cbb0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
-0001cbc0: 7361 7665 4469 6374 2c22 4d41 2d53 6967  saveDict,"MA-Sig
-0001cbd0: 6e61 6c22 290a 2020 2020 2020 2020 2320  nal").        # 
-0001cbe0: 6469 6666 6572 656e 6365 203d 2061 6273  difference = abs
-0001cbf0: 2864 6966 6665 7265 6e63 6529 0a20 2020  (difference).   
-0001cc00: 2020 2020 2063 6f6e 6654 6578 7420 3d20       confText = 
-0001cc10: 6622 7b67 6f6c 6465 6e78 4f76 6572 5465  f"{goldenxOverTe
-0001cc20: 7874 2069 6620 6973 476f 6c64 656e 4372  xt if isGoldenCr
-0001cc30: 6f73 734f 7665 7220 656c 7365 2028 6465  ossOver else (de
-0001cc40: 6164 784f 7665 7254 6578 7420 6966 2069  adxOverText if i
-0001cc50: 7344 6561 6443 726f 7373 4f76 6572 2065  sDeadCrossOver e
-0001cc60: 6c73 6520 2827 436f 6e66 2e55 7027 2069  lse ('Conf.Up' i
-0001cc70: 6620 6973 3530 444d 4155 7054 7265 6e64  f is50DMAUpTrend
-0001cc80: 2065 6c73 6520 2827 436f 6e66 2e44 6f77   else ('Conf.Dow
-0001cc90: 6e27 2069 6620 6973 3530 444d 4144 6f77  n' if is50DMADow
-0001cca0: 6e54 7265 6e64 2065 6c73 6520 286b 6579  nTrend else (key
-0001ccb0: 3320 6966 2069 7335 3044 4d41 2065 6c73  3 if is50DMA els
-0001ccc0: 6520 286b 6579 3420 6966 2069 7332 3030  e (key4 if is200
-0001ccd0: 444d 4120 656c 7365 2027 556e 6b6e 6f77  DMA else 'Unknow
-0001cce0: 6e27 2929 2929 297d 220a 2020 2020 2020  n')))))}".      
-0001ccf0: 2020 6966 2061 6273 2872 6563 656e 745b    if abs(recent[
-0001cd00: 6b65 7931 5d2e 696c 6f63 5b30 5d20 2d20  key1].iloc[0] - 
-0001cd10: 7265 6365 6e74 5b6b 6579 325d 2e69 6c6f  recent[key2].ilo
-0001cd20: 635b 305d 2920 3c3d 2028 0a20 2020 2020  c[0]) <= (.     
-0001cd30: 2020 2020 2020 2072 6563 656e 745b 6b65         recent[ke
-0001cd40: 7931 5d2e 696c 6f63 5b30 5d20 2a20 7065  y1].iloc[0] * pe
-0001cd50: 7263 656e 7461 6765 0a20 2020 2020 2020  rcentage.       
-0001cd60: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0001cd70: 6966 2072 6563 656e 745b 6b65 7931 5d2e  if recent[key1].
-0001cd80: 696c 6f63 5b30 5d20 3e3d 2072 6563 656e  iloc[0] >= recen
-0001cd90: 745b 6b65 7932 5d2e 696c 6f63 5b30 5d3a  t[key2].iloc[0]:
-0001cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cdb0: 2073 6372 6565 6e44 6963 745b 224d 412d   screenDict["MA-
-0001cdc0: 5369 676e 616c 225d 203d 2028 0a20 2020  Signal"] = (.   
-0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
-0001cdf0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001ce00: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
-0001ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce20: 2020 2020 2b20 2863 6f6c 6f72 5465 7874      + (colorText
-0001ce30: 2e47 5245 454e 2069 6620 6973 3530 444d  .GREEN if is50DM
-0001ce40: 4155 7054 7265 6e64 2065 6c73 6520 2863  AUpTrend else (c
-0001ce50: 6f6c 6f72 5465 7874 2e46 4149 4c20 6966  olorText.FAIL if
-0001ce60: 2069 7335 3044 4d41 446f 776e 5472 656e   is50DMADownTren
-0001ce70: 6420 656c 7365 2063 6f6c 6f72 5465 7874  d else colorText
-0001ce80: 2e57 4152 4e29 290a 2020 2020 2020 2020  .WARN)).        
-0001ce90: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
-0001cea0: 7b63 6f6e 6654 6578 747d 2028 7b64 6966  {confText} ({dif
-0001ceb0: 6665 7265 6e63 657d 2529 220a 2020 2020  ference}%)".    
-0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ced0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001cf00: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
-0001cf10: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
-0001cf20: 315d 202b 2066 227b 636f 6e66 5465 7874  1] + f"{confText
-0001cf30: 7d20 287b 6469 6666 6572 656e 6365 7d25  } ({difference}%
-0001cf40: 2922 0a20 2020 2020 2020 2020 2020 2065  )".            e
-0001cf50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001cf60: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0001cf70: 224d 412d 5369 676e 616c 225d 203d 2028  "MA-Signal"] = (
-0001cf80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cf90: 2020 2020 2073 6176 6564 5b30 5d20 0a20       saved[0] . 
-0001cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfb0: 2020 202b 2063 6f6c 6f72 5465 7874 2e42     + colorText.B
-0001cfc0: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
-0001cfd0: 2020 2020 2020 2020 2b20 2863 6f6c 6f72          + (color
-0001cfe0: 5465 7874 2e47 5245 454e 2069 6620 6973  Text.GREEN if is
-0001cff0: 3530 444d 4155 7054 7265 6e64 2065 6c73  50DMAUpTrend els
-0001d000: 6520 2863 6f6c 6f72 5465 7874 2e46 4149  e (colorText.FAI
-0001d010: 4c20 6966 2069 7335 3044 4d41 446f 776e  L if is50DMADown
-0001d020: 5472 656e 6420 656c 7365 2063 6f6c 6f72  Trend else color
-0001d030: 5465 7874 2e57 4152 4e29 290a 2020 2020  Text.WARN)).    
-0001d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d050: 2b20 6622 7b63 6f6e 6654 6578 747d 2028  + f"{confText} (
-0001d060: 7b64 6966 6665 7265 6e63 657d 2529 220a  {difference}%)".
-0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d080: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-0001d090: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-0001d0a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001d0b0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-0001d0c0: 4d41 2d53 6967 6e61 6c22 5d20 3d20 7361  MA-Signal"] = sa
-0001d0d0: 7665 645b 315d 202b 2066 227b 636f 6e66  ved[1] + f"{conf
-0001d0e0: 5465 7874 7d20 287b 6469 6666 6572 656e  Text} ({differen
-0001d0f0: 6365 7d25 2922 0a20 2020 2020 2020 2020  ce}%)".         
-0001d100: 2020 2072 6574 7572 6e20 636f 6e66 4669     return confFi
-0001d110: 6c74 6572 203d 3d20 3320 6f72 205c 0a20  lter == 3 or \. 
-0001d120: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001d130: 636f 6e66 4669 6c74 6572 203d 3d20 3120  confFilter == 1 
-0001d140: 616e 6420 6e6f 7420 6973 4465 6164 4372  and not isDeadCr
-0001d150: 6f73 734f 7665 7220 616e 6420 2869 7335  ossOver and (is5
-0001d160: 3044 4d41 5570 5472 656e 6420 6f72 2028  0DMAUpTrend or (
-0001d170: 6973 476f 6c64 656e 4372 6f73 734f 7665  isGoldenCrossOve
-0001d180: 7220 6f72 2027 5570 2720 696e 2063 6f6e  r or 'Up' in con
-0001d190: 6654 6578 7429 2929 206f 7220 5c0a 2020  fText))) or \.  
-0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2863                (c
-0001d1b0: 6f6e 6646 696c 7465 7220 3d3d 2032 2061  onfFilter == 2 a
-0001d1c0: 6e64 206e 6f74 2069 7347 6f6c 6465 6e43  nd not isGoldenC
-0001d1d0: 726f 7373 4f76 6572 2061 6e64 2028 6973  rossOver and (is
-0001d1e0: 3530 444d 4144 6f77 6e54 7265 6e64 206f  50DMADownTrend o
-0001d1f0: 7220 6973 4465 6164 4372 6f73 734f 7665  r isDeadCrossOve
-0001d200: 7220 6f72 2027 446f 776e 2720 696e 2063  r or 'Down' in c
-0001d210: 6f6e 6654 6578 7429 290a 2020 2020 2020  onfText)).      
-0001d220: 2020 2320 4d61 7962 6520 7468 6520 6469    # Maybe the di
-0001d230: 6666 6572 656e 6365 2069 7320 6e6f 7420  fference is not 
-0001d240: 7769 7468 696e 2074 6865 2072 616e 6765  within the range
-0001d250: 2c20 6275 7420 7765 2764 2073 7469 6c6c  , but we'd still
-0001d260: 206c 696b 6520 746f 206b 6565 7020 7468   like to keep th
-0001d270: 6520 7374 6f63 6b20 696e 0a20 2020 2020  e stock in.     
-0001d280: 2020 2023 2074 6865 206c 6973 7420 6966     # the list if
-0001d290: 2069 7427 7320 6120 676f 6c64 656e 2063   it's a golden c
-0001d2a0: 726f 7373 6f76 6572 206f 7220 6465 6164  rossover or dead
-0001d2b0: 2063 726f 7373 6f76 6572 0a20 2020 2020   crossover.     
-0001d2c0: 2020 2069 6620 6973 476f 6c64 656e 4372     if isGoldenCr
-0001d2d0: 6f73 734f 7665 7220 6f72 2069 7344 6561  ossOver or isDea
-0001d2e0: 6443 726f 7373 4f76 6572 3a0a 2020 2020  dCrossOver:.    
-0001d2f0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-0001d300: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-0001d310: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0001d320: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
-0001d330: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0001d340: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001d350: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-0001d360: 2020 2020 2020 2020 2020 202b 2028 636f             + (co
-0001d370: 6c6f 7254 6578 742e 4752 4545 4e20 6966  lorText.GREEN if
-0001d380: 2069 7335 3044 4d41 5570 5472 656e 6420   is50DMAUpTrend 
-0001d390: 656c 7365 2028 636f 6c6f 7254 6578 742e  else (colorText.
-0001d3a0: 4641 494c 2069 6620 6973 3530 444d 4144  FAIL if is50DMAD
-0001d3b0: 6f77 6e54 7265 6e64 2065 6c73 6520 636f  ownTrend else co
-0001d3c0: 6c6f 7254 6578 742e 5741 524e 2929 0a20  lorText.WARN)). 
-0001d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3e0: 2020 202b 2066 227b 636f 6e66 5465 7874     + f"{confText
-0001d3f0: 7d20 287b 6469 6666 6572 656e 6365 7d25  } ({difference}%
-0001d400: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
-0001d410: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
-0001d420: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001d430: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001d440: 2020 2020 2073 6176 6544 6963 745b 224d       saveDict["M
-0001d450: 412d 5369 676e 616c 225d 203d 2073 6176  A-Signal"] = sav
-0001d460: 6564 5b31 5d20 2b20 6622 7b63 6f6e 6654  ed[1] + f"{confT
-0001d470: 6578 747d 2028 7b64 6966 6665 7265 6e63  ext} ({differenc
-0001d480: 657d 2529 220a 2020 2020 2020 2020 2020  e}%)".          
-0001d490: 2020 7265 7475 726e 2063 6f6e 6646 696c    return confFil
-0001d4a0: 7465 7220 3d3d 2033 206f 7220 5c0a 2020  ter == 3 or \.  
-0001d4b0: 2020 2020 2020 2020 2020 2020 2020 2863                (c
-0001d4c0: 6f6e 6646 696c 7465 7220 3d3d 2031 2061  onfFilter == 1 a
-0001d4d0: 6e64 2069 7347 6f6c 6465 6e43 726f 7373  nd isGoldenCross
-0001d4e0: 4f76 6572 2920 6f72 205c 0a20 2020 2020  Over) or \.     
-0001d4f0: 2020 2020 2020 2020 2020 2028 636f 6e66             (conf
-0001d500: 4669 6c74 6572 203d 3d20 3220 616e 6420  Filter == 2 and 
-0001d510: 6973 4465 6164 4372 6f73 734f 7665 7229  isDeadCrossOver)
-0001d520: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d530: 4661 6c73 650a 0a20 2020 2023 406d 6561  False..    #@mea
-0001d540: 7375 7265 5f74 696d 650a 2020 2020 2320  sure_time.    # 
-0001d550: 5661 6c69 6461 7465 2069 6620 7368 6172  Validate if shar
-0001d560: 6520 7072 6963 6573 2061 7265 2063 6f6e  e prices are con
-0001d570: 736f 6c69 6461 7469 6e67 0a20 2020 2064  solidating.    d
-0001d580: 6566 2076 616c 6964 6174 6543 6f6e 736f  ef validateConso
-0001d590: 6c69 6461 7469 6f6e 2873 656c 662c 2064  lidation(self, d
-0001d5a0: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-0001d5b0: 6176 6544 6963 742c 2070 6572 6365 6e74  aveDict, percent
-0001d5c0: 6167 653d 3130 293a 0a20 2020 2020 2020  age=10):.       
-0001d5d0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-0001d5e0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-0001d5f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001d600: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001d610: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-0001d620: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0001d630: 2064 6174 612e 6669 6c6c 6e61 2830 290a   data.fillna(0).
-0001d640: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0001d650: 6174 612e 7265 706c 6163 6528 5b6e 702e  ata.replace([np.
-0001d660: 696e 662c 202d 6e70 2e69 6e66 5d2c 2030  inf, -np.inf], 0
-0001d670: 290a 2020 2020 2020 2020 6863 203d 2064  ).        hc = d
-0001d680: 6174 612e 6465 7363 7269 6265 2829 5b22  ata.describe()["
-0001d690: 436c 6f73 6522 5d5b 226d 6178 225d 0a20  Close"]["max"]. 
-0001d6a0: 2020 2020 2020 206c 6320 3d20 6461 7461         lc = data
-0001d6b0: 2e64 6573 6372 6962 6528 295b 2243 6c6f  .describe()["Clo
-0001d6c0: 7365 225d 5b22 6d69 6e22 5d0a 2020 2020  se"]["min"].    
-0001d6d0: 2020 2020 6966 2028 6863 202d 206c 6329      if (hc - lc)
-0001d6e0: 203c 3d20 2868 6320 2a20 7065 7263 656e   <= (hc * percen
-0001d6f0: 7461 6765 202f 2031 3030 2920 616e 6420  tage / 100) and 
-0001d700: 2868 6320 2d20 6c63 2021 3d20 3029 3a0a  (hc - lc != 0):.
-0001d710: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-0001d720: 656e 4469 6374 5b22 436f 6e73 6f6c 2e22  enDict["Consol."
-0001d730: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-0001d740: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
-0001d750: 424f 4c44 0a20 2020 2020 2020 2020 2020  BOLD.           
-0001d760: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0001d770: 2e47 5245 454e 0a20 2020 2020 2020 2020  .GREEN.         
-0001d780: 2020 2020 2020 202b 2022 5261 6e67 653a         + "Range:
-0001d790: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001d7a0: 2020 2b20 7374 7228 726f 756e 6428 2861    + str(round((a
-0001d7b0: 6273 2828 6863 202d 206c 6329 202f 2068  bs((hc - lc) / h
-0001d7c0: 6329 202a 2031 3030 292c 2031 2929 0a20  c) * 100), 1)). 
-0001d7d0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001d7e0: 2022 2522 0a20 2020 2020 2020 2020 2020   "%".           
-0001d7f0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0001d800: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0001d810: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-0001d820: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
-0001d830: 6565 6e44 6963 745b 2243 6f6e 736f 6c2e  eenDict["Consol.
-0001d840: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-0001d850: 2020 2020 2020 2063 6f6c 6f72 5465 7874         colorText
-0001d860: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
-0001d870: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001d880: 742e 4641 494c 0a20 2020 2020 2020 2020  t.FAIL.         
-0001d890: 2020 2020 2020 202b 2022 5261 6e67 653a         + "Range:
-0001d8a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001d8b0: 2020 2b20 7374 7228 726f 756e 6428 2861    + str(round((a
-0001d8c0: 6273 2828 6863 202d 206c 6329 202f 2068  bs((hc - lc) / h
-0001d8d0: 6329 202a 2031 3030 292c 2031 2929 0a20  c) * 100), 1)). 
-0001d8e0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001d8f0: 2022 2522 0a20 2020 2020 2020 2020 2020   "%".           
-0001d900: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0001d910: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
-0001d920: 2029 0a20 2020 2020 2020 2073 6176 6544   ).        saveD
-0001d930: 6963 745b 2243 6f6e 736f 6c2e 225d 203d  ict["Consol."] =
-0001d940: 2066 2752 616e 6765 3a7b 7374 7228 726f   f'Range:{str(ro
-0001d950: 756e 6428 2861 6273 2828 6863 2d6c 6329  und((abs((hc-lc)
-0001d960: 2f68 6329 2a31 3030 292c 3129 292b 2225  /hc)*100),1))+"%
-0001d970: 227d 270a 2020 2020 2020 2020 7265 7475  "}'.        retu
-0001d980: 726e 2072 6f75 6e64 2828 6162 7328 2868  rn round((abs((h
-0001d990: 6320 2d20 6c63 2920 2f20 6863 2920 2a20  c - lc) / hc) * 
-0001d9a0: 3130 3029 2c20 3129 0a0a 2020 2020 2320  100), 1)..    # 
-0001d9b0: 7661 6c69 6461 7465 2069 6620 7468 6520  validate if the 
-0001d9c0: 7374 6f63 6b20 6861 7320 6265 656e 2068  stock has been h
-0001d9d0: 6176 696e 6720 6869 6768 6572 2068 6967  aving higher hig
-0001d9e0: 6873 2c20 6869 6768 6572 206c 6f77 730a  hs, higher lows.
-0001d9f0: 2020 2020 2320 616e 6420 6869 6768 6572      # and higher
-0001da00: 2063 6c6f 7365 2077 6974 6820 6c61 7465   close with late
-0001da10: 7374 2063 6c6f 7365 203e 2073 7570 6572  st close > super
-0001da20: 7472 656e 6420 616e 6420 382d 454d 412e  trend and 8-EMA.
-0001da30: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-0001da40: 6548 6967 6865 7248 6967 6873 4869 6768  eHigherHighsHigh
-0001da50: 6572 4c6f 7773 4869 6768 6572 436c 6f73  erLowsHigherClos
-0001da60: 6528 7365 6c66 2c20 6466 293a 0a20 2020  e(self, df):.   
-0001da70: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
-0001da80: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
-0001da90: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0001daa0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-0001dab0: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-0001dac0: 6f70 7928 290a 2020 2020 2020 2020 6461  opy().        da
-0001dad0: 7930 203d 2064 6174 610a 2020 2020 2020  y0 = data.      
-0001dae0: 2020 6461 7931 203d 2064 6174 615b 313a    day1 = data[1:
-0001daf0: 5d0a 2020 2020 2020 2020 6461 7932 203d  ].        day2 =
-0001db00: 2064 6174 615b 323a 5d0a 2020 2020 2020   data[2:].      
-0001db10: 2020 6461 7933 203d 2064 6174 615b 333a    day3 = data[3:
-0001db20: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
-0001db30: 2864 6179 3129 203c 2031 206f 7220 6c65  (day1) < 1 or le
-0001db40: 6e28 6461 7932 2920 3c20 3120 6f72 206c  n(day2) < 1 or l
-0001db50: 656e 2864 6179 3329 203c 2031 3a0a 2020  en(day3) < 1:.  
-0001db60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001db70: 2046 616c 7365 0a20 2020 2020 2020 2068   False.        h
-0001db80: 6967 6865 7248 6967 6873 203d 2028 0a20  igherHighs = (. 
-0001db90: 2020 2020 2020 2020 2020 2028 6461 7930             (day0
-0001dba0: 5b22 4869 6768 225d 2e69 6c6f 635b 305d  ["High"].iloc[0]
-0001dbb0: 203e 2064 6179 315b 2248 6967 6822 5d2e   > day1["High"].
-0001dbc0: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
-0001dbd0: 2020 2020 2061 6e64 2028 6461 7931 5b22       and (day1["
-0001dbe0: 4869 6768 225d 2e69 6c6f 635b 305d 203e  High"].iloc[0] >
-0001dbf0: 2064 6179 325b 2248 6967 6822 5d2e 696c   day2["High"].il
-0001dc00: 6f63 5b30 5d29 0a20 2020 2020 2020 2020  oc[0]).         
-0001dc10: 2020 2061 6e64 2028 6461 7932 5b22 4869     and (day2["Hi
-0001dc20: 6768 225d 2e69 6c6f 635b 305d 203e 2064  gh"].iloc[0] > d
-0001dc30: 6179 335b 2248 6967 6822 5d2e 696c 6f63  ay3["High"].iloc
-0001dc40: 5b30 5d29 0a20 2020 2020 2020 2029 0a20  [0]).        ). 
-0001dc50: 2020 2020 2020 2068 6967 6865 724c 6f77         higherLow
-0001dc60: 7320 3d20 280a 2020 2020 2020 2020 2020  s = (.          
-0001dc70: 2020 2864 6179 305b 224c 6f77 225d 2e69    (day0["Low"].i
-0001dc80: 6c6f 635b 305d 203e 2064 6179 315b 224c  loc[0] > day1["L
-0001dc90: 6f77 225d 2e69 6c6f 635b 305d 290a 2020  ow"].iloc[0]).  
-0001dca0: 2020 2020 2020 2020 2020 616e 6420 2864            and (d
-0001dcb0: 6179 315b 224c 6f77 225d 2e69 6c6f 635b  ay1["Low"].iloc[
-0001dcc0: 305d 203e 2064 6179 325b 224c 6f77 225d  0] > day2["Low"]
-0001dcd0: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
-0001dce0: 2020 2020 2020 616e 6420 2864 6179 325b        and (day2[
-0001dcf0: 224c 6f77 225d 2e69 6c6f 635b 305d 203e  "Low"].iloc[0] >
-0001dd00: 2064 6179 335b 224c 6f77 225d 2e69 6c6f   day3["Low"].ilo
-0001dd10: 635b 305d 290a 2020 2020 2020 2020 290a  c[0]).        ).
-0001dd20: 2020 2020 2020 2020 6869 6768 6572 436c          higherCl
-0001dd30: 6f73 6520 3d20 280a 2020 2020 2020 2020  ose = (.        
-0001dd40: 2020 2020 2864 6179 305b 2243 6c6f 7365      (day0["Close
-0001dd50: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001dd60: 315b 2243 6c6f 7365 225d 2e69 6c6f 635b  1["Close"].iloc[
-0001dd70: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-0001dd80: 616e 6420 2864 6179 315b 2243 6c6f 7365  and (day1["Close
-0001dd90: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001dda0: 325b 2243 6c6f 7365 225d 2e69 6c6f 635b  2["Close"].iloc[
-0001ddb0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-0001ddc0: 616e 6420 2864 6179 325b 2243 6c6f 7365  and (day2["Close
-0001ddd0: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
-0001dde0: 335b 2243 6c6f 7365 225d 2e69 6c6f 635b  3["Close"].iloc[
-0001ddf0: 305d 290a 2020 2020 2020 2020 290a 2020  0]).        ).  
-0001de00: 2020 2020 2020 2320 6869 6768 6572 5253        # higherRS
-0001de10: 4920 3d20 2864 6179 305b 2252 5349 225d  I = (day0["RSI"]
-0001de20: 2e69 6c6f 635b 305d 203e 2064 6179 315b  .iloc[0] > day1[
-0001de30: 2252 5349 225d 2e69 6c6f 635b 305d 2920  "RSI"].iloc[0]) 
-0001de40: 616e 6420 5c0a 2020 2020 2020 2020 2320  and \.        # 
-0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de60: 2864 6179 315b 2252 5349 225d 2e69 6c6f  (day1["RSI"].ilo
-0001de70: 635b 305d 203e 2064 6179 325b 2252 5349  c[0] > day2["RSI
-0001de80: 225d 2e69 6c6f 635b 305d 2920 616e 6420  "].iloc[0]) and 
-0001de90: 5c0a 2020 2020 2020 2020 2320 2020 2020  \.        #     
-0001dea0: 2020 2020 2020 2020 2020 2020 2864 6179              (day
-0001deb0: 325b 2252 5349 225d 2e69 6c6f 635b 305d  2["RSI"].iloc[0]
-0001dec0: 203e 2064 6179 335b 2252 5349 225d 2e69   > day3["RSI"].i
-0001ded0: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
-0001dee0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-0001def0: 2020 2020 2020 2020 6461 7933 5b22 5253          day3["RS
-0001df00: 4922 5d2e 696c 6f63 5b30 5d20 3e3d 2035  I"].iloc[0] >= 5
-0001df10: 3020 616e 6420 6461 7930 5b22 5253 4922  0 and day0["RSI"
-0001df20: 5d2e 696c 6f63 5b30 5d20 3e3d 2036 350a  ].iloc[0] >= 65.
-0001df30: 2020 2020 2020 2020 7265 7665 7273 6564          reversed
-0001df40: 4461 7461 203d 2064 6174 615b 3a3a 2d31  Data = data[::-1
-0001df50: 5d2e 636f 7079 2829 0a20 2020 2020 2020  ].copy().       
-0001df60: 2072 6576 6572 7365 6444 6174 615b 2253   reversedData["S
-0001df70: 5550 4552 5422 5d20 3d20 706b 7461 6c69  UPERT"] = pktali
-0001df80: 622e 7375 7065 7274 7265 6e64 2872 6576  b.supertrend(rev
-0001df90: 6572 7365 6444 6174 612c 2037 2c20 3329  ersedData, 7, 3)
-0001dfa0: 5b22 5355 5045 5254 5f37 5f33 2e30 225d  ["SUPERT_7_3.0"]
-0001dfb0: 0a20 2020 2020 2020 2072 6576 6572 7365  .        reverse
-0001dfc0: 6444 6174 615b 2245 4d41 3822 5d20 3d20  dData["EMA8"] = 
-0001dfd0: 706b 7461 6c69 622e 454d 4128 7265 7665  pktalib.EMA(reve
-0001dfe0: 7273 6564 4461 7461 5b22 436c 6f73 6522  rsedData["Close"
-0001dff0: 5d2c 2074 696d 6570 6572 696f 643d 3929  ], timeperiod=9)
-0001e000: 0a20 2020 2020 2020 2068 6967 6865 7243  .        higherC
-0001e010: 6c6f 7365 203d 2028 0a20 2020 2020 2020  lose = (.       
-0001e020: 2020 2020 2068 6967 6865 7243 6c6f 7365       higherClose
-0001e030: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001e040: 2064 6179 305b 2243 6c6f 7365 225d 2e69   day0["Close"].i
-0001e050: 6c6f 635b 305d 203e 2072 6576 6572 7365  loc[0] > reverse
-0001e060: 6444 6174 612e 7461 696c 2831 295b 2253  dData.tail(1)["S
-0001e070: 5550 4552 5422 5d2e 696c 6f63 5b30 5d0a  UPERT"].iloc[0].
-0001e080: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0001e090: 6461 7930 5b22 436c 6f73 6522 5d2e 696c  day0["Close"].il
-0001e0a0: 6f63 5b30 5d20 3e20 7265 7665 7273 6564  oc[0] > reversed
-0001e0b0: 4461 7461 2e74 6169 6c28 3129 5b22 454d  Data.tail(1)["EM
-0001e0c0: 4138 225d 2e69 6c6f 635b 305d 0a20 2020  A8"].iloc[0].   
-0001e0d0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0001e0e0: 6574 7572 6e20 6869 6768 6572 4869 6768  eturn higherHigh
-0001e0f0: 7320 616e 6420 6869 6768 6572 4c6f 7773  s and higherLows
-0001e100: 2061 6e64 2068 6967 6865 7243 6c6f 7365   and higherClose
-0001e110: 0a0a 2020 2020 2340 6d65 6173 7572 655f  ..    #@measure_
-0001e120: 7469 6d65 0a20 2020 2023 2056 616c 6964  time.    # Valid
-0001e130: 6174 6520 2749 6e73 6964 6520 4261 7227  ate 'Inside Bar'
-0001e140: 2073 7472 7563 7475 7265 2066 6f72 2072   structure for r
-0001e150: 6563 656e 7420 6461 7973 0a20 2020 2064  ecent days.    d
-0001e160: 6566 2076 616c 6964 6174 6549 6e73 6964  ef validateInsid
-0001e170: 6542 6172 280a 2020 2020 2020 2020 7365  eBar(.        se
-0001e180: 6c66 2c20 6466 2c20 7363 7265 656e 4469  lf, df, screenDi
-0001e190: 6374 2c20 7361 7665 4469 6374 2c20 6368  ct, saveDict, ch
-0001e1a0: 6172 7450 6174 7465 726e 3d31 2c20 6461  artPattern=1, da
-0001e1b0: 7973 546f 4c6f 6f6b 6261 636b 3d35 0a20  ysToLookback=5. 
-0001e1c0: 2020 2029 3a0a 2020 2020 2020 2020 6966     ):.        if
-0001e1d0: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-0001e1e0: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-0001e1f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001e200: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-0001e210: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-0001e220: 2020 2020 2020 206f 7267 4461 7461 203d         orgData =
-0001e230: 2064 6174 610a 2020 2020 2020 2020 7361   data.        sa
-0001e240: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
-0001e250: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
-0001e260: 2873 6372 6565 6e44 6963 742c 2073 6176  (screenDict, sav
-0001e270: 6544 6963 742c 2022 5061 7474 6572 6e22  eDict, "Pattern"
-0001e280: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
-0001e290: 696e 2072 616e 6765 2869 6e74 2864 6179  in range(int(day
-0001e2a0: 7354 6f4c 6f6f 6b62 6163 6b29 2c20 696e  sToLookback), in
-0001e2b0: 7428 726f 756e 6428 6461 7973 546f 4c6f  t(round(daysToLo
-0001e2c0: 6f6b 6261 636b 202a 2030 2e35 2929 202d  okback * 0.5)) -
-0001e2d0: 2031 2c20 2d31 293a 0a20 2020 2020 2020   1, -1):.       
-0001e2e0: 2020 2020 2069 6620 6920 3d3d 2032 3a0a       if i == 2:.
-0001e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e300: 7265 7475 726e 2030 2020 2320 4578 6974  return 0  # Exit
-0001e310: 2069 6620 6f6e 6c79 206c 6173 7420 3220   if only last 2 
-0001e320: 6361 6e64 6c65 7320 6172 6520 6c65 6674  candles are left
-0001e330: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001e340: 6368 6172 7450 6174 7465 726e 203d 3d20  chartPattern == 
-0001e350: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0001e360: 2020 2069 6620 2255 7022 2069 6e20 7361     if "Up" in sa
-0001e370: 7665 4469 6374 5b22 5472 656e 6422 5d20  veDict["Trend"] 
-0001e380: 616e 6420 280a 2020 2020 2020 2020 2020  and (.          
-0001e390: 2020 2020 2020 2020 2020 2242 756c 6c22            "Bull"
-0001e3a0: 2069 6e20 7361 7665 4469 6374 5b22 4d41   in saveDict["MA
-0001e3b0: 2d53 6967 6e61 6c22 5d0a 2020 2020 2020  -Signal"].      
-0001e3c0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0001e3d0: 2022 5375 7070 6f72 7422 2069 6e20 7361   "Support" in sa
-0001e3e0: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
-0001e3f0: 6c22 5d0a 2020 2020 2020 2020 2020 2020  l"].            
-0001e400: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0001e410: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-0001e420: 3d20 6f72 6744 6174 612e 6865 6164 2869  = orgData.head(i
-0001e430: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e440: 2020 2020 2020 7265 6643 616e 646c 6520        refCandle 
-0001e450: 3d20 6461 7461 2e74 6169 6c28 3129 0a20  = data.tail(1). 
-0001e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e470: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-0001e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e490: 286c 656e 2864 6174 612e 4869 6768 5b64  (len(data.High[d
-0001e4a0: 6174 612e 4869 6768 203e 2072 6566 4361  ata.High > refCa
-0001e4b0: 6e64 6c65 2e48 6967 682e 6974 656d 2829  ndle.High.item()
-0001e4c0: 5d29 203d 3d20 3029 0a20 2020 2020 2020  ]) == 0).       
-0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4e0: 2061 6e64 2028 6c65 6e28 6461 7461 2e4c   and (len(data.L
-0001e4f0: 6f77 5b64 6174 612e 4c6f 7720 3c20 7265  ow[data.Low < re
-0001e500: 6643 616e 646c 652e 4c6f 772e 6974 656d  fCandle.Low.item
-0001e510: 2829 5d29 203d 3d20 3029 0a20 2020 2020  ()]) == 0).     
-0001e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e530: 2020 2061 6e64 2028 6c65 6e28 6461 7461     and (len(data
-0001e540: 2e4f 7065 6e5b 6461 7461 2e4f 7065 6e20  .Open[data.Open 
-0001e550: 3e20 7265 6643 616e 646c 652e 4869 6768  > refCandle.High
-0001e560: 2e69 7465 6d28 295d 2920 3d3d 2030 290a  .item()]) == 0).
-0001e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e580: 2020 2020 2020 2020 616e 6420 286c 656e          and (len
-0001e590: 2864 6174 612e 436c 6f73 655b 6461 7461  (data.Close[data
-0001e5a0: 2e43 6c6f 7365 203c 2072 6566 4361 6e64  .Close < refCand
-0001e5b0: 6c65 2e4c 6f77 2e69 7465 6d28 295d 2920  le.Low.item()]) 
-0001e5c0: 3d3d 2030 290a 2020 2020 2020 2020 2020  == 0).          
-0001e5d0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-0001e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5f0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-0001e600: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
-0001e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e620: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-0001e630: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e650: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
-0001e660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e670: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0001e680: 6f6c 6f72 5465 7874 2e57 4152 4e0a 2020  olorText.WARN.  
-0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6a0: 2020 2020 2020 2020 2020 2b20 2822 496e            + ("In
-0001e6b0: 7369 6465 2042 6172 2028 2564 2922 2025  side Bar (%d)" %
-0001e6c0: 2069 290a 2020 2020 2020 2020 2020 2020   i).            
-0001e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6e0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e700: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e720: 2020 7361 7665 4469 6374 5b22 5061 7474    saveDict["Patt
-0001e730: 6572 6e22 5d20 3d20 7361 7665 645b 315d  ern"] = saved[1]
-0001e740: 202b 2022 496e 7369 6465 2042 6172 2028   + "Inside Bar (
-0001e750: 2564 2922 2025 2069 0a20 2020 2020 2020  %d)" % i.       
+0001a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a870: 2020 2020 2b20 6461 7461 5f6c 6973 745b      + data_list[
+0001a880: 636e 745d 2e73 706c 6974 2822 5f22 295b  cnt].split("_")[
+0001a890: 315d 2e75 7070 6572 2829 0a20 2020 2020  1].upper().     
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8c0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0001a8d0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+0001a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a900: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a930: 2020 2020 2020 636f 6c6f 7254 6578 742e        colorText.
+0001a940: 4641 494c 0a20 2020 2020 2020 2020 2020  FAIL.           
+0001a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a970: 202b 2073 7472 2866 696e 616c 2e53 4c5b   + str(final.SL[
+0001a980: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9b0: 2b20 636f 6c6f 7254 6578 742e 454e 442c  + colorText.END,
+0001a9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9e0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+0001a9f0: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
+0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa20: 2020 2020 2020 2020 202b 2073 7472 2866           + str(f
+0001aa30: 696e 616c 2e54 6172 6765 745b 305d 290a  inal.Target[0]).
+0001aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa60: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001aa70: 6c6f 7254 6578 742e 454e 442c 0a20 2020  lorText.END,.   
+0001aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaa0: 2020 2020 2020 2020 2066 2231 3a7b 7269           f"1:{ri
+0001aab0: 736b 5f72 6577 6172 647d 222c 0a20 2020  sk_reward}",.   
+0001aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aae0: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
+0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab30: 2020 636f 6c75 6d6e 733d 7265 7375 6c74    columns=result
+0001ab40: 5f64 662e 636f 6c75 6d6e 732c 0a20 2020  _df.columns,.   
+0001ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab60: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab80: 2020 2020 2020 2020 2020 2020 5d2c 0a20              ],. 
+0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aba0: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+0001abb0: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0001abc0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abe0: 2020 2020 2072 6573 756c 745f 6466 2e72       result_df.r
+0001abf0: 6573 6574 5f69 6e64 6578 2864 726f 703d  eset_index(drop=
+0001ac00: 5472 7565 2c20 696e 706c 6163 653d 5472  True, inplace=Tr
+0001ac10: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0001ac20: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0001ac30: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+0001ac40: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+0001ac50: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0001ac60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001ac70: 6465 6661 756c 745f 6c6f 6767 6572 2e64  default_logger.d
+0001ac80: 6562 7567 2865 2c20 6578 635f 696e 666f  ebug(e, exc_info
+0001ac90: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0001aca0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001acb0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+0001acc0: 2020 2020 2020 2020 2320 5468 656e 2075          # Then u
+0001acd0: 7064 6174 650a 2020 2020 2020 2020 2020  pdate.          
+0001ace0: 2020 2020 2020 2020 2020 6c61 7374 5f73            last_s
+0001acf0: 6967 6e61 6c5b 6461 7461 5f6c 6973 745b  ignal[data_list[
+0001ad00: 636e 745d 5d20 3d20 5b66 696e 616c 5d0a  cnt]] = [final].
+0001ad10: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
+0001ad20: 745f 6466 2069 7320 6e6f 7420 4e6f 6e65  t_df is not None
+0001ad30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001ad40: 7375 6c74 5f64 662e 6472 6f70 5f64 7570  sult_df.drop_dup
+0001ad50: 6c69 6361 7465 7328 6b65 6570 3d22 6c61  licates(keep="la
+0001ad60: 7374 222c 2069 6e70 6c61 6365 3d54 7275  st", inplace=Tru
+0001ad70: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+0001ad80: 6573 756c 745f 6466 2e73 6f72 745f 7661  esult_df.sort_va
+0001ad90: 6c75 6573 2862 793d 2254 696d 6522 2c20  lues(by="Time", 
+0001ada0: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+0001adb0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0001adc0: 756c 745f 6466 5b3a 3a2d 315d 0a0a 2020  ult_df[::-1]..  
+0001add0: 2020 2320 5072 6570 726f 6365 7373 2074    # Preprocess t
+0001ade0: 6865 2061 6371 7569 7265 6420 6461 7461  he acquired data
+0001adf0: 0a20 2020 2064 6566 2070 7265 7072 6f63  .    def preproc
+0001ae00: 6573 7344 6174 6128 7365 6c66 2c20 6466  essData(self, df
+0001ae10: 2c20 6461 7973 546f 4c6f 6f6b 6261 636b  , daysToLookback
+0001ae20: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0001ae30: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+0001ae40: 6528 6466 2c20 7064 2e44 6174 6146 7261  e(df, pd.DataFra
+0001ae50: 6d65 290a 2020 2020 2020 2020 6461 7461  me).        data
+0001ae60: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+0001ae70: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001ae80: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0001ae90: 612e 7265 706c 6163 6528 6e70 2e69 6e66  a.replace(np.inf
+0001aea0: 2c20 6e70 2e6e 616e 292e 7265 706c 6163  , np.nan).replac
+0001aeb0: 6528 2d6e 702e 696e 662c 206e 702e 6e61  e(-np.inf, np.na
+0001aec0: 6e29 2e64 726f 706e 6128 686f 773d 2261  n).dropna(how="a
+0001aed0: 6c6c 2229 0a20 2020 2020 2020 2020 2020  ll").           
+0001aee0: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
+0001aef0: 6c6f 6767 6572 2e69 6e66 6f28 6622 5072  logger.info(f"Pr
+0001af00: 6570 726f 6365 7373 696e 6720 6461 7461  eprocessing data
+0001af10: 3a5c 6e7b 6461 7461 2e68 6561 6428 3129  :\n{data.head(1)
+0001af20: 7d5c 6e22 290a 2020 2020 2020 2020 2020  }\n").          
+0001af30: 2020 6966 2064 6179 7354 6f4c 6f6f 6b62    if daysToLookb
+0001af40: 6163 6b20 6973 204e 6f6e 653a 0a20 2020  ack is None:.   
+0001af50: 2020 2020 2020 2020 2020 2020 2064 6179               day
+0001af60: 7354 6f4c 6f6f 6b62 6163 6b20 3d20 7365  sToLookback = se
+0001af70: 6c66 2e63 6f6e 6669 674d 616e 6167 6572  lf.configManager
+0001af80: 2e64 6179 7354 6f4c 6f6f 6b62 6163 6b0a  .daysToLookback.
+0001af90: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0001afa0: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
+0001afb0: 722e 7573 6545 4d41 3a0a 2020 2020 2020  r.useEMA:.      
+0001afc0: 2020 2020 2020 2020 2020 736d 6120 3d20            sma = 
+0001afd0: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+0001afe0: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
+0001aff0: 6572 696f 643d 3530 290a 2020 2020 2020  eriod=50).      
+0001b000: 2020 2020 2020 2020 2020 6c6d 6120 3d20            lma = 
+0001b010: 706b 7461 6c69 622e 454d 4128 6461 7461  pktalib.EMA(data
+0001b020: 5b22 436c 6f73 6522 5d2c 2074 696d 6570  ["Close"], timep
+0001b030: 6572 696f 643d 3230 3029 0a20 2020 2020  eriod=200).     
+0001b040: 2020 2020 2020 2020 2020 2073 736d 6120             ssma 
+0001b050: 3d20 706b 7461 6c69 622e 454d 4128 6461  = pktalib.EMA(da
+0001b060: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
+0001b070: 6570 6572 696f 643d 3929 0a20 2020 2020  eperiod=9).     
+0001b080: 2020 2020 2020 2020 2020 2073 736d 6132             ssma2
+0001b090: 3020 3d20 706b 7461 6c69 622e 454d 4128  0 = pktalib.EMA(
+0001b0a0: 6461 7461 5b22 436c 6f73 6522 5d2c 2074  data["Close"], t
+0001b0b0: 696d 6570 6572 696f 643d 3230 290a 2020  imeperiod=20).  
+0001b0c0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001b0d0: 7461 2e69 6e73 6572 7428 6c65 6e28 6461  ta.insert(len(da
+0001b0e0: 7461 2e63 6f6c 756d 6e73 292c 2022 534d  ta.columns), "SM
+0001b0f0: 4122 2c20 736d 6129 0a20 2020 2020 2020  A", sma).       
+0001b100: 2020 2020 2020 2020 2064 6174 612e 696e           data.in
+0001b110: 7365 7274 286c 656e 2864 6174 612e 636f  sert(len(data.co
+0001b120: 6c75 6d6e 7329 2c20 224c 4d41 222c 206c  lumns), "LMA", l
+0001b130: 6d61 290a 2020 2020 2020 2020 2020 2020  ma).            
+0001b140: 2020 2020 6461 7461 2e69 6e73 6572 7428      data.insert(
+0001b150: 6c65 6e28 6461 7461 2e63 6f6c 756d 6e73  len(data.columns
+0001b160: 292c 2022 5353 4d41 222c 2073 736d 6129  ), "SSMA", ssma)
+0001b170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b180: 2064 6174 612e 696e 7365 7274 286c 656e   data.insert(len
+0001b190: 2864 6174 612e 636f 6c75 6d6e 7329 2c20  (data.columns), 
+0001b1a0: 2253 534d 4132 3022 2c20 7373 6d61 3230  "SSMA20", ssma20
+0001b1b0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0001b1c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b1d0: 2020 2020 736d 6120 3d20 706b 7461 6c69      sma = pktali
+0001b1e0: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
+0001b1f0: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+0001b200: 3530 290a 2020 2020 2020 2020 2020 2020  50).            
+0001b210: 2020 2020 6c6d 6120 3d20 706b 7461 6c69      lma = pktali
+0001b220: 622e 534d 4128 6461 7461 5b22 436c 6f73  b.SMA(data["Clos
+0001b230: 6522 5d2c 2074 696d 6570 6572 696f 643d  e"], timeperiod=
+0001b240: 3230 3029 0a20 2020 2020 2020 2020 2020  200).           
+0001b250: 2020 2020 2073 736d 6120 3d20 706b 7461       ssma = pkta
+0001b260: 6c69 622e 534d 4128 6461 7461 5b22 436c  lib.SMA(data["Cl
+0001b270: 6f73 6522 5d2c 2074 696d 6570 6572 696f  ose"], timeperio
+0001b280: 643d 3929 0a20 2020 2020 2020 2020 2020  d=9).           
+0001b290: 2020 2020 2073 736d 6132 3020 3d20 706b       ssma20 = pk
+0001b2a0: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
+0001b2b0: 436c 6f73 6522 5d2c 2074 696d 6570 6572  Close"], timeper
+0001b2c0: 696f 643d 3230 290a 2020 2020 2020 2020  iod=20).        
+0001b2d0: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
+0001b2e0: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
+0001b2f0: 756d 6e73 292c 2022 534d 4122 2c20 736d  umns), "SMA", sm
+0001b300: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
+0001b310: 2020 2064 6174 612e 696e 7365 7274 286c     data.insert(l
+0001b320: 656e 2864 6174 612e 636f 6c75 6d6e 7329  en(data.columns)
+0001b330: 2c20 224c 4d41 222c 206c 6d61 290a 2020  , "LMA", lma).  
+0001b340: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001b350: 7461 2e69 6e73 6572 7428 6c65 6e28 6461  ta.insert(len(da
+0001b360: 7461 2e63 6f6c 756d 6e73 292c 2022 5353  ta.columns), "SS
+0001b370: 4d41 222c 2073 736d 6129 0a20 2020 2020  MA", ssma).     
+0001b380: 2020 2020 2020 2020 2020 2064 6174 612e             data.
+0001b390: 696e 7365 7274 286c 656e 2864 6174 612e  insert(len(data.
+0001b3a0: 636f 6c75 6d6e 7329 2c20 2253 534d 4132  columns), "SSMA2
+0001b3b0: 3022 2c20 7373 6d61 3230 290a 2020 2020  0", ssma20).    
+0001b3c0: 2020 2020 2020 2020 766f 6c20 3d20 706b          vol = pk
+0001b3d0: 7461 6c69 622e 534d 4128 6461 7461 5b22  talib.SMA(data["
+0001b3e0: 566f 6c75 6d65 225d 2c20 7469 6d65 7065  Volume"], timepe
+0001b3f0: 7269 6f64 3d32 3029 0a20 2020 2020 2020  riod=20).       
+0001b400: 2020 2020 2072 7369 203d 2070 6b74 616c       rsi = pktal
+0001b410: 6962 2e52 5349 2864 6174 615b 2243 6c6f  ib.RSI(data["Clo
+0001b420: 7365 225d 2c20 7469 6d65 7065 7269 6f64  se"], timeperiod
+0001b430: 3d31 3429 0a20 2020 2020 2020 2020 2020  =14).           
+0001b440: 2064 6174 612e 696e 7365 7274 286c 656e   data.insert(len
+0001b450: 2864 6174 612e 636f 6c75 6d6e 7329 2c20  (data.columns), 
+0001b460: 2256 6f6c 4d41 222c 2076 6f6c 290a 2020  "VolMA", vol).  
+0001b470: 2020 2020 2020 2020 2020 6461 7461 2e69            data.i
+0001b480: 6e73 6572 7428 6c65 6e28 6461 7461 2e63  nsert(len(data.c
+0001b490: 6f6c 756d 6e73 292c 2022 5253 4922 2c20  olumns), "RSI", 
+0001b4a0: 7273 6929 0a20 2020 2020 2020 2020 2020  rsi).           
+0001b4b0: 2063 6369 203d 2070 6b74 616c 6962 2e43   cci = pktalib.C
+0001b4c0: 4349 2864 6174 615b 2248 6967 6822 5d2c  CI(data["High"],
+0001b4d0: 2064 6174 615b 224c 6f77 225d 2c20 6461   data["Low"], da
+0001b4e0: 7461 5b22 436c 6f73 6522 5d2c 2074 696d  ta["Close"], tim
+0001b4f0: 6570 6572 696f 643d 3134 290a 2020 2020  eperiod=14).    
+0001b500: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
+0001b510: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
+0001b520: 756d 6e73 292c 2022 4343 4922 2c20 6363  umns), "CCI", cc
+0001b530: 6929 0a20 2020 2020 2020 2020 2020 2074  i).            t
+0001b540: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001b550: 2020 2020 6661 7374 6b2c 2066 6173 7464      fastk, fastd
+0001b560: 203d 2070 6b74 616c 6962 2e53 544f 4348   = pktalib.STOCH
+0001b570: 5253 4928 0a20 2020 2020 2020 2020 2020  RSI(.           
+0001b580: 2020 2020 2020 2020 2064 6174 615b 2243           data["C
+0001b590: 6c6f 7365 225d 2c20 7469 6d65 7065 7269  lose"], timeperi
+0001b5a0: 6f64 3d31 342c 2066 6173 746b 5f70 6572  od=14, fastk_per
+0001b5b0: 696f 643d 352c 2066 6173 7464 5f70 6572  iod=5, fastd_per
+0001b5c0: 696f 643d 332c 2066 6173 7464 5f6d 6174  iod=3, fastd_mat
+0001b5d0: 7970 653d 300a 2020 2020 2020 2020 2020  ype=0.          
+0001b5e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001b5f0: 2020 2020 2020 2020 6461 7461 2e69 6e73          data.ins
+0001b600: 6572 7428 6c65 6e28 6461 7461 2e63 6f6c  ert(len(data.col
+0001b610: 756d 6e73 292c 2022 4641 5354 4b22 2c20  umns), "FASTK", 
+0001b620: 6661 7374 6b29 0a20 2020 2020 2020 2020  fastk).         
+0001b630: 2020 2020 2020 2064 6174 612e 696e 7365         data.inse
+0001b640: 7274 286c 656e 2864 6174 612e 636f 6c75  rt(len(data.colu
+0001b650: 6d6e 7329 2c20 2246 4153 5444 222c 2066  mns), "FASTD", f
+0001b660: 6173 7464 290a 2020 2020 2020 2020 2020  astd).          
+0001b670: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0001b680: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0001b690: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+0001b6a0: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
+0001b6b0: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
+0001b6c0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001b6d0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001b6e0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0001b6f0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0001b700: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+0001b710: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
+0001b720: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
+0001b730: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001b740: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001b750: 2020 6461 7461 203d 2064 6174 615b 3a3a    data = data[::
+0001b760: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
+0001b770: 6865 2064 6174 6166 7261 6d65 0a20 2020  he dataframe.   
+0001b780: 2020 2020 2023 2064 6174 6120 3d20 6461       # data = da
+0001b790: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+0001b7a0: 2020 2020 2023 2064 6174 6120 3d20 6461       # data = da
+0001b7b0: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+0001b7c0: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+0001b7d0: 0a20 2020 2020 2020 2066 756c 6c44 6174  .        fullDat
+0001b7e0: 6120 3d20 6461 7461 0a20 2020 2020 2020  a = data.       
+0001b7f0: 2074 7269 6d6d 6564 4461 7461 203d 2064   trimmedData = d
+0001b800: 6174 612e 6865 6164 2864 6179 7354 6f4c  ata.head(daysToL
+0001b810: 6f6f 6b62 6163 6b29 0a20 2020 2020 2020  ookback).       
+0001b820: 2072 6574 7572 6e20 2866 756c 6c44 6174   return (fullDat
+0001b830: 612c 2074 7269 6d6d 6564 4461 7461 290a  a, trimmedData).
+0001b840: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
+0001b850: 6966 2074 6865 2073 746f 636b 2069 7320  if the stock is 
+0001b860: 6275 6c6c 6973 6820 696e 2074 6865 2073  bullish in the s
+0001b870: 686f 7274 2074 6572 6d0a 2020 2020 6465  hort term.    de
+0001b880: 6620 7661 6c69 6461 7465 3135 4d69 6e75  f validate15Minu
+0001b890: 7465 5072 6963 6556 6f6c 756d 6542 7265  tePriceVolumeBre
+0001b8a0: 616b 6f75 7428 7365 6c66 2c20 6466 293a  akout(self, df):
+0001b8b0: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
+0001b8c0: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
+0001b8d0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0001b8e0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001b8f0: 0a20 2020 2020 2020 2023 2068 7474 7073  .        # https
+0001b900: 3a2f 2f63 6861 7274 696e 6b2e 636f 6d2f  ://chartink.com/
+0001b910: 7363 7265 656e 6572 2f31 352d 6d69 6e2d  screener/15-min-
+0001b920: 7072 6963 652d 766f 6c75 6d65 2d62 7265  price-volume-bre
+0001b930: 616b 6f75 740a 2020 2020 2020 2020 6461  akout.        da
+0001b940: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+0001b950: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001b960: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+0001b970: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+0001b980: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+0001b990: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+0001b9a0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001b9b0: 7461 5b3a 3a2d 315d 2020 2320 5265 7665  ta[::-1]  # Reve
+0001b9c0: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+0001b9d0: 6520 736f 2074 6861 7420 6974 7320 7468  e so that its th
+0001b9e0: 6520 6f6c 6465 7374 2064 6174 6520 6669  e oldest date fi
+0001b9f0: 7273 740a 2020 2020 2020 2020 6461 7461  rst.        data
+0001ba00: 5b22 534d 4132 3022 5d20 3d20 706b 7461  ["SMA20"] = pkta
+0001ba10: 6c69 622e 534d 4128 6461 7461 5b22 436c  lib.SMA(data["Cl
+0001ba20: 6f73 6522 5d2c 2032 3029 0a20 2020 2020  ose"], 20).     
+0001ba30: 2020 2064 6174 615b 2253 4d41 3230 5622     data["SMA20V"
+0001ba40: 5d20 3d20 706b 7461 6c69 622e 534d 4128  ] = pktalib.SMA(
+0001ba50: 6461 7461 5b22 566f 6c75 6d65 225d 2c20  data["Volume"], 
+0001ba60: 3230 290a 2020 2020 2020 2020 6461 7461  20).        data
+0001ba70: 203d 2064 6174 615b 0a20 2020 2020 2020   = data[.       
+0001ba80: 2020 2020 203a 3a2d 310a 2020 2020 2020       ::-1.      
+0001ba90: 2020 5d20 2023 2052 6576 6572 7365 2074    ]  # Reverse t
+0001baa0: 6865 2064 6174 6166 7261 6d65 2073 6f20  he dataframe so 
+0001bab0: 7468 6174 2069 7427 7320 7468 6520 6d6f  that it's the mo
+0001bac0: 7374 2072 6563 656e 7420 6461 7465 2066  st recent date f
+0001bad0: 6972 7374 0a20 2020 2020 2020 2072 6563  irst.        rec
+0001bae0: 656e 7420 3d20 6461 7461 2e68 6561 6428  ent = data.head(
+0001baf0: 3329 0a20 2020 2020 2020 2069 6620 6c65  3).        if le
+0001bb00: 6e28 7265 6365 6e74 2920 3c20 333a 0a20  n(recent) < 3:. 
+0001bb10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001bb20: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001bb30: 636f 6e64 3120 3d20 7265 6365 6e74 5b22  cond1 = recent["
+0001bb40: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+0001bb50: 3e20 7265 6365 6e74 5b22 436c 6f73 6522  > recent["Close"
+0001bb60: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
+0001bb70: 2020 636f 6e64 3220 3d20 636f 6e64 3120    cond2 = cond1 
+0001bb80: 616e 6420 2872 6563 656e 745b 2243 6c6f  and (recent["Clo
+0001bb90: 7365 225d 2e69 6c6f 635b 305d 203e 2072  se"].iloc[0] > r
+0001bba0: 6563 656e 745b 2253 4d41 3230 225d 2e69  ecent["SMA20"].i
+0001bbb0: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001bbc0: 636f 6e64 3320 3d20 636f 6e64 3220 616e  cond3 = cond2 an
+0001bbd0: 6420 2872 6563 656e 745b 2243 6c6f 7365  d (recent["Close
+0001bbe0: 225d 2e69 6c6f 635b 315d 203e 2072 6563  "].iloc[1] > rec
+0001bbf0: 656e 745b 2248 6967 6822 5d2e 696c 6f63  ent["High"].iloc
+0001bc00: 5b32 5d29 0a20 2020 2020 2020 2063 6f6e  [2]).        con
+0001bc10: 6434 203d 2063 6f6e 6433 2061 6e64 2028  d4 = cond3 and (
+0001bc20: 7265 6365 6e74 5b22 566f 6c75 6d65 225d  recent["Volume"]
+0001bc30: 2e69 6c6f 635b 305d 203e 2072 6563 656e  .iloc[0] > recen
+0001bc40: 745b 2253 4d41 3230 5622 5d2e 696c 6f63  t["SMA20V"].iloc
+0001bc50: 5b30 5d29 0a20 2020 2020 2020 2063 6f6e  [0]).        con
+0001bc60: 6435 203d 2063 6f6e 6434 2061 6e64 2028  d5 = cond4 and (
+0001bc70: 7265 6365 6e74 5b22 566f 6c75 6d65 225d  recent["Volume"]
+0001bc80: 2e69 6c6f 635b 315d 203e 2072 6563 656e  .iloc[1] > recen
+0001bc90: 745b 2253 4d41 3230 5622 5d2e 696c 6f63  t["SMA20V"].iloc
+0001bca0: 5b30 5d29 0a20 2020 2020 2020 2072 6574  [0]).        ret
+0001bcb0: 7572 6e20 636f 6e64 350a 0a20 2020 2064  urn cond5..    d
+0001bcc0: 6566 2076 616c 6964 6174 6542 756c 6c69  ef validateBulli
+0001bcd0: 7368 466f 7254 6f6d 6f72 726f 7728 7365  shForTomorrow(se
+0001bce0: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
+0001bcf0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+0001bd00: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+0001bd10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001bd20: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0001bd30: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+0001bd40: 290a 2020 2020 2020 2020 2320 6874 7470  ).        # http
+0001bd50: 733a 2f2f 6368 6172 7469 6e6b 2e63 6f6d  s://chartink.com
+0001bd60: 2f73 6372 6565 6e65 722f 6275 6c6c 6973  /screener/bullis
+0001bd70: 682d 666f 722d 746f 6d6f 7272 6f77 0a20  h-for-tomorrow. 
+0001bd80: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001bd90: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+0001bda0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+0001bdb0: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+0001bdc0: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+0001bdd0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+0001bde0: 7461 5b3a 3a2d 315d 2020 2320 5265 7665  ta[::-1]  # Reve
+0001bdf0: 7273 6520 7468 6520 6461 7461 6672 616d  rse the datafram
+0001be00: 6520 736f 2074 6861 7420 6974 7320 7468  e so that its th
+0001be10: 6520 6f6c 6465 7374 2064 6174 6520 6669  e oldest date fi
+0001be20: 7273 740a 2020 2020 2020 2020 6d61 6364  rst.        macd
+0001be30: 4c69 6e65 203d 2070 6b74 616c 6962 2e4d  Line = pktalib.M
+0001be40: 4143 4428 6461 7461 5b22 436c 6f73 6522  ACD(data["Close"
+0001be50: 5d2c 2031 322c 2032 362c 2039 295b 305d  ], 12, 26, 9)[0]
+0001be60: 2e74 6169 6c28 3329 0a20 2020 2020 2020  .tail(3).       
+0001be70: 206d 6163 6453 6967 6e61 6c20 3d20 706b   macdSignal = pk
+0001be80: 7461 6c69 622e 4d41 4344 2864 6174 615b  talib.MACD(data[
+0001be90: 2243 6c6f 7365 225d 2c20 3132 2c20 3236  "Close"], 12, 26
+0001bea0: 2c20 3929 5b31 5d2e 7461 696c 2833 290a  , 9)[1].tail(3).
+0001beb0: 2020 2020 2020 2020 6d61 6364 4869 7374          macdHist
+0001bec0: 203d 2070 6b74 616c 6962 2e4d 4143 4428   = pktalib.MACD(
+0001bed0: 6461 7461 5b22 436c 6f73 6522 5d2c 2031  data["Close"], 1
+0001bee0: 322c 2032 362c 2039 295b 325d 2e74 6169  2, 26, 9)[2].tai
+0001bef0: 6c28 3329 0a0a 2020 2020 2020 2020 7265  l(3)..        re
+0001bf00: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+0001bf10: 2020 2028 6d61 6364 4869 7374 2e69 6c6f     (macdHist.ilo
+0001bf20: 635b 3a31 5d2e 696c 6f63 5b30 5d20 3c20  c[:1].iloc[0] < 
+0001bf30: 6d61 6364 4869 7374 2e69 6c6f 635b 3a32  macdHist.iloc[:2
+0001bf40: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001bf50: 2020 2020 2020 2061 6e64 2028 6d61 6364         and (macd
+0001bf60: 4869 7374 2e69 6c6f 635b 3a33 5d2e 696c  Hist.iloc[:3].il
+0001bf70: 6f63 5b32 5d20 3e20 6d61 6364 4869 7374  oc[2] > macdHist
+0001bf80: 2e69 6c6f 635b 3a32 5d2e 696c 6f63 5b31  .iloc[:2].iloc[1
+0001bf90: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0001bfa0: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+0001bfb0: 2020 2020 2028 6d61 6364 4c69 6e65 2e69       (macdLine.i
+0001bfc0: 6c6f 635b 3a33 5d2e 696c 6f63 5b32 5d20  loc[:3].iloc[2] 
+0001bfd0: 2d20 6d61 6364 5369 676e 616c 2e69 6c6f  - macdSignal.ilo
+0001bfe0: 635b 3a33 5d2e 696c 6f63 5b32 5d29 0a20  c[:3].iloc[2]). 
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+0001c000: 2028 6d61 6364 4c69 6e65 2e69 6c6f 635b   (macdLine.iloc[
+0001c010: 3a32 5d2e 696c 6f63 5b31 5d20 2d20 6d61  :2].iloc[1] - ma
+0001c020: 6364 5369 676e 616c 2e69 6c6f 635b 3a32  cdSignal.iloc[:2
+0001c030: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001c040: 2020 2020 2020 2020 2020 203e 3d20 302e             >= 0.
+0001c050: 340a 2020 2020 2020 2020 2020 2020 290a  4.            ).
+0001c060: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001c070: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001c080: 2020 286d 6163 644c 696e 652e 696c 6f63    (macdLine.iloc
+0001c090: 5b3a 325d 2e69 6c6f 635b 315d 202d 206d  [:2].iloc[1] - m
+0001c0a0: 6163 6453 6967 6e61 6c2e 696c 6f63 5b3a  acdSignal.iloc[:
+0001c0b0: 325d 2e69 6c6f 635b 315d 290a 2020 2020  2].iloc[1]).    
+0001c0c0: 2020 2020 2020 2020 2020 2020 2d20 286d              - (m
+0001c0d0: 6163 644c 696e 652e 696c 6f63 5b3a 315d  acdLine.iloc[:1]
+0001c0e0: 2e69 6c6f 635b 305d 202d 206d 6163 6453  .iloc[0] - macdS
+0001c0f0: 6967 6e61 6c2e 696c 6f63 5b3a 315d 2e69  ignal.iloc[:1].i
+0001c100: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001c110: 2020 2020 2020 2020 3c3d 2030 2e32 0a20          <= 0.2. 
+0001c120: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001c130: 2020 2020 2020 2020 2061 6e64 2028 6d61           and (ma
+0001c140: 6364 4c69 6e65 2e69 6c6f 635b 3a33 5d2e  cdLine.iloc[:3].
+0001c150: 696c 6f63 5b32 5d20 3e20 6d61 6364 5369  iloc[2] > macdSi
+0001c160: 676e 616c 2e69 6c6f 635b 3a33 5d2e 696c  gnal.iloc[:3].il
+0001c170: 6f63 5b32 5d29 0a20 2020 2020 2020 2020  oc[2]).         
+0001c180: 2020 2061 6e64 2028 0a20 2020 2020 2020     and (.       
+0001c190: 2020 2020 2020 2020 2028 6d61 6364 4c69           (macdLi
+0001c1a0: 6e65 2e69 6c6f 635b 3a33 5d2e 696c 6f63  ne.iloc[:3].iloc
+0001c1b0: 5b32 5d20 2d20 6d61 6364 5369 676e 616c  [2] - macdSignal
+0001c1c0: 2e69 6c6f 635b 3a33 5d2e 696c 6f63 5b32  .iloc[:3].iloc[2
+0001c1d0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001c1e0: 2020 202d 2028 6d61 6364 4c69 6e65 2e69     - (macdLine.i
+0001c1f0: 6c6f 635b 3a32 5d2e 696c 6f63 5b31 5d20  loc[:2].iloc[1] 
+0001c200: 2d20 6d61 6364 5369 676e 616c 2e69 6c6f  - macdSignal.ilo
+0001c210: 635b 3a32 5d2e 696c 6f63 5b31 5d29 0a20  c[:2].iloc[1]). 
+0001c220: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+0001c230: 2031 0a20 2020 2020 2020 2020 2020 2029   1.            )
+0001c240: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001c250: 2340 6d65 6173 7572 655f 7469 6d65 0a20  #@measure_time. 
+0001c260: 2020 2023 2076 616c 6964 6174 6520 6966     # validate if
+0001c270: 2043 4349 2069 7320 7769 7468 696e 2067   CCI is within g
+0001c280: 6976 656e 2072 616e 6765 0a20 2020 2064  iven range.    d
+0001c290: 6566 2076 616c 6964 6174 6543 4349 2873  ef validateCCI(s
+0001c2a0: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
+0001c2b0: 6963 742c 2073 6176 6544 6963 742c 206d  ict, saveDict, m
+0001c2c0: 696e 4343 492c 206d 6178 4343 4929 3a0a  inCCI, maxCCI):.
+0001c2d0: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+0001c2e0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+0001c2f0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0001c300: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0001c310: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0001c320: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0001c330: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+0001c340: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
+0001c350: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+0001c360: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+0001c370: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
+0001c380: 2063 6369 203d 2069 6e74 2864 6174 612e   cci = int(data.
+0001c390: 6865 6164 2831 295b 2243 4349 225d 2e69  head(1)["CCI"].i
+0001c3a0: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
+0001c3b0: 7361 7665 4469 6374 5b22 4343 4922 5d20  saveDict["CCI"] 
+0001c3c0: 3d20 6363 690a 2020 2020 2020 2020 6966  = cci.        if
+0001c3d0: 2028 6363 6920 3e3d 206d 696e 4343 4920   (cci >= minCCI 
+0001c3e0: 616e 6420 6363 6920 3c3d 206d 6178 4343  and cci <= maxCC
+0001c3f0: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
+0001c400: 6966 2028 2255 7022 2069 6e20 7361 7665  if ("Up" in save
+0001c410: 4469 6374 5b22 5472 656e 6422 5d29 3a0a  Dict["Trend"]):.
+0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c430: 7363 7265 656e 4469 6374 5b22 4343 4922  screenDict["CCI"
+0001c440: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+0001c450: 2020 2020 2020 2020 2020 2863 6f6c 6f72            (color
+0001c460: 5465 7874 2e42 4f4c 4420 6966 2028 2253  Text.BOLD if ("S
+0001c470: 7472 6f6e 6722 2069 6e20 7361 7665 4469  trong" in saveDi
+0001c480: 6374 5b22 5472 656e 6422 5d29 2065 6c73  ct["Trend"]) els
+0001c490: 6520 2222 2920 2b20 636f 6c6f 7254 6578  e "") + colorTex
+0001c4a0: 742e 4752 4545 4e20 2b20 7374 7228 6363  t.GREEN + str(cc
+0001c4b0: 6929 202b 2063 6f6c 6f72 5465 7874 2e45  i) + colorText.E
+0001c4c0: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001c4d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001c4e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001c4f0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0001c500: 745b 2243 4349 225d 203d 2028 0a20 2020  t["CCI"] = (.   
+0001c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c520: 2028 636f 6c6f 7254 6578 742e 424f 4c44   (colorText.BOLD
+0001c530: 2069 6620 2822 5374 726f 6e67 2220 696e   if ("Strong" in
+0001c540: 2073 6176 6544 6963 745b 2254 7265 6e64   saveDict["Trend
+0001c550: 225d 2920 656c 7365 2022 2229 202b 2063  "]) else "") + c
+0001c560: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
+0001c570: 7374 7228 6363 6929 202b 2063 6f6c 6f72  str(cci) + color
+0001c580: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0001c590: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001c5a0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001c5b0: 7565 0a20 2020 2020 2020 2073 6372 6565  ue.        scree
+0001c5c0: 6e44 6963 745b 2243 4349 225d 203d 2063  nDict["CCI"] = c
+0001c5d0: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+0001c5e0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+0001c5f0: 2073 7472 2863 6369 2920 2b20 636f 6c6f   str(cci) + colo
+0001c600: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
+0001c610: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+0001c620: 2020 2020 2320 4669 6e64 2043 6f6e 666c      # Find Confl
+0001c630: 7563 656e 6365 0a20 2020 2064 6566 2076  ucence.    def v
+0001c640: 616c 6964 6174 6543 6f6e 666c 7565 6e63  alidateConfluenc
+0001c650: 6528 7365 6c66 2c20 7374 6f63 6b2c 2064  e(self, stock, d
+0001c660: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+0001c670: 6176 6544 6963 742c 2070 6572 6365 6e74  aveDict, percent
+0001c680: 6167 653d 302e 312c 636f 6e66 4669 6c74  age=0.1,confFilt
+0001c690: 6572 3d33 293a 0a20 2020 2020 2020 2069  er=3):.        i
+0001c6a0: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+0001c6b0: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+0001c6c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001c6d0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+0001c6e0: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+0001c6f0: 2020 2020 2020 2020 7265 6365 6e74 203d          recent =
+0001c700: 2064 6174 612e 6865 6164 2832 290a 2020   data.head(2).  
+0001c710: 2020 2020 2020 6966 206c 656e 2872 6563        if len(rec
+0001c720: 656e 7429 203c 2032 3a0a 2020 2020 2020  ent) < 2:.      
+0001c730: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001c740: 7365 0a20 2020 2020 2020 206b 6579 3120  se.        key1 
+0001c750: 3d20 2253 4d41 220a 2020 2020 2020 2020  = "SMA".        
+0001c760: 6b65 7932 203d 2022 4c4d 4122 0a20 2020  key2 = "LMA".   
+0001c770: 2020 2020 206b 6579 3320 3d20 2235 3044       key3 = "50D
+0001c780: 4d41 220a 2020 2020 2020 2020 6b65 7934  MA".        key4
+0001c790: 203d 2022 3230 3044 4d41 220a 2020 2020   = "200DMA".    
+0001c7a0: 2020 2020 6973 3230 444d 4143 726f 7373      is20DMACross
+0001c7b0: 6f76 6572 3530 444d 4120 3d20 2872 6563  over50DMA = (rec
+0001c7c0: 656e 745b 2253 534d 4132 3022 5d2e 696c  ent["SSMA20"].il
+0001c7d0: 6f63 5b30 5d20 3e3d 2072 6563 656e 745b  oc[0] >= recent[
+0001c7e0: 2253 4d41 225d 2e69 6c6f 635b 305d 2920  "SMA"].iloc[0]) 
+0001c7f0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
+0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c810: 2020 2872 6563 656e 745b 2253 534d 4132    (recent["SSMA2
+0001c820: 3022 5d2e 696c 6f63 5b31 5d20 3c3d 2072  0"].iloc[1] <= r
+0001c830: 6563 656e 745b 2253 4d41 225d 2e69 6c6f  ecent["SMA"].ilo
+0001c840: 635b 315d 290a 2020 2020 2020 2020 6973  c[1]).        is
+0001c850: 3530 444d 4143 726f 7373 6f76 6572 3230  50DMACrossover20
+0001c860: 3044 4d41 203d 2028 7265 6365 6e74 5b22  0DMA = (recent["
+0001c870: 534d 4122 5d2e 696c 6f63 5b30 5d20 3e3d  SMA"].iloc[0] >=
+0001c880: 2072 6563 656e 745b 224c 4d41 225d 2e69   recent["LMA"].i
+0001c890: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2020 2020 2020 2020 2020 2872 6563 656e            (recen
+0001c8c0: 745b 2253 4d41 225d 2e69 6c6f 635b 315d  t["SMA"].iloc[1]
+0001c8d0: 203c 3d20 7265 6365 6e74 5b22 4c4d 4122   <= recent["LMA"
+0001c8e0: 5d2e 696c 6f63 5b31 5d29 0a20 2020 2020  ].iloc[1]).     
+0001c8f0: 2020 2069 7347 6f6c 6465 6e43 726f 7373     isGoldenCross
+0001c900: 4f76 6572 203d 2069 7332 3044 4d41 4372  Over = is20DMACr
+0001c910: 6f73 736f 7665 7235 3044 4d41 206f 7220  ossover50DMA or 
+0001c920: 6973 3530 444d 4143 726f 7373 6f76 6572  is50DMACrossover
+0001c930: 3230 3044 4d41 0a20 2020 2020 2020 2069  200DMA.        i
+0001c940: 7335 3044 4d41 4372 6f73 736f 7665 7232  s50DMACrossover2
+0001c950: 3030 444d 4144 6f77 6e20 3d20 2872 6563  00DMADown = (rec
+0001c960: 656e 745b 2253 4d41 225d 2e69 6c6f 635b  ent["SMA"].iloc[
+0001c970: 305d 203c 3d20 7265 6365 6e74 5b22 4c4d  0] <= recent["LM
+0001c980: 4122 5d2e 696c 6f63 5b30 5d29 2061 6e64  A"].iloc[0]) and
+0001c990: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001c9b0: 7265 6365 6e74 5b22 534d 4122 5d2e 696c  recent["SMA"].il
+0001c9c0: 6f63 5b31 5d20 3e3d 2072 6563 656e 745b  oc[1] >= recent[
+0001c9d0: 224c 4d41 225d 2e69 6c6f 635b 315d 290a  "LMA"].iloc[1]).
+0001c9e0: 2020 2020 2020 2020 6973 3230 444d 4143          is20DMAC
+0001c9f0: 726f 7373 6f76 6572 3530 444d 4144 6f77  rossover50DMADow
+0001ca00: 6e20 3d20 2872 6563 656e 745b 2253 534d  n = (recent["SSM
+0001ca10: 4132 3022 5d2e 696c 6f63 5b30 5d20 3c3d  A20"].iloc[0] <=
+0001ca20: 2072 6563 656e 745b 2253 4d41 225d 2e69   recent["SMA"].i
+0001ca30: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
+0001ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca50: 2020 2020 2020 2020 2020 2872 6563 656e            (recen
+0001ca60: 745b 2253 534d 4132 3022 5d2e 696c 6f63  t["SSMA20"].iloc
+0001ca70: 5b31 5d20 3e3d 2072 6563 656e 745b 2253  [1] >= recent["S
+0001ca80: 4d41 225d 2e69 6c6f 635b 315d 290a 2020  MA"].iloc[1]).  
+0001ca90: 2020 2020 2020 6973 4465 6164 4372 6f73        isDeadCros
+0001caa0: 734f 7665 7220 3d20 6973 3230 444d 4143  sOver = is20DMAC
+0001cab0: 726f 7373 6f76 6572 3530 444d 4144 6f77  rossover50DMADow
+0001cac0: 6e20 6f72 2069 7335 3044 4d41 4372 6f73  n or is50DMACros
+0001cad0: 736f 7665 7232 3030 444d 4144 6f77 6e0a  sover200DMADown.
+0001cae0: 2020 2020 2020 2020 6465 6164 784f 7665          deadxOve
+0001caf0: 7254 6578 7420 3d20 6627 4465 6164 4372  rText = f'DeadCr
+0001cb00: 6f73 736f 7665 727b 2228 3230 2922 2069  ossover{"(20)" i
+0001cb10: 6620 6973 3230 444d 4143 726f 7373 6f76  f is20DMACrossov
+0001cb20: 6572 3530 444d 4144 6f77 6e20 656c 7365  er50DMADown else
+0001cb30: 2028 2228 3530 2922 2069 6620 6973 3530   ("(50)" if is50
+0001cb40: 444d 4143 726f 7373 6f76 6572 3230 3044  DMACrossover200D
+0001cb50: 4d41 446f 776e 2065 6c73 6520 2222 297d  MADown else "")}
+0001cb60: 270a 2020 2020 2020 2020 676f 6c64 656e  '.        golden
+0001cb70: 784f 7665 7254 6578 7420 3d20 6627 476f  xOverText = f'Go
+0001cb80: 6c64 656e 4372 6f73 736f 7665 727b 2228  ldenCrossover{"(
+0001cb90: 3230 2922 2069 6620 6973 3230 444d 4143  20)" if is20DMAC
+0001cba0: 726f 7373 6f76 6572 3530 444d 4120 656c  rossover50DMA el
+0001cbb0: 7365 2028 2228 3530 2922 2069 6620 6973  se ("(50)" if is
+0001cbc0: 3530 444d 4143 726f 7373 6f76 6572 3230  50DMACrossover20
+0001cbd0: 3044 4d41 2065 6c73 6520 2222 297d 270a  0DMA else "")}'.
+0001cbe0: 2020 2020 2020 2020 6966 2069 7332 3044          if is20D
+0001cbf0: 4d41 4372 6f73 736f 7665 7235 3044 4d41  MACrossover50DMA
+0001cc00: 206f 7220 6973 3230 444d 4143 726f 7373   or is20DMACross
+0001cc10: 6f76 6572 3530 444d 4144 6f77 6e3a 0a20  over50DMADown:. 
+0001cc20: 2020 2020 2020 2020 2020 206b 6579 3120             key1 
+0001cc30: 3d20 2253 534d 4132 3022 0a20 2020 2020  = "SSMA20".     
+0001cc40: 2020 2020 2020 206b 6579 3220 3d20 2253         key2 = "S
+0001cc50: 4d41 220a 2020 2020 2020 2020 2020 2020  MA".            
+0001cc60: 6b65 7933 203d 2022 3230 444d 4122 0a20  key3 = "20DMA". 
+0001cc70: 2020 2020 2020 2020 2020 206b 6579 3420             key4 
+0001cc80: 3d20 2235 3044 4d41 220a 2020 2020 2020  = "50DMA".      
+0001cc90: 2020 6973 3530 444d 4155 7054 7265 6e64    is50DMAUpTrend
+0001cca0: 203d 2028 7265 6365 6e74 5b6b 6579 315d   = (recent[key1]
+0001ccb0: 2e69 6c6f 635b 305d 203e 2072 6563 656e  .iloc[0] > recen
+0001ccc0: 745b 6b65 7932 5d2e 696c 6f63 5b31 5d29  t[key2].iloc[1])
+0001ccd0: 0a20 2020 2020 2020 2069 7335 3044 4d41  .        is50DMA
+0001cce0: 446f 776e 5472 656e 6420 3d20 2872 6563  DownTrend = (rec
+0001ccf0: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
+0001cd00: 5d20 3c20 7265 6365 6e74 5b6b 6579 315d  ] < recent[key1]
+0001cd10: 2e69 6c6f 635b 315d 290a 2020 2020 2020  .iloc[1]).      
+0001cd20: 2020 6973 3530 444d 4120 3d20 2872 6563    is50DMA = (rec
+0001cd30: 656e 745b 6b65 7931 5d2e 696c 6f63 5b30  ent[key1].iloc[0
+0001cd40: 5d20 3c3d 2072 6563 656e 745b 2243 6c6f  ] <= recent["Clo
+0001cd50: 7365 225d 2e69 6c6f 635b 305d 290a 2020  se"].iloc[0]).  
+0001cd60: 2020 2020 2020 6973 3230 3044 4d41 203d        is200DMA =
+0001cd70: 2028 7265 6365 6e74 5b6b 6579 325d 2e69   (recent[key2].i
+0001cd80: 6c6f 635b 305d 203c 3d20 7265 6365 6e74  loc[0] <= recent
+0001cd90: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0001cda0: 5d29 0a20 2020 2020 2020 2064 6966 6665  ]).        diffe
+0001cdb0: 7265 6e63 6520 3d20 726f 756e 6428 2872  rence = round((r
+0001cdc0: 6563 656e 745b 6b65 7931 5d2e 696c 6f63  ecent[key1].iloc
+0001cdd0: 5b30 5d20 2d20 7265 6365 6e74 5b6b 6579  [0] - recent[key
+0001cde0: 325d 2e69 6c6f 635b 305d 290a 2020 2020  2].iloc[0]).    
+0001cdf0: 2020 2020 2020 2020 2020 2020 2f20 7265              / re
+0001ce00: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+0001ce10: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
+0001ce20: 2020 2020 2020 2a20 3130 302c 0a20 2020        * 100,.   
+0001ce30: 2020 2020 2020 2020 2020 2020 2032 2c0a               2,.
+0001ce40: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001ce50: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+0001ce60: 436f 6e66 444d 4144 6966 6665 7265 6e63  ConfDMADifferenc
+0001ce70: 6522 5d20 3d20 6469 6666 6572 656e 6365  e"] = difference
+0001ce80: 0a20 2020 2020 2020 2073 6372 6565 6e44  .        screenD
+0001ce90: 6963 745b 2243 6f6e 6644 4d41 4469 6666  ict["ConfDMADiff
+0001cea0: 6572 656e 6365 225d 203d 2064 6966 6665  erence"] = diffe
+0001ceb0: 7265 6e63 650a 2020 2020 2020 2020 7361  rence.        sa
+0001cec0: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+0001ced0: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+0001cee0: 2873 6372 6565 6e44 6963 742c 7361 7665  (screenDict,save
+0001cef0: 4469 6374 2c22 4d41 2d53 6967 6e61 6c22  Dict,"MA-Signal"
+0001cf00: 290a 2020 2020 2020 2020 2320 6469 6666  ).        # diff
+0001cf10: 6572 656e 6365 203d 2061 6273 2864 6966  erence = abs(dif
+0001cf20: 6665 7265 6e63 6529 0a20 2020 2020 2020  ference).       
+0001cf30: 2063 6f6e 6654 6578 7420 3d20 6622 7b67   confText = f"{g
+0001cf40: 6f6c 6465 6e78 4f76 6572 5465 7874 2069  oldenxOverText i
+0001cf50: 6620 6973 476f 6c64 656e 4372 6f73 734f  f isGoldenCrossO
+0001cf60: 7665 7220 656c 7365 2028 6465 6164 784f  ver else (deadxO
+0001cf70: 7665 7254 6578 7420 6966 2069 7344 6561  verText if isDea
+0001cf80: 6443 726f 7373 4f76 6572 2065 6c73 6520  dCrossOver else 
+0001cf90: 2827 436f 6e66 2e55 7027 2069 6620 6973  ('Conf.Up' if is
+0001cfa0: 3530 444d 4155 7054 7265 6e64 2065 6c73  50DMAUpTrend els
+0001cfb0: 6520 2827 436f 6e66 2e44 6f77 6e27 2069  e ('Conf.Down' i
+0001cfc0: 6620 6973 3530 444d 4144 6f77 6e54 7265  f is50DMADownTre
+0001cfd0: 6e64 2065 6c73 6520 286b 6579 3320 6966  nd else (key3 if
+0001cfe0: 2069 7335 3044 4d41 2065 6c73 6520 286b   is50DMA else (k
+0001cff0: 6579 3420 6966 2069 7332 3030 444d 4120  ey4 if is200DMA 
+0001d000: 656c 7365 2027 556e 6b6e 6f77 6e27 2929  else 'Unknown'))
+0001d010: 2929 297d 220a 2020 2020 2020 2020 6966  )))}".        if
+0001d020: 2061 6273 2872 6563 656e 745b 6b65 7931   abs(recent[key1
+0001d030: 5d2e 696c 6f63 5b30 5d20 2d20 7265 6365  ].iloc[0] - rece
+0001d040: 6e74 5b6b 6579 325d 2e69 6c6f 635b 305d  nt[key2].iloc[0]
+0001d050: 2920 3c3d 2028 0a20 2020 2020 2020 2020  ) <= (.         
+0001d060: 2020 2072 6563 656e 745b 6b65 7931 5d2e     recent[key1].
+0001d070: 696c 6f63 5b30 5d20 2a20 7065 7263 656e  iloc[0] * percen
+0001d080: 7461 6765 0a20 2020 2020 2020 2029 3a0a  tage.        ):.
+0001d090: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0001d0a0: 6563 656e 745b 6b65 7931 5d2e 696c 6f63  ecent[key1].iloc
+0001d0b0: 5b30 5d20 3e3d 2072 6563 656e 745b 6b65  [0] >= recent[ke
+0001d0c0: 7932 5d2e 696c 6f63 5b30 5d3a 0a20 2020  y2].iloc[0]:.   
+0001d0d0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0001d0e0: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
+0001d0f0: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
+0001d100: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+0001d110: 6564 5b30 5d20 0a20 2020 2020 2020 2020  ed[0] .         
+0001d120: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+0001d130: 6f72 5465 7874 2e42 4f4c 440a 2020 2020  orText.BOLD.    
+0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d150: 2b20 2863 6f6c 6f72 5465 7874 2e47 5245  + (colorText.GRE
+0001d160: 454e 2069 6620 6973 3530 444d 4155 7054  EN if is50DMAUpT
+0001d170: 7265 6e64 2065 6c73 6520 2863 6f6c 6f72  rend else (color
+0001d180: 5465 7874 2e46 4149 4c20 6966 2069 7335  Text.FAIL if is5
+0001d190: 3044 4d41 446f 776e 5472 656e 6420 656c  0DMADownTrend el
+0001d1a0: 7365 2063 6f6c 6f72 5465 7874 2e57 4152  se colorText.WAR
+0001d1b0: 4e29 290a 2020 2020 2020 2020 2020 2020  N)).            
+0001d1c0: 2020 2020 2020 2020 2b20 6622 7b63 6f6e          + f"{con
+0001d1d0: 6654 6578 747d 2028 7b64 6966 6665 7265  fText} ({differe
+0001d1e0: 6e63 657d 2529 220a 2020 2020 2020 2020  nce}%)".        
+0001d1f0: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001d200: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+0001d210: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001d220: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0001d230: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+0001d240: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
+0001d250: 2066 227b 636f 6e66 5465 7874 7d20 287b   f"{confText} ({
+0001d260: 6469 6666 6572 656e 6365 7d25 2922 0a20  difference}%)". 
+0001d270: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001d280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d290: 2073 6372 6565 6e44 6963 745b 224d 412d   screenDict["MA-
+0001d2a0: 5369 676e 616c 225d 203d 2028 0a20 2020  Signal"] = (.   
+0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2c0: 2073 6176 6564 5b30 5d20 0a20 2020 2020   saved[0] .     
+0001d2d0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001d2e0: 2063 6f6c 6f72 5465 7874 2e42 4f4c 440a   colorText.BOLD.
+0001d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d300: 2020 2020 2b20 2863 6f6c 6f72 5465 7874      + (colorText
+0001d310: 2e47 5245 454e 2069 6620 6973 3530 444d  .GREEN if is50DM
+0001d320: 4155 7054 7265 6e64 2065 6c73 6520 2863  AUpTrend else (c
+0001d330: 6f6c 6f72 5465 7874 2e46 4149 4c20 6966  olorText.FAIL if
+0001d340: 2069 7335 3044 4d41 446f 776e 5472 656e   is50DMADownTren
+0001d350: 6420 656c 7365 2063 6f6c 6f72 5465 7874  d else colorText
+0001d360: 2e57 4152 4e29 290a 2020 2020 2020 2020  .WARN)).        
+0001d370: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+0001d380: 7b63 6f6e 6654 6578 747d 2028 7b64 6966  {confText} ({dif
+0001d390: 6665 7265 6e63 657d 2529 220a 2020 2020  ference}%)".    
+0001d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3b0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+0001d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d3e0: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
+0001d3f0: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
+0001d400: 315d 202b 2066 227b 636f 6e66 5465 7874  1] + f"{confText
+0001d410: 7d20 287b 6469 6666 6572 656e 6365 7d25  } ({difference}%
+0001d420: 2922 0a20 2020 2020 2020 2020 2020 2072  )".            r
+0001d430: 6574 7572 6e20 636f 6e66 4669 6c74 6572  eturn confFilter
+0001d440: 203d 3d20 3320 6f72 205c 0a20 2020 2020   == 3 or \.     
+0001d450: 2020 2020 2020 2020 2020 2028 636f 6e66             (conf
+0001d460: 4669 6c74 6572 203d 3d20 3120 616e 6420  Filter == 1 and 
+0001d470: 6e6f 7420 6973 4465 6164 4372 6f73 734f  not isDeadCrossO
+0001d480: 7665 7220 616e 6420 2869 7335 3044 4d41  ver and (is50DMA
+0001d490: 5570 5472 656e 6420 6f72 2028 6973 476f  UpTrend or (isGo
+0001d4a0: 6c64 656e 4372 6f73 734f 7665 7220 6f72  ldenCrossOver or
+0001d4b0: 2027 5570 2720 696e 2063 6f6e 6654 6578   'Up' in confTex
+0001d4c0: 7429 2929 206f 7220 5c0a 2020 2020 2020  t))) or \.      
+0001d4d0: 2020 2020 2020 2020 2020 2863 6f6e 6646            (confF
+0001d4e0: 696c 7465 7220 3d3d 2032 2061 6e64 206e  ilter == 2 and n
+0001d4f0: 6f74 2069 7347 6f6c 6465 6e43 726f 7373  ot isGoldenCross
+0001d500: 4f76 6572 2061 6e64 2028 6973 3530 444d  Over and (is50DM
+0001d510: 4144 6f77 6e54 7265 6e64 206f 7220 6973  ADownTrend or is
+0001d520: 4465 6164 4372 6f73 734f 7665 7220 6f72  DeadCrossOver or
+0001d530: 2027 446f 776e 2720 696e 2063 6f6e 6654   'Down' in confT
+0001d540: 6578 7429 290a 2020 2020 2020 2020 2320  ext)).        # 
+0001d550: 4d61 7962 6520 7468 6520 6469 6666 6572  Maybe the differ
+0001d560: 656e 6365 2069 7320 6e6f 7420 7769 7468  ence is not with
+0001d570: 696e 2074 6865 2072 616e 6765 2c20 6275  in the range, bu
+0001d580: 7420 7765 2764 2073 7469 6c6c 206c 696b  t we'd still lik
+0001d590: 6520 746f 206b 6565 7020 7468 6520 7374  e to keep the st
+0001d5a0: 6f63 6b20 696e 0a20 2020 2020 2020 2023  ock in.        #
+0001d5b0: 2074 6865 206c 6973 7420 6966 2069 7427   the list if it'
+0001d5c0: 7320 6120 676f 6c64 656e 2063 726f 7373  s a golden cross
+0001d5d0: 6f76 6572 206f 7220 6465 6164 2063 726f  over or dead cro
+0001d5e0: 7373 6f76 6572 0a20 2020 2020 2020 2069  ssover.        i
+0001d5f0: 6620 6973 476f 6c64 656e 4372 6f73 734f  f isGoldenCrossO
+0001d600: 7665 7220 6f72 2069 7344 6561 6443 726f  ver or isDeadCro
+0001d610: 7373 4f76 6572 3a0a 2020 2020 2020 2020  ssOver:.        
+0001d620: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+0001d630: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d650: 2020 2020 7361 7665 645b 305d 200a 2020      saved[0] .  
+0001d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d670: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+0001d680: 4c44 0a20 2020 2020 2020 2020 2020 2020  LD.             
+0001d690: 2020 2020 2020 202b 2028 636f 6c6f 7254         + (colorT
+0001d6a0: 6578 742e 4752 4545 4e20 6966 2069 7335  ext.GREEN if is5
+0001d6b0: 3044 4d41 5570 5472 656e 6420 656c 7365  0DMAUpTrend else
+0001d6c0: 2028 636f 6c6f 7254 6578 742e 4641 494c   (colorText.FAIL
+0001d6d0: 2069 6620 6973 3530 444d 4144 6f77 6e54   if is50DMADownT
+0001d6e0: 7265 6e64 2065 6c73 6520 636f 6c6f 7254  rend else colorT
+0001d6f0: 6578 742e 5741 524e 2929 0a20 2020 2020  ext.WARN)).     
+0001d700: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001d710: 2066 227b 636f 6e66 5465 7874 7d20 287b   f"{confText} ({
+0001d720: 6469 6666 6572 656e 6365 7d25 2922 0a20  difference}%)". 
+0001d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d740: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
+0001d750: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001d760: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001d770: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
+0001d780: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
+0001d790: 5d20 2b20 6622 7b63 6f6e 6654 6578 747d  ] + f"{confText}
+0001d7a0: 2028 7b64 6966 6665 7265 6e63 657d 2529   ({difference}%)
+0001d7b0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
+0001d7c0: 7475 726e 2063 6f6e 6646 696c 7465 7220  turn confFilter 
+0001d7d0: 3d3d 2033 206f 7220 5c0a 2020 2020 2020  == 3 or \.      
+0001d7e0: 2020 2020 2020 2020 2020 2863 6f6e 6646            (confF
+0001d7f0: 696c 7465 7220 3d3d 2031 2061 6e64 2069  ilter == 1 and i
+0001d800: 7347 6f6c 6465 6e43 726f 7373 4f76 6572  sGoldenCrossOver
+0001d810: 2920 6f72 205c 0a20 2020 2020 2020 2020  ) or \.         
+0001d820: 2020 2020 2020 2028 636f 6e66 4669 6c74         (confFilt
+0001d830: 6572 203d 3d20 3220 616e 6420 6973 4465  er == 2 and isDe
+0001d840: 6164 4372 6f73 734f 7665 7229 0a20 2020  adCrossOver).   
+0001d850: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001d860: 650a 0a20 2020 2023 406d 6561 7375 7265  e..    #@measure
+0001d870: 5f74 696d 650a 2020 2020 2320 5661 6c69  _time.    # Vali
+0001d880: 6461 7465 2069 6620 7368 6172 6520 7072  date if share pr
+0001d890: 6963 6573 2061 7265 2063 6f6e 736f 6c69  ices are consoli
+0001d8a0: 6461 7469 6e67 0a20 2020 2064 6566 2076  dating.    def v
+0001d8b0: 616c 6964 6174 6543 6f6e 736f 6c69 6461  alidateConsolida
+0001d8c0: 7469 6f6e 2873 656c 662c 2064 662c 2073  tion(self, df, s
+0001d8d0: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+0001d8e0: 6963 742c 2070 6572 6365 6e74 6167 653d  ict, percentage=
+0001d8f0: 3130 293a 0a20 2020 2020 2020 2069 6620  10):.        if 
+0001d900: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+0001d910: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+0001d920: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001d930: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+0001d940: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+0001d950: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+0001d960: 612e 6669 6c6c 6e61 2830 290a 2020 2020  a.fillna(0).    
+0001d970: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
+0001d980: 7265 706c 6163 6528 5b6e 702e 696e 662c  replace([np.inf,
+0001d990: 202d 6e70 2e69 6e66 5d2c 2030 290a 2020   -np.inf], 0).  
+0001d9a0: 2020 2020 2020 6863 203d 2064 6174 612e        hc = data.
+0001d9b0: 6465 7363 7269 6265 2829 5b22 436c 6f73  describe()["Clos
+0001d9c0: 6522 5d5b 226d 6178 225d 0a20 2020 2020  e"]["max"].     
+0001d9d0: 2020 206c 6320 3d20 6461 7461 2e64 6573     lc = data.des
+0001d9e0: 6372 6962 6528 295b 2243 6c6f 7365 225d  cribe()["Close"]
+0001d9f0: 5b22 6d69 6e22 5d0a 2020 2020 2020 2020  ["min"].        
+0001da00: 6966 2028 6863 202d 206c 6329 203c 3d20  if (hc - lc) <= 
+0001da10: 2868 6320 2a20 7065 7263 656e 7461 6765  (hc * percentage
+0001da20: 202f 2031 3030 2920 616e 6420 2868 6320   / 100) and (hc 
+0001da30: 2d20 6c63 2021 3d20 3029 3a0a 2020 2020  - lc != 0):.    
+0001da40: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+0001da50: 6374 5b22 436f 6e73 6f6c 2e22 5d20 3d20  ct["Consol."] = 
+0001da60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001da70: 2020 636f 6c6f 7254 6578 742e 424f 4c44    colorText.BOLD
+0001da80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001da90: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
+0001daa0: 454e 0a20 2020 2020 2020 2020 2020 2020  EN.             
+0001dab0: 2020 202b 2022 5261 6e67 653a 220a 2020     + "Range:".  
+0001dac0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001dad0: 7374 7228 726f 756e 6428 2861 6273 2828  str(round((abs((
+0001dae0: 6863 202d 206c 6329 202f 2068 6329 202a  hc - lc) / hc) *
+0001daf0: 2031 3030 292c 2031 2929 0a20 2020 2020   100), 1)).     
+0001db00: 2020 2020 2020 2020 2020 202b 2022 2522             + "%"
+0001db10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001db20: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0001db30: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001db40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001db50: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+0001db60: 6963 745b 2243 6f6e 736f 6c2e 225d 203d  ict["Consol."] =
+0001db70: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001db80: 2020 2063 6f6c 6f72 5465 7874 2e42 4f4c     colorText.BOL
+0001db90: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001dba0: 2020 2b20 636f 6c6f 7254 6578 742e 4641    + colorText.FA
+0001dbb0: 494c 0a20 2020 2020 2020 2020 2020 2020  IL.             
+0001dbc0: 2020 202b 2022 5261 6e67 653a 220a 2020     + "Range:".  
+0001dbd0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001dbe0: 7374 7228 726f 756e 6428 2861 6273 2828  str(round((abs((
+0001dbf0: 6863 202d 206c 6329 202f 2068 6329 202a  hc - lc) / hc) *
+0001dc00: 2031 3030 292c 2031 2929 0a20 2020 2020   100), 1)).     
+0001dc10: 2020 2020 2020 2020 2020 202b 2022 2522             + "%"
+0001dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dc30: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
+0001dc40: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001dc50: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+0001dc60: 2243 6f6e 736f 6c2e 225d 203d 2066 2752  "Consol."] = f'R
+0001dc70: 616e 6765 3a7b 7374 7228 726f 756e 6428  ange:{str(round(
+0001dc80: 2861 6273 2828 6863 2d6c 6329 2f68 6329  (abs((hc-lc)/hc)
+0001dc90: 2a31 3030 292c 3129 292b 2225 227d 270a  *100),1))+"%"}'.
+0001dca0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0001dcb0: 6f75 6e64 2828 6162 7328 2868 6320 2d20  ound((abs((hc - 
+0001dcc0: 6c63 2920 2f20 6863 2920 2a20 3130 3029  lc) / hc) * 100)
+0001dcd0: 2c20 3129 0a0a 2020 2020 2320 7661 6c69  , 1)..    # vali
+0001dce0: 6461 7465 2069 6620 7468 6520 7374 6f63  date if the stoc
+0001dcf0: 6b20 6861 7320 6265 656e 2068 6176 696e  k has been havin
+0001dd00: 6720 6869 6768 6572 2068 6967 6873 2c20  g higher highs, 
+0001dd10: 6869 6768 6572 206c 6f77 730a 2020 2020  higher lows.    
+0001dd20: 2320 616e 6420 6869 6768 6572 2063 6c6f  # and higher clo
+0001dd30: 7365 2077 6974 6820 6c61 7465 7374 2063  se with latest c
+0001dd40: 6c6f 7365 203e 2073 7570 6572 7472 656e  lose > supertren
+0001dd50: 6420 616e 6420 382d 454d 412e 0a20 2020  d and 8-EMA..   
+0001dd60: 2064 6566 2076 616c 6964 6174 6548 6967   def validateHig
+0001dd70: 6865 7248 6967 6873 4869 6768 6572 4c6f  herHighsHigherLo
+0001dd80: 7773 4869 6768 6572 436c 6f73 6528 7365  wsHigherClose(se
+0001dd90: 6c66 2c20 6466 293a 0a20 2020 2020 2020  lf, df):.       
+0001dda0: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+0001ddb0: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+0001ddc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001ddd0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0001dde0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+0001ddf0: 290a 2020 2020 2020 2020 6461 7930 203d  ).        day0 =
+0001de00: 2064 6174 610a 2020 2020 2020 2020 6461   data.        da
+0001de10: 7931 203d 2064 6174 615b 313a 5d0a 2020  y1 = data[1:].  
+0001de20: 2020 2020 2020 6461 7932 203d 2064 6174        day2 = dat
+0001de30: 615b 323a 5d0a 2020 2020 2020 2020 6461  a[2:].        da
+0001de40: 7933 203d 2064 6174 615b 333a 5d0a 2020  y3 = data[3:].  
+0001de50: 2020 2020 2020 6966 206c 656e 2864 6179        if len(day
+0001de60: 3129 203c 2031 206f 7220 6c65 6e28 6461  1) < 1 or len(da
+0001de70: 7932 2920 3c20 3120 6f72 206c 656e 2864  y2) < 1 or len(d
+0001de80: 6179 3329 203c 2031 3a0a 2020 2020 2020  ay3) < 1:.      
+0001de90: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001dea0: 7365 0a20 2020 2020 2020 2068 6967 6865  se.        highe
+0001deb0: 7248 6967 6873 203d 2028 0a20 2020 2020  rHighs = (.     
+0001dec0: 2020 2020 2020 2028 6461 7930 5b22 4869         (day0["Hi
+0001ded0: 6768 225d 2e69 6c6f 635b 305d 203e 2064  gh"].iloc[0] > d
+0001dee0: 6179 315b 2248 6967 6822 5d2e 696c 6f63  ay1["High"].iloc
+0001def0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0001df00: 2061 6e64 2028 6461 7931 5b22 4869 6768   and (day1["High
+0001df10: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
+0001df20: 325b 2248 6967 6822 5d2e 696c 6f63 5b30  2["High"].iloc[0
+0001df30: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0001df40: 6e64 2028 6461 7932 5b22 4869 6768 225d  nd (day2["High"]
+0001df50: 2e69 6c6f 635b 305d 203e 2064 6179 335b  .iloc[0] > day3[
+0001df60: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
+0001df70: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001df80: 2020 2068 6967 6865 724c 6f77 7320 3d20     higherLows = 
+0001df90: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
+0001dfa0: 6179 305b 224c 6f77 225d 2e69 6c6f 635b  ay0["Low"].iloc[
+0001dfb0: 305d 203e 2064 6179 315b 224c 6f77 225d  0] > day1["Low"]
+0001dfc0: 2e69 6c6f 635b 305d 290a 2020 2020 2020  .iloc[0]).      
+0001dfd0: 2020 2020 2020 616e 6420 2864 6179 315b        and (day1[
+0001dfe0: 224c 6f77 225d 2e69 6c6f 635b 305d 203e  "Low"].iloc[0] >
+0001dff0: 2064 6179 325b 224c 6f77 225d 2e69 6c6f   day2["Low"].ilo
+0001e000: 635b 305d 290a 2020 2020 2020 2020 2020  c[0]).          
+0001e010: 2020 616e 6420 2864 6179 325b 224c 6f77    and (day2["Low
+0001e020: 225d 2e69 6c6f 635b 305d 203e 2064 6179  "].iloc[0] > day
+0001e030: 335b 224c 6f77 225d 2e69 6c6f 635b 305d  3["Low"].iloc[0]
+0001e040: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0001e050: 2020 2020 6869 6768 6572 436c 6f73 6520      higherClose 
+0001e060: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0001e070: 2864 6179 305b 2243 6c6f 7365 225d 2e69  (day0["Close"].i
+0001e080: 6c6f 635b 305d 203e 2064 6179 315b 2243  loc[0] > day1["C
+0001e090: 6c6f 7365 225d 2e69 6c6f 635b 305d 290a  lose"].iloc[0]).
+0001e0a0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001e0b0: 2864 6179 315b 2243 6c6f 7365 225d 2e69  (day1["Close"].i
+0001e0c0: 6c6f 635b 305d 203e 2064 6179 325b 2243  loc[0] > day2["C
+0001e0d0: 6c6f 7365 225d 2e69 6c6f 635b 305d 290a  lose"].iloc[0]).
+0001e0e0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001e0f0: 2864 6179 325b 2243 6c6f 7365 225d 2e69  (day2["Close"].i
+0001e100: 6c6f 635b 305d 203e 2064 6179 335b 2243  loc[0] > day3["C
+0001e110: 6c6f 7365 225d 2e69 6c6f 635b 305d 290a  lose"].iloc[0]).
+0001e120: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001e130: 2020 2320 6869 6768 6572 5253 4920 3d20    # higherRSI = 
+0001e140: 2864 6179 305b 2252 5349 225d 2e69 6c6f  (day0["RSI"].ilo
+0001e150: 635b 305d 203e 2064 6179 315b 2252 5349  c[0] > day1["RSI
+0001e160: 225d 2e69 6c6f 635b 305d 2920 616e 6420  "].iloc[0]) and 
+0001e170: 5c0a 2020 2020 2020 2020 2320 2020 2020  \.        #     
+0001e180: 2020 2020 2020 2020 2020 2020 2864 6179              (day
+0001e190: 315b 2252 5349 225d 2e69 6c6f 635b 305d  1["RSI"].iloc[0]
+0001e1a0: 203e 2064 6179 325b 2252 5349 225d 2e69   > day2["RSI"].i
+0001e1b0: 6c6f 635b 305d 2920 616e 6420 5c0a 2020  loc[0]) and \.  
+0001e1c0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0001e1d0: 2020 2020 2020 2020 2864 6179 325b 2252          (day2["R
+0001e1e0: 5349 225d 2e69 6c6f 635b 305d 203e 2064  SI"].iloc[0] > d
+0001e1f0: 6179 335b 2252 5349 225d 2e69 6c6f 635b  ay3["RSI"].iloc[
+0001e200: 305d 2920 616e 6420 5c0a 2020 2020 2020  0]) and \.      
+0001e210: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0001e220: 2020 2020 6461 7933 5b22 5253 4922 5d2e      day3["RSI"].
+0001e230: 696c 6f63 5b30 5d20 3e3d 2035 3020 616e  iloc[0] >= 50 an
+0001e240: 6420 6461 7930 5b22 5253 4922 5d2e 696c  d day0["RSI"].il
+0001e250: 6f63 5b30 5d20 3e3d 2036 350a 2020 2020  oc[0] >= 65.    
+0001e260: 2020 2020 7265 7665 7273 6564 4461 7461      reversedData
+0001e270: 203d 2064 6174 615b 3a3a 2d31 5d2e 636f   = data[::-1].co
+0001e280: 7079 2829 0a20 2020 2020 2020 2072 6576  py().        rev
+0001e290: 6572 7365 6444 6174 615b 2253 5550 4552  ersedData["SUPER
+0001e2a0: 5422 5d20 3d20 706b 7461 6c69 622e 7375  T"] = pktalib.su
+0001e2b0: 7065 7274 7265 6e64 2872 6576 6572 7365  pertrend(reverse
+0001e2c0: 6444 6174 612c 2037 2c20 3329 5b22 5355  dData, 7, 3)["SU
+0001e2d0: 5045 5254 5f37 5f33 2e30 225d 0a20 2020  PERT_7_3.0"].   
+0001e2e0: 2020 2020 2072 6576 6572 7365 6444 6174       reversedDat
+0001e2f0: 615b 2245 4d41 3822 5d20 3d20 706b 7461  a["EMA8"] = pkta
+0001e300: 6c69 622e 454d 4128 7265 7665 7273 6564  lib.EMA(reversed
+0001e310: 4461 7461 5b22 436c 6f73 6522 5d2c 2074  Data["Close"], t
+0001e320: 696d 6570 6572 696f 643d 3929 0a20 2020  imeperiod=9).   
+0001e330: 2020 2020 2068 6967 6865 7243 6c6f 7365       higherClose
+0001e340: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+0001e350: 2068 6967 6865 7243 6c6f 7365 0a20 2020   higherClose.   
+0001e360: 2020 2020 2020 2020 2061 6e64 2064 6179           and day
+0001e370: 305b 2243 6c6f 7365 225d 2e69 6c6f 635b  0["Close"].iloc[
+0001e380: 305d 203e 2072 6576 6572 7365 6444 6174  0] > reversedDat
+0001e390: 612e 7461 696c 2831 295b 2253 5550 4552  a.tail(1)["SUPER
+0001e3a0: 5422 5d2e 696c 6f63 5b30 5d0a 2020 2020  T"].iloc[0].    
+0001e3b0: 2020 2020 2020 2020 616e 6420 6461 7930          and day0
+0001e3c0: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+0001e3d0: 5d20 3e20 7265 7665 7273 6564 4461 7461  ] > reversedData
+0001e3e0: 2e74 6169 6c28 3129 5b22 454d 4138 225d  .tail(1)["EMA8"]
+0001e3f0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+0001e400: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+0001e410: 6e20 6869 6768 6572 4869 6768 7320 616e  n higherHighs an
+0001e420: 6420 6869 6768 6572 4c6f 7773 2061 6e64  d higherLows and
+0001e430: 2068 6967 6865 7243 6c6f 7365 0a0a 2020   higherClose..  
+0001e440: 2020 2340 6d65 6173 7572 655f 7469 6d65    #@measure_time
+0001e450: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
+0001e460: 2749 6e73 6964 6520 4261 7227 2073 7472  'Inside Bar' str
+0001e470: 7563 7475 7265 2066 6f72 2072 6563 656e  ucture for recen
+0001e480: 7420 6461 7973 0a20 2020 2064 6566 2076  t days.    def v
+0001e490: 616c 6964 6174 6549 6e73 6964 6542 6172  alidateInsideBar
+0001e4a0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+0001e4b0: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
+0001e4c0: 7361 7665 4469 6374 2c20 6368 6172 7450  saveDict, chartP
+0001e4d0: 6174 7465 726e 3d31 2c20 6461 7973 546f  attern=1, daysTo
+0001e4e0: 4c6f 6f6b 6261 636b 3d35 0a20 2020 2029  Lookback=5.    )
+0001e4f0: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+0001e500: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+0001e510: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+0001e520: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001e530: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+0001e540: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+0001e550: 2020 206f 7267 4461 7461 203d 2064 6174     orgData = dat
+0001e560: 610a 2020 2020 2020 2020 7361 7665 6420  a.        saved 
+0001e570: 3d20 7365 6c66 2e66 696e 6443 7572 7265  = self.findCurre
+0001e580: 6e74 5361 7665 6456 616c 7565 2873 6372  ntSavedValue(scr
+0001e590: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+0001e5a0: 742c 2022 5061 7474 6572 6e22 290a 2020  t, "Pattern").  
+0001e5b0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+0001e5c0: 616e 6765 2869 6e74 2864 6179 7354 6f4c  ange(int(daysToL
+0001e5d0: 6f6f 6b62 6163 6b29 2c20 696e 7428 726f  ookback), int(ro
+0001e5e0: 756e 6428 6461 7973 546f 4c6f 6f6b 6261  und(daysToLookba
+0001e5f0: 636b 202a 2030 2e35 2929 202d 2031 2c20  ck * 0.5)) - 1, 
+0001e600: 2d31 293a 0a20 2020 2020 2020 2020 2020  -1):.           
+0001e610: 2069 6620 6920 3d3d 2032 3a0a 2020 2020   if i == 2:.    
+0001e620: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001e630: 726e 2030 2020 2320 4578 6974 2069 6620  rn 0  # Exit if 
+0001e640: 6f6e 6c79 206c 6173 7420 3220 6361 6e64  only last 2 cand
+0001e650: 6c65 7320 6172 6520 6c65 6674 0a20 2020  les are left.   
+0001e660: 2020 2020 2020 2020 2069 6620 6368 6172           if char
+0001e670: 7450 6174 7465 726e 203d 3d20 313a 0a20  tPattern == 1:. 
+0001e680: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001e690: 6620 2255 7022 2069 6e20 7361 7665 4469  f "Up" in saveDi
+0001e6a0: 6374 5b22 5472 656e 6422 5d20 616e 6420  ct["Trend"] and 
+0001e6b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001e6c0: 2020 2020 2020 2242 756c 6c22 2069 6e20        "Bull" in 
+0001e6d0: 7361 7665 4469 6374 5b22 4d41 2d53 6967  saveDict["MA-Sig
+0001e6e0: 6e61 6c22 5d0a 2020 2020 2020 2020 2020  nal"].          
+0001e6f0: 2020 2020 2020 2020 2020 6f72 2022 5375            or "Su
+0001e700: 7070 6f72 7422 2069 6e20 7361 7665 4469  pport" in saveDi
+0001e710: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d0a  ct["MA-Signal"].
+0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e730: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001e740: 2020 2020 2020 2064 6174 6120 3d20 6f72         data = or
+0001e750: 6744 6174 612e 6865 6164 2869 290a 2020  gData.head(i).  
 0001e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e770: 2072 6574 7572 6e20 690a 2020 2020 2020   return i.      
-0001e780: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7a0: 2020 2020 7265 7475 726e 2030 0a20 2020      return 0.   
-0001e7b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001e7c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001e7d0: 6620 2244 6f77 6e22 2069 6e20 7361 7665  f "Down" in save
-0001e7e0: 4469 6374 5b22 5472 656e 6422 5d20 616e  Dict["Trend"] an
-0001e7f0: 6420 280a 2020 2020 2020 2020 2020 2020  d (.            
-0001e800: 2020 2020 2020 2020 2242 6561 7222 2069          "Bear" i
-0001e810: 6e20 7361 7665 4469 6374 5b22 4d41 2d53  n saveDict["MA-S
-0001e820: 6967 6e61 6c22 5d20 6f72 2022 5265 7369  ignal"] or "Resi
-0001e830: 7374 2220 696e 2073 6176 6544 6963 745b  st" in saveDict[
-0001e840: 224d 412d 5369 676e 616c 225d 0a20 2020  "MA-Signal"].   
-0001e850: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-0001e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e870: 2020 2020 6461 7461 203d 206f 7267 4461      data = orgDa
-0001e880: 7461 2e68 6561 6428 6929 0a20 2020 2020  ta.head(i).     
-0001e890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001e8a0: 6566 4361 6e64 6c65 203d 2064 6174 612e  efCandle = data.
-0001e8b0: 7461 696c 2831 290a 2020 2020 2020 2020  tail(1).        
-0001e8c0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-0001e8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e8e0: 2020 2020 2020 2020 2028 6c65 6e28 6461           (len(da
-0001e8f0: 7461 2e48 6967 685b 6461 7461 2e48 6967  ta.High[data.Hig
-0001e900: 6820 3e20 7265 6643 616e 646c 652e 4869  h > refCandle.Hi
-0001e910: 6768 2e69 7465 6d28 295d 2920 3d3d 2030  gh.item()]) == 0
-0001e920: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e930: 2020 2020 2020 2020 2020 616e 6420 286c            and (l
-0001e940: 656e 2864 6174 612e 4c6f 775b 6461 7461  en(data.Low[data
-0001e950: 2e4c 6f77 203c 2072 6566 4361 6e64 6c65  .Low < refCandle
-0001e960: 2e4c 6f77 2e69 7465 6d28 295d 2920 3d3d  .Low.item()]) ==
-0001e970: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-0001e980: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0001e990: 286c 656e 2864 6174 612e 4f70 656e 5b64  (len(data.Open[d
-0001e9a0: 6174 612e 4f70 656e 203e 2072 6566 4361  ata.Open > refCa
-0001e9b0: 6e64 6c65 2e48 6967 682e 6974 656d 2829  ndle.High.item()
-0001e9c0: 5d29 203d 3d20 3029 0a20 2020 2020 2020  ]) == 0).       
-0001e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9e0: 2061 6e64 2028 6c65 6e28 6461 7461 2e43   and (len(data.C
-0001e9f0: 6c6f 7365 5b64 6174 612e 436c 6f73 6520  lose[data.Close 
-0001ea00: 3c20 7265 6643 616e 646c 652e 4c6f 772e  < refCandle.Low.
-0001ea10: 6974 656d 2829 5d29 203d 3d20 3029 0a20  item()]) == 0). 
+0001e770: 2020 7265 6643 616e 646c 6520 3d20 6461    refCandle = da
+0001e780: 7461 2e74 6169 6c28 3129 0a20 2020 2020  ta.tail(1).     
+0001e790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001e7a0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0001e7b0: 2020 2020 2020 2020 2020 2020 286c 656e              (len
+0001e7c0: 2864 6174 612e 4869 6768 5b64 6174 612e  (data.High[data.
+0001e7d0: 4869 6768 203e 2072 6566 4361 6e64 6c65  High > refCandle
+0001e7e0: 2e48 6967 682e 6974 656d 2829 5d29 203d  .High.item()]) =
+0001e7f0: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
+0001e800: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0001e810: 2028 6c65 6e28 6461 7461 2e4c 6f77 5b64   (len(data.Low[d
+0001e820: 6174 612e 4c6f 7720 3c20 7265 6643 616e  ata.Low < refCan
+0001e830: 646c 652e 4c6f 772e 6974 656d 2829 5d29  dle.Low.item()])
+0001e840: 203d 3d20 3029 0a20 2020 2020 2020 2020   == 0).         
+0001e850: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001e860: 6e64 2028 6c65 6e28 6461 7461 2e4f 7065  nd (len(data.Ope
+0001e870: 6e5b 6461 7461 2e4f 7065 6e20 3e20 7265  n[data.Open > re
+0001e880: 6643 616e 646c 652e 4869 6768 2e69 7465  fCandle.High.ite
+0001e890: 6d28 295d 2920 3d3d 2030 290a 2020 2020  m()]) == 0).    
+0001e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8b0: 2020 2020 616e 6420 286c 656e 2864 6174      and (len(dat
+0001e8c0: 612e 436c 6f73 655b 6461 7461 2e43 6c6f  a.Close[data.Clo
+0001e8d0: 7365 203c 2072 6566 4361 6e64 6c65 2e4c  se < refCandle.L
+0001e8e0: 6f77 2e69 7465 6d28 295d 2920 3d3d 2030  ow.item()]) == 0
+0001e8f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e900: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0001e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e920: 2073 6372 6565 6e44 6963 745b 2250 6174   screenDict["Pat
+0001e930: 7465 726e 225d 203d 2028 0a20 2020 2020  tern"] = (.     
+0001e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e950: 2020 2020 2020 2073 6176 6564 5b30 5d0a         saved[0].
+0001e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e970: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001e980: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
+0001e990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9a0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0001e9b0: 5465 7874 2e57 4152 4e0a 2020 2020 2020  Text.WARN.      
+0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9d0: 2020 2020 2020 2b20 2822 496e 7369 6465        + ("Inside
+0001e9e0: 2042 6172 2028 2564 2922 2025 2069 290a   Bar (%d)" % i).
+0001e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea00: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
+0001ea10: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
 0001ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea30: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0001ea40: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0001ea50: 7265 656e 4469 6374 5b22 5061 7474 6572  reenDict["Patter
-0001ea60: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
-0001ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea80: 2020 2020 7361 7665 645b 305d 0a20 2020      saved[0].   
-0001ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eaa0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0001eab0: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+0001ea30: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001ea40: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0001ea50: 7665 4469 6374 5b22 5061 7474 6572 6e22  veDict["Pattern"
+0001ea60: 5d20 3d20 7361 7665 645b 315d 202b 2022  ] = saved[1] + "
+0001ea70: 496e 7369 6465 2042 6172 2028 2564 2922  Inside Bar (%d)"
+0001ea80: 2025 2069 0a20 2020 2020 2020 2020 2020   % i.           
+0001ea90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001eaa0: 7572 6e20 690a 2020 2020 2020 2020 2020  urn i.          
+0001eab0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 0001eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ead0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-0001eae0: 742e 5741 524e 0a20 2020 2020 2020 2020  t.WARN.         
-0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb00: 2020 202b 2028 2249 6e73 6964 6520 4261     + ("Inside Ba
-0001eb10: 7220 2825 6429 2220 2520 6929 0a20 2020  r (%d)" % i).   
+0001ead0: 7265 7475 726e 2030 0a20 2020 2020 2020  return 0.       
+0001eae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001eaf0: 2020 2020 2020 2020 2020 2069 6620 2244             if "D
+0001eb00: 6f77 6e22 2069 6e20 7361 7665 4469 6374  own" in saveDict
+0001eb10: 5b22 5472 656e 6422 5d20 616e 6420 280a  ["Trend"] and (.
 0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb30: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0001eb40: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-0001eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb60: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0001eb70: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-0001eb80: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-0001eb90: 2073 6176 6564 5b31 5d20 2b20 2249 6e73   saved[1] + "Ins
-0001eba0: 6964 6520 4261 7220 2825 6429 2220 2520  ide Bar (%d)" % 
-0001ebb0: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
-0001ebc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001ebd0: 2069 0a20 2020 2020 2020 2020 2020 2020   i.             
-0001ebe0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001ebf0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001ec00: 7572 6e20 300a 2020 2020 2020 2020 7265  urn 0.        re
-0001ec10: 7475 726e 2030 0a0a 2020 2020 2320 4669  turn 0..    # Fi
-0001ec20: 6e64 2049 504f 2062 6173 650a 2020 2020  nd IPO base.    
-0001ec30: 6465 6620 7661 6c69 6461 7465 4970 6f42  def validateIpoB
-0001ec40: 6173 6528 7365 6c66 2c20 7374 6f63 6b2c  ase(self, stock,
-0001ec50: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
-0001ec60: 2073 6176 6544 6963 742c 2070 6572 6365   saveDict, perce
-0001ec70: 6e74 6167 653d 302e 3329 3a0a 2020 2020  ntage=0.3):.    
-0001ec80: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
-0001ec90: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
-0001eca0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
-0001ecb0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0001ecc0: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
-0001ecd0: 7079 2829 0a20 2020 2020 2020 206c 6973  py().        lis
-0001ece0: 7469 6e67 5072 6963 6520 3d20 6461 7461  tingPrice = data
-0001ecf0: 5b3a 3a2d 315d 2e68 6561 6428 3129 5b22  [::-1].head(1)["
-0001ed00: 4f70 656e 225d 2e69 6c6f 635b 305d 0a20  Open"].iloc[0]. 
-0001ed10: 2020 2020 2020 2063 7572 7265 6e74 5072         currentPr
-0001ed20: 6963 6520 3d20 6461 7461 2e68 6561 6428  ice = data.head(
-0001ed30: 3129 5b22 436c 6f73 6522 5d2e 696c 6f63  1)["Close"].iloc
-0001ed40: 5b30 5d0a 2020 2020 2020 2020 4154 4820  [0].        ATH 
-0001ed50: 3d20 6461 7461 2e64 6573 6372 6962 6528  = data.describe(
-0001ed60: 295b 2248 6967 6822 5d5b 226d 6178 225d  )["High"]["max"]
-0001ed70: 0a20 2020 2020 2020 2069 6620 4154 4820  .        if ATH 
-0001ed80: 3e20 286c 6973 7469 6e67 5072 6963 6520  > (listingPrice 
-0001ed90: 2b20 286c 6973 7469 6e67 5072 6963 6520  + (listingPrice 
-0001eda0: 2a20 7065 7263 656e 7461 6765 2929 3a0a  * percentage)):.
-0001edb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001edc0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001edd0: 2061 7761 7920 3d20 726f 756e 6428 2828   away = round(((
-0001ede0: 6375 7272 656e 7450 7269 6365 202d 206c  currentPrice - l
-0001edf0: 6973 7469 6e67 5072 6963 6529 202f 206c  istingPrice) / l
-0001ee00: 6973 7469 6e67 5072 6963 6529 202a 2031  istingPrice) * 1
-0001ee10: 3030 2c20 3129 0a20 2020 2020 2020 2069  00, 1).        i
-0001ee20: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-0001ee30: 286c 6973 7469 6e67 5072 6963 6520 2d20  (listingPrice - 
-0001ee40: 286c 6973 7469 6e67 5072 6963 6520 2a20  (listingPrice * 
-0001ee50: 7065 7263 656e 7461 6765 2929 0a20 2020  percentage)).   
-0001ee60: 2020 2020 2020 2020 203c 3d20 6375 7272           <= curr
-0001ee70: 656e 7450 7269 6365 0a20 2020 2020 2020  entPrice.       
-0001ee80: 2020 2020 203c 3d20 286c 6973 7469 6e67       <= (listing
-0001ee90: 5072 6963 6520 2b20 286c 6973 7469 6e67  Price + (listing
-0001eea0: 5072 6963 6520 2a20 7065 7263 656e 7461  Price * percenta
-0001eeb0: 6765 2929 0a20 2020 2020 2020 2029 3a0a  ge)).        ):.
-0001eec0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0001eed0: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-0001eee0: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-0001eef0: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
-0001ef00: 6963 742c 2022 5061 7474 6572 6e22 290a  ict, "Pattern").
-0001ef10: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0001ef20: 7761 7920 3e20 303a 0a20 2020 2020 2020  way > 0:.       
-0001ef30: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-0001ef40: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-0001ef50: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001ef60: 2020 2020 2020 2073 6176 6564 5b30 5d20         saved[0] 
-0001ef70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef80: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
-0001ef90: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
-0001efa0: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-0001efb0: 7254 6578 742e 4752 4545 4e0a 2020 2020  rText.GREEN.    
-0001efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efd0: 2b20 6622 4950 4f20 4261 7365 2028 7b61  + f"IPO Base ({a
-0001efe0: 7761 797d 2025 2922 0a20 2020 2020 2020  way} %)".       
-0001eff0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-0001f000: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-0001f010: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0001f020: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001f030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f040: 2073 6372 6565 6e44 6963 745b 2250 6174   screenDict["Pat
-0001f050: 7465 726e 225d 203d 2028 0a20 2020 2020  tern"] = (.     
-0001f060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f070: 6176 6564 5b30 5d0a 2020 2020 2020 2020  aved[0].        
-0001f080: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-0001f090: 6c6f 7254 6578 742e 424f 4c44 0a20 2020  lorText.BOLD.   
-0001f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0b0: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
-0001f0c0: 454e 0a20 2020 2020 2020 2020 2020 2020  EN.             
-0001f0d0: 2020 2020 2020 202b 2022 4950 4f20 4261         + "IPO Ba
-0001f0e0: 7365 2022 0a20 2020 2020 2020 2020 2020  se ".           
-0001f0f0: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-0001f100: 5465 7874 2e46 4149 4c0a 2020 2020 2020  Text.FAIL.      
-0001f110: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001f120: 6622 287b 6177 6179 7d20 2529 220a 2020  f"({away} %)".  
-0001f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f140: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-0001f150: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-0001f160: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001f170: 7361 7665 4469 6374 5b22 5061 7474 6572  saveDict["Patter
-0001f180: 6e22 5d20 3d20 7361 7665 645b 315d 202b  n"] = saved[1] +
-0001f190: 2066 2249 504f 2042 6173 6520 287b 6177   f"IPO Base ({aw
-0001f1a0: 6179 7d20 2529 220a 2020 2020 2020 2020  ay} %)".        
-0001f1b0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-0001f1c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001f1d0: 616c 7365 0a0a 2020 2020 2340 6d65 6173  alse..    #@meas
-0001f1e0: 7572 655f 7469 6d65 0a20 2020 2023 2056  ure_time.    # V
-0001f1f0: 616c 6964 6174 6520 4c6f 7265 6e74 7a69  alidate Lorentzi
-0001f200: 616e 2043 6c61 7373 6966 6963 6174 696f  an Classificatio
-0001f210: 6e20 7369 676e 616c 0a20 2020 2064 6566  n signal.    def
-0001f220: 2076 616c 6964 6174 654c 6f72 656e 747a   validateLorentz
-0001f230: 6961 6e28 7365 6c66 2c20 6466 2c20 7363  ian(self, df, sc
-0001f240: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-0001f250: 6374 2c20 6c6f 6f6b 466f 723d 3329 3a0a  ct, lookFor=3):.
-0001f260: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
-0001f270: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
-0001f280: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0001f290: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001f2a0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-0001f2b0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-0001f2c0: 2023 206c 6f6f 6b46 6f72 3a20 312d 4275   # lookFor: 1-Bu
-0001f2d0: 792c 2032 2d53 656c 6c2c 2033 2d41 6e79  y, 2-Sell, 3-Any
-0001f2e0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0001f2f0: 6461 7461 5b3a 3a2d 315d 2020 2320 5265  data[::-1]  # Re
-0001f300: 7665 7273 6520 7468 6520 6461 7461 6672  verse the datafr
-0001f310: 616d 650a 2020 2020 2020 2020 6461 7461  ame.        data
-0001f320: 203d 2064 6174 612e 7265 6e61 6d65 280a   = data.rename(.
-0001f330: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0001f340: 6d6e 733d 7b0a 2020 2020 2020 2020 2020  mns={.          
-0001f350: 2020 2020 2020 224f 7065 6e22 3a20 226f        "Open": "o
-0001f360: 7065 6e22 2c0a 2020 2020 2020 2020 2020  pen",.          
-0001f370: 2020 2020 2020 2243 6c6f 7365 223a 2022        "Close": "
-0001f380: 636c 6f73 6522 2c0a 2020 2020 2020 2020  close",.        
-0001f390: 2020 2020 2020 2020 2248 6967 6822 3a20          "High": 
-0001f3a0: 2268 6967 6822 2c0a 2020 2020 2020 2020  "high",.        
-0001f3b0: 2020 2020 2020 2020 224c 6f77 223a 2022          "Low": "
-0001f3c0: 6c6f 7722 2c0a 2020 2020 2020 2020 2020  low",.          
-0001f3d0: 2020 2020 2020 2256 6f6c 756d 6522 3a20        "Volume": 
-0001f3e0: 2276 6f6c 756d 6522 2c0a 2020 2020 2020  "volume",.      
-0001f3f0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0001f400: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-0001f410: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0001f420: 5375 7070 7265 7373 4f75 7470 7574 2873  SuppressOutput(s
-0001f430: 7570 7072 6573 735f 7374 646f 7574 3d54  uppress_stdout=T
-0001f440: 7275 652c 2073 7570 7072 6573 735f 7374  rue, suppress_st
-0001f450: 6465 7272 3d54 7275 6529 3a0a 2020 2020  derr=True):.    
-0001f460: 2020 2020 2020 2020 2020 2020 6c63 203d              lc =
-0001f470: 2061 7461 2e4c 6f72 656e 747a 6961 6e43   ata.LorentzianC
-0001f480: 6c61 7373 6966 6963 6174 696f 6e28 6461  lassification(da
-0001f490: 7461 3d64 6174 6129 0a20 2020 2020 2020  ta=data).       
-0001f4a0: 2020 2020 2073 6176 6564 203d 2073 656c       saved = sel
-0001f4b0: 662e 6669 6e64 4375 7272 656e 7453 6176  f.findCurrentSav
-0001f4c0: 6564 5661 6c75 6528 7363 7265 656e 4469  edValue(screenDi
-0001f4d0: 6374 2c20 7361 7665 4469 6374 2c20 2250  ct, saveDict, "P
-0001f4e0: 6174 7465 726e 2229 0a20 2020 2020 2020  attern").       
-0001f4f0: 2020 2020 2069 6620 6c63 2e64 662e 696c       if lc.df.il
-0001f500: 6f63 5b2d 315d 5b22 6973 4e65 7742 7579  oc[-1]["isNewBuy
-0001f510: 5369 676e 616c 225d 3a0a 2020 2020 2020  Signal"]:.      
-0001f520: 2020 2020 2020 2020 2020 7363 7265 656e            screen
-0001f530: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
-0001f540: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0001f550: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
-0001f560: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
-0001f570: 4420 2b20 636f 6c6f 7254 6578 742e 4752  D + colorText.GR
-0001f580: 4545 4e20 2b20 224c 6f72 656e 747a 6961  EEN + "Lorentzia
-0001f590: 6e2d 4275 7922 202b 2063 6f6c 6f72 5465  n-Buy" + colorTe
-0001f5a0: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-0001f5b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001f5c0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-0001f5d0: 745b 2250 6174 7465 726e 225d 203d 2073  t["Pattern"] = s
-0001f5e0: 6176 6564 5b31 5d20 2b20 224c 6f72 656e  aved[1] + "Loren
-0001f5f0: 747a 6961 6e2d 4275 7922 0a20 2020 2020  tzian-Buy".     
-0001f600: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
-0001f610: 6f6b 466f 7220 213d 2032 3a20 2320 4e6f  okFor != 2: # No
-0001f620: 7420 5365 6c6c 0a20 2020 2020 2020 2020  t Sell.         
-0001f630: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001f640: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
-0001f650: 2020 2065 6c69 6620 6c63 2e64 662e 696c     elif lc.df.il
-0001f660: 6f63 5b2d 315d 5b22 6973 4e65 7753 656c  oc[-1]["isNewSel
-0001f670: 6c53 6967 6e61 6c22 5d3a 0a20 2020 2020  lSignal"]:.     
-0001f680: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-0001f690: 6e44 6963 745b 2250 6174 7465 726e 225d  nDict["Pattern"]
-0001f6a0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0001f6b0: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
-0001f6c0: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
-0001f6d0: 4c44 202b 2063 6f6c 6f72 5465 7874 2e46  LD + colorText.F
-0001f6e0: 4149 4c20 2b20 224c 6f72 656e 747a 6961  AIL + "Lorentzia
-0001f6f0: 6e2d 5365 6c6c 2220 2b20 636f 6c6f 7254  n-Sell" + colorT
-0001f700: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-0001f710: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001f720: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-0001f730: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-0001f740: 7361 7665 645b 315d 202b 2022 4c6f 7265  saved[1] + "Lore
-0001f750: 6e74 7a69 616e 2d53 656c 6c22 0a20 2020  ntzian-Sell".   
-0001f760: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001f770: 6c6f 6f6b 466f 7220 213d 2031 3a20 2320  lookFor != 1: # 
-0001f780: 4e6f 7420 4275 790a 2020 2020 2020 2020  Not Buy.        
-0001f790: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001f7a0: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
-0001f7b0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-0001f7c0: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
-0001f7d0: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
-0001f7e0: 2020 2320 5661 6c75 6545 7272 6f72 3a20    # ValueError: 
-0001f7f0: 6f70 6572 616e 6473 2063 6f75 6c64 206e  operands could n
-0001f800: 6f74 2062 6520 6272 6f61 6463 6173 7420  ot be broadcast 
-0001f810: 746f 6765 7468 6572 2077 6974 6820 7368  together with sh
-0001f820: 6170 6573 2028 3230 2c29 2028 3236 2c29  apes (20,) (26,)
-0001f830: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-0001f840: 696c 6520 222f 6f70 742f 686f 6d65 6272  ile "/opt/homebr
-0001f850: 6577 2f6c 6962 2f70 7974 686f 6e33 2e31  ew/lib/python3.1
-0001f860: 312f 7369 7465 2d70 6163 6b61 6765 732f  1/site-packages/
-0001f870: 6164 7661 6e63 6564 5f74 612f 4c6f 7265  advanced_ta/Lore
-0001f880: 6e74 7a69 616e 436c 6173 7369 6669 6361  ntzianClassifica
-0001f890: 7469 6f6e 2f43 6c61 7373 6966 6965 722e  tion/Classifier.
-0001f8a0: 7079 222c 206c 696e 6520 3138 362c 2069  py", line 186, i
-0001f8b0: 6e20 5f5f 696e 6974 5f5f 0a20 2020 2020  n __init__.     
-0001f8c0: 2020 2020 2020 2023 2046 696c 6520 222f         # File "/
-0001f8d0: 6f70 742f 686f 6d65 6272 6577 2f6c 6962  opt/homebrew/lib
-0001f8e0: 2f70 7974 686f 6e33 2e31 312f 7369 7465  /python3.11/site
-0001f8f0: 2d70 6163 6b61 6765 732f 6164 7661 6e63  -packages/advanc
-0001f900: 6564 5f74 612f 4c6f 7265 6e74 7a69 616e  ed_ta/Lorentzian
-0001f910: 436c 6173 7369 6669 6361 7469 6f6e 2f43  Classification/C
-0001f920: 6c61 7373 6966 6965 722e 7079 222c 206c  lassifier.py", l
-0001f930: 696e 6520 3339 352c 2069 6e20 5f5f 636c  ine 395, in __cl
-0001f940: 6173 7369 6679 0a20 2020 2020 2020 2020  assify.         
-0001f950: 2020 2023 2046 696c 6520 222f 6f70 742f     # File "/opt/
-0001f960: 686f 6d65 6272 6577 2f6c 6962 2f70 7974  homebrew/lib/pyt
-0001f970: 686f 6e33 2e31 312f 7369 7465 2d70 6163  hon3.11/site-pac
-0001f980: 6b61 6765 732f 7061 6e64 6173 2f63 6f72  kages/pandas/cor
-0001f990: 652f 6f70 732f 636f 6d6d 6f6e 2e70 7922  e/ops/common.py"
-0001f9a0: 2c20 6c69 6e65 2037 362c 2069 6e20 6e65  , line 76, in ne
-0001f9b0: 775f 6d65 7468 6f64 0a20 2020 2020 2020  w_method.       
-0001f9c0: 2020 2020 2023 2046 696c 6520 222f 6f70       # File "/op
-0001f9d0: 742f 686f 6d65 6272 6577 2f6c 6962 2f70  t/homebrew/lib/p
-0001f9e0: 7974 686f 6e33 2e31 312f 7369 7465 2d70  ython3.11/site-p
-0001f9f0: 6163 6b61 6765 732f 7061 6e64 6173 2f63  ackages/pandas/c
-0001fa00: 6f72 652f 6172 7261 796c 696b 652e 7079  ore/arraylike.py
-0001fa10: 222c 206c 696e 6520 3730 2c20 696e 205f  ", line 70, in _
-0001fa20: 5f61 6e64 5f5f 0a20 2020 2020 2020 2020  _and__.         
-0001fa30: 2020 2023 2046 696c 6520 222f 6f70 742f     # File "/opt/
-0001fa40: 686f 6d65 6272 6577 2f6c 6962 2f70 7974  homebrew/lib/pyt
-0001fa50: 686f 6e33 2e31 312f 7369 7465 2d70 6163  hon3.11/site-pac
-0001fa60: 6b61 6765 732f 7061 6e64 6173 2f63 6f72  kages/pandas/cor
-0001fa70: 652f 7365 7269 6573 2e70 7922 2c20 6c69  e/series.py", li
-0001fa80: 6e65 2035 3831 302c 2069 6e20 5f6c 6f67  ne 5810, in _log
-0001fa90: 6963 616c 5f6d 6574 686f 640a 2020 2020  ical_method.    
-0001faa0: 2020 2020 2020 2020 2320 4669 6c65 2022          # File "
-0001fab0: 2f6f 7074 2f68 6f6d 6562 7265 772f 6c69  /opt/homebrew/li
-0001fac0: 622f 7079 7468 6f6e 332e 3131 2f73 6974  b/python3.11/sit
-0001fad0: 652d 7061 636b 6167 6573 2f70 616e 6461  e-packages/panda
-0001fae0: 732f 636f 7265 2f6f 7073 2f61 7272 6179  s/core/ops/array
-0001faf0: 5f6f 7073 2e70 7922 2c20 6c69 6e65 2034  _ops.py", line 4
-0001fb00: 3536 2c20 696e 206c 6f67 6963 616c 5f6f  56, in logical_o
-0001fb10: 700a 2020 2020 2020 2020 2020 2020 2320  p.            # 
-0001fb20: 4669 6c65 2022 2f6f 7074 2f68 6f6d 6562  File "/opt/homeb
-0001fb30: 7265 772f 6c69 622f 7079 7468 6f6e 332e  rew/lib/python3.
-0001fb40: 3131 2f73 6974 652d 7061 636b 6167 6573  11/site-packages
-0001fb50: 2f70 616e 6461 732f 636f 7265 2f6f 7073  /pandas/core/ops
-0001fb60: 2f61 7272 6179 5f6f 7073 2e70 7922 2c20  /array_ops.py", 
-0001fb70: 6c69 6e65 2033 3634 2c20 696e 206e 615f  line 364, in na_
-0001fb80: 6c6f 6769 6361 6c5f 6f70 0a20 2020 2020  logical_op.     
-0001fb90: 2020 2020 2020 2023 2073 656c 662e 6465         # self.de
-0001fba0: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
-0001fbb0: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
-0001fbc0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0001fbd0: 2070 6173 730a 2020 2020 2020 2020 7265   pass.        re
-0001fbe0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-0001fbf0: 2320 7661 6c69 6461 7465 2069 6620 7468  # validate if th
-0001fc00: 6520 7374 6f63 6b20 6861 7320 6265 656e  e stock has been
-0001fc10: 2068 6176 696e 6720 6c6f 7765 7220 6c6f   having lower lo
-0001fc20: 7773 2c20 6c6f 7765 7220 6869 6768 730a  ws, lower highs.
-0001fc30: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
-0001fc40: 4c6f 7765 7248 6967 6873 4c6f 7765 724c  LowerHighsLowerL
-0001fc50: 6f77 7328 7365 6c66 2c20 6466 293a 0a20  ows(self, df):. 
-0001fc60: 2020 2020 2020 2069 6620 6466 2069 7320         if df is 
-0001fc70: 4e6f 6e65 206f 7220 6c65 6e28 6466 2920  None or len(df) 
-0001fc80: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0001fc90: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0001fca0: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
-0001fcb0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-0001fcc0: 6461 7930 203d 2064 6174 610a 2020 2020  day0 = data.    
-0001fcd0: 2020 2020 6461 7931 203d 2064 6174 615b      day1 = data[
-0001fce0: 313a 5d0a 2020 2020 2020 2020 6461 7932  1:].        day2
-0001fcf0: 203d 2064 6174 615b 323a 5d0a 2020 2020   = data[2:].    
-0001fd00: 2020 2020 6461 7933 203d 2064 6174 615b      day3 = data[
-0001fd10: 333a 5d0a 2020 2020 2020 2020 6c6f 7765  3:].        lowe
-0001fd20: 7248 6967 6873 203d 2028 0a20 2020 2020  rHighs = (.     
-0001fd30: 2020 2020 2020 2028 6461 7930 5b22 4869         (day0["Hi
-0001fd40: 6768 225d 2e69 6c6f 635b 305d 203c 2064  gh"].iloc[0] < d
-0001fd50: 6179 315b 2248 6967 6822 5d2e 696c 6f63  ay1["High"].iloc
-0001fd60: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-0001fd70: 2061 6e64 2028 6461 7931 5b22 4869 6768   and (day1["High
-0001fd80: 225d 2e69 6c6f 635b 305d 203c 2064 6179  "].iloc[0] < day
-0001fd90: 325b 2248 6967 6822 5d2e 696c 6f63 5b30  2["High"].iloc[0
-0001fda0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-0001fdb0: 6e64 2028 6461 7932 5b22 4869 6768 225d  nd (day2["High"]
-0001fdc0: 2e69 6c6f 635b 305d 203c 2064 6179 335b  .iloc[0] < day3[
-0001fdd0: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
-0001fde0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0001fdf0: 2020 206c 6f77 6572 4c6f 7773 203d 2028     lowerLows = (
-0001fe00: 0a20 2020 2020 2020 2020 2020 2028 6461  .            (da
-0001fe10: 7930 5b22 4c6f 7722 5d2e 696c 6f63 5b30  y0["Low"].iloc[0
-0001fe20: 5d20 3c20 6461 7931 5b22 4c6f 7722 5d2e  ] < day1["Low"].
-0001fe30: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
-0001fe40: 2020 2020 2061 6e64 2028 6461 7931 5b22       and (day1["
-0001fe50: 4c6f 7722 5d2e 696c 6f63 5b30 5d20 3c20  Low"].iloc[0] < 
-0001fe60: 6461 7932 5b22 4c6f 7722 5d2e 696c 6f63  day2["Low"].iloc
-0001fe70: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-0001fe80: 2061 6e64 2028 6461 7932 5b22 4c6f 7722   and (day2["Low"
-0001fe90: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7933  ].iloc[0] < day3
-0001fea0: 5b22 4c6f 7722 5d2e 696c 6f63 5b30 5d29  ["Low"].iloc[0])
-0001feb0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0001fec0: 2020 2068 6967 6865 7252 5349 203d 2028     higherRSI = (
-0001fed0: 0a20 2020 2020 2020 2020 2020 2028 6461  .            (da
-0001fee0: 7930 5b22 5253 4922 5d2e 696c 6f63 5b30  y0["RSI"].iloc[0
-0001fef0: 5d20 3c20 6461 7931 5b22 5253 4922 5d2e  ] < day1["RSI"].
-0001ff00: 696c 6f63 5b30 5d29 0a20 2020 2020 2020  iloc[0]).       
-0001ff10: 2020 2020 2061 6e64 2028 6461 7931 5b22       and (day1["
-0001ff20: 5253 4922 5d2e 696c 6f63 5b30 5d20 3c20  RSI"].iloc[0] < 
-0001ff30: 6461 7932 5b22 5253 4922 5d2e 696c 6f63  day2["RSI"].iloc
-0001ff40: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-0001ff50: 2061 6e64 2028 6461 7932 5b22 5253 4922   and (day2["RSI"
-0001ff60: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7933  ].iloc[0] < day3
-0001ff70: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d29  ["RSI"].iloc[0])
-0001ff80: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0001ff90: 2064 6179 305b 2252 5349 225d 2e69 6c6f   day0["RSI"].ilo
-0001ffa0: 635b 305d 203e 3d20 3530 0a20 2020 2020  c[0] >= 50.     
-0001ffb0: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-0001ffc0: 7572 6e20 6c6f 7765 7248 6967 6873 2061  urn lowerHighs a
-0001ffd0: 6e64 206c 6f77 6572 4c6f 7773 2061 6e64  nd lowerLows and
-0001ffe0: 2068 6967 6865 7252 5349 0a0a 2020 2020   higherRSI..    
-0001fff0: 2320 5661 6c69 6461 7465 2069 6620 7265  # Validate if re
-00020000: 6365 6e74 2076 6f6c 756d 6520 6973 206c  cent volume is l
-00020010: 6f77 6573 7420 6f66 206c 6173 7420 274e  owest of last 'N
-00020020: 2720 4461 7973 0a20 2020 2064 6566 2076  ' Days.    def v
-00020030: 616c 6964 6174 654c 6f77 6573 7456 6f6c  alidateLowestVol
-00020040: 756d 6528 7365 6c66 2c20 6466 2c20 6461  ume(self, df, da
-00020050: 7973 466f 724c 6f77 6573 7456 6f6c 756d  ysForLowestVolum
-00020060: 6529 3a0a 2020 2020 2020 2020 6966 2064  e):.        if d
-00020070: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00020080: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-00020090: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000200a0: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-000200b0: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-000200c0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
-000200d0: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
-000200e0: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
-000200f0: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
-00020100: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
-00020110: 2020 2020 2069 6620 6461 7973 466f 724c       if daysForL
-00020120: 6f77 6573 7456 6f6c 756d 6520 6973 204e  owestVolume is N
-00020130: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00020140: 2064 6179 7346 6f72 4c6f 7765 7374 566f   daysForLowestVo
-00020150: 6c75 6d65 203d 2033 300a 2020 2020 2020  lume = 30.      
-00020160: 2020 6966 206c 656e 2864 6174 6129 203c    if len(data) <
-00020170: 2064 6179 7346 6f72 4c6f 7765 7374 566f   daysForLowestVo
-00020180: 6c75 6d65 3a0a 2020 2020 2020 2020 2020  lume:.          
-00020190: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-000201a0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
-000201b0: 7461 2e68 6561 6428 6461 7973 466f 724c  ta.head(daysForL
-000201c0: 6f77 6573 7456 6f6c 756d 6529 0a20 2020  owestVolume).   
-000201d0: 2020 2020 2072 6563 656e 7420 3d20 6461       recent = da
-000201e0: 7461 2e68 6561 6428 3129 0a20 2020 2020  ta.head(1).     
-000201f0: 2020 2069 6620 6c65 6e28 7265 6365 6e74     if len(recent
-00020200: 2920 3c20 313a 0a20 2020 2020 2020 2020  ) < 1:.         
-00020210: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00020220: 2020 2020 2020 2020 6966 2028 7265 6365          if (rece
-00020230: 6e74 5b22 566f 6c75 6d65 225d 2e69 6c6f  nt["Volume"].ilo
-00020240: 635b 305d 203c 3d20 6461 7461 2e64 6573  c[0] <= data.des
-00020250: 6372 6962 6528 295b 2256 6f6c 756d 6522  cribe()["Volume"
-00020260: 5d5b 226d 696e 225d 2920 616e 6420 7265  ]["min"]) and re
-00020270: 6365 6e74 5b0a 2020 2020 2020 2020 2020  cent[.          
-00020280: 2020 2256 6f6c 756d 6522 0a20 2020 2020    "Volume".     
-00020290: 2020 205d 5b30 5d20 213d 206e 702e 6e61     ][0] != np.na
-000202a0: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
-000202b0: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-000202c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-000202d0: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
-000202e0: 4c54 5020 7769 7468 696e 206c 696d 6974  LTP within limit
-000202f0: 730a 2020 2020 6465 6620 7661 6c69 6461  s.    def valida
-00020300: 7465 4c54 5028 7365 6c66 2c20 6466 2c20  teLTP(self, df, 
-00020310: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
-00020320: 4469 6374 2c20 6d69 6e4c 5450 3d4e 6f6e  Dict, minLTP=Non
-00020330: 652c 206d 6178 4c54 503d 4e6f 6e65 2c6d  e, maxLTP=None,m
-00020340: 696e 4368 616e 6765 3d30 293a 0a20 2020  inChange=0):.   
-00020350: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-00020360: 6f70 7928 290a 2020 2020 2020 2020 6c74  opy().        lt
-00020370: 7056 616c 6964 203d 2046 616c 7365 0a20  pValid = False. 
-00020380: 2020 2020 2020 2069 6620 6d69 6e4c 5450         if minLTP
-00020390: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000203a0: 2020 2020 2020 6d69 6e4c 5450 203d 2073        minLTP = s
-000203b0: 656c 662e 636f 6e66 6967 4d61 6e61 6765  elf.configManage
-000203c0: 722e 6d69 6e4c 5450 0a20 2020 2020 2020  r.minLTP.       
-000203d0: 2069 6620 6d61 784c 5450 2069 7320 4e6f   if maxLTP is No
-000203e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000203f0: 6d61 784c 5450 203d 2073 656c 662e 636f  maxLTP = self.co
-00020400: 6e66 6967 4d61 6e61 6765 722e 6d61 784c  nfigManager.maxL
-00020410: 5450 0a20 2020 2020 2020 2064 6174 6120  TP.        data 
-00020420: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-00020430: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00020440: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00020450: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-00020460: 3029 0a20 2020 2020 2020 2072 6563 656e  0).        recen
-00020470: 7420 3d20 6461 7461 2e68 6561 6428 3129  t = data.head(1)
-00020480: 0a0a 2020 2020 2020 2020 7063 745f 6368  ..        pct_ch
-00020490: 616e 6765 203d 2028 6461 7461 5b3a 3a2d  ange = (data[::-
-000204a0: 315d 5b22 436c 6f73 6522 5d2e 7063 745f  1]["Close"].pct_
-000204b0: 6368 616e 6765 2829 202a 2031 3030 292e  change() * 100).
-000204c0: 696c 6f63 5b2d 315d 0a20 2020 2020 2020  iloc[-1].       
-000204d0: 2069 6620 7063 745f 6368 616e 6765 203d   if pct_change =
-000204e0: 3d20 6e70 2e69 6e66 206f 7220 7063 745f  = np.inf or pct_
-000204f0: 6368 616e 6765 203d 3d20 2d6e 702e 696e  change == -np.in
-00020500: 663a 0a20 2020 2020 2020 2020 2020 2070  f:.            p
-00020510: 6374 5f63 6861 6e67 6520 3d20 300a 2020  ct_change = 0.  
-00020520: 2020 2020 2020 7063 745f 7361 7665 203d        pct_save =
-00020530: 2022 252e 3166 2525 2220 2520 7063 745f   "%.1f%%" % pct_
-00020540: 6368 616e 6765 0a20 2020 2020 2020 2069  change.        i
-00020550: 6620 7063 745f 6368 616e 6765 203e 2030  f pct_change > 0
-00020560: 2e32 3a0a 2020 2020 2020 2020 2020 2020  .2:.            
-00020570: 7063 745f 6368 616e 6765 203d 2063 6f6c  pct_change = col
-00020580: 6f72 5465 7874 2e47 5245 454e 202b 2028  orText.GREEN + (
-00020590: 2225 2e31 6625 2522 2025 2070 6374 5f63  "%.1f%%" % pct_c
-000205a0: 6861 6e67 6529 202b 2063 6f6c 6f72 5465  hange) + colorTe
-000205b0: 7874 2e45 4e44 0a20 2020 2020 2020 2065  xt.END.        e
-000205c0: 6c69 6620 7063 745f 6368 616e 6765 203c  lif pct_change <
-000205d0: 202d 302e 323a 0a20 2020 2020 2020 2020   -0.2:.         
-000205e0: 2020 2070 6374 5f63 6861 6e67 6520 3d20     pct_change = 
-000205f0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
-00020600: 2028 2225 2e31 6625 2522 2025 2070 6374   ("%.1f%%" % pct
-00020610: 5f63 6861 6e67 6529 202b 2063 6f6c 6f72  _change) + color
-00020620: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00020630: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00020640: 2020 2070 6374 5f63 6861 6e67 6520 3d20     pct_change = 
-00020650: 636f 6c6f 7254 6578 742e 5741 524e 202b  colorText.WARN +
-00020660: 2028 2225 2e31 6625 2522 2025 2070 6374   ("%.1f%%" % pct
-00020670: 5f63 6861 6e67 6529 202b 2063 6f6c 6f72  _change) + color
-00020680: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
-00020690: 2073 6176 6544 6963 745b 2225 4368 6e67   saveDict["%Chng
-000206a0: 225d 203d 2070 6374 5f73 6176 650a 2020  "] = pct_save.  
-000206b0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-000206c0: 5b22 2543 686e 6722 5d20 3d20 7063 745f  ["%Chng"] = pct_
-000206d0: 6368 616e 6765 0a20 2020 2020 2020 206c  change.        l
-000206e0: 7470 203d 2072 6f75 6e64 2872 6563 656e  tp = round(recen
-000206f0: 745b 2243 6c6f 7365 225d 2e69 6c6f 635b  t["Close"].iloc[
-00020700: 305d 2c20 3229 0a20 2020 2020 2020 2076  0], 2).        v
-00020710: 6572 6966 7953 7461 6765 5477 6f20 3d20  erifyStageTwo = 
-00020720: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
-00020730: 6c65 6e28 6461 7461 2920 3e20 3235 303a  len(data) > 250:
-00020740: 0a20 2020 2020 2020 2020 2020 2079 6561  .            yea
-00020750: 726c 794c 6f77 203d 2064 6174 612e 6865  rlyLow = data.he
-00020760: 6164 2832 3530 295b 2243 6c6f 7365 225d  ad(250)["Close"]
-00020770: 2e6d 696e 2829 0a20 2020 2020 2020 2020  .min().         
-00020780: 2020 2079 6561 726c 7948 6967 6820 3d20     yearlyHigh = 
-00020790: 6461 7461 2e68 6561 6428 3235 3029 5b22  data.head(250)["
-000207a0: 436c 6f73 6522 5d2e 6d61 7828 290a 2020  Close"].max().  
-000207b0: 2020 2020 2020 2020 2020 6966 206c 7470            if ltp
-000207c0: 203c 2028 3220 2a20 7965 6172 6c79 4c6f   < (2 * yearlyLo
-000207d0: 7729 2061 6e64 206c 7470 203c 2028 302e  w) and ltp < (0.
-000207e0: 3735 202a 2079 6561 726c 7948 6967 6829  75 * yearlyHigh)
-000207f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020800: 2020 7665 7269 6679 5374 6167 6554 776f    verifyStageTwo
-00020810: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00020820: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00020830: 6963 745b 2253 746f 636b 225d 203d 2063  ict["Stock"] = c
-00020840: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
-00020850: 7361 7665 4469 6374 5b22 5374 6f63 6b22  saveDict["Stock"
-00020860: 5d20 2b20 636f 6c6f 7254 6578 742e 454e  ] + colorText.EN
-00020870: 440a 2020 2020 2020 2020 6966 206c 7470  D.        if ltp
-00020880: 203e 3d20 6d69 6e4c 5450 2061 6e64 206c   >= minLTP and l
-00020890: 7470 203c 3d20 6d61 784c 5450 3a0a 2020  tp <= maxLTP:.  
-000208a0: 2020 2020 2020 2020 2020 6c74 7056 616c            ltpVal
-000208b0: 6964 203d 2054 7275 650a 2020 2020 2020  id = True.      
-000208c0: 2020 2020 2020 6966 206d 696e 4368 616e        if minChan
-000208d0: 6765 2021 3d20 303a 0a20 2020 2020 2020  ge != 0:.       
-000208e0: 2020 2020 2020 2020 2023 2055 7365 7220           # User 
-000208f0: 6861 7320 7375 7070 6c69 6564 2073 6f6d  has supplied som
-00020900: 6520 6669 6c74 6572 2066 6f72 2070 6572  e filter for per
-00020910: 6365 6e74 6167 6520 6368 616e 6765 0a20  centage change. 
-00020920: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00020930: 7470 5661 6c69 6420 3d20 666c 6f61 7428  tpValid = float(
-00020940: 7374 7228 7063 745f 7361 7665 292e 7265  str(pct_save).re
-00020950: 706c 6163 6528 2225 222c 2222 2929 203e  place("%","")) >
-00020960: 3d20 6d69 6e43 6861 6e67 650a 2020 2020  = minChange.    
-00020970: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
-00020980: 5b22 4c54 5022 5d20 3d20 726f 756e 6428  ["LTP"] = round(
-00020990: 6c74 702c 2032 290a 2020 2020 2020 2020  ltp, 2).        
-000209a0: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
-000209b0: 4c54 5022 5d20 3d20 2863 6f6c 6f72 5465  LTP"] = (colorTe
-000209c0: 7874 2e47 5245 454e 2069 6620 6c74 7056  xt.GREEN if ltpV
-000209d0: 616c 6964 2065 6c73 6520 636f 6c6f 7254  alid else colorT
-000209e0: 6578 742e 4641 494c 2920 2b20 2822 252e  ext.FAIL) + ("%.
-000209f0: 3266 2220 2520 6c74 7029 202b 2063 6f6c  2f" % ltp) + col
-00020a00: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00020a10: 2020 2020 2020 2072 6574 7572 6e20 6c74         return lt
-00020a20: 7056 616c 6964 2c20 7665 7269 6679 5374  pValid, verifySt
-00020a30: 6167 6554 776f 0a20 2020 2020 2020 2073  ageTwo.        s
-00020a40: 6372 6565 6e44 6963 745b 224c 5450 225d  creenDict["LTP"]
-00020a50: 203d 2063 6f6c 6f72 5465 7874 2e46 4149   = colorText.FAI
-00020a60: 4c20 2b20 2822 252e 3266 2220 2520 6c74  L + ("%.2f" % lt
-00020a70: 7029 202b 2063 6f6c 6f72 5465 7874 2e45  p) + colorText.E
-00020a80: 4e44 0a20 2020 2020 2020 2073 6176 6544  ND.        saveD
-00020a90: 6963 745b 224c 5450 225d 203d 2072 6f75  ict["LTP"] = rou
-00020aa0: 6e64 286c 7470 2c20 3229 0a20 2020 2020  nd(ltp, 2).     
-00020ab0: 2020 2072 6574 7572 6e20 6c74 7056 616c     return ltpVal
-00020ac0: 6964 2c20 7665 7269 6679 5374 6167 6554  id, verifyStageT
-00020ad0: 776f 0a0a 2020 2020 6465 6620 7661 6c69  wo..    def vali
-00020ae0: 6461 7465 4c54 5046 6f72 506f 7274 666f  dateLTPForPortfo
-00020af0: 6c69 6f43 616c 6328 7365 6c66 2c20 6466  lioCalc(self, df
-00020b00: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
-00020b10: 7665 4469 6374 2c72 6571 7565 7374 6564  veDict,requested
-00020b20: 5065 7269 6f64 3d30 293a 0a20 2020 2020  Period=0):.     
-00020b30: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
-00020b40: 7928 290a 2020 2020 2020 2020 7065 7269  y().        peri
-00020b50: 6f64 7320 3d20 7365 6c66 2e63 6f6e 6669  ods = self.confi
-00020b60: 674d 616e 6167 6572 2e70 6572 696f 6473  gManager.periods
-00020b70: 5261 6e67 650a 2020 2020 2020 2020 6966  Range.        if
-00020b80: 2072 6571 7565 7374 6564 5065 7269 6f64   requestedPeriod
-00020b90: 203e 2030 2061 6e64 2072 6571 7565 7374   > 0 and request
-00020ba0: 6564 5065 7269 6f64 206e 6f74 2069 6e20  edPeriod not in 
-00020bb0: 7065 7269 6f64 733a 0a20 2020 2020 2020  periods:.       
-00020bc0: 2020 2020 2070 6572 696f 6473 2e61 7070       periods.app
-00020bd0: 656e 6428 7265 7175 6573 7465 6450 6572  end(requestedPer
-00020be0: 696f 6429 0a20 2020 2020 2020 2070 7265  iod).        pre
-00020bf0: 7669 6f75 735f 7265 6365 6e74 203d 2064  vious_recent = d
-00020c00: 6174 612e 6865 6164 2831 290a 2020 2020  ata.head(1).    
-00020c10: 2020 2020 7072 6576 696f 7573 5f72 6563      previous_rec
-00020c20: 656e 742e 7265 7365 745f 696e 6465 7828  ent.reset_index(
-00020c30: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
-00020c40: 2020 2020 2020 6361 6c63 5f64 6174 6520        calc_date 
-00020c50: 3d20 7374 7228 7072 6576 696f 7573 5f72  = str(previous_r
-00020c60: 6563 656e 742e 696c 6f63 5b3a 2c20 305d  ecent.iloc[:, 0]
-00020c70: 5b30 5d29 2e73 706c 6974 2822 2022 295b  [0]).split(" ")[
-00020c80: 305d 0a20 2020 2020 2020 2066 6f72 2070  0].        for p
-00020c90: 7264 2069 6e20 7065 7269 6f64 733a 0a20  rd in periods:. 
-00020ca0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00020cb0: 6e28 6461 7461 2920 3e3d 2070 7264 202b  n(data) >= prd +
-00020cc0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00020cd0: 2020 2020 7072 6576 4c74 7020 3d20 6461      prevLtp = da
-00020ce0: 7461 5b22 436c 6f73 6522 5d2e 696c 6f63  ta["Close"].iloc
-00020cf0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00020d00: 2020 2020 6c74 7054 6479 203d 2064 6174      ltpTdy = dat
-00020d10: 615b 2243 6c6f 7365 225d 2e69 6c6f 635b  a["Close"].iloc[
-00020d20: 7072 645d 0a20 2020 2020 2020 2020 2020  prd].           
-00020d30: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00020d40: 6365 2870 7265 764c 7470 2c70 642e 5365  ce(prevLtp,pd.Se
-00020d50: 7269 6573 293a 0a20 2020 2020 2020 2020  ries):.         
-00020d60: 2020 2020 2020 2020 2020 2070 7265 764c             prevL
-00020d70: 7470 203d 2070 7265 764c 7470 5b30 5d0a  tp = prevLtp[0].
-00020d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d90: 2020 2020 6c74 7054 6479 203d 206c 7470      ltpTdy = ltp
-00020da0: 5464 795b 305d 0a20 2020 2020 2020 2020  Tdy[0].         
-00020db0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
-00020dc0: 745b 6622 4c54 507b 7072 647d 225d 203d  t[f"LTP{prd}"] =
-00020dd0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00020de0: 2020 2020 2020 2028 636f 6c6f 7254 6578         (colorTex
-00020df0: 742e 4752 4545 4e20 6966 2028 6c74 7054  t.GREEN if (ltpT
-00020e00: 6479 203e 3d20 7072 6576 4c74 7029 2065  dy >= prevLtp) e
-00020e10: 6c73 6520 2863 6f6c 6f72 5465 7874 2e46  lse (colorText.F
-00020e20: 4149 4c29 290a 2020 2020 2020 2020 2020  AIL)).          
-00020e30: 2020 2020 2020 2020 2020 2b20 7374 7228            + str(
-00020e40: 227b 3a2e 3266 7d22 2e66 6f72 6d61 7428  "{:.2f}".format(
-00020e50: 6c74 7054 6479 2929 0a20 2020 2020 2020  ltpTdy)).       
-00020e60: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00020e70: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00020e80: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00020e90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00020ea0: 6372 6565 6e44 6963 745b 6622 4772 6f77  creenDict[f"Grow
-00020eb0: 7468 7b70 7264 7d22 5d20 3d20 280a 2020  th{prd}"] = (.  
-00020ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ed0: 2020 2863 6f6c 6f72 5465 7874 2e47 5245    (colorText.GRE
-00020ee0: 454e 2069 6620 286c 7470 5464 7920 3e3d  EN if (ltpTdy >=
-00020ef0: 2070 7265 764c 7470 2920 656c 7365 2028   prevLtp) else (
-00020f00: 636f 6c6f 7254 6578 742e 4641 494c 2929  colorText.FAIL))
-00020f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020f20: 2020 2020 202b 2073 7472 2822 7b3a 2e32       + str("{:.2
-00020f30: 667d 222e 666f 726d 6174 286c 7470 5464  f}".format(ltpTd
-00020f40: 7920 2d20 7072 6576 4c74 7029 290a 2020  y - prevLtp)).  
-00020f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f60: 2020 2b20 636f 6c6f 7254 6578 742e 454e    + colorText.EN
-00020f70: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
-00020f80: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00020f90: 2020 2020 7361 7665 4469 6374 5b66 224c      saveDict[f"L
-00020fa0: 5450 7b70 7264 7d22 5d20 3d20 726f 756e  TP{prd}"] = roun
-00020fb0: 6428 6c74 7054 6479 2c20 3229 0a20 2020  d(ltpTdy, 2).   
-00020fc0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-00020fd0: 6544 6963 745b 6622 4772 6f77 7468 7b70  eDict[f"Growth{p
-00020fe0: 7264 7d22 5d20 3d20 726f 756e 6428 6c74  rd}"] = round(lt
-00020ff0: 7054 6479 202d 2070 7265 764c 7470 2c20  pTdy - prevLtp, 
-00021000: 3229 0a20 2020 2020 2020 2020 2020 2020  2).             
-00021010: 2020 2069 6620 7072 6420 3d3d 2032 3220     if prd == 22 
-00021020: 6f72 2028 7072 6420 3d3d 2072 6571 7565  or (prd == reque
-00021030: 7374 6564 5065 7269 6f64 293a 0a20 2020  stedPeriod):.   
-00021040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021050: 2063 6861 6e67 6550 6572 6365 6e74 203d   changePercent =
-00021060: 2072 6f75 6e64 2828 2870 7265 764c 7470   round(((prevLtp
-00021070: 2d6c 7470 5464 7929 2069 6620 7265 7175  -ltpTdy) if requ
-00021080: 6573 7465 6450 6572 696f 6420 3d3d 3020  estedPeriod ==0 
-00021090: 656c 7365 2028 6c74 7054 6479 202d 2070  else (ltpTdy - p
-000210a0: 7265 764c 7470 2929 2a31 3030 2f6c 7470  revLtp))*100/ltp
-000210b0: 5464 792c 2032 290a 2020 2020 2020 2020  Tdy, 2).        
-000210c0: 2020 2020 2020 2020 2020 2020 7361 7665              save
-000210d0: 4469 6374 5b66 227b 7072 647d 2d50 6420  Dict[f"{prd}-Pd 
-000210e0: 2522 5d20 3d20 6622 7b63 6861 6e67 6550  %"] = f"{changeP
-000210f0: 6572 6365 6e74 7d25 2220 6966 206e 6f74  ercent}%" if not
-00021100: 2070 642e 6973 6e61 2863 6861 6e67 6550   pd.isna(changeP
-00021110: 6572 6365 6e74 2920 656c 7365 2027 2d27  ercent) else '-'
-00021120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021130: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-00021140: 6622 7b70 7264 7d2d 5064 2025 225d 203d  f"{prd}-Pd %"] =
-00021150: 2028 2863 6f6c 6f72 5465 7874 2e47 5245   ((colorText.GRE
-00021160: 454e 2069 6620 6368 616e 6765 5065 7263  EN if changePerc
-00021170: 656e 7420 3e3d 3020 656c 7365 2063 6f6c  ent >=0 else col
-00021180: 6f72 5465 7874 2e46 4149 4c29 202b 2066  orText.FAIL) + f
-00021190: 227b 6368 616e 6765 5065 7263 656e 747d  "{changePercent}
-000211a0: 2522 202b 2063 6f6c 6f72 5465 7874 2e45  %" + colorText.E
-000211b0: 4e44 2920 6966 206e 6f74 2070 642e 6973  ND) if not pd.is
-000211c0: 6e61 2863 6861 6e67 6550 6572 6365 6e74  na(changePercent
-000211d0: 2920 656c 7365 2027 2d27 0a20 2020 2020  ) else '-'.     
-000211e0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-000211f0: 6e44 6963 745b 2244 6174 6522 5d20 3d20  nDict["Date"] = 
-00021200: 6361 6c63 5f64 6174 650a 2020 2020 2020  calc_date.      
-00021210: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-00021220: 6374 5b22 4461 7465 225d 203d 2063 616c  ct["Date"] = cal
-00021230: 635f 6461 7465 0a20 2020 2020 2020 2020  c_date.         
-00021240: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021250: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-00021260: 745b 6622 4c54 507b 7072 647d 225d 203d  t[f"LTP{prd}"] =
-00021270: 206e 702e 6e61 6e0a 2020 2020 2020 2020   np.nan.        
-00021280: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
-00021290: 5b66 2247 726f 7774 687b 7072 647d 225d  [f"Growth{prd}"]
-000212a0: 203d 206e 702e 6e61 6e0a 2020 2020 2020   = np.nan.      
-000212b0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
-000212c0: 4469 6374 5b22 4461 7465 225d 203d 2063  Dict["Date"] = c
-000212d0: 616c 635f 6461 7465 0a20 2020 2020 2020  alc_date.       
-000212e0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-000212f0: 745b 2244 6174 6522 5d20 3d20 6361 6c63  t["Date"] = calc
-00021300: 5f64 6174 650a 0a20 2020 2023 2046 696e  _date..    # Fin
-00021310: 6420 7374 6f63 6b73 2074 6861 7420 6172  d stocks that ar
-00021320: 6520 6265 6172 6973 6820 696e 7472 6164  e bearish intrad
-00021330: 6179 3a20 4d61 6364 2048 6973 746f 6772  ay: Macd Histogr
-00021340: 616d 206e 6567 6174 6976 650a 2020 2020  am negative.    
-00021350: 6465 6620 7661 6c69 6461 7465 4d41 4344  def validateMACD
-00021360: 4869 7374 6f67 7261 6d42 656c 6f77 3028  HistogramBelow0(
-00021370: 7365 6c66 2c20 6466 293a 0a20 2020 2020  self, df):.     
-00021380: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
-00021390: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
-000213a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000213b0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-000213c0: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
-000213d0: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
-000213e0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
-000213f0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-00021400: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
-00021410: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
-00021420: 2030 290a 2020 2020 2020 2020 6461 7461   0).        data
-00021430: 203d 2064 6174 615b 3a3a 2d31 5d20 2023   = data[::-1]  #
-00021440: 2052 6576 6572 7365 2074 6865 2064 6174   Reverse the dat
-00021450: 6166 7261 6d65 2073 6f20 7468 6174 2069  aframe so that i
-00021460: 7473 2074 6865 206f 6c64 6573 7420 6461  ts the oldest da
-00021470: 7465 2066 6972 7374 0a20 2020 2020 2020  te first.       
-00021480: 206d 6163 6420 3d20 706b 7461 6c69 622e   macd = pktalib.
-00021490: 4d41 4344 2864 6174 615b 2243 6c6f 7365  MACD(data["Close
-000214a0: 225d 2c20 3132 2c20 3236 2c20 3929 5b32  "], 12, 26, 9)[2
-000214b0: 5d2e 7461 696c 2831 290a 2020 2020 2020  ].tail(1).      
-000214c0: 2020 7265 7475 726e 206d 6163 642e 696c    return macd.il
-000214d0: 6f63 5b3a 315d 5b30 5d20 3c20 300a 0a20  oc[:1][0] < 0.. 
-000214e0: 2020 2023 406d 6561 7375 7265 5f74 696d     #@measure_tim
-000214f0: 650a 2020 2020 2320 4669 6e64 2069 6620  e.    # Find if 
-00021500: 7374 6f63 6b20 6761 696e 696e 6720 6275  stock gaining bu
-00021510: 6c6c 6973 6820 6d6f 6d65 6e74 756d 0a20  llish momentum. 
-00021520: 2020 2064 6566 2076 616c 6964 6174 654d     def validateM
-00021530: 6f6d 656e 7475 6d28 7365 6c66 2c20 6466  omentum(self, df
-00021540: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
-00021550: 7665 4469 6374 293a 0a20 2020 2020 2020  veDict):.       
-00021560: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
-00021570: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
-00021580: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00021590: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-000215a0: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
-000215b0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-000215c0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-000215d0: 3d20 6461 7461 2e68 6561 6428 3329 0a20  = data.head(3). 
-000215e0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-000215f0: 6e28 6461 7461 2920 3c20 333a 0a20 2020  n(data) < 3:.   
-00021600: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00021610: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00021620: 2020 2020 2020 666f 7220 726f 7720 696e        for row in
-00021630: 2064 6174 612e 6974 6572 726f 7773 2829   data.iterrows()
-00021640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021650: 2020 2320 416c 6c20 3320 6361 6e64 6c65    # All 3 candle
-00021660: 7320 7368 6f75 6c64 2062 6520 4772 6565  s should be Gree
-00021670: 6e20 616e 6420 4e4f 5420 4369 7263 7569  n and NOT Circui
-00021680: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-00021690: 2020 2079 6320 3d20 726f 775b 315d 5b22     yc = row[1]["
-000216a0: 436c 6f73 6522 5d0a 2020 2020 2020 2020  Close"].        
-000216b0: 2020 2020 2020 2020 796f 203d 2072 6f77          yo = row
-000216c0: 5b31 5d5b 224f 7065 6e22 5d0a 2020 2020  [1]["Open"].    
-000216d0: 2020 2020 2020 2020 2020 2020 6966 2079              if y
-000216e0: 6320 3c3d 2079 6f3a 0a20 2020 2020 2020  c <= yo:.       
-000216f0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00021700: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
-00021710: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-00021720: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00021730: 2020 2066 2753 746f 636b 3a7b 7361 7665     f'Stock:{save
-00021740: 4469 6374 5b22 5374 6f63 6b22 5d7d 2c20  Dict["Stock"]}, 
-00021750: 6973 206e 6f74 2061 206d 6f6d 656e 7475  is not a momentu
-00021760: 6d2d 6761 696e 6572 2062 6563 6175 7365  m-gainer because
-00021770: 2079 6573 7465 7264 6179 2d63 6c6f 7365   yesterday-close
-00021780: 2028 7b79 637d 2920 3c3d 2079 6573 7465   ({yc}) <= yeste
-00021790: 7264 6179 2d6f 7065 6e20 287b 796f 7d29  rday-open ({yo})
-000217a0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-000217b0: 2020 2020 2020 2320 290a 2020 2020 2020        # ).      
-000217c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000217d0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-000217e0: 2020 2020 2020 206f 7065 6e44 6573 6320         openDesc 
-000217f0: 3d20 6461 7461 2e73 6f72 745f 7661 6c75  = data.sort_valu
-00021800: 6573 2862 793d 5b22 4f70 656e 225d 2c20  es(by=["Open"], 
-00021810: 6173 6365 6e64 696e 673d 4661 6c73 6529  ascending=False)
-00021820: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
-00021830: 7365 4465 7363 203d 2064 6174 612e 736f  seDesc = data.so
-00021840: 7274 5f76 616c 7565 7328 6279 3d5b 2243  rt_values(by=["C
-00021850: 6c6f 7365 225d 2c20 6173 6365 6e64 696e  lose"], ascendin
-00021860: 673d 4661 6c73 6529 0a20 2020 2020 2020  g=False).       
-00021870: 2020 2020 2076 6f6c 4465 7363 203d 2064       volDesc = d
-00021880: 6174 612e 736f 7274 5f76 616c 7565 7328  ata.sort_values(
-00021890: 6279 3d5b 2256 6f6c 756d 6522 5d2c 2061  by=["Volume"], a
-000218a0: 7363 656e 6469 6e67 3d46 616c 7365 290a  scending=False).
-000218b0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-000218c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000218d0: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-000218e0: 2020 2020 2020 2020 2020 6461 7461 2e65            data.e
-000218f0: 7175 616c 7328 6f70 656e 4465 7363 290a  quals(openDesc).
-00021900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021910: 2020 2020 616e 6420 6461 7461 2e65 7175      and data.equ
-00021920: 616c 7328 636c 6f73 6544 6573 6329 0a20  als(closeDesc). 
-00021930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021940: 2020 2061 6e64 2064 6174 612e 6571 7561     and data.equa
-00021950: 6c73 2876 6f6c 4465 7363 290a 2020 2020  ls(volDesc).    
-00021960: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00021970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021980: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
-00021990: 745f 6c6f 6767 6572 2e69 6e66 6f28 0a20  t_logger.info(. 
-000219a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219b0: 2020 2023 2020 2020 2066 2753 746f 636b     #     f'Stock
-000219c0: 3a7b 7361 7665 4469 6374 5b22 5374 6f63  :{saveDict["Stoc
-000219d0: 6b22 5d7d 2c20 6f70 656e 2c63 6c6f 7365  k"]}, open,close
-000219e0: 2061 6e64 2076 6f6c 756d 6520 6571 7561   and volume equa
-000219f0: 6c20 6672 6f6d 2064 6179 2062 6566 6f72  l from day befor
-00021a00: 6520 7965 7374 6572 6461 792e 2041 2070  e yesterday. A p
-00021a10: 6f74 656e 7469 616c 206d 6f6d 656e 7475  otential momentu
-00021a20: 6d2d 6761 696e 6572 2127 0a20 2020 2020  m-gainer!'.     
-00021a30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00021a40: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00021a50: 2020 2020 2020 2074 6f20 3d20 6461 7461         to = data
-00021a60: 5b22 4f70 656e 225d 2e69 6c6f 635b 305d  ["Open"].iloc[0]
-00021a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021a80: 2020 2020 2079 6320 3d20 6461 7461 5b22       yc = data["
-00021a90: 436c 6f73 6522 5d2e 696c 6f63 5b31 5d0a  Close"].iloc[1].
-00021aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ab0: 2020 2020 796f 203d 2064 6174 615b 224f      yo = data["O
-00021ac0: 7065 6e22 5d2e 696c 6f63 5b31 5d0a 2020  pen"].iloc[1].  
+0001eb30: 2020 2020 2242 6561 7222 2069 6e20 7361      "Bear" in sa
+0001eb40: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+0001eb50: 6c22 5d20 6f72 2022 5265 7369 7374 2220  l"] or "Resist" 
+0001eb60: 696e 2073 6176 6544 6963 745b 224d 412d  in saveDict["MA-
+0001eb70: 5369 676e 616c 225d 0a20 2020 2020 2020  Signal"].       
+0001eb80: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+0001eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eba0: 6461 7461 203d 206f 7267 4461 7461 2e68  data = orgData.h
+0001ebb0: 6561 6428 6929 0a20 2020 2020 2020 2020  ead(i).         
+0001ebc0: 2020 2020 2020 2020 2020 2072 6566 4361             refCa
+0001ebd0: 6e64 6c65 203d 2064 6174 612e 7461 696c  ndle = data.tail
+0001ebe0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+0001ebf0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+0001ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec10: 2020 2020 2028 6c65 6e28 6461 7461 2e48       (len(data.H
+0001ec20: 6967 685b 6461 7461 2e48 6967 6820 3e20  igh[data.High > 
+0001ec30: 7265 6643 616e 646c 652e 4869 6768 2e69  refCandle.High.i
+0001ec40: 7465 6d28 295d 2920 3d3d 2030 290a 2020  tem()]) == 0).  
+0001ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec60: 2020 2020 2020 616e 6420 286c 656e 2864        and (len(d
+0001ec70: 6174 612e 4c6f 775b 6461 7461 2e4c 6f77  ata.Low[data.Low
+0001ec80: 203c 2072 6566 4361 6e64 6c65 2e4c 6f77   < refCandle.Low
+0001ec90: 2e69 7465 6d28 295d 2920 3d3d 2030 290a  .item()]) == 0).
+0001eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecb0: 2020 2020 2020 2020 616e 6420 286c 656e          and (len
+0001ecc0: 2864 6174 612e 4f70 656e 5b64 6174 612e  (data.Open[data.
+0001ecd0: 4f70 656e 203e 2072 6566 4361 6e64 6c65  Open > refCandle
+0001ece0: 2e48 6967 682e 6974 656d 2829 5d29 203d  .High.item()]) =
+0001ecf0: 3d20 3029 0a20 2020 2020 2020 2020 2020  = 0).           
+0001ed00: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+0001ed10: 2028 6c65 6e28 6461 7461 2e43 6c6f 7365   (len(data.Close
+0001ed20: 5b64 6174 612e 436c 6f73 6520 3c20 7265  [data.Close < re
+0001ed30: 6643 616e 646c 652e 4c6f 772e 6974 656d  fCandle.Low.item
+0001ed40: 2829 5d29 203d 3d20 3029 0a20 2020 2020  ()]) == 0).     
+0001ed50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001ed60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ed70: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+0001ed80: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+0001ed90: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edb0: 7361 7665 645b 305d 0a20 2020 2020 2020  saved[0].       
+0001edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edd0: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001ede0: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+0001edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee00: 2020 2b20 636f 6c6f 7254 6578 742e 5741    + colorText.WA
+0001ee10: 524e 0a20 2020 2020 2020 2020 2020 2020  RN.             
+0001ee20: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001ee30: 2028 2249 6e73 6964 6520 4261 7220 2825   ("Inside Bar (%
+0001ee40: 6429 2220 2520 6929 0a20 2020 2020 2020  d)" % i).       
+0001ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee60: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001ee70: 2e45 4e44 0a20 2020 2020 2020 2020 2020  .END.           
+0001ee80: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eea0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+0001eeb0: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+0001eec0: 6564 5b31 5d20 2b20 2249 6e73 6964 6520  ed[1] + "Inside 
+0001eed0: 4261 7220 2825 6429 2220 2520 690a 2020  Bar (%d)" % i.  
+0001eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eef0: 2020 2020 2020 7265 7475 726e 2069 0a20        return i. 
+0001ef00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001ef10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001ef20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ef30: 300a 2020 2020 2020 2020 7265 7475 726e  0.        return
+0001ef40: 2030 0a0a 2020 2020 2320 4669 6e64 2049   0..    # Find I
+0001ef50: 504f 2062 6173 650a 2020 2020 6465 6620  PO base.    def 
+0001ef60: 7661 6c69 6461 7465 4970 6f42 6173 6528  validateIpoBase(
+0001ef70: 7365 6c66 2c20 7374 6f63 6b2c 2064 662c  self, stock, df,
+0001ef80: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
+0001ef90: 6544 6963 742c 2070 6572 6365 6e74 6167  eDict, percentag
+0001efa0: 653d 302e 3329 3a0a 2020 2020 2020 2020  e=0.3):.        
+0001efb0: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
+0001efc0: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
+0001efd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001efe0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001eff0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
+0001f000: 0a20 2020 2020 2020 206c 6973 7469 6e67  .        listing
+0001f010: 5072 6963 6520 3d20 6461 7461 5b3a 3a2d  Price = data[::-
+0001f020: 315d 2e68 6561 6428 3129 5b22 4f70 656e  1].head(1)["Open
+0001f030: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+0001f040: 2020 2063 7572 7265 6e74 5072 6963 6520     currentPrice 
+0001f050: 3d20 6461 7461 2e68 6561 6428 3129 5b22  = data.head(1)["
+0001f060: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d0a  Close"].iloc[0].
+0001f070: 2020 2020 2020 2020 4154 4820 3d20 6461          ATH = da
+0001f080: 7461 2e64 6573 6372 6962 6528 295b 2248  ta.describe()["H
+0001f090: 6967 6822 5d5b 226d 6178 225d 0a20 2020  igh"]["max"].   
+0001f0a0: 2020 2020 2069 6620 4154 4820 3e20 286c       if ATH > (l
+0001f0b0: 6973 7469 6e67 5072 6963 6520 2b20 286c  istingPrice + (l
+0001f0c0: 6973 7469 6e67 5072 6963 6520 2a20 7065  istingPrice * pe
+0001f0d0: 7263 656e 7461 6765 2929 3a0a 2020 2020  rcentage)):.    
+0001f0e0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001f0f0: 616c 7365 0a20 2020 2020 2020 2061 7761  alse.        awa
+0001f100: 7920 3d20 726f 756e 6428 2828 6375 7272  y = round(((curr
+0001f110: 656e 7450 7269 6365 202d 206c 6973 7469  entPrice - listi
+0001f120: 6e67 5072 6963 6529 202f 206c 6973 7469  ngPrice) / listi
+0001f130: 6e67 5072 6963 6529 202a 2031 3030 2c20  ngPrice) * 100, 
+0001f140: 3129 0a20 2020 2020 2020 2069 6620 280a  1).        if (.
+0001f150: 2020 2020 2020 2020 2020 2020 286c 6973              (lis
+0001f160: 7469 6e67 5072 6963 6520 2d20 286c 6973  tingPrice - (lis
+0001f170: 7469 6e67 5072 6963 6520 2a20 7065 7263  tingPrice * perc
+0001f180: 656e 7461 6765 2929 0a20 2020 2020 2020  entage)).       
+0001f190: 2020 2020 203c 3d20 6375 7272 656e 7450       <= currentP
+0001f1a0: 7269 6365 0a20 2020 2020 2020 2020 2020  rice.           
+0001f1b0: 203c 3d20 286c 6973 7469 6e67 5072 6963   <= (listingPric
+0001f1c0: 6520 2b20 286c 6973 7469 6e67 5072 6963  e + (listingPric
+0001f1d0: 6520 2a20 7065 7263 656e 7461 6765 2929  e * percentage))
+0001f1e0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+0001f1f0: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
+0001f200: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
+0001f210: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
+0001f220: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
+0001f230: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
+0001f240: 2020 2020 2020 2020 6966 2061 7761 7920          if away 
+0001f250: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0001f260: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+0001f270: 2250 6174 7465 726e 225d 203d 2028 0a20  "Pattern"] = (. 
+0001f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f290: 2020 2073 6176 6564 5b30 5d20 0a20 2020     saved[0] .   
+0001f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2b0: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
+0001f2c0: 440a 2020 2020 2020 2020 2020 2020 2020  D.              
+0001f2d0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+0001f2e0: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
+0001f2f0: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
+0001f300: 4950 4f20 4261 7365 2028 7b61 7761 797d  IPO Base ({away}
+0001f310: 2025 2922 0a20 2020 2020 2020 2020 2020   %)".           
+0001f320: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+0001f330: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+0001f340: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001f350: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f360: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0001f370: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
+0001f380: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+0001f390: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+0001f3a0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0001f3b0: 2020 2020 2020 2020 2b20 636f 6c6f 7254          + colorT
+0001f3c0: 6578 742e 424f 4c44 0a20 2020 2020 2020  ext.BOLD.       
+0001f3d0: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+0001f3e0: 6f6c 6f72 5465 7874 2e47 5245 454e 0a20  olorText.GREEN. 
+0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f400: 2020 202b 2022 4950 4f20 4261 7365 2022     + "IPO Base "
+0001f410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f420: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+0001f430: 2e46 4149 4c0a 2020 2020 2020 2020 2020  .FAIL.          
+0001f440: 2020 2020 2020 2020 2020 2b20 6622 287b            + f"({
+0001f450: 6177 6179 7d20 2529 220a 2020 2020 2020  away} %)".      
+0001f460: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001f470: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+0001f480: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001f490: 2020 2020 2020 2020 2020 2020 7361 7665              save
+0001f4a0: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+0001f4b0: 3d20 7361 7665 645b 315d 202b 2066 2249  = saved[1] + f"I
+0001f4c0: 504f 2042 6173 6520 287b 6177 6179 7d20  PO Base ({away} 
+0001f4d0: 2529 220a 2020 2020 2020 2020 2020 2020  %)".            
+0001f4e0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+0001f4f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001f500: 0a0a 2020 2020 2340 6d65 6173 7572 655f  ..    #@measure_
+0001f510: 7469 6d65 0a20 2020 2023 2056 616c 6964  time.    # Valid
+0001f520: 6174 6520 4c6f 7265 6e74 7a69 616e 2043  ate Lorentzian C
+0001f530: 6c61 7373 6966 6963 6174 696f 6e20 7369  lassification si
+0001f540: 676e 616c 0a20 2020 2064 6566 2076 616c  gnal.    def val
+0001f550: 6964 6174 654c 6f72 656e 747a 6961 6e28  idateLorentzian(
+0001f560: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+0001f570: 4469 6374 2c20 7361 7665 4469 6374 2c20  Dict, saveDict, 
+0001f580: 6c6f 6f6b 466f 723d 3329 3a0a 2020 2020  lookFor=3):.    
+0001f590: 2020 2020 6966 2064 6620 6973 204e 6f6e      if df is Non
+0001f5a0: 6520 6f72 206c 656e 2864 6629 203d 3d20  e or len(df) == 
+0001f5b0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0001f5c0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+0001f5d0: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+0001f5e0: 7079 2829 0a20 2020 2020 2020 2023 206c  py().        # l
+0001f5f0: 6f6f 6b46 6f72 3a20 312d 4275 792c 2032  ookFor: 1-Buy, 2
+0001f600: 2d53 656c 6c2c 2033 2d41 6e79 0a20 2020  -Sell, 3-Any.   
+0001f610: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+0001f620: 5b3a 3a2d 315d 2020 2320 5265 7665 7273  [::-1]  # Revers
+0001f630: 6520 7468 6520 6461 7461 6672 616d 650a  e the dataframe.
+0001f640: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+0001f650: 6174 612e 7265 6e61 6d65 280a 2020 2020  ata.rename(.    
+0001f660: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+0001f670: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001f680: 2020 224f 7065 6e22 3a20 226f 7065 6e22    "Open": "open"
+0001f690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f6a0: 2020 2243 6c6f 7365 223a 2022 636c 6f73    "Close": "clos
+0001f6b0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+0001f6c0: 2020 2020 2248 6967 6822 3a20 2268 6967      "High": "hig
+0001f6d0: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+0001f6e0: 2020 2020 224c 6f77 223a 2022 6c6f 7722      "Low": "low"
+0001f6f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f700: 2020 2256 6f6c 756d 6522 3a20 2276 6f6c    "Volume": "vol
+0001f710: 756d 6522 2c0a 2020 2020 2020 2020 2020  ume",.          
+0001f720: 2020 7d0a 2020 2020 2020 2020 290a 2020    }.        ).  
+0001f730: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001f740: 2020 2020 2020 2077 6974 6820 5375 7070         with Supp
+0001f750: 7265 7373 4f75 7470 7574 2873 7570 7072  ressOutput(suppr
+0001f760: 6573 735f 7374 646f 7574 3d54 7275 652c  ess_stdout=True,
+0001f770: 2073 7570 7072 6573 735f 7374 6465 7272   suppress_stderr
+0001f780: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0001f790: 2020 2020 2020 2020 6c63 203d 2061 7461          lc = ata
+0001f7a0: 2e4c 6f72 656e 747a 6961 6e43 6c61 7373  .LorentzianClass
+0001f7b0: 6966 6963 6174 696f 6e28 6461 7461 3d64  ification(data=d
+0001f7c0: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
+0001f7d0: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
+0001f7e0: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+0001f7f0: 6c75 6528 7363 7265 656e 4469 6374 2c20  lue(screenDict, 
+0001f800: 7361 7665 4469 6374 2c20 2250 6174 7465  saveDict, "Patte
+0001f810: 726e 2229 0a20 2020 2020 2020 2020 2020  rn").           
+0001f820: 2069 6620 6c63 2e64 662e 696c 6f63 5b2d   if lc.df.iloc[-
+0001f830: 315d 5b22 6973 4e65 7742 7579 5369 676e  1]["isNewBuySign
+0001f840: 616c 225d 3a0a 2020 2020 2020 2020 2020  al"]:.          
+0001f850: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+0001f860: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
+0001f870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f880: 2020 2020 7361 7665 645b 305d 202b 2063      saved[0] + c
+0001f890: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+0001f8a0: 636f 6c6f 7254 6578 742e 4752 4545 4e20  colorText.GREEN 
+0001f8b0: 2b20 224c 6f72 656e 747a 6961 6e2d 4275  + "Lorentzian-Bu
+0001f8c0: 7922 202b 2063 6f6c 6f72 5465 7874 2e45  y" + colorText.E
+0001f8d0: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+0001f8e0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001f8f0: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
+0001f900: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
+0001f910: 5b31 5d20 2b20 224c 6f72 656e 747a 6961  [1] + "Lorentzia
+0001f920: 6e2d 4275 7922 0a20 2020 2020 2020 2020  n-Buy".         
+0001f930: 2020 2020 2020 2069 6620 6c6f 6f6b 466f         if lookFo
+0001f940: 7220 213d 2032 3a20 2320 4e6f 7420 5365  r != 2: # Not Se
+0001f950: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
+0001f960: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001f970: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
+0001f980: 6c69 6620 6c63 2e64 662e 696c 6f63 5b2d  lif lc.df.iloc[-
+0001f990: 315d 5b22 6973 4e65 7753 656c 6c53 6967  1]["isNewSellSig
+0001f9a0: 6e61 6c22 5d3a 0a20 2020 2020 2020 2020  nal"]:.         
+0001f9b0: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+0001f9c0: 745b 2250 6174 7465 726e 225d 203d 2028  t["Pattern"] = (
+0001f9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f9e0: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
+0001f9f0: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
+0001fa00: 2063 6f6c 6f72 5465 7874 2e46 4149 4c20   colorText.FAIL 
+0001fa10: 2b20 224c 6f72 656e 747a 6961 6e2d 5365  + "Lorentzian-Se
+0001fa20: 6c6c 2220 2b20 636f 6c6f 7254 6578 742e  ll" + colorText.
+0001fa30: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+0001fa40: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001fa50: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+0001fa60: 5061 7474 6572 6e22 5d20 3d20 7361 7665  Pattern"] = save
+0001fa70: 645b 315d 202b 2022 4c6f 7265 6e74 7a69  d[1] + "Lorentzi
+0001fa80: 616e 2d53 656c 6c22 0a20 2020 2020 2020  an-Sell".       
+0001fa90: 2020 2020 2020 2020 2069 6620 6c6f 6f6b           if look
+0001faa0: 466f 7220 213d 2031 3a20 2320 4e6f 7420  For != 1: # Not 
+0001fab0: 4275 790a 2020 2020 2020 2020 2020 2020  Buy.            
+0001fac0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001fad0: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
+0001fae0: 7074 2045 7863 6570 7469 6f6e 3a20 2023  pt Exception:  #
+0001faf0: 2070 7261 676d 613a 206e 6f20 636f 7665   pragma: no cove
+0001fb00: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
+0001fb10: 5661 6c75 6545 7272 6f72 3a20 6f70 6572  ValueError: oper
+0001fb20: 616e 6473 2063 6f75 6c64 206e 6f74 2062  ands could not b
+0001fb30: 6520 6272 6f61 6463 6173 7420 746f 6765  e broadcast toge
+0001fb40: 7468 6572 2077 6974 6820 7368 6170 6573  ther with shapes
+0001fb50: 2028 3230 2c29 2028 3236 2c29 0a20 2020   (20,) (26,).   
+0001fb60: 2020 2020 2020 2020 2023 2046 696c 6520           # File 
+0001fb70: 222f 6f70 742f 686f 6d65 6272 6577 2f6c  "/opt/homebrew/l
+0001fb80: 6962 2f70 7974 686f 6e33 2e31 312f 7369  ib/python3.11/si
+0001fb90: 7465 2d70 6163 6b61 6765 732f 6164 7661  te-packages/adva
+0001fba0: 6e63 6564 5f74 612f 4c6f 7265 6e74 7a69  nced_ta/Lorentzi
+0001fbb0: 616e 436c 6173 7369 6669 6361 7469 6f6e  anClassification
+0001fbc0: 2f43 6c61 7373 6966 6965 722e 7079 222c  /Classifier.py",
+0001fbd0: 206c 696e 6520 3138 362c 2069 6e20 5f5f   line 186, in __
+0001fbe0: 696e 6974 5f5f 0a20 2020 2020 2020 2020  init__.         
+0001fbf0: 2020 2023 2046 696c 6520 222f 6f70 742f     # File "/opt/
+0001fc00: 686f 6d65 6272 6577 2f6c 6962 2f70 7974  homebrew/lib/pyt
+0001fc10: 686f 6e33 2e31 312f 7369 7465 2d70 6163  hon3.11/site-pac
+0001fc20: 6b61 6765 732f 6164 7661 6e63 6564 5f74  kages/advanced_t
+0001fc30: 612f 4c6f 7265 6e74 7a69 616e 436c 6173  a/LorentzianClas
+0001fc40: 7369 6669 6361 7469 6f6e 2f43 6c61 7373  sification/Class
+0001fc50: 6966 6965 722e 7079 222c 206c 696e 6520  ifier.py", line 
+0001fc60: 3339 352c 2069 6e20 5f5f 636c 6173 7369  395, in __classi
+0001fc70: 6679 0a20 2020 2020 2020 2020 2020 2023  fy.            #
+0001fc80: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
+0001fc90: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
+0001fca0: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
+0001fcb0: 732f 7061 6e64 6173 2f63 6f72 652f 6f70  s/pandas/core/op
+0001fcc0: 732f 636f 6d6d 6f6e 2e70 7922 2c20 6c69  s/common.py", li
+0001fcd0: 6e65 2037 362c 2069 6e20 6e65 775f 6d65  ne 76, in new_me
+0001fce0: 7468 6f64 0a20 2020 2020 2020 2020 2020  thod.           
+0001fcf0: 2023 2046 696c 6520 222f 6f70 742f 686f   # File "/opt/ho
+0001fd00: 6d65 6272 6577 2f6c 6962 2f70 7974 686f  mebrew/lib/pytho
+0001fd10: 6e33 2e31 312f 7369 7465 2d70 6163 6b61  n3.11/site-packa
+0001fd20: 6765 732f 7061 6e64 6173 2f63 6f72 652f  ges/pandas/core/
+0001fd30: 6172 7261 796c 696b 652e 7079 222c 206c  arraylike.py", l
+0001fd40: 696e 6520 3730 2c20 696e 205f 5f61 6e64  ine 70, in __and
+0001fd50: 5f5f 0a20 2020 2020 2020 2020 2020 2023  __.            #
+0001fd60: 2046 696c 6520 222f 6f70 742f 686f 6d65   File "/opt/home
+0001fd70: 6272 6577 2f6c 6962 2f70 7974 686f 6e33  brew/lib/python3
+0001fd80: 2e31 312f 7369 7465 2d70 6163 6b61 6765  .11/site-package
+0001fd90: 732f 7061 6e64 6173 2f63 6f72 652f 7365  s/pandas/core/se
+0001fda0: 7269 6573 2e70 7922 2c20 6c69 6e65 2035  ries.py", line 5
+0001fdb0: 3831 302c 2069 6e20 5f6c 6f67 6963 616c  810, in _logical
+0001fdc0: 5f6d 6574 686f 640a 2020 2020 2020 2020  _method.        
+0001fdd0: 2020 2020 2320 4669 6c65 2022 2f6f 7074      # File "/opt
+0001fde0: 2f68 6f6d 6562 7265 772f 6c69 622f 7079  /homebrew/lib/py
+0001fdf0: 7468 6f6e 332e 3131 2f73 6974 652d 7061  thon3.11/site-pa
+0001fe00: 636b 6167 6573 2f70 616e 6461 732f 636f  ckages/pandas/co
+0001fe10: 7265 2f6f 7073 2f61 7272 6179 5f6f 7073  re/ops/array_ops
+0001fe20: 2e70 7922 2c20 6c69 6e65 2034 3536 2c20  .py", line 456, 
+0001fe30: 696e 206c 6f67 6963 616c 5f6f 700a 2020  in logical_op.  
+0001fe40: 2020 2020 2020 2020 2020 2320 4669 6c65            # File
+0001fe50: 2022 2f6f 7074 2f68 6f6d 6562 7265 772f   "/opt/homebrew/
+0001fe60: 6c69 622f 7079 7468 6f6e 332e 3131 2f73  lib/python3.11/s
+0001fe70: 6974 652d 7061 636b 6167 6573 2f70 616e  ite-packages/pan
+0001fe80: 6461 732f 636f 7265 2f6f 7073 2f61 7272  das/core/ops/arr
+0001fe90: 6179 5f6f 7073 2e70 7922 2c20 6c69 6e65  ay_ops.py", line
+0001fea0: 2033 3634 2c20 696e 206e 615f 6c6f 6769   364, in na_logi
+0001feb0: 6361 6c5f 6f70 0a20 2020 2020 2020 2020  cal_op.         
+0001fec0: 2020 2023 2073 656c 662e 6465 6661 756c     # self.defaul
+0001fed0: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
+0001fee0: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
+0001fef0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0001ff00: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+0001ff10: 2046 616c 7365 0a0a 2020 2020 2320 7661   False..    # va
+0001ff20: 6c69 6461 7465 2069 6620 7468 6520 7374  lidate if the st
+0001ff30: 6f63 6b20 6861 7320 6265 656e 2068 6176  ock has been hav
+0001ff40: 696e 6720 6c6f 7765 7220 6c6f 7773 2c20  ing lower lows, 
+0001ff50: 6c6f 7765 7220 6869 6768 730a 2020 2020  lower highs.    
+0001ff60: 6465 6620 7661 6c69 6461 7465 4c6f 7765  def validateLowe
+0001ff70: 7248 6967 6873 4c6f 7765 724c 6f77 7328  rHighsLowerLows(
+0001ff80: 7365 6c66 2c20 6466 293a 0a20 2020 2020  self, df):.     
+0001ff90: 2020 2069 6620 6466 2069 7320 4e6f 6e65     if df is None
+0001ffa0: 206f 7220 6c65 6e28 6466 2920 3d3d 2030   or len(df) == 0
+0001ffb0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001ffc0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+0001ffd0: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+0001ffe0: 7928 290a 2020 2020 2020 2020 6461 7930  y().        day0
+0001fff0: 203d 2064 6174 610a 2020 2020 2020 2020   = data.        
+00020000: 6461 7931 203d 2064 6174 615b 313a 5d0a  day1 = data[1:].
+00020010: 2020 2020 2020 2020 6461 7932 203d 2064          day2 = d
+00020020: 6174 615b 323a 5d0a 2020 2020 2020 2020  ata[2:].        
+00020030: 6461 7933 203d 2064 6174 615b 333a 5d0a  day3 = data[3:].
+00020040: 2020 2020 2020 2020 6c6f 7765 7248 6967          lowerHig
+00020050: 6873 203d 2028 0a20 2020 2020 2020 2020  hs = (.         
+00020060: 2020 2028 6461 7930 5b22 4869 6768 225d     (day0["High"]
+00020070: 2e69 6c6f 635b 305d 203c 2064 6179 315b  .iloc[0] < day1[
+00020080: 2248 6967 6822 5d2e 696c 6f63 5b30 5d29  "High"].iloc[0])
+00020090: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+000200a0: 2028 6461 7931 5b22 4869 6768 225d 2e69   (day1["High"].i
+000200b0: 6c6f 635b 305d 203c 2064 6179 325b 2248  loc[0] < day2["H
+000200c0: 6967 6822 5d2e 696c 6f63 5b30 5d29 0a20  igh"].iloc[0]). 
+000200d0: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
+000200e0: 6461 7932 5b22 4869 6768 225d 2e69 6c6f  day2["High"].ilo
+000200f0: 635b 305d 203c 2064 6179 335b 2248 6967  c[0] < day3["Hig
+00020100: 6822 5d2e 696c 6f63 5b30 5d29 0a20 2020  h"].iloc[0]).   
+00020110: 2020 2020 2029 0a20 2020 2020 2020 206c       ).        l
+00020120: 6f77 6572 4c6f 7773 203d 2028 0a20 2020  owerLows = (.   
+00020130: 2020 2020 2020 2020 2028 6461 7930 5b22           (day0["
+00020140: 4c6f 7722 5d2e 696c 6f63 5b30 5d20 3c20  Low"].iloc[0] < 
+00020150: 6461 7931 5b22 4c6f 7722 5d2e 696c 6f63  day1["Low"].iloc
+00020160: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+00020170: 2061 6e64 2028 6461 7931 5b22 4c6f 7722   and (day1["Low"
+00020180: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7932  ].iloc[0] < day2
+00020190: 5b22 4c6f 7722 5d2e 696c 6f63 5b30 5d29  ["Low"].iloc[0])
+000201a0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+000201b0: 2028 6461 7932 5b22 4c6f 7722 5d2e 696c   (day2["Low"].il
+000201c0: 6f63 5b30 5d20 3c20 6461 7933 5b22 4c6f  oc[0] < day3["Lo
+000201d0: 7722 5d2e 696c 6f63 5b30 5d29 0a20 2020  w"].iloc[0]).   
+000201e0: 2020 2020 2029 0a20 2020 2020 2020 2068       ).        h
+000201f0: 6967 6865 7252 5349 203d 2028 0a20 2020  igherRSI = (.   
+00020200: 2020 2020 2020 2020 2028 6461 7930 5b22           (day0["
+00020210: 5253 4922 5d2e 696c 6f63 5b30 5d20 3c20  RSI"].iloc[0] < 
+00020220: 6461 7931 5b22 5253 4922 5d2e 696c 6f63  day1["RSI"].iloc
+00020230: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+00020240: 2061 6e64 2028 6461 7931 5b22 5253 4922   and (day1["RSI"
+00020250: 5d2e 696c 6f63 5b30 5d20 3c20 6461 7932  ].iloc[0] < day2
+00020260: 5b22 5253 4922 5d2e 696c 6f63 5b30 5d29  ["RSI"].iloc[0])
+00020270: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00020280: 2028 6461 7932 5b22 5253 4922 5d2e 696c   (day2["RSI"].il
+00020290: 6f63 5b30 5d20 3c20 6461 7933 5b22 5253  oc[0] < day3["RS
+000202a0: 4922 5d2e 696c 6f63 5b30 5d29 0a20 2020  I"].iloc[0]).   
+000202b0: 2020 2020 2020 2020 2061 6e64 2064 6179           and day
+000202c0: 305b 2252 5349 225d 2e69 6c6f 635b 305d  0["RSI"].iloc[0]
+000202d0: 203e 3d20 3530 0a20 2020 2020 2020 2029   >= 50.        )
+000202e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000202f0: 6c6f 7765 7248 6967 6873 2061 6e64 206c  lowerHighs and l
+00020300: 6f77 6572 4c6f 7773 2061 6e64 2068 6967  owerLows and hig
+00020310: 6865 7252 5349 0a0a 2020 2020 2320 5661  herRSI..    # Va
+00020320: 6c69 6461 7465 2069 6620 7265 6365 6e74  lidate if recent
+00020330: 2076 6f6c 756d 6520 6973 206c 6f77 6573   volume is lowes
+00020340: 7420 6f66 206c 6173 7420 274e 2720 4461  t of last 'N' Da
+00020350: 7973 0a20 2020 2064 6566 2076 616c 6964  ys.    def valid
+00020360: 6174 654c 6f77 6573 7456 6f6c 756d 6528  ateLowestVolume(
+00020370: 7365 6c66 2c20 6466 2c20 6461 7973 466f  self, df, daysFo
+00020380: 724c 6f77 6573 7456 6f6c 756d 6529 3a0a  rLowestVolume):.
+00020390: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+000203a0: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+000203b0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000203c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000203d0: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+000203e0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+000203f0: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
+00020400: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
+00020410: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
+00020420: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
+00020430: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
+00020440: 2069 6620 6461 7973 466f 724c 6f77 6573   if daysForLowes
+00020450: 7456 6f6c 756d 6520 6973 204e 6f6e 653a  tVolume is None:
+00020460: 0a20 2020 2020 2020 2020 2020 2064 6179  .            day
+00020470: 7346 6f72 4c6f 7765 7374 566f 6c75 6d65  sForLowestVolume
+00020480: 203d 2033 300a 2020 2020 2020 2020 6966   = 30.        if
+00020490: 206c 656e 2864 6174 6129 203c 2064 6179   len(data) < day
+000204a0: 7346 6f72 4c6f 7765 7374 566f 6c75 6d65  sForLowestVolume
+000204b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000204c0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+000204d0: 2020 2064 6174 6120 3d20 6461 7461 2e68     data = data.h
+000204e0: 6561 6428 6461 7973 466f 724c 6f77 6573  ead(daysForLowes
+000204f0: 7456 6f6c 756d 6529 0a20 2020 2020 2020  tVolume).       
+00020500: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
+00020510: 6561 6428 3129 0a20 2020 2020 2020 2069  ead(1).        i
+00020520: 6620 6c65 6e28 7265 6365 6e74 2920 3c20  f len(recent) < 
+00020530: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
+00020540: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00020550: 2020 2020 6966 2028 7265 6365 6e74 5b22      if (recent["
+00020560: 566f 6c75 6d65 225d 2e69 6c6f 635b 305d  Volume"].iloc[0]
+00020570: 203c 3d20 6461 7461 2e64 6573 6372 6962   <= data.describ
+00020580: 6528 295b 2256 6f6c 756d 6522 5d5b 226d  e()["Volume"]["m
+00020590: 696e 225d 2920 616e 6420 7265 6365 6e74  in"]) and recent
+000205a0: 5b0a 2020 2020 2020 2020 2020 2020 2256  [.            "V
+000205b0: 6f6c 756d 6522 0a20 2020 2020 2020 205d  olume".        ]
+000205c0: 5b30 5d20 213d 206e 702e 6e61 6e3a 0a20  [0] != np.nan:. 
+000205d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000205e0: 6e20 5472 7565 0a20 2020 2020 2020 2072  n True.        r
+000205f0: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+00020600: 2023 2056 616c 6964 6174 6520 4c54 5020   # Validate LTP 
+00020610: 7769 7468 696e 206c 696d 6974 730a 2020  within limits.  
+00020620: 2020 6465 6620 7661 6c69 6461 7465 4c54    def validateLT
+00020630: 5028 7365 6c66 2c20 6466 2c20 7363 7265  P(self, df, scre
+00020640: 656e 4469 6374 2c20 7361 7665 4469 6374  enDict, saveDict
+00020650: 2c20 6d69 6e4c 5450 3d4e 6f6e 652c 206d  , minLTP=None, m
+00020660: 6178 4c54 503d 4e6f 6e65 2c6d 696e 4368  axLTP=None,minCh
+00020670: 616e 6765 3d30 293a 0a20 2020 2020 2020  ange=0):.       
+00020680: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00020690: 290a 2020 2020 2020 2020 6c74 7056 616c  ).        ltpVal
+000206a0: 6964 203d 2046 616c 7365 0a20 2020 2020  id = False.     
+000206b0: 2020 2069 6620 6d69 6e4c 5450 2069 7320     if minLTP is 
+000206c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000206d0: 2020 6d69 6e4c 5450 203d 2073 656c 662e    minLTP = self.
+000206e0: 636f 6e66 6967 4d61 6e61 6765 722e 6d69  configManager.mi
+000206f0: 6e4c 5450 0a20 2020 2020 2020 2069 6620  nLTP.        if 
+00020700: 6d61 784c 5450 2069 7320 4e6f 6e65 3a0a  maxLTP is None:.
+00020710: 2020 2020 2020 2020 2020 2020 6d61 784c              maxL
+00020720: 5450 203d 2073 656c 662e 636f 6e66 6967  TP = self.config
+00020730: 4d61 6e61 6765 722e 6d61 784c 5450 0a20  Manager.maxLTP. 
+00020740: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00020750: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+00020760: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+00020770: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+00020780: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+00020790: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
+000207a0: 6461 7461 2e68 6561 6428 3129 0a0a 2020  data.head(1)..  
+000207b0: 2020 2020 2020 7063 745f 6368 616e 6765        pct_change
+000207c0: 203d 2028 6461 7461 5b3a 3a2d 315d 5b22   = (data[::-1]["
+000207d0: 436c 6f73 6522 5d2e 7063 745f 6368 616e  Close"].pct_chan
+000207e0: 6765 2829 202a 2031 3030 292e 696c 6f63  ge() * 100).iloc
+000207f0: 5b2d 315d 0a20 2020 2020 2020 2069 6620  [-1].        if 
+00020800: 7063 745f 6368 616e 6765 203d 3d20 6e70  pct_change == np
+00020810: 2e69 6e66 206f 7220 7063 745f 6368 616e  .inf or pct_chan
+00020820: 6765 203d 3d20 2d6e 702e 696e 663a 0a20  ge == -np.inf:. 
+00020830: 2020 2020 2020 2020 2020 2070 6374 5f63             pct_c
+00020840: 6861 6e67 6520 3d20 300a 2020 2020 2020  hange = 0.      
+00020850: 2020 7063 745f 7361 7665 203d 2022 252e    pct_save = "%.
+00020860: 3166 2525 2220 2520 7063 745f 6368 616e  1f%%" % pct_chan
+00020870: 6765 0a20 2020 2020 2020 2069 6620 7063  ge.        if pc
+00020880: 745f 6368 616e 6765 203e 2030 2e32 3a0a  t_change > 0.2:.
+00020890: 2020 2020 2020 2020 2020 2020 7063 745f              pct_
+000208a0: 6368 616e 6765 203d 2063 6f6c 6f72 5465  change = colorTe
+000208b0: 7874 2e47 5245 454e 202b 2028 2225 2e31  xt.GREEN + ("%.1
+000208c0: 6625 2522 2025 2070 6374 5f63 6861 6e67  f%%" % pct_chang
+000208d0: 6529 202b 2063 6f6c 6f72 5465 7874 2e45  e) + colorText.E
+000208e0: 4e44 0a20 2020 2020 2020 2065 6c69 6620  ND.        elif 
+000208f0: 7063 745f 6368 616e 6765 203c 202d 302e  pct_change < -0.
+00020900: 323a 0a20 2020 2020 2020 2020 2020 2070  2:.            p
+00020910: 6374 5f63 6861 6e67 6520 3d20 636f 6c6f  ct_change = colo
+00020920: 7254 6578 742e 4641 494c 202b 2028 2225  rText.FAIL + ("%
+00020930: 2e31 6625 2522 2025 2070 6374 5f63 6861  .1f%%" % pct_cha
+00020940: 6e67 6529 202b 2063 6f6c 6f72 5465 7874  nge) + colorText
+00020950: 2e45 4e44 0a20 2020 2020 2020 2065 6c73  .END.        els
+00020960: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00020970: 6374 5f63 6861 6e67 6520 3d20 636f 6c6f  ct_change = colo
+00020980: 7254 6578 742e 5741 524e 202b 2028 2225  rText.WARN + ("%
+00020990: 2e31 6625 2522 2025 2070 6374 5f63 6861  .1f%%" % pct_cha
+000209a0: 6e67 6529 202b 2063 6f6c 6f72 5465 7874  nge) + colorText
+000209b0: 2e45 4e44 0a20 2020 2020 2020 2073 6176  .END.        sav
+000209c0: 6544 6963 745b 2225 4368 6e67 225d 203d  eDict["%Chng"] =
+000209d0: 2070 6374 5f73 6176 650a 2020 2020 2020   pct_save.      
+000209e0: 2020 7363 7265 656e 4469 6374 5b22 2543    screenDict["%C
+000209f0: 686e 6722 5d20 3d20 7063 745f 6368 616e  hng"] = pct_chan
+00020a00: 6765 0a20 2020 2020 2020 206c 7470 203d  ge.        ltp =
+00020a10: 2072 6f75 6e64 2872 6563 656e 745b 2243   round(recent["C
+00020a20: 6c6f 7365 225d 2e69 6c6f 635b 305d 2c20  lose"].iloc[0], 
+00020a30: 3229 0a20 2020 2020 2020 2076 6572 6966  2).        verif
+00020a40: 7953 7461 6765 5477 6f20 3d20 5472 7565  yStageTwo = True
+00020a50: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00020a60: 6461 7461 2920 3e20 3235 303a 0a20 2020  data) > 250:.   
+00020a70: 2020 2020 2020 2020 2079 6561 726c 794c           yearlyL
+00020a80: 6f77 203d 2064 6174 612e 6865 6164 2832  ow = data.head(2
+00020a90: 3530 295b 2243 6c6f 7365 225d 2e6d 696e  50)["Close"].min
+00020aa0: 2829 0a20 2020 2020 2020 2020 2020 2079  ().            y
+00020ab0: 6561 726c 7948 6967 6820 3d20 6461 7461  earlyHigh = data
+00020ac0: 2e68 6561 6428 3235 3029 5b22 436c 6f73  .head(250)["Clos
+00020ad0: 6522 5d2e 6d61 7828 290a 2020 2020 2020  e"].max().      
+00020ae0: 2020 2020 2020 6966 206c 7470 203c 2028        if ltp < (
+00020af0: 3220 2a20 7965 6172 6c79 4c6f 7729 2061  2 * yearlyLow) a
+00020b00: 6e64 206c 7470 203c 2028 302e 3735 202a  nd ltp < (0.75 *
+00020b10: 2079 6561 726c 7948 6967 6829 3a0a 2020   yearlyHigh):.  
+00020b20: 2020 2020 2020 2020 2020 2020 2020 7665                ve
+00020b30: 7269 6679 5374 6167 6554 776f 203d 2046  rifyStageTwo = F
+00020b40: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00020b50: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00020b60: 2253 746f 636b 225d 203d 2063 6f6c 6f72  "Stock"] = color
+00020b70: 5465 7874 2e46 4149 4c20 2b20 7361 7665  Text.FAIL + save
+00020b80: 4469 6374 5b22 5374 6f63 6b22 5d20 2b20  Dict["Stock"] + 
+00020b90: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+00020ba0: 2020 2020 2020 6966 206c 7470 203e 3d20        if ltp >= 
+00020bb0: 6d69 6e4c 5450 2061 6e64 206c 7470 203c  minLTP and ltp <
+00020bc0: 3d20 6d61 784c 5450 3a0a 2020 2020 2020  = maxLTP:.      
+00020bd0: 2020 2020 2020 6c74 7056 616c 6964 203d        ltpValid =
+00020be0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00020bf0: 2020 6966 206d 696e 4368 616e 6765 2021    if minChange !
+00020c00: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00020c10: 2020 2020 2023 2055 7365 7220 6861 7320       # User has 
+00020c20: 7375 7070 6c69 6564 2073 6f6d 6520 6669  supplied some fi
+00020c30: 6c74 6572 2066 6f72 2070 6572 6365 6e74  lter for percent
+00020c40: 6167 6520 6368 616e 6765 0a20 2020 2020  age change.     
+00020c50: 2020 2020 2020 2020 2020 206c 7470 5661             ltpVa
+00020c60: 6c69 6420 3d20 666c 6f61 7428 7374 7228  lid = float(str(
+00020c70: 7063 745f 7361 7665 292e 7265 706c 6163  pct_save).replac
+00020c80: 6528 2225 222c 2222 2929 203e 3d20 6d69  e("%","")) >= mi
+00020c90: 6e43 6861 6e67 650a 2020 2020 2020 2020  nChange.        
+00020ca0: 2020 2020 7361 7665 4469 6374 5b22 4c54      saveDict["LT
+00020cb0: 5022 5d20 3d20 726f 756e 6428 6c74 702c  P"] = round(ltp,
+00020cc0: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+00020cd0: 7363 7265 656e 4469 6374 5b22 4c54 5022  screenDict["LTP"
+00020ce0: 5d20 3d20 2863 6f6c 6f72 5465 7874 2e47  ] = (colorText.G
+00020cf0: 5245 454e 2069 6620 6c74 7056 616c 6964  REEN if ltpValid
+00020d00: 2065 6c73 6520 636f 6c6f 7254 6578 742e   else colorText.
+00020d10: 4641 494c 2920 2b20 2822 252e 3266 2220  FAIL) + ("%.2f" 
+00020d20: 2520 6c74 7029 202b 2063 6f6c 6f72 5465  % ltp) + colorTe
+00020d30: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00020d40: 2020 2072 6574 7572 6e20 6c74 7056 616c     return ltpVal
+00020d50: 6964 2c20 7665 7269 6679 5374 6167 6554  id, verifyStageT
+00020d60: 776f 0a20 2020 2020 2020 2073 6372 6565  wo.        scree
+00020d70: 6e44 6963 745b 224c 5450 225d 203d 2063  nDict["LTP"] = c
+00020d80: 6f6c 6f72 5465 7874 2e46 4149 4c20 2b20  olorText.FAIL + 
+00020d90: 2822 252e 3266 2220 2520 6c74 7029 202b  ("%.2f" % ltp) +
+00020da0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00020db0: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00020dc0: 224c 5450 225d 203d 2072 6f75 6e64 286c  "LTP"] = round(l
+00020dd0: 7470 2c20 3229 0a20 2020 2020 2020 2072  tp, 2).        r
+00020de0: 6574 7572 6e20 6c74 7056 616c 6964 2c20  eturn ltpValid, 
+00020df0: 7665 7269 6679 5374 6167 6554 776f 0a0a  verifyStageTwo..
+00020e00: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00020e10: 4c54 5046 6f72 506f 7274 666f 6c69 6f43  LTPForPortfolioC
+00020e20: 616c 6328 7365 6c66 2c20 6466 2c20 7363  alc(self, df, sc
+00020e30: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+00020e40: 6374 2c72 6571 7565 7374 6564 5065 7269  ct,requestedPeri
+00020e50: 6f64 3d30 293a 0a20 2020 2020 2020 2064  od=0):.        d
+00020e60: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+00020e70: 2020 2020 2020 2020 7065 7269 6f64 7320          periods 
+00020e80: 3d20 7365 6c66 2e63 6f6e 6669 674d 616e  = self.configMan
+00020e90: 6167 6572 2e70 6572 696f 6473 5261 6e67  ager.periodsRang
+00020ea0: 650a 2020 2020 2020 2020 6966 2072 6571  e.        if req
+00020eb0: 7565 7374 6564 5065 7269 6f64 203e 2030  uestedPeriod > 0
+00020ec0: 2061 6e64 2072 6571 7565 7374 6564 5065   and requestedPe
+00020ed0: 7269 6f64 206e 6f74 2069 6e20 7065 7269  riod not in peri
+00020ee0: 6f64 733a 0a20 2020 2020 2020 2020 2020  ods:.           
+00020ef0: 2070 6572 696f 6473 2e61 7070 656e 6428   periods.append(
+00020f00: 7265 7175 6573 7465 6450 6572 696f 6429  requestedPeriod)
+00020f10: 0a20 2020 2020 2020 2070 7265 7669 6f75  .        previou
+00020f20: 735f 7265 6365 6e74 203d 2064 6174 612e  s_recent = data.
+00020f30: 6865 6164 2831 290a 2020 2020 2020 2020  head(1).        
+00020f40: 7072 6576 696f 7573 5f72 6563 656e 742e  previous_recent.
+00020f50: 7265 7365 745f 696e 6465 7828 696e 706c  reset_index(inpl
+00020f60: 6163 653d 5472 7565 290a 2020 2020 2020  ace=True).      
+00020f70: 2020 6361 6c63 5f64 6174 6520 3d20 7374    calc_date = st
+00020f80: 7228 7072 6576 696f 7573 5f72 6563 656e  r(previous_recen
+00020f90: 742e 696c 6f63 5b3a 2c20 305d 5b30 5d29  t.iloc[:, 0][0])
+00020fa0: 2e73 706c 6974 2822 2022 295b 305d 0a20  .split(" ")[0]. 
+00020fb0: 2020 2020 2020 2066 6f72 2070 7264 2069         for prd i
+00020fc0: 6e20 7065 7269 6f64 733a 0a20 2020 2020  n periods:.     
+00020fd0: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
+00020fe0: 7461 2920 3e3d 2070 7264 202b 2031 3a0a  ta) >= prd + 1:.
+00020ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021000: 7072 6576 4c74 7020 3d20 6461 7461 5b22  prevLtp = data["
+00021010: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d0a  Close"].iloc[0].
+00021020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021030: 6c74 7054 6479 203d 2064 6174 615b 2243  ltpTdy = data["C
+00021040: 6c6f 7365 225d 2e69 6c6f 635b 7072 645d  lose"].iloc[prd]
+00021050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021060: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
+00021070: 7265 764c 7470 2c70 642e 5365 7269 6573  revLtp,pd.Series
+00021080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00021090: 2020 2020 2020 2070 7265 764c 7470 203d         prevLtp =
+000210a0: 2070 7265 764c 7470 5b30 5d0a 2020 2020   prevLtp[0].    
+000210b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210c0: 6c74 7054 6479 203d 206c 7470 5464 795b  ltpTdy = ltpTdy[
+000210d0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+000210e0: 2020 2073 6372 6565 6e44 6963 745b 6622     screenDict[f"
+000210f0: 4c54 507b 7072 647d 225d 203d 2028 0a20  LTP{prd}"] = (. 
+00021100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021110: 2020 2028 636f 6c6f 7254 6578 742e 4752     (colorText.GR
+00021120: 4545 4e20 6966 2028 6c74 7054 6479 203e  EEN if (ltpTdy >
+00021130: 3d20 7072 6576 4c74 7029 2065 6c73 6520  = prevLtp) else 
+00021140: 2863 6f6c 6f72 5465 7874 2e46 4149 4c29  (colorText.FAIL)
+00021150: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021160: 2020 2020 2020 2b20 7374 7228 227b 3a2e        + str("{:.
+00021170: 3266 7d22 2e66 6f72 6d61 7428 6c74 7054  2f}".format(ltpT
+00021180: 6479 2929 0a20 2020 2020 2020 2020 2020  dy)).           
+00021190: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+000211a0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+000211b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000211c0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+000211d0: 6e44 6963 745b 6622 4772 6f77 7468 7b70  nDict[f"Growth{p
+000211e0: 7264 7d22 5d20 3d20 280a 2020 2020 2020  rd}"] = (.      
+000211f0: 2020 2020 2020 2020 2020 2020 2020 2863                (c
+00021200: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
+00021210: 6620 286c 7470 5464 7920 3e3d 2070 7265  f (ltpTdy >= pre
+00021220: 764c 7470 2920 656c 7365 2028 636f 6c6f  vLtp) else (colo
+00021230: 7254 6578 742e 4641 494c 2929 0a20 2020  rText.FAIL)).   
+00021240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021250: 202b 2073 7472 2822 7b3a 2e32 667d 222e   + str("{:.2f}".
+00021260: 666f 726d 6174 286c 7470 5464 7920 2d20  format(ltpTdy - 
+00021270: 7072 6576 4c74 7029 290a 2020 2020 2020  prevLtp)).      
+00021280: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00021290: 636f 6c6f 7254 6578 742e 454e 440a 2020  colorText.END.  
+000212a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000212b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212c0: 7361 7665 4469 6374 5b66 224c 5450 7b70  saveDict[f"LTP{p
+000212d0: 7264 7d22 5d20 3d20 726f 756e 6428 6c74  rd}"] = round(lt
+000212e0: 7054 6479 2c20 3229 0a20 2020 2020 2020  pTdy, 2).       
+000212f0: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
+00021300: 745b 6622 4772 6f77 7468 7b70 7264 7d22  t[f"Growth{prd}"
+00021310: 5d20 3d20 726f 756e 6428 6c74 7054 6479  ] = round(ltpTdy
+00021320: 202d 2070 7265 764c 7470 2c20 3229 0a20   - prevLtp, 2). 
+00021330: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021340: 6620 7072 6420 3d3d 2032 3220 6f72 2028  f prd == 22 or (
+00021350: 7072 6420 3d3d 2072 6571 7565 7374 6564  prd == requested
+00021360: 5065 7269 6f64 293a 0a20 2020 2020 2020  Period):.       
+00021370: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+00021380: 6e67 6550 6572 6365 6e74 203d 2072 6f75  ngePercent = rou
+00021390: 6e64 2828 2870 7265 764c 7470 2d6c 7470  nd(((prevLtp-ltp
+000213a0: 5464 7929 2069 6620 7265 7175 6573 7465  Tdy) if requeste
+000213b0: 6450 6572 696f 6420 3d3d 3020 656c 7365  dPeriod ==0 else
+000213c0: 2028 6c74 7054 6479 202d 2070 7265 764c   (ltpTdy - prevL
+000213d0: 7470 2929 2a31 3030 2f6c 7470 5464 792c  tp))*100/ltpTdy,
+000213e0: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
+000213f0: 2020 2020 2020 2020 7361 7665 4469 6374          saveDict
+00021400: 5b66 227b 7072 647d 2d50 6420 2522 5d20  [f"{prd}-Pd %"] 
+00021410: 3d20 6622 7b63 6861 6e67 6550 6572 6365  = f"{changePerce
+00021420: 6e74 7d25 2220 6966 206e 6f74 2070 642e  nt}%" if not pd.
+00021430: 6973 6e61 2863 6861 6e67 6550 6572 6365  isna(changePerce
+00021440: 6e74 2920 656c 7365 2027 2d27 0a20 2020  nt) else '-'.   
+00021450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021460: 2073 6372 6565 6e44 6963 745b 6622 7b70   screenDict[f"{p
+00021470: 7264 7d2d 5064 2025 225d 203d 2028 2863  rd}-Pd %"] = ((c
+00021480: 6f6c 6f72 5465 7874 2e47 5245 454e 2069  olorText.GREEN i
+00021490: 6620 6368 616e 6765 5065 7263 656e 7420  f changePercent 
+000214a0: 3e3d 3020 656c 7365 2063 6f6c 6f72 5465  >=0 else colorTe
+000214b0: 7874 2e46 4149 4c29 202b 2066 227b 6368  xt.FAIL) + f"{ch
+000214c0: 616e 6765 5065 7263 656e 747d 2522 202b  angePercent}%" +
+000214d0: 2063 6f6c 6f72 5465 7874 2e45 4e44 2920   colorText.END) 
+000214e0: 6966 206e 6f74 2070 642e 6973 6e61 2863  if not pd.isna(c
+000214f0: 6861 6e67 6550 6572 6365 6e74 2920 656c  hangePercent) el
+00021500: 7365 2027 2d27 0a20 2020 2020 2020 2020  se '-'.         
+00021510: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00021520: 745b 2244 6174 6522 5d20 3d20 6361 6c63  t["Date"] = calc
+00021530: 5f64 6174 650a 2020 2020 2020 2020 2020  _date.          
+00021540: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00021550: 4461 7465 225d 203d 2063 616c 635f 6461  Date"] = calc_da
+00021560: 7465 0a20 2020 2020 2020 2020 2020 2065  te.            e
+00021570: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00021580: 2020 2020 2073 6176 6544 6963 745b 6622       saveDict[f"
+00021590: 4c54 507b 7072 647d 225d 203d 206e 702e  LTP{prd}"] = np.
+000215a0: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
+000215b0: 2020 2020 7361 7665 4469 6374 5b66 2247      saveDict[f"G
+000215c0: 726f 7774 687b 7072 647d 225d 203d 206e  rowth{prd}"] = n
+000215d0: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
+000215e0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+000215f0: 5b22 4461 7465 225d 203d 2063 616c 635f  ["Date"] = calc_
+00021600: 6461 7465 0a20 2020 2020 2020 2020 2020  date.           
+00021610: 2020 2020 2073 6176 6544 6963 745b 2244       saveDict["D
+00021620: 6174 6522 5d20 3d20 6361 6c63 5f64 6174  ate"] = calc_dat
+00021630: 650a 0a20 2020 2023 2046 696e 6420 7374  e..    # Find st
+00021640: 6f63 6b73 2074 6861 7420 6172 6520 6265  ocks that are be
+00021650: 6172 6973 6820 696e 7472 6164 6179 3a20  arish intraday: 
+00021660: 4d61 6364 2048 6973 746f 6772 616d 206e  Macd Histogram n
+00021670: 6567 6174 6976 650a 2020 2020 6465 6620  egative.    def 
+00021680: 7661 6c69 6461 7465 4d41 4344 4869 7374  validateMACDHist
+00021690: 6f67 7261 6d42 656c 6f77 3028 7365 6c66  ogramBelow0(self
+000216a0: 2c20 6466 293a 0a20 2020 2020 2020 2069  , df):.        i
+000216b0: 6620 6466 2069 7320 4e6f 6e65 206f 7220  f df is None or 
+000216c0: 6c65 6e28 6466 2920 3d3d 2030 3a0a 2020  len(df) == 0:.  
+000216d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000216e0: 2046 616c 7365 0a20 2020 2020 2020 2064   False.        d
+000216f0: 6174 6120 3d20 6466 2e63 6f70 7928 290a  ata = df.copy().
+00021700: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00021710: 6174 612e 6669 6c6c 6e61 2830 290a 2020  ata.fillna(0).  
+00021720: 2020 2020 2020 6461 7461 203d 2064 6174        data = dat
+00021730: 612e 7265 706c 6163 6528 5b6e 702e 696e  a.replace([np.in
+00021740: 662c 202d 6e70 2e69 6e66 5d2c 2030 290a  f, -np.inf], 0).
+00021750: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00021760: 6174 615b 3a3a 2d31 5d20 2023 2052 6576  ata[::-1]  # Rev
+00021770: 6572 7365 2074 6865 2064 6174 6166 7261  erse the datafra
+00021780: 6d65 2073 6f20 7468 6174 2069 7473 2074  me so that its t
+00021790: 6865 206f 6c64 6573 7420 6461 7465 2066  he oldest date f
+000217a0: 6972 7374 0a20 2020 2020 2020 206d 6163  irst.        mac
+000217b0: 6420 3d20 706b 7461 6c69 622e 4d41 4344  d = pktalib.MACD
+000217c0: 2864 6174 615b 2243 6c6f 7365 225d 2c20  (data["Close"], 
+000217d0: 3132 2c20 3236 2c20 3929 5b32 5d2e 7461  12, 26, 9)[2].ta
+000217e0: 696c 2831 290a 2020 2020 2020 2020 7265  il(1).        re
+000217f0: 7475 726e 206d 6163 642e 696c 6f63 5b3a  turn macd.iloc[:
+00021800: 315d 5b30 5d20 3c20 300a 0a20 2020 2023  1][0] < 0..    #
+00021810: 406d 6561 7375 7265 5f74 696d 650a 2020  @measure_time.  
+00021820: 2020 2320 4669 6e64 2069 6620 7374 6f63    # Find if stoc
+00021830: 6b20 6761 696e 696e 6720 6275 6c6c 6973  k gaining bullis
+00021840: 6820 6d6f 6d65 6e74 756d 0a20 2020 2064  h momentum.    d
+00021850: 6566 2076 616c 6964 6174 654d 6f6d 656e  ef validateMomen
+00021860: 7475 6d28 7365 6c66 2c20 6466 2c20 7363  tum(self, df, sc
+00021870: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+00021880: 6374 293a 0a20 2020 2020 2020 2069 6620  ct):.        if 
+00021890: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
+000218a0: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
+000218b0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000218c0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
+000218d0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
+000218e0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000218f0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00021900: 7461 2e68 6561 6428 3329 0a20 2020 2020  ta.head(3).     
+00021910: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
+00021920: 7461 2920 3c20 333a 0a20 2020 2020 2020  ta) < 3:.       
+00021930: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00021940: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00021950: 2020 666f 7220 726f 7720 696e 2064 6174    for row in dat
+00021960: 612e 6974 6572 726f 7773 2829 3a0a 2020  a.iterrows():.  
+00021970: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00021980: 416c 6c20 3320 6361 6e64 6c65 7320 7368  All 3 candles sh
+00021990: 6f75 6c64 2062 6520 4772 6565 6e20 616e  ould be Green an
+000219a0: 6420 4e4f 5420 4369 7263 7569 7473 0a20  d NOT Circuits. 
+000219b0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+000219c0: 6320 3d20 726f 775b 315d 5b22 436c 6f73  c = row[1]["Clos
+000219d0: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
+000219e0: 2020 2020 796f 203d 2072 6f77 5b31 5d5b      yo = row[1][
+000219f0: 224f 7065 6e22 5d0a 2020 2020 2020 2020  "Open"].        
+00021a00: 2020 2020 2020 2020 6966 2079 6320 3c3d          if yc <=
+00021a10: 2079 6f3a 0a20 2020 2020 2020 2020 2020   yo:.           
+00021a20: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
+00021a30: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
+00021a40: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
+00021a50: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
+00021a60: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
+00021a70: 5b22 5374 6f63 6b22 5d7d 2c20 6973 206e  ["Stock"]}, is n
+00021a80: 6f74 2061 206d 6f6d 656e 7475 6d2d 6761  ot a momentum-ga
+00021a90: 696e 6572 2062 6563 6175 7365 2079 6573  iner because yes
+00021aa0: 7465 7264 6179 2d63 6c6f 7365 2028 7b79  terday-close ({y
+00021ab0: 637d 2920 3c3d 2079 6573 7465 7264 6179  c}) <= yesterday
+00021ac0: 2d6f 7065 6e20 287b 796f 7d29 270a 2020  -open ({yo})'.  
 00021ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ae0: 2020 6479 6320 3d20 6461 7461 5b22 436c    dyc = data["Cl
-00021af0: 6f73 6522 5d2e 696c 6f63 5b32 5d0a 2020  ose"].iloc[2].  
-00021b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b10: 2020 6966 2028 746f 203e 3d20 7963 2920    if (to >= yc) 
-00021b20: 616e 6420 2879 6f20 3e3d 2064 7963 293a  and (yo >= dyc):
-00021b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021b40: 2020 2020 2020 2020 2023 2073 656c 662e           # self.
-00021b50: 6465 6661 756c 745f 6c6f 6767 6572 2e69  default_logger.i
-00021b60: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
-00021b70: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00021b80: 2020 2066 2753 746f 636b 3a7b 7361 7665     f'Stock:{save
-00021b90: 4469 6374 5b22 5374 6f63 6b22 5d7d 2c20  Dict["Stock"]}, 
-00021ba0: 6973 2061 206d 6f6d 656e 7475 6d2d 6761  is a momentum-ga
-00021bb0: 696e 6572 2062 6563 6175 7365 2074 6f64  iner because tod
-00021bc0: 6179 2d6f 7065 6e20 287b 746f 7d29 203e  ay-open ({to}) >
-00021bd0: 3d20 7965 7374 6572 6461 792d 636c 6f73  = yesterday-clos
-00021be0: 6520 287b 7963 7d29 2061 6e64 2079 6573  e ({yc}) and yes
-00021bf0: 7465 7264 6179 2d6f 7065 6e28 7b79 6f7d  terday-open({yo}
-00021c00: 2920 3e3d 2064 6179 2d62 6566 6f72 652d  ) >= day-before-
-00021c10: 636c 6f73 6528 7b64 7963 7d29 270a 2020  close({dyc})'.  
-00021c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c30: 2020 2020 2020 2320 290a 2020 2020 2020        # ).      
-00021c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c50: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
-00021c60: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
-00021c70: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
-00021c80: 2073 6176 6544 6963 742c 2022 5061 7474   saveDict, "Patt
-00021c90: 6572 6e22 290a 2020 2020 2020 2020 2020  ern").          
-00021ca0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00021cb0: 7265 656e 4469 6374 5b22 5061 7474 6572  reenDict["Patter
-00021cc0: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
-00021cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ce0: 2020 2020 7361 7665 645b 305d 0a20 2020      saved[0].   
-00021cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d00: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-00021d10: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
-00021d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d30: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00021d40: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
-00021d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d60: 2020 2020 2b20 224d 6f6d 656e 7475 6d20      + "Momentum 
-00021d70: 4761 696e 6572 220a 2020 2020 2020 2020  Gainer".        
-00021d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d90: 2020 2020 2b20 636f 6c6f 7254 6578 742e      + colorText.
-00021da0: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00021db0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00021dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021dd0: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
-00021de0: 5061 7474 6572 6e22 5d20 3d20 7361 7665  Pattern"] = save
-00021df0: 645b 315d 202b 2022 4d6f 6d65 6e74 756d  d[1] + "Momentum
-00021e00: 2047 6169 6e65 7222 0a20 2020 2020 2020   Gainer".       
-00021e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e20: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
-00021e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e40: 2023 2073 656c 662e 6465 6661 756c 745f   # self.default_
-00021e50: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
+00021ae0: 2020 2320 290a 2020 2020 2020 2020 2020    # ).          
+00021af0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00021b00: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00021b10: 2020 206f 7065 6e44 6573 6320 3d20 6461     openDesc = da
+00021b20: 7461 2e73 6f72 745f 7661 6c75 6573 2862  ta.sort_values(b
+00021b30: 793d 5b22 4f70 656e 225d 2c20 6173 6365  y=["Open"], asce
+00021b40: 6e64 696e 673d 4661 6c73 6529 0a20 2020  nding=False).   
+00021b50: 2020 2020 2020 2020 2063 6c6f 7365 4465           closeDe
+00021b60: 7363 203d 2064 6174 612e 736f 7274 5f76  sc = data.sort_v
+00021b70: 616c 7565 7328 6279 3d5b 2243 6c6f 7365  alues(by=["Close
+00021b80: 225d 2c20 6173 6365 6e64 696e 673d 4661  "], ascending=Fa
+00021b90: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+00021ba0: 2076 6f6c 4465 7363 203d 2064 6174 612e   volDesc = data.
+00021bb0: 736f 7274 5f76 616c 7565 7328 6279 3d5b  sort_values(by=[
+00021bc0: 2256 6f6c 756d 6522 5d2c 2061 7363 656e  "Volume"], ascen
+00021bd0: 6469 6e67 3d46 616c 7365 290a 2020 2020  ding=False).    
+00021be0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00021bf0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00021c00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00021c10: 2020 2020 2020 6461 7461 2e65 7175 616c        data.equal
+00021c20: 7328 6f70 656e 4465 7363 290a 2020 2020  s(openDesc).    
+00021c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c40: 616e 6420 6461 7461 2e65 7175 616c 7328  and data.equals(
+00021c50: 636c 6f73 6544 6573 6329 0a20 2020 2020  closeDesc).     
+00021c60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00021c70: 6e64 2064 6174 612e 6571 7561 6c73 2876  nd data.equals(v
+00021c80: 6f6c 4465 7363 290a 2020 2020 2020 2020  olDesc).        
+00021c90: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00021ca0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00021cb0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+00021cc0: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
+00021cd0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00021ce0: 2020 2020 2066 2753 746f 636b 3a7b 7361       f'Stock:{sa
+00021cf0: 7665 4469 6374 5b22 5374 6f63 6b22 5d7d  veDict["Stock"]}
+00021d00: 2c20 6f70 656e 2c63 6c6f 7365 2061 6e64  , open,close and
+00021d10: 2076 6f6c 756d 6520 6571 7561 6c20 6672   volume equal fr
+00021d20: 6f6d 2064 6179 2062 6566 6f72 6520 7965  om day before ye
+00021d30: 7374 6572 6461 792e 2041 2070 6f74 656e  sterday. A poten
+00021d40: 7469 616c 206d 6f6d 656e 7475 6d2d 6761  tial momentum-ga
+00021d50: 696e 6572 2127 0a20 2020 2020 2020 2020  iner!'.         
+00021d60: 2020 2020 2020 2020 2020 2023 2029 0a20             # ). 
+00021d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021d80: 2020 2074 6f20 3d20 6461 7461 5b22 4f70     to = data["Op
+00021d90: 656e 225d 2e69 6c6f 635b 305d 0a20 2020  en"].iloc[0].   
+00021da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021db0: 2079 6320 3d20 6461 7461 5b22 436c 6f73   yc = data["Clos
+00021dc0: 6522 5d2e 696c 6f63 5b31 5d0a 2020 2020  e"].iloc[1].    
+00021dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021de0: 796f 203d 2064 6174 615b 224f 7065 6e22  yo = data["Open"
+00021df0: 5d2e 696c 6f63 5b31 5d0a 2020 2020 2020  ].iloc[1].      
+00021e00: 2020 2020 2020 2020 2020 2020 2020 6479                dy
+00021e10: 6320 3d20 6461 7461 5b22 436c 6f73 6522  c = data["Close"
+00021e20: 5d2e 696c 6f63 5b32 5d0a 2020 2020 2020  ].iloc[2].      
+00021e30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021e40: 2028 746f 203e 3d20 7963 2920 616e 6420   (to >= yc) and 
+00021e50: 2879 6f20 3e3d 2064 7963 293a 0a20 2020  (yo >= dyc):.   
 00021e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e70: 2023 2020 2020 2066 2753 746f 636b 3a7b   #     f'Stock:{
-00021e80: 7361 7665 4469 6374 5b22 5374 6f63 6b22  saveDict["Stock"
-00021e90: 5d7d 2c20 6973 206e 6f74 2061 206d 6f6d  ]}, is not a mom
-00021ea0: 656e 7475 6d2d 6761 696e 6572 2062 6563  entum-gainer bec
-00021eb0: 6175 7365 2065 6974 6865 7220 746f 6461  ause either toda
-00021ec0: 792d 6f70 656e 2028 7b74 6f7d 2920 3c20  y-open ({to}) < 
-00021ed0: 7965 7374 6572 6461 792d 636c 6f73 6520  yesterday-close 
-00021ee0: 287b 7963 7d29 206f 7220 7965 7374 6572  ({yc}) or yester
-00021ef0: 6461 792d 6f70 656e 287b 796f 7d29 203c  day-open({yo}) <
-00021f00: 2064 6179 2d62 6566 6f72 652d 636c 6f73   day-before-clos
-00021f10: 6528 7b64 7963 7d29 270a 2020 2020 2020  e({dyc})'.      
-00021f20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00021f30: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00021f40: 6365 7074 2049 6e64 6578 4572 726f 7220  cept IndexError 
-00021f50: 6173 2065 3a20 2320 7072 6167 6d61 3a20  as e: # pragma: 
-00021f60: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
-00021f70: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-00021f80: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
-00021f90: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
-00021fa0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00021fb0: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
-00021fc0: 745f 6c6f 6767 6572 2e64 6562 7567 2864  t_logger.debug(d
-00021fd0: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
-00021fe0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00021ff0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00022000: 7365 0a20 2020 2020 2020 2065 7863 6570  se.        excep
-00022010: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00022020: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
-00022030: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
-00022040: 2020 7365 6c66 2e64 6566 6175 6c74 5f6c    self.default_l
-00022050: 6f67 6765 722e 6465 6275 6728 652c 2065  ogger.debug(e, e
-00022060: 7863 5f69 6e66 6f3d 5472 7565 290a 2020  xc_info=True).  
-00022070: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022080: 2046 616c 7365 0a0a 2020 2020 2340 6d65   False..    #@me
-00022090: 6173 7572 655f 7469 6d65 0a20 2020 2023  asure_time.    #
-000220a0: 2056 616c 6964 6174 6520 4d6f 7669 6e67   Validate Moving
-000220b0: 2061 7665 7261 6765 7320 616e 6420 6c6f   averages and lo
-000220c0: 6f6b 2066 6f72 2062 7579 2f73 656c 6c20  ok for buy/sell 
-000220d0: 7369 676e 616c 730a 2020 2020 6465 6620  signals.    def 
-000220e0: 7661 6c69 6461 7465 4d6f 7669 6e67 4176  validateMovingAv
-000220f0: 6572 6167 6573 2873 656c 662c 2064 662c  erages(self, df,
-00022100: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-00022110: 6544 6963 742c 206d 6152 616e 6765 3d32  eDict, maRange=2
-00022120: 2e35 2c6d 614c 656e 6774 683d 3029 3a0a  .5,maLength=0):.
-00022130: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
-00022140: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
-00022150: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
-00022160: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
-00022170: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
-00022180: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
-00022190: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
-000221a0: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
-000221b0: 6561 6428 3129 0a20 2020 2020 2020 206d  ead(1).        m
-000221c0: 6153 6967 6e61 6c73 203d 205b 5d0a 2020  aSignals = [].  
-000221d0: 2020 2020 2020 6966 2073 7472 286d 614c        if str(maL
-000221e0: 656e 6774 6829 2069 6e20 5b22 3022 2c22  ength) in ["0","
-000221f0: 3222 2c22 3322 5d3a 0a20 2020 2020 2020  2","3"]:.       
-00022200: 2020 2020 2073 6176 6564 203d 2073 656c       saved = sel
-00022210: 662e 6669 6e64 4375 7272 656e 7453 6176  f.findCurrentSav
-00022220: 6564 5661 6c75 6528 7363 7265 656e 4469  edValue(screenDi
-00022230: 6374 2c73 6176 6544 6963 742c 224d 412d  ct,saveDict,"MA-
-00022240: 5369 676e 616c 2229 0a20 2020 2020 2020  Signal").       
-00022250: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00022260: 2020 2020 2020 2020 2020 7265 6365 6e74            recent
-00022270: 5b22 534d 4122 5d2e 696c 6f63 5b30 5d20  ["SMA"].iloc[0] 
-00022280: 3e20 7265 6365 6e74 5b22 4c4d 4122 5d2e  > recent["LMA"].
-00022290: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-000222a0: 2020 2020 2020 2020 616e 6420 7265 6365          and rece
-000222b0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-000222c0: 5b30 5d20 3e20 7265 6365 6e74 5b22 534d  [0] > recent["SM
-000222d0: 4122 5d2e 696c 6f63 5b30 5d0a 2020 2020  A"].iloc[0].    
-000222e0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-000222f0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00022300: 6e44 6963 745b 224d 412d 5369 676e 616c  nDict["MA-Signal
-00022310: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
-00022320: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-00022330: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-00022340: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-00022350: 2e47 5245 454e 202b 2022 4275 6c6c 6973  .GREEN + "Bullis
-00022360: 6822 202b 2063 6f6c 6f72 5465 7874 2e45  h" + colorText.E
-00022370: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-00022380: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00022390: 2020 2020 2073 6176 6544 6963 745b 224d       saveDict["M
-000223a0: 412d 5369 676e 616c 225d 203d 2073 6176  A-Signal"] = sav
-000223b0: 6564 5b31 5d20 2b20 2242 756c 6c69 7368  ed[1] + "Bullish
-000223c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000223d0: 2020 6d61 5369 676e 616c 732e 6170 7065    maSignals.appe
-000223e0: 6e64 2822 3322 290a 2020 2020 2020 2020  nd("3").        
-000223f0: 2020 2020 656c 6966 2072 6563 656e 745b      elif recent[
-00022400: 2253 4d41 225d 2e69 6c6f 635b 305d 203c  "SMA"].iloc[0] <
-00022410: 2072 6563 656e 745b 224c 4d41 225d 2e69   recent["LMA"].i
-00022420: 6c6f 635b 305d 3a0a 2020 2020 2020 2020  loc[0]:.        
-00022430: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-00022440: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-00022450: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00022460: 2020 2020 2020 2020 7361 7665 645b 305d          saved[0]
-00022470: 202b 2063 6f6c 6f72 5465 7874 2e42 4f4c   + colorText.BOL
-00022480: 4420 2b20 636f 6c6f 7254 6578 742e 4641  D + colorText.FA
-00022490: 494c 202b 2022 4265 6172 6973 6822 202b  IL + "Bearish" +
-000224a0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-000224b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000224c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000224d0: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
-000224e0: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
-000224f0: 5d20 2b20 2242 6561 7269 7368 220a 2020  ] + "Bearish".  
-00022500: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00022510: 5369 676e 616c 732e 6170 7065 6e64 2822  Signals.append("
-00022520: 3222 290a 2020 2020 2020 2020 2020 2020  2").            
-00022530: 656c 6966 2072 6563 656e 745b 2253 4d41  elif recent["SMA
-00022540: 225d 2e69 6c6f 635b 305d 203d 3d20 303a  "].iloc[0] == 0:
-00022550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022560: 2073 6372 6565 6e44 6963 745b 224d 412d   screenDict["MA-
-00022570: 5369 676e 616c 225d 203d 2028 0a20 2020  Signal"] = (.   
-00022580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022590: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
-000225a0: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
-000225b0: 6f72 5465 7874 2e57 4152 4e20 2b20 2255  orText.WARN + "U
-000225c0: 6e6b 6e6f 776e 2220 2b20 636f 6c6f 7254  nknown" + colorT
-000225d0: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-000225e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000225f0: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-00022600: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-00022610: 3d20 7361 7665 645b 315d 202b 2022 556e  = saved[1] + "Un
-00022620: 6b6e 6f77 6e22 0a20 2020 2020 2020 2020  known".         
-00022630: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00022640: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
-00022650: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
-00022660: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00022670: 2020 2020 2020 2020 2073 6176 6564 5b30           saved[0
-00022680: 5d20 2b20 636f 6c6f 7254 6578 742e 424f  ] + colorText.BO
-00022690: 4c44 202b 2063 6f6c 6f72 5465 7874 2e57  LD + colorText.W
-000226a0: 4152 4e20 2b20 224e 6575 7472 616c 2220  ARN + "Neutral" 
-000226b0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-000226c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000226e0: 2020 7361 7665 4469 6374 5b22 4d41 2d53    saveDict["MA-S
-000226f0: 6967 6e61 6c22 5d20 3d20 7361 7665 645b  ignal"] = saved[
-00022700: 315d 202b 2022 4e65 7574 7261 6c22 0a20  1] + "Neutral". 
-00022710: 2020 2020 2020 2072 6576 6572 7365 6444         reversedD
-00022720: 6174 6120 3d20 6461 7461 5b3a 3a2d 315d  ata = data[::-1]
-00022730: 2020 2320 5265 7665 7273 6520 7468 6520    # Reverse the 
-00022740: 6461 7461 6672 616d 650a 2020 2020 2020  dataframe.      
-00022750: 2020 656d 615f 3230 203d 2070 6b74 616c    ema_20 = pktal
-00022760: 6962 2e45 4d41 2872 6576 6572 7365 6444  ib.EMA(reversedD
-00022770: 6174 615b 2243 6c6f 7365 225d 2c32 3029  ata["Close"],20)
-00022780: 2e74 6169 6c28 3129 2e69 6c6f 635b 305d  .tail(1).iloc[0]
-00022790: 0a20 2020 2020 2020 2076 7761 7020 3d20  .        vwap = 
-000227a0: 706b 7461 6c69 622e 5657 4150 2872 6576  pktalib.VWAP(rev
-000227b0: 6572 7365 6444 6174 615b 2248 6967 6822  ersedData["High"
-000227c0: 5d2c 7265 7665 7273 6564 4461 7461 5b22  ],reversedData["
-000227d0: 4c6f 7722 5d2c 7265 7665 7273 6564 4461  Low"],reversedDa
-000227e0: 7461 5b22 436c 6f73 6522 5d2c 7265 7665  ta["Close"],reve
-000227f0: 7273 6564 4461 7461 5b22 566f 6c75 6d65  rsedData["Volume
-00022800: 225d 292e 7461 696c 2831 292e 696c 6f63  "]).tail(1).iloc
-00022810: 5b30 5d0a 2020 2020 2020 2020 736d 6144  [0].        smaD
-00022820: 6576 203d 2064 6174 615b 2253 4d41 225d  ev = data["SMA"]
-00022830: 2e69 6c6f 635b 305d 202a 206d 6152 616e  .iloc[0] * maRan
-00022840: 6765 202f 2031 3030 0a20 2020 2020 2020  ge / 100.       
-00022850: 206c 6d61 4465 7620 3d20 6461 7461 5b22   lmaDev = data["
-00022860: 4c4d 4122 5d2e 696c 6f63 5b30 5d20 2a20  LMA"].iloc[0] * 
-00022870: 6d61 5261 6e67 6520 2f20 3130 300a 2020  maRange / 100.  
-00022880: 2020 2020 2020 656d 6144 6576 203d 2065        emaDev = e
-00022890: 6d61 5f32 3020 2a20 6d61 5261 6e67 6520  ma_20 * maRange 
-000228a0: 2f20 3130 300a 2020 2020 2020 2020 7677  / 100.        vw
-000228b0: 6170 4465 7620 3d20 7677 6170 202a 206d  apDev = vwap * m
-000228c0: 6152 616e 6765 202f 2031 3030 0a20 2020  aRange / 100.   
-000228d0: 2020 2020 206f 7065 6e2c 2068 6967 682c       open, high,
-000228e0: 206c 6f77 2c20 636c 6f73 652c 2073 6d61   low, close, sma
-000228f0: 2c20 6c6d 6120 3d20 280a 2020 2020 2020  , lma = (.      
-00022900: 2020 2020 2020 6461 7461 5b22 4f70 656e        data["Open
-00022910: 225d 2e69 6c6f 635b 305d 2c0a 2020 2020  "].iloc[0],.    
-00022920: 2020 2020 2020 2020 6461 7461 5b22 4869          data["Hi
-00022930: 6768 225d 2e69 6c6f 635b 305d 2c0a 2020  gh"].iloc[0],.  
-00022940: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-00022950: 4c6f 7722 5d2e 696c 6f63 5b30 5d2c 0a20  Low"].iloc[0],. 
-00022960: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-00022970: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-00022980: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-00022990: 7461 5b22 534d 4122 5d2e 696c 6f63 5b30  ta["SMA"].iloc[0
-000229a0: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
-000229b0: 6174 615b 224c 4d41 225d 2e69 6c6f 635b  ata["LMA"].iloc[
-000229c0: 305d 2c0a 2020 2020 2020 2020 290a 2020  0],.        ).  
-000229d0: 2020 2020 2020 6d61 7320 3d20 5b73 6d61        mas = [sma
-000229e0: 2c6c 6d61 2c65 6d61 5f32 302c 7677 6170  ,lma,ema_20,vwap
-000229f0: 5d20 6966 206d 614c 656e 6774 683d 3d30  ] if maLength==0
-00022a00: 2065 6c73 6520 5b73 6d61 2c6c 6d61 2c65   else [sma,lma,e
-00022a10: 6d61 5f32 305d 0a20 2020 2020 2020 206d  ma_20].        m
-00022a20: 6144 6576 7320 3d20 5b73 6d61 4465 762c  aDevs = [smaDev,
-00022a30: 206c 6d61 4465 762c 2065 6d61 4465 762c   lmaDev, emaDev,
-00022a40: 2076 7761 7044 6576 5d20 6966 206d 614c   vwapDev] if maL
-00022a50: 656e 6774 683d 3d30 2065 6c73 6520 5b73  ength==0 else [s
-00022a60: 6d61 4465 762c 206c 6d61 4465 762c 2065  maDev, lmaDev, e
-00022a70: 6d61 4465 765d 0a20 2020 2020 2020 206d  maDev].        m
-00022a80: 6154 6578 7473 203d 205b 2235 304d 4122  aTexts = ["50MA"
-00022a90: 2c22 3230 304d 4122 2c22 3230 454d 4122  ,"200MA","20EMA"
-00022aa0: 2c22 5657 4150 225d 2069 6620 6d61 4c65  ,"VWAP"] if maLe
-00022ab0: 6e67 7468 3d3d 3020 656c 7365 205b 2235  ngth==0 else ["5
-00022ac0: 304d 4122 2c22 3230 304d 4122 2c22 3230  0MA","200MA","20
-00022ad0: 454d 4122 5d0a 2020 2020 2020 2020 6d61  EMA"].        ma
-00022ae0: 5265 7665 7273 616c 203d 2030 0a20 2020  Reversal = 0.   
-00022af0: 2020 2020 2069 6e64 6578 203d 2030 0a20       index = 0. 
-00022b00: 2020 2020 2020 2062 756c 6c69 7368 4361         bullishCa
-00022b10: 6e64 6c65 203d 2073 656c 662e 6765 7443  ndle = self.getC
-00022b20: 616e 646c 6554 7970 6528 6461 7461 290a  andleType(data).
-00022b30: 2020 2020 2020 2020 6966 2073 7472 286d          if str(m
-00022b40: 614c 656e 6774 6829 206e 6f74 2069 6e20  aLength) not in 
-00022b50: 5b22 3222 2c22 3322 5d3a 0a20 2020 2020  ["2","3"]:.     
-00022b60: 2020 2020 2020 2066 6f72 206d 6120 696e         for ma in
-00022b70: 206d 6173 3a0a 2020 2020 2020 2020 2020   mas:.          
-00022b80: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00022b90: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00022ba0: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00022bb0: 6963 742c 7361 7665 4469 6374 2c22 4d41  ict,saveDict,"MA
-00022bc0: 2d53 6967 6e61 6c22 290a 2020 2020 2020  -Signal").      
-00022bd0: 2020 2020 2020 2020 2020 2320 5461 6b69            # Taki
-00022be0: 6e67 2053 7570 706f 7274 0a20 2020 2020  ng Support.     
-00022bf0: 2020 2020 2020 2020 2020 2069 6620 636c             if cl
-00022c00: 6f73 6520 3e20 6d61 2061 6e64 206c 6f77  ose > ma and low
-00022c10: 203c 3d20 286d 6120 2b20 6d61 4465 7673   <= (ma + maDevs
-00022c20: 5b69 6e64 6578 5d29 2061 6e64 2073 7472  [index]) and str
-00022c30: 286d 614c 656e 6774 6829 2069 6e20 5b22  (maLength) in ["
-00022c40: 3022 2c22 3122 5d3a 0a20 2020 2020 2020  0","1"]:.       
-00022c50: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-00022c60: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
-00022c70: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
-00022c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c90: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
-00022ca0: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
-00022cb0: 6f72 5465 7874 2e47 5245 454e 202b 2066  orText.GREEN + f
-00022cc0: 227b 6d61 5465 7874 735b 696e 6465 785d  "{maTexts[index]
-00022cd0: 7d2d 5375 7070 6f72 7422 202b 2063 6f6c  }-Support" + col
-00022ce0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
-00022cf0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00022d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022d10: 2020 2020 2073 6176 6544 6963 745b 224d       saveDict["M
-00022d20: 412d 5369 676e 616c 225d 203d 2073 6176  A-Signal"] = sav
-00022d30: 6564 5b31 5d20 2b20 6622 7b6d 6154 6578  ed[1] + f"{maTex
-00022d40: 7473 5b69 6e64 6578 5d7d 2d53 7570 706f  ts[index]}-Suppo
-00022d50: 7274 220a 2020 2020 2020 2020 2020 2020  rt".            
-00022d60: 2020 2020 2020 2020 6d61 5265 7665 7273          maRevers
-00022d70: 616c 203d 2031 0a20 2020 2020 2020 2020  al = 1.         
-00022d80: 2020 2020 2020 2020 2020 206d 6153 6967             maSig
-00022d90: 6e61 6c73 2e61 7070 656e 6428 2231 2229  nals.append("1")
-00022da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022db0: 2023 2056 616c 6964 6174 696e 6720 5265   # Validating Re
-00022dc0: 7369 7374 616e 6365 0a20 2020 2020 2020  sistance.       
-00022dd0: 2020 2020 2020 2020 2065 6c69 6620 636c           elif cl
-00022de0: 6f73 6520 3c20 6d61 2061 6e64 2068 6967  ose < ma and hig
-00022df0: 6820 3e3d 2028 6d61 202d 206d 6144 6576  h >= (ma - maDev
-00022e00: 735b 696e 6465 785d 2920 616e 6420 7374  s[index]) and st
-00022e10: 7228 6d61 4c65 6e67 7468 2920 696e 205b  r(maLength) in [
-00022e20: 2230 222c 2236 225d 3a0a 2020 2020 2020  "0","6"]:.      
-00022e30: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00022e40: 7265 656e 4469 6374 5b22 4d41 2d53 6967  reenDict["MA-Sig
-00022e50: 6e61 6c22 5d20 3d20 280a 2020 2020 2020  nal"] = (.      
-00022e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022e70: 2020 7361 7665 645b 305d 202b 2063 6f6c    saved[0] + col
-00022e80: 6f72 5465 7874 2e42 4f4c 4420 2b20 636f  orText.BOLD + co
-00022e90: 6c6f 7254 6578 742e 4641 494c 202b 2066  lorText.FAIL + f
-00022ea0: 227b 6d61 5465 7874 735b 696e 6465 785d  "{maTexts[index]
-00022eb0: 7d2d 5265 7369 7374 2220 2b20 636f 6c6f  }-Resist" + colo
-00022ec0: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00022ed0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00022ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ef0: 2020 2020 7361 7665 4469 6374 5b22 4d41      saveDict["MA
-00022f00: 2d53 6967 6e61 6c22 5d20 3d20 7361 7665  -Signal"] = save
-00022f10: 645b 315d 202b 2066 227b 6d61 5465 7874  d[1] + f"{maText
-00022f20: 735b 696e 6465 785d 7d2d 5265 7369 7374  s[index]}-Resist
-00022f30: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022f40: 2020 2020 2020 6d61 5265 7665 7273 616c        maReversal
-00022f50: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
-00022f60: 2020 2020 2020 2020 2020 6d61 5369 676e            maSign
-00022f70: 616c 732e 6170 7065 6e64 2822 3622 290a  als.append("6").
-00022f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f90: 2320 466f 7220 6120 4275 6c6c 6973 6820  # For a Bullish 
-00022fa0: 4361 6e64 6c65 0a20 2020 2020 2020 2020  Candle.         
-00022fb0: 2020 2020 2020 2069 6620 6275 6c6c 6973         if bullis
-00022fc0: 6843 616e 646c 653a 0a20 2020 2020 2020  hCandle:.       
-00022fd0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00022fe0: 726f 7373 696e 6720 7570 0a20 2020 2020  rossing up.     
-00022ff0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023000: 6620 6f70 656e 203c 206d 6120 616e 6420  f open < ma and 
-00023010: 636c 6f73 6520 3e20 6d61 2061 6e64 2073  close > ma and s
-00023020: 7472 286d 614c 656e 6774 6829 2069 6e20  tr(maLength) in 
-00023030: 5b22 3022 2c22 3522 5d3a 0a20 2020 2020  ["0","5"]:.     
-00023040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023050: 2020 2073 6372 6565 6e44 6963 745b 224d     screenDict["M
-00023060: 412d 5369 676e 616c 225d 203d 2028 0a20  A-Signal"] = (. 
-00023070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023080: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-00023090: 5b30 5d20 2b20 636f 6c6f 7254 6578 742e  [0] + colorText.
-000230a0: 424f 4c44 202b 2063 6f6c 6f72 5465 7874  BOLD + colorText
-000230b0: 2e47 5245 454e 202b 2066 2242 756c 6c43  .GREEN + f"BullC
-000230c0: 726f 7373 2d7b 6d61 5465 7874 735b 696e  ross-{maTexts[in
-000230d0: 6465 785d 7d22 202b 2063 6f6c 6f72 5465  dex]}" + colorTe
-000230e0: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
-000230f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00023100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023110: 2020 2020 2020 2020 2073 6176 6544 6963           saveDic
-00023120: 745b 224d 412d 5369 676e 616c 225d 203d  t["MA-Signal"] =
-00023130: 2073 6176 6564 5b31 5d20 2b20 6622 4275   saved[1] + f"Bu
-00023140: 6c6c 4372 6f73 732d 7b6d 6154 6578 7473  llCross-{maTexts
-00023150: 5b69 6e64 6578 5d7d 220a 2020 2020 2020  [index]}".      
-00023160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023170: 2020 6d61 5265 7665 7273 616c 203d 2031    maReversal = 1
-00023180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023190: 2020 2020 2020 2020 206d 6153 6967 6e61           maSigna
-000231a0: 6c73 2e61 7070 656e 6428 2235 2229 0a20  ls.append("5"). 
-000231b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000231c0: 2046 6f72 2061 2042 6561 7269 7368 2043   For a Bearish C
-000231d0: 616e 646c 650a 2020 2020 2020 2020 2020  andle.          
-000231e0: 2020 2020 2020 656c 6966 206e 6f74 2062        elif not b
-000231f0: 756c 6c69 7368 4361 6e64 6c65 3a0a 2020  ullishCandle:.  
-00023200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023210: 2020 2320 4372 6f73 7369 6e67 2064 6f77    # Crossing dow
-00023220: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00023230: 2020 2020 2020 6966 206f 7065 6e20 3e20        if open > 
-00023240: 736d 6120 616e 6420 636c 6f73 6520 3c20  sma and close < 
-00023250: 736d 6120 616e 6420 7374 7228 6d61 4c65  sma and str(maLe
-00023260: 6e67 7468 2920 696e 205b 2230 222c 2234  ngth) in ["0","4
-00023270: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00023280: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-00023290: 656e 4469 6374 5b22 4d41 2d53 6967 6e61  enDict["MA-Signa
-000232a0: 6c22 5d20 3d20 280a 2020 2020 2020 2020  l"] = (.        
-000232b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000232c0: 2020 2020 7361 7665 645b 305d 202b 2063      saved[0] + c
-000232d0: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
-000232e0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
-000232f0: 2066 2242 6561 7243 726f 7373 2d7b 6d61   f"BearCross-{ma
-00023300: 5465 7874 735b 696e 6465 785d 7d22 202b  Texts[index]}" +
-00023310: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
-00023320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023330: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00023340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023350: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
-00023360: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
-00023370: 5d20 2b20 6622 4265 6172 4372 6f73 732d  ] + f"BearCross-
-00023380: 7b6d 6154 6578 7473 5b69 6e64 6578 5d7d  {maTexts[index]}
-00023390: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000233a0: 2020 2020 2020 2020 2020 6d61 5265 7665            maReve
-000233b0: 7273 616c 203d 202d 310a 2020 2020 2020  rsal = -1.      
-000233c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000233d0: 2020 6d61 5369 676e 616c 732e 6170 7065    maSignals.appe
-000233e0: 6e64 2822 3422 290a 2020 2020 2020 2020  nd("4").        
-000233f0: 2020 2020 2020 2020 696e 6465 7820 2b3d          index +=
-00023400: 2031 0a20 2020 2020 2020 2072 6574 7572   1.        retur
-00023410: 6e56 616c 7565 203d 206d 6152 6576 6572  nValue = maRever
-00023420: 7361 6c0a 2020 2020 2020 2020 6966 206d  sal.        if m
-00023430: 614c 656e 6774 6820 213d 2030 3a0a 2020  aLength != 0:.  
-00023440: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00023450: 5661 6c75 6520 3d20 7374 7228 6d61 4c65  Value = str(maLe
-00023460: 6e67 7468 2920 696e 206d 6153 6967 6e61  ngth) in maSigna
-00023470: 6c73 0a20 2020 2020 2020 2072 6574 7572  ls.        retur
-00023480: 6e20 7265 7475 726e 5661 6c75 650a 0a20  n returnValue.. 
-00023490: 2020 2023 2046 696e 6420 4e52 7820 7261     # Find NRx ra
-000234a0: 6e67 6520 666f 7220 5265 7665 7273 616c  nge for Reversal
-000234b0: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-000234c0: 654e 6172 726f 7752 616e 6765 2873 656c  eNarrowRange(sel
-000234d0: 662c 2064 662c 2073 6372 6565 6e44 6963  f, df, screenDic
-000234e0: 742c 2073 6176 6544 6963 742c 206e 723d  t, saveDict, nr=
-000234f0: 3429 3a0a 2020 2020 2020 2020 6966 2064  4):.        if d
-00023500: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
-00023510: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
-00023520: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00023530: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
-00023540: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
-00023550: 2020 2020 2073 6176 6564 203d 2073 656c       saved = sel
-00023560: 662e 6669 6e64 4375 7272 656e 7453 6176  f.findCurrentSav
-00023570: 6564 5661 6c75 6528 7363 7265 656e 4469  edValue(screenDi
-00023580: 6374 2c20 7361 7665 4469 6374 2c20 2250  ct, saveDict, "P
-00023590: 6174 7465 726e 2229 0a20 2020 2020 2020  attern").       
-000235a0: 2069 6620 504b 4461 7465 5574 696c 6974   if PKDateUtilit
-000235b0: 6965 732e 6973 5472 6164 696e 6754 696d  ies.isTradingTim
-000235c0: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
-000235d0: 2072 616e 6765 4461 7461 203d 2064 6174   rangeData = dat
-000235e0: 612e 6865 6164 286e 7220 2b20 3129 5b31  a.head(nr + 1)[1
-000235f0: 3a5d 0a20 2020 2020 2020 2020 2020 206e  :].            n
-00023600: 6f77 5f63 616e 646c 6520 3d20 6461 7461  ow_candle = data
-00023610: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
-00023620: 2020 2020 2072 616e 6765 4461 7461 5b22       rangeData["
-00023630: 5261 6e67 6522 5d20 3d20 6162 7328 7261  Range"] = abs(ra
-00023640: 6e67 6544 6174 615b 2243 6c6f 7365 225d  ngeData["Close"]
-00023650: 202d 2072 616e 6765 4461 7461 5b22 4f70   - rangeData["Op
-00023660: 656e 225d 290a 2020 2020 2020 2020 2020  en"]).          
-00023670: 2020 7265 6365 6e74 203d 2072 616e 6765    recent = range
-00023680: 4461 7461 2e68 6561 6428 3129 0a20 2020  Data.head(1).   
-00023690: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-000236a0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-000236b0: 6e28 7265 6365 6e74 2920 3d3d 2031 0a20  n(recent) == 1. 
-000236c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000236d0: 6e64 2072 6563 656e 745b 2252 616e 6765  nd recent["Range
-000236e0: 225d 2e69 6c6f 635b 305d 203d 3d20 7261  "].iloc[0] == ra
-000236f0: 6e67 6544 6174 612e 6465 7363 7269 6265  ngeData.describe
-00023700: 2829 5b22 5261 6e67 6522 5d5b 226d 696e  ()["Range"]["min
-00023710: 225d 0a20 2020 2020 2020 2020 2020 2029  "].            )
-00023720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023730: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-00023740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00023750: 6765 7443 616e 646c 6554 7970 6528 7265  getCandleType(re
-00023760: 6365 6e74 290a 2020 2020 2020 2020 2020  cent).          
-00023770: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-00023780: 775f 6361 6e64 6c65 5b22 436c 6f73 6522  w_candle["Close"
-00023790: 5d2e 696c 6f63 5b30 5d20 3e3d 2072 6563  ].iloc[0] >= rec
-000237a0: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
-000237b0: 635b 305d 0a20 2020 2020 2020 2020 2020  c[0].           
-000237c0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-000237d0: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-000237e0: 656e 4469 6374 5b22 5061 7474 6572 6e22  enDict["Pattern"
-000237f0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
-00023800: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00023810: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
-00023820: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
-00023830: 6578 742e 4752 4545 4e20 2b20 6622 4275  ext.GREEN + f"Bu
-00023840: 792d 4e52 7b6e 727d 2220 2b20 636f 6c6f  y-NR{nr}" + colo
-00023850: 7254 6578 742e 454e 440a 2020 2020 2020  rText.END.      
-00023860: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00023870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023880: 2020 2020 7361 7665 4469 6374 5b22 5061      saveDict["Pa
-00023890: 7474 6572 6e22 5d20 3d20 7361 7665 645b  ttern"] = saved[
-000238a0: 315d 202b 2066 2242 7579 2d4e 527b 6e72  1] + f"Buy-NR{nr
-000238b0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-000238c0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-000238d0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000238e0: 2020 2065 6c69 6620 280a 2020 2020 2020     elif (.      
-000238f0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-00023900: 7420 7365 6c66 2e67 6574 4361 6e64 6c65  t self.getCandle
-00023910: 5479 7065 2872 6563 656e 7429 0a20 2020  Type(recent).   
-00023920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023930: 2061 6e64 206e 6f77 5f63 616e 646c 655b   and now_candle[
-00023940: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
-00023950: 203c 3d20 7265 6365 6e74 5b22 436c 6f73   <= recent["Clos
-00023960: 6522 5d2e 696c 6f63 5b30 5d0a 2020 2020  e"].iloc[0].    
-00023970: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00023980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023990: 2020 2073 6372 6565 6e44 6963 745b 2250     screenDict["P
-000239a0: 6174 7465 726e 225d 203d 2028 0a20 2020  attern"] = (.   
-000239b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239c0: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
-000239d0: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
-000239e0: 2063 6f6c 6f72 5465 7874 2e46 4149 4c20   colorText.FAIL 
-000239f0: 2b20 6622 5365 6c6c 2d4e 527b 6e72 7d22  + f"Sell-NR{nr}"
-00023a00: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-00023a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023a20: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00023a30: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00023a40: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00023a50: 2073 6176 6564 5b31 5d20 2b20 6622 5365   saved[1] + f"Se
-00023a60: 6c6c 2d4e 527b 6e72 7d22 0a20 2020 2020  ll-NR{nr}".     
-00023a70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00023a80: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00023a90: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00023aa0: 6c73 650a 2020 2020 2020 2020 656c 7365  lse.        else
-00023ab0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00023ac0: 6e67 6544 6174 6120 3d20 6461 7461 2e68  ngeData = data.h
-00023ad0: 6561 6428 6e72 290a 2020 2020 2020 2020  ead(nr).        
-00023ae0: 2020 2020 7261 6e67 6544 6174 612e 6c6f      rangeData.lo
-00023af0: 635b 3a2c 2752 616e 6765 275d 203d 2061  c[:,'Range'] = a
-00023b00: 6273 2872 616e 6765 4461 7461 5b22 436c  bs(rangeData["Cl
-00023b10: 6f73 6522 5d20 2d20 7261 6e67 6544 6174  ose"] - rangeDat
-00023b20: 615b 224f 7065 6e22 5d29 0a20 2020 2020  a["Open"]).     
-00023b30: 2020 2020 2020 2072 6563 656e 7420 3d20         recent = 
-00023b40: 7261 6e67 6544 6174 612e 6865 6164 2831  rangeData.head(1
-00023b50: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00023b60: 2072 6563 656e 745b 2252 616e 6765 225d   recent["Range"]
-00023b70: 2e69 6c6f 635b 305d 203d 3d20 7261 6e67  .iloc[0] == rang
-00023b80: 6544 6174 612e 6465 7363 7269 6265 2829  eData.describe()
-00023b90: 5b22 5261 6e67 6522 5d5b 226d 696e 225d  ["Range"]["min"]
-00023ba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023bb0: 2020 7363 7265 656e 4469 6374 5b22 5061    screenDict["Pa
-00023bc0: 7474 6572 6e22 5d20 3d20 280a 2020 2020  ttern"] = (.    
-00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023be0: 7361 7665 645b 305d 202b 2063 6f6c 6f72  saved[0] + color
-00023bf0: 5465 7874 2e42 4f4c 4420 2b20 636f 6c6f  Text.BOLD + colo
-00023c00: 7254 6578 742e 4752 4545 4e20 2b20 6622  rText.GREEN + f"
-00023c10: 4e52 7b6e 727d 2220 2b20 636f 6c6f 7254  NR{nr}" + colorT
-00023c20: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00023c30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00023c40: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-00023c50: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
-00023c60: 7361 7665 645b 315d 202b 2066 224e 527b  saved[1] + f"NR{
-00023c70: 6e72 7d22 0a20 2020 2020 2020 2020 2020  nr}".           
-00023c80: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00023c90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00023ca0: 7572 6e20 4661 6c73 650a 0a20 2020 2023  urn False..    #
-00023cb0: 2046 696e 6420 6966 2073 746f 636b 2069   Find if stock i
-00023cc0: 7320 6e65 776c 7920 6c69 7374 6564 0a20  s newly listed. 
-00023cd0: 2020 2064 6566 2076 616c 6964 6174 654e     def validateN
-00023ce0: 6577 6c79 4c69 7374 6564 2873 656c 662c  ewlyListed(self,
-00023cf0: 2064 662c 2064 6179 7354 6f4c 6f6f 6b62   df, daysToLookb
-00023d00: 6163 6b29 3a0a 2020 2020 2020 2020 6966  ack):.        if
-00023d10: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-00023d20: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-00023d30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00023d40: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
-00023d50: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
-00023d60: 2020 2020 2020 2064 6179 7354 6f4c 6f6f         daysToLoo
-00023d70: 6b62 6163 6b20 3d20 696e 7428 6461 7973  kback = int(days
-00023d80: 546f 4c6f 6f6b 6261 636b 5b3a 2d31 5d29  ToLookback[:-1])
-00023d90: 0a20 2020 2020 2020 2072 6563 656e 7420  .        recent 
-00023da0: 3d20 6461 7461 2e68 6561 6428 3129 0a20  = data.head(1). 
-00023db0: 2020 2020 2020 2069 6620 6c65 6e28 7265         if len(re
-00023dc0: 6365 6e74 2920 3c20 313a 0a20 2020 2020  cent) < 1:.     
-00023dd0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00023de0: 6c73 650a 2020 2020 2020 2020 6966 206c  lse.        if l
-00023df0: 656e 2864 6174 6129 203c 2064 6179 7354  en(data) < daysT
-00023e00: 6f4c 6f6f 6b62 6163 6b20 616e 6420 280a  oLookback and (.
-00023e10: 2020 2020 2020 2020 2020 2020 7265 6365              rece
-00023e20: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
-00023e30: 5b30 5d20 213d 206e 702e 6e61 6e20 616e  [0] != np.nan an
-00023e40: 6420 7265 6365 6e74 5b22 436c 6f73 6522  d recent["Close"
-00023e50: 5d2e 696c 6f63 5b30 5d20 3e20 300a 2020  ].iloc[0] > 0.  
-00023e60: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00023e70: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00023e80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00023e90: 4661 6c73 650a 0a20 2020 2023 2056 616c  False..    # Val
-00023ea0: 6964 6174 6520 6966 2074 6865 2073 746f  idate if the sto
-00023eb0: 636b 2070 7269 6365 7320 6172 6520 6174  ck prices are at
-00023ec0: 206c 6561 7374 2072 6973 696e 6720 6279   least rising by
-00023ed0: 2032 2520 666f 7220 7468 6520 6c61 7374   2% for the last
-00023ee0: 2033 2073 6573 7369 6f6e 730a 2020 2020   3 sessions.    
-00023ef0: 6465 6620 7661 6c69 6461 7465 5072 6963  def validatePric
-00023f00: 6552 6973 696e 6742 7941 744c 6561 7374  eRisingByAtLeast
-00023f10: 3250 6572 6365 6e74 2873 656c 662c 2064  2Percent(self, d
-00023f20: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
-00023f30: 6176 6544 6963 7429 3a0a 2020 2020 2020  aveDict):.      
-00023f40: 2020 6966 2064 6620 6973 204e 6f6e 6520    if df is None 
-00023f50: 6f72 206c 656e 2864 6629 203d 3d20 303a  or len(df) == 0:
-00023f60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00023f70: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00023f80: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
-00023f90: 2829 0a20 2020 2020 2020 2064 6174 6120  ().        data 
-00023fa0: 3d20 6461 7461 2e66 696c 6c6e 6128 3029  = data.fillna(0)
-00023fb0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00023fc0: 6461 7461 2e72 6570 6c61 6365 285b 6e70  data.replace([np
-00023fd0: 2e69 6e66 2c20 2d6e 702e 696e 665d 2c20  .inf, -np.inf], 
-00023fe0: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
-00023ff0: 3d20 6461 7461 2e68 6561 6428 3429 0a20  = data.head(4). 
-00024000: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
-00024010: 7461 2920 3c20 343a 0a20 2020 2020 2020  ta) < 4:.       
-00024020: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00024030: 650a 2020 2020 2020 2020 6461 7930 203d  e.        day0 =
-00024040: 2064 6174 612e 696c 6f63 5b30 5d5b 2243   data.iloc[0]["C
-00024050: 6c6f 7365 225d 2e69 7465 6d28 290a 2020  lose"].item().  
-00024060: 2020 2020 2020 6461 794d 696e 7573 3120        dayMinus1 
-00024070: 3d20 6461 7461 2e69 6c6f 635b 315d 5b22  = data.iloc[1]["
-00024080: 436c 6f73 6522 5d2e 6974 656d 2829 0a20  Close"].item(). 
-00024090: 2020 2020 2020 2064 6179 4d69 6e75 7332         dayMinus2
-000240a0: 203d 2064 6174 612e 696c 6f63 5b32 5d5b   = data.iloc[2][
-000240b0: 2243 6c6f 7365 225d 2e69 7465 6d28 290a  "Close"].item().
-000240c0: 2020 2020 2020 2020 6461 794d 696e 7573          dayMinus
-000240d0: 3320 3d20 6461 7461 2e69 6c6f 635b 335d  3 = data.iloc[3]
-000240e0: 5b22 436c 6f73 6522 5d2e 6974 656d 2829  ["Close"].item()
-000240f0: 0a20 2020 2020 2020 2070 6572 6365 6e74  .        percent
-00024100: 3320 3d20 726f 756e 6428 2864 6179 4d69  3 = round((dayMi
-00024110: 6e75 7332 202d 2064 6179 4d69 6e75 7333  nus2 - dayMinus3
-00024120: 2920 2a20 3130 3020 2f20 6461 794d 696e  ) * 100 / dayMin
-00024130: 7573 332c 2032 290a 2020 2020 2020 2020  us3, 2).        
-00024140: 7065 7263 656e 7432 203d 2072 6f75 6e64  percent2 = round
-00024150: 2828 6461 794d 696e 7573 3120 2d20 6461  ((dayMinus1 - da
-00024160: 794d 696e 7573 3229 202a 2031 3030 202f  yMinus2) * 100 /
-00024170: 2064 6179 4d69 6e75 7332 2c20 3229 0a20   dayMinus2, 2). 
-00024180: 2020 2020 2020 2070 6572 6365 6e74 3120         percent1 
-00024190: 3d20 726f 756e 6428 2864 6179 3020 2d20  = round((day0 - 
-000241a0: 6461 794d 696e 7573 3129 202a 2031 3030  dayMinus1) * 100
-000241b0: 202f 2064 6179 4d69 6e75 7331 2c20 3229   / dayMinus1, 2)
-000241c0: 0a0a 2020 2020 2020 2020 6966 2070 6572  ..        if per
-000241d0: 6365 6e74 3120 3e3d 2032 2061 6e64 2070  cent1 >= 2 and p
-000241e0: 6572 6365 6e74 3220 3e3d 2032 2061 6e64  ercent2 >= 2 and
-000241f0: 2070 6572 6365 6e74 3320 3e3d 2032 3a0a   percent3 >= 2:.
-00024200: 2020 2020 2020 2020 2020 2020 7063 745f              pct_
-00024210: 6368 616e 6765 5f74 6578 7420 3d20 280a  change_text = (.
-00024220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024230: 2822 252e 3166 2525 2220 2520 7065 7263  ("%.1f%%" % perc
-00024240: 656e 7431 290a 2020 2020 2020 2020 2020  ent1).          
-00024250: 2020 2020 2020 2b20 2822 2028 252e 3166        + (" (%.1f
-00024260: 2525 2c22 2025 2070 6572 6365 6e74 3229  %%," % percent2)
-00024270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024280: 202b 2028 2220 252e 3166 2525 2922 2025   + (" %.1f%%)" %
-00024290: 2070 6572 6365 6e74 3329 0a20 2020 2020   percent3).     
-000242a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000242b0: 2020 2020 2073 6176 6544 6963 745b 2225       saveDict["%
-000242c0: 4368 6e67 225d 203d 2070 6374 5f63 6861  Chng"] = pct_cha
-000242d0: 6e67 655f 7465 7874 0a20 2020 2020 2020  nge_text.       
-000242e0: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
-000242f0: 2225 4368 6e67 225d 203d 2063 6f6c 6f72  "%Chng"] = color
-00024300: 5465 7874 2e47 5245 454e 202b 2070 6374  Text.GREEN + pct
-00024310: 5f63 6861 6e67 655f 7465 7874 202b 2063  _change_text + c
-00024320: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
-00024330: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00024340: 5472 7565 2061 6e64 2073 656c 662e 6765  True and self.ge
-00024350: 7443 616e 646c 6554 7970 6528 6461 7461  tCandleType(data
-00024360: 2e68 6561 6428 3129 290a 2020 2020 2020  .head(1)).      
-00024370: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-00024380: 2020 2020 2340 6d65 6173 7572 655f 7469      #@measure_ti
-00024390: 6d65 0a20 2020 2023 2076 616c 6964 6174  me.    # validat
-000243a0: 6520 6966 2052 5349 2069 7320 7769 7468  e if RSI is with
-000243b0: 696e 2067 6976 656e 2072 616e 6765 0a20  in given range. 
-000243c0: 2020 2064 6566 2076 616c 6964 6174 6552     def validateR
-000243d0: 5349 2873 656c 662c 2064 662c 2073 6372  SI(self, df, scr
-000243e0: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-000243f0: 742c 206d 696e 5253 492c 206d 6178 5253  t, minRSI, maxRS
-00024400: 492c 7273 694b 6579 3d22 5253 4922 293a  I,rsiKey="RSI"):
-00024410: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
-00024420: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
-00024430: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00024440: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00024450: 0a20 2020 2020 2020 2069 6620 7273 694b  .        if rsiK
-00024460: 6579 206e 6f74 2069 6e20 6466 2e63 6f6c  ey not in df.col
-00024470: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-00024480: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00024490: 2020 2020 2020 2064 6174 6120 3d20 6466         data = df
-000244a0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-000244b0: 6461 7461 203d 2064 6174 612e 6669 6c6c  data = data.fill
-000244c0: 6e61 2830 290a 2020 2020 2020 2020 6461  na(0).        da
-000244d0: 7461 203d 2064 6174 612e 7265 706c 6163  ta = data.replac
-000244e0: 6528 5b6e 702e 696e 662c 202d 6e70 2e69  e([np.inf, -np.i
-000244f0: 6e66 5d2c 2030 290a 2020 2020 2020 2020  nf], 0).        
-00024500: 7273 6920 3d20 696e 7428 6461 7461 2e68  rsi = int(data.h
-00024510: 6561 6428 3129 5b72 7369 4b65 795d 2e69  ead(1)[rsiKey].i
-00024520: 6c6f 635b 305d 290a 2020 2020 2020 2020  loc[0]).        
-00024530: 7361 7665 4469 6374 5b72 7369 4b65 795d  saveDict[rsiKey]
-00024540: 203d 2072 7369 0a20 2020 2020 2020 2023   = rsi.        #
-00024550: 2068 7474 7073 3a2f 2f63 6861 7274 696e   https://chartin
-00024560: 6b2e 636f 6d2f 7363 7265 656e 6572 2f72  k.com/screener/r
-00024570: 7369 2d73 6372 6565 6e69 6e67 0a20 2020  si-screening.   
-00024580: 2020 2020 2069 6620 7273 693e 2030 2061       if rsi> 0 a
-00024590: 6e64 2072 7369 203e 3d20 6d69 6e52 5349  nd rsi >= minRSI
-000245a0: 2061 6e64 2072 7369 203c 3d20 6d61 7852   and rsi <= maxR
-000245b0: 5349 3a20 2023 206f 7220 2872 7369 203c  SI:  # or (rsi <
-000245c0: 3d20 3731 2061 6e64 2072 7369 203e 3d20  = 71 and rsi >= 
-000245d0: 3637 293a 0a20 2020 2020 2020 2020 2020  67):.           
-000245e0: 2073 6372 6565 6e44 6963 745b 7273 694b   screenDict[rsiK
-000245f0: 6579 5d20 3d20 280a 2020 2020 2020 2020  ey] = (.        
-00024600: 2020 2020 2020 2020 636f 6c6f 7254 6578          colorTex
-00024610: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
-00024620: 7874 2e47 5245 454e 202b 2073 7472 2872  xt.GREEN + str(r
-00024630: 7369 2920 2b20 636f 6c6f 7254 6578 742e  si) + colorText.
-00024640: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
-00024650: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00024660: 7475 726e 2054 7275 6520 6966 2028 7273  turn True if (rs
-00024670: 694b 6579 203d 3d20 2252 5349 6922 2920  iKey == "RSIi") 
-00024680: 656c 7365 2028 7365 6c66 2e76 616c 6964  else (self.valid
-00024690: 6174 6552 5349 2864 662c 2073 6372 6565  ateRSI(df, scree
-000246a0: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
-000246b0: 206d 696e 5253 492c 206d 6178 5253 492c   minRSI, maxRSI,
-000246c0: 7273 694b 6579 3d22 5253 4969 2229 206f  rsiKey="RSIi") o
-000246d0: 7220 5472 7565 290a 2020 2020 2020 2020  r True).        
-000246e0: 7363 7265 656e 4469 6374 5b72 7369 4b65  screenDict[rsiKe
-000246f0: 795d 203d 2063 6f6c 6f72 5465 7874 2e42  y] = colorText.B
-00024700: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
-00024710: 4641 494c 202b 2073 7472 2872 7369 2920  FAIL + str(rsi) 
-00024720: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
-00024730: 2020 2020 2020 2020 2320 4966 2065 6974          # If eit
-00024740: 6865 7220 6461 696c 7920 6f72 2069 6e74  her daily or int
-00024750: 7261 6461 7920 5253 4920 636f 6d65 7320  raday RSI comes 
-00024760: 7769 7468 696e 2072 616e 6765 3f0a 2020  within range?.  
-00024770: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00024780: 7365 2069 6620 2872 7369 4b65 7920 3d3d  se if (rsiKey ==
-00024790: 2022 5253 4969 2229 2065 6c73 6520 2873   "RSIi") else (s
-000247a0: 656c 662e 7661 6c69 6461 7465 5253 4928  elf.validateRSI(
-000247b0: 6466 2c20 7363 7265 656e 4469 6374 2c20  df, screenDict, 
-000247c0: 7361 7665 4469 6374 2c20 6d69 6e52 5349  saveDict, minRSI
-000247d0: 2c20 6d61 7852 5349 2c72 7369 4b65 793d  , maxRSI,rsiKey=
-000247e0: 2252 5349 6922 2929 0a0a 2020 2020 2320  "RSIi"))..    # 
-000247f0: 5661 6c69 6461 7465 2069 6620 7468 6520  Validate if the 
-00024800: 7374 6f63 6b20 6973 2062 756c 6c69 7368  stock is bullish
-00024810: 2069 6e20 7468 6520 7368 6f72 7420 7465   in the short te
-00024820: 726d 0a20 2020 2064 6566 2076 616c 6964  rm.    def valid
-00024830: 6174 6553 686f 7274 5465 726d 4275 6c6c  ateShortTermBull
-00024840: 6973 6828 7365 6c66 2c20 6466 2c20 7363  ish(self, df, sc
-00024850: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-00024860: 6374 293a 0a20 2020 2020 2020 2069 6620  ct):.        if 
-00024870: 6466 2069 7320 4e6f 6e65 206f 7220 6c65  df is None or le
-00024880: 6e28 6466 2920 3d3d 2030 3a0a 2020 2020  n(df) == 0:.    
-00024890: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000248a0: 616c 7365 0a20 2020 2020 2020 2064 6174  alse.        dat
-000248b0: 6120 3d20 6466 2e63 6f70 7928 290a 2020  a = df.copy().  
-000248c0: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-000248d0: 6368 6172 7469 6e6b 2e63 6f6d 2f73 6372  chartink.com/scr
-000248e0: 6565 6e65 722f 7368 6f72 742d 7465 726d  eener/short-term
-000248f0: 2d62 756c 6c69 7368 0a20 2020 2020 2020  -bullish.       
-00024900: 2064 6174 6120 3d20 6461 7461 2e66 696c   data = data.fil
-00024910: 6c6e 6128 3029 0a20 2020 2020 2020 2064  lna(0).        d
-00024920: 6174 6120 3d20 6461 7461 2e72 6570 6c61  ata = data.repla
-00024930: 6365 285b 6e70 2e69 6e66 2c20 2d6e 702e  ce([np.inf, -np.
-00024940: 696e 665d 2c20 3029 0a20 2020 2020 2020  inf], 0).       
-00024950: 2072 6563 656e 7420 3d20 6461 7461 2e68   recent = data.h
-00024960: 6561 6428 3129 0a20 2020 2020 2020 2066  ead(1).        f
-00024970: 6b20 3d20 3020 6966 206c 656e 2864 6174  k = 0 if len(dat
-00024980: 6129 203c 2033 2065 6c73 6520 6e70 2e72  a) < 3 else np.r
-00024990: 6f75 6e64 2864 6174 615b 2246 4153 544b  ound(data["FASTK
-000249a0: 225d 2e69 6c6f 635b 325d 2c20 3529 0a20  "].iloc[2], 5). 
-000249b0: 2020 2020 2020 2023 2052 6576 6572 7365         # Reverse
-000249c0: 2074 6865 2064 6174 6166 7261 6d65 2066   the dataframe f
-000249d0: 6f72 2069 6368 696d 6f6b 7520 6361 6c63  or ichimoku calc
-000249e0: 756c 6174 696f 6e73 2077 6974 6820 6461  ulations with da
-000249f0: 7465 2069 6e20 6173 6365 6e64 696e 6720  te in ascending 
-00024a00: 6f72 6465 720a 2020 2020 2020 2020 6466  order.        df
-00024a10: 5f6e 6577 203d 2064 6174 615b 3a3a 2d31  _new = data[::-1
-00024a20: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
-00024a30: 2020 2020 2020 2020 2020 2064 665f 6963             df_ic
-00024a40: 6869 203d 2064 665f 6e65 772e 7265 6e61  hi = df_new.rena
-00024a50: 6d65 280a 2020 2020 2020 2020 2020 2020  me(.            
-00024a60: 2020 2020 636f 6c75 6d6e 733d 7b0a 2020      columns={.  
-00024a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a80: 2020 224f 7065 6e22 3a20 226f 7065 6e22    "Open": "open"
-00024a90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00024aa0: 2020 2020 2020 2248 6967 6822 3a20 2268        "High": "h
-00024ab0: 6967 6822 2c0a 2020 2020 2020 2020 2020  igh",.          
-00024ac0: 2020 2020 2020 2020 2020 224c 6f77 223a            "Low":
-00024ad0: 2022 6c6f 7722 2c0a 2020 2020 2020 2020   "low",.        
-00024ae0: 2020 2020 2020 2020 2020 2020 2243 6c6f              "Clo
-00024af0: 7365 223a 2022 636c 6f73 6522 2c0a 2020  se": "close",.  
-00024b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b10: 2020 2256 6f6c 756d 6522 3a20 2276 6f6c    "Volume": "vol
-00024b20: 756d 6522 2c0a 2020 2020 2020 2020 2020  ume",.          
-00024b30: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00024b40: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00024b50: 2020 6963 6869 203d 2070 6b74 616c 6962    ichi = pktalib
-00024b60: 2e69 6368 696d 6f6b 7528 6466 5f69 6368  .ichimoku(df_ich
-00024b70: 692c 2039 2c20 3236 2c20 3532 2c20 3236  i, 9, 26, 52, 26
-00024b80: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00024b90: 2069 6368 6920 6973 204e 6f6e 653a 0a20   ichi is None:. 
-00024ba0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00024bb0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00024bc0: 2020 2020 2020 2020 6466 5f6e 6577 203d          df_new =
-00024bd0: 2070 642e 636f 6e63 6174 285b 6466 5f6e   pd.concat([df_n
-00024be0: 6577 2c20 6963 6869 5d2c 2061 7869 733d  ew, ichi], axis=
-00024bf0: 3129 0a20 2020 2020 2020 2020 2020 2023  1).            #
-00024c00: 2052 6576 6572 7365 2061 6761 696e 2074   Reverse again t
-00024c10: 6f20 6765 7420 7468 6520 6d6f 7374 2072  o get the most r
-00024c20: 6563 656e 7420 6461 7465 206f 6e20 746f  ecent date on to
-00024c30: 700a 2020 2020 2020 2020 2020 2020 6466  p.            df
-00024c40: 5f6e 6577 203d 2064 665f 6e65 775b 3a3a  _new = df_new[::
-00024c50: 2d31 5d0a 2020 2020 2020 2020 2020 2020  -1].            
-00024c60: 6466 5f6e 6577 203d 2064 665f 6e65 772e  df_new = df_new.
-00024c70: 6865 6164 2831 290a 2020 2020 2020 2020  head(1).        
-00024c80: 2020 2020 6466 5f6e 6577 5b22 636c 6f75      df_new["clou
-00024c90: 645f 6772 6565 6e22 5d20 3d20 6466 5f6e  d_green"] = df_n
-00024ca0: 6577 5b22 4953 415f 3922 5d2e 696c 6f63  ew["ISA_9"].iloc
-00024cb0: 5b30 5d20 3e20 6466 5f6e 6577 5b22 4953  [0] > df_new["IS
-00024cc0: 425f 3236 225d 2e69 6c6f 635b 305d 0a20  B_26"].iloc[0]. 
-00024cd0: 2020 2020 2020 2020 2020 2064 665f 6e65             df_ne
-00024ce0: 775b 2263 6c6f 7564 5f72 6564 225d 203d  w["cloud_red"] =
-00024cf0: 2064 665f 6e65 775b 2249 5342 5f32 3622   df_new["ISB_26"
-00024d00: 5d2e 696c 6f63 5b30 5d20 3e20 6466 5f6e  ].iloc[0] > df_n
-00024d10: 6577 5b22 4953 415f 3922 5d2e 696c 6f63  ew["ISA_9"].iloc
-00024d20: 5b30 5d0a 2020 2020 2020 2020 6578 6365  [0].        exce
-00024d30: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00024d40: 653a 2020 2320 7072 6167 6d61 3a20 6e6f  e:  # pragma: no
-00024d50: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-00024d60: 2020 2073 656c 662e 6465 6661 756c 745f     self.default_
-00024d70: 6c6f 6767 6572 2e64 6562 7567 2865 2c20  logger.debug(e, 
-00024d80: 6578 635f 696e 666f 3d54 7275 6529 0a20  exc_info=True). 
-00024d90: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00024da0: 2020 2020 2020 2020 6162 6f76 6543 6c6f          aboveClo
-00024db0: 7564 546f 7020 3d20 4661 6c73 650a 2020  udTop = False.  
-00024dc0: 2020 2020 2020 2320 6261 7365 6c69 6e65        # baseline
-00024dd0: 203e 2063 6c6f 7564 2074 6f70 2028 636c   > cloud top (cl
-00024de0: 6f75 6420 6973 2062 6f75 6e64 2062 7920  oud is bound by 
-00024df0: 7370 616e 2061 2061 6e64 2073 7061 6e20  span a and span 
-00024e00: 6229 2061 6e64 2063 6c6f 7365 2069 7320  b) and close is 
-00024e10: 3e20 636c 6f75 6420 746f 700a 2020 2020  > cloud top.    
-00024e20: 2020 2020 6966 2064 665f 6e65 775b 2263      if df_new["c
-00024e30: 6c6f 7564 5f67 7265 656e 225d 2e69 6c6f  loud_green"].ilo
-00024e40: 635b 305d 3a0a 2020 2020 2020 2020 2020  c[0]:.          
-00024e50: 2020 6162 6f76 6543 6c6f 7564 546f 7020    aboveCloudTop 
-00024e60: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00024e70: 2020 2020 6466 5f6e 6577 5b22 494b 535f      df_new["IKS_
-00024e80: 3236 225d 2e69 6c6f 635b 305d 203e 2064  26"].iloc[0] > d
-00024e90: 665f 6e65 775b 2249 5341 5f39 225d 2e69  f_new["ISA_9"].i
-00024ea0: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
-00024eb0: 2020 2020 2020 2061 6e64 2072 6563 656e         and recen
-00024ec0: 745b 2243 6c6f 7365 225d 2e69 6c6f 635b  t["Close"].iloc[
-00024ed0: 305d 203e 2064 665f 6e65 775b 2249 5341  0] > df_new["ISA
-00024ee0: 5f39 225d 2e69 6c6f 635b 305d 0a20 2020  _9"].iloc[0].   
-00024ef0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00024f00: 2020 2065 6c69 6620 6466 5f6e 6577 5b22     elif df_new["
-00024f10: 636c 6f75 645f 7265 6422 5d2e 696c 6f63  cloud_red"].iloc
-00024f20: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
-00024f30: 2061 626f 7665 436c 6f75 6454 6f70 203d   aboveCloudTop =
-00024f40: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00024f50: 2020 2064 665f 6e65 775b 2249 4b53 5f32     df_new["IKS_2
-00024f60: 3622 5d2e 696c 6f63 5b30 5d20 3e20 6466  6"].iloc[0] > df
-00024f70: 5f6e 6577 5b22 4953 425f 3236 225d 2e69  _new["ISB_26"].i
-00024f80: 6c6f 635b 305d 0a20 2020 2020 2020 2020  loc[0].         
-00024f90: 2020 2020 2020 2061 6e64 2072 6563 656e         and recen
-00024fa0: 745b 2243 6c6f 7365 225d 2e69 6c6f 635b  t["Close"].iloc[
-00024fb0: 305d 203e 2064 665f 6e65 775b 2249 5342  0] > df_new["ISB
-00024fc0: 5f32 3622 5d2e 696c 6f63 5b30 5d0a 2020  _26"].iloc[0].  
-00024fd0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00024fe0: 2020 2020 2023 204c 6174 6573 7420 4963       # Latest Ic
-00024ff0: 6869 6d6f 6b75 2062 6173 656c 696e 6520  himoku baseline 
-00025000: 6973 203c 206c 6174 6573 7420 4963 6869  is < latest Ichi
-00025010: 6d6f 6b75 2063 6f6e 7665 7273 696f 6e20  moku conversion 
-00025020: 6c69 6e65 0a20 2020 2020 2020 2069 6620  line.        if 
-00025030: 6162 6f76 6543 6c6f 7564 546f 7020 616e  aboveCloudTop an
-00025040: 6420 6466 5f6e 6577 5b22 494b 535f 3236  d df_new["IKS_26
-00025050: 225d 2e69 6c6f 635b 305d 203c 2064 665f  "].iloc[0] < df_
-00025060: 6e65 775b 2249 5453 5f39 225d 2e69 6c6f  new["ITS_9"].ilo
-00025070: 635b 305d 3a0a 2020 2020 2020 2020 2020  c[0]:.          
-00025080: 2020 2320 5374 6f63 6852 5349 2063 726f    # StochRSI cro
-00025090: 7373 6564 2032 3020 616e 6420 5253 4920  ssed 20 and RSI 
-000250a0: 3e20 3530 0a20 2020 2020 2020 2020 2020  > 50.           
-000250b0: 2069 6620 666b 203e 2032 3020 616e 6420   if fk > 20 and 
-000250c0: 7265 6365 6e74 5b22 5253 4922 5d2e 696c  recent["RSI"].il
-000250d0: 6f63 5b30 5d20 3e20 3530 3a0a 2020 2020  oc[0] > 50:.    
-000250e0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-000250f0: 6e64 6974 696f 6e20 6f66 2063 726f 7373  ndition of cross
-00025100: 696e 6720 7468 6520 5374 6f63 6852 5349  ing the StochRSI
-00025110: 206d 6169 6e20 7369 676e 616c 206c 696e   main signal lin
-00025120: 6520 6672 6f6d 2062 6f74 746f 6d20 746f  e from bottom to
-00025130: 2074 6f70 0a20 2020 2020 2020 2020 2020   top.           
-00025140: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00025150: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00025160: 7461 5b22 4641 5354 4422 5d2e 696c 6f63  ta["FASTD"].iloc
-00025170: 5b31 3030 5d20 3c20 6461 7461 5b22 4641  [100] < data["FA
-00025180: 5354 4b22 5d2e 696c 6f63 5b31 3030 5d0a  STK"].iloc[100].
+00021e70: 2020 2020 2023 2073 656c 662e 6465 6661       # self.defa
+00021e80: 756c 745f 6c6f 6767 6572 2e69 6e66 6f28  ult_logger.info(
+00021e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021ea0: 2020 2020 2020 2020 2023 2020 2020 2066           #     f
+00021eb0: 2753 746f 636b 3a7b 7361 7665 4469 6374  'Stock:{saveDict
+00021ec0: 5b22 5374 6f63 6b22 5d7d 2c20 6973 2061  ["Stock"]}, is a
+00021ed0: 206d 6f6d 656e 7475 6d2d 6761 696e 6572   momentum-gainer
+00021ee0: 2062 6563 6175 7365 2074 6f64 6179 2d6f   because today-o
+00021ef0: 7065 6e20 287b 746f 7d29 203e 3d20 7965  pen ({to}) >= ye
+00021f00: 7374 6572 6461 792d 636c 6f73 6520 287b  sterday-close ({
+00021f10: 7963 7d29 2061 6e64 2079 6573 7465 7264  yc}) and yesterd
+00021f20: 6179 2d6f 7065 6e28 7b79 6f7d 2920 3e3d  ay-open({yo}) >=
+00021f30: 2064 6179 2d62 6566 6f72 652d 636c 6f73   day-before-clos
+00021f40: 6528 7b64 7963 7d29 270a 2020 2020 2020  e({dyc})'.      
+00021f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f60: 2020 2320 290a 2020 2020 2020 2020 2020    # ).          
+00021f70: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00021f80: 7665 6420 3d20 7365 6c66 2e66 696e 6443  ved = self.findC
+00021f90: 7572 7265 6e74 5361 7665 6456 616c 7565  urrentSavedValue
+00021fa0: 2873 6372 6565 6e44 6963 742c 2073 6176  (screenDict, sav
+00021fb0: 6544 6963 742c 2022 5061 7474 6572 6e22  eDict, "Pattern"
+00021fc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021fd0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00021fe0: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
+00021ff0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00022000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022010: 7361 7665 645b 305d 0a20 2020 2020 2020  saved[0].       
+00022020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022030: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+00022040: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
+00022050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022060: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+00022070: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
+00022080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022090: 2b20 224d 6f6d 656e 7475 6d20 4761 696e  + "Momentum Gain
+000220a0: 6572 220a 2020 2020 2020 2020 2020 2020  er".            
+000220b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220c0: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+000220d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000220f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022100: 2020 7361 7665 4469 6374 5b22 5061 7474    saveDict["Patt
+00022110: 6572 6e22 5d20 3d20 7361 7665 645b 315d  ern"] = saved[1]
+00022120: 202b 2022 4d6f 6d65 6e74 756d 2047 6169   + "Momentum Gai
+00022130: 6e65 7222 0a20 2020 2020 2020 2020 2020  ner".           
+00022140: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00022150: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+00022160: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+00022170: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+00022180: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
+00022190: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+000221a0: 2020 2066 2753 746f 636b 3a7b 7361 7665     f'Stock:{save
+000221b0: 4469 6374 5b22 5374 6f63 6b22 5d7d 2c20  Dict["Stock"]}, 
+000221c0: 6973 206e 6f74 2061 206d 6f6d 656e 7475  is not a momentu
+000221d0: 6d2d 6761 696e 6572 2062 6563 6175 7365  m-gainer because
+000221e0: 2065 6974 6865 7220 746f 6461 792d 6f70   either today-op
+000221f0: 656e 2028 7b74 6f7d 2920 3c20 7965 7374  en ({to}) < yest
+00022200: 6572 6461 792d 636c 6f73 6520 287b 7963  erday-close ({yc
+00022210: 7d29 206f 7220 7965 7374 6572 6461 792d  }) or yesterday-
+00022220: 6f70 656e 287b 796f 7d29 203c 2064 6179  open({yo}) < day
+00022230: 2d62 6566 6f72 652d 636c 6f73 6528 7b64  -before-close({d
+00022240: 7963 7d29 270a 2020 2020 2020 2020 2020  yc})'.          
+00022250: 2020 2020 2020 2020 2020 2320 290a 2020            # ).  
+00022260: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00022270: 2049 6e64 6578 4572 726f 7220 6173 2065   IndexError as e
+00022280: 3a20 2320 7072 6167 6d61 3a20 6e6f 2063  : # pragma: no c
+00022290: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
+000222a0: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
+000222b0: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
+000222c0: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
+000222d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000222e0: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
+000222f0: 6767 6572 2e64 6562 7567 2864 6174 6129  gger.debug(data)
+00022300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022310: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00022320: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00022330: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00022340: 6365 7074 696f 6e20 6173 2065 3a20 2023  ception as e:  #
+00022350: 2070 7261 676d 613a 206e 6f20 636f 7665   pragma: no cove
+00022360: 720a 2020 2020 2020 2020 2020 2020 7365  r.            se
+00022370: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+00022380: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
+00022390: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
+000223a0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000223b0: 7365 0a0a 2020 2020 2340 6d65 6173 7572  se..    #@measur
+000223c0: 655f 7469 6d65 0a20 2020 2023 2056 616c  e_time.    # Val
+000223d0: 6964 6174 6520 4d6f 7669 6e67 2061 7665  idate Moving ave
+000223e0: 7261 6765 7320 616e 6420 6c6f 6f6b 2066  rages and look f
+000223f0: 6f72 2062 7579 2f73 656c 6c20 7369 676e  or buy/sell sign
+00022400: 616c 730a 2020 2020 6465 6620 7661 6c69  als.    def vali
+00022410: 6461 7465 4d6f 7669 6e67 4176 6572 6167  dateMovingAverag
+00022420: 6573 2873 656c 662c 2064 662c 2073 6372  es(self, df, scr
+00022430: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+00022440: 742c 206d 6152 616e 6765 3d32 2e35 2c6d  t, maRange=2.5,m
+00022450: 614c 656e 6774 683d 3029 3a0a 2020 2020  aLength=0):.    
+00022460: 2020 2020 6461 7461 203d 2064 662e 636f      data = df.co
+00022470: 7079 2829 0a20 2020 2020 2020 2064 6174  py().        dat
+00022480: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
+00022490: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+000224a0: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
+000224b0: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
+000224c0: 2c20 3029 0a20 2020 2020 2020 2072 6563  , 0).        rec
+000224d0: 656e 7420 3d20 6461 7461 2e68 6561 6428  ent = data.head(
+000224e0: 3129 0a20 2020 2020 2020 206d 6153 6967  1).        maSig
+000224f0: 6e61 6c73 203d 205b 5d0a 2020 2020 2020  nals = [].      
+00022500: 2020 6966 2073 7472 286d 614c 656e 6774    if str(maLengt
+00022510: 6829 2069 6e20 5b22 3022 2c22 3222 2c22  h) in ["0","2","
+00022520: 3322 5d3a 0a20 2020 2020 2020 2020 2020  3"]:.           
+00022530: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
+00022540: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+00022550: 6c75 6528 7363 7265 656e 4469 6374 2c73  lue(screenDict,s
+00022560: 6176 6544 6963 742c 224d 412d 5369 676e  aveDict,"MA-Sign
+00022570: 616c 2229 0a20 2020 2020 2020 2020 2020  al").           
+00022580: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00022590: 2020 2020 2020 7265 6365 6e74 5b22 534d        recent["SM
+000225a0: 4122 5d2e 696c 6f63 5b30 5d20 3e20 7265  A"].iloc[0] > re
+000225b0: 6365 6e74 5b22 4c4d 4122 5d2e 696c 6f63  cent["LMA"].iloc
+000225c0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+000225d0: 2020 2020 616e 6420 7265 6365 6e74 5b22      and recent["
+000225e0: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+000225f0: 3e20 7265 6365 6e74 5b22 534d 4122 5d2e  > recent["SMA"].
+00022600: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+00022610: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00022620: 2020 2020 2020 2073 6372 6565 6e44 6963         screenDic
+00022630: 745b 224d 412d 5369 676e 616c 225d 203d  t["MA-Signal"] =
+00022640: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00022650: 2020 2020 2020 2073 6176 6564 5b30 5d20         saved[0] 
+00022660: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
+00022670: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
+00022680: 454e 202b 2022 4275 6c6c 6973 6822 202b  EN + "Bullish" +
+00022690: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+000226a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000226b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000226c0: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
+000226d0: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
+000226e0: 5d20 2b20 2242 756c 6c69 7368 220a 2020  ] + "Bullish".  
+000226f0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00022700: 5369 676e 616c 732e 6170 7065 6e64 2822  Signals.append("
+00022710: 3322 290a 2020 2020 2020 2020 2020 2020  3").            
+00022720: 656c 6966 2072 6563 656e 745b 2253 4d41  elif recent["SMA
+00022730: 225d 2e69 6c6f 635b 305d 203c 2072 6563  "].iloc[0] < rec
+00022740: 656e 745b 224c 4d41 225d 2e69 6c6f 635b  ent["LMA"].iloc[
+00022750: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+00022760: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+00022770: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
+00022780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022790: 2020 2020 7361 7665 645b 305d 202b 2063      saved[0] + c
+000227a0: 6f6c 6f72 5465 7874 2e42 4f4c 4420 2b20  olorText.BOLD + 
+000227b0: 636f 6c6f 7254 6578 742e 4641 494c 202b  colorText.FAIL +
+000227c0: 2022 4265 6172 6973 6822 202b 2063 6f6c   "Bearish" + col
+000227d0: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+000227e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000227f0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00022800: 6544 6963 745b 224d 412d 5369 676e 616c  eDict["MA-Signal
+00022810: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
+00022820: 2242 6561 7269 7368 220a 2020 2020 2020  "Bearish".      
+00022830: 2020 2020 2020 2020 2020 6d61 5369 676e            maSign
+00022840: 616c 732e 6170 7065 6e64 2822 3222 290a  als.append("2").
+00022850: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00022860: 2072 6563 656e 745b 2253 4d41 225d 2e69   recent["SMA"].i
+00022870: 6c6f 635b 305d 203d 3d20 303a 0a20 2020  loc[0] == 0:.   
+00022880: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+00022890: 6565 6e44 6963 745b 224d 412d 5369 676e  eenDict["MA-Sign
+000228a0: 616c 225d 203d 2028 0a20 2020 2020 2020  al"] = (.       
+000228b0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+000228c0: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+000228d0: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+000228e0: 7874 2e57 4152 4e20 2b20 2255 6e6b 6e6f  xt.WARN + "Unkno
+000228f0: 776e 2220 2b20 636f 6c6f 7254 6578 742e  wn" + colorText.
+00022900: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00022910: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00022920: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00022930: 4d41 2d53 6967 6e61 6c22 5d20 3d20 7361  MA-Signal"] = sa
+00022940: 7665 645b 315d 202b 2022 556e 6b6e 6f77  ved[1] + "Unknow
+00022950: 6e22 0a20 2020 2020 2020 2020 2020 2065  n".            e
+00022960: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022970: 2020 2020 2073 6372 6565 6e44 6963 745b       screenDict[
+00022980: 224d 412d 5369 676e 616c 225d 203d 2028  "MA-Signal"] = (
+00022990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000229a0: 2020 2020 2073 6176 6564 5b30 5d20 2b20       saved[0] + 
+000229b0: 636f 6c6f 7254 6578 742e 424f 4c44 202b  colorText.BOLD +
+000229c0: 2063 6f6c 6f72 5465 7874 2e57 4152 4e20   colorText.WARN 
+000229d0: 2b20 224e 6575 7472 616c 2220 2b20 636f  + "Neutral" + co
+000229e0: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+000229f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00022a00: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00022a10: 7665 4469 6374 5b22 4d41 2d53 6967 6e61  veDict["MA-Signa
+00022a20: 6c22 5d20 3d20 7361 7665 645b 315d 202b  l"] = saved[1] +
+00022a30: 2022 4e65 7574 7261 6c22 0a20 2020 2020   "Neutral".     
+00022a40: 2020 2072 6576 6572 7365 6444 6174 6120     reversedData 
+00022a50: 3d20 6461 7461 5b3a 3a2d 315d 2020 2320  = data[::-1]  # 
+00022a60: 5265 7665 7273 6520 7468 6520 6461 7461  Reverse the data
+00022a70: 6672 616d 650a 2020 2020 2020 2020 656d  frame.        em
+00022a80: 615f 3230 203d 2070 6b74 616c 6962 2e45  a_20 = pktalib.E
+00022a90: 4d41 2872 6576 6572 7365 6444 6174 615b  MA(reversedData[
+00022aa0: 2243 6c6f 7365 225d 2c32 3029 2e74 6169  "Close"],20).tai
+00022ab0: 6c28 3129 2e69 6c6f 635b 305d 0a20 2020  l(1).iloc[0].   
+00022ac0: 2020 2020 2076 7761 7020 3d20 706b 7461       vwap = pkta
+00022ad0: 6c69 622e 5657 4150 2872 6576 6572 7365  lib.VWAP(reverse
+00022ae0: 6444 6174 615b 2248 6967 6822 5d2c 7265  dData["High"],re
+00022af0: 7665 7273 6564 4461 7461 5b22 4c6f 7722  versedData["Low"
+00022b00: 5d2c 7265 7665 7273 6564 4461 7461 5b22  ],reversedData["
+00022b10: 436c 6f73 6522 5d2c 7265 7665 7273 6564  Close"],reversed
+00022b20: 4461 7461 5b22 566f 6c75 6d65 225d 292e  Data["Volume"]).
+00022b30: 7461 696c 2831 292e 696c 6f63 5b30 5d0a  tail(1).iloc[0].
+00022b40: 2020 2020 2020 2020 736d 6144 6576 203d          smaDev =
+00022b50: 2064 6174 615b 2253 4d41 225d 2e69 6c6f   data["SMA"].ilo
+00022b60: 635b 305d 202a 206d 6152 616e 6765 202f  c[0] * maRange /
+00022b70: 2031 3030 0a20 2020 2020 2020 206c 6d61   100.        lma
+00022b80: 4465 7620 3d20 6461 7461 5b22 4c4d 4122  Dev = data["LMA"
+00022b90: 5d2e 696c 6f63 5b30 5d20 2a20 6d61 5261  ].iloc[0] * maRa
+00022ba0: 6e67 6520 2f20 3130 300a 2020 2020 2020  nge / 100.      
+00022bb0: 2020 656d 6144 6576 203d 2065 6d61 5f32    emaDev = ema_2
+00022bc0: 3020 2a20 6d61 5261 6e67 6520 2f20 3130  0 * maRange / 10
+00022bd0: 300a 2020 2020 2020 2020 7677 6170 4465  0.        vwapDe
+00022be0: 7620 3d20 7677 6170 202a 206d 6152 616e  v = vwap * maRan
+00022bf0: 6765 202f 2031 3030 0a20 2020 2020 2020  ge / 100.       
+00022c00: 206f 7065 6e2c 2068 6967 682c 206c 6f77   open, high, low
+00022c10: 2c20 636c 6f73 652c 2073 6d61 2c20 6c6d  , close, sma, lm
+00022c20: 6120 3d20 280a 2020 2020 2020 2020 2020  a = (.          
+00022c30: 2020 6461 7461 5b22 4f70 656e 225d 2e69    data["Open"].i
+00022c40: 6c6f 635b 305d 2c0a 2020 2020 2020 2020  loc[0],.        
+00022c50: 2020 2020 6461 7461 5b22 4869 6768 225d      data["High"]
+00022c60: 2e69 6c6f 635b 305d 2c0a 2020 2020 2020  .iloc[0],.      
+00022c70: 2020 2020 2020 6461 7461 5b22 4c6f 7722        data["Low"
+00022c80: 5d2e 696c 6f63 5b30 5d2c 0a20 2020 2020  ].iloc[0],.     
+00022c90: 2020 2020 2020 2064 6174 615b 2243 6c6f         data["Clo
+00022ca0: 7365 225d 2e69 6c6f 635b 305d 2c0a 2020  se"].iloc[0],.  
+00022cb0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+00022cc0: 534d 4122 5d2e 696c 6f63 5b30 5d2c 0a20  SMA"].iloc[0],. 
+00022cd0: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+00022ce0: 224c 4d41 225d 2e69 6c6f 635b 305d 2c0a  "LMA"].iloc[0],.
+00022cf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022d00: 2020 6d61 7320 3d20 5b73 6d61 2c6c 6d61    mas = [sma,lma
+00022d10: 2c65 6d61 5f32 302c 7677 6170 5d20 6966  ,ema_20,vwap] if
+00022d20: 206d 614c 656e 6774 683d 3d30 2065 6c73   maLength==0 els
+00022d30: 6520 5b73 6d61 2c6c 6d61 2c65 6d61 5f32  e [sma,lma,ema_2
+00022d40: 305d 0a20 2020 2020 2020 206d 6144 6576  0].        maDev
+00022d50: 7320 3d20 5b73 6d61 4465 762c 206c 6d61  s = [smaDev, lma
+00022d60: 4465 762c 2065 6d61 4465 762c 2076 7761  Dev, emaDev, vwa
+00022d70: 7044 6576 5d20 6966 206d 614c 656e 6774  pDev] if maLengt
+00022d80: 683d 3d30 2065 6c73 6520 5b73 6d61 4465  h==0 else [smaDe
+00022d90: 762c 206c 6d61 4465 762c 2065 6d61 4465  v, lmaDev, emaDe
+00022da0: 765d 0a20 2020 2020 2020 206d 6154 6578  v].        maTex
+00022db0: 7473 203d 205b 2235 304d 4122 2c22 3230  ts = ["50MA","20
+00022dc0: 304d 4122 2c22 3230 454d 4122 2c22 5657  0MA","20EMA","VW
+00022dd0: 4150 225d 2069 6620 6d61 4c65 6e67 7468  AP"] if maLength
+00022de0: 3d3d 3020 656c 7365 205b 2235 304d 4122  ==0 else ["50MA"
+00022df0: 2c22 3230 304d 4122 2c22 3230 454d 4122  ,"200MA","20EMA"
+00022e00: 5d0a 2020 2020 2020 2020 6d61 5265 7665  ].        maReve
+00022e10: 7273 616c 203d 2030 0a20 2020 2020 2020  rsal = 0.       
+00022e20: 2069 6e64 6578 203d 2030 0a20 2020 2020   index = 0.     
+00022e30: 2020 2062 756c 6c69 7368 4361 6e64 6c65     bullishCandle
+00022e40: 203d 2073 656c 662e 6765 7443 616e 646c   = self.getCandl
+00022e50: 6554 7970 6528 6461 7461 290a 2020 2020  eType(data).    
+00022e60: 2020 2020 6966 2073 7472 286d 614c 656e      if str(maLen
+00022e70: 6774 6829 206e 6f74 2069 6e20 5b22 3222  gth) not in ["2"
+00022e80: 2c22 3322 5d3a 0a20 2020 2020 2020 2020  ,"3"]:.         
+00022e90: 2020 2066 6f72 206d 6120 696e 206d 6173     for ma in mas
+00022ea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022eb0: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
+00022ec0: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
+00022ed0: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
+00022ee0: 7361 7665 4469 6374 2c22 4d41 2d53 6967  saveDict,"MA-Sig
+00022ef0: 6e61 6c22 290a 2020 2020 2020 2020 2020  nal").          
+00022f00: 2020 2020 2020 2320 5461 6b69 6e67 2053        # Taking S
+00022f10: 7570 706f 7274 0a20 2020 2020 2020 2020  upport.         
+00022f20: 2020 2020 2020 2069 6620 636c 6f73 6520         if close 
+00022f30: 3e20 6d61 2061 6e64 206c 6f77 203c 3d20  > ma and low <= 
+00022f40: 286d 6120 2b20 6d61 4465 7673 5b69 6e64  (ma + maDevs[ind
+00022f50: 6578 5d29 2061 6e64 2073 7472 286d 614c  ex]) and str(maL
+00022f60: 656e 6774 6829 2069 6e20 5b22 3022 2c22  ength) in ["0","
+00022f70: 3122 5d3a 0a20 2020 2020 2020 2020 2020  1"]:.           
+00022f80: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00022f90: 6963 745b 224d 412d 5369 676e 616c 225d  ict["MA-Signal"]
+00022fa0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00022fb0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00022fc0: 6564 5b30 5d20 2b20 636f 6c6f 7254 6578  ed[0] + colorTex
+00022fd0: 742e 424f 4c44 202b 2063 6f6c 6f72 5465  t.BOLD + colorTe
+00022fe0: 7874 2e47 5245 454e 202b 2066 227b 6d61  xt.GREEN + f"{ma
+00022ff0: 5465 7874 735b 696e 6465 785d 7d2d 5375  Texts[index]}-Su
+00023000: 7070 6f72 7422 202b 2063 6f6c 6f72 5465  pport" + colorTe
+00023010: 7874 2e45 4e44 0a20 2020 2020 2020 2020  xt.END.         
+00023020: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00023030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023040: 2073 6176 6544 6963 745b 224d 412d 5369   saveDict["MA-Si
+00023050: 676e 616c 225d 203d 2073 6176 6564 5b31  gnal"] = saved[1
+00023060: 5d20 2b20 6622 7b6d 6154 6578 7473 5b69  ] + f"{maTexts[i
+00023070: 6e64 6578 5d7d 2d53 7570 706f 7274 220a  ndex]}-Support".
+00023080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023090: 2020 2020 6d61 5265 7665 7273 616c 203d      maReversal =
+000230a0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+000230b0: 2020 2020 2020 206d 6153 6967 6e61 6c73         maSignals
+000230c0: 2e61 7070 656e 6428 2231 2229 0a20 2020  .append("1").   
+000230d0: 2020 2020 2020 2020 2020 2020 2023 2056               # V
+000230e0: 616c 6964 6174 696e 6720 5265 7369 7374  alidating Resist
+000230f0: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+00023100: 2020 2020 2065 6c69 6620 636c 6f73 6520       elif close 
+00023110: 3c20 6d61 2061 6e64 2068 6967 6820 3e3d  < ma and high >=
+00023120: 2028 6d61 202d 206d 6144 6576 735b 696e   (ma - maDevs[in
+00023130: 6465 785d 2920 616e 6420 7374 7228 6d61  dex]) and str(ma
+00023140: 4c65 6e67 7468 2920 696e 205b 2230 222c  Length) in ["0",
+00023150: 2236 225d 3a0a 2020 2020 2020 2020 2020  "6"]:.          
+00023160: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00023170: 4469 6374 5b22 4d41 2d53 6967 6e61 6c22  Dict["MA-Signal"
+00023180: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+00023190: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+000231a0: 7665 645b 305d 202b 2063 6f6c 6f72 5465  ved[0] + colorTe
+000231b0: 7874 2e42 4f4c 4420 2b20 636f 6c6f 7254  xt.BOLD + colorT
+000231c0: 6578 742e 4641 494c 202b 2066 227b 6d61  ext.FAIL + f"{ma
+000231d0: 5465 7874 735b 696e 6465 785d 7d2d 5265  Texts[index]}-Re
+000231e0: 7369 7374 2220 2b20 636f 6c6f 7254 6578  sist" + colorTex
+000231f0: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+00023200: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00023210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023220: 7361 7665 4469 6374 5b22 4d41 2d53 6967  saveDict["MA-Sig
+00023230: 6e61 6c22 5d20 3d20 7361 7665 645b 315d  nal"] = saved[1]
+00023240: 202b 2066 227b 6d61 5465 7874 735b 696e   + f"{maTexts[in
+00023250: 6465 785d 7d2d 5265 7369 7374 220a 2020  dex]}-Resist".  
+00023260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023270: 2020 6d61 5265 7665 7273 616c 203d 202d    maReversal = -
+00023280: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00023290: 2020 2020 2020 6d61 5369 676e 616c 732e        maSignals.
+000232a0: 6170 7065 6e64 2822 3622 290a 2020 2020  append("6").    
+000232b0: 2020 2020 2020 2020 2020 2020 2320 466f              # Fo
+000232c0: 7220 6120 4275 6c6c 6973 6820 4361 6e64  r a Bullish Cand
+000232d0: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+000232e0: 2020 2069 6620 6275 6c6c 6973 6843 616e     if bullishCan
+000232f0: 646c 653a 0a20 2020 2020 2020 2020 2020  dle:.           
+00023300: 2020 2020 2020 2020 2023 2043 726f 7373           # Cross
+00023310: 696e 6720 7570 0a20 2020 2020 2020 2020  ing up.         
+00023320: 2020 2020 2020 2020 2020 2069 6620 6f70             if op
+00023330: 656e 203c 206d 6120 616e 6420 636c 6f73  en < ma and clos
+00023340: 6520 3e20 6d61 2061 6e64 2073 7472 286d  e > ma and str(m
+00023350: 614c 656e 6774 6829 2069 6e20 5b22 3022  aLength) in ["0"
+00023360: 2c22 3522 5d3a 0a20 2020 2020 2020 2020  ,"5"]:.         
+00023370: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00023380: 6372 6565 6e44 6963 745b 224d 412d 5369  creenDict["MA-Si
+00023390: 676e 616c 225d 203d 2028 0a20 2020 2020  gnal"] = (.     
+000233a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000233b0: 2020 2020 2020 2073 6176 6564 5b30 5d20         saved[0] 
+000233c0: 2b20 636f 6c6f 7254 6578 742e 424f 4c44  + colorText.BOLD
+000233d0: 202b 2063 6f6c 6f72 5465 7874 2e47 5245   + colorText.GRE
+000233e0: 454e 202b 2066 2242 756c 6c43 726f 7373  EN + f"BullCross
+000233f0: 2d7b 6d61 5465 7874 735b 696e 6465 785d  -{maTexts[index]
+00023400: 7d22 202b 2063 6f6c 6f72 5465 7874 2e45  }" + colorText.E
+00023410: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
+00023420: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00023430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023440: 2020 2020 2073 6176 6544 6963 745b 224d       saveDict["M
+00023450: 412d 5369 676e 616c 225d 203d 2073 6176  A-Signal"] = sav
+00023460: 6564 5b31 5d20 2b20 6622 4275 6c6c 4372  ed[1] + f"BullCr
+00023470: 6f73 732d 7b6d 6154 6578 7473 5b69 6e64  oss-{maTexts[ind
+00023480: 6578 5d7d 220a 2020 2020 2020 2020 2020  ex]}".          
+00023490: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+000234a0: 5265 7665 7273 616c 203d 2031 0a20 2020  Reversal = 1.   
+000234b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234c0: 2020 2020 206d 6153 6967 6e61 6c73 2e61       maSignals.a
+000234d0: 7070 656e 6428 2235 2229 0a20 2020 2020  ppend("5").     
+000234e0: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
+000234f0: 2061 2042 6561 7269 7368 2043 616e 646c   a Bearish Candl
+00023500: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00023510: 2020 656c 6966 206e 6f74 2062 756c 6c69    elif not bulli
+00023520: 7368 4361 6e64 6c65 3a0a 2020 2020 2020  shCandle:.      
+00023530: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00023540: 4372 6f73 7369 6e67 2064 6f77 6e0a 2020  Crossing down.  
+00023550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023560: 2020 6966 206f 7065 6e20 3e20 736d 6120    if open > sma 
+00023570: 616e 6420 636c 6f73 6520 3c20 736d 6120  and close < sma 
+00023580: 616e 6420 7374 7228 6d61 4c65 6e67 7468  and str(maLength
+00023590: 2920 696e 205b 2230 222c 2234 225d 3a0a  ) in ["0","4"]:.
+000235a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235b0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+000235c0: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
+000235d0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+000235e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235f0: 7361 7665 645b 305d 202b 2063 6f6c 6f72  saved[0] + color
+00023600: 5465 7874 2e42 4f4c 4420 2b20 636f 6c6f  Text.BOLD + colo
+00023610: 7254 6578 742e 4641 494c 202b 2066 2242  rText.FAIL + f"B
+00023620: 6561 7243 726f 7373 2d7b 6d61 5465 7874  earCross-{maText
+00023630: 735b 696e 6465 785d 7d22 202b 2063 6f6c  s[index]}" + col
+00023640: 6f72 5465 7874 2e45 4e44 0a20 2020 2020  orText.END.     
+00023650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023660: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00023670: 2020 2020 2020 2020 2020 2020 2073 6176               sav
+00023680: 6544 6963 745b 224d 412d 5369 676e 616c  eDict["MA-Signal
+00023690: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
+000236a0: 6622 4265 6172 4372 6f73 732d 7b6d 6154  f"BearCross-{maT
+000236b0: 6578 7473 5b69 6e64 6578 5d7d 220a 2020  exts[index]}".  
+000236c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236d0: 2020 2020 2020 6d61 5265 7665 7273 616c        maReversal
+000236e0: 203d 202d 310a 2020 2020 2020 2020 2020   = -1.          
+000236f0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00023700: 5369 676e 616c 732e 6170 7065 6e64 2822  Signals.append("
+00023710: 3422 290a 2020 2020 2020 2020 2020 2020  4").            
+00023720: 2020 2020 696e 6465 7820 2b3d 2031 0a20      index += 1. 
+00023730: 2020 2020 2020 2072 6574 7572 6e56 616c         returnVal
+00023740: 7565 203d 206d 6152 6576 6572 7361 6c0a  ue = maReversal.
+00023750: 2020 2020 2020 2020 6966 206d 614c 656e          if maLen
+00023760: 6774 6820 213d 2030 3a0a 2020 2020 2020  gth != 0:.      
+00023770: 2020 2020 2020 7265 7475 726e 5661 6c75        returnValu
+00023780: 6520 3d20 7374 7228 6d61 4c65 6e67 7468  e = str(maLength
+00023790: 2920 696e 206d 6153 6967 6e61 6c73 0a20  ) in maSignals. 
+000237a0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+000237b0: 7475 726e 5661 6c75 650a 0a20 2020 2023  turnValue..    #
+000237c0: 2046 696e 6420 4e52 7820 7261 6e67 6520   Find NRx range 
+000237d0: 666f 7220 5265 7665 7273 616c 0a20 2020  for Reversal.   
+000237e0: 2064 6566 2076 616c 6964 6174 654e 6172   def validateNar
+000237f0: 726f 7752 616e 6765 2873 656c 662c 2064  rowRange(self, d
+00023800: 662c 2073 6372 6565 6e44 6963 742c 2073  f, screenDict, s
+00023810: 6176 6544 6963 742c 206e 723d 3429 3a0a  aveDict, nr=4):.
+00023820: 2020 2020 2020 2020 6966 2064 6620 6973          if df is
+00023830: 204e 6f6e 6520 6f72 206c 656e 2864 6629   None or len(df)
+00023840: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00023850: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00023860: 2020 2020 2020 2020 6461 7461 203d 2064          data = d
+00023870: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+00023880: 2073 6176 6564 203d 2073 656c 662e 6669   saved = self.fi
+00023890: 6e64 4375 7272 656e 7453 6176 6564 5661  ndCurrentSavedVa
+000238a0: 6c75 6528 7363 7265 656e 4469 6374 2c20  lue(screenDict, 
+000238b0: 7361 7665 4469 6374 2c20 2250 6174 7465  saveDict, "Patte
+000238c0: 726e 2229 0a20 2020 2020 2020 2069 6620  rn").        if 
+000238d0: 504b 4461 7465 5574 696c 6974 6965 732e  PKDateUtilities.
+000238e0: 6973 5472 6164 696e 6754 696d 6528 293a  isTradingTime():
+000238f0: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
+00023900: 6765 4461 7461 203d 2064 6174 612e 6865  geData = data.he
+00023910: 6164 286e 7220 2b20 3129 5b31 3a5d 0a20  ad(nr + 1)[1:]. 
+00023920: 2020 2020 2020 2020 2020 206e 6f77 5f63             now_c
+00023930: 616e 646c 6520 3d20 6461 7461 2e68 6561  andle = data.hea
+00023940: 6428 3129 0a20 2020 2020 2020 2020 2020  d(1).           
+00023950: 2072 616e 6765 4461 7461 5b22 5261 6e67   rangeData["Rang
+00023960: 6522 5d20 3d20 6162 7328 7261 6e67 6544  e"] = abs(rangeD
+00023970: 6174 615b 2243 6c6f 7365 225d 202d 2072  ata["Close"] - r
+00023980: 616e 6765 4461 7461 5b22 4f70 656e 225d  angeData["Open"]
+00023990: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000239a0: 6365 6e74 203d 2072 616e 6765 4461 7461  cent = rangeData
+000239b0: 2e68 6561 6428 3129 0a20 2020 2020 2020  .head(1).       
+000239c0: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
+000239d0: 2020 2020 2020 2020 2020 6c65 6e28 7265            len(re
+000239e0: 6365 6e74 2920 3d3d 2031 0a20 2020 2020  cent) == 1.     
+000239f0: 2020 2020 2020 2020 2020 2061 6e64 2072             and r
+00023a00: 6563 656e 745b 2252 616e 6765 225d 2e69  ecent["Range"].i
+00023a10: 6c6f 635b 305d 203d 3d20 7261 6e67 6544  loc[0] == rangeD
+00023a20: 6174 612e 6465 7363 7269 6265 2829 5b22  ata.describe()["
+00023a30: 5261 6e67 6522 5d5b 226d 696e 225d 0a20  Range"]["min"]. 
+00023a40: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00023a50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00023a60: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00023a70: 2020 2020 2020 2073 656c 662e 6765 7443         self.getC
+00023a80: 616e 646c 6554 7970 6528 7265 6365 6e74  andleType(recent
+00023a90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023aa0: 2020 2020 2020 616e 6420 6e6f 775f 6361        and now_ca
+00023ab0: 6e64 6c65 5b22 436c 6f73 6522 5d2e 696c  ndle["Close"].il
+00023ac0: 6f63 5b30 5d20 3e3d 2072 6563 656e 745b  oc[0] >= recent[
+00023ad0: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
+00023ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023af0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00023b00: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
+00023b10: 6374 5b22 5061 7474 6572 6e22 5d20 3d20  ct["Pattern"] = 
+00023b20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00023b30: 2020 2020 2020 2020 2020 7361 7665 645b            saved[
+00023b40: 305d 202b 2063 6f6c 6f72 5465 7874 2e42  0] + colorText.B
+00023b50: 4f4c 4420 2b20 636f 6c6f 7254 6578 742e  OLD + colorText.
+00023b60: 4752 4545 4e20 2b20 6622 4275 792d 4e52  GREEN + f"Buy-NR
+00023b70: 7b6e 727d 2220 2b20 636f 6c6f 7254 6578  {nr}" + colorTex
+00023b80: 742e 454e 440a 2020 2020 2020 2020 2020  t.END.          
+00023b90: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00023ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bb0: 7361 7665 4469 6374 5b22 5061 7474 6572  saveDict["Patter
+00023bc0: 6e22 5d20 3d20 7361 7665 645b 315d 202b  n"] = saved[1] +
+00023bd0: 2066 2242 7579 2d4e 527b 6e72 7d22 0a20   f"Buy-NR{nr}". 
+00023be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bf0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+00023c00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00023c10: 6c69 6620 280a 2020 2020 2020 2020 2020  lif (.          
+00023c20: 2020 2020 2020 2020 2020 6e6f 7420 7365            not se
+00023c30: 6c66 2e67 6574 4361 6e64 6c65 5479 7065  lf.getCandleType
+00023c40: 2872 6563 656e 7429 0a20 2020 2020 2020  (recent).       
+00023c50: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00023c60: 206e 6f77 5f63 616e 646c 655b 2243 6c6f   now_candle["Clo
+00023c70: 7365 225d 2e69 6c6f 635b 305d 203c 3d20  se"].iloc[0] <= 
+00023c80: 7265 6365 6e74 5b22 436c 6f73 6522 5d2e  recent["Close"].
+00023c90: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
+00023ca0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00023cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00023cc0: 6372 6565 6e44 6963 745b 2250 6174 7465  creenDict["Patte
+00023cd0: 726e 225d 203d 2028 0a20 2020 2020 2020  rn"] = (.       
+00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cf0: 2073 6176 6564 5b30 5d20 2b20 636f 6c6f   saved[0] + colo
+00023d00: 7254 6578 742e 424f 4c44 202b 2063 6f6c  rText.BOLD + col
+00023d10: 6f72 5465 7874 2e46 4149 4c20 2b20 6622  orText.FAIL + f"
+00023d20: 5365 6c6c 2d4e 527b 6e72 7d22 202b 2063  Sell-NR{nr}" + c
+00023d30: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
+00023d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d50: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00023d60: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00023d70: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+00023d80: 6564 5b31 5d20 2b20 6622 5365 6c6c 2d4e  ed[1] + f"Sell-N
+00023d90: 527b 6e72 7d22 0a20 2020 2020 2020 2020  R{nr}".         
+00023da0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00023db0: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
+00023dc0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00023dd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00023de0: 2020 2020 2020 2020 2020 7261 6e67 6544            rangeD
+00023df0: 6174 6120 3d20 6461 7461 2e68 6561 6428  ata = data.head(
+00023e00: 6e72 290a 2020 2020 2020 2020 2020 2020  nr).            
+00023e10: 7261 6e67 6544 6174 612e 6c6f 635b 3a2c  rangeData.loc[:,
+00023e20: 2752 616e 6765 275d 203d 2061 6273 2872  'Range'] = abs(r
+00023e30: 616e 6765 4461 7461 5b22 436c 6f73 6522  angeData["Close"
+00023e40: 5d20 2d20 7261 6e67 6544 6174 615b 224f  ] - rangeData["O
+00023e50: 7065 6e22 5d29 0a20 2020 2020 2020 2020  pen"]).         
+00023e60: 2020 2072 6563 656e 7420 3d20 7261 6e67     recent = rang
+00023e70: 6544 6174 612e 6865 6164 2831 290a 2020  eData.head(1).  
+00023e80: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
+00023e90: 656e 745b 2252 616e 6765 225d 2e69 6c6f  ent["Range"].ilo
+00023ea0: 635b 305d 203d 3d20 7261 6e67 6544 6174  c[0] == rangeDat
+00023eb0: 612e 6465 7363 7269 6265 2829 5b22 5261  a.describe()["Ra
+00023ec0: 6e67 6522 5d5b 226d 696e 225d 3a0a 2020  nge"]["min"]:.  
+00023ed0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+00023ee0: 7265 656e 4469 6374 5b22 5061 7474 6572  reenDict["Patter
+00023ef0: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
+00023f00: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00023f10: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
+00023f20: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
+00023f30: 742e 4752 4545 4e20 2b20 6622 4e52 7b6e  t.GREEN + f"NR{n
+00023f40: 727d 2220 2b20 636f 6c6f 7254 6578 742e  r}" + colorText.
+00023f50: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00023f60: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00023f70: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00023f80: 5061 7474 6572 6e22 5d20 3d20 7361 7665  Pattern"] = save
+00023f90: 645b 315d 202b 2066 224e 527b 6e72 7d22  d[1] + f"NR{nr}"
+00023fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023fb0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+00023fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00023fd0: 4661 6c73 650a 0a20 2020 2023 2046 696e  False..    # Fin
+00023fe0: 6420 6966 2073 746f 636b 2069 7320 6e65  d if stock is ne
+00023ff0: 776c 7920 6c69 7374 6564 0a20 2020 2064  wly listed.    d
+00024000: 6566 2076 616c 6964 6174 654e 6577 6c79  ef validateNewly
+00024010: 4c69 7374 6564 2873 656c 662c 2064 662c  Listed(self, df,
+00024020: 2064 6179 7354 6f4c 6f6f 6b62 6163 6b29   daysToLookback)
+00024030: 3a0a 2020 2020 2020 2020 6966 2064 6620  :.        if df 
+00024040: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+00024050: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+00024060: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00024070: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+00024080: 2064 662e 636f 7079 2829 0a20 2020 2020   df.copy().     
+00024090: 2020 2064 6179 7354 6f4c 6f6f 6b62 6163     daysToLookbac
+000240a0: 6b20 3d20 696e 7428 6461 7973 546f 4c6f  k = int(daysToLo
+000240b0: 6f6b 6261 636b 5b3a 2d31 5d29 0a20 2020  okback[:-1]).   
+000240c0: 2020 2020 2072 6563 656e 7420 3d20 6461       recent = da
+000240d0: 7461 2e68 6561 6428 3129 0a20 2020 2020  ta.head(1).     
+000240e0: 2020 2069 6620 6c65 6e28 7265 6365 6e74     if len(recent
+000240f0: 2920 3c20 313a 0a20 2020 2020 2020 2020  ) < 1:.         
+00024100: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00024110: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
+00024120: 6174 6129 203c 2064 6179 7354 6f4c 6f6f  ata) < daysToLoo
+00024130: 6b62 6163 6b20 616e 6420 280a 2020 2020  kback and (.    
+00024140: 2020 2020 2020 2020 7265 6365 6e74 5b22          recent["
+00024150: 436c 6f73 6522 5d2e 696c 6f63 5b30 5d20  Close"].iloc[0] 
+00024160: 213d 206e 702e 6e61 6e20 616e 6420 7265  != np.nan and re
+00024170: 6365 6e74 5b22 436c 6f73 6522 5d2e 696c  cent["Close"].il
+00024180: 6f63 5b30 5d20 3e20 300a 2020 2020 2020  oc[0] > 0.      
+00024190: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+000241a0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+000241b0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000241c0: 650a 0a20 2020 2023 2056 616c 6964 6174  e..    # Validat
+000241d0: 6520 6966 2074 6865 2073 746f 636b 2070  e if the stock p
+000241e0: 7269 6365 7320 6172 6520 6174 206c 6561  rices are at lea
+000241f0: 7374 2072 6973 696e 6720 6279 2032 2520  st rising by 2% 
+00024200: 666f 7220 7468 6520 6c61 7374 2033 2073  for the last 3 s
+00024210: 6573 7369 6f6e 730a 2020 2020 6465 6620  essions.    def 
+00024220: 7661 6c69 6461 7465 5072 6963 6552 6973  validatePriceRis
+00024230: 696e 6742 7941 744c 6561 7374 3250 6572  ingByAtLeast2Per
+00024240: 6365 6e74 2873 656c 662c 2064 662c 2073  cent(self, df, s
+00024250: 6372 6565 6e44 6963 742c 2073 6176 6544  creenDict, saveD
+00024260: 6963 7429 3a0a 2020 2020 2020 2020 6966  ict):.        if
+00024270: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
+00024280: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
+00024290: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000242a0: 4661 6c73 650a 2020 2020 2020 2020 6461  False.        da
+000242b0: 7461 203d 2064 662e 636f 7079 2829 0a20  ta = df.copy(). 
+000242c0: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+000242d0: 7461 2e66 696c 6c6e 6128 3029 0a20 2020  ta.fillna(0).   
+000242e0: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+000242f0: 2e72 6570 6c61 6365 285b 6e70 2e69 6e66  .replace([np.inf
+00024300: 2c20 2d6e 702e 696e 665d 2c20 3029 0a20  , -np.inf], 0). 
+00024310: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00024320: 7461 2e68 6561 6428 3429 0a20 2020 2020  ta.head(4).     
+00024330: 2020 2069 6620 6c65 6e28 6461 7461 2920     if len(data) 
+00024340: 3c20 343a 0a20 2020 2020 2020 2020 2020  < 4:.           
+00024350: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00024360: 2020 2020 2020 6461 7930 203d 2064 6174        day0 = dat
+00024370: 612e 696c 6f63 5b30 5d5b 2243 6c6f 7365  a.iloc[0]["Close
+00024380: 225d 2e69 7465 6d28 290a 2020 2020 2020  "].item().      
+00024390: 2020 6461 794d 696e 7573 3120 3d20 6461    dayMinus1 = da
+000243a0: 7461 2e69 6c6f 635b 315d 5b22 436c 6f73  ta.iloc[1]["Clos
+000243b0: 6522 5d2e 6974 656d 2829 0a20 2020 2020  e"].item().     
+000243c0: 2020 2064 6179 4d69 6e75 7332 203d 2064     dayMinus2 = d
+000243d0: 6174 612e 696c 6f63 5b32 5d5b 2243 6c6f  ata.iloc[2]["Clo
+000243e0: 7365 225d 2e69 7465 6d28 290a 2020 2020  se"].item().    
+000243f0: 2020 2020 6461 794d 696e 7573 3320 3d20      dayMinus3 = 
+00024400: 6461 7461 2e69 6c6f 635b 335d 5b22 436c  data.iloc[3]["Cl
+00024410: 6f73 6522 5d2e 6974 656d 2829 0a20 2020  ose"].item().   
+00024420: 2020 2020 2070 6572 6365 6e74 3320 3d20       percent3 = 
+00024430: 726f 756e 6428 2864 6179 4d69 6e75 7332  round((dayMinus2
+00024440: 202d 2064 6179 4d69 6e75 7333 2920 2a20   - dayMinus3) * 
+00024450: 3130 3020 2f20 6461 794d 696e 7573 332c  100 / dayMinus3,
+00024460: 2032 290a 2020 2020 2020 2020 7065 7263   2).        perc
+00024470: 656e 7432 203d 2072 6f75 6e64 2828 6461  ent2 = round((da
+00024480: 794d 696e 7573 3120 2d20 6461 794d 696e  yMinus1 - dayMin
+00024490: 7573 3229 202a 2031 3030 202f 2064 6179  us2) * 100 / day
+000244a0: 4d69 6e75 7332 2c20 3229 0a20 2020 2020  Minus2, 2).     
+000244b0: 2020 2070 6572 6365 6e74 3120 3d20 726f     percent1 = ro
+000244c0: 756e 6428 2864 6179 3020 2d20 6461 794d  und((day0 - dayM
+000244d0: 696e 7573 3129 202a 2031 3030 202f 2064  inus1) * 100 / d
+000244e0: 6179 4d69 6e75 7331 2c20 3229 0a0a 2020  ayMinus1, 2)..  
+000244f0: 2020 2020 2020 6966 2070 6572 6365 6e74        if percent
+00024500: 3120 3e3d 2032 2061 6e64 2070 6572 6365  1 >= 2 and perce
+00024510: 6e74 3220 3e3d 2032 2061 6e64 2070 6572  nt2 >= 2 and per
+00024520: 6365 6e74 3320 3e3d 2032 3a0a 2020 2020  cent3 >= 2:.    
+00024530: 2020 2020 2020 2020 7063 745f 6368 616e          pct_chan
+00024540: 6765 5f74 6578 7420 3d20 280a 2020 2020  ge_text = (.    
+00024550: 2020 2020 2020 2020 2020 2020 2822 252e              ("%.
+00024560: 3166 2525 2220 2520 7065 7263 656e 7431  1f%%" % percent1
+00024570: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024580: 2020 2b20 2822 2028 252e 3166 2525 2c22    + (" (%.1f%%,"
+00024590: 2025 2070 6572 6365 6e74 3229 0a20 2020   % percent2).   
+000245a0: 2020 2020 2020 2020 2020 2020 202b 2028               + (
+000245b0: 2220 252e 3166 2525 2922 2025 2070 6572  " %.1f%%)" % per
+000245c0: 6365 6e74 3329 0a20 2020 2020 2020 2020  cent3).         
+000245d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000245e0: 2073 6176 6544 6963 745b 2225 4368 6e67   saveDict["%Chng
+000245f0: 225d 203d 2070 6374 5f63 6861 6e67 655f  "] = pct_change_
+00024600: 7465 7874 0a20 2020 2020 2020 2020 2020  text.           
+00024610: 2073 6372 6565 6e44 6963 745b 2225 4368   screenDict["%Ch
+00024620: 6e67 225d 203d 2063 6f6c 6f72 5465 7874  ng"] = colorText
+00024630: 2e47 5245 454e 202b 2070 6374 5f63 6861  .GREEN + pct_cha
+00024640: 6e67 655f 7465 7874 202b 2063 6f6c 6f72  nge_text + color
+00024650: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00024660: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00024670: 2061 6e64 2073 656c 662e 6765 7443 616e   and self.getCan
+00024680: 646c 6554 7970 6528 6461 7461 2e68 6561  dleType(data.hea
+00024690: 6428 3129 290a 2020 2020 2020 2020 7265  d(1)).        re
+000246a0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
+000246b0: 2340 6d65 6173 7572 655f 7469 6d65 0a20  #@measure_time. 
+000246c0: 2020 2023 2076 616c 6964 6174 6520 6966     # validate if
+000246d0: 2052 5349 2069 7320 7769 7468 696e 2067   RSI is within g
+000246e0: 6976 656e 2072 616e 6765 0a20 2020 2064  iven range.    d
+000246f0: 6566 2076 616c 6964 6174 6552 5349 2873  ef validateRSI(s
+00024700: 656c 662c 2064 662c 2073 6372 6565 6e44  elf, df, screenD
+00024710: 6963 742c 2073 6176 6544 6963 742c 206d  ict, saveDict, m
+00024720: 696e 5253 492c 206d 6178 5253 492c 7273  inRSI, maxRSI,rs
+00024730: 694b 6579 3d22 5253 4922 293a 0a20 2020  iKey="RSI"):.   
+00024740: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
+00024750: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
+00024760: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00024770: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+00024780: 2020 2020 2069 6620 7273 694b 6579 206e       if rsiKey n
+00024790: 6f74 2069 6e20 6466 2e63 6f6c 756d 6e73  ot in df.columns
+000247a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000247b0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+000247c0: 2020 2064 6174 6120 3d20 6466 2e63 6f70     data = df.cop
+000247d0: 7928 290a 2020 2020 2020 2020 6461 7461  y().        data
+000247e0: 203d 2064 6174 612e 6669 6c6c 6e61 2830   = data.fillna(0
+000247f0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
+00024800: 2064 6174 612e 7265 706c 6163 6528 5b6e   data.replace([n
+00024810: 702e 696e 662c 202d 6e70 2e69 6e66 5d2c  p.inf, -np.inf],
+00024820: 2030 290a 2020 2020 2020 2020 7273 6920   0).        rsi 
+00024830: 3d20 696e 7428 6461 7461 2e68 6561 6428  = int(data.head(
+00024840: 3129 5b72 7369 4b65 795d 2e69 6c6f 635b  1)[rsiKey].iloc[
+00024850: 305d 290a 2020 2020 2020 2020 7361 7665  0]).        save
+00024860: 4469 6374 5b72 7369 4b65 795d 203d 2072  Dict[rsiKey] = r
+00024870: 7369 0a20 2020 2020 2020 2023 2068 7474  si.        # htt
+00024880: 7073 3a2f 2f63 6861 7274 696e 6b2e 636f  ps://chartink.co
+00024890: 6d2f 7363 7265 656e 6572 2f72 7369 2d73  m/screener/rsi-s
+000248a0: 6372 6565 6e69 6e67 0a20 2020 2020 2020  creening.       
+000248b0: 2069 6620 7273 693e 2030 2061 6e64 2072   if rsi> 0 and r
+000248c0: 7369 203e 3d20 6d69 6e52 5349 2061 6e64  si >= minRSI and
+000248d0: 2072 7369 203c 3d20 6d61 7852 5349 3a20   rsi <= maxRSI: 
+000248e0: 2023 206f 7220 2872 7369 203c 3d20 3731   # or (rsi <= 71
+000248f0: 2061 6e64 2072 7369 203e 3d20 3637 293a   and rsi >= 67):
+00024900: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+00024910: 6565 6e44 6963 745b 7273 694b 6579 5d20  eenDict[rsiKey] 
+00024920: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00024930: 2020 2020 636f 6c6f 7254 6578 742e 424f      colorText.BO
+00024940: 4c44 202b 2063 6f6c 6f72 5465 7874 2e47  LD + colorText.G
+00024950: 5245 454e 202b 2073 7472 2872 7369 2920  REEN + str(rsi) 
+00024960: 2b20 636f 6c6f 7254 6578 742e 454e 440a  + colorText.END.
+00024970: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00024980: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00024990: 2054 7275 6520 6966 2028 7273 694b 6579   True if (rsiKey
+000249a0: 203d 3d20 2252 5349 6922 2920 656c 7365   == "RSIi") else
+000249b0: 2028 7365 6c66 2e76 616c 6964 6174 6552   (self.validateR
+000249c0: 5349 2864 662c 2073 6372 6565 6e44 6963  SI(df, screenDic
+000249d0: 742c 2073 6176 6544 6963 742c 206d 696e  t, saveDict, min
+000249e0: 5253 492c 206d 6178 5253 492c 7273 694b  RSI, maxRSI,rsiK
+000249f0: 6579 3d22 5253 4969 2229 206f 7220 5472  ey="RSIi") or Tr
+00024a00: 7565 290a 2020 2020 2020 2020 7363 7265  ue).        scre
+00024a10: 656e 4469 6374 5b72 7369 4b65 795d 203d  enDict[rsiKey] =
+00024a20: 2063 6f6c 6f72 5465 7874 2e42 4f4c 4420   colorText.BOLD 
+00024a30: 2b20 636f 6c6f 7254 6578 742e 4641 494c  + colorText.FAIL
+00024a40: 202b 2073 7472 2872 7369 2920 2b20 636f   + str(rsi) + co
+00024a50: 6c6f 7254 6578 742e 454e 440a 2020 2020  lorText.END.    
+00024a60: 2020 2020 2320 4966 2065 6974 6865 7220      # If either 
+00024a70: 6461 696c 7920 6f72 2069 6e74 7261 6461  daily or intrada
+00024a80: 7920 5253 4920 636f 6d65 7320 7769 7468  y RSI comes with
+00024a90: 696e 2072 616e 6765 3f0a 2020 2020 2020  in range?.      
+00024aa0: 2020 7265 7475 726e 2046 616c 7365 2069    return False i
+00024ab0: 6620 2872 7369 4b65 7920 3d3d 2022 5253  f (rsiKey == "RS
+00024ac0: 4969 2229 2065 6c73 6520 2873 656c 662e  Ii") else (self.
+00024ad0: 7661 6c69 6461 7465 5253 4928 6466 2c20  validateRSI(df, 
+00024ae0: 7363 7265 656e 4469 6374 2c20 7361 7665  screenDict, save
+00024af0: 4469 6374 2c20 6d69 6e52 5349 2c20 6d61  Dict, minRSI, ma
+00024b00: 7852 5349 2c72 7369 4b65 793d 2252 5349  xRSI,rsiKey="RSI
+00024b10: 6922 2929 0a0a 2020 2020 2320 5661 6c69  i"))..    # Vali
+00024b20: 6461 7465 2069 6620 7468 6520 7374 6f63  date if the stoc
+00024b30: 6b20 6973 2062 756c 6c69 7368 2069 6e20  k is bullish in 
+00024b40: 7468 6520 7368 6f72 7420 7465 726d 0a20  the short term. 
+00024b50: 2020 2064 6566 2076 616c 6964 6174 6553     def validateS
+00024b60: 686f 7274 5465 726d 4275 6c6c 6973 6828  hortTermBullish(
+00024b70: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+00024b80: 4469 6374 2c20 7361 7665 4469 6374 293a  Dict, saveDict):
+00024b90: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
+00024ba0: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
+00024bb0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00024bc0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00024bd0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00024be0: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
+00024bf0: 2020 2320 6874 7470 733a 2f2f 6368 6172    # https://char
+00024c00: 7469 6e6b 2e63 6f6d 2f73 6372 6565 6e65  tink.com/screene
+00024c10: 722f 7368 6f72 742d 7465 726d 2d62 756c  r/short-term-bul
+00024c20: 6c69 7368 0a20 2020 2020 2020 2064 6174  lish.        dat
+00024c30: 6120 3d20 6461 7461 2e66 696c 6c6e 6128  a = data.fillna(
+00024c40: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+00024c50: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
+00024c60: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
+00024c70: 2c20 3029 0a20 2020 2020 2020 2072 6563  , 0).        rec
+00024c80: 656e 7420 3d20 6461 7461 2e68 6561 6428  ent = data.head(
+00024c90: 3129 0a20 2020 2020 2020 2066 6b20 3d20  1).        fk = 
+00024ca0: 3020 6966 206c 656e 2864 6174 6129 203c  0 if len(data) <
+00024cb0: 2033 2065 6c73 6520 6e70 2e72 6f75 6e64   3 else np.round
+00024cc0: 2864 6174 615b 2246 4153 544b 225d 2e69  (data["FASTK"].i
+00024cd0: 6c6f 635b 325d 2c20 3529 0a20 2020 2020  loc[2], 5).     
+00024ce0: 2020 2023 2052 6576 6572 7365 2074 6865     # Reverse the
+00024cf0: 2064 6174 6166 7261 6d65 2066 6f72 2069   dataframe for i
+00024d00: 6368 696d 6f6b 7520 6361 6c63 756c 6174  chimoku calculat
+00024d10: 696f 6e73 2077 6974 6820 6461 7465 2069  ions with date i
+00024d20: 6e20 6173 6365 6e64 696e 6720 6f72 6465  n ascending orde
+00024d30: 720a 2020 2020 2020 2020 6466 5f6e 6577  r.        df_new
+00024d40: 203d 2064 6174 615b 3a3a 2d31 5d0a 2020   = data[::-1].  
+00024d50: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00024d60: 2020 2020 2020 2064 665f 6963 6869 203d         df_ichi =
+00024d70: 2064 665f 6e65 772e 7265 6e61 6d65 280a   df_new.rename(.
+00024d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d90: 636f 6c75 6d6e 733d 7b0a 2020 2020 2020  columns={.      
+00024da0: 2020 2020 2020 2020 2020 2020 2020 224f                "O
+00024db0: 7065 6e22 3a20 226f 7065 6e22 2c0a 2020  pen": "open",.  
+00024dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024dd0: 2020 2248 6967 6822 3a20 2268 6967 6822    "High": "high"
+00024de0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024df0: 2020 2020 2020 224c 6f77 223a 2022 6c6f        "Low": "lo
+00024e00: 7722 2c0a 2020 2020 2020 2020 2020 2020  w",.            
+00024e10: 2020 2020 2020 2020 2243 6c6f 7365 223a          "Close":
+00024e20: 2022 636c 6f73 6522 2c0a 2020 2020 2020   "close",.      
+00024e30: 2020 2020 2020 2020 2020 2020 2020 2256                "V
+00024e40: 6f6c 756d 6522 3a20 2276 6f6c 756d 6522  olume": "volume"
+00024e50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00024e60: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00024e70: 290a 2020 2020 2020 2020 2020 2020 6963  ).            ic
+00024e80: 6869 203d 2070 6b74 616c 6962 2e69 6368  hi = pktalib.ich
+00024e90: 696d 6f6b 7528 6466 5f69 6368 692c 2039  imoku(df_ichi, 9
+00024ea0: 2c20 3236 2c20 3532 2c20 3236 290a 2020  , 26, 52, 26).  
+00024eb0: 2020 2020 2020 2020 2020 6966 2069 6368            if ich
+00024ec0: 6920 6973 204e 6f6e 653a 0a20 2020 2020  i is None:.     
+00024ed0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00024ee0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+00024ef0: 2020 2020 6466 5f6e 6577 203d 2070 642e      df_new = pd.
+00024f00: 636f 6e63 6174 285b 6466 5f6e 6577 2c20  concat([df_new, 
+00024f10: 6963 6869 5d2c 2061 7869 733d 3129 0a20  ichi], axis=1). 
+00024f20: 2020 2020 2020 2020 2020 2023 2052 6576             # Rev
+00024f30: 6572 7365 2061 6761 696e 2074 6f20 6765  erse again to ge
+00024f40: 7420 7468 6520 6d6f 7374 2072 6563 656e  t the most recen
+00024f50: 7420 6461 7465 206f 6e20 746f 700a 2020  t date on top.  
+00024f60: 2020 2020 2020 2020 2020 6466 5f6e 6577            df_new
+00024f70: 203d 2064 665f 6e65 775b 3a3a 2d31 5d0a   = df_new[::-1].
+00024f80: 2020 2020 2020 2020 2020 2020 6466 5f6e              df_n
+00024f90: 6577 203d 2064 665f 6e65 772e 6865 6164  ew = df_new.head
+00024fa0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+00024fb0: 6466 5f6e 6577 5b22 636c 6f75 645f 6772  df_new["cloud_gr
+00024fc0: 6565 6e22 5d20 3d20 6466 5f6e 6577 5b22  een"] = df_new["
+00024fd0: 4953 415f 3922 5d2e 696c 6f63 5b30 5d20  ISA_9"].iloc[0] 
+00024fe0: 3e20 6466 5f6e 6577 5b22 4953 425f 3236  > df_new["ISB_26
+00024ff0: 225d 2e69 6c6f 635b 305d 0a20 2020 2020  "].iloc[0].     
+00025000: 2020 2020 2020 2064 665f 6e65 775b 2263         df_new["c
+00025010: 6c6f 7564 5f72 6564 225d 203d 2064 665f  loud_red"] = df_
+00025020: 6e65 775b 2249 5342 5f32 3622 5d2e 696c  new["ISB_26"].il
+00025030: 6f63 5b30 5d20 3e20 6466 5f6e 6577 5b22  oc[0] > df_new["
+00025040: 4953 415f 3922 5d2e 696c 6f63 5b30 5d0a  ISA_9"].iloc[0].
+00025050: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00025060: 7863 6570 7469 6f6e 2061 7320 653a 2020  xception as e:  
+00025070: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+00025080: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
+00025090: 656c 662e 6465 6661 756c 745f 6c6f 6767  elf.default_logg
+000250a0: 6572 2e64 6562 7567 2865 2c20 6578 635f  er.debug(e, exc_
+000250b0: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+000250c0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+000250d0: 2020 2020 6162 6f76 6543 6c6f 7564 546f      aboveCloudTo
+000250e0: 7020 3d20 4661 6c73 650a 2020 2020 2020  p = False.      
+000250f0: 2020 2320 6261 7365 6c69 6e65 203e 2063    # baseline > c
+00025100: 6c6f 7564 2074 6f70 2028 636c 6f75 6420  loud top (cloud 
+00025110: 6973 2062 6f75 6e64 2062 7920 7370 616e  is bound by span
+00025120: 2061 2061 6e64 2073 7061 6e20 6229 2061   a and span b) a
+00025130: 6e64 2063 6c6f 7365 2069 7320 3e20 636c  nd close is > cl
+00025140: 6f75 6420 746f 700a 2020 2020 2020 2020  oud top.        
+00025150: 6966 2064 665f 6e65 775b 2263 6c6f 7564  if df_new["cloud
+00025160: 5f67 7265 656e 225d 2e69 6c6f 635b 305d  _green"].iloc[0]
+00025170: 3a0a 2020 2020 2020 2020 2020 2020 6162  :.            ab
+00025180: 6f76 6543 6c6f 7564 546f 7020 3d20 280a  oveCloudTop = (.
 00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251a0: 2020 2020 616e 6420 6461 7461 5b22 4641      and data["FA
-000251b0: 5354 4422 5d2e 696c 6f63 5b31 3031 5d20  STD"].iloc[101] 
-000251c0: 3e20 6461 7461 5b22 4641 5354 4b22 5d2e  > data["FASTK"].
-000251d0: 696c 6f63 5b31 3031 5d0a 2020 2020 2020  iloc[101].      
-000251e0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-000251f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025200: 2023 2063 6c6f 7365 203e 2035 3020 7065   # close > 50 pe
-00025210: 7269 6f64 2053 4d41 2f45 4d41 2061 6e64  riod SMA/EMA and
-00025220: 2032 3030 2070 6572 696f 6420 534d 412f   200 period SMA/
-00025230: 454d 410a 2020 2020 2020 2020 2020 2020  EMA.            
-00025240: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00025250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025260: 2020 2020 2072 6563 656e 745b 2253 534d       recent["SSM
-00025270: 4122 5d2e 696c 6f63 5b30 5d20 3e20 7265  A"].iloc[0] > re
-00025280: 6365 6e74 5b22 534d 4122 5d2e 696c 6f63  cent["SMA"].iloc
-00025290: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-000252a0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000252b0: 7265 6365 6e74 5b22 436c 6f73 6522 5d2e  recent["Close"].
-000252c0: 696c 6f63 5b30 5d20 3e20 7265 6365 6e74  iloc[0] > recent
-000252d0: 5b22 5353 4d41 225d 2e69 6c6f 635b 305d  ["SSMA"].iloc[0]
-000252e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000252f0: 2020 2020 2020 2020 2061 6e64 2072 6563           and rec
-00025300: 656e 745b 2243 6c6f 7365 225d 2e69 6c6f  ent["Close"].ilo
-00025310: 635b 305d 203e 2072 6563 656e 745b 224c  c[0] > recent["L
-00025320: 4d41 225d 2e69 6c6f 635b 305d 0a20 2020  MA"].iloc[0].   
-00025330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025340: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00025350: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00025360: 6420 3d20 7365 6c66 2e66 696e 6443 7572  d = self.findCur
-00025370: 7265 6e74 5361 7665 6456 616c 7565 2873  rentSavedValue(s
-00025380: 6372 6565 6e44 6963 742c 7361 7665 4469  creenDict,saveDi
-00025390: 6374 2c22 4d41 2d53 6967 6e61 6c22 290a  ct,"MA-Signal").
-000253a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253b0: 2020 2020 2020 2020 7363 7265 656e 4469          screenDi
-000253c0: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-000253d0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000253e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253f0: 7361 7665 645b 305d 202b 2063 6f6c 6f72  saved[0] + color
-00025400: 5465 7874 2e42 4f4c 4420 2b20 636f 6c6f  Text.BOLD + colo
-00025410: 7254 6578 742e 4752 4545 4e20 2b20 2242  rText.GREEN + "B
-00025420: 756c 6c69 7368 2220 2b20 636f 6c6f 7254  ullish" + colorT
-00025430: 6578 742e 454e 440a 2020 2020 2020 2020  ext.END.        
-00025440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00025460: 2020 2020 2020 2020 2020 7361 7665 4469            saveDi
-00025470: 6374 5b22 4d41 2d53 6967 6e61 6c22 5d20  ct["MA-Signal"] 
-00025480: 3d20 7361 7665 645b 315d 202b 2022 4275  = saved[1] + "Bu
-00025490: 6c6c 6973 6822 0a20 2020 2020 2020 2020  llish".         
-000254a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000254b0: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-000254c0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-000254d0: 2020 2020 0a20 2020 2023 2056 616c 6964      .    # Valid
-000254e0: 6174 6520 5643 5020 6173 2070 6572 204d  ate VCP as per M
-000254f0: 6172 6b20 4d69 6e65 7276 696e 690a 2020  ark Minervini.  
-00025500: 2020 2320 6874 7470 733a 2f2f 6368 6172    # https://char
-00025510: 7469 6e6b 2e63 6f6d 2f73 6372 6565 6e65  tink.com/screene
-00025520: 722f 766f 6c61 7469 6c69 7479 2d63 6f6d  r/volatility-com
-00025530: 7072 6573 7369 6f6e 0a20 2020 2064 6566  pression.    def
-00025540: 2076 616c 6964 6174 6556 4350 4d61 726b   validateVCPMark
-00025550: 4d69 6e65 7276 696e 6928 7365 6c66 2c20  Minervini(self, 
-00025560: 6466 3a70 642e 4461 7461 4672 616d 652c  df:pd.DataFrame,
-00025570: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
-00025580: 6544 6963 7429 3a0a 2020 2020 2020 2020  eDict):.        
-00025590: 6966 2064 6620 6973 204e 6f6e 6520 6f72  if df is None or
-000255a0: 206c 656e 2864 6629 203d 3d20 303a 0a20   len(df) == 0:. 
-000255b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000255c0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-000255d0: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
-000255e0: 0a20 2020 2020 2020 206f 686c 635f 6469  .        ohlc_di
-000255f0: 6374 203d 207b 0a20 2020 2020 2020 2020  ct = {.         
-00025600: 2020 2027 4f70 656e 273a 2766 6972 7374     'Open':'first
-00025610: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00025620: 4869 6768 273a 276d 6178 272c 0a20 2020  High':'max',.   
-00025630: 2020 2020 2020 2020 2027 4c6f 7727 3a27           'Low':'
-00025640: 6d69 6e27 2c0a 2020 2020 2020 2020 2020  min',.          
-00025650: 2020 2743 6c6f 7365 273a 276c 6173 7427    'Close':'last'
-00025660: 2c0a 2020 2020 2020 2020 2020 2020 2756  ,.            'V
-00025670: 6f6c 756d 6527 3a27 7375 6d27 0a20 2020  olume':'sum'.   
-00025680: 2020 2020 207d 0a20 2020 2020 2020 2023       }.        #
-00025690: 2066 696e 616c 5f64 6620 3d20 6466 2e72   final_df = df.r
-000256a0: 6573 616d 706c 6528 2757 2d46 5249 272c  esample('W-FRI',
-000256b0: 2063 6c6f 7365 643d 276c 6566 7427 292e   closed='left').
-000256c0: 6167 6728 6f68 6c63 5f64 6963 7429 2e73  agg(ohlc_dict).s
-000256d0: 6869 6674 2827 3164 2729 0a20 2020 2020  hift('1d').     
-000256e0: 2020 2077 6565 6b6c 7944 6174 6120 3d20     weeklyData = 
-000256f0: 6461 7461 2e72 6573 616d 706c 6528 2757  data.resample('W
-00025700: 2729 2e61 6767 286f 686c 635f 6469 6374  ').agg(ohlc_dict
-00025710: 290a 2020 2020 2020 2020 7265 7665 7273  ).        revers
-00025720: 6564 4461 7461 203d 2064 6174 615b 3a3a  edData = data[::
-00025730: 2d31 5d20 2023 2052 6576 6572 7365 2074  -1]  # Reverse t
-00025740: 6865 2064 6174 6166 7261 6d65 0a20 2020  he dataframe.   
-00025750: 2020 2020 2072 6563 656e 745f 636c 6f73       recent_clos
-00025760: 6520 3d20 6461 7461 5b22 436c 6f73 6522  e = data["Close"
-00025770: 5d2e 6865 6164 2831 292e 696c 6f63 5b30  ].head(1).iloc[0
-00025780: 5d0a 2020 2020 2020 2020 775f 656d 615f  ].        w_ema_
-00025790: 3133 203d 2070 6b74 616c 6962 2e45 4d41  13 = pktalib.EMA
-000257a0: 2877 6565 6b6c 7944 6174 615b 2243 6c6f  (weeklyData["Clo
-000257b0: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
-000257c0: 3133 292e 7461 696c 2831 292e 696c 6f63  13).tail(1).iloc
-000257d0: 5b30 5d0a 2020 2020 2020 2020 775f 656d  [0].        w_em
-000257e0: 615f 3236 203d 2070 6b74 616c 6962 2e45  a_26 = pktalib.E
-000257f0: 4d41 2877 6565 6b6c 7944 6174 615b 2243  MA(weeklyData["C
-00025800: 6c6f 7365 225d 2c74 696d 6570 6572 696f  lose"],timeperio
-00025810: 643d 3236 292e 7461 696c 2831 292e 696c  d=26).tail(1).il
-00025820: 6f63 5b30 5d0a 2020 2020 2020 2020 775f  oc[0].        w_
-00025830: 736d 615f 3530 203d 2070 6b74 616c 6962  sma_50 = pktalib
-00025840: 2e53 4d41 2877 6565 6b6c 7944 6174 615b  .SMA(weeklyData[
-00025850: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00025860: 696f 643d 3530 292e 7461 696c 2831 292e  iod=50).tail(1).
-00025870: 696c 6f63 5b30 5d0a 2020 2020 2020 2020  iloc[0].        
-00025880: 775f 736d 615f 3430 203d 2070 6b74 616c  w_sma_40 = pktal
-00025890: 6962 2e53 4d41 2877 6565 6b6c 7944 6174  ib.SMA(weeklyDat
-000258a0: 615b 2243 6c6f 7365 225d 2c74 696d 6570  a["Close"],timep
-000258b0: 6572 696f 643d 3430 292e 7461 696c 2831  eriod=40).tail(1
-000258c0: 292e 696c 6f63 5b30 5d0a 2020 2020 2020  ).iloc[0].      
-000258d0: 2020 775f 736d 615f 3430 5f35 775f 6167    w_sma_40_5w_ag
-000258e0: 6f20 3d20 706b 7461 6c69 622e 534d 4128  o = pktalib.SMA(
-000258f0: 7765 656b 6c79 4461 7461 2e68 6561 6428  weeklyData.head(
-00025900: 6c65 6e28 7765 656b 6c79 4461 7461 292d  len(weeklyData)-
-00025910: 3529 5b22 436c 6f73 6522 5d2c 7469 6d65  5)["Close"],time
-00025920: 7065 7269 6f64 3d34 3029 2e74 6169 6c28  period=40).tail(
-00025930: 3129 2e69 6c6f 635b 305d 0a20 2020 2020  1).iloc[0].     
-00025940: 2020 2077 5f6d 696e 5f35 3020 3d20 6d69     w_min_50 = mi
-00025950: 6e28 312e 332a 7765 656b 6c79 4461 7461  n(1.3*weeklyData
-00025960: 2e74 6169 6c28 3530 295b 224c 6f77 225d  .tail(50)["Low"]
-00025970: 290a 2020 2020 2020 2020 775f 6d61 785f  ).        w_max_
-00025980: 3530 203d 206d 6178 2830 2e37 352a 7765  50 = max(0.75*we
-00025990: 656b 6c79 4461 7461 2e74 6169 6c28 3530  eklyData.tail(50
-000259a0: 295b 2248 6967 6822 5d29 0a20 2020 2020  )["High"]).     
-000259b0: 2020 2077 5f65 6d61 5f32 365f 3230 775f     w_ema_26_20w_
-000259c0: 6167 6f20 3d20 706b 7461 6c69 622e 454d  ago = pktalib.EM
-000259d0: 4128 7765 656b 6c79 4461 7461 2e68 6561  A(weeklyData.hea
-000259e0: 6428 6c65 6e28 7765 656b 6c79 4461 7461  d(len(weeklyData
-000259f0: 292d 3230 295b 2243 6c6f 7365 225d 2c74  )-20)["Close"],t
-00025a00: 696d 6570 6572 696f 643d 3236 292e 7461  imeperiod=26).ta
-00025a10: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
-00025a20: 2020 2020 2020 7265 6365 6e74 5f65 6d61        recent_ema
-00025a30: 5f31 335f 3230 645f 6167 6f20 3d20 706b  _13_20d_ago = pk
-00025a40: 7461 6c69 622e 454d 4128 7265 7665 7273  talib.EMA(revers
-00025a50: 6564 4461 7461 2e68 6561 6428 6c65 6e28  edData.head(len(
-00025a60: 7265 7665 7273 6564 4461 7461 292d 3230  reversedData)-20
-00025a70: 295b 2243 6c6f 7365 225d 2c74 696d 6570  )["Close"],timep
-00025a80: 6572 696f 643d 3133 292e 7461 696c 2831  eriod=13).tail(1
-00025a90: 292e 696c 6f63 5b30 5d0a 2020 2020 2020  ).iloc[0].      
-00025aa0: 2020 775f 736d 615f 3430 5f35 775f 6167    w_sma_40_5w_ag
-00025ab0: 6f20 3d20 706b 7461 6c69 622e 534d 4128  o = pktalib.SMA(
-00025ac0: 7765 656b 6c79 4461 7461 2e68 6561 6428  weeklyData.head(
-00025ad0: 6c65 6e28 7765 656b 6c79 4461 7461 292d  len(weeklyData)-
-00025ae0: 3529 5b22 436c 6f73 6522 5d2c 7469 6d65  5)["Close"],time
-00025af0: 7065 7269 6f64 3d34 3029 2e74 6169 6c28  period=40).tail(
-00025b00: 3129 2e69 6c6f 635b 305d 0a20 2020 2020  1).iloc[0].     
-00025b10: 2020 2077 5f73 6d61 5f34 305f 3130 775f     w_sma_40_10w_
-00025b20: 6167 6f20 3d20 706b 7461 6c69 622e 534d  ago = pktalib.SM
-00025b30: 4128 7765 656b 6c79 4461 7461 2e68 6561  A(weeklyData.hea
-00025b40: 6428 6c65 6e28 7765 656b 6c79 4461 7461  d(len(weeklyData
-00025b50: 292d 3130 295b 2243 6c6f 7365 225d 2c74  )-10)["Close"],t
-00025b60: 696d 6570 6572 696f 643d 3430 292e 7461  imeperiod=40).ta
-00025b70: 696c 2831 292e 696c 6f63 5b30 5d0a 2020  il(1).iloc[0].  
-00025b80: 2020 2020 2020 7265 6365 6e74 5f73 6d61        recent_sma
-00025b90: 5f35 3020 3d20 706b 7461 6c69 622e 534d  _50 = pktalib.SM
-00025ba0: 4128 7265 7665 7273 6564 4461 7461 5b22  A(reversedData["
-00025bb0: 436c 6f73 6522 5d2c 7469 6d65 7065 7269  Close"],timeperi
-00025bc0: 6f64 3d35 3029 2e74 6169 6c28 3129 2e69  od=50).tail(1).i
-00025bd0: 6c6f 635b 305d 0a20 2020 2020 2020 2077  loc[0].        w
-00025be0: 5f77 6d61 5f38 203d 2070 6b74 616c 6962  _wma_8 = pktalib
-00025bf0: 2e57 4d41 2877 6565 6b6c 7944 6174 615b  .WMA(weeklyData[
-00025c00: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00025c10: 696f 643d 3829 2e74 6169 6c28 3129 2e69  iod=8).tail(1).i
-00025c20: 6c6f 635b 305d 0a20 2020 2020 2020 2077  loc[0].        w
-00025c30: 5f73 6d61 5f38 203d 2070 6b74 616c 6962  _sma_8 = pktalib
-00025c40: 2e53 4d41 2877 6565 6b6c 7944 6174 615b  .SMA(weeklyData[
-00025c50: 2243 6c6f 7365 225d 2c74 696d 6570 6572  "Close"],timeper
-00025c60: 696f 643d 3829 2e74 6169 6c28 3129 2e69  iod=8).tail(1).i
-00025c70: 6c6f 635b 305d 0a20 2020 2020 2020 206e  loc[0].        n
-00025c80: 756d 5072 6576 696f 7573 4361 6e64 6c65  umPreviousCandle
-00025c90: 7320 3d20 3230 0a20 2020 2020 2020 2070  s = 20.        p
-00025ca0: 756c 6c62 6163 6b44 6174 6120 3d20 6461  ullbackData = da
-00025cb0: 7461 2e68 6561 6428 6e75 6d50 7265 7669  ta.head(numPrevi
-00025cc0: 6f75 7343 616e 646c 6573 290a 2020 2020  ousCandles).    
-00025cd0: 2020 2020 7075 6c6c 6261 636b 4461 7461      pullbackData
-00025ce0: 2e6c 6f63 5b3a 2c27 5075 6c6c 4261 636b  .loc[:,'PullBack
-00025cf0: 275d 203d 2070 756c 6c62 6163 6b44 6174  '] = pullbackDat
-00025d00: 615b 2243 6c6f 7365 225d 2e6c 7428 7075  a["Close"].lt(pu
-00025d10: 6c6c 6261 636b 4461 7461 5b22 4f70 656e  llbackData["Open
-00025d20: 225d 2920 232e 7368 6966 7428 7065 7269  "]) #.shift(peri
-00025d30: 6f64 733d 3129 2920 2326 2064 6174 615b  ods=1)) #& data[
-00025d40: 224c 6f77 225d 2e6c 7428 6461 7461 5b22  "Low"].lt(data["
-00025d50: 4c6f 7722 5d2e 7368 6966 7428 7065 7269  Low"].shift(peri
-00025d60: 6f64 733d 3129 290a 2020 2020 2020 2020  ods=1)).        
-00025d70: 7368 7269 6e6b 6564 566f 6c44 6174 6120  shrinkedVolData 
-00025d80: 3d20 7075 6c6c 6261 636b 4461 7461 5b70  = pullbackData[p
-00025d90: 756c 6c62 6163 6b44 6174 615b 2250 756c  ullbackData["Pul
-00025da0: 6c42 6163 6b22 5d20 3d3d 2054 7275 655d  lBack"] == True]
-00025db0: 2e68 6561 6428 6e75 6d50 7265 7669 6f75  .head(numPreviou
-00025dc0: 7343 616e 646c 6573 290a 2020 2020 2020  sCandles).      
-00025dd0: 2020 7265 6365 6e74 4c61 7267 6573 7456    recentLargestV
-00025de0: 6f6c 756d 6520 3d20 6d61 7828 7075 6c6c  olume = max(pull
-00025df0: 6261 636b 4461 7461 5b70 756c 6c62 6163  backData[pullbac
-00025e00: 6b44 6174 615b 2250 756c 6c42 6163 6b22  kData["PullBack"
-00025e10: 5d20 3d3d 2046 616c 7365 5d2e 6865 6164  ] == False].head
-00025e20: 2833 295b 2256 6f6c 756d 6522 5d29 0a20  (3)["Volume"]). 
-00025e30: 2020 2020 2020 2023 2070 756c 6c62 6163         # pullbac
-00025e40: 6b44 6174 612e 6c6f 635b 3a2c 2750 4256  kData.loc[:,'PBV
-00025e50: 6f6c 5261 7469 6f27 5d20 3d20 7075 6c6c  olRatio'] = pull
-00025e60: 6261 636b 4461 7461 5b22 566f 6c75 6d65  backData["Volume
-00025e70: 225d 2f72 6563 656e 744c 6172 6765 7374  "]/recentLargest
-00025e80: 566f 6c75 6d65 0a20 2020 2020 2020 2076  Volume.        v
-00025e90: 6f6c 496e 5072 6576 696f 7573 5075 6c6c  olInPreviousPull
-00025ea0: 6261 636b 7353 6872 696e 6b65 6420 3d20  backsShrinked = 
-00025eb0: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-00025ec0: 206e 6f74 2073 6872 696e 6b65 6456 6f6c   not shrinkedVol
-00025ed0: 4461 7461 2e65 6d70 7479 3a0a 2020 2020  Data.empty:.    
-00025ee0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-00025ef0: 300a 2020 2020 2020 2020 2020 2020 7768  0.            wh
-00025f00: 696c 6520 696e 6465 7820 3c20 6c65 6e28  ile index < len(
-00025f10: 7368 7269 6e6b 6564 566f 6c44 6174 6129  shrinkedVolData)
-00025f20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00025f30: 2020 766f 6c49 6e50 7265 7669 6f75 7350    volInPreviousP
-00025f40: 756c 6c62 6163 6b73 5368 7269 6e6b 6564  ullbacksShrinked
-00025f50: 203d 2073 6872 696e 6b65 6456 6f6c 4461   = shrinkedVolDa
-00025f60: 7461 5b22 566f 6c75 6d65 225d 2e69 6c6f  ta["Volume"].ilo
-00025f70: 635b 696e 6465 785d 203c 2073 656c 662e  c[index] < self.
-00025f80: 636f 6e66 6967 4d61 6e61 6765 722e 7663  configManager.vc
-00025f90: 7056 6f6c 756d 6543 6f6e 7472 6163 7469  pVolumeContracti
-00025fa0: 6f6e 5261 7469 6f20 2a20 7265 6365 6e74  onRatio * recent
-00025fb0: 4c61 7267 6573 7456 6f6c 756d 650a 2020  LargestVolume.  
-00025fc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00025fd0: 206e 6f74 2076 6f6c 496e 5072 6576 696f   not volInPrevio
-00025fe0: 7573 5075 6c6c 6261 636b 7353 6872 696e  usPullbacksShrin
-00025ff0: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
-00026000: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00026010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00026020: 6e64 6578 202b 3d20 310a 2020 2020 2020  ndex += 1.      
-00026030: 2020 7265 6365 6e74 566f 6c75 6d65 4861    recentVolumeHa
-00026040: 7341 626f 7665 4176 6756 6f6c 203d 2072  sAboveAvgVol = r
-00026050: 6563 656e 744c 6172 6765 7374 566f 6c75  ecentLargestVolu
-00026060: 6d65 203e 3d20 7365 6c66 2e63 6f6e 6669  me >= self.confi
-00026070: 674d 616e 6167 6572 2e76 6f6c 756d 6552  gManager.volumeR
-00026080: 6174 696f 202a 2064 6174 615b 2256 6f6c  atio * data["Vol
-00026090: 4d41 225d 2e69 6c6f 635b 305d 0a20 2020  MA"].iloc[0].   
-000260a0: 2020 2020 2069 7356 4350 203d 2077 5f65       isVCP = w_e
-000260b0: 6d61 5f31 3320 3e20 775f 656d 615f 3236  ma_13 > w_ema_26
-000260c0: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
-000260d0: 2020 2020 2020 2077 5f65 6d61 5f32 3620         w_ema_26 
-000260e0: 3e20 775f 736d 615f 3530 2061 6e64 205c  > w_sma_50 and \
-000260f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026100: 2077 5f73 6d61 5f34 3020 3e20 775f 736d   w_sma_40 > w_sm
-00026110: 615f 3430 5f35 775f 6167 6f20 616e 6420  a_40_5w_ago and 
-00026120: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00026130: 2020 7265 6365 6e74 5f63 6c6f 7365 203e    recent_close >
-00026140: 3d20 775f 6d69 6e5f 3530 2061 6e64 205c  = w_min_50 and \
-00026150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026160: 2072 6563 656e 745f 636c 6f73 6520 3e3d   recent_close >=
-00026170: 2077 5f6d 6178 5f35 3020 616e 6420 5c0a   w_max_50 and \.
-00026180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026190: 7265 6365 6e74 5f65 6d61 5f31 335f 3230  recent_ema_13_20
-000261a0: 645f 6167 6f20 3e20 775f 656d 615f 3236  d_ago > w_ema_26
-000261b0: 5f32 3077 5f61 676f 2061 6e64 205c 0a20  _20w_ago and \. 
-000261c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000261d0: 5f73 6d61 5f34 305f 3577 5f61 676f 203e  _sma_40_5w_ago >
-000261e0: 2077 5f73 6d61 5f34 305f 3130 775f 6167   w_sma_40_10w_ag
-000261f0: 6f20 616e 6420 5c0a 2020 2020 2020 2020  o and \.        
-00026200: 2020 2020 2020 2020 7265 6365 6e74 5f63          recent_c
-00026210: 6c6f 7365 203e 2072 6563 656e 745f 736d  lose > recent_sm
-00026220: 615f 3530 2061 6e64 205c 0a20 2020 2020  a_50 and \.     
-00026230: 2020 2020 2020 2020 2020 2028 775f 776d             (w_wm
-00026240: 615f 3820 2d20 775f 736d 615f 3829 2a36  a_8 - w_sma_8)*6
-00026250: 2f32 3920 3c20 302e 3520 616e 6420 5c0a  /29 < 0.5 and \.
-00026260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026270: 766f 6c49 6e50 7265 7669 6f75 7350 756c  volInPreviousPul
-00026280: 6c62 6163 6b73 5368 7269 6e6b 6564 2061  lbacksShrinked a
-00026290: 6e64 205c 0a20 2020 2020 2020 2020 2020  nd \.           
-000262a0: 2020 2020 2072 6563 656e 7456 6f6c 756d       recentVolum
-000262b0: 6548 6173 4162 6f76 6541 7667 566f 6c20  eHasAboveAvgVol 
-000262c0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
-000262d0: 2020 2020 2020 7265 6365 6e74 5f63 6c6f        recent_clo
-000262e0: 7365 203e 2031 300a 2020 2020 2020 2020  se > 10.        
-000262f0: 6966 2069 7356 4350 3a0a 2020 2020 2020  if isVCP:.      
-00026300: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
-00026310: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
-00026320: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
-00026330: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
-00026340: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
-00026350: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
-00026360: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
-00026370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026380: 7361 7665 645b 305d 200a 2020 2020 2020  saved[0] .      
-00026390: 2020 2020 2020 2020 2020 2b20 636f 6c6f            + colo
-000263a0: 7254 6578 742e 424f 4c44 0a20 2020 2020  rText.BOLD.     
-000263b0: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
-000263c0: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
-000263d0: 2020 2020 2020 2020 2020 2020 202b 2066               + f
-000263e0: 2256 4350 284d 696e 6572 7669 6e69 2922  "VCP(Minervini)"
-000263f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026400: 202b 2063 6f6c 6f72 5465 7874 2e45 4e44   + colorText.END
-00026410: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00026420: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
-00026430: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
-00026440: 2073 6176 6564 5b31 5d20 2b20 6622 5643   saved[1] + f"VC
-00026450: 5028 4d69 6e65 7276 696e 6929 220a 2020  P(Minervini)".  
-00026460: 2020 2020 2020 7265 7475 726e 2069 7356        return isV
-00026470: 4350 0a20 2020 200a 2020 2020 2320 5661  CP.    .    # Va
-00026480: 6c69 6461 7465 2056 4350 0a20 2020 2064  lidate VCP.    d
-00026490: 6566 2076 616c 6964 6174 6556 4350 280a  ef validateVCP(.
-000264a0: 2020 2020 2020 2020 7365 6c66 2c20 6466          self, df
-000264b0: 2c20 7363 7265 656e 4469 6374 2c20 7361  , screenDict, sa
-000264c0: 7665 4469 6374 2c20 7374 6f63 6b4e 616d  veDict, stockNam
-000264d0: 653d 4e6f 6e65 2c20 7769 6e64 6f77 3d33  e=None, window=3
-000264e0: 2c20 7065 7263 656e 7461 6765 4672 6f6d  , percentageFrom
-000264f0: 546f 703d 330a 2020 2020 293a 0a20 2020  Top=3.    ):.   
-00026500: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
-00026510: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
-00026520: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00026530: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00026540: 2020 2020 2064 6174 6120 3d20 6466 2e63       data = df.c
-00026550: 6f70 7928 290a 2020 2020 2020 2020 7472  opy().        tr
-00026560: 793a 0a20 2020 2020 2020 2020 2020 2070  y:.            p
-00026570: 6572 6365 6e74 6167 6546 726f 6d54 6f70  ercentageFromTop
-00026580: 202f 3d20 3130 300a 2020 2020 2020 2020   /= 100.        
-00026590: 2020 2020 6461 7461 2e72 6573 6574 5f69      data.reset_i
-000265a0: 6e64 6578 2869 6e70 6c61 6365 3d54 7275  ndex(inplace=Tru
-000265b0: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-000265c0: 6174 612e 7265 6e61 6d65 2863 6f6c 756d  ata.rename(colum
-000265d0: 6e73 3d7b 2269 6e64 6578 223a 2022 4461  ns={"index": "Da
-000265e0: 7465 227d 2c20 696e 706c 6163 653d 5472  te"}, inplace=Tr
-000265f0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00026600: 6461 7461 5b22 746f 7073 225d 203d 2028  data["tops"] = (
-00026610: 6461 7461 5b22 4869 6768 225d 2e69 6c6f  data["High"].ilo
-00026620: 635b 6c69 7374 2870 6b74 616c 6962 2e61  c[list(pktalib.a
-00026630: 7267 7265 6c65 7874 7265 6d61 286e 702e  rgrelextrema(np.
-00026640: 6172 7261 7928 6461 7461 5b22 4869 6768  array(data["High
-00026650: 225d 292c 206e 702e 6772 6561 7465 725f  "]), np.greater_
-00026660: 6571 7561 6c2c 206f 7264 6572 3d77 696e  equal, order=win
-00026670: 646f 7729 5b30 5d29 5d2e 6865 6164 2834  dow)[0])].head(4
-00026680: 2929 0a20 2020 2020 2020 2020 2020 2064  )).            d
-00026690: 6174 615b 2262 6f74 7322 5d20 3d20 2864  ata["bots"] = (d
-000266a0: 6174 615b 224c 6f77 225d 2e69 6c6f 635b  ata["Low"].iloc[
-000266b0: 6c69 7374 2870 6b74 616c 6962 2e61 7267  list(pktalib.arg
-000266c0: 7265 6c65 7874 7265 6d61 286e 702e 6172  relextrema(np.ar
-000266d0: 7261 7928 6461 7461 5b22 4c6f 7722 5d29  ray(data["Low"])
-000266e0: 2c20 6e70 2e6c 6573 735f 6571 7561 6c2c  , np.less_equal,
-000266f0: 206f 7264 6572 3d77 696e 646f 7729 5b30   order=window)[0
-00026700: 5d29 5d2e 6865 6164 2834 2929 0a20 2020  ])].head(4)).   
-00026710: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-00026720: 6461 7461 2e66 696c 6c6e 6128 3029 0a20  data.fillna(0). 
-00026730: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00026740: 3d20 6461 7461 2e72 6570 6c61 6365 285b  = data.replace([
-00026750: 6e70 2e69 6e66 2c20 2d6e 702e 696e 665d  np.inf, -np.inf]
-00026760: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-00026770: 2074 6f70 7320 3d20 6461 7461 5b64 6174   tops = data[dat
-00026780: 612e 746f 7073 203e 2030 5d0a 2020 2020  a.tops > 0].    
-00026790: 2020 2020 2020 2020 2320 626f 7473 203d          # bots =
-000267a0: 2064 6174 615b 6461 7461 2e62 6f74 7320   data[data.bots 
-000267b0: 3e20 305d 0a20 2020 2020 2020 2020 2020  > 0].           
-000267c0: 2068 6967 6865 7374 546f 7020 3d20 726f   highestTop = ro
-000267d0: 756e 6428 746f 7073 2e64 6573 6372 6962  und(tops.describ
-000267e0: 6528 295b 2248 6967 6822 5d5b 226d 6178  e()["High"]["max
-000267f0: 225d 2c20 3129 0a20 2020 2020 2020 2020  "], 1).         
-00026800: 2020 2066 696c 7465 7265 6454 6f70 7320     filteredTops 
-00026810: 3d20 746f 7073 5b0a 2020 2020 2020 2020  = tops[.        
-00026820: 2020 2020 2020 2020 746f 7073 2e74 6f70          tops.top
-00026830: 7320 3e20 2868 6967 6865 7374 546f 7020  s > (highestTop 
-00026840: 2d20 2868 6967 6865 7374 546f 7020 2a20  - (highestTop * 
-00026850: 7065 7263 656e 7461 6765 4672 6f6d 546f  percentageFromTo
-00026860: 7029 290a 2020 2020 2020 2020 2020 2020  p)).            
-00026870: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00026880: 2066 696c 7465 7265 6454 6f70 732e 6571   filteredTops.eq
-00026890: 7561 6c73 2874 6f70 7329 3a20 2023 2054  uals(tops):  # T
-000268a0: 6f70 7320 6172 6520 696e 2074 6865 2072  ops are in the r
-000268b0: 616e 6765 0a20 2020 2020 2020 2020 2020  ange.           
-000268c0: 2020 2020 206c 6f77 506f 696e 7473 203d       lowPoints =
-000268d0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-000268e0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-000268f0: 6765 286c 656e 2874 6f70 7329 202d 2031  ge(len(tops) - 1
-00026900: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00026910: 2020 2020 2020 2065 6e64 4461 7465 203d         endDate =
-00026920: 2074 6f70 732e 696c 6f63 5b69 5d5b 2244   tops.iloc[i]["D
-00026930: 6174 6522 5d0a 2020 2020 2020 2020 2020  ate"].          
-00026940: 2020 2020 2020 2020 2020 7374 6172 7444            startD
-00026950: 6174 6520 3d20 746f 7073 2e69 6c6f 635b  ate = tops.iloc[
-00026960: 6920 2b20 315d 5b22 4461 7465 225d 0a20  i + 1]["Date"]. 
-00026970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026980: 2020 206c 6f77 506f 696e 7473 2e61 7070     lowPoints.app
-00026990: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-000269a0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000269b0: 615b 0a20 2020 2020 2020 2020 2020 2020  a[.             
-000269c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000269d0: 6461 7461 2e44 6174 6520 3e3d 2073 7461  data.Date >= sta
-000269e0: 7274 4461 7465 2920 2620 2864 6174 612e  rtDate) & (data.
-000269f0: 4461 7465 203c 3d20 656e 6444 6174 6529  Date <= endDate)
-00026a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026a10: 2020 2020 2020 2020 205d 2e64 6573 6372           ].descr
-00026a20: 6962 6528 295b 224c 6f77 225d 5b22 6d69  ibe()["Low"]["mi
-00026a30: 6e22 5d0a 2020 2020 2020 2020 2020 2020  n"].            
-00026a40: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00026a50: 2020 2020 2020 2020 2020 6c6f 7750 6f69            lowPoi
-00026a60: 6e74 734f 7267 203d 206c 6f77 506f 696e  ntsOrg = lowPoin
-00026a70: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-00026a80: 2020 206c 6f77 506f 696e 7473 2e73 6f72     lowPoints.sor
-00026a90: 7428 7265 7665 7273 653d 5472 7565 290a  t(reverse=True).
-00026aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ab0: 6c6f 7750 6f69 6e74 7353 6f72 7465 6420  lowPointsSorted 
-00026ac0: 3d20 6c6f 7750 6f69 6e74 730a 2020 2020  = lowPoints.    
-00026ad0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00026ae0: 6174 612e 656d 7074 7920 6f72 206c 656e  ata.empty or len
-00026af0: 286c 6f77 506f 696e 7473 2920 3c20 313a  (lowPoints) < 1:
-00026b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026b10: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00026b20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00026b30: 2020 6c74 7020 3d20 6461 7461 2e68 6561    ltp = data.hea
-00026b40: 6428 3129 5b22 436c 6f73 6522 5d2e 696c  d(1)["Close"].il
-00026b50: 6f63 5b30 5d0a 2020 2020 2020 2020 2020  oc[0].          
-00026b60: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00026b70: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00026b80: 6f77 506f 696e 7473 4f72 6720 3d3d 206c  owPointsOrg == l
-00026b90: 6f77 506f 696e 7473 536f 7274 6564 0a20  owPointsSorted. 
-00026ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026bb0: 2020 2061 6e64 206c 7470 203c 2068 6967     and ltp < hig
-00026bc0: 6865 7374 546f 700a 2020 2020 2020 2020  hestTop.        
-00026bd0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00026be0: 6c74 7020 3e20 6c6f 7750 6f69 6e74 735b  ltp > lowPoints[
-00026bf0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-00026c00: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00026c10: 2020 2020 2020 2020 2020 7361 7665 6420            saved 
-00026c20: 3d20 7365 6c66 2e66 696e 6443 7572 7265  = self.findCurre
-00026c30: 6e74 5361 7665 6456 616c 7565 2873 6372  ntSavedValue(scr
-00026c40: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
-00026c50: 742c 2022 5061 7474 6572 6e22 290a 2020  t, "Pattern").  
-00026c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026c70: 2020 7363 7265 656e 4469 6374 5b22 5061    screenDict["Pa
-00026c80: 7474 6572 6e22 5d20 3d20 280a 2020 2020  ttern"] = (.    
-00026c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ca0: 2020 2020 7361 7665 645b 305d 200a 2020      saved[0] .  
-00026cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026cc0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00026cd0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-00026ce0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00026cf0: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
-00026d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026d10: 2020 2020 2020 2020 202b 2066 2256 4350           + f"VCP
-00026d20: 2028 424f 3a20 7b68 6967 6865 7374 546f   (BO: {highestTo
-00026d30: 707d 2922 0a20 2020 2020 2020 2020 2020  p})".           
-00026d40: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00026d50: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
+000251a0: 6466 5f6e 6577 5b22 494b 535f 3236 225d  df_new["IKS_26"]
+000251b0: 2e69 6c6f 635b 305d 203e 2064 665f 6e65  .iloc[0] > df_ne
+000251c0: 775b 2249 5341 5f39 225d 2e69 6c6f 635b  w["ISA_9"].iloc[
+000251d0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+000251e0: 2020 2061 6e64 2072 6563 656e 745b 2243     and recent["C
+000251f0: 6c6f 7365 225d 2e69 6c6f 635b 305d 203e  lose"].iloc[0] >
+00025200: 2064 665f 6e65 775b 2249 5341 5f39 225d   df_new["ISA_9"]
+00025210: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00025220: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00025230: 6c69 6620 6466 5f6e 6577 5b22 636c 6f75  lif df_new["clou
+00025240: 645f 7265 6422 5d2e 696c 6f63 5b30 5d3a  d_red"].iloc[0]:
+00025250: 0a20 2020 2020 2020 2020 2020 2061 626f  .            abo
+00025260: 7665 436c 6f75 6454 6f70 203d 2028 0a20  veCloudTop = (. 
+00025270: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00025280: 665f 6e65 775b 2249 4b53 5f32 3622 5d2e  f_new["IKS_26"].
+00025290: 696c 6f63 5b30 5d20 3e20 6466 5f6e 6577  iloc[0] > df_new
+000252a0: 5b22 4953 425f 3236 225d 2e69 6c6f 635b  ["ISB_26"].iloc[
+000252b0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+000252c0: 2020 2061 6e64 2072 6563 656e 745b 2243     and recent["C
+000252d0: 6c6f 7365 225d 2e69 6c6f 635b 305d 203e  lose"].iloc[0] >
+000252e0: 2064 665f 6e65 775b 2249 5342 5f32 3622   df_new["ISB_26"
+000252f0: 5d2e 696c 6f63 5b30 5d0a 2020 2020 2020  ].iloc[0].      
+00025300: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00025310: 2023 204c 6174 6573 7420 4963 6869 6d6f   # Latest Ichimo
+00025320: 6b75 2062 6173 656c 696e 6520 6973 203c  ku baseline is <
+00025330: 206c 6174 6573 7420 4963 6869 6d6f 6b75   latest Ichimoku
+00025340: 2063 6f6e 7665 7273 696f 6e20 6c69 6e65   conversion line
+00025350: 0a20 2020 2020 2020 2069 6620 6162 6f76  .        if abov
+00025360: 6543 6c6f 7564 546f 7020 616e 6420 6466  eCloudTop and df
+00025370: 5f6e 6577 5b22 494b 535f 3236 225d 2e69  _new["IKS_26"].i
+00025380: 6c6f 635b 305d 203c 2064 665f 6e65 775b  loc[0] < df_new[
+00025390: 2249 5453 5f39 225d 2e69 6c6f 635b 305d  "ITS_9"].iloc[0]
+000253a0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000253b0: 5374 6f63 6852 5349 2063 726f 7373 6564  StochRSI crossed
+000253c0: 2032 3020 616e 6420 5253 4920 3e20 3530   20 and RSI > 50
+000253d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000253e0: 666b 203e 2032 3020 616e 6420 7265 6365  fk > 20 and rece
+000253f0: 6e74 5b22 5253 4922 5d2e 696c 6f63 5b30  nt["RSI"].iloc[0
+00025400: 5d20 3e20 3530 3a0a 2020 2020 2020 2020  ] > 50:.        
+00025410: 2020 2020 2020 2020 2320 636f 6e64 6974          # condit
+00025420: 696f 6e20 6f66 2063 726f 7373 696e 6720  ion of crossing 
+00025430: 7468 6520 5374 6f63 6852 5349 206d 6169  the StochRSI mai
+00025440: 6e20 7369 676e 616c 206c 696e 6520 6672  n signal line fr
+00025450: 6f6d 2062 6f74 746f 6d20 746f 2074 6f70  om bottom to top
+00025460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025470: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00025480: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+00025490: 4641 5354 4422 5d2e 696c 6f63 5b31 3030  FASTD"].iloc[100
+000254a0: 5d20 3c20 6461 7461 5b22 4641 5354 4b22  ] < data["FASTK"
+000254b0: 5d2e 696c 6f63 5b31 3030 5d0a 2020 2020  ].iloc[100].    
+000254c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254d0: 616e 6420 6461 7461 5b22 4641 5354 4422  and data["FASTD"
+000254e0: 5d2e 696c 6f63 5b31 3031 5d20 3e20 6461  ].iloc[101] > da
+000254f0: 7461 5b22 4641 5354 4b22 5d2e 696c 6f63  ta["FASTK"].iloc
+00025500: 5b31 3031 5d0a 2020 2020 2020 2020 2020  [101].          
+00025510: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00025520: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+00025530: 6c6f 7365 203e 2035 3020 7065 7269 6f64  lose > 50 period
+00025540: 2053 4d41 2f45 4d41 2061 6e64 2032 3030   SMA/EMA and 200
+00025550: 2070 6572 696f 6420 534d 412f 454d 410a   period SMA/EMA.
+00025560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025570: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00025580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025590: 2072 6563 656e 745b 2253 534d 4122 5d2e   recent["SSMA"].
+000255a0: 696c 6f63 5b30 5d20 3e20 7265 6365 6e74  iloc[0] > recent
+000255b0: 5b22 534d 4122 5d2e 696c 6f63 5b30 5d0a  ["SMA"].iloc[0].
+000255c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255d0: 2020 2020 2020 2020 616e 6420 7265 6365          and rece
+000255e0: 6e74 5b22 436c 6f73 6522 5d2e 696c 6f63  nt["Close"].iloc
+000255f0: 5b30 5d20 3e20 7265 6365 6e74 5b22 5353  [0] > recent["SS
+00025600: 4d41 225d 2e69 6c6f 635b 305d 0a20 2020  MA"].iloc[0].   
+00025610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025620: 2020 2020 2061 6e64 2072 6563 656e 745b       and recent[
+00025630: 2243 6c6f 7365 225d 2e69 6c6f 635b 305d  "Close"].iloc[0]
+00025640: 203e 2072 6563 656e 745b 224c 4d41 225d   > recent["LMA"]
+00025650: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+00025660: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+00025670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025680: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
+00025690: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
+000256a0: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
+000256b0: 6e44 6963 742c 7361 7665 4469 6374 2c22  nDict,saveDict,"
+000256c0: 4d41 2d53 6967 6e61 6c22 290a 2020 2020  MA-Signal").    
+000256d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000256e0: 2020 2020 7363 7265 656e 4469 6374 5b22      screenDict["
+000256f0: 4d41 2d53 6967 6e61 6c22 5d20 3d20 280a  MA-Signal"] = (.
+00025700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025710: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00025720: 645b 305d 202b 2063 6f6c 6f72 5465 7874  d[0] + colorText
+00025730: 2e42 4f4c 4420 2b20 636f 6c6f 7254 6578  .BOLD + colorTex
+00025740: 742e 4752 4545 4e20 2b20 2242 756c 6c69  t.GREEN + "Bulli
+00025750: 7368 2220 2b20 636f 6c6f 7254 6578 742e  sh" + colorText.
+00025760: 454e 440a 2020 2020 2020 2020 2020 2020  END.            
+00025770: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00025780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025790: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+000257a0: 4d41 2d53 6967 6e61 6c22 5d20 3d20 7361  MA-Signal"] = sa
+000257b0: 7665 645b 315d 202b 2022 4275 6c6c 6973  ved[1] + "Bullis
+000257c0: 6822 0a20 2020 2020 2020 2020 2020 2020  h".             
+000257d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000257e0: 6e20 5472 7565 0a20 2020 2020 2020 2072  n True.        r
+000257f0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00025800: 0a20 2020 2023 2056 616c 6964 6174 6520  .    # Validate 
+00025810: 5643 5020 6173 2070 6572 204d 6172 6b20  VCP as per Mark 
+00025820: 4d69 6e65 7276 696e 690a 2020 2020 2320  Minervini.    # 
+00025830: 6874 7470 733a 2f2f 6368 6172 7469 6e6b  https://chartink
+00025840: 2e63 6f6d 2f73 6372 6565 6e65 722f 766f  .com/screener/vo
+00025850: 6c61 7469 6c69 7479 2d63 6f6d 7072 6573  latility-compres
+00025860: 7369 6f6e 0a20 2020 2064 6566 2076 616c  sion.    def val
+00025870: 6964 6174 6556 4350 4d61 726b 4d69 6e65  idateVCPMarkMine
+00025880: 7276 696e 6928 7365 6c66 2c20 6466 3a70  rvini(self, df:p
+00025890: 642e 4461 7461 4672 616d 652c 2073 6372  d.DataFrame, scr
+000258a0: 6565 6e44 6963 742c 2073 6176 6544 6963  eenDict, saveDic
+000258b0: 7429 3a0a 2020 2020 2020 2020 6966 2064  t):.        if d
+000258c0: 6620 6973 204e 6f6e 6520 6f72 206c 656e  f is None or len
+000258d0: 2864 6629 203d 3d20 303a 0a20 2020 2020  (df) == 0:.     
+000258e0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000258f0: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
+00025900: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+00025910: 2020 2020 206f 686c 635f 6469 6374 203d       ohlc_dict =
+00025920: 207b 0a20 2020 2020 2020 2020 2020 2027   {.            '
+00025930: 4f70 656e 273a 2766 6972 7374 272c 0a20  Open':'first',. 
+00025940: 2020 2020 2020 2020 2020 2027 4869 6768             'High
+00025950: 273a 276d 6178 272c 0a20 2020 2020 2020  ':'max',.       
+00025960: 2020 2020 2027 4c6f 7727 3a27 6d69 6e27       'Low':'min'
+00025970: 2c0a 2020 2020 2020 2020 2020 2020 2743  ,.            'C
+00025980: 6c6f 7365 273a 276c 6173 7427 2c0a 2020  lose':'last',.  
+00025990: 2020 2020 2020 2020 2020 2756 6f6c 756d            'Volum
+000259a0: 6527 3a27 7375 6d27 0a20 2020 2020 2020  e':'sum'.       
+000259b0: 207d 0a20 2020 2020 2020 2023 2066 696e   }.        # fin
+000259c0: 616c 5f64 6620 3d20 6466 2e72 6573 616d  al_df = df.resam
+000259d0: 706c 6528 2757 2d46 5249 272c 2063 6c6f  ple('W-FRI', clo
+000259e0: 7365 643d 276c 6566 7427 292e 6167 6728  sed='left').agg(
+000259f0: 6f68 6c63 5f64 6963 7429 2e73 6869 6674  ohlc_dict).shift
+00025a00: 2827 3164 2729 0a20 2020 2020 2020 2077  ('1d').        w
+00025a10: 6565 6b6c 7944 6174 6120 3d20 6461 7461  eeklyData = data
+00025a20: 2e72 6573 616d 706c 6528 2757 2729 2e61  .resample('W').a
+00025a30: 6767 286f 686c 635f 6469 6374 290a 2020  gg(ohlc_dict).  
+00025a40: 2020 2020 2020 7265 7665 7273 6564 4461        reversedDa
+00025a50: 7461 203d 2064 6174 615b 3a3a 2d31 5d20  ta = data[::-1] 
+00025a60: 2023 2052 6576 6572 7365 2074 6865 2064   # Reverse the d
+00025a70: 6174 6166 7261 6d65 0a20 2020 2020 2020  ataframe.       
+00025a80: 2072 6563 656e 745f 636c 6f73 6520 3d20   recent_close = 
+00025a90: 6461 7461 5b22 436c 6f73 6522 5d2e 6865  data["Close"].he
+00025aa0: 6164 2831 292e 696c 6f63 5b30 5d0a 2020  ad(1).iloc[0].  
+00025ab0: 2020 2020 2020 775f 656d 615f 3133 203d        w_ema_13 =
+00025ac0: 2070 6b74 616c 6962 2e45 4d41 2877 6565   pktalib.EMA(wee
+00025ad0: 6b6c 7944 6174 615b 2243 6c6f 7365 225d  klyData["Close"]
+00025ae0: 2c74 696d 6570 6572 696f 643d 3133 292e  ,timeperiod=13).
+00025af0: 7461 696c 2831 292e 696c 6f63 5b30 5d0a  tail(1).iloc[0].
+00025b00: 2020 2020 2020 2020 775f 656d 615f 3236          w_ema_26
+00025b10: 203d 2070 6b74 616c 6962 2e45 4d41 2877   = pktalib.EMA(w
+00025b20: 6565 6b6c 7944 6174 615b 2243 6c6f 7365  eeklyData["Close
+00025b30: 225d 2c74 696d 6570 6572 696f 643d 3236  "],timeperiod=26
+00025b40: 292e 7461 696c 2831 292e 696c 6f63 5b30  ).tail(1).iloc[0
+00025b50: 5d0a 2020 2020 2020 2020 775f 736d 615f  ].        w_sma_
+00025b60: 3530 203d 2070 6b74 616c 6962 2e53 4d41  50 = pktalib.SMA
+00025b70: 2877 6565 6b6c 7944 6174 615b 2243 6c6f  (weeklyData["Clo
+00025b80: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
+00025b90: 3530 292e 7461 696c 2831 292e 696c 6f63  50).tail(1).iloc
+00025ba0: 5b30 5d0a 2020 2020 2020 2020 775f 736d  [0].        w_sm
+00025bb0: 615f 3430 203d 2070 6b74 616c 6962 2e53  a_40 = pktalib.S
+00025bc0: 4d41 2877 6565 6b6c 7944 6174 615b 2243  MA(weeklyData["C
+00025bd0: 6c6f 7365 225d 2c74 696d 6570 6572 696f  lose"],timeperio
+00025be0: 643d 3430 292e 7461 696c 2831 292e 696c  d=40).tail(1).il
+00025bf0: 6f63 5b30 5d0a 2020 2020 2020 2020 775f  oc[0].        w_
+00025c00: 736d 615f 3430 5f35 775f 6167 6f20 3d20  sma_40_5w_ago = 
+00025c10: 706b 7461 6c69 622e 534d 4128 7765 656b  pktalib.SMA(week
+00025c20: 6c79 4461 7461 2e68 6561 6428 6c65 6e28  lyData.head(len(
+00025c30: 7765 656b 6c79 4461 7461 292d 3529 5b22  weeklyData)-5)["
+00025c40: 436c 6f73 6522 5d2c 7469 6d65 7065 7269  Close"],timeperi
+00025c50: 6f64 3d34 3029 2e74 6169 6c28 3129 2e69  od=40).tail(1).i
+00025c60: 6c6f 635b 305d 0a20 2020 2020 2020 2077  loc[0].        w
+00025c70: 5f6d 696e 5f35 3020 3d20 6d69 6e28 312e  _min_50 = min(1.
+00025c80: 332a 7765 656b 6c79 4461 7461 2e74 6169  3*weeklyData.tai
+00025c90: 6c28 3530 295b 224c 6f77 225d 290a 2020  l(50)["Low"]).  
+00025ca0: 2020 2020 2020 775f 6d61 785f 3530 203d        w_max_50 =
+00025cb0: 206d 6178 2830 2e37 352a 7765 656b 6c79   max(0.75*weekly
+00025cc0: 4461 7461 2e74 6169 6c28 3530 295b 2248  Data.tail(50)["H
+00025cd0: 6967 6822 5d29 0a20 2020 2020 2020 2077  igh"]).        w
+00025ce0: 5f65 6d61 5f32 365f 3230 775f 6167 6f20  _ema_26_20w_ago 
+00025cf0: 3d20 706b 7461 6c69 622e 454d 4128 7765  = pktalib.EMA(we
+00025d00: 656b 6c79 4461 7461 2e68 6561 6428 6c65  eklyData.head(le
+00025d10: 6e28 7765 656b 6c79 4461 7461 292d 3230  n(weeklyData)-20
+00025d20: 295b 2243 6c6f 7365 225d 2c74 696d 6570  )["Close"],timep
+00025d30: 6572 696f 643d 3236 292e 7461 696c 2831  eriod=26).tail(1
+00025d40: 292e 696c 6f63 5b30 5d0a 2020 2020 2020  ).iloc[0].      
+00025d50: 2020 7265 6365 6e74 5f65 6d61 5f31 335f    recent_ema_13_
+00025d60: 3230 645f 6167 6f20 3d20 706b 7461 6c69  20d_ago = pktali
+00025d70: 622e 454d 4128 7265 7665 7273 6564 4461  b.EMA(reversedDa
+00025d80: 7461 2e68 6561 6428 6c65 6e28 7265 7665  ta.head(len(reve
+00025d90: 7273 6564 4461 7461 292d 3230 295b 2243  rsedData)-20)["C
+00025da0: 6c6f 7365 225d 2c74 696d 6570 6572 696f  lose"],timeperio
+00025db0: 643d 3133 292e 7461 696c 2831 292e 696c  d=13).tail(1).il
+00025dc0: 6f63 5b30 5d0a 2020 2020 2020 2020 775f  oc[0].        w_
+00025dd0: 736d 615f 3430 5f35 775f 6167 6f20 3d20  sma_40_5w_ago = 
+00025de0: 706b 7461 6c69 622e 534d 4128 7765 656b  pktalib.SMA(week
+00025df0: 6c79 4461 7461 2e68 6561 6428 6c65 6e28  lyData.head(len(
+00025e00: 7765 656b 6c79 4461 7461 292d 3529 5b22  weeklyData)-5)["
+00025e10: 436c 6f73 6522 5d2c 7469 6d65 7065 7269  Close"],timeperi
+00025e20: 6f64 3d34 3029 2e74 6169 6c28 3129 2e69  od=40).tail(1).i
+00025e30: 6c6f 635b 305d 0a20 2020 2020 2020 2077  loc[0].        w
+00025e40: 5f73 6d61 5f34 305f 3130 775f 6167 6f20  _sma_40_10w_ago 
+00025e50: 3d20 706b 7461 6c69 622e 534d 4128 7765  = pktalib.SMA(we
+00025e60: 656b 6c79 4461 7461 2e68 6561 6428 6c65  eklyData.head(le
+00025e70: 6e28 7765 656b 6c79 4461 7461 292d 3130  n(weeklyData)-10
+00025e80: 295b 2243 6c6f 7365 225d 2c74 696d 6570  )["Close"],timep
+00025e90: 6572 696f 643d 3430 292e 7461 696c 2831  eriod=40).tail(1
+00025ea0: 292e 696c 6f63 5b30 5d0a 2020 2020 2020  ).iloc[0].      
+00025eb0: 2020 7265 6365 6e74 5f73 6d61 5f35 3020    recent_sma_50 
+00025ec0: 3d20 706b 7461 6c69 622e 534d 4128 7265  = pktalib.SMA(re
+00025ed0: 7665 7273 6564 4461 7461 5b22 436c 6f73  versedData["Clos
+00025ee0: 6522 5d2c 7469 6d65 7065 7269 6f64 3d35  e"],timeperiod=5
+00025ef0: 3029 2e74 6169 6c28 3129 2e69 6c6f 635b  0).tail(1).iloc[
+00025f00: 305d 0a20 2020 2020 2020 2077 5f77 6d61  0].        w_wma
+00025f10: 5f38 203d 2070 6b74 616c 6962 2e57 4d41  _8 = pktalib.WMA
+00025f20: 2877 6565 6b6c 7944 6174 615b 2243 6c6f  (weeklyData["Clo
+00025f30: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
+00025f40: 3829 2e74 6169 6c28 3129 2e69 6c6f 635b  8).tail(1).iloc[
+00025f50: 305d 0a20 2020 2020 2020 2077 5f73 6d61  0].        w_sma
+00025f60: 5f38 203d 2070 6b74 616c 6962 2e53 4d41  _8 = pktalib.SMA
+00025f70: 2877 6565 6b6c 7944 6174 615b 2243 6c6f  (weeklyData["Clo
+00025f80: 7365 225d 2c74 696d 6570 6572 696f 643d  se"],timeperiod=
+00025f90: 3829 2e74 6169 6c28 3129 2e69 6c6f 635b  8).tail(1).iloc[
+00025fa0: 305d 0a20 2020 2020 2020 206e 756d 5072  0].        numPr
+00025fb0: 6576 696f 7573 4361 6e64 6c65 7320 3d20  eviousCandles = 
+00025fc0: 3230 0a20 2020 2020 2020 2070 756c 6c62  20.        pullb
+00025fd0: 6163 6b44 6174 6120 3d20 6461 7461 2e68  ackData = data.h
+00025fe0: 6561 6428 6e75 6d50 7265 7669 6f75 7343  ead(numPreviousC
+00025ff0: 616e 646c 6573 290a 2020 2020 2020 2020  andles).        
+00026000: 7075 6c6c 6261 636b 4461 7461 2e6c 6f63  pullbackData.loc
+00026010: 5b3a 2c27 5075 6c6c 4261 636b 275d 203d  [:,'PullBack'] =
+00026020: 2070 756c 6c62 6163 6b44 6174 615b 2243   pullbackData["C
+00026030: 6c6f 7365 225d 2e6c 7428 7075 6c6c 6261  lose"].lt(pullba
+00026040: 636b 4461 7461 5b22 4f70 656e 225d 2920  ckData["Open"]) 
+00026050: 232e 7368 6966 7428 7065 7269 6f64 733d  #.shift(periods=
+00026060: 3129 2920 2326 2064 6174 615b 224c 6f77  1)) #& data["Low
+00026070: 225d 2e6c 7428 6461 7461 5b22 4c6f 7722  "].lt(data["Low"
+00026080: 5d2e 7368 6966 7428 7065 7269 6f64 733d  ].shift(periods=
+00026090: 3129 290a 2020 2020 2020 2020 7368 7269  1)).        shri
+000260a0: 6e6b 6564 566f 6c44 6174 6120 3d20 7075  nkedVolData = pu
+000260b0: 6c6c 6261 636b 4461 7461 5b70 756c 6c62  llbackData[pullb
+000260c0: 6163 6b44 6174 615b 2250 756c 6c42 6163  ackData["PullBac
+000260d0: 6b22 5d20 3d3d 2054 7275 655d 2e68 6561  k"] == True].hea
+000260e0: 6428 6e75 6d50 7265 7669 6f75 7343 616e  d(numPreviousCan
+000260f0: 646c 6573 290a 2020 2020 2020 2020 7265  dles).        re
+00026100: 6365 6e74 4c61 7267 6573 7456 6f6c 756d  centLargestVolum
+00026110: 6520 3d20 6d61 7828 7075 6c6c 6261 636b  e = max(pullback
+00026120: 4461 7461 5b70 756c 6c62 6163 6b44 6174  Data[pullbackDat
+00026130: 615b 2250 756c 6c42 6163 6b22 5d20 3d3d  a["PullBack"] ==
+00026140: 2046 616c 7365 5d2e 6865 6164 2833 295b   False].head(3)[
+00026150: 2256 6f6c 756d 6522 5d29 0a20 2020 2020  "Volume"]).     
+00026160: 2020 2023 2070 756c 6c62 6163 6b44 6174     # pullbackDat
+00026170: 612e 6c6f 635b 3a2c 2750 4256 6f6c 5261  a.loc[:,'PBVolRa
+00026180: 7469 6f27 5d20 3d20 7075 6c6c 6261 636b  tio'] = pullback
+00026190: 4461 7461 5b22 566f 6c75 6d65 225d 2f72  Data["Volume"]/r
+000261a0: 6563 656e 744c 6172 6765 7374 566f 6c75  ecentLargestVolu
+000261b0: 6d65 0a20 2020 2020 2020 2076 6f6c 496e  me.        volIn
+000261c0: 5072 6576 696f 7573 5075 6c6c 6261 636b  PreviousPullback
+000261d0: 7353 6872 696e 6b65 6420 3d20 4661 6c73  sShrinked = Fals
+000261e0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+000261f0: 2073 6872 696e 6b65 6456 6f6c 4461 7461   shrinkedVolData
+00026200: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
+00026210: 2020 2020 696e 6465 7820 3d20 300a 2020      index = 0.  
+00026220: 2020 2020 2020 2020 2020 7768 696c 6520            while 
+00026230: 696e 6465 7820 3c20 6c65 6e28 7368 7269  index < len(shri
+00026240: 6e6b 6564 566f 6c44 6174 6129 3a0a 2020  nkedVolData):.  
+00026250: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00026260: 6c49 6e50 7265 7669 6f75 7350 756c 6c62  lInPreviousPullb
+00026270: 6163 6b73 5368 7269 6e6b 6564 203d 2073  acksShrinked = s
+00026280: 6872 696e 6b65 6456 6f6c 4461 7461 5b22  hrinkedVolData["
+00026290: 566f 6c75 6d65 225d 2e69 6c6f 635b 696e  Volume"].iloc[in
+000262a0: 6465 785d 203c 2073 656c 662e 636f 6e66  dex] < self.conf
+000262b0: 6967 4d61 6e61 6765 722e 7663 7056 6f6c  igManager.vcpVol
+000262c0: 756d 6543 6f6e 7472 6163 7469 6f6e 5261  umeContractionRa
+000262d0: 7469 6f20 2a20 7265 6365 6e74 4c61 7267  tio * recentLarg
+000262e0: 6573 7456 6f6c 756d 650a 2020 2020 2020  estVolume.      
+000262f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00026300: 2076 6f6c 496e 5072 6576 696f 7573 5075   volInPreviousPu
+00026310: 6c6c 6261 636b 7353 6872 696e 6b65 643a  llbacksShrinked:
+00026320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026330: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00026340: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00026350: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
+00026360: 6365 6e74 566f 6c75 6d65 4861 7341 626f  centVolumeHasAbo
+00026370: 7665 4176 6756 6f6c 203d 2072 6563 656e  veAvgVol = recen
+00026380: 744c 6172 6765 7374 566f 6c75 6d65 203e  tLargestVolume >
+00026390: 3d20 7365 6c66 2e63 6f6e 6669 674d 616e  = self.configMan
+000263a0: 6167 6572 2e76 6f6c 756d 6552 6174 696f  ager.volumeRatio
+000263b0: 202a 2064 6174 615b 2256 6f6c 4d41 225d   * data["VolMA"]
+000263c0: 2e69 6c6f 635b 305d 0a20 2020 2020 2020  .iloc[0].       
+000263d0: 2069 7356 4350 203d 2077 5f65 6d61 5f31   isVCP = w_ema_1
+000263e0: 3320 3e20 775f 656d 615f 3236 2061 6e64  3 > w_ema_26 and
+000263f0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00026400: 2020 2077 5f65 6d61 5f32 3620 3e20 775f     w_ema_26 > w_
+00026410: 736d 615f 3530 2061 6e64 205c 0a20 2020  sma_50 and \.   
+00026420: 2020 2020 2020 2020 2020 2020 2077 5f73               w_s
+00026430: 6d61 5f34 3020 3e20 775f 736d 615f 3430  ma_40 > w_sma_40
+00026440: 5f35 775f 6167 6f20 616e 6420 5c0a 2020  _5w_ago and \.  
+00026450: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00026460: 6365 6e74 5f63 6c6f 7365 203e 3d20 775f  cent_close >= w_
+00026470: 6d69 6e5f 3530 2061 6e64 205c 0a20 2020  min_50 and \.   
+00026480: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00026490: 656e 745f 636c 6f73 6520 3e3d 2077 5f6d  ent_close >= w_m
+000264a0: 6178 5f35 3020 616e 6420 5c0a 2020 2020  ax_50 and \.    
+000264b0: 2020 2020 2020 2020 2020 2020 7265 6365              rece
+000264c0: 6e74 5f65 6d61 5f31 335f 3230 645f 6167  nt_ema_13_20d_ag
+000264d0: 6f20 3e20 775f 656d 615f 3236 5f32 3077  o > w_ema_26_20w
+000264e0: 5f61 676f 2061 6e64 205c 0a20 2020 2020  _ago and \.     
+000264f0: 2020 2020 2020 2020 2020 2077 5f73 6d61             w_sma
+00026500: 5f34 305f 3577 5f61 676f 203e 2077 5f73  _40_5w_ago > w_s
+00026510: 6d61 5f34 305f 3130 775f 6167 6f20 616e  ma_40_10w_ago an
+00026520: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+00026530: 2020 2020 7265 6365 6e74 5f63 6c6f 7365      recent_close
+00026540: 203e 2072 6563 656e 745f 736d 615f 3530   > recent_sma_50
+00026550: 2061 6e64 205c 0a20 2020 2020 2020 2020   and \.         
+00026560: 2020 2020 2020 2028 775f 776d 615f 3820         (w_wma_8 
+00026570: 2d20 775f 736d 615f 3829 2a36 2f32 3920  - w_sma_8)*6/29 
+00026580: 3c20 302e 3520 616e 6420 5c0a 2020 2020  < 0.5 and \.    
+00026590: 2020 2020 2020 2020 2020 2020 766f 6c49              volI
+000265a0: 6e50 7265 7669 6f75 7350 756c 6c62 6163  nPreviousPullbac
+000265b0: 6b73 5368 7269 6e6b 6564 2061 6e64 205c  ksShrinked and \
+000265c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000265d0: 2072 6563 656e 7456 6f6c 756d 6548 6173   recentVolumeHas
+000265e0: 4162 6f76 6541 7667 566f 6c20 616e 6420  AboveAvgVol and 
+000265f0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00026600: 2020 7265 6365 6e74 5f63 6c6f 7365 203e    recent_close >
+00026610: 2031 300a 2020 2020 2020 2020 6966 2069   10.        if i
+00026620: 7356 4350 3a0a 2020 2020 2020 2020 2020  sVCP:.          
+00026630: 2020 7361 7665 6420 3d20 7365 6c66 2e66    saved = self.f
+00026640: 696e 6443 7572 7265 6e74 5361 7665 6456  indCurrentSavedV
+00026650: 616c 7565 2873 6372 6565 6e44 6963 742c  alue(screenDict,
+00026660: 2073 6176 6544 6963 742c 2022 5061 7474   saveDict, "Patt
+00026670: 6572 6e22 290a 2020 2020 2020 2020 2020  ern").          
+00026680: 2020 7363 7265 656e 4469 6374 5b22 5061    screenDict["Pa
+00026690: 7474 6572 6e22 5d20 3d20 280a 2020 2020  ttern"] = (.    
+000266a0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+000266b0: 645b 305d 200a 2020 2020 2020 2020 2020  d[0] .          
+000266c0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
+000266d0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
+000266e0: 2020 2020 2020 202b 2063 6f6c 6f72 5465         + colorTe
+000266f0: 7874 2e47 5245 454e 0a20 2020 2020 2020  xt.GREEN.       
+00026700: 2020 2020 2020 2020 202b 2066 2256 4350           + f"VCP
+00026710: 284d 696e 6572 7669 6e69 2922 0a20 2020  (Minervini)".   
+00026720: 2020 2020 2020 2020 2020 2020 202b 2063               + c
+00026730: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
+00026740: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00026750: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
+00026760: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
+00026770: 6564 5b31 5d20 2b20 6622 5643 5028 4d69  ed[1] + f"VCP(Mi
+00026780: 6e65 7276 696e 6929 220a 2020 2020 2020  nervini)".      
+00026790: 2020 7265 7475 726e 2069 7356 4350 0a20    return isVCP. 
+000267a0: 2020 200a 2020 2020 2320 5661 6c69 6461     .    # Valida
+000267b0: 7465 2056 4350 0a20 2020 2064 6566 2076  te VCP.    def v
+000267c0: 616c 6964 6174 6556 4350 280a 2020 2020  alidateVCP(.    
+000267d0: 2020 2020 7365 6c66 2c20 6466 2c20 7363      self, df, sc
+000267e0: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
+000267f0: 6374 2c20 7374 6f63 6b4e 616d 653d 4e6f  ct, stockName=No
+00026800: 6e65 2c20 7769 6e64 6f77 3d33 2c20 7065  ne, window=3, pe
+00026810: 7263 656e 7461 6765 4672 6f6d 546f 703d  rcentageFromTop=
+00026820: 330a 2020 2020 293a 0a20 2020 2020 2020  3.    ):.       
+00026830: 2069 6620 6466 2069 7320 4e6f 6e65 206f   if df is None o
+00026840: 7220 6c65 6e28 6466 2920 3d3d 2030 3a0a  r len(df) == 0:.
+00026850: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00026860: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00026870: 2064 6174 6120 3d20 6466 2e63 6f70 7928   data = df.copy(
+00026880: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00026890: 2020 2020 2020 2020 2020 2070 6572 6365             perce
+000268a0: 6e74 6167 6546 726f 6d54 6f70 202f 3d20  ntageFromTop /= 
+000268b0: 3130 300a 2020 2020 2020 2020 2020 2020  100.            
+000268c0: 6461 7461 2e72 6573 6574 5f69 6e64 6578  data.reset_index
+000268d0: 2869 6e70 6c61 6365 3d54 7275 6529 0a20  (inplace=True). 
+000268e0: 2020 2020 2020 2020 2020 2064 6174 612e             data.
+000268f0: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d7b  rename(columns={
+00026900: 2269 6e64 6578 223a 2022 4461 7465 227d  "index": "Date"}
+00026910: 2c20 696e 706c 6163 653d 5472 7565 290a  , inplace=True).
+00026920: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00026930: 5b22 746f 7073 225d 203d 2028 6461 7461  ["tops"] = (data
+00026940: 5b22 4869 6768 225d 2e69 6c6f 635b 6c69  ["High"].iloc[li
+00026950: 7374 2870 6b74 616c 6962 2e61 7267 7265  st(pktalib.argre
+00026960: 6c65 7874 7265 6d61 286e 702e 6172 7261  lextrema(np.arra
+00026970: 7928 6461 7461 5b22 4869 6768 225d 292c  y(data["High"]),
+00026980: 206e 702e 6772 6561 7465 725f 6571 7561   np.greater_equa
+00026990: 6c2c 206f 7264 6572 3d77 696e 646f 7729  l, order=window)
+000269a0: 5b30 5d29 5d2e 6865 6164 2834 2929 0a20  [0])].head(4)). 
+000269b0: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+000269c0: 2262 6f74 7322 5d20 3d20 2864 6174 615b  "bots"] = (data[
+000269d0: 224c 6f77 225d 2e69 6c6f 635b 6c69 7374  "Low"].iloc[list
+000269e0: 2870 6b74 616c 6962 2e61 7267 7265 6c65  (pktalib.argrele
+000269f0: 7874 7265 6d61 286e 702e 6172 7261 7928  xtrema(np.array(
+00026a00: 6461 7461 5b22 4c6f 7722 5d29 2c20 6e70  data["Low"]), np
+00026a10: 2e6c 6573 735f 6571 7561 6c2c 206f 7264  .less_equal, ord
+00026a20: 6572 3d77 696e 646f 7729 5b30 5d29 5d2e  er=window)[0])].
+00026a30: 6865 6164 2834 2929 0a20 2020 2020 2020  head(4)).       
+00026a40: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+00026a50: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
+00026a60: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
+00026a70: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
+00026a80: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
+00026a90: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+00026aa0: 7320 3d20 6461 7461 5b64 6174 612e 746f  s = data[data.to
+00026ab0: 7073 203e 2030 5d0a 2020 2020 2020 2020  ps > 0].        
+00026ac0: 2020 2020 2320 626f 7473 203d 2064 6174      # bots = dat
+00026ad0: 615b 6461 7461 2e62 6f74 7320 3e20 305d  a[data.bots > 0]
+00026ae0: 0a20 2020 2020 2020 2020 2020 2068 6967  .            hig
+00026af0: 6865 7374 546f 7020 3d20 726f 756e 6428  hestTop = round(
+00026b00: 746f 7073 2e64 6573 6372 6962 6528 295b  tops.describe()[
+00026b10: 2248 6967 6822 5d5b 226d 6178 225d 2c20  "High"]["max"], 
+00026b20: 3129 0a20 2020 2020 2020 2020 2020 2066  1).            f
+00026b30: 696c 7465 7265 6454 6f70 7320 3d20 746f  ilteredTops = to
+00026b40: 7073 5b0a 2020 2020 2020 2020 2020 2020  ps[.            
+00026b50: 2020 2020 746f 7073 2e74 6f70 7320 3e20      tops.tops > 
+00026b60: 2868 6967 6865 7374 546f 7020 2d20 2868  (highestTop - (h
+00026b70: 6967 6865 7374 546f 7020 2a20 7065 7263  ighestTop * perc
+00026b80: 656e 7461 6765 4672 6f6d 546f 7029 290a  entageFromTop)).
+00026b90: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+00026ba0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+00026bb0: 7465 7265 6454 6f70 732e 6571 7561 6c73  teredTops.equals
+00026bc0: 2874 6f70 7329 3a20 2023 2054 6f70 7320  (tops):  # Tops 
+00026bd0: 6172 6520 696e 2074 6865 2072 616e 6765  are in the range
+00026be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026bf0: 206c 6f77 506f 696e 7473 203d 205b 5d0a   lowPoints = [].
+00026c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c10: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00026c20: 656e 2874 6f70 7329 202d 2031 293a 0a20  en(tops) - 1):. 
+00026c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c40: 2020 2065 6e64 4461 7465 203d 2074 6f70     endDate = top
+00026c50: 732e 696c 6f63 5b69 5d5b 2244 6174 6522  s.iloc[i]["Date"
+00026c60: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00026c70: 2020 2020 2020 7374 6172 7444 6174 6520        startDate 
+00026c80: 3d20 746f 7073 2e69 6c6f 635b 6920 2b20  = tops.iloc[i + 
+00026c90: 315d 5b22 4461 7465 225d 0a20 2020 2020  1]["Date"].     
+00026ca0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00026cb0: 6f77 506f 696e 7473 2e61 7070 656e 6428  owPoints.append(
+00026cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026cd0: 2020 2020 2020 2020 2064 6174 615b 0a20           data[. 
+00026ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026cf0: 2020 2020 2020 2020 2020 2028 6461 7461             (data
+00026d00: 2e44 6174 6520 3e3d 2073 7461 7274 4461  .Date >= startDa
+00026d10: 7465 2920 2620 2864 6174 612e 4461 7465  te) & (data.Date
+00026d20: 203c 3d20 656e 6444 6174 6529 0a20 2020   <= endDate).   
+00026d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026d40: 2020 2020 205d 2e64 6573 6372 6962 6528       ].describe(
+00026d50: 295b 224c 6f77 225d 5b22 6d69 6e22 5d0a  )["Low"]["min"].
 00026d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026d70: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00026d80: 2020 2020 2020 2073 6176 6544 6963 745b         saveDict[
-00026d90: 2250 6174 7465 726e 225d 203d 2073 6176  "Pattern"] = sav
-00026da0: 6564 5b31 5d20 2b20 6622 5643 5020 2842  ed[1] + f"VCP (B
-00026db0: 4f3a 207b 6869 6768 6573 7454 6f70 7d29  O: {highestTop})
-00026dc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00026dd0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00026de0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00026df0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00026e00: 2020 2320 7072 6167 6d61 3a20 6e6f 2063    # pragma: no c
-00026e10: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
-00026e20: 2073 656c 662e 6465 6661 756c 745f 6c6f   self.default_lo
-00026e30: 6767 6572 2e64 6562 7567 2865 2c20 6578  gger.debug(e, ex
-00026e40: 635f 696e 666f 3d54 7275 6529 0a20 2020  c_info=True).   
-00026e50: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00026e60: 650a 0a20 2020 2023 2056 616c 6964 6174  e..    # Validat
-00026e70: 6520 6966 2076 6f6c 756d 6520 6f66 206c  e if volume of l
-00026e80: 6173 7420 6461 7920 6973 2068 6967 6865  ast day is highe
-00026e90: 7220 7468 616e 2061 7667 0a20 2020 2064  r than avg.    d
-00026ea0: 6566 2076 616c 6964 6174 6556 6f6c 756d  ef validateVolum
-00026eb0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-00026ec0: 2064 662c 2073 6372 6565 6e44 6963 742c   df, screenDict,
-00026ed0: 2073 6176 6544 6963 742c 2076 6f6c 756d   saveDict, volum
-00026ee0: 6552 6174 696f 3d32 2e35 2c20 6d69 6e56  eRatio=2.5, minV
-00026ef0: 6f6c 756d 653d 3130 300a 2020 2020 293a  olume=100.    ):
-00026f00: 0a20 2020 2020 2020 2069 6620 6466 2069  .        if df i
-00026f10: 7320 4e6f 6e65 206f 7220 6c65 6e28 6466  s None or len(df
-00026f20: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00026f30: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00026f40: 2c20 4661 6c73 650a 2020 2020 2020 2020  , False.        
-00026f50: 6461 7461 203d 2064 662e 636f 7079 2829  data = df.copy()
-00026f60: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00026f70: 6461 7461 2e66 696c 6c6e 6128 3029 0a20  data.fillna(0). 
-00026f80: 2020 2020 2020 2064 6174 6120 3d20 6461         data = da
-00026f90: 7461 2e72 6570 6c61 6365 285b 6e70 2e69  ta.replace([np.i
-00026fa0: 6e66 2c20 2d6e 702e 696e 665d 2c20 3029  nf, -np.inf], 0)
-00026fb0: 0a20 2020 2020 2020 2072 6563 656e 7420  .        recent 
-00026fc0: 3d20 6461 7461 2e68 6561 6428 3129 0a20  = data.head(1). 
-00026fd0: 2020 2020 2020 2023 2045 6974 6865 7220         # Either 
-00026fe0: 7468 6520 726f 6c6c 696e 6720 766f 6c75  the rolling volu
-00026ff0: 6d65 206f 6620 7061 7374 2032 3020 7365  me of past 20 se
-00027000: 7373 696f 6e73 206f 7220 746f 6461 7927  ssions or today'
-00027010: 7320 766f 6c75 6d65 2073 686f 756c 6420  s volume should 
-00027020: 6265 203e 206d 696e 2076 6f6c 756d 650a  be > min volume.
-00027030: 2020 2020 2020 2020 6861 734d 696e 696d          hasMinim
-00027040: 756d 566f 6c75 6d65 203d 2028 0a20 2020  umVolume = (.   
-00027050: 2020 2020 2020 2020 2072 6563 656e 745b           recent[
-00027060: 2256 6f6c 4d41 225d 2e69 6c6f 635b 305d  "VolMA"].iloc[0]
-00027070: 203e 3d20 6d69 6e56 6f6c 756d 650a 2020   >= minVolume.  
-00027080: 2020 2020 2020 2020 2020 6f72 2072 6563            or rec
-00027090: 656e 745b 2256 6f6c 756d 6522 5d2e 696c  ent["Volume"].il
-000270a0: 6f63 5b30 5d20 3e3d 206d 696e 566f 6c75  oc[0] >= minVolu
-000270b0: 6d65 0a20 2020 2020 2020 2029 0a20 2020  me.        ).   
-000270c0: 2020 2020 2069 6620 7265 6365 6e74 5b22       if recent["
-000270d0: 566f 6c4d 4122 5d2e 696c 6f63 5b30 5d20  VolMA"].iloc[0] 
-000270e0: 3d3d 2030 3a20 2023 2048 616e 646c 6573  == 0:  # Handles
-000270f0: 2044 6976 6964 6520 6279 2030 2077 6172   Divide by 0 war
-00027100: 6e69 6e67 0a20 2020 2020 2020 2020 2020  ning.           
-00027110: 2073 6176 6544 6963 745b 2256 6f6c 756d   saveDict["Volum
-00027120: 6522 5d20 3d20 3020 2023 2022 556e 6b6e  e"] = 0  # "Unkn
-00027130: 6f77 6e22 0a20 2020 2020 2020 2020 2020  own".           
-00027140: 2073 6372 6565 6e44 6963 745b 2256 6f6c   screenDict["Vol
-00027150: 756d 6522 5d20 3d20 300a 2020 2020 2020  ume"] = 0.      
-00027160: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00027170: 7365 2c20 6861 734d 696e 696d 756d 566f  se, hasMinimumVo
-00027180: 6c75 6d65 0a20 2020 2020 2020 2072 6174  lume.        rat
-00027190: 696f 203d 2072 6f75 6e64 2872 6563 656e  io = round(recen
-000271a0: 745b 2256 6f6c 756d 6522 5d2e 696c 6f63  t["Volume"].iloc
-000271b0: 5b30 5d20 2f20 7265 6365 6e74 5b22 566f  [0] / recent["Vo
-000271c0: 6c4d 4122 5d2e 696c 6f63 5b30 5d2c 2032  lMA"].iloc[0], 2
-000271d0: 290a 2020 2020 2020 2020 7361 7665 4469  ).        saveDi
-000271e0: 6374 5b22 566f 6c75 6d65 225d 203d 2072  ct["Volume"] = r
-000271f0: 6174 696f 0a20 2020 2020 2020 2069 6620  atio.        if 
-00027200: 7261 7469 6f20 3e3d 2076 6f6c 756d 6552  ratio >= volumeR
-00027210: 6174 696f 2061 6e64 2072 6174 696f 2021  atio and ratio !
-00027220: 3d20 6e70 2e6e 616e 2061 6e64 2028 6e6f  = np.nan and (no
-00027230: 7420 6d61 7468 2e69 7369 6e66 2872 6174  t math.isinf(rat
-00027240: 696f 2929 3a0a 2020 2020 2020 2020 2020  io)):.          
-00027250: 2020 7363 7265 656e 4469 6374 5b22 566f    screenDict["Vo
-00027260: 6c75 6d65 225d 203d 2072 6174 696f 0a20  lume"] = ratio. 
-00027270: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00027280: 6e20 5472 7565 2c20 6861 734d 696e 696d  n True, hasMinim
-00027290: 756d 566f 6c75 6d65 0a20 2020 2020 2020  umVolume.       
-000272a0: 2073 6372 6565 6e44 6963 745b 2256 6f6c   screenDict["Vol
-000272b0: 756d 6522 5d20 3d20 7261 7469 6f0a 2020  ume"] = ratio.  
-000272c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000272d0: 7365 2c20 6861 734d 696e 696d 756d 566f  se, hasMinimumVo
-000272e0: 6c75 6d65 0a0a 2020 2020 2320 4669 6e64  lume..    # Find
-000272f0: 2069 6620 7374 6f63 6b20 6973 2076 616c   if stock is val
-00027300: 6964 6174 696e 6720 766f 6c75 6d65 2073  idating volume s
-00027310: 7072 6561 6420 616e 616c 7973 6973 0a20  pread analysis. 
-00027320: 2020 2064 6566 2076 616c 6964 6174 6556     def validateV
-00027330: 6f6c 756d 6553 7072 6561 6441 6e61 6c79  olumeSpreadAnaly
-00027340: 7369 7328 7365 6c66 2c20 6466 2c20 7363  sis(self, df, sc
-00027350: 7265 656e 4469 6374 2c20 7361 7665 4469  reenDict, saveDi
-00027360: 6374 293a 0a20 2020 2020 2020 2074 7279  ct):.        try
-00027370: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00027380: 2064 6620 6973 204e 6f6e 6520 6f72 206c   df is None or l
-00027390: 656e 2864 6629 203d 3d20 303a 0a20 2020  en(df) == 0:.   
-000273a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000273b0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-000273c0: 2020 2020 2020 6461 7461 203d 2064 662e        data = df.
-000273d0: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-000273e0: 2020 2064 6174 6120 3d20 6461 7461 2e68     data = data.h
-000273f0: 6561 6428 3229 0a20 2020 2020 2020 2020  ead(2).         
-00027400: 2020 2069 6620 6c65 6e28 6461 7461 2920     if len(data) 
-00027410: 3c20 323a 0a20 2020 2020 2020 2020 2020  < 2:.           
-00027420: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00027430: 650a 2020 2020 2020 2020 2020 2020 7472  e.            tr
-00027440: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00027450: 2020 2023 2043 6865 636b 2066 6f72 2070     # Check for p
-00027460: 7265 7669 6f75 7320 5245 4420 6361 6e64  revious RED cand
-00027470: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-00027480: 2020 2020 2320 4375 7272 656e 7420 6361      # Current ca
-00027490: 6e64 6c65 203d 2030 7468 2c20 5072 6576  ndle = 0th, Prev
-000274a0: 696f 7573 2043 616e 646c 6520 3d20 3173  ious Candle = 1s
-000274b0: 7420 666f 7220 666f 6c6c 6f77 696e 6720  t for following 
-000274c0: 6c6f 6769 630a 2020 2020 2020 2020 2020  logic.          
-000274d0: 2020 2020 2020 6966 2064 6174 612e 696c        if data.il
-000274e0: 6f63 5b31 5d5b 224f 7065 6e22 5d20 3e3d  oc[1]["Open"] >=
-000274f0: 2064 6174 612e 696c 6f63 5b31 5d5b 2243   data.iloc[1]["C
-00027500: 6c6f 7365 225d 3a0a 2020 2020 2020 2020  lose"]:.        
-00027510: 2020 2020 2020 2020 2020 2020 7370 7265              spre
-00027520: 6164 3120 3d20 6162 7328 6461 7461 2e69  ad1 = abs(data.i
-00027530: 6c6f 635b 315d 5b22 4f70 656e 225d 202d  loc[1]["Open"] -
-00027540: 2064 6174 612e 696c 6f63 5b31 5d5b 2243   data.iloc[1]["C
-00027550: 6c6f 7365 225d 290a 2020 2020 2020 2020  lose"]).        
-00027560: 2020 2020 2020 2020 2020 2020 7370 7265              spre
-00027570: 6164 3020 3d20 6162 7328 6461 7461 2e69  ad0 = abs(data.i
-00027580: 6c6f 635b 305d 5b22 4f70 656e 225d 202d  loc[0]["Open"] -
-00027590: 2064 6174 612e 696c 6f63 5b30 5d5b 2243   data.iloc[0]["C
-000275a0: 6c6f 7365 225d 290a 2020 2020 2020 2020  lose"]).        
-000275b0: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
-000275c0: 725f 7769 636b 5f73 7072 6561 6430 203d  r_wick_spread0 =
-000275d0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-000275e0: 2020 2020 2020 2020 2020 206d 6178 2864             max(d
-000275f0: 6174 612e 696c 6f63 5b30 5d5b 224f 7065  ata.iloc[0]["Ope
-00027600: 6e22 5d2c 2064 6174 612e 696c 6f63 5b30  n"], data.iloc[0
-00027610: 5d5b 2243 6c6f 7365 225d 290a 2020 2020  ]["Close"]).    
-00027620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027630: 2020 2020 2d20 6461 7461 2e69 6c6f 635b      - data.iloc[
-00027640: 305d 5b22 4c6f 7722 5d0a 2020 2020 2020  0]["Low"].      
-00027650: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00027660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027670: 2020 2020 766f 6c31 203d 2064 6174 612e      vol1 = data.
-00027680: 696c 6f63 5b31 5d5b 2256 6f6c 756d 6522  iloc[1]["Volume"
-00027690: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000276a0: 2020 2020 2020 766f 6c30 203d 2064 6174        vol0 = dat
-000276b0: 612e 696c 6f63 5b30 5d5b 2256 6f6c 756d  a.iloc[0]["Volum
-000276c0: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-000276d0: 2020 2020 2020 2020 7361 7665 6420 3d20          saved = 
-000276e0: 7365 6c66 2e66 696e 6443 7572 7265 6e74  self.findCurrent
-000276f0: 5361 7665 6456 616c 7565 2873 6372 6565  SavedValue(scree
-00027700: 6e44 6963 742c 2073 6176 6544 6963 742c  nDict, saveDict,
-00027710: 2022 5061 7474 6572 6e22 290a 2020 2020   "Pattern").    
-00027720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027730: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00027740: 2020 2020 2020 2020 2020 2020 2073 7072               spr
-00027750: 6561 6430 203e 2073 7072 6561 6431 0a20  ead0 > spread1. 
-00027760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027770: 2020 2020 2020 2061 6e64 2076 6f6c 3020         and vol0 
-00027780: 3c20 766f 6c31 0a20 2020 2020 2020 2020  < vol1.         
-00027790: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000277a0: 6e64 2064 6174 612e 696c 6f63 5b30 5d5b  nd data.iloc[0][
-000277b0: 2256 6f6c 756d 6522 5d20 3c20 6461 7461  "Volume"] < data
-000277c0: 2e69 6c6f 635b 305d 5b22 566f 6c4d 4122  .iloc[0]["VolMA"
-000277d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000277e0: 2020 2020 2020 2020 2020 616e 6420 6461            and da
-000277f0: 7461 2e69 6c6f 635b 305d 5b22 436c 6f73  ta.iloc[0]["Clos
-00027800: 6522 5d20 3c3d 2064 6174 612e 696c 6f63  e"] <= data.iloc
-00027810: 5b31 5d5b 224f 7065 6e22 5d0a 2020 2020  [1]["Open"].    
-00027820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027830: 2020 2020 616e 6420 7370 7265 6164 3020      and spread0 
-00027840: 3c20 6c6f 7765 725f 7769 636b 5f73 7072  < lower_wick_spr
-00027850: 6561 6430 0a20 2020 2020 2020 2020 2020  ead0.           
-00027860: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00027870: 2064 6174 612e 696c 6f63 5b30 5d5b 2256   data.iloc[0]["V
-00027880: 6f6c 756d 6522 5d20 3c3d 2069 6e74 2864  olume"] <= int(d
-00027890: 6174 612e 696c 6f63 5b31 5d5b 2256 6f6c  ata.iloc[1]["Vol
-000278a0: 756d 6522 5d20 2a20 302e 3735 290a 2020  ume"] * 0.75).  
-000278b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278c0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-000278d0: 2020 2020 2020 2020 2020 2020 2073 6372               scr
-000278e0: 6565 6e44 6963 745b 2250 6174 7465 726e  eenDict["Pattern
-000278f0: 225d 203d 2028 0a20 2020 2020 2020 2020  "] = (.         
+00026d70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00026d80: 2020 2020 2020 6c6f 7750 6f69 6e74 734f        lowPointsO
+00026d90: 7267 203d 206c 6f77 506f 696e 7473 0a20  rg = lowPoints. 
+00026da0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00026db0: 6f77 506f 696e 7473 2e73 6f72 7428 7265  owPoints.sort(re
+00026dc0: 7665 7273 653d 5472 7565 290a 2020 2020  verse=True).    
+00026dd0: 2020 2020 2020 2020 2020 2020 6c6f 7750              lowP
+00026de0: 6f69 6e74 7353 6f72 7465 6420 3d20 6c6f  ointsSorted = lo
+00026df0: 7750 6f69 6e74 730a 2020 2020 2020 2020  wPoints.        
+00026e00: 2020 2020 2020 2020 6966 2064 6174 612e          if data.
+00026e10: 656d 7074 7920 6f72 206c 656e 286c 6f77  empty or len(low
+00026e20: 506f 696e 7473 2920 3c20 313a 0a20 2020  Points) < 1:.   
+00026e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026e40: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00026e50: 2020 2020 2020 2020 2020 2020 2020 6c74                lt
+00026e60: 7020 3d20 6461 7461 2e68 6561 6428 3129  p = data.head(1)
+00026e70: 5b22 436c 6f73 6522 5d2e 696c 6f63 5b30  ["Close"].iloc[0
+00026e80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00026e90: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+00026ea0: 2020 2020 2020 2020 2020 206c 6f77 506f             lowPo
+00026eb0: 696e 7473 4f72 6720 3d3d 206c 6f77 506f  intsOrg == lowPo
+00026ec0: 696e 7473 536f 7274 6564 0a20 2020 2020  intsSorted.     
+00026ed0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00026ee0: 6e64 206c 7470 203c 2068 6967 6865 7374  nd ltp < highest
+00026ef0: 546f 700a 2020 2020 2020 2020 2020 2020  Top.            
+00026f00: 2020 2020 2020 2020 616e 6420 6c74 7020          and ltp 
+00026f10: 3e20 6c6f 7750 6f69 6e74 735b 305d 0a20  > lowPoints[0]. 
+00026f20: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00026f30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026f40: 2020 2020 2020 7361 7665 6420 3d20 7365        saved = se
+00026f50: 6c66 2e66 696e 6443 7572 7265 6e74 5361  lf.findCurrentSa
+00026f60: 7665 6456 616c 7565 2873 6372 6565 6e44  vedValue(screenD
+00026f70: 6963 742c 2073 6176 6544 6963 742c 2022  ict, saveDict, "
+00026f80: 5061 7474 6572 6e22 290a 2020 2020 2020  Pattern").      
+00026f90: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+00026fa0: 7265 656e 4469 6374 5b22 5061 7474 6572  reenDict["Patter
+00026fb0: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
+00026fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026fd0: 7361 7665 645b 305d 200a 2020 2020 2020  saved[0] .      
+00026fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ff0: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+00027000: 4c44 0a20 2020 2020 2020 2020 2020 2020  LD.             
+00027010: 2020 2020 2020 2020 2020 202b 2063 6f6c             + col
+00027020: 6f72 5465 7874 2e47 5245 454e 0a20 2020  orText.GREEN.   
+00027030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027040: 2020 2020 202b 2066 2256 4350 2028 424f       + f"VCP (BO
+00027050: 3a20 7b68 6967 6865 7374 546f 707d 2922  : {highestTop})"
+00027060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027070: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+00027080: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00027090: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000270a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000270b0: 2020 2073 6176 6544 6963 745b 2250 6174     saveDict["Pat
+000270c0: 7465 726e 225d 203d 2073 6176 6564 5b31  tern"] = saved[1
+000270d0: 5d20 2b20 6622 5643 5020 2842 4f3a 207b  ] + f"VCP (BO: {
+000270e0: 6869 6768 6573 7454 6f70 7d29 220a 2020  highestTop})".  
+000270f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027100: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+00027110: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00027120: 6570 7469 6f6e 2061 7320 653a 2020 2320  eption as e:  # 
+00027130: 7072 6167 6d61 3a20 6e6f 2063 6f76 6572  pragma: no cover
+00027140: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00027150: 662e 6465 6661 756c 745f 6c6f 6767 6572  f.default_logger
+00027160: 2e64 6562 7567 2865 2c20 6578 635f 696e  .debug(e, exc_in
+00027170: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
+00027180: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00027190: 2020 2023 2056 616c 6964 6174 6520 6966     # Validate if
+000271a0: 2076 6f6c 756d 6520 6f66 206c 6173 7420   volume of last 
+000271b0: 6461 7920 6973 2068 6967 6865 7220 7468  day is higher th
+000271c0: 616e 2061 7667 0a20 2020 2064 6566 2076  an avg.    def v
+000271d0: 616c 6964 6174 6556 6f6c 756d 6528 0a20  alidateVolume(. 
+000271e0: 2020 2020 2020 2073 656c 662c 2064 662c         self, df,
+000271f0: 2073 6372 6565 6e44 6963 742c 2073 6176   screenDict, sav
+00027200: 6544 6963 742c 2076 6f6c 756d 6552 6174  eDict, volumeRat
+00027210: 696f 3d32 2e35 2c20 6d69 6e56 6f6c 756d  io=2.5, minVolum
+00027220: 653d 3130 300a 2020 2020 293a 0a20 2020  e=100.    ):.   
+00027230: 2020 2020 2069 6620 6466 2069 7320 4e6f       if df is No
+00027240: 6e65 206f 7220 6c65 6e28 6466 2920 3d3d  ne or len(df) ==
+00027250: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00027260: 7265 7475 726e 2046 616c 7365 2c20 4661  return False, Fa
+00027270: 6c73 650a 2020 2020 2020 2020 6461 7461  lse.        data
+00027280: 203d 2064 662e 636f 7079 2829 0a20 2020   = df.copy().   
+00027290: 2020 2020 2064 6174 6120 3d20 6461 7461       data = data
+000272a0: 2e66 696c 6c6e 6128 3029 0a20 2020 2020  .fillna(0).     
+000272b0: 2020 2064 6174 6120 3d20 6461 7461 2e72     data = data.r
+000272c0: 6570 6c61 6365 285b 6e70 2e69 6e66 2c20  eplace([np.inf, 
+000272d0: 2d6e 702e 696e 665d 2c20 3029 0a20 2020  -np.inf], 0).   
+000272e0: 2020 2020 2072 6563 656e 7420 3d20 6461       recent = da
+000272f0: 7461 2e68 6561 6428 3129 0a20 2020 2020  ta.head(1).     
+00027300: 2020 2023 2045 6974 6865 7220 7468 6520     # Either the 
+00027310: 726f 6c6c 696e 6720 766f 6c75 6d65 206f  rolling volume o
+00027320: 6620 7061 7374 2032 3020 7365 7373 696f  f past 20 sessio
+00027330: 6e73 206f 7220 746f 6461 7927 7320 766f  ns or today's vo
+00027340: 6c75 6d65 2073 686f 756c 6420 6265 203e  lume should be >
+00027350: 206d 696e 2076 6f6c 756d 650a 2020 2020   min volume.    
+00027360: 2020 2020 6861 734d 696e 696d 756d 566f      hasMinimumVo
+00027370: 6c75 6d65 203d 2028 0a20 2020 2020 2020  lume = (.       
+00027380: 2020 2020 2072 6563 656e 745b 2256 6f6c       recent["Vol
+00027390: 4d41 225d 2e69 6c6f 635b 305d 203e 3d20  MA"].iloc[0] >= 
+000273a0: 6d69 6e56 6f6c 756d 650a 2020 2020 2020  minVolume.      
+000273b0: 2020 2020 2020 6f72 2072 6563 656e 745b        or recent[
+000273c0: 2256 6f6c 756d 6522 5d2e 696c 6f63 5b30  "Volume"].iloc[0
+000273d0: 5d20 3e3d 206d 696e 566f 6c75 6d65 0a20  ] >= minVolume. 
+000273e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000273f0: 2069 6620 7265 6365 6e74 5b22 566f 6c4d   if recent["VolM
+00027400: 4122 5d2e 696c 6f63 5b30 5d20 3d3d 2030  A"].iloc[0] == 0
+00027410: 3a20 2023 2048 616e 646c 6573 2044 6976  :  # Handles Div
+00027420: 6964 6520 6279 2030 2077 6172 6e69 6e67  ide by 0 warning
+00027430: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
+00027440: 6544 6963 745b 2256 6f6c 756d 6522 5d20  eDict["Volume"] 
+00027450: 3d20 3020 2023 2022 556e 6b6e 6f77 6e22  = 0  # "Unknown"
+00027460: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+00027470: 6565 6e44 6963 745b 2256 6f6c 756d 6522  eenDict["Volume"
+00027480: 5d20 3d20 300a 2020 2020 2020 2020 2020  ] = 0.          
+00027490: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+000274a0: 6861 734d 696e 696d 756d 566f 6c75 6d65  hasMinimumVolume
+000274b0: 0a20 2020 2020 2020 2072 6174 696f 203d  .        ratio =
+000274c0: 2072 6f75 6e64 2872 6563 656e 745b 2256   round(recent["V
+000274d0: 6f6c 756d 6522 5d2e 696c 6f63 5b30 5d20  olume"].iloc[0] 
+000274e0: 2f20 7265 6365 6e74 5b22 566f 6c4d 4122  / recent["VolMA"
+000274f0: 5d2e 696c 6f63 5b30 5d2c 2032 290a 2020  ].iloc[0], 2).  
+00027500: 2020 2020 2020 7361 7665 4469 6374 5b22        saveDict["
+00027510: 566f 6c75 6d65 225d 203d 2072 6174 696f  Volume"] = ratio
+00027520: 0a20 2020 2020 2020 2069 6620 7261 7469  .        if rati
+00027530: 6f20 3e3d 2076 6f6c 756d 6552 6174 696f  o >= volumeRatio
+00027540: 2061 6e64 2072 6174 696f 2021 3d20 6e70   and ratio != np
+00027550: 2e6e 616e 2061 6e64 2028 6e6f 7420 6d61  .nan and (not ma
+00027560: 7468 2e69 7369 6e66 2872 6174 696f 2929  th.isinf(ratio))
+00027570: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
+00027580: 7265 656e 4469 6374 5b22 566f 6c75 6d65  reenDict["Volume
+00027590: 225d 203d 2072 6174 696f 0a20 2020 2020  "] = ratio.     
+000275a0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+000275b0: 7565 2c20 6861 734d 696e 696d 756d 566f  ue, hasMinimumVo
+000275c0: 6c75 6d65 0a20 2020 2020 2020 2073 6372  lume.        scr
+000275d0: 6565 6e44 6963 745b 2256 6f6c 756d 6522  eenDict["Volume"
+000275e0: 5d20 3d20 7261 7469 6f0a 2020 2020 2020  ] = ratio.      
+000275f0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00027600: 6861 734d 696e 696d 756d 566f 6c75 6d65  hasMinimumVolume
+00027610: 0a0a 2020 2020 2320 4669 6e64 2069 6620  ..    # Find if 
+00027620: 7374 6f63 6b20 6973 2076 616c 6964 6174  stock is validat
+00027630: 696e 6720 766f 6c75 6d65 2073 7072 6561  ing volume sprea
+00027640: 6420 616e 616c 7973 6973 0a20 2020 2064  d analysis.    d
+00027650: 6566 2076 616c 6964 6174 6556 6f6c 756d  ef validateVolum
+00027660: 6553 7072 6561 6441 6e61 6c79 7369 7328  eSpreadAnalysis(
+00027670: 7365 6c66 2c20 6466 2c20 7363 7265 656e  self, df, screen
+00027680: 4469 6374 2c20 7361 7665 4469 6374 293a  Dict, saveDict):
+00027690: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000276a0: 2020 2020 2020 2020 2020 6966 2064 6620            if df 
+000276b0: 6973 204e 6f6e 6520 6f72 206c 656e 2864  is None or len(d
+000276c0: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
+000276d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000276e0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000276f0: 2020 6461 7461 203d 2064 662e 636f 7079    data = df.copy
+00027700: 2829 0a20 2020 2020 2020 2020 2020 2064  ().            d
+00027710: 6174 6120 3d20 6461 7461 2e68 6561 6428  ata = data.head(
+00027720: 3229 0a20 2020 2020 2020 2020 2020 2069  2).            i
+00027730: 6620 6c65 6e28 6461 7461 2920 3c20 323a  f len(data) < 2:
+00027740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027750: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00027760: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00027770: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00027780: 2043 6865 636b 2066 6f72 2070 7265 7669   Check for previ
+00027790: 6f75 7320 5245 4420 6361 6e64 6c65 730a  ous RED candles.
+000277a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000277b0: 2320 4375 7272 656e 7420 6361 6e64 6c65  # Current candle
+000277c0: 203d 2030 7468 2c20 5072 6576 696f 7573   = 0th, Previous
+000277d0: 2043 616e 646c 6520 3d20 3173 7420 666f   Candle = 1st fo
+000277e0: 7220 666f 6c6c 6f77 696e 6720 6c6f 6769  r following logi
+000277f0: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+00027800: 2020 6966 2064 6174 612e 696c 6f63 5b31    if data.iloc[1
+00027810: 5d5b 224f 7065 6e22 5d20 3e3d 2064 6174  ]["Open"] >= dat
+00027820: 612e 696c 6f63 5b31 5d5b 2243 6c6f 7365  a.iloc[1]["Close
+00027830: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+00027840: 2020 2020 2020 2020 7370 7265 6164 3120          spread1 
+00027850: 3d20 6162 7328 6461 7461 2e69 6c6f 635b  = abs(data.iloc[
+00027860: 315d 5b22 4f70 656e 225d 202d 2064 6174  1]["Open"] - dat
+00027870: 612e 696c 6f63 5b31 5d5b 2243 6c6f 7365  a.iloc[1]["Close
+00027880: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+00027890: 2020 2020 2020 2020 7370 7265 6164 3020          spread0 
+000278a0: 3d20 6162 7328 6461 7461 2e69 6c6f 635b  = abs(data.iloc[
+000278b0: 305d 5b22 4f70 656e 225d 202d 2064 6174  0]["Open"] - dat
+000278c0: 612e 696c 6f63 5b30 5d5b 2243 6c6f 7365  a.iloc[0]["Close
+000278d0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+000278e0: 2020 2020 2020 2020 6c6f 7765 725f 7769          lower_wi
+000278f0: 636b 5f73 7072 6561 6430 203d 2028 0a20  ck_spread0 = (. 
 00027900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027910: 2020 2073 6176 6564 5b30 5d20 0a20 2020     saved[0] .   
-00027920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027930: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
-00027940: 5465 7874 2e42 4f4c 440a 2020 2020 2020  Text.BOLD.      
+00027910: 2020 2020 2020 206d 6178 2864 6174 612e         max(data.
+00027920: 696c 6f63 5b30 5d5b 224f 7065 6e22 5d2c  iloc[0]["Open"],
+00027930: 2064 6174 612e 696c 6f63 5b30 5d5b 2243   data.iloc[0]["C
+00027940: 6c6f 7365 225d 290a 2020 2020 2020 2020  lose"]).        
 00027950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027960: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00027970: 742e 4752 4545 4e0a 2020 2020 2020 2020  t.GREEN.        
-00027980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027990: 2020 2020 2b20 2253 7570 706c 7920 4472      + "Supply Dr
-000279a0: 6f75 6768 7422 0a20 2020 2020 2020 2020  ought".         
-000279b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279c0: 2020 202b 2063 6f6c 6f72 5465 7874 2e45     + colorText.E
-000279d0: 4e44 0a20 2020 2020 2020 2020 2020 2020  ND.             
-000279e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00027960: 2d20 6461 7461 2e69 6c6f 635b 305d 5b22  - data.iloc[0]["
+00027970: 4c6f 7722 5d0a 2020 2020 2020 2020 2020  Low"].          
+00027980: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00027990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279a0: 766f 6c31 203d 2064 6174 612e 696c 6f63  vol1 = data.iloc
+000279b0: 5b31 5d5b 2256 6f6c 756d 6522 5d0a 2020  [1]["Volume"].  
+000279c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279d0: 2020 766f 6c30 203d 2064 6174 612e 696c    vol0 = data.il
+000279e0: 6f63 5b30 5d5b 2256 6f6c 756d 6522 5d0a  oc[0]["Volume"].
 000279f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a00: 2020 2020 2073 6176 6544 6963 745b 2250       saveDict["P
-00027a10: 6174 7465 726e 225d 203d 2073 6176 6564  attern"] = saved
-00027a20: 5b31 5d20 2b20 2253 7570 706c 7920 4472  [1] + "Supply Dr
-00027a30: 6f75 6768 7422 0a20 2020 2020 2020 2020  ought".         
-00027a40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00027a50: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00027a60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00027a70: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00027a80: 2020 2020 2020 2020 2020 2020 7370 7265              spre
-00027a90: 6164 3020 3c20 7370 7265 6164 310a 2020  ad0 < spread1.  
-00027aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ab0: 2020 2020 2020 616e 6420 766f 6c30 203e        and vol0 >
-00027ac0: 2076 6f6c 310a 2020 2020 2020 2020 2020   vol1.          
-00027ad0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00027ae0: 6420 6461 7461 2e69 6c6f 635b 305d 5b22  d data.iloc[0]["
-00027af0: 566f 6c75 6d65 225d 203e 2064 6174 612e  Volume"] > data.
-00027b00: 696c 6f63 5b30 5d5b 2256 6f6c 4d41 225d  iloc[0]["VolMA"]
-00027b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027b20: 2020 2020 2020 2020 2061 6e64 2064 6174           and dat
-00027b30: 612e 696c 6f63 5b30 5d5b 2243 6c6f 7365  a.iloc[0]["Close
-00027b40: 225d 203c 3d20 6461 7461 2e69 6c6f 635b  "] <= data.iloc[
-00027b50: 315d 5b22 4f70 656e 225d 0a20 2020 2020  1]["Open"].     
-00027b60: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00027b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027b80: 2020 2020 2020 2020 2020 7363 7265 656e            screen
-00027b90: 4469 6374 5b22 5061 7474 6572 6e22 5d20  Dict["Pattern"] 
-00027ba0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00027bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027bc0: 7361 7665 645b 305d 200a 2020 2020 2020  saved[0] .      
-00027bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027be0: 2020 2020 2020 2b20 636f 6c6f 7254 6578        + colorTex
-00027bf0: 742e 424f 4c44 0a20 2020 2020 2020 2020  t.BOLD.         
-00027c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c10: 2020 202b 2063 6f6c 6f72 5465 7874 2e47     + colorText.G
-00027c20: 5245 454e 0a20 2020 2020 2020 2020 2020  REEN.           
-00027c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c40: 202b 2022 4465 6d61 6e64 2052 6973 6522   + "Demand Rise"
-00027c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027c60: 2020 2020 2020 2020 2020 2020 202b 2063               + c
-00027c70: 6f6c 6f72 5465 7874 2e45 4e44 0a20 2020  olorText.END.   
+00027a00: 2020 2020 7361 7665 6420 3d20 7365 6c66      saved = self
+00027a10: 2e66 696e 6443 7572 7265 6e74 5361 7665  .findCurrentSave
+00027a20: 6456 616c 7565 2873 6372 6565 6e44 6963  dValue(screenDic
+00027a30: 742c 2073 6176 6544 6963 742c 2022 5061  t, saveDict, "Pa
+00027a40: 7474 6572 6e22 290a 2020 2020 2020 2020  ttern").        
+00027a50: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00027a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027a70: 2020 2020 2020 2020 2073 7072 6561 6430           spread0
+00027a80: 203e 2073 7072 6561 6431 0a20 2020 2020   > spread1.     
+00027a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027aa0: 2020 2061 6e64 2076 6f6c 3020 3c20 766f     and vol0 < vo
+00027ab0: 6c31 0a20 2020 2020 2020 2020 2020 2020  l1.             
+00027ac0: 2020 2020 2020 2020 2020 2061 6e64 2064             and d
+00027ad0: 6174 612e 696c 6f63 5b30 5d5b 2256 6f6c  ata.iloc[0]["Vol
+00027ae0: 756d 6522 5d20 3c20 6461 7461 2e69 6c6f  ume"] < data.ilo
+00027af0: 635b 305d 5b22 566f 6c4d 4122 5d0a 2020  c[0]["VolMA"].  
+00027b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b10: 2020 2020 2020 616e 6420 6461 7461 2e69        and data.i
+00027b20: 6c6f 635b 305d 5b22 436c 6f73 6522 5d20  loc[0]["Close"] 
+00027b30: 3c3d 2064 6174 612e 696c 6f63 5b31 5d5b  <= data.iloc[1][
+00027b40: 224f 7065 6e22 5d0a 2020 2020 2020 2020  "Open"].        
+00027b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b60: 616e 6420 7370 7265 6164 3020 3c20 6c6f  and spread0 < lo
+00027b70: 7765 725f 7769 636b 5f73 7072 6561 6430  wer_wick_spread0
+00027b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027b90: 2020 2020 2020 2020 2061 6e64 2064 6174           and dat
+00027ba0: 612e 696c 6f63 5b30 5d5b 2256 6f6c 756d  a.iloc[0]["Volum
+00027bb0: 6522 5d20 3c3d 2069 6e74 2864 6174 612e  e"] <= int(data.
+00027bc0: 696c 6f63 5b31 5d5b 2256 6f6c 756d 6522  iloc[1]["Volume"
+00027bd0: 5d20 2a20 302e 3735 290a 2020 2020 2020  ] * 0.75).      
+00027be0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+00027bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027c00: 2020 2020 2020 2020 2073 6372 6565 6e44           screenD
+00027c10: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
+00027c20: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00027c30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00027c40: 6176 6564 5b30 5d20 0a20 2020 2020 2020  aved[0] .       
+00027c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c60: 2020 2020 202b 2063 6f6c 6f72 5465 7874       + colorText
+00027c70: 2e42 4f4c 440a 2020 2020 2020 2020 2020  .BOLD.          
 00027c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00027ca0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00027cb0: 6176 6544 6963 745b 2250 6174 7465 726e  aveDict["Pattern
-00027cc0: 225d 203d 2073 6176 6564 5b31 5d20 2b20  "] = saved[1] + 
-00027cd0: 2244 656d 616e 6420 5269 7365 220a 2020  "Demand Rise".  
-00027ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027cf0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00027d00: 650a 2020 2020 2020 2020 2020 2020 6578  e.            ex
-00027d10: 6365 7074 2049 6e64 6578 4572 726f 7220  cept IndexError 
-00027d20: 6173 2065 3a20 2320 7072 6167 6d61 3a20  as e: # pragma: 
-00027d30: 6e6f 2063 6f76 6572 0a20 2020 2020 2020  no cover.       
-00027d40: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-00027d50: 6661 756c 745f 6c6f 6767 6572 2e64 6562  fault_logger.deb
-00027d60: 7567 2865 2c20 6578 635f 696e 666f 3d54  ug(e, exc_info=T
-00027d70: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00027d80: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00027d90: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00027da0: 7365 0a20 2020 2020 2020 2065 7863 6570  se.        excep
-00027db0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00027dc0: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
-00027dd0: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
-00027de0: 2020 7365 6c66 2e64 6566 6175 6c74 5f6c    self.default_l
-00027df0: 6f67 6765 722e 6465 6275 6728 652c 2065  ogger.debug(e, e
-00027e00: 7863 5f69 6e66 6f3d 5472 7565 290a 2020  xc_info=True).  
-00027e10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00027e20: 2046 616c 7365 0a                         False.
+00027c90: 2020 2b20 636f 6c6f 7254 6578 742e 4752    + colorText.GR
+00027ca0: 4545 4e0a 2020 2020 2020 2020 2020 2020  EEN.            
+00027cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027cc0: 2b20 2253 7570 706c 7920 4472 6f75 6768  + "Supply Drough
+00027cd0: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
+00027ce0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00027cf0: 2063 6f6c 6f72 5465 7874 2e45 4e44 0a20   colorText.END. 
+00027d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00027d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d30: 2073 6176 6544 6963 745b 2250 6174 7465   saveDict["Patte
+00027d40: 726e 225d 203d 2073 6176 6564 5b31 5d20  rn"] = saved[1] 
+00027d50: 2b20 2253 7570 706c 7920 4472 6f75 6768  + "Supply Drough
+00027d60: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
+00027d70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00027d80: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
+00027d90: 2020 2020 2020 2020 2020 2069 6620 280a             if (.
+00027da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027db0: 2020 2020 2020 2020 7370 7265 6164 3020          spread0 
+00027dc0: 3c20 7370 7265 6164 310a 2020 2020 2020  < spread1.      
+00027dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027de0: 2020 616e 6420 766f 6c30 203e 2076 6f6c    and vol0 > vol
+00027df0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00027e00: 2020 2020 2020 2020 2020 616e 6420 6461            and da
+00027e10: 7461 2e69 6c6f 635b 305d 5b22 566f 6c75  ta.iloc[0]["Volu
+00027e20: 6d65 225d 203e 2064 6174 612e 696c 6f63  me"] > data.iloc
+00027e30: 5b30 5d5b 2256 6f6c 4d41 225d 0a20 2020  [0]["VolMA"].   
+00027e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e50: 2020 2020 2061 6e64 2064 6174 612e 696c       and data.il
+00027e60: 6f63 5b30 5d5b 2243 6c6f 7365 225d 203c  oc[0]["Close"] <
+00027e70: 3d20 6461 7461 2e69 6c6f 635b 315d 5b22  = data.iloc[1]["
+00027e80: 4f70 656e 225d 0a20 2020 2020 2020 2020  Open"].         
+00027e90: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
+00027ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027eb0: 2020 2020 2020 7363 7265 656e 4469 6374        screenDict
+00027ec0: 5b22 5061 7474 6572 6e22 5d20 3d20 280a  ["Pattern"] = (.
+00027ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ee0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00027ef0: 645b 305d 200a 2020 2020 2020 2020 2020  d[0] .          
+00027f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f10: 2020 2b20 636f 6c6f 7254 6578 742e 424f    + colorText.BO
+00027f20: 4c44 0a20 2020 2020 2020 2020 2020 2020  LD.             
+00027f30: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00027f40: 2063 6f6c 6f72 5465 7874 2e47 5245 454e   colorText.GREEN
+00027f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027f60: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00027f70: 4465 6d61 6e64 2052 6973 6522 0a20 2020  Demand Rise".   
+00027f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f90: 2020 2020 2020 2020 202b 2063 6f6c 6f72           + color
+00027fa0: 5465 7874 2e45 4e44 0a20 2020 2020 2020  Text.END.       
+00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fc0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00027fd0: 2020 2020 2020 2020 2020 2073 6176 6544             saveD
+00027fe0: 6963 745b 2250 6174 7465 726e 225d 203d  ict["Pattern"] =
+00027ff0: 2073 6176 6564 5b31 5d20 2b20 2244 656d   saved[1] + "Dem
+00028000: 616e 6420 5269 7365 220a 2020 2020 2020  and Rise".      
+00028010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028020: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+00028030: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00028040: 2049 6e64 6578 4572 726f 7220 6173 2065   IndexError as e
+00028050: 3a20 2320 7072 6167 6d61 3a20 6e6f 2063  : # pragma: no c
+00028060: 6f76 6572 0a20 2020 2020 2020 2020 2020  over.           
+00028070: 2020 2020 2073 656c 662e 6465 6661 756c       self.defaul
+00028080: 745f 6c6f 6767 6572 2e64 6562 7567 2865  t_logger.debug(e
+00028090: 2c20 6578 635f 696e 666f 3d54 7275 6529  , exc_info=True)
+000280a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000280b0: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+000280c0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+000280d0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000280e0: 6365 7074 696f 6e20 6173 2065 3a20 2023  ception as e:  #
+000280f0: 2070 7261 676d 613a 206e 6f20 636f 7665   pragma: no cove
+00028100: 720a 2020 2020 2020 2020 2020 2020 7365  r.            se
+00028110: 6c66 2e64 6566 6175 6c74 5f6c 6f67 6765  lf.default_logge
+00028120: 722e 6465 6275 6728 652c 2065 7863 5f69  r.debug(e, exc_i
+00028130: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
+00028140: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00028150: 7365 0a                                  se.
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/StockScreener.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/StockScreener.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/UserMenuChoicesHandler.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/UserMenuChoicesHandler.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/Utility.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/Utility.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/WorkflowManager.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/WorkflowManager.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/classes/keys.py` & `pkscreener-0.45.20240601.425/pkscreener/classes/keys.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/courbd.ttf` & `pkscreener-0.45.20240601.425/pkscreener/courbd.ttf`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/globals.py` & `pkscreener-0.45.20240601.425/pkscreener/globals.py`

 * *Files 1% similar despite different names*

```diff
@@ -1256,14 +1256,16 @@
             atrSensitivity = input(colorText.WARN + f"Enter the ATR Trailing Stop Sensitivity (Multiplier) value (Optimal:1, Current={configManager.atrTrailingStopSensitivity}):") or configManager.atrTrailingStopSensitivity
             configManager.atrTrailingStopSensitivity = atrSensitivity
             atrPeriod = input(colorText.WARN + f"Enter the ATR Period value (Optimal:10, Current={configManager.atrTrailingStopPeriod}):") or configManager.atrTrailingStopPeriod
             configManager.atrTrailingStopPeriod = atrPeriod
             atrEma = input(colorText.WARN + f"Enter the ATR EMA period (Optimal:200, Current={configManager.atrTrailingStopEMAPeriod}):") or configManager.atrTrailingStopEMAPeriod
             configManager.atrTrailingStopEMAPeriod = atrEma
             configManager.setConfig(ConfigManager.parser,default=True,showFileCreatedText=False)
+        # Ensure we have the template JSONs from vectorBt
+        screener.computeBuySellSignals(None)
 
     if executeOption == 42:
         Utility.tools.getLastScreenedResults(defaultAnswer)
         return None, None
     if executeOption >= MAX_SUPPORTED_MENU_OPTION and executeOption <= MAX_MENU_OPTION:
         OutputControls().printOutput(
             colorText.BOLD
@@ -1585,15 +1587,15 @@
                 gClient.df_to_sheet(df=df,sheetName=runOption)
                 OutputControls().printOutput(f"{colorText.GREEN} => Done in {round(time.time()-begin,2)}s{colorText.END}")
     except:
         pass
     if "RUNNER" not in os.environ.keys() and not testing and (userPassedArgs is None or (userPassedArgs is not None and userPassedArgs.user is None and (userPassedArgs.answerdefault is None or userPassedArgs.systemlaunched))):
         prevOutput_results = saveResults.index if (saveResults is not None and not saveResults.empty) else []
         hasFoundStocks = len(prevOutput_results) > 0 and (("|" not in userPassedArgs.options) if (userPassedArgs is not None and userPassedArgs.options is not None) else True)
-        if hasFoundStocks:
+        if hasFoundStocks or configManager.showPinnedMenuEvenForNoResult:
             monitorOption = userPassedArgs.systemlaunched if (userPassedArgs is not None and isinstance(userPassedArgs.systemlaunched,str) and userPassedArgs.systemlaunched is not None) else (userPassedArgs.options if (userPassedArgs is not None and userPassedArgs.options is not None) else "")
             if len(monitorOption) == 0:
                 for choice in selectedChoice.keys():
                     monitorOption = (f"{monitorOption}:" if len(monitorOption) > 0  else '') + f"{selectedChoice[choice]}"
             m0.renderPinnedMenu(substitutes=[monitorOption,len(prevOutput_results)])
             pinOption = input(
                     colorText.BOLD + colorText.FAIL + "[+] Select option: "
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/pkscreener.ini` & `pkscreener-0.45.20240601.425/pkscreener/pkscreener.ini`

 * *Files 14% similar despite different names*

```diff
@@ -20,14 +20,15 @@
 maxnetworkretrycount = 10
 maxnumresultrowsinmonitor = 3
 morninganalysiscandlenumber = 25
 morninganalysiscandleduration = 1m
 onlystagetwostocks = y
 period = 1y
 showpaststrategydata = n
+showpinnedmenuevenfornoresult = y
 showunknowntrends = y
 shuffle = y
 useema = n
 vcpvolumecontractionratio = 0.4
 
 [filters]
 consolidationpercentage = 10.0
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener/pkscreenerbot.py` & `pkscreener-0.45.20240601.425/pkscreener/pkscreenerbot.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener/pkscreenercli.py` & `pkscreener-0.45.20240601.425/pkscreener/pkscreenercli.py`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/pkscreener.egg-info/PKG-INFO` & `pkscreener-0.45.20240601.425/pkscreener.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 Metadata-Version: 2.1
 Name: pkscreener
-Version: 0.45.20240601.424
+Version: 0.45.20240601.425
 Summary: A Python-based stock screener for NSE, India with alerts to Telegram Channel (pkscreener)
 Home-page: https://github.com/pkjmesra/pkscreener
-Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240601.424.zip
+Download-URL: https://github.com/pkjmesra/pkscreener/archive/v0.45.20240601.425.zip
 Author: pkjmesra
 Author-email: pkjmesra@gmail.com
 License: OSI Approved (MIT)
 Keywords: NSE,Technical Indicators,Scanning,Stock Scanners
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
@@ -274,19 +274,19 @@
 * Always backtest and analyze the stocks manually before you trade.
 * The Author(s), the software and any related/unrelated entity will not be held liable for your own investing decisions or losses. The authors or this softfware does not make any claim about the correctness of the results.
 * This screener began as a [fork](https://github.com/pranjal-joshi/Screeni-py) but has since added a lot of additional scanners, backtesting, Telegram bots, Alerts and a number of modifications and improvements.
 
 [MADE-IN-INDIA-badge]: https://img.shields.io/badge/MADE%20WITH%20%E2%9D%A4%20IN-INDIA-orange
 [MADE-IN-INDIA]: https://en.wikipedia.org/wiki/India
 [Windows-badge]: https://img.shields.io/badge/Windows-0078D6?logo=windows&logoColor=white
-[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.exe
+[Windows]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.exe
 [Linux-badge]: https://img.shields.io/badge/Linux-FCC624?logo=linux&logoColor=black
-[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.bin
+[Linux]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.bin
 [Mac OS-badge]: https://img.shields.io/badge/mac%20os-D3D3D3?logo=apple&logoColor=000000
-[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.423/pkscreenercli.run
+[Mac OS]: https://github.com/pkjmesra/PKScreener/releases/download/0.45.20240601.424/pkscreenercli.run
 [GitHub release (latest by date)-badge]: https://img.shields.io/github/v/release/pkjmesra/PKScreener
 [GitHub release (latest by date)]: https://github.com/pkjmesra/PKScreener/releases/latest
 [pypi-badge]: https://img.shields.io/pypi/v/pkscreener.svg?style=flat-square
 [pypi]: https://pypi.python.org/pypi/pkscreener
 [wheel-badge]: https://img.shields.io/pypi/wheel/pkscreener.svg?style=flat-square
 [GitHub all releases]: https://img.shields.io/github/downloads/pkjmesra/PKScreener/total?color=Green&label=Downloads&style=for-the-badge
 [License-badge]: https://img.shields.io/github/license/pkjmesra/PKScreener?style=for-the-badge
```

### Comparing `pkscreener-0.45.20240601.424/pkscreener.egg-info/SOURCES.txt` & `pkscreener-0.45.20240601.425/pkscreener.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `pkscreener-0.45.20240601.424/setup.py` & `pkscreener-0.45.20240601.425/setup.py`

 * *Files identical despite different names*

